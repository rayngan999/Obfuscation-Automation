!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.RenderExtensionLoader=t()}(this,function(){"use strict";var e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};function t(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}return function(){return function(n){var r=n.account,i=n.workspace,o=n.path,s=n.locale,c=n.publicEndpoint,u=n.verbose,a=n.timeout,l=this;if(this.load=function(){return n=l,r=void 0,o=function(){var n,r,i,o;return t(this,function(t){switch(t.label){case 0:return this.time("render-extension-loader:json"),[4,this.get("https://"+this.workspace+"--"+this.account+"."+this.publicEndpoint+"/legacy-extensions"+this.path+"?__disableSSR&locale="+this.locale+"&v=3")];case 1:return n=t.sent(),r=n.runtime,i=n.styles,o=n.scripts,this.timeEnd("render-extension-loader:json"),this.renderMajor=r.renderMajor||6,this.styles=i,this.scripts=o,this.runtime=e({},r,{start:!1}),this.styles&&this.styles.forEach(this.addStyleToPage),this.time("render-extension-loader:scripts"),[4,Promise.all(this.scripts.map(this.addScriptToPage))];case 2:return t.sent(),this.timeEnd("render-extension-loader:scripts"),[2,this.runtime]}})},new((i=void 0)||(i=Promise))(function(e,t){function s(e){try{u(o.next(e))}catch(e){t(e)}}function c(e){try{u(o.throw(e))}catch(e){t(e)}}function u(t){t.done?e(t.value):new i(function(e){e(t.value)}).then(s,c)}u((o=o.apply(n,r||[])).next())});var n,r,i,o},this.update=function(t){return l.runtime="function"==typeof t?t(l.runtime):e({},l.runtime,t),l.runtime},this.render=function(t,n,r){return r&&(l.runtime.extensions[t].props=e({},l.runtime.extensions[t].props,r)),l.time("render-extension-loader:render"),window["__RENDER_"+l.renderMajor+"_RUNTIME__"].render(t,l.runtime,n),l.timeEnd("render-extension-loader:render"),l.runtime},this.getExistingScriptSrcs=function(){for(var e=[],t=0;t<document.scripts.length;t++)e.push(document.scripts.item(t).src);return e},this.scriptOnPage=function(e){return l.getExistingScriptSrcs().some(function(t){return-1!==t.indexOf(e)})},this.addScriptToPage=function(e){return new Promise(function(t,n){if(l.scriptOnPage(e))return t();var r=document.createElement("script");r.crossOrigin="anonymous",r.onload=function(){return t()},r.onerror=function(){return n()},r.async=!1,r.src=e,document.head.appendChild(r)})},this.addStyleToPage=function(e){var t=document.createElement("link");t.href=e,t.type="text/css",t.rel="stylesheet",document.head.appendChild(t)},this.time=function(e){l.verbose&&console.time(e)},this.timeEnd=function(e){l.verbose&&console.timeEnd(e)},this.account=r,this.workspace=i,this.path=o,this.locale=s||"en-US",this.verbose=u,this.timeout=a,this.publicEndpoint=c||(/myvtexdev\.com/.test(window.location.hostname)?"myvtexdev.com":"myvtex.com"),this.get=window.$?function(e){return window.$.ajax({url:e,timeout:l.timeout})}:window.fetch?function(e){return new Promise(function(t,n){var r=setTimeout(function(){n({error:"timeout"})},l.timeout);window.fetch(e).then(function(e){return clearTimeout(r),e}).then(function(e){return e.json()}).then(function(e){return t(e)})})}:null,window.__RUNTIME__||(window.__RUNTIME__={account:r,workspace:i,publicEndpoint:c}),!this.get)throw new Error("Render Extension Loader requires either jQuery.ajax or window.fetch.")}}()});
//# sourceMappingURL=render-extension-loader.js.map
