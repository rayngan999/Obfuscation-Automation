(function(t,e){(function(t,e,a){if(typeof define==='function'&&define.amd){define(['jquery'],t)}
else if(typeof exports==='object'&&typeof Meteor==='undefined'){module.exports=t(require('jquery'))}
else{t(e||a)}}(function(t){'use strict';var n=function(e,n,s){var a={invalid:[],getCaret:function(){try{var t,n=0,o=e.get(0),i=document.selection,s=o.selectionStart;if(i&&navigator.appVersion.indexOf('MSIE 10')===-1){t=i.createRange();t.moveStart('character',-a.val().length);n=t.text.length}
else if(s||s==='0'){n=s};return n}catch(r){}},setCaret:function(t){try{if(e.is(':focus')){var a,n=e.get(0);if(n.setSelectionRange){n.setSelectionRange(t,t)}
else{a=n.createTextRange();a.collapse(!0);a.moveEnd('character',t);a.moveStart('character',t);a.select()}}}catch(s){}},events:function(){e.on('keydown.mask',function(t){e.data('mask-keycode',t.keyCode||t.which);e.data('mask-previus-value',e.val());e.data('mask-previus-caret-pos',a.getCaret());a.maskDigitPosMapOld=a.maskDigitPosMap}).on(t.jMaskGlobals.useInput?'input.mask':'keyup.mask',a.behaviour).on('paste.mask drop.mask',function(){setTimeout(function(){e.keydown().keyup()},100)}).on('change.mask',function(){e.data('changed',!0)}).on('blur.mask',function(){if(r!==a.val()&&!e.data('changed')){e.trigger('change')};e.data('changed',!1)}).on('blur.mask',function(){r=a.val()}).on('focus.mask',function(e){if(s.selectOnFocus===!0){t(e.target).select()}}).on('focusout.mask',function(){if(s.clearIfNotMatch&&!o.test(a.val())){a.val('')}})},getRegexMask:function(){var s=[],a,r,c,l,t,o;for(var e=0;e<n.length;e++){a=i.translation[n.charAt(e)];if(a){r=a.pattern.toString().replace(/.{1}$|^.{1}/g,'');c=a.optional;l=a.recursive;if(l){s.push(n.charAt(e));t={digit:n.charAt(e),pattern:r}}
else{s.push(!c&&!l?r:(r+'?'))}}
else{s.push(n.charAt(e).replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&'))}};o=s.join('');if(t){o=o.replace(new RegExp('('+t.digit+'(.*'+t.digit+')?)'),'($1)?').replace(new RegExp(t.digit,'g'),t.pattern)};return new RegExp(o)},destroyEvents:function(){e.off(['input','keydown','keyup','paste','drop','blur','focusout',''].join('.mask '))},val:function(t){var s=e.is('input'),a=s?'val':'text',n;if(arguments.length>0){if(e[a]()!==t){e[a](t)};n=e}
else{n=e[a]()};return n},calculateCaretPosition:function(t){var d=a.getMasked(),s=a.getCaret();if(t!==d){var i=e.data('mask-previus-caret-pos')||0,l=d.length,c=t.length,f=0,u=0,r=0,o=0,n=0;for(n=s;n<l;n++){if(!a.maskDigitPosMap[n]){break};u++};for(n=s-1;n>=0;n--){if(!a.maskDigitPosMap[n]){break};f++};for(n=s-1;n>=0;n--){if(a.maskDigitPosMap[n]){r++}};for(n=i-1;n>=0;n--){if(a.maskDigitPosMapOld[n]){o++}};if(s>c){s=l*10}
else if(i>=s&&i!==c){if(!a.maskDigitPosMapOld[s]){var v=s;s-=o-r;s-=f;if(a.maskDigitPosMap[s]){s=v}}}
else if(s>i){s+=r-o;s+=u}};return s},behaviour:function(n){n=n||window.event;a.invalid=[];var l=e.data('mask-keycode');if(t.inArray(l,i.byPassKeys)===-1){var s=a.getMasked(),r=a.getCaret(),o=e.data('mask-previus-value')||'';setTimeout(function(){a.setCaret(a.calculateCaretPosition(o))},t.jMaskGlobals.keyStrokeCompensation);a.val(s);a.setCaret(r);return a.callbacks(n)}},getMasked:function(t,l){var v=[],C=l===undefined?a.val():l+'',e=0,k=n.length,o=0,h=C.length,r=1,m='push',f=-1,M=0,g=[],d,b;if(s.reverse){m='unshift';r=-1;d=0;e=k-1;o=h-1;b=function(){return e>-1&&o>-1}}
else{d=k-1;b=function(){return e<k&&o<h}};var y;while(b()){var p=n.charAt(e),u=C.charAt(o),c=i.translation[p];if(c){if(u.match(c.pattern)){v[m](u);if(c.recursive){if(f===-1){f=e}
else if(e===d&&e!==f){e=f-r};if(d===f){e-=r}};e+=r}
else if(u===y){M--;y=undefined}
else if(c.optional){e+=r;o-=r}
else if(c.fallback){v[m](c.fallback);e+=r;o-=r}
else{a.invalid.push({p:o,v:u,e:c.pattern})};o+=r}
else{if(!t){v[m](p)};if(u===p){g.push(o);o+=r}
else{y=p;g.push(o+M);M++};e+=r}};var w=n.charAt(d);if(k===h+1&&!i.translation[w]){v.push(w)};var j=v.join('');a.mapMaskdigitPositions(j,g,h);return j},mapMaskdigitPositions:function(t,e,n){var r=s.reverse?t.length-n:0;a.maskDigitPosMap={};for(var i=0;i<e.length;i++){a.maskDigitPosMap[e[i]+r]=1}},callbacks:function(t){var i=a.val(),c=i!==r,l=[i,t,e,s],o=function(t,e,a){if(typeof s[t]==='function'&&e){s[t].apply(this,a)}};o('onChange',c===!0,l);o('onKeyPress',c===!0,l);o('onComplete',i.length===n.length,l);o('onInvalid',a.invalid.length>0,[i,t,e,a.invalid,s])}};e=t(e);var i=this,r=a.val(),o;n=typeof n==='function'?n(a.val(),undefined,e,s):n;i.mask=n;i.options=s;i.remove=function(){var t=a.getCaret();if(i.options.placeholder){e.removeAttr('placeholder')};if(e.data('mask-maxlength')){e.removeAttr('maxlength')};a.destroyEvents();a.val(i.getCleanVal());a.setCaret(t);return e};i.getCleanVal=function(){return a.getMasked(!0)};i.getMaskedVal=function(t){return a.getMasked(!1,t)};i.init=function(r){r=r||!1;s=s||{};i.clearIfNotMatch=t.jMaskGlobals.clearIfNotMatch;i.byPassKeys=t.jMaskGlobals.byPassKeys;i.translation=t.extend({},t.jMaskGlobals.translation,s.translation);i=t.extend(!0,{},i,s);o=a.getRegexMask();if(r){a.events();a.val(a.getMasked())}
else{if(s.placeholder){e.attr('placeholder',s.placeholder)};if(e.data('mask')){e.attr('autocomplete','off')};for(var l=0,f=!0;l<n.length;l++){var c=i.translation[n.charAt(l)];if(c&&c.recursive){f=!1;break}};if(f){e.attr('maxlength',n.length).data('mask-maxlength',!0)};a.destroyEvents();a.events();var u=a.getCaret();a.val(a.getMasked());a.setCaret(u)}};i.init(!e.is('input'))};t.maskWatchers={};var s=function(){var e=t(this),s={},i='data-mask-',r=e.attr('data-mask');if(e.attr(i+'reverse')){s.reverse=!0};if(e.attr(i+'clearifnotmatch')){s.clearIfNotMatch=!0};if(e.attr(i+'selectonfocus')==='true'){s.selectOnFocus=!0};if(a(e,r,s)){return e.data('mask',new n(this,r,s))}},a=function(e,a,n){n=n||{};var s=t(e).data('mask'),i=JSON.stringify,o=t(e).val()||t(e).text();try{if(typeof a==='function'){a=a(o)};return typeof s!=='object'||i(s.options)!==i(n)||s.mask!==a}catch(r){}},i=function(t){var e=document.createElement('div'),a;t='on'+t;a=(t in e);if(!a){e.setAttribute(t,'return;');a=typeof e[t]==='function'};e=null;return a};t.fn.mask=function(e,s){s=s||{};var i=this.selector,r=t.jMaskGlobals,l=r.watchInterval,c=s.watchInputs||r.watchInputs,o=function(){if(a(this,e,s)){return t(this).data('mask',new n(this,e,s))}};t(this).each(o);if(i&&i!==''&&c){clearInterval(t.maskWatchers[i]);t.maskWatchers[i]=setInterval(function(){t(document).find(i).each(o)},l)};return this};t.fn.masked=function(t){return this.data('mask').getMaskedVal(t)};t.fn.unmask=function(){clearInterval(t.maskWatchers[this.selector]);delete t.maskWatchers[this.selector];return this.each(function(){var e=t(this).data('mask');if(e){e.remove().removeData('mask')}})};t.fn.cleanVal=function(){return this.data('mask').getCleanVal()};t.applyDataMask=function(e){e=e||t.jMaskGlobals.maskElements;var a=(e instanceof t)?e:t(e);a.filter(t.jMaskGlobals.dataMaskAttr).each(s)};var e={maskElements:'input,td,span,div',dataMaskAttr:'*[data-mask]',dataMask:!0,watchInterval:300,watchInputs:!0,keyStrokeCompensation:10,useInput:!/Chrome\/[2-4][0-9]|SamsungBrowser/.test(window.navigator.userAgent)&&i('input'),watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{'0':{pattern:/\d/},'9':{pattern:/\d/,optional:!0},'#':{pattern:/\d/,recursive:!0},'A':{pattern:/[a-zA-Z0-9]/},'S':{pattern:/[a-zA-Z]/}}};t.jMaskGlobals=t.jMaskGlobals||{};e=t.jMaskGlobals=t.extend(!0,{},e,t.jMaskGlobals);if(e.dataMask){t.applyDataMask()};setInterval(function(){if(t.jMaskGlobals.watchDataMask){t.applyDataMask()}},e.watchInterval)},window.jQuery,window.Zepto));t('#credit-card-number').mask('0000000000000000');e.behaviors.phantomClearCvv={attach:function(e){var a=t('#commerce-checkout-flow-phantom-checkout-online-flow',e);if(a.length&&a.attr('action').indexOf('order_review')!==-1){a.find('.form-submit').on('click',function(e){e.preventDefault();var n=a.find('#credit-card-number');if(n.length&&n.val()&&n.val().length>6){var s=n.val().substr(0,6);$binField=t('#bin-number');if($binField.length<1){$last4Field=a.find('.accept-js-data-last4');$binField=$last4Field.clone().removeAttr('class').attr({'name':$last4Field.attr('name').replace('[last4]','[bin]'),'id':'bin-number'}).insertAfter($last4Field)};$binField.val(s)};a.submit();a.find('#edit-phantom-payment-process-cvv-code').val('')})}}}}(jQuery,Drupal));