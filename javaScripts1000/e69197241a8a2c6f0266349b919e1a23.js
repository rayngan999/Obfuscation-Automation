define(['jquery','require','web/modules/mylocations','localization/copy'],function($,require,mylocations,copy){var tmout;function addTooltip(selector){$(selector).mouseover(function(e){var tip=$(this).attr('title');$(this).attr('title','');$(this).children("img:first").attr('alt','');$(this).append('<div id="tooltip"><div class="tipHeader"></div><div class="tipBody">'+tip+'</div></div>');if($.browser.msie&&parseInt($.browser.version)==7)
{$('#tooltip').position({of:$(this),at:"left bottom",my:"left top",offset:"-10 0"}).fadeIn('500').css("visibility","visible");}
else
{$('#tooltip').position({of:$(this),at:"left bottom",my:"left top",offset:"-10 12"}).fadeIn('500').css("visibility","visible");}}).mouseout(function(){$(this).attr('title',$('.tipBody').html());$(this).children("img:first").attr('alt',$('.tipBody').html());$(this).children('div#tooltip').remove();});}
function bindModal(overlays){if(!overlays){return;}
var openSelector=overlays.openSelector,contentClass=overlays.contentClass,closeSelector=overlays.closeSelector;$(openSelector).click(function(e){e.preventDefault();if(openSelector=='a.location-open-window'){if(mylocations.getCount()==10){window.location.href=window._config.url_my_account+window._config.url_edit_locations+'?maxlimit=1';return false;}}
var overlayBox=$(this).attr('href');$(overlayBox).fadeIn(300,function(){if($.browser.msie){this.style.removeAttribute('filter');}}).addClass('opened');var popMargTop=($(overlayBox).height()+24)/2;var popMargLeft=($(overlayBox).width()+24)/2;$(overlayBox).css({'margin-top':-popMargTop,'margin-left':-popMargLeft});$('body').append('<div id="overlay-mask" class="overlay-mask"></div>');$('#overlay-mask').fadeIn(300,function(){if($.browser.msie){this.style.removeAttribute('filter');}});return false;});var closeSelector=closeSelector+', #overlay-mask';var commonClass='#overlay-mask,'+contentClass;$(closeSelector).off("click").on('click',function(evt){$(window).trigger("modalClose");$(commonClass).fadeOut(300,function(){$('#overlay-mask').remove();if($.browser.msie){this.style.removeAttribute('filter');}
if(typeof gigya!='undefined'&&gigya&&$('*[gigid="showLoginUI"]').attr('gigid')){if($('*[gigid="showLoginUI"]').is(':visible')){gigya.socialize.hideUI();}}});return false;});}
function addLocationModal(elements){if($(elements.component).length==0)
return false;$(elements.hoverSelector).mouseover(function(e){$(elements.component).addClass('opened');if(typeof window.placecode=='string'){require(['jquery-ui'],function(jquery_ui){var locSaved=mylocations.checkLocationSaved(window.placecode);if(locSaved==false&&mylocations.getCount()<10&&mylocations.checkBlockedLocations(window.placecode)==false){$(elements.component).fadeIn().css("visibility","visible");tmout=setTimeout(function(){if(!$(elements.component).is(':hover')){$(elements.component).fadeOut();}},10000);}else if(locSaved==true){$(elements.component).css({'height':'60px','margin-top':'24px'}).find('.content-area').html('<div>'+copy.location.favorite_saved+'</div><div class="arrow-location"></div>');$(elements.component).fadeIn().css("visibility","visible");tmout=setTimeout(function(){if(!$(elements.component).is(':hover')){$(elements.component).fadeOut();}},10000);}});}}).click(function(e){$(elements.component).addClass('opened');if(typeof window.placecode=='string'){require(['jquery-ui'],function(jquery_ui){var locSaved=mylocations.checkLocationSaved(window.placecode);if(locSaved==false&&mylocations.getCount()<10){$(elements.component).fadeIn().css("visibility","visible");tmout=setTimeout(function(){if(!$(elements.component).is(':hover')){$(elements.component).fadeOut();}},10000);}else if(locSaved==true){$(elements.component).css({'height':'60px','margin-top':'24px'}).find('.content-area').html('<div>'+copy.location.favorite_saved+'</div><div class="arrow-location"></div>');$(elements.component).fadeIn().css("visibility","visible");tmout=setTimeout(function(){if(!$(elements.component).is(':hover')){$(elements.component).fadeOut();}},10000);}});}});$(elements.component).mouseenter(function(e){window.clearTimeout(tmout);}).mouseleave(function(e){window.clearTimeout(tmout);tmout=setTimeout(function(){$(elements.component).fadeOut();},10000);});$(elements.saveButton).on('click',function(event){event.preventDefault();if(typeof window.placecode=='string'){require(['web/modules/location_search'],function(search){var loc=(typeof window.postalcode!=undefined&&window.postalcode!=null)?window.postalcode:window.placecode;search.addLocation(loc);});}
$(elements.component).fadeOut();});$(elements.cancelButton).on('click',function(event){event.preventDefault();if(typeof window.placecode=='string'){mylocations.updateBlockedLocations(window.placecode);}
$(elements.component).fadeOut();});};function webCamModal(elements){if($(elements.component).length==0)
return false;var popMargTop=($(elements.component).height()+24)/2;var popMargLeft=($(elements.component).width()+24)/2;$(elements.component).css({'margin-top':-popMargTop,'margin-left':-popMargLeft});$(elements.webCam).on('click',function(event){event.preventDefault();$(elements.component).fadeIn().removeClass('visuallyhidden');});$(elements.closeOn).on('click',function(event){event.preventDefault();$(elements.component).fadeOut();});}
function authModal(element){var overlayBox=element;$(overlayBox).fadeIn(300,function(){if($.browser.msie){this.style.removeAttribute('filter');}});var popMargTop=($(overlayBox).height()+24)/2;var popMargLeft=($(overlayBox).width()+24)/2;$(overlayBox).css({'margin-top':-popMargTop,'margin-left':-popMargLeft});$('body').append('<div id="overlay-mask"></div>');$('#overlay-mask').fadeIn(300,function(){if($.browser.msie){this.style.removeAttribute('filter');}}).on('click',function(e){e.preventDefault;return false;});}
function systemAlertOverlay(elements){if($(elements.component).length==0)
return false;var popMargTop=($(elements.component).height()+24)/2;var popMargLeft=($(elements.component).width()+24)/2;$(elements.component).css({'margin-top':-popMargTop,'margin-left':-popMargLeft});$(elements.openOn).on('click',function(event){event.preventDefault();$($(this).attr("href")).fadeIn();});$(elements.closeOn).on('click',function(event){$(elements.component).fadeOut();});}
return{bindToolTip:addTooltip,bind:bindModal,bindAddLocationModal:addLocationModal,bindWebCamModal:webCamModal,bindSystemAlertModal:systemAlertOverlay,bindAuthModal:authModal};});;