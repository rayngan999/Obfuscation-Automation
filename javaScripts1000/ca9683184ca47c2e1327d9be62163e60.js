/**
 * Stackla is made available under a commercial licence
 * and is subject to Stackla's Terms of Service.
 *
 * Refer to https://stackla.com/terms-of-service/ 
 * or contact support@stackla.com for further clarification.
 *
 * Built on 2021-08-02 14:08:45
 */
!function(){"use strict";var a,b=$(document);if(!window.Stackla||!window.Stackla.Trackla){var c={tileVote:"vote",tileComment:"comment",tileLike:"like",tileShare:"share"};a=function(a){var b,c=this;c.events=[],c.tileImpressions=[],c.trackingMethod="realtime",c.writeFrequency=1e4;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);c.init()},a.prototype.init=function(){var a=this;b.on("tileVote",a.handleEvents.bind(a)),b.on("tileComment",a.handleEvents.bind(a)),b.on("tileLike",a.handleEvents.bind(a)),b.on("tileShare",a.handleEvents.bind(a)),b.on("tileExpand",a.handleEvents.bind(a)),b.on("tileClick",a.handleEvents.bind(a)),b.on("tilesAppend",a.handleEvents.bind(a)),b.on("tilesReappear",a.handleEvents.bind(a)),b.on("load",a.handleEvents.bind(a)),"interval"===a.trackingMethod&&a.writeFrequency&&setInterval(a.writeToTrackla.bind(a),a.writeFrequency)},a.prototype.addEvent=function(a,b,c,d){var e=this;e.events.push({category:a,action:b,label:c,value:d})},a.prototype.handleAppend=function(a,b,c){var d=this,e=[];"undefined"==typeof c&&(c=!0),c||(d.tileImpressions.length=0),b&&b.length&&(b.map(function(a){var b=d.getTileId(a);b&&$.inArray(b,d.tileImpressions)===-1&&(d.addEvent("tile","view","",b),d.tileImpressions.push(b),e.push(a))}),e.map(function(a){a.tags&&a.tags.length&&a.tags.map(function(a){d.addEvent("tag","view","",a)})}))},a.prototype.handleClick=function(a,b){var c=this,d=c.getTileId(b);d&&(c.addEvent("tile","click","",d),b.tags&&b.tags.length&&b.tags.map(function(a){c.addEvent("tag","click","",a)}))},a.prototype.handleInteractions=function(a,b){var c=this,d=c.getTileId(b);d&&c.addEvent("tile",a,"",d)},a.prototype.handleLoad=function(a,b){var c=this;b&&b.id&&(c.addEvent("widget","view","",b.id),c.addEvent("parent","load","",{widget_id:b.id,parent_page_url:document.referrer}))},a.prototype.writeToTrackla=function(){var a=this,b=JSON.stringify({stackId:a.stackId,page:window.location.href,events:a.events});a.tracklaEndPoint&&a.stackId&&a.events.length&&(a.events.length=0,$.ajax({url:a.tracklaEndPoint,contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",data:b}))},a.prototype.handleEvents=function(a,b){var d=this,e=a&&a.type||"";switch(e){case"tileClick":case"tileExpand":d.handleClick(e,b);break;case"tilesReappear":d.handleAppend(e,b,!1);break;case"tilesAppend":d.handleAppend(e,b);break;case"load":d.handleLoad(e,b);break;case"tileVote":case"tileLike":case"tileComment":case"tileShare":d.handleInteractions(c[e],b)}"realtime"===d.trackingMethod&&(clearTimeout(d.delayWriteToTrackla),d.delayWriteToTrackla=setTimeout(d.writeToTrackla.bind(d),500))},a.prototype.getTileId=function(a){if(a&&a._id){if("object"==typeof a._id&&a._id.$id)return a._id.$id;if("string"==typeof a._id)return a._id}return null},window.Stackla=window.Stackla||{},window.Stackla.Trackla=a}}();