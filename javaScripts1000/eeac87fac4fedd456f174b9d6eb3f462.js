(function(t,r){var h=Brid.Util,C=Brid.event;t.$bp.Advertising=Brid.Abstract.extend({currentAdsManager:null,adManagers:[],adSDKConfigReference:{brid:"VAST",ima:"GoogleIMA"},_iqAvailable:!1,init:function b(d,a){function c(c,a){Brid.log("Advertising BridIQ onHandshake response",a,"error",c);if(this._iqAvailable=!(a.blocked||c))this._iqUserID=a.user_id,this._iqDomainID=a.domain_id;this._bIQHandShakeInProgress=!1;this._handshakeCallback&&this._handshakeCallback()}if(d.config.hideAdContainer)return null;
b.base.call(this,d,a);this.el=this.createElement();this.somse="";this.skippedFired=!1;this.ads={};this.adManagers=[];this.currentAdsManager=null;a=this.ads;var e=d.config;d.advertising=!0;a.adOffset=e.adOffset?parseInt(e.adOffset):0;a.adFrequency=e.adFrequency?parseInt(e.adFrequency):0;a.bridAdPartner=!!e.Partner.bridAdPartner;a.adFrequency=0===a.adFrequency?1:a.adFrequency;Brid.log("Advertising ads.adOffset",a.adOffset,"ads.adFrequency",a.adFrequency);a=function(a,c){var b=[],e=!1;a&&a.map(function(a){c[a]&&
b.push(c[a])});if(1===b.length&&"VAST"==b[0]){var f=[];d.currentSource.id&&d.currentSource.Ad||0<d.videos.length&&d.videos[0].Ad?(d.currentSource.id&&d.currentSource.Ad?(Brid.log("Take ads from currentSource"),a=d.currentSource.Ad):(Brid.log("Take ads from first video"),a=d.videos[0].Ad),Brid.log("playerAds",a),a.map(function(a){var c=a.Ad.desktop,b=a.Ad.mobile;a=c&&0<c.length;var e=b&&0<b.length,c=Brid.isMobilePlatform?e?b:[]:a?c:b;a||e?(Brid.log("Check",c),Array.isArray(c)||(c=[c]),c.forEach(function(a){f=
f.concat(a)})):d.config.Ad.splice(index,1)})):d.config.Ad&&(Brid.log("Take ads from player settings"),a=d.config.Ad,Brid.log("playerAds",a),a.map(function(a,c){var b=a.desktop,e=a.mobile,g=b&&0<b.length,h=e&&0<e.length,b=Brid.isMobilePlatform?h?e:[]:g?b:e;g||h?(Brid.log("Check",b),Array.isArray(b)||(b=[b]),b.forEach(function(a){f=f.concat(a)})):(d.config.Ad.splice(c,1),1==a.adType&&(d.config.Prebid||d.config.A9)&&(d.config.prebidMidrollData={adTimeType:a.adTimeType,cuepoints:a.cuepoints}))}));Brid.log("Final Array",
f);if(0<f.length)for(a=0;a<f.length;a++)if(Brid.log("Check url: ",f[a]),f[a].url){if(f[a].url&&(-1!=f[a].url.indexOf("googleads")||-1!=f[a].url.indexOf("21760922134")||-1!=f[a].url.indexOf("brid_parser=ima"))){e=!0;break}}else if(f[a]&&(-1!=f[a].indexOf("googleads")||-1!=f[a].indexOf("21760922134")||-1!=f[a].indexOf("brid_parser=ima"))){e=!0;break}a=d.config.Partner;if(a.program){var g=a.program;a=g.desktop;var g=g.mobile,h=a&&0<a.length,q=g&&0<g.length;if(g=Brid.isMobilePlatform?q?g:[]:h?a:g)for(a=
0;a<g.length;a++)if(g[a].url&&g[a].url&&(-1!=g[a].url.indexOf("googleads")||-1!=g[a].url.indexOf("21760922134")||-1!=g[a].url.indexOf("brid_parser=ima"))){e=!0;break}}}0===b.length?b=Brid.isMobilePlatform?["VAST","GoogleIMA"]:["GoogleIMA","VAST"]:1===b.length&&("VAST"===b[0]&&e&&b.push("GoogleIMA"),"GoogleIMA"===b[0]&&b.push("VAST"));return b}(e.adSDK,this.adSDKConfigReference);Brid.log("Advertising adManagerClasses",a);a.map(this.$f(function(a){"undefined"!==typeof Brid[a]&&this.adManagers.push(new Brid[a](d,
{container:this.el,wrapper:this}))}));d.adsManager=this;if(d.isReady)this.onPlayerReady();else d.addOnce("ready",this.$f(this.onPlayerReady));d.add("newContent",this.$f(this.checkScheduledAds));d.add(["stopped","skipped"],this.$f(this.onEnded));d.add("playerresize",this.$f(this.onResize));d.add("start",this.$f(this.resetSkippedFired));d.config.deblocker&&"undefined"!==typeof $BridIq&&$BridIq.isAdBlockEnabled()&&(this.iqConfig=d.config.IQ||$BridIq.config,this._bIQHandShakeInProgress=!0,$BridIq.handshake(this.iqConfig,
this.$f(c)))},createElement:function(){var b=h.elById(this.player.id+"_adContainer");b||(b=h.createElement("div",{id:this.player.id+"_adContainer"}));if(!b)return!1;b.innerHTML="";h.addClass(b,"brid-advert-container");b.style.maxWidth="none";b.style.maxHeight="none";b.style.minWidth="0";b.style.minHeight="0";return b},techCall:function(b,d,a){if((a=a||this.currentAdsManager)&&!a.error)if(Brid.log("Advertising techCall ",b,d),a.isReady)try{a[b](d)}catch(c){Brid.error(c)}else a.ready(function(){this[b](d)})},
techGet:function(b,d,a){if((a=a||this.currentAdsManager)&&!a.error)if(a.isReady)try{return a[b](d)}catch(c){void 0===a[b]?Brid.warn("--- BridPlayer --- "+b+" method not defined for "+a.name+" advertising technology.",c):"TypeError"==c.name?Brid.error("--- BridPlayer --- "+b+" unavailable on "+a.name+" advertising technology element.",c):Brid.error(c)}else Brid.warn("--- BridPlayer --- "+a.name+" ads manager is not ready")},resetSkippedFired:function(){this.skippedFired=!1},onPlayerReady:function(){Brid.log("Advertising onPlayerReady");
var b=this.player;h.insertAfter(b.tag,this.el);this.defaultControlsBehaviour=b.config.controlsBehavior;b.config.autoplay&&!b.tech.support.monetizable&&(Brid.warn("Advertising Shouldn't play ads tech not monetizable"),this.hide())},setupAdsLoader:function(){var b=this.player;if(b.showOnAd()||!b.tech.support.adManagement&&b.tech.support.monetizable)for(var b=0,d=this.adManagers.length;b<d;b++)this.techCall("setupAdsLoader",null,this.adManagers[b]);else this.hide()},checkScheduledAds:function(b){Brid.log("Advertising checkScheduledAds");
var d=this.player,a=this.ads,c=d.currentSource,e=d.config.Ad,f=c.Ad;this.flagOurAd=!1;this.priority=0;this.ourAdPos=-1;a.overlay=a.midroll=a.postroll=a.preroll=a.banner=null;d.hasPreroll=!1;d.hasPostroll=!1;d.hasMidroll=!1;d.hasOverlay=!1;d.remove("beforeStart",this.$f(this.onBeforeStart));d.remove("timeupdate",this.$f(this.checkForAd));this.adManagers=this.adManagers.filter(function(a){return!a.error});if(this.player.config.monetize)if(d.showOnAd()||d.tech.support.monetizable&&c.monetize&&this.checkOffsetAndFrequency()&&
0!==this.adManagers.length){if(d.config.freqCap){var n=h.getLocalStorage(d.config.id+"_cap");if(!(b&&b.data&&b.data.reinit)&&n&&"1"===n)return}this.contentCompleteCalled=!1;e&&e.map(function(b){b.played=!1;"0"===b.adType&&(a.preroll=h.clone(b));"1"===b.adType&&(a.midroll=h.clone(b));"2"===b.adType&&(a.postroll=h.clone(b));"3"===b.adType&&(a.overlay=h.clone(b));"4"===b.adType&&(a.banner=h.clone(b))});f&&f.map(function(b){b.Ad.played=!1;"0"===b.Ad.adType&&(a.preroll=h.clone(b.Ad));"1"===b.Ad.adType&&
(a.midroll=h.clone(b.Ad));"2"===b.Ad.adType&&(a.postroll=h.clone(b.Ad));"3"===b.Ad.adType&&(a.overlay=h.clone(b.Ad));"4"===b.Ad.adType&&(a.banner=h.clone(b.Ad))});c.intro_video&&(a.midroll=a.postroll=a.overlay=a.banner=null);b=a.preroll;var c=a.midroll,e=a.postroll,f=a.overlay,p=a.banner;b&&(b.adTags=this.selectAdTagsByPlatform(b));c&&(c.adTags=this.selectAdTagsByPlatform(c),c.cuepoints=c.cuepoints.split(","),c.cuepointsStatus=[]);e&&(e.adTags=this.selectAdTagsByPlatform(e));p&&(p.adTags=this.selectAdTagsByPlatform(p));
f&&(f.adTags=this.selectAdTagsByPlatform(f));var l=d.config.Partner,m=d.currentSource.age_gate_id?parseInt(d.currentSource.age_gate_id):0;Brid.log("Advertising checkForScheduledAds ageGateID",m);n=l.program;l.exclude&&n&&(n=this.excludeDfpBackfill(n,l.exclude));if(!this.flagOurAd&&a.bridAdPartner&&2>m&&n&&(this.networkAdTags=this.selectAdTagsByPlatform(n))){var g=this.networkAdTags[0];Brid.log("Ad program networkAdTags",g);b&&(b.adTags=b.adTags||[[]],b.adTags=b.adTags.map(function(a){return a.concat(g)}),
b.adTags.priority=0,b.adTags.pod=0);e&&(e.adTags=e.adTags||[[]],e.adTags=e.adTags.map(function(a){return a.concat(g)}),e.adTags.priority=0,e.adTags.pod=0);c&&(c.adTags=c.adTags||[[]],c.adTags=c.adTags.map(function(a){return a.concat(g)}),c.adTags.priority=0,c.adTags.pod=0);b||c||e||(b=a.preroll={adTimeType:"s",adType:"0",cuepoints:null,overlayDuration:"10",overlayStartAt:null,played:!1},b.adTags=b.adTags||[[]],b.adTags=b.adTags[0].concat([g]),b.adTags.priority=0,b.adTags.pod=0)}d.hasPreroll=!!(b&&
b.adTags&&b.adTags.length&&b.adTags.some(function(a){return 0<a.length}));d.hasPostroll=!!(e&&e.adTags&&e.adTags.length&&e.adTags.some(function(a){return 0<a.length}));d.hasMidroll=!!(c&&c.adTags&&c.adTags.length&&c.adTags.some(function(a){return 0<a.length}));d.hasOverlay=!!(f&&f.adTags&&f.adTags.length&&f.adTags.some(function(a){return 0<a.length}));d.hasBanner=!1;d.hasMidroll&&d.config.auto_skip_at&&0<parseInt(d.config.auto_skip_at)&&(Brid.log("Advertising disabling midrolls because of config.auto_skip_at"),
d.hasMidroll=!1,c=a.midroll=null);if(!this.flagOurAd&&(p&&(p.adTags||p.mobile)||n&&n.banner)){p=p||{mobile:[],adType:"4"};l=n&&n.banner;m=!!(d.config.Prebid&&d.config.Prebid.midroll&&d.config.Prebid.midroll.length||d.config.A9&&d.config.A9.midroll&&d.config.A9.midroll.length);d.hasBanner=!0;Brid.log("Advertising add BannerAd",p,l);this.bannerManagerAdded||(this.adManagers.push(new Brid.BannerAd(d,{container:this.el,wrapper:this})),this.bannerManagerAdded=!0);var k=p.adTags||p.mobile,k="string"===
typeof k?[k]:k;Array.isArray(k[0])&&(k[0]=k[0][0]);p.adTags=k;l&&(p.adTags=p.adTags.concat(l));p.adTags.map(function(a){Brid.log("Advertising add BannerAd",a.overlayDuration,p.overlayDuration);var b=a[0]?a[0]:a.url?a:{id:"",url:a};b.url&&-1!=b.url.indexOf("<|>")||(b.url+="<|>"+(void 0===a.overlayDuration?p.overlayDuration:a.overlayDuration)||"")});if(d.hasMidroll||c&&c.adTags&&m)Brid.log("Add banner fallback for midroll"),c.adTags=c.adTags.map(function(a){return a.concat(p.adTags)});d.hasPreroll?
b.adTags=b.adTags.map(function(a){return a.concat(p.adTags)}):(p.adTags=[p.adTags],b=a.preroll=p,d.hasPreroll=!0);a.preroll.adTags.priority=0;a.preroll.adTags.pod=0}Brid.log("Advertising preroll",b,"midroll",c,"postroll",e,"overlay",f);d.tech.support.adManagement?(a.bridAd=this.networkAdTags,a.flagOurAd=this.flagOurAd,d.techCall("ads",a),n&&d.techCall("setProgram",n),this.techCall("destroyAdsLoader"),this.hide()):(this.show(),this.setupAdsLoader(),d.hasPreroll&&d.add("beforeStart",this.$f(this.onBeforeStart)),
(d.hasMidroll||d.hasOverlay)&&d.add("timeupdate",this.$f(this.checkForAd)),d.add("ended",this.$f(this.onEnded)))}else Brid.warn("Advertising Shouldn't play ads on non monetizable techs | Video or player not monetized | No Ad Managers initialized due to Ad Blocker or Network Error"),this.hide(),this.frequencyLimit=!0,this.techCall("destroyAdsLoader")},checkOffsetAndFrequency:function(){var b=!0;"undefined"!=typeof this.videosPlayed&&null!=this.videosPlayed||this.player.config.resetFreqCounter||(this.videosPlayed=
h.getLocalStorage(this.player.id+"_videos_played"));this.videosPlayed||(this.videosPlayed=1);Brid.log("Advertising checkOffsetAndFrequency videosPlayed",this.videosPlayed,"adFrequency",this.ads.adFrequency,"adOffset",this.ads.adOffset);if(this.videosPlayed<this.ads.adOffset||0!=(this.videosPlayed-this.ads.adOffset)%this.ads.adFrequency)b=!1,this.player.config.autoplay_on_ad&&(this.player.config.autoplay=!1,this.player.config.autoplayInview=!1,Brid.isMobilePlatform||(this.player.config.autoplay_on_ad=
!1)),this.player.config.ad_preload=!1;return b},onBeforeStart:function(){Brid.log("Advertising onBeforeStart");this.player.remove("beforeStart",this.$f(this.onBeforeStart));this.hasAdRules=!1;this.resetManager();this.checkPreroll()},checkPreroll:function(){var b=this.ads.preroll;b&&!b.played&&this.player.config.monetize&&(this.player.remove("timeupdate",this.$f(this.checkForAd)),this.preRequestAd(b))},checkForMidroll:function(){if(!(0>=this.player.duration()||!this.player.config.monetize||Brid.isIPhone&&
-1===this.player.currentSrc().indexOf(this.player.currentSource.src))){if("i"==this.ads.midroll.adTimeType&&this.player.currentSource.livestream&&this.player.currentSource.livestreamStartedAt&&!Number.isInteger(this.player.currentTime())){if(!this.player.values.lastCurrentTime||this.player.currentTime()<this.player.values.lastCurrentTime){this.firstMidrollCuepoint||(this.firstMidrollCuepoint=parseInt(this.ads.midroll.cuepoints[0]));var b=new Date/1E3-this.player.currentSource.livestreamStartedAt,
d=this.firstMidrollCuepoint-b%this.firstMidrollCuepoint-this.player.currentTime();60>d&&(d+=this.firstMidrollCuepoint);this.ads.midroll.cuepoints=[d,d+this.firstMidrollCuepoint];Brid.log("Brid resetting midrolls",this.ads.midroll.cuepoints,"stream uptime",h.formatTime(b))}this.player.values.lastCurrentTime=this.player.currentTime()}var d=this.player,a=this.ads.midroll,c=a.cuepoints;if("%"==a.adTimeType){for(var e=0;e<c.length;e++)c[e]=parseInt(parseInt(c[e])*d.duration()/100);a.adTimeType="s"}"i"==
a.adTimeType&&(this.firstMidrollCuepoint||(c.splice(1),c[0]=parseInt(c[0]),this.firstMidrollCuepoint=c[0]),1==c.length&&c.push(c[0]+this.firstMidrollCuepoint));for(e=0;e<c.length;e++){var f=parseInt(c[e]);if(!this.player.values.isLive)if(f>this.player.duration()){c.splice(e,1);Brid.log("Advertising removing midroll at",f);continue}else 1>=this.player.duration()-f&&(a.cuepoints[e]--,f--,Brid.log("Advertising moving midroll to",f));b=f-d.currentTime();if(0>=b){if(d.waitingForAd&&!a.cuepointsStatus[f])break;
Brid.log("Advertising play midroll");d.remove("timeupdate",this.$f(this.checkForAd));c.splice(e,1);if(a.cuepointsStatus[f]&&"preRequestAd"==a.cuepointsStatus[f])Brid.log("preRequestAd for cuepoint",f),d.pause(),Brid.isIPhone&&d.isFullScreen&&"GoogleIMA"==d.adsManager.currentAdsManager.name&&d.toggleFullScreen(!d.isFullScreen),d.midrollPreload=!1,d.Advertising.tempTime=d.currentTime(),d.adsManager.start();else if(a.cuepointsStatus[f]&&"adError"==a.cuepointsStatus[f])d.midrollPreload=!1,d.trigger("hideAdInfo"),
d.add("timeupdate",this.$f(this.checkForAd)),d.Advertising.tempTime=null;else if(d.midrollPreload=!1,d.pause(),a.adTags.priority=0,a.adTags.pod=0,!this.preRequestAd(a))this.onContentResumeRequested();this.player.midrollNotMutedCase=!1;break}else if(5>b&&0<b){a.cuepointsStatus[f]||!d.config||!d.config.id||d.hasBanner||"22954"==d.config.id||d.config.disableMidrollPreload||(Brid.log("Create cuepoint",f),a.cuepointsStatus[f]="preRequestAd",d.midrollPreload=!0,a.adTags.priority=0,a.adTags.pod=0,this.preRequestAd(a));
d.trigger("adStartsSoon");break}else d.trigger("hideAdInfo")}}},checkForOverlay:function(){var b=this.ads.overlay,d=this.player;if("s"==b.adTimeType)var a=d.currentTime()-b.overlayStartAt;else a=d.currentTime()-d.duration()*b.overlayStartAt/100,b.overlayDuration=d.duration()*b.overlayDuration/100;0<a&&!b.playing&&!b.played&&this.preRequestAd(b)},checkForAd:function(){this.hasAdRules||!this.player.isPlaying||this.player.getAdInProgress()||((this.ads.midroll&&!this.player.config.MidrollOnlyWhenMuted||
this.ads.midroll&&this.player.config.MidrollOnlyWhenMuted&&this.player.muted()||this.player.midrollNotMutedCase)&&this.checkForMidroll(),this.ads.overlay&&!this.ads.overlay.played&&this.checkForOverlay())},getScheduledCuepoints:function(){var b=this.player,d=this.ads.midroll;if(d&&d.cuepoints&&0<d.cuepoints.length){var a=[];if("i"==d.adTimeType)(a=this.firstMidrollCuepoint)||(a=parseInt(d.cuepoints[0])),d=Math.ceil(b.currentTime()/a)*a,a=[d,d+a];else for(var c=0;c<d.cuepoints.length;c++)a.push("%"==
d.adTimeType?parseInt(parseInt(d.cuepoints[c])*b.duration()/100):parseInt(d.cuepoints[c]));return a.filter(function(a){return a>b.currentTime()&&a<b.duration()})}return!1},onEnded:function(b){Brid.log("Advertising onEnded",b,this.skippedFired);this.player.remove("ended",this.$f(this.onEnded));this.firstMidrollCuepoint=null;if(this.skippedFired)return Brid.log("Advertising onEnded skippedFired abort"),!1;b&&"skipped"==b.type&&(this.skippedFired=!0);if(!this.contentCompleteCalled){this.contentCompleteCalled=
!0;(this.ads.overlay&&this.ads.overlay.playing||!this.isLinear())&&this.stopNonLinear();for(var d=0,a=this.adManagers.length;d<a;d++)this.techCall("contentComplete",null,this.adManagers[d]);"ended"===b.type&&this.checkPostroll()}},checkPostroll:function(){var b=this.ads.postroll;b&&!b.played&&(this.player.remove("timeupdate",this.$f(this.checkForAd)),this.preRequestAd(b))},iframeHasFocus:function(){if(this.currentAdsManager)for(var b=this.currentAdsManager.el.getElementsByTagName("iframe"),d=0;d<
b.length;d++)if(r.activeElement==b[d])return!0;return!1},setAd:function(b,d,a,c){if(this.player.currentSource.monetize||this.player.config.type){var e=!1,f=b.pod||0,h=this.player,p=function(a,b){var c=h.config.bid_order;if(!c||0==c.length||!a.source)return 0;var d=0,e=c.indexOf(a.source);0<e&&b.forEach(function(b,f){a.source&&(b=c.indexOf(b.source),b<e&&-1!=b&&(d=Math.max(d,f+1)))});return d};"string"===typeof b.adTagUrl&&(b.adTagUrl=[b.adTagUrl]);var l="video"===d?this.player.currentSource.Ad:this.player.config.Ad;
"player"===d&&(this.player.currentSource.Ad=[]);if(l&&0<l.length)for(var m=0;m<l.length;m++){if(l[m].mobile&&0<l[m].mobile.length&&!Array.isArray(l[m].mobile[0])&&(l[m].mobile=[l[m].mobile]),l[m].desktop&&0<l[m].desktop.length&&!Array.isArray(l[m].desktop[0])&&(l[m].desktop=[l[m].desktop]),l[m].adType===b.adType)if(e=!0,a){l[m].mobile||l[m].desktop||(l[m].mobile=[]);if(l[m].mobile){f>=l[m].mobile.length&&(f=l[m].mobile.length,l[m].mobile[f]=[]);for(var g=0;g<b.adTagUrl.length;g++){var k={id:"",url:b.adTagUrl[g]};
b.source&&(k.source=b.source);b.bidder&&(k.bidder=b.bidder);b.cpm&&(k.cpm=b.cpm);l[m].mobile[f].splice(p(k,l[m].mobile[f]),0,k)}}if(l[m].desktop)for(f>=l[m].desktop.length&&(f=l[m].desktop.length,l[m].desktop[f]=[]),g=0;g<b.adTagUrl.length;g++)k={id:"",url:b.adTagUrl[g]},b.source&&(k.source=b.source),b.bidder&&(k.bidder=b.bidder),b.cpm&&(k.cpm=b.cpm),l[m].desktop[f].splice(p(k,l[m].desktop[f]),0,k)}else for(l[m].mobile=l[m].mobile||[],f>=l[m].mobile.length&&(f=l[m].mobile.length),l[m].mobile[f]=[],
g=0;g<b.adTagUrl.length;g++)k={id:"",url:b.adTagUrl[g]},b.source&&(k.source=b.source),b.bidder&&(k.bidder=b.bidder),b.cpm&&(k.cpm=b.cpm),l[m].mobile[f].push(k)}else l="video"===d?this.player.currentSource.Ad=[]:this.player.config.Ad=[];if(!e)if(1==b.adType&&!b.cuepoints&&this.player.config.prebidMidrollData&&(b.cuepoints=this.player.config.prebidMidrollData.cuepoints,b.adTimeType=this.player.config.prebidMidrollData.adTimeType),1!=b.adType||"string"===typeof b.cuepoints&&0<b.cuepoints.length){b.mobile=
[[]];for(g=0;g<b.adTagUrl.length;g++)k={id:"",url:b.adTagUrl[g]},b.source&&(k.source=b.source),b.bidder&&(k.bidder=b.bidder),b.cpm&&(k.cpm=b.cpm),b.mobile[0].push(k);"video"===d?l.push({Ad:b}):l.push(b);delete b.adTagUrl}else Brid.log("Cannot SetAd, not enough parameters provided for missing ad slot");Brid.log("SetAd END",l);c||this.checkScheduledAds()}},removeAd:function(b,d){var a=!1,c="video"===d?this.player.currentSource.Ad:this.player.config.Ad;if(c&&0<c.length)for(var e=0;e<c.length;e++)if(c[e].adType===
b.adType||!b.adType){if(c[e].mobile){0<c[e].mobile.length&&!Array.isArray(c[e].mobile[0])&&(c[e].mobile=[c[e].mobile]);for(var f=0;f<c[e].mobile.length;f++)d=h.search(c[e].mobile[f],"url",b.adTagUrl),-1<d&&(c[e].mobile[f].splice(d,1),a=!0)}if(c[e].desktop)for(0<c[e].desktop.length&&!Array.isArray(c[e].desktop[0])&&(c[e].desktop=[c[e].desktop]),f=0;f<c[e].desktop.length;f++)d=h.search(c[e].desktop[f],"url",b.adTagUrl),-1<d&&(c[e].desktop[f].splice(d,1),a=!0)}Brid.log("RemoveAd END",a,c)},appendPod:function(b,
d){var a="video"===d?this.player.currentSource.Ad:this.player.config.Ad;Brid.log("Brid appendPod",a,"ad",b);for(var c=0;c<a.length;c++)a[c].adType==b.adType&&["mobile","desktop"].forEach(function(d){a[c][d]&&Array.isArray(a[c][d])&&a[c][d].push([{id:"",url:b.adTagUrl,source:b.source}])})},playAd:function(b){Brid.log("Advertising playAd",b);var d=this.player;d.currentSource.monetize&&(b.adTagUrl&&"string"===typeof b.adTagUrl&&(b.adTagUrl=[b.adTagUrl]),b=this.flagOurAd?this.networkAdTags:b,b="string"===
typeof b?{adTagUrl:[b]}:"array"===typeof b?{adTagUrl:b}:b,b.adTags=this.selectAdTagsByPlatform(b),d.newContent=!1,d.tech.support.adManagement?(this.hide(),this.player.techCall("playAd",b)):this.preRequestAd(b))},selectAdTagsByPlatform:function(b){var d=b.flashAdTagUrl||b.desktop,a=b.adTagUrl||b.mobile,c=d&&0<d.length,e=a&&0<a.length,c=Brid.isMobilePlatform?e?a:null:c?d:a;Brid.log("Advertising selectAdTagsByPlatform ",b.adType,"desktop",d,"mobile",a);c?("string"===typeof c?c=[{id:"0",url:c}]:"string"===
typeof c[0]&&(c=c.map(function(a,b){return{id:"",url:a}})),0<c.length&&!Array.isArray(c[0])&&(Brid.log("Advertising converting old ad structure to new",c),c=[c]),c.pod=0,c.priority=0):c=null;Brid.log("Advertising selectAdTagsByPlatform ads",c);return c},excludeDfpBackfill:function(b,d){var a={},c=b.desktop&&0<b.desktop.length,e=b.mobile&&0<b.mobile.length,f=b.banner&&0<b.banner.length;if(c=Brid.isMobilePlatform?e?b.mobile:null:c?b.desktop:b.mobile){var n="";Brid.isMobilePlatform?(a.mobile=[],n="mobile"):
(a.desktop=[],n="desktop");c=c.map(function(b,c){if(-1==b.url.indexOf("21760922134"))a[n].push(b);else{var e=!0;h.each(d,function(a){Brid.Util.getEmbededUrl()==a&&(e=!1)});e&&a[n].push(b)}})}f&&b.banner.map(function(b,c){-1==b.url.indexOf("google")&&(a.banner||(a.banner=[]),a.banner.push(b))});return a},selectPriorityAdTag:function(b){var d=null,a=this.player.config,c=a.Partner.program;Brid.log("Advertising selectPriorityAdTag",b);if(!b)return!1;(this.flagOurAd?!this.ads.overlay||!this.ads.overlay.playing:
1)&&b[b.pod]&&b.priority<b[b.pod].length?(d=b[b.pod][b.priority],b.priority++):b.priority=0;Brid.log("Advertising tag",d,"pod",b.pod,"priority",b.priority);this.flagOurAd=!!(d&&a.backfill_monetize&&c&&(c.desktop&&-1!==c.desktop.indexOf(d)||c.mobile&&-1!==c.mobile.indexOf(d)||c.banner&&-1!==c.banner.indexOf(d)));d&&d.url&&0===d.url.indexOf("http://")&&(d.url=d.url.substr(5));return d},selectAdsManager:function(b){for(var d,a=0,c=this.adManagers.length;a<c;a++)if(this.adManagers[a].supportsAdTag(b)&&
!this.adManagers[a].error&&!d){d=this.adManagers[a];break}return d},preRequestAd:function(b){Brid.log("Advertising preRequestAd",b,this.techGet("isLinear"),this.currentAdObject);if(!b)return!1;for(var d=b.adTags.length-1;0<=d;d--)0==b.adTags[d].length&&b.adTags.splice(d,1);this.currentAdObject&&(this.ads.overlay&&this.ads.overlay.playing||!this.isLinear())&&this.stopNonLinear();this.thirdParty=!1;this.currentAdObject=b;this.currentAdObject.played=!0;if(b=this.selectPriorityAdTag(b.adTags))return this.currentAdObject.currentID=
b.id,this.requestAd(b.url),!0;!Brid.isIPhone&&this.currentAdsManager&&"GoogleIMA"==this.currentAdsManager.name&&(this.currentAdsManager.adsLoader=null,this.currentAdsManager.adDisplayContainer.destroy(),this.currentAdsManager.adDisplayContainer=null);Brid.log("Advertising no more adtags");return!1},requestAd:function(b){function d(a,b,c){var d=new RegExp("[&?]"+b+"=","i");return a=d.test(a)?a.replace(d,"$&"+encodeURIComponent(c)+"%26"):a+((-1==a.indexOf("?")?"?":"&")+b+"="+encodeURIComponent(c))}
function a(a,b,c){return-1!=a.toLowerCase().indexOf(".spotxchange.")?a.replace(new RegExp("="+b.replace(/(\[|])/g,"\\$1"),"gi"),"="+c):a.split(b).join(c).split(b.toUpperCase()).join(c)}function c(a){this._handshakeCallback=null;$BridIq.url({Url:a,Key:k.iqConfig.Key,AccountId:k.iqConfig.AccountId},e.bind(k))}function e(a,c){a?(Brid.error("--- Brid IQ Deblock failed--- ",a),this._urlDeblocked=!1,this.techCall("requestAd",b)):(Brid.log("onDeblock url:",c.url),this._urlDeblocked=!0,this.techCall("requestAd",
c.url),$BridIq.ping("request",{user_id:this._iqUserID,domain_id:this._iqDomainID}))}function f(a){Brid.error("--- BridPlayer --- IP fetch failed",a);p(b)}function n(c){try{"string"===typeof c&&(h.setLocalStorage("brid_location",c),c=JSON.parse(c),h.location=c),Brid.log("Advertising location",c),b=a(b,"[user_ip]",encodeURIComponent(c.connection.ip)),b=a(b,"[ipaddress]",encodeURIComponent(c.connection.ip)),b=a(b,"[latitude]",encodeURIComponent(c.location.latitude.toString())),b=a(b,"[longitude]",encodeURIComponent(c.location.longitude.toString())),
p(b)}catch(E){Brid.error("--- BridPlayer --- IP parse failed",E),p(b)}}function p(b){function c(){if("function"===typeof u.__tcfapi){Brid.log("GDPR __tcfapi exists");if(n)return!m.cancelTimeout&&!m.timeoutFnCalled&&m.intervalCurrent>=m.timeoutMs&&(m.timeoutFnCalled=!0,setTimeout(d,1500),Brid.log("GDPR __tcfapi response timed out!")),m.intervalCurrent+=50;n=!0;u.__tcfapi("getTCData",2,function(c,f){m.timeoutFnCalled||(m.cancelTimeout=!0,Brid.log("GDPR __tcfapi tcData",c,"success",f),c.gdprApplies&&
"cmpuishown"==c.eventStatus?(clearInterval(q),Brid.log("GDPR __tcfapi waiting for useractioncomplete"),u.__tcfapi("addEventListener",2,function(a,c){!c||"useractioncomplete"!==a.eventStatus||g.tcfNotReceived&&!g.config.monetize||(p(b),u.__tcfapi("removeEventListener",2,null,a.listenerId))}),setTimeout(d,4E3)):(b=a(b,"[gdpr]",c.gdprApplies?"1":"0"),b=a(b,"[consent]",c.tcString||""),e()))})}else"function"===typeof u.__cmp?(Brid.log("GDPR __cmp exists"),n||(n=!0,setTimeout(function(){Brid.log("GDPR __cmp timeout exceed!");
b=a(b,"[gdpr]","0");e()},500),u.__cmp("getConsentData",null,function(c){Brid.log("GDPR __cmp responseObject",c);b=a(b,"[gdpr]",c.gdprApplies?"1":"0");b=a(b,"[consent]",c.consentData||"");e()}))):h.isAmp()?(Brid.log("GDPR waiting for AMP consent"),void 0!=g.values.ampGDPR&&(Brid.log("GDPR using AMP consent data",g.values.ampGDPR),b=a(b,"[gdpr]",g.values.ampGDPR.gdprApplies?"1":"0"),b=a(b,"[consent]",g.values.ampGDPR.gdprString||""),e()),n||(n=!0,g.trigger("requestAMPGDPR"),setTimeout(d,1500))):(Brid.log("GDPR __cmp / __tcfapi don't exist",
f),f+=50,500<=f&&e())}function d(){!k&&g.currentSrc()&&(Brid.log("GDPR __tcfapi useractioncomplete not received in timely manner, clicking play button will show content without ads"),clearInterval(q),g.tcfNotReceived=!0,e())}function e(){k||(Brid.log("GDPR FIRE request"),l(b));clearInterval(q);q=null;k=!0}var f=0,n=!1,k=!1,m={intervalCurrent:0,timeoutMs:3E3,timeoutFnCalled:!1,cancelTimeout:!1};if(/\[(gdpr|consent|npa)\]/i.test(b)||g.config.wait_tcf_api){Brid.log("GDPR macro exists / wait for TCF API");
var q=setInterval(c,50)}else l(b)}function l(b){function c(){d+=50;Brid.log("uspCheckIntervalCurrent",d);500<=d&&(clearInterval(f),f=null,e=!0,m(b))}var d=0,e=!1;if(-1!=b.toLowerCase().indexOf("[us_privacy]"))if(Brid.log("USPAPI macro exists"),"function"===typeof u.__uspapi){Brid.log("USPAPI __uspapi exists");var f=setInterval(c,50);u.__uspapi("getUSPData",1,function(c,d){b=a(b,"[us_privacy]",d?c.uspString:"");e||(Brid.log("USPAPI FIRE request"),m(b));f&&(clearInterval(f),f=null)})}else Brid.log("USPAPI __uspapi does not exist"),
b=a(b,"[us_privacy]",""),m(b);else m(b)}function m(a){Brid.exLog("requestAd: ",a,"currentAdsManager",v.name);Brid.log("Advertising _iqAvailable",k._iqAvailable,"_bIQHandShakeInProgress",k._bIQHandShakeInProgress,"pod",q.adTags.pod,"priority",q.adTags.priority);if(g.tcfNotReceived)k.onContentResumeRequested();else if(k._iqAvailable)c(a);else if(k._bIQHandShakeInProgress)k._handshakeCallback=c.bind(k,a);else{if(Brid.Util.adBlockerEnabled)g.trigger("adBlock",{flagOurAd:k.flagOurAd,at:q.adType,am:v.name,
ai:q.currentID});else{var b=q.adTags.pod,d=q.adTags.priority-1;k.flagOurAd?(0>k.ourAdPos&&(k.ourAdPos=d),g.trigger("ourAdRequest",{am:v.name,at:"BannerAd"===v.name?"4":q.adType,pp:b,wp:d-k.ourAdPos,baid:q.adTags[b][d].id})):g.showOnAd()?g.trigger("adUnitRequest",{am:v.name,at:"BannerAd"===v.name?"4":q.adType,pp:b,wp:d,baid:q.adTags[b][d].id}):g.showOnAd()||(Brid.log("Brid Advertising trigger partnerAdRequest",d),g.trigger("partnerAdRequest",{am:v.name,at:"BannerAd"===v.name?"4":q.adType,pp:b,wp:d,
baid:q.adTags[b][d].id,bidder:q.adTags[b][d].bidder}))}if("3"!=q.adType){b="";for(d=32;0<d;--d)b+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];k.somse=b;g.trigger("requestAd",q);g.add("adImpression",function(){Array.prototype.slice.call(arguments,1);(!arguments[0].data||arguments[0].data.s&&arguments[0].data.s!=k.somse)&&g.trigger("incrementCredit")});g.add("adEnd",function(){Array.prototype.slice.call(arguments,1);(!arguments[0].data||arguments[0].data.s&&
arguments[0].data.s!=k.somse)&&g.trigger("incrementCreditComplete")})}k.doStartAdCalled=!1;k.techCall("requestAd",a)}}var g=this.player,k=this,q=this.currentAdObject,u=r.BridIframeBurst?t.top:t,z=u.document;g.waitingForAd=!0;this._urlDeblocked=this.adErrored=this.isPodTag=this.adSkipped=this.adPlayed=!1;var v=this.currentAdsManager=this.selectAdsManager(b),x=-1<b.indexOf("doubleclick")&&25>b.indexOf("doubleclick"),y=-1<b.indexOf("springserve")&&15>b.indexOf("springserve");this.tempTime||0!=q.adTags.pod||
(this.tempTime=g.currentTime());g.config.autoplayStickyAdOnly&&(void 0===g.config.autoplayInviewOriginal&&(g.config.autoplayInviewOriginal=g.config.autoplayInview),g.config.autoplayInview=!1,g.closed=!1);if(v&&!v.error){if(x&&"GoogleIMA"==v.name)this.hasAdRules=-1!=b.indexOf("ad_rule=1");else{this.hasAdRules=!1;if(-1!=b.toLowerCase().indexOf("[timestamp]")){var A=(new Date).getTime();b=a(b,"[timestamp]",A)}-1!=b.toLowerCase().indexOf("[referrer_url]")&&(b=a(b,"[referrer_url]",encodeURIComponent(x?
h.getEmbededUrl():z.referrer)))}-1!=b.toLowerCase().indexOf("[description_url]")&&(b=a(b,"[description_url]",encodeURIComponent(h.getEmbededUrl())));-1!=b.toLowerCase().indexOf("[page_url]")&&(b=a(b,"[page_url]",encodeURIComponent(h.getEmbededUrl())));-1!=b.toLowerCase().indexOf("[video_title]")&&(b=a(b,"[video_title]",encodeURIComponent(g.currentSource.title)));-1!=b.toLowerCase().indexOf("[video_duration]")&&(b=a(b,"[video_duration]",g.duration()||g.currentSource.duration));-1!=b.toLowerCase().indexOf("[video_id]")&&
(b=a(b,"[video_id]",g.currentSource.id));-1!=b.toLowerCase().indexOf("[player_width]")&&g.el&&(g.el.clientWidth||parseInt(g.el.style.width))&&(b=a(b,"[player_width]",g.el.clientWidth||parseInt(g.el.style.width)));-1!=b.toLowerCase().indexOf("[player_height]")&&g.el&&(g.el.clientHeight||parseInt(g.el.style.height))&&(b=a(b,"[player_height]",g.el.clientHeight||parseInt(g.el.style.height)));-1!=b.toLowerCase().indexOf("[player_id]")&&(b=a(b,"[player_id]",g.config.id));-1!=b.toLowerCase().indexOf("[player_os]")&&
(b=a(b,"[player_os]","l"==h.getOS()?"o":h.getOS()));-1!=b.toLowerCase().indexOf("[player_type]")&&(b=a(b,"[player_type]","Brid.Player"==g.name?"p":"o"));-1!=b.toLowerCase().indexOf("[player_size]")&&(b=a(b,"[player_size]",g.config.id+"_"+g.getSizeStr()));-1!=b.toLowerCase().indexOf("%5bplayer_size%5d")&&(b=a(b,"%5Bplayer_size%5D",g.config.id+"_"+g.getSizeStr()));-1!=b.toLowerCase().indexOf("[autoplay]")&&(b=a(b,"[autoplay]",g.config.autoplay?"1":"0"));-1!=b.toLowerCase().indexOf("[description]")&&
(b=a(b,"[description]",encodeURIComponent(g.currentSource.description)));-1!=b.toLowerCase().indexOf("[mediafile_url]")&&(b=a(b,"[mediafile_url]",encodeURIComponent(g.currentSource.src)));-1!=b.toLowerCase().indexOf("[dnt]")&&(b=a(b,"[dnt]",navigator.doNotTrack&&"1"===navigator.doNotTrack?"1":"0"));-1!=b.toLowerCase().indexOf("[viewability]")&&(b=a(b,"[viewability]",g.isPlayerInView()?"1":"0"));-1!=b.toLowerCase().indexOf("[uid]")&&(b=a(b,"[uid]",h.getSession()));-1!=b.toLowerCase().indexOf("[video_tags]")&&
(b=a(b,"[video_tags]",encodeURIComponent(g.currentSource.tags||"")));-1!=b.toLowerCase().indexOf("[brid_site]")&&(b=a(b,"[brid_site]",encodeURIComponent(g.config.Partner?g.config.Partner.domain_short:"")));if(-1!=b.toLowerCase().indexOf("[brid_")){for(var A=b,C=/\[brid_([a-zA-Z0-9_]+)\]/g;z=C.exec(b);)A=a(A,z[0],encodeURIComponent("undefined"!=typeof bridMacros&&z[1]in bridMacros?bridMacros[z[1]]:""));b=A}-1!=b.toLowerCase().indexOf("[user_agent]")&&(b=a(b,"[user_agent]",encodeURIComponent(h.ua)));
if(g.currentSource.customParams&&x&&!this.flagOurAd)for(w in g.currentSource.customParams)g.currentSource.customParams.hasOwnProperty(w)&&(b=a(b,"[item-"+w+"]",encodeURIComponent(g.currentSource.customParams[w])));try{var B=t.localStorage?t.localStorage.getItem("_pdfps"):!1;if(B&&(x||y)){var F="permutive="+JSON.parse(B).join();b=d(b,x?"cust_params":"brid_permutive",F)}}catch(D){Brid.error("--- BridPlayer --- LocalStorage Error",D)}-1!==b.toLowerCase().indexOf("[user_ip]")||-1!==b.toLowerCase().indexOf("[ipaddress]")||
-1!==b.toLowerCase().indexOf("[latitude]")||-1!==b.toLowerCase().indexOf("[longitude]")?h.location?n(h.location):Brid.Loader.loadText("https://api.clarifyip.com/?key=1s5JByAIGeaeEphPkqPlq",n,f):p(b)}else{Brid.error("--- BridPlayer --- Unsupported adTag or Ad Manager initialization failed");Brid.exLog("Unsupported adTag or Ad Manager initialization failed");x=q.adTags.pod;y=q.adTags.priority-1;B=this.flagOurAd&&0<this.ourAdPos?y-this.ourAdPos:y;var w=v?v.name:"AdBlock";w={ec:9999,am:w,pub:this.flagOurAd?
"b":"p",pp:x,wp:B,at:"BannerAd"===w?"4":q.adType};0<=y&&(w.baid=q.adTags[x][y].id);g.trigger("adErrorAnalytics",w);this.preRequestAd(q)?Brid.log("Advertising prerequest success"):(Brid.log("Advertising prerequest fail"),this.hide(),this.adErrored=!0,this.resetManager(),g.trigger("adError",{message:"Unsupported adTag or Ad Manager initialization failed"}),this.onContentResumeRequested())}},stopNonLinear:function(){Brid.log("AdsManager stopNonLinear");this.onResize(null);this.ads.overlay&&(this.ads.overlay.playing=
!1);this.currentAdsManager&&(this.currentAdsManager.el&&this.currentAdsManager.el.removeAttribute("style"),this.techCall("stop"));this.ourAdPos=-1;this.player.currentSrc()&&(this.resetManager(),this.reset())},onAdError:function(b,d,a){var c=this.player,e=this.currentAdObject,f=this.currentAdsManager,h=e?e.adTags.pod:0,p=e?e.adTags.priority-1:0,l=this.flagOurAd&&0<this.ourAdPos?p-this.ourAdPos:p,f=f?f.name:"GoogleIMA";Brid.log("Advertising onAdError message",b,c.newContent,d,a,f);a||(a=8888);e&&(l=
{ec:a,am:f,pub:this.flagOurAd?"b":"p",pp:h,wp:l,at:"BannerAd"===f?"4":e.adType},0<=p&&(l.baid=e.adTags[h][p].id),c.trigger("adErrorAnalytics",l));if(c.newContent)c.trigger("adError",{message:b,code:a});else{if(d){this.adManagers=this.adManagers.filter(function(a){return!a.error});if(0===this.adManagers.length){c.trigger("adError",{message:b,code:a});this.adErrored=!0;this.onContentResumeRequested();return}this.currentAdObject&&--this.currentAdObject.adTags.priority}501==a&&this.adPlayed&&c.config.soft501?
(this.adErrored=!0,this.resetManager(),this.onContentResumeRequested()):this.preRequestAd(this.currentAdObject)?Brid.log("Advertising prerequest success"):(Brid.log("Advertising prerequest fail"),this.adErrored=!0,this.resetManager(),c.trigger("adError",{message:b,code:a}),this.onContentResumeRequested())}},onAdStart:function(b){var d=this.player,a=this.currentAdObject,c=!1;Brid.log("Advertising onAdStart isLinear",this.techGet("isLinear"));this.techGet("isLinear")?(d.adInProgress=!0,d.manualTimeUpdatesOn(),
d.trigger("play")):a&&(a.overlayDuration&&0!==a.overlayDuration||(a.overlayDuration=d.duration()?d.duration()-d.currentTime():15),this.currentAdObject===this.ads.overlay&&(this.ads.overlay.playing=!0),this.adPlayed=!0,this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null),-1===this.duration()&&(c=!0,this.closeTimeout=setTimeout(this.$f(this.stopNonLinear),1E3*a.overlayDuration)),this.currentAdsManager.adsManager.isVPAID&&!this.currentAdsManager.adsManager.adManager.tech._adUnit._creative.getAdLinear()&&
(c=!0,this.closeTimeout=setTimeout(this.$f(this.stopNonLinear),1E3*a.overlayDuration)));d.trigger("adStart",{nonlinear:c});d.onScroll();b&&d.trigger("vpaidStart");this.thirdParty&&d.trigger("3rdPartyAdStart")},onAdImpression:function(){var b=this.currentAdObject,d=this.player,a=this.currentAdsManager,c=b.adTags.pod,e=b.adTags.priority-1;d.waitingForAd=!1;d.waitForInViewAdAutoplay=!1;this.adPlayed=!0;this.techGet("isLinear")&&(d.adInProgress=!0);Brid.log("Advertising onAdImpression flagOurAd",this.flagOurAd);
d.trigger("adImpression",{s:this.somse});d.config.autohide_ad_controls||d.trigger("show");this.flagOurAd?d.trigger("ourAdImpression",{am:a.name,at:"BannerAd"===a.name?"4":b.adType,pp:c,wp:e-this.ourAdPos,baid:b.adTags[c][e].id}):d.showOnAd()?d.trigger("adUnitImpression",{am:a.name,at:"BannerAd"===a.name?"4":b.adType,pp:c,wp:e,baid:b.adTags[c][e].id}):d.showOnAd()||d.trigger("partnerAdImpression",{am:a.name,at:"BannerAd"===a.name?"4":b.adType,pp:c,wp:e,baid:b.adTags[c][e].id,bidder:b.adTags[c][e].bidder,
cpm:b.adTags[c][e].cpm});this._urlDeblocked&&$BridIq.ping("impression",{user_id:this._iqUserID,domain_id:this._iqDomainID})},onAdComplete:function(){var b=this.currentAdObject,d=this.player,a=this.currentAdsManager,c=b.adTags.pod,e=b.adTags.priority-1;Brid.log("Advertising onAdComplete",b,e,c);this.adSkipped||d.trigger("adComplete",{wp:e-this.ourAdPos-1,pod:c,pods:b.adTags.length});this.flagOurAd?d.trigger("ourAdComplete",{am:a.name,at:"BannerAd"===a.name?"4":b.adType,pp:c,wp:e-this.ourAdPos,baid:b.adTags[c][e].id}):
d.showOnAd()?d.trigger("adUnitComplete",{am:a.name,at:"BannerAd"===a.name?"4":b.adType,pp:c,wp:e,baid:b.adTags[c][e].id}):d.showOnAd()||d.trigger("partnerAdComplete",{am:a.name,at:"BannerAd"===a.name?"4":b.adType,pp:c,wp:e,baid:b.adTags[c][e].id,bidder:b.adTags[c][e].bidder})},onAdSkipped:function(){var b=this.currentAdObject,d=this.player,a=b.adTags.pod,c=b.adTags.priority-1;Brid.log("Advertising onAdSkip",b,c,a);d.trigger("adSkip",{wp:c-this.ourAdPos-1,pod:a,pods:b.adTags.length})},onContentPauseRequested:function(){var b=
this.player;Brid.log("Advertising onContentPauseRequested",b.isPlaying);this.tempTime||0!=this.currentAdObject.adTags.pod||(this.tempTime=b.currentTime());b.isPlaying&&(Brid.log("POZIV PAUZE 1"),b.pause());b.remove("ended",this.$f(this.onEnded));b.trigger("disableInteraction")},onContentResumeRequested:function(){function b(){null!==c.children&&(Brid.log("Advertising resumeFromTimeIma",a.tempTime),a.tempTime?setTimeout(function(){c.currentTime(a.tempTime);c.play();a.tempTime=null},700):c.play(),c.tech&&
!c.tech.support.timeupdateEvent&&c.manualTimeUpdatesOn(),c.trigger("startTrackingTime"))}function d(){null!==c.children&&(Brid.log("Advertising resumeFromTime",a.tempTime),a.tempTime&&setTimeout(function(){c.currentTime(a.tempTime);a.tempTime=null},500),c.tech&&!c.tech.support.timeupdateEvent&&c.manualTimeUpdatesOn(),c.trigger("startTrackingTime"))}var a=this,c=a.player,e=a.contentCompleteCalled;if(null!==c.children)if(Brid.log("Advertising onContentResumeRequested contentCompleteCalled",e,"currentSrc",
c.currentSrc(),"currentSource",c.currentSource.src,"_this.tempTime",a.tempTime,"player current Time",c.tag.currentTime,"autoplay_on_ad",c.config.autoplay_on_ad,"adErrored",this.adErrored,"adPlayed",this.adPlayed,"player.userInteracted",c.userInteracted,"doStartAdCalled",this.doStartAdCalled,"midrollPreload",c.midrollPreload,"adsManager name",this.currentAdsManager?this.currentAdsManager.name:"NULL"),this.currentAdObject&&this.currentAdObject.adTags.pod+1<this.currentAdObject.adTags.length&&(!c.closed||
c.currentSrc()))this.currentAdsManager&&"GoogleIMA"==this.currentAdsManager.name&&this.currentAdsManager.adsManager&&0==this.currentAdsManager.adsManager.getCuePoints().length&&this.currentAdsManager.adsLoader&&(Brid.log("CALL adsLoader.contentComplete 1"),this.currentAdsManager.adsLoader.contentComplete()),this.currentAdObject.adTags.pod++,Brid.log("Advertising going to next pod",this.currentAdObject,this.currentAdObject.adTags.pod),this.reset(),this.currentAdObject.adTags.priority=0,this.preRequestAd(this.currentAdObject);
else{if(this.currentAdsManager&&"GoogleIMA"==this.currentAdsManager.name&&this.currentAdsManager.adsManager&&0==this.currentAdsManager.adsManager.getCuePoints().length&&this.currentAdsManager.adsLoader&&(Brid.log("CALL adsLoader.contentComplete 1"),this.currentAdsManager.adsLoader.contentComplete(),!Brid.isIPhone&&this.currentAdsManager.currentAd&&this.currentAdsManager.currentAd.isLinear()&&"2"!==this.currentAdObject.adType)){var f=this;setTimeout(function(){f.player.waitingForAd||(f.currentAdsManager.adsLoader=
null,f.currentAdsManager.adDisplayContainer.destroy(),f.currentAdsManager.adDisplayContainer=null)},100)}a.reset();c.trigger("adsCompleted");c.muted(c.values.muted);c.volume(c.values.volume);c.remove("ended",a.$f(a.onEnded));c.add("ended",a.$f(a.onEnded));c.currentSrc()&&(!c.config.autoplay_on_ad||a.adPlayed||c.userInteracted||c.config.autoplayStickyAdOnly?c.config.ad_preload&&!this.doStartAdCalled&&this.adErrored?this.adErrored=!0:c.midrollPreload&&this.adErrored?(h.each(this.currentAdObject.cuepointsStatus,
function(b,c){"preRequestAd"===b&&(a.currentAdObject.cuepointsStatus[c]="adError")}),this.adErrored=!0):setTimeout(this.$f(function(){if(null!==c.children){Brid.log("Advertising resumeContent");if(c.config.autoplayStickyAdOnly&&(Brid.log("Advertising autoplayStickyAdOnly positionType",c.positionType,"isPlayerInView",c.isPlayerInView(),"adPlayed",this.adPlayed),c.config.autoplayInview=!0,c.config.autoplay_on_ad=!1,c.SlideInView&&c.SlideInView.close&&c.SlideInView.close.trigger("close"),c.closed=!0,
!c.isPlayerInView()&&!0===c.config.autoplayInviewOriginal)){c.trigger("showPoster");c.pause();return}!e&&(!c.currentSource.error&&-1===c.currentSrc().indexOf(c.currentSource.src)&&Brid.isIPhone||!c.currentSource.error&&-1===c.currentSrc().indexOf(c.currentSource.src)&&0==c.tag.currentTime||!c.currentSource.error&&-1===c.currentSrc().indexOf(c.currentSource.src)&&this.currentAdsManager&&"Brid.VAST"==this.currentAdsManager.name||""==c.tag.src)?(Brid.log("Advertising onContentResumeRequested 1"),c.stopTrackingCurrentTime(),
c.trigger("stopTrackingTime"),Brid.isIPhone?c.addOnce("loadedmetadata",b):c.addOnce("loadedmetadata",d),c.src(c.currentSource),c.load(),Brid.isIPhone||c.play()):e?(Brid.log("Advertising onContentResumeRequested 3"),Brid.isIPhone&&-1===c.currentSrc().indexOf(c.currentSource.src)&&(this.adSkipped&&c.src(c.currentSource),0==c.tag.currentTime&&(c.remove("ended",this.$f(this.onEnded)),c.src(c.currentSource),c.newContent=!0,c.trigger("newContent")),c.trigger("showPoster")),c.remove("loadedmetadata",d),
a.tempTime=null):(Brid.log("Advertising onContentResumeRequested 2"),a.tempTime?Brid.isIPhone&&0==c.tag.currentTime?(c.load(),c.addOnce("loadedmetadata",b)):setTimeout(function(){c.play();Brid.log("Advertising resumeFromTime",a.tempTime);a.tempTime=null;c.trigger("durationChange")},300):c.play())}}),0):(Brid.log("ULECEMO OVDE BESNO!!!"),c.onScrollFunc&&(Brid.log("REMOVE SCROLL ALSO"),c.removeScroll()),this.adErrored=!0))}},reset:function(){var b=this.player;b.adInProgress=!1;this.closeTimeout&&(clearTimeout(this.closeTimeout),
this.closeTimeout=null);b.tag&&(h.removeClass(b.tag,"brid-animate"),h.css(b.tag,{height:""},!1,"important"),setTimeout(function(){h.addClass(b.tag,"brid-animate")},250));Brid.log("Advertising reset",this.techGet("isLinear"));this.isLinear()&&(this.adErrored||this.adPlayed)&&(this.ourAdPos=-1);b.waitingForAd=!1;b.trigger("enableInteraction");if(this.ads.midroll||this.ads.overlay)b.remove("timeupdate",this.$f(this.checkForAd)),b.add("timeupdate",this.$f(this.checkForAd));b.trigger("adEnd",{s:this.somse})},
resetManager:function(){Brid.log("Brid.Advertising resetManager");this.techCall("resetManager");this.currentAdsManager&&this.currentAdsManager.el&&this.currentAdsManager.el.removeAttribute("style");this.currentAdsManager&&(this.currentAdsManager=null)},start:function(){this.currentAdsManager&&this.techCall("start",this.paused)},stop:function(){this.currentAdsManager&&this.techCall("stop")},play:function(b){b=this.player;b.tech.support.adManagement?b.techCall("play"):this.currentAdsManager&&this.techCall("togglePlay",
!0)},pause:function(b){b=this.player;b.tech.support.adManagement?b.techCall("pause"):this.currentAdsManager&&this.techCall("togglePlay",!1)},togglePlay:function(b){var d=this.player;d.pausedOnInteraction="undefined"!=typeof b;Brid.log("Advertisement togglePlay",this.currentAdsManager,"this.paused",this.paused);d.tech.support.adManagement?d.techGet("paused")?d.techCall("play"):d.techCall("pause"):this.currentAdsManager&&this.techCall("togglePlay",this.paused)},duration:function(){return this.player.tech.support.adManagement?
this.player.techGet("duration"):this.currentAdsManager?this.techGet("duration"):0},currentTime:function(){return this.player.tech.support.adManagement?this.player.techGet("currentTime"):this.currentAdsManager?this.techGet("currentTime"):0},volume:function(b){var d=this.player;if("undefined"!==typeof b)if(Brid.log("Advertising set volume",b),d.tech.support.adManagement)d.techCall("setVolume",b);else return this.currentAdsManager?this.techCall("volume",b):0;else return d.tech.support.adManagement?parseFloat(d.techGet("volume")):
this.currentAdsManager?this.techGet("volume"):0},hide:function(){for(var b=0,d=this.adManagers.length;b<d;b++)this.techCall("hide",null,this.adManagers[b])},show:function(){for(var b=0,d=this.adManagers.length;b<d;b++)this.techCall("show",null,this.adManagers[b])},onResize:function(b){this.currentAdsManager&&(b=b?100:0,setTimeout(this.$f(function(){this.techCall("onResize")}),b))},isLinear:function(){return"undefined"===typeof this.techGet("isLinear")||null===this.techGet("isLinear")||this.techGet("isLinear")}});
Brid.GoogleIMA=Brid.Abstract.extend({adsManager:null,adsLoader:null,adDisplayContainer:null,ad:null,hasAdRules:!1,isVPAID:!1,vpaidMode:"",adTimeout:15,init:function d(a,c){d.base.call(this,a,c);Brid.log("GoogleIMA init");this.el=c.container;this.parent=c.wrapper;this.adDisplayContainerInitialized=!1;this.name="GoogleIMA";this.adDisplayContainer=this.adsLoader=this.adsManager=null;if("undefined"===typeof google||"undefined"===typeof google.ima)this.count=0,Brid.Loader.load("js","https://imasdk.googleapis.com/js/sdkloader/ima3.js",
this.onDependencyLoad,null,this);else this.onDependencyLoad()},onDependencyLoad:function(){var d=this.player;Brid.log("GoogleIMA onDependencyLoad",this.count);if(!this.el)return this.error=!0,this.parent.onAdError("Ad Container not present",!0),this.hide(),null;if("undefined"===typeof google||"undefined"===typeof google.ima)return 10>this.count?(this.count++,setTimeout(this.$f(this.onDependencyLoad),50)):(this.error=!0,this.parent.onAdError("Google IMA not initialized. Make sure Ad blocker is disabled",
!0),this.hide()),null;d.add("userInteraction",this.$f(this.onUserInteraction));d.add("lastSecond",this.$f(this.onLastSecond));d.add("dompositionchange",this.$f(this.onDOMPositionChange));d.config&&d.config.id&&"22954"!=d.config.id&&(google.ima.settings.setPlayerType("brid-player"),google.ima.settings.setPlayerVersion("2.7.18"));google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0);google.ima.settings.setFeatureFlags({enableOmidBeta:!0});google.ima.settings.setNumRedirects(8);d.config.translate&&
d.config.translate.ima_locale&&google.ima.settings.setLocale(d.config.translate.ima_locale);this.triggerReady()},hide:function(){this.el&&h.css(this.el,{display:"none"})},show:function(){this.el&&h.css(this.el,{display:"block"})},onDOMPositionChange:function(){this.destroyAdsLoader();this.onUserInteraction()},onUserInteraction:function(d){var a=this.player;Brid.log("GoogleIMA onUserInteraction isPlaying",d);a.showOnAd()||!a.tech.support.adManagement&&a.tech.support.monetizable?(Brid.log("GoogleIMA onUserInteraction isPlaying",
a.isPlaying,"adDisplayContainer",this.adDisplayContainer,"adDisplayContainerInitialized",this.adDisplayContainerInitialized,"adsLoader",this.adsLoader),this.adDisplayContainer&&!this.adDisplayContainerInitialized&&(this.adDisplayContainerInitialized=!0,this.adDisplayContainer.initialize())):this.hide()},setVPAIDMode:function(d){Brid.log("GoogleIMA setVPAIDMode",d);google.ima.settings.setVpaidMode(d);this.vpaidMode=d},setupAdsLoader:function(){Brid.log("GoogleIMA setupAdsLoader",this.el,this.player.tag);
!this.adsLoader&&this.player.tag&&(this.adDisplayContainer||(this.adDisplayContainer=new google.ima.AdDisplayContainer(this.el,this.player.tag),this.player.adDisplayContainer=this.adDisplayContainer,Brid.isIPhone||(Brid.log("setupAdsLoader adDisplayContainer.initialize() 2"),this.adDisplayContainerInitialized=!0,this.adDisplayContainer.initialize())),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
this.$f(this.onAdsManagerLoaded),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.$f(this.onAdError),!1))},contentComplete:function(){Brid.log("GoogleIMA contentComplete");this.adsLoader&&this.adsLoader.contentComplete();!this.adsManager||this.adsManager.getCuePoints().length&&-1!=this.adsManager.getCuePoints().indexOf(-1)||this.resetManager()},requestAd:function(d){var a=this.player;var c=!1;if(-1!==d.indexOf("ima3vpaid.appspot.com")){var e=h.queryStringToObj(d.split("?")[1]);
Brid.log("GoogleIMA stripIMAWrapper",e);d=e.adTagUrl?decodeURIComponent(e.adTagUrl):d}this.adTag=d;this._hasResponse=!1;if("undefined"===typeof google||"undefined"===typeof google.ima)this.error=!0,this.parent.onAdError("Google IMA not initialized. Make sure Ad blocker is disabled",!0),this.hide();else{this.adsLoader||this.setupAdsLoader();this.show();if(-1!=d.toLowerCase().indexOf("brid_vpaidmode")||-1!=d.toLowerCase().indexOf("brid_adtimeout"))c=d.split("?")[1]?h.queryStringToObj(d.split("?")[1]):
-1!=d.toLowerCase().indexOf("brid_vpaidmode=insecure")?{brid_vpaidmode:"insecure"}:{},Brid.log("GoogleIMA requestAd params",c),this.adTimeout=c.brid_adtimeout||this.adTimeout,c=c.brid_vpaidmode&&"insecure"==c.brid_vpaidmode,d=d.replace("&brid_vpaidmode=insecure","");c||this.parent._urlDeblocked?this.setVPAIDMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE):this.setVPAIDMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED);d=h.removeParam("brid_parser",d);c=new google.ima.AdsRequest;h.validateURL(d)?
c.adTagUrl=d:-1!==d.indexOf("<VAST")&&-1!==d.indexOf("</VAST>")?c.adsResponse=d:(Brid.error("--- BridPlayer --- VAST Template or Ad Tag ndo not have a proper format"),Brid.exLog("VAST Template or Ad Tag does not have a proper format"),this.parent.onAdError("VAST Template or Ad Tag do not have a proper format"));c.linearAdSlotWidth=a.el.offsetWidth;c.linearAdSlotHeight=a.el.offsetHeight;c.nonLinearAdSlotWidth=a.el.offsetWidth;c.nonLinearAdSlotHeight=a.el.offsetHeight;c.vastLoadTimeout=1E3*this.adTimeout;
d=a.config.autoplay;e=a.muted();Brid.log("GoogleIMA autoplayAllowed",d,"autoplayRequiresMuted",e,"continuousPlayback",a.isNextQueued());a.config&&a.config.id&&"22954"!=a.config.id&&(c.setAdWillAutoPlay(d),c.setAdWillPlayMuted(e),c.setContinuousPlayback(a.isNextQueued()));try{this.adsLoader.requestAds(c)}catch(f){Brid.error("--- BridPlayer --- Google IMA Error. Google IMA initialization failed",f),Brid.exLog("Google IMA Error. Google IMA initialization failed",f),this.parent.onAdError("Google IMA Error. Google IMA initialization failed")}}},
onAdsManagerLoaded:function(d){var a=this.player;a.trigger("AdsManagerLoadedEvent",{adsManagerLoadedEvent:d});var c=new google.ima.AdsRenderingSettings;c.loadVideoTimeout=1E3*this.adTimeout;c.mimeTypes="video/mp4 video/webm video/x-msvideo video/mpeg video/ogg application/javascript application/octet-stream".split(" ");a.config.ad_max_bitrate&&0<a.config.ad_max_bitrate&&(c.bitrate=a.config.ad_max_bitrate);d=this.adsManager=d.getAdsManager(a.tag,c);this.onContentPauseRequestedFunc=this.$f(this.onContentPauseRequested);
this.onContentResumeRequestedFunc=this.$f(this.onContentResumeRequested);this.onAdEventFunc=this.$f(this.onAdEvent);0<d.getCuePoints().length&&-1!==d.getCuePoints().indexOf(-1)&&(a.hasPostroll=!0);d.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.$f(this.onAdError));d.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequestedFunc);d.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequestedFunc);var c=[google.ima.AdEvent.Type.ALL_ADS_COMPLETED,
google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.DURATION_CHANGE,google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,google.ima.AdEvent.Type.IMPRESSION,google.ima.AdEvent.Type.LOG],
e;for(e in c)d.addEventListener(c[e],this.onAdEventFunc);try{Brid.log("GoogleIMA onAdsManagerLoaded adDisplayContainerInitialized",this.adDisplayContainerInitialized,"canAutoplay",a.canAutoplay(),"isFacebookApp",h.isFacebookApp());if(!this.adDisplayContainerInitialized){if(!a.canAutoplay()){Brid.event.add(r.body,"click",this.$f(this.onInteraction));return}this.onUserInteraction()}this.doStartAd()}catch(f){d&&(d.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequestedFunc),
d.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequestedFunc)),Brid.error("--- BridPlayer --- Google IMA Error. There was a problem with the VAST response",f.getError?f.getError():f),Brid.exLog("Google IMA Error. There was a problem with the VAST response",f.getError?f.getError():f),this.parent.onAdError("Google IMA Error. There was a problem with the VAST response.")}},onInteraction:function(){Brid.event.remove(r.body,"click",this.$f(this.onInteraction));
this.onUserInteraction();this.doStartAd()},doStartAd:function(){var d=this.player;Brid.log("GoogleIMA doStartAd");this.parent.doStartAdCalled=!0;this.adsManager.init(d.el.offsetWidth,d.el.offsetHeight,google.ima.ViewMode.NORMAL);this._hasResponse=!0;Brid.log("Bice da smo ovde",d.config.autoplayInview,!d.isPlayerInView(),d.config.viewability,d.name);Brid.log("isMidroll","1"===this.parent.currentAdObject.adType);if("1"===this.parent.currentAdObject.adType&&d.midrollPreload)this.parent.paused=!0;else{if(d.name&&
"Brid.Player"==d.name){if((d.config.autoplayInview&&!d.config.autoplayStickyAdOnly&&!d.isPlayerInView()||d.config.ad_preload&&!d.playWithPreloadStarted&&!d.config.autoplayInview)&&!this.started){d.waitForInViewAdAutoplay=!0;d.config.ad_preload&&!d.config.autoplayInview&&d.trigger("adPreloaded");this.parent.paused=!0;return}}else if(d.config.autoplayInview&&!d.isPlayerInView()&&d.config.viewability){this.parent.paused=!0;return}this.started=!0;Brid.log("GoogleIMA doStartAd");this.volume(d.values.muted?
0:d.values.volume||0);this.parent.paused=!1;this.adsManager.start()}},onAdEvent:function(d){var a=this.player,c=google.ima.AdEvent.Type,e=this.currentAd=d.getAd();Brid.log("GoogleIMA onAdEvent",d.type);Brid.exLog("GoogleIMA AdEvent",d.type);switch(d.type){case c.LOADED:Brid.log("GOOGLE IMA AD LOADED","Ad System",e.getAdSystem(),"Advertiser name",e.getAdvertiserName());Brid.log("Creative Ad id",e.getCreativeAdId(),"Creative Id",e.getCreativeId());Brid.log("Creative Trafficking params",e.getTraffickingParameters());
Brid.log("Wrapper ad ids",e.getWrapperAdIds(),"Wrapper ad systems",e.getWrapperAdSystems());Brid.log("Wraper Creative Ad id",e.getWrapperCreativeIds());1<this.currentAd.getAdPodInfo().getTotalAds()&&(this.parent.isPodTag=!0);this.show();Brid.log("Current ad is linear",e.isLinear(),e.isLinear);if(e.isLinear()){if(e.b&&e.b.vpaid||e.g&&e.g.vpaid||"application/x-shockwave-flash"==e.getContentType())this.isVPAID=!0;Brid.log("GoogleIMA LOADED setVolume muted",a.values.muted,"volume",a.values.volume);this.volume(a.values.muted?
0:a.values.volume||0)}else if(a.currentSrc())a.isPlaying?"1"===this.parent.currentAdObject.adType&&a.paused()&&(this.onContentResumeRequested(),Brid.log("Call onContentResumeRequested 2")):(this.parent.adPlayed=!0,this.onContentResumeRequested(),Brid.log("Call onContentResumeRequested 1"));else{this.onAdError("Google IMA Error. Outstream units do not support non-linear ads");break}Brid.isMobilePlatform&&Array.prototype.map.call(a.el.getElementsByTagName("video"),function(c){var d=c.play;c.play=function(){Brid.log("GoogleIMA LOADED play videoNode",
c,"videoNode.muted",c.muted,"player.values.muted",a.values.muted);c.muted=a.values.muted;c.play=d;return c.play()}});this.onResize(null);break;case c.STARTED:Brid.isIPhone&&a.isFullScreen&&a.toggleFullScreen(!a.isFullScreen);this.parent.onAdStart(this.isVPAID);e.isLinear()&&a.trigger("adDuration",{duration:e.getDuration()});Brid.event.remove(r.body,"click",this.$f(this.onInteraction));Brid.log("GoogleIMA STARTED setVolume muted",a.values.muted,"volume",a.values.volume);this.volume(a.values.muted?
0:a.values.volume||0);this.onResize(null);break;case c.IMPRESSION:a.showOnAd()&&a.config.autoplayInview&&!a.isPlayerInView()&&(Brid.log("CALLING OUTSTREAM PAUSE"),this.adsManager.pause());Brid.isMobilePlatform&&a.showOnAd()&&setTimeout(this.$f(function(){0!=this.currentAd.getDuration()-this.adsManager.getRemainingTime()||a.getAdInProgress()||(Brid.log("CALLING FADE IN PARENT"),a.fadeInParent())}),1E3);this.parent.onAdImpression();Brid.log("GoogleIMA IMPRESSION setVolume muted",a.values.muted,"volume",
a.values.volume);this.volume(a.values.muted?0:a.values.volume||0);break;case c.DURATION_CHANGE:a.trigger("durationChange");break;case c.PAUSED:a.config.blockAdPause&&!a.pausedOnInteraction?this.adsManager.resume():(Brid.log("SAD SMO OVDE"),this.parent.paused=!0,a.trigger("pause"),a.trigger("adPause"));Brid.isMobilePlatform||h.autoplayDesktopSupported||h.isAutoplayDesktopSupported();break;case c.CLICK:Brid.isMobilePlatform||h.autoplayDesktopSupported||h.isAutoplayDesktopSupported();a.trigger("adClicked");
break;case c.RESUMED:this.parent.paused=!1;a.trigger("play");a.trigger("adResume");break;case c.FIRST_QUARTILE:a.trigger("adFirstQuartile");break;case c.MIDPOINT:a.trigger("adMidpoint");break;case c.THIRD_QUARTILE:a.trigger("adThirdQuartile");break;case c.COMPLETE:this.parent.onAdComplete();break;case c.LOG:d=d.getAdData();d.adError&&Brid.log("Non-fatal error occurred: "+d.adError.getMessage());break;case c.SKIPPED:this.parent.onAdSkipped();break;case c.ALL_ADS_COMPLETED:case c.USER_CLOSE:var f=this.player.adsManager.currentAdObject,
f=f?f.adTags.pod:0;Brid.log("GoogleIMA",d.type,"getRemainingTime",this.adsManager.getRemainingTime(),"player.waitingForAd",this.player.waitingForAd);Brid.log("GoogleIMA",d.type,"ad pod",f);if(this.player.waitingForAd&&0<f)Brid.log("Ignore ALL_ADS_COMPLETED");else{if(d.type===c.USER_CLOSE)if(.1>=this.adsManager.getRemainingTime())this.parent.onAdComplete();else this.parent.onAdSkipped();if(!this.parent.adPlayed&&2>this.player.adsManager.currentAdObject.adTags.length)this.onAdError("All ads completed without an impression");
if(!this._contentResumeCalled||this.adsManager&&0<this.adsManager.getCuePoints().length&&-1!=this.adsManager.getCuePoints().indexOf(-1))this.onContentResumeRequested();!1===e.isLinear()&&this.parent.reset();this.resetManager()}}},onContentPauseRequested:function(){Brid.log("GoogleIMA onContentPauseRequested");this._contentResumeCalled=!1;this.parent.onContentPauseRequested()},onContentResumeRequested:function(d){Brid.log("GoogleIMA onContentResumeRequested");this._contentResumeCalled=!0;this.parent.onContentResumeRequested()},
onAdError:function(d){d=d&&d.getError&&d.getError()||d;Brid.error("--- BridPlayer --- Google IMA Error. ",d);d.getMessage&&d.getMessage()&&Brid.log("Google IMA Error message",d.getMessage());Brid.exLog("Google IMA Error.",d);this.player&&this.player.waitForInViewAdAutoplay&&(this.player.waitForInViewAdAutoplay=!1);if(this.adsManager){this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequestedFunc);this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,
this.onContentResumeRequestedFunc);var a=[google.ima.AdEvent.Type.ALL_ADS_COMPLETED,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.DURATION_CHANGE,google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,
google.ima.AdEvent.Type.IMPRESSION,google.ima.AdEvent.Type.LOG];for(c in a)this.adsManager.removeEventListener(a[c],this.onAdEventFunc)}this.isVPAID=!1;if(d&&d.getErrorCode&&901==d.getErrorCode()&&-1==this.adTag.indexOf("brid_vpaidmode"))this.player.config&&this.player.config.id&&"22954"!=this.player.config.id&&(d=google.ima.ImaSdkSettings.VpaidMode,this.resetManager(),this.setVPAIDMode(this.vpaidMode===d.ENABLED?d.INSECURE:d.ENABLED),this.requestAd(this.adTag+"&brid_vpaidmode=insecure"));else{var c=
8888;d&&d.getErrorCode&&(c=d.getErrorCode());this.adsLoader&&(Brid.log("CALL adsLoader.contentComplete 3"),this.adsLoader.contentComplete());this.parent.onAdError("Google IMA Error. "+d,!1,c)}},onLastSecond:function(){this.player.getAdInProgress()&&this.currentAd&&!this.currentAd.isLinear()&&this.parent.stopNonLinear()},stop:function(){this.adsManager&&(Brid.log("GoogleIMA stop"),this.adsManager.stop())},resetManager:function(){Brid.log("GoogleIMA resetManager");this.currentAd&&(this.currentAd=null);
this.isVPAID=this.parent.hasAdRules=!1;this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)},destroyAdsLoader:function(){Brid.log("GoogleIMA destroyAdsLoader");this.adsLoader&&(this.adsLoader.destroy(),this.adsLoader=null);this.adDisplayContainer&&(this.adDisplayContainer.destroy(),this.adDisplayContainer=null,this.adDisplayContainerInitialized=!1)},isLinear:function(){return this.currentAd?this.currentAd.isLinear():null},start:function(){Brid.log("GoogleIMA start",this._hasResponse);
var d=this.player;this.adsManager&&this._hasResponse?(this.volume(d.values.muted?0:d.values.volume||0),this.parent.paused=!1,this.adsManager.start()):d.waitingForAd=!0},togglePlay:function(d){Brid.log("GoogleIMA togglePlay",d);this.adsManager&&(d?this.adsManager.resume():this.adsManager.pause())},duration:function(){return this.currentAd?this.currentAd.getDuration():0},currentTime:function(){return this.adsManager&&this.currentAd?this.currentAd.getDuration()-this.adsManager.getRemainingTime():0},
volume:function(d){var a=this.adsManager,c=this.player,e=d;if("undefined"!==typeof d)a&&(!Brid.isMobilePlatform&&c.config.autoplay&&h.autoplayDesktopSupportedPromise&&!h.autoplayDesktopSupported&&(Brid.log("GOOGLE IMA SET VOLUME TO 0 DUE TO BROWSER LIMITATION"),e=0,Array.prototype.map.call(this.el.getElementsByTagName("video"),function(a){Brid.log("VIDEO ELEMENT",a,"VIDEO ELEMENT src",a.src,"VIDEO ELEMENT currentTime",a.currentTime,"VIDEO ELEMENT ended",a.ended);""!=a.src&&!a.ended&&0<a.currentTime&&
(e=d)})),Array.prototype.map.call(this.el.getElementsByTagName("video"),function(a){0<e?a.removeAttribute("muted"):a.setAttribute("muted","true");a.muted=0===e}),Brid.log("GoogleIMA setVolume val",e),a.setVolume(e));else return a?a.getVolume():0},onResize:function(){var d=this.player,a=d.isFullScreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,c=this.currentAd;h.css(this.el,{top:"",bottom:"",left:"",right:""});if(this.adsManager&&c)if(c.isLinear())Brid.log("GoogleIMA onResize linear offsetWidth",
d.playerHolder.el.offsetWidth,"offsetHeight",d.playerHolder.el.offsetHeight),this.adsManager.resize(d.playerHolder.el.offsetWidth,d.playerHolder.el.offsetHeight,a);else{var e=d.isFullScreen?90:45,f=c.getWidth(),c=c.getHeight(),f=1>=f?this.el.offsetWidth-50:f,c=1>=c?100:c;h.css(this,{top:d.playerHolder.el.offsetHeight-(c+50)-e+"px",bottom:"auto",left:(d.playerHolder.el.offsetWidth-(f+50))/2+"px",right:"auto"});Brid.log("GoogleIMA onResize non linear ad width",f,"ad height",c);this.adsManager.resize(f+
50,c+50,a)}},supportsAdTag:function(d){Brid.log("GoogleIMA supportsAdTag",d,Brid.Util.adBlockerEnabled);return-1!==d.indexOf("brid_parser=ima")?!0:-1!==d.indexOf("brid_parser=brid")?!1:(h.validateURL(d)||-1!==d.indexOf("<VAST")&&-1!==d.indexOf("</VAST>"))&&!Brid.Util.adBlockerEnabled}});Brid.VAST=Brid.Abstract.extend({closeTimeout:null,hasAdRules:!1,isVPAID:!1,jsLoaded:!1,cssLoaded:!1,_hasResponse:!1,adTimeout:15,pbTechInitialized:!1,init:function a(c,e){a.base.call(this,c,e);this.name="Brid.VAST";
this.el=e.container;this.parent=e.wrapper;if("undefined"===typeof Brid.AdSDK){e="";if("//p.brid.tv"==c.config.Url.servicePlugins||"//player.a-2.tv"==c.config.Url.servicePlugins||"//video.adhunters.tv"==c.config.Url.servicePlugins||"//services.n8eve.com"==c.config.Url.servicePlugins||"//adunit.vidssp.com"==c.config.Url.servicePlugins||"//cdn.hybrid1.io"==c.config.Url.servicePlugins)e="parser/"+Brid.pv.plugins.parser.version+"/";Brid.Loader.load("js",c.config.Url.servicePlugins+"/"+c.config.Url.plugins+
e+"brid.parser.min.js",this.$f(this.onJSLoded),null,this)}else this.triggerReady()},onJSLoded:function(){setTimeout(this.$f(function(){"undefined"!=typeof Brid.AdSDK?this.isReady||this.triggerReady():(this.error=!0,this.parent.onAdError("Brid VAST ERROR. Brid VAST SDK load failed.",!0))}),0)},setupAdsLoader:function(){Brid.log("Brid.VAST setupAdsLoader");if(!this.adsManager){try{var a=this.adsManager=new Brid.AdSDK.AdsManager(this.player,{},this.el)}catch(c){Brid.error("Brid VAST ERROR. Brid VAST SDK could not be initialized",
c);this.error=!0;this.parent.onAdError("Brid VAST ERROR. Brid VAST SDK could not be initialized",!0);return}this.player&&this.player.tech&&this.player.tech.support.adManagement?this.hide():(a.add("vast.adEnd",this.$f(this.onAdEnd)),a.add("vast.adStart",this.$f(this.onAdStart)),a.add("vast.contentPauseRequested",this.$f(this.onContentPauseRequested)),a.add("vast.contentResumeRequested",this.$f(this.onContentResumeRequested)),a.add("vast.adImpression",this.$f(this.onAdImpression)),a.add("vast.adVideoStart",
this.$f(this.onAdVideoStart)),a.add("vast.adSkip",this.$f(this.onAdSkiped)),a.add("vast.adError",this.$f(this.onAdError)),a.add("vast.adDurationChange",this.$f(this.onAdDurationChange)),a.add("vast.adPause",this.$f(this.onAdPause)),a.add("vast.adResume",this.$f(this.onAdResume)),a.add("vast.adVideoComplete",this.$f(this.onAdComplete)),a.add("vast.selected3rdParty",this.$f(this.on3rdPartySelected)),a.add(["vast.firstQuartile","vast.midpoint","vast.thirdQuartile"],this.$f(function(a){switch(a.type){case "vast.firstQuartile":this.player.trigger("adFirstQuartile");
break;case "vast.midpoint":this.player.trigger("adMidpoint");break;case "vast.thirdQuartile":this.player.trigger("adThirdQuartile")}})),this.player.add("userInteraction",this.$f(this.onUserInteraction)),this.player.add("lastSecond",this.$f(this.onLastSecond)))}},contentComplete:function(){},requestAd:function(a){var c=r.BridIframeBurst?t.top:t;0<a.indexOf("//googleads")&&10>a.indexOf("//googleads")&&(a="https://ima3vpaid.appspot.com/?adTagUrl="+a+"&type=js");if(-1!=a.toLowerCase().indexOf("brid_adtimeout")){var e=
h.queryStringToObj(a);Brid.log("VAST requestAd params",e);this.adTimeout=e.brid_adtimeout||this.adTimeout;a=h.removeParam("brid_adtimeout",a)}a=h.removeParam("brid_parser",a);0<a.indexOf("pubads")&&10>a.indexOf("pubads")&&(a=h.removeParam("impl",a),a=h.replaceParam("output","xml_vast4",a),a+=this.player.config.autoplay?"&vpa=auto":"&vpa=click",a+=this.player.muted()?"&vpmute=1":"&vpmute=0",a+=h.addAfszv(this.player.el.offsetWidth,this.player.el.offsetHeight),c.googleToken&&c.googleToken[4]&&""!=c.googleToken[4]&&
(a=a+"&jar="+c.googleToken[4]),a+=h.isAmp()?"&is_amp=1":"&is_amp=0",a=a+"&scor="+Math.floor(4503599627370496*Math.random()));Brid.exLog("Brid.VAST requestAd",a);this.adsManager||this.setupAdsLoader();this.show();this.adUnit=null;this._hasResponse=!1;this.adsManager.config.adCancelTimeout=1E3*this.adTimeout;this.adsManager.requestAd(a,this.$f(this.onAdResponse))},onAdResponse:function(){var a=this.player;Brid.exLog("Brid.VAST onAdResponse");this._hasResponse=!0;this.show();a.canAutoplay()||a.userInteracted?
(this.pbTechInitialized=!0,this.doStartAd()):Brid.event.add(r.body,"click",this.$f(this.onInteraction,this.id),!0)},onUserInteraction:function(){this.player.remove("userInteraction",this.$f(this.onUserInteraction));Brid.log("Brid.VAST onUserInteraction pbTechInitialized",this.pbTechInitialized,"userInteracted",this.player.userInteracted);this.parent.currentAdsManager&&"GoogleIMA"==this.parent.currentAdsManager.name||this.player.getAdInProgress()||(this.adsManager||this.setupAdsLoader(),this.pbTechInitialized||
(this.pbTechInitialized=!0,this.adsManager.initializePlaybackTech()))},onInteraction:function(){Brid.event.remove(r.body,"click",this.$f(this.onInteraction));this.onUserInteraction();this.doStartAd()},doStartAd:function(){var a=this.player;Brid.log("Brid.VAST doStartAd");this.parent.doStartAdCalled=!0;if("1"===this.parent.currentAdObject.adType&&a.midrollPreload)this.parent.paused=!0;else{if(a.name&&"Brid.Player"==a.name){if((a.config.autoplayInview&&!a.config.autoplayStickyAdOnly&&!a.isPlayerInView()||
a.config.ad_preload&&!a.playWithPreloadStarted&&!a.config.autoplayInview)&&!this.started){a.waitForInViewAdAutoplay=!0;Brid.log("PAUZIRAJ");a.config.ad_preload&&!a.config.autoplayInview&&a.trigger("adPreloaded");this.parent.paused=!0;return}}else if(a.config.autoplayInview&&!a.isPlayerInView()&&a.config.viewability){this.parent.paused=!0;return}this.started=!0;this.parent.paused=!1;this.adUnit=this.adsManager.playAd();Brid.log("\tsetAdVolume VAST doStartAd");this.adsManager.setAdVolume(this.player.values.muted?
0:this.player.values.volume);this.onResize();this.player.showOnAd()}},onAdStart:function(){Brid.exLog("Brid.VAST onAdStart");this.adsManager.isVPAID&&!this.adsManager.adManager.tech._adUnit._creative.getAdLinear()&&(Brid.isMobilePlatform&&h.isIOS()||(this.adsManager.adManager.playbackTech.el.src=""),this.adsManager.resize(this.player.el.offsetHeight-150-40,0,this.player.el.offsetWidth,150,"normal"),this.player.adInProgress=!1,this.parent.adPlayed=!0,this.onContentResumeRequested());Brid.event.remove(r.body,
"click",this.$f(this.onInteraction));this.adUnit=this.adsManager.adUnit;if(this.isLinear()||this.player.currentSrc())Brid.log("VAST onAdStart setVolume muted",this.player.values.muted,"volume",this.player.values.volume),Brid.log("\tsetAdVolume VAST onAdStart"),this.adsManager.setAdVolume(this.player.values.muted?0:this.player.values.volume),this.parent.onAdStart(this.adsManager.isVPAID);else this.onAdError({data:"Outstream units do not support non-linear ads"})},onAdImpression:function(){var a=this.player;
this.adUnit||(this.adUnit=this.adsManager.adUnit);a.showOnAd()&&a.config.autoplayInview&&!a.isPlayerInView()&&this.adUnit.pauseAd();Brid.log("VAST onAdImpression setVolume muted",this.player.values.muted,"volume",this.player.values.volume);Brid.log("\tsetAdVolume VAST onAdImpression");this.adsManager.setAdVolume(a.values.muted?0:a.values.volume);this.onResize();this.parent.onAdImpression()},onAdVideoStart:function(){this.onResize()},onAdComplete:function(){Brid.log("Brid.VAST onAdComplete");Brid.exLog("Brid.VAST onAdComplete");
this.parent.onAdComplete()},onAdSkiped:function(){this.parent.adSkipped=!0;this.parent.onAdSkipped();Brid.exLog("Brid.VAST onAdSkiped");Brid.log("Brid.VAST onAdSkiped")},onAdEnd:function(){Brid.exLog("Brid.VAST onAdEnd");Brid.log("Brid.VAST onAdEnd")},onContentPauseRequested:function(){this.parent.onContentPauseRequested()},onContentResumeRequested:function(){Brid.log("Brid.VAST onContentResumeRequested waitForPlaylistEnd",this.adsManager.waitForPlaylistEnd);this.adsManager.waitForPlaylistEnd||(0==
this.isLinear()&&(this.parent.adPlayed=!0),this.parent.onContentResumeRequested())},onAdPause:function(){Brid.exLog("Brid.VAST onAdPause");var a=this.player;a.config.blockAdPause&&!a.pausedOnInteraction?this.adUnit.resumeAd():(this.parent.paused=!0,a.trigger("pause"),a.trigger("adPause"))},onAdResume:function(){Brid.exLog("Brid.VAST onAdResume");this.parent.paused=!1;this.adsManager.isVPAID||this.player.trigger("play");this.player.trigger("adResume")},onAdDurationChange:function(){this.player.trigger("durationchange")},
on3rdPartySelected:function(){this.parent.thirdParty=!0},onAdError:function(a){this.adsManager.waitForPlaylistEnd||(a=a.data?a.data.error:"",Brid.exLog("Brid.VAST onAdError",a),Brid.log("Brid.VAST onAdError",a),this.parent.onAdError("Brid.VAST onAdError "+a,!1,a&&a.code?a.code:8888))},stop:function(){this.adsManager&&this.adsManager.stopAd()},onLastSecond:function(){this.adsManager&&this.adUnit&&!this.isLinear()&&this.parent.stopNonLinear()},resetManager:function(){this.adUnit=null;Brid.log("Brid.VAST resetManager");
this.adsManager&&this.adsManager.reset()},destroyAdsLoader:function(){Brid.log("AdSDK destroyAdsLoader");this.pbTechInitialized=!1;this.adsManager&&(this.adsManager.destroyAdsLoader(),this.adsManager.destroy(),this.adsManager=null)},isLinear:function(){return this.adUnit?this.adsManager.isLinear():null},start:function(){Brid.log("Brid.VAST start adsManager",this.adsManager,"_hasResponse",this._hasResponse);this.adsManager&&this._hasResponse?(this.adsManager.playAd(),Brid.log("\tsetAdVolume VAST start"),
this.adsManager.setAdVolume(this.player.values.muted?0:this.player.values.volume),this.parent.paused=!1):this.player.waitingForAd=!0},togglePlay:function(a){Brid.log("Brid.VAST togglePlay",a);this.adsManager&&this.adUnit&&(a?this.adUnit.resumeAd():this.adUnit.pauseAd())},duration:function(){return this.adsManager?this.adsManager.getAdDuration()||-1:0},currentTime:function(){return this.adsManager?this.adsManager.getAdCurrentTime()||0:0},volume:function(a){var c=this.adsManager;if("undefined"!==typeof a)c&&
(Brid.log("\tsetAdVolume VAST volume"),c.setAdVolume(a));else return c?c.getAdVolume():0},hide:function(){this.el&&h.css(this.el,{display:"none"})},show:function(){this.el&&h.css(this.el,{display:"block"})},onResize:function(){if(this.player.getAdInProgress()){var a=this.player,c=a.isFullScreen?"fullscreen":"normal";h.css(this.el,{top:"",bottom:"",left:"",right:""});if(this.adsManager.isLinear()&&this.adUnit)Brid.log("VAST onResize isLinear",a.playerHolder.el.offsetWidth,a.playerHolder.el.offsetHeight),
this.adsManager.resize(0,0,a.playerHolder.el.offsetWidth,a.playerHolder.el.offsetHeight,c);else if(this.adUnit){var e=a.isFullScreen?90:45,f=this.adUnit.getWidth()||0,n=this.adUnit.getHeight()||0,f=0>=f?this.el.offsetWidth-50:f,n=0>=n?100:n;this.adsManager.resize(a.playerHolder.el.offsetHeight-n-e,(a.playerHolder.el.offsetWidth-f)/2,f,n,c)}}},supportsAdTag:function(a){Brid.log("Brid.VAST supportsAdTag",a,Brid.Util.adBlockerEnabled);return-1!==a.indexOf("brid_parser=ima")?!1:-1!==a.indexOf("brid_parser=brid")?
!0:(h.validateURL(a)||-1!==a.indexOf("<VAST")&&-1!==a.indexOf("</VAST>"))&&(-1===a.indexOf("//googleads")&&-1===a.indexOf("21760922134")||Brid.Util.adBlockerEnabled)}});Brid.BannerAd=Brid.Abstract.extend({default:{adRequestTimeout:15E3,adDuration:15},init:function c(e,f){c.base.call(this,e,f);this.el=f.container;this.parent=f.wrapper;this.name="BannerAd";this.closeButtonInterval=null;this.triggerReady()},iframeBannerResizeCallback:function(c){var e=r.BridIframeBurst?t.top:t,f=this.iframeBanner;if("bannerResize"==
c.data.event&&(f.style.width=c.data.w+"px",f.style.height=c.data.h+"px",Brid.event.remove(e,"message",this.$f(this.iframeBannerResizeCallback)),Brid.log("BannerAd setting iframe size to",c.data.w,c.data.h),50<c.data.w&&50<c.data.h))this.onAdLoaded()},requestAd:function(c){function e(){n.anyad.contains(n.ad)||!h.isChrome()||n.showAnyAd||n.anyad.appendChild(n.ad);var c=n.ad.getElementsByTagName("iframe");Brid.log("BannerAd checkForIframe iframes",c);if(0<c.length)n.adLoadTimeout=setTimeout(n.$f(n.onAdLoadError),
n.config.adRequestTimeout),(this.adiFrame=c[c.length-1])&&Brid.event.once(this.adiFrame,"load",n.$f(n.onAdLoaded));else if(0<n.ad.getElementsByTagName("img").length||0<n.ad.getElementsByTagName("a").length)n.onAdLoaded();else if(100>=p)p++,setTimeout(e,50);else n.onAdLoadError()}var f=r.BridIframeBurst?t.top:t;c=c.split("<|>");var n=this,p=0,l;this.config.adDuration=c[1]?parseInt(c[1]):0;c=c[0];var m=/\.display\('(.*)'\)/g.exec(c),g=Math.floor(Math.random()*Math.floor(1E3));m&&(c=c.split(m[1]).join(m[1]+
"-"+g),Brid.log("BannerAd modifying adTag div id",m[1]+"-"+g));Brid.log("BannerAd requestAd",c,"adDuration",this.config.adDuration,"use iframe",!!this.player.config.use_iframe_for_banners);if(this.player.config.use_iframe_for_banners){this.ad=h.createElement("div",{className:"brid-banner-ad"});var k=this.iframeBanner=r.createElement("iframe");var q="<body><style>html,body{margin:0;padding:0}</style><script>window.onload=function(){var cnt=0;function checkIframeSizes(){var iframes=document.querySelectorAll('iframe');iframes.forEach(function(i){if(i.clientWidth!=0&&i.clientHeight!=0){window.parent.postMessage({event:'bannerResize',w:i.clientWidth,h:i.clientHeight},'*');clearInterval(th);}});if(cnt++>=300)clearInterval(th);}var th=setInterval(checkIframeSizes,50);};\x3c/script>"+
c+"</body>";this.ad.appendChild(k);k.style.display="block";k.style.border="0";k.style.width="0px";k.style.height="0px";this.adLoadTimeout=setTimeout(this.$f(this.onAdLoadError),this.config.adRequestTimeout);Brid.event.add(f,"message",this.$f(this.iframeBannerResizeCallback))}else{var u="";this.originalDW=r.write;r.write=this.$f(function(c){u+=c;/<[a-z][\s\S]*>/i.test(u)&&(l=h.createElement("div",{innerHTML:""}),l.innerHTML=u,n.ad.appendChild(l),u="",n.executeJS(l))});this.ad=h.createElement("div",
{className:"brid-banner-ad",innerHTML:"<div>"+c+"</div>"})}this.anyad=h.createElement("div",{className:"brid-banner-anyad"});"inglide"==this.player.positionType&&this.player.SlideInView.resizeAnyAd();this.anyadInfo=h.createElement("div",{className:"brid-banner-anyad-info"});this.player.playerCloseButton&&this.player.playerCloseButton.buttonConfig.position&&"top-left"==this.player.playerCloseButton.buttonConfig.position&&h.css(this.anyadInfo,{"margin-left":"25px"});this.anyad.insertBefore(this.anyadInfo,
this.anyad.firstChild);this.player.el.insertBefore(this.anyad,this.player.firstChild);if(this.showAnyAd=this.player.config.anyAd&&!this.player.isFullScreen)Brid.log("BannerAd AnyAd add ResizeListener"),Brid.Util.addResizeListener(this.ad,this.$f(this.onResize));this.anyad.appendChild(this.ad);this.player.config.use_iframe_for_banners?(k.contentWindow.document.open(),k.contentWindow.document.write(q),k.contentWindow.document.close()):(this.executeJS(this.ad),setTimeout(e,50))},executeJS:function(c){function e(c,
e,h){c.getAttribute(h)&&e.setAttribute(h,c.getAttribute(h)||"")}c=[].slice.call(c.getElementsByTagName("script"));0<c.length&&c.slice(0).map(function(c){var f=h.createElement("script");f.innerHTML=c.innerHTML;e(c,f,"src");e(c,f,"type");e(c,f,"async");e(c,f,"id");c.parentNode&&c.parentNode.insertBefore(f,c);c.parentNode&&c.parentNode.removeChild(c)})},onAdLoaded:function(){Brid.log("BannerAd onAdLoaded");this.originalDW&&(r.write=this.originalDW);var c=this.player;c.bannerMode=!0;this.adLoadTimeout&&
clearTimeout(this.adLoadTimeout);c.config.enable_close_button||(this.close=new Brid.Close(c,{name:"Close"}),this.close.add("close",this.$f(this.onAdEnd)),this.close.addClass("brid-close-banner"));this.adBannerBar=h.createElement("div",{className:"brid-banner-ad-bar"});this.el.appendChild(this.adBannerBar);this.adInfo=h.createElement("div",{className:"brid-banner-ad-info",innerHTML:"Advertisement"});this.adBannerBar.appendChild(this.adInfo);c.currentSrc()?h.css(this.el,{"background-color":"#000"}):
h.css(c.el,{"background-color":"transparent"});c.controls&&c.controls.hide();c.progressControl&&c.progressControl.hide();this.parent.paused=!0;this.parent.onAdStart();if(this.showAnyAd)this.onResize();this.parent.onAdImpression();this.parent.onContentPauseRequested();if(c.name&&"Brid.Player"==c.name){if(c.config.autoplayInview&&!c.isPlayerInView()&&"inglide"!=c.positionType){this.waitingForStart=c.waitForInViewAdAutoplay=!0;return}}else{if(c.showOnAd()&&c.config.autoplayInview&&!c.isPlayerInView()){this.waitingForStart=
!0;return}this.parent.paused=!1}this.initTimeouts()},start:function(){Brid.exLog("BannerAd start");this.waitingForStart&&this.initTimeouts()},stop:function(){this.onAdEnd()},initTimeouts:function(){this.waitingForStart=!1;this.config.adDuration&&(Brid.log("BannerAd onAdLoaded set ad timeout",this.config.adDuration),this.durationTimeout=setTimeout(this.$f(this.onAdEnd),1E3*this.config.adDuration),this.elapsedTime=0,this.timerInterval=setInterval(this.$f(function(){this.elapsedTime++;(this.anyadInfo||
this.adInfo).innerHTML="Ad: "+(this.config.adDuration-this.elapsedTime)+"s"}),1E3))},onAdEnd:function(){var c=this.player;Brid.log("BannerAd onAdEnd");this.parent.onAdComplete();this.resetManager();c.currentSrc()&&h.css(this.el,{"background-color":"transparent"});c.currentSrc()&&(c.controls&&c.controls.show(),c.progressControl&&c.progressControl.show());this.parent.onContentResumeRequested()},onAdLoadError:function(){Brid.log("BannerAd onAdLoadError");this.originalDW&&(r.write=this.originalDW);this.resetManager();
this.parent.onAdError("Banner Ad Load Timeout")},isLinear:function(){return!0},resetManager:function(){this.player.bannerMode=!1;Brid.event.remove(r.BridIframeBurst?t.top:t,"message",this.$f(this.iframeBannerResizeCallback));this.adiFrame&&(Brid.event.remove(this.adiFrame,"load",this.$f(this.onAdLoaded)),this.adiFrame=null);this.closeButtonInterval&&clearInterval(this.closeButtonInterval);this.timerInterval&&clearInterval(this.timerInterval);this.durationTimeout&&clearInterval(this.durationTimeout);
this.adLoadTimeout&&clearInterval(this.adLoadTimeout);this.close&&(this.close.destroy(),this.close=null);this.ad&&this.ad.parentNode&&(this.showAnyAd&&(Brid.log("BannerAd AnyAd remove ResizeListener"),Brid.Util.removeResizeListener(this.ad,this.$f(this.onResize))),this.anyad.parentNode&&this.anyad.parentNode.removeChild(this.anyad),this.player.playerHolder.el.style.display="",Brid.log("BannerAd AnyAd reverting player size",this.player.positionType,this.preAnyadSize),"normal"==this.player.positionType&&
this.preAnyadSize&&(this.player.el.style.width=this.preAnyadSize.width+"px",this.player.el.style.height=this.preAnyadSize.height+"px"),this.player.resize(),this.preAnyadSize=null,this.player.removeClass("brid-any-ad"),this.player.trigger("anyadFinished"),this.ad=null);this.adInfo&&this.adInfo.parentNode&&(this.adBannerBar.removeChild(this.adInfo),this.adInfo=null);this.adBannerBar&&this.adBannerBar.parentNode&&(this.el.removeChild(this.adBannerBar),this.adBannerBar=null)},setupAdsLoader:function(){},
contentComplete:function(){},onResize:function(c){if(this.player.getAdInProgress()&&this.showAnyAd){var e=this.player;c=this.anyad;if(300==e.el.clientWidth&&250<=e.el.clientHeight&&270>=e.el.clientHeight&&150<=this.ad.clientWidth&&170>=this.ad.clientWidth)return Brid.log("Responsive or iframe banner - do not resize"),!1;Brid.log("BannerAd AnyAd onResize player",e.el.clientWidth,e.el.clientHeight,"ad",this.ad.clientWidth,this.ad.clientHeight);this.preAnyadSize||(this.preAnyadSize={width:e.el.clientWidth,
height:e.el.clientHeight},e.currentSrc()||(e.el.style.opacity=0),Brid.log("BannerAd AnyAd preAnyadSize",this.preAnyadSize));c.style.width=this.ad.clientWidth+"px";c.style.height=this.ad.clientHeight+"px";e.playerHolder.el.style.display="none";e.el.style.width=c.style.width;e.el.style.height=c.style.height;e.currentSrc()||(clearTimeout(this.showAnyAdTimeout),this.showAnyAdTimeout=setTimeout(function(){e.el.style.opacity=1},200));h.addClass(this.ad,"brid-banner-ad-no");h.removeClass(this.ad,"brid-banner-ad");
e.addClass("brid-any-ad")}},hide:function(){this.el&&h.css(this.el,{display:"none"})},show:function(){this.el&&h.css(this.el,{display:"block"})},supportsAdTag:function(c){return!this.player.config.anyAd&&this.player.el&&this.player.el.clientHeight&&250>this.player.el.clientHeight?(Brid.error("--- BridPlayer --- Banners are not supported on small player sizes"),!1):!h.validateURL(c)&&!Brid.Util.adBlockerEnabled},togglePlay:function(c){Brid.log("BannerAd togglePlay",c);this.waitingForStart&&c&&this.initTimeouts();
this.parent.paused=!c;c?this.player.trigger("play"):this.player.trigger("pause")},duration:function(){return this.config.adDuration||0},currentTime:function(){return 0},volume:function(){return this.player.values.volume}});t.$bp.plugin("bridgima",function(c){c=c||this;c.isReady?c.addChild(new t.$bp.GoogleAnalytics(c,config)):t.$bp.Util.merge(c.config.children,{Advertising:{}})});C.trigger(r,"bridpluginloaded")})(window,document);
