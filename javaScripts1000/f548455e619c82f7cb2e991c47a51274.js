define("components/sessionExpiredModal",["FR","jquery","underscore","moment","services/freerideRestApi","services/urlHelper"],function(e,n,t,i,o,s){var r,a,c,d,l,u,p={},g={cacheJQueryElements:function(){p.cartNav=n("#nav_cart"),p.sessionExpiredTemplate=n("#session_expired_template"),p.checkoutSessionExpiredTemplate=n("#checkout_session_expired_template")},clearExistingTimeout:function(){c&&clearTimeout(c)},closeModal:function(){e.$el.window.trigger("global-modal-close")},openModal:function(){var n=g.getTemplate();setTimeout(function(){e.$el.window.trigger("global-modal-open",[n,void 0])},2e3)},getTemplate:function(){return(a||d?t.template(p.checkoutSessionExpiredTemplate.html()):t.template(p.sessionExpiredTemplate.html()))({})},setPageType:function(){d=e.$el.body.hasClass("checkout-page"),l=e.$el.body.hasClass("account-page")},setCartVars:function(){t.isEmpty(window.shoppingCart)?(console.error("window.shoppingCart does not exist."),a=!1):a=window.shoppingCart.TotalProducts>0},startSessionWarning:function(){g.clearExistingTimeout(),"true"===e.$el.body.attr("data-session-active")&&"logged in"===e.$el.body.attr("data-user-authentication-status")&&(r=i().add(parseInt(e.$el.body.attr("data-session-time"),10),"m"),g.checkForSessionWarning())},checkForSessionWarning:function(){if(r){var e=i();g.clearExistingTimeout(),e.isSame(r)||e.isAfter(r)?(r=void 0,g.signoutAndRedirect()):c=setTimeout(g.checkForSessionWarning,6e4)}},setRedirectUrl:function(){u=a||d?p.cartNav.attr("href")+"?sessionExpired":"/?sessionExpired"},signoutAndRedirect:function(){o.logOut({},function(e){!0===e.success?window.location.href=d||l||a?u:"?sessionExpired":console.error("restApi.logOut response: ",e.error)})},openSessionExpiredModal:function(){if("sessionExpired"in s.getQueryStringParameters()){g.openModal();var e=window.location.toString();if(e.indexOf("?")>0){var n=e.substring(0,e.indexOf("?"));window.history.replaceState({},document.title,n)}}}},f={init:function(){g.cacheJQueryElements(),g.setPageType(),g.openSessionExpiredModal(),f.bindEvents(),g.startSessionWarning()},bindEvents:function(){e.$el.window.on("page-visibility-shown",g.checkForSessionWarning),e.$el.window.on("session-extended",g.startSessionWarning),e.$el.window.on("win.sc_load",function(){g.setCartVars(),g.setRedirectUrl()}),e.$el.window.on("cart-count-update",function(){g.setCartVars(),g.checkForSessionWarning()}),e.$el.globalModal.on("click",".session_expired_modal__button",function(e){e.preventDefault(),g.closeModal()})}};n(function(){return f.init()})});
//# sourceMappingURL=sessionExpiredModal.js.map
