!function e(t,a,i){function n(r,s){if(!a[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(o)return o(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var l=a[r]={exports:{}};t[r][0].call(l.exports,function(e){var a=t[r][1][e];return n(a?a:e)},l,l.exports,e,t,a,i)}return a[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}({1:[function(e,t,a){function i(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}function n(e,t,a){}function o(e,t,a){}function r(e,t,a){}function s(e,t,a){}function c(e){return e.replace(T,"&lt;").replace(I,"&gt;")}function d(e,t,a,i){if(a=g(a),"href"===t||"src"===t){if(a=k.trim(a),"#"===a)return"#";if("http://"!==a.substr(0,7)&&"https://"!==a.substr(0,8)&&"mailto:"!==a.substr(0,7)&&"tel:"!==a.substr(0,4)&&"#"!==a[0]&&"/"!==a[0])return""}else if("background"===t){if(R.lastIndex=0,R.test(a))return""}else if("style"===t){if(D.lastIndex=0,D.test(a))return"";if(N.lastIndex=0,N.test(a)&&(R.lastIndex=0,R.test(a)))return"";i!==!1&&(i=i||j,a=i.process(a))}return a=f(a)}function l(e){return e.replace(S,"&quot;")}function u(e){return e.replace(C,'"')}function p(e){return e.replace(E,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})}function m(e){return e.replace(M,":").replace(A," ")}function h(e){for(var t="",a=0,i=e.length;a<i;a++)t+=e.charCodeAt(a)<32?" ":e.charAt(a);return k.trim(t)}function g(e){return e=u(e),e=p(e),e=m(e),e=h(e)}function f(e){return e=l(e),e=c(e)}function v(){return""}function b(e,t){function a(t){return!!i||k.indexOf(e,t)!==-1}"function"!=typeof t&&(t=function(){});var i=!Array.isArray(e),n=[],o=!1;return{onIgnoreTag:function(e,i,r){if(a(e)){if(r.isClosing){var s="[/removed]",c=r.position+s.length;return n.push([o!==!1?o:r.position,c]),o=!1,s}return o||(o=r.position),"[removed]"}return t(e,i,r)},remove:function(e){var t="",a=0;return k.forEach(n,function(i){t+=e.slice(a,i[0]),a=i[1]}),t+=e.slice(a)}}}function w(e){return e.replace(O,"")}function y(e){var t=e.split("");return t=t.filter(function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}),t.join("")}var x=e("cssfilter").FilterCSS,_=e("cssfilter").getDefaultWhiteList,k=e("./util"),j=new x,T=/</g,I=/>/g,S=/"/g,C=/&quot;/g,E=/&#([a-zA-Z0-9]*);?/gim,M=/&colon;?/gim,A=/&newline;?/gim,R=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,D=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,N=/u\s*r\s*l\s*\(.*/gi,O=/<!--[\s\S]*?-->/g;a.whiteList=i(),a.getDefaultWhiteList=i,a.onTag=n,a.onIgnoreTag=o,a.onTagAttr=r,a.onIgnoreTagAttr=s,a.safeAttrValue=d,a.escapeHtml=c,a.escapeQuote=l,a.unescapeQuote=u,a.escapeHtmlEntities=p,a.escapeDangerHtml5Entities=m,a.clearNonPrintableCharacter=h,a.friendlyAttrValue=g,a.escapeAttrValue=f,a.onIgnoreTagStripAll=v,a.StripTagBody=b,a.stripCommentTag=w,a.stripBlankChar=y,a.cssFilter=j,a.getDefaultCSSWhiteList=_},{"./util":4,cssfilter:8}],2:[function(e,t,a){function i(e,t){var a=new s(t);return a.process(e)}function n(){return"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope}var o=e("./default"),r=e("./parser"),s=e("./xss");a=t.exports=i,a.filterXSS=i,a.FilterXSS=s;for(var c in o)a[c]=o[c];for(var c in r)a[c]=r[c];"undefined"!=typeof window&&(window.filterXSS=t.exports),n()&&(self.filterXSS=t.exports)},{"./default":1,"./parser":3,"./xss":5}],3:[function(e,t,a){function i(e){var t=u.spaceIndex(e);if(t===-1)var a=e.slice(1,-1);else var a=e.slice(1,t+1);return a=u.trim(a).toLowerCase(),"/"===a.slice(0,1)&&(a=a.slice(1)),"/"===a.slice(-1)&&(a=a.slice(0,-1)),a}function n(e){return"</"===e.slice(0,2)}function o(e,t,a){"user strict";var o="",r=0,s=!1,c=!1,d=0,l=e.length,u="",p="";for(d=0;d<l;d++){var m=e.charAt(d);if(s===!1){if("<"===m){s=d;continue}}else if(c===!1){if("<"===m){o+=a(e.slice(r,d)),s=d,r=d;continue}if(">"===m){o+=a(e.slice(r,s)),p=e.slice(s,d+1),u=i(p),o+=t(s,o.length,u,p,n(p)),r=d+1,s=!1;continue}if(('"'===m||"'"===m)&&"="===e.charAt(d-1)){c=m;continue}}else if(m===c){c=!1;continue}}return r<e.length&&(o+=a(e.substr(r))),o}function r(e,t){"user strict";function a(e,a){if(e=u.trim(e),e=e.replace(p,"").toLowerCase(),!(e.length<1)){var i=t(e,a||"");i&&n.push(i)}}for(var i=0,n=[],o=!1,r=e.length,d=0;d<r;d++){var m,h,g=e.charAt(d);if(o!==!1||"="!==g)if(o===!1||d!==i||'"'!==g&&"'"!==g||"="!==e.charAt(d-1))if(/\s|\n|\t/.test(g)){if(e=e.replace(/\s|\n|\t/g," "),o===!1){if(h=s(e,d),h===-1){m=u.trim(e.slice(i,d)),a(m),o=!1,i=d+1;continue}d=h-1;continue}if(h=c(e,d-1),h===-1){m=u.trim(e.slice(i,d)),m=l(m),a(o,m),o=!1,i=d+1;continue}}else;else{if(h=e.indexOf(g,d+1),h===-1)break;m=u.trim(e.slice(i+1,h)),a(o,m),o=!1,d=h,i=d+1}else o=e.slice(i,d),i=d+1}return i<e.length&&(o===!1?a(e.slice(i)):a(o,l(u.trim(e.slice(i))))),u.trim(n.join(" "))}function s(e,t){for(;t<e.length;t++){var a=e[t];if(" "!==a)return"="===a?t:-1}}function c(e,t){for(;t>0;t--){var a=e[t];if(" "!==a)return"="===a?t:-1}}function d(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}function l(e){return d(e)?e.substr(1,e.length-2):e}var u=e("./util"),p=/[^a-zA-Z0-9_:\.\-]/gim;a.parseTag=o,a.parseAttr=r},{"./util":4}],4:[function(e,t,a){t.exports={indexOf:function(e,t){var a,i;if(Array.prototype.indexOf)return e.indexOf(t);for(a=0,i=e.length;a<i;a++)if(e[a]===t)return a;return-1},forEach:function(e,t,a){var i,n;if(Array.prototype.forEach)return e.forEach(t,a);for(i=0,n=e.length;i<n;i++)t.call(a,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,a=t.exec(e);return a?a.index:-1}}},{}],5:[function(e,t,a){function i(e){return void 0===e||null===e}function n(e){var t=p.spaceIndex(e);if(t===-1)return{html:"",closing:"/"===e[e.length-2]};e=p.trim(e.slice(t+1,-1));var a="/"===e[e.length-1];return a&&(e=p.trim(e.slice(0,-1))),{html:e,closing:a}}function o(e){var t={};for(var a in e)t[a]=e[a];return t}function r(e){e=o(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag,e.onIgnoreTag=c.onIgnoreTagStripAll),e.whiteList=e.whiteList||c.whiteList,e.onTag=e.onTag||c.onTag,e.onTagAttr=e.onTagAttr||c.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||c.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||c.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||c.safeAttrValue,e.escapeHtml=e.escapeHtml||c.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new s(e.css))}var s=e("cssfilter").FilterCSS,c=e("./default"),d=e("./parser"),l=d.parseTag,u=d.parseAttr,p=e("./util");r.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,a=t.options,o=a.whiteList,r=a.onTag,s=a.onIgnoreTag,d=a.onTagAttr,m=a.onIgnoreTagAttr,h=a.safeAttrValue,g=a.escapeHtml,f=t.cssFilter;a.stripBlankChar&&(e=c.stripBlankChar(e)),a.allowCommentTag||(e=c.stripCommentTag(e));var v=!1;if(a.stripIgnoreTagBody){var v=c.StripTagBody(a.stripIgnoreTagBody,s);s=v.onIgnoreTag}var b=l(e,function(e,t,a,c,l){var v={sourcePosition:e,position:t,isClosing:l,isWhite:o.hasOwnProperty(a)},b=r(a,c,v);if(!i(b))return b;if(v.isWhite){if(v.isClosing)return"</"+a+">";var w=n(c),y=o[a],x=u(w.html,function(e,t){var n=p.indexOf(y,e)!==-1,o=d(a,e,t,n);if(!i(o))return o;if(n)return t=h(a,e,t,f),t?e+'="'+t+'"':e;var o=m(a,e,t,n);return i(o)?void 0:o}),c="<"+a;return x&&(c+=" "+x),w.closing&&(c+=" /"),c+=">"}var b=s(a,c,v);return i(b)?g(c):b},g);return v&&(b=v.remove(b)),b},t.exports=r},{"./default":1,"./parser":3,"./util":4,cssfilter:8}],6:[function(e,t,a){function i(e){return void 0===e||null===e}function n(e){var t={};for(var a in e)t[a]=e[a];return t}function o(e){e=n(e||{}),e.whiteList=e.whiteList||r.whiteList,e.onAttr=e.onAttr||r.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||r.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||r.safeAttrValue,this.options=e}var r=e("./default"),s=e("./parser");e("./util");o.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,a=t.options,n=a.whiteList,o=a.onAttr,r=a.onIgnoreAttr,c=a.safeAttrValue,d=s(e,function(e,t,a,s,d){var l=n[a],u=!1;if(l===!0?u=l:"function"==typeof l?u=l(s):l instanceof RegExp&&(u=l.test(s)),u!==!0&&(u=!1),s=c(a,s)){var p={position:t,sourcePosition:e,source:d,isWhite:u};if(u){var m=o(a,s,p);return i(m)?a+":"+s:m}var m=r(a,s,p);return i(m)?void 0:m}});return d},t.exports=o},{"./default":7,"./parser":9,"./util":10}],7:[function(e,t,a){function i(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function n(e,t,a){}function o(e,t,a){}function r(e,t){return s.test(t)?"":t}var s=/javascript\s*\:/gim;a.whiteList=i(),a.getDefaultWhiteList=i,a.onAttr=n,a.onIgnoreAttr=o,a.safeAttrValue=r},{}],8:[function(e,t,a){function i(e,t){var a=new o(t);return a.process(e)}var n=e("./default"),o=e("./css");a=t.exports=i,a.FilterCSS=o;for(var r in n)a[r]=n[r];"undefined"!=typeof window&&(window.filterCSS=t.exports)},{"./css":6,"./default":7}],9:[function(e,t,a){function i(e,t){function a(){if(!o){var a=n.trim(e.slice(r,s)),i=a.indexOf(":");if(i!==-1){var d=n.trim(a.slice(0,i)),l=n.trim(a.slice(i+1));if(d){var u=t(r,c.length,d,l,a);u&&(c+=u+"; ")}}}r=s+1}e=n.trimRight(e),";"!==e[e.length-1]&&(e+=";");for(var i=e.length,o=!1,r=0,s=0,c="";s<i;s++){var d=e[s];if("/"===d&&"*"===e[s+1]){var l=e.indexOf("*/",s+2);if(l===-1)break;s=l+1,r=s+1,o=!1}else"("===d?o=!0:")"===d?o=!1:";"===d?o||a():"\n"===d&&a()}return n.trim(c)}var n=e("./util");t.exports=i},{"./util":10}],10:[function(e,t,a){t.exports={indexOf:function(e,t){var a,i;if(Array.prototype.indexOf)return e.indexOf(t);for(a=0,i=e.length;a<i;a++)if(e[a]===t)return a;return-1},forEach:function(e,t,a){var i,n;if(Array.prototype.forEach)return e.forEach(t,a);for(i=0,n=e.length;i<n;i++)t.call(a,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}}},{}]},{},[2]),function(){function e(e,t){this.imInstance=t,this.id=e.conv_id,this.type=e.conv_type,this.title=e.conv_title,this.subtitle=e.conv_subtitle,this.avatar=e.conv_avatar,this.readMsgId=e.read_msg_id,this.mTime=e.mtime,this.peer=e.peer,this.summary=e.summary,Object.defineProperty(this,"_originalObject",{value:e,enumerable:!1})}function t(e,t){this.imInstance=t,this.convId=e.msg.conv_id,this.convType=e.msg.conv_type,this.fromUcid=e.msg.from_ucid,this.id=e.msg.msg_id,this.localId=e.msg.msg_local_id,this.payload=e.msg.msg_payload,this.type=e.msg.msg_type,this.sendTime=e.msg.send_time,this.seq=e.seq,this.summary=e.msg.msg_summary,Object.defineProperty(this,"_originalObject",{value:e,enumerable:!1})}function a(){this._listener={}}function i(e){if(this._events=new a,this.appkey=e.appkey,this.msgApiRoot=e.msgApiRoot,this.mediaApiRoot=e.mediaApiRoot,this.configHeader=e.apiheader,this.ucid=e.ucid,this.port=null,this.extAttr=null,this.convMap={},this.currentSeq=-1,this.msgTimer=0,this.msgTimerLevel=0,this.initMsgWindow={},this.triggerSyncTimer=null,this.state=0,!this.appkey)throw new Error("IM need appkey")}!function(e){"use strict";function t(e,t){var a=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(a>>16);return i<<16|65535&a}function a(e,t){return e<<t|e>>>32-t}function i(e,i,n,o,r,s){return t(a(t(t(i,e),t(o,s)),r),n)}function n(e,t,a,n,o,r,s){return i(t&a|~t&n,e,t,o,r,s)}function o(e,t,a,n,o,r,s){return i(t&n|a&~n,e,t,o,r,s)}function r(e,t,a,n,o,r,s){return i(t^a^n,e,t,o,r,s)}function s(e,t,a,n,o,r,s){return i(a^(t|~n),e,t,o,r,s)}function c(e,a){e[a>>5]|=128<<a%32,e[(a+64>>>9<<4)+14]=a;var i,c,d,l,u,p=1732584193,m=-271733879,h=-1732584194,g=271733878;for(i=0;i<e.length;i+=16)c=p,d=m,l=h,u=g,p=n(p,m,h,g,e[i],7,-680876936),g=n(g,p,m,h,e[i+1],12,-389564586),h=n(h,g,p,m,e[i+2],17,606105819),m=n(m,h,g,p,e[i+3],22,-1044525330),p=n(p,m,h,g,e[i+4],7,-176418897),g=n(g,p,m,h,e[i+5],12,1200080426),h=n(h,g,p,m,e[i+6],17,-1473231341),m=n(m,h,g,p,e[i+7],22,-45705983),p=n(p,m,h,g,e[i+8],7,1770035416),g=n(g,p,m,h,e[i+9],12,-1958414417),h=n(h,g,p,m,e[i+10],17,-42063),m=n(m,h,g,p,e[i+11],22,-1990404162),p=n(p,m,h,g,e[i+12],7,1804603682),g=n(g,p,m,h,e[i+13],12,-40341101),h=n(h,g,p,m,e[i+14],17,-1502002290),m=n(m,h,g,p,e[i+15],22,1236535329),p=o(p,m,h,g,e[i+1],5,-165796510),g=o(g,p,m,h,e[i+6],9,-1069501632),h=o(h,g,p,m,e[i+11],14,643717713),m=o(m,h,g,p,e[i],20,-373897302),p=o(p,m,h,g,e[i+5],5,-701558691),g=o(g,p,m,h,e[i+10],9,38016083),h=o(h,g,p,m,e[i+15],14,-660478335),m=o(m,h,g,p,e[i+4],20,-405537848),p=o(p,m,h,g,e[i+9],5,568446438),g=o(g,p,m,h,e[i+14],9,-1019803690),h=o(h,g,p,m,e[i+3],14,-187363961),m=o(m,h,g,p,e[i+8],20,1163531501),p=o(p,m,h,g,e[i+13],5,-1444681467),g=o(g,p,m,h,e[i+2],9,-51403784),h=o(h,g,p,m,e[i+7],14,1735328473),m=o(m,h,g,p,e[i+12],20,-1926607734),p=r(p,m,h,g,e[i+5],4,-378558),g=r(g,p,m,h,e[i+8],11,-2022574463),h=r(h,g,p,m,e[i+11],16,1839030562),m=r(m,h,g,p,e[i+14],23,-35309556),p=r(p,m,h,g,e[i+1],4,-1530992060),g=r(g,p,m,h,e[i+4],11,1272893353),h=r(h,g,p,m,e[i+7],16,-155497632),m=r(m,h,g,p,e[i+10],23,-1094730640),p=r(p,m,h,g,e[i+13],4,681279174),g=r(g,p,m,h,e[i],11,-358537222),h=r(h,g,p,m,e[i+3],16,-722521979),m=r(m,h,g,p,e[i+6],23,76029189),p=r(p,m,h,g,e[i+9],4,-640364487),g=r(g,p,m,h,e[i+12],11,-421815835),h=r(h,g,p,m,e[i+15],16,530742520),m=r(m,h,g,p,e[i+2],23,-995338651),p=s(p,m,h,g,e[i],6,-198630844),g=s(g,p,m,h,e[i+7],10,1126891415),h=s(h,g,p,m,e[i+14],15,-1416354905),m=s(m,h,g,p,e[i+5],21,-57434055),p=s(p,m,h,g,e[i+12],6,1700485571),g=s(g,p,m,h,e[i+3],10,-1894986606),h=s(h,g,p,m,e[i+10],15,-1051523),m=s(m,h,g,p,e[i+1],21,-2054922799),p=s(p,m,h,g,e[i+8],6,1873313359),g=s(g,p,m,h,e[i+15],10,-30611744),h=s(h,g,p,m,e[i+6],15,-1560198380),m=s(m,h,g,p,e[i+13],21,1309151649),p=s(p,m,h,g,e[i+4],6,-145523070),g=s(g,p,m,h,e[i+11],10,-1120210379),h=s(h,g,p,m,e[i+2],15,718787259),m=s(m,h,g,p,e[i+9],21,-343485551),p=t(p,c),m=t(m,d),h=t(h,l),g=t(g,u);return[p,m,h,g]}function d(e){var t,a="",i=32*e.length;for(t=0;i>t;t+=8)a+=String.fromCharCode(e[t>>5]>>>t%32&255);return a}function l(e){var t,a=[];for(a[(e.length>>2)-1]=void 0,t=0;t<a.length;t+=1)a[t]=0;var i=8*e.length;for(t=0;i>t;t+=8)a[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return a}function u(e){return d(c(l(e),8*e.length))}function p(e,t){var a,i,n=l(e),o=[],r=[];for(o[15]=r[15]=void 0,n.length>16&&(n=c(n,8*e.length)),a=0;16>a;a+=1)o[a]=909522486^n[a],r[a]=1549556828^n[a];return i=c(o.concat(l(t)),512+8*t.length),d(c(r.concat(i),640))}function m(e){var t,a,i="0123456789abcdef",n="";for(a=0;a<e.length;a+=1)t=e.charCodeAt(a),n+=i.charAt(t>>>4&15)+i.charAt(15&t);return n}function h(e){return unescape(encodeURIComponent(e))}function g(e){return u(h(e))}function f(e){return m(g(e))}function v(e,t){return p(h(e),h(t))}function b(e,t){return m(v(e,t))}function w(e,t,a){return t?a?v(t,e):b(t,e):a?g(e):f(e)}e.md5=w}(this);var n={timeOffset:0,noop:function(){},makeRequestHeader:function(e,t,a){function i(e){var t=[];return $.each(e,function(e,a){t.push(e+"="+a)}),t.sort(),t.join("&")}var n={},o={},r="";return o=$.extend({"Lianjia-Access-Token":e["Lianjia-Access-Token"]||"1","Lianjia-Device-Id":e.uuid||"","Lianjia-Im-Timestamp":(new Date).getTime()-this.timeOffset},e),n=$.extend(n,o),n=$.extend(n,t),delete n["Lianjia-Uuid"],r=i(n),o["Lianjia-Im-Signature"]=md5(r+a),o}};e.prototype={constructor:e,fetchDetail:function(e){var t=this;e=e||n.noop;var a={conv_id:this.id};$.ajax({url:this.imInstance.msgApiRoot+"/conv/detail/fetch",headers:n.makeRequestHeader(this.imInstance.configHeader,a,this.imInstance.appkey),data:a,dataType:"json",method:"GET",xhrFields:{withCredentials:!0},cache:!0,success:function(a){if(0!==a.errno)throw e(null,t),new Error(a.error);e(a.data,t)},error:function(){throw e(null,t),new Error("/conv/detail/fetch ajax fail.")}})},updateDetail:function(){var e=this;({conv_id:this.id});this.fetchDetail(function(t){e.id=t.conv_id,e.type=t.conv_type,e.title=t.conv_title,e.subtitle=t.conv_subtitle,e.avatar=t.conv_avatar,e.readMsgId=t.read_msg_id,e.mTime=t.mtime,e.peer=t.peer,e.summary=t.summary})}},t.prototype={constructor:t},a.prototype={constructor:a,addListener:function(e,t){"undefined"==typeof this._listener[e]&&(this._listener[e]=[]),"function"==typeof t&&this._listener[e].push(t)},removeListener:function(e,t){var a=this._listener[e];if("function"==typeof t)for(var i=0,n=a.length;i<n;i++)t===a[i]&&a.splice(i,1);else"undefined"==typeof t&&delete this._listener[e]},fireEvent:function(e,t,a){var i=this._listener[e],n=[{type:e,target:a,param:t}];if(i)for(var o=0,r=i.length;o<r;o++)"function"==typeof i[o]&&(t instanceof Array&&(n=n.concat(t)),i[o].apply(this,n))}},i.prototype={constructor:i,initialize:function(){function e(){$.ajax({url:a.msgApiRoot+"/config/sync",headers:n.makeRequestHeader(a.configHeader,{},a.appkey),data:{},dataType:"json",method:"GET",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw t(),new Error(e.error);t(e.data.poll.windows)},error:function(){throw t(),new Error("/config/sync ajax fail.")}})}function t(e){a.initMsgWindow=e||[{interval:3,count:10},{interval:6,count:10},{interval:15,count:8},{interval:30,count:4},{interval:60,count:-1}],a.syncConv(0,100,function(e){a.state=1,a.fire("init",[a]),a.triggerSyncMsg(a.currentSeq)})}var a=this;$.ajax({url:this.msgApiRoot+"/time/sync",headers:n.makeRequestHeader(this.configHeader,{},this.appkey),data:{},dataType:"json",method:"GET",xhrFields:{withCredentials:!0},cache:!0,success:function(t){if(0!==t.errno)throw n.timeOffset=0,e(),new Error(t.error);n.timeOffset=Math.round(+new Date-t.data.timestamp),a.timeOffset=n.timeOffset,e()},error:function(){throw n.timeOffset=0,e(),new Error("/time/sync ajax fail.")}}),/^(http|https)?:\/\/\w+\.lianjia\.com/.test(location.href)||"1"===this.configHeader["Lianjia-Access-Token"]||$.ajax({url:this.mediaApiRoot+"/cookie",headers:n.makeRequestHeader(this.configHeader,{},this.appkey),data:{},dataType:"json",method:"GET",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw new Error(e.error)},error:function(){throw new Error("/cookie ajax fail.")}})},syncConv:function(t,a,i){function o(t,a,i){var o=arguments.callee,s={offset:t,limit:a};$.ajax({url:r.msgApiRoot+"/user/conv/list",headers:n.makeRequestHeader(r.configHeader,s,r.appkey),data:s,dataType:"json",method:"GET",xhrFields:{withCredentials:!0},cache:!0,success:function(n){if(0!==n.errno)throw i(null,r),new Error(n.error);$.each(n.data.list,function(){r.convMap[this.conv_id]=new e(this,r)}),t+n.data.list.length<n.data.total_count&&n.data.list.length>0?o(t+a,a,i):i(r.convMap,r)},error:function(){throw i(null,r),new Error("/user/conv/list ajax fail.")}})}var r=this;i=i||n.noop,o(t,a,i)},syncMsg:function(a){function i(a){clearTimeout(o.msgTimer);var i={},s=arguments.callee;a===-1?(i.rev_seq=a,i.seq=0):i.seq=a;$.ajax({url:o.msgApiRoot+"/msg/sync",headers:n.makeRequestHeader(o.configHeader,i,o.appkey),data:i,dataType:"json",method:"GET",xhrFields:{withCredentials:!0},timeout:1e4,cache:!0,success:function(i){if(0!==i.errno)throw o.msgTimer=setTimeout(function(){s(o.currentSeq)},1e3*o.initMsgWindow[o.msgTimerLevel].interval),new Error(i.error);if(i.data.list.length>0){o.currentSeq=i.data.list[i.data.list.length-1].seq;var n=[],c=[],d=[];$.each(i.data.list,function(){var a=new t(this,o);switch(o.convMap[a.convId]||0===a.convId||(o.convMap[a.convId]={},o.fetchConversation(a.convId,function(t){t&&(o.convMap[a.convId]=new e(t,o))})),a.type){case 100:c.push(a);break;case 101:d.push(a);break;default:n.push(a)}}),n.length>0&&o.fire("message",[n,a]),c.length>0&&o.fire("arrive",[c,a]),d.length>0&&o.fire("read",[d,a]),r=0,o.msgTimerLevel=0}1===i.data.has_more?s(o.currentSeq):(o.initMsgWindow[o.msgTimerLevel].count===-1?r=0:r>=o.initMsgWindow[o.msgTimerLevel].count&&(r=0,o.msgTimerLevel=Math.min(o.msgTimerLevel+1,o.initMsgWindow.length-1)),r++,o.msgTimer=setTimeout(function(){s(o.currentSeq)},1e3*o.initMsgWindow[o.msgTimerLevel].interval)),a===-1&&o.fire("start",[o])},error:function(){throw o.msgTimer=setTimeout(function(){s(o.currentSeq)},1e3*o.initMsgWindow[o.msgTimerLevel].interval),new Error("/msg/sync ajax fail.")}})}var o=this;this.msgTimerLevel=0;var r=0;i(a)},triggerSyncMsg:function(e){var t=this;this.triggerSyncTimer&&clearTimeout(this.triggerSyncTimer),this.triggerSyncTimer=setTimeout(function(){t.syncMsg(e)},100)},create:function(t,a,i){var o=this,r="",s={};if(i=i||n.noop,t instanceof Array){if(t.length>1)throw new Error("Error #42002: conv_type === 1 only allow 2 members. Please see http://wiki.lianjia.com/pages/viewpage.action?pageId=9899018 .");r=t.join(",")}else r=t;if(r===this.ucid)throw new Error("Error #42003: conv_type === 1 can't talk to self. Please see http://wiki.lianjia.com/pages/viewpage.action?pageId=9899018 .");1===a?(s={members:t,conv_type:a},$.ajax({url:o.msgApiRoot+"/conv/create",headers:n.makeRequestHeader(this.configHeader,s,this.appkey),data:s,dataType:"json",method:"POST",xhrFields:{withCredentials:!0},cache:!0,success:function(t){if(0!==t.errno)throw i(null,o),new Error(t.error);var a=new e(t.data,o);o.convMap[a.id]=a,i(a,o)},error:function(){throw i(null,o),new Error("/conv/create ajax fail.")}})):(s={members:r,conv_type:a},$.ajax({url:o.msgApiRoot+"/conv/create",headers:n.makeRequestHeader(this.configHeader,s,this.appkey),data:s,dataType:"json",method:"POST",xhrFields:{withCredentials:!0},cache:!0,success:function(t){if(0!==t.errno)throw i(null,o),new Error(t.error);var a=new e(t.data,o);o.convMap[a.id]=a,i(a,o)},error:function(){throw i(null,o),new Error("/conv/create ajax fail.")}}))},convEnter:function(e){var t=this,a={conv_id:e,msg_attr:JSON.stringify({biz_src:Object.assign({},{port:t.port},t.extAttr)})};e&&$.ajax({url:t.msgApiRoot+"/conv/enter",headers:n.makeRequestHeader(this.configHeader,a,this.appkey),data:a,dataType:"json",method:"POST",success:function(e){},error:function(e){throw new Error("/conv/enter ajax fail.")}})},recallMsg:function(e){if(e&&e.conv_id&&e.msg_id){var t={conv_id:e.conv_id,msg_id:e.msg_id};$.ajax({url:this.msgApiRoot+"/msg/recall",headers:n.makeRequestHeader(this.configHeader,t,this.appkey),data:t,dataType:"json",method:"POST",success:function(t){cb=e.callback,0===t.errno?cb&&cb(t.data):cb&&cb()},error:function(e){}})}},talkTo:function(e,t,a){var i=this;a=a||n.noop,this.getTalk(e,function(n){n?i.sendTo(n.id,t,a):i.create(e,1,function(e){i.sendTo(e.id,t,a)})})},get330card:function(e,t){$.ajax({url:this.msgApiRoot+"/card",headers:n.makeRequestHeader(this.configHeader,e,this.appkey),data:e,dataType:"json",method:"get",contentType:"application/x-www-form-urlencoded",xhrFields:{withCredentials:!0},success:function(e){0===e.errno&&t(e)}})},send330:function(e,t,a){var i=this,o={conv_id:e,msg_local_id:t.localId||+new Date,msg_type:t.type,msg_payload:t.payload},r="";(i.port||i.extAttr)&&(r=JSON.stringify({biz_src:Object.assign({},{port:i.port},i.extAttr)})),r&&(o.msg_attr=r),a=a||n.noop,$.ajax({url:this.msgApiRoot+"/msg/send",headers:n.makeRequestHeader(this.configHeader,o,this.appkey),data:o,dataType:"json",method:"POST",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw a(null,i),new Error(e.error);a(e)},error:function(){throw a(null,i),new Error("/msg/send ajax fail.")}})},sendTo:function(e,a,i){var o=this,r={conv_id:e,msg_local_id:a.localId||+new Date,msg_type:a.type,msg_payload:a.payload},s="";(o.port||o.extAttr)&&(s=JSON.stringify({biz_src:Object.assign({},{port:o.port},o.extAttr)})),s&&(r.msg_attr=s),i=i||n.noop,$.ajax({url:this.msgApiRoot+"/msg/send",headers:n.makeRequestHeader(this.configHeader,r,this.appkey),data:r,dataType:"json",method:"POST",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw i(null,o,e),new Error(e.error);var n=new t({msg:{conv_id:e.data.conv_id,msg_id:e.data.msg_id,msg_local_id:e.data.msg_local_id,send_time:e.data.send_time,from_ucid:o.ucid,msg_payload:a.payload,msg_type:a.type},seq:-1},o);i(n,o),o.triggerSyncMsg(o.currentSeq)},error:function(){throw i(null,o),new Error("/msg/send ajax fail.");
}})},uploadPicture:function(e,t,a){var i=this,o=new FormData;o.append("conv_id",e),o.append("image",t),$.ajax({url:this.mediaApiRoot+"/image/upload",headers:n.makeRequestHeader(this.configHeader,{},this.appkey),data:o,dataType:"json",processData:!1,contentType:!1,method:"POST",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw a(null,i),new Error(e.error);a(JSON.stringify(e.data),i)},error:function(){throw a(null,i),new Error("/image/upload ajax fail.")}})},markRead:function(e,t){var a=this,i={conv_id:e.convId,msg_id:e.id};t=t||n.noop,$.ajax({url:this.msgApiRoot+"/msg/read",headers:n.makeRequestHeader(this.configHeader,i,this.appkey),data:i,dataType:"json",method:"POST",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw t(null,a),new Error(e.error);t(e.data,a)},error:function(){throw t(null,a),new Error("/msg/read ajax fail.")}})},fetchConversation:function(e,t){var a=this,i={conv_id:e};t=t||n.noop,$.ajax({url:this.msgApiRoot+"/conv/detail/fetch",headers:n.makeRequestHeader(this.configHeader,i,this.appkey),data:i,dataType:"json",method:"GET",async:!1,xhrFields:{withCredentials:!0},cache:!0,success:function(i){if(0!==i.errno)throw t(null,a),new Error(i.error+" convId: "+e);t(i.data,a)},error:function(){throw t(null,a),new Error("/conv/detail/fetch ajax fail.")}})},getTalk:function(e,t){var a=this;t=t||n.noop;var i=null;$.each(this.convMap,function(){var t=this;if(1===t.conv_type&&t.peer.ucid===e)return i=this,!1}),t(i,a)},getHistory:function(e,a){var i=this;a=a||n.noop,$.ajax({url:this.msgApiRoot+"/msg/list",headers:n.makeRequestHeader(this.configHeader,e,this.appkey),data:e,dataType:"json",method:"GET",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw a(null,i),new Error(e.error);var n=e.data.list,o=[];$.each(n,function(){o.push(new t({msg:this},i))}),a(o,i)},error:function(){throw a(null,i),new Error("/msg/list ajax fail.")}})},accuse:function(e,t){var a=this,i=e;t=t||n.noop,$.ajax({url:this.msgApiRoot+"/guangsha/report",headers:n.makeRequestHeader(this.configHeader,i,this.appkey),data:i,dataType:"json",method:"POST",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw t(null,a),new Error(e.error);t(e)},error:function(){throw t(null,a),new Error("/guangsha/report ajax fail.")}})},fetchReportStatus:function(e,t){var a=this,i={conv_id:e};t=t||n.noop,$.ajax({url:this.msgApiRoot+"/user/status/fetch",headers:n.makeRequestHeader(this.configHeader,i,this.appkey),data:i,dataType:"json",method:"GET",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw t(null,a),new Error(e.error);t(e)},error:function(){throw t(null,a),new Error("/guangsha/report ajax fail.")}})},getUsersInfo:function(e,t){var a=this;t=t||n.noop,$.ajax({url:this.msgApiRoot+"/user/detail/fetch",headers:n.makeRequestHeader(this.configHeader,e,this.appkey),data:e,dataType:"json",method:"GET",xhrFields:{withCredentials:!0},cache:!0,success:function(e){if(0!==e.errno)throw t(null,a),new Error(e.error);t(e.data.list,a)},error:function(){throw t(null,a),new Error("/user/detail/fetch")}})},IMNotification:function(e,t){if("string"!=typeof e.title||"string"!=typeof e.body)throw new Error("opt.title and opt.body is must be string!");var a=window.Notification||window.mozNotification||window.webkitNotification,i=null,n=Date.now(),o={dir:"auto",lang:"zh-CN",tag:n,icon:e.icon,body:e.body};if(a&&("granted"===a.permission?i=new a(e.title,o):"denied"!==a.permission&&"default"!==a.permission||a.requestPermission(function(t){"granted"===t&&(i=new a(e.title,o))})),i)i.onclick=function(){window.focus()},i.onshow=function(){if("Audio"in window){var e=new Audio(t+"/static/two beat.wav");e.play()}var a=setTimeout(function(){i.close?i.close():i.close.bind(i),clearTimeout(a)},3e3)},i.onerror=function(){},i.onclose=function(){};else if("Audio"in window){var r=new Audio(t+"/static/two beat.wav");r.play()}},encodeHtml:function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},on:function(e,t){this._events.addListener(e,t)},off:function(e,t){this._events.removeListener(e,t)},fire:function(e,t){this._events.fireEvent(e,t,this)},destory:function(){this.fire("destory",[this]),clearTimeout(this.msgTimer),delete this._events._listener}},window.ImCore=i}(),function(e,t,a){var i=a(t);"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof exports?i.exports=i:t[e]=i,window[e]=i}("LianjiaIM",this,function(){function _EventEmitter(){"use strict";function e(){}"function"!=typeof Object.create&&(Object.create=function(){var e=function(){};return function(t){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof t)throw TypeError("Argument must be an object");e.prototype=t;var a=new e;return e.prototype=null,a}}()),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=a.length;return function(n){if("object"!=typeof n&&("function"!=typeof n||null===n))throw new TypeError("Object.keys called on non-object");var o,r,s=[];for(o in n)e.call(n,o)&&s.push(o);if(t)for(r=0;r<i;r++)e.call(n,a[r])&&s.push(a[r]);return s}}()),e.extend=function(t){function a(){this&&i(this,arguments),this&&this._initialize_&&this._initialize_.apply(this,arguments)}var i=this,n=i.prototype,o=a.prototype=Object.create(n);for(var r in t){if("constructor"===r)return;var s=t[r];if("function"==typeof s&&n[r]&&"function"==typeof n[r])s=function(e,t){return function(){var a=this._super;this._super=n[e];var i=t.apply(this,arguments);return this._super=a,i}}(r,s);else if("object"==typeof s&&n[r]&&"object"==typeof n[r])for(var c in n[r])s[c]||(s[c]=n[r][c]);o[r]=s}return a.extend=e.extend,a};var t=e.extend({_initialize_:function(e){var t=this;t._eventList={},t._eventTriggerd_={},this.initialize&&this.initialize.apply(this,arguments),this._promise_="boolean"==typeof e&&e},on:function(e,t){if(!e||!t)throw"type of fn is required";var a=this,i=a._eventList[e];i||(i=[],a._eventList[e]=i),i.push(t)},off:function(e,t){var a=this;if(!e)return void(a._eventList={});var i=a._eventList[e];if(i&&i.length){if(!t){for(;i.pop(););return}for(var n=0,o=i.length;n<o;n++)if(i[n]==t||i[n]==t.fn)return void i.splice(n,1)}},trigger:function(e){if(e){var t=this,a=Array.prototype.slice.call(arguments,1);t._promise_&&(t._eventTriggerd_[e]=a);var i=t._eventList[e];if(i&&i.length)for(var n=0;n<i.length;n++)if(i[n].apply(t,a)===!1)return!1}},before:function(e,t){var a,i=this;return function(){return--e>0?a=t.apply(i,arguments):t=null,a}},once:function(e,t){var a=this;e&&t&&a.on(e,a.before(2,t))},destroy:function(){var e=this;e._eventList=null},always:function(e,t){var a=this;a.on(e,t),a._eventTriggerd_[e]&&t.apply(null,a._eventTriggerd_[e])}});return t}function _Trans(){function e(t){if(!(this instanceof e))return new e(t);var a={url:"",method:"get",dataType:"json",validateCode:!0,args:{},type:"ajax"};this.opt=$.extend(a,t),"jsonp"==this.opt.type&&(this.opt.dataType="jsonp")}return $.extend(e.prototype,{request:function(e,t){var a={success:$.noop,fail:$.noop,timeout:$.noop,timeout:15e3};$.extend(a,t);var i=$.Deferred(),n=this;$.extend(n.opt.args,e);$.ajax({url:n.opt.url,type:n.opt.method,dataType:n.opt.dataType,data:n.opt.args,timeout:n.opt.timeout}).success(function(e){if(n.opt.validateCode===!0&&e&&"code"in e){if(1!=e.code)return void i.reject(e);if(e.code==-1)return void($.listener&&$.listener.trigger("unlogin"));e.data&&!$.isArray(e.data)&&(e=e.data)}i.resolve(e)}).fail(function(e){i.reject(e)});return i},setArgs:function(e){$.extend(this.opt.args,e)}}),e}function _getCommonEnv(){function e(){var e=$.parseURL(location.href);a.host=e.host,a.scheme=e.scheme,a.port=e.port;var t=a.host.match(/.*\.(lianjia|ke)\.com/)[1];0===t.indexOf("dev")?a.env="dev":0===t.indexOf("test")&&(a.env="test")}function t(e){var t="";return e.scheme&&(t+=e.scheme+"://"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+="/"+e.path),e.query&&(t+="?"+e.query),e.hash&&(t+="#"+e.hash),t}var a={host:"",scheme:"",port:"",env:"online"},i={};return i.getEnv=function(){return a.env},i.fixedHost=function(e){if(!e)return a.host;var t=e.substring(0,e.indexOf("."));switch(a.env){case"dev":case"test":if(0!==t.indexOf(a.env))return a.env+e;break;case"online":}return e},i.fixedUrl=function(e,n){n=n||!1,e.indexOf("http")<0&&(e=location.protocol+e);var o=$.parseURL(e);return o.host?(!n&&(o.host=i.fixedHost(o.host)),o.port=a.port,o.scheme||(o.scheme=a.scheme)):(o.host=a.host,o.scheme=a.scheme,o.port=a.port),t(o)},i.isSameDomain=function(e){var t=$.parseURL(e);return t.host==a.host},e(),$.env=i,i}function _pushMessage(e){return function(e){var t=$.env.fixedUrl("//ajax.lianjia.com/ajax/user/favorite/getnotifynum/"),a={house_showing:{url:"//user.lianjia.com/site/seeSchedule",text:'ä½ ççæ¿æ¥ç¨æ<span class="unreadNumber">#{unread}</span>æ¡æ´æ°'},community_new_house_source:{url:"//user.lianjia.com/?filter=3",text:'ä½ å³æ³¨çå°åºæ<span class="unreadNumber">#{unread}</span>æ¡æ°ä¸'},deal:{url:"//user.lianjia.com/?filter=1",text:'ä½ å³æ³¨çæ¿æºæ<span class="unreadNumber">#{unread}</span>æ¡æäº¤'},price_changed:{url:"//user.lianjia.com/?filter=2",text:'ä½ å³æ³¨çæ¿æºæ<span class="unreadNumber">#{unread}</span>æ¡åä»·'},"search:new":{url:"//user.lianjia.com/?filter=4",text:'ä½ ä¿å­çæç´¢æ¡ä»¶æ<span class="unreadNumber">#{unread}</span>æ¡åå¨'},on_answer_insert_concern:{url:"//user.lianjia.com/site/myWenda/?filter=1",text:'æ¨å³æ³¨çé®é¢æ<span class="unreadNumber">#{unread}</span>æ¡åå¤'},on_answer_insert:{url:"//user.lianjia.com/site/myWenda/",text:'æ¨æé®çé®é¢æ<span class="unreadNumber">#{unread}</span>æ¡åå¤'},on_extra_answer_pass:{url:"//user.lianjia.com/site/myWenda/?filter=2",text:'æ¨æ¶å°<span class="unreadNumber">#{unread}</span>æ¡æ°è¿½ç­'},on_special_question_pass:{url:"//user.lianjia.com/site/myWenda/?filter=3",text:'æ¨æ¶å°<span class="unreadNumber">#{unread}</span>æ¡å®åæé®'},on_extra_question_pass:{url:"//user.lianjia.com/site/myWenda/?filter=4",text:'æ¨æ¶å°<span class="unreadNumber">#{unread}</span>æ¡è¿½é®'},xuequ_bbs:{url:"//user.lianjia.com/site/bbs?type=4",text:'è®ºåæ<span class="unreadNumber">#{unread}</span>æ¡åå¤'},ting_shou:{url:"//user.lianjia.com/",text:'æ¨å³æ³¨ç<span class="unreadNumber">#{unread}</span>å¥æ¿æºå·²ä¸æ¶'}},i=$.extend({},a,{on_extra_answer_pass:{url:"//agent.lianjia.com/preference/wenda/?filter=2",text:'æ¨æ¶å°<span class="unreadNumber">#{unread}</span>æ¡æ°è¿½ç­'},on_special_question_pass:{url:"//agent.lianjia.com/preference/wenda/?filter=3",text:'æ¨æ¶å°<span class="unreadNumber">#{unread}</span>æ¡å®åæé®'},on_extra_question_pass:{url:"//agent.lianjia.com/preference/wenda/?filter=4",text:'æ¨æ¶å°<span class="unreadNumber">#{unread}</span>æ¡è¿½é®'}});$.ajax({url:t,type:"get",dataType:"jsonp",success:function(t){if(0===t.errno){var n=t.data.is_agent?i:a,o=0;for(var r in t.data.group_by_type)0!==t.data.group_by_type[r].unread&&n.hasOwnProperty(r)&&(o+=t.data.group_by_type[r].unread);0!==o&&(e.tipContainer.html(e.tipTpl.render({unreadNum:o})),e.container.html(e.msgTpl.render({group_by_type:t.data.group_by_type,pushMsgMap:n})))}}})}}function _crossRequest(){function e(e,t){var a=document.createElement("iframe");return a.id=e,a.name=e,a.src=t,a.style.cssText="display:none;width:0px;height:0px;",a.width=0,a.height=0,a.title="empty",document.body.appendChild(a),a}var t=new LJMessenger("LIANJIA_CROSS_MESSAGE","LIANJIA-CROSS");t.listen(function(e){e=JSON.parse(e);var a=e.name;t.targets[a]&&("state"==e.type?(t.targets[a].readyState="ready",t.targets[a].dealReady()):t.targets[a].deal(e.data,e.success))});var a={},i=function(e,t){var a=this;a.domain=e,t=t||$.parseURL(e).host.replace(/\./g,"-"),a.name=t,a.init()};return $.extend(i.prototype,{init:function(){var a=this,i=a.domain+"/xd/api/?name="+a.name,n=e(a.name,i);a.iframe=n.contentWindow,t.addTarget(a.iframe,a.name),a.reqArray=[],t.targets[a.name].deal=function(e,i){t.targets[a.name].isRequest=!1;var n=a.reqArray.shift(),o=!1;try{o=e}catch(e){}i?n.defer.resolve(o):n.defer.reject(o),a.next()},t.targets[a.name].dealReady=function(){a.next()}},next:function(){var e=this;if(t.targets[e.name].readyState&&e.reqArray.length&&!t.targets[e.name].isRequest){t.targets[e.name].isRequest=!0;var a=e.reqArray[0],i={type:"request",data:a.request},n=JSON.stringify(i);t.targets[e.name].send(n)}},request:function(e){var t=this,a=$.Deferred();return t.reqArray.push({defer:a,request:e}),t.next(),a}}),function(e,t){return a[e]?a[e]:a[e]=new i(e,t)}}function _trans(){var e=$.EventEmitter,t=_crossRequest(),a=_getCommonEnv(),i=!1,n=e.extend({initialize:function(e){var n={url:"",type:"get",dataType:"json",args:{}};$.extend(n,e),n.url=a.fixedUrl(n.url),n.method=n.type;var o=this;if(o.opt=n,!i){var r=a.fixedUrl($.parseURL(n.url).host);a.isSameDomain(r)?o.isSame=!0:o.crossRequest=t(r)}},request:function(e){var t=this,a=t.opt;return $.extend(a.args,e),a.data=a.args,i||t.isSame?$.ajax(a):this.crossRequest.request(a)}});return n}function _sticker(){return[{face:"0",chara:"[å¾®ç¬]",code:"/::)"},{face:"1",chara:"[ä¼¤å¿]",code:"/::~"},{face:"2",chara:"[ç¾å¥³]",code:"/::B"},{face:"3",chara:"[åå]",code:"/::|"},{face:"4",chara:"[å¢¨é]",code:"/:8-)"},{face:"5",chara:"[å­]",code:"/::<"},{face:"6",chara:"[ç¾]",code:"/::$"},{face:"7",chara:"[å]",code:"/::X"},{face:"8",chara:"[ç¡]",code:"/::Z"},{face:"9",chara:"[å°å­]",code:"/::'("},{face:"10",chara:"[å§]",code:"/::-|"},{face:"11",chara:"[æ]",code:"/::@"},{face:"12",chara:"[è°ç®]",code:"/::P"},{face:"13",chara:"[ç¬]",code:"/::D"},{face:"14",chara:"[æè®¶]",code:"/::O"},{face:"15",chara:"[é¾è¿]",code:"/::("},{face:"16",chara:"[é·]",code:"/::+"},{face:"17",chara:"[æ±]",code:"/:--b"},{face:"18",chara:"[æç]",code:"/::Q"},{face:"19",chara:"[å]",code:"/::T"},{face:"20",chara:"[å¤§ç¬]",code:"/:,@P"},{face:"21",chara:"[å¿«ä¹]",code:"/:,@-D"},{face:"22",chara:"[å¥]",code:"/::d"},{face:"23",chara:"[å²]",code:"/:,@o"},{face:"24",chara:"[é¥¿]",code:"/::g"},{face:"25",chara:"[ç´¯]",code:"/:|-)"},{face:"26",chara:"[å]",code:"/::!"},{face:"27",chara:"[å°æ±]",code:"/::L"},{face:"28",chara:"[é«å´]",code:"/::>"},{face:"29",chara:"[é²]",code:"/::,@"},{face:"30",chara:"[åªå]",code:"/:,@f"},{face:"31",chara:"[éª]",code:"/::-S"},{face:"32",chara:"[çé®]",code:"/:?"},{face:"33",chara:"[ç§å¯]",code:"/:,@x"},{face:"34",chara:"[ä¹±]",code:"/:,@@"},{face:"35",chara:"[ç¯]",code:"/::8"},{face:"36",chara:"[å]",code:"/:,@!"},{face:"37",chara:"[é¬¼]",code:"/:!!!"},{face:"38",chara:"[æå»]",code:"/:xx"},{face:"39",chara:"[åè§]",code:"/:bye"},{face:"40",chara:"[ä¸­æ±]",code:"/:wipe"},{face:"41",chara:"[æ ]",code:"/:dig"},{face:"42",chara:"[é¼æ]",code:"/:handclap"},{face:"43",chara:"[ç³ç³]",code:"/:&-("},{face:"44",chara:"[æ¶æ]",code:"/:B-)"},{face:"45",chara:"[å·¦ä»ä¹]",code:"/:<@"},{face:"46",chara:"[å³ä»ä¹]",code:"/:@>"},{face:"47",chara:"[å°ç´¯]",code:"/::-O"},{face:"48",chara:"[ç]",code:"/:>-|"},{face:"49",chara:"[å§å±]",code:"/:P-("},{face:"50",chara:"[å¤§é¾è¿]",code:"/::'|"},{face:"51",chara:"[å]",code:"/:X-)"},{face:"52",chara:"[äº²]",code:"/::*"},{face:"53",chara:"[æå]",code:"/:@x"},{face:"54",chara:"[å¯æ]",code:"/:8*"},{face:"55",chara:"[å]",code:"/:pd"},{face:"56",chara:"[æ°´æ]",code:"/:<W>"},{face:"57",chara:"[é]",code:"/:beer"},{face:"58",chara:"[ç¯®ç]",code:"/:basketb"},{face:"59",chara:"[ä¹ä¹]",code:"/:oo"},{face:"60",chara:"[åå¡]",code:"/:coffee"},{face:"61",chara:"[ç¾é£]",code:"/:eat"},{face:"62",chara:"[å¨ç©]",code:"/:pig"},{face:"63",chara:"[é²è±]",code:"/:rose"},{face:"64",chara:"[æ¯]",code:"/:fade"},{face:"65",chara:"[å]",code:"/:showlove"},{face:"66",chara:"[ç±]",code:"/:heart"},{face:"67",chara:"[åæ]",code:"/:break"},{face:"68",chara:"[çæ¥]",code:"/:cake"},{face:"69",chara:"[çµ]",code:"/:li"}]}function LianjiaIM(e,t){var a=this;if(!e.appid||!e.appkey)throw new Error("IM Error: need appkey & appid to init lianjia IM.");var i=window.location.href.indexOf("ke")>-1;this.login=e.login,this.token=e.token,this.is_ljbb=e.is_ljbb,this.is_bkbb=e.is_bkbb,this.is_accuse="",this.accuseType=0,this.downAppUrl=e.downAppUrl||(i?"//www.ke.com/client/":"//www.lianjia.com/client/"),this.appDesc=e.appDesc||(i?"ç«å³ä¸è½½è´å£³æ¾æ¿APP, éæ¶éå°è~":"ç«å³ä¸è½½é¾å®¶APPï¼éæ¶éå°è~"),this.unreadSum=0,this.notify=e.notify||!1,this.version=e.version||1.1,this.validUrl=/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(ke.com|lianjia.com|realsee.com|ljcdn.com)/,this.header={"Lianjia-Im-Protocal-Version":"1.1","Lianjia-App-Id":e.appid,"Lianjia-Access-Token":e.token||"1","Lianjia-Device-Id":_util.getCookie("lianjia_uuid")},localStorage.setItem("BangInfo","{}"),this.userData=$.extend({uuid:_util.getCookie("lianjia_uuid"),cityid:_util.getCookie("select_city")},e.userData||{}),this.userData.code||(a.userData=$.extend({ucid:_util.getCookie("lianjia_uuid"),name:"æ¸¸å®¢",avatar:"",type:1},a.userData)),a.BangInfo=JSON.parse(localStorage.getItem("BangInfo")||"{}"),a.BangInfoNow=a.BangInfo[a.userData.ucid]||{},a.bangData=$.extend({},{conv_id:"",callUuid:"",skillCode:""},a.BangInfoNow),$(window).on("storage",function(e){"BangInfo"==e.originalEvent.key&&(a.BangInfo=JSON.parse(localStorage.getItem("BangInfo")||"{}"),a.BangInfoNow=a.BangInfo[a.userData.ucid]||{},a.bangData=$.extend({},{conv_id:"",callUuid:"",skillCode:""},a.BangInfoNow))}),this.updateBangInfo=function(){this.BangInfo[this.userData.ucid]=$.extend({},this.BangInfoNow),localStorage.setItem("BangInfo",JSON.stringify(this.BangInfo))},this.bangMsgList={},this.visibleBang=!1,this.isFirstInline=!0,this.pageConf=e,this.firstInitMessageList=!0,this.imgRoot="https://s1.ljcdn.com/web-im-sdk",this.staticRoot=e.staticRoot.replace(/\/\?_v=\d*/g,""),this.is_ljbb||this.is_bkbb?this.rootnode=$(['<div class="lianjiaim im-fold" data-role="lianjiaim">','<div class="lianjiaim-shandow clear">','<div class="lianjiaim-wrap" data-role="im-wrap">','<div class="lianjiaim-head" data-role="im-head">','<span data-role="im-title">å¨çº¿å¨è¯¢</span>','<span class="lianjiaim-head-num" data-role="im-unread" data-unread="0" style="display: none;">0</span>','<a class="lianjiaim-head-closebtn" title="æ¶èµ·" data-role="im-foldbtn">æ¶èµ·</a>',"</div>",'<div class="lianjiaim-body" data-role="im-body">','<ul class="lianjiaim-service" data-role="im-serviceitem-container">','<li class="lianjiaim-body-item">','<div class="im-item-show clear">',"<table>","<tbody>","<tr>",'<td class="im-item-avatar">','<img src="'+this.staticRoot+"/pc/asset/lianjiaIM/img/imgV2/"+(this.is_bkbb?"icon_online@2x.png":"icon_serv@2xV2.png")+'" alt="" width="40" height="40" data-role="im-listitem-item-avatar">','<i data-role="im-listitem-item-newmsg" style="display: none;" data-newmsg="0">0</i>',"</td>",'<td class="im-item-cont">','<span class="name" data-role="im-listitem-item-name"></span>','<span class="text" data-role="im-listitem-item-text"></span>',"</td>","</tr>","</tbody>","</table>","</div>","</li>","</ul>",'<ul data-role="im-listitem-container" style="display: none;"></ul>','<div class="lianjiaim-noagent" data-role="im-noagent-container" style="">','<div class="noagent-title">æ²¡æèè¿çç»çºªäºº</div>',"</div>","</div>","</div>",'<div class="lianjiaim-window im-online" data-role="im-window" data-agentid="" style="display: none;">','<div class="lianjiaim-wintitle">',"<i>å¨çº¿</i>",'<span class="im-wt-name" data-role="im-window-name"></span>','<a class="im-wt-closebtn" title="å³é­" data-role="im-window-closebtn">å³é­</a>',"</div>",'<div class="lianjiaim-wincont">','<div class="im-wc-hint"><span data-role="im-window-offlinename"></span>å½åä¸å¨çº¿ï¼æ¨å¯ä»¥å¨çº¿çè¨</div>','<div class="im-wc-chat" data-role="im-window-chatcontainer">','<p class="chat-tophint">èå¤©çæ¶åï¼ç»çºªäººæ æ³ç¥éæ¨çææºå·ï¼</p>','<div data-role="im-logtrigger"></div>','<ul data-role="im-window-msgcontainer"></ul>',"</div>",'<div class="im-wc-input">','<div class="im-input-container" data-role="im-input-container">','<textarea placeholder="ç¹å»è¾å¥æ¨æ³è¦å¨è¯¢çé®é¢â¦" data-role="im-input-textarea"></textarea>','<a class="im-input-insertpic" title="æå¥å¾ç" data-role="im-input-picbtn">æå¥å¾ç</a>','<input type="file" style="display: none;" accept=".gif,.jpg,.jpeg,.png,.bmp" data-role="im-input-picupload"/>','<span class="im-errorlog" data-role="im-errorlog" style="display: none;"></span>',"</div>",'<div class="im-btn-container">','<a href="'+this.downAppUrl+'" target="_blank" title="ä¸è½½é¾å®¶APP">'+this.appDesc+"</a>",'<input type="button" value="åé" class="send" data-role="im-input-sendbtn"/>',"</div>","</div>","</div>","</div>",'<div class="lianjiaim-window im-online" data-role="im-bang" style="display: none;">','<div class="lianjiaim-wintitle">',"<i>å¨çº¿</i>",'<span class="im-wt-name">é¾å®¶å¸®å¸®</span>','<span class="im-wt-time">å¨çº¿äººå·¥æå¡æ¶é´ï¼9:00 - 20:00</span>','<a class="im-wt-closebtn" title="å³é­" data-role="bang-close">å³é­</a>',"</div>",'<div class="lianjiaim-wincont">','<div class="im-wc-chat bang-chatcontainer" data-role="bang-chatcontainer">','<ul data-role="bang-msgcontainer"></ul>',"</div>",'<div class="im-wc-input">','<div class="im-input-container" data-role="im-input-container">','<textarea placeholder="ç¹å»è¾å¥æ¨æ³è¦å¨è¯¢çé®é¢â¦" data-role="bang-textarea"></textarea>','<a class="im-input-insertpic" title="æå¥å¾ç" data-role="bang-picbtn">æå¥å¾ç</a>','<input type="file" style="display: none;" accept=".gif,.jpg,.jpeg,.png,.bmp" data-role="bang-picupload"/>',"</div>",'<div class="im-btn-container">','<input type="button" value="åé" class="send" data-role="bang-send"/>','<input type="button" value="ç»æå¯¹è¯" class="end" data-role="bang-end" style="display: none;"/>',"</div>","</div>","</div>","</div>","</div>",'<div class="lianjiaim-personcard" data-role="im-pcard" style="display: none; top: 9999em; left: 9999em;">','<div class="im-personcard-top clear">','<div class="im-personcard-avatar">','<img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="78" height="78" data-role="im-pcard-avatar"/>',"</div>",'<div class="im-personcard-detail">','<div class="im-personname-wrap">','<span class="im-personname" data-role="im-pcard-name"></span>','<span class="im-gray" data-role="im-pcard-grade"></span>',"</div>","<div>",'<span class="im-gray">ä¸»è¥ååï¼</span>','<span data-role="im-pcard-district"></span>',"</div>","<div>",'<span class="im-gray">æå±é¨åºï¼</span>','<span data-role="im-pcard-store"></span>',"</div>","<div>",'<span class="im-gray">ä»ä¸å¹´éï¼</span>','<span data-role="im-pcard-workage"></span>',"</div>","</div>","</div>",'<div class="im-personcard-bottom">',"<table>","<tbody>","<tr>","<td>","<span>ç´¯è®¡æäº¤ï¼</span>",'<span class="im-red" data-role="im-pcard-totaldeal"></span>',"</td>","<td>","<span>ææ»å¸¦çï¼</span>",'<span class="im-red" data-role="im-pcard-monthshow"></span>',"</td>","<td>","<span>å¥½è¯çï¼</span>",'<span class="im-red" data-role="im-pcard-praiserate"></span>',"</td>","</tr>","</tbody>","</table>","</div>",'<a class="im-personcard-shopbtn" href="" target="_blank" title="è¿å¥åºéº" data-role="im-pcard-shoplink">è¿å¥åºéº</a>',"</div>","</div>"].join("")):this.rootnode=$(['<div class="lianjiaim im-fold" data-role="lianjiaim">','<div class="cover" style="position: fixed; height: 100%; width: 100%; background: #000; opacity: 0.6; z-index: 1001; display: none;"></div>','<div class="lianjiaim-shandow clear">','<div class="modal-wrap" style="border: 1px solid #ddd; width: 320px; height: 190px; border-radius: 4px; top: 137px; left: 164px; position: absolute; z-index: 1002; background: white; display: none;">','<div class="close-modal" style="color: #9297A6; position: absolute; top: 10px; right: 10px; font-size: 16px; cursor: pointer">&times;</div>','<div class="set-accuse" style="display: none;">','<div style="margin: 40px 32px 27px; font-size: 16px; font-weight: bold;">ä¸¾æ¥åï¼è¯¥ç¨æ·å°æ æ³ä¸æ¨æ¶åæ¶æ¯</div>','<div style="margin-left: 32px;">','<label style="margin-right: 44px; cursor: pointer" for="WEISHANG"><input name="type" type="radio" id="WEISHANG" value="WEISHANG" />  å¾®å</label>','<label style="margin-right: 44px; cursor: pointer" for="TONGYE"><input name="type" type="radio" id="TONGYE" value="TONGYE" />  åä¸</label>','<label for="SAORAO" style="cursor: pointer"><input name="type" type="radio" id="SAORAO" value="SAORAO" />  éªæ°</label>',"</div>","</div>",'<div class="cancel-accuse" style="display:none;">','<div style="margin: 40px 32px 70px 60px; font-size: 16px; font-weight: bold;">æ¯å¦ç¡®è®¤åæ¶ä¸¾æ¥è¯¥ç¨æ·ï¼</div>',"</div>",'<div style="margin-top: 30px; text-align: center"><button  style="width: 80px; height: 32px; background: #0984F9; color: #fff; font-size: 14px; cursor: pointer;" id="confirm-accuse">ç¡®å®</button></div>',"</div>",'<div class="lianjiaim-wrap" data-role="im-wrap">','<div class="lianjiaim-head" data-role="im-head">','<span data-role="im-title">å¨çº¿å¨è¯¢</span>','<span class="lianjiaim-head-num" data-role="im-unread" data-unread="0" style="display: none;">0</span>','<a class="lianjiaim-head-closebtn" title="æ¶èµ·" data-role="im-foldbtn">æ¶èµ·</a>',"</div>",'<div class="lianjiaim-body" data-role="im-body">','<ul data-role="im-listitem-container" style="display: none;"></ul>','<div class="lianjiaim-noagent" data-role="im-noagent-container" style="">','<div class="noagent-title">æ²¡æèè¿çç»çºªäºº</div>',"</div>","</div>","</div>",'<div class="lianjiaim-window im-online" data-role="im-window" data-agentid="" style="display: none;">','<div class="lianjiaim-wintitle">',"<i>å¨çº¿</i>",'<span class="im-wt-name" data-role="im-window-name"></span>','<a class="im-wt-closebtn" title="å³é­" data-role="im-window-closebtn">å³é­</a>',"</div>",'<div class="lianjiaim-wincont">','<div class="im-wc-hint"><span data-role="im-window-offlinename"></span>å½åä¸å¨çº¿ï¼æ¨å¯ä»¥å¨çº¿çè¨</div>','<div class="im-wc-chat" data-role="im-window-chatcontainer">','<div class="report-celling" style="display: none; position: fixed; width: 380px; z-index: 5; padding: 10px 40px; background: #FFFBE6; line-height: 22px; font-size: 12px;color: rgba(0,0,0,0.65);">','<img style="height: 14px; width: 14px; margin: 5px 5px 6px auto;" src="'+this.imgRoot+'/static/notify2@2x.png"/>','<span class="report-text"></span>',"</div>",'<p class="chat-tophint">èå¤©çæ¶åï¼ç»çºªäººæ æ³ç¥éæ¨çææºå·ï¼</p>','<div data-role="im-logtrigger"></div>','<ul data-role="im-window-msgcontainer"></ul>',"</div>",'<div class="im-wc-input">','<div class="im-input-container" data-role="im-input-container">','<textarea placeholder="ç¹å»è¾å¥æ¨æ³è¦å¨è¯¢çé®é¢â¦" data-role="im-input-textarea"></textarea>','<a class="im-input-insertpic" title="æå¥å¾ç" data-role="im-input-picbtn">æå¥å¾ç</a>','<input type="file" style="display: none;" accept=".gif,.jpg,.jpeg,.png,.bmp" data-role="im-input-picupload"/>','<span class="im-errorlog" data-role="im-errorlog" style="display: none;"></span>',"</div>",'<div class="im-btn-container">','<span class="is_accuse" style="display: inline-block; cursor: pointer; color: #C7C7C7; font-size: 12px; line-height: 14px; margin-top: 4px;">','<img style="height: 14px; width: 14px; margin: 0px 2px 2px auto;" src="'+this.imgRoot+'/static/alarm@2x.png"/>','<span class="accuse-text">ä¸¾æ¥</span>',"</span>",'<a href="'+this.downAppUrl+'" target="_blank" title="ä¸è½½APP">'+this.appDesc+"</a>",'<input type="button" value="åé" class="send" data-role="im-input-sendbtn"/>',"</div>","</div>","</div>","</div>",'<div class="lianjiaim-window im-online" data-role="im-bang" style="display: none;">','<div class="lianjiaim-wintitle">',"<i>å¨çº¿</i>",'<span class="im-wt-name">é¾å®¶å¸®å¸®</span>','<span class="im-wt-time">å¨çº¿äººå·¥æå¡æ¶é´ï¼9:00 - 20:00</span>','<a class="im-wt-closebtn" title="å³é­" data-role="bang-close">å³é­</a>',"</div>",'<div class="lianjiaim-wincont">','<div class="im-wc-chat bang-chatcontainer" data-role="bang-chatcontainer">','<ul data-role="bang-msgcontainer"></ul>',"</div>",'<div class="im-wc-input">','<div class="im-input-container" data-role="im-input-container">','<textarea placeholder="ç¹å»è¾å¥æ¨æ³è¦å¨è¯¢çé®é¢â¦" data-role="bang-textarea"></textarea>','<a class="im-input-insertpic" title="æå¥å¾ç" data-role="bang-picbtn">æå¥å¾ç</a>','<input type="file" style="display: none;" accept=".gif,.jpg,.jpeg,.png,.bmp" data-role="bang-picupload"/>',"</div>",'<div class="im-btn-container">','<input type="button" value="åé" class="send" data-role="bang-send"/>','<input type="button" value="ç»æå¯¹è¯" class="end" data-role="bang-end" style="display: none;"/>',"</div>","</div>","</div>","</div>","</div>",'<div class="lianjiaim-personcard" data-role="im-pcard" style="display: none; top: 9999em; left: 9999em;">','<div class="im-personcard-top clear">','<div class="im-personcard-avatar">','<img src="" alt="" width="78" height="78" data-role="im-pcard-avatar"/>',"</div>",'<div class="im-personcard-detail">','<div class="im-personname-wrap">','<span class="im-personname" data-role="im-pcard-name"></span>','<span class="im-gray" data-role="im-pcard-grade"></span>',"</div>","<div>",'<span class="im-gray">ä¸»è¥ååï¼</span>','<span data-role="im-pcard-district"></span>',"</div>","<div>",'<span class="im-gray">æå±é¨åºï¼</span>','<span data-role="im-pcard-store"></span>',"</div>","<div>",'<span class="im-gray">ä»ä¸å¹´éï¼</span>','<span data-role="im-pcard-workage"></span>',"</div>","</div>","</div>",'<div class="im-personcard-bottom">',"<table>","<tbody>","<tr>","<td>","<span>ç´¯è®¡æäº¤ï¼</span>",'<span class="im-red" data-role="im-pcard-totaldeal"></span>',"</td>","<td>","<span>ææ»å¸¦çï¼</span>",'<span class="im-red" data-role="im-pcard-monthshow"></span>',"</td>","<td>","<span>å¥½è¯çï¼</span>",'<span class="im-red" data-role="im-pcard-praiserate"></span>',"</td>","</tr>","</tbody>","</table>","</div>",'<a class="im-personcard-shopbtn" href="" target="_blank" title="è¿å¥åºéº" data-role="im-pcard-shoplink">è¿å¥åºéº</a>',"</div>","</div>"].join("")),this.nodes={wrap:this.rootnode.find('[data-role="im-wrap"]'),head:this.rootnode.find('[data-role="im-head"]'),title:this.rootnode.find('[data-role="im-title"]'),body:this.rootnode.find('[data-role="im-body"]'),serviceItemContainer:this.rootnode.find('[data-role="im-serviceitem-container"]'),listItemContainer:this.rootnode.find('[data-role="im-listitem-container"]'),noagentContainer:this.rootnode.find('[data-role="im-noagent-container"]'),headUnread:this.rootnode.find('[data-role="im-unread"]'),foldBtn:this.rootnode.find('[data-role="im-foldbtn"]'),talkwindow:this.rootnode.find('[data-role="im-window"]'),talkwindowOfflineName:this.rootnode.find('[data-role="im-window-offlinename"]'),talkwindowChatContainer:this.rootnode.find('[data-role="im-window-chatcontainer"]'),talkwindowMsgContainer:this.rootnode.find('[data-role="im-window-msgcontainer"]'),inputContainer:this.rootnode.find('[data-role="im-input-container"]'),inputTextarea:this.rootnode.find('[data-role="im-input-textarea"]'),inputPicBtn:this.rootnode.find('[data-role="im-input-picbtn"]'),inputPicUpload:this.rootnode.find('[data-role="im-input-picupload"]'),inputSendBtn:this.rootnode.find('[data-role="im-input-sendbtn"]'),errorlogContainer:this.rootnode.find('[data-role="im-errorlog"]'),pcard:this.rootnode.find('[data-role="im-pcard"]'),logTrigger:this.rootnode.find('[data-role="im-logtrigger"]'),topText:this.rootnode.find("p.chat-tophint"),bbtitle:this.rootnode.find('[data-role="im-listitem-item-name"]'),bbsubtitle:this.rootnode.find('[data-role="im-listitem-item-text"]'),bbname:this.rootnode.find("span.im-wt-name"),bbtime:this.rootnode.find(".im-wt-time"),talkBang:this.rootnode.find('[data-role="im-bang"]'),talkBangMsgContainer:this.rootnode.find('[data-role="bang-msgcontainer"]'),talkBangTextarea:this.rootnode.find('[data-role="bang-textarea"]'),picBtnBang:this.rootnode.find('[data-role="bang-picbtn"]'),picInputBang:this.rootnode.find('[data-role="bang-picupload"]'),talkBangDownload:this.rootnode.find('[data-role="bang-download"]'),talkBangSend:this.rootnode.find('[data-role="bang-send"]'),talkBangEnd:this.rootnode.find('[data-role="bang-end"]'),is_accuse:this.rootnode.find("span.is_accuse"),accuseModal:this.rootnode.find("div.modal-wrap"),closeModal:this.rootnode.find("div.modal-wrap div.close-modal"),cancleAccuse:this.rootnode.find("div.modal-wrap div.cancle-accuse"),setAccuse:this.rootnode.find("div.modal-wrap div.set-accuse"),cancelAccuse:this.rootnode.find("div.modal-wrap div.cancel-accuse"),cover:this.rootnode.find("div.cover"),accuseType:this.rootnode.find('div.modal-wrap input[name="type"]'),confirm:this.rootnode.find("#confirm-accuse"),
reportCelling:this.rootnode.find("div.lianjiaim-wincont .report-celling"),accuseText:this.rootnode.find("div.im-btn-container span.accuse-text"),reportText:this.rootnode.find("span.report-text")},this.nodes.bbtitle.text(this.is_bkbb?"å¨çº¿å®¢æ":"é¾å®¶å¸®å¸®"),this.nodes.bbsubtitle.text(this.is_bkbb?"è´å£³æ¾æ¿å®æ¹äººå·¥å®¢æ":"é¾å®¶ç½å®æ¹äººå·¥å®¢æ"),this.nodes.bbname.text(this.is_bkbb?"å¨çº¿å®¢æ":"é¾å®¶å¸®å¸®"),this.nodes.bbtime.text("å¨çº¿äººå·¥æå¡æ¶é´ï¼9:00 - 20:00"),this.listItemTemplate=$.template(['<li class="lianjiaim-body-item<% if (!item.user_status) { %> offline<% } %>" data-role="im-listitem-item" data-convid="<%= item.convId %>" data-convtype="<%= item.convType %>" data-agentid="<%= item.id %>" data-msgtime="0">','<div class="im-item-show clear">',"<table>","<tbody>","<tr>",'<td class="im-item-avatar">','<img src="<%= item.avatar %>" alt="" width="40" height="40" data-role="im-listitem-item-avatar"/>','<i data-role="im-listitem-item-newmsg" style="display: none;" data-newmsg="0">0</i>',"</td>",'<td class="im-item-cont">','<span class="name" title="" data-role="im-listitem-item-name"><%= item.name %></span>','<span class="text" title="" data-role="im-listitem-item-text"><%= item.summary %></span>',"</td>","</tr>","</tbody>","</table>",'<div class="im-item-time" data-role="im-listitem-item-time"></div>','<a class="im-item-delbtn" title="å é¤" data-role="im-listdelbtn">&#215;</a>',"</div>",'<div class="im-item-delete clear">',"<div>",'<span class="title">ç¡®å®å é¤ï¼</span>','<span class="cont">å é¤åå°ä¸å¯æ¢å¤</span>',"</div>",'<div class="im-item-delbtnwrap">','<a class="im-btn" title="ç¡®å®" data-role="im-listdel-confirmbtn">ç¡®å®</a>','<a class="im-btn" title="åæ¶" data-role="im-listdel-cancelbtn">åæ¶</a>',"</div>","</div>","</li>"].join("")),this.messageNodeTemplate=$.template(['<li class="chat-block clear <%= sendType %>" data-msgtime="<%= timestamp %>" data-msgid="<%= msgid %>" data-role="msgitem">','<div class="chat-avatar">','<a title="<%= user.username %>" data-role="im-window-avatar"><img src="<%= user.avatar %>" alt="<%= user.username %>" width="34" height="34"/></a>',"</div>",'<div class="chat-content">',"<i>&#9660;</i>","<div><%= message.text %></div>","</div>","</li>"].join("")),this.picNodeTemplate=$.template(['<li class="chat-block clear <%= sendType %>" data-msgtime="<%= timestamp %>" data-msgid="<%= msgid %>" data-role="msgitem">','<div class="chat-avatar">','<a title="<%= user.username %>" data-role="im-window-avatar"><img src="<%= user.avatar %>" alt="<%= user.username %>" width="34" height="34"/></a>',"</div>",'<div class="chat-content">',"<i>&#9660;</i>",'<p><a href="<%= pic.url %>" title="<%= pic.desc %>" target="_blank"><img class="chat-msg-pic" src="<%= pic.thumb %>" alt="<%= pic.desc %>" /></a></p>',"</div>","</li>"].join("")),this.housecardNodeTemplate=$.template(['<li class="chat-block clear <%= sendType %>" data-msgtime="<%= timestamp %>" data-msgid="<%= msgid %>" data-role="msgitem">','<div class="chat-avatar">','<a title="<%= user.username %>" data-role="im-window-avatar"><img src="<%= user.avatar %>" alt="<%= user.username %>" width="34" height="34"/></a>',"</div>",'<div class="chat-content">',"<i>&#9660;</i>",'<a class="im-housecard" href="<%= houseinfo.schemeUrl %>" target="_blank" title="<%= houseinfo.houseName %>">','<img src="<%= houseinfo.houseImgUrl %>" alt="<%= houseinfo.houseName %>" width="54" height="54"/>','<span class="im-housecard-detail">','<span class="im-housecard-title"><%= houseinfo.lineText1 || houseinfo.houseName %></span>',['<span class="im-housecard-describe">',"<% if(houseinfo.lineText2) { %>","<em><%= houseinfo.lineText2%></em>","<% } else { %>","<em><%= houseinfo.houseBedroomCount %>å®¤<%= houseinfo.houseHallCount %>å</em>","<em><%= houseinfo.area %>ã¡</em>","<em><%= houseinfo.orientation %></em>","<% } %>","</span>"].join(""),['<span style="display: flex; justify-content: space-between" class="im-housecard-price">',"<% if (houseinfo.lineText3) { %>","<%= houseinfo.lineText3 %>","<% } else { %>",'<%= (houseinfo.price && houseinfo.price !== "0") ? ((houseinfo.price / 10000) + houseinfo.priceUnit) : "ææ ä»·æ ¼" %>','<span style="text-align:right; font-weight:bold"><%= houseinfo.houseState==2 ? "æäº¤" : "" %></span>',"<% } %>","</span>"].join(""),"</span>","</a>","</div>","</li>"].join("")),this.chatTimeNodeTemplate=$.template(['<li class="chat-time"><%= time %></li>'].join("")),this.xinfangcardNodeTemplate=$.template(['<li class="chat-block clear <%= sendType %>" data-msgtime="<%= timestamp %>" data-msgid="<%= msgid %>" data-role="msgitem">','<div class="chat-avatar">','<a title="<%= user.username %>" data-role="im-window-avatar"><img src="<%= user.avatar %>" alt="<%= user.username %>" width="34" height="34"/></a>',"</div>",'<div class="chat-content">',"<i>&#9660;</i>",'<a class="im-housecard" href="<%= houseinfo.schemeUrl %>" target="_blank" title="<%= houseinfo.houseName %>">','<img src="<%= houseinfo.buildingImgUrl %>" alt="<%= houseinfo.buildingName %>" width="54" height="54"/>','<span class="im-housecard-detail">','<span class="im-housecard-title"><%= houseinfo.buildingName %></span>','<span class="im-housecard-describe"><em><%= houseinfo.area %></em><em class="im-house-type-right"><%= houseinfo.houseType %></em></span>','<span class="im-housecard-price"><%= houseinfo.avgPrice %></span>',"</span>","</a>","</div>","</li>"].join("")),this.zulincardNodeTemplate=$.template(['<li class="chat-block clear <%= sendType %>" data-msgtime="<%= timestamp %>" data-msgid="<%= msgid %>" data-role="msgitem">','<div class="chat-avatar">','<a title="<%= user.username %>" data-role="im-window-avatar"><img src="<%= user.avatar %>" alt="<%= user.username %>" width="34" height="34"/></a>',"</div>",'<div class="chat-content">',"<i>&#9660;</i>",'<a class="im-housecard" href="<%= houseinfo.schemeUrl %>" target="_blank" title="<%= houseinfo.houseName %>">','<img src="<%= houseinfo.buildingImgUrl %>.54x54.jpg" alt="<%= houseinfo.buildingName %>" width="54" height="54"/>','<span class="im-housecard-detail">','<span class="im-housecard-title"><%= houseinfo.buildingName %></span>','<span class="im-housecard-describe"><em><%= houseinfo.area %></em><em class="im-house-type-right"><%= houseinfo.houseType %></em></span>','<span class="im-housecard-price"><%= houseinfo.avgPrice %></span>',"</span>","</a>","</div>","</li>"].join("")),this.msg330NodeTemplate=$.template(['<li class="chat-block card330 clear <%= sendType %> <%= msgid %>" data-role="msgitem" style="margin-bottom:35px;">','<% if (fromUcid !== "SYSTEM") { %><div class="chat-avatar">','<a title="<%= user.username %>" data-role="im-window-avatar"><img src="<%= user.avatar %>" alt="<%= user.username %>" width="34" height="34"/></a>',"</div><% } %>",'<div class="chat-content type-3" style="background: white; padding: 0px; border-radius: 10px; overflow: hidden; height: 180px; width:200px">','<a class="house-card" href="javascript:;" target="_blank">','<span class="im-housecard-detail" style="margin: 0px; height: auto; width: 200px;">','<span class="im-housecard-img" style="width:200px;"></span>','<span class="im-housecard-title" style="margin-left: 15px;"></span>','<span class="im-housecard-info" style="margin-left: 15px;"></span>','<span class="im-housecard-price" style="margin-left: 15px;"></span>',"</span>","</a>","</div>",'<div class="chat-content type-cardId1" style="background: white; padding: 0px; border-radius: 10px; overflow: hidden; width:254px">','<div class="im-phonecard-detail" style="margin: auto 15px; height: auto;">','<div class="im-phonecard-title"','style="margin-top: 11px;font-family: PingFang-SC-Bold;font-weight: bold;font-size: 16px;color: #394043;letter-spacing: 0;line-height: 21px">','<img class="system-avatar" style="height: 22px;margin-right: 8px;vertical-align: middle;">','<span class="im-phonecard-title-text" style="vertical-align: middle;"></span>',"</div>",'<div class="im-phonecard-desc" ','style="margin-bottom: 14px;margin-top: 8px;font-family: PingFangSC-Regular;font-size: 15px;color: #394043;letter-spacing: 0;line-height: 19px;">',"</div>",'<div class="im-phonecard-btns" style="display: flex;text-align: center;margin: 8px 0;border-top: 1px solid #E6E6E6">','<span class="im-phonecard-btn im-phonecard-btn1" style="flex:1;margin: 8px 0;"></span>','<span class="im-phonecard-btn im-phonecard-btn2" style="flex:1;margin: 8px 0;border-left: 1px solid #E5E5E5"></span>',"</div>","</div>","</div>",'<div class="chat-content type-1" style="padding: 10px; border-radius: 10px; overflow: hidden; width:200px">','<p class="im-housecard-info" style="font-size: 14px">æä¸æ¯æè¯¥æ¶æ¯ç±»åï¼è¯·åå¾appæ¥ç</p>',"</div>",'<div style="position: relative;" class="type-3-label">','<span class="im-housecard-label" style="position: absolute; right: 220px; top: 185px; font-size: 12px; display: inline-block; padding: 2px 5px; border: 1px solid #ddd; border-radius: 5px; background: #bab9b9; color: #fff;"></span>',"</div>","</li>"].join("")),this.msg802NodeTemplate=$.template(['<li class="chat-system-msg" style="padding: 0 10px;color: #aaa;font-size: 12px;text-align: center;margin-bottom: 10px;" data-msgid="<%= msgid %>"><%= desc %></li>'].join("")),this.msgRecallTemplate=$.template(['<li class="msgRecall clear" data-msgid="<%= msgid %>" >','<div class="chat-msg-recall" data-msgid="<%= msgid %>" >æ¤å</div>',"</li>"].join("")),this.bangShowEnd=function(e){e?(a.nodes.talkBangDownload.hide(),a.nodes.talkBangEnd.show()):(a.nodes.talkBangDownload.show(),a.nodes.talkBangEnd.hide()),a.scrollBangWindow("bottom")},this.bangRenderSysMsg=function(e,t){var i=$.template(['<li class="chat-wait">'+e+"</li>"].join("")).render();return t?i:(a.nodes.talkBangMsgContainer.append(i),void a.scrollBangWindow("bottom"))},this.bangRenderMsg=function(e,t,i,n,o){var r=t?"chat-out":"chat-in";e=o?filterXSS(e):t?filterXSS(_util.httpHtml(e)):_util.httpHtml(e),e=e.replace(/(\/\:\S*\s)/g,function(e){e=$.trim(e);for(var t in sticker)if(e==sticker[t].code)return'<img style="height: 20px;" src="'+a.staticRoot+"/pc/asset/lianjiaIM/img/sticker/"+sticker[t].face+'.gif"/>';return e});var s=a.messageNodeTemplate.render({sendType:[r,i||""].join(" "),timestamp:$.now(),msgid:"0",user:{username:t?this.userData.username||"æ¸¸å®¢":a.is_bkbb?"å¨çº¿å®¢æ":"é¾å®¶å¸®å¸®",avatar:t?this.userData.avatar||a.staticRoot+"/pc/asset/lianjiaIM/img/imgV2/tourist.png":a.staticRoot+"/pc/asset/lianjiaIM/img/imgV2/"+(a.is_bkbb?"icon_online@2x.png":"icon_serv@2xV2.png")},message:{text:e}});return n?s:(a.nodes.talkBangMsgContainer.append(s),void a.scrollBangWindow("bottom"))},this.bangRenderHistory=function(e){if(e.length){var t=[];e.forEach(function(e,i){var n="",o=!1,r="SN_LJBB"!=e.fromUcid&&"KE_KEFU"!=e.fromUcid,s=_util.timeFormat(e.sendTime,"deltaTime","YYYY-MM-DD hh:mm");if(e.type==-1&&(n=a.bangRenderMsg(e.payload,r,"",!0),o=!0),99!=e.type||r||(n=a.bangRenderMsg(JSON.parse(e.payload).url,!1,"",!0),o=!0),600==e.type||e.type==-2)try{var c=JSON.parse(e.payload);c.original&&(n=a.bangRenderPic(c,r,!0),o=!0),c.desc&&(n=a.bangRenderSysMsg(c.desc,!0),"object"==typeof c.content&&c.content.message&&(n=a.bangRenderSysMsg(c.content.message,!0),2==c.type&&1==c.content.sessionStatus&&(n=a.bangRenderMsg(c.content.message,!1,"",!0))),o=!0)}catch(e){}o&&t.push(a.bangRenderSysMsg(s,!0)),t.push(n)}),a.nodes.talkBangMsgContainer.prepend(t.join("")),a.scrollBangWindow("bottom")}},this.bangRenderPic=function(e,t,a){var i="å¾ç",n=e.thumbnail,o=e.original;this.validUrl.test(e.thumbnail)||(e.thumbnail=null,i="éæ³å¾ç"),this.validUrl.test(e.original)||(e.original=null,i="éæ³å¾ç");var r=['<a href="'+e.original+'" title='+i+' target="_blank" data-invalid='+o+">",'<img class="chat-msg-pic" src="'+e.thumbnail+'" alt='+i+" data-invalid="+n+"/>","</a>"].join("");return a?this.bangRenderMsg(r,t,"",!0,!0):void this.bangRenderMsg(r,t,"",!1,!0)},this.bangRenderType=function(){var e=this.is_bkbb?["<div>","<p>æ¨å¥½ï¼å¨çº¿å®¢æå¾é«å´ä¸ºæ¨æå¡ï¼è¯·éæ©æ¨å¨è¯¢çæå¡ç±»å</p>",'<div class="bang-type">',[{text:"è´å£³äºææ¿",value:"BEIKESECOND"},{text:"è´å£³æ°æ¿",value:"BEIKENEWHOUSE"},{text:"è´å£³æ¿å±ç§èµ",value:"BEIKELEASE"}].map(function(e,t){return'<span data-role="bang-type" data-value="'+e.value+'">'+e.text+"</span>"}).join(""),"</div>","</div>"]:["<div>","<p>æ¨å¥½ï¼é¾å®¶å¸®å¸®å¾é«å´ä¸ºæ¨æå¡ï¼è¯·éæ©æ¨å¨è¯¢çæå¡ç±»å</p>",'<div class="bang-type">',[{text:"äºææ¿",value:"JNZ001"},{text:"æ°æ¿",value:"JNZ002"},{text:"æ¿å±ç§èµ",value:"JNZ003"}].map(function(e,t){return'<span data-role="bang-type" data-value="'+e.value+'">'+e.text+"</span>"}).join(""),"</div>","</div>"];e=e.join(""),this.bangRenderMsg(e,!1,"chat-bang")},this.bangRenderAppraise=function(){var e=['<div class="bang-appraise">','<div class="appraise-title">è¯·æ¨å¯¹æçæå¡ååºè¯ä»·ï¼è°¢è°¢ã</div>','<div class="appraise-type">',[{name:"reaction",text:"ååºæ¶æ",value:5},{name:"solved",text:"é®é¢è§£å³",value:5},{name:"attitude",text:"æå¡æåº¦",value:5}].map(function(e,t){return['<div class="appraise-type-item" data-name="'+e.name+'" data-value="'+e.value+'">','<div class="appraise-text">'+e.text+"</div>",'<div class="appraise-stars">',[1,1,1,1,1].map(function(){return'<span class="appraise-star active"></span>'}).join(""),"</div>",'<div class="appraise-num">5å</div>',"</div>"].join("")}).join(""),"</div>",'<textarea data-role="appraise-textarea" placeholder="è¯·åä¸æ¨çå®è´µæè§åå»ºè®®..." maxlength="120"></textarea>','<div class="appraise-btns">','<span data-role="appraise-btn-cancel" class="appraise-btn-cancel">åæ¶</span>','<span data-role="appraise-btn-submit" class="appraise-btn-submit">ç¡®å®</span>',"</div>","</div>"].join("");a.bangRenderMsg(e,!1,"chat-bang")},this.scrollBangWindow=function(e){$(".bang-chatcontainer").scrollTop(function(){return $.isNumeric(e)?e:"top"===e?0:a.nodes.talkBangMsgContainer.height()-$(this).height()+100})},this.bangTalkDisable=function(e){a.scrollBangWindow("bottom")},this.bangInline=function(){a.bangRenderSysMsg("æ­£å¨ä¸ºæ¨å®æåå¸­ï¼è¯·ç¨ç­..."),a.core.sendTo(a.bangData.conv_id,{type:600,payload:JSON.stringify({type:1,content:{customerId:a.userData.ucid,customerName:a.userData.name,cityCode:a.userData.cityid,customerType:a.userData.code?2:1,skillCode:a.bangData.skillCode}})},function(e){return e?void a.bangShowEnd(!0):(a.bangRenderSysMsg("è¿çº¿å¤±è´¥"),void a.bangTalkDisable(!0))})},this.bangHangup=function(e,t){a.BangInfoNow={conv_id:a.BangInfoNow.conv_id},a.updateBangInfo(),a.core.sendTo(e,{type:600,payload:JSON.stringify({type:3,content:{hangupType:1}})},function(){t&&t()})},this.housecardReg=/(.*?)http[s]?:\/\/\S+?\.lianjia\.com.*?(ershoufang|chengjiao)\/(\S+?)\.html[#?=\-\w]*(.*)/i,this.xinfangcardReg=/(.*?)http[s]?:\/\/\S+?\.fang\.ke\.com\/loupan\/.*?(\S+?)[\/|?|#][#?=\-\w]*(.*)/i,this.zulincardReg=/(.*?)http[s]?:\/\/\S+?\.zu\.ke\.com\/zufang\/(\w+)\.html[\/|?|#]?[#?=\-\w]*(.*)/i,this.apartmentReg=/(.*?)http[s]?:\/\/\S+?\.zu\.ke\.com\/apartment\/(\w+)\.html[\/|?|#]?[#?=\-\w]*(.*)/i,this.ke_ershouCardReg=/(.*?)http[s]?:\/\/\S+?\.ke\.com\/ershoufang\/(\w+)\.html[\/|?|#]?[#?=\-\w]*(.*)/i,this.chengjiao_ershouCardReg=/(.*?)http[s]?:\/\/\S+?\.ke\.com\/chengjiao\/(\w+)\.html[\/|?|#]?[#?=\-\w]*(.*)/i,this.isFolding=!0,this.isLoadingHistory=!1,this.currentConvId="",this.lianjiaServiceWindow=null,this.errorlogTimer=0,this.publicAccount=["GUANG_XIAOXIA","GUANG_ZUYUE","GUANG_FANGYUANTIXING","GUANG_ZHUSHOU","NUOZHEN_ZUFANG","KE_ZHUANGXIUZHUSHOU","KE_XINXUANGUWEN"],this.publicAccounts=["NUOZHEN_ZUFANG","KE_ZHUANGXIUZHUSHOU","KE_XINXUANGUWEN"],this.msg2type={"-1":"ææ¬","-2":"è¯­é³","-6":"æä»¶",1:"æ¿æºå¡ç",2:"å¨çº¿å¸¦çå¡ç",3:"å¦æ¯çæ¿å¡ç",7:"å°åºå¡ç",5:"çæ¿æ¥ç¨å¡ç",6:"æ°æ¿æ¥¼çå¡ç ",99:"é¾æ¥å¡ç",8:"åè½å·æ¶æ¯",105:"èªå¨åå¤",109:"GIFè¡¨æ",211:"å¾é",310:"å¬å¼å¡ç",320:"ç§å¯å¡ç",330:"éç¨å¡ç",400:"å¬ä¼å·èªå®ä¹èåç¹å»æ¶æ¯",120:"å¯ææ¬æ¶æ¯",121:"æ°å¯ææ¬æ¶æ¯",600:"å¸®å¸®ï¼CRMï¼ä¸å¡ä¸ç¨èªå®ä¹æ¶æ¯",122:"ç¾¤éè¯·å¡ç",123:"çº¢åå¡ç",124:"è§è²åæç¤º",125:"éç¨éæå¾æå¡çæ¶æ¯",800:"è¿å¥ä¼è¯",804:"æºè½å©ææç¤ºæ¶æ¯"},this.imData={},this.agentData={},this.housecardStat={data:{},check:function(e,t){if(this.data[e]){var a=this.data[e][t]||0,i=(new Date).getTime();return i-a>6048e5}return!0},set:function(e,t){this.data[e]||(this.data[e]={}),this.data[e][t]=(new Date).getTime(),window.localStorage.housecardStat=JSON.stringify(this.data)}},this.housecardStat.data=JSON.parse(window.localStorage.housecardStat||"{}"),this.initMessageList=function(){a.core.on("message",function(e,t,i){function n(e){var t={};"[object Array]"===Object.prototype.toString.call(e)&&(e[0].type===-1?(t=e[0]||{},e=e[1]):(t=e[1]||{},e=e[0]));try{var i=JSON.parse(e.payload),n="";2==i.type&&(n=i.content.message,1==i.content.sessionStatus&&(a.bangRenderSysMsg("è¿çº¿æå"),a.bangRenderMsg(n)),2==i.content.sessionStatus&&a.bangRenderSysMsg(n),a.isFirstInline&&a.sendUrlBang(),a.bangData.callUuid=i.content.callUuid,a.BangInfoNow.callUuid=i.content.callUuid,a.updateBangInfo(),a.bangTalkDisable(!1),a.isFirstInline=!1),6==i.type&&(a.bangRenderSysMsg(i.content.message),a.bangTalkDisable(!0),4!=i.content.sessionStatus&&(a.BangInfoNow.skillCode="",a.updateBangInfo(),5!=i.content.sessionStatus&&a.bangRenderType()))}catch(e){}t.type===-1&&a.bangRenderMsg(t.payload)}var o={},r=[];$.each(t,function(e,t){o[t.convId]||(o[t.convId]=[]),o[t.convId].push(t)}),$.each(o,function(e,t){e=+e,r.push({convId:e,newMsgList:t})}),r.sort(function(e,t){return e.newMsgList.slice(-1)[0].sendTime-t.newMsgList.slice(-1)[0].sendTime}),$.each(r,function(e,t){var n=t.convId,o=this.newMsgList;a.updateImDataConv(n,"convObj",a.core.convMap[n]),i!==-1&&a.imData[n]&&a.imData[n].convObj&&a.imData[n].convObj.updateDetail&&a.imData[n].convObj.updateDetail(),null===a.imData[n].itemNode&&a.addConvItemNode(a.imData[n].convObj),$.each(o,function(e,t){a.imData[n].msgList.push(t)});var r=a.filterSupportMsg(o),s=r.slice(-1)[0]||{},c=0;n===a.currentConvId?(a.addMsg(r,"btm"),a.scrollWindow("btm")):i!==-1&&$.each(r,function(e,t){var i=a.imData[n].convObj;a.notify&&a.core.IMNotification({title:i.title,body:t.summary,icon:i.avatar},a.imgRoot),this.fromUcid!==a.userData.ucid&&c++}),a.updateConvItemNode(n,{text:a.getMsgSummary(s),time:s.sendTime,newmsgAmount:"+"+c},i!==-1)});var s=[],c=[],d=0;if(i==-1){if(a.bangData.conv_id)2==t.length?n(t):s=t.filter(function(e,t){return e.convId==a.bangData.conv_id});else if(2==t.length)n(item);else{var l=t.filter(function(e){return"SN_LJBB"===e.fromUcid||"KE_KEFU"===e.fromUcid});l.length&&(s=t.filter(function(e,t){return e.convId==l[0].convId}))}a.bangRenderHistory(s)}else c=t.filter(function(e){return"SN_LJBB"===e.fromUcid||"KE_KEFU"===e.fromUcid}),d=+a.nodes.serviceItemContainer.find('[data-role="im-listitem-item-newmsg"]').attr("data-newmsg")+c.length,a.bangData.conv_id&&"none"===a.nodes.talkBang.css("display")?a.nodes.serviceItemContainer.find('[data-role="im-listitem-item-newmsg"]').attr("data-newmsg",d).text(d)[d?"show":"hide"]():a.nodes.serviceItemContainer.find('[data-role="im-listitem-item-newmsg"]').attr("data-newmsg",0).text(0).hide(),c.forEach(function(e){if(a.bangData.skillCode){if(a.bangMsgList[e.sendTime]==e.payload)return!1;if(a.bangMsgList[e.sendTime]=e.payload,e&&a.bangData.conv_id)try{var t=JSON.parse(e.payload),i="";"object"!=typeof t&&a.bangRenderMsg(t,!1),e.type==-2&&a.bangRenderPic(t,!1),99==e.type&&a.bangRenderMsg(t.url,!1,"",!1),2==t.type&&(i=t.content.message,1==t.content.sessionStatus&&(a.bangRenderSysMsg("è¿çº¿æå"),a.bangRenderMsg(i)),2==t.content.sessionStatus&&a.bangRenderSysMsg(i),a.isFirstInline&&a.sendUrlBang(),a.bangData.callUuid=t.content.callUuid,a.BangInfoNow.callUuid=t.content.callUuid,a.updateBangInfo(),a.bangTalkDisable(!1),a.isFirstInline=!1),3==t.type&&(i=t.desc,a.bangTalkDisable(!0),a.bangRenderSysMsg("<span>"+i+'</span><span class="btn-handle" data-role="inline-again">éæ°è¿çº¿</span>'),a.bangRenderAppraise(),a.BangInfoNow={conv_id:a.BangInfoNow.conv_id},a.updateBangInfo()),4==t.type&&3==t.content.sessionStatus&&(a.bangTalkDisable(!0),a.BangInfoNow={conv_id:a.BangInfoNow.conv_id},a.updateBangInfo(),a.bangRenderSysMsg('<span>ä¼è¯å·²ç»æ</span><span class="btn-handle" data-role="inline-again">éæ°è¿çº¿</span>')),6==t.type&&(a.bangRenderSysMsg(t.content.message),a.bangTalkDisable(!0),4!=t.content.sessionStatus&&(a.BangInfoNow.skillCode="",a.updateBangInfo(),5!=t.content.sessionStatus&&a.bangRenderType())),7==t.type&&(5==t.content.status&&a.bangRenderSysMsg(t.content.message),6==t.content.status&&a.bangRenderSysMsg("<span>"+t.content.message+'</span><a class="btn-handle" target="_blank" href="http://cconline.netapi.lianjia.com/webchat/callback.html?lianjiaCity='+window.ljConf.city_id+'">é¢çº¦å¼å«</a>'),7==t.content.status&&a.bangRenderSysMsg(t.content.message))}catch(t){var i=e.payload;a.bangRenderMsg(i,!1)}}});a.updateHeadUnread()}),a.core.on("arrive",function(e,t,i){var n=!1;t.map(function(e){var t=e.convId,i=e.fromUcid,o=JSON.parse(e.payload||"{}"),r=o.msg_id,s=o.time;t==a.currentConvId&&(n=!0),a.core.ucid!=i&&r&&(a.imData[t].arriveInfo?a.imData[t].arriveInfo.arrive<r&&(a.imData[t].arriveInfo={arrive:r,arriveTime:s}):a.imData[t].arriveInfo={arrive:r,arriveTime:s})}),a.updateArrive_Read({eventType:"msgArrive",isNeedUpdate:n,isFormOther:!0})}),a.core.on("read",function(e,t,i){var n=!1;t.map(function(e){var t=e.convId,i=e.fromUcid,o=JSON.parse(e.payload||"{}"),r=o.msg_id,s=o.time;t==a.currentConvId&&(n=!0),a.core.ucid!=i&&r&&(a.imData[t]&&!a.imData[t].readInfo?a.imData[t].readInfo={read:r,readTime:s}:a.imData[t]&&a.imData[t].readInfo&&a.imData[t].readInfo.read<r&&(a.imData[t].readInfo={read:r,readTime:s}))}),a.updateArrive_Read({eventType:"msgRead",isNeedUpdate:n,isFormOther:!0})})},this.userData.code?(a.core=new ImCore({msgApiRoot:apiRoot.imApi.msg,mediaApiRoot:apiRoot.imApi.media,apiheader:a.header,appkey:e.appkey,ucid:a.userData.ucid}),this.getUcData(this.userData.ucid,function(t){var i=t[0]||{};a.userData=$.extend({ucid:i.uc_id,name:i.name,avatar:i.favicon,type:i.type},a.userData),a.core=new ImCore({msgApiRoot:apiRoot.imApi.msg,mediaApiRoot:apiRoot.imApi.media,apiheader:a.header,appkey:e.appkey,ucid:a.userData.ucid}),a.core.on("init",function(t){$.each(a.core.convMap,function(e,t){e=+e,a.updateImDataConv(e,"convObj",t),a.updateImDataConv(e,"readMsgId",t.readMsgId)}),a.nodes.listItemContainer.on("click",'[data-role="im-listitem-item"]',function(){a.nodes.reportCelling.hide(),a.clickConvItemTrck();var t=$(this).attr("data-convid"),i=$(this).attr("data-agentid"),n=$(this).attr("data-convtype");"function"==typeof e.userTrack&&e.userTrack({event:"convClick",convId:t,agentId:i,convType:n}),a.currentConvId!==t&&(a.setWindow(t),a.showWindow(!0)),~a.publicAccount.indexOf(i)||a.core.fetchReportStatus(t,function(e){e&&(Object.keys(e.data).length>0?(a.accuseType=2,a.nodes.reportCelling.show(),a.nodes.reportText.html(e.data.desc),a.nodes.accuseText.html("åæ¶ä¸¾æ¥")):(a.accuseType=1,a.nodes.reportCelling.hide(),a.nodes.accuseText.html("ä¸¾æ¥")))})}),a.nodes.talkwindow.on("click",'[data-role="im-window-closebtn"]',function(){a.currentConvId="",a.showWindow(!1)}),a.nodes.inputSendBtn.on("click",function(){""===a.currentConvId||a.nodes.inputSendBtn.prop("disabled")||(a.nodes.inputSendBtn.val("åéä¸­...").prop({disabled:!0}),a.sendMsg(a.currentConvId,a.nodes.inputTextarea.val(),function(e,t){if(a.nodes.inputSendBtn.val("åé").prop({disabled:!1}),$.isEmptyObject(e)){var i="æ¶æ¯åéå¤±è´¥";42504===t.errno&&(i=t.error),a.showErrorlog(i)}else a.nodes.inputTextarea.val("")})),"function"==typeof e.userTrack&&e.userTrack({event:"clickSend",convId:a.currentConvId,content:a.nodes.inputTextarea.val()})}),a.nodes.inputTextarea.on("keydown",function(e){13===e.keyCode&&e.ctrlKey===!1&&(e.preventDefault(),a.nodes.inputSendBtn.trigger("click"))}),a.nodes.inputPicBtn.on("click",function(){a.nodes.inputPicUpload.trigger("click")}),a.nodes.inputPicUpload.on("change",function(e){a.sendPic(a.currentConvId,a.nodes.inputPicUpload[0].files[0],function(e){$.isEmptyObject(e)&&a.showErrorlog("å¾çåéå¤±è´¥")})}),a.nodes.talkwindowChatContainer.delegate(".chat-content","contextmenu",function(e){e.preventDefault(),e.stopPropagation(),$(".msgRecall").remove();for(var t=$(this).closest(".chat-block"),i=t.data("msgid"),n=a.imData[a.currentConvId].msgList,o=n.length,r={},s=0;s<o;s++)n[s].id==i&&(r=n[s]);if(r.fromUcid===a.core.ucid&&r.sendTime>Date.now()-12e4-a.core.timeOffset){var c=$(a.msgRecallTemplate.render({timestamp:t.data("msgtime"),msgid:i}));if($("[data-msgid="+i+"] .chat-content").find(".msgRecall").length)return;$("[data-msgid="+i+"] .chat-content").append(c)}}).delegate(".chat-msg-recall","click",function(e){var t=$(this).data("msgid");a.core.recallMsg({msg_id:t,conv_id:a.currentConvId,callback:function(e){return e?void a.core.triggerSyncMsg(a.core.currentSeq):void a.showErrorlog("æ¶æ¯æ¤åå¤±è´¥")}})}),a.rootnode.on("click",function(e){$(".msgRecall").remove()}),a.nodes.talkwindowChatContainer.on("scroll",function(){a.loadHist()}),function(){var e=!1,t=function(){setTimeout(function(){e&&a.nodes.pcard.stop().fadeOut(100,function(){a.nodes.pcard.css({top:"9999em",left:"9999em"})})},100)};a.nodes.talkwindow.on("mouseenter",'.chat-in [data-role="im-window-avatar"]',function(){e=!1;var t=$(this),i=a.agentData[a.imData[a.currentConvId].convObj.peer.ucid];i&&(a.updatePcard(i),a.nodes.pcard.css({top:t.position().top-t.height()/2+13+a.nodes.talkwindowMsgContainer.position().top,left:t.position().left+t.width()/2+a.nodes.talkwindowMsgContainer.position().left}).stop().fadeIn(100))}).on("mouseleave",'.chat-in [data-role="im-window-avatar"]',function(){e=!0,t()}),a.nodes.pcard.on("mouseenter",function(){e=!1}).on("mouseleave",function(){e=!0,t()})}(),a.renderConvList()}),a.initMessageList(),a.imBaseInteractiveInit(e),a.core.initialize()})):this.imBaseInteractiveInit(e),t&&t()}$.template=function(){var rsplit=function(e,t){for(var a,i,n,o=t.exec(e),r=new Array;null!=o;)a=o.index,i=t.lastIndex,0!=a&&(n=e.substring(0,a),r.push(e.substring(0,a)),e=e.slice(a)),r.push(o[0]),e=e.slice(o[0].length),o=t.exec(e);return""==!e&&r.push(e),r},chop=function(e){return e.substr(0,e.length-1)},extend=function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},EJS=function(e){if(e="string"==typeof e?{view:e}:e,this.set_options(e),e.precompiled)return this.template={},this.template.process=e.precompiled,void EJS.update(this.name,this);if(e.element){if("string"==typeof e.element){var t=e.element;if(e.element=document.getElementById(e.element),null==e.element)throw t+"does not exist!"}e.element.value?this.text=e.element.value:this.text=e.element.innerHTML,this.name=e.element.id,this.type="["}else if(e.url){e.url=EJS.endExt(e.url,this.extMatch),this.name=this.name?this.name:e.url;var a=e.url,i=EJS.get(this.name,this.cache);if(i)return i;if(i==EJS.INVALID_PATH)return null;try{this.text=EJS.request(a+(this.cache?"":"?"+Math.random()))}catch(e){}if(null==this.text)throw{type:"EJS",message:"There is no template at "+a}}var i=new EJS.Compiler(this.text,this.type);i.compile(e,this.name),EJS.update(this.name,this),this.template=i};return EJS.prototype={render:function(e,t){e=e||{},this._extra_helpers=t;var a=new EJS.Helpers(e,t||{});return this.template.process.call(e,e,a)},update:function(element,options){return"string"==typeof element&&(element=document.getElementById(element)),null==options?(_template=this,function(e){EJS.prototype.update.call(_template,element,e)}):void("string"==typeof options?(params={},params.url=options,_template=this,params.onComplete=function(request){var object=eval(request.responseText);EJS.prototype.update.call(_template,element,object)},EJS.ajax_request(params)):element.innerHTML=this.render(options))},out:function(){return this.template.out},set_options:function(e){this.type=e.type||EJS.type,this.cache=null!=e.cache?e.cache:EJS.cache,this.text=e.text||null,this.name=e.name||null,this.ext=e.ext||EJS.ext,this.extMatch=new RegExp(this.ext.replace(/\./,"."))}},EJS.endExt=function(e,t){return e?(t.lastIndex=0,e+(t.test(e)?"":this.ext)):null},EJS.Scanner=function(e,t,a){extend(this,{left_delimiter:t+"%",right_delimiter:"%"+a,double_left:t+"%%",double_right:"%%"+a,left_equal:t+"%=",left_comment:t+"%#"}),this.SplitRegexp="["==t?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:new RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)"),this.source=e,this.stag=null,this.lines=0},EJS.Scanner.to_text=function(e){return null==e||void 0===e?"":e instanceof Date?e.toDateString():e.toString?e.toString():""},EJS.Scanner.prototype={scan:function(e){if(scanline=this.scanline,regex=this.SplitRegexp,""==!this.source)for(var t=rsplit(this.source,/\n/),a=0;a<t.length;a++){var i=t[a];this.scanline(i,regex,e)}},scanline:function(e,t,a){this.lines++;for(var i=rsplit(e,t),n=0;n<i.length;n++){var o=i[n];if(null!=o)try{a(o,this)}catch(e){throw{type:"EJS.Scanner",line:this.lines}}}}},EJS.Buffer=function(e,t){this.line=new Array,this.script="",this.pre_cmd=e,this.post_cmd=t;for(var a=0;a<this.pre_cmd.length;a++)this.push(e[a])},EJS.Buffer.prototype={push:function(e){this.line.push(e)},cr:function(){this.script=this.script+this.line.join("; "),this.line=new Array,this.script=this.script+"\n"},close:function(){if(this.line.length>0){for(var e=0;e<this.post_cmd.length;e++)this.push(pre_cmd[e]);this.script=this.script+this.line.join("; "),line=null}}},EJS.Compiler=function(e,t){this.pre_cmd=["var ___ViewO = [];"],this.post_cmd=new Array,this.source=" ",null!=e&&("string"==typeof e?(e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),this.source=e):e.innerHTML&&(this.source=e.innerHTML),"string"!=typeof this.source&&(this.source="")),t=t||"<";var a=">";switch(t){case"[":a="]";break;case"<":break;default:throw t+" is not a supported deliminator"}this.scanner=new EJS.Scanner(this.source,t,a),this.out=""},EJS.Compiler.prototype={compile:function(options,name){options=options||{},this.out="";var put_cmd="___ViewO.push(",insert_cmd=put_cmd,buff=new EJS.Buffer(this.pre_cmd,this.post_cmd),content="",clean=function(e){return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\n/g,"\\n"),e=e.replace(/"/g,'\\"')};this.scanner.scan(function(e,t){if(null==t.stag)switch(e){case"\n":content+="\n",buff.push(put_cmd+'"'+clean(content)+'");'),buff.cr(),content="";break;case t.left_delimiter:case t.left_equal:case t.left_comment:t.stag=e,content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),content="";break;case t.double_left:content+=t.left_delimiter;break;default:content+=e}else switch(e){case t.right_delimiter:switch(t.stag){case t.left_delimiter:"\n"==content[content.length-1]?(content=chop(content),buff.push(content),buff.cr()):buff.push(content);break;case t.left_equal:buff.push(insert_cmd+"(EJS.Scanner.to_text("+content+")))")}t.stag=null,content="";break;case t.double_right:content+=t.right_delimiter;break;default:content+=e}}),content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),buff.close(),this.out=buff.script+";";var to_be_evaled="/*"+name+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";try{eval(to_be_evaled)}catch(e){if("undefined"==typeof JSLINT)throw e;JSLINT(this.out);for(var i=0;i<JSLINT.errors.length;i++){var error=JSLINT.errors[i];if("Unnecessary semicolon."!=error.reason){error.line++;var e=new Error;throw e.lineNumber=error.line,e.message=error.reason,options.view&&(e.fileName=options.view),e}}}}},EJS.config=function(e){EJS.cache=null!=e.cache?e.cache:EJS.cache,EJS.type=null!=e.type?e.type:EJS.type,EJS.ext=null!=e.ext?e.ext:EJS.ext;var t=EJS.templates_directory||{};EJS.templates_directory=t,EJS.get=function(e,a){return 0==a?null:t[e]?t[e]:null},EJS.update=function(e,a){null!=e&&(t[e]=a)},EJS.INVALID_PATH=-1},EJS.config({cache:!0,type:"<",ext:".ejs"}),EJS.Helpers=function(e,t){this._data=e,this._extras=t,extend(this,t)},EJS.Helpers.prototype={view:function(e,t,a){return a||(a=this._extras),t||(t=this._data),new EJS(e).render(t,a)},to_text:function(e,t){return null==e||void 0===e?t||"":e instanceof Date?e.toDateString():e.toString?e.toString().replace(/\n/g,"<br />").replace(/''/g,"'"):""}},EJS.newRequest=function(){for(var e=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=0;t<e.length;t++)try{var a=e[t]();if(null!=a)return a}catch(e){continue;
}},EJS.request=function(e){var t=new EJS.newRequest;t.open("GET",e,!1);try{t.send(null)}catch(e){return null}return 404==t.status||2==t.status||0==t.status&&""==t.responseText?null:t.responseText},EJS.ajax_request=function(e){e.method=e.method?e.method:"GET";var t=new EJS.newRequest;t.onreadystatechange=function(){4==t.readyState&&(200==t.status?e.onComplete(t):e.onComplete(t))},t.open(e.method,e.url),t.send(null)},function(e){return new EJS({text:e,type:"<"})}}(),$.Trans=_Trans(),$.EventEmitter=_EventEmitter(),window.LJMessenger=function(){function e(e,t){var a="";if(arguments.length<2?a="target error - target and name are both requied":"object"!=typeof e?a="target error - target itself must be window object":"string"!=typeof t&&(a="target error - target name must be string type"),a)throw new Error(a);this.target=e,this.name=t}function t(e,t){this.targets={},this.name=e,this.listenFunc=[],a=t||a,"string"!=typeof a&&(a=a.toString()),this.initListen()}var a="[LIANJIA_Messenger_CROSS]",i="postMessage"in window;return i?e.prototype.send=function(e){this.target.postMessage(a+e,"*")}:e.prototype.send=function(e){var t=window.navigator[a+this.name];if("function"!=typeof t)throw new Error("target callback function is not defined");t(a+e,window)},t.prototype.addTarget=function(t,a){var i=new e(t,a);this.targets[a]=i},t.prototype.initListen=function(){var e=this,t=function(t){if("object"==typeof t&&t.data&&(t=t.data),t&&"string"==typeof t&&t.indexOf(a)>=0){t=t.slice(a.length);for(var i=0;i<e.listenFunc.length;i++)e.listenFunc[i](t)}};i?"addEventListener"in document?window.addEventListener("message",t,!1):"attachEvent"in document&&window.attachEvent("onmessage",t):window.navigator[a+this.name]=t},t.prototype.listen=function(e){this.listenFunc.push(e)},t.prototype.clear=function(){this.listenFunc=[]},t.prototype.send=function(e){var t,a=this.targets;for(t in a)a.hasOwnProperty(t)&&a[t].send(e)},t}(),$.parseURL&&"[object Function]"===Object.prototype.toString.call($.parseURL)||($.parseURL=function(e){if(!e)return null;for(var t=/^((?:([A-Za-z]+):(\/{0,3}))?([0-9.\-A-Za-z]+\.[0-9A-Za-z]+)?(?::(\d+))?)(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,a=["url","origin","scheme","slash","host","port","path","query","hash"],i=t.exec(e),n={},o=0,r=a.length;r>o;o+=1)n[a[o]]=i[o]||"";return n});var sticker=_sticker,$win=$(window),$body=$(document.body),apiRoot=function(){for(var e=window.location,t=e.host,a=["dev","test","offline","self","selfnew","beta"],i=null;(i=a.pop())&&!(t.indexOf(i)>=0););i=i?"test":"prod";var n={dev:"http://ajax.testapi.lianjia.com:7081/",test:"http://ajax.testapi.lianjia.com/",prod:"//ajax.api.lianjia.com/"},o={dev:{msg:"https://imapi-test.lianjia.com",media:"https://imm-test.lianjia.com"},test:{msg:"https://imapi-test.lianjia.com",media:"https://imm-test.lianjia.com"},prod:{msg:"https://imapi.lianjia.com",media:"https://imm.lianjia.com"}},r={dev:"http://imscheduler.sinan.off.test.lianjia.com:10103/webchat/satisfaction",test:"http://imscheduler.sinan.off.test.lianjia.com:10103/webchat/satisfaction",prod:"https://ajax.api.lianjia.com/web/remark/satisfaction"},s={dev:"http://10.30.128.254:8050/",test:"http://test5-newhouseapi.fang.lianjia.com/",prod:"//newhouseapi.ke.com/"},c={dev:"http://10.30.129.193:9002/",test:"http://testapi.zufangzi.com/",prod:"//api.zufangzi.com/"},d={dev:"http://10.30.129.109:8058/",test:"http://preview-ajax.api.ke.com/",prod:"//ajax.api.ke.com/"};return{ljApi:n[i],imApi:o[i],satisfaction:r[i],xfApi:s[i],zulinApi:c[i],ke_ershouApi:d[i]}}(),_util={noop:function(){},pad:function(e){return("0"+e).slice(-2)},httpHtml:function(e){var t=/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|&|-)+)/g;return/ke.com|lianjia.com|realsee.com/.test(e)?e.replace(t,'<a href="$1$2" target="_blank">$1$2</a>'):e},timeFormat:function(e,t,a){var i=new Date(e),n=i.getFullYear()+"",o=this.pad(i.getMonth()+1),r=this.pad(i.getDate()),s=this.pad(i.getHours()),c=this.pad(i.getMinutes()),d=this.pad(i.getSeconds()),l="";switch(t){case"deltaTime":var u=new Date;l=i.getFullYear()===u.getFullYear()&&i.getMonth()===u.getMonth()&&i.getDate()===u.getDate()?s+":"+c:u.getTime()-i.getTime()<864e5?"æ¨å¤© "+s+":"+c:a.replace(/YYYY/g,n).replace(/MM/g,o).replace(/DD/g,r).replace(/hh/g,s).replace(/mm/g,c).replace(/ss/g,d);break;default:l=t.replace(/YYYY/g,n).replace(/MM/g,o).replace(/DD/g,r).replace(/hh/g,s).replace(/mm/g,c).replace(/ss/g,d)}return l},getCookie:function(e){if(document.cookie.length>0){var t=document.cookie.indexOf(e+"="),a=0;if(t!=-1)return t=t+e.length+1,a=document.cookie.indexOf(";",t),a==-1&&(a=document.cookie.length),decodeURI(document.cookie.substring(t,a))}return""},setCookie:function(e,t,a){var i=new Date;i.setDate(i.getDate()+a),document.cookie=e+"="+encodeURI(t)+(null==a?"":";expires="+i.toUTCString())},apiUrl:function(e){return apiRoot.ljApi+e},xinfangUrl:function(e){return apiRoot.xfApi+e},zulinUrl:function(e){return apiRoot.zulinApi+e},ke_ershouUrl:function(e){return apiRoot.ke_ershouApi+e},imApiUrl:function(e){return apiRoot.imApi.msg+e}};return LianjiaIM.queue={},window.__lianjiaIMVersion="é¾æ¥ + è¡¨æ",LianjiaIM.prototype={constructor:LianjiaIM,clickConvItemTrck:function(){return!!this.core&&(this.core.port="im_convlist",void(this.core.extAttr=null))},createTalkTrack:function(e,t){return!!this.core&&(this.core.port=e,void(t&&(this.core.extAttr="string"==typeof t?JSON.parse(t):t)))},imBaseInteractiveInit:function(e){var t=this;t.nodes.serviceItemContainer.on("click",function(a){a.preventDefault(),t.showBang(!0,!0),t.nodes.serviceItemContainer.find('[data-role="im-listitem-item-newmsg"]').attr("data-newmsg",0).text(0).hide(),t.updateHeadUnread(),t.firstInitMessageList&&(t.firstInitMessageList=!1,t.bangData.conv_id?(t.userData.code||(t.header["Lianjia-Uuid"]=t.userData.ucid,t.core=new ImCore({msgApiRoot:apiRoot.imApi.msg,mediaApiRoot:apiRoot.imApi.media,apiheader:t.header,appkey:t.pageConf.appkey,ucid:t.userData.ucid}),t.initMessageList(),t.core.initialize()),t.bangData.skillCode?(t.bangTalkDisable(!1),t.bangShowEnd(!0)):(t.bangRenderType(),t.bangTalkDisable(!0),t.bangShowEnd(!0))):t.userData.code?t.core.create([e.is_ljbb&&"SN_LJBB"||e.is_bkbb&&"KE_KEFU"],3,function(e){return $.isEmptyObject(e)?void t.bangRenderSysMsg("ä¼è¯åå»ºå¤±è´¥"):(t.bangData.conv_id=e.id,t.BangInfoNow={conv_id:e.id},t.updateBangInfo(),t.bangRenderType(),void t.initMessageList())}):(t.header["Lianjia-Uuid"]=t.userData.ucid,t.core=new ImCore({msgApiRoot:apiRoot.imApi.msg,mediaApiRoot:apiRoot.imApi.media,apiheader:t.header,appkey:t.pageConf.appkey,ucid:t.userData.ucid}),t.core.create([e.is_ljbb&&"SN_LJBB"||e.is_bkbb&&"KE_KEFU"],3,function(e){return $.isEmptyObject(e)?void t.bangRenderSysMsg("ä¼è¯åå»ºå¤±è´¥"):(t.bangData.conv_id=e.id,t.BangInfoNow={conv_id:e.id},t.updateBangInfo(),t.bangRenderType(),t.initMessageList(),void t.core.initialize())})),t.clickConvItemTrck(),"function"==typeof e.userTrack?(e.userTrack({ljweb_mod:"bangbangclick",ljweb_bl:t.userData.code?"1":"0",ljweb_el:"BB120",ljweb_group:1}),e.userTrack({ljweb_mod:"bangbangclick",ljweb_bl:t.userData.code?"1":"0",ljweb_el:"BB120",ljweb_group:1})):(window.LjUserTrack&&LjUserTrack.send&&LjUserTrack.send({ljweb_mod:"bangbangclick",ljweb_bl:t.userData.code?"1":"0",ljweb_el:"BB120",ljweb_group:1}),window.LjUserTrack&&LjUserTrack.send&&LjUserTrack.send({ljweb_mod:"bangbangclick",ljweb_bl:t.userData.code?"1":"0",ljweb_el:"BB120",ljweb_group:1,evt_id:"10190"})))}),t.nodes.talkBangMsgContainer.on("click",'[data-role="bang-type"]',function(){var e=($(this).closest(".chat-block"),$(this).data("value")),a=$(this).text();t.bangData.skillCode=e,t.BangInfoNow.skillCode=e,t.updateBangInfo(),t.bangRenderMsg(t.core.encodeHtml(a),!0),t.bangInline()}).on("click",'[data-role="inline-again"]',function(){t.bangRenderType()}),t.sendUrlBang=function(){var e=window.location.href;if(null!==e.match(t.housecardReg)){var a=e.replace(t.housecardReg,"$3");t.getHouseCard(a,function(e){t.core.sendTo(t.bangData.conv_id,{type:1,payload:JSON.stringify(e)},function(e){})},function(){})}else if(null!==e.match(t.xinfangcardReg)){var i=e.replace(t.xinfangcardReg,"$2");t.getXinfangCard(i,function(e){t.core.sendTo(t.bangData.conv_id,{type:6,payload:JSON.stringify(e)},function(e){})},function(){})}else t.core.sendTo(t.bangData.conv_id,{type:99,payload:JSON.stringify({title:"",content:"",url:window.location.href,coverUrl:""})},function(e){})},t.nodes.talkBangMsgContainer.on("mouseenter mouseleave click",".appraise-star",function(e){function t(e){e=e||5,n.text(e+"å"),i.removeClass("active").slice(0,e).addClass("active")}var a=$(this).closest(".appraise-type-item"),i=a.find(".appraise-star"),n=a.find(".appraise-num"),o=(a.attr("data-value")||5,+$(this).index()+1);"click"==e.type?(a.attr("data-value",o),t(o)):t("mouseenter"==e.type?o:a.attr("data-value"))}),t.nodes.talkBangMsgContainer.on("click",".appraise-btn-submit",function(e){$(this).closest(".bang-appraise").addClass("disabled");var a={callUuid:t.bangData.callUuid};t.nodes.talkBangMsgContainer.find(".appraise-type-item").each(function(e,t){var i=$(this).attr("data-name"),n=$(this).attr("data-value");a[i]=n});var i=$.trim(t.nodes.talkBangMsgContainer.find('[data-role="appraise-textarea"]').val());i&&(a.suggest=i.slice(0,120)),t.nodes.talkBangMsgContainer.find(".bang-appraise").closest("li").remove(),t.bangRenderMsg(t.is_bkbb?"æè°¢æ¨çè¯ä»·åé¦ï¼è´å£³æ¾æ¿å°ä¼è¶æ¥è¶å¥½ã":"æè°¢æ¨çè¯ä»·åé¦ï¼é¾å®¶ç½å°ä¼è¶æ¥è¶å¥½ã"),$.post(apiRoot.satisfaction,a)}),t.nodes.talkBangMsgContainer.on("click",".appraise-btn-cancel",function(e){t.nodes.talkBangMsgContainer.find(".bang-appraise").closest("li").remove(),t.bangRenderMsg("æ¨å·²åæ¶æå¡è¯ä»·")}),t.nodes.talkBangTextarea.on("keydown",function(e){13===e.keyCode&&e.ctrlKey===!1&&(e.preventDefault(),t.nodes.talkBangSend.trigger("click"))}),t.nodes.talkBangSend.on("click",function(){var e=$.trim(t.nodes.talkBangTextarea.val());e&&(t.nodes.talkBangSend.val("åéä¸­...").prop({disabled:!0}),t.sendMsg(t.bangData.conv_id,e,function(a){t.nodes.talkBangSend.val("åé").prop({disabled:!1}),t.nodes.talkBangTextarea.val(""),t.bangRenderMsg(t.core.encodeHtml(e),!0)}))}),t.nodes.talkBangEnd.on("click",function(e){t.bangTalkDisable(!0),t.bangHangup(t.bangData.conv_id,function(){t.bangRenderSysMsg('<span>æ¨ææ­äºéè¯</span><span class="btn-handle" data-role="inline-again">éæ°è¿çº¿</span>'),t.bangRenderAppraise()})}),t.nodes.picBtnBang.on("click",function(){t.nodes.picInputBang.trigger("click")}),t.nodes.picInputBang.on("change",function(e){t.sendPic(t.bangData.conv_id,t.nodes.picInputBang[0].files[0],function(e){if(e){var a=JSON.parse(e.payload);t.bangRenderPic(a,!0)}else t.bangRenderSysMsg("å¾çåéå¤±è´¥")})}),$body.on("click.lianjiaim",'a[data-role="lianjiaim-createtalk"]',function(a){a.preventDefault();var i=$(this);t.initTalk(i.attr("data-ucid"),i.data("source-port")),t.createTalkTrack(i.data("source-port"),i.data("source-extends")),"function"==typeof e.userTrack?(e.userTrack({ljweb_mod:"imclick",ljweb_bl:t.userData.code?"1":"0",ljweb_el:i.attr("data-ucid"),ljweb_group:1}),e.userTrack({ljweb_mod:"imclick",ljweb_bl:t.userData.code?"1":"0",ljweb_el:i.attr("data-ucid"),ljweb_group:1,evt_id:"10190"})):(window.LjUserTrack&&LjUserTrack.send&&LjUserTrack.send({ljweb_mod:"imclick",ljweb_bl:t.userData.code?"1":"0",ljweb_el:i.attr("data-ucid"),ljweb_group:1}),window.LjUserTrack&&LjUserTrack.send&&LjUserTrack.send({ljweb_mod:"imclick",ljweb_bl:t.userData.code?"1":"0",ljweb_el:i.attr("data-ucid"),ljweb_group:1,evt_id:"10190"}))}),$body.append(this.rootnode),this.nodes.head.on("click",function(a){"function"==typeof e.userTrack&&e.userTrack({event:"openIm",target:t.isFolding}),t.fold(!t.isFolding)}),t.nodes.is_accuse.on("click",function(e){t.nodes.cover.show(),t.nodes.accuseModal.show(),"ä¸¾æ¥"===t.nodes.accuseText.html()?(t.nodes.setAccuse.show(),t.nodes.cancelAccuse.hide()):(t.nodes.setAccuse.hide(),t.nodes.cancelAccuse.show())}),t.nodes.closeModal.on("click",function(e){t.nodes.accuseModal.hide(),t.nodes.cover.hide()}),t.nodes.accuseType.on("click",function(e){t.is_accuse=e.target.value,t.accuseType=1}),t.nodes.confirm.on("click",function(e){var a={type:2===t.accuseType?"TONGYE":t.is_accuse,ucid:t.imData[t.currentConvId].convObj.peer.ucid,op_type:t.accuseType};t.core&&t.core.accuse(a,function(e){if(0===e.errno)if(1===t.accuseType){var a={WEISHANG:"å¾®å",TONGYE:"åä¸",SAORAO:"éªæ°"};t.nodes.accuseText.html("åæ¶ä¸¾æ¥"),t.nodes.reportCelling.show(),t.nodes.reportText.html("æ¨å·²å°TAæ æ³¨ä¸º"+a[t.is_accuse]),t.accuseType=2}else t.nodes.accuseText.html("ä¸¾æ¥"),t.nodes.reportCelling.hide(),t.accuseType=1;t.nodes.closeModal.trigger("click")})}),t.nodes.talkBang.on("click",'[data-role="bang-close"]',function(){t.currentConvId="",t.showBang(!1)})},getUcData:function(e,t){t=t||_util.noop,"string"==typeof e&&(e=[e]),this.core.getUsersInfo({ucids:e.join(",")},t)},updateArrive_Read:function(e){var t=[],a=null;this.currentConvId&&this.imData[this.currentConvId]&&(t=this.imData[this.currentConvId].msgList,a=this.imData[this.currentConvId].readInfo);var i=0;if(e.isFormOther&&this.currentConvId){i=a?a.read:t[t.length-1].readMsgId,$(".chat-content .readState").remove();var n=document.createElement("div");n.innerText="å·²è¯»",n.className="readState",$("[data-msgid="+i+"] .chat-content").append(n)}},filterSupportMsg:function(e){var t=[],a=[-1,-2,-6,1,2,3,7,5,6,99,8,105,109,211,310,320,330,400,120,121,600,122,123,124,125,800,802,804];return $.each(e,function(){var e=this;a.some(function(t){return t===e.type})&&t.push(e)}),t},getMsgSummary:function(e){var t="";if(e)switch(e.type){case-1:t=e.payload;break;case-2:t="[å¾ç]";break;case 105:t="[èªå¨åå¤]"+e.payload;break;case 109:t="["+(JSON.parse(e.payload).emoticonName||"è¡¨æ")+"]";break;case 1:t="[æ¿æº]";break;case 6:t="[æ¥¼ç]";default:t=e.summary}return t},showIM:function(){this.fold(!1)},hideIM:function(){$("div.lianjiaim-wrap").hide(),this.fold(!0)},on:function(e,t){LianjiaIM.queue[e]||(LianjiaIM.queue[e]=[]),LianjiaIM.queue[e].push(t)},off:function(e,t){if(LianjiaIM.queue[e]){var a=LianjiaIM.quenen[e].indexOf(t);LianjiaIM.queue[e].splice(a,1)}},emit:function(e){var t=LianjiaIM.queue[e];if(t)for(var a=0;a<t.length;a++)"IMUnReadMsgNum"===e?t[a](this.unreadSum):t[a]()},initTalk:function(e){var t=this,a=arguments,i="",n="",o="",r="",s="";if(!this.userData.code)return void(this.login&&"[object Function]"===Object.prototype.toString.call(this.login)?this.login():"undefined"!=typeof login?login.openLoginDialog&&login.openLoginDialog():alert("è¯·åç»å½åå¼å§èå¤©ï¼"));var c=Object.prototype.toString.call(a[0]);if("[object Object]"===c?(i=e.ucid||"",n=e.port||"",o=e.msgPayload,r=e.scheme,s=e.push_content||"ä½ æä¸æ¡æ°æ¶æ¯",this.core&&(this.core.extAttr=JSON.parse(e.extends||"null"))):"[object String]"===c&&(i=a[0]||"",n=a[1]||"im",this.core&&(this.core.extAttr=JSON.parse(a[2]||"null"))),i!==this.userData.ucid&&""!==i){t.core&&(t.core.port=n);var d=~this.publicAccounts.indexOf(i),l=d?3:1;t.core&&t.core.create(i,l,function(e){if(null!==e){if(t.updateImDataConv(e.id,"convObj",e),null===t.imData[e.id].itemNode&&t.addConvItemNode(t.imData[e.id].convObj),t.fold(!1),t.setWindow(e.id),t.showWindow(!0),t.scrollWindow("btm"),d&&t.core.convEnter(e.id),r&&t.sendCard(r,s),o&&t.sendMsg(e.id,o,function(e){$.isEmptyObject(e)&&t.showErrorlog("æ¶æ¯åéå¤±è´¥")}),null!==window.location.href.match(t.housecardReg)){var a=window.location.href.replace(t.housecardReg,"$3");t.housecardStat.check(i,a)&&t.sendMsg(e.id,window.location.href,function(e){t.housecardStat.set(i,a),$.isEmptyObject(e)&&t.showErrorlog("æ¶æ¯åéå¤±è´¥")},!1,1)}if(null!==window.location.href.match(t.xinfangcardReg)){var n=window.location.href.replace(t.xinfangcardReg,"$2"),c=window.location.href.replace(t.xinfangcardReg,"$3");if("wenda"===n&&c.indexOf("project_name")==-1)return;t.housecardStat.check(i,n)&&t.sendMsg(e.id,window.location.href,function(e){t.housecardStat.set(i,n),$.isEmptyObject(e)&&t.showErrorlog("æ¶æ¯åéå¤±è´¥")})}if(null!==window.location.href.match(t.ke_ershouCardReg)){var l=window.location.href.replace(t.ke_ershouCardReg,"$2");t.housecardStat.check(i,l)&&t.sendMsg(e.id,window.location.href,function(e){t.housecardStat.set(i,l),$.isEmptyObject(e)&&t.showErrorlog("æ¶æ¯åéå¤±è´¥")})}if(null!==window.location.href.match(t.chengjiao_ershouCardReg)){var u=window.location.href.replace(t.chengjiao_ershouCardReg,"$2");t.housecardStat.check(i,u)&&t.sendMsg(e.id,window.location.href,function(e){t.housecardStat.set(i,u),$.isEmptyObject(e)&&t.showErrorlog("æ¶æ¯åéå¤±è´¥")})}}else t.showErrorlog("ä¼è¯åå»ºå¤±è´¥")})}},sendMsg:function(e,t,a,i,n){a=a||_util.noop;var o=this;if($.trim(t).length>0)if(i||null===t.match(this.housecardReg))if(i||null===t.match(o.xinfangcardReg))if(i||null===t.match(o.zulincardReg))if(i||null===t.match(o.ke_ershouCardReg)&&null===t.match(o.chengjiao_ershouCardReg)){var r=t,s=null;r.length>500&&(r=t.slice(0,500),s=t.slice(500)),this.core.sendTo(e,{type:-1,localId:+new Date,payload:this.core.encodeHtml(r)},function(t,i,n){null!==s?o.sendMsg(e,s,a):a(t,n)})}else{var c=t.match(o.ke_ershouCardReg)||t.match(o.chengjiao_ershouCardReg),d={oriMsg:t,beforeMsg:c[1]||"",house_code:c[2]||"",afterMsg:c[3]||""};this.sendKeErshouCard(e,d,a)}else{var c=t.match(o.zulincardReg),d={oriMsg:t,beforeMsg:c[1]||"",house_code:c[2]||""};this.sendZulincard(e,d,a)}else{var l="",u=t.replace(o.xinfangcardReg,"$2"),p=t.replace(o.xinfangcardReg,"$3");l="wenda"===u?p.substring(p.indexOf("=")+1):u;var m={oriMsg:t,beforeMsg:t.replace(o.xinfangcardReg,"$1"),project_name:l};this.sendXinfangcard(e,m,a,n)}else{var d={oriMsg:t,beforeMsg:t.replace(this.housecardReg,"$1"),houseType:t.replace(this.housecardReg,"$2"),houseCode:t.replace(this.housecardReg,"$3")};this.sendHousecard(e,d,a)}else a({noSend:!0})},sendCard:function(e,t,a){var i=this,n={scheme:e,desc:"[[æ¨æ¶å°ä¸æ¡æ¶æ¯ï¼è¯·åçº§APPçæ¬åæ¥ç]]",push_content:t};i.send330Msg(i.currentConvId,n,function(e){var t={msg_id:e.data.msg_id,conv_id:e.data.conv_id,scheme:n.scheme};i.init330card(t,i.core.ucid),a&&a()})},sendPic:function(e,t,a){a=a||_util.noop,this.core.uploadPicture(e,t,function(t,i){var n=JSON.parse(t),o=i.encodeHtml(n.original);n.original=o,i.sendTo(e,{type:-2,payload:JSON.stringify(n)},function(e){a(e)})})},sendHousecardMsg:function(e,t,a){a=a||_util.noop,this.core.sendTo(e,{type:1,localId:+new Date,payload:JSON.stringify(t)},function(e){a(e)})},sendHousecard:function(e,t,a){a=a||_util.noop;var i=this;i.getHouseCard(t.houseCode,function(n){i.sendMsg(e,t.beforeMsg,function(){i.sendHousecardMsg(e,n,function(e){a(e)})})},function(){throw i.showErrorlog("æ æ³è·åæ¿æºå¡çä¿¡æ¯"),i.sendMsg(e,t.oriMsg,function(){a()},!0),new Error("æ æ³è·åæ¿æºå¡çä¿¡æ¯")})},getHouseCard:function(e,t,a){$.ajax({url:_util.apiUrl("house/house/gethousecard"),data:{house_code:e},dataType:"jsonp",success:function(e){if(0===e.errno){var i=Object.assign({houseCode:e.data.house_code,houseName:e.data.title,houseImgUrl:e.data.cover_pic,houseHallCount:e.data.blueprint_hall_num,houseBedroomCount:e.data.blueprint_bedroom_num,area:e.data.area,price:e.data.price,orientation:e.data.orientation,schemeUrl:e.data.m_url},e.data);switch(e.data.house_type){case"ershoufang":case"sell":i.houseType=1;break;case"zufang":case"rent":i.houseType=1}switch(e.data.house_state){case"zai_shou":i.houseState=1;break;case"yi_shou":i.houseState=2;break;case"ting_shou":i.houseState=3}t&&t(i)}else a&&a()}})},sendXinfangcardMsg:function(e,t,a){a=a||_util.noop,this.core.sendTo(e,{type:6,localId:+new Date,payload:JSON.stringify(t)},function(e){a(e)})},sendXinfangcard:function(e,t,a,i){a=a||_util.noop;var n=this;n.getXinfangCard(t.project_name,function(i){n.sendMsg(e,t.beforeMsg,function(){n.sendXinfangcardMsg(e,i,function(e){a(e)})})},function(i){throw n.showErrorlog("æ æ³è·åæ¿æºå¡çä¿¡æ¯"),n.sendMsg(e,t.oriMsg,function(){a()},!0),new Error("æ æ³è·åæ¿æºå¡çä¿¡æ¯")},i)},getXinfangCard:function(e,t,a,i){$.ajax({url:_util.xinfangUrl("newhouse/api/resblock/imcard"),data:{project_name:e.replace("p_",""),source:1},type:"get",dataType:"json",success:function(e){if(0===e.errno){var n={buildingId:e.data.resblock_id,buildingName:e.data.resblock_name,buildingImgUrl:e.data.image_url,avgPrice:e.data.show_price_info,area:e.data.area,roomType:e.data.room_type,houseType:e.data.house_type,address:e.data.address_desc,cityCode:e.data.city_code,projectName:e.data.project_name,schemeUrl:e.data.pc_url,fromType:i?1:0};t&&t(n)}else a&&a()},error:function(e){a&&a(e)}})},sendZulincardMsg:function(e,t,a){a=a||_util.noop,this.core.sendTo(e,{type:1,localId:+new Date,payload:JSON.stringify(t)},function(e){a(e)})},sendZulincard:function(e,t,a,i){a=a||_util.noop;var n=this;n.getZulincard(t.house_code,function(i){n.sendMsg(e,t.beforeMsg,function(){n.sendZulincardMsg(e,i,function(e){a(e)})})},function(i){throw n.showErrorlog("æ æ³è·åæ¿æºå¡çä¿¡æ¯"),n.sendMsg(e,t.oriMsg,function(){a()},!0),new Error("æ æ³è·åæ¿æºå¡çä¿¡æ¯")},i)},getZulincard:function(e,t,a,i){function n(e,t){var a=[];return $.each(e,function(e,t){a.push(e+"="+t)}),a.sort(),a.join(t)}var o="74bd10b352473fd0ebac140dc9585581",r={house_code:e,ts:(Date.now()/1e3).toFixed(0)},s=n(r,"&"),c=n(r,"");$.ajax({url:_util.zulinUrl("v1/house/baseinfo")+"?"+s+"&rent_sign="+md5(o+c+"v1/house/baseinfo")+"&rent_app_id=lianjiaIM",data:{},dataType:"json",success:function(e){if(0===e.status){var i=e.data||{},n=i.layout?i.layout.match(/(\d+)å®¤(\d+)å(\d+)å«/)||[]:[],o={houseCode:i.house_code,houseType:2,houseName:i.house_title,houseImgUrl:i.list_picture,houseHallCount:parseInt(n[2],10)||0,houseBedroomCount:parseInt(n[1],10)||0,area:parseFloat(i.rent_area,10)||0,price:parseFloat(i.rent_price_listing,10)||0,orientation:i.frame_orientation,schemeUrl:i.pc_landing_page};t&&t(o)}else a&&a()},error:function(e){a&&a(e)}})},send330Msg:function(e,t,a){a=a||_util.noop,this.core.send330(e,{type:330,localId:+new Date,payload:JSON.stringify(t)},function(e){a(e)})},init330card:function(e,t){var a=this;this.core.get330card(e,function(i){var n=i.data,o=n.uiModel,r=$("li.card330."+e.msg_id);if(2===n.cardID)r.find(".type-1").hide(),r.find(".type-cardId1").hide(),r.find(".type-3").show(),r.find(".type-3-label").show(),r.find(".house-card").attr("href",n.webScheme),r.find(".im-housecard-img").html('<img style="height: 110px; width: 200px;" src='+o.imageUrl+" />"),r.find(".im-housecard-title").text(o.textTitle),r.find(".im-housecard-info").text(o.textContent1),r.find(".im-housecard-price").text(o.textContent2),r.find(".im-housecard-label").text(o.label);else if(1===n.cardID){r.find(".type-1").hide(),r.find(".type-3").hide(),r.find(".type-3-label").hide(),r.find(".type-cardId1").show(),r.find(".type-cardId1").css("width","initial"),r.find(".type-cardId1").css("max-width","initial"),r.find(".type-cardId1").css("box-sizing","border-box"),r.find(".type-cardId1").css("margin","0 10px"),r.find(".im-phonecard-title-text").text(o.title),r.find(".im-phonecard-title .system-avatar").attr("src",o.icon),r.find(".im-phonecard-desc").text(o.summary),r.find(".system-avatar").show();var s=r.find(".im-phonecard-btns");a.core.ucid==t?s.hide():(s.find(".im-phonecard-btn1").on("click",function(e){var t=e.target.dataset;a.update330PhoneCard({msg_id:t.msg_id,conv_id:t.conv_id,scheme:t.scheme},s)}),s.find(".im-phonecard-btn1").text(o.buttons[0].text).attr({"data-msg_id":e.msg_id,"data-conv_id":e.conv_id,"data-scheme":o.buttons[0].action}).css({color:o.buttons[0].textColor}),o.buttons[1]?(s.find(".im-phonecard-btn2").on("click",function(e){var t=e.target.dataset;a.update330PhoneCard({msg_id:t.msg_id,conv_id:t.conv_id,scheme:t.scheme},s)}),s.find(".im-phonecard-btn2").text(o.buttons[1].text).attr({"data-msg_id":e.msg_id,"data-conv_id":e.conv_id,"data-scheme":o.buttons[1].action}).css({color:o.buttons[1].textColor})):s.find(".im-phonecard-btn2").hide())}else r.find(".type-1").show(),r.find(".type-3").hide(),r.find(".type-cardId1").hide(),r.find(".type-3-label").hide()})},update330PhoneCard:function(e,t){e.scheme&&this.core.get330card(e,function(e){var a=e.data,i=a.uiModel;t.find(".im-phonecard-btn1").text(i.buttons[0].text).attr({"data-scheme":i.buttons[0].action}).css({color:i.buttons[0].textColor}),i.buttons[1]?t.find(".im-phonecard-btn2").text(i.buttons[1].text).attr({"data-scheme":i.buttons[1].action}).css({color:i.buttons[1].textColor}):t.find(".im-phonecard-btn2").hide()})},sendKeErshouCard:function(e,t,a,i){a=a||_util.noop;var n=this;n.getKeErshouCard(t.house_code,function(i){n.sendMsg(e,t.beforeMsg,function(){n.sendHousecardMsg(e,i,function(e){a(e)})})},function(i){throw n.showErrorlog("æ æ³è·åæ¿æºå¡çä¿¡æ¯"),n.sendMsg(e,t.oriMsg,function(){a(i)},!0),new Error("æ æ³è·åæ¿æºå¡çä¿¡æ¯")},i)},getKeErshouCard:function(e,t,a,i){$.ajax({url:_util.ke_ershouUrl("houseim/cardinfo"),data:{type:"pc",source:"im",houseCode:e,token:md5(e+"im_fds1324ere][;4%7!390")},type:"GET",dataType:"jsonp",success:function(e){if(0===e.errno){var i=e.data||{},n=Object.assign({houseCode:i.houseCode,houseType:i.houseType||1,isPriceOnly:i.isPriceOnly,houseName:i.houseName,houseImgUrl:i.houseImgUrl,houseHallCount:i.houseHallCount,houseBedroomCount:i.houseBedroomCount,area:i.area,price:i.price,houseState:i.houseState,orientation:i.orientation,schemeUrl:i.schemeUrl},i);t&&t(n)}else a&&a()},error:function(e){a&&a(e)}})},fold:function(e){e!==this.isFolding&&(this.isFolding=e,e?(this.rootnode.addClass("im-fold"),this.showWindow(!1),this.showBang(!1)):(this.rootnode.removeClass("im-fold"),this.visibleBang?this.showBang(!0):""!==this.currentConvId&&this.showWindow(!0)))},showWindow:function(e){this.scrollWindow("btm"),this.nodes.talkwindow[e?"show":"hide"](),e&&(this.visibleBang=!1,this.showBang(!1)),this.nodes.is_accuse.is(":visible")?this.nodes.topText.hide():this.nodes.topText.show()},showBang:function(e,t){e&&(this.visibleBang=!0),this.nodes.talkBang[e?"show":"hide"](),e&&this.showWindow(!1),t&&(this.rootnode.removeClass("im-fold"),this.isFolding=!1),this.scrollBangWindow("bottom")},scrollWindow:function(e){switch(e){case"top":this.nodes.talkwindowChatContainer.scrollTop(0);break;case"btm":this.nodes.talkwindowChatContainer.scrollTop(this.nodes.talkwindowMsgContainer.height());break;default:this.nodes.talkwindowChatContainer.scrollTop(e)}},renderConvList:function(e){var t=this;e||(e=t.imData),t.nodes.listItemContainer.html("");var a=[],i=0;$.each(e,function(e,i){i&&i.convObj&&(1===i.convObj.type||3===i.convObj.type&&t.publicAccount.indexOf(i.convObj.peer.ucid)>-1)&&a.push(i)}),a.sort(function(e,t){return e.convObj.mTime-t.convObj.mTime}),$.each(a,function(e,a){var n=a.convObj;t.addConvItemNode(n),i++}),i>0?(t.nodes.noagentContainer.hide(),t.nodes.listItemContainer.show()):(t.nodes.listItemContainer.hide(),t.nodes.noagentContainer.show())},updateImDataConv:function(e,t,a){this.imData[e]||(this.imData[e]={convObj:null,msgList:[],itemNode:null,readMsgId:0,hasHistory:!0});var i=this.imData[e];switch(t){case"convObj":i.convObj=a;break;case"msgList":i.msgList=a;break;case"itemNode":i.itemNode=a;break;case"readMsgId":i.readMsgId=a;break;case"hasHistory":i.hasHistory=a}},addConvItemNode:function(e){var t=this;if(!(!e||!e.peer||e.peer&&"SN_LJBB"===e.peer.ucid||e.peer&&"KE_KEFU"===e.peer.ucid||2===e.type||3===e.type&&t.publicAccount.indexOf(e.peer.ucid)===-1)){var a=$(this.listItemTemplate.render({item:{user_status:1,convId:e.id,convType:e.type,id:e.peer.ucid,name:e.title,avatar:e.avatar,summary:t.core.encodeHtml(e.summary)}}));this.updateImDataConv(e.id,"itemNode",a),this.nodes.listItemContainer.prepend(a),this.updateConvItemNode(e.id,{text:e.lastMsg,time:e.mTime})}},updateConvItemNode:function(e,t,a){var i=this.imData[e].itemNode;if(i){var n=i.find('[data-role="im-listitem-item-newmsg"]'),o=+n.attr("data-newmsg");t.text&&i.find('[data-role="im-listitem-item-text"]').html(this.core.encodeHtml(t.text)),t.time&&i.find('[data-role="im-listitem-item-time"]').html(_util.timeFormat(t.time,"deltaTime","YYYY-MM-DD")),void 0!==t.newmsgAmount&&("string"==typeof t.newmsgAmount&&null!==t.newmsgAmount.match(/\+/g)?o+=+t.newmsgAmount.replace(/\+/g,""):"number"==typeof t.newmsgAmount&&(o=t.newmsgAmount),n.attr({"data-newmsg":o}).html(o<=99?o:"99+"),o>0?n.show():n.hide()),a&&this.nodes.listItemContainer.prepend(i)}},updateHeadUnread:function(){var e=0;$.each(this.nodes.listItemContainer.find('[data-role="im-listitem-item"]'),function(){e+=+$(this).find('[data-role="im-listitem-item-newmsg"]').attr("data-newmsg")}),this.is_ljbb&&(e+=+this.nodes.serviceItemContainer.find('[data-role="im-listitem-item-newmsg"]').attr("data-newmsg")),this.nodes.headUnread.attr({"data-newmsg":e}).html(e<=99?e:"99+"),e>0?this.nodes.headUnread.show():this.nodes.headUnread.hide(),this.unreadSum=e,this.emit("IMUnReadMsgNum")},updatePcard:function(e){var t=function(e,t,a){var i="";return i=null===e?t:a?a.replace(/<r>/g,e):e};this.nodes.pcard.find('[data-role="im-pcard-avatar"]').attr({src:e.photo_url.replace(/\d+x\d+/g,"78x78")}),this.nodes.pcard.find('[data-role="im-pcard-name"]').html(e.name),this.nodes.pcard.find('[data-role="im-pcard-grade"]').html(t(e.agent_level,"")),this.nodes.pcard.find('[data-role="im-pcard-district"]').html(t(e.bizcircle_name,"ææ ")),this.nodes.pcard.find('[data-role="im-pcard-store"]').html(t(e.shop_name,"ææ ")),this.nodes.pcard.find('[data-role="im-pcard-workage"]').html(t(e.job_year,"ææ ")),this.nodes.pcard.find('[data-role="im-pcard-totaldeal"]').html(t(e.house_sold_count,"ææ ")),this.nodes.pcard.find('[data-role="im-pcard-monthshow"]').html(t(e.recent_see,"ææ ")),this.nodes.pcard.find('[data-role="im-pcard-praiserate"]').html(t(e.review_good_rate,"ææ ","<r>%")),this.nodes.pcard.find('[data-role="im-pcard-shoplink"]').attr({href:"https://dianpu.lianjia.com/"+e.agent_ucid})},setWindow:function(e){var t=this,a=this.imData[e],i=a.convObj,n=i.peer.type,o=i.peer.ucid,r=this.filterSupportMsg(a.msgList);this.currentConvId=+e,this.nodes.talkwindowMsgContainer.html(""),this.nodes.inputTextarea.val(""),this.nodes.talkwindow.find('[data-role="im-window-name"]').html(i.title),r.length>0?this.addMsg(r,"btm"):this.loadHist(!0),1===n&&(this.agentData[o]||$.ajax({url:_util.apiUrl("im/agent/getagentdetail"),data:{agent_ucid:o},dataType:"jsonp",success:function(e){t.agentData[o]=e.data}})),t.updateConvItemNode(e,{newmsgAmount:0}),t.updateHeadUnread()},loadHist:function(e){var t=this;if(!t.isLoadingHistory&&0===t.nodes.talkwindowChatContainer.scrollTop()){var a=t.currentConvId,i=t.imData[t.currentConvId].msgList[0],n=0;if(i){if(1===i.id||t.imData[t.currentConvId].hasHistory===!1)return;n=i.sendTime}t.isLoadingHistory=!0,t.core.getHistory({conv_id:a,max_send_time:n,limit:100},function(i){if(null!==i){var n=t.filterSupportMsg(i);t.updateImDataConv(a,"msgList",i.reverse().concat(t.imData[a].msgList));var o=t.nodes.talkwindowMsgContainer.find("li.chat-block").eq(0);t.addMsg(n,"top");var r=t.nodes.talkwindowMsgContainer.find("li.chat-block").eq(0);e?t.scrollWindow("btm"):o[0]&&r[0]&&t.scrollWindow(o[0].getBoundingClientRect().top-r[0].getBoundingClientRect().top),0!==i.length&&1!==i[0].id||t.updateImDataConv(a,"hasHistory",!1)}else t.showErrorlog("è·ååå²è®°å½å¤±è´¥");t.isLoadingHistory=!1})}},addMsg:function(e,t){var a=this,i=6e4;e.length>0&&($.each(e,function(){var e=this,n=null,o=null;if(!(a.nodes.talkwindowMsgContainer.find('[data-msgid="'+e.id+'"]').length>0)){var r="",s="",c="";switch(a.userData.ucid===e.fromUcid?(r="chat-out",s=a.userData.name,c=a.userData.avatar||a.staticRoot+"/pc/asset/lianjiaIM/img/icon_user@2x.png"):(r="chat-in",s=a.imData[e.convId].convObj.title,c=a.imData[e.convId].convObj.avatar||a.staticRoot+"/pc/asset/img/jingjiren/noimg.jpg"),e.type){case-1:case 105:n=$(a.messageNodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},message:{text:filterXSS(_util.httpHtml(e.payload))}}));break;case 120:n=$(a.messageNodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},message:{text:e.payload}}));break;case-2:var d=JSON.parse(e.payload);d=a.isValidHouseUrl(d,["original","thumbnail"]),n=$(a.picNodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},pic:{url:a.core.encodeHtml(d.original),thumb:a.core.encodeHtml(d.thumbnail),desc:"å¾ç"}}));break;case 109:n=$(a.picNodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},pic:{url:JSON.parse(e.payload).emoticonRemoteUrl,
thumb:JSON.parse(e.payload).emoticonRemoteUrl,desc:JSON.parse(e.payload).emoticonName}}));break;case 1:var l=JSON.parse(e.payload);l.houseImgUrl&&null!==l.houseImgUrl.match(/http/g)||(l.houseImgUrl=a.staticRoot+"/pc/asset/img/new-version/default_block.png"),1===l.isPriceOnly?l.priceUnit="ä¸èµ·":l.priceUnit="ä¸",3!=l.houseType&&2!=l.houseType||(l.price=1e4*l.price,l.priceUnit="å/æ"),l=a.isValidHouseUrl(l,["schemeUrl"]),n=$(a.housecardNodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},houseinfo:l}));break;case 6:var u=JSON.parse(e.payload);u.houseImgUrl&&null!==u.houseImgUrl.match(/http/g)||(u.houseImgUrl=a.staticRoot+"/pc/asset/img/new-version/default_block.png"),u=a.isValidHouseUrl(u,["schemeUrl"]),n=$(a.xinfangcardNodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},houseinfo:u}));break;case 330:var p={msg_id:e.id,conv_id:e.convId,scheme:JSON.parse(e.payload).scheme};n=$(a.msg330NodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},fromUcid:e.fromUcid})),a.init330card(p,e.fromUcid);break;case 600:var m=JSON.parse(e.payload);if(m.content&&2===m.type){var h=m.content&&m.content.message||m.desc;1===m.content.sessionStatus&&(n=$(a.messageNodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},message:{text:_util.httpHtml(h)}})))}else{var h=m.content&&m.content.message||m.desc;n=$(a.msg802NodeTemplate.render({sendType:"system",timestamp:e.sendTime,msgid:e.id,desc:h}))}break;case 802:var g=JSON.parse(e.payload);a.nodes.talkwindowMsgContainer.find("li.chat-block[data-msgid="+g.msg_id+"]").remove(),n=$(a.msg802NodeTemplate.render({sendType:"system",timestamp:e.sendTime,msgid:e.id,desc:g.desc}));break;default:n=$(a.messageNodeTemplate.render({sendType:r,timestamp:e.sendTime,msgid:e.id,user:{username:s,avatar:c},message:{text:a.core.encodeHtml(e.type+"-æä¸æ¯ææ¶æ¯ç±»åï¼è¯·åå¾appæ¥ç")}}))}if(n){if(n.data({msgData:e}),600===e.type){var m=JSON.parse(e.payload);if(m.content&&2===m.type&&1===m.content.sessionStatus){var f=$(a.msg802NodeTemplate.render({sendType:"system",timestamp:e.sendTime,msgid:e.id,desc:"å·²ä¸ºæ¨æ¥éå®¢æ"}));f.data({msgData:e}),a.nodes.talkwindowMsgContainer.append(f)}}"btm"===t?(o=a.nodes.talkwindowMsgContainer.find("li.chat-block:last"),(0===o.length||e.sendTime-o.data("msgData").sendTime>i)&&802!==e.type&&a.nodes.talkwindowMsgContainer.append(a.chatTimeNodeTemplate.render({time:_util.timeFormat(e.sendTime,"deltaTime","YYYY-MM-DD hh:mm")})),a.nodes.talkwindowMsgContainer.append(n)):"top"===t&&(o=a.nodes.talkwindowMsgContainer.find("li.chat-block:first"),a.nodes.talkwindowMsgContainer.prepend(n),(0===o.length||e.sendTime-o.data("msgData").sendTime<-i)&&802!==e.type&&a.nodes.talkwindowMsgContainer.prepend(a.chatTimeNodeTemplate.render({time:_util.timeFormat(e.sendTime,"deltaTime","YYYY-MM-DD hh:mm")})))}}}),this.addRead(e.slice(-1)[0]))},addRead:function(e){e.fromUcid!==this.userData.ucid&&e.id>0&&e.id>this.imData[e.convId].readMsgId&&(this.updateImDataConv(e.convId,"readMsgId",e.id),this.core.markRead(e))},isValidHouseUrl:function(e,t){if("object"==typeof t)for(var a=t.length,i=0;i<a;i++)e&&!this.validUrl.test(e[t[i]])&&(e[t[i]]=location.href);else"string"==typeof t&&e&&!this.validUrl.test(e[t])&&(e[t]=location.href);return e},showErrorlog:function(e){var t=this;clearTimeout(this.errorlogTimer),this.nodes.errorlogContainer.hide().html(e).fadeIn(200,function(){t.errorlogTimer=setTimeout(function(){t.nodes.errorlogContainer.fadeOut(200,function(){t.nodes.errorlogContainer.html("")})},2e3)})}},function(){var e=document.createElement("style");e.innerText=".im-housecard img{vertical-align: baseline;}.readState{ color: #9c9fa1; position: absolute;bottom: -18px;right: 0;font-size: 12px;}.im-wc-chat .chat-out .chat-content{ position: relative; }.msgRecall{ position: absolute;bottom: -20px;right: 0; color:#101d37;background: ghostwhite;border-radius: 2px;cursor: pointer; padding: 0 10px;}",document.body.appendChild(e)}(),LianjiaIM});