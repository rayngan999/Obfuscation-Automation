!function(b){var a=(b.browser.msie?"paste":"input")+".mask",c=void 0!=window.orientation;b.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},b.fn.extend({caret:function(f,d){if(0!=this.length){if("number"==typeof f){return d="number"==typeof d?d:f,this.each(function(){if(this.setSelectionRange){this.setSelectionRange(f,d)}else{if(this.createTextRange){var e=this.createTextRange();e.collapse(!0),e.moveEnd("character",d),e.moveStart("character",f),e.select()}}})}if(this[0].setSelectionRange){f=this[0].selectionStart,d=this[0].selectionEnd}else{if(document.selection&&document.selection.createRange){var g=document.selection.createRange();f=0-g.duplicate().moveStart("character",-100000),d=f+g.text.length}}return{begin:f,end:d}}},unmask:function(){return this.trigger("unmask")},mask:function(e,j){if(!e&&this.length>0){var g=b(this[0]);return g.data(b.mask.dataName)()}j=b.extend({placeholder:"_",completed:null},j);var k=b.mask.definitions,m=[],d=e.length,f=null,h=e.length;return b.each(e.split(""),function(l,i){"?"==i?(h--,d=l):k[i]?(m.push(new RegExp(k[i])),null==f&&(f=m.length-1)):m.push(null)}),this.trigger("unmask").each(function(){function q(i){for(;++i<=h&&!m[i];){}return i}function t(i){for(;--i>=0&&!m[i];){}return i}function r(v,p){if(!(0>v)){for(var w=v,i=q(p);h>w;w++){if(m[w]){if(!(h>i&&m[w].test(A[i]))){break}A[w]=A[i],A[i]=j.placeholder,i=q(i)}}l(),z.caret(Math.max(f,v))}}function u(v){for(var p=v,y=j.placeholder;h>p;p++){if(m[p]){var i=q(p),w=A[p];if(A[p]=y,!(h>i&&m[i].test(w))){break}y=w}}}function n(w){var p=w.which;if(8==p||46==p||c&&127==p){var i=z.caret(),v=i.begin,y=i.end;return y-v==0&&(v=46!=p?t(v):y=q(v-1),y=46==p?q(y):y),s(v,y),r(v,y-1),!1}return 27==p?(z.val(x),z.caret(0,o()),!1):void 0}function B(w){var v=w.which,C=z.caret();if(w.ctrlKey||w.altKey||w.metaKey||32>v){return !0}if(v){C.end-C.begin!=0&&(s(C.begin,C.end),r(C.begin,C.end-1));var p=q(C.begin-1);if(h>p){var y=String.fromCharCode(v);if(m[p].test(y)){u(p),A[p]=y,l();var i=q(p);z.caret(i),j.completed&&i>=h&&j.completed.call(z)}}return !1}}function s(p,i){for(var v=p;i>v&&h>v;v++){m[v]&&(A[v]=j.placeholder)}}function l(){return z.val(A.join("")).val()}function o(y){for(var w=z.val(),D=-1,p=0,v=0;h>p;p++){if(m[p]){for(A[p]=j.placeholder;v++<w.length;){var C=w.charAt(v-1);if(m[p].test(C)){A[p]=C,D=p;break}}if(v>w.length){break}}else{A[p]==w.charAt(v)&&p!=d&&(v++,D=p)}}return !y&&d>D+1?(z.val(""),s(0,h)):(y||D+1>=d)&&(l(),y||z.val(z.val().substring(0,D+1))),d?p:f}var z=b(this),A=b.map(e.split(""),function(p,i){return"?"!=p?k[p]?j.placeholder:p:void 0}),x=z.val();z.data(b.mask.dataName,function(){return b.map(A,function(p,i){return m[i]&&p!=j.placeholder?p:null}).join("")}),z.attr("readonly")||z.one("unmask",function(){z.unbind(".mask").removeData(b.mask.dataName)}).bind("focus.mask",function(){x=z.val();var i=o();l();var p=function(){i==e.length?z.caret(0,i):z.caret(i)};(b.browser.msie?p:function(){setTimeout(p,0)})()}).bind("blur.mask",function(){o(),z.val()!=x&&z.change()}).bind("keydown.mask",n).bind("keypress.mask",B).bind(a,function(){setTimeout(function(){z.caret(o(!0))},0)}),o()})}})}(jQuery);