/*! 20210802-4-RELEASE */

(()=>{const t=TRC.implClasses.TRCRBox,e=TRC.PROTOCOL;t.prototype.generateRDiv=function(){const t=document.createElement("div");return t.id=this.getListId(),t.className="trc_rbox_div trc_rbox_border_elm","none"!==this.element.style.display&&(t.style.display="none"),t.style.overflowX="hidden",t.style.overflowY="hidden",t},t.prototype.generateVisibleParts=function(){if(null!=this.listContainer)return;this.header=this.generateHeader(this.element);const t=document.createElement("div");t.id=this.id.replace("trc_","outer_"),t.className="trc_rbox_outer",t.style.overflow="hidden",this.listContainer=this.generateRDiv(),t.appendChild(this.listContainer),this.element.appendChild(t),this.element.style.display="block",this.addTaboolaLogo()},t.prototype.drawListBody=function(t){if(TRC.tlf&&console.timeStamp(`start mode - ${this.mode_name}`),TRC.tlf&&console.group(`mode - ${this.mode_name}`),TRC.tlf&&console.time("mode rendering"),"object"!=typeof t)return;if(this.element.offsetTop<=0&&this.element.offsetWidth<=0)return void TRC.Timeout.set(this.drawListBody.trcBind(this,t),1e3);window._tblConsole=window._tblConsole||[],TRC.pConsole(this.mode_name,"debug","start drawing widget","");const e=this.listContainer;this.boxes=[];let i=0;const s=this.trc;if(this.navigationType=s.getProperty(this.mode_name,"navigation-type",this.propertiesOverride),this.trc.calculateAutoSizeParameters(this),this.element.className+=this.autoSize?" trc-auto-size":"",this.isWCTextLinks){const t=TRC.dom.closest(this.getContainer(),".trc_related_container");if(TRC.dom.addClass(t,"trc_tl"),TRC.dom.on(window,"resize",this.fixWCTextLinksVideoBoxes.trcBind(this).trcThrottle(500)),TRC.listen("videoCubeChange",this.fixWCTextLinksVideoBoxes.trcBind(this)),this.isResponsive){const e="trc_tl_responsive",i=this.disableResponsiveCSSReuse?this.id:this.mode_name;TRC.dom.addClass(t,`${e} ${e}_${i}`),this.setResponsiveRules(`${e}_${i}`,this.recommendationList.length)}}function o(t){const e=parseInt(document.trcGetCurrentStyle(t,"height"),10);if(isNaN(e))return!0;const i=document.createElement("span");i.style.display="block",i.style.height="10px",i.style.width="10px",t.appendChild(i);const s=parseInt(document.trcGetCurrentStyle(t,"height"),10);return t.removeChild(i),s!==e}function r(t,e){t.style.height=`${e}px`;let i=0;for(;t.clientHeight>e;)t.style.height=`${e-++i}px`}let n=!1,l=this.trc.getProperty(this.mode_name,"detail-order",this.propertiesOverride);const a=this.orientation=this.trc.getProperty(this.mode_name,"orientation",this.propertiesOverride);l=l.split(",");for(let y=0;y<l.length;y++)"duration"===l[y]&&(n=!0);let h=0;this.exploreTimeoutId=null,void 0!==this.trc.global&&(h=this.trc.global["explore-delay"]?this.trc.global["explore-delay"]:h);const d=this;this.container.onmouseover=function(t){let e=null;window.event?e=window.event.srcElement:t&&(e=t.target),e!==this.container&&null!=this.exploreTimeoutId||e===this.container&&null!=this.exploreTimeoutId||(this.exploreTimeoutId=TRC.Timeout.set(function(){this.exploreTimeoutId&&(TRC.Timeout.clear(this.exploreTimeoutId),this.exploreTimeoutId=null),this.sendEvent("explore",{},null,!0,null,null)}.trcBind(this),h))}.trcBind(this),0!==h&&(this.container.onmouseout=function(t){t=t||window.event;const e=this.container.getBoundingClientRect();t.clientX>=e.left&&t.clientX<e.right&&t.clientY>=e.top&&t.clientY<e.bottom||this.exploreTimeoutId&&(TRC.Timeout.clear(this.exploreTimeoutId),this.exploreTimeoutId=null)}.trcBind(this));const c=document.createElement("div");for(c.id=`internal_${this.id}`,this.internalContainer=c;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(c),"none"!==e.style.display&&"none"!==e.parentNode.style.display||(this.listContainer.style.display="block",this.listContainer.parentNode.style.display="block");const m={};__trcCopyProps(t,m),delete m["video-list"],c.meta=m,this.firstVideo=null;let p=this.isResponsive?this.recommendationList.length:s.getProperty(this.mode_name,"list-size",this.propertiesOverride);p=Math.min(p,this.recommendationList.length),"horizontal"===a?(e.style.overflowY="hidden",e.style.overflowX="auto",c.style.width="5000px"):(e.style.overflowX="hidden",e.style.overflowY="auto");for(let y=0;y<p;y++){TRC.tlf&&0===y&&console.time("item rendering");const t=this.recommendationList[y];t.itemIndex=y,null==this.firstVideo&&"video"===t.type&&(this.firstVideo=t);try{this.trc.global["disable-runHook"]?this.trc.getFunction(this.mode_name,"item-data-filter",this.propertiesOverride,t):this.trc.runHook(this,this.mode_name,"item-data-filter",this.propertiesOverride,!1,t);const s=this.drawVideoBox(t,n);if(y>=this.recommendationList.length/2&&this.isWCTextLinks&&!this.isResponsive&&(s.className+=" trc_tl_right_col"),"vertical"===a){const t=document.createElement("div");t.style.clear="both",s.appendChild(t)}if(c.appendChild(s),"scrolling"!==this.navigationType){const t=this.trc.getProperty(this.mode_name,"thumbnail-position",this.propertiesOverride);if(this.rows>1&&this.autoSize&&("top"===t||"bottom"===t)){const t=this.itemMaxHeight<s.clientHeight?s.clientHeight:this.itemMaxHeight;this.itemMaxHeight=this.itemMaxHeight?t:s.clientHeight}if(s.offsetHeight>e.offsetHeight){const t=s.offsetHeight-e.offsetHeight;s.style.height=`${parseInt(document.trcGetCurrentStyle(s,"height"),10)-t}px`}c.removeChild(s)}else{s.fixTextOverflow(),void 0===s.image_div?s.thumb.appendChild(s.img):(s.thumb.appendChild(s.image_div),s.image_div.appendChild(s.img)),this.trc.global["use-delay-image-load"]?TRC.Timeout.set(this.setImageLoad.trcBind(this,s.img,s,s.img_src,100,s.thumb,this.trc.global["thumb-lazy-load-switch"]),10):this.setImageLoad(s.img,s,s.img_src,100,s.thumb,this.trc.global["thumb-lazy-load-switch"]);const t=parseInt(document.trcGetCurrentStyle(s,"margin-right"),10);i=s.clientWidth+s.offsetLeft+(isNaN(t)?0:t),"horizontal"===a&&o(s)&&r(s,e.offsetHeight)}this.boxes.push(s)}catch(t){__trcError("Error in drawVideoBox",t)}TRC.tlf&&0===y&&console.timeEnd("item rendering")}if("scrolling"!==s.getProperty(this.mode_name,"navigation-type",this.propertiesOverride)?(c.style.width="auto",d.drawPager()):(c.style.width=`${i}px`,function t(i){if(e[`client${i}`]+1>=e[`scroll${i}`])return;let s=Math.floor(Math.max(1,e[`scroll${i}`]-e[`client${i}`]));s-=Math.max(0,e[`scroll${i}`]-e.parentNode[`scroll${i}`]);const o=parseInt(e.style[i.toLowerCase()],10),r=`${Math.max(e[`scroll${i}`],isNaN(o)?0:o)+s}px`;e.style[i.toLowerCase()]=r,"Width"===i&&(this.element.style.width=r),this.postRenderQueue.pushFront("adapt to scrollbar",t.trcBind(this,i))}.call(this,"horizontal"===s.getProperty(this.mode_name,"orientation",this.propertiesOverride)?"Height":"Width"),e.onscroll=function(){this.sendEvent("explore",{},null,!0),this.check_visibility()}.trcBind(this),this.check_visibility()),this.shouldAddRowsClearingDivs())for(let y=0;y<this.boxes.length;y++)this.isBeginningOfNewRow(y,this.boxes.length)&&this.addAutoSizeRowClearingDiv(this.boxes[y]);this.boxes[0].className+=" trc-first-recommendation trc-spotlight-first-recommendation",this.postRenderQueue.pushBack("list-suffix,publisher-end",function(t){this.trc.global["disable-runHook"]?(this.trc.getFunction(this.mode_name,"list-suffix",this.propertiesOverride,t,this),TRC.CustomModulesManager.runHook("list-suffix",this.mode_name,this,this.propertiesOverride,t,this)):this.trc.runHook(this,this.mode_name,"list-suffix",this.propertiesOverride,!0,t,this),this.trc["publisher-end"](this.id),TRC.CustomModulesManager.runHook("publisher-end",null,this,this.id)}.trcBind(this,c)),this.postRenderQueue.pushBack("checkForBlocking",this.checkForBlocking.trcBind(this)),this.postRender();let u=0,g=1e3;this.visibleTimeoutId=null,void 0!==this.trc.global&&(u=this.trc.global["visible-delay"]?this.trc.global["visible-delay"]:u,g=this.trc.global["visible-cycle"]?this.trc.global["visible-cycle"]:g),this.visibilityReporter=new TRC.WidgetVisibilityReporter(this),TRC.eventDelegator.dispatch("onrender",{name:this.mode_name,container:this.container,placement:this.orig_placement}),TRC.EventsAPI.dispatchRender(t,this),TRC.tlf&&console.timeEnd("mode rendering"),TRC.tlf&&console.groupEnd()},t.prototype.drawPager=function(){const t=this.trc,e=this.mode_name,i=this.listContainer,s=i.firstChild;let o;this.rows=t.getProperty(e,"rows",this.propertiesOverride),this.clearChilds(s),i.style.overflowX="hidden",i.style.overflowY="hidden";let r=[{start_index:0,end_index:this.boxes.length}];const n=document.createElement("div");if(n.style.clear="both",!this.autoSize){let t;for(;this.rows>1&&!(r.length>=this.rows);)this.rows--;if(this.rows>1){t=[];for(let e=0;e<r.length;e++)this.boxes[r[e].start_index].className+=" trc-first-in-row",(e+1)%this.rows==0&&t.push({start_index:r[e+1-this.rows].start_index,end_index:r[e].end_index})}t&&(i.style.height="auto",r=t)}for(o=r[0].start_index;o<=r[0].end_index;o++){if(o>=this.boxes.length)continue;const t=this.boxes[o];s.appendChild(t);try{null!=t.img_src&&(void 0===t.image_div?t.thumb.appendChild(t.img):(t.thumb.appendChild(t.image_div),t.image_div.appendChild(t.img)),this.setImageLoad(t.img,t,t.img_src,100,t.thumb,this.trc.global["thumb-lazy-load-switch"]),t.img_src=null)}catch(t){__trcError("Pager thumbnail images fixing errors",t)}t.fixTextOverflow()}return s.appendChild(n),this.check_visibility(),null},t.prototype.FixVideoImage=function(t,e,i){const s=TRC.css.utils;if(0===i.height||0===i.width||!i.complete)return s.setStyleProperty(i,"width",`${t}px`,this.isCssImportant),s.setStyleProperty(i,"height",`${e}px`,this.isCssImportant),void(i.style.visibility="visible");const o=t/e,r=i.width/i.height;if(o>r){const o=Math.floor(t/r),n=Math.floor((e-o)/2);s.setStyleProperty(i,"width",`${t}px`,this.isCssImportant),0!==n&&(TRC.Browser.ieAtleast(8)?(i.style.position="relative",s.setStyleProperty(i,"top",`${n}px`,this.isCssImportant)):s.setStyleProperty(i,"margin-top",`${n}px`,this.isCssImportant))}else{const o=Math.floor(e*r),n=Math.floor((t-o)/2);s.setStyleProperty(i,"height",`${e}px`,this.isCssImportant),0!==n&&(TRC.Browser.ieAtleast(8)?(i.style.position="relative","ltr"===this.trc.direction?s.setStyleProperty(i,"left",`${n}px`,this.isCssImportant):s.setStyleProperty(i,"left",`${-1*n}px`,this.isCssImportant)):"ltr"===this.trc.direction?s.setStyleProperty(i,"margin-left",`${n}px`,this.isCssImportant):s.setStyleProperty(i,"margin-right",`${n}px`,this.isCssImportant))}i.style.visibility="visible"},t.prototype.drawThumbnailLink=function(t,i,s,o,r){let n;i||"video"===s.type&&void 0!==s.duration&&""!==s.duration&&"0"!==s.duration&&(n=this.genDuration(s.duration));const l=this.createVideoLink(s,o);TRC.dom.addClass(l,"item-thumbnail-href"),void 0!==s["thumbnail-clickable"]&&"false"===s["thumbnail-clickable"]&&(l.title="",l.style.cursor="default",l.onclick=function(){return!1});const a=this.trc.getProperty(this.mode_name,"thumbnail-height",this.propertiesOverride),h=this.trc.getProperty(this.mode_name,"thumbnail-width",this.propertiesOverride),d=document.createElement("span");let c;if(d.className="thumbBlock",void 0!==a&&(d.style.height=`${a}px`),void 0!==h&&(d.style.width=`${h}px`),s.imageIframe)this.drawImageIframe(d,s.imageIframe,s.link.logger_url),t.hasFloatingButton=!0;else{(c=document.createElement("img")).style.visibility="hidden";const t=this.add_span("thumbnail-overlay",null,d);void 0!==a&&(t.style.height=`${a}px`),void 0!==h&&(t.style.width=`${h}px`),c.onerror=this.imageOnErrorHandler.trcBind(this,c,s,e),c.onload=function t(e){e.complete?this.FixVideoImage(h,a,e):TRC.Timeout.set(t.trcBind(this,e),1e3)}.trcBind(this,c)}if(s.isSyndicated){const t=document.createElement("span");if(t.className="branding",s["branding-text"])t.appendChild(document.createTextNode(this.formatData("syndicator",s["branding-text"])));else if(s["branding-url"]){const e=document.createElement("img");e.src=s["branding-url"],t.appendChild(e)}d.appendChild(t)}if(d.style.position="relative",new TRC.ThumbnailOverlayComponents(d,s.isSyndicated,this),t.thumb=d,t.img=c,t.img_src=this.getThumbnailURL(s,h,a),n){const t=document.createElement("div");t.className="video-duration video-duration-detail",t.style.left=0,void 0!==h&&(t.style.marginLeft=`${h-3}px`,t.style.top=`${a-15}px`),t.appendChild(n);const e=this.genDuration(s.duration);e.style.opacity=1,e.style.filter="alpha(opacity=100)",e.style.backgroundColor="transparent",t.appendChild(e),d.appendChild(t)}switch(l.appendChild(d),r){case"bottom":d.style.cssFloat="none",d.style.styleFloat="none",d.style.display="block",d.style.width=`${h}px`;break;case"top":case"under":d.style.cssFloat="none",d.style.styleFloat="none",d.style.display="block",d.style.width=`${h}px`;break;case"end":d.style.cssFloat="right",d.style.styleFloat="right"}return l},t.prototype.drawVideoBox=function(t,e,i,s){let o="";(t=__trcCopyProps(t,{})).isSyndicated=t["is-syndicated"]||t["is-in-network"]||t["is-native"],t.isPhoto="photo"===t.type,t.isText="text"===t.type,t.imageIframe=Object.prototype.hasOwnProperty.call(t,"image-iframe")&&t["image-iframe"],this.setApiItemsData(t),t.tags="string"==typeof t.tags?TRC.text.parseCSV(t.tags):[];const r=document.createElement("div");r.rbox=this;const n=r.thumbnail_position=s||this.trc.getProperty(this.mode_name,"thumbnail-position",this.propertiesOverride);r.video_data=t,r.setAttribute("data-item-id",t["item-id"]),r.setAttribute("data-item-title",t.title),r.setAttribute("data-item-thumb",this.getThumbnailURL(t,100,80)),r.setAttribute("data-item-syndicated",!!t.isSyndicated),this.setVideoBoxClassName(r),this.autoSize&&this.setAutoDimantions(r);let l=t.url;if(0===l.search(/\w{3,4}:\/\/(\w+)\.taboola(syndication)?.com/)){const t=l.split(/[?&]/);for(let e=0;e<t.length;e++)if("url"===t[e].split("=")[0]){l=decodeURIComponent(t[e].split("=")[1]);break}}if(!t.isSyndicated){t.original_url=l,l=this.trc.global["disable-runHook"]?this.trc.getFunction(this.mode_name,"change-url",this.propertiesOverride,l,r,this.tracking):this.trc.runHook(this,this.mode_name,"change-url",this.propertiesOverride,!1,l,r,this.tracking);const e=this.formatTrackingParam()||this.tracking;l===t.original_url&&e&&(l=TRC.URL.prototype.addParamsToUrl(l,e))}t.url=l,t.scParams=this.createVideoBoxClickUrlParams(t,l),t.logger_url=this.createVideoBoxClickUrlWithParams(t.scParams),o+=t.title,TRC.BlockClicksManager.isBlockClicksEnabled(this.trc.global,t)&&new TRC.BlockClicksManager(this,r,t);const a=this.createVideoLink(t,o);TRC.dom.addClass(a,"item-label-href"),t.link=a;const h=document.createElement("span");if(h.style.display="block",h.className="video-label-box",a.appendChild(h),r.labelsBox=h,r.appendChild(a),"none"!==n){const i=this.drawThumbnailLink(r,e,t,o,n);if("under"===n){const e=this.trc.getProperty(this.mode_name,"thumbnail-height",this.propertiesOverride);i.title=a.title="",r.insertBefore(i,a),r.style.position="relative",r.style.height=`${e}px`;const s=document.createElement("span");TRC.dom.addClass(s,"tbl-text-over"),TRC.dom.addClass(a,"tbl-text-over-container"),a.appendChild(s),o=this.findElement(t=>t.className.search("title")>=0,r.labelsBox,"span",null),t.thumbUnder=!0}else"bottom"===n?r.appendChild(i):r.insertBefore(i,a)}let d=i||this.trc.getProperty(this.mode_name,`detail-order${t.isSyndicated?"-syndicated":""}`,this.propertiesOverride);if(d=d.split(","),this.buildLabelBox(h,t,d),r.fixTextOverflow=this.fixBoxTitleAndDesc.trcBind(this,t,h),!TRC.botDetected&&t[TRC.TrackingScriptLoader.TRC_SCRIPT_TAGS_ATTRIBUTE]&&t[TRC.TrackingScriptLoader.TRC_SCRIPT_TAGS_ATTRIBUTE].length>0){const e=`${this.outermostContainer.id}-${t.itemIndex}`;TRC.TrackingScriptLoader.renderScriptTagIntoVideoBox(r,t,e)}try{this.trc.global["disable-runHook"]?(this.trc.getFunction(this.mode_name,"item-renderer",this.propertiesOverride,r,r.video_data),TRC.CustomModulesManager.runHook("item-renderer",this.mode_name,this,this.propertiesOverride,r,r.video_data)):this.trc.runHook(this,this.mode_name,"item-renderer",this.propertiesOverride,!0,r,r.video_data)}catch(t){__trcError("Error in itemRenderer",t)}return r},t.prototype.shouldAddRowsClearingDivs=function(){const t="autowidget-template-static"===this.widgetCreatorLayout;return this.autoSize&&t&&!this.trc.global["disable-autosize-clearing-div"]},t.prototype.isBeginningOfNewRow=function(t,e){const i=t%(e/this.rows)==0;return 0!==t&&i},t.prototype.addAutoSizeRowClearingDiv=function(t){const e=document.createElement("div");e.style.clear="both",e.style.width="100%",t.parentNode.insertBefore(e,t)},t.prototype.setAutoDimantions=function(t){if(!this.AutoSizeRule)return;let e=`${this.AutoSizeRule.Ws}px`;this.rows>1&&(t.style.marginBottom=e),this.boxes.length%this.AutoSizeRule.n==0&&(e=0),"rtl"===this.trc.direction?t.style.marginRight=e:t.style.marginLeft=e,t.style.width=`${this.AutoSizeRule.Wi}px`;const i=this.trc.getProperty(this.mode_name,"thumbnail-height",this.propertiesOverride),s=this.trc.getProperty(this.mode_name,"thumbnail-width",this.propertiesOverride),o=i/s;this.trc.modes[this.mode_name]["thumbnail-width"]=this.AutoSizeRule.Wi,this.trc.modes[this.mode_name]["thumbnail-height"]=Math.round(this.AutoSizeRule.Wi*o)},t.prototype.fixWCTextLinksVideoBoxes=function(){const t=this.boxes;for(let e=0,i=t.length;e<i;e++)t[e].labelsBox.firstChild.innerHTML=t[e].video_data.title,t[e].fixTextOverflow(!0)},t.prototype.imageOnErrorHandler=function(t,e,i){let s=t.src;const o=s.search(/\Shttp\S/),r=e["item-id"];s=o>5&&this.isTaboolaCDNImage(s)?this.getFallbackImageForTaboolaCDNImage(s,r,i):this.getFallbackImageForNonTaboolaCDNImage(t,r,i),t.src=s},t.prototype.fixBoxTitleAndDesc=function(t,e,i){if(i)try{const i=this.trc.getProperty(this.mode_name,"details-inline-with-title",this.propertiesOverride),s=i?i.split(","):[],o=this.findElement(t=>t.className.search("title")>=0,e,"span",null);s&&s.length&&o&&"inline"===document.trcGetCurrentStyle(o,"display")&&(o.style.display="inline-block"),o.inlineDetailsElements=this.setupInlineDetails(s,e);const r="false"!=t["truncate-title"];this.fixBoxOverflow(o,t.title,!1,r,s,e),t.thumbUnder&&(t.link.style.fontSize=`${e.font}px`),s&&s.length&&(o.style.display="inline"),this.fixBoxOverflow(this.findElement(t=>t.className.search("description")>=0,e,"span",null),t.description,!0,!0,null,null)}catch(t){__trcError("Problem in fixBoxTitleAndDesc",t)}else this.postRenderQueue.pushBack("fixBoxTitleAndDesc",this.fixBoxTitleAndDesc.trcBind(this,t,e,!0))},t.prototype.setupInlineDetails=function(t,e){const i=this.findElements(t,e);let s=!1;for(let o=0;t&&o<t.length;o++)"branding"===t[o]&&(s=!0);if(t.length&&!s){const t=this.findElement(t=>t.className.search("branding")>=0,e,"span",null);t&&(t.style.display="block")}for(let o=0;i&&o<i.length;o++){const t=i[o];t.style.display="inline-block",t.style.verticalAlign="middle"}return i}})();