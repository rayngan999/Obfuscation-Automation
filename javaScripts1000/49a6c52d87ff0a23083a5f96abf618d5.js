"use strict";var zdAutoComplete=(function(d,r,t){var f;var s;var n=0;var q;var p;var i=function(){return d("#zd-auto-complete-wrap").length>0};var c;var m=false;var o=function(y,v){var x=v.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");x=x.split(" ").filter(function(z){return z.length>0}).join("|");var w=new RegExp("\\b"+x,"gi");return v?y.replace(w,function(z){return'<em class="highlight">'+z+"</em>"}):y};var e=function(w){var v=d.Deferred();var y={clientId:t.injectionSettings.clientId,query:w||""};if(n>0){y.limit=n}var x={url:Zoomd.Widget.SU_BaseUrlServiceHttp+"/AutoComplete",type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",data:y,timeout:30000,success:function(z){if(!z||z.Error){v.reject(z)}else{v.resolve(z)}},error:function(z){v.reject(z)}};if(s){s.abort()}s=d.ajax(x);return v.promise()};var a=d("<li></li>");var b=d("<ul id='zd-auto-complete-wrap' class='zd-auto-complete'></ul>");var u=function(y,x){l();if(y&&y.suggestions&&y.suggestions.length>0){b.html("");var v=n-1;for(var w=0;w<y.suggestions.length;w++){a.html(o(y.suggestions[w],x));b.append(a.clone());if(v>0&&w==v){break}}f=b}else{f=d("<ul class='zd-auto-complete no-result'></ul>")}return f};var l=function(){d(document).off("click.autocmp");d(document).off("mouseenter.autocmp")};var g=function(){l();d(document).on("mouseenter.autocmp","ul#zd-auto-complete-wrap > li",function(v){d("#zd-auto-complete-wrap > li").toggleClass("selected",false);d(v.target).toggleClass("selected",true)});d(document).on("click.autocmp","ul#zd-auto-complete-wrap > li",function(w){var x=d("#zd-auto-complete-wrap > li.selected");j(x);var v=x.text();d(".zd-auto-complete-content").trigger("zoomdSearch:ac-selected",{searchTerm:v})}.bind(this))}.bind(this);this.loadSuggestions=function(x,z,y,w,v){if((x.length==0)){v(u());return}n=z;p=y;(e(x)).done(function(A){if(!i()){q=new Date();m=false}c=x;v(u(A,x));g();var B=(new Date()-w)/1000;if(A&&A.suggestions&&A.suggestions.length>0){k("autoCompleteOpened",B,A.suggestions,x)}})};var j=function(x){m=true;var w=(new Date()-q)/1000;var v=x.index();k("autoCompleteSelected",w,h(),c,x.text(),v)};this.getCurrentItem=function(){var v=d("#zd-auto-complete-wrap > li.selected");if(v.length<1){return}j(v);return v};this.goUp=function(){if(d("#zd-auto-complete-wrap > li").length<2){return}var w=d("#zd-auto-complete-wrap > li.selected");var v=w.prev().get(0);w.toggleClass("selected",false);if(v){return w.prev().toggleClass("selected",true)}else{return d("#zd-auto-complete-wrap > li:last-child").toggleClass("selected",true)}};this.goDown=function(){if(!f){return}var w=d("#zd-auto-complete-wrap > li.selected");var v=w.next().get(0);w.toggleClass("selected",false);if(v){return w.next().toggleClass("selected",true)}else{return d("#zd-auto-complete-wrap > li:first-child").toggleClass("selected",true)}};this.close=function(w){if(d("#zd-auto-complete-wrap").length>0){if(!w){l()}d("#zd-auto-complete-wrap").remove();if(!m){var v=(new Date()-q)/1000;k("autoCompleteClosed",v,h(),c)}}};var h=function(){if(!f){return}return f.find("li").map(function(v,w){return w.textContent})};var k=function(C,A,x,B,w,v){var z={itemType:"autocomplete",itemState:p,timeSeconds:A,query:B,itemName:w?w:"",totalResults:x.length,resultIndex:v?v:0,filterType:"autocomplete"};for(var y=0;y<Math.min(x.length,3);y++){z["filter"+(parseInt(y)+1)]=x[y]}t.logEvent(C,z)};return this});