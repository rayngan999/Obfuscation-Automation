!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("JS Ads for Publishers",[],t):"object"==typeof exports?exports["JS Ads for Publishers"]=t():e["JS Ads for Publishers"]=t()}(self,(function(){return function(){var e={808:function(e,t,n){var r,i;!function(s){if(void 0===(i="function"==typeof(r=s)?r.call(t,n,t,e):r)||(e.exports=i),!0,e.exports=s(),!!0){var o=window.Cookies,a=window.Cookies=s();a.noConflict=function(){return window.Cookies=o,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function i(){}function s(t,n,s){if("undefined"!=typeof document){"number"==typeof(s=e({path:"/"},i.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var o=JSON.stringify(n);/^[\{\[]/.test(o)&&(n=o)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in s)s[c]&&(a+="; "+c,!0!==s[c]&&(a+="="+s[c].split(";")[0]));return document.cookie=t+"="+n+a}}function o(e,n){if("undefined"!=typeof document){for(var i={},s=document.cookie?document.cookie.split("; "):[],o=0;o<s.length;o++){var a=s[o].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(a[0]);if(c=(r.read||r)(c,d)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(i[d]=c,e===d)break}catch(e){}}return e?i[e]:i}}return i.set=s,i.get=function(e){return o(e,!1)},i.getJSON=function(e){return o(e,!0)},i.remove=function(t,n){s(t,"",e(n,{expires:-1}))},i.defaults={},i.withConverter=n,i}((function(){}))}))}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return function(){"use strict";n.r(r);const e={adClassName:"adsbytrafficjunky",botttomAdName:"tjBottomAd",closeImageURL:`${location.protocol}//static.trafficjunky.com/delivery/img/close.png`,cookies:{bottom:{expiry:48e4,name:"TJBottomClose"},fail:{name:"TJAdsFail"},server:{expiry:36e5,name:"RLBNSERVERID"}},defaults:{bg_color:"transparent",platform:"mobile"},idSync:{scriptUrl:"https://static.trafficjunky.com/invocation/idsync/production/idsync.min.js",sites:["tube8","pornhub","youporn","redtube","xtube"]}},t={"background-color":"#000000",border:"none",display:"block",margin:"0 auto",overflow:"hidden"},i={border:"none",display:"block",height:"100%",left:"0","margin-left":"auto","margin-right":"auto",position:"absolute",right:"0",top:"0","vertical-align":"middle",width:"100%"},s={overflow:"hidden",position:"relative"},o={"-ms-transform":"translateX(-50%)",bottom:"0px",display:"block",left:"50%",position:"fixed",transform:"translateX(-50%)","z-index":"9999"},a={background:`url(${e.closeImageURL})`,"background-repeat":"no-repeat",cursor:"pointer",height:"20px",position:"absolute",right:"-10px",top:"-10px",width:"20px"},c={overflow:"hidden",position:"relative"},d={left:"0",position:"absolute",top:"0",width:"100%"};var l,u;!function(e){e.popunderTriggered="popunderTriggered",e.embeddedAdsLoaded="embeddedAdsLoaded",e.embeddedAdsError="embeddedAdsError",e.embeddedAdsSpotLoaded="embeddedAdsSpotLoaded",e.embeddedAdsSpotFailed="embeddedAdsSpotFailed",e.embeddedAdsSpotDefaultLoaded="embeddedAdsSpotDefaultLoaded",e.embeddedAdsDebuggerUpdate="embeddedAdsDebuggerUpdate"}(l||(l={})),function(e){e[e.Low=99]="Low",e[e.Medium=550]="Medium",e[e.High=720]="High",e[e.VeryHight=1080]="VeryHight"}(u||(u={}));var h=n(808);const p={adBaseURL:`${location.protocol}//{ENV}/{METHOD}`,adClassNameContext:"adsbytrafficjunkycontext",cookies:{deliveryServer:{name:"TJDeliveryServer"},env:{name:"TJAdsUrl"}},videoFormats:["video/mp4","video/webm","video/ogg"]};class m{}var f,g;m.getEnv=e=>{const t=h.get(p.cookies.env.name),n=".trafficjunky.net";return t?`${t}${n}`:e||`ads${n}`},m.getDeliveryServer=()=>h.get(p.cookies.deliveryServer.name),function(e){e.context_pornstar="context_pornstar",e.context_category="context_category",e.context_tag="context_tag",e.context_page_type="context_page_type",e.info="info",e.category="category",e.search="search",e.site="site"}(f||(f={})),function(e){e.site_id="site_id",e.hb_guid="hc",e.version="t_version",e.platform="device_type",e.client_ip="clientIP",e.segment="segment",e.custom_param="",e.delivery_server="",e.refresh_times="",e.refresh_delay="",e.retry="",e.bg_color="",e.default_image="",e.default_url="",e.domain_rewrite="",e.fail_url="",e.spot_ssp="",e.spot_new=""}(g||(g={}));class v{createURL(e,t=!1){const n=e.specificParams.domain_rewrite;let r=p.adBaseURL;r=r.replace("{ENV}",m.getEnv(n)),r=r.replace("{METHOD}",this.getMethod(e,t)),t?(r+=`?zone_id=${e.spotId}&redirect=1&format=popunder`,r+=`&clientType=${encodeURIComponent(String(e.specificParams.platform))}`):(r+=`?data=${encodeURIComponent(`[{"spots":[{"zone":${e.spotId}}]}]`)}`,r+="&clientType=mobile"),r+=this.getChannelsParameters(e.channelParams),r+=this.getSpecificParameters(e.specificParams,t);const i=m.getDeliveryServer();return i&&(r+=`&delivery-server=${i}`),n&&(r+=`&dm=${encodeURIComponent(n)}`),r+=`&_=${Date.now()}`,e.specificParams.custom_param&&(r+=e.specificParams.custom_param),r}getSpecificParams(e,t){const n=Object.assign(Object.assign({},t),e),r={};for(const e in n)e in g&&(r[e]=n[e]);return r}getChannelParams(e,t){const n=Object.assign(Object.assign({},t),e),r={};for(const e in n)e in f&&(r[e]=n[e]);return r}getAdContextAttributes(){const e=document.querySelector(`meta[name="${p.adClassNameContext}"]`);return e?b.getDataAttributes(e):null}getChannelsParameters(e){let t="";if(!e)return t;for(const n in e)f[n]&&e[n]&&(t+=`&channel[${n}]=${encodeURIComponent(e[n])}`);return t}getSpecificParameters(e,t){let n="";for(const r in e){if(!g[r]||!e[r])continue;const i=this.getSpecificParameterValue(e,t,r);n+=`&${g[r]}=${encodeURIComponent(i)}`}return n}getSpecificParameterValue(e,t,n){return"platform"!==n||t||"pc"!==e[n]?e[n]:"tablet"}getMethod(e,t){return"true"===e.specificParams.spot_ssp?"deep-ssp":t?"ads":"ads_batch"}}class y{static log(e,t){y.logs[e]||(y.logs[e]=[]),t&&(t.logTime=new Date(Date.now())),y.logs[e].push(t);const n=JSON.parse(JSON.stringify(this.debug()));window.postMessage({debug:n,name:e,type:l.embeddedAdsDebuggerUpdate},"*")}static getSpots(){const e={};for(const t in y.logs){-1!==[l.embeddedAdsSpotDefaultLoaded,l.embeddedAdsSpotFailed,l.embeddedAdsSpotLoaded].indexOf(t)&&y.populateMapForEvent(t,e)}return y.populateSpots(e)}static populateSpots(e){const t={};for(const n in e){t[n]||(t[n]={});const r=e[n][l.embeddedAdsSpotFailed];this.populateSpotsPerRefreshed(t[n],r,"failed");const i=e[n][l.embeddedAdsSpotDefaultLoaded];this.populateSpotsPerRefreshed(t[n],i,"default_loaded");const s=e[n][l.embeddedAdsSpotLoaded];this.populateSpotsPerRefreshed(t[n],s,"loaded")}return this.formatSpots(t)}static formatSpots(e){const t={};for(const n in e){t[n]=[];for(const r in e[n])t[n].push(e[n][r])}return t}static populateMapForEvent(e,t){for(let n=0;n<y.logs[e].length;n++){const r=y.logs[e][n].ad;t[r.refreshed]||(t[r.refreshed]={}),t[r.refreshed][e]||(t[r.refreshed][e]={}),t[r.refreshed][e][r.uuid]={container:y.logs[e][n].container,spotId:r.spotId}}}static populateSpotsPerRefreshed(e,t,n){if(t)for(const r in t)e[r]={container:t[r].container,spotId:t[r].spotId,status:n}}static getHBSpots(){const e=document.querySelectorAll("script[src*='/ads_batch']");for(let t=0;t<e.length;t++){const n=String(e[t].getAttribute("src")),r=y.getHBSpotsFromScript(n);if(r)return r}return null}static getHBSpotsFromScript(e){try{if(!e||-1===e.indexOf("?"))return null;e=e.substring(e.indexOf("?"));const t=new URLSearchParams(e);if(!t.get("hb"))return null;const n=JSON.parse(t.get("data"))[0].spots,r=[];for(let e=0;e<n.length;e++)r.push(n[e].zone);return r}catch(e){return null}}}y.logs={},y.debug=()=>({context:y.adContextAttributes,events:y.logs,hbSpots:y.getHBSpots(),spots:y.getSpots(),version:"1.0.3"});class b{static connectionInfo(){return navigator.connection||navigator.mozConnection||navigator.webkitConnection}static getNearestAvailableQuality(e,t){const n=Number(t);let r=Object.keys(e);if(0===r.length)return null;r=r.filter((t=>"progressive"===e[t].delivery)),r=r.filter((t=>{const n=e[t];return!!n.type&&["video/mp4","video/webm","video/ogg"].includes(n.type)}));return r.sort(((e,t)=>{const r=Number(e),i=Number(t);return isNaN(r)?1:isNaN(i)?-1:Math.abs(n-r)-Math.abs(n-i)}))[0]}}b.createDOMElement=(e,t={})=>{const n=document.createElement(e);for(const e in t)n.setAttribute(e,t[e]);return n},b.getDataAttributes=e=>{var t,n;const r=[].filter.call(e.attributes,(e=>/^data-/.test(e.name))),i={};for(const e in r){const s=null===(t=r[e].name)||void 0===t?void 0:t.replace("data-","").replace(/-/g,"_"),o=null===(n=r[e].value)||void 0===n?void 0:n.trim();o&&s&&(i[s]=b.sanitize(o))}return i},b.isLeftButton=e=>1===(e.which||e.button),b.isAdBlock=()=>{const e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox";let t=!1;try{document.body.appendChild(e),t=0===document.getElementsByClassName("adsbox")[0].offsetHeight,document.body.removeChild(e)}catch(e){t=!0}return t||!window.tjEmbeddedAdsLoaded},b.dispatchTjEvent=(e,t)=>{const n=document.createEvent("Event");n.initEvent(e,!1,!0),t&&(n.detail=t),document.dispatchEvent(n),y.log(e,t),e===l.embeddedAdsSpotFailed&&b.sendFailEvent(t)},b.sendFailEvent=e=>{var t;const n=(new v).getAdContextAttributes();if(!n||!n.fail_url)return;if(0===e.status)return;const r=new XMLHttpRequest;r.open("POST",n.fail_url),r.send(JSON.stringify({pageUrl:window.location.href,retryCounter:e.retried,tjAdData:null!==(t=e.request.response)&&void 0!==t?t:"",tjAdRequestUrl:e.request.url,tjResponseCode:e.request.status,tjResponseTime:e.request.duration,tjZoneID:e.ad.spotId}))},b.getQuality=()=>{const e=b.connectionInfo();return e?e.downlink<.3?u.Low:e.downlink<.7?u.Medium:u.High:u.Medium},b.sanitize=e=>{const t={"<":"&lt;",">":"&gt;"};return e.replace(/[<>]/gi,(e=>t[e]))};var w=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class S{static dispatchError(e){S.dispatch(l.embeddedAdsError,null,{error:JSON.stringify(e,Object.getOwnPropertyNames(e))})}}S.createInlineStyle=(e,t=!1)=>{let n="";for(const t in e){let r="";";"!==e[t].substr(e[t].length-1)&&(r=";"),n+=`${t}:${e[t]}${r}`}return t&&(n=n.replace(/!important/g,"").replace(/;/g,"!important;")),n},S.getElementByTag=(e,t)=>e.tagName===t.toUpperCase()?e:e.querySelector(t),S.getElementBySpotId=(e,t)=>w(void 0,void 0,void 0,(function*(){const n=`.${e}[data-source-id="${t}"], .${e}[data-spot-id="${t}"]`;let r=0;for(;!document.querySelector(n);){if(r++>20)return null;yield new Promise((e=>requestAnimationFrame(e)))}return document.querySelector(n)})),S.dispatch=(e,t=null,n={})=>{b.dispatchTjEvent(e,S.getEventParams(t,n))},S.getEventParams=(e=null,t={})=>(e&&(t=Object.assign({ad:Object.assign({},e.params),channelParams:e.channelParams,container:e.containerElement,request:Object.assign(Object.assign({},e.request),{duration:Date.now()-Number(e.request.duration)}),specificParams:e.specificParams},t)),t),S.getUUID=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));class A{static wasClosed(){return Boolean(h.get(e.cookies.bottom.name))}static isTestFail(){return Boolean(h.get(e.cookies.fail.name))}static close(){const t=new Date(Date.now()+e.cookies.bottom.expiry);h.set(e.cookies.bottom.name,"1",{expires:t,secure:!0})}}A.setDeliveryServer=t=>{if(!t)return;const n=new Date(Date.now()+e.cookies.server.expiry);h.set(e.cookies.server.name,t,{expires:n,secure:!0})};class x{static createURL(e,t=!1){return x.adService.createURL(e,t)}static getSpecificParams(e,t){return x.adService.getSpecificParams(e,t)}static getChannelParams(e,t){return x.adService.getChannelParams(e,t)}static getAdContextAttributes(){const e=x.adService.getAdContextAttributes();return y.adContextAttributes=e,e}}x.adService=new v;class C{static getHBAd(e){const t=window.tjPreloadAds[e.params.spotId],n=A.isTestFail()?null:t.response;return e.request.duration=Date.now()-t.duration,e.request.url=t.url,e.request.status=t.status,e.request.response=t.response,delete window.tjPreloadAds[e.params.spotId],(new Y).load(),new Promise((e=>e(n)))}static verifyResponse(e,t,n){return t.request.url=n,t.request.status=e.status,t.request.response=e.responseText,!window.XDomainRequest&&200!==e.status||!e.responseText||A.isTestFail()?null:e.responseText}}C.makeRequest=e=>window.tjPreloadAds&&window.tjPreloadAds[e.params.spotId]?C.getHBAd(e):new Promise((t=>{const n=window.XDomainRequest?new window.XDomainRequest:new XMLHttpRequest,r=x.createURL({channelParams:e.channelParams,specificParams:e.specificParams,spotId:e.params.spotId});n.onload=n.onerror=n.ontimeout=()=>{t(C.verifyResponse(n,e,r))},n.onprogress=()=>{},n.open("GET",r),n.timeout=1e4,n.send()}));class P{}P.fixSrcDoc=e=>{var t,n,r;if("srcdoc"in document.createElement("iframe"))return;if("IFRAME"!==e.tagName&&(e=e.querySelector("iframe")),!e)return;const i=e,s=null==i?void 0:i.getAttribute("srcdoc");s&&(null===(t=i.contentWindow)||void 0===t||t.document.open(),null===(n=i.contentWindow)||void 0===n||n.document.write(s),null===(r=i.contentWindow)||void 0===r||r.document.close())},P.fixMobileVideoAd=e=>{if(!e)return e;const t=e.indexOf('<div class="adtool_video_ad"');return-1!==t&&(e=`${e.substr(0,t)}\n\t\t\t<script src='//cdn11.contentabc.com/delivery/mobile_video/adtool_mobile_video_player_min.js'><\/script>\n\t\t\t${e.substr(t)}`),e};var E=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class k{static create(e,t,n){return E(this,void 0,void 0,(function*(){let r=n;return r||(r=yield k.getJSONFromContent(e)),k.createSync(e,t,r)}))}static createSync(e,t,n){const r=k.createIframe(e,t);return k.inject(r,e,n)}static inject(e,t,n){const r=n;if(!r)return null;const i=k.getHTMLfromJSON(r);return i?(t.request.data=r,e.setAttribute("srcdoc",i),e):null}}k.wrap=(e,t,n)=>{const r=k.createIframe(e,n);return r.setAttribute("srcdoc",t.outerHTML),r},k.createIframe=(e,n)=>{(n=n||Object.assign({},t))["background-color"]=e.specificParams.bg_color;return b.createDOMElement("iframe",{allowtransparency:"true","data-embeddedads":"true","data-spot-id":e.params.spotId,height:e.params.height,marginheight:"0",marginwidth:"0",scrolling:"no",style:S.createInlineStyle(n,!0),width:e.params.width})},k.getJSONFromContent=e=>E(void 0,void 0,void 0,(function*(){const t=yield C.makeRequest(e);if(!t)return null;try{return JSON.parse(t)[0]}catch(e){return null}})),k.getHTMLfromJSON=e=>{let t="";return e.full_html?t=e.full_html:e.html&&(t=e.html),P.fixMobileVideoAd(t)};var D=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class j extends class{constructor(t,n){this.channelParams={},this.specificParams={},this.request={},this.getParams=e=>({height:String(e.height),refreshed:0,spotId:e.source_id?Number(e.source_id):Number(e.spot_id),type:String(e.type),uuid:S.getUUID(),width:String(e.width)}),this.setChannelAndSpecificParams=(t,n)=>{this.specificParams=x.getSpecificParams(t,n),this.channelParams=x.getChannelParams(t,n);for(const t in e.defaults)this.specificParams[t]||(this.specificParams[t]=e.defaults[t])},this.params=this.getParams(t),this.setChannelAndSpecificParams(t,n)}}{constructor(e,n,r){super(n,r),this.createWithDefaultIfFail=(e,t)=>D(this,void 0,void 0,(function*(){const n=Number(this.specificParams.retry)||0;this.request.defaultAd=!1;for(let t=0;t<n+1;t++){const n=yield e();if(n)return n;S.dispatch(l.embeddedAdsSpotFailed,this,{retried:t})}return this.createDefaultAd(t)})),this.createDefaultAd=e=>{if(!this.specificParams.default_image||!this.specificParams.default_url)return null;(e=e||Object.assign({height:this.params.height,width:this.params.width},t))["background-color"]=this.specificParams.bg_color;const n=b.createDOMElement("img",{src:this.specificParams.default_image,style:S.createInlineStyle(e)}),r=b.createDOMElement("a",{"data-embeddedadsfallback":"true","data-height":this.params.height,"data-spot-id":this.params.spotId,"data-width":this.params.width,href:this.specificParams.default_url,target:"_blank"});return r.appendChild(n),this.request.defaultAd=!0,r},this.containerElement=e,this.refresh()}refresh(){const e=Number(this.specificParams.refresh_delay),t=Number(this.specificParams.refresh_times);if(!e||!t)return;let n=0;this.interval=window.setInterval((()=>{++n>=t&&window.clearInterval(this.interval),this.params.refreshed++,"function"==typeof this.revert&&this.revert(),this.run()}),1e3*e)}reload(){window.clearInterval(this.interval),"function"==typeof this.revert&&this.revert(),this.run(),this.refresh()}run(){return D(this,void 0,void 0,(function*(){if(!this.checkIfCreatable())return!1;this.request.duration=Date.now();const e=yield this.create();if(!e||!document.body.contains(this.containerElement))return"function"==typeof this.revert&&this.revert(),!1;this.insertIntoDOM(e),this.removeInvocationCode(),this.containerElement=e,P.fixSrcDoc(e);const t=this.request.defaultAd?l.embeddedAdsSpotDefaultLoaded:l.embeddedAdsSpotLoaded;return S.dispatch(t,this),!0}))}checkIfCreatable(){return!(!this.containerElement||!this.containerElement.parentNode)&&document.body.contains(this.containerElement)}insertIntoDOM(e){this.containerElement&&this.containerElement.parentNode&&this.containerElement.parentNode.insertBefore(e,this.containerElement.nextSibling)}removeInvocationCode(){this.containerElement&&this.containerElement.parentNode&&this.containerElement.parentNode.removeChild(this.containerElement)}}var I,_,O=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class T extends j{constructor(){super(...arguments),this.create=()=>O(this,void 0,void 0,(function*(){const e=Object.assign(Object.assign({},i),{"min-height":`${this.params.height}`}),t=yield this.createWithDefaultIfFail((()=>k.create(this,e)),e);return t?this.createResponsiveWrapper(t):null})),this.createResponsiveWrapper=e=>{const t=Number(this.params.width.slice(0,-2)),n=Number(this.params.height.slice(0,-2)),r=Math.floor(n/t*100),i=S.createInlineStyle(Object.assign(Object.assign({},s),{"padding-top":`${r}%`}),!0),o=b.createDOMElement("div",{style:i});return o.appendChild(e),o}}}class N{constructor(e,t){this.create=()=>k.createSync(this.baseAd,void 0,this.json),this.baseAd=e,this.json=t}}class M{constructor(e,t){this.lastPlayPos=0,this.currentPlayPos=0,this.bufferingDetected=!1,this.video=e.firstChild,this.mediaFiles=t,this.setQuality(b.getQuality()),Object.keys(this.mediaFiles).length>1&&setInterval(this.checkBuffering,50)}checkBuffering(){if(!this.video)return;this.currentPlayPos=this.video.currentTime;this.isBuffering(.03)&&(this.bufferingDetected=!0),this.isBuffering(.03,!0)&&(this.bufferingDetected=!1),this.lastPlayPos=this.currentPlayPos}isBuffering(e,t=!1){return!!this.video.paused&&(t?this.bufferingDetected&&this.currentPlayPos>this.lastPlayPos+e:!this.bufferingDetected&&this.currentPlayPos<this.lastPlayPos+e)}setQuality(e){let t=this.mediaFiles[e];if(!t){const n=b.getNearestAvailableQuality(this.mediaFiles,e);if(!n)return;t=this.mediaFiles[n]}t&&(this.video.src=t.url)}}class R{getValue(e,t,n=null){let r=null;const i=e.querySelectorAll(t);for(let e=0;e<i.length;e++){const t=i[e],s=this.strip(t.textContent);if(s&&(!n||n&&s!==n)){r=s;break}}return r}strip(e){return e?e.replace("<![CDATA[","").replace("]]>","").trim():null}}!function(e){e.Start="start",e.FirstQuartile="firstQuartile",e.Midpoint="midpoint",e.ThirdQuartile="thirdQuartile",e.Complete="complete",e.Mute="mute",e.Unmute="unmute",e.Pause="pause",e.Resume="resume",e.Fullscreen="fullscreen",e.Skip="skip",e.Click="click",e.Impression="impression"}(I||(I={}));class L extends R{get(e){const t={},n=e.querySelectorAll("TrackingEvents Tracking");for(let e=0;e<n.length;e++){const r=n[e],i=r.getAttribute("event"),s=r,o=this.strip(s.textContent);this.addEventUrl(t,i,o)}return 0!==Object.keys(t).length?t:null}addEventUrl(e,t,n){t&&n&&I[t.charAt(0).toUpperCase()+t.slice(1)]&&(e[t]||(e[t]=[]),e[t].push(n))}}class q extends R{get(e){if(!(e=e.querySelectorAll("VideoClicks")[0]))return null;const t=this.getValue(e,"VideoClicks ClickThrough");if(!t)return null;const n=[],r=e.querySelectorAll("VideoClicks ClickTracking");for(let e=0;e<r.length;e++){const t=r[e],i=this.strip(t.textContent);i&&n.push(i)}return{clickThrough:t,clickTracking:n}}}class F extends R{get(e){const t={},n=e.querySelectorAll("MediaFiles MediaFile");for(let e=0;e<n.length;e++){const r=n[e],i=r,s=this.strip(i.textContent),o=Number(r.getAttribute("height")),a=r.getAttribute("type"),c=a&&p.videoFormats.includes(a);s&&c&&(t[o]={bitrate:Number(r.getAttribute("bitrate")),delivery:r.getAttribute("delivery"),height:o,type:a,url:s,width:Number(r.getAttribute("width"))})}return t}}class B extends R{constructor(){super(...arguments),this.getWithVideoClicksEvents=e=>{e.events||(e.events={});let t=e.events[I.Click]||[];return t=[...t,...e.videoClicks.clickTracking],e.events[I.Click]=t,e}}get(e){const t=[],n=e.querySelectorAll("Creatives Creative");for(let e=0;e<n.length;e++){let r=n[e];const i=r.getAttribute("AdID");if(r=r.querySelectorAll("Linear")[0],!r)continue;const s=this.getCreative(r,i);s&&t.push(this.getWithVideoClicksEvents(s))}return t.length?t:null}getCompanion(e){if(!e.querySelector("Creatives Creative CompanionAds Companion"))return null;const t=this.getValue(e,"StaticResource");return t?{clickThrough:this.getValue(e,"CompanionClickThrough"),clickTracking:this.getValue(e,"CompanionClickTracking"),staticRessource:t}:null}getCreative(e,t){const n=(new q).get(e),r=(new F).get(e);return n&&Object.keys(r).length?{duration:this.getValue(e,"Duration"),events:(new L).get(e),id:t,mediaFiles:r,videoClicks:n}:null}}class U extends R{get(e){const t=new B,n=t.get(e),r=t.getCompanion(e);return n?{adSystem:this.getValue(e,"AdSystem"),companion:r,creatives:n}:null}}class $ extends N{constructor(){super(...arguments),this.create=()=>{try{const e=this.stringToVAST();if(!e)return null;this.vast=e,this.baseAd.request.data=this.json;const t=this.createVideo(),n=this.createOverlay(),r=this.createWrapper(t,n);return new M(t,this.vast.creatives[0].mediaFiles),k.wrap(this.baseAd,r)}catch(e){return null}},this.getEventScript=(e,t)=>{if(!t)return null;const n=b.createDOMElement("script");return n.innerHTML=`document.getElementById('${e}').onclick = function() { \n\t\t\t\t\t\t\t\tvar xhr = new XMLHttpRequest(); \n\t\t\t\t\t\t\t\txhr.open('GET', '${t}'); \n\t\t\t\t\t\t\t\txhr.send(); \n\t\t\t\t\t\t    };`,n}}createWrapper(e,t){const{width:n,height:r}=this.baseAd.params,i=S.createInlineStyle(Object.assign(Object.assign({},c),{height:r,width:n})),s=b.createDOMElement("div",{style:i});return s.appendChild(e),t&&s.appendChild(t),s}createOverlay(){if(!this.vast.companion)return null;const{staticRessource:e,clickThrough:t,clickTracking:n}=this.vast.companion,r=b.createDOMElement("img",{src:e,style:S.createInlineStyle(d)});if(!t)return r;const i=b.createDOMElement("a",{href:t,id:"overlay",target:"_blank"}),s=this.getEventScript("overlay",n);return i.appendChild(r),s&&i.appendChild(s),i}createVideo(){const e=b.createDOMElement("video",{autoplay:!0,loop:!0,muted:"muted",playsinline:"",preload:"auto",style:"width: 100%"});e.muted=!0,e.volume=0;const{clickThrough:t,clickTracking:n}=this.vast.creatives[0].videoClicks,r=b.createDOMElement("a",{href:t,id:"video",target:"_blank"}),i=this.getEventScript("video",n[0]);return r.appendChild(e),i&&r.appendChild(i),r}stringToVAST(){const e=(new DOMParser).parseFromString(this.json.full_html,"application/xml").querySelectorAll("InLine")[0];return e?(new U).get(e):null}}!function(e){e.AdaptiveVideo="adaptive_video",e.Video="video",e.Iframe="iframe",e.Image="image",e.VideoBanner="video_banner",e.Static="static"}(_||(_={}));class V{constructor(){this.create=(e,t)=>t.media_type===_.VideoBanner?new $(e,t):new N(e,t)}}var J=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class H extends j{constructor(){super(...arguments),this.create=()=>J(this,void 0,void 0,(function*(){return yield this.createWithDefaultIfFail(this.getIframeAd)})),this.getIframeAd=()=>J(this,void 0,void 0,(function*(){const e=yield k.getJSONFromContent(this);if(!e)return null;const t=(new V).create(this,e);return t?t.create():null}))}}var W=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Q extends j{constructor(){super(...arguments),this.createBottomAdElement=()=>W(this,void 0,void 0,(function*(){const e=yield this.createWithDefaultIfFail((()=>k.create(this)));if(!e)return null;const t=this.createContainer(),n=S.createInlineStyle({height:`${this.params.height}`,width:`${this.params.width}`}),r=b.createDOMElement("div",{style:n});return r.appendChild(this.createCloseButton(t)),r.appendChild(e),t.appendChild(r),t})),this.createCloseButton=e=>{const t=b.createDOMElement("div");return t.setAttribute("style",S.createInlineStyle(a)),t.onclick=()=>{document.body.removeChild(e),A.close()},t},this.createContainer=()=>{const t=b.createDOMElement("div",{id:e.botttomAdName});return t.setAttribute("style",S.createInlineStyle(o)),t}}create(){return W(this,void 0,void 0,(function*(){return window.tjBottomAdLoaded=!0,yield this.createBottomAdElement()}))}insertIntoDOM(e){document.body.appendChild(e)}checkIfCreatable(){return!A.wasClosed()&&!window.tjBottomAdLoaded&&super.checkIfCreatable()}revert(){delete window.tjBottomAdLoaded}}class X{constructor(){this.create=(e,t,n)=>"bottom"===t.type?new Q(e,t,n):this.isResponsive(t,n)?new T(e,t,n):new H(e,t,n),this.isResponsive=(e,t)=>{if("responsive"!==e.type)return!1;const n=e.info||(null==t?void 0:t.info);return!n||"partner"!==JSON.parse(n).content_type}}}var z=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class G{constructor(){this.sync=e=>z(this,void 0,void 0,(function*(){if(this.verify(e)&&!window.tjIdSyncSynced){window.tjIdSyncSynced=!0;try{const e=yield this.get();if(!e)return;e.set_TJ_uid().fp_get().sync()}catch(e){}}})),this.get=()=>z(this,void 0,void 0,(function*(){return new Promise((t=>{if(window.idsync)return t(window.idsync);const n=document.createElement("script");n.defer=!0,n.src=`${e.idSync.scriptUrl}?v=${this.getCacheVersion()}`,n.onload=n.onerror=()=>t(window.idsync),document.body.insertAdjacentElement("beforeend",n)}))})),this.getCacheVersion=()=>{const e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0).getTime()},this.verify=t=>{if(!t)return!1;const n=t.site,r="publisher"===t.invocation_type;return!(-1===e.idSync.sites.indexOf(n)&&!r)&&-1===window.navigator.userAgent.indexOf("MSIE")}}}var Z=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Y{constructor(){this.idSyncService=new G,this.preload=()=>{if(!window.tjPreloadAds)return;const t=x.getAdContextAttributes();for(const n in window.tjPreloadAds)"response"in window.tjPreloadAds[n]&&(window.tjPreloadAds[n].loaded||(window.tjPreloadAds[n].loaded=!0,new Promise((()=>Z(this,void 0,void 0,(function*(){const r=yield S.getElementBySpotId(e.adClassName,n);r&&this.run(r,t)}))))))},this.load=()=>{const t=document.getElementsByClassName(e.adClassName),n=x.getAdContextAttributes(),r=[];this.idSyncService.sync(n);for(let e=0;e<t.length;e++){const i=this.run(t[e],n);i&&r.push(i)}return Promise.all(r)},this.reload=e=>{const t=Y.ads[e];if(t)for(const e in t)t[e].reload()},this.run=(e,t)=>{const n=b.getDataAttributes(e);if(!this.canCreate(n))return null;e.setAttribute("data-loading","true");const r=(new X).create(e,n,t);return Y.ads[r.params.spotId]||(Y.ads[r.params.spotId]=[]),Y.ads[r.params.spotId].push(r),r.run()},this.verifyAttributes=e=>!(!this.verify(e,["source_id"])&&!this.verify(e,["spot_id"]))&&this.verify(e,["height","width"]),this.verify=(e,t)=>{let n=!0;for(let r=0;r<t.length;r++)e[t[r]]||(n=!1);return n},this.setDeliveryServer=()=>{const e=x.getAdContextAttributes();A.setDeliveryServer(null==e?void 0:e.delivery_server)}}init(){window.tjLoadEmbeddedAds=this.load,window.tjPreloadEmbeddedAds=this.preload,window.tjReloadEmbeddedAdsSpot=this.reload,window.tjDebug=y.debug,this.setDeliveryServer()}canCreate(e){if(e.loading)return!1;if(!this.verifyAttributes(e))return!1;const t=e.spot_id;return!(window.tjPreloadAds&&window.tjPreloadAds[t]&&!window.tjPreloadAds[t].loaded)}}Y.ads={};class K{constructor(){this.embeddedAdsService=new Y}init(){if(window.tjEmbeddedAdsLoaded)return!1;try{window.tjEmbeddedAdsLoaded=!0,this.sendLoadedEvent(),this.launch()}catch(e){return S.dispatchError(e),!1}return!0}launch(){this.embeddedAdsService.init(),this.embeddedAdsService.preload(),"loading"!==document.readyState?this.embeddedAdsService.load():document.addEventListener("DOMContentLoaded",(()=>{try{this.embeddedAdsService.load()}catch(e){S.dispatchError(e)}}))}sendLoadedEvent(){let e={};if(void 0!==window.tjEmbeddedAdsDuration){const t=void 0!==window.tjPreloadAds?Object.assign({},window.tjPreloadAds):null;e={duration:Date.now()-window.tjEmbeddedAdsDuration,tjPreloadAds:t}}b.dispatchTjEvent(l.embeddedAdsLoaded,e)}}(new K).init()}(),r}()}));