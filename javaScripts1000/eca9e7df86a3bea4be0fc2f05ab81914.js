(self.AMP=self.AMP||[]).push({n:"amp-auto-lightbox",ev:"0.1",l:true,v:"2107170150000",m:0,f:function(AMP,_){"use strict";function p(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}p(this);"function"===typeof Symbol&&Symbol("x");var q;function r(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}var t;function u(a,b,c,d){function e(m){try{return g(m)}catch(C){var h,n;null==(n=(h=self).__AMP_REPORT_ERROR)||n.call(h,C);throw C}}var f=a,g=c,l=v(),k=!(null==d||!d.capture);f.addEventListener(b,e,l?d:k);return function(){var m;null==(m=f)||m.removeEventListener(b,e,l?d:k);e=f=g=null}}function v(){if(void 0!==t)return t;t=!1;try{var a={get capture(){t=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return t}function w(a){return a?Array.prototype.slice.call(a):[]}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function x(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}function y(a,b){return a.closest?a.closest(b):x(a,(function(c){var d=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector;return d?d.call(c,b):!1}))}function z(a,b){for(a=a.lastElementChild;a;a=a.previousElementSibling)if(b(a))return a;return null}var A=self.AMP_CONFIG||{},B=("string"==typeof A.cdnProxyRegex?new RegExp(A.cdnProxyRegex):A.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function D(a){if(self.document&&self.document.head&&(!self.location||!B.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}A.cdnUrl||D("runtime-host");A.geoApiUrl||D("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var E=self.__AMP_LOG;function F(){if(E.dev)return E.dev;throw Error("failed to call initLogConstructor")}function G(a,b,c,d){var e=c,f=u(a,b,(function(g){try{e(g)}finally{e=null,f()}}),d);return f}function H(a){return!!(a.complete||"complete"==a.readyState||I(a)&&0<a.readyState||a.document&&"complete"==a.document.readyState)}function J(a){var b,c;if(H(a))return Promise.resolve(a);var d=I(a);return d&&a.__AMP_MEDIA_LOAD_FAILURE_SRC===a.currentSrc?Promise.reject(a):new Promise((function(e,f){b=d?G(a,"loadedmetadata",e,{capture:!0}):G(a,"load",e);if(a.tagName){var g=a;if(d&&!a.hasAttribute("src")&&(g=z(a,(function(l){return"SOURCE"===l.tagName})),!g))return f(Error("Media has no source."));c=G(g,"error",f)}})).then((function(){c&&c();return a}),(function(){b&&b();I(a)&&(a.__AMP_MEDIA_LOAD_FAILURE_SRC=a.currentSrc||!0);var e=a;e&&e.src&&(e=e.src);if(!E.user)throw Error("failed to call initLogConstructor");throw E.user.createError("Failed to load:",e)}))}function I(a){return"AUDIO"===a.tagName||"VIDEO"===a.tagName}var K={bubbles:!0,cancelable:!0};function L(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return M(a,b)}function N(a,b){var c=O(a);c=P(c);return M(c,b)}function O(a){return a.nodeType?L((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function P(a){a=O(a);return a.isSingleDoc()?a.win:a}function M(a,b){Q(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function Q(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}/nochunking=1/.test(self.location.hash);(function(){return q?q:q=Promise.resolve(void 0)})();function R(a,b){var c={needsRootBounds:!1},d=c=void 0===c?{}:c,e=d.needsRootBounds;return new b.IntersectionObserver(a,{threshold:d.threshold,root:b.parent&&b.parent!=b&&e?b.document:void 0})}new WeakMap;new WeakMap;var S,T;function U(a){S||(S=new WeakMap,T=new WeakMap);var b=T.get(a);b||(b=R((function(c){for(var d=new Set,e=c.length-1;0<=e;e--){var f=c[e].target;d.has(f)||(d.add(f),b.unobserve(f),S.get(f).resolve(c[e]),S.delete(f))}}),a),T.set(a,b));return b}function V(a){var b;if(null==(b=S)?0:b.has(a))return S.get(a).promise;U(a.ownerDocument.defaultView).observe(a);b=new r;S.set(a,b);return b.promise}function W(a){a.tagName.startsWith("AMP-");if(a.createdCallback)return Promise.resolve(a);if(!a.__AMP_UPG_PRM){var b=new r;a.__AMP_UPG_PRM=b.promise;a.__AMP_UPG_RES=b.resolve}return a.__AMP_UPG_PRM}var X={Article:!0,NewsArticle:!0,BlogPosting:!0,LiveBlogPosting:!0,DiscussionForumPosting:!0};function Y(){}var aa=/\s+([0-9]+)w(,|[\S\s]*$)/g;function ba(a){return N(a,"mutator").mutateElement(a,(function(){a.setAttribute("i-amphtml-auto-lightbox-visited","")}))}function ca(){return["amp-img","img"].map((function(a){return a+":not([lightbox]):not([i-amphtml-auto-lightbox-visited])"})).join(",")}function da(a){return"IMG"===a.tagName?J(a):W(a).then((function(b){return b.signals().whenSignal("load-end")}))}function ea(a){return w(a.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map((function(b){try{var c=JSON.parse(b.textContent)}catch(d){c=null}return(c||{})["@type"]})).filter(Boolean)}function fa(a){return ea(a).some((function(b){return X[b]}))}function ha(a){function b(c){return!!a.getRootNode().querySelector(c)}return b('script[custom-element="amp-lightbox-gallery"]')&&b("[lightbox]:not([i-amphtml-auto-lightbox-visited])")}var ia=0;function ja(a,b){return N(a,"mutator").mutateElement(b,(function(){b.setAttribute("lightbox","i-amphtml-auto-lightbox-"+ia++)})).then((function(){L(a.win,"extensions").installExtensionForDoc(a,"amp-lightbox-gallery");var c=b.ownerDocument.createEvent("Event");c.data={};c.initEvent("amp-auto-lightbox:newly-set",K.bubbles,K.cancelable);b.dispatchEvent(c);return b}))}function ka(a,b){b.map((function(c){return da(c).then((function(){return V(c).then((function(d){var e=d.boundingClientRect;if(d="IMG"===c.tagName||c.signals().get("load-end")){d=e.width;var f=e.height,g=c.querySelector("img")||c,l=g.naturalHeight;var k=g.naturalWidth;var m=k/l;var h=-1;if(g=g.getAttribute("srcset"))for(var n;n=aa.exec(g);)n=parseInt(n[1],10),n>h&&(h=n);k=h>k?{naturalWidth:h,naturalHeight:h/m}:{naturalWidth:k,naturalHeight:l};l=k.naturalHeight;k=k.naturalWidth;h=N(a,"viewport").getSize();m=h.width;h=h.height;d*=f;if(d=1.2<=k*l/d||k>m||l>h||.25<=d/(m*h))"IMG"===c.tagName&&y(c,"amp-img")||y(c,"a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]")?d=!1:(d=O(a||c),d=P(d),d=!(Q(d,"action")?M(d,"action"):null).hasResolvableAction(c,"tap"))}if(d)return F().info("amp-auto-lightbox","apply",c),ja(a,c)}))}),Y)}))}function Z(a,b){if(ha(a))var c=0;else c=(c=a.getRootNode().querySelector('meta[property="og:type"]'))?c.getAttribute("content"):void 0,c="article"==c||fa(a);if(c){c=b||a.win.document;var d=ca();c=w(c.querySelectorAll(d));c.forEach(ba);ka(a,c)}else F().info("amp-auto-lightbox","disabled")}(function(a){var b=a.ampdoc;b.whenReady().then((function(){b.getRootNode().addEventListener("amp:dom-update",(function(c){Z(b,c.target)}));Z(b)}))})(self.AMP)}});//# sourceMappingURL=amp-auto-lightbox-0.1.js.map