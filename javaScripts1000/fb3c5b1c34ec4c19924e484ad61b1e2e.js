(function(){var d,s,l;try{var u=window.$MicrosoftMaps8,n=u.Internal,ci=n._WorkDispatcher,li=u.Anchor,wt=u.BasicTemplate,ai=n._BinaryObject,vi=u.BitmapImageTemplate,bt=u.ChildVectorImageTemplate,kt=n._CurveKey,ft=n._Curve,h=n._Color,et=n._ComponentNames,yi=n._CurveVector4,ot=n._CurveColor,a=n._CurveColorHelper,st=n.CustomMapStyleManager,nt=n._DiscreteRangeCollectionSpline,t=n._Debug,dt=n._Gimme,e=u.GlobalConfig,r=n._Helper,ht=n._HslaTransformCurve,y=n._JSEvent,w=e.features.labels,gt=n._LatLonCrs,pi=u.LocationRect,tt=n._LoggerConstants,c=n._LruCache,ni=u.Matrix2D,ti=n._MapAuthentication,wi=u.Location,bi=u.MapMath,f=u.MercatorCubeCrs,ki=n._MercatorTileUtility,o=n._Network,it=n._Observable,di=n._ObservableObject,ii=u.Point,gi=n.PyramidTileSpatialIndex,nr=u.Rectangle,ri=n.SheetSpatialIndex,rt=n.StaticPromise,ct=n._TransformCurve,lt=n._Url,i=u.VectorImageTemplate,v=n._VectorMath,b=e.features.xsr,k=u.ZoomLevel,ui=this&&this.__spreadArrays||function(){for(var i=0,n=0,r=arguments.length;n<r;n++)i+=arguments[n].length;for(var u=Array(i),f=0,n=0;n<r;n++)for(var e=arguments[n],t=0,o=e.length;t<o;t++,f++)u[f]=e[t];return u},at=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ut;(function(n){function f(n,f,e){var h=u[f],s,o;return n&&h?(s="badge${badgeType}{templates[0].id}",o=t.getItem(s),o||(o=new bt(n[0],h,2,0,e?e:i,r),t.addItem(s,o)),ui(n,[o])):n}var i={x:-2,y:3},r=.875,t=new c(25),u=[null,{records:[{vectorType:2,centerX:8,centerY:8,radiusX:7.5,radiusY:7.5,style:{fillStyle:"#de3700",lineWidth:1,strokeStyle:"#fff"}},{vectorType:4,pathData:"M9.108 5.882C 8.609 5.383 8.331 4.705 8.335 4c -0.094 0.036 -0.184 0.078 -0.272 0.127 -1.033 0.606 -1.379 1.934 -0.774 2.967l.125 .211c 0.29 0.37 0.225 0.905 -0.145 1.195 -0.37 0.29 -0.905 0.225 -1.195 -0.145l-.709 -.785c -0.739 1.359 -0.324 3.057 0.958 3.921 1.283 0.865 3.012 0.612 3.995 -0.583 0.982 -1.195 0.895 -2.941 -0.202 -4.032l-1.008 -.995z",style:{fillStyle:"#fff"}}]},{records:[{vectorType:2,centerX:8,centerY:8,radiusX:7.5,radiusY:7.5,style:{fillStyle:"#006d21",lineWidth:1,strokeStyle:"#fff"}},{vectorType:4,pathData:"M12 6.5l-1-1.49-2.125 1.424V4h-1.75v2.434L5 5 4 6.5 6.331 8 4 9.5 5 11l2.125-1.434V12h1.75V9.566L11 11l1-1.5L9.669 8z",style:{fillStyle:"#fff"}}]},{records:[{vectorType:2,centerX:8,centerY:8,radiusX:7.5,radiusY:7.5,style:{fillStyle:"#006d21",lineWidth:1,strokeStyle:"#fff"}},{vectorType:4,pathData:"M11.7,6.5L9.5,4.3c-0.2-0.2-0.5-0.2-0.7,0L4.3,8.8C4.2,8.8,4.1,9,4.1,9.1v2.3c0,0.3,0.2,0.5,0.5,0.5h2.3c0.1,0,0.3-0.1,0.4-0.1l4.5-4.5C11.9,7.1,11.9,6.7,11.7,6.5z M6.1,10.9c-0.1,0.1-0.3,0.2-0.5,0.2c-0.2,0-0.4-0.1-0.5-0.2c-0.1-0.1-0.2-0.3-0.2-0.5S4.9,10,5.1,9.9c0.1-0.1,0.3-0.2,0.5-0.2c0.2,0,0.4,0.1,0.5,0.2c0.1,0.1,0.2,0.3,0.2,0.5S6.3,10.8,6.1,10.9z",style:{fillStyle:"#fff"}}]}];n.addBadgeTemplate=f})(ut||(ut={}));d=function(){function n(n,i,u,f,e){var o=this;this._requestFailedCount=0;this._maxFailureForFailover=10;this.spatialIndex=new ri;this._map=n;this._coreConfig=i;this._constructGeometryFromLabelHints=typeof e=="boolean"?e:!0;this._minZoom=i.basemapDataMinZoom;this._maxZoom=i.basemapDataMaxZoom;t.assertNotNullOrEmpty(u,"vectorTileUrlFormat");this._layersOfInterest=f;this._urlFormat=r._updateTfeUrlDomain(u);this._urlFormat=r._updateTfeMktAndUrl(this._urlFormat);i.vectorTileFeatures&&(this._urlFormat+=i.vectorTileFeatures);this._urlContainsCredentialsParam=this._urlFormat.indexOf("{credentials}")>-1;this._id=this._jsonsoSuffix="basemap";this._requests={};this.invalidated=new y;n.mapTypeChangeStarted.add(function(){return o._updateCstl()});this._updateCstl()}return n.prototype.getLayerDataSource=function(n){return new yt(n,this,this.spatialIndex)},n.prototype.cancelPrimitivesRequest=function(n,t){var i=this._getDispatchKey(n,null,t||"",this._id);o.abortRequest(this._requests[i])},n.prototype.cancelPrimitivesRequestInternal=function(n,t,i){var r=this._getDispatchKey(n,t,i||"",this._id);o.abortRequest(this._requests[r])},n.prototype.getPrimitives=function(n,t,i,r){this.getPrimitivesInternal(n,null,t,i,r)},n.prototype.shouldFetchPrimitives=function(){return!0},n.prototype.getPrimitivesInternal=function(t,i,u,f,e){var c=this._getDispatchKey(t,i,f||"",this._id),s,h,l,v;if(e=Math.round(e),e<this._minZoom||e>this._maxZoom||!this.shouldFetchPrimitives())this._completeRequest(u,{primitives:[]},c);else{var a=t.quadKey,y=this.getFilterKey(),p=this._cstl,o=this._urlFormat.replace(/{quadkey}/ig,a).replace(/{subdomain}/ig,r._getTileSubDomain(a)).replace(/{filter}/ig,y).replace(/{cstl}/ig,p);o.startsWith("data:")||(s=lt.fromString(o),typeof FunctionalTestHooks!="undefined"&&(h=s.queryStringParameters&&s.queryStringParameters.ourl,h&&(h=lt.fromString(atob(h)).toString(!0,!0),s.queryStringParameters.ourl=btoa(h))),o=s.toString(!0,!0));l=n._responsesCacheV2.getItem(o);l?(v=this._getVectorDataResponse(i,l),this._completeRequest(u,this._filterResponse(v),c)):this._downloadGrid(t,c,i,o,u)}},n.prototype._filterResponse=function(n){return n},n.prototype.applyFilter=function(n){this._filter=n;this.invalidated.invoke()},n.prototype.resetFilter=function(){this._filter=null;this.invalidated.invoke()},n.prototype.getFilterKey=function(){var r="",t=this._filter,i,n;if(t&&t.value&&t.distribution)for(i=t.value,n=0;n<i.length;n++)r+=i[n]+":"+t.distribution[n],n<i.length&&(r+=",");return r},n.prototype._updateCstl=function(){var n=this._map.getMapType(),t=n&&n.cstl||"";this._cstl!==t&&(this._cstl=t,this.invalidated.invoke())},n.prototype._downloadGrid=function(i,u,f,e,s,h){var c=this,l=i.quadKey,a;t.logDebugData("BaseMapDataSource - _downloadgrid() "+l);t.time(r._formatString("Network call for quadkey - {0}",l));a=null;(!this._coreConfig.autoGenBaseMapJsonso||t.getFunctionalTestHooksEnabled())&&(a=l.toString()+"_"+this._jsonsoSuffix);var v=this._urlContainsCredentialsParam||this._requestFailedCount>this._maxFailureForFailover||h,y=this._getUpdatedUrlWithCredentials(e,v),p=function(n){c._handleResponse(i,e,u,f,s,n,!0)},w=function(r,o){t.log(null,"ERROR: failed to get {0}",l);o===4||h?c._handleResponse(i,e,u,f,s,n._createEmptyResponse(),!1,o):(c._requestFailedCount++,c._logNetworkError(),c._downloadGrid(i,u,f,e,s,!0))};this._requests[u]=o.downloadJsonp(y,"grid",p,w,a,!1,null,0)},n.prototype._handleResponse=function(i,u,f,e,o,s,h,c){var w=this,v,l,a,y;this._map.isDisposed()||(v=i.quadKey,delete this._requests[f],t.groupCollapsed(null,"Callback for lod: {0} quadkey {1}",i.lod.toString(),v),t.timeEnd(r._formatString("Network call for quadkey - {0}",v)),t.time(r._formatString("Parsing vector response for quadkey - {0}",v)),l=n._responsesCacheV2.getItem(u),l||(s&&!s.tag?l=this._parseResponse(s,i,u):(l=n._responsesCacheV2.getItem(u)||{},it.mergeProperties(l,this._parseNullDataRegion(e))),h&&n._responsesCacheV2.addItem(u,l)),t.timeEnd(r._formatString("Parsing vector response for quadkey - {0}",v)),s&&s.requestFailed||(a=this._getVectorDataResponse(e,l)),a||(a={primitives:null,requestFailed:!0,requestAborted:c===4}),y=a&&a.primitives,y&&y.length>0?this._map.getTemplateSelector().then(function(n){var t=function(){for(var t,h,i,r=[],u=[],e=[],s=0;s<y.length;s++)t=y[s],t.entity&&t.entity.oid?e.push(t.entity.oid):t.geometryType===1?r.push(t.bucket):(h=p.getShieldIndices(t.entity),h.length>0&&u.push({bucketId:t.bucket,indexes:h}));i=[];r.length>0&&i.push(n.prefetchImages(r));u.length>0&&i.push(n.prefetchShields(u));e.length>0&&i.push(n.prefetchOrganizationImagesByOrgId(e));Promise.all(i).then(function(){w._completeRequest(o,w._filterResponse(a),f)})};n.selectorReady().then(t)}):this._completeRequest(o,this._filterResponse(a),f),t.groupEnd())},n.prototype._completeRequest=function(n,t){n(t)},n.prototype._getDispatchKey=function(n,t,i,r){var u=n.quadKey;return t?u+"_"+t+"_"+i+"_"+r:u+"_"+i+"_"+r},n._createEmptyResponse=function(){return{entities:[],layers:{},requestFailed:!0}},n.prototype._getVectorDataResponse=function(n,t){var u=null,i,r;if(n)this._layersOfInterest.indexOf(n)>-1&&(u=t[n]);else{for(i=[],r=0;r<this._layersOfInterest.length;r++)t[this._layersOfInterest[r]]&&i.push.apply(i,t[this._layersOfInterest[r]].primitives);i.length>0&&(u={primitives:i})}return u},n.prototype._parseNullDataRegion=function(t){var u,i,r;if(n._nullDataRegionResponse||(u={isNullDataRegionMarker:!0,crs:gt.instance,geometryType:1,geometry:{x:0,y:0,bounds:[90,180,-90,-180]}},n._nullDataRegionResponse={primitives:[u]}),i={},t)i[t]=n._nullDataRegionResponse;else for(r=0;r<this._layersOfInterest.length;r++)i[this._layersOfInterest[r]]=n._nullDataRegionResponse;return i},n.getAnchorTextSpan=function(n){var t,i,e,r,o,u,f;if(n&&n.lbl)for(i=0,e=n.lbl.length;i<e;i++){for(r=n.lbl[i],o=r.tps&&r.tps.length||0,u=0;u<o;u++)if(f=r.tps[u],t=t||f,!f.n){t=f;break}if(t&&!t.n)break}return t},n.prototype._constructGeometryFromHint=function(t,i){var f,e=n.getAnchorTextSpan(t),r,u,o;if(e){r=e.x||0;u=e.y||0;switch(i){case 1:f={x:r,y:u,bounds:[u,r,u,r]};break;case 2:f={x:[r,r],y:[u,u],bounds:[u,r,u,r]};break;case 3:o={x:[r,r],y:[u,u]};f={rings:[o],r:[o],bounds:[u,r,u,r]}}}return f},n.prototype._logResponseError=function(n,t,i){var r=u.logger,f;r&&(f={feature:et.BaseMapData,action:tt.Error,data:{layerId:i||"",response:t||"",url:n||""}},r.logCriticalError(null,f))},n.prototype._parseResponse=function(n,i,u){var rt=n.entities,ut=i.crs,p={},a=n.layers,c=n.placement,g,nt,w,ft,s,b,et,h,k,e,tt,v,o,f,ot,l,d,it;if(this._constructGeometryFromLabelHints&&c&&c.length>0)for(g={},nt=Object.keys(a),w=0,ft=nt.length;w<ft;w++)for(s=nt[w],p[s]={primitives:[]},h=a[s],b=0,et=h.length;b<et;b++)(e=h[b],o=e.entityIndex||e.ei,t.assert(o!==0,"Primitive with entityindex 0 is invalid"),g[o+","+e.gt])||(e.bucket=e.bkt,e.entityIndex=o,e.geometryType=e.gt,e.geometry=this._constructGeometryFromHint(c[o],e.geometryType),t.assert(e.geometry!==null,"Geometry should be constructed from a hint"),f=rt[o],f&&(this._coreConfig.clickBasemapPrimitives&&(f.clickable=f.clickable||!!f.clk,f.clickable&&(e.isTapEnabled||(e.isTapEnabled=e.isHoverEnabled=function(){return!0}),f.changed||(f.changed=new y))),f.name=f.displayName||f.dn,f.labelImportance=f.labelImportance||f.li||-1,f.ypid=f.ypid||f.yp,f.shieldName=f.shieldName||f.sn||[],f.shieldIndex=f.shieldIndex||f.si||[],f.labelHint=c[o],f.landmarksDealFlag=!!f.cp,e.entity=f),e.crs=ut,p[s].primitives.push(e),g[o+","+e.gt]=o);else for(s in a)if(a.hasOwnProperty(s))for(h=this._generateLinePrimitives(a[s]),p[s]={primitives:h},h=h,k=0;k<h.length;k++)if(e=h[k],!e.bucket){e.g||this._logResponseError(u,JSON.stringify(n),s);e.bucket=e.bkt;e.entityIndex=e.ei;e.geometry=e.g;e.geometryType=e.gt;e.geometry.bounds=e.g.b;switch(e.geometryType){case 1:tt=16384;v=e.geometry;e.geometry.bounds=[Math.min(tt,v.y),v.x,v.y,Math.min(tt,v.x)];break;case 3:l=e.geometry;l.rings=l.r}if(o=e.entityIndex,f=rt[o],f&&(f.name=f.displayName||f.dn,f.labelImportance=f.labelImportance||f.li||-1,f.ypid=f.ypid||f.yp,f.shieldName=f.shieldName||f.sn||[],f.shieldIndex=f.shieldIndex||f.si||[],f.labelHint=c&&c[o],e.entity=f.ypid?f:f.tj?f:f),ot=e.geometry,e.geometryType===3)for(l=ot,d=0;d<l.rings.length;d++)it=l.rings[d],r._deltaDecode(it.x),r._deltaDecode(it.y);e.crs=ut}return p},n.prototype._generateLinePrimitives=function(n){for(var t,i,u,s,h,f,c,e=[],o=0;o<n.length;o++)if(t=n[o],t.gt===3){if(i=t.g.r,!i)continue;for(u=0;u<i.length;u++)s=i[u],r._deltaDecode(s.x),r._deltaDecode(s.y);for(h=this._convertPolygonToPolylineGeometry(t.g,512),f=0;f<h.length;f++)c={entityIndex:t.ei,ei:t.ei,bkt:t.bkt,gt:2,g:h[f]},e.push(c)}else e.push(t);return e},n.prototype._convertPolygonToPolylineGeometry=function(n,t){for(var r,s,h,e,u,o=[],c=0;c<n.r.length;c++){var i=n.r[c],l=!1,f=null;for(i.x.length>0&&(i.x.push(i.x[0]),i.y.push(i.y[0])),r=0;r<i.x.length;r++)s=i.x[r],h=i.y[r],s<0||s>t||h<0||h>t?(l=!0,r>0&&(e=[],u=this._lineIntersect(0,0,0,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&e.push(u),u=this._lineIntersect(0,0,t,0,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&e.push(u),u=this._lineIntersect(0,t,t,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&e.push(u),u=this._lineIntersect(t,0,t,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&e.push(u),e.length===1&&f?(f.x.push(e[0].x),f.y.push(e[0].y)):e.length===2&&o.push({x:[e[0].x,e[1].x],y:[e[0].y,e[1].y],bounds:null,b:[0,0,t,t]})),f&&(o.push(f),f=null)):(f||(f={x:[],y:[],bounds:null,b:[0,0,t,t]}),l&&(u=this._lineIntersect(0,0,0,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r])||this._lineIntersect(0,0,t,0,i.x[r-1],i.y[r-1],i.x[r],i.y[r])||this._lineIntersect(0,t,t,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r])||this._lineIntersect(t,0,t,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&(f.x.push(u.x),f.y.push(u.y))),f.x.push(s),f.y.push(h),l=!1);f&&o.push(f)}return o},n.prototype._lineIntersect=function(n,t,i,r,u,f,e,o){var h,s,c,l,a;return n===i&&t===r||u===e&&f===o?null:(h=(o-f)*(i-n)-(e-u)*(r-t),h===0)?null:(s=((e-u)*(t-f)-(o-f)*(n-u))/h,c=((i-n)*(t-f)-(r-t)*(n-u))/h,s<0||s>1||c<0||c>1)?null:(l=n+s*(i-n),a=t+s*(r-t),new ii(l,a))},n.prototype._getUpdatedUrlWithCredentials=function(n,t){return t?this._urlContainsCredentialsParam||(n+="&key="+ti.instance.getSessionId()):!t&&this._urlContainsCredentialsParam&&(n=n.replace(/&?key={credentials}/ig,"")),n},n.prototype._logNetworkError=function(){var n,t;this._requestFailedCount===this._maxFailureForFailover+1&&Math.random()<=.1&&(n=u.logger,n&&(t={feature:et.MapControl,action:tt.Error,data:{errorMessage:"Basemap vector data requests failed "+this._requestFailedCount+" times. Switching over to use TFE authentication."}},n.logCriticalError(null,t)))},n._responsesCacheV2=new c(50),n}(),function(n){function t(n,t){var i=t[n]||{};return i.type==="SvgFixedColor"?i.color:i.type==="SvgPaletteColor"?{value:i.color,property:e(i.svgPaletteColor)}:null}function w(n){var t=null;return n&16?t="semiBold":n&1?t="bold":n&32&&(t="light"),t}function s(n){for(var i,r=[],t=0,u=n;t<u.length;t++)i=u[t],r.push(i.x,i.y);return r}function b(n,i,r){if(!n)return null;var u=null;switch(n.recordType){case"Ellipse":u={type:"ellipse",scale:{property:n.scalePaletteKeyId},stroke:t(n.lineStyle.colorValueId,i),strokeScale:{property:n.strokeScalePaletteKeyId},strokeWidth:n.lineStyle.strokeWidth,centerX:n.cX,centerY:n.cY,radiusX:n.rX,radiusY:n.rY};break;case"FilledEllipse":u={type:"ellipse",scale:{property:n.scalePaletteKeyId},fill:t(n.colorValueId,i),centerX:n.cX,centerY:n.cY,radiusX:n.rX,radiusY:n.rY};break;case"Path":u={type:"path",scale:{property:n.scalePaletteKeyId},stroke:t(n.strokeValueId,i),strokeScale:{property:n.strokeScalePaletteKeyId},strokeWidth:n.strokeWidth,fill:t(n.fillValueId,i),data:n.geometryString};break;case"Polygon":u={type:"polygon",scale:{property:n.scalePaletteKeyId},fill:t(n.colorValueId,i),points:s(n.pointsList)};break;case"Polyline":u={type:"polyline",scale:{property:n.scalePaletteKeyId},stroke:t(n.lineDrawStyle.colorValueId,i),strokeScale:{property:n.strokeScalePaletteKeyId},strokeWidth:n.lineDrawStyle.strokeWidth,points:s(n.pointsList)};break;case"Text":u={type:"text",scale:{property:n.scalePaletteKeyId},x:n.leftTop.x,y:n.leftTop.y,width:n.rightBottom.x-n.leftTop.x,height:n.rightBottom.y-n.leftTop.y,fill:t(n.textStyle.colorValueId,i),fontFamily:r.getFixedString(n.textStyle.fontFamilyId),fontSize:n.textStyle.fontSize,fontWeight:w(n.textStyle.fontStyle)}}return u}function k(n,t,i){var r,f,s,e,h,c,o,u;if(!n)return null;for(r={background:{records:[],shape:-1},icon:{records:[],shape:-1}},f=0,s=n.records;f<s.length;f++)e=s[f],h=b(e,t,i),h&&(c=i.getFixedString(e.shapePaletteKeyId)||"",o=c.endsWith(l.backgroundShapeRecord)?r.background:r.icon,o.records.push(h),c&&o.shape===-1&&(o.shape=e.shapePaletteKeyId));return u={anchorX:n.hotspotX,anchorY:n.hotspotY,overrideAnchor:n.overrideHotspot},r.background.shape!==-1||r.icon.shape!==-1?(u.layers={},r.background.records.length&&(u.layers.background=r.background),r.icon.records.length&&(u.layers.icon=r.icon)):u.records=r.icon.records,u}function r(n,t,i){var r=t[n]||{},u;return r.type==="SvgFixedColor"?r.color:r.type==="SvgPaletteColor"?(u=i.getColorPaletteValue(e(r.svgPaletteColor)),u||u===0?a.convertPackedTorgba(u):r.color):null}function u(n,t,i){var u=t[n]||{},r;return u.type==="SvgPaletteColor"&&(r=e(u.svgPaletteColor),typeof r=="number")?i.getFixedString(r):undefined}function e(n){var t,i;return n&&(t=n.paletteKeyId,typeof t!="number"&&(i=n.idPair&&n.idPair[0],t=i&&i.second)),t}function d(n,t,f){var e=null;switch(n.recordType){case"Ellipse":e={vectorType:2,centerX:n.cX,centerY:n.cY,radiusX:n.rX,radiusY:n.rY,style:{lineWidth:n.lineStyle.strokeWidth,lineWidthScale:f.getSinglePaletteValue(n.strokeScalePaletteKeyId),strokeStyle:r(n.lineStyle.colorValueId,t,f)},strokeScalePaletteKey:f.getFixedString(n.strokeScalePaletteKeyId),strokeStylePaletteKey:u(n.lineStyle.colorValueId,t,f)};break;case"FilledEllipse":e={vectorType:2,centerX:n.cX,centerY:n.cY,radiusX:n.rX,radiusY:n.rY,style:{fillStyle:r(n.colorValueId,t,f)},fillStylePaletteKey:u(n.colorValueId,t,f)};break;case"Path":e={vectorType:4,pathData:n.geometryString,style:{fillStyle:r(n.fillValueId,t,f),lineWidth:n.strokeWidth,lineWidthScale:f.getSinglePaletteValue(n.strokeScalePaletteKeyId),strokeStyle:r(n.strokeValueId,t,f)},fillStylePaletteKey:u(n.fillValueId,t,f),strokeScalePaletteKey:f.getFixedString(n.strokeScalePaletteKeyId),strokeStylePaletteKey:u(n.strokeValueId,t,f)};break;case"Polygon":e={vectorType:0,pointsList:n.pointsList,style:{fillStyle:r(n.colorValueId,t,f)},fillStylePaletteKey:u(n.colorValueId,t,f)};break;case"Polyline":e={vectorType:1,pointsList:n.pointsList,style:{lineWidth:n.lineDrawStyle.strokeWidth,lineWidthScale:f.getSinglePaletteValue(n.strokeScalePaletteKeyId),strokeStyle:r(n.lineDrawStyle.colorValueId,t,f)},strokeScalePaletteKey:f.getFixedString(n.strokeScalePaletteKeyId),strokeStylePaletteKey:u(n.lineDrawStyle.colorValueId,t,f)};break;case"Text":var o=n.leftTop||{x:0,y:0},s=n.rightBottom||o,h=o.x,c=s.x,l=o.y,a=s.y;e={vectorType:3,text:i.placeholderText,anchor:{x:(h+c)/2,y:(l+a)/2},maxWidth:c-h,leftTop:o,rightBottom:s,style:{fillStyle:r(n.textStyle.colorValueId,t,f),font:f.getFixedString(n.textStyle.fontFamilyId)||i.defaultFont,fontStyle:n.textStyle.fontStyle,fontSize:n.textStyle.fontSize,horizontalAutoScaling:n.horizontalAutoScaling,verticalAlignment:1},fillStylePaletteKey:u(n.textStyle.colorValueId,t,f)}}return e&&(e.scale=f.getSinglePaletteValue(n.scalePaletteKeyId),e.scalePaletteKey=f.getFixedString(n.scalePaletteKeyId),e.shapePaletteKey=f.getFixedString(n.shapePaletteKeyId)),e}function g(n,t,i){return n&&{hitTest:1,hotspotX:n.hotspotX,hotspotY:n.hotspotY,overrideHotspot:n.overrideHotspot,records:n.records&&n.records.map(function(n){return d(n,t,i)})}}function o(n,t){var i,r,u;if(typeof n=="string")i=n;else if(n){if(r=t.getColorPaletteValue(n.property),r||r===0)return a.convertPackedTorgba(r);i=n.value||h.transparent}return i?(u=h.parse(i,2),u&&u.toRgba()):undefined}function c(n,t){return typeof n=="number"?n:n?t.getSinglePaletteValue(n.property):1}function f(n,t){return typeof n=="object"?t.getFixedString(n.property):undefined}function nt(n){var t=0;switch(n){case"bold":t=1;break;case"semiBold":t=16;break;case"light":t=32}return t}function v(n){var i=[],t;if(n.length%2==0)for(t=0;t<n.length;t+=2)i.push({x:n[t],y:n[t+1]});return i}function y(n,t,r){function y(n,t){var i=t.style,u=o(n.stroke,r);u&&(i.strokeStyle=u,i.lineWidth=n.strokeWidth||1,i.lineWidthScale=c(n.strokeScale,r),t.strokeScalePaletteKey=f(n.strokeScale,r),t.strokeStylePaletteKey=f(n.stroke,r))}function h(n,t){y(n,t);var i=o(n.fill,r);i&&(t.style.fillStyle=i,t.fillStylePaletteKey=f(n.fill,r))}var u=null;switch(n.type){case"circle":u={vectorType:2,centerX:n.centerX||0,centerY:n.centerY||0,radiusX:n.radius||0,radiusY:n.radius||0,style:{}};h(n,u);break;case"ellipse":u={vectorType:2,centerX:n.centerX||0,centerY:n.centerY||0,radiusX:n.radiusX||0,radiusY:n.radiusY||0,style:{}};h(n,u);break;case"line":u={vectorType:1,pointsList:[{x:n.x1||0,y:n.y1||0},{x:n.x2||0,y:n.y2||0}],style:{lineCap:n.lineCap||"butt",lineJoin:n.lineJoin||"round"}};y(n,u);break;case"path":u={vectorType:4,pathData:n.data,style:{}};h(n,u);break;case"polygon":u={vectorType:0,pointsList:v(n.points),style:{}};h(n,u);break;case"polyline":u={vectorType:1,pointsList:v(n.points),style:{lineCap:n.lineCap||"butt",lineJoin:n.lineJoin||"round"}};h(n,u);break;case"rect":var e=n.x||0,s=n.y||0,l=n.width||0,a=n.height||0;u={vectorType:0,pointsList:[{x:e,y:s},{x:e+l,y:s},{x:e+l,y:s+a},{x:e,y:s+a},{x:e,y:s}],style:{}};h(n,u);break;case"text":var e=n.x||0,s=n.y||0,l=n.width||0,a=n.height||0;u={vectorType:3,text:i.placeholderText,anchor:{x:e+l/2,y:s+a/2},maxWidth:l,leftTop:{x:e,y:s},rightBottom:{x:e+l,y:s+a},style:{fillStyle:o(n.fill,r),font:n.fontFamily||i.defaultFont,fontStyle:nt(n.fontWeight),fontSize:n.fontSize||0,horizontalAutoScaling:1,verticalAlignment:1},fillStylePaletteKey:f(n.fill,r)}}return u&&(u.scale=c(n.scale,r),u.scalePaletteKey=f(n.scale,r),u.shapePaletteKey=t),u}function p(n,t,i,r){var u=t.layers[i];u&&u.records&&n.push.apply(n,u.records.map(function(n){return y(n,r.getFixedString(u.shape),r)}))}function tt(n,t){var i=[];return(n&&n.layers?(p(i,n,"background",t),p(i,n,"icon",t)):n&&n.records&&i.push.apply(i,n.records.map(function(n){return y(n,undefined,t)})),i&&i.length)?{hitTest:1,hotspotX:n.anchorX,hotspotY:n.anchorY,overrideHotspot:n.overrideAnchor||!1,records:i}:undefined}n.convertLegacyImage=k;n.imageFromLegacy=g;n.imageFromBaseMap=tt}(s||(s={})),function(n){var t=function(){function t(n){this._images={};this._orgImages={};this._legacyImages=[];this._legacyOrgImages={};this._parsedImages=new c(250);var t=e.dynamicProperties,i=t.compositionHandlerGenerationId,u=n.mapTemplateUrlBase.replace("{stlRequestDomain}",t.bingRequestDomain);this._urlImageFormat=r._updateTfeUrlDomain(b.mapImageTemplateUrlFormat.replace("{urlbase}",u)).replace("{stlVersion}",e.stlVersion).replace("{odmgenid}",i);this._fetchNewImageFormat=b.fetchNewMapImageFormat;this._convertLegacyFormat=b.convertLegacyMapImageFormat}return t.prototype.getImage=function(t,i,r,u){var s=t+"_"+i,e=this._parsedImages.getItem(s),f,o;return e||(this._fetchNewImageFormat||this._convertLegacyFormat?(f=this._images[t],f&&(e=n.imageFromBaseMap(f,u))):(f=this._legacyImages[t],f&&(o=void 0,"image"in f?(o=f.image&&f.image.vectorImage,r=f.svgColor):o=f,o&&(e=n.imageFromLegacy(o,r,u)))),e&&this._parsedImages.addItem(s,e)),e},t.prototype.getOrgImage=function(t,i,r){var e="o"+t+"_"+i,f=this._parsedImages.getItem(e),u;return f||(this._fetchNewImageFormat||this._convertLegacyFormat?(u=this._orgImages[t],u&&(f=n.imageFromBaseMap(u,r))):(u=this._legacyOrgImages[t],u&&(f=n.imageFromLegacy(u.image&&u.image.vectorImage,u.svgColor,r))),f&&this._parsedImages.addItem(e,f)),f},t.prototype.createClassicIcon=function(n){var t=9999,i;return this._fetchNewImageFormat||this._convertLegacyFormat?this._images[t]||(this._images[t]={overrideAnchor:!0,layers:{background:{records:[{type:"circle",centerX:0,centerY:0,radius:10,fill:{value:"#FFFFFF",property:n.getFixedStringId("Task1.HighlightFillColor")},scale:{property:n.getFixedStringId("Task1.HighlightScale")},stroke:{value:"#FFFFFF",property:n.getFixedStringId("Task1.HighlightStrokeColor")},strokeScale:{property:n.getFixedStringId("Task1.HighlightStrokeWidthScale")},strokeWidth:1},{type:"circle",centerX:0,centerY:0,radius:7,fill:{value:"#FFFFFF",property:n.getFixedStringId("Task1.FillColor")},scale:{property:n.getFixedStringId("Task1.BackgroundScale")}}],shape:n.getFixedStringId("Task1.Shape-Background")}}}):this._legacyImages[t]||(i=[{type:"SvgPaletteColor",color:"#FFFFFF",svgPaletteColor:{paletteKeyId:n.getFixedStringId("Task1.FillColor")}},{type:"SvgPaletteColor",color:"#FFFFFF",svgPaletteColor:{paletteKeyId:n.getFixedStringId("Task1.HighlightFillColor")}},{type:"SvgPaletteColor",color:"#FFFFFF",svgPaletteColor:{paletteKeyId:n.getFixedStringId("Task1.HighlightStrokeColor")}},],this._legacyImages[t]={svgColor:i,image:{vectorImage:{overrideHotspot:!0,records:[{recordType:"FilledEllipse",cX:0,cY:0,rX:10,rY:10,scalePaletteKeyId:n.getFixedStringId("Task1.HighlightScale"),shapePaletteKeyId:n.getFixedStringId("Task1.Shape-Background"),colorValueId:1},{recordType:"Ellipse",cX:0,cY:0,rX:10,rY:10,scalePaletteKeyId:n.getFixedStringId("Task1.HighlightScale"),shapePaletteKeyId:n.getFixedStringId("Task1.Shape-Background"),strokeScalePaletteKeyId:n.getFixedStringId("Task1.HighlightStrokeWidthScale"),lineStyle:{colorValueId:2,strokeWidth:1}},{recordType:"FilledEllipse",cX:0,cY:0,rX:7,rY:7,scalePaletteKeyId:n.getFixedStringId("Task1.BackgroundScale"),shapePaletteKeyId:n.getFixedStringId("Task1.Shape-Background"),colorValueId:0}]}}}),t},t.prototype.prefetchImages=function(t,i,r,u,f){var e=this,s=t.split(",").map(function(n){return parseInt(n)}),h=s[0]%2,c=this._urlImageFormat.replace(/{imageIdx}/ig,t).replace(/{orgId}/ig,"").replace(/{subdomain}/ig,(isNaN(h)?0:h)+"");o.downloadJson(c,"XsrImages",function(t,f){for(var o,h,s=0,c=f;s<c.length;s++)o=c[s],h=t[o],e._fetchNewImageFormat?e._images[o]=h:e._convertLegacyFormat?e._images[o]=n.convertLegacyImage(h.vectorImage,i,r):e._legacyImages[o]=h.vectorImage;u&&u(f)},f,s,!1,0,!1)},t.prototype.prefetchOrgImage=function(t,i,r,u){var f=this,e=parseInt(t)%2,s=this._urlImageFormat.replace(/{orgId}/ig,t).replace(/{imageIdx}/ig,"").replace(/{subdomain}/ig,(isNaN(e)?0:e)+"");o.downloadJson(s,"XsrOrgJsImages",function(t,u){if(t)if(f._fetchNewImageFormat)f._orgImages[u]=t;else if(f._convertLegacyFormat){var e=t;f._orgImages[u]=n.convertLegacyImage(e.image&&e.image.vectorImage,e.svgColor,i)}else f._legacyOrgImages[u]=t;r&&r(u)},u,t,!1,0,!1)},t}();n.BaseMapImageLoader=t}(s||(s={}));var fi=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u,!1)||this}return at(t,n),t}(d),ei=function(){function n(n,t,i){this._items={};this._customStyleManager=n;n&&(n.palette=this);this._fixedStringList=t;this._fixedStringMap=i}return n._clone=function(n,t){var i;switch(n.type){case 0:i={keyId:t,type:n.type,stringId:n.stringId};break;case 1:i={keyId:t,type:n.type,value:n.value,ignoreTransform:n.ignoreTransform};break;case 3:i={keyId:t,type:n.type,value:n.value};break;case 2:i={keyId:t,type:n.type,value:n.value,ignoreTransform:n.ignoreTransform};break;case 4:i={keyId:t,type:n.type,value:n.value}}return i&&(i.additionalAttributes=n.additionalAttributes),i},n.prototype._addItem=function(n,t){this._items[t]=n},n.prototype.getStackedColorPaletteValue=function(n,t){var r=NaN,i=this.getStackedPaletteItem(n,t);return i&&i.type===1&&(r=i.value),r},n.prototype.getStackedSinglePaletteItem=function(n,t){var r=null,i=this.getStackedPaletteItem(n,t);return i&&i.type===2&&(r=i),r},n.prototype.getStackedStringPaletteValue=function(n,t){var r,i=this.getStackedPaletteItem(n,t);return i&&i.type===0&&(r=this._fixedStringList[i.stringId]),r},n.prototype.getStackedEnumPaletteValue=function(n,t){var r,i=this.getStackedPaletteItem(n,t);return i&&i.type===4&&(r=i.value),r},n.prototype.getStackedBooleanPaletteValue=function(n,t){var r,i=this.getStackedPaletteItem(n,t);return i&&i.type===3&&(r=i.value),r},n.prototype.getStackedPaletteItem=function(n,t){var e=null,r,o,i,s,h,u,f;if(!n||!t)return null;for(r=0,o=n.length;r<o;r++)if(i=this._customStyleManager&&this._customStyleManager.getElementItem(n[r],t),i||(s=n[r]+"."+t,h=this.getFixedStringId(s),i=this._items[h]),i)if(u=i.additionalAttributes,f=u&&u.propertyReferenceId,f)t=this._fixedStringList[f];else{e=i;break}return e},n.prototype.getColorPaletteValue=function(n,t){var r=NaN,i;return n=n||0,i=this._items[n],i&&(t&&i.keyId!==n||(r=i.value)),r},n.prototype.getSinglePaletteValue=function(n,t,i){var u,r;return i===void 0&&(i=1),u=i,n=n||0,r=this._items[n],r&&(t&&r.keyId!==n||(u=r.value)),u},n.prototype.getBooleanPaletteValue=function(n){var i=!1,t;return n=n||0,t=this._items[n],t&&(i=t.value),i},n.prototype.getStringPaletteValue=function(n){var i="",t;return n=n||0,t=this._items[n],t&&(i=this._fixedStringList[t.stringId]),i},n.prototype.getFixedStringId=function(n){var t=this._fixedStringMap[n];return typeof t!="number"&&(t=-1),t},n.prototype.getFixedString=function(n){return this._fixedStringList[n]},n.prototype.populate=function(i,r,u){var h,s,e,o,a,y,f;if(!i.isParsed){if(i.isParsed=!0,h={},i.nodeType){for(s=i.nodeType.properties,e={name:i.nodeType.name,parent:i.nodeType.parent,properties:i.nodeType.properties};e.parent&&e.parent.properties;)s=s.concat(e.parent.properties),e=e.parent;for(f=0;f<s.length;f++){var c=s[f].propertyName,v=i.name+"."+c,l=r[v];l?(this._addItem(l,l.keyId),h[c]=l):(o=u&&u[c],o?(a=this.getFixedStringId(v),a>=0?(y=o.additionalAttributes?n._clone(o,o.keyId):o,this._addItem(y,a),h[c]=y):t.assert(!0,"KeyId not in FixedStrings "+a)):t.assert(!0,"Palette key should be present "+v))}}if(i.children)for(f=0;f<i.children.length;f++)this.populate(i.children[f],r,h)}},n.prototype.getBackgroundShapeIds=function(){for(var n,e,i,r,u=Object.keys(this._items),f={},t=0,o=u.length;t<o;t++)n=this._items[u[t]],n&&n.type===0&&(e=n.keyId,i=this._fixedStringList[e],i&&i.endsWith(l.backgroundShapeRecord)&&(r=n.stringId,this._fixedStringList[r]&&(f[r]=!0)));return Object.keys(f)},n.prototype.addItem=function(n,t){var i={type:4,hasValue:!0,value:t};this.addPaletteItem(n,i)},n.prototype.addPaletteItem=function(n,t){t.keyId=this.addFixedString(n);this._addItem(t,t.keyId)},n.prototype.addFixedString=function(n){var t=this.getFixedStringId(n);return t===-1&&(t=this._fixedStringList.length,this._fixedStringList.push(n),this._fixedStringMap[n]=t),t},n}(),g=function(){function n(n){this._templateName=n}return n.prototype.dispose=function(){},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t){t(n)})),this._ready},n.prototype.getCategoryIconTemplate=function(n){Microsoft.Maps.setTimeout(function(){n&&n({icon:null,iconColor:""})},0)},n.prototype.getIconTemplate=function(n){Microsoft.Maps.setTimeout(function(){n&&n({icon:null,iconColor:""})},0)},n.prototype.getCityPolygonTemplates=function(){return null},n.prototype.getFirstDrawOrder=function(){return 0},n.prototype.getPolygonTemplates=function(){return null},n.prototype.getLandmarkVectorImageTemplate=function(t,i){var r=n._landmarkTemplates[i];return r?[r]:[]},n.prototype.getMarkupStyle=function(){var t=l.isDarkTheme(this._templateName)?n._darkThemeStyle:n._lightThemeStyle;return{styleStatic:t.styleStatic,styleDynamic:r._copyObject(t.styleDynamic)}},n.prototype.getName=function(){return this._templateName},n.prototype.getPoiTemplate=function(t,i){var r=n.poiTemplates[i];return r?[r]:[]},n.prototype.getPoiVectorImageTemplate=function(t,i){var r=n.poiTemplates[i];return r?[r]:[]},n.prototype.getRoutePoiVectorImageTemplate=function(t,i){var r;return r=t==="turn"?n.directionsTurnTemplate:n.poiTemplates[i],r?[r]:[]},n.prototype.prefetchShields=function(){return new Promise(function(n){n()})},n.prototype.prefetchImages=function(){return new Promise(function(n){n()})},n.prototype.prefetchOrganizationImagesByOrgId=function(){return new Promise(function(n){n()})},n.prototype.getFetchedShields=function(t,i,r){var u,f,e;if(i&&r&&r.length){for(u=[],f=0,e=r.length;f<e;f++)u.push(n.DefaultShieldTemplate);return u}return null},n.prototype.getShieldsAsync=function(n,t,i,r){var u=this;Microsoft.Maps.setTimeout(function(){r&&r(u.getFetchedShields(n,t,i))},0)},n.prototype.getTemplates=function(){return null},n._lightThemeStyle={styleStatic:{backgroundColor:"rgba(236,234,227,0.7)"},styleDynamic:{visible:!0,font:"SegoeBing",fontSize:10,fontColor:"#000"}},n._darkThemeStyle={styleStatic:{backgroundColor:"rgba(64,64,64,0.7)"},styleDynamic:{visible:!0,font:"SegoeBing",fontSize:10,fontColor:"#fff"}},n._landmarkTemplates=[null,null,new i({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1}),new i({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:12,radiusY:12},{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1}),new i({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:12,radiusY:12},{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1})],n.poiTemplates=[null,null,new i({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:10}],hitTest:1}),new i({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:16,radiusY:16},{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:10}],hitTest:1}),new i({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:2},centerX:0,centerY:0,radiusX:14,radiusY:14},{vectorType:2,style:{fillStyle:"#000"},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),new i({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:1},centerX:0,centerY:0,radiusX:8,radiusY:8}],hitTest:1}),new i({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:2},centerX:0,centerY:0,radiusX:10,radiusY:10},{vectorType:2,style:{fillStyle:"rgba(0,0,0,0.5)"},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),],n.directionsTurnTemplate=new i({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:1},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),n.DefaultShieldTemplate=new i({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#666",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:8},{vectorType:3,style:{fillStyle:"#000",font:"SegoeBing",fontSize:7,fontStyle:1,horizontalAutoScaling:1},anchor:{x:0,y:0},maxWidth:18,text:"{MapDisplay}"}]}),n}(),p;(function(n){function r(n){var t=n;return!!(t&&t.clickable)}function u(n){var i="",t=n;return t&&(t.getPrimaryLabelText?i=t.getPrimaryLabelText():t.name?i=t.name:t.getName?i=t.getName():t.title?i=t.title:t.getTitle&&(i=t.getTitle())),i}function f(n){var i="",t=n;return t.getSecondaryLabelText?i=t.getSecondaryLabelText():t.subtitle?i=t.subtitle:t.getSubtitle&&(i=t.getSubtitle()),i}function e(n){var i=!1,t=n;return typeof t.independentHotRegions!="undefined"?i=t.independentHotRegions:t.getIndependentHotRegions&&(i=t.getIndependentHotRegions()),i}function o(n){var i="",t=n;return t&&(t.getIconText?i=t.getIconText():t.iconText&&(i=t.iconText)),i}function s(n){var t=n;return t&&t.labelImportance||0}function h(n){var t=n;return t&&t.shieldName}function c(n){var t=n;return t&&t.shieldIndex}function i(n){var t=n&&n.split(":");return t&&t.length>1?t[1].replace(/^["\s]+|["\s]+$/g,""):""}function l(n){var r=n.split(","),u="",f="";return t.assertNotNull(r,"shield attributes"),t.assert(r.length===4,"all four shield attributes should be present"),r&&r.length===4&&(u=i(r[0]),f=i(r[3])),{text:u,modifier:f}}function a(n,t){var r=n,i=r&&(r.ypid||r.businesslistingid);return t&&i&&i.indexOf(":")>-1&&(i=i.split(":")[1]),i}function v(n){var t=n;return t&&t.tj}function y(n){var t=n;return t&&t.representsTransitStop}function p(n){return n&&n.poiType===5}n.getClickable=r;n.getDisplayName=u;n.getSecondaryDisplayName=f;n.independentHotRegions=e;n.getIconText=o;n.getLabelImportance=s;n.getShieldNames=h;n.getShieldIndices=c;n.getShieldDisplayData=l;n.getYpid=a;n.getTransitJson=v;n.isTransitEntity=y;n.isLandmarkEntity=p})(p||(p={}));l=function(){function n(i,u,f,o,s,h,l,a){this._clientPerf=a;this._customStyleManager=u;this._imageLoader=o;this._styleEntryBucketMap=f;u&&(u.styleEntryBucketMap=f);this._primitiveTemplateCache=new c(100);this._categoryIconCache=new c(100);this._templateName=h;this._state=[];this._stlVersion=l;this._bucketToMappedImageIndex={};this._bucketToPassDefinitionIndex={};this._bucketToDrawOrderListIndex={};this._mappedToUnmappedImageIndex={};this._unmappedToMappedImageIndex={};this._unmappedIndexToBucketIds={};this._images={};this.ready=new y;t.enableFunctionalTestHooks&&r._getUrlParam(window.location,"teststylefailure")==="1"&&(n._retryTimeout=1);var v=e.dynamicProperties,w=v.compositionHandlerGenerationId,p=i.mapTemplateUrlBase.replace("{stlRequestDomain}",v.bingRequestDomain);i.catMapUrlFormat&&(this._catMapUrlFormat=r._updateTfeUrlDomain(i.catMapUrlFormat.replace("{urlbase}",p)).replace("{stlVersion}",this._stlVersion).replace("{subdomain}","0"));this._urlFormat=r._updateTfeUrlDomain(s.replace("{urlbase}",p)).replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",w);it.mergeProperties(n._localCatIdBucketMapping,n._localCatIdBucketMapping_Delta);this._markupOrder=new c(1e3);this._shieldImages={};this._shieldScaleListForZoom={};this._initialized=!1;this._retryCount=0}return n.init=function(){var i={},t={},r={};["50","64","65","226","227","228","229","231","232","234","235","236","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","1899"].forEach(function(n){i[n]=!0;t[n]=!0});["337","338","339","340","341","342","350","351","352","1386","1387","353","1370","1371","344","1441","1442","1443"].forEach(function(n){t[n]=!0});["254","253","252","251","250","249","243","242","241","236","235","232","231","229","228","227","226"].forEach(function(n){r[n]=!0});n._transitBucketIds=i;n._invertedIconBucketIds=t;n._multimodeTransitBucketIds=r},n.prototype.getName=function(){return this._templateName},n.isDarkTheme=function(n){return!!this._darkTemplates[n]},n.extractCategoryId=function(t,i){var u,r;for(t=t||"",u=t.split("."),r=u.length-1;r>=0;r--)if(n.getBucketForCategory(u[r]))return u[r];return i?n.DefaultBucketForLocalCat:null},n.getBucketForCategory=function(t){var i,r=n._categoryBucketMap,u;return r?(u=r[t]||r[n._categoryRemap[t]]||n._categoryFallbackMap[t],i=u&&u.bucketId.toString()):i=n._localCatIdBucketMapping[t],i},n.getPaletteKeyForCategory=function(t){var i="",r=n._bucketPaletteMap,u=n.getBucketForCategory(t);return r&&(i=r[u]||""),i},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t,i){var r=[n._initCategoryMap(),n._initTemplateData()];n._styleEntryBucketMap&&parseFloat(n._stlVersion)>=8.12&&r.push(n._styleEntryBucketMap.ready());Promise.all(r).then(function(){n._initialized=!0;n._ready=new rt(n);t(n)},function(){n._ready=null;i(null)})})),this._ready},n.prototype._initCategoryMap=function(){var i=this,t=n._catMapPromise;return t||(t=this._catMapUrlFormat?new Promise(function(n){o.downloadJson(i._catMapUrlFormat,"catmap",function(t){i._onCatMapResponse(t);n(null)},function(){n(null)},null,!1,null,!1)}):new rt(null),n._catMapPromise=t),t},n.prototype._onCatMapResponse=function(t){var r,o,i;if(!this._isDisposed&&t){var u=t.categoryMap||[],f={},e={};for(r=0,o=u.length;r<o;r++)i=u[r],f[i.categoryId]=i,e[i.bucketId]=i.entry;n._categoryBucketMap=f;n._bucketPaletteMap=e}},n.prototype._initTemplateData=function(){var t=this,n=this._templatePromise;return n||(n=new Promise(function(n,i){t._requestTemplateData(n,i)}),this._templatePromise=n),n},n.prototype._requestTemplateData=function(i,r){var u=this,e,f,s,h;!this._requested&&this._urlFormat&&(this._requested=!0,this._delayLoadTimerId&&(window.clearTimeout(this._delayLoadTimerId),this._delayLoadTimerId=null),t.logDebugData("BaseMapTemplateSelector - _requestTemplateData() "+this._urlFormat),e=this._clientPerf&&this._clientPerf.start(n._latencyLogKey),f=window[this._templateName],f!==undefined&&f===this._templateName?(s="XsrPrefetchCallback",h="XsrPrefetchErrorCallback",window[s]=function(n,t){delete window[t];delete window[h];delete window[s];u._onTemplateResponse(n,e,i)},window[h]=function(n){delete window[n];delete window[h];delete window[s];u._retryCount++;u._onTemplateError(n,i,r)}):f?(delete window[this._templateName],this._onTemplateResponse(f,e,i)):o.downloadJson(this._urlFormat.replace(/{templateName}/ig,this._templateName).replace(/{subdomain}/ig,"0"),"styles",function(n){u._onTemplateResponse(n,e,i)},function(){u._onTemplateError(u._templateName,i,r)},null,!1,null,!1))},n.prototype._onTemplateError=function(i,r,u){var f=this;this._retryCount<n._maxRetries?(this._requested=!1,this._retryCount++,t.logNetworkData(i,"retry "+this._retryCount),this._delayLoadTimerId=Microsoft.Maps.setTimeout(function(){f._requestTemplateData(r,u)},n._retryTimeout*1e3)):t.logNetworkData(i,"max retries");u(null)},n.prototype._onTemplateResponse=function(n,t,i){this._isDisposed||(this._clientPerf&&this._clientPerf.end(t),this._parseTemplate(n,i))},n.prototype._loadTemplates=function(n,t,i){if(!this._initialized)throw new Error("BaseMapTemplateSelector: trying to use this class before it has been initialized");return this._getMarkupRecord(n,t,i)},n.prototype._IsCurveGraph=function(n){return typeof n.position!="undefined"&&typeof n.tangentType!="undefined"?!0:!1},n.prototype._IsDiscreateCollectionGraph=function(n){return typeof n.start!="undefined"&&typeof n.end!="undefined"?!0:!1},n.prototype._IsHslaTransformCurveGraph=function(n){return n.graphType===14?!0:!1},n.prototype._IsTransformCurveGraph=function(n){return n.graphType===15&&typeof n.numericTransformCurve!="undefined"?!0:!1},n.prototype._getFixedStringId=function(n){var t=this._fixedStringMap[n];return typeof t!="number"&&(t=-1),t},n.prototype._getColorformat=function(n){var i=null,t;return n.graphType===1&&(t=n.value,t&&typeof t=="string"&&t.slice(1).length===6&&!isNaN(parseInt(t.slice(1),16))?i=1:t&&typeof t=="string"&&t.indexOf("rgba")>-1?i=0:(t||t===0)&&typeof t=="number"&&(i=3)),i},n.prototype._parseTemplate=function(r,u){var o=this,nt,et,tt,h,ot,st,ht,ct,s,y,it,c,ut,p,lt,w,l,at,vt,e,b,f,yt,v,ft,d,g,pt;if(t.time("ParseTemplate"),nt=this._graphPassDefinitionList=r.graphs,this._landColor=r.landColor,this._drawOrderList=r.drawOrder,this._shieldStyleResponseData={},r&&r.shields)for(e=0,et=r.shields.length;e<et;e++)tt=r.shields[e],this._shieldStyleResponseData[tt.shieldBucketId]=tt.passID[0];for(this._passDefinitionList=r.passDefinitions,this._imageGroups=r.imageGroups,this._groupedImageOptions=r.groupedImageOptions,this._state=r.state||[],this._propertyValues=r.propertyValues,this._svgColor=r.svgColor,this._serverColorValues=r.colorValues,this._serverSingleValues=r.singleValues,this._serverBooleanValues=r.booleanValues,this._serverStringValues=r.stringValues,this._serverEnumValues=r.enumValues,i.fontFamilies=r.fontFamilies,this._markupOrderList=r.markupOrder,this._visibilityRanges=r.visibilityRanges,this._computedSplineGraphs=new Array(nt.length),this._computedSplineGraphPaletteKeys=new Array(nt.length),this._mapImages=[],this._imgVariants=r.imageVariantsList,this._fixedStringList=r.fixedStrings,this._fixedStringMap={},h=0,ot=this._fixedStringList.length;h<ot;h++)this._fixedStringMap[this._fixedStringList[h]]=h;for(this._palette=this._createPalette(r.paletteDefinitions,r.paletteItems),st=this._getFixedStringId("Global.ImageFamily"),ht=this._palette.getStringPaletteValue(st),this._paletteFlavorKeyId=this._getFixedStringId(ht),ct=this._getFixedStringId("Default"),s=0,e=0;e<(this._imgVariants&&this._imgVariants.length);e++){for(it=this._imgVariants[e],f=0;f<it.imageReferences.length;f++)if(c=it.imageReferences[f],c.keyId===this._paletteFlavorKeyId){y=c.imageId;break}else c.keyId===ct&&(y=c.imageId);this._unmappedToMappedImageIndex[y]=s;this._mappedToUnmappedImageIndex[s++]=y}for(this._shapeImageLookup={},ut=r.shapeImageLookup&&r.shapeImageLookup.idPair||[],p=0,lt=ut.length;p<lt;p++)w=ut[p],w&&(l=w.second,this._shapeImageLookup[w.first]=l,this._unmappedToMappedImageIndex[l]||(this._unmappedToMappedImageIndex[l]=s,this._mappedToUnmappedImageIndex[s++]=l));for(at=this._palette.getBackgroundShapeIds(),vt=at.map(function(n){return o._shapeImageLookup[n]}),this._initClassicIcons(),this._setStateIndex(),e=0;e<r.visibilityRanges.length;e++)if(b=r.visibilityRanges[e],b)for(f=0;f<b.length;f++){var k=b[f],s=k.visibleValueId||0,a=r.booleanValues[s];a&&(a.type===1?k.visible=a.fValue||!1:(k.visible=this._palette.getBooleanPaletteValue(a.pValue),k.visiblePaletteKey=a.pValue))}for(this._styleVisibilities=[],this._markupVisibilities=[],f=0,yt=this._drawOrderList.bucket.length;f<yt;f++)v=this._drawOrderList.bucket[f].toString(),ft=this._drawOrderList.passID[f],this._bucketToPassDefinitionIndex[v]=ft,this._bucketToDrawOrderListIndex[v]=f,d=this._getMappedImageIndex(ft),d>=0&&(this._bucketToMappedImageIndex[v]=d),g=this._mappedToUnmappedImageIndex[d],this._unmappedIndexToBucketIds[g]||(this._unmappedIndexToBucketIds[g]=[]),this._unmappedIndexToBucketIds[g].push(v);t.timeEnd("ParseTemplate");pt=[n._haloImageBucket,n.DefaultBucketForLocalCat,n.pricePoiBucketId,n.xsrPolygonBucketId,n.cityPolygonBucket,n.itineraryPoiBucketId,n._multimodeTransitBucket];this.prefetchImages(pt,vt,!0).then(function(){o._initialized=!0;o._ready=new rt(o);u();o.ready&&o.ready.invoke()})},n.prototype._populateSplineGraphValueAndPaletteKey=function(n,t){var e,u,i,f,r;switch(t){case 1:for(u=0;u<n.length;u++)if(i=n[u],f=typeof i.valueId!="undefined"?i.valueId:i.value,typeof f=="number"){if(r=this._serverColorValues[f],!r)continue;r.type===1?i.value=r.fValue||0:(i.value=this._palette.getColorPaletteValue(r.pValue,!1),i.paletteKey=r.pValue,isNaN(i.value)&&(i.value=-1))}break;case 2:for(u=0;u<n.length;u++)if(i=n[u],f=typeof i.valueId!="undefined"?i.valueId:i.value,typeof f=="number"){if(r=this._serverSingleValues[f],!r)continue;r.type===1?i.value=r.fValue||0:(i.value=this._palette.getSinglePaletteValue(r.pValue),i.paletteKey=r.pValue)}break;case 16:for(u=0;u<n.length;u++)if(i=n[u],f=typeof i.valueId!="undefined"?i.valueId:i.value,typeof f=="number"){if(r=this._serverBooleanValues[f],!r)continue;r.type===1?i.value=r.fValue||!1:(i.value=this._palette.getBooleanPaletteValue(r.pValue),i.paletteKey=r.pValue)}break;case 17:for(u=0;u<n.length;u++)if(i=n[u],f=typeof i.valueId!="undefined"?i.valueId:i.value,typeof f=="number"){if(r=this._serverStringValues[f],!r)continue;r.type===1?(e=r.fValue||0,i.value=this._fixedStringList[e]):(i.value=this._palette.getStringPaletteValue(r.pValue),i.paletteKey=r.pValue)}break;case 18:for(u=0;u<n.length;u++)if(i=n[u],f=typeof i.valueId!="undefined"?i.valueId:i.value,typeof f=="number"){if(r=this._serverEnumValues[f],!r)continue;r.type===1?i.value=r.fValue||0:(i.value=this._palette.getSinglePaletteValue(r.pValue,!1,0),i.paletteKey=r.pValue)}}},n.prototype._getComputedSplineGraph=function(n){var u,t,l,r,o,s,e,c,f,y,a,i,p,v,w;if(this._computedSplineGraphs[n]===undefined){if(u=null,t=this._graphPassDefinitionList[n],!t||t.length<1)return this._computedSplineGraphs[n]=u,u;if(l=t[0].graphType,l&&this._populateSplineGraphValueAndPaletteKey(t,l),r=t[0],o=this._getColorformat(r),o!==null){for(s=new ot,i=0;i<t.length;i++)f=t[i],e=new h(f.value,o),s.addKey(f.position,e.red,e.green,e.blue,e.alpha,f.tangentType==="Smooth"?1:f.tangentType==="Step"?2:0),i+1<t.length&&(t[i+1].graphType=1,o=this._getColorformat(t[i+1]));s.computeTangents();u=s}else if(this._IsCurveGraph(r)){for(c=new ft,i=0;i<t.length;i++)f=t[i],y=new kt(f.position,f.value,f.tangentType==="Smooth"?1:f.tangentType==="Step"?2:0),c.addKey(y);c.computeTangents();u=c}else if(this._IsDiscreateCollectionGraph(r)){for(a=new nt,i=0;i<t.length;i++)a.addRange(t[i].start,t[i].end,t[i].value);u=a}else if(this._IsTransformCurveGraph(r))p=r.numericTransformCurve,v=this._getComputedSplineGraph(p),v&&(w=new ct(v),u=w);else if(this._IsHslaTransformCurveGraph(r)){var b=this._getComputedSplineGraph(r.h),k=this._getComputedSplineGraph(r.s),d=this._getComputedSplineGraph(r.l),g=this._getComputedSplineGraph(r.a),tt=new ht(b,k,d,g);u=tt}this._computedSplineGraphPaletteKeys[n]=u&&r.paletteKey?r.paletteKey:null;this._computedSplineGraphs[n]=u}return this._computedSplineGraphs[n]},n.prototype._getImageByBucketId=function(n){if(this._images){if(!this._images[n]){var t=this._bucketToMappedImageIndex[n];this._updateCachedImages(this._mappedToUnmappedImageIndex[t])}return this._images[n]}return null},n.prototype._getImage=function(n){return this._imageLoader.getImage(n,this._templateName,this._svgColor,this._palette)},n.prototype._getOrgImage=function(n){return this._imageLoader.getOrgImage(n,this._templateName,this._palette)},n.prototype._updateCachedImages=function(n){var u=this._getImage(n),f,e,t,o,r,s;if(u&&(f=this._unmappedToMappedImageIndex[n],!this._mapImages[f]&&(this._mapImages[f]=u,e=this._unmappedIndexToBucketIds[n],e)))for(t=0,o=e;t<o.length;t++)r=o[t],s=this._passDefinitionList[this._bucketToPassDefinitionIndex[r]],this._images[r]={scale:s.scale,scaleTransform:s.scaleTransform,template:new i(u),visibility:this._getStyleVisibility(this._bucketToDrawOrderListIndex[r])}},n.prototype._initClassicIcons=function(){var r=this._imageLoader.createClassicIcon(this._palette),n=this._palette,i=n.addFixedString("Classic"),t;this._shapeImageLookup[i]=r;t={type:0,hasValue:!0,stringId:i};n.addPaletteItem("DefaultPointStateClassic.Shape-Background",t);n.addPaletteItem("HoverPointStateClassic.Shape-Background",t);n.addPaletteItem("HoverPointStateClassic.HighlightScale",{type:2,hasValue:!0,value:1.3});n.addPaletteItem("HoverPointStateClassic.HighlightStrokeWidthScale",{type:2,hasValue:!0,value:2});n.addPaletteItem("SelectedPointStateClassic.Shape-Background",t);n.addPaletteItem("SelectedPointStateClassic.HighlightScale",{type:2,hasValue:!0,value:1.8});n.addPaletteItem("SelectedPointStateClassic.HighlightStrokeWidthScale",{type:2,hasValue:!0,value:2});n.addPaletteItem("InactivePointStateClassic.Shape-Background",t);n.addPaletteItem("InactivePointStateClassic.HighlightScale",{type:2,hasValue:!0,value:0});n.addPaletteItem("InactiveSelectedPointStateClassic.Shape-Background",t);n.addPaletteItem("InactiveSelectedPointStateClassic.HighlightScale",{type:2,hasValue:!0,value:1.5})},n.prototype._createPalette=function(n,t){var l,g=n.nodes,rt=n.types,f,a,v,w,nt,tt,k,d,ut,o,y,s,b,it,p,e,h,i,r,c,u;for(st&&st.initialize(g,this._fixedStringList),f={},a={},i=0;i<rt.length;i++)if(v=rt[i],v){for(w=v.parentId,b=this._fixedStringList[v.nameId],f[i]={name:b,properties:[]},w>=0&&(nt=f[w],nt?f[i].parent=nt:a[i]=w),tt=v.properties,k=0;k<tt.length;k++)(d=tt[k],d)&&(ut=this._fixedStringList[d.nameId],f[i].properties.push({propertyName:ut,valueType:d.valueType}));for(u in a)i===a[u]&&(e=f[u],e&&(e.parent=f[i],delete a[u]))}for(o={},y={},i=0;i<g.length;i++)if((s=g[i],s)&&(b=this._fixedStringList[s.nameId],it=f[s.nodeTypeId],it||!(s.parentId>=0))){o[i]={name:b,nodeType:it};s.parentId>=0&&(p=o[s.parentId],p?(p.children||(p.children=[]),p.children.push(o[i])):y[i]=s.parentId);for(u in y)i===y[u]&&(e=o[u],e&&(e.children||(e.children=[]),e.children.push(o[i]),delete y[u]))}for(h={},i=0;i<t.length;i++)if(r=t[i],c=this._fixedStringList[r.keyId],r&&c)switch(r.type){case"StringPaletteItem":h[c]={keyId:r.keyId,type:0,stringId:r.stringPaletteItem};break;case"ColorPaletteItem":h[c]={keyId:r.keyId,type:1,value:r.colorPaletteItem.value,ignoreTransform:r.colorPaletteItem.ignoreTransform,additionalAttributes:r.colorPaletteItem.additionalAttributes};break;case"SinglePaletteItem":h[c]={keyId:r.keyId,type:2,value:r.singlePaletteItem.value,ignoreTransform:r.singlePaletteItem.ignoreTransform};break;case"EnumPaletteItem":h[c]={keyId:r.keyId,type:4,value:r.enumPaletteItem.value};break;case"BooleanPaletteItem":h[c]={keyId:r.keyId,type:3,value:r.booleanPaletteItem}}l=new ei(this._customStyleManager,this._fixedStringList,this._fixedStringMap);for(u in o)l.populate(o[u],h);return l.addPaletteItem("Inverted.FillColor",{type:1,hasValue:!0,value:-1,ignoreTransform:!1,additionalAttributes:{propertyReferenceId:this._getFixedStringId("IconColor")}}),l.addPaletteItem("Inverted.IconColor",{type:1,hasValue:!0,value:-1,ignoreTransform:!1,additionalAttributes:{propertyReferenceId:this._getFixedStringId("FillColor")}}),l},n.prototype._getShieldUnmappedImageIndexes=function(n){var o=[],f=this._shieldStyleResponseData[parseInt(n)],s,h,r,t,e,u,i;if(f)for(s=f.length,h=this._getFixedStringId("Default"),r=0;r<s;r++){for(t=this._computeSplineGraphObject(this._passDefinitionList[f[r]].image,1),e=this._imgVariants[t].imageReferences,u=0;u<e.length;u++)if(i=e[u],i.keyId===this._paletteFlavorKeyId){t=i.imageId;break}else i.keyId===h&&(t=i.imageId);o.push(t)}return o},n.prototype._getShieldImages=function(n,t){var r=this._shieldImages[n],o,s,u,f,e;for(r||(r=[]),o=this._getShieldUnmappedImageIndexes(n),u=0;u<o.length;u++){for(f=-1,e=0;e<t.length;e++)if(t[e]===u){f=u;break}(s=this._mapImages[this._unmappedToMappedImageIndex[o[u]]],s)&&(f===-1||r[f]||(r[f]=new i(s)))}return this._shieldImages[n]=r,r},n.prototype._getShieldScales=function(n,t){var i,u=this._shieldScaleListForZoom[n]||{},s,f,e,r,o,h;if(u&&(i=u[t],!i)){if(s=this._getStyleScale(n),f=this._shieldStyleResponseData[parseInt(t)],f)for(e=f.length,i=new Array(e),r=0;r<e;r++)o=this._passDefinitionList[f[r]],h=this._getScale(o.shieldScale,o.shieldScalingTransform,s),i[r]=h;u[t]=i;this._shieldScaleListForZoom[n]=u}return i},n.prototype._getMarkupRecord=function(i,r,u){var y,e,f,c,o,p,l,w;if(t.time("ParseMarkupOrder"),y=i+","+r+","+u,e=this._markupOrder[y]||this._getStaticMarkupRecord(i,r,u),e)return e;f=this._markupOrderList;f.validKeys={};f.keys=f.bucket;c=[];f.templates=new Array(f.passID.length);var b=this._getStyleScale(i),k=dt.Browser.is_webkit?n._webkitFontFillLightnessFactor:0,h=[],d=parseInt(r);for(o=0,p=f.bucket.length;o<p;o++)if(f.bucket[o]===d)this._getGeometryType(this._markupOrderList.geometry[o])===u&&h.push(o);else if(h.length>0)break;if(h.length===0)return null;for(l=0,w=h.length;l<w;l++){var a=h[l],s={},v=f.passID[a];c[v]||(c[v]=this._getMarkupOrderTemplate(v,b,k));s.style=c[v];e?e.style.styleDynamic.secondaryFontSize=s.style.styleDynamic.fontSize:(s.visibility=this._getMarkupVisibility(a),s.priority=f.priority[a],s.globalOrder=a+1,e=s)}return this._markupOrder.addItem(y,e),t.time("PopulateMarkupOrder"),t.timeEnd("ParseMarkupOrder"),e},n.prototype._getStaticMarkupRecord=function(t,i,u){var s,v=i+","+u,h=n._poiStyles[this._templateName][v],a,f;if(h){var w=t+","+v,b=[{visible:!0,visiblePaletteKey:this._fixedStringMap["UserPoint.LabelVisible"],zoom:0}],y={drawingStyleVisibilities:{}},c=y.drawingStyleVisibilities;if(c[3]=c[2]=c[1]=b,s={style:{styleStatic:r._copyObject(h.styleStatic),styleDynamic:h.styleDynamic},priority:h.styleDynamic.priority,globalOrder:h.styleDynamic.globalOrder},this._markupOrder.addItem(w,s),u===1){var k=n.DefaultBucketForLocalCat,d=this._getMarkupRecord(t,k,u),l=d.style,o=r._copyObject(l.styleStatic),e=l.styleDynamic,p=l.styleDynamic.fontColor;o.wrapDisplayName=!0;o.backgroundColor=n.isDarkTheme(this._templateName)?"rgba(64,64,64,0.7)":"rgba(236,234,227,0.7)";switch(i){case n.bucketIdForPoi:t<16?(o.offsetX=13,o.offsetY=13):t>=16&&t<=19?(o.offsetX=15,o.offsetY=15):(o.offsetX=17,o.offsetY=17);break;case n.bucketIdForSelectedPoi:o.offsetX=24;o.offsetY=24;p=this._getColor("SelectedPointState"+n._labelColor,!0)}a=s.style;f=a.styleDynamic;a.styleStatic=o;f.font=e.font;f.fontPaletteKey=e.fontPaletteKey;f.fontColor=p;f.fontColorPaletteKey=e.fontColorPaletteKey;f.fontSize=e.fontSize;f.secondaryFontSize=e.secondaryFontSize;f.fontWeight=e.fontWeight;f.fontWeightPaletteKey=e.fontWeightPaletteKey;f.fontStyle=e.fontStyle;f.fontStylePaletteKey=e.fontStylePaletteKey;f.fontCaps=e.fontCaps;f.fontCapsPaletteKey=e.fontCapsPaletteKey;f.outlineColor=e.outlineColor;f.outlineColorPaletteKey=e.outlineColorPaletteKey;s.visibility=y}}return s},n.prototype._getMarkupOrderTemplate=function(t,i,r){var u=this._passDefinitionList[t],l={styleStatic:{},styleDynamic:{font:"",fontSize:0,fontColor:"",outlineColor:""},markupPassDefinitionIndex:t},f=l.styleStatic,e=l.styleDynamic,a,b,o,s,h,v,y,c,p;e.font=this._computeSplineGraphObject(u.fontName,i)||"SegoeBing";e.fontPaletteKey=this._getSplineGraphPaletteKey(u.fontName);a=this._computeSplineGraphObject(u.fontColorTransform,i);e.fontColor=a?this._computeHslaTransform(u.fontColor,i,a,r):this._computeSplineGraphObject(u.fontColor,i);e.fontColorPaletteKey=this._getSplineGraphPaletteKey(u.fontColor);e.fontWeight=this._computeSplineGraphObject(u.fontWeight,i)||0;e.fontWeightPaletteKey=this._getSplineGraphPaletteKey(u.fontWeight);e.fontStyle=this._computeSplineGraphObject(u.fontStyle,i)||0;e.fontStylePaletteKey=this._getSplineGraphPaletteKey(u.fontStyle);e.fontCaps=this._computeSplineGraphObject(u.fontCapitals,i)||0;e.fontCapsPaletteKey=this._getSplineGraphPaletteKey(u.fontCapitals);f.preferredFontSize=this._computeSplineGraphObject(u.preferedFontSize,i);f.preferredFontSizePaletteKey=this._getSplineGraphPaletteKey(u.preferedFontSize);f.fontSizeTransform=this._computeSplineGraphObject(u.preferedFontSizeTransform,i)||1;e.fontSize=f.preferredFontSize*f.fontSizeTransform;f.pointLabelPlacementPreference=this._computeSplineGraphObject(u.pointPlacement,i);f.polygonFillPreference=this._computeSplineGraphObject(u.areaFillingPreference,i);f.verticalAlignment=this._computeSplineGraphObject(u.lineVerticalAlign,i);f.fontGlow=this._computeSplineGraphObject(u.fontGlow,i);f.fontOutlined=this._computeSplineGraphObject(u.fontOutlined,i);f.fontUnderlined=this._computeSplineGraphObject(u.fontUnderlined,i);f.glowColor=this._computeSplineGraphObject(u.glowColor,i);f.glowSize=this._computeSplineGraphObject(u.glowSize,i);b=this._computeSplineGraphObject(u.heightMatch,i);switch(b){case"LabelHeightMatchXHeight":o=2;break;case"LabelHeightMatchAscent":o=1;break;default:o=0}return o!==0&&(s=0,h=this._computeSplineGraphObject(u.heightMatchPixels,i),h&&(v=this._computeSplineGraphObject(u.heightMatchPixelsTransform,i),v&&(h*=v),o===1?s=h*n._capHeightRatio:o===2&&(s=h*n._xHeightRatio),s<e.fontSize&&(e.fontSize=s))),y=this._computeSplineGraphObject(u.outlineColorTransform,i),e.outlineColor=y?this._computeHslaTransform(u.outlineColor,i,y):this._computeSplineGraphObject(u.outlineColor,i),e.outlineColorPaletteKey=this._getSplineGraphPaletteKey(u.outlineColor),f.outlineWidth=this._computeSplineGraphObject(u.outlineWidth,i),f.outlineWidth<2&&(f.outlineWidth+=n._outlineWidthDelta),w.ignoreStrata||(c={},c.alpha=this._computeSplineGraphObject(u.overrideAlpha,i),c.fontSize=this._computeSplineGraphObject(u.strataFontSize,i),f.strataStyle=c),p=this._computeSplineGraphObject(u.shieldLabelVisibility,i),f.shieldLabelVisibility=p==="Both"?2:p==="NoText"?1:0,l},n.prototype._applyStackedBackgroundShape=function(t,r,u,f){for(var l,o,tt,b,a,v,d,y=this,h=f&&f.getVectorImage(),c=h&&h.records||[],g,p,s="",rt=function(n){var t=y._getFixedStringId(n),i=y._shapeImageLookup[t];return y._getImage(i)},nt=function(n,t){for(var i,u,f=n&&Object.keys(n)||[],r=0,e=f.length;r<e;r++)i=f[r],i.endsWith("PaletteKey")&&(u=(n[i]||"").split("."),u.length===2&&(n[i]=t+"."+u[1]))},e=0,w=c.length;e<w;e++)if(l=c[e].shapePaletteKey,l)if(s)if(l===s)p=e;else break;else l.endsWith(n.backgroundShapeRecord)&&(g=p=e,s=l);else if(s)break;if(t===2||t===3)tt=t===2?n.pricePoiBucketId:n.itineraryPoiBucketId,o=this._mapImages[this._bucketToMappedImageIndex[tt]];else{if(b=this._getStackedStringValue(u,s),!b)return f;o=rt(b)}if(o){a=JSON.parse(JSON.stringify(o.records));v=void 0;r?v=c.filter(function(n){return n.vectorType===3}):(a=a.filter(function(n){return n.vectorType!==3}),v=c.slice(p+1));var it=o.overrideHotspot||t===2,k=[].concat(c.slice(0,g),a,v),ut={hotspotX:it?o.hotspotX:h.hotspotX,hotspotY:it?o.hotspotY:h.hotspotY,hitTest:h.hitTest,records:k};for(f=new i(ut),d=s.split(".")[0],e=0,w=a.length;e<w;e++)nt(k[e],d),nt(k[e].style,d)}return f},n.prototype._applyStackedColor=function(n,t,i,r){var u=this._getStackedColorValue(n,r);u&&(t[i]=u)},n.prototype._getStackedColorValue=function(n,t){var u,i,r;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedColorPaletteValue(n.concat(i[0]),i[1]),u=isNaN(r)?"":isFinite(r)?a.convertPackedTorgba(r):h.black),u},n.prototype._applyStackedScale=function(n,t,i,r){var f=this._getStackedNumericValueItem(n,r),u=f&&f.value;typeof u=="number"&&isFinite(u)&&(t[i]*=u)},n.prototype._getStackedNumericValueItem=function(n,t){var r=null,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedSinglePaletteItem(n.concat(i[0]),i[1])),r},n.prototype._applyStackedEnum=function(n,t,i,r){var u=this._getStackedEnumValue(n,r);u&&(t[i]=u)},n.prototype._getStackedEnumValue=function(n,t){var r,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedEnumPaletteValue(n.concat(i[0]),i[1])),r},n.prototype._applyStackedString=function(n,t,i,r){var f=t[r],u=this._getStackedStringValue(n,f);u&&(t[i]=u)},n.prototype._getStackedStringValue=function(n,t){var r,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedStringPaletteValue(n.concat(i[0]),i[1])),r},n.prototype._getStackedBooleanValue=function(n,t){var r,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedBooleanPaletteValue(n.concat(i[0]),i[1])),r},n.prototype._getColor=function(n,t){var r=this._getFixedStringId(n),i=this._palette.getColorPaletteValue(r,t);return isNaN(i)?"":i||i===0?a.convertPackedTorgba(i):h.black},n.prototype._getScale=function(n,t,i,r,u){var f,e;return u===void 0&&(u=!1),f=r!==undefined?r:this._computeSplineGraphObject(n,i),u||(e=this._computeSplineGraphObject(t,i),e>0&&(f=f*e)),f},n.prototype._setStateIndex=function(){var t="en-us",n,i;for(this._currentStateIndex=0,n=0;n<this._state.length;n++)if(i=this._state[n].idPair[0],i){var f=this._propertyValues[i.second],u=this._fixedStringList[f.propVal].toLowerCase(),r=e.dynamicProperties.market.toLowerCase();if(r===t&&u===t||r.substr(0,2)!==t.substr(0,2)&&u.substr(0,2)===r.substr(0,2)){this._currentStateIndex=n;break}}},n.prototype._getMappedImageIndex=function(n){var f=this._passDefinitionList[n],t=-1,r,u,i;if(typeof f.imageGroup!="undefined"){if(t=Math.round(this._computeSplineGraphObject(f.imageGroup,1)),r=this._imageGroups[t].images,!r)return t;for(u=0;u<r.length;u++)if(i=this._groupedImageOptions[r[u]],i.stateId==this._currentStateIndex){t=i.mapImage;break}else i.stateId==0&&(t=i.mapImage)}return t},n.prototype.getRoutePoiVectorImageTemplate=function(t,i,r){var f=n.directionIconTypeBuckets[t],e=7,o=n._getPointStateName(i,n._poiTypeStateGroups[e]),s="d"+f+o+r.toString(),u=this._primitiveTemplateCache.getItem(s);return u?u:(u=this._getTemplates_PoiRefresh(e,!1,f,null,1,r,[o],!0,!0,null),u&&u.length?this._primitiveTemplateCache.addItem(s,u):u=t==="turn"?[g.directionsTurnTemplate]:[g.poiTemplates[i]],u)},n.prototype._addShadow_PoiRefresh=function(n,t,i){var u;if(n&&n.length&&t&&(u=this._computeSplineGraphObject(t.shadow,i),u)){var e=this._computeSplineGraphObject(t.glowColor,i),o=this._computeSplineGraphObject(t.glowSize,i),f=n[0],r=f&&f.shadowStyle;r&&(r.shadowColor=e,r.shadowBlur=o,r.shadowOffset={x:0,y:2})}},n._getPointStateName=function(t,i){var r=n._poiStateNames[t]||"";return i&&r.endsWith("PointState")&&(r=r+(i||"")),r},n.prototype.getCategoryIconTemplate=function(t,i,r,u,f){var e=n.getBucketForCategory(i)||n.DefaultBucketForLocalCat;this.getIconTemplate(t,e,!1,r,u,f)},n.prototype.getIconTemplate=function(t,u,f,e,o,s){var c=this,l=""+u+f+e+o+s,a=this._categoryIconCache.getItem(l);if(t){if(a){Microsoft.Maps.setAsync(function(){t(a)});return}this.prefetchImages([u]).then(function(){var it=n._transitBucketIds[u],rt=5,ot=n._getPointStateName(2,n._poiTypeStateGroups[rt]),ut=c._getTemplates_PoiRefresh(rt,!1,u,null,1,12,[ot],!0,!0,null),ft=ut&&ut[0],w=null,b="",k="",g=null,v,nt,y,et,p;if(ft){for(v=ft.getVectorImage(),nt={hotspotX:v.hotspotX,hotspotY:v.hotspotY,records:[]},y=0,et=v.records.length;y<et;y++){var d=v.records[y],tt=nt.records[y]=r._copyObject(d),a=tt.style=r._copyObject(d.style);f||(d.shapePaletteKey&&d.shapePaletteKey.endsWith(n.backgroundShapeRecord)?(!k&&tt.fillStylePaletteKey&&tt.fillStylePaletteKey.endsWith(n._fillColor)&&(k=a.fillStyle),a.fillStyle=a.strokeStyle=h.transparent):(b=b||a.fillStyle,a.fillStyle=e||(it?k:b),a.strokeStyle=h.transparent))}w=new i(nt);o&&(s=s||o,p=w.getBounds().getSize(),p.width&&p.height&&w.setScale(Math.min(o/p.width,s/p.height)));g={icon:w,iconColor:it?k:b};c._categoryIconCache.addItem(l,g)}Microsoft.Maps.setAsync(function(){t(g)})})}},n.prototype._getLandmarkVectorImageTemplate_PoiRefresh=function(t,i,u,f){var o=t.bucket,h=t.entity&&t.entity.oid||"",c=n._getPointStateName(i,n._poiTypeStateGroups[f]),l,e,a,s,v;if(n._multimodeTransitBucketIds[o]&&f===4&&(o=n._multimodeTransitBucket),a=this._bucketToDrawOrderListIndex[o],s=a&&this._getStyleVisibility(a),s&&this._isTemplateVisible(u,s,t.geometryType)){if(v=this._getScaleFromZoom(u,o,h,[c]),l=""+f+o+h+c+v,e=this._primitiveTemplateCache.getItem(l),e)return e;e=this._getTemplates_PoiRefresh(f,!1,o,h,t.geometryType,u,[c],!1,!0,v);r._renderAllPoiAndLabelsGL()&&s&&(t.visibilities=s.drawingStyleVisibilities[t.geometryType]);e&&this._primitiveTemplateCache.addItem(l,e)}return e},n.prototype._getBucketPaletteKey=function(t,i){var r="",e,o,s,h,u,l,f,c;if(!t||t===i)return r;if(e=n._bucketPaletteMap,e)r=e[t]||"";else{if(o=this._getImageByBucketId(t),s=o&&o.template,s)for(h=s.getVectorImage(),u=0,l=h.records.length;u<l;u++)if(f=h.records[u],!f.shapePaletteKey||!f.shapePaletteKey.endsWith(n.backgroundShapeRecord)){r=f.fillStylePaletteKey;break}r&&(c=r.split("."),c.length>1&&(r=c[0]))}return r},n.prototype._getPoiVectorImageTemplate_PoiRefresh=function(n,t,i,r,u,f){var e,o,s=f,h,c,l;if(s||(h=this._bucketToDrawOrderListIndex[n],c=h&&this._getStyleVisibility(h),s=c&&this._isTemplateVisible(r,c,1)),s){if(l=this._getScaleFromZoom(r,n,null,t),o=n+","+t.join(".")+","+l+","+u,e=this._primitiveTemplateCache.getItem(o),e)return e;e=this._getTemplates_PoiRefresh(i,u,n,null,1,r,t,f,!0,l);e&&this._primitiveTemplateCache.addItem(o,e)}return e},n.prototype._getTemplates_PoiRefresh=function(n,r,u,f,e,o,s,h,c,l){var p=null,ut,ft,v,a,w,nt,b,et,y,k,tt,ot,it;if(!this._initialized)return t.log(null,"TemplateSelector needs to be initialized before getTemplates() call"),null;var d=this._passDefinitionList[this._bucketToPassDefinitionIndex[u]],g=this._getStyleScale(o),rt=f&&this._getOrgImage(f);if(f&&rt)ut=this._getStyleVisibility(this._bucketToDrawOrderListIndex[u]),(h||this._isTemplateVisible(o,ut,e))&&(ft=l===null?this._getScale(d.scale,d.scaleTransform,g):l,p=[new i(rt,ft)]);else if(v=this._getImageByBucketId(u),a=v?v.template:null,a&&c&&(w=JSON.parse(JSON.stringify(a.getVectorImage())),a=new i(w)),a&&(h||this._isTemplateVisible(o,v.visibility,e))){for(n===2?a=this._applyStackedBackgroundShape(2,r,s,a):r&&!a.hasPlaceholderText&&(a=this._applyStackedBackgroundShape(3,r,s,a)),a=this._applyStackedBackgroundShape(null,r,s,a),w=a.getVectorImage(),nt=w.records,b=0,et=nt.length;b<et;b++)y=nt[b],k=y.style,this._applyStackedColor(s,k,"fillStyle",y.fillStylePaletteKey),this._applyStackedColor(s,k,"strokeStyle",y.strokeStylePaletteKey),this._applyStackedScale(s,k,"lineWidthScale",y.strokeScalePaletteKey),this._applyStackedScale(s,y,"scale",y.scalePaletteKey);l===null?(ot=this._getSplineGraphPaletteKey(v.scale),it=this._getStackedNumericValueItem(s,ot)||{},tt=this._getScale(v.scale,v.scaleTransform,g,it.value,it.ignoreTransform)):tt=l;a.setScale(tt);p=[a]}return this._addShadow_PoiRefresh(p,d,g),p},n.prototype.getMarkupStyle=function(i,r,u,f){var v,h,l,y;if(i){var a=i.stylesheetEntry,p=i.stylesheetEntryState,w=i.bucket||this._customStyleManager.getElementBucket(a,i.geometryType);if(w){var o=w.toString(),s=i.geometryType,c=Math.round(k.fromScale(null,r,!0)),e;if(e=this._markupOrder.getItem(c+","+o+","+s),e||(e=this._loadTemplates(c,o,s)),!e){if(v=o,o=this._getOriginalBucketId(o),t.assert(o!=null,"failed to map bucketId "+v),!o)return;e=this._getMarkupRecord(c,o,s);e&&this._markupOrder.addItem(c+","+v+","+s,e)}if(e)return(h=[],l=n._getPointStateName(u,n._poiTypeStateGroups[f]),l&&(s===3&&(l=l.replace("Point","Area")),h.push(l)),a&&a.indexOf(".")>=0&&h.push(a),p&&h.push.apply(h,p.split(";")),y=this._computeStyleDynamic(e,s,c,h),y)?{styleStatic:e.style.styleStatic,styleDynamic:y}:void 0}}},n.prototype.getLandmarkVectorImageTemplate=function(t,i,r,u){u===void 0&&(u=5);var f=t.bucket,e=!!p.getTransitJson(t.entity),o=e&&t.layer&&t.layer.getHighlighted(),s=k.fromScale(null,r,!0);return o?u=4:u===5&&n._transitBucketIds[f]&&(u=6),this._getLandmarkVectorImageTemplate_PoiRefresh(t,i,s,u)},n.prototype.getPoiTemplate=function(t,i,r,u,f,e,o,s){var c,h,l,a;return u===void 0&&(u=1),f===void 0&&(f=!0),e===void 0&&(e=!0),c=n._getPointStateName(i,n._poiTypeStateGroups[u]),h=c?[c]:[],o&&o.indexOf(".")>=0&&h.push(o),s&&h.push.apply(h,s.split(";")),u===3?h.push("ItineraryPoint"):(u===1||u===4)&&n._invertedIconBucketIds[t]&&h.push("Inverted"),t||(o?(l=this._customStyleManager.getElementBucket(o,1),t=l&&l.toString()):t=n.DefaultBucketForLocalCat),a=this._getPoiVectorImageTemplate_PoiRefresh(t,h,u,r,f,e),a&&a.slice()},n.prototype.getPoiVectorImageTemplate=function(t,i,r,u,f,e,o){var c;u===void 0&&(u=1);f===void 0&&(f=!0);var l=typeof o=="number"?n._taskList[o]:undefined,s=n.getBucketForCategory(t),a=n.getBucketForCategory(e),h;return s||(s=n.DefaultBucketForLocalCat),l?h=l:(c=this._getBucketPaletteKey(a,s),c&&(h=c)),this.getPoiTemplate(s,i,r,u,f,!0,null,h)},n._setLineDashes=function(n,t,i){var r,f,o,h;if(n&&typeof n=="number"&&isFinite(n)&&typeof t=="number"&&t>0&&t<=32){r=[];n=Math.floor(n);f=void 0;n<0&&(n=n>>>0);f=n.toString(2).slice(-t);var e=0,u=0,s="";for(o=f.length-1;o>=0;o--)h=f[o],h!==s&&(u&&(r.length||s!=="0"?r.push(u):e=u),s=h,u=0),u++;f.length<t&&(r.push(u),u=t-f.length);e?(r.push(u,e),i.dashes=r,i.dashOffset=e):r.length&&(r.push(u),i.dashes=r)}},n.prototype._applyPolygonDrawingPass=function(t,i,r){var u,f,e,o,h,s,c,l;return t?(t.brushColor?(f=t.brushColor,u={},e=this._getStackedColorValue(i,this._fixedStringList[this._getComputedSplineGraphPaletteKey(f)]),e?u.fillStyle=e:(o=this._computeSplineGraphObject(t.brushColorTransform,r),u.fillStyle=o?this._computeHslaTransform(f,r,o):this._computeSplineGraphObject(f,r))):t.penColor&&(f=t.penColor,u={},u.strokeStyle&&(u.secondaryLineWidth=u.lineWidth,u.secondaryStrokeStyle=u.strokeStyle),e=this._getStackedColorValue(i,this._fixedStringList[this._getComputedSplineGraphPaletteKey(t.penColor)]),e?u.strokeStyle=e:(o=this._computeSplineGraphObject(t.penColorTransform,r),u.strokeStyle=o?this._computeHslaTransform(f,r,o):this._computeSplineGraphObject(f,r)),t.penWidth&&(h=this._getSplineGraphPaletteKey(t.penWidth),s=this._getStackedNumericValueItem(i,h)||{},u.lineWidth=this._getScale(t.penWidth,t.penWidthTransform,r,s.value,s.ignoreTransform)),t.bitPattern&&(c=this._computeSplineGraphObject(t.bitPattern,r),l=this._computeSplineGraphObject(t.patternRepeat,r),n._setLineDashes(c,l,u))),u):u},n.prototype.getFirstDrawOrder=function(n){var t=parseInt(n);return this._drawOrderList.bucket.indexOf(t)},n.prototype.getPolygonTemplates=function(t,i,u,f,e,o,s,h){var nt=i?parseInt(i):this._customStyleManager.getElementBucket(s,t),tt=k.fromScale(null,e,!0),rt="apt_"+t+"_"+nt+"_"+u+"_"+tt+"_"+o+"_"+s+"_"+h,v=this._primitiveTemplateCache.getItem(rt),a,d,g,c,b,ft,et,l,y;if(v)return v;switch(u){default:case 2:a="DefaultAreaState";break;case 3:a="HoverAreaState";break;case 4:a="SelectedAreaState"}d=n._poiTypeStateGroups[f];d&&(a=a+d);var p=a?[a]:[],ot=this._getStyleScale(tt),ut=this._drawOrderList,st=this._passDefinitionList,w=r._allIndexesOf(ut.bucket,nt);if(s&&s.indexOf(".")>=0&&p.push(s),h&&p.push.apply(p,h.split(";")),w&&w.length){for(g=[],c=void 0,b=0,ft=w.length;b<ft;b++)et=st[ut.passID[w[b]]],l=this._applyPolygonDrawingPass(et,p,ot),l&&(l.hitTest=o,y=!1,c&&(l.fillStyle?c.fillStyle||(y=!0):l.strokeStyle&&(l.dashes||c.dashes||(c.strokeStyle?!c.secondaryStrokeStyle&&c.lineWidth>l.lineWidth&&(c.secondaryLineWidth=c.lineWidth,c.secondaryStrokeStyle=c.strokeStyle,y=!0):y=!0))),y?it.mergeProperties(c,l):(c=l,g.push(l)));v=g.map(function(n){return new wt(n)});this._primitiveTemplateCache.addItem(rt,v)}return v},n.prototype.getCityPolygonTemplates=function(t,i,r,u,f){var e=null;return(t===n.cityPolygonBucket||t===n.xsrPolygonBucketId)&&(e=this.getPolygonTemplates(3,n.xsrPolygonBucketId,r,1,u,f)),e},n.getPushpinTextTemplates=function(t,r,u,f){var h=[],e={style:{fillStyle:"rgb(255,255,255)",font:"Arial, Helvetica, Sans-Serif",fontStyle:1,fontSize:11.25,horizontalAutoScaling:1},text:"{MapDisplay}",anchor:{x:0,y:0},vectorType:3,scale:1},o,l,s,a;if(r){var v=r.height,c=r.width,y={pointsList:[{x:0,y:0},{x:c,y:0},{x:c,y:v},{x:0,y:v}],vectorType:0,style:{fillStyle:"rgba(255,255,255,0)"},scale:1};e.maxWidth=c;e.style.fontSize=10;e.anchor.x=u.x;e.anchor.y=u.y;o={records:[y,e],hitTest:1};h=[new i(o,1,f)]}else l=t.getVectorImage().records,s=l[l.length-1],s&&s.vectorType===2&&(a=n._cloneObject(s),e.maxWidth=a.radiusX*2/1.414,o={records:[a,e],hitTest:1},h=[new i(o,t.getScale())]);return h},n.prototype.getTemplates=function(r,u,f){var l,s,c,y,o,a,p,w;if(f===void 0&&(f=!1),l=null,!this._initialized)return t.log(null,"TemplateSelector needs to be initialized before getTemplates() call",this._initialized),null;var b=r.bucket,v=k.fromScale(null,u,!0),h=this._getImageByBucketId(b),e=h?h.template:null;if(e&&f&&(s=JSON.parse(JSON.stringify(e.getVectorImage())),e=new i(s)),e&&this._isTemplateVisible(v,h.visibility,r.geometryType)){for(s=e.getVectorImage(),c=0,y=s.records.length;c<y;c++)o=s.records[c].fillStylePaletteKey,a=this._getColor(o,!1),a&&o&&(o.indexOf(n._backgroundColor)>-1||o.indexOf(n._borderColor)>-1||o.indexOf(n._colorString)||o.indexOf(n._fillColor))&&(s.records[c].style.fillStyle=a);p=this._getStyleScale(v);w=this._getScale(h.scale,h.scaleTransform,p);e.setScale(w);l=[e]}return l},n.prototype._getVisibilitiesByIndex=function(n,t,i,r){var e={drawingStyleVisibilities:{}},k,w,s,h,f,o,u,g,b,p,l;e.geometryType=this._getGeometryType(i[n]);k=t[n];for(w in k){s=[];e.densityLodCollection=new nt;switch(w){case"point":h=1;break;case"line":h=2;break;case"polygon":h=3}if(h===e.geometryType){var a=v.markupVisible,y=1,c=0,tt=t[n][w],d=r[tt];for(f=0;f<d.length;f++)u={visible:!1},o=d[f],u.densityDistance=o.densityDistance,u.densityImportance=o.densityImportance,u.visible=o.visible,u.zoom=Math.round(v.calculateZoomforStyleScale(o.startZoomLevel)),u.visiblePaletteKey=o.visiblePaletteKey,s.push(u);for(f=s.length-1;f>=0;f--){if(u=s[f],c=this._getStyleScale(u.zoom),g=u.densityDistance===0&&u.densityImportance===0,g)e.densityLodCollection.addRange(c,y,a);else{for(b=(y-c)/v.zoomDeltaBetweenLods,p=a+b,l=c;l<y;l+=v.zoomDeltaBetweenLods)e.densityLodCollection.addRange(l,l+v.zoomDeltaBetweenLods,p),p=p-1;a+=b}y=c;u.densityLodDelta=a}}e.drawingStyleVisibilities[h]=s}return e},n.prototype._getMarkupVisibility=function(n){return this._markupVisibilities[n]||(this._markupVisibilities[n]=this._getVisibilitiesByIndex(n,this._markupOrderList.visibilityIndex,this._markupOrderList.geometry,this._visibilityRanges)),this._markupVisibilities[n]},n.prototype._getStyleVisibility=function(n){return this._styleVisibilities[n]||(this._styleVisibilities[n]=this._getVisibilitiesByIndex(n,this._drawOrderList.visibilityIndex,this._drawOrderList.geometry,this._visibilityRanges)),this._styleVisibilities[n]},n.prototype._getComputedSplineGraphPaletteKey=function(n){return this._computedSplineGraphPaletteKeys[n]===undefined&&this._getComputedSplineGraph(n),this._computedSplineGraphPaletteKeys[n]},n.prototype._getGeometryType=function(n){var t;switch(n){case 0:t=1;break;case 2:t=2;break;case 3:t=3}return t},n.prototype._computeHslaTransform=function(t,i,r,u){var o,e,s,f,h;return this._computedSplineGraphs&&(e=this._getComputedSplineGraph(t),e&&(s=e.evaluateHsla(i),f=a.applyHslaTransform(s,r),u&&f.z<.7&&(f.z*=u),h=a.hslaTorgba(f.x,f.y,f.z,f.w*n._alphaTransformCoefficient),o=h.toRgba())),o},n.prototype._computeSplineGraphObject=function(n,t){var r=null,i;if(this._computedSplineGraphs)return i=this._getComputedSplineGraph(n),i instanceof ft?r=i.evaluate(t):i instanceof ot?r=i.evaluate(t).toRgba():i instanceof nt?r=i.evaluate(t):i instanceof ct?r=i.evaluate(t):i instanceof ht&&(r=i.evaluate(t)),r},n.prototype._getSplineGraphPaletteKey=function(n){var t=this._getComputedSplineGraphPaletteKey(n);return this._fixedStringList[t]},n.prototype.getLandColor=function(){return this._landColor[0].value},n.prototype._getOriginalBucketId=function(n){var t=Math.floor(parseInt(n)&65535);return t.toString()},n.prototype._computeStyleDynamic=function(n,t,i,r){var w=n.style,u=w.styleDynamic||{},b=w.styleStatic||{},f,o=u.visible,k=u.densityDistance,d=u.densityImportance,g=u.densityLodDelta,h=0,c,nt,a,s,e,v,y,p,l;if(n.visibility){for(c=n.visibility.drawingStyleVisibilities[t],nt=c.length,s=0;s<nt;s++)e=c[s],h=h||e.visiblePaletteKey,i>=e.zoom&&(o=e.visible,k=e.densityDistance,d=e.densityImportance,g=e.densityLodDelta);if(t===3){for(a=!1,c=n.visibility.drawingStyleVisibilities[2],s=0;s<c.length;s++)e=c[s],h=h||e.visiblePaletteKey,i>=e.zoom&&(a=e.visible);(o||a)&&(o=!0)}h&&(v=this._getCustomStyle(h),v!==undefined?o=v:o&&(y=this._getStackedBooleanValue(r,this._fixedStringList[h]),y!==undefined&&(o=y)))}return o&&(f={visible:o,densityDistance:k,densityImportance:d,densityLodDelta:g,priority:n.priority,font:u.font,fontPaletteKey:u.fontPaletteKey,fontSize:u.fontSize,fontWeight:u.fontWeight,fontWeightPaletteKey:u.fontWeightPaletteKey,fontStyle:u.fontStyle,fontStylePaletteKey:u.fontStylePaletteKey,fontCaps:u.fontCaps,fontCapsPaletteKey:u.fontCapsPaletteKey,fontColor:u.fontColor,fontColorPaletteKey:u.fontColorPaletteKey,outlineColor:u.outlineColor,outlineColorPaletteKey:u.outlineColorPaletteKey,secondaryFontSize:u.secondaryFontSize||u.fontSize,globalOrder:n.globalOrder},this._applyStackedString(r,f,"font","fontPaletteKey"),p=this._getStackedNumericValueItem(r,b.preferredFontSizePaletteKey),l=p&&p.value,typeof l=="number"&&isFinite(l)&&(f.fontSize=l*b.fontSizeTransform),this._applyStackedEnum(r,f,"fontWeight",f.fontWeightPaletteKey),this._applyStackedEnum(r,f,"fontStyle",f.fontStylePaletteKey),this._applyStackedEnum(r,f,"fontCaps",f.fontCapsPaletteKey),this._applyStackedColor(r,f,"fontColor",f.fontColorPaletteKey),this._applyStackedColor(r,f,"outlineColor",f.outlineColorPaletteKey)),f},n.prototype._getCustomStyle=function(n){var i=this._fixedStringList[n],t=i&&i.split("."),r;return t&&t.length===2&&(r=this._customStyleManager.getElementStyle(t[0],t[1])),r},n.prototype._getStyleScale=function(n){return Math.round(v.calculateStyleScaleForLod(n)*1e7)/1e7},n.prototype.prefetchShields=function(n,t){var i=this;return t===void 0&&(t=3),new Promise(function(r){for(var a,h,e,u,v,y,o,c,p,l=[],s={},f=0;f<n.length;f++)for(a=i._getShieldUnmappedImageIndexes(n[f].bucketId),h=n[f].indexes,e=0;e<h.length;e++)u=a[h[e]],u>=0&&(i._getImage(u)?i._updateCachedImages(u):s[u]||(s[u]=!0));for(v=Object.keys(s),y=function(r){l.push(new Promise(function(u){i._imageLoader.prefetchImages(r,i._svgColor,i._palette,function(n){i._isDisposed||i._updateCachedImages(n[0]);u()},function(){t>0&&Microsoft.Maps.setTimeout(function(){i._isDisposed||i.prefetchShields(n,--t)},200);u()})}))},o=0,c=v;o<c.length;o++)p=c[o],y(p);Promise.all(l).then(function(){r()})})},n.prototype.prefetchOrganizationImagesByOrgId=function(n,t){var i=this,u,r,f,e;if(t===void 0&&(t=3),u=[],n)for(r=0,f=n;r<f.length;r++)e=f[r],this._getOrgImage(e)||u.push(e);return new Promise(function(n){for(var o,f=[],s=function(n){f.push(new Promise(function(r){i._imageLoader.prefetchOrgImage(n,i._palette,function(){r()},function(n){t>0&&Microsoft.Maps.setTimeout(function(){i._isDisposed||i.prefetchOrganizationImagesByOrgId([n],t-1)},200);r()})}))},r=0,e=u;r<e.length;r++)o=e[r],s(o);Promise.all(f).then(function(){n()})})},n.prototype.prefetchImages=function(n,t,i,r){var u=this;return r===void 0&&(r=3),t=t||[],new Promise(function(f){for(var y,h,p,l,w,a=[],c=!1,s={},v=function(n){var t,r;n>=0&&(t=u._mappedToUnmappedImageIndex[n],u._getImage(t)&&u._updateCachedImages(t),r=u._mapImages[n],c=c||!r,(!r||i)&&(s[t]=!0))},e=0,o=n.length;e<o;e++)y=n[e],h=u._bucketToMappedImageIndex[y],v(h);for(e=0,o=t.length;e<o;e++)h=u._unmappedToMappedImageIndex[t[e]],v(h);if(c)for(i&&(p=Object.keys(s),s={},s[p.join(",")]=!0),l=Object.keys(s),w=function(f){var e=l[f];a.push(new Promise(function(f){u._imageLoader.prefetchImages(e,u._svgColor,u._palette,function(n){var t,i,r;if(!u._isDisposed)for(t=0,i=n;t<i.length;t++)r=i[t],u._updateCachedImages(r);f()},function(){r>0&&Microsoft.Maps.setTimeout(function(){u._isDisposed||u.prefetchImages(n,t,i,--r)},200);f()})}))},e=0,o=l.length;e<o;e++)w(e,o);Promise.all(a).then(function(){f()})})},n.prototype.getFetchedShields=function(n,t,i){var f,e,h,u,r;if(!t||!i||!i.length)return null;var n=Math.round(n),o=this._getShieldImages(t,i),s=[];if(o)for(f=this._getShieldScales(n,t),e=0,h=i.length;e<h;e++)u=i[e],r=null,u>=0&&(r=o[u],r&&f&&f[u]&&r.setScale(f[u]),r||(r=g.DefaultShieldTemplate)),s.push(r);return s},n.prototype.getShieldsAsync=function(n,t,i,r){var u=this,f;r&&(f={bucketId:t,indexes:i},this.selectorReady().then(function(){u.prefetchShields([f]).then(function(){r(u.getFetchedShields(n,t,i))})}))},n.prototype.dispose=function(){this._shieldStyleResponseData=null;this._computedSplineGraphs=[];this._markupOrder&&this._markupOrder.clear();this._serverBooleanValues=[];this._serverColorValues=[];this._serverEnumValues=[];this._serverSingleValues=[];this._serverStringValues=[];this._graphPassDefinitionList=[];this._styleVisibilities=[];this._passDefinitionList=[];this._markupVisibilities=[];this._images=null;this._imgVariants=[];this._markupOrderList=null;this._palette=null;this._drawOrderList=null;this._mapImages=[];this._svgColor=[];this._imageGroups=[];this._groupedImageOptions=[];this._fixedStringList=[];this._shieldImages=null;this._shieldScaleListForZoom=null;this._state=[];this._urlFormat=null;this._propertyValues=[];this._primitiveTemplateCache.clear();this._categoryIconCache.clear();this._bucketToMappedImageIndex={};this._bucketToPassDefinitionIndex={};this._bucketToDrawOrderListIndex={};this._mappedToUnmappedImageIndex={};this._unmappedToMappedImageIndex={};this._unmappedIndexToBucketIds={};this._visibilityRanges=null;this.ready&&this.ready.dispose();window.clearTimeout(this._delayLoadTimerId);this._isDisposed=!0},n.prototype._isTemplateVisible=function(n,t,i){for(var o,u=t.drawingStyleVisibilities[i],s=u.length||0,f=!1,e,r=0;r<s;r++)e=e||u[r].visiblePaletteKey,n>=u[r].zoom&&(f=u[r].visible);return this._customStyleManager&&this._customStyleManager.hasCustomStyle&&(o=this._getCustomStyle(e),typeof o=="boolean"&&(f=o)),f},n.prototype._getScaleFromZoom=function(n,t,i,r){var f,s=this._getStyleScale(n),e,u,h,o;return i&&this._getOrgImage(i)?(e=this._passDefinitionList[this._bucketToPassDefinitionIndex[t]],f=this._getScale(e.scale,e.scaleTransform,s)):(u=this._getImageByBucketId(t),u?(h=this._getSplineGraphPaletteKey(u.scale),o=this._getStackedNumericValueItem(r,h)||{},f=this._getScale(u.scale,u.scaleTransform,s,o.value,o.ignoreTransform)):f=null),f},n._cloneObject=function(n){var i,r,t,f,u;if(!n||typeof n!="object")return n;for(i={},r=Object.keys(n),t=0,f=r.length;t<f;t++)u=r[t],i[u]=this._cloneObject(n[u]);return i},n._colorString=".Color",n._backgroundColor=".BackgroundColor",n._borderColor=".BorderColor",n._labelColor=".LabelColor",n._fillColor=".FillColor",n.backgroundShapeRecord="Shape-Background",n._poiStateNames=["","","DefaultPointState","HoverPointState","SelectedPointState","InactivePointState","InactiveSelectedPointState",],n._poiTypeStateGroups=["","Search","Price","Itinerary","ShowMe","Landmark","Transit","","","","Classic","","Search","Venue",],n.DefaultBucketForLocalCat="334",n.FallbackLocalCat="90000",n._taskList=["Task1","Task2","Task3","Transit","Favorite","Layer"],n._haloImageBucket="1372",n.cityPolygonBucket="879",n.microPoiBucket="1374",n._categoryRemap={"13344":"91572","90298":"91257","90375":"90386","90628":"90727","90948":"91562","90975":"90977","91485":"90661","91563":"90940","91826":"90012","100000":"203",EatAndDrink:"90287",WhatToDo:"90012",WhereToStay:"91572",WhereToStayOpalAction:"91572",Attraction:"90012",Campground:"91562",MovieTheatre:"90045",Parking:"90925",Trail:"90012",School:"90199",University:"90199",TestingLocation:"90386"},n._categoryFallbackMap={House:{categoryId:-1,bucketId:1942,entry:""},PivotEntity:{categoryId:-1,bucketId:353,entry:""},"90000":{categoryId:9e4,bucketId:334,entry:"Business"}},n._localCatIdBucketMapping={EatAndDrink:"286",WhatToDo:"280",WhereToStay:"287",WhereToStayOpalAction:"287",Attraction:"280",Campground:"1366",House:"310",MovieTheatre:"273",Parking:"275",PivotEntity:"353",Trail:"280",School:"294",University:"294",TestingLocation:"1367","91562":"1366","91826":"280","13344":"287","91648":"288","90014":"300","91616":"257","90954":"277","90133":"278","90122":"279","90243":"284","91563":"329","90650":"1365","91533":"271","91649":"281","90948":"1366","90903":"274","90024":"303","90386":"1367","90188":"295","91485":"1368","90727":"306","90859":"325","90089":"276","91537":"296","90298":"318","90738":"67","91348":"309","91572":"287","90320":"297","90837":"313","90045":"273","90016":"304","90960":"1369","91271":"319","90925":"275","90804":"270","90331":"320","90342":"272","90287":"286","90199":"294","90771":"305","91548":"324","91549":"118","91550":"307","91493":"299","90871":"326","90034":"302","90012":"280","91510":"1381","90017":"301","90595":"311","90001":"258","90078":"330","91186":"327","91204":"308","91714":"66","90977":"331","90584":"310","91627":"68","91391":"316","91259":"321","91774":"70","91773":"71","91499":"312","91651":"328","90540":"315","91764":"67","91768":"69","90496":"314","91762":"113","91643":"114","90848":"322","91650":"1359","90942":"317","91621":"64","90892":"1899","91600":"1380","100000":"248","203":"248","255":"254","257":"253","251":"252","253":"251","254":"250","252":"249","91754":"65","205":"247","204":"246","207":"245","206":"244","200":"240","264":"243","265":"242","263":"241","250":"239","202":"238","266":"236","261":"235","91571":"50","201":"234","262":"232","256":"231","260":"229","259":"228","258":"227","267":"226"},n._localCatIdBucketMapping_Delta={House:"1942","90940":"329","90975":"331","90375":"1367","90628":"306","90000":"334"},n._multimodeTransitBucket="239",n.directionIconTypeBuckets={start:"352",middle:"350",via:"1387",turn:"1386",end:"351",ferry:"339",walk:"341",bus:"342",train:"338",airline:"340",tube:"338",auto:"337"},n.poiStylePriorityGroup=999999,n.itineraryPoiBucketId="1941",n.pricePoiBucketId="1901",n.bucketIdForPoi="999999",n.bucketIdForSelectedPoi="999998",n.bucketIdForTransientLensTop="999997",n.bucketIdForTransientLensBottom="999997.5",n.bucketIdForTransientLensLeft="999997.6",n.bucketIdForTransientLensRight="999997.7",n.bucketIdForDirectionsPins="999996",n.xsrPolygonBucketId="1383",n._roadCustomStyle={"999999,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:12,offsetY:12,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"999999,3":{styleStatic:{fontOutlined:!1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"1901,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"999998,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:2,visible:!0,priority:n.poiStylePriorityGroup}},"999997,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.5,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.6,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.7,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999996,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:6,offsetY:6,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}}},n._aerialCustomStyle={"999999,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:12,offsetY:12,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"999999,3":{styleStatic:{fontOutlined:!1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"1901,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"999998,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:2,visible:!0,priority:n.poiStylePriorityGroup}},"999997,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.5,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.6,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.7,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999996,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:6,offsetY:6,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}}},n._poiStyles={"097A0D85-2585-425A-8471-60BDD3C5B7C3":n._roadCustomStyle,"7DCFF932-3B97-4B3E-9EB4-5B9AA89EFA3C":n._roadCustomStyle,"DCD31B1C-B637-4B36-8635-829DF5E46999":n._roadCustomStyle,"DC2B2930-4CA4-45EB-9EE9-3F4EFA4267E5":n._roadCustomStyle,"7443EAC9-CD76-4236-B027-22DBC504BF06":n._aerialCustomStyle,"A3A1C843-30CE-4828-984C-AD44EAF2A245":n._aerialCustomStyle,"68C27B9C-4FB4-4CEC-A664-3FC3C2E8A12A":n._aerialCustomStyle,"F83F2201-05FD-4BFF-8700-07CEEF51C66B":n._aerialCustomStyle},n._darkTemplates={"7443EAC9-CD76-4236-B027-22DBC504BF06":!0,"A3A1C843-30CE-4828-984C-AD44EAF2A245":!0,"68C27B9C-4FB4-4CEC-A664-3FC3C2E8A12A":!0,"3AD7646D-02C7-4E2A-B3AB-2044A88171E9":!0},n._latencyLogKey="MC_TD_NL",n._delayLoadTimeout=60,n._maxRetries=5,n._retryTimeout=10,n._alphaTransformCoefficient=1.5,n._outlineWidthDelta=1,n._xHeightRatio=1.15385,n._capHeightRatio=.93752,n._webkitFontFillLightnessFactor=.85,n}();l.init();var oi=function(){function n(n,t,i,r,u,f,e,o){this._basemapSelector=new l(n,t,i,r,u,f,e,o);this._selector=this._basemapSelector}return n.prototype.dispose=function(){this._basemapSelector&&this._basemapSelector!==this._selector&&this._basemapSelector.dispose();this._selector&&(this._selector.dispose(),this._selector=null);this._basemapSelector=null;this._ready=null;window.clearTimeout(this._delayLoadTimerId)},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t){n._selector&&n._selector.selectorReady().then(function(n){t(n)},function(){if(n._selector){n._selector=new g(n._selector.getName());n._basemapSelector&&n._basemapSelector.ready&&n._basemapSelector.ready.addOne(function(){n._selector=n._basemapSelector});t(n);var i={feature:"",action:tt.Error,data:"BaseMapTemplateSelector failed to load, FallbackTemplateSelector loaded"};u.logger&&u.logger.logCriticalError(null,i)}})})),this._ready},n.prototype.getCategoryIconTemplate=function(n,t,i,r,u){this._selector&&this._selector.getCategoryIconTemplate(n,t,i,r,u)},n.prototype.getIconTemplate=function(n,t,i,r,u,f){this._selector&&this._selector.getIconTemplate(n,t,i,r,u,f)},n.prototype.getCityPolygonTemplates=function(n,t,i,r,u){return this._selector&&this._selector.getCityPolygonTemplates(n,t,i,r,u)},n.prototype.getFirstDrawOrder=function(n){return this._selector&&this._selector.getFirstDrawOrder(n)},n.prototype.getPolygonTemplates=function(n,t,i,r,u,f,e,o){return this._selector&&this._selector.getPolygonTemplates(n,t,i,r,u,f,e,o)},n.prototype.getLandmarkVectorImageTemplate=function(n,t,i,r){return this._selector&&this._selector.getLandmarkVectorImageTemplate(n,t,i,r)},n.prototype.getMarkupStyle=function(n,t,i,r){return this._selector&&this._selector.getMarkupStyle(n,t,i,r)},n.prototype.getName=function(){return this._selector&&this._selector.getName()},n.prototype.getPoiTemplate=function(n,t,i,r,u,f,e,o){return r===void 0&&(r=1),u===void 0&&(u=!0),f===void 0&&(f=!0),this._selector.getPoiTemplate(n,t,i,r,u,f,e,o)},n.prototype.getPoiVectorImageTemplate=function(n,t,i,r,u,f,e){return this._selector&&this._selector.getPoiVectorImageTemplate(n,t,i,r,u,f,e)},n.prototype.getRoutePoiVectorImageTemplate=function(n,t,i){return this._selector&&this._selector.getRoutePoiVectorImageTemplate(n,t,i)},n.prototype.prefetchShields=function(n){return this._selector&&this._selector.prefetchShields(n)},n.prototype.prefetchImages=function(n,t,i,r){return this._selector&&this._selector.prefetchImages(n,t,i,r)},n.prototype.prefetchOrganizationImagesByOrgId=function(n,t){return t===void 0&&(t=3),this._selector&&this._selector.prefetchOrganizationImagesByOrgId(n,t)},n.prototype.getFetchedShields=function(n,t,i){return this._selector&&this._selector.getFetchedShields(n,t,i)},n.prototype.getShieldsAsync=function(n,t,i,r){this._selector&&this._selector.getShieldsAsync(n,t,i,r)},n.prototype.getTemplates=function(n,t){return this._selector&&this._selector.getTemplates(n,t)},n}(),vt=function(){function n(n){this._maxValue=16384;this.id="SpatialGrid"+n.quadKey;this._matrixCache=new c(1024);this.bounds=[0,this._maxValue,this._maxValue,0];var t=1<<n.lod,i=1<<(n.lod>0?n.lod-1:0);this._west=n.x/t*360-180;this._east=(n.x+1)/t*360-180;this._north=90-n.y/i*180;this._south=90-(n.y+1)/i*180;this._x1=f.instance.projectToX(this._north,this._west);this._width=(f.instance.projectToX(this._south,this._east)-this._x1)/this._maxValue;this._y1=f.instance.projectToY(this._north,this._west);this._height=(f.instance.projectToY(this._south,this._east)-this._y1)/this._maxValue;this._mercatorToGridCrsMatrix=null}return n.prototype.getMatrix=function(n){var i=n.id,t=this._matrixCache.getItem(i);return t||(t=this._getMatrixInternal(n),this._matrixCache.addItem(i,t)),t},n.prototype._getMatrixInternal=function(n){var i=new ni(this._width,0,0,this._height,this._x1,this._y1),t;return n===f.instance?i:(t=n.getMatrix&&n.getMatrix(f.instance),t)?t.invert().multiply(i):null},n.prototype._getMercatorToGridCrsMatrix=function(){return this._mercatorToGridCrsMatrix||(this._mercatorToGridCrsMatrix=this._getMatrixInternal(f.instance).invert()),this._mercatorToGridCrsMatrix},n.prototype.projectToX=function(n,t){return this._project(n,t,!0)},n.prototype.projectToY=function(n,t){return this._project(n,t,!1)},n.prototype._project=function(n,t,i){var r=f.instance.projectToX(n,t),u=f.instance.projectToY(n,t),e=this._getMercatorToGridCrsMatrix();switch(i){case!0:return e.projectX(r,u);case!1:return e.projectY(r,u)}},n.prototype.toLatitude=function(n,t){var i=this._x1+this._width*n,r=this._y1+this._height*t;return f.instance.toLatitude(i,r)},n.prototype.toLongitude=function(n,t){var i=this._x1+this._width*n,r=this._y1+this._height*t;return f.instance.toLongitude(i,r)},n}(),si=function(){function n(n){var r=0,u=0,t,i;if(n===0)t=0;else{for(var e=n,o=2147483648,f=31;f&&!(e&o);)f--,o/=2;t=(f+1)/2}for(i=0;i<t;i++)r<<=1,r|=n>>(t-i-1)*2&1,i>0&&(u<<=1,u|=n>>(t-i-1)*2+1&1);for(var e=n&2147483647>>32-2*t,s="0",h=t;h--;)s+="0123".charAt(e>>h*2&3);this.quadKey=s;this.x=r;this.y=u;this.lod=t;this.crs=new vt(this);this.bounds=[0,16384,16384,0]}return n.fromLocation=function(t,i){if(i===0)return new n(1);if(i===1)return new n(t.longitude>0?3:2);var r=2<<i-2,u=Math.floor((t.longitude+180)*2*r/360),f=Math.floor((90-t.latitude)*r/180);return u=Math.min(u,r*2-1),f=Math.min(f,r-1),n.fromGridXY(u,f,i)},n.fromGridXY=function(i,r,u){var f=0,e;if(t.assertNotNull(i,"gridX"),t.assertNotNull(r,"gridY"),t.assertNotNull(u,"lod"),u===0)f=1;else{for(f=0,e=0;e<u;e++)f<<=1,f|=r>>u-e-1&1,f<<=1,f|=i>>u-e-1&1;f|=1<<u*2-1}return new n(f)},n}(),hi=function(n){function t(t,i,r,u,f,e,o,s){var h=n.call(this,t,i,r,u)||this;return h._id=o,s&&(h._jsonsoSuffix=s),h._minZoom=f,h._maxZoom=e,h._suppressDataRetrieval=!w.staticLandmarks&&!w.dynamicLandmarks,h}return at(t,n),t.prototype.updateZoom=function(n,t){this._minZoom=n;this._minZoom=t},t.prototype.applyFilter=function(n){this._filter=n},t.prototype.resetFilter=function(){this._filter=null},t.prototype.setLayer=function(n){this._layer=n},t.prototype._filterResponse=function(n){var r={},f=w.staticLandmarks,u,i,t;if(r.primitives=[],n&&n.primitives)for(r.primitives=n.primitives,u=0;u<r.primitives.length;u++)i=r.primitives[u],f?i.isHoverEnabled=i.isTapEnabled=null:i.isHoverEnabled||(i.isHoverEnabled=i.isTapEnabled=function(){return!0}),t=i.entity,t&&(t.changed||(t.changed=new y),t.ypid&&t.ypid.indexOf("ypid:")!==0&&(t.ypid="ypid:"+t.ypid),t.poiType=5),i.layer=this._layer;return r},t.prototype.shouldFetchPrimitives=function(){return this._suppressDataRetrieval||this._layer&&!this._layer.getVisible()?!1:!0},t}(d),yt=function(){function n(n,t,i){var r=this;this._layerId=n;this._parentDataSource=t;this.spatialIndex=i;this.invalidated=new y;t.invalidated.add(function(n){return r.invalidated.invoke(n)})}return n.prototype.getParentDataSource=function(){return this._parentDataSource},n.prototype.getPrimitives=function(n,t,i,r){this._parentDataSource.getPrimitivesInternal(n,this._layerId,t,i,r)},n.prototype.applyFilter=function(n){this._parentDataSource.applyFilter(n)},n.prototype.resetFilter=function(){this._parentDataSource.resetFilter()},n.prototype.cancelPrimitivesRequest=function(n,t){this._parentDataSource.cancelPrimitivesRequestInternal(n,this._layerId,t)},n.prototype.getDataUniquenessKey=function(n){t.assertNotNull(n,"regionId");return n.quadKey+this._parentDataSource.getFilterKey()},n}(),s;(function(n){var t=function(){function n(n){this._coreConfig=n}return n.prototype.ready=function(){var n=this;return this._readyPromise||(this._readyPromise=new Promise(function(t,i){var u=e.dynamicProperties,f=n._coreConfig.mapTemplateUrlBase.replace("{stlRequestDomain}",u.bingRequestDomain),s=r._updateTfeUrlDomain(b.styleEntryToBucketUrl.replace("{urlbase}",f)).replace("{stlVersion}",e.stlVersion).replace("{subdomain}","0");o.downloadJson(s,"basemapdata",function(i){n._entryToBucket={};Object.keys(i).forEach(function(t){n._entryToBucket[t.toLowerCase()]=i[t]});t()},function(){i()},null,!1,null,!1)})),this._readyPromise},n.prototype.getEntryBucket=function(n,t){var i=n&&this._entryToBucket&&this._entryToBucket[n.toLowerCase()],r;if(i)switch(t){case 3:r=i.a;break;case 2:r=i.l;break;case 1:r=i.p}return r},n}();n.StyleEntryBucketMap=t})(s||(s={}));n.BadgeTemplateSelector=ut;n._BaseMapDataSource=d;n._BaseMapStreetsideDataSource=fi;n._EntityHelper=p;n.BaseMapImageLoader=s.BaseMapImageLoader;n._BaseMapTemplateSelector=l;n._BaseMapTemplateSelectorProxy=oi;n._GridId=si;n._GridCrs=vt;n._LandmarksDataSource=hi;n._LayerDataSource=yt;n.StyleEntryBucketMap=s.StyleEntryBucketMap}catch(pt){if(u.logger)u.logger.logCriticalError(pt);else throw pt;}}).call(window)