define("components/login",["FR","services/freerideRestApi","components/sharedUI/forms","services/mouseflowHelper"],function(r,e,o,n){var s={getLoginFormElements:function(r){var e={};return e.returningCustomerForm=$(r).closest("form"),e.userName=e.returningCustomerForm.find('[name="UserName"]'),e.userNameFieldGroup=$(e.userName).closest(".accountLogin__fieldGroup"),e.password=$(e.returningCustomerForm).find('[name="Password"]'),e.passwordFieldGroup=$(e.password).closest(".accountLogin__fieldGroup"),e.errorMessage=$(e.returningCustomerForm).find(".errorMessage"),e},returningCustomerSubmit:function(t,i){var a=i(t.target);if(n.forms.submit(a.returningCustomerForm),$(a.returningCustomerForm).validate().form(),a.returningCustomerForm.valid()){a.window=r.$el.window,a.errorMessage.removeClass("error"),a.userNameFieldGroup.removeClass("error"),a.passwordFieldGroup.removeClass("error"),a.userName.removeClass("input-validation-error"),a.password.removeClass("input-validation-error");var u={UserName:a.userName.val(),Password:a.password.val(),IsLoginPage:$('form[data-login-page="True"]').length>0,RedirectUrl:r.redirectUrl||window.location.pathname+window.location.search};a.window.trigger("loading-spinner-on",[".main-container"]),e.existingAccountLogin(JSON.stringify(u),{},function(r){var e=JSON.parse(r.data);if(!0===r.success)n.forms.success(a.returningCustomerForm),$(a.returningCustomerForm).trigger("signInSuccessful"),setTimeout(function(){window.location.href=e.Response},250);else{n.forms.failure(a.returningCustomerForm),a.userName.addClass("input-validation-error"),a.password.addClass("input-validation-error");var i=o.extractError(e),u="<p>"+i+"</p>";a.returningCustomerForm.validate().showErrors({UserName:"",Password:""}),a.errorMessage.html(u).addClass("error");var d=s.getErrors(a.returningCustomerForm,i);$(t.target).trigger("errorMsgShown",d),a.window.trigger("loading-spinner-off",[".main-container"]),a.returningCustomerForm.closest(".main_nav__utility_item").addClass("hover").focus()}})}else{n.forms.failure(a.returningCustomerForm);var d=s.getErrors(a.returningCustomerForm);$(t.target).trigger("errorMsgShown",d)}},getErrors:function(r,e){var o={};return s.hidePasswordInput(),r.find(".field-validation-error").each(function(){var r=$(this);o[r.attr("data-valmsg-for")]=r.find("span").text().trim()}),void 0!==e&&(o["catch-all-error"]=e),o},bindEvents:function(){$(".accountLogin__cta").click(function(r){r.preventDefault(),s.hidePasswordInput(),s.returningCustomerSubmit(r,s.getLoginFormElements)}),$(".accountLogin input").keydown(function(r){13===(r.which||r.keyCode)&&(r.preventDefault(),s.hidePasswordInput(),s.returningCustomerSubmit(r,s.getLoginFormElements))}),$(".showButton").click(function(r){return r.preventDefault(),r.stopPropagation(),s.showPasswordInput(r.target)}),$(".hideButton").click(function(r){return r.preventDefault(),r.stopPropagation(),s.hidePasswordInput(r.target)})},init:function(){s.bindEvents();var e=function(){$(".accountLoginPage").find(".returningCustomerFormId").trigger("shown")};window.VRI_AnalyticsLoaded?e():r.$el.window.on("VRI_AnalyticsLoaded",e)},hidePasswordInput:function(r){if(r)return $(r).closest(".passwordButtons").removeClass("passwordButtons--is-showing"),$(r).closest(".accountLogin__fieldGroup").find(".passwordInput")[0].type="password";$(".passwordButtons--is-showing").removeClass("passwordButtons--is-showing"),$(".passwordInput").map(function(r,e){e.type="password"}).get()},showPasswordInput:function(r){var e=$(r).closest(".accountLogin__fieldGroup").find(".passwordInput")[0];e&&e.value.length&&($(r).closest(".passwordButtons").addClass("passwordButtons--is-showing"),e.type="text")}};return $(function(){return s.init()}),s});
//# sourceMappingURL=login.js.map
