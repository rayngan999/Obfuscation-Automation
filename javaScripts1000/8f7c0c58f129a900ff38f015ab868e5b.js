define(["modules/id.core"],function(e){"use strict";e.utils.log("loading id.mainActionBarV2.js");var t=function(){var t,n=this,i=!1,o=!1,s=!1,a=!1,r=!1,d=!0,c=[];this.conf={SITE_WRAP_SELECTOR:".idjs-SiteWrap",ACTIVE_STATE_CLASS:"id-SimpleTab--active",ACTIVE_STATE_SELECTOR:".id-SimpleTab--active",ENCODED_CONTENT_SELECTOR:".idjs-MainNavV2-encodedLinks",MAIN_TRIGGER_SELECTOR:".idjs-MainNavV2-mainTrigger",MAIN_TRIGGER_CLASS:"idjs-MainNavV2-mainTrigger",MAIN_TRIGGER_TARGET_DATA:"idMainnavv2TriggerTarget",MAIN_TRIGGER_READY_CLASS:"id-MainNavV2-menuTrigger--ready",MAIN_TRIGGER_CAT_ID_DATA:"idMainnavv2MainCatid",SEARCH_TRIGGER_CLASS:"idjs-MainNavV2-searchTrigger",SEARCH_TRIGGER_SELECTOR:".idjs-MainNavV2-searchTrigger",SEARCH_TRIGGER_TARGET_DATA:"idMainnavv2TriggerTarget",SEARCH_INPUT_SELECTOR:".id-js-FulltextSearch-input",USER_SETTINGS_TRIGGER_CLASS:"idjs-MainNavV2-userSettingsTrigger",USER_SETTINGS_TRIGGER_SELECTOR:".idjs-MainNavV2-userSettingsTrigger",USER_SETTINGS_TARGET_DATA:"idMainnavv2TriggerTarget",BOOKMARK_TRIGGER_CLASS:"idjs-MainNavV2-bookmarkTrigger",BOOKMARK_TRIGGER_SELECTOR:".idjs-MainNavV2-bookmarkTrigger",BOOKMARK_TARGET_DATA:"idMainnavv2TriggerTarget",SUB_WRAP_SELECTOR:".idjs-MainNavV2-wrap",SUB_WRAP_ACTIVE_CLASS:"id-MainNavV2-wrap--active",SUB_SECT_ID_PREFIX:"#id-subLvl",SUB_SECT_ID_DATA:"idMainnavv2Id",SUB_SECT_SELECTOR:".idjs-MainNavV2-sect",SUB_SECT_CURRENT_CLASS:"id-MainNavV2-sect--current",SUB_SECT_CURRENT_SELECTOR:".id-MainNavV2-sect--current",SUB_TRIGGER_CLASS:"idjs-MainNavV2-subTrigger",SUB_TRIGGER_SELECTOR:".idjs-MainNavV2-subTrigger",SUB_TRIGGER_CAT_ID_DATA:"idMainnavv2Catid",SUB_TRIGGER_CAT_ID_DATA_SELECTOR:"data-id-mainnavv2-catid",SUB_TRIGGER_TO_PARENT_CAT_ID_DATA:"idMainnavv2ParentCatid",SUB_TRIGGER_TO_PARENT_CLASS:"idjs-MainNavV2-subTriggerToParent",CLOSE_ALL_TRIGGER_CLASS:"idjs-MainNavV2-closeAllTrigger",TEASER_HOLDER_SELECTOR_PREFIX:"#id-js-MainNavV2-teaser",TEASER_HOLDER_SELECTOR_MOBILE_POSTFIX:"--mobl",TRIGGER_TYPES:{MAIN:"main",SEARCH:"search",USER_SETTINGS:"user",BOOKMARK:"bookmark",BREAD_CRUMB:"bread",SUB_MENU:"sub",SUB_MENU_TO_PARENT:"subToParent",CLOSE_ALL:"closeAll"}},this.setMainNavActive=function(e){o=e?!0:!1},this.setSearchActive=function(e){s=e?!0:!1},this.setUserSettingsActive=function(e){a=e?!0:!1},this.setBookmarkActive=function(e){r=e?!0:!1},this.setMainActionBarSticky=function(e){d=e?!0:!1},this.initNav=function(t){e.dom.bind(t,"click",function(e){n.handleNavigationClick(e)}),e.dom.$(this.conf.MAIN_TRIGGER_SELECTOR,t).addClass(this.conf.MAIN_TRIGGER_READY_CLASS)},this.prepareNav=function(){i===!1&&(this.decodeAndInsertContent(e.dom.$(this.conf.SUB_TRIGGER_SELECTOR,n.nav)),this.decodeAndInsertContent(e.dom.$(this.conf.ENCODED_CONTENT_SELECTOR)),i=!0)},this.handleNavigationClick=function(t){var i=n.getNavElementInformation(t.target);(void 0!==i.catId||void 0!==i.elementType)&&(t.preventDefault(),n.prepareNav(),e.event.publish(e.event.constants.MAIN_NAV_V2_ELEMENT_CLICKED,i.catId,i.elementType),n.handleNavigationBehaviour(i.elementType,i.catId))},this.handleBreadCrumbClick=function(e){n.prepareNav(),n.handleNavigationBehaviour(n.conf.TRIGGER_TYPES.BREAD_CRUMB,e)},this.decodeAndInsertContent=function(t){var i,o,s,a=t.length,r=function(e){e.hasClass(n.conf.SUB_TRIGGER_CLASS)&&n.decodeAndInsertContent(e)};for(s=0;a>s;s+=1)o=e.dom.$(t[s]),i=JSON.parse(o.data("idMConf")||"{}"),"content-insert"===o.data("idModule")&&i.lazyInit===!0&&(i.lazyInit=!1,o.data("idMConf",JSON.stringify(i)),e.event.publish(e.event.constants.CONTENT_INSERT,t[s],i,r))},this.getNavElementInformation=function(t){var i,o,s,a=e.dom.$(t),r={};return a.hasClass(n.conf.MAIN_TRIGGER_CLASS)?(o=n.conf.TRIGGER_TYPES.MAIN,r=a.data(),i=r[n.conf.MAIN_TRIGGER_CAT_ID_DATA]):e.dom.closest(n.conf.MAIN_TRIGGER_SELECTOR,a)?(o=n.conf.TRIGGER_TYPES.MAIN,s=e.dom.closest(n.conf.MAIN_TRIGGER_SELECTOR,a),r=s.data(),i=r[n.conf.MAIN_TRIGGER_CAT_ID_DATA]):a.hasClass(n.conf.SEARCH_TRIGGER_CLASS)?o=n.conf.TRIGGER_TYPES.SEARCH:a.hasClass(n.conf.USER_SETTINGS_TRIGGER_CLASS)?o=n.conf.TRIGGER_TYPES.USER_SETTINGS:a.hasClass(n.conf.BOOKMARK_TRIGGER_CLASS)?o=n.conf.TRIGGER_TYPES.BOOKMARK:a.hasClass(n.conf.SUB_TRIGGER_CLASS)?(o=n.conf.TRIGGER_TYPES.SUB_MENU,r=a.data(),i=r[n.conf.SUB_TRIGGER_CAT_ID_DATA]):a.hasClass(n.conf.SUB_TRIGGER_TO_PARENT_CLASS)?(o=n.conf.TRIGGER_TYPES.SUB_MENU_TO_PARENT,r=a.data(),i=r[n.conf.SUB_TRIGGER_TO_PARENT_CAT_ID_DATA]):a.hasClass(n.conf.CLOSE_ALL_TRIGGER_CLASS)&&(o=n.conf.TRIGGER_TYPES.CLOSE_ALL),{catId:i,elementType:o}},this.handleNavigationBehaviour=function(e,t){this.handleStickyBehaviour(e,t),e===n.conf.TRIGGER_TYPES.MAIN||e===n.conf.TRIGGER_TYPES.SEARCH||e===n.conf.TRIGGER_TYPES.USER_SETTINGS||e===n.conf.TRIGGER_TYPES.BOOKMARK?(e===n.conf.TRIGGER_TYPES.MAIN&&(o?this.closeMainNav():(this.openMainNav(),this.insertNavigationTeaser(t))),e===n.conf.TRIGGER_TYPES.SEARCH&&this[s?"closeSearch":"openSearch"](),e===n.conf.TRIGGER_TYPES.USER_SETTINGS&&this[a?"closeUserSettings":"openUserSettings"](),e===n.conf.TRIGGER_TYPES.BOOKMARK&&this[r?"closeBookmarks":"openBookmarks"]()):e===n.conf.TRIGGER_TYPES.CLOSE_ALL?this.closeMainNav():e===n.conf.TRIGGER_TYPES.SUB_MENU?this.handleSubNavigationBehaviour(t):e===n.conf.TRIGGER_TYPES.SUB_MENU_TO_PARENT?this.handleSubNavigationBehaviour(t):e===n.conf.TRIGGER_TYPES.BREAD_CRUMB&&(t===this.getCurrentlyActiveSubNav().catId?this.closeMainNav():this.handleSubNavigationBehaviour(t))},this.insertNavigationTeaser=function(t){e.utils.inArray(t,c)||(c.push(t),this.loadNavigationTeaser(t,e.dom.$(n.conf.TEASER_HOLDER_SELECTOR_PREFIX+t)))},this.loadNavigationTeaser=function(t,i){t&&i.length>0&&e.event.publish(e.event.constants.LAZYLOAD,{type:"CONTAINER",categoryId:t,containerType:"NAVIGATION_TEASER",targetId:"#"+i[0].id,invertLoadingState:!0},n.insertNavigationTeaserMobile)},this.insertNavigationTeaserMobile=function(t,i){var o=e.dom.$(i.targetId+n.conf.TEASER_HOLDER_SELECTOR_MOBILE_POSTFIX);e.dom.$(e.dom.util.create(t)).appendTo(o),e.initComponents(o)},this.handleStickyBehaviour=function(e,t){d?this.deactivateSticky():o&&e===n.conf.TRIGGER_TYPES.MAIN||s&&e===n.conf.TRIGGER_TYPES.SEARCH||a&&e===n.conf.TRIGGER_TYPES.USER_SETTINGS||r&&e===n.conf.TRIGGER_TYPES.BOOKMARK||t===this.getCurrentlyActiveSubNav().catId&&e===n.conf.TRIGGER_TYPES.BREAD_CRUMB||e===n.conf.TRIGGER_TYPES.CLOSE_ALL?this.activateSticky():this.jumpToTop()},this.deactivateSticky=function(){d=!1,t=e.dom.$(window).scrollTop(),e.dom.$(".id-js-SiteHeader-wrap").removeClass("id-SiteHeader-wrap--stickyOnScrollUp"),this.jumpToTop()},this.activateSticky=function(){d=!0;var n=e.dom.$(".id-js-SiteHeader-wrap");t>n.offset().top+n.offset().height?n.addClass("id-StickyElement--isSticky id-StickyElement--hide"):n.removeClass("id-StickyElement--isSticky"),n.addClass("id-SiteHeader-wrap--stickyOnScrollUp"),window.scrollTo(0,t)},this.jumpToTop=function(){window.scrollTo(0,parseInt(e.dom.$(n.conf.SITE_WRAP_SELECTOR).offset().top,10))},this.openMainNav=function(){o||(this.closeSearch(),this.closeUserSettings(),this.closeBookmarks(),this.handleMainNavClasses("add")),o=!0},this.closeMainNav=function(){o&&(this.handleSubNavigationBehaviour(void 0),this.handleMainNavClasses("remove")),o=!1},this.handleMainNavClasses=function(t){if("add"===t||"remove"===t){var i="add"===t?"addClass":"removeClass",o=e.dom.$(n.conf.MAIN_TRIGGER_SELECTOR,n.nav),s=o.data();e.dom.$(n.conf.SUB_WRAP_SELECTOR,n.nav)[i](n.conf.SUB_WRAP_ACTIVE_CLASS),o[i](n.conf.ACTIVE_STATE_CLASS),e.dom.$(s[n.conf.MAIN_TRIGGER_TARGET_DATA])[i](n.conf.ACTIVE_STATE_CLASS+" "+n.conf.SUB_SECT_CURRENT_CLASS)}},this.openSearch=function(){if(!s){this.closeMainNav(),this.closeUserSettings(),this.closeBookmarks();var t=this.handleNavElementClasses("add",n.conf.SEARCH_TRIGGER_SELECTOR,n.conf.SEARCH_TRIGGER_TARGET_DATA);e.dom.$(n.conf.SEARCH_INPUT_SELECTOR,t).first().focus()}s=!0},this.closeSearch=function(){s&&this.handleNavElementClasses("remove",n.conf.SEARCH_TRIGGER_SELECTOR,n.conf.SEARCH_TRIGGER_TARGET_DATA),s=!1},this.openUserSettings=function(){if(!a){this.closeMainNav(),this.closeSearch(),this.closeBookmarks();var t=this.handleNavElementClasses("add",n.conf.USER_SETTINGS_TRIGGER_SELECTOR,n.conf.USER_SETTINGS_TARGET_DATA);e.dom.$("[type=email]",t).first().focus()}a=!0},this.closeUserSettings=function(){a&&this.handleNavElementClasses("remove",n.conf.USER_SETTINGS_TRIGGER_SELECTOR,n.conf.USER_SETTINGS_TARGET_DATA),a=!1},this.openBookmarks=function(){r||(this.closeMainNav(),this.closeSearch(),this.closeUserSettings(),this.handleNavElementClasses("add",n.conf.BOOKMARK_TRIGGER_SELECTOR,n.conf.BOOKMARK_TARGET_DATA)),r=!0},this.closeBookmarks=function(){r&&this.handleNavElementClasses("remove",n.conf.BOOKMARK_TRIGGER_SELECTOR,n.conf.BOOKMARK_TARGET_DATA),r=!1},this.handleNavElementClasses=function(t,i,o){var s,a,r,d;return("add"===t||"remove"===t)&&(d="add"===t?"addClass":"removeClass",a=e.dom.$(i,n.nav),r=a.data(),s=e.dom.$(r[o]),a[d](n.conf.ACTIVE_STATE_CLASS),s[d](n.conf.ACTIVE_STATE_CLASS)),s},this.handleSubNavigationBehaviour=function(t){if(o||this.openMainNav(),void 0===t)e.dom.$(n.conf.ACTIVE_STATE_SELECTOR,n.nav).removeClass(n.conf.ACTIVE_STATE_CLASS+" "+n.conf.SUB_SECT_CURRENT_CLASS);else{n.insertNavigationTeaser(t);var i,s=e.dom.$(n.conf.SUB_SECT_ID_PREFIX+t,n.nav),a=e.dom.$("["+n.conf.SUB_TRIGGER_CAT_ID_DATA_SELECTOR+'="'+t+'"]',n.nav);i=this.getCurrentlyActiveSubNav(),e.dom.$("["+n.conf.SUB_TRIGGER_CAT_ID_DATA_SELECTOR+'="'+i.catId+'"]',n.nav).removeClass(n.conf.ACTIVE_STATE_CLASS),i.$elem.removeClass(n.conf.SUB_SECT_CURRENT_CLASS),e.dom.$(n.conf.ACTIVE_STATE_SELECTOR,s[0]).removeClass(n.conf.ACTIVE_STATE_CLASS+" "+n.conf.SUB_SECT_CURRENT_CLASS),s.addClass(n.conf.ACTIVE_STATE_CLASS+" "+n.conf.SUB_SECT_CURRENT_CLASS),a.addClass(n.conf.ACTIVE_STATE_CLASS),e.dom.parents(n.conf.SUB_SECT_SELECTOR,s).addClass(n.conf.ACTIVE_STATE_CLASS)}},this.getCurrentlyActiveSubNav=function(){var t,i=e.dom.$(n.conf.SUB_SECT_CURRENT_SELECTOR,n.nav),o=i.data();return t=o&&o[n.conf.SUB_SECT_ID_DATA]||void 0,{catId:t,$elem:i}},this.init=function(t){this.nav=t,this.initNav(t),e.event.subscribe(e.event.constants.BREADCRUMB_CLICK,n.handleBreadCrumbClick,this,!1)}};return t});