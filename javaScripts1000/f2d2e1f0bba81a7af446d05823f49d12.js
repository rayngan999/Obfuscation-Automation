(function(){var w,ot,y,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,b,oi;try{(function(){var n={L_OverlayEntity_AddMyPlaces:"Add to favorites",L_OverlayEntity_SaveAsFavorite:"Save as favorite",L_OverlayEntity_SaveAs:"Save as...",L_OverlayEntity_Save:"Save...",L_OverlayEntity_MoveTo:"Move to",L_AddNickNameOption:"Add a nickname",L_AddNoteOption:"Add a description",L_EditNickNameOption:"Edit nickname",L_EditNoteOption:"Edit description",L_DeleteEntityOption:"Remove",L_EditEntityOption:"Edit",L_DeleteNickNameOption:"Delete nickname",L_DeleteNoteOption:"Delete description",L_EditHomeWorkOption:"Edit",L_HideHomeWorkOption:"Hide from general Map",L_DisplayHomeWorkOption:"Always display on Map",L_OverlayEntity_AddPushpin:"Add a pin",L_OverlayEntity_Directions:"Directions",L_OverlayEntity_DirectionsTo:"Directions to",L_OverlayEntity_DirectionsFrom:"Directions from",L_OverlayEntity_AddToRoute:"Add to route",L_OverlayEntity_AddToItineraries:"Save to {0}",L_OverlayEntity_MoveToDay:"Move to",L_OverlayEntity_Nearby:"Nearby",L_OverlayEntity_OpenCard:"Show details",L_OverlayEntity_OpenNewCard:"Open as new card",L_TrafficScheduledConstruction_Text:"Scheduled construction",L_TrafficOtherNews_Text:"Other news",L_TrafficCongestion_Text:"Congestion",L_TrafficAccident_Text:"Accident",L_TrafficDisabledVehicle_Text:"Disabled vehicle",L_TrafficRoadHazard_Text:"Road hazard",L_TrafficUnScheduledContruction_Text:"Unscheduled construction",L_TrafficPlannedEvent_Text:"Planned event",L_TrafficMassTransit_Text:"Transit incident",L_TrafficWeather_Text:"Weather alert",L_TrafficMiscellaneous_Text:"Miscellaneous",L_TrafficSeverityMinor_Text:"Minor",L_TrafficSeverityModerate_Text:"Moderate",L_TrafficSeveritySerious_Text:"Serious",L_TrafficSeverityLowImpact_Text:"Low impact",L_TrafficPopupSeverity_Text:"Severity:",L_TrafficPopupStartTime_Text:"Start time:",L_TrafficPopupEstEndTime_Text:"Est. end time:",L_TrafficPopupDescription_Text:"Description:",L_TrafficCurrentCameraImage_Text:"Current traffic conditions image at {0}",L_TrafficPreviewCameraImage_Text:"Thumbnail preview of traffic conditions image at {0}",L_TrafficRecentCamerasTitle:"Recently viewed cameras",L_TrafficPopularCamerasTitle:"Popular cameras",L_TrafficIncidentsTitle:"Notifications",L_TrafficLegendsTitle:"Traffic legend",L_TrafficLegendsHeavy:"Heavy",L_TrafficLegendsModerate:"Moderate",L_TrafficLegendsLight:"Light",L_TrafficLegendsNoTraffic:"No traffic",L_TrafficLegendsClosed:"Road closed",L_TrafficLegendsSlow:"Slow",L_TrafficLegendsFast:"Fast",L_TrafficModuleMoreLink:"see more",L_TrafficModuleLessLink:"see less",L_TrafficBackButtonText:"return to summary",L_TrafficTaskTitle_Text:"Traffic",L_TrafficsZoomInNotification:"Zoom in to see more cameras",L_TrafficsNoCameraNotification:"Sorry, there are no cameras in this area",L_TrafficsToggleCameras:"Cameras",L_TrafficCameraDirectionNorth_Text:"Camera facing North",L_TrafficCameraDirectionSouth_Text:"Camera facing South",L_TrafficCameraDirectionEast_Text:"Camera facing East",L_TrafficCameraDirectionWest_Text:"Camera facing West",L_Traffic_Camera_Tip:"View camera at:",L_InfoboxCloseToolTip_Text:"Close",L_TrafficCameraDisclaimer_Text:"Traffic camera images must not be viewed while driving.  In law a person may be regarded as driving a vehicle whenever the engine is running.",L_StreetsideNoCoverageInstructions_Text:"Tap on a highlighted road to enter Streetside.",L_NavBarLocateMeToolTip_Text:"Locate me",L_NavBarMapSwitcherToolTip_Text:"Change the map style",L_NavBarRotateCCToolTip_Text:"Rotate left",L_NavBarRotateToolTip_Text:"Reset orientation",L_NavBarRotateCToolTip_Text:"Rotate right",L_NavBarStreetsideLabel_Text:"Streetside",L_NavBarTrafficLabel_Text:"Traffic",L_NavBarBirdseyeV2ExitTip_Text:"Exit Bird's eye",L_NavBarBirdseyeV2NotAvailableTip_PrimaryText:"No imagery available beyond this",L_NavBarBirdseyeV2NotAvailableTip_SecondaryText:"Pan to other areas with coverage",L_NavBarBirdseyeV2NotAvailableRotationTip_PrimaryText:"Rotation not available",L_NavBarZoomInToolTip_Text:"Zoom in",L_NavBarZoomOutToolTip_Text:"Zoom out",L_NavBarCloseRadialMenuToolTip_Text:"Close",L_NavBarOpenRadialMenuToolTip_Text:"View aerial, birds eye, and more...",L_StreetsideNoCoverageInMapView_Text:"Streetside isn't available here, press ESC to exit.",L_StreetsideMobileNoCoverageInMapView_Text:"Streetside isn't available here.",L_OverlayEntity_Streetside:"View streetside",L_OverlayEntity_BirdseyeV2:"View bird's eye",L_OverlayEntity_Zoom:"Zoom in",L_ScaleBarKilometers_Text:"km",L_ScaleBarMeters_Text:"m",L_ScaleBarMiles_Text:"miles",L_ScaleBarYards_Text:"yards",L_ScaleBarFeet_Text:"feet",L_TrafficDateTimeFormat:"{0} {1}",L_LocateMe_ChangeSettings_Text:"Manually change my location setting",L_LocateMe_Error_Text_Approximate_Location:"We could not retrieve your exact location, but think you may be in this area.",L_LocateMe_Error_Text_Setting:"We could not retrieve your exact location. This is your default location setting.",L_StreetsideAutoEntryTooltip_Text:"Did you know you can click on the blue lines to enter Streetside?",L_CurrentMapTypeToolTip_Text:"Current Map Type: {mapStyle}",L_RadialMenuAerialButtonToolTip_Text:"Aerial",L_RadialMenuAerialButtonDescription_Text:"A detailed look from above",L_RadialMenuBirdseyeButtonToolTip_Text:"Bird's eye",L_RadialMenuBirdseyeButtonDescription_Text:"A better angle of aerial photography",L_RadialMenuOrdnanceSurveyButtonToolTip_Text:"Ordnance Survey",L_RadialMenuOrdnanceSurveyButtonDescription_Text:"Maps for outdoor life (UK only)",L_RadialMenuRoadButtonToolTip_Text:"Road",L_RadialMenuRoadButtonDescription_Text:"A standard road map",L_RadialMenuStreetsideButtonToolTip_Text:"Streetside",L_RadialMenuStreetsideButtonDescription_Text:"Explore at eye level",L_DropDownMenuLabelToggleButtonToolTip_Text:"Labels",L_DropDownMenuLabelToggleButtonDescription_Text:"for Aerial and Bird's eye",L_OverlayEntity_AddAPushpin:"Add a pushpin",L_WalkingTime:"{0} min walk",L_NearbyParkingTitle:"Parking near {0}",L_NearbyParkingError:"Sorry, no nearby parking found!!",L_CameraImageErrorText:"This camera feed is currently unavailable.  Please try again later.",L_OverlayEntity_Coordinates:"Coordinates",L_OverlayEntity_Copy_Coordinates:"Copy",L_OverlayEntity_Copy_Succeeded:"Copied",L_OverlayEntity_ZoomOut:"Zoom out",L_OverlayEntity_Measure:"Measure distance",L_GeochainWorldText:"World",L_NavBarMapTypeSwitcherToolTip_Text:"Switch to {0}",L_NavBarTrafficToggleToolTip_TurnOn_Text:"Turn on traffic",L_NavBarTrafficToggleToolTip_TurnOff_Text:"Turn off traffic",L_DropDownMenuLabelToggleButtonDescription_Text_AerialOnly:"for Aerial",L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerial:"for Road and Aerial",L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerialBirdseye:"for Road, Aerial and Bird's eye",L_NavBarOpenRadialMenuToolTip_NoBirdseye_text:"View aerial and more...",L_RadialMenuLabelToggleToolTip_Text:"Turn labels on or off",L_RadialMenuLabelToggleDisabled_Text:"disabled",L_DraggableList_Keyboard_Drag_Start_Hint:"Press Enter to select the current row, then use up and down arrow keys to reorder. Press Enter again to deselect",L_DraggableList_Keyboard_Drag_Move_Hint:"Use the up and down arrow keys to reorder. Press Enter to deselect.",L_DraggableList_Keyboard_Drag_Top_Error_Hint:"You are in the top position",L_DraggableList_Keyboard_Drag_Bottom_Error_Hint:"You are in the bottom position",L_ZoomInButtonAriaLabel:"Current Level {0}, Zoom In ",L_ZoomOutButtonAriaLabel:"Current Level {0}, Zoom Out",L_ZoomButtonAriaLabelDisabled:"Disabled",L_CameraCloseAriaLabel:"Close Camera Popup",L_RadialMenuRoadDarkButtonToolTip_Text:"Dark road",L_RadialMenuRoadDarkButtonDescription_Text:"A darker-styled road map",L_RadialMenuGrayscaleButtonToolTip_Text:"Grayscale",L_RadialMenuGrayscaleButtonDescription_Text:"A grayscale map",L_RadialMenuCanvasDarkButtonToolTip_Text:"Canvas Dark",L_RadialMenuCanvasDarkButtonDescription_Text:"A dark style map",L_RadialMenuCanvasLightButtonToolTip_Text:"Canvas Light",L_RadialMenuCanvasLightButtonDescription_Text:"A light style map",L_GeochainTitle_Text:"Expand/Collapse Geochain",RadialMenuBirdseyeV2ButtonDescriptionText:"We have updated Bird's Eye. {0}",RadialMenuBirdseyeV2ButtonAlternateText:"Learn more",L_NavVarBirdseyeV2TipClose:"Close",L_CmtButtonTooltip:"commutability entrance",RadialMenuTitle:"Map style",L_TrafficRemoveAllRecentCamerasLink:"Remove all",L_TrafficRemoveRecentCameraToolTip_Text:"Remove Camera at {0}",MapsTimeSelect:"Select the time",CalendarEmptyDays:"These days are not valid for this month",CalendarNextMonth:"Go to {0}",TrafficCameraAriaLabel:"Show larger camera image of {0}",TrafficCameraName:"Traffic camera at {0}",TrafficCameraToggleButtonAriaLabel:"Show traffic camera toggle button",SpinBoxHoursLabel:"Hours",SpinBoxMinutesLabel:"Minutes",SpinBoxAmPmLabel:"a.m. or p.m.",L_BaseListMapMobile_Toggle_List:"List",L_BaseListMapMobile_Toggle_Map:"Map",L_MyPlacesButton_Label:"My Places",ClickToSelect:"Check to select",ClickToUnselect:"Uncheck to deselect",L_Search_This_Area_Label:"Search in this area",LandmarkDealsMore_Text:" + {0} more",SearchBoxSearchGhostText:"Search Bing Maps"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("MapDelay",n):window.$MicrosoftMaps8.ResourcesObject=n})();var i=window.$MicrosoftMaps8,u=i.Internal,hi=u._Binding,nr=u._BoundsAccumulator,k=u.CanvasDrawingContext,n=u.ControlTemplate,e=u._Debug,tr=u._Dispatcher,ci=u._GeometryGeneralizer,r=u._Gimme,f=u._Helper,h=u._JSEvent,li=u._LruCache,g=u._ObjectWithId,s=u._Observable,ai=u._ObservableCollection,nt=u._ObservableObject,it=i.ResourceManager.MapDelay,rt=u._Url,ir=u._VectorMath,v=i.Anchor,rr=i.LocationRect,l=i.ResourceManager.MapDelay,c=i.Rectangle,ur=i.PixelCrs,a=i.Point,vi=i.Size,yi=i.SimplePointPrimitive,fr=i.ZoomLevel,p=i.GlobalConfig,ut='<div id="{Binding primitive.entity.id}" class="infoboxOverlay">    <div class="infoboxTitle">        <TextBlock Text="{Binding primitive.entity.title}" />    <\/div>    <div class="infoboxDescription">        <TextBlock Text="{Binding primitive.entity.description}"/>    <\/div>    <div class="infoboxActions">        <ul class="infoboxActionList">            <ItemsControl ItemsSource="{Binding primitive.entity.actions}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <a href="#" title="{Binding text}" class="{Binding cssClass}" event:click="handler" data-task="{Binding taskData}" />                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/ul>    <\/div><\/div>',d='<div>    <div class="lc_bkl b_lBottom">        <div class="mccall">            <input type="date" value="{TemplateBinding mobileDate Mode=TwoWay}" event:change="onSetDate" class="dateTimeValue" />            <div class="mccali">                <div class="clock"><\/div>            <\/div>        <\/div>    <\/div>    <div class="lc_bkl b_lBottom">        <div class="mccall">            <input type="time" value="{TemplateBinding mobileTime Mode=TwoWay}" event:change="onSetTime" class="dateTimeValue" />            <div class="mccali">                <div class="clock"><\/div>            <\/div>        <\/div>    <\/div><\/div>',pi='<div class="spinBox bm_disable_highlighting" data-tag="spinBox">    <div class="cell" event:click="onCellClick"><TextBlock Text="{TemplateBinding index Converter=indexToValue}" /><\/div>    <div class="column" tabindex="0" role="list" aria-activedescendant="{TemplateBinding activeId}" style:display="{TemplateBinding open Converter=boolToDisplay}" event:click="onColumnClick" event:mouseover="onMouseOver" event:mousewheel="onMouseWheel" event:contextmenu="onContextMenu" event:keydown="onColumnKeyDown" event:keyup="endScroll">        <div class="spinBoxUpArrow" event:mousedown="onUpArrow" event:mouseup="endScroll" event:mouseout="endScroll" event:touchend="endScroll"><\/div>        <div class="scrollContainer">            <div class="selectedBg"><\/div>            <ItemsControl ItemsSource="{TemplateBinding itemsSource}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li data-value="{Binding value}" id="{Binding itemId}" role="listitem" event:click="onItemClick" event:keydown="onColumnKeyDown" event:keyup="endScroll"><TextBlock Text="{Binding text}" /><\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>        <div class="spinBoxDownArrow" event:mousedown="onDownArrow" event:mouseup="endScroll" event:mouseout="endScroll" event:touchend="endScroll"><\/div>    <\/div><\/div>',d='<div class="{TemplateBinding open Converter=openToClass}" data-tag="timeControl">    <SpinBox ItemsSource="{TemplateBinding col0Source}" Open="{TemplateBinding open}" Index="{TemplateBinding col0Index Mode=TwoWay}" event:openEvent="onOpen" TaskId="{TemplateBinding taskId}" />    <SpinBox ItemsSource="{TemplateBinding col1Source}" Open="{TemplateBinding open}" Index="{TemplateBinding col1Index Mode=TwoWay}" event:openEvent="onOpen" TaskId="{TemplateBinding taskId}" />    <SpinBox ItemsSource="{TemplateBinding col2Source}" Open="{TemplateBinding open}" Index="{TemplateBinding col2Index Mode=TwoWay}" event:openEvent="onOpen" TaskId="{TemplateBinding taskId}" />    <a href="#" class="dropdown" event:click="onDropdown" role="button" aria-label="{TemplateBinding ariaLabel}" aria-expanded="{TemplateBinding open}" event:mouseover="onHover"><\/a>    <div style="clear:both"><\/div><\/div>',t=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ft=function(){function n(t,i,r){this._staticResources=i;this._controlFactory=r;this._disposables=[];this._parsed=typeof t=="string"?n._parseTemplate(t):t}return n.prototype.applyControlTemplate=function(n,t){return this._controlArgs=t,this._applyTemplate(this._parsed,n,null)},n.prototype.applyDataTemplate=function(n){return this._applyTemplate(this._parsed,{dataContext:n},null)},n.prototype.dispose=function(){f._clearDisposables(this._disposables);this._disposables=[]},n.prototype._applyTemplate=function(n,t,i){if(n.tagName)return this._applyTag(n,t,i);if(n instanceof Array)return this._applyArray(n,t,i);if(typeof n=="string")i&&i.appendText?i.appendText(n):i.append(n);else if(n&&n.extensionTag)switch(n.extensionTag){case"Binding":case"TemplateBinding":return this._applyBinding(n,t,i);case"StaticBinding":return this._applyBinding(n,this._staticResources,i);default:throw new Error("Unsupported extension tag: "+n.extensionTag);}else throw new Error("Unsupported template");},n.prototype._createPseudoParent=function(n,t){return{append:function(i){return s.setValue(n,t,i),this},obj:n,property:t}},n.prototype._applyBinding=function(n,t,i){var c=this,l=i.obj,a=i.property,f=n.namedParams||{},o=n.args||{},r=n.extensionTag==="Binding"?"dataContext":"",s,u,h,e;return o[0]&&(r.length&&(r+="."),r+=o[0]),s=f.Mode||"OneWay",u=null,f.Converter&&(u=this._staticResources[f.Converter]),h=function(n){return u?u.call(c._staticResources,n):n},e=new hi(t,r,l,a,h,s),this._disposables.push(e),e},n.prototype._applyTag=function(t,i,r){function k(t,i){if(i){i.dispose&&t.push(i);var r=i[n._controlDisposableProperty];r&&r.length&&Array.prototype.push.apply(t,r)}}var h=t.tagName,b,a,p,u,w,c,l,f,v,e,o,s,y,d;switch(h){case"ItemsPresenter":return this._applyItemsPresenter(t,i,r,"itemsSource","itemTemplate"),null;case"ContentPresenter":return b=t.attr.content||"content",this._applyItemsPresenter(t,i,r,b,"contentTemplate"),null;case"PopOutPresenter":return this._applyItemsPresenter(t,i,r,"popOutContent","popOutTemplate"),null;case"TabbedPresenter":return this._applyItemsPresenter(t,i,r,"tabContent","tabTemplate"),null;case"DataTemplate":case"ControlTemplate":return a=new n(t.content[0],this._staticResources,this._controlFactory),this._disposables.push(a),r&&r.append&&r.append(a),a}if(p=h.split("."),p.length===2){if(t.content.length!==1)throw new Error("Node property expression must have exactly 1 child");return this._applyTemplate(t.content[0],i,this._createPseudoParent(r,p[1]))}if(u=this._controlFactory(h,this._controlArgs),!u)throw new Error("Unable to create "+h);if(w=u,w.dispose&&this._disposables.push(w),l=t.attr,f=[],l)for(c in l)if(l.hasOwnProperty(c)){if(v=l[c],e=c.split(":"),e.length===1)o=this._applyTemplate(v,i,this._createPseudoParent(u,c));else if(e.length===2)switch(e[0]){case"event":o=this._addHandler(u,e[1],v,i.dataContext);break;case"style":o=this._applyTemplate(v,i,this._createPseudoParent(u[0].style,e[1]))}o&&o.dispose&&f.push(o)}if(r&&r.append(u),t.content)if(h==="style"&&u[0].styleSheet)u[0].styleSheet.cssText=t.content;else if(s=this._applyTemplate(t.content,i,u),s)if(s instanceof Array)for(y=0,d=s.length;y<d;y++)k(f,s[y]);else k(f,s);return f.length&&(u[n._controlDisposableProperty]=f),u},n.prototype._addHandler=function(n,t,i,r){var c=this,e=r&&s.getValue(r,i),o=this._staticResources&&this._staticResources[i],f,u;if(e)u=function(n){return e.call(r,n)};else if(o)u=function(n){return o.call(c._staticResources,n)};else return null;return n[t]instanceof h?f=n[t].add(u):(n.add_event(t,u),f={dispose:function(){n.remove_event(t,u)}}),this._disposables.push(f),f},n.prototype._applyItemsPresenter=function(t,i,r,u,e){function b(){var n=s.getValue(i,u),t=s.getValue(i,e),r=s.getValue(i,"itemContainerGenerator");(n!==h||t!==a||r!==c)&&(l&&l.dispose(),h=n,a=t,c=r,h&&(k(),l=h.changed&&h.changed.add(k),p._disposables.push(l)))}function k(t){var i,e,u,r,s,c;if(t=t||{reset:!0},t.reset||t.removed){if(o=v.nextSibling,t.removed)for(i=t.removedIndex;i--;)o=o&&o.nextSibling;for(i=0;o&&o!==w&&(!t.removed||i<t.removed.length);)e=o.nextSibling,o.dispose&&o.dispose(),f._clearDisposables(o[n._controlDisposableProperty]),o.parentNode.removeChild(o),o=e,i++}if(t.reset||t.added){if(o=v.nextSibling,t.added)for(i=t.addedIndex;i--;)o=o.nextSibling;if(u=o,r=t.added||h,typeof r=="string"||typeof r.nodeType=="number")y(r,u);else if(r instanceof Array||r instanceof ai)for(s=r.length,i=0;i<s;i++)c=r[i],y(c,u);else y(r,u)}}function y(t,i){var u=p._renderData(t,a),f=u,e=c&&c.generateNext(t);e&&e.append(u);var f=e||u,o=u[n._controlDisposableProperty],s=f[0]||f;s[n._controlDisposableProperty]=o;r.insertBefore(f,i)}var p=this,o,h,a,c,l,v=document.createTextNode(""),w=document.createTextNode("");r.append(v).append(w);b();this._disposables.push(i.changed.add(b))},n.prototype._applyArray=function(n,t,i){for(var u=[],r=0;r<n.length;r++)u.push(this._applyTemplate(n[r],t,i));return u},n.prototype._renderData=function(n,t){return t?t.applyDataTemplate(n):n&&typeof n.nodeType=="number"?n:document.createTextNode(n?n.toString():"")},n._parseTemplate=function(n){function c(n){var t=r[r.length-1];(typeof n!="string"||(n=n.replace(v,"").trim(),n.length!==0))&&(t?(t.content||(t.content=[]),t.content.push(n)):s=n)}function y(n){var r,h,u,t,o,s,f,i,e;if(!(r=/\{(\w+)(\s+([^\}]+))?\}/g.exec(n)))return n;if(h=r[1],u={extensionTag:h},r[2]){for(t=r[2],t=t.trim().split(" "),o=[],s={},f=0;f<t.length;f++)i=t[f],e=i.indexOf("="),e===-1?o.push(i):s[i.substring(0,e)]=i.substring(e+1);u.args=o;u.namedParams=s}return u}var f,o,h;n.charAt(0)==="#"&&(n=document.getElementById(n.substr(1)).text);for(var l=/<\/?(?:(\w+):)?([\w\.]+)(?:\s*(?:\w+\:)?[\w\-]+=(?:"[^"]*"|'[^']*')\s*)*\s*(\/?)>/g,a=/((?:\w+\:)?[\w\-]+)=(?:"([^"]*)"|'([^']*)')/g,v=/<!--[\s\S]*?-->/g,s=null,r=[],t,u,e=0,i;!!(t=l.exec(n));)if(t.index>e&&c(n.substring(e,t.index)),e=t.index+t[0].length,f=t[2],t[0].charAt(1)==="/"){if(i=r.pop(),i.tagName!==f)throw new Error("Unmatched ending tag: "+f);}else{for(o={};!!(u=a.exec(t[0]));)h=y(u[2]||u[3]||""),o[u[1]]=h;i={tagName:f,namespace:t[1],attr:o};c(i);t[3]!=="/"&&r.push(i)}return s},n._controlDisposableProperty="$ctrl_disp$",n}(),n=function(n){function i(t,r){return n.call(this,t,r,i.createControl)||this}return t(i,n),i.registerControl=function(n,t){i._controls[n]=t},i.createControl=function(n,t){var r=i._controls[n];return r?new r(t):f._createElement(n)},i._controls={},i._textPrototypeAdded=!1,i}(ft),wi=function(n){function r(t){var i=n.call(this)||this;return i._style=t,i}return t(r,n),r.prototype.getStyle=function(){return this._style},r.prototype.render=function(n,t,i,r,u){return this.renderGroup(n,[t],i,r,u)},r.prototype.renderGroup=function(n,t,r,u,f){var l=u?null:n.getRawContext(),a,v,y,ot=r.zoom,h,s,ft,et,c;u||n.setStyle(this._style,f);var p=[],st=r instanceof i.Viewport?r.getRectangle():null,tt=0,it=0;for(r.bounds[3]<r.crs.bounds[3]&&(tt=1),r.bounds[1]>r.crs.bounds[1]&&(it=1),h=0;h<t.length;h++){s=t[h];u||n.setPrimitive(s);v!==s.crs&&(v=s.crs,y=new b(v,r),a=y.getMatrix());var w=s.geometry,rt=s.geometryType,o=w.boundingBox,ut=o&&o.crossesInternationalDateLine(!0),k;if(!ut&&a&&(k=this._renderMatrixTransform(n,l,w,rt,a,u)),k)p=[k];else{e.logShapePrimitive(s);var d=0,g=0,nt=o&&o.originalBounds;for(ut&&nt&&isFinite(nt[1])&&isFinite(nt[3])&&(ft=Math.min(o.originalBounds[1],o.originalBounds[3]),et=Math.max(o.originalBounds[1],o.originalBounds[3]),g=Math.round(-ft/360),d=Math.round(-et/360)),d-=tt,g+=it,c=d;c<=g;c++)p.push(this._renderProjectionTransform(n,l,w,rt,y,ot,c,st,u))}}return this._matrixTransformed&&(u||l.restore(),this._matrixTransformed=null),u||n.flush(),p},r.prototype.getIsHitTestable=function(){return this._style.hitTest===1},r.prototype._renderMatrixTransform=function(n,t,i,r,u,f){function c(n,t,i,r){var f={points:[]},s=n.x,h=n.y,p=s.length,u,e,o;if(p>0){var c=h[0],l=s[0],v=h[0],y=s[0];for(u=0;u<p;u++)e=s[u],o=h[u],c=Math.min(c,o),l=Math.min(l,e),v=Math.max(v,o),y=Math.max(y,e),f.points.push(new a(e,o)),r||(u===0?i.moveTo(e,o):t.lineTo(e,o,s[u-1],h[u-1]));f.top=c;f.left=l;f.width=y-l;f.height=v-c}return f}var e=null,h,s,o;if(this._matrixTransformed!==u){if(this._matrixTransformed&&(f||t.restore(),this._matrixTransformed=null),r===2&&Math.abs(Math.abs(u[0]/u[3])-1)>.1)return e;f||(t.save(),t.lineWidth*=1/u[0],t.transform.apply(t,u.getValues()));this._matrixTransformed=u}e={shapes:[],type:r,style:this._style};switch(r){case 2:e.shapes.push(c(i,n,t,f));f||n.stroke();case 3:for(h=i,s=h.rings,o=0;o<s.length;o++)e.shapes.push(c(s[o],n,t,f)),f||t.closePath();f||(n.stroke(),n.fill())}return e},r.prototype._renderProjectionTransform=function(n,t,i,r,u,f,e,o,s){var c,h,v,y,a,l;this._matrixTransformed&&(s||t.restore(),this._matrixTransformed=null);c={shapes:[],type:r,style:this._style};switch(r){case 2:v=i;h={};this._renderProjection(n,t,v,r,u,f,e,o,s,h);h.points&&c.shapes.push(h);s||n.stroke();break;case 3:for(y=i,a=y.rings,l=0;l<a.length;l++)h={},this._renderProjection(n,t,a[l],r,u,f,e,o,s,h),h.points&&c.shapes.push(h),s||t.closePath();s||(n.stroke(),n.fill())}return c},r.prototype._renderProjection=function(n,t,i,r,u,e,o,s,h,l){var v,y,k,d,ct,lt,w;(!i.rawX||u.destinationCrs!==i.projectedCrs||i.projectedCrs&&i.projectedCrs.sceneMetadata)&&(i.rawX=[],i.rawY=[],i.projectedCrs=u.destinationCrs);var g=p.glPolyline&&r===2&&(!this._style.dashes||this._style.dashes.length===0)?null:ci.instance.getGeneralizations(i,e,u),b=[],ft=u.destinationCrs&&u.destinationCrs.sceneMetadata,at=f._getCoreConfig().be2PolygonFix&&r===3&&ft,et=at&&ft.getBoundsRectangle();u.calculateProjectedCoordinates(0,i,o,et);v=u.lastProjectedX;y=u.lastProjectedY;h||t.moveTo(v,y);b.push(new a(v,y));var ot=g?g.length:i.x.length,st,nt=y,tt=v,rt=y,ut=v,ht=r===3,it=!1;for(w=1;w<ot;w++)st=g?g[w]:w,u.calculateProjectedCoordinates(st,i,o,et),k=u.lastProjectedX,d=u.lastProjectedY,s?(ct=c.fromSides(v,k,y,d),ht||(s.intersects(ct)?(it=!0,h||n.lineTo(k,d,v,y)):h||t.moveTo(k,d))):h||n.lineTo(u.lastProjectedX,u.lastProjectedY,v,y),v=k,y=d,nt=Math.min(nt,y),tt=Math.min(tt,v),rt=Math.max(rt,y),ut=Math.max(ut,v),b.push(new a(v,y));if(s&&ht&&(lt=c.fromPoints.apply(c,b),it=s.intersects(lt),!h&&it))for(w=1;w<ot;w++)n.lineTo(b[w].x,b[w].y,b[w-1].x,b[w-1].y);s&&!it&&(b=null);l.points=b;l.top=nt;l.left=tt;l.width=ut-tt;l.height=rt-nt},r}(g),et=function(n){function i(t,i,r,u,e){var o=n.call(this)||this,s;return o._scale=i||1,o._anchor=r||new v(0,0,1),o._hitTestShape=1,t&&(t instanceof HTMLImageElement?o._image=t:(o._image=document.createElement("img"),o._image.src=t),o._checkTainted(),f._renderAllPoiAndLabelsGL()&&(s=t.src?t.src:t,s&&(o.id=f._getHash(s)+e))),o}return t(i,n),i.prototype.render=function(n,t,i,r,u,f){return this.renderGroup(n,[t],i,r,u,f)},i.prototype.renderGroup=function(n,t,i,r,u,f){var h=[],s,l;if(t&&this._image)for(s=0;s<t.length;s++){var e=t[s],c=e.geometry,o=new b(e.crs,i);o.project(c.x,c.y);l=r?this.renderData(n.getDevicePixelRatio(),e.entity,o.lastProjectedX,o.lastProjectedY,u,f,e):this.renderCanvas(n,e.entity,o.lastProjectedX,o.lastProjectedY,u,f,e);h.push(l)}return h},i.prototype.getBounds=function(){var n=this._getMetrics(),t=n.anchorX,i=n.anchorY,r=n.scaleX,u=n.scaleY;return c.fromSides(-(r*t),r*(n.width-t),-(u*i),u*(n.height-i))},i.prototype.getIsHitTestable=function(){return!0},i.prototype.getHitTestShape=function(){return this._hitTestShape},i.prototype.setHitTestShape=function(n){this._hitTestShape=n},i.prototype._prepareBitmapData=function(n,t,r,u,f,e,o){var y,c,l;f===void 0&&(f=1);var b=r,k=u,h=this._anchor,a=this._image,v=this._image.getAttribute(i.shadowStyleAttribute);v&&(v=JSON.parse(v));o&&(y=s.getValue(o,"imageSize"));y?(c=y.width||0,l=y.height||0):(c=a.naturalWidth||a.width,l=a.naturalHeight||a.height);f=f*this._scale;h.units===0?(r-=f*h.x*c,u-=f*h.y*l):(r-=f*h.x,u-=f*h.y);f=(window.devicePixelRatio||1)*f;var p=Math.round(r),w=Math.round(u),d=c*f,g=l*f;return{resultImages:[{drawX:p,drawY:w,width:d,height:g,source:this._image,shadow:v,anchorAdjustX:p+c/2-b,anchorAdjustY:w+l/2-k}]}},i.prototype.renderData=function(n,t,i,r,u,f,e){return this._prepareBitmapData(n,t,i,r,u,f,e)},i.prototype.renderCanvas=function(n,t,i,r,u,f,e){var s,o,h;return u===void 0&&(u=1),s=this._prepareBitmapData(n.getDevicePixelRatio(),t,i,r,u,f,e),s&&s.resultImages.length>0&&(o=s.resultImages[0],o.shadow&&o.shadow.shadowColor&&(h=n.getStyle(),n.setStyle(o.shadow)),n.drawImage(o.source,o.drawX,o.drawY,o.width,o.height),h&&n.setStyle(h)),s},i.prototype.getScale=function(){return this._scale},i.prototype._getMetrics=function(){var n=this._scale,t=this._image.naturalWidth||this._image.width,i=this._image.naturalHeight||this._image.height,r=this._anchor.x,u=this._anchor.y;return this._anchor.units===0&&(r*=t,u*=i),{anchorX:r,anchorY:u,scaleX:n,scaleY:n,width:t,height:i}},i.prototype._checkTainted=function(){var n=!1,t,u,i;if(f._renderAllPoiAndLabelsGL())if(t=this._image.src,r.Browser.is_ie&&t.indexOf("data:image/svg+xml;")===0)n=!0;else if(t.indexOf("http")===0&&rt.fromString(t).protocolAndDomain()!==rt.fromString(window.location.origin).protocolAndDomain())if(this._image.crossOrigin){u=document.createElement("canvas");i=u.getContext("2d");try{i.drawImage(this._image,0,0,1,1);i.getImageData(0,0,1,1);n=!1}catch(e){n=!0}}else n=!0;this.tainted=n},i.shadowStyleAttribute="data-shadow",i}(g),bi=function(){function n(n){var t=this;this._map=n;this._map.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(t._resetTemplateSelector=!0)})}return n.prototype.selectorReady=function(){var n=this;return!this._baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._resetTemplateSelector=!1,n._baseMapTemplateSelector.selectorReady()}):this._baseMapTemplateSelector.selectorReady()},n.prototype.getMarkupStyle=function(n,t,i){var r,u;return n&&this._baseMapTemplateSelector&&(u=this._getPoiState(n),!i&&n.entity&&typeof n.entity.poiType=="number"&&(i=n.entity.poiType),i||(i=1),r=this._baseMapTemplateSelector.getMarkupStyle(n,t,u,i)),r},n.prototype._getPoiState=function(n){var i=n.viewState,t=2;return i===1?t=3:i===2&&(t=4),t},n.prototype.getTemplates=function(n,t,i){i===void 0&&(i=1);var r=null;return n&&this._baseMapTemplateSelector&&n.geometryType===1&&(n.entity&&typeof n.entity.poiType!="undefined"&&(i=n.entity.poiType),r=this._baseMapTemplateSelector.getLandmarkVectorImageTemplate(n,this._getPoiState(n),t,i)),r},n}(),tt=function(n){function i(t,r,u){var f=n.call(this)||this,h,o,v,e,s;f._image=t;f._hitTestShape=1;typeof r!="number"&&(r=1);f._scale=r;f._anchor=u;f._cachedTextScale={};h=typeof p!="undefined"&&p.features.labels||{};f._container=h.renderVectorImageOnDOM?document.body:null;f._iconTextYAdjust=h.iconTextYAdjust;var l=[],c=[],a=t.records||[];for(o=0,v=a.length;o<v;o++)e=a[o],e.scale=isFinite(e.scale)?e.scale:1,e.vectorType===3?(s=e,c.push(s),s.text===i.placeholderText&&(f.hasPlaceholderText=!0,f._templateTextRecord=s)):l.push(e);return f._vectorRecords=l,f._textRecords=c,f.hasText=!!c.length,f.shadowStyle={},f}return t(i,n),i.getDefaultFontFamily=function(n){var t=p.features.labels,r=n.toLowerCase();return r==="segoebing"?t.useSegoeFontStack?n.concat(", "+i._segoeFontStack):i._reducedFontStack:r==="segoe ui"?t.useSegoeFontStack?i._segoeFontStack:i._reducedFontStack:n},i.prototype.getVectorImage=function(){return this._image},i.prototype.getScale=function(){return this._scale},i.prototype.getAnchor=function(){return this._anchor},i.prototype.setScale=function(n){this._scale=n===0?0:n||1},i.prototype.render=function(n,t,i,r,u,f){return this.renderGroup(n,[t],i,r,u,f)},i.prototype.renderGroup=function(n,t,i,r,u,f){var c=[],s,o,l,h,a,v;if(t)for(s=0;s<t.length;s++)o=t[s],o&&(l=o.geometry,h=new b(o.crs,i),h.project(l.x,l.y),a=h.lastProjectedX,v=h.lastProjectedY,e.logPoiLayerStyleStart(),r?c.push(this.renderData(n.getDevicePixelRatio(),o.entity,a,v,u,f,o)):c.push(this.renderCanvas(n,o.entity,a,v,u,f,o)),e.logPoiLayerStyleEnd(f),e.logPushpinPrimitive(f,o));return c},i.prototype._getTextScale=function(n){var t=this._templateTextRecord,u=this._cachedTextScale,f=1,e,r,h,c;if(n=n||"",e=n.length||0,r=u[n],r)return r;if(e>1&&t&&t.maxWidth>0&&t.style.horizontalAutoScaling===1){var o=i._scratchContext,s=this._bounds.getSize().width,l=s-t.maxWidth;typeof t.style.fontStyleString!="string"&&i._processFontStyle(t);o.setFont(t.style.fontStyleString+t.style.fontSize+"pt "+i.getDefaultFontFamily(t.style.font));h=o.getRawContext().measureText(n).width;c=l+h;f=Math.max(1,c/s)}return r=new vi(f,1),u[n]=r,r},i.prototype.getBounds=function(n){var t=this._getMetrics(n),r=t.anchorX,u=t.anchorY,f=t.scaleX,e=t.scaleY,i=this._bounds;return c.fromSides(f*(i.minPoint.x-r),f*(i.maxPoint.x-r),e*(i.minPoint.y-u),e*(i.maxPoint.y-u))},i.prototype._getMetrics=function(n){this._parseRecords();var t=this._bounds,u=t.getSize(),f=u.width,e=u.height,o=this.hasText&&this._getTextScale(n)||{width:1,height:1},s=o.width*this._scale,h=o.height*this._scale,i=this._anchor.x,r=this._anchor.y;return this._anchor.units===0&&(i=i*f+t.minPoint.x,r=r*e+t.minPoint.y),{anchorX:i,anchorY:r,scaleX:s,scaleY:h,width:f,height:e}},i.prototype.getIsHitTestable=function(){return this._image.hitTest===1},i.prototype.getHitTestShape=function(){var n=this._hitTestShape;return this.getIsHitTestable()||(n=0),n},i.prototype.setHitTestShape=function(n){this._hitTestShape=n},i.prototype._parseRecords=function(){var n=this._bounds,t=this._image,r,i,u;if(!n){for(n=c.empty(),r=t.records||[],i=0,u=r.length;i<u;i++)n.union(this._parseRecord(r[i]));this._bounds=n}this._anchor||(n.isEmpty()||(typeof t.hotspotX!="number"&&(t.hotspotX=(n.minPoint.x+n.maxPoint.x)/2),typeof t.hotspotY!="number"&&(t.hotspotY=(n.minPoint.y+n.maxPoint.y)/2)),this._anchor=new v(t.hotspotX,t.hotspotY))},i.prototype._parseRecord=function(n){var s,t,u,f,r,e,o;if(!n)return c.empty();s=n.vectorType||0;switch(s){case 2:t=n;n.bounds=c.fromPoints({x:t.centerX-t.radiusX,y:t.centerY-t.radiusY},{x:t.centerX+t.radiusX,y:t.centerY+t.radiusY});break;case 4:i._parsePathGeometry(n);break;case 0:case 1:n.bounds=c.fromPoints.apply(this,n.pointsList);break;case 3:u=n;u.leftTop&&u.rightBottom&&(n.bounds=c.fromPoints(u.leftTop,u.rightBottom))}return f=n.bounds,r=n.scale,f&&r!==1&&(e=f.minPoint,o=f.maxPoint,e.x*=r,e.y*=r,o.x*=r,o.y*=r),n.bounds||c.empty()},i.prototype._prepareVectorData=function(n,t,r,u,o,h,c){var v;o===void 0&&(o=1);var tt,it=this._image,d=[],et=r,ot=u;if(r=Math.round(r),u=Math.round(u),it.records&&it.records.length>0){this._parseRecords();var st=t&&(s.getValue(t,"name")||s.getValue(t,"iconText")),w=this._getMetrics(st),l=w.scaleX*o,a=w.scaleY*o;(l!==this._cachedScaleX||a!==this._cachedScaleY||n!==this._cachedImageDPR)&&(this._cachedVectorImage=this._cacheRecords(this._vectorRecords,null,l,a),this._cachedImageDPR=n,this._cachedScaleX=l,this._cachedScaleY=a,this._cachedText=[],this._cachedTextImage=null);v=this._getTextValues(t);v.length&&!f._areArraysEqual(this._cachedText,v)&&(this._cachedTextImage=this._cacheRecords(this._textRecords,v,l,a),this._cachedText=v);var ht=w.anchorX*l,ct=w.anchorY*a,y=r-ht,p=u-ct;y=isNaN(y)?0:y;p=isNaN(p)?0:p;tt={deltaX:y,deltaY:p,scaleX:l,scaleY:a,renderingResult:{resultImages:d}};var rt=i._cachedImageBuffer,b=this._cachedVectorImage.width/i._cachedImageOversample,k=this._cachedVectorImage.height/i._cachedImageOversample,g=Math.round(y+l*this._bounds.minPoint.x-rt/2),nt=Math.round(p+a*this._bounds.minPoint.y-rt/2),ut=g+b/2/n-et,ft=nt+k/2/n-ot;d.push({source:this._cachedVectorImage,width:b,height:k,drawX:g,drawY:nt,anchorAdjustX:ut,anchorAdjustY:ft,shadow:this.shadowStyle});this._cachedTextImage&&(b=this._cachedTextImage.width/i._cachedImageOversample,k=this._cachedTextImage.height/i._cachedImageOversample,d.push({source:this._cachedTextImage,width:b,height:k,drawX:g,drawY:nt,anchorAdjustX:ut,anchorAdjustY:ft}))}return h&&c&&e.getFunctionalTestHooksEnabled()&&this._vectorRecords.length&&e.logVectorImageTemplate(this._vectorRecords,this._textRecords),tt},i.prototype.renderData=function(n,t,i,r,u,f,e){var o=this._prepareVectorData(n,t,i,r,u,f,e);return o?o.renderingResult:null},i.prototype.renderCanvas=function(n,t,i,r,u,f,e){var o,s,c,h;return u===void 0&&(u=1),o=this._prepareVectorData(n.getDevicePixelRatio(),t,i,r,u,f,e),o&&(n.hasPrimitives()?this._renderRecord(n,null,this._vectorRecords[0],o.deltaX,o.deltaY,o.scaleX,o.scaleY):(s=o.renderingResult.resultImages[0],s.shadow&&s.shadow.shadowColor&&(c=n.getStyle(),n.setStyle(s.shadow)),n.drawImage(s.source,s.drawX,s.drawY,s.width,s.height),c&&n.setStyle(c),h=o.renderingResult.resultImages[1],h&&n.drawImage(h.source,h.drawX,h.drawY,h.width,h.height))),o?o.renderingResult:null},i.prototype.renderIcon=function(n){var i=new k,t=this._getMetrics(n&&this.hasText?s.getValue(n,"name"):""),r=this._bounds.minPoint;return i.setSize(Math.ceil(t.scaleX*t.width),Math.ceil(t.scaleY*t.height)),this.renderCanvas(i,n,t.scaleX*(t.anchorX-r.x),t.scaleY*(t.anchorY-r.y)),i.getRootElement()},i.prototype._cacheRecords=function(n,t,r,u){var y=this._bounds.getSize(),c=i._cachedImageOversample,l=r*c,a=u*c,s=i._cachedImageBuffer*c,w=Math.ceil(l*y.width)+s,b=Math.ceil(a*y.height)+s,h=new k,v=h.getRootElement(),f,e,o,p;for(h.setSize(w,b),this._container&&(v.set_style({display:"none",outline:"none",position:"absolute",left:"-1000px",top:"-1000px"}),this._container.appendChild(v[0])),f=-l*this._bounds.minPoint.x,e=-a*this._bounds.minPoint.y,f=Math.round((isNaN(f)?0:f)+s/2),e=Math.round((isNaN(e)?0:e)+s/2),o=0,p=n.length;o<p;o++)this._renderRecord(h,t&&t[o],n[o],f,e,l,a);return this._container&&this._container.removeChild(v[0]),h.getRootElement()[0]},i.prototype._getTextValues=function(n){for(var u,r=[],t=0,f=this._textRecords.length;t<f;t++)u=this._textRecords[t],r.push(i._getText(u,i.placeholderText,n,["iconText","name"]));return r},i.prototype._renderRecord=function(n,t,i,r,u,f,e){if(i){var o=i.vectorType||0;i.style&&n.setStyle(i.style,e);switch(o){case 0:case 1:this._renderPolyRecord(n,i,r,u,f,e);break;case 2:this._renderEllipseRecord(n,i,r,u,f,e);break;case 4:this._renderPathRecord(n,i,r,u,f,e);break;case 3:this._renderTextRecord(n,i,t,r,u,f,e)}n.flush()}},i._getFontWeight=function(n){var t="";return(n&16)!=0?t="600":(n&1)!=0?t="bold":(n&32)!=0&&(t="300"),t},i._getFontStyle=function(n){var t="";return(n&2)!=0&&(t="italic"),t},i._processFontStyle=function(n){var r=n.style.fontStyle,t=i._getFontWeight(r)+" "+i._getFontStyle(r);t=t.trim();t&&(t+=" ");n.style.fontStyleString=t},i.prototype._renderTextRecord=function(n,t,r,u,f,e,o){var y=n.getRawContext(),c=t.anchor||{x:0,y:0},l,a,s,h,v;e*=t.scale;o*=t.scale;l=u+c.x*e;a=f+c.y*o;typeof t.style.fontStyleString!="string"&&i._processFontStyle(t);s=t.style.fontStyleString+t.style.fontSize*o+"pt "+i.getDefaultFontFamily(t.style.font);h=0;this._iconTextYAdjust&&(v=k.getLineHeight(s),h=v*this._iconTextYAdjust);n.setFont(s);y.fillText(r,l,a+h)},i.prototype._renderPathRecord=function(n,t,i,r,u,f){t.render&&(t.render(n,i,r,u*t.scale,f*t.scale),t.style.strokeStyle&&n.stroke(),t.style.fillStyle&&n.fill())},i.prototype._renderPolyRecord=function(n,t,i,r,u,f){e.assertNotNull(n,"drawingContext");e.assertNotNull(t,"polyRecord");var o=n.getRawContext();this._renderLines(o,t.pointsList,i,r,u*t.scale,f*t.scale);t.vectorType===0&&o.closePath();t.style.fillStyle&&n.fill();t.style.strokeStyle&&n.stroke()},i.prototype._renderEllipseRecord=function(n,t,i,r,u,f){e.assertNotNull(n,"drawingContext");e.assertNotNull(t,"ellipseRecord");u*=t.scale;f*=t.scale;n.drawEllipse(t.centerX*u+i,t.centerY*f+r,t.radiusX*u,t.radiusY*f);t.style.fillStyle&&n.fill();t.style.strokeStyle&&n.stroke()},i._getText=function(n,t,i,r){var e=n.text,u,f,o;if(e===t&&i){for(u=null,f=0,o=r.length;f<o;f++)if(u=s.getValue(i,r[f]),u)break;e=u||""}return e},i.prototype._renderLines=function(n,t,i,r,u,f){var e,o,s;if(n&&t&&t.length)for(e=t[0],n.moveTo(e.x*u+i,e.y*f+r),o=1,s=t.length;o<s;o++)e=t[o],n.lineTo(e.x*u+i,e.y*f+r);else throw new Error("raw context is null or points array is invalid");},i._parsePathGeometry=function(n){function p(n,t){rt=at(rt,n);ft=at(ft,t);ht=vt(ht,n);ct=vt(ct,t)}var ot=n&&n.pathData,h,r,et,nt,s,e,o;if(!ot)throw new Error("Invalid path geometry string");h=[];h.push("var rawContext = drawingContext.getRawContext();");for(var st=!1,g=0,tt=0,w=0,it=0,l=0,lt=0,ut="",t=[],b=!1,u=0,f=0,k=0,d=0,v=0,y=0,at=Math.min,vt=Math.max,rt=Number.MAX_VALUE,ft=rt,ht=-rt,ct=-ft;!st;){r=g<ot.length?ot.charAt(g):null;et=!1;switch(tt){case 0:if(r)if(r>="0"&&r<="9"||r==="."||r==="-"){if(it===0||it===2)throw new Error("Encountered value with no valid command");w=it;l=lt}else if(r>="a"&&r<="z"||r>="A"&&r<="Z"){if(lt=l,r>="a"&&r<="z"?(l=2,r=r.toUpperCase()):l=1,it=w,w=i._pathCommands[r],!w){w=it;throw new Error("Unknown command");}w===2?h.push("rawContext.closePath();"):(tt=1,t=[]);g++}else g++;else st=!0;break;case 1:r?r>="a"&&r<="z"||r>="A"&&r<="Z"?(tt=0,et=!0):r>="0"&&r<="9"||r==="."||r==="-"?(ut="",tt=2):g++:(st=!0,et=!0);break;case 2:r&&(r>="0"&&r<="9"||r==="."||r==="-"&&ut.length===0)?(ut+=r,g++):(t.push(parseFloat(ut)),tt=1);break;default:throw new Error("Invalid state in parsing path geometry");}if(et){s=t.length;switch(w){case 1:if(s===0||(s&1)!=0)throw new Error("Invalid number of parameters for MoveTo command");switch(l){case 1:u=t[s-2];f=t[s-1];break;case 2:u+=t[s-2];f+=t[s-1];break;default:throw new Error("Unknown command type");}p(u,f);h.push("rawContext.moveTo("+u+" * scaleX + deltaX, "+f+" * scaleY + deltaY);");b=!1;break;case 3:if(s===0||(s&1)!=0)throw new Error("Invalid number of parameters for LineTo command");for(nt=s/2,e=0;e<nt;e++){switch(l){case 1:u=t[e*2];f=t[e*2+1];break;case 2:u+=t[e*2];f+=t[e*2+1];break;default:throw new Error("Unknown command type");}p(u,f);h.push("rawContext.lineTo("+u+" * scaleX + deltaX, "+f+" * scaleY + deltaY);");b=!1}break;case 4:if(s===0)throw new Error("Invalid number of parameters for HorizontalLineTo command");for(e=0;e<s;e++){switch(l){case 1:u=t[e];break;case 2:u+=t[e];break;default:throw new Error("Unknown command type");}p(u,f);h.push("rawContext.lineTo("+u+" * scaleX + deltaX, "+f+" * scaleY + deltaY);");b=!1}break;case 5:if(s===0)throw new Error("Invalid number of parameters for VerticalLineTo command");for(e=0;e<s;e++){switch(l){case 1:f=t[e];break;case 2:f+=t[e];break;default:throw new Error("Unknown command type");}p(u,f);h.push("rawContext.lineTo("+u+" * scaleX + deltaX, "+f+" * scaleY + deltaY);");b=!1}break;case 6:if(s===0||s%6!=0)throw new Error("Invalid number of parameters for CurveTo command");for(nt=s/6,e=0;e<nt;e++){o=e*6;switch(l){case 1:k=t[o];d=t[o+1];v=t[o+2];y=t[o+3];u=t[o+4];f=t[o+5];break;case 2:k=u+t[o];d=f+t[o+1];v=u+t[o+2];y=f+t[o+3];u+=t[o+4];f+=t[o+5];break;default:throw new Error("Unknown command type");}p(k,d);p(v,y);p(u,f);h.push("rawContext.bezierCurveTo("+k+" * scaleX + deltaX, "+d+" * scaleY + deltaY, "+v+" * scaleX + deltaX, "+y+" * scaleY + deltaY, "+u+" * scaleX + deltaX, "+f+" * scaleY + deltaY);");b=!0}break;case 7:if(s===0||s%4!=0)throw new Error("Invalid number of parameters for SmartCurveTo command");for(b||(v=u,y=f),nt=s/4,e=0;e<nt;e++){k=u*2-v;d=f*2-y;o=e*4;switch(l){case 1:v=t[o];y=t[o+1];u=t[o+2];f=t[o+3];break;case 2:v=u+t[o];y=f+t[o+1];u+=t[o+2];f+=t[o+3];break;default:throw new Error("Unknown command type");}p(k,d);p(v,y);p(u,f);h.push("rawContext.bezierCurveTo("+k+" * scaleX + deltaX, "+d+" * scaleY + deltaY, "+v+" * scaleX + deltaX, "+y+" * scaleY + deltaY, "+u+" * scaleX + deltaX, "+f+" * scaleY + deltaY);");b=!0}break;case 2:throw new Error("Internal error in handling of Close command");default:throw new Error("Invalid command");}}}n.render=new Function("drawingContext","deltaX","deltaY","scaleX","scaleY",h.join("\n"));n.bounds=new c(new a(rt,ft),new a(ht,ct))},i._reducedFontStack='Frutiger, "Frutiger Linotype", "Dejavu Sans", "Helvetica Neue", Arial, sans-serif',i._segoeFontStack='"Segoe UI", '+i._reducedFontStack,i.placeholderText="{MapDisplay}",i._cachedImageBuffer=4,i._cachedImageOversample=1,i._scratchContext=new k,i._pathCommands={M:1,Z:2,L:3,H:4,V:5,C:6,S:7,Q:8,T:9,A:10},i.defaultFont="SegoeBing",i}(g),ki=function(n){function i(t,i,r,u,f,e,o){var s=n.call(this,i,e,o)||this;return s._parent=t,s._hAlign=r,s._vAlign=u,s._offset=f||{x:0,y:0},s.setHitTestShape(0),s}return t(i,n),i.prototype._getMetrics=function(t){var r=n.prototype._getMetrics.call(this,t),i=this._parent.getBounds(t),u,f;switch(this._hAlign){case 1:u=i.minPoint.x;break;case 2:u=i.maxPoint.x;break;default:u=(i.minPoint.x+i.maxPoint.x)/2}switch(this._vAlign){case 0:f=i.minPoint.y;break;case 2:f=i.maxPoint.y;break;default:f=(i.minPoint.y+i.maxPoint.y)/2}return r.anchorX-=(u+this._offset.x)/r.scaleX,r.anchorY-=(f+this._offset.y)/r.scaleY,r},i}(tt),di=function(){function t(){}return t.getDefaultOverlayTemplate=function(){return t._defaultOverlayTemplate||(t._defaultOverlayTemplate=new n(ut)),t._defaultOverlayTemplate},t}(),o=function(i){function u(n,t){var r=i.call(this,n)||this;return n=n||r,r.disposables=[],r._controlArgs=t||{},r.disposables.push(r.rendered=new h),n.defineProperty("template",function(n,t){return r._onTemplateChanged(n,t)},u._templateConverter),r}return t(u,i),u.prototype._render=function(){var n=null,t=null,i;this._root&&(n=this._root.getParent(),t=this._root.get_sibling(1),this._root.removeFromParent());i=this.getTemplate();this._root=i?i.applyControlTemplate(this,this._controlArgs):r(document.createElement("div"));n&&n.length&&(t&&t.length?n.insertBefore(this._root,t):n.append(this._root));this.rendered.invoke()},u.prototype._onTemplateChanged=function(n){n&&n.dispose();this._root&&this._root.getParent()&&this._render()},u._templateConverter=function(t){return typeof t=="string"&&(t=new n(t)),t},u.prototype.boolToDisplay=function(n){return n?"":"none"},u.prototype.boolToVisibility=function(n){return n?"":"hidden"},u.prototype.appendTo=function(n){n.append(this.getRootElement())},u.prototype.getRootElement=function(){return this._root||this._render(),this._root},u.prototype.dispose=function(){var t,n;this.getTemplate&&(t=this.getTemplate(),t&&t.dispose());i.prototype.dispose.call(this);n=this._root;n&&n.removeFromParent&&n.removeFromParent();this._root=null;f._clearDisposables(this.disposables);f._nullifyClass(this)},u.prototype.setVisible=function(n){this.getRootElement().set_style({display:this.boolToDisplay(n)})},u.prototype.isTabbable=function(n){var i=n.nodeName.toLowerCase(),r=_w.getComputedStyle(n),t;return r.display==="none"||r.visibility==="hidden"?!1:/input|select|textarea|button|object/.test(i)?!n.disabled:(t=parseInt(n.getAttribute("tabindex")),"a"===i&&n.getAttribute("href")?isNaN(t)||t>=0:!isNaN(t)&&t>=0)},u.prototype.getFirstTabbableChild=function(n){for(var i,r=n.getElementsByTagName("*"),t=0;t<r.length;t++)if(i=r[t],this.isTabbable(i))return i;return null},u}(nt),gi=function(i){function r(){var t=i.call(this)||this;return t._templateString='<a class="{TemplateBinding buttonClass Converter=setClassName}" data-tag="{TemplateBinding buttonClass}" title="{TemplateBinding hoverText}" event:click="onButtonClick" href="#"><span class="{TemplateBinding buttonIcon Converter=setIconClassName}"> <\/span><TextBlock Text="{TemplateBinding buttonText}" /><\/a>',t.defineProperty("buttonText"),t.defineProperty("buttonClass"),t.defineProperty("buttonIcon"),t.defineProperty("hoverText"),t.click=new h,t.setTemplate(new n(t._templateString,{onButtonClick:function(n){t._onButtonClick(n)},setClassName:function(n){return t._setClassName(n)},setIconClassName:function(n){return t._setIconClassName(n)}})),t}return t(r,i),r.prototype._onButtonClick=function(n){this.click.invoke(n)},r.prototype._setClassName=function(n){return"commonButtonControl "+n},r.prototype._setIconClassName=function(n){return"buttonIcon "+n},r}(o);n.registerControl("Button",gi);w=function(n){function i(t){var i=n.call(this,t)||this;return t=t||i,t.defineProperty("content"),t.defineProperty("contentTemplate",function(n,t){return i._onContentTemplateChanged(n,t)}),i}return t(i,n),i.prototype._onContentTemplateChanged=function(n){n&&n.dispose()},i.prototype.dispose=function(){var t=this.getContentTemplate();t&&t.dispose();n.prototype.dispose.call(this)},i}(o);ot=function(n){function i(){var t=n.call(this)||this;return t.defineProperty("checked",function(n,i){var r=i?it.ClickToUnselect:it.ClickToSelect;t.setAriaLabel(r);t.setTitle(r)},null,{defaultValue:!1}),t.defineProperty("ariaLabel"),t.defineProperty("title"),t.defineProperty("ariaLabelBy"),t.defineProperty("disabled",function(n,i){var r=t.getRootElement().select("input");i?r.set_attr("disabled","disabled"):r.remove_attr("disabled")},null,{defaultValue:!1}),t.defineProperty("value"),t.setTemplate('<label><input type="checkbox" value="{TemplateBinding Value}" aria-checked="{TemplateBinding Checked}" checked="{TemplateBinding Checked Mode=TwoWay}" title="{TemplateBinding Title}" aria-labelledBy="{TemplateBinding ariaLabelBy}" data-tag="checkbox" /><ContentPresenter /><\/label>'),t}return t(i,n),i}(w);n.registerControl("CheckBox",ot);y=function(n){function i(){var t=n.call(this)||this;return t._defaultTemplate="<{tag}><ItemsPresenter /><\/{tag}>",t.defineProperty("panelTagName",function(n,i){return t._onPanelTagNameChanged(n,i)},null,{defaultValue:"div"}),t.defineProperty("itemsSource"),t.defineProperty("itemTemplate",function(n,i){return t._onItemTemplateChanged(n,i)}),t._onPanelTagNameChanged(null,t.getPanelTagName()),t}return t(i,n),i.prototype._onItemTemplateChanged=function(n){n&&n.dispose()},i.prototype._onPanelTagNameChanged=function(n,t){this.setTemplate(this._defaultTemplate.replace(/{tag}/g,t))},i.prototype.dispose=function(){var t=this.getItemTemplate&&this.getItemTemplate();t&&t.dispose();n.prototype.dispose.call(this)},i}(o);n.registerControl("ItemsControl",y);st=function(i){function r(){var t=i.call(this)||this;return t.itemContainerGenerator=t,t.defineProperty("selectedItem",function(n,i){return t._onSelectedItemChanged(n,i)}),t.setTemplate(new n('<select event:change="onChange"><ItemsPresenter /><\/select>',{onChange:function(){return t._onSelectionChanged()}})),t}return t(r,i),r.prototype.generateNext=function(n){var t=f._createElement("option");return n===this.getSelectedItem()&&(t[0].selected=!0),t},r.prototype._onSelectionChanged=function(){var n=this.getRootElement()[0].selectedIndex,t=this.getItemsSource();this.setSelectedItem(t[n])},r.prototype._onSelectedItemChanged=function(n,t){var u=this.getItemsSource(),i=u.indexOf(t),r;i>=0&&(r=this.getRootElement()[0],r.selectedIndex=i)},r}(y);n.registerControl("ComboBox",st);ht=function(i){function r(){var t=i.call(this)||this;return t.defineProperty("containerClass"),t.defineProperty("controlName",function(i,r){t._control&&t._control.dispose();t._control=null;r&&(t._control=n.createControl(r),t.rendered.addOne(function(){t._control.rendered.invoke(t);t.setControlRef(t._control)}),t.setContent(t._control),t.setContentTemplate(t._control.getTemplate()))}),t.defineProperty("controlRef"),t.setTemplate('<div class="{TemplateBinding containerClass}" ><ContentPresenter /><\/div>'),t}return t(r,i),r}(w);n.registerControl("ContainerControl",ht);ct=function(i){function u(){var t=i.call(this)||this;return t._templateString='<div><ItemsControl ItemsSource="{TemplateBinding KeyList}" ><ItemsControl.ItemTemplate><DataTemplate><div class="{StaticBinding BlockClass}" data-key="{Binding key}" event:click="onBlockClick"><div class="{StaticBinding NameClass}"><TextBlock Text="{Binding key}" /><\/div><MappedItemsControl ContainerClass="{StaticBinding ContainerClass}" SourceKey="{Binding key}" SourceMap="{StaticBinding Dictionary}" ItemTemplate="{StaticBinding ValueTemplate}" /><\/div><\/DataTemplate><\/ItemsControl.ItemTemplate><\/ItemsControl><\/div>',t.defineProperty("keyList"),t.defineProperty("dictionary",function(){return t._updateTemplate()}),t.defineProperty("valueTemplate",function(){return t._updateTemplate()}),t.defineProperty("nameClass",function(){return t._updateTemplate()},null,{defaultValue:"hideName"}),t.defineProperty("containerClass"),t.defineProperty("blockClass"),t.onBlockClicked=new h,t.setTemplate(new n(t._templateString,null)),t}return t(u,i),u.prototype._onBlockClick=function(n){var t=r(n.currentTarget),i=t.get_attr("data-key");this.onBlockClicked.invoke(i)},u.prototype._updateTemplate=function(){var r=this,t=this.getDictionary(),i=this.getValueTemplate();t&&i&&this.setTemplate(new n(this._templateString,{Dictionary:t,ValueTemplate:i,NameClass:this.getNameClass(),ContainerClass:this.getContainerClass(),BlockClass:this.getBlockClass(),onBlockClick:function(n){r._onBlockClick(n)}}))},u}(o);n.registerControl("DictionaryItemsControl",ct);lt=function(i){function u(){var t=i.call(this)||this;return t._autoScrollBuffer=150,t._autoScrollStep=20,t._timeoutLength=100,t.itemContainerGenerator=t,t.onDragBegin=new h,t.onDragComplete=new h,t._timeoutId=0,t.defineProperty("draggedEntry"),t.defineProperty("placeholderElement"),t.defineProperty("ulClass"),t.defineProperty("blockDrag"),t.setTemplate(new n(u._draggableListFlexTemplate,{onDragMove:function(n){return t._onDragMove(n)},onDragEnd:function(n){return t._onDragEnd(n)}})),t}return t(u,i),u.prototype._getPositionFieldFromPointerArgs=function(n,t){var r=n.targetTouches,u=n.touches,i,f;if(r&&r[0])i=r[0][t];else if(u&&u[0])i=u[0][t];else if(n[t])i=n[t];else if(n instanceof KeyboardEvent){if(f=n.currentTarget.getBoundingClientRect(),t.indexOf("X")>=0)return f.left;if(t.indexOf("Y")>=0)return f.top}else return-1;return i},u.prototype.generateNext=function(){var n=this,i=f._createElement("li"),t,r;return i.set_attr("data-draggable","draggable").set_attr("aria-grabbed","false").set_attr("aria-dropeffect","none").set_attr("aria-role","listitem").add_class("bm_draggableItem"),this.useWholeDrag&&this.noGrip||(t=f._createElement("span"),this.gripClass?t.add_class(this.gripClass):t.add_class("defaultGrip"),e.addDataTag(t,"defaultGrip"),this.tooltip&&t.set_attr("title",this.tooltip),t.set_attr("data-grip","grip").set_attr("tabindex","0").set_attr("role","button").add_event("focus",function(n){n.currentTarget.setAttribute("aria-label",l.L_DraggableList_Keyboard_Drag_Start_Hint)}).add_event("blur",function(t){t.currentTarget.removeAttribute("aria-label");n._isDragging&&n._onDragEnd(t,!1)})),this.useWholeDrag?(r=function(t){t.target&&t.target.classList&&t.target.classList.contains("bm_noDrag")||n.getBlockDrag()||(n._dragFinished=!1,n._clickTimeoutId&&window.clearTimeout(n._clickTimeoutId),n._clickTimeoutId=Microsoft.Maps.setTimeout(function(){return n._onDragStart(t,i)},t.type==="touchstart"?1e3:150),t.type==="touchstart"||t.type==="pointerdown"&&t.pointerType==="touch"||t.preventDefault())},i.add_event("touchstart",function(n){r(n)}).add_event("mousedown",function(n){r(n)}).add_event("mouseup",function(){window.clearTimeout(n._clickTimeoutId)},!0).add_event("touchend",function(){window.clearTimeout(n._clickTimeoutId)},!0).add_event("click",function(t){window.clearTimeout(n._clickTimeoutId);n._dragFinished&&n._haltEvent(t);n._dragFinished=!1},!0).add_event("keydown",function(t){n.getBlockDrag()||n._onKeyDown(t,i)}),t&&t.add_event("keydown",function(t){n.getBlockDrag()||n._onKeyDown(t,i,!0)})):t.add_event("touchstart",function(t){n._onDragStart(t,i)}).add_event("mousedown",function(t){n._onDragStart(t,i)}).add_event("keydown",function(t){n.getBlockDrag()||n._onKeyDown(t,i,!0)}).add_event("click",function(t){n._haltEvent(t)}),t&&i.append(t),i},u.prototype._startMovePosition=function(n,t){this._moveStartX=this._getPositionFieldFromPointerArgs(n,"pageX");this._moveStartY=this._getPositionFieldFromPointerArgs(n,"pageY");t?(this._dragPositionX=t.x,this._dragPositionY=t.y):(this._dragPositionX=this._moveStartX,this._dragPositionY=this._moveStartY);this._isDragging=!0},u.prototype._updatePosition=function(n,t,i){if(this._isDragging){if(n instanceof KeyboardEvent)this._dragPositionX=t,this._dragPositionY=i;else{t=0;i=0;var r=this._getPositionFieldFromPointerArgs(n,"pageX"),u=this._getPositionFieldFromPointerArgs(n,"pageY");r!==-1&&u!==-1&&(t=r-this._moveStartX,i=u-this._moveStartY);this._moveStartX+=t;this._moveStartY+=i;this._dragPositionX+=t;this._dragPositionY+=i}return!0}return!1},u.prototype._onDragStart=function(n,t){var r,i;this._isDragging||this._isMouseDisabled&&n instanceof MouseEvent||(n.preventDefault(),this._fixContainerHeight(),this._initializeDraggablesList(),this._draggedEntryIndex=this._getDragIndex(t),this._insertIndex=this._draggedEntryIndex,this.setDraggedEntry(t),this._setAriaGrabbed(!0),r=t[0],this._startMovePosition(n,new a(r.offsetLeft,r.offsetTop)),this._startDraggingElement(),this._createPlaceholder(),this._insertPlaceholder(this._insertIndex),n instanceof KeyboardEvent&&(this._isMouseDisabled=!0,i=this._getDefaultGripTargetOfDraggedEntry(),i&&(i.setAttribute("aria-label",l.L_DraggableList_Keyboard_Drag_Move_Hint),i.setAttribute("aria-selected","true"))),this.onDragBegin.hasHandlersRegistered&&this.onDragBegin.invoke());this._haltEvent(n)},u.prototype._onDragMove=function(n,t){var i,u,f,r;!this._isDragging||this._isMouseDisabled&&n instanceof MouseEvent?n.type==="touchmove"&&window.clearTimeout(this._clickTimeoutId):(this._clearTimeOut(),n.preventDefault(),n instanceof KeyboardEvent&&(i=this._getDefaultGripTargetOfDraggedEntry(),i&&(i.setAttribute("aria-label",l.L_DraggableList_Keyboard_Drag_Move_Hint),i.setAttribute("aria-selected","true"))),this._determineNeedToAutoScroll(n),n instanceof KeyboardEvent?(this._updateKeyboardPosition(t),r=this.getPlaceholderElement()[0],u=r.offsetLeft,f=r.offsetTop):this._checkMouseOverNewEntry(n),this._updatePosition(n,u,f)&&(this._setDraggedElementPosition(),this._haltEvent(n)))},u.prototype._checkMouseOverNewEntry=function(n){for(var u,i,t,f=null,e=0,o=this._draggablesList.length;e<o;e++)if((u=this._draggablesList[e],!u.classList.contains("moving"))&&(i=u.getBoundingClientRect(),n.pageX>=i.left&&n.pageX<=i.right&&n.pageY>=i.top&&n.pageY<=i.bottom)){f=r(u);break}f&&(t=this._getDragIndex(f),t===this._insertIndex?this._draggedEntryIndex<this._insertIndex?t++:t--:t>this._insertIndex&&t++,this._insertIndex=t,this._insertPlaceholder(this._insertIndex))},u.prototype._updateKeyboardPosition=function(n){var t=this._insertIndex+n;this._draggedEntryIndex===this._insertIndex&&n===1&&t++;t>=0&&t<=this._draggablesList.length&&(this._insertIndex=t,this._insertPlaceholder(this._insertIndex))},u.prototype._onDragEnd=function(n,t){var o,u,f,i;t===void 0&&(t=!0);!this._isDragging||this._isMouseDisabled&&n instanceof MouseEvent||(this._clearTimeOut(),n.preventDefault(),this._isDragging=!1,this._dragFinished=!0,o=this._draggedEntryIndex!==this._insertIndex&&t,u=null,this._stopDraggingElement(),this._removePlaceholder(),this._setAriaGrabbed(!1),o&&(u=this.getItemsSource()[this._draggedEntryIndex],this._reorderItemsList(),e.getFunctionalTestHooksEnabled()&&(f=r(r("[data-draggable=draggable]",this.getRootElement()[0])[this._draggedEntryIndex]),f.add_class("finishedDragging"),e.addDataTag(f,"finishedDragging"))),(n instanceof KeyboardEvent||n instanceof FocusEvent)&&(this._isMouseDisabled=!1,i=this._getDefaultGripTargetOfDraggedEntry(),i&&(i.setAttribute("aria-label",l.L_DraggableList_Keyboard_Drag_Start_Hint),i.setAttribute("aria-selected","false"))),this._draggedEntryIndex=-1,this._insertIndex=-1,this._draggablesList=null,this._unfixContainerHeight(),this.onDragComplete.hasHandlersRegistered&&this.onDragComplete.invoke(u),this._haltEvent(n))},u.prototype._setAriaGrabbed=function(n){var t=this.getDraggedEntry()[0],i;if(!t.classList.contains("bm_draggableItem")){t=t.parentElement;t.setAttribute("aria-grabbed",n.toString());return}t.setAttribute("aria-grabbed",n.toString());i=n?"move":"none";t.setAttribute("aria-dropeffect",i)},u.prototype._startDraggingElement=function(){var n=this.getDraggedEntry(),t=n.get_size();t&&n.set_style({width:t.width+"px"});n.add_class("moving");e.addDataTag(n,"moving");this._setDraggedElementPosition()},u.prototype._createPlaceholder=function(){var n=f._createElement("div"),i=this.getDraggedEntry(),t=i&&i.get_size();t&&n.set_style({width:t.width+"px",height:t.height+"px"});n.add_class("bm_placeholder");this.setPlaceholderElement(n)},u.prototype._insertPlaceholder=function(n){var t=this.getPlaceholderElement(),i,u,f,e;t.removeFromParent();n<this._draggablesList.length?(i=this._draggablesList[n],u=r(i.parentElement),u.insertBefore(t,i)):(f=this._draggablesList[this._draggablesList.length-1],e=r(f.parentElement),e.append(t))},u.prototype._removePlaceholder=function(){var n=this.getPlaceholderElement();n.removeFromParent();this.setPlaceholderElement(null)},u.prototype._setDraggedElementPosition=function(){this.getDraggedEntry().set_style({top:this._dragPositionY+"px",left:this._dragPositionX+"px"})},u.prototype._stopDraggingElement=function(){var n=this.getDraggedEntry();n.remove_class("moving");n.set_style({top:"",left:"",width:""});e.getFunctionalTestHooksEnabled()&&n.remove_attr("data-tag")},u.prototype._getDragIndex=function(n){var r=n.length&&n[0],i,u,t;if(r)for(i=this._draggablesList||this.getRootElement().select("[data-draggable=draggable]"),u=i.length,t=0;t<u;t++)if(i[t]===r)return t;return null},u.prototype._getDefaultGripTargetOfDraggedEntry=function(){var t=this.getDraggedEntry(),n=t&&t.select(".defaultGrip");return n&&n.length>0?n[0]:null},u.prototype._getDraggedElementHeight=function(){return this.getDraggedEntry().get_size().height},u.prototype._initializeDraggablesList=function(){this._draggablesList=this.getRootElement().select("[data-draggable=draggable]")},u.prototype._haltEvent=function(n){n.stopPropagation();n.preventDefault()},u.prototype._reorderItemsList=function(){var n=this.getItemsSource(),t=n[this._draggedEntryIndex],i=this._insertIndex+(this._draggedEntryIndex<this._insertIndex?-1:0);n.removeAt(this._draggedEntryIndex);n.insert(t,i)},u.prototype._determineNeedToAutoScroll=function(n){var u=this,t=0,f=this._getScrollContainer(),i=f.getBoundingClientRect(),r=this.getRootElement()[0].getBoundingClientRect();this._moveStartY>i.bottom-this._autoScrollBuffer&&this._moveStartY<=r.bottom?t=this._autoScrollStep:this._moveStartY<i.top+this._autoScrollBuffer&&this._moveStartY>=r.top&&(t=-1*this._autoScrollStep);t!==0&&this._timeoutId===0&&(this._timeoutId=Microsoft.Maps.setTimeout(function(){return u._updateAutoScroll(n,t)},this._timeoutLength))},u.prototype._updateAutoScroll=function(n,t){this._clearTimeOut();var i=this._getScrollContainer(),r=i.scrollTop+t;r>0&&r<i.scrollHeight-i.clientHeight&&(i.scrollTop=r,this._dragPositionY+=t,this._onDragMove(n))},u.prototype._getScrollContainer=function(){var n=null,t,i;return this.scrollContainer?n=this.scrollContainer:(t=r("[data-containerareatype=cardsContainer]"),i=t.getParent(),n=i[0]),n},u.prototype._clearTimeOut=function(){this._timeoutId!==0&&(window.clearTimeout(this._timeoutId),this._timeoutId=0)},u.prototype._onKeyDown=function(n,t,i){var u=n,r=u.keyCode||u.which,f=this.getDraggedEntry()&&this.getDraggedEntry()[0];n.target.tagName!=="INPUT"&&n.target.tagName!=="TEXTAREA"&&((i||this._isDragging)&&r===13||!i&&r===32?this._isDragging?this._onDragEnd(n):this._onDragStart(n,t):r===38&&this._isDragging?this._insertIndex>0?this._onDragMove(n,-1):f.setAttribute("aria-label",l.L_DraggableList_Keyboard_Drag_Top_Error_Hint):r===40&&this._isDragging&&(this._insertIndex<this.getItemsSource().length?this._onDragMove(n,1):f.setAttribute("aria-label",l.L_DraggableList_Keyboard_Drag_Bottom_Error_Hint)))},u.prototype._fixContainerHeight=function(){var n=this.getRootElement()[0];n&&(n.style.minHeight=n.clientHeight+"px")},u.prototype._unfixContainerHeight=function(){var n=this.getRootElement()[0];n&&(n.style.minHeight="0")},u._draggableListFlexTemplate='<div class="bm_draggableDisplay" event:touchmove="onDragMove" event:mousemove="onDragMove" event:pointermove="onDragMove"><ul role="list" class="{TemplateBinding ulClass}" event:touchend="onDragEnd" event:mouseup="onDragEnd"><ItemsPresenter /><\/ul><\/div>',u}(y);n.registerControl("DraggableList",lt);at=function(i){function u(){var t=i.call(this)||this;return t._templateString='<div class="{TemplateBinding Class}" aria-label="{TemplateBinding AriaLabel}" event:mousemove="onScroll" event:touchmove="onScroll" event:pointermove="onScroll" data-tag="popOutTop"><div class="popOutInner" data-tag="popOutInner"><ItemsPresenter /><\/div><\/div>',t.defineProperty("class",null,null,{defaultValue:"popOutTop"}),t.defineProperty("ariaLabel"),t.itemContainerGenerator=t,t.onEntryClicked=new h,t.onEntryMouseover=new h,t.onEntryMouseout=new h,t.setTemplate(new n(t._templateString,{onScroll:function(n){n.type==="touchmove"&&(u._scrolling=!0);n.stopPropagation();n.cancelBubble=!0}})),t}return t(u,i),u.prototype.generateNext=function(n){var t=this,u=this.getItemsSource(),o=u.indexOf(n),r=function(n){t._entryClicked(n)},s=function(n){t._entryMouseover(n)},h=function(n){t._entryMouseout(n)},c=function(n){t._entryKeydown(n)},i;return n.separator?i=f._createElement("div").add_class("dropdownSeparator"):(i=f._createElement("a").add_event("click",r).add_event("touchend",r).add_event("mouseover",s).add_event("mouseout",h).add_event("keydown",c).add_class("dropdownEntry").set_attr("data-dropdown",""+o).set_attr("href","#").set_attr("role","button"),e.addDataTag(i,"dropdownEntry")),i},u.prototype._entryClicked=function(n){var t,i;if(u._scrolling){u._scrolling=!1;return}(n.stopPropagation(),n.preventDefault(),n.type!=="pointerup"||r(".mapContainer .MicrosoftMap").has(n.target)&&!p.isMapsAnswer)&&(t=r(n.currentTarget),t&&t.length>0&&t[0].hasAttribute("data-dropdown")&&(i=parseInt(t.get_attr("data-dropdown")),this.onEntryClicked.invoke(i)))},u.prototype._entryMouseover=function(n){var t=parseInt(r(n.currentTarget).get_attr("data-dropdown"));this.onEntryMouseover.invoke(t);n.stopPropagation();n.preventDefault()},u.prototype._entryMouseout=function(n){var t=parseInt(r(n.currentTarget).get_attr("data-dropdown"));this.onEntryMouseout.invoke(t);n.stopPropagation();n.preventDefault()},u.prototype._entryKeydown=function(n){var t;n.keyCode===40?(t=n.target.nextElementSibling,t&&t.focus()):n.keyCode===38&&(t=n.target.previousElementSibling,t&&t.focus())},u._scrolling=!1,u}(y);n.registerControl("Dropdown",at);vt=function(n){function i(){var t=n.call(this)||this;return t._defaultTemplate="<div class='flexItems'><ItemsPresenter /><\/div>",t.defineProperty("itemsSource"),t.defineProperty("itemTemplate",function(n,i){return t._onItemTemplateChanged(n,i)}),t.setTemplate(t._defaultTemplate),t}return t(i,n),i.prototype._onItemTemplateChanged=function(n){n&&n.dispose()},i.prototype.dispose=function(){var t=this.getItemTemplate&&this.getItemTemplate();t&&t.dispose();n.prototype.dispose.call(this)},i}(o);n.registerControl("FlexItemsControl",vt);yt=function(n){function i(){var t=n.call(this)||this;return t._enabledTags=["b","strong"],t.defineProperty("formattedtext",function(n,i){return t.onFormattedTextChanged(n,i)}),t._root=document.createElement("span"),t}return t(i,n),i.prototype.getRootElement=function(){return r(this._root)},i.prototype.dispose=function(){n.prototype.dispose.call(this);this._root=null},i.prototype.onFormattedTextChanged=function(n,t){this.addFormattedResult(t,this._root)},i.prototype.addFormattedResult=function(n,t){var i,r,f,u,o;if(n&&n.length!=0){for(r=n.length-1,u=0;u<this._enabledTags.length;u++){var h="<"+this._enabledTags[u]+">",c="<\/"+this._enabledTags[u]+">",e=n.indexOf(h),s=n.indexOf(c);e>-1&&e<r&&s>-1&&(r=e,f=s,i=this._enabledTags[u])}i?(t.appendChild(document.createTextNode(n.substr(0,r))),o=document.createElement(i),this.addFormattedResult(n.substr(r+i.length+2,f-r-i.length-2),o),t.appendChild(o),this.addFormattedResult(n.substr(f+i.length+3),t)):t.appendChild(document.createTextNode(n))}},i}(nt);n.registerControl("FormattedTextBlock",yt);pt=function(i){function r(){var t=i.call(this)||this;return t._templateString='<div class="{TemplateBinding ContainerClass}"><ItemsPresenter /><\/div>',t.defineProperty("sourceKey",function(){return t._onSourceChanged()}),t.defineProperty("sourceMap",function(){return t._onSourceChanged()}),t.defineProperty("containerClass"),t.setTemplate(new n(t._templateString,null)),t}return t(r,i),r.prototype._onSourceChanged=function(){var n=this.getSourceKey(),t=this.getSourceMap();n&&t&&this.setItemsSource(t[n])},r}(y);n.registerControl("MappedItemsControl",pt);wt=function(i){function r(){var t=i.call(this)||this,r,u;return t._ignoreDateTimeChanged=!1,t.defineProperty("time",t.onTimeChanged),t.defineProperty("date",t.onDateChanged),t.defineProperty("mobileDate"),t.defineProperty("mobileTime"),d&&(t.setTemplate(new n(d,{onSetDate:function(n){t._parseDate(n)},onSetTime:function(n){t._parseTime(n)}})),r=t._getCurrentDate(),u=t._getCurrentTime(),t.setMobileDate(r),t.setMobileTime(u)),t}return t(r,i),r.prototype._parseDate=function(n){var t=n.target.value.split(/[^0-9]/),i=Date.parse(t[0]+"/"+t[1]+"/"+t[2]+" 00:00:00");this._ignoreDateTimeChanged=!0;try{this.setDate(i)}catch(r){}this._ignoreDateTimeChanged=!1},r.prototype._parseTime=function(n){var t=n.target.valueAsNumber/1e3;this._ignoreDateTimeChanged=!0;try{this.setTime(t)}catch(i){}this._ignoreDateTimeChanged=!1},r.prototype.onTimeChanged=function(n,t){var u,e,r,i,f;this._ignoreDateTimeChanged||(u=3600,e=43200,t%=86400,r=Math.floor(t/u),i=t%u,i/=60,f=r<10?"0"+r+":":r+":",f+=i<10?"0"+i:i,this.setMobileTime(f))},r.prototype.onDateChanged=function(n,t){if(!this._ignoreDateTimeChanged){var i=new Date(t),r=this._formatDate(i);this.setMobileDate(r)}},r.prototype._getCurrentDate=function(){var n=new Date;return this._formatDate(n)},r.prototype._getCurrentTime=function(){var n=new Date;return n.toTimeString()},r.prototype._formatDate=function(n){var u=n.getFullYear(),i=n.getMonth()+1,r=n.getDate(),t=u+"-";return i<10&&(t+="0"),t+=i+"-",r<10&&(t+="0"),t+r},r}(o);n.registerControl("MobileTimeControl",wt);bt=function(i){function r(){var t=i.call(this)||this;return t._templateString='<div class="{TemplateBinding Class}" data-tag="popOutTop"><div class="popOutInner" data-tag="popOutInner"><ContentPresenter /><\/div><\/div>',t.defineProperty("class",null,null,{defaultValue:"popOutTop"}),t.setTemplate(new n(t._templateString,null)),t}return t(r,i),r}(w);n.registerControl("PopOut",bt);kt=function(i){function u(){var t=i.call(this)||this;return t._templateString='<div class="bm_popOutContainer" data-tag="popOutContainer"><a class="{TemplateBinding ButtonClass}" event:click="onButtonClick" href="#" role="button" aria-expanded="{TemplateBinding IsDisplayed}" ><TextBlock Text="{TemplateBinding ButtonText}" /><\/a><div class="popOutTemplate" data-tag="popOutTemplate" style:display="{TemplateBinding IsDisplayed Converter=displayPopOut}" event:click="onPopOutClick" event:touchend="onPopOutClick" event:mousewheel="onMouseWheel" ><PopOutPresenter /><\/div><\/div>',t.defineProperty("popOutContent"),t.defineProperty("popOutTemplate"),t.defineProperty("buttonText"),t.defineProperty("buttonClass",null,null,{defaultValue:"popOutButton"}),t.defineProperty("isDisplayed",function(n,i){return t._onDisplayChange(n,i)},null,{defaultValue:!1}),t.setTemplate(new n(t._templateString,{onButtonClick:function(n){return t._onButtonClick(n)},onPopOutClick:function(n){n.stopPropagation()},onMouseWheel:function(n){return t._onMouseWheel(n)},displayPopOut:function(n){return t.displayPopOut(n)}})),t._windowClickOrKeyboardEventHandler=function(n){var u=n,o=u?u.keyCode||u.which:null,i,f,r,e;if(o&&o===27)t._hidePopOut(n);else{if(i=n.target,f=t.getRootElement(),f&&f.has(i))return;r=i&&i.className.toString();r==="dropdownEntry"&&i.childElementCount>0&&i.children[0].childElementCount>0&&(i=i.children[0].childNodes[0],r=i.className.toString());e=i&&i.parentElement&&i.parentElement.className&&i.parentElement.className.toString();r&&r.indexOf("feedbackMenuLink")!==-1||e&&e.indexOf("feedbackMenuLink")!==-1||t._hidePopOut(n)}},t}return t(u,i),u.prototype.displayPopOut=function(n){return n?"block":"none"},u.prototype.dispose=function(){r(window).remove_event("click,contextmenu,keydown",this._windowClickOrKeyboardEventHandler);i.prototype.dispose.call(this)},u.prototype._onButtonClick=function(n){this.setIsDisplayed(!this.getIsDisplayed());n.preventDefault()},u.prototype._onMouseWheel=function(n){n.stopPropagation()},u.prototype._onDisplayChange=function(n,t){var u=this,i=r(window);t?Microsoft.Maps.setTimeout(function(){i.add_event("click,contextmenu,keydown",u._windowClickOrKeyboardEventHandler,!0)},1):n&&i.remove_event("click,contextmenu,keydown",this._windowClickOrKeyboardEventHandler)},u.prototype._hidePopOut=function(){this.getRootElement()[0]?this.setIsDisplayed(!1):r(window).remove_event("click,contextmenu,keydown",this._windowClickOrKeyboardEventHandler)},u}(o);n.registerControl("PopOutButton",kt);dt=function(i){function r(){var t=i.call(this)||this;return t.defineProperty("itemsSource"),t.defineProperty("selectedItem",t._onSelectedItemChanged),t.setTemplate(new n('<div class="radioGroup" data-tag="radioGroup"><ItemsControl ItemsSource="{TemplateBinding itemsSource}"><ItemsControl.ItemTemplate><DataTemplate><a href="#" data-value="{Binding value}" event:click="onClick" role="button" aria-current="false"><TextBlock Text="{Binding text}"/><\/a><\/DataTemplate><\/ItemsControl.ItemTemplate><\/ItemsControl><\/div>',{onClick:function(n){var u,r,i;for(n.preventDefault(),u=n.target.getAttribute("data-value"),r=t.getItemsSource(),i=0;i<r.length;i++)if(r[i].value==u){t.setSelectedItem(r[i]);break}}})),t}return t(r,i),r.prototype._onSelectedItemChanged=function(n,t){for(var u=this.getItemsSource().indexOf(t),r=this.getRootElement().select("a"),i=0;i<r.length;i++)r[i].className=i===u?"selected":"",r[i].setAttribute("aria-current",i===u?"true":"false")},r}(o);n.registerControl("RadioGroup",dt);gt=function(i){function r(){var t=i.call(this)||this;return t.defineProperty("ignorePopOutButtonText"),t.defineProperty("popOutButtonText"),t.defineProperty("selectedItem",function(n,i){t._handleSelectedItemChanged(n,i)}),t.defineProperty("itemsSource",function(n,i){t.getPopOutContent().options=i}),t.defineProperty("dropdownOpen",t._onDropdownOpenChanged,null,{isPrivate:!0}),t.defineProperty("popOutContent",null,null,{defaultValue:{options:null},isPrivate:!0}),t.dropdown=new h,t.setTemplate(new n('<span class="{TemplateBinding DropdownOpen Converter=openToCssClass}" data-tag="selectControl"><PopOutButton PopOutContent="{TemplateBinding PopOutContent}" IsDisplayed="{TemplateBinding DropdownOpen Mode=TwoWay}" ButtonText="{TemplateBinding PopOutButtonText}" ButtonClass="popOutButton dropdownBtn" ><PopOutButton.PopOutTemplate><DataTemplate><div><Dropdown ItemsSource="{Binding options}" event:onEntryClicked="onEntryClicked" ><Dropdown.ItemTemplate><DataTemplate><TextBlock Text="{Binding text}" /><\/DataTemplate><\/Dropdown.ItemTemplate><\/Dropdown><\/div><\/DataTemplate><\/PopOutButton.PopOutTemplate><\/PopOutButton><\/span>',{onEntryClicked:function(n){t.setDropdownOpen(!1);t.setSelectedItem(t.getItemsSource()[n]);window.clearTimeout(r.timeoutHandler);r.timeoutHandler=Microsoft.Maps.setTimeout(function(){t.getRootElement().select(".popOutButton")[0].focus()},r.timeoutTime/5)},openToCssClass:function(n){return"selectControl"+(n?" dropdownOpen":"")}})),t}return t(r,i),r.prototype._handleSelectedItemChanged=function(n,t){if(!n&&this.getIgnorePopOutButtonText()){this.setPopOutButtonText("");return}if(n!=t)if(this.getIgnorePopOutButtonText())this.setPopOutButtonText("");else{var i=this.getSelectedItem();this.setPopOutButtonText(i?i.text:"")}},r.prototype._onDropdownOpenChanged=function(n,t){var i=this;t&&(window.clearTimeout(r.timeoutHandler),r.timeoutHandler=Microsoft.Maps.setTimeout(function(){var n=i.getItemsSource().indexOf(i.getSelectedItem()),t;n<0&&(n=0);t=i.getRootElement().select(".dropdownEntry");n>=0&&t[n]&&t[n].focus()},r.timeoutTime));this.dropdown.hasHandlersRegistered&&this.dropdown.invoke(t)},r.timeoutTime=50,r}(o);n.registerControl("SelectControl",gt);ni=function(n){function i(){var t=n.call(this)||this;return t.defineProperty("value",function(n,i){return t.onAttributeChanged("value",n,i)}),t.defineProperty("min",function(n,i){return t.onAttributeChanged("min",n,i)}),t.defineProperty("max",function(n,i){return t.onAttributeChanged("max",n,i)}),t.defineProperty("step",function(n,i){return t.onAttributeChanged("step",n,i)}),t.setTemplate('<input type="range" value="{TemplateBinding Value Mode=TwoWay}"/>'),t}return t(i,n),i.prototype.onAttributeChanged=function(t,i,r){n.prototype.getRootElement.call(this).set_attr(t,r)},i}(o);n.registerControl("Slider",ni);ti=function(i){function r(){var t=i.call(this)||this;return t._timerId=0,t.defineProperty("itemsSource"),t.defineProperty("taskId"),t.defineProperty("index",null,null,{defaultValue:0}),t.defineProperty("open",t._onOpenChanged,null,{defaultValue:!1}),t.defineProperty("activeId"),t.openEvent=new h,t._pos=0,t.setTemplate(new n(pi,{onItemClick:function(n){var i;n.preventDefault();var f=n.target.getAttribute("data-value"),r=-1,u=t.getItemsSource();for(i=u.length-1;i>=0;i--)if(u[i].value==f){r=i;break}r===t._pos?t._invokeOpenEvent():t._setPos(r)},onMouseOver:function(n){n.preventDefault();n.stopPropagation();t._setActiveDescendentID()},onCellClick:function(n){n.stopPropagation();t._invokeOpenEvent()},onUpArrow:function(){t._scroll(-1,500)},onDownArrow:function(){t._scroll(1,500)},onColumnKeyDown:function(n){var r=n,i=r.keyCode||r.which;(i===38||i===40||i===13)&&(n.stopPropagation(),n.preventDefault());i===38?t._scroll(-1,500):i===40?t._scroll(1,500):i===13&&t._invokeOpenEvent()},endScroll:function(){window.clearTimeout(t._timerId);t._setActiveDescendentID()},onContextMenu:function(n){n.stopPropagation();n.preventDefault()},onColumnClick:function(n){n.stopPropagation()},onMouseWheel:function(n){n.stopPropagation();n.preventDefault();n.wheelDelta&&t._setPos(t._pos+(n.wheelDelta>0?-1:1))},indexToValue:function(n){var i=t.getItemsSource();return!i||n<0||n>=i.length?"":i[n].text},boolToDisplay:function(n){return n?"":"none"}})),t}return t(r,i),r.prototype._invokeOpenEvent=function(){this.openEvent.hasHandlersRegistered&&this.openEvent.invoke()},r.prototype._onOpenChanged=function(n,t){t?this._setPos(this.getIndex()):this.setIndex(this._pos)},r.prototype._setPos=function(n){var t=this.getRootElement().select("li"),i;n<0||n>=t.length||(i=t[n],i&&(t[this._pos].className="",this._pos=n,i.className="selected",this._listElement||(this._listElement=this.getRootElement().select("ul")),this._listElement.set_style({top:26*(2-n)+"px"})))},r.prototype._scroll=function(n,t){if(this._setPos(this._pos+n),n>0&&this._pos<this.getItemsSource().length-1||n<0&&this._pos>0){var i=this;window.clearTimeout(this._timerId);this._timerId=Microsoft.Maps.setTimeout(function(){i._scroll(n,150)},t)}},r.prototype._setActiveDescendentID=function(){var t=this.getItemsSource()[this._pos],n=this.getTaskId(),i=n?n:"";this.setActiveId(t.itemId+i)},r}(o);n.registerControl("SpinBox",ti);ii=function(i){function r(){var t=i.call(this)||this;return t.defineProperty("value",null,null,{defaultValue:0}),t.setTemplate(new n('<div class="starRate" event:click="onClick"><div style:width="{TemplateBinding Value Converter=valueToWidth}"><\/div><\/div>',{onClick:function(n){var i=n.offsetX||n.layerX;t.setValue(Math.floor(i/40)+1)},valueToWidth:function(n){return n*20+"%"}})),t}return t(r,i),r}(o);n.registerControl("StarRating",ii);ri=function(i){function r(){var t=i.call(this)||this;return t._templateString='<div class="tabTemplate" style:display="{TemplateBinding IsDisplayed Converter=displayTab}" ><TabbedPresenter /><\/div>',t.defineProperty("tabContent"),t.defineProperty("tabTemplate"),t.defineProperty("isDisplayed",function(n,i){return t._onDisplayChange(n,i)},null,{defaultValue:!1}),t.setTemplate(new n(t._templateString,{displayTab:function(n){return t.displayTab(n)}})),t}return t(r,i),r.prototype.displayTab=function(n){return n?"block":"none"},r.prototype._onDisplayChange=function(){},r}(o);n.registerControl("Tab",ri);ui=function(n){function i(){var t=n.call(this)||this;return t.defineProperty("text",function(n,i){return t.onTextChanged(n,i)}),t._root=document.createTextNode(""),t}return t(i,n),i.prototype.getRootElement=function(){return r(this._root)},i.prototype.dispose=function(){n.prototype.dispose.call(this);this._root=null},i.prototype.onTextChanged=function(n,t){this._root.nodeValue=t},i}(nt);n.registerControl("TextBlock",ui);fi=function(u){function e(){var t=u.call(this)||this,i,f;if(t._ignoreTimeChanged=!1,t.defineProperty("time",t._onTimeChanged),t.defineProperty("taskId"),t.defineProperty("disabled",t._onDisabledChanged,null,{defaultValue:!1}),t.defineProperty("open",t._onOpenChanged,null,{defaultValue:!1,isPrivate:!0}),t.defineProperty("editing",t._onEditingChanged,null,{defaultValue:!1}),t.defineProperty("col0Index",null,null,{defaultValue:0}),t.defineProperty("col1Index",null,null,{defaultValue:0}),t.defineProperty("col2Index",null,null,{defaultValue:0}),t.defineProperty("ariaLabel",null,null,{defaultValue:l?l.MapsTimeSelect:""}),e._sourceData||e._initializeData(),t.col0Source=e._sourceData[0],t.col1Source=e._sourceData[1],t.col2Source=e._sourceData[2],d){if(t.setTemplate(new n(d,{onDropdown:function(n){n.preventDefault();t.getDisabled()||t.toggleOpen()},onOpen:function(){t.getDisabled()||t.toggleOpen()},onHover:function(){t._convertTimeToAriaLabel()},openToClass:function(n){return t.getDisabled()?"timeControl time_ctrl_disabled":"timeControl"+(n?" open":"")}})),i=t.getRootElement().select(".spinBox"),i){for(f=0;f<i.length;f++)e._sourceData[f]||(i[f].style.display="none"),i[f].getElementsByClassName("column")[0].classList.add("box"+f.toString());i.length>0&&(i[0]&&i[0].setAttribute("aria-label",l.SpinBoxHoursLabel),i[1]&&i[1].setAttribute("aria-label",l.SpinBoxMinutesLabel),i[2]&&i[2].setAttribute("aria-label",l.SpinBoxAmPmLabel))}t._windowEventHandler=function(){t._onWindowEvent()};t._windowKeyEventHandler=function(n){var u=n;if(u.keyCode===9){var f=document.activeElement,i=f&&f.classList,e="box2";if(u.shiftKey&&(e="box0"),i&&!(i.contains("column")&&i.contains(e)))return;t._onWindowEvent();Microsoft.Maps.setTimeout(function(){var n=r(".dirTimePopup"),t=n.length>0&&r(".timeControl",n[0]),i;t.length>0&&(i=t[0].getElementsByClassName("dropdown"),i[0].focus())},100)}}}return t}return t(e,u),e.prototype.toggleOpen=function(){var t=!this.getOpen(),n,i;if(this.setOpen(t),t)n=this.getRootElement().select(".column");else{i=this._getTimeFromSource();this._ignoreTimeChanged=!0;try{this.setTime(i)}catch(r){}this._ignoreTimeChanged=!1;n=this.getRootElement().select(".dropdown")}n&&n[0].focus();this.setEditing(t)},e.prototype._onTimeChanged=function(n,t){var r,u,f,i;this._ignoreTimeChanged||(r=3600,u=43200,t%=86400,f=e._amPmCol>=0,f&&(this._setIndex(e._amPmCol,Math.floor(t/u)),t%=u),i=Math.floor(t/r),f&&--i<0&&(i=11),this._setIndex(e._hoursCol,i),t%=r,this._setIndex(e._minsCol,Math.floor(t/300)),this._convertTimeToAriaLabel())},e.prototype._getTimeFromSource=function(){var n=this.col0Source[this.getCol0Index()].value+this.col1Source[this.getCol1Index()].value;return this.col2Source&&(n+=this.col2Source[this.getCol2Index()].value),n},e.prototype._convertTimeToAriaLabel=function(){var n=this._getTimeFromSource();n&&this.setAriaLabel(f._formatUTCTimeString(new Date(n*1e3)))},e.prototype._onDisabledChanged=function(n,t){t&&this.getOpen()?this.toggleOpen():this.setOpen(!1)},e.prototype._setIndex=function(n,t){switch(n){case 0:this.setCol0Index(t);break;case 1:this.setCol1Index(t);break;case 2:this.setCol2Index(t)}},e.prototype._onEditingChanged=function(n,t){this.getOpen()!=t&&this.toggleOpen()},e.prototype._onOpenChanged=function(n,t){var i=this;t?Microsoft.Maps.setTimeout(function(){r(window).add_event("click,contextmenu",i._windowEventHandler);r(window).add_event("keydown",i._windowKeyEventHandler)},1):n&&this._removeWindowEvents()},e.prototype._onWindowEvent=function(){this.getRootElement()[0]?this.getOpen()&&this.toggleOpen():this._removeWindowEvents()},e.prototype._removeWindowEvents=function(){var n=r(window);n.remove_event("click,contextmenu",this._windowEventHandler);n.remove_event("keydown",this._windowKeyEventHandler)},e._getShortTimePattern=function(n){var t=n.shortTimePattern+" ";return t.replace(/'[a-zA-Z]*'/gi,"")},e._initializeData=function(){var o=i.GlobalConfig.dynamicProperties.cultureData,l=e._getShortTimePattern(o),f,c;e._amPmCol=-1;var r=[],u=0,n,t=0;for(f=0;f<l.length;f++){var s=l.charAt(f),h=null,a=!1;switch(s){case"h":case"H":case"m":case"t":s===n?(++t,a=!0):h=s}if(!a&&n){switch(n){case"h":c=e._createArray(1,12,1,t>1,3600,3600,n);c[11].value=0;r.push(c);e._hoursCol=u++;break;case"H":r.push(e._createArray(0,23,1,t>1,0,3600,n));e._hoursCol=u++;break;case"m":r.push(e._createArray(0,55,5,t>1,0,300,n));e._minsCol=u++;break;case"t":r.push([{text:o.amDesignator,value:0,itemId:"itemIdAM"},{text:o.pmDesignator,value:43200,itemId:"itemIdPM"}]);e._amPmCol=u++}n=null;t=0}h&&(n=h,t=1)}e._sourceData=r},e._createArray=function(n,t,i,r,u,f,e){for(var s=[],o=n,h=u;o<=t;o+=i,h+=f)s.push({text:(o<10&&r?"0":"")+o,value:h,itemId:"itemId"+o.toString()+e});return s},e}(o);n.registerControl("TimeControl",fi);ei=function(i){function r(){var t=i.call(this)||this,e,u,f;return t._isFocused=!1,e=r._supportsPlaceholder,t.defineProperty("watermark"),t.defineProperty("maxLength"),t.defineProperty("value",e?null:t._onValueChanged),t.onEnter=new h,u={onKeydown:function(n){return t._onKeydown(n)}},f=r._commonTemplate,e?f+=r._dataTagTemplate+=r._placeholderTemplate:(f+=r._dataTagTemplate+=r._downlevelTemplate,u.onFocus=function(){return t._onFocus()},u.onBlur=function(){return t._onBlur()}),t.setTemplate(new n(f,u)),t}return t(r,i),r.prototype._onKeydown=function(n){if(this.onEnter.hasHandlersRegistered&&n.type==="keydown"){var t=n;(t.keyCode===13||t.which===13)&&this.onEnter.invoke()}},r.prototype._onFocus=function(){this._isFocused=!0;this._showWatermark(!1)},r.prototype._onBlur=function(){this._isFocused=!1;this.getValue()===""&&this._showWatermark(!0)},r.prototype._onValueChanged=function(n,t){this._isFocused||this._showWatermark(!t)},r.prototype._showWatermark=function(n){var t=this.getRootElement(),i=t[0],u=r._className;n?(i.value=this.getWatermark(),t.add_class(u)):(i.value=this.getValue(),t.remove_class(u))},r._supportsPlaceholder="placeholder"in document.createElement("input"),r._commonTemplate='<input type="text" maxlength="{TemplateBinding maxLength}" title="{TemplateBinding watermark}" value="{TemplateBinding Value Mode=TwoWay}" event:keydown="onKeydown"',r._placeholderTemplate=' placeholder="{TemplateBinding watermark}" />',r._dataTagTemplate=' data-tag="watermarkInput"',r._downlevelTemplate=' event:focus="onFocus" event:blur="onBlur" />',r._className="watermarkText",r}(o);n.registerControl("WatermarkedTextInput",ei);b=function(){function n(n,t){var i,r;e.assertNotNull(n,"sourceCrs");e.assertNotNull(t,"destinationRegionId");this._xOffset=-t.bounds[3];this._yOffset=-t.bounds[0];this._xScale=t.pixelWidth/(t.bounds[1]-t.bounds[3]);this._yScale=t.pixelHeight/(t.bounds[2]-t.bounds[0]);this._sourceCrs=n;this.destinationCrs=t.crs;i=this.destinationCrs.bounds;this._destinationCrsWidth=i[1]-i[3];r=this._sourceCrs.getMatrix&&this._sourceCrs.getMatrix(this.destinationCrs);r&&(this._matrix=r.translate(this._xOffset,this._yOffset).scale(this._xScale,this._yScale))}return n.prototype.project=function(n,t){this._project(n,t,!0,0)},n.prototype._project=function(n,t,i,r){if(this._matrix&&!r)this.lastProjectedX=this._matrix.projectX(n,t),this.lastProjectedY=this._matrix.projectY(n,t);else{var u=this._sourceCrs.toLatitude(n,t),f=this._sourceCrs.toLongitude(n,t);this.lastRawX=this.destinationCrs.projectToX(u,f,i);this.lastRawY=this.destinationCrs.projectToY(u,f);this._projectFromRawCoordinate(this.lastRawX,this.lastRawY,r)}},n.prototype._projectFromRawCoordinate=function(n,t,i){this.lastRawX=n;this.lastRawY=t;i&&(i=i*this._destinationCrsWidth||0);this.lastProjectedX=(n+this._xOffset+i)*this._xScale;this.lastProjectedY=(t+this._yOffset)*this._yScale},n.prototype.getMatrix=function(){return this._matrix},n.prototype.calculateProjectedCoordinates=function(n,t,i,r){if(t.rawX[n])this._projectFromRawCoordinate(t.rawX[n],t.rawY[n],i);else{var u=r?f._clamp(t.x[n],r.minPoint.x,r.maxPoint.x):t.x[n],e=r?f._clamp(t.y[n],r.minPoint.y,r.maxPoint.y):t.y[n];this._project(u,e,!1,i);t.rawX[n]=this.lastRawX;t.rawY[n]=this.lastRawY}},n}();oi=function(){function n(n){var t=this;this._map=n;this._map.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(t._resetTemplateSelector=!0)});this._cache=new li(5)}return n.prototype.getMarkupStyle=function(n,t,i){i===void 0&&(i=1);var r;return n&&this._baseMapTemplateSelector&&(r=this._baseMapTemplateSelector.getMarkupStyle(n,t,2,i)),r},n.prototype.getTemplates=function(n){var r,i,u,t,e;if(n instanceof yi)i=s.getValue(n,"image"),i||(i=f._getImageFromCss("defaultPushpinImg"),s.setValue(n,"image",i)),i&&(u=i,u.records?r=new tt(u):(t=s.getValue(n,"anchor"),t?t instanceof a?t=new v(t.x,t.y):t instanceof v||(t=new v(0,0)):t=new v(13,39),s.setValue(n,"anchor",t),e=i instanceof HTMLImageElement?i.currentSrc:i,r=this._cache.getItem(e),r||(r=new et(i,1,t,n),this._cache.addItem(e,r))));else{if(n.getTemplates)return n.getTemplates();n.getTemplate&&(r=n.getTemplate())}return[r]},n.prototype.selectorReady=function(){var n=this;return!this._baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._resetTemplateSelector=!1,n._baseMapTemplateSelector.selectorReady()}):this._baseMapTemplateSelector.selectorReady()},n}();u.ContentControl=w;u.Control=o;u.ControlTemplate=n;u.InfoboxOverlayTemplate=ut;u.Template=ft;i.BasicTemplate=wi;i.BitmapImageTemplate=et;i.BucketPrimitiveTemplateSelector=bi;i.ChildVectorImageTemplate=ki;i.CommonTemplates=di;i.CoordinateProjection=b;i.DefaultTemplateSelector=oi;i.VectorImageTemplate=tt}catch(si){if(i.logger)i.logger.logCriticalError(si);else throw si;}}).call(window)