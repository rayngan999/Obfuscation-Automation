!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.IMUID=t():e.IMUID=t()}(this,(function(){return function(){var e={996:function(e,t){!function(){"use strict";var e={};!function(){var t=e;Object.defineProperty(t,"__esModule",{value:!0}),t.imUlid=void 0;var o="0123456789ABCDEFGHJKMNPQRSTVWXYZ";t.imUlid=function(){for(var e,t=Date.now(),n="",i=10;i--;)n=o[e=t%32]+n,t=(t-e)/32;i=16;var r=new Uint8Array(i);("crypto"in window?crypto:msCrypto).getRandomValues(r);for(;i--;)n+=o[31&r[i]];return n}}();var o=t;for(var n in e)o[n]=e[n];e.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})}()}},t={};function o(n){var i=t[n];if(i!==undefined)return i.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n={};return function(){"use strict";function e(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}o.d(n,{IMUID:function(){return c}});var u=o(996),a=function(){function e(){t(this,e)}return r(e,[{key:"push",value:function(e){var t;null===(t=window.IMUID)||void 0===t||t.run(e)}}]),e}(),s=function(){function o(){var n=this;(t(this,o),e(this,"IMUIDs",{}),e(this,"msToExpire",2592e6),window.IMUIDRequest&&window.IMUIDRequest instanceof Array)&&(window.IMUIDRequest.forEach((function(e){n.run(e)})),window.IMUIDRequest=new a)}return r(o,[{key:"run",value:function(e){if("customerId"in e&&"callback"in e){var t,n=e,i=this.getCookie(o.VISITOR_COOKIE_NAME)===o.OPTOUT_VALUE;if(i)return void e.callback({uid:"",vid:"",optouted:i,status:"done",loopbacks:null!==(t=null==n?void 0:n.loopbacks)&&void 0!==t?t:null});this.IMUIDs[n.customerId]={};var r=this.getVid();this.getUid({vid:r,seed:n,onLoad:function(e){var t;n.callback({vid:r,uid:e,optouted:!1,status:"done",loopbacks:null!==(t=null==n?void 0:n.loopbacks)&&void 0!==t?t:null})},onTimeout:function(){var e;n.callback({uid:"",vid:"",optouted:!1,status:"timeout",loopbacks:null!==(e=null==n?void 0:n.loopbacks)&&void 0!==e?e:null})}})}else if("optout"in e){e.optout?this.setCookie(o.VISITOR_COOKIE_NAME,o.OPTOUT_VALUE):this.setCookie(o.VISITOR_COOKIE_NAME,"")}}},{key:"get",value:function(e){return this.IMUIDs[e+""].uid}},{key:"getCookie",value:function(e){for(var t=e.length+1,o=document.cookie.split("; "),n="",i=0;i<o.length;i++)if(o[i].substr(0,t)===e+"="){n=o[i].substr(t,o[i].length);break}return n}},{key:"setCookie",value:function(e,t,o,n){var i;o=null!==(i=o)&&void 0!==i?i:"."+window.location.hostname,n=void 0===n?"https:"===window.location.protocol:!!n;var r=new Date;r.setTime(r.getTime()+this.msToExpire),document.cookie=e+"="+t+(this.msToExpire?"; expires="+r.toUTCString():"")+"; path=/"+(o?"; domain="+o:"")+(n?"; SameSite=none; Secure;":";")}},{key:"isImid",value:function(e){return"string"==typeof e&&0===e.indexOf(o.IMID_PREFIX)}},{key:"setCustomerUid",value:function(e,t){this.IMUIDs[e].uid=t}},{key:"getVid",value:function(){var e=this.getCookie(o.VISITOR_COOKIE_NAME);return e||(e=(0,u.imUlid)()),this.setCookie(o.VISITOR_COOKIE_NAME,e),e}},{key:"getPreferUid",value:function(e,t){return this.isImid(t)?t:e||t}},{key:"fetchData",value:function(e){var t=e.url,o=e.onLoad,n=e.onTimeout,i=e.timeout,r=void 0===i?1e4:i,u=new XMLHttpRequest,a=setTimeout((function(){u.abort(),n&&n()}),r);u.onload=function(){clearTimeout(a),o&&o(u.responseText)},u.withCredentials=!0,u.open("GET",t,!0),u.send(null)}},{key:"getUid",value:function(e){var t=this,n=e.vid,i=e.seed,r=e.onLoad,u=e.onTimeout,a="https://".concat(i.SYNC_URL||o.SYNC_URL,"?vid=").concat(n,"&cid=").concat(i.customerId);this.fetchData({url:a,onLoad:function(e){var o=JSON.parse(e).uid,n=i.customerId,u=t.IMUIDs[n].aggrid||"",a=t.getPreferUid(u,o);t.setCustomerUid(n,a),r(a)},onTimeout:function(){u&&u()},timeout:i.callbackTimeout})}}]),o}();e(s,"IMID_PREFIX","i"),e(s,"SYNC_URL","audiencedata.im-apps.net/imuid/get"),e(s,"VISITOR_COOKIE_NAME","_im_vid"),e(s,"OPTOUT_VALUE","optout"),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var c="IMUID"in window?window.IMUID:new s}(),n=n.IMUID}()}));