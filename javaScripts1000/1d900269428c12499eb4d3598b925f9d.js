Cube("datav:/com/ml-line-basic/1.7.18/line",["datav:/com/maliang-utils/0.0.25","datav:/npm/bcore/0.0.22/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.17.11","datav:/npm/dchart-line-with-point-area/0.4.35","datav:/npm/d3/3.5.12/d3","datav:/npm/moment/2.19.1"],function(a,b,c){function d(a){return g.isNumber(a)&&!g.isNaN(a)&&g.isFinite(a)?a:null}var e=c("datav:/npm/bcore/0.0.22/event"),f=c("datav:/npm/jquery/2.1.4"),g=c("datav:/npm/lodash/4.17.11"),h=c("datav:/npm/dchart-line-with-point-area/0.4.35"),i=c("datav:/com/maliang-utils/0.0.25"),j=c("datav:/npm/d3/3.5.12/d3"),k=c("datav:/npm/moment/2.19.1"),l=Symbol();return a.exports=e.extend(function(a,b){this.config={theme:{},chart:{},tooltip:{show:!0,trigger:"item",triggerMethod:"hover",beforeFormat:null,formatter:"xyAxisChart",enterFocus:!0,axisPointer:{show:!0,_type:"line",lineStyle:{color:"#f00",width:1,_type:"solid"}},hideDelay:300,textStyle:{color:"#fff",fontSize:14,fontFamily:"Microsoft Yahei",fontWeight:"normal"},bgBox:{color:"rgba(0, 0, 0, 0.65)",padding:10,xOffset:6,yOffset:10,customSize:{show:!1,width:300,height:150},borderColor:"#333",borderWidth:0}}},this.container=f(a),this.apis=b.apis,this._data=null,this.chart=null,this.init(b)},{init:function(a){this.mergeConfig(a),this.updateLayout(),this.chart=new h(this.container[0],this._getChartOptions()),this.chart.updateBeforeRender=this.chart.beforeRender},_getChartOptions:function(a){var b=g.cloneDeep(this.config),c=g.cloneDeep(b.chart),e=b.xaxis,f=b.yaxis;c.xaxis=g.clone(e),c.yaxis=g.clone(f),c.series=g.clone(b.series),c.series.length&&c.series.forEach(function(a){if(a.color=a.line.color,a.colorWidth=a.line["stroke-width"],a.style=a.line.style,a.point.hide=!a.point.show,a.area.hide=!a.area.show,a.line.interpolate&&(a.interpolate=i.getCustomSmoothSpline),a.label["font-size"]=a.label.fontSize,f.label.format&&f.label.format.includes("%")){var b=j.format(f.label.format);a.label&&(a.label.format=function(a,c){return b(a.y[c]&&a.y[c].value)})}}),c.xaxis.padding=[b.chart.innerPadding,b.chart.outerPadding],c.xaxis.fontSize=e.textarea.fontSize||null,c.xaxis.fontColor=e.textarea.color,c.xaxis.fontWeight=e.textarea.fontWeight,c.xaxis.fontStrokeWidth=e.textarea.fontStrokeWidth,c.xaxis.textShow=e.label.show,c.xaxis.type=e.label.category,c.xaxis.ticks=e.label.amount,"time"===c.xaxis.type?c.xaxis.tickFormat=j.time.format(e.label.format):"defaults"===c.xaxis.type?c.xaxis.tickFormat=e.label.format:(c.xaxis.tickFormat=null,c.xaxis.ticks=c.xaxis.ticks||a&&a.length||null),c.xaxis.padding="category"===c.xaxis.type?[e.label.innerPadding,e.label.outerPadding]:null,c.xaxis.max=null===e.label.max?null:e.label.max,c.xaxis.min=null===e.label.min?null:e.label.min,c.xaxis.format=e.label.dataFormat,c.xaxis.blank=e.label.blank,c.xaxis.blankDis=e.label.blankDis;var h=e.label.max,k=e.label.min;if("time"===c.xaxis.type&&(c.xaxis.max=c.xaxis.max&&"auto"!==c.xaxis.max?e.label.max:null,c.xaxis.min=c.xaxis.min&&"auto"!==c.xaxis.min?e.label.min:null),"defaults"===c.xaxis.type)if(c.xaxis.blank&&a){var l=g.map(a,"x"),m=g.max(l),n=g.min(l),o=(m-n)*e.label.blankDis;c.xaxis.max=c.xaxis.max&&"auto"!==c.xaxis.max?g.toNumber(h)+o:m+o,c.xaxis.min=c.xaxis.min&&"auto"!==c.xaxis.min?g.toNumber(k)-o:n-o}else c.xaxis.max=c.xaxis.max?d(g.toNumber(e.label.max)):null,c.xaxis.min=c.xaxis.min?d(g.toNumber(e.label.min)):null;if(c.xaxis.dy=e.label.dy,c.xaxis.assistLine=e.assistLine.show,c.xaxis.assistLineColor=e.assistLine.color,null===d(g.toNumber(f.label.max))?"dataMax"===f.label.max?(c.yaxis.max=null,c.yaxis.maxNeedNice=!1):(c.yaxis.max=null,c.yaxis.maxNeedNice=!0):(c.yaxis.max=+f.label.max,c.yaxis.maxNeedNice=!1),null===d(g.toNumber(f.label.min))?"dataMin"===f.label.min?(c.yaxis.min=null,c.yaxis.minNeedNice=!1):(c.yaxis.min=0,c.yaxis.minNeedNice=!0):(c.yaxis.min=+f.label.min,c.yaxis.minNeedNice=!1),c.yaxis.ticks=f.label.amount||null,c.yaxis.fontSize=f.textarea.fontSize||null,c.yaxis.fontColor=f.textarea.color,c.yaxis.fontWeight=f.textarea.fontWeight,c.yaxis.fontStrokeWidth=f.textarea.fontStrokeWidth,c.yaxis.textShow=f.label.show,c.yaxis.dy=f.label.dy,f.label.format&&f.label.format.includes("%")){switch(f.label.format){case"%":c.yaxis.tickFormat=".0f";break;case".1%":c.yaxis.tickFormat=".2f";break;case".2%":default:c.yaxis.tickFormat=".4f";}c.yaxis.format=f.label.format}else c.yaxis.format=null,c.yaxis.tickFormat=f.label.format||function(a){return a};c.yaxis.assistLine=f.assistLine.show,c.yaxis.assistLineColor=f.assistLine.color,c.xaxis.rotate=g.toNumber(e.label.angle),c.xaxis.label="category"!==e.label.category&&""!==e.label.unit?e.label.unit||null:null,c.yaxis.rotate=g.toNumber(f.label.angle),c.yaxis.label=f.unit.show&&f.unit.value||null,c.xaxis.net=e.net.show,c.xaxis.netColor=e.net.color,c.yaxis.net=f.net.show,c.yaxis.netColor=f.net.color,c.legend=b.legend,c.legend.show=!1,c.beforeLayout=null;var p=b.chart.margin,q=p.top,r=p.right;c.margin.top=q||c.yaxis.show&&c.yaxis.textShow&&c.yaxis.label&&3*f.textarea.fontSize||0,c.margin.right=r||c.xaxis.show&&c.xaxis.textShow&&c.xaxis.label&&c.xaxis.label.length&&3*e.textarea.fontSize||0,c.xaxis.format=e.label.dataFormat,c.hiddenEmptyData=!b.chart.emptyData;var s=b.animation;if(c.animation=s.show,c.animationDuration=s.animationDuration,c.animationEasing=s.animationEasing,c.animationUpdateFromPrevious=s.animationUpdateFromPrevious,c.animationDurationUpdate=s.animationDurationUpdate,b.tooltip){var t=b.tooltip,u=t.axisPointer,v=t.textStyle,w=t.bgBox;c.tooltip||(c.tooltip={}),void 0!==t.show&&(c.tooltip.show=t.show),t.trigger&&(c.tooltip.trigger=t.trigger),t.triggerMethod&&(c.tooltip.triggerMethod=t.triggerMethod),t.beforeFormat&&(c.tooltip.beforeFormat=t.beforeFormat),c.tooltip.formatter="xyAxisChart",void 0!==t.enterFocus&&(c.tooltip.enterFocus=t.enterFocus),void 0!==t.hideDelay&&(c.tooltip.hideDelay=t.hideDelay),u&&u._type&&(c.tooltip.axisPointer=u._type),u&&u.lineStyle&&(c.tooltip.lineStyle=u.lineStyle),v&&(c.tooltip.color=v.color,c.tooltip.fontSize=v.fontSize+"px",c.tooltip.fontFamily=v.fontFamily,c.tooltip.fontWeight=v.fontWeight),w&&(w.color&&(c.tooltip.backgroundColor=w.color),void 0!==w.padding&&(c.tooltip.padding=w.padding),void 0!==w.xOffset&&(c.tooltip.xOffset=w.xOffset),void 0!==w.yOffset&&(c.tooltip.yOffset=w.yOffset),w.customSize&&(c.tooltip.autoSize=!w.customSize.show,c.tooltip.width=w.customSize.width,c.tooltip.height=w.customSize.height),w.borderColor&&(c.tooltip.borderColor=w.borderColor),void 0!==w.borderWidth&&(c.tooltip.borderWidth=w.borderWidth))}return c},render:function(a,b){if(b=this.mergeConfig(b),a=this.data(a,b),a&&a.length){var c=this._getChartOptions(a);this.chart.render(a,c),this.updateStyle()}},resize:function(a,b){this.updateLayout(a,b),this._data&&this._data.length&&(this.chart.render(this._data,{width:a,height:b}),this.updateStyle())},setColors:function(){},setOriginalData:function(a){this[l]=a},getOriginalData:function(){return this[l]},data:function(a,b){b=this.mergeConfig(b),a&&this.setOriginalData(a),a||(a=this.getOriginalData());var c=b&&b.chart&&b.chart.loadAmount||2e3;c&&(a=a.slice(0,c));var d=this.config.xaxis.label.category;return a&&a.length&&(this.__data=g.cloneDeep(a),this.hasS(this.__data)?("defaults"===d&&this.__data.sort(function(c,a){return c.x-a.x}),this._data=i.threeD2Two(this.__data,"x","y","s",i.getSeriesValue(this.__data,"s"),"time"===d&&function(c,a){return c<a?-1:1})):this._data=g.cloneDeep(this.__data).map(function(a){return a.y={value:a.y,data:g.clone(a),__isNull:!a.y},a})),this._data},mergeConfig:function(a){return a?(this.config.theme=g.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),a.series&&(this.config.series=a.series),this.config=g.defaultsDeep(a||{},this.config),this.config):this.config},updateLayout:function(){},updateStyle:function(){var a=this.chart.el;if(a){a.selectAll(".area-g .serie").style("stroke","none"),a.select(".con-svg").style("background","transparent"),a.selectAll(".series:not(.area-g):not(.scatterplot-g) .serie").style("fill","none");var b=g.get(this.config,"yaxis.label.format");if(b&&b.includes("%")){var c=j.format(""+b);a.selectAll(".axis2 .tick text").text(function(a){return g.isFunction(c)&&c(a)||a})}}},clear:function(){this.chart&&this.chart.empty()},destroy:function(){this.chart&&this.chart.off(),this.chart&&this.chart.destroy(),this._data=this.__data=null},updateOptions:function(a){this.mergeConfig(a),this.render()},hasS:function(a){var b=0;return g.map(a,function(a){void 0!==a.s&&b++}),b===a.length||0!==b&&!1}}),a.exports});;
Cube("datav:/com/ml-line-basic/1.7.18",["datav:/com/legend/0.1.2","datav:/com/maliang-utils/0.0.22","datav:/npm/bcore/0.0.22/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.17.11"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.22/event"),e=c("datav:/npm/jquery/2.1.4"),f=c("datav:/npm/lodash/4.17.11"),g=c("datav:/com/ml-line-basic/1.7.18/line"),h=c("datav:/com/legend/0.1.2"),i=c("datav:/com/maliang-utils/0.0.22");return a.exports=d.extend(function(a,b){this.config={theme:{},chart:{background:"transparent",margin:{top:36,bottom:0,left:20,right:40}},axis:{xaxis:{tickSize:2},yaxis:{tickSize:2}},legend:{innerStyle:{"line-height":1.3}},series:[{value:"1",color:"#2F8FBE"}],animation:{show:!0,animationDuration:1e3,animationDurationUpdate:300,animationUpdateFromPrevious:!0,animationEasing:"cubicInOut"}},this.container=e(a).css("padding","10px 0"),this.chart=null,this.legend=null,this.init(b)},{init:function(a){this.apis=a.apis;var b=this.mergeConfig(a),c=b.legend,d=c.layout.loc.split("-")[0];this.chartDom=e("<div class=\"dchart-bar-basic\" style=\"width: 100%;\"></div>"),this.legendDom=e("<div class=\"dchart-legend\" style=\"left: 0;width: 100%;\"></div>"),"bottom"===d?(this.container.append(this.chartDom),this.container.append(this.legendDom)):(this.container.append(this.legendDom),this.container.append(this.chartDom)),this.legend=new h(this.legendDom[0],b.legend);var i=f.cloneDeep(b.series);i.forEach(function(a){a.color=a.line.color}),this.legend.render(i,b.legend),this.chartDom.height(this.container.height()-(b.legend.show&&this.legendDom.height()||0)),this.chart=new g(this.chartDom[0],f.cloneDeep(b)),this.legendDom.css("display",c.show&&"block"||"none"),this._bindEvent()},render:function(a,b){var c=this.mergeConfig(b);if(a=this.data(a),a&&a.length){var d=i.conflictConfigWithData(c,a,[{configField:{type:"array",field:"serieName",parent:"series"},dataField:"s",priority:"config",newConfigField:"showName"}]),e=f.cloneDeep(d.series);e.forEach(function(a){a.color=a.line.color}),this.legend.render(e,d.legend),this.config.chart.height=this.container.height()-(this.config.legend.show&&this.legendDom.height()||0),this.chartDom.height(this.config.chart.height),a&&this.chart.render(a,d),this.emit("after-render"),this._cfg=d}},updateOptions:function(a){var b=a.legend,c=this.config.legend;f.isEqual(c,b)||this.updateLegendLayout(b),this.render(null,a)},updateStyle:function(){},setColors:function(){},data:function(a){return a&&(this._data=f.clone(a),this._data.length&&this._data.forEach(function(a){a.y=f.toNumber(a.y)})),this._data},mergeConfig:function(a){return a?(this.config.theme=f.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),a.series&&(this.config.series=a.series),this.config=f.defaultsDeep(a||{},this.config),this.config.legend.textarea.fontFamily=this.config.chart.fontFamily,this.config):this.config},resize:function(a,b){var c=b-(this.config.legend.show&&this.legendDom.outerHeight()||0)-20;this.mergeConfig({chart:{width:a,height:c}}),this.chart.resize(a,c)},updateLegendLayout:function(a){var b=this.config.legend;if(b.show!==a.show&&(this.legendDom.css("display",a.show&&"block"||"none"),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)),b.textarea.fontSize!==a.textarea.fontSize&&(this.legendDom.find(".legend-item").css("fontSize",a.textarea.fontSize),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)),JSON.stringify(b.layout.margin)!==JSON.stringify(a.layout.margin)){var c=a.layout.margin;this.legendDom.find(".legend-item").css("margin",c.vertiInterval+"px "+c.horiInterval+"px"),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)}var d=b.layout.loc.split("-")[0],e=a.layout.loc.split("-")[0];d!==e&&("top"===e?this.container[0].appendChild(this.chartDom[0]):"bottom"===e&&this.container[0].appendChild(this.legendDom[0])),this.render(null,{legend:a})},clear:function(){this.chart&&this.chart.clear(),this.legend&&f.isFunction(this.legend.clear)&&this.legend.clear()},destroy:function(){this.chart&&this.chart.destroy(),this.chart=null,this.legend&&this.legend.destroy(),this.legend=null,this.chartDom=null,this.legendDom=null,this.container&&this.container.empty(),this._data=null},startAnimate:function(){if(!(this.chart&&this.chart.chart))return!1;if(this._cfg){this.chart.chart.clearAllAnimation();var a=this._cfg.animation,b=a.animationUpdateFromPrevious;a.animationUpdateFromPrevious=!1;var c=a.animationDurationUpdate;a.animationDurationUpdate=a.animationDuration,this.chart.render(this.data(),this._cfg),this.emit("after-render"),a.animationDurationUpdate=c,a.animationUpdateFromPrevious=b}},clearAnimate:function(){this.chart&&this.chart.chart&&this.chart.chart.resumeToAnimationEnd()},_bindEvent:function(){var a=this;if(this.chart&&this.chart.chart){var b=this.chart.chart;["click"].forEach(function(c){b.on(c,function(b){var d=b.data;return a.emit(c,d)})})}},highlight:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=a.data,c=a.options,d=void 0===c?{}:c;return this.chart?void(d.hasOwnProperty("selectMode")&&(d.mode=d.selectMode,delete d.selectMode),d.hasOwnProperty("cancelHighlightFirst")&&d.cancelHighlightFirst&&this.cancelHighlight(),this.chart.chart&&this.chart.chart.highlight({targetData:b,options:d})):null},cancelHighlight:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=a.data,c=a.options,d=void 0===c?{}:c;return this.chart?void(d.hasOwnProperty("selectMode")&&(d.mode=d.selectMode,delete d.selectMode),this.chart.chart&&this.chart.chart.cancelHighlight({targetData:b,options:d})):null}}),a.exports});