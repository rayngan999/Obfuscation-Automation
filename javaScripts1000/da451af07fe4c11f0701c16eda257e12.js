(function(){try{var i=window.$MicrosoftMaps8,n=i.Internal,d=n._BoundsAccumulator,u=n._Debug,g=n._Dispatcher,nt=n._WorkDispatcher,tt=n._EventBinding,it=n._Gimme,f=n._Helper,rt=n._JSEvent,ut=i.ImageryMapLayer,o=n._LatLonCrs,b=i.LocationRect,c=n._LruCache,e=i.Location,ft=i.MapMath,et=n._MercatorCube,ot=i.MercatorCubeCrs,st=n._MercatorTileUtility,ht=n._Observable,ct=n._ObservableObject,lt=n._Overlay,at=n._OverlayManager,r=i.Point,vt=i.Size,l=n._VectorMath,yt=i.VectorMapLayer,pt=n._Network,wt=n._GeometryGeneralizer,bt=i.BasicTemplate,kt=i.GlobalConfig,s=function(){function n(n,t,i,r,f,e){var l,s,h,a;r===void 0&&(r=256);f===void 0&&(f=256);e===void 0&&(e=o.instance);u.assertIsInteger(n,"x");u.assertIsInteger(t,"y");u.assertIsInteger(i,"zoom");u.assertIsInteger(r,"width");u.assertIsInteger(f,"height");l=1<<i;this.x=n;this.y=t;this.zoom=i;this.pixelWidth=r;this.pixelHeight=f;this.crs=e;s=(e.bounds[1]-e.bounds[3])/l;h=(e.bounds[2]-e.bounds[0])/l;this.bounds=[e.bounds[0]+h*t,e.bounds[3]+s*n+s,e.bounds[0]+h*t+h,e.bounds[3]+s*n,];var c="",v=n,y=t;for(a=0;a<i;a++)c=((v&1)+2*(y&1)).toString()+c,v>>=1,y>>=1;this.quadKey=c;this._stringValue=e.id+"PryamidTile"+c}return n.prototype.getParent=function(){var t=null;return this.zoom>1&&(t=new n(Math.floor(this.x/2),Math.floor(this.y/2),this.zoom-1,this.pixelWidth,this.pixelHeight)),t},n.prototype.toString=function(){return this._stringValue},n.fromQuadKey=function(t,i,r,u){var f,s,h;u===void 0&&(u=o.instance);var c=0,l=0,e=t.length;for(f=e;f>0;f--)s=1<<f-1,h=t.charCodeAt(e-f)-48,h&1&&(c|=s),h&2&&(l|=s);return new n(c,l,e,i,r,u)},n.areEqual=function(n,t){return n&&t&&n.quadKey===t.quadKey&&n.crs===t.crs},n}(),t=function(){function n(){}return n.getLodFromGroundResolution=function(n,t,i){var u=Math.cos(t*l.radiansPerDegree)*156543.04,r=l.log2(u/n);return r=Math.round(r),Math.max(r-i,1)},n.getTileIdFromLocation=function(t,i,r){var u=n.latLongToPixelXY(t,i);return r&&(u.x+=r.x,u.y+=r.y),n.pixelXYToTileXY(u)},n.getMapSize=function(t){return n.tileLength<<t},n.latLongToPixelXY=function(t,i){var s=f._clamp(t.latitude,n.minLatitude,n.maxLatitude),h=e.normalizeLongitude(t.longitude),c=(h+180)/360,o=Math.sin(s*Math.PI/180),l=.5-Math.log((1+o)/(1-o))/(4*Math.PI),u=n.getMapSize(i),a=Math.floor(f._clamp(c*u+.5,0,u-1)),v=Math.floor(f._clamp(l*u+.5,0,u-1));return new r(a,v)},n.pixelXYToTileXY=function(t){var i=Math.floor(t.x/n.tileLength),u=Math.floor(t.y/n.tileLength);return new r(i,u)},n.pixelXYToTile=function(t,i){var r=Math.floor(t.x/n.tileLength),u=Math.floor(t.y/n.tileLength);return new s(r,u,i,n.tileLength,n.tileLength,o.instance)},n.tileXYToPixelXY=function(t){var i=t.x*n.tileLength,u=t.y*n.tileLength;return new r(i,u)},n.tileToPixelXY=function(t){var i=t.x*n.tileLength,u=t.y*n.tileLength;return new r(i,u)},n.pixelXYToLatLong=function(t,i){var r=n.getMapSize(i),u=f._clamp(t.x,0,r-1)/r-.5,o=.5-f._clamp(t.y,0,r-1)/r,s=90-360*Math.atan(Math.exp(-o*2*Math.PI))/Math.PI,h=360*u;return new e(s,h)},n.quadKeyToLocationRect=function(t){var i=t.length,u=n.quadKeyToTileXY(t),f=u.x*n.tileLength,e=u.y*n.tileLength,o=f+n.tileLength,s=e+n.tileLength;return b.fromCorners(n.pixelXYToLatLong(new r(f,e),i),n.pixelXYToLatLong(new r(o,s),i))},n.quadKeyToTileXY=function(n){for(var t,u=0,f=0,e=n.length,i=e;i>0;i--){t=1<<i-1;switch(n[e-i]){case"0":break;case"1":u|=t;break;case"2":f|=t;break;case"3":u|=t;f|=t;break;default:throw new Error("Invalid QuadKey digit sequence.");}}return new r(u,f)},n.tileLength=256,n.minLatitude=-85.05112878,n.maxLatitude=85.05112878,n.minLongitude=-180,n.maxLongitude=180,n}(),a=function(){function n(n){this._lodOffset=n?n:0}return n.prototype.getRegionsInBounds=function(i,r,u,f){u===void 0&&(u=t.tileLength);var e=r-.001*r,o=n._getLodFromScale(e,this._lodOffset);return n._getRegionsInternal(i,o,u,f)},n.prototype.getRegions=function(i,r,u,f){u===void 0&&(u=t.tileLength);var e=t.getLodFromGroundResolution(r,i.center.latitude,this._lodOffset);return n._getRegionsInternal(i,e,u,f)},n._getLodFromScale=function(t,i){for(var u,f=n._scaleToLod.length,r=0;r<f;r++)if(u=n._scaleToLod[r],t<=u.scale)return Math.max(u.lod-i,1)},n._getRegionsInternal=function(n,f,e,o){var l,y,a;u.assertIsInteger(f,"lod");var h=t.getTileIdFromLocation(n.getNorthwest(),f,new r(1,1)),c=t.getTileIdFromLocation(n.getSoutheast(),f,new r(-1,-1)),p=[],v=t.getMapSize(f)/e,w=h.x<=c.x?c.x-h.x+1:v+c.x-h.x+1;for(n.crossesInternationalDateLine()&&n.width>=180&&h.x===c.x&&(w=v),l=h.x,y=0;y<w;y++){for(l===v&&(l=0),a=h.y;a<=c.y;a++)p.push(new s(l,a,f,e,e,o?o:i.MercatorCubeCrs.instance));l++}return p},n._scaleToLod=[{scale:.0187,lod:23},{scale:.0373,lod:22},{scale:.0746,lod:21},{scale:.1493,lod:20},{scale:.2986,lod:19},{scale:.5972,lod:18},{scale:1.1943,lod:17},{scale:2.3887,lod:16},{scale:4.7773,lod:15},{scale:9.5546,lod:14},{scale:19.1093,lod:13},{scale:38.2185,lod:12},{scale:76.437,lod:11},{scale:152.8741,lod:10},{scale:305.7481,lod:9},{scale:611.4962,lod:8},{scale:1222.9925,lod:7},{scale:2445.9849,lod:6},{scale:4891.9698,lod:5},{scale:9783.9396,lod:4},{scale:19567.8792,lod:3},{scale:39135.7585,lod:2},{scale:Number.POSITIVE_INFINITY,lod:1}],n}(),v=function(){function n(n,t,i,r){this.image=n;this.cacheKey=t;this.tileRegion=i;this.requestedRegion=r||i}return n}(),y=function(){function n(){}return n.addTile=function(t,i){u.assertNotNull(t,"tile");t&&(i?n._sharedBackgroundCache.addItem(t.cacheKey,t):n._sharedCache.addItem(t.cacheKey,t))},n.getTile=function(t,i){return i?n._sharedBackgroundCache.getItem(t):n._sharedCache.getItem(t)||n._sharedBackgroundCache.getItem(t)},n.getBackgroundTile=function(t,i){var r;return r=i?n._sharedBackgroundCache.getInternalDictionary()[t]:n._sharedCache.getInternalDictionary()[t]||n._sharedBackgroundCache.getInternalDictionary()[t],r&&r.item},n._sharedCacheSize=256,n._sharedBackgroundCacheSize=64,n._sharedCache=new c(n._sharedCacheSize),n._sharedBackgroundCache=new c(n._sharedBackgroundCacheSize),n}(),p=function(){function n(n){this._quadKey=n.quadKey;this.id="sheetcrs-"+n.quadKey;this._tileXY=t.quadKeyToTileXY(n.quadKey);this.bounds=n.bounds}return n.prototype.projectToX=function(i,r){var u=this._getSheetLod(),f=new e(i,r),o=t.latLongToPixelXY(f,u),s=t.tileXYToPixelXY(this._tileXY),h=n._maxValue/256;return(o.x-s.x)*h},n.prototype.projectToY=function(i,r){var u=this._getSheetLod(),f=new e(i,r),o=t.latLongToPixelXY(f,u),s=t.tileXYToPixelXY(this._tileXY),h=n._maxValue/256;return(o.y-s.y)*h},n.prototype.toLatitude=function(i,u){var s=this._getSheetLod(),f=new r(this._tileXY.x,this._tileXY.y),e,o;return f.x+=i/n._maxValue,f.y+=u/n._maxValue,e=t.tileXYToPixelXY(f),o=t.pixelXYToLatLong(e,s),o.latitude},n.prototype.toLongitude=function(i,u){var s=this._getSheetLod(),f=new r(this._tileXY.x,this._tileXY.y),e,o;return f.x+=i/n._maxValue,f.y+=u/n._maxValue,e=t.tileXYToPixelXY(f),o=t.pixelXYToLatLong(e,s),o.longitude},n.prototype._getSheetLod=function(){return this._quadKey.length},n._maxValue=512,n}(),h=function(){function n(n){this.quadKey=n;this.lod=n.length;this.crs=new p(this);this.bounds=this.crs.bounds}return n}(),k=function(){function n(){this._pyramidTileSpatialIndex=new a(1)}return n.prototype.getRegionsInBounds=function(n,t){for(var f,e,r=[],u=this._pyramidTileSpatialIndex.getRegionsInBounds(n,t),i=0;i<u.length;i++)f=u[i].quadKey,e=new h(f),r.push(e);return r},n.prototype.getRegions=function(n,t){for(var f,e,r=[],u=this._pyramidTileSpatialIndex.getRegions(n,t),i=0;i<u.length;i++)f=u[i].quadKey,e=new h(f),r.push(e);return r},n}();i.PyramidTileId=s;n.PyramidTileSpatialIndex=a;n.SheetId=h;n.SheetCrs=p;n.SheetSpatialIndex=k;n.TileSystemHelper=t;n.RasterTileCache=typeof y!="undefined"?y:null;n.RasterTile=typeof v!="undefined"?v:null}catch(w){if(i.logger)i.logger.logCriticalError(w);else throw w;}}).call(window)