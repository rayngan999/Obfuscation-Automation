(function(){var ri,lu,au,fi,ur,fr,dt,vu,er,or,sr,yu,hr,pu,cr,wu,lr,ar,vr,wi,bi,yr,ci,pr,ei,du,ki,wr,br,oi,tf,rf,nt;try{(function(){var n={L_OverlayEntity_AddMyPlaces:"Add to favorites",L_OverlayEntity_SaveAsFavorite:"Save as favorite",L_OverlayEntity_SaveAs:"Save as...",L_OverlayEntity_Save:"Save...",L_OverlayEntity_MoveTo:"Move to",L_AddNickNameOption:"Add a nickname",L_AddNoteOption:"Add a description",L_EditNickNameOption:"Edit nickname",L_EditNoteOption:"Edit description",L_DeleteEntityOption:"Remove",L_EditEntityOption:"Edit",L_DeleteNickNameOption:"Delete nickname",L_DeleteNoteOption:"Delete description",L_EditHomeWorkOption:"Edit",L_HideHomeWorkOption:"Hide from general Map",L_DisplayHomeWorkOption:"Always display on Map",L_OverlayEntity_AddPushpin:"Add a pin",L_OverlayEntity_Directions:"Directions",L_OverlayEntity_DirectionsTo:"Directions to",L_OverlayEntity_DirectionsFrom:"Directions from",L_OverlayEntity_AddToRoute:"Add to route",L_OverlayEntity_AddToItineraries:"Save to {0}",L_OverlayEntity_MoveToDay:"Move to",L_OverlayEntity_Nearby:"Nearby",L_OverlayEntity_OpenCard:"Show details",L_OverlayEntity_OpenNewCard:"Open as new card",L_TrafficScheduledConstruction_Text:"Scheduled construction",L_TrafficOtherNews_Text:"Other news",L_TrafficCongestion_Text:"Congestion",L_TrafficAccident_Text:"Accident",L_TrafficDisabledVehicle_Text:"Disabled vehicle",L_TrafficRoadHazard_Text:"Road hazard",L_TrafficUnScheduledContruction_Text:"Unscheduled construction",L_TrafficPlannedEvent_Text:"Planned event",L_TrafficMassTransit_Text:"Transit incident",L_TrafficWeather_Text:"Weather alert",L_TrafficMiscellaneous_Text:"Miscellaneous",L_TrafficSeverityMinor_Text:"Minor",L_TrafficSeverityModerate_Text:"Moderate",L_TrafficSeveritySerious_Text:"Serious",L_TrafficSeverityLowImpact_Text:"Low impact",L_TrafficPopupSeverity_Text:"Severity:",L_TrafficPopupStartTime_Text:"Start time:",L_TrafficPopupEstEndTime_Text:"Est. end time:",L_TrafficPopupDescription_Text:"Description:",L_TrafficCurrentCameraImage_Text:"Current traffic conditions image at {0}",L_TrafficPreviewCameraImage_Text:"Thumbnail preview of traffic conditions image at {0}",L_TrafficRecentCamerasTitle:"Recently viewed cameras",L_TrafficPopularCamerasTitle:"Popular cameras",L_TrafficIncidentsTitle:"Notifications",L_TrafficLegendsTitle:"Traffic legend",L_TrafficLegendsHeavy:"Heavy",L_TrafficLegendsModerate:"Moderate",L_TrafficLegendsLight:"Light",L_TrafficLegendsNoTraffic:"No traffic",L_TrafficLegendsClosed:"Road closed",L_TrafficLegendsSlow:"Slow",L_TrafficLegendsFast:"Fast",L_TrafficModuleMoreLink:"see more",L_TrafficModuleLessLink:"see less",L_TrafficBackButtonText:"return to summary",L_TrafficTaskTitle_Text:"Traffic",L_TrafficsZoomInNotification:"Zoom in to see more cameras",L_TrafficsNoCameraNotification:"Sorry, there are no cameras in this area",L_TrafficsToggleCameras:"Cameras",L_TrafficCameraDirectionNorth_Text:"Camera facing North",L_TrafficCameraDirectionSouth_Text:"Camera facing South",L_TrafficCameraDirectionEast_Text:"Camera facing East",L_TrafficCameraDirectionWest_Text:"Camera facing West",L_Traffic_Camera_Tip:"View camera at:",L_InfoboxCloseToolTip_Text:"Close",L_TrafficCameraDisclaimer_Text:"Traffic camera images must not be viewed while driving.  In law a person may be regarded as driving a vehicle whenever the engine is running.",L_StreetsideNoCoverageInstructions_Text:"Tap on a highlighted road to enter Streetside.",L_NavBarLocateMeToolTip_Text:"Locate me",L_NavBarMapSwitcherToolTip_Text:"Change the map style",L_NavBarRotateCCToolTip_Text:"Rotate left",L_NavBarRotateToolTip_Text:"Reset orientation",L_NavBarRotateCToolTip_Text:"Rotate right",L_NavBarStreetsideLabel_Text:"Streetside",L_NavBarTrafficLabel_Text:"Traffic",L_NavBarBirdseyeV2ExitTip_Text:"Exit Bird's eye",L_NavBarBirdseyeV2NotAvailableTip_PrimaryText:"No imagery available beyond this",L_NavBarBirdseyeV2NotAvailableTip_SecondaryText:"Pan to other areas with coverage",L_NavBarBirdseyeV2NotAvailableRotationTip_PrimaryText:"Rotation not available",L_NavBarZoomInToolTip_Text:"Zoom in",L_NavBarZoomOutToolTip_Text:"Zoom out",L_NavBarCloseRadialMenuToolTip_Text:"Close",L_NavBarOpenRadialMenuToolTip_Text:"View aerial, birds eye, and more...",L_StreetsideNoCoverageInMapView_Text:"Streetside isn't available here, press ESC to exit.",L_StreetsideMobileNoCoverageInMapView_Text:"Streetside isn't available here.",L_OverlayEntity_Streetside:"View streetside",L_OverlayEntity_BirdseyeV2:"View bird's eye",L_OverlayEntity_Zoom:"Zoom in",L_ScaleBarKilometers_Text:"km",L_ScaleBarMeters_Text:"m",L_ScaleBarMiles_Text:"miles",L_ScaleBarYards_Text:"yards",L_ScaleBarFeet_Text:"feet",L_TrafficDateTimeFormat:"{0} {1}",L_LocateMe_ChangeSettings_Text:"Manually change my location setting",L_LocateMe_Error_Text_Approximate_Location:"We could not retrieve your exact location, but think you may be in this area.",L_LocateMe_Error_Text_Setting:"We could not retrieve your exact location. This is your default location setting.",L_StreetsideAutoEntryTooltip_Text:"Did you know you can click on the blue lines to enter Streetside?",L_CurrentMapTypeToolTip_Text:"Current Map Type: {mapStyle}",L_RadialMenuAerialButtonToolTip_Text:"Aerial",L_RadialMenuAerialButtonDescription_Text:"A detailed look from above",L_RadialMenuBirdseyeButtonToolTip_Text:"Bird's eye",L_RadialMenuBirdseyeButtonDescription_Text:"A better angle of aerial photography",L_RadialMenuOrdnanceSurveyButtonToolTip_Text:"Ordnance Survey",L_RadialMenuOrdnanceSurveyButtonDescription_Text:"Maps for outdoor life (UK only)",L_RadialMenuRoadButtonToolTip_Text:"Road",L_RadialMenuRoadButtonDescription_Text:"A standard road map",L_RadialMenuStreetsideButtonToolTip_Text:"Streetside",L_RadialMenuStreetsideButtonDescription_Text:"Explore at eye level",L_DropDownMenuLabelToggleButtonToolTip_Text:"Labels",L_DropDownMenuLabelToggleButtonDescription_Text:"for Aerial and Bird's eye",L_OverlayEntity_AddAPushpin:"Add a pushpin",L_WalkingTime:"{0} min walk",L_NearbyParkingTitle:"Parking near {0}",L_NearbyParkingError:"Sorry, no nearby parking found!!",L_CameraImageErrorText:"This camera feed is currently unavailable.  Please try again later.",L_OverlayEntity_Coordinates:"Coordinates",L_OverlayEntity_Copy_Coordinates:"Copy",L_OverlayEntity_Copy_Succeeded:"Copied",L_OverlayEntity_ZoomOut:"Zoom out",L_OverlayEntity_Measure:"Measure distance",L_GeochainWorldText:"World",L_NavBarMapTypeSwitcherToolTip_Text:"Switch to {0}",L_NavBarTrafficToggleToolTip_TurnOn_Text:"Turn on traffic",L_NavBarTrafficToggleToolTip_TurnOff_Text:"Turn off traffic",L_DropDownMenuLabelToggleButtonDescription_Text_AerialOnly:"for Aerial",L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerial:"for Road and Aerial",L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerialBirdseye:"for Road, Aerial and Bird's eye",L_NavBarOpenRadialMenuToolTip_NoBirdseye_text:"View aerial and more...",L_RadialMenuLabelToggleToolTip_Text:"Turn labels on or off",L_RadialMenuLabelToggleDisabled_Text:"disabled",L_DraggableList_Keyboard_Drag_Start_Hint:"Press Enter to select the current row, then use up and down arrow keys to reorder. Press Enter again to deselect",L_DraggableList_Keyboard_Drag_Move_Hint:"Use the up and down arrow keys to reorder. Press Enter to deselect.",L_DraggableList_Keyboard_Drag_Top_Error_Hint:"You are in the top position",L_DraggableList_Keyboard_Drag_Bottom_Error_Hint:"You are in the bottom position",L_ZoomInButtonAriaLabel:"Current Level {0}, Zoom In ",L_ZoomOutButtonAriaLabel:"Current Level {0}, Zoom Out",L_ZoomButtonAriaLabelDisabled:"Disabled",L_CameraCloseAriaLabel:"Close Camera Popup",L_RadialMenuRoadDarkButtonToolTip_Text:"Dark road",L_RadialMenuRoadDarkButtonDescription_Text:"A darker-styled road map",L_RadialMenuGrayscaleButtonToolTip_Text:"Grayscale",L_RadialMenuGrayscaleButtonDescription_Text:"A grayscale map",L_RadialMenuCanvasDarkButtonToolTip_Text:"Canvas Dark",L_RadialMenuCanvasDarkButtonDescription_Text:"A dark style map",L_RadialMenuCanvasLightButtonToolTip_Text:"Canvas Light",L_RadialMenuCanvasLightButtonDescription_Text:"A light style map",L_GeochainTitle_Text:"Expand/Collapse Geochain",RadialMenuBirdseyeV2ButtonDescriptionText:"We have updated Bird's Eye. {0}",RadialMenuBirdseyeV2ButtonAlternateText:"Learn more",L_NavVarBirdseyeV2TipClose:"Close",L_CmtButtonTooltip:"commutability entrance",RadialMenuTitle:"Map style",L_TrafficRemoveAllRecentCamerasLink:"Remove all",L_TrafficRemoveRecentCameraToolTip_Text:"Remove Camera at {0}",MapsTimeSelect:"Select the time",CalendarEmptyDays:"These days are not valid for this month",CalendarNextMonth:"Go to {0}",TrafficCameraAriaLabel:"Show larger camera image of {0}",TrafficCameraName:"Traffic camera at {0}",TrafficCameraToggleButtonAriaLabel:"Show traffic camera toggle button",SpinBoxHoursLabel:"Hours",SpinBoxMinutesLabel:"Minutes",SpinBoxAmPmLabel:"a.m. or p.m.",L_BaseListMapMobile_Toggle_List:"List",L_BaseListMapMobile_Toggle_Map:"Map",L_MyPlacesButton_Label:"My Places",ClickToSelect:"Check to select",ClickToUnselect:"Uncheck to deselect",L_Search_This_Area_Label:"Search in this area",LandmarkDealsMore_Text:" + {0} more",SearchBoxSearchGhostText:"Search Bing Maps"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("MapDelay",n):window.$MicrosoftMaps8.ResourcesObject=n})();var f=window.$MicrosoftMaps8,i=f.Internal,yt=i.TaskData=i.TaskData||{},tr=f.Anchor,sf=i.BadgeTemplateSelector,gr=f.BasicMapAnimation,hf=f.BasicTemplate,cf=f.BitmapImageTemplate,ss=f.BirdseyeV2Crs,hs=i.BirdsEyeV2DialogViewModel,li=i._BoundsAccumulator,lf=f.BucketPrimitiveTemplateSelector,cs=f.ChangeMagnitude,ls=i._Color,as=i.CommutabilityControl,si=i._ComponentNames,af=i.Control,l=i.ControlTemplate,ai=f.CoreMap,ir=i._BaseMapTemplateSelector,a=f.Internal._Debug,vs=f.DefaultTemplateSelector,vf=i.DelayLoadedObject,nu=f.GlobalConfig.features.directions,ut=i._EntityHelper,ii=i._MapAuthentication,pt=i._EntryPoints,yf=i._ExternalPromise,gt=i._FeatureNames,r=f.GlobalConfig,u=i._Gimme,e=i._Helper,pf=f.ImageryMapLayer,wf=f.Infobox,tt=i._JSEvent,ys=i._LandmarksDataSource,tu=i._LatLonCrs,ht=f.LocationRect,it=i._LocalStorageCache,ct=i._LoggerConstants,vi=i._LruCache,k=i.MapHelper,ni=f.MapMath,ft=r.features.mapDelay,n=f.MapTypeId,ps=i._MercatorTileId,ws=i._MercatorTileUtility,lt=f.MapView,h=f.Location,d=f.NavigationBarMode,et=f.NavigationBarOrientation,wt=i._Network,bf=i._ObjectWithId,bs=i._Observable,iu=i._ObservableCollection,yi=i._ObservableObject,kf=i.OrderedDictionary,hi=i._Overlay,df=i._PerfV2Logger,p=f.Point,gf=f.Pushpin,ru=f.PrimitiveOverlayHelper,ne=f.RasterImageryScene,ks=f.Rectangle,t=f.ResourceManager.MapDelay,te=f.Polygon,rr=f.SimplePointPrimitive,ds=f.Size,gs=i.StaticPromise,c=r.features.streetside,b=r.features.sharing,ie=f.LabelVisibility,nh=f.TaskPrimitivesZOrderManager,th=r.features.traffic,re=f.VectorImageTemplate,bt=f.VectorMapLayer,y=i._VectorMath,ih=f.Viewport,at=f.ZoomLevel,uu=f.ZoomAroundLocationAnimator,ue='<div class="be2LabelToggleContainer" title="{TemplateBinding Resources.L_RadialMenuLabelToggleToolTip_Text}" event:click="onClick" event:touchstart="onClick">    <div class="be2LabelsTag">{labelToggleTooltip}<\/div>    <div class="be2LabelToggle switchSlot labelToggle" for="be2ToggleInput">        <div class="labelToggle_Container labelStyle">            <input id="be2ToggleInput" aria-label="{TemplateBinding Resources.L_RadialMenuLabelToggleToolTip_Text}" type="checkbox" class="labelToggle_Input" checked="checked" tabindex="-1" />            <label class="labelToggle_label" role="button" aria-label="{labelToggleTooltip}" />        <\/div>    <\/div><\/div>',fu='<div class="{TemplateBinding isCollapsed Converter=boolToContainerCollapsedClass }" data-tag="geochainContainer" style:display="{TemplateBinding isVisible Converter=boolToDisplay}">    <a class="{TemplateBinding isCollapsed Converter=boolToCollapsedClass }" href="#" role="button" data-tag="geochainCollapse" title="{TemplateBinding resources.L_GeochainTitle_Text}" aria-expanded="{TemplateBinding isCollapsed Converter=boolToExpandedString}" event:click="onCollapseClick" event:focus="onFocus" event:mousedown="stopEvent" event:mouseup="stopEvent" event:touchdown="stopEvent" event:touchup="stopEvent" event:touchend="onCollapseClick" event:contextmenu="stopEvent" />    <span style:display="{TemplateBinding isCollapsed Converter=boolToCollpased}" data-tag="geochainSegmentContainer">        <ItemsControl ItemsSource="{TemplateBinding geochainSegments}" panelTagName="span">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <a class="geochainSegment" data-index="{Binding index}" data-tag="geochainSegment" event:click="onSegmentClick" event:mousedown="stopEvent" event:mouseup="stopEvent" event:touchdown="stopEvent" event:touchup="stopEvent" event:touchend="stopEvent" event:contextmenu="stopEvent">                        <TextBlock Text=\'{Binding displayName}\' />                    <\/a>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <span style:display="{TemplateBinding isLastLocationVisible Converter=boolToDisplay}" data-tag="geochainLastLocationContainer">            <a class="geochainActionButton geochainLastLocation" data-tag="geochainLastLocation" event:click="onLastLocationClick" event:mousedown="stopEvent" event:mouseup="stopEvent" event:touchdown="stopEvent" event:touchup="stopEvent" event:touchend="stopEvent" event:contextmenu="stopEvent" />        <\/span>    <\/span><\/div>',fe='<div class="switchSlot labelToggle" for="navbarLabelToggleInput" tabindex="0" role="checkbox" aria-checked="true" aria-label="" title="{toggleButtonHoverToolTip}" event:blur="onBlur" event:click="onClick" event:touchstart="onClick" event:keyup="onKeyUp" event:contextmenu="onContextMenu">    <div class="labelToggle_Container labelStyle">        <input id="navbarLabelToggleInput" type="checkbox" class="labelToggle_Input" checked="checked" tabindex="-1" />        <label class="labelStyleSwitch" title="{tooltip}">{tooltip}<\/label>        <label class="labelToggle_label" helper="{TemplateBinding Helper}" role="button" aria-label="{tooltip}" />    <\/div><\/div>',ee='<div id="MicrosoftNav" class="NavBar_Container Light" ><\/div>',oe='<a id="{TemplateBinding id}"   class="NavBar_Button"   title="{TemplateBinding title}"   href="#"   role="button"   event:click="onClick"   event:mousedown="stopEvent"   event:mouseup="stopEvent"   event:mouseout="onMouseOut"   event:touchstart="stopEvent"   event:touchmove="stopEvent"   event:touchend="stopEvent"   event:contextmenu="stopEvent"   event:focus="onFocus">    <div class="NavButton_Icon"><\/div><\/a>',se='<div id="ZoomControl" class="NavBar_Zoom NavBar_Button">    <div id="zoom_divider" class="zoom_divider" /><\/div>',eu='<div class="infoboxOverlay transitLandmarksToolTip">    <div class="overlayStopName">        <TextBlock Text="{StaticBinding stopName}" />    <\/div>    <div class="sectionSeparator" data-tag="sectionSeparator"><\/div>    <div class="overlayRoutesList">        <div class="{StaticBinding showLongList Converter=addNewLines}">            <TextBlock Text="{StaticBinding routeList}" />        <\/div>    <\/div><\/div>',he='<div class="infoBoxLink">    <div class="bm_layerInfobox" id="infobox-container">        <div class="infoboxBody clientSide" style="min-width:220px;max-width:320px">            <div class="infoboxHouseImage">                <img class="infoboxBgImg" src="{image}"/>            <\/div>            <div class="infoboxText" style="padding: 4px 10px;">                <div class="titleLine" style="display: inline-block; line-height: 12px; padding-bottom: 2px;">{title}<\/div>                <div class="factsLine"style="line-height: 12px;opacity:{categoryOpacity}">{facts}<\/div>                <div class="factsLine" style="padding-bottom: 0px;opacity:{ratingOpacity}">{morefacts}<\/div>                <div class="infoboxDealBadge" adsLink="{adsUrl}">{price}<\/div>                <div class="infoboxDealsMore">{numdeals}<\/div>            <\/div>        <\/div>    <\/div><\/div>',ce='    <div class="bm_layerInfobox skaleton">        <div class="infoboxBody clientSide" style="height:80px;width:320px">            <div class="infoboxHouseImage">                <div style="width:80px;height:80px;background-color:lightgray"/><\/div>        <\/div>        <div class="infoboxText">            <div style="width: 200px;height:17px;margin-top:-4px; background-color: lightgray"><\/div>            <div style="width:100px;height:12px;background-color:lightgrey;margin:4px 0px"><\/div>            <div class="factsLine" style="padding-bottom: 0px;">{morefacts}<\/div>            <div class="infoboxDealBadge" style="background-color:darkseagreen;width:40px;margin-top:-3px"><\/div>        <\/div>    <\/div>',o=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),le=function(){function n(n){this._receiver=n}return n}(),ae=function(n){function t(t,i){var r=n.call(this,t)||this;return r._setTargetElement(i),r._targetElement.length>0?r._bindInteractionEvents():r._bindInteractionEventsHandler=i.modeDOMsMounted.add(function(n){n===0&&(r._setTargetElement(i),r._bindInteractionEvents(),r._bindInteractionEventsHandler.dispose())}),r}return o(t,n),t.prototype.dispose=function(){this._targetElement&&(this._targetElement.remove_event("click",this._clickHandler).remove_event("keydown",this._keyDownHandler).remove_event("keyup",this._keyUpHandler),this._targetElement=null,this._clickHandler=null,this._keyDownHandler=null,this._keyUpHandler=null);this._bindInteractionEventsHandler&&this._bindInteractionEventsHandler.dispose()},t.prototype._bindInteractionEvents=function(){var n=this;this._clickHandler=function(t){return n._onClick(t)};this._keyDownHandler=function(t){return n._onKeyDown(t)};this._keyUpHandler=function(t){return n._onKeyUp(t)};this._targetElement&&this._targetElement.add_event("click",this._clickHandler).add_event("keydown",this._keyDownHandler).add_event("keyup",this._keyUpHandler)},t.prototype._setTargetElement=function(n){this._targetElement=n.getRootElement().select(".ms-composite")},t.prototype._onClick=function(){var n=u(window).get_scroll_pos();this._targetElement[0].focus();r.isSDK&&window.scrollTo(n.x,n.y)},t.prototype._onKeyDown=function(n){var t={timestamp:Date.now(),element:n.target,keyCode:n.keyCode,originalArgs:n},i=this._receiver.onKeyDown(t);i&&n.preventDefault&&n.preventDefault()},t.prototype._onKeyUp=function(n){var t={timestamp:Date.now(),element:n.target,keyCode:n.keyCode,originalArgs:n},i=this._receiver.onKeyUp(t);i&&n.preventDefault&&n.preventDefault()},t}(le),ve=function(){function n(n){this.receiver=n}return n}(),ye=function(n){function t(t,i){var u=n.call(this,t)||this,r;u._registeredJsEvents={};u._map=i;var s=function(n,t){return u._addLocationToEvent(n,t)},c={argBuilder:s},l={preventDefault:!0,argBuilder:s},h=u._rootElement=u._map.getRootElement(),f=["mouseup","mouseenter","mouseleave","mousemove","mousewheel","touchstart"],o=["mousedown","contextmenu","touchend","touchmove"];for(r=0;r<f.length;r++)u._registeredJsEvents[f[r]]=e._defineJSEventForDomEvent(h,f[r],c);for(r=0;r<o.length;r++)u._registeredJsEvents[o[r]]=e._defineJSEventForDomEvent(h,o[r],l);return u}return o(t,n),t.prototype.dispose=function(){for(var n in this._registeredJsEvents)e._undefineJSEventForDomEvent(this._rootElement,n,this._registeredJsEvents[n].id),this._registeredJsEvents[n].dispose();e._nullifyClass(this)},t.prototype._addLocationToEvent=function(n,i){var u=this,r;a.assertNotNull(n,"args");a.assertNotNull(i,"original");var f=n.point,o=this._map.getMode(),e=o&&f&&o.tryPointToLocation(f);e&&(n.location=e);n.primitive=i.primitive;n.hitTarget=i.hitTarget;n.layer=i.layer;r={pointerType:2,identifier:"m",timestamp:Date.now(),element:i.target,button:t._getButtonProperty(i),buttonsState:t._getButtonsStateProperty(i),point:f,location:e,primitive:i.primitive,hitTarget:i.hitTarget,layer:i.layer,exclusiveHitTest:i.exclusiveHitTest,wheelDelta:n.wheelDelta,originalArgs:i};switch(i.type){case"mouseup":this.receiver.onPointerReleased(r);break;case"mousedown":this.receiver.onPointerPressed(r);break;case"mousemove":this.receiver.onPointerMoved([r]);break;case"mouseenter":case"mouseover":this.receiver.onPointerEntered(r);break;case"mouseleave":case"mouseout":this.receiver.onPointerExited(r);break;case"mousewheel":case"DOMMouseScroll":this.receiver.onPointerWheelChanged(r);break;case"contextmenu":this.receiver.onContextMenuInvoked(r);break;case"touchstart":this._callPointerFunctionForTouchEvents(function(n){u.receiver.onPointerPressed(n)},r,i);break;case"touchend":this._callPointerFunctionForTouchEvents(function(n){u.receiver.onPointerReleased(n)},r,i);break;case"touchmove":this._callPointerFunctionForTouchEvents(function(n){u.receiver.onPointerMoved(n)},r,i);break;case"touchcancel":this._callPointerFunctionForTouchEvents(function(n){u.receiver.onPointerCanceled(n)},r,i);break;case"pointerdown":case"MSPointerDown":i.preventDefault();this._callPointerFunctionForMsPointerEvent(function(n){u.receiver.onPointerPressed(n)},r,i);break;case"pointerup":case"MSPointerUp":this._callPointerFunctionForMsPointerEvent(function(n){u.receiver.onPointerReleased(n)},r,i);break;case"pointermove":case"MSPointerMove":this._callPointerFunctionForMsPointerEvent(function(n){u.receiver.onPointerMoved([n])},r,i);break;case"pointercancel":case"MSPointerCancel":this._callPointerFunctionForMsPointerEvent(function(n){u.receiver.onPointerCanceled(n)},r,i)}n.preventDefault&&n.preventDefault()},t.prototype._callPointerFunctionForTouchEvents=function(n,t,i){var e=i.changedTouches,o,f;if(e.length>0){for(o=[],f=0;f<e.length;f++){var r=e[f],s=u(t.element&&t.element.parentElement).get_absolute_pos(),h=new p(r.pageX-s.x,r.pageY-s.y),l=this._map.getMode().tryPointToLocation(h),c={pointerType:4,identifier:"t"+r.identifier,timestamp:t.timestamp,element:t.element,button:1,point:h,location:l,primitive:r.primitive,layer:r.layer,exclusiveHitTest:r.exclusiveHitTest,originalArgs:i};i.type!=="touchmove"?n(c):o.push(c)}i.type==="touchmove"&&n(o)}},t.prototype._callPointerFunctionForMsPointerEvent=function(n,t,i){var e=u(t.element&&t.element.parentElement).get_absolute_pos(),o=new p(i.pageX-e.x,i.pageY-e.y),s=this._map.getMode().tryPointToLocation(o),r,f;switch(i.pointerType){case"touch":case 2:r=4;f="t";break;case"pen":case 3:r=3;f="p";break;case"mouse":case 4:r=2;f="m";break;default:r=1;f="u"}t.pointerType=r;t.identifier=f+i.pointerId;t.point=o;t.location=s;n(t)},t._getButtonProperty=function(n){var i=n.button,t;switch(i){case 0:t=1;break;case 1:t=4;break;case 2:t=2;break;case 3:t=8;break;case 4:t=16;break;case 5:t=32;break;case-1:default:t=0}return t},t._getButtonsStateProperty=function(n){var i=0,r=u.Browser,f=n.type,e=n.originalWhich,o=n.originalButtons||n.buttons;return typeof o=="number"?r.is_ie&&r.ie_version!=-1&&r.ie_version<10&&f==="mousemove"||(i=o):r.is_webkit&&(f==="mousemove"?e===1?i=1:e===3&&(i=2):f==="mousedown"?i=t._getButtonProperty(n):f==="mouseup"&&(i=0)),i},t}(ve),pe=function(){function n(n,t,i){this._map=n;this._coreConfig=t;this._container=i;this._disposables=[];this._noBoundaryData=!1;this.invalidated=new tt;this._geoEntityApiHasData=!0}return n.populatePostCodeLayer=function(n,t,i,r,u){var f=n instanceof ai?n:n.getV8Map();f.getCityPolygonManager().then(function(n){n.selectorReady().then(function(){n._populatePostCodeToLayer(f,t,i,function(n){r(n)},u)})})},n.handlePostCodePrimitiveHover=function(t,i){var f=t.eventName==="mouseover",o=t.layer,u=t.primitive,e,h,r,s,c;u.geometryType!==3||i?u.geometryType===1&&(r=u.metadata,s=r&&r.polygon,s?n.handlePostCodePrimitiveHover({eventName:t.eventName,layer:t.layer,primitive:s}):(c=o.getPrimitives().indexOf(u)>=0,!c&&f?(r.primitiveShownOnHover=!0,o.add(u)):!f&&r.primitiveShownOnHover&&(delete r.primitiveShownOnHover,o.remove(u)),u.setState(f?3:2))):(r=u.metadata,r&&r.labelPushpin&&(e=r.labelPushpin,e.entity&&(e.entity.collisionBehavior=f?1:0),h=o.getPrimitives().indexOf(e)>=0,!h&&f?(r.labelShownOnHover=!0,o.add(e)):!f&&r.labelShownOnHover&&(delete r.labelShownOnHover,o.remove(e)),e.setState(f?3:2),e.changed.invoke()),f?(o.bringToTop(u),u.viewState=1):u.viewState=0)},n.bindPostCodeLayerHandlers=function(t,i){var u=i instanceof ai?i:i.getV8Map(),r=n.handlePostCodePrimitiveHover,f=function(t){n.handlePostCodePrimitiveHover(t,!0)},o=!t.primitiveHoverStarted.isHandlerRegistered(r)&&!t.primitiveHoverStopped.isHandlerRegistered(r),e;o&&(e=u.viewChanged.add(function(){var e=u.getConfig(),v=e.postCodeMinLabelZoom,l=e.postCodeMinPushpinZoom,a=e.postCodeMaxHoverClickZoom,i=u.getMercatorZoomLevel(),o=t.getPrimitives(),s=[],h=[],c;o.forEach(function(n){var t=n.metadata,r;i>=v?(r=t.labelPushpin,n.geometryType===3&&o.indexOf(r)<0&&s.push(r)):n.geometryType===1&&t&&t.polygon&&h.push(n);i<l&&n.geometryType===1&&t&&!t.polygon&&h.push(n)});i>=l&&(c=t.metadata&&t.metadata.pushpinPostCodes,c&&c.forEach(function(n){o.indexOf(n)<0&&s.push(n)}));t.add(s);h.forEach(function(n){return t.remove(n)});i>a&&t.primitiveHoverStarted.isHandlerRegistered(r)?(t.primitiveHoverStarted.remove(r),n._clearPrimitiveHoverStatus(t),t.primitiveHoverStarted.add(f)):i<=a&&!t.primitiveHoverStarted.isHandlerRegistered(r)&&(t.primitiveHoverStarted.remove(f),t.primitiveHoverStarted.add(r))}),t.addToDisposables(e),t.primitiveHoverStarted.add(r),t.primitiveHoverStopped.add(r))},n.prototype.addLayer=function(t,i,r,u){var f=this,e;this._layer&&this.removeLayer();this._vdpId=t;this._cityPolygons=null;this._minZoomLevel=i;this._maxZoomLevel=r;this._geoEntityApiHasData=!u;this._geoEntityApiHasData?(this._noBoundaryData=!1,this._container.instanceAsync("GeoDataAPIManager",function(){f._layer=new bt(f._coreConfig.cityPolygonVectorLayerId+n._cityPolygonCount,f,f,f._coreConfig.landmarksLayerZIndex);f._initializeLayer()})):(e=this._coreConfig.cityPolygonUrlFormat.replace("{entityId}",t.toString()),this._landmarksDataSource?(this._landmarksDataSource.updateZoom(i,r),this._initializeLandmarkDatasource()):this._container.instanceAsync("LandmarksDataSource",function(n){f._landmarksDataSource=n;f._initializeLandmarkDatasource()},{vectorTileUrlFormat:e,landmarksMinZoom:i,landmarksMaxZoom:r,landmarksVectorLayerId:this._coreConfig.cityPolygonVectorLayerId,landmarksDataSourceLayersOfInterest:this._coreConfig.cityPolygonDataSourceLayersOfInterest,jsonsoSuffix:this._coreConfig.cityPolygonVectorLayerId}))},n.prototype.getPrimitives=function(n,t){var i=this;this._noBoundaryData?this._displayFallbackPois(t):this._geoEntityApiHasData?this._cityPolygons?this._cityPolygons.length>0?t&&t({primitives:this._cityPolygons}):this._displayFallbackPois(t):ii.instance.authenticateClientAndRetrieveSessionId(function(n){Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getEntityDetails(i._vdpId,{lod:1,getEntityMetadata:!1,entityType:null},n,function(n){if(n.hasGeoPoliticalIssues)i._displayFallbackPois(t);else if(n.results&&n.results.length>0&&n.results[0]){i._cityPolygons=n.results[0].Polygons;i._completePolygonsBound=ht.fromShapes(i._cityPolygons);i._cityPolygons.forEach(function(n){n.bucket=ir.cityPolygonBucket;n.viewState=2});var r=i._map.getMercatorZoomLevel();i._minZoomLevel=Math.min(r,i._minZoomLevel);i._validateZoomLevel();i._noBoundaryData?i._displayFallbackPois(t):t&&t({primitives:i._cityPolygons})}else i._geoEntityApiHasData&&(i.removeLayer(),i.addLayer(i._vdpId,i._minZoomLevel,i._maxZoomLevel,!0))},null,function(){i._displayFallbackPois(t)})}):this._dataSource.getPrimitives(n,function(n){i._noBoundaryData?i._displayFallbackPois(t):t&&t(n)})},n.prototype.removeLayer=function(){this._layer&&(this._dataSource=null,this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null,this._noBoundaryData=!1)},n.prototype.selectorReady=function(){var n=this;return!this._baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._resetTemplateSelector=!1,n._baseMapTemplateSelector.selectorReady()}):this._baseMapTemplateSelector.selectorReady()},n.prototype.getTemplates=function(t,i,r){var u=t,e=null,o,s,f;if(u instanceof rr)o=this._map.getMercatorZoomLevel(),e=this._baseMapTemplateSelector.getPoiVectorImageTemplate(null,4,o,1,!1,null);else{s=u.taskDisplayState&&u.taskDisplayState.colorIndex||k._getColorMapping(n._defaultTaskColorIndex);f=2;switch(u.viewState){case 1:f=3;break;case 2:f=4}e=this._baseMapTemplateSelector.getCityPolygonTemplates(t.bucket,s,f,i,r)}return e},n.prototype.dispose=function(){this._cityPolygons=null;this._landmarksDataSource=null;this.removeLayer();e._clearDisposables(this._disposables)},n.prototype._displayFallbackPois=function(n){this._fallbackPrimitive?n&&n({primitives:[this._fallbackPrimitive]}):n&&n({primitives:[]})},n.prototype._initializeLandmarkDatasource=function(){this._dataSource=this._landmarksDataSource.getLayerDataSource(this._coreConfig.cityPolygonVectorLayerId);this.spatialIndex=this._dataSource.spatialIndex;this._layer=new bt(this._coreConfig.cityPolygonVectorLayerId+n._cityPolygonCount,this,this,this._coreConfig.landmarksLayerZIndex);this._initializeLayer()},n.prototype._initializeLayer=function(){var i=this,t;n._cityPolygonCount++;this._layer.setVisible(!0);this._map.getLayers().insert(this._layer);this._layer.setRenderTarget(2);this._disposables.push(this._layer.getFrameManager().dataLoaded.add(function(n){return i._onDataLoaded(n)}));this._disposables.push(this._layer.getFrameManager().frameSet.add(function(n){return i._onFrameSet(n)}));this._disposables.push(this._map.mapZoomStopped.add(function(n){return i._processZoomStopped(n)}));t=this._map.getMapOptions();t.center&&t.entityName&&(this._fallbackPrimitive=new rr(t.center,{id:this._vdpId.toString(),title:t.entityName,collisionBehavior:2}),r.isMapsAnswer&&(this._fallbackPrimitive.entity.title=null),this._fallbackPrimitive.layer=this._layer,this._fallbackPrimitive.bucket=ir.bucketIdForPoi)},n.prototype._onDataLoaded=function(){var t,i,r,n;if(!this._noBoundaryData&&this._layer){if(t=this._layer.getFrameManager().getFrameData().getPrimitives(2,!1),t)for(i=0,r=t.length;i<r;i++)if(n=t[i],n.geometry&&(n.geometryType===2||n.geometry.rings&&n.geometry.rings.length>0))return;this._noBoundaryData=!0;this.invalidated.invoke()}},n.prototype._onFrameSet=function(){this._validateZoomLevel()},n.prototype._processZoomStopped=function(){this._validateZoomLevel();this.invalidated.invoke()},n.prototype._validateZoomLevel=function(){var i=this._map.getMercatorZoomLevel(),t;if(i>=this._minZoomLevel&&i<=this._maxZoomLevel){if(this._noBoundaryData=!1,this._completePolygonsBound&&this._geoEntityApiHasData&&(t=this._map.getMode(),t)){var r=t.tryLocationToPoint(this._completePolygonsBound.getNorthwest()),u=t.tryLocationToPoint(this._completePolygonsBound.getSoutheast()),e=Math.abs(u.x-r.x),o=Math.abs(u.y-r.y),f=this._map.getViewport();e/f.pixelWidth<n._minPolygonWidthHeightRatio&&o/f.pixelHeight<n._minPolygonWidthHeightRatio&&(this._noBoundaryData=!0)}}else i<this._minZoomLevel&&(this._noBoundaryData=!0)},n.prototype._populatePostCodeToLayer=function(t,i,r,u,f){var o=this,s=t instanceof ai?t:t.getV8Map(),e=s.getMercatorZoomLevel(),h=s.getConfig(),l=h.postCodeMinLabelZoom,c=h.postCodeMinPushpinZoom;Microsoft.Maps.loadModule(["Microsoft.Maps.SpatialDataService","Microsoft.Maps.SpatialMath","Microsoft.Maps.Search"],function(){var w=r.length,v=0,h=[],a=[],b=new Microsoft.Maps.Search.SearchManager(t),y=t.getBounds(),s,p;y.buffer(1);s=function(){if(v++,v>=w){i&&(i.add(h),e>=c&&i.add(a),i.metadata={pushpinPostCodes:a},n.bindPostCodeLayerHandlers(i,t));var r=f||e>=c?h.concat(a):h;u&&u(r)}};p=function(n){var r,u,i,f,c,v;n.results&&n.results.length>0&&n.results[0].Name?(r=n.results[0].Name.EntityName,r===n.location?(u=n.results[0].Polygons,i=null,u.length>=1&&(f=[],u.forEach(function(n){return f.push(n.getLocations())}),i=new te(f)),i&&(o._populatePostCodePolygon(i,r,t),h.push(i),c=i.metadata&&i.metadata.labelPushpin,c&&e>=l&&h.push(c)),s()):(v={where:n.location,bounds:y,callback:function(t){o._processPointPostCodeResponse(a,t,n.location);s()},errorCallback:s},b.geocode(v))):s()};ii.instance.authenticateClientAndRetrieveSessionId(function(n){Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(r,{entityType:"Postcode1",getAllPolygons:!0},t instanceof ai?n:t,p,null,s)})})},n.prototype._processPointPostCodeResponse=function(t,i,r){var o;if(i.results&&i.results.length>0&&i.results[0].location){var v=n._postCodeThemeColor.replace("{a}","1"),s=i.results[0].location,u=t.filter(function(n){var t=n.getLocation();return h.areEqual(s,t,!0,1e-6)});if(u&&u.length>0){var f=u[0],c=f.metadata,e=f.getTitle(),y=c.title,l=y+","+r,a=e.split(",").length,p=a===3?e+",...":a===4?e:l;f.setOptions({title:p});c.title=l}else o=new gf(s,{title:r,color:v}),o.metadata={title:r},t.push(o)}},n._clearPrimitiveHoverStatus=function(n){for(var t,r,u,f=n.getPrimitives(),i=0,e=f.length;i<e;i++)if(t=f[i],t.viewState===1){t.geometryType===3&&(t.viewState=0,r=t.metadata,u=r&&r.labelPushpin,u&&u.setState(2));break}},n.prototype._populatePostCodePolygon=function(n,t){var u=this,r,i;n.metadata={title:t};n.viewState=0;n.bucket=ir.xsrPolygonBucketId;n.getTemplates=function(){return u.getTemplates(n,1,1)};r=Microsoft.Maps.SpatialMath.Geometry.centroid(n);i=new Microsoft.Maps.Pushpin(r,{title:t,icon:"<svg xmlns='http://www.w3.org/2000/svg' width='1' height='1'><\/svg>",anchor:new p(0,12)});i.entity.collisionBehavior=0;i.metadata={title:t,polygon:n};n.metadata.labelPushpin=i},n._defaultTaskColorIndex=3,n._postCodeThemeColor="rgba(90, 104, 108, {a})",n._cityPolygonCount=0,n._minPolygonWidthHeightRatio=.1,n}(),w=function(){function n(){}return n.taskDataHandlerKey="data-task",n.taskProcessDataHandlerKey="data-process",n.streetsideDataHandlerKey="data-streetside",n.instrumentationDataHandlerKey="data-instrumentation",n.callServerInstrumentationDataHandlerKey="data-serverInstrumentation",n.photosynthDataHandlerKey="data-photosynth",n.shareDataHandlerKey="data-share",n.printDataHandlerKey="data-print",n.layoutDataHandlerKey="data-layout",n.mapViewDataHandlerKey="data-mapview",n.birdsEyeV2DialogDataHandlerKey="data-birdseyeV2Dialog",n.layerManagerDataHandlerKey="data-managelayer",n}(),we=function(){function n(n,i){this._worldText=t.L_GeochainWorldText;this._boundsCache=new vi(100);this._currentGeochainRequestIds=[];this._map=n;this._reverseGeocoder=i}return n.prototype.getGeochain=function(t,i,u,f){var s=this,e,o;if((!this._map||!(this._map.isDisposed()||r.disableReverseGeocode))&&(i||(i=this._map.getMode().tryPointToLocation(k.getViewportCenter(this._map))),u||(e=this._map.getBounds().bounds,u=ht.fromEdges(e[0],e[3],e[2],e[1])),!this._lastCenterPoint||!this._lastBoundingRect||!h.areEqual(this._lastCenterPoint,i,!0,1e-6)||!ht.areEqual(this._lastBoundingRect,u,1e-6))){if(this._lastCenterPoint=i,this._lastBoundingRect=u,!f){for(o=0;o<this._currentGeochainRequestIds.length;o++)wt.abortRequest(this._currentGeochainRequestIds[o]);this._currentGeochainRequestIds=[]}f?this._reverseGeocoder.reverseGeocodeWithNetworkId(i,function(n){s._geochainReverseGeocoderCallback(n,u,f,t)},Object.keys(n._geochainEntityTypes),!0,1):this._currentGeochainRequestIds.push(this._reverseGeocoder.reverseGeocodeWithNetworkId(i,function(n){s._geochainReverseGeocoderCallback(n,u,f,t)},Object.keys(n._geochainEntityTypes),!0,1))}},n.prototype._getBoundingBox=function(n,t){ii.instance.authenticateClientAndRetrieveSessionId(function(i){var u=ft.boundingBoxRequestUrlFormat.replace("{session_key}",i).replace("{culture}",r.dynamicProperties.market).replace("{query}",n);wt.downloadJsonp(u,"geochain",t,function(){},null,null,null,3)})},n.prototype._geochainReverseGeocoderCallback=function(t,i,r,u){var s=this,e,f,o,c,h,l,a;if(r||(this._currentGeochainRequestIds=[]),t.success){if(e=this._parseReverseGeocoderResponse(t),!e){u([]);return}for(f=this._generateBoundsQueries(e),o=f.length,f.length===0&&u(this._constructGeochainFromBounds(i,e)),c=0;c<f.length;c++){if(h=c,!f[h].id||this._boundsCache.getItem(f[h].id)){o--;o===0&&(r||(this._currentGeochainRequestIds=[]),u(this._constructGeochainFromBounds(i,e)));continue}l=function(t,f){if(f&&f.authenticationResultCode===n._validAuthenticationCode&&f.statusCode===n._validStatusCode&&f.resourceSets&&f.resourceSets.length>0&&f.resourceSets[0].resources&&f.resourceSets[0].resources.length>0){var h=f.resourceSets[0].resources[0];t&&h.bbox&&s._boundsCache.addItem(t,h.bbox);o--;o===0&&(r||(s._currentGeochainRequestIds=[]),u(s._constructGeochainFromBounds(i,e)))}else o--,o===0&&(r||(s._currentGeochainRequestIds=[]),u(s._constructGeochainFromBounds(i,e)))};a=l.bind(this,f[h].id);this._getBoundingBox(f[h].query,a)}}},n.prototype._parseReverseGeocoderResponse=function(n){var e=n.results?n.results.length:0,t,r,u,i,f;if(e==0)return null;for(t={},r=0;r<e;r++)if(i=n.results[r].address,f=n.results[r].entityType,f!=="Neighborhood"){t.country=i.countryRegion;t.countryEntityId=i.countryRegionEntityId;t.state=i.adminDistrict;t.stateEntityId=i.adminDistrictEntityId;t.county=i.adminDistrict2;t.countyEntityId=i.adminDistrict2EntityId;t.city=i.locality;t.cityEntityId=i.localityEntityId;t.street=i.addressLine;t.streetEntityId=i.addressLineEntityId;break}for(u=0;u<e;u++)if(i=n.results[u].address,f=n.results[u].entityType,f==="Neighborhood"){t.country=i.countryRegion;t.countryEntityId=i.countryRegionEntityId;t.state=i.adminDistrict;t.stateEntityId=i.adminDistrictEntityId;t.county=i.adminDistrict2;t.countyEntityId=i.adminDistrict2EntityId;t.neighborhood=i.neighborhood;t.neighborhoodEntityId=i.neighborhoodEntityId;break}return t},n.prototype._generateBoundsQueries=function(n){var i=[],t="",r,u,f;return n.country&&(t+="&countryRegion="+n.country,r=t,i.push({query:r,id:n.countryEntityId}),n.state&&(t+="&adminDistrict="+n.state,u=t,i.push({query:u,id:n.stateEntityId}),n.county&&n.city&&(t+="&adminDistrict2="+n.county+"&locality="+n.city,f=t,i.push({query:f,id:n.cityEntityId})))),i},n.prototype._constructGeochainFromBounds=function(t,i){var l=this._map.getMode(),a=l&&l.getMapViewForLocationsInView([t.getNorthwest(),t.getSoutheast()]),u=a&&at.fromLocation(a.cameraLocation,!1),h=[],f,r,c,o,e;if(typeof u!="number"||isNaN(u))return h;for(u=Math.ceil(u),f=-1,r=0;r<n._geochainLevels.length;r++){var e=n._geochainLevels[r],s=null,v=i[e+"EntityId"];if(v&&(s=this._boundsCache.getItem(v)),s)if(this._canFitViewport(s,t)){this._comparableToViewport(s,t)&&(f=r);break}else f=r;else if(c=n._geochainLevelZoomLimits[e],c>=u){if(c<u+2){f=r;break}}else f=r}for(o=0;o<=f;o++)e=n._geochainLevels[o],i[e]&&h.push(new yu(i[e],i[e+"EntityId"],o));return h},n.prototype._comparableToViewport=function(n,t){if(!n||!t)return!1;var i=ht.fromEdges(n[2],n[1],n[0],n[3]),r=Math.min(t.width/4,t.height/4);return i.width>=r||i.height>=r},n.prototype._canFitViewport=function(n,t){if(!n||!t)return!1;var i=ht.fromEdges(n[2],n[1],n[0],n[3]);return!(i.width>t.width||i.height>t.height)},n._validAuthenticationCode="ValidCredentials",n._validStatusCode=200,n._validStatusDescription="OK",n._geochainEntityTypes={Neighborhood:"neighborhood",PopulatedPlace:"city",AdminDivision1:"state",AdminDivision2:"county",CountryRegion:"country"},n._geochainLevels=["country","state","county","city","neighborhood"],n._geochainLevelZoomLimits={country:4,state:7,county:10,city:13,neighborhood:15},n}(),be=function(){function n(){}return n.prototype.geocode=function(t,i,u,f,e,o){var s={success:!1,statusCode:null,authenticationResultCode:null,statusDescription:null,name:t,results:null},h;location||i(s);h=f&&f<=n._maxNumberOfResults?f:n._defaultResultCount;ii.instance.authenticateClientAndRetrieveSessionId(function(f){var c=ft.geocodeRequestUrlFormat.replace("{session_key}",f),l=c.replace("{query}",encodeURIComponent(t)).replace("{culture}",r.dynamicProperties.market).replace("{userMapView}",n._getBoundsString(u)).replace("{maxResults}",h).replace("{neighborhood}",e?"1":"0").replace("{incl}",o?"ciso2":"");wt.downloadJsonp(l,"geocode",function(t){var r,u,f;if(t&&t.authenticationResultCode===n._validAuthenticationCode&&t.statusCode===n._validStatusCode&&t.statusDescription===n._validStatusDescription&&t.resourceSets&&t.resourceSets.length!==0){for(s.success=!0,s.statusCode=n._validStatusCode,s.authenticationResultCode=n._validAuthenticationCode,s.statusDescription=n._validStatusDescription,u=0,f=t.resourceSets.length;u<f;u++)if(r=t.resourceSets[u].resources,r&&r.length!==0){s.results=r;break}s.traceId=t.traceId}else t?(s.statusCode=t.statusCode,s.authenticationResultCode=t.authenticationResultCode,s.statusDescription=t.statusDescription,s.errorMessage=t.errorDetails&&t.errorDetails.length>0&&t.errorDetails[0],s.traceId=t.traceId):(s.statusCode=400,s.authenticationResultCode="Unknown",s.statusDescription="Unknown");i(s)},function(){s.authenticationResultCode="Unknown";s.statusCode=404;s.statusDescription="Http Error";i(s)},null,null)})},n._getBoundsString=function(n){return n?n.getSouth()+","+n.getWest()+","+n.getNorth()+","+n.getEast():""},n._validAuthenticationCode="ValidCredentials",n._validStatusCode=200,n._validStatusDescription="OK",n._defaultResultCount=5,n._maxNumberOfResults=20,n}(),ke=function(){function n(){}return n.Invoke="IN",n}(),ou=function(){function n(n,t){this._window=n;this._reverseGeocoder=t;this._fetchingPosition=!1}return n.prototype.GetCurrentPosition=function(n){var i=this,t;n&&n.callback&&(t={success:!1,statusCode:200,authenticationResultCode:"ValidCredentials",statusDescription:"OK",location:null,addressList:null,results:null,position:null,error:{code:4,message:"Unknown Error"}},this._window.navigator&&this._window.navigator.geolocation?this._fetchingPosition?(t.error.code=5,t.error.message="Try again later",n.callback(t)):(n.timeout=n.timeout?n.timeout:ft.geolocationTimeout,n.maximumAge=n.maximumAge?n.maximumAge:ft.geolocationMaxAge,n.enableHighAccuracy=!0,this._fetchingPosition=!0,this._window.navigator.geolocation.getCurrentPosition(function(r){t.success=!0;t.position=r;t.location=new h(r.coords.latitude,r.coords.longitude,r.coords.altitude);t.error=null;i._fetchingPosition=!1;n.performReverseGeocoding?i._reverseGeocoder.reverseGeocode(t.location,function(i){t.addressList=i.success&&i.addressList?[i.addressList[0]]:[];n.callback(t)}):n.callback(t);i._logData(t)},function(r){t.error.code=r.code;t.error.message=r.message;i._fetchingPosition=!1;n.callback(t);i._logData(t)},n)):(t.error.code=6,t.error.message="Geolocation not supported by browser",n.callback(t)))},n.prototype._logData=function(t){if(!this._hasLogged&&t){var i={feature:gt.LocateMe,action:ke.Invoke,data:n._createLogData(t)};g.invokeHandler(w.instrumentationDataHandlerKey,{logData:i});this._hasLogged=!0}},n._createLogData=function(n){var i=n.success,u="NaN,NaN",f=NaN,e=-1,t;return i&&n.position&&n.position.coords?(t=n.position.coords,u=t.latitude+","+t.longitude,f=t.accuracy):e=n.error.code,{success:i,errorCode:e,clientIP:r.dynamicProperties.clientIP,reverseIPLocation:r.dynamicProperties.reverseIPLocation,geolocation:u,geolocationAccuracy:f}},n}(),ri;(function(n){var t=function(){function n(t){n._container=t;n._references&&t.instanceAsyncAll(n._references,function(t){var r,u,i;if(n._references){for(r=0;r<n._references.length;r++){var f=n._references[r].name,e=n._mapping[f],o=t[f];for(u=0;u<e.length;u++)i=e[u],n._attrDataHandlerList[i]=o,n._invokeHandlerQueue[i]&&o.processData(i,n._invokeHandlerQueue[i])}n._references=null;n._mapping=null;n._invokeHandlerQueue=null}})}return n.registerDataHandler=function(t,i){if(!t||!i||n._attrDataHandlerList[t]||typeof r!="undefined"&&!r.isMapsVertical&&!r.dynamicProperties.mapOverlayInSerpEnabled&&w.streetsideDataHandlerKey!==t&&w.instrumentationDataHandlerKey!==t)return!1;if(typeof i=="string")if(n._container)n._container.instanceAsync(i,function(i){n._attrDataHandlerList[t]=i},null);else{var u=n._mapping[i];u?u.push(t):(u=n._mapping[i]=[t],n._references.push({name:i}))}else n._attrDataHandlerList[t]=i;return!0},n.registerEventForDataAttribute=function(t,i,r){var f,o;return!t||!i?!1:(f=u(n._topLevelTaskContainerSelector),f.length!==0)?(n._eventAttributeList[t]||(n._eventAttributeList[t]=[]),n._eventAttributeList[t].push(i),o=function(n,t){n.target=t.target;n.type=t.type;n.preventDefault=r&&r.preventDefault&&function(){t.preventDefault()}},n._eventHandlers[t]=n._eventHandlers[t]||e._defineJSEventForDomEvent(f,t,{argBuilder:o}).add(n._eventHandler),!0):!1},n.invokeHandler=function(t,i){var r=n._attrDataHandlerList[t];r?r.processData(t,i):n._mapping?n._invokeHandlerQueue[t]=i:console.log("Invalid handler key : "+t)},n._processEvent=function(t,i,r){for(var e={},o=!1,h=!1,f,s,c;t&&t.length&&!t.get_attr(n._topLevelTaskContainerAttributeName);){e=n._getAttributeListForEvent(t,i);for(f in e)if(s=n._attrDataHandlerList[f],s){try{c=u.Internals.parseJSON(e[f]);s.processData(f,c,t,i);h=!0}catch(l){}o=!0}if(o||!r)return o&&h;t=t.parent()}return!1},n._eventHandler=function(t){if(!t.target||!u(t.target.parentElement).has_class("ms-composite")){var i=t.type,r=u(t.target),f=n._processEvent(r,i,!0);return f&&t.preventDefault&&t.preventDefault(),!1}},n._getAttributeListForEvent=function(t,i){for(var u=n._eventAttributeList[i],e={},f,r=0,o=u.length;r<o;r++)f=t.get_attr(u[r]),f&&(e[u[r]]=f);return e},n._references=[],n._mapping={},n._attrDataHandlerList={},n._eventHandlers={},n._eventAttributeList={},n._invokeHandlerQueue={},n._topLevelTaskContainerSelector="div[data-global]",n._topLevelTaskContainerAttributeName="data-global",n._container=null,n}();n.GlobalDataEventHandler_Old=t})(ri||(ri={})),function(n){var t=function(){function n(t){function s(t,i){var r=n._invokeHandlerQueue[t];r&&i.processData(t,r)}var u,f,i,e,o,r;if(n._reset(),n._container=t,u=Object.keys(n._eventAttributeData),u&&u.length)for(i=0;i<u.length;i++)n._registerEvent(u[i]);if(f=Object.keys(n._staticDataHandlers),f&&f.length)for(i=0;i<f.length;i++)e=f[i],o=n._staticDataHandlers[e],n._dataHandlers[e]=o,s(e,o);r=Object.keys(n._dynamicDataHandlers).map(function(n){return{name:n}});r&&r.length?t.instanceAsyncAll(r,function(t){var i,u,f;if(n._container){for(i=0;i<r.length;i++){var e=r[i].name,o=n._dynamicDataHandlers[e],h=t[e];for(u=0;u<o.length;u++)f=o[u],n._dataHandlers[f]=h,s(f,h)}n._invokeHandlerQueue={}}}):n._invokeHandlerQueue={}}return n._reset=function(){var i,t;if(n._container){for(n._container=null,n._dataHandlers={},n._invokeHandlerQueue={},i=Object.keys(n._eventHandlers),t=0;t<i.length;t++)n._eventHandlers[i[t]].dispose();n._eventHandlers={}}},n.registerDataHandler=function(t,i){if(!t||!i||n._dataHandlers[t]||typeof r!="undefined"&&!r.isMapsVertical&&!r.dynamicProperties.mapOverlayInSerpEnabled&&w.streetsideDataHandlerKey!==t&&w.instrumentationDataHandlerKey!==t)return!1;if(typeof i=="string"){var u=n._dynamicDataHandlers[i];u||(u=n._dynamicDataHandlers[i]=[]);u.push(t);n._container&&n._container.instanceAsync(i,function(i){n._dataHandlers[t]=i},null)}else n._staticDataHandlers[t]=i,n._dataHandlers[t]=i;return!0},n.registerEventForDataAttribute=function(t,i,r){return!t||!i?!1:(n._eventAttributeData[t]={attrName:i,options:r},n._container)?n._registerEvent(t):!0},n._registerEvent=function(t){var r=u(n._topLevelTaskContainerSelector),f=n._eventAttributeData[t],h=f.attrName,o=f.options,i,s;return r.length!==0?(i=n._eventAttributeList,i[t]||(i[t]=[]),i[t].push(h),s=function(n,t){n.target=t.target;n.type=t.type;n.preventDefault=o&&o.preventDefault&&function(){t.preventDefault()}},n._eventHandlers[t]=n._eventHandlers[t]||e._defineJSEventForDomEvent(r,t,{argBuilder:s}).add(n._eventHandler),!0):!1},n.invokeHandler=function(t,i){var r=n._dataHandlers[t];r?r.processData(t,i):n._invokeHandlerQueue[t]=i},n._processEvent=function(t,i,r){for(var o={},s=!1,a=!1,h,f,e,c,l;t&&t.length&&!t.get_attr(n._topLevelTaskContainerAttributeName);){for(o=n._getAttributeListForEvent(t,i),h=Object.keys(o),f=0;f<h.length;f++)if(e=h[f],c=n._dataHandlers[e],c){l=void 0;try{l=u.Internals.parseJSON(o[e]);c.processData(e,l,t,i);a=!0}catch(v){}s=!0}if(s||!r)return s&&a;t=t.parent()}return!1},n._eventHandler=function(t){if(!t.target||!u(t.target.parentElement).has_class("ms-composite")){var i=t.type,r=u(t.target),f=n._processEvent(r,i,!0);return f&&t.preventDefault&&t.preventDefault(),!1}},n._getAttributeListForEvent=function(t,i){for(var u=n._eventAttributeList[i],e={},f,r=0,o=u.length;r<o;r++)f=t.get_attr(u[r]),f&&(e[u[r]]=f);return e},n._dynamicDataHandlers={},n._staticDataHandlers={},n._dataHandlers={},n._eventAttributeData={},n._eventHandlers={},n._eventAttributeList={},n._invokeHandlerQueue={},n._topLevelTaskContainerSelector="div[data-global]",n._topLevelTaskContainerAttributeName="data-global",n._container=null,n}();n.GlobalDataEventHandler=t}(ri||(ri={}));var g=ft.useNewGlobalDataEventHandler?ri.GlobalDataEventHandler:ri.GlobalDataEventHandler_Old,su=function(){function n(n,t,i){this._map=n;this._perfLog=i;this._bubbleSource=t}return n.prototype.isAvailable=function(n,t,i,r){if(!n&&r&&(n=r.panoramaInfo),n instanceof ht)this._getClosestBubble(n,c.defaultNumberOfBubblesToRequest,t,i);else if(n instanceof h){var u=this._getBoundingBoxFromMapLocation(n,r);this._getClosestBubble(u,c.defaultNumberOfBubblesToRequest,t,i)}else typeof n=="number"?this._getBubbleById(n,t,i):n&&typeof n=="object"&&n.id?t&&t(n,[n]):i&&i()},n.prototype._getBoundingBoxFromMapLocation=function(n,t){var i,u,r,e,f;return t&&typeof t.panoramaLookupRadius=="number"&&t.panoramaLookupRadius>0?i=t.panoramaLookupRadius:(u=this._map.getMercatorZoomLevel(),i=Math.pow(2,c.maxZoomForSS-u),r=c.minLookupsMeters[u-17],isNaN(r)&&(r=c.minLookupsMeters[0]),i=Math.max(i,r)),e=ni.metersToDegrees(i),f=e*2,new ht(n,f,f)},n.prototype._getClosestBubble=function(n,t,i,r){var f=this,u=this._bubbleSource.getBubbles(n,t,function(n){return f._handleGetBubblesResponse(n,i)},r);u&&this._handleGetBubblesResponse(u,i)},n.prototype._getBubbleById=function(n,t,i){var u=this,r=this._bubbleSource.getBubbleById(n,function(n){return u._handleGetBubblesResponse(n,t)},i);r&&this._handleGetBubblesResponse([r],t)},n.prototype._handleGetBubblesResponse=function(n,t){t&&t(n[0],n)},n}(),de=function(t){function i(n,i,r){var u=t.call(this,n,i,r)||this;return u._disposables=[],u._animating=!1,u._animationStartTime=0,u._animationDuration=0,u}return o(i,t),i.prototype.show=function(n,t){var i=this,u=t&&t.onErrorLoading;this.isAvailable(n,function(n){i._map.getContainer().instanceAsync(r.isMapsVertical?"StreetsideMode":"SDKStreetsideMode",function(r){return i._prepStreetsideMode(r,n,new h(n.la,n.lo),t)},{StreetsideModeBootstrapper:i})},u,t)},i.prototype._prepStreetsideMode=function(t,i,r,u){var e=this,f=this._map.getMode();f&&!f._sivSize?(t.setPreviousMode(f),t.setPreviousMapType(this._map.getMapType()),this._prepAndStartStreetsideMode(t,i,r,u)):this._map.getContainer().instanceAsync("CompositeMapMode",function(f){t.setPreviousMode(f);t.setPreviousMapType(e._map.createMapType(n.road));e._prepAndStartStreetsideMode(t,i,r,u)})},i.prototype._prepAndStartStreetsideMode=function(t,i,r,u){this._map.setMapType(this._map.createMapType(n.streetside));typeof u.heading!="number"&&u.locationToLookAt&&(u.heading=ni.getAngleBetweenTwoLocations(new h(i.la,i.lo),u.locationToLookAt));t.setInitialBubble(i,u);var f=u&&u.onSuccessLoading;c.zoomInAnimationAllowed&&r&&u&&u.zoomIn?this._zoomInToStreetside(t,f,new h(i.la,i.lo)):this._startStreetsideMode(t,f)},i.prototype._zoomInToStreetside=function(n,t,i){var r=this,u;this._animating||(u=c.zoomInAnimationTargetZoomLevel-k.getMercatorZoomLevel(this._map),this._animating=!0,this._animationStartTime=Date.now(),this._animationDuration=Math.ceil(c.zoomInAnimationMillisecondsPerZoomLevel*u),this._disposables.push(this._map.viewChanged.add(function(u){return r._onViewChanged(u,n,t,i)})));window.requestAnimationFrame(function(){return r._zoomIn(n,t,i)})},i.prototype._zoomIn=function(n,t,i){var r=this._getZoomAnimationValue();k.zoomAroundLocation(this._map,i,r,!0)},i.prototype._getZoomAnimationValue=function(){var i=c.zoomInAnimationTargetZoomLevel-k.getMercatorZoomLevel(this._map),r=Date.now()-this._animationStartTime,n=r/(this._animationDuration/2),t;return n<1?t=-i/2*(Math.sqrt(1-n*n)-1):(n-=2,t=i/2*(Math.sqrt(1-n*n)+1)),t},i.prototype._startStreetsideMode=function(n,t){this._map.setMode(n);t&&t()},i.prototype._onViewChanged=function(n,t,r,u){k.getMercatorZoomLevel(this._map)>=c.zoomInAnimationTargetZoomLevel-i._targetZoomLevelForAnimationEntryFudgeFactor?(this._animating=!1,this._disposables.pop().dispose(),this._startStreetsideMode(t,r)):this._zoomInToStreetside(t,r,u)},i._targetZoomLevelForAnimationEntryFudgeFactor=.01,i}(su),s=function(){function n(){}return n.directionsTask="DirectionsTask",n.directionsFlipTask="DirectionsFlipTask",n.collectionsTask="CollectionsTask",n.localDetailsTask="LocalDetailsTask",n.localListingTask="LocalListingTask",n.hotelsListingTask="HotelsListingTask",n.houseListingTask="HouseListingTask",n.polygonListingTask="PolygonListingTask",n.restaurantsListingTask="RestaurantsListingTask",n.localSearchTask="LocalSearchTask",n.houseDetailsTask="HouseDetailsTask",n.hotelsDetailsTask="HotelsDetailsTask",n.restaurantDetailsTask="RestaurantDetailsTask",n.feedbackTask="FeedbackTask",n.transitStopTask="TransitStopTask",n.transitLineTask="TransitLineTask",n.trafficFlipTask="TrafficFlipTask",n.trafficTask="TrafficTask",n.nearbyParkingTask="NearbyParkingTask",n.nearbyTransitTask="NearbyTransitTask",n.polygonEntityDetailsTask="PolygonEntityDetailsTask",n.measureMap="MeasureMapTask",n.itineraryDetailsTask="ItineraryDetailsTask",n.itineraryListingsTask="ItineraryListingsTask",n.venueMapDirectoryTask="VenueMapTask",n}(),ot;(function(n){n[n.EC=0]="EC";n[n.GPL=1]="GPL";n[n.PSS=2]="PSS";n[n.EMC=3]="EMC";n[n.SEW=4]="SEW";n[n.FB=5]="FB";n[n.TW=6]="TW";n[n.GSL=7]="GSL"})(ot||(ot={}));var ge=function(){function n(n,t){var u,f,c,i,e,o,h;this._taskManager=t;u=r.features;this._sharingConfig=u.sharing;this._taskBar=n;f=[];this._requestCompatibilityParams=!1;for(c in this._sharingConfig.supportedSchemas)f=f.concat(this._sharingConfig.supportedSchemas[c].supportedFeatures),f=f.filter(function(n,t){return f.indexOf(n)==t});for(this._referrerFormCodeRegex=/form=([^&]*)/ig,this._longLinkBase="",this._queryConstants="",i={},e=0;e<f.length;e++)i[f[e]]=!0;this._taskToFeatureMap={};this._featureToTaskMap={};this._featureToTaskMap.taskFramework="taskFramework";this._taskToFeatureMap.taskFramework="taskFramework";this._featureToTaskMap.shareImage="shareImage";this._taskToFeatureMap.shareImage="shareImage";u.localSearch.isEnabled&&i.LocalListing&&(this._taskToFeatureMap[s.localListingTask]="localListing");u.transit.isEnabled&&(i.TransitStop&&(this._taskToFeatureMap[s.transitStopTask]="transitStop",this._featureToTaskMap.transitStop=s.transitStopTask),i.NearbyTransit&&(this._taskToFeatureMap[s.nearbyTransitTask]="nearbyTransit",this._featureToTaskMap.nearbyTransit=s.nearbyTransitTask),i.TransitLine&&(this._taskToFeatureMap[s.transitLineTask]="transitLine",this._featureToTaskMap.transitLine=s.transitLineTask));u.localSearch.isEnabled&&i.LocalDetails&&(this._taskToFeatureMap[s.localDetailsTask]="localDetails");u.collections.isEnabled&&i.Collections&&(this._taskToFeatureMap[s.collectionsTask]="collections",this._featureToTaskMap.collections=s.collectionsTask);u.directions.isEnabled&&i.Directions&&(this._taskToFeatureMap[s.directionsTask]="directions",this._featureToTaskMap.directions=s.directionsTask);u.traffic.isEnabled&&i.Traffic&&(this._taskToFeatureMap[s.trafficTask]="traffic",this._featureToTaskMap.traffic=s.trafficTask);u.travel.isEnabled&&i.ItineraryDetails&&(this._taskToFeatureMap[s.itineraryDetailsTask]="itineraryDetails",this._featureToTaskMap.itineraryDetails=s.itineraryDetailsTask);o="mode0";this._featureToTaskMap.compositeMapMode=o;this._taskToFeatureMap[o]="compositeMapMode";u.streetside.isEnabled&&(h="mode2",this._featureToTaskMap.streetside=h,this._taskToFeatureMap[h]="streetside")}return n.getShortenServiceUrl=function(n){return b.shorteningServiceUrl.replace("{path}",encodeURIComponent("~".concat("/",b.shellPath,"?",n))).replace("{hostname}",window.location.hostname)},n.prototype.getQueryParameters=function(t,i,r,f){var c=[],y=0,s,o,e,h,l,v;for(s in t)if(t.hasOwnProperty(s)){if(o=s,!this._featureToTaskMap.hasOwnProperty(o)){if(!this._taskToFeatureMap.hasOwnProperty(o))continue;o=this._taskToFeatureMap[o]}c.push({id:(y++).toString(),featureType:o,data:u.Internals.stringify(t[s])})}e={};e.v=b.currentProtocolVersion.toString();e.sV=b.currentSchemaVersion.toString();this._referrerFormCodeRegex.lastIndex=0;h=this._referrerFormCodeRegex.exec(window.location.search);h&&h.length>1&&(e.form=h[1]);a.getFunctionalTestHooksEnabled()&&(e.testhooks="1");b.enableLandingPageChanges&&(e[b.landingPageChangeParameter]="1");l={queryParameters:e,onSuccess:function(t){if(i){var u=JSON.parse(t),e=u&&u.permalink;f&&(f.PSR=e?"pass":"fail",f.PL=u.permalink,n.instLog(ot.GPL,f));e?i&&i(u):r&&r()}},onError:function(){f&&(f.PSR="fail",n.instLog(ot.GPL,f));r&&r()}};v="/"+b.serviceEndpoint;wt.doPost(v,u.Internals.stringify(c),l)},n.prototype.getGeneralPermalink=function(t,i,r,f,e){var c=this,o={},k=!1,y=null,l,a,p,h,s,d,w,v;t&&(l=t.getMode(),l&&(a="mode"+l.mapModeType,o[a]=l.getState()),y=l.mapModeType);p=[];h={EP:f?f:"",FN:[],PSR:"",PL:"",MM:this._getMapModeLoggingType(y)};this._taskManager&&(b.enableMultipleCardSharing?(this._sharingConfig.currentSchemaVersion===1?(s=this._taskManager.serialize(!0,this._sharingConfig.currentSchemaVersion,e),s.buildBackwardCompatibleUrl=this._requestCompatibilityParams,o.taskFramework=s):this._sharingConfig.currentSchemaVersion===2&&(s=this._taskManager.serialize(!0,this._sharingConfig.currentSchemaVersion,e),s.buildBackwardCompatibleUrl=this._requestCompatibilityParams,o.taskFramework={objectStoreId:this._permalinkEntities&&this._permalinkEntities[n.osidQueryParamName]?this._permalinkEntities[n.osidQueryParamName].partValue:"",data:u.Internals.stringify(s)}),h.FN=[gt.TaskManager],k=!0,d=new uf(a&&o[a],s),d.createShareImage(function(n){n&&(o.shareImage={data:n});c.getQueryParameters(o,function(n,t){c._onPermalinkCallSuccess(n,i,t)},function(n,t){c._onPermalinkCallFailure(r,n,t)},h)})):(w=this._taskManager.getFocusedStack(),w&&(v=w.getForegroundTask(),o[v.type]=v.serialize(),p.push(this._getFeatureLoggingCode(v.type)),h.FN=p)));y==2&&(h.FN=[gt.Streetside]);k||this.getQueryParameters(o,function(n,t){c._onPermalinkCallSuccess(n,i,t)},function(n,t){c._onPermalinkCallFailure(r,n,t)},h)},n.prototype.setRequestCompatibilityParams=function(n){this._requestCompatibilityParams=n},n.prototype._onPermalinkCallSuccess=function(t,i,r){function l(n,t){var i=n[t];return i||(i={isEnabled:!0},n[t]=i),i}var s,h,u,v,c,f,y,e;if(b.enableMultipleCardSharing){this._permalinkEntities={};this._queryConstants="";this._longLinkBase="";var o=this._taskManager.getStacks(),p=this._taskManager.getFocusedStack(),a=t.permalink;if(a&&(s=a.split("?"),s.length==2)){for(this._longLinkBase=s[0]+"?",h=s[1].split("&"),f=0;f<h.length;f++)if(u=h[f],u)if(u.indexOf("tsts")===0){if(v=parseInt(u.slice(4,u.indexOf("="))),c=o[v],!c)continue;e=l(this._permalinkEntities,c.getForegroundTask().id);e.partValue=u}else if(u.indexOf("tstt")===0){var v=parseInt(u.slice(4,u.indexOf("="))),c=o[v],e=l(this._permalinkEntities,c.getForegroundTask().id);e.title=u}else u.indexOf(n.osidQueryParamName)===0?(e=l(this._permalinkEntities,n.osidQueryParamName),e.partValue=u.substring(u.indexOf("=")+1,u.length)):u.length>0&&(this._queryConstants+="&"+h[f]);if(this._permalinkEntities[n.osidQueryParamName]){for(f=0,y=o.length;f<y;f++)e=l(this._permalinkEntities,o[f].getForegroundTask().id);this._currentLongLink=a;this._currentPermalinkEntitiesHash=this._getLinkEntitiesHash()}}}i&&i(t,r)},n.prototype._onPermalinkCallFailure=function(n,t,i){this._permalinkEntities=null;this._currentPermalinkEntitiesHash=null;this._currentShortLink=null;n&&n(t,i)},n.prototype._getParamValueFromUrl=function(n,t){var f=n.split("?"),u,r,i;if(f.length==2)for(u=f[1].split("&"),r=0;r<u.length;r++)if((i=u[r],i)&&i.indexOf(t)===0)return i.substring(i.indexOf("=")+1,i.length);return null},n.prototype.shorten=function(t,i,r,u){var f=this,e,o;this._permalinkEntities==null&&i&&i("initial permalink hasn't been requested yet.");this._currentShortLink==null||this._currentShortlinkEntitiesHash!=this._getLinkEntitiesHash()||r||u?(e=this._constructCurrentQueryParams(r),u&&e.toLowerCase().indexOf("form=")!=-1&&(e=e.replace(/(form=).*?(&|$)/,"$1"+u+"$2")),o=n.getShortenServiceUrl(e),o.length>n.maxIeUrlLength&&(this._currentShortLink==null,this._currentShortlinkEntitiesHash=null,i()),wt.downloadJson(o,"permalink",function(n){r||u||(f._currentShortLink=n.d,f._currentShortlinkEntitiesHash=f._getLinkEntitiesHash());t&&t(n.d,f._longLinkBase+e)},function(){f._currentShortLink==null;f._currentShortlinkEntitiesHash=null;n.instLog(ot.SEW,{SL:o,ERR:6});i&&i()}),n.instLog(ot.GSL,{SL:o})):t&&t(this._currentShortLink)},n.prototype.isShorteningAvailable=function(){if(this._permalinkEntities!==null){var t=n.getShortenServiceUrl(this._constructCurrentQueryParams());if(t.length<=n.maxIeUrlLength)return!0}return!1},n.prototype.getPermalinkParts=function(){return this._permalinkEntities},n.prototype.getCurrentLink=function(t,i,r){var v=this,o,s,l,a,y,p,w;if(!this._permalinkEntities)throw new Error("initial permalink hasn't been requested yet.");if(this._sharingConfig.currentSchemaVersion===2&&this._currentPermalinkEntitiesHash!==this._getLinkEntitiesHash()){o={};t&&(s=t.getMode(),s&&(o["mode"+s.mapModeType]=s.getState()));var f=this._taskManager.getStacks(),e={focusedStackIndex:-1,stacks:[],isFocusedStackInCollapsedState:!1},b=this._taskManager.getFocusedStack(),h=void 0,c=f?f.length:0;for(c>1&&(l=f[c-1].getForegroundTask(),!l||l.type!=="CollectionsTask"||l.isPublicCollection&&l.isPublicCollection()||(f[c-2].displayState.isHidden=!1,f[c-2].getForegroundTask().displayState.isHidden=!1,f[c-2].getForegroundTask().displayState.activationState=1)),a=0,y=f.length;a<y;a++)h=f[a],p=h.getForegroundTask().id,this._permalinkEntities[p].isEnabled&&(e.stacks.push(h.serialize(!0,this._sharingConfig.currentSchemaVersion)),h===b&&(e.focusedStackIndex=e.stacks.length-1));h&&(e.focusedStackIndex===-1&&(e.focusedStackIndex=e.stacks.length-1),o.taskFramework={objectStoreId:this._permalinkEntities&&this._permalinkEntities[n.osidQueryParamName]?this._permalinkEntities[n.osidQueryParamName].partValue:"",data:u.Internals.stringify(e)},w=new uf(s&&s.getState(),e),w.createShareImage(function(n){n&&(o.shareImage={data:n});v.getQueryParameters(o,function(n){v._onUpdatePermalinkCallback(n,i)},function(){r&&r()})}));h||this.getQueryParameters(o,function(n){v._onUpdatePermalinkCallback(n,i)},function(){r&&r()})}else i(this._longLinkBase+this._constructCurrentQueryParams())},n.prototype._onUpdatePermalinkCallback=function(t,i){this._currentPermalinkEntitiesHash=this._getLinkEntitiesHash();this._currentLongLink=t.permalink;this._permalinkEntities[n.osidQueryParamName]&&(this._permalinkEntities[n.osidQueryParamName].partValue=this._getParamValueFromUrl(this._currentLongLink,n.osidQueryParamName));i&&i(t.permalink)},n.prototype._getLinkEntitiesHash=function(){for(var r,t="",n=0,i=Object.keys(this._permalinkEntities);n<i.length;n++)r=this._permalinkEntities[i[n]],r.isEnabled&&(t+=(t===""?"":"_")+i[n]);return t},n.prototype.getPrintParameters=function(){},n.prototype.processSharedStates=function(t){var o,c,h,i,r,l,y,p,b,f,k,a,tt;if(t&&(!t||t.length!=0)){var d=[],nt=[],v=!1;for(o=0,h=t.length;o<h;o++)if(i=t[o],this._featureToTaskMap.hasOwnProperty(i.featureType)&&this._featureToTaskMap[i.featureType]==="mode2"){v=!0;break}for(c=0,h=t.length;c<h;c++)i=t[c],r=JSON.parse(i.data),r&&(r.disableHistoryPointCreation=!0),v||(i.featureType===this._taskToFeatureMap[s.localDetailsTask]||i.featureType===this._taskToFeatureMap[s.localListingTask]?(this._taskBar&&r&&r.query&&this._taskBar.setSearchTerm(r.query),l=s.localSearchTask,y=!1,r&&(r.entryPoint=pt.Permalink,p=i.featureType===this._taskToFeatureMap[s.localDetailsTask]?s.localDetailsTask:i.featureType===this._taskToFeatureMap[s.localListingTask]?s.localListingTask:s.localSearchTask,b=e._overrideTasktypeBasedOnCategory(p,r),b!==p&&(l=b,y=!0)),y?g.invokeHandler(w.taskDataHandlerKey,{type:l,state:r}):g.invokeHandler(w.taskProcessDataHandlerKey,{type:l,requestState:r})):this._featureToTaskMap.hasOwnProperty(i.featureType)&&(v||(i.featureType===this._taskToFeatureMap.taskFramework?(f=r,this._sharingConfig.readSchemaVersion==2&&f.data&&(f=u.Internals.parseJSON(f.data)),this._taskManager.deserialize(f)):(i.featureType===this._taskToFeatureMap[s.directionsTask]&&(r.entryPoint=4),g.invokeHandler(w.taskDataHandlerKey,{type:this._featureToTaskMap[i.featureType],state:r}))))),d.push(this._getFeatureLoggingCode(this._featureToTaskMap[i.featureType])),nt.push(i.data?i.data:"");k=this._sharingConfig.formCode;this._referrerFormCodeRegex.lastIndex=0;a=this._referrerFormCodeRegex.exec(window.location.search);a&&a.length>1&&(k=a[1]);tt={FN:d,PSD:nt,RF:k};n.instLog(ot.PSS,tt)}},n.instLog=function(n,t){var i={logData:{feature:gt.Share,action:ot[n],data:t},isMapsAction:n!==ot.EC};g.invokeHandler(w.instrumentationDataHandlerKey,i)},n.prototype._getFeatureLoggingCode=function(n){switch(n){case s.collectionsTask:return gt.Collections;case s.directionsTask:return gt.Directions;case s.localDetailsTask:case s.localListingTask:case s.localSearchTask:return gt.Search;default:return""}},n.prototype._getMapModeLoggingType=function(n){switch(n){case 0:return"CM";case 1:return"OS";case 2:return"SS";default:return""}},n.prototype._constructCurrentQueryParams=function(t){var o="",a="",v="",s=null,h=Object.keys(this._permalinkEntities),f,e,c,u,i;if(this._permalinkEntities[n.osidQueryParamName])o+=(o.length?"&":"")+n.osidQueryParamName+"="+this._permalinkEntities[n.osidQueryParamName].partValue;else for(f=h.length-1;f>=0;f--)e=this._permalinkEntities[h[f]],e.isEnabled&&(o+="&"+e.partValue+(e.title?"&"+e.title:""),s||(s=h[f]));var y=this._taskManager.getFocusedStack(),p=y&&y.getForegroundTask(),l=p&&this._permalinkEntities[p.id],r=null;l&&l.isEnabled?r=l:s&&(r=this._permalinkEntities[s]);c=null;r&&r.partValue&&(u=r.partValue.split("="),u.length===2&&(c=/\d+/i.exec(u[0])[0],a=decodeURIComponent(decodeURIComponent(u[1]))),r.title&&(u=r.title.split("=")),u.length===2&&(v="&tt="+u[1]));c&&(this._queryConstants=this._queryConstants.replace(/ftst=\d+/i,"ftst="+c));i=a+v;h.length>0&&(i+=o);i+=this._queryConstants;switch(t){case 1:i=i.replace(/form=[a-z0-9]+/i,"form="+n.facebookFormCode);break;case 2:i=i.replace(/form=[a-z0-9]+/i,"form="+n.twitterFormCode)}return i},n.maxIeUrlLength=2083,n.maxAllowedSharingLinkLength=n.maxIeUrlLength-128,n.osidQueryParamName="osid",n.facebookFormCode="LMLTFB",n.twitterFormCode="LMLTTW",n}(),no=function(){function n(n,t,i){var r=this;this._serializableComponents={};this._window=n;this._map=i;t.instanceAsync("Permalink",function(n){r._permalink=n;r._permalink.setRequestCompatibilityParams(!0)});this._historyUrl=this._originalUrl=this._window.location.toString();this._currentUrlPath=this._originalUrlPath=this._window.location.pathname;this._setDevParams();this._isOnOverlay=e._isLargeMapShownOnSerp();this._history=new hu(n);this._history.statechanged.add(function(n){return r._processStateChange(n)});e._isSmallMapShownOnSerp()||(this._pageLoadStateDictionary=this._history.getState());this._serializableObjectChanged=new tt;this._serializableObjectChanged.addThrottled(function(n){return r._processObjectChange(n)},300,function(n,t){var i=t;return i&&i.magnitude===2||(i=n),i})}return n.prototype.register=function(n,t){var i=this;if(!n||!t||this._serializableComponents[n])throw new Error("Invalid or Duplicate Key passed for registration: "+n);return this._serializableComponents[n]=t,t.serializableObjectChanged.add(function(n){return i._raiseSerializationChanged(n)}),this._pageLoadStateDictionary&&this._pageLoadStateDictionary[n]&&t.deserialize(this._pageLoadStateDictionary[n]),!0},n.prototype.unregister=function(n){if(!n||!this._serializableComponents[n])throw new Error("Invalid key passed for registration: "+n);delete this._serializableComponents[n]},n.prototype.getHistoryState=function(){return this._history.getState()},n.prototype.doesLocalStorageStateExist=function(){var n=this._history.getLocalStorageState(),t;if(!n)return!1;for(t in n)if(n.hasOwnProperty(t))return!0;return!1},n.prototype.processLocalStorageState=function(){var n=this._history.getLocalStorageState();n&&this._processStateChange(n)},n.prototype.clearLocalStorageState=function(){this._history.clearLocalStorageState()},n.prototype._raiseSerializationChanged=function(n){this._ignoreSerializationEvents||this._serializableObjectChanged.invoke(n)},n.prototype.setIsCapturing=function(n){this._ignoreSerializationEvents=!n},n.prototype.nextHistoryPointReplace=function(){this._nextHistoryPointReplace=!0},n.prototype.updateAddressBar=function(n,t){var i=this._window.location,r;this._currentUrlPath=n;r=i.toString().replace(i.pathname,n);this._historyUrl=r;this._isOnOverlay=e._isLargeMapShownOnSerp();t&&this._history.replaceState(this._history.getState(),this._historyUrl)},n.prototype._processStateChange=function(n){var t,i;this._ignoreSerializationEvents=!0;this._pageLoadStateDictionary=null;this._reloadPageToHandleUrlChange();n=n||{};for(t in this._serializableComponents)this._serializableComponents.hasOwnProperty(t)&&(i=n[t]||{},this._serializableComponents[t].deserialize(i));this._updateBrowserUrl();this._ignoreSerializationEvents=!1},n.prototype._reloadPageToHandleUrlChange=function(){var n=this._window.location.toString();ft.enableUpdateUrlParams?this._currentUrlPath===this._window.location.pathname||this._isOnOverlay||this._window.location.reload():this._historyUrl===n||this._isOnOverlay||this._window.location.reload()},n.prototype._processObjectChange=function(n){var t,i,u;if(!(e._isSmallMapShownOnSerp()||r.dynamicProperties.mapsOverlayClosing)||n&&n.clearHistory){this._pageLoadStateDictionary=null;t={};for(i in this._serializableComponents)u=this._serializableComponents.hasOwnProperty(i)&&this._serializableComponents[i].serialize(),u&&(t[i]=u);ft.enableUpdateUrlParams&&this._updateUrlWithTaskParams();n&&n.clearHistory?this._history.clearState():n&&n.magnitude===2?this._nextHistoryPointReplace?(this._nextHistoryPointReplace=!1,this._history.replaceState(t,this._historyUrl)):this._history.pushState(t,this._historyUrl):this._history.replaceState(t,this._historyUrl);this._updateBrowserUrl()}},n.prototype._updateBrowserUrl=function(){ft.updateUrlDynamically&&this._requestPermalinkWithRetries({ts:Date.now(),isFullFilled:!1},0)},n.prototype._updateUrlWithTaskParams=function(){var t=this._serializableComponents.hasOwnProperty("TaskManager")&&this._serializableComponents.TaskManager,i,n,r;t&&(i=t,n=i.getFocusedStack(),n?(r=n.getTaskUrlParams(),this._historyUrl=this._window.location.origin+"/maps?"+r):this._historyUrl=this._window.location.origin+"/maps?",this._devParams&&(this._historyUrl+=this._devParams))},n.prototype._requestPermalinkWithRetries=function(n,t){var i=this;this._permalink&&(this._lastUrlUpdateRequestTS=n,this._permalink.getGeneralPermalink(this._map,function(t){n.ts<i._lastUrlUpdateRequestTS.ts&&i._lastUrlUpdateRequestTS.isFullFilled||(i._history.replaceState(i._history.getState(),t.permalink),i._lastUrlUpdateRequestTS.isFullFilled=!0)},function(){n.ts<i._lastUrlUpdateRequestTS.ts&&i._lastUrlUpdateRequestTS.isFullFilled||t<5&&n.ts>=i._lastUrlUpdateRequestTS.ts&&i._requestPermalinkWithRetries(n,t+1)},"URlUpdate"))},n.prototype._setDevParams=function(){var n=ft.devParamsList,u="",t,f,i,r;if(n&&n.length){for(t=0,f=n.length;t<f;t++)i=n[t],r=e._getUrlParam(window.location,i),r&&(u+="&"+i+"="+r);this._devParams=u}},n}(),ui=function(){function n(n){var t=this;this._window=n;this.length=-1;this.statechanged=new tt;u(this._window).add_event("hashchange",function(){return t._processHashChange()});this._loadState()}return n.prototype.back=function(){throw new Error("Not implemented");},n.prototype.forward=function(){throw new Error("Not implemented");},n.prototype.go=function(){throw new Error("Not implemented");},n.prototype.pushState=function(n){this._ignoreNextHashChange=!0;this._window.location.hash=this._serializeState(n)},n.prototype.replaceState=function(n){this._ignoreNextHashChange=!0;this._window.location.replace(this._window.location.href.split("#")[0]+"#"+this._serializeState(n))},n.prototype._processHashChange=function(){if(this._ignoreNextHashChange){this._ignoreNextHashChange=!1;return}this._loadState();this.statechanged.invoke(this.state)},n.prototype._loadState=function(){var n,t;this.state=null;try{n=this._window.location.hash;n&&n.length&&(t=u.Internals.base64Decode(n.substring(1)),this.state=u.Internals.parseJSON(t))}catch(i){}},n.prototype._serializeState=function(n){var t=u.Internals.stringify(n);return u.Internals.base64Encode(t)},n}(),hu=function(){function n(n){var i=this,t;this._window=n;this.statechanged=new tt;this._window.history&&this._window.history.pushState?(this._history=this._window.history,u(this._window).add_event("popstate",function(){return i._invokeStateChanged()})):(t=new ui(this._window),t.statechanged.add(function(){return i._invokeStateChanged()}),this._history=t);this._initialHistoryCount=this._history.length;this._historyIndex=0}return n.prototype.getState=function(){try{var n=this._history.state;return!n||this._history instanceof ui||(n=n.state),n}catch(t){return Microsoft.Maps.logger&&Microsoft.Maps.logger.logCriticalError(t),null}},n.prototype.pushState=function(n,t){if(r.isMobile||!(e._isSmallMapShownOnSerp()||r.dynamicProperties.mapsOverlayClosing)){if(this._historyIndex++,!t||this._history instanceof ui)this._history.pushState(n,null);else{var i={state:n,index:this._historyIndex,url:t};this._history.pushState(i,null,t)}this._setLocalStorageMapState(n)}},n.prototype.replaceState=function(n,t){if(r.isMobile||!(e._isSmallMapShownOnSerp()||r.dynamicProperties.mapsOverlayClosing)){if(!t||this._history instanceof ui)this._history.replaceState(n,null);else{var i={state:n,index:this._historyIndex,url:t};this._history.replaceState(i,null,t)}this._setLocalStorageMapState(n)}},n.prototype.clearState=function(){this._historyIndex>0&&this._history.go(-1*this._historyIndex);this._historyIndex=0},n.prototype.getLocalStorageState=function(){return it.isEnabled()?JSON.parse(it.getItem(n.historyLocalStorageKey)):null},n.prototype.clearLocalStorageState=function(){this._setLocalStorageMapState({})},n.prototype._setLocalStorageMapState=function(t){it.isEnabled()&&it.setItem(n.historyLocalStorageKey,JSON.stringify(t))},n.prototype._invokeStateChanged=function(){if(!r.dynamicProperties.mapsOverlayClosing){if(!(this._history instanceof ui))try{var n=this._history.state;this._historyIndex=n?n.index:0}catch(t){Microsoft.Maps.logger&&Microsoft.Maps.logger.logCriticalError(t);this._historyIndex=0}this.statechanged.invoke(this.getState())}},n.historyLocalStorageKey="BingMapsState",n}(),rh=function(){function n(){}return n}(),to=function(){function n(){}return n.getImageFromCss=function(t){var i=n._cachedImages.getItem(t);return i||(i=e._getImageFromCss(t),n._cachedImages.addItem(t,i)),i},n.prototype.dispose=function(){n._cachedImages.clear()},n._cachedImages=new vi(10),n}(),io=function(){function n(n,t){this._callback=n;this._options={expansionDeceleration:.0008,rotationalDeceleration:.0008,linearDeceleration:.0023};t&&this.setOptions(t)}return n.prototype.setOptions=function(n){if(typeof n.expansionDeceleration!="undefined"){if(n.expansionDeceleration<=0)throw new Error("The 'expansionDeceleration' argument must be positive");this._options.expansionDeceleration=n.expansionDeceleration}if(typeof n.rotationalDeceleration!="undefined"){if(n.rotationalDeceleration<=0)throw new Error("The 'rotationalDeceleration' argument must be positive");this._options.rotationalDeceleration=n.rotationalDeceleration}if(typeof n.linearDeceleration!="undefined"){if(n.linearDeceleration<=0)throw new Error("The 'linearDeceleration' argument must be positive");this._options.linearDeceleration=n.linearDeceleration}},n.prototype.getOptions=function(){return this._options},n.prototype.start=function(n,t){var i=this;this.stop();this._currentVelocities={angularVelocity:t.angularVelocity,expansionVelocity:t.expansionVelocity,linearVelocity:t.linearVelocity};this._pointerTrails=n;this._animationId=u.Effects.Animation.requestAnimationFrame(function(){return i._onTick()})},n.prototype.stop=function(){this._currentVelocities&&(u.Effects.Animation.cancelAnimationFrame(this._animationId),this._currentVelocities=null,this._callback&&this._callback(null,this._pointerTrails,null),this._pointerTrails=null)},n.prototype._onTick=function(){var s=this,t,f,i,e,r,o;this._currentVelocities&&(t=y.getMagnitudeOfVector2D(this._currentVelocities.linearVelocity),f=y.getAngleOfVector2D(this._currentVelocities.linearVelocity),t-=this._options.linearDeceleration*n._tickInterval,t=Math.max(t,0),this._currentVelocities.linearVelocity=y.getVector2DFromMagnitudeAndDirection(t,f),i=Math.abs(this._currentVelocities.angularVelocity),e=this._currentVelocities.angularVelocity>=0?1:-1,i-=this._options.rotationalDeceleration*n._tickInterval,i=Math.max(i,0),this._currentVelocities.angularVelocity=i*e,r=Math.abs(this._currentVelocities.expansionVelocity),o=this._currentVelocities.expansionVelocity>=0?1:-1,r-=this._options.expansionDeceleration*n._tickInterval,r=Math.max(r,0),this._currentVelocities.expansionVelocity=r*o,this._callback&&this._callback(this._currentVelocities,this._pointerTrails,n._tickInterval),t<.001&&i<.001&&r<.001?this.stop():u.Effects.Animation.requestAnimationFrame(function(){return s._onTick()}))},n._tickInterval=16,n}(),ro=function(){function i(n,t,i){this._events=[];this._map=n;this._container=i;this._coreConfig=t;this.landmarksAllDataSourcePromise=new yf;this._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!1,htmlContent:null,location:null,autoAlignment:!0,offset:new p(10,10)};this._coupoiLandmarksDisplayed={}}return i.prototype.initialize=function(){var t=this,i=new vf(function(n){t._container.instanceAsyncAll([{name:"LandmarksDataSource",args:t._coreConfig},{name:"LandmarksOSDataSource",args:t._coreConfig}],n)});i.getObjectAsync(function(i){t._landmarksDataSource=i.LandmarksDataSource;t._landmarksOSDataSource=i.LandmarksOSDataSource;t._layerDataSource=t._landmarksDataSource.getLayerDataSource(t._coreConfig.landmarksVectorLayerId);t._layerOSDataSource=t._landmarksOSDataSource.getLayerDataSource(t._coreConfig.landmarksVectorLayerId);var r=t._map.getMapType().id;r!==n.birdseye&&r!==n.birdseyeV2&&r!==n.streetside&&t._setDataSourceLayer();t.landmarksAllDataSourcePromise.resolve({landmarksDS:t._landmarksDataSource,landmarksOSDS:t._landmarksOSDataSource})});this._map.mapTypeChanged.add(function(i){t.landmarksAllDataSourcePromise.then(function(){t._layer&&(i.newMapTypeId===n.ordnanceSurvey?t._layer.setDataSource(t._layerOSDataSource):t._layer.setDataSource(t._layerDataSource))})})},i.prototype._setDataSourceLayer=function(){var n=this;this.landmarksAllDataSourcePromise.then(function(t){n._layer||n._addLayer(t)})},i.prototype._addLayer=function(t){var i=this,r;this._layer||(this._layer=this._map.getMapType().id===n.ordnanceSurvey?new bt(this._coreConfig.landmarksLayerId,this._layerOSDataSource,this,this._coreConfig.landmarksLayerZIndex):new bt(this._coreConfig.landmarksLayerId,this._layerDataSource,this,this._coreConfig.landmarksLayerZIndex),this._layer.setRenderTarget(1),this._layer.canBeFiltered=!0,t.landmarksOSDS.setLayer(this._layer),t.landmarksDS.setLayer(this._layer),r=this._map.getLayers(),r.insert(this._layer),this._layer.setVisible(!0),this._primitiveTapped=this._layer.primitiveTapped.add(function(n){i._onPrimitiveTapped(n)}),this._primitiveHoverStarted=this._layer.primitiveHoverStarted.add(function(n){i._onPrimitiveHoverStarted(n)}),this._primitiveHoverStopped=this._layer.primitiveHoverStopped.add(function(n){i._onPrimitiveHoverStopped(n)}),this._events.push(this._map.mapTypeChanged.add(function(n){i._onMapTypeChanged(n)}),r.changed.add(function(n){i._onMapLayersChanged(n)})),this._layer.overlayEvent=2)},i.prototype._onMapLayersChanged=function(n){var r=!n||n.reset,i=this._layer,t=i&&i.getDataSource();t&&t.invalidated&&r&&t.invalidated.invoke()},i.prototype._onMapTypeChanged=function(t){if(t.newMapTypeId!==t.oldMapTypeId){this._resetTemplateSelector=!0;this._initialized=!1;this.selectorReady();var i=t.newMapTypeId!==n.birdseye&&t.newMapTypeId!==n.streetside&&t.newMapTypeId!==n.birdseyeV2;this._layer.setVisible(i)}},i.prototype._removeLayer=function(){this._layer&&(this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null);this.removePrimitiveTapped();this.removePrimitiveHover();this._currentInfobox&&this._currentInfobox.dispose();e._clearDisposables(this._events)},i.prototype.applyFilterOnDataSource=function(n){var r,t,u,i,f,e;if(n){for(r=this._map.getBaseLayers(),t=0;t<r.length;t++)u=r[t],u instanceof bt&&(i=u.getDataSource(),i&&i.applyFilter&&i.applyFilter(n));f=this._layer.getDataSource();f.applyFilter(n);e={logData:{feature:si.Landmarks,action:ct.Activated,data:{FCAT:n.value.toString(),FCT:n.value.length}},isMapsAction:!0};g.invokeHandler(w.instrumentationDataHandlerKey,e)}},i.prototype.resetDataSource=function(){for(var i,n,u,r=this._map.getBaseLayers(),t=0;t<r.length;t++)i=r[t],i instanceof bt&&(n=i.getDataSource(),n&&n.resetFilter&&n.resetFilter());u=this._layer.getDataSource();u.resetFilter()},i.prototype.removePrimitiveTapped=function(){this._primitiveTapped&&(this._primitiveTapped.dispose(),this._primitiveTapped=null)},i.prototype.removePrimitiveHover=function(){this._primitiveHoverStarted&&(this._primitiveHoverStarted.dispose(),this._primitiveHoverStarted=null);this._primitiveHoverStopped&&(this._primitiveHoverStopped.dispose(),this._primitiveHoverStopped=null)},i.prototype.selectorReady=function(){var n=this;return!this._baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){n._baseMapTemplateSelector=t;n._resetTemplateSelector=!1;var i=t.selectorReady();return i.then(function(){n._initialized=!0}),i}):this._baseMapTemplateSelector.selectorReady()},i.prototype.getMarkupStyle=function(n,t){var i;return n&&this._initialized&&(i=this._baseMapTemplateSelector.getMarkupStyle(n,t,this._getPoiState(n),5)),i},i.prototype._getPoiState=function(n){var i=n.viewState,t=2;return i===1?t=3:i===2&&(t=4),t},i.prototype.getTemplates=function(n,t){var i=null,r=n.entity&&n.entity.landmarksDealFlag;return n&&this._initialized&&(i=this._baseMapTemplateSelector.getLandmarkVectorImageTemplate(n,this._getPoiState(n),t)),r&&this._coreConfig.landmarkDeals&&(i=sf.addBadgeTemplate(i,3)),i},i.prototype._selectPoi=function(n,t){var f=ut.getTransitJson(n.entity),e=ut.getYpid(n.entity),r,i,u,o,c,l;switch(t){case 2:e?(g.invokeHandler(w.taskProcessDataHandlerKey,{type:s.localDetailsTask,requestState:{entryPoint:pt.Landmarks,id:e,flippingCard:!1,taskTitle:ut.getDisplayName(n.entity)}}),this._log(si.Landmarks,ct.Clicked,n)):f&&(r=JSON.parse(f),r.stops&&r.stops.length>0&&(i=n.geometry,u=null,i&&(u=new h(n.crs.toLatitude(i.bounds[1],i.bounds[0]),n.crs.toLongitude(i.bounds[1],i.bounds[0]))),o={id:r.stops[0].id,title:r.stops[0].name,location:u,activationEntryPoint:1},g.invokeHandler(w.taskDataHandlerKey,{type:s.transitStopTask,state:o}),c={Z:this._map.getMercatorZoomLevel(),TM:n.bucket,S:ut.getLabelImportance(n.entity),L:u},l={logData:{feature:"TS",action:"MPC",data:c}},g.invokeHandler(w.instrumentationDataHandlerKey,l)))}},i.prototype._getMapBounds=function(){var t=k.getMapBounds(this._map,!0),n=[];return n.push(t.getNorth()),n.push(t.getWest()),n.push(t.getSouth()),n.push(t.getEast()),n},i.prototype._getRating=function(n,t){for(var r=t&&t.toLowerCase().indexOf("tripadvisor")>-1,f=r?"tartg_f sw_st":"sw_st",e=r?"tartg_hf sw_sth":"sw_sth",o=r?"tartg_e sw_ste":"sw_ste",u='<div><div class="me-b_factrow"><span class="csrc sc_rc1" role= "img" aria-label="Star Rating: '+n+' out of 10." >',i=0;i<10;i=i+2)u+='<span class="'+(n>i?n>i+1?f:e:o)+'"><\/span>';return u+"<\/span><\/div><\/div>"},i.prototype._createInfoboxHtml=function(n){var r=n.ads.length,i=n.ads[0],u=i.category||"",f=parseFloat(n.ads[0].bingRating);return he.replace("{image}",i.img||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAAAXRSTlMAQObYZgAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=").replace("{title}",n.name||"").replace("{facts}",u).replace("{morefacts}",this._getRating(f,i.ratingProvider)).replace("{price}",i.price||"").replace("{adsUrl}",i.cpc||"").replace("{numdeals}",r>1?t.LandmarkDealsMore_Text.replace("{0}",r-1):"").replace("{categoryOpacity}",u?"1":"0").replace("{ratingOpacity}",isNaN(f)?"0":"1")},i.prototype._onPrimitiveHoverStarted=function(n){var i=this,t=n.primitive,r=ut.getYpid(t.entity,!0),f=ut.getTransitJson(t.entity),e=t.entity,s=e.landmarksDealFlag,u,o;if(t.entity&&(r||f||s)){if(t.viewState=1,t.zIndex=2,this._hoverStartTimeStamp=Date.now(),t.entity.changed.invoke(),f){var c=JSON.parse(f),a=this._buildTransitStaticResources(c),v={overlayTemplate:new l(eu,a),overlayAnchor:new tr(-n.point.y-10,-n.point.x-10),overlayAlignment:0};ru.showOverlay(this._map,v,t)}r&&s&&this._coreConfig.landmarkDeals&&(u=t.geometry,this._infoboxOptions.location=new h(t.crs.toLatitude(u.x,u.y),t.crs.toLongitude(u.x,u.y)),this._currentInfobox||(this._currentInfobox=new wf(this._infoboxOptions.location,this._infoboxOptions),this._currentInfobox.setMap(this._map),this._currentInfobox.setPrimitive(t),this._events.push(this._currentInfobox.changed.add(function(n){n&&n.name==="htmlContent"&&i._registerInfoboxClickHandler(i._currentInfobox.getPrimitive())}))),this._coupoiLandmarksDisplayed[r]||(this._infoboxOptions.visible=!0,this._infoboxOptions.htmlContent=ce.replace("{morefacts}",this._getRating(0)),this._currentInfobox.setOptions(this._infoboxOptions)),o=this._coreConfig.landmarkDealsUrl.replace("{ypid}",r),this._landmarkDealRequestId=wt.downloadJson(o,"landmarkDeals",function(n,u){i._coupoiLandmarksDisplayed[r]=!0;var f=n.Ads;u===r&&(f&&f.length>0?(e.ads=f,i._infoboxOptions.visible=!0,i._infoboxOptions.htmlContent=i._createInfoboxHtml(e),i._currentInfobox.setPrimitive(t),i._currentInfobox.setOptions(i._infoboxOptions)):i._currentInfobox.setOptions({visible:!1}))},null,r,!1,0,null,null,df.getLogKeyFromUrl(o)))}},i.prototype._onPrimitiveHoverStopped=function(n){var t=n.primitive,r=t.entity;if(r){wt.abortRequest(this._landmarkDealRequestId);var f=ut.getYpid(r),u=ut.getTransitJson(r),e=t.entity.landmarksDealFlag;(f||u||e)&&(t.viewState=0,t.zIndex=0,this._hoverStartTimeStamp&&Date.now()-this._hoverStartTimeStamp>=i._hoverLoggingThresholdForEventLogging&&this._log(si.Landmarks,ct.Hovered,t,null,Date.now()-this._hoverStartTimeStamp),this._hoverStartTimeStamp=null,t.entity.changed.invoke(),u&&ru.hideOverlay(this._map,t),this._currentInfobox&&this._currentInfobox.getVisible()&&this._currentInfobox.setOptions({visible:!1,closeDelayTime:500}))}},i.prototype._onPrimitiveTapped=function(n){var t=n.primitive,i=ut.getYpid(t.entity);(t.entity&&i||ut.getTransitJson(t.entity))&&this._selectPoi(t,2)},i.prototype._registerInfoboxClickHandler=function(n){var r=this,i=u(".infoBoxLink");i.length>0&&(i.set_attr("aria-label",t.InfoboxListAriaLabel),i.set_style({cursor:"pointer"}),i.add_event("click",function(t){var i=t.target&&t.target.getAttribute("adsLink");i&&(r._log(si.LandmarksDeal,ct.Clicked,n,i),window.open(i,"_blank"));n.entity&&(r._selectPoi(n,2),r._currentInfobox.setOptions({visible:!1}))}))},i.prototype.dispose=function(){this._coupoiLandmarksDisplayed=null;this._removeLayer()},i.prototype._buildTransitStaticResources=function(n){var o="",s="",u=[],h=0,f=!1,i,t,r,e;if(n&&n.stops&&n.stops.length&&(s=n.stops[0].name,n.stops[0].routes&&n.stops[0].routes.length)){for(i=n.stops[0].routes,t=0;t<i.length;t++)for(r=0;r<i[t].names.length;r++)e=i[t].names[r],e.length>5&&h++,u.push(e);f=h>=u.length/2;o=u.join(f?"\n":", ")}return{transitLandmark:n,routeList:o,showLongList:f,stopName:s,addNewLines:this._addNewLines}},i.prototype._addNewLines=function(n){return n?"enableNewLines":""},i.prototype._log=function(n,t,i,r,u){var o=ut.getYpid(i.entity),f=i.geometry,s=null,e,c;f&&(s=new h(i.crs.toLatitude(f.bounds[1],f.bounds[0]),i.crs.toLongitude(f.bounds[1],f.bounds[0])));e=null;o&&(e={ID:o,Z:this._map.getMercatorZoomLevel(),L:s,CP:i.entity&&i.entity.landmarksDealFlag?"1":"0"},u&&(e.HD=u),r&&(e.dealsUrl=r));c={logData:{feature:n,action:t,data:e}};g.invokeHandler(w.instrumentationDataHandlerKey,c)},i._hoverLoggingThresholdForEventLogging=500,i}(),uo=function(){function n(n){this._primitives=[];this._changedEventHandlers=[];this.invalidated=new tt;n&&this.addPrimitives(n)}return n.prototype.addPrimitive=function(n){this.addPrimitives([n])},n.prototype.addPrimitives=function(n){for(var t,r=new li,i=0;i<n.length;i++)t=n[i],this._primitives.push(t),this._observePrimitiveChanges(t),t.geometry&&r.accumulate(t.geometry.bounds,t.crs);this._invokeInvalidatedEvent(r.getBounds())},n.prototype.removePrimitive=function(n){var t=this._primitives.indexOf(n),i,r;if(t===-1)throw new Error("The primitive does not exist is this data source.");i=this._changedEventHandlers[t];i&&i.dispose();this._primitives.splice(t,1);this._changedEventHandlers.splice(t,1);r=new li;n.geometry&&r.accumulate(n.geometry.bounds,n.crs);this._invokeInvalidatedEvent(r.getBounds())},n.prototype.clear=function(){this._disposeAllChangedEventHandlers();this._primitives=[];this._changedEventHandlers=[];this._invokeInvalidatedEvent(null)},n.prototype.getPrimitives=function(n,t){t({primitives:this._primitives})},n.prototype.dispose=function(){this._disposeAllChangedEventHandlers();this._primitives=null;this._changedEventHandlers=null},n.prototype._disposeAllChangedEventHandlers=function(){for(var t,n=0;n<this._changedEventHandlers.length;n++)t=this._changedEventHandlers[n],t&&t.dispose()},n.prototype._observePrimitiveChanges=function(n){var r=this,t=n.entitychanged,i=null;t&&(i=t.add(function(){return r._onPrimitiveChanged(n)}));this._changedEventHandlers.push(i)},n.prototype._onPrimitiveChanged=function(n){if(n.geometry){var t=new li;t.accumulate(n.geometry.bounds,n.crs);this._invokeInvalidatedEvent(t.getBounds())}},n.prototype._invokeInvalidatedEvent=function(n){this.invalidated.invoke({dirtyRect:n})},n}(),pi=function(){function n(n,t,i){this.expansion=n;this.rotation=t;this.translation=i}return n.prototype.clone=function(){return new n(this.expansion,this.rotation,new p(this.translation.x,this.translation.y))},n.areEqual=function(n,t){return a.assertNotNull(n,"manipulationDelta1"),a.assertNotNull(t,"manipulationDelta2"),n.expansion===t.expansion&&n.rotation===t.rotation&&n.translation.x===t.translation.x&&n.translation.y===t.translation.y},n}(),fo=function(){function n(){this._deltaList=[]}return n.prototype.clear=function(){this._deltaList.splice(0,this._deltaList.length)},n.prototype.add=function(n){a.assertNotNull(n,"manipulationDelta");var t=this._deltaList;t.length&&pi.areEqual(n,t[t.length-1])||t.push(n)},n.prototype.getLast=function(){return a.assert(this._deltaList.length>0,"Cannot call getLast when the trail is empty."),this._deltaList[this._deltaList.length-1]},n.prototype.getLastExcluding=function(n){a.assert(this._deltaList.length>0,"Cannot call getLastExcluding when the trail is empty.");for(var t=this._deltaList.length-1;t>=0&&pi.areEqual(this._deltaList[t],n);)--t;return t>=0?this._deltaList[t]:null},n.prototype.getLastN=function(n){return this._deltaList.slice(-n)},n.prototype.isEmpty=function(){return this._deltaList.length===0},n}(),uh=function(){function n(){}return n}(),eo=function(){function n(){this.reset()}return n.prototype.reset=function(){this._activeKeyCodes={}},n.prototype.processKeyDownEvent=function(n){var t=n.originalArgs;t&&(t.altKey||t.ctrlKey||t.metaKey)||(this._activeKeyCodes[n.keyCode]=!0)},n.prototype.processKeyUpEvent=function(n){this._activeKeyCodes[n.keyCode]=!1},n.prototype.isKeyPressed=function(n){return this._activeKeyCodes[n]},n.prototype.isPanUpRequested=function(){return this._activeKeyCodes[38]&&!this._activeKeyCodes[40]},n.prototype.isPanDownRequested=function(){return this._activeKeyCodes[40]&&!this._activeKeyCodes[38]},n.prototype.isPanLeftRequested=function(){return this._activeKeyCodes[37]&&!this._activeKeyCodes[39]},n.prototype.isPanRightRequested=function(){return this._activeKeyCodes[39]&&!this._activeKeyCodes[37]},n.prototype.isPanOperationRequested=function(){return this.isPanUpRequested()||this.isPanDownRequested()||this.isPanLeftRequested()||this.isPanRightRequested()},n.prototype.isZoomInRequested=function(){var n=this._activeKeyCodes,t=n[187]||n[107],i=n[189]||n[109];return t&&!i},n.prototype.isZoomOutRequested=function(){var n=this._activeKeyCodes,t=n[187]||n[107],i=n[189]||n[109];return i&&!t},n.prototype.isZoomOperationRequested=function(){return this.isZoomInRequested()||this.isZoomOutRequested()},n.prototype.isMapTypeSwitchRequested=function(){var n=this._activeKeyCodes;return n[65]||n[66]||n[69]||n[72]||n[79]||n[82]||n[83]},n.prototype.isNavigationRequested=function(){return this.isPanOperationRequested()||this.isZoomOperationRequested()},n}(),v=function(){function n(){}return n.ActionBubbleChanged="BC",n.BubbleLocation="BL",n.BubbleChangedMethod="BCM",n.BubbleChangedMethodArrow="Arrow",n.BubbleChangedMethodOverviewMap="OverviewMap",n.BubbleChangedMethodOverviewMapPoi="OverviewMapPoi",n.BubbleChangedMethodTapAndHold="TapAndHold",n.BubbleChangedMethodKeyboard="Keyboard",n.EntryPoint="EP",n.EntryPointZoomIn="ZoomIn",n.EntryPointStreetsideMini="StreetsideMini",n.EntryPointCoverageMap="CoverageMap",n.EntryPointDrivingDirections="DrivingDirections",n.EntryPointLocalDetails="LocalDetails",n.EntryPointPermalink="Permalink",n.EntryPointBrowserHistory="BrowserHistory",n.ExitMethod="EM",n.ExitMethodEscKey="EscKey",n.ExitMethodExitButton="ExitButton",n.ExitMethodExternal="External",n.NumberBubblesNavigated="NBN",n.OverviewMapActivated="OM"+ct.Activated,n.OverviewMapDeactivated="OM"+ct.Deactivated,n.OriginUser="User",n.OriginEvent="Event",n.PhotosynthModeFeatureName="PS",n.StreetsideModeFeatureName="SS",n.StreetsideMiniFeatureName="SM",n.StreetsideErrorAction="E",n.StreetsideBootstrapError="BE",n}(),kt=function(){function n(){}return n.CoverageLayerDisplayTime=v.StreetsideModeFeatureName+"_CLD",n.AutoEntryToImmersionTime=v.StreetsideModeFeatureName+"_AEI",n.CoverageLayerClickToImmersionTime=v.StreetsideModeFeatureName+"_CLCI",n.LocalDetailsClickToImmersionTime=v.StreetsideModeFeatureName+"_LDCI",n.DirectionsClickToImmersionTime=v.StreetsideModeFeatureName+"_DCI",n.StreetsideMiniClickToImmersionTime=v.StreetsideModeFeatureName+"_SMCI",n.ContextMenuClickToImmersionTime=v.StreetsideModeFeatureName+"_CMCI",n.PermalinkToImmersionTime=v.StreetsideModeFeatureName+"_PCI",n.BrowserHistoryToImmersionTime=v.StreetsideModeFeatureName+"_BHCI",n.LaunchToReadyTime=v.StreetsideModeFeatureName+"_LR",n.DirectionsIntegrationTime=v.StreetsideModeFeatureName+"_DI",n.LocalDetailsIntegrationTime=v.StreetsideModeFeatureName+"_LDI",n.UpdateOverviewMapTime=v.StreetsideModeFeatureName+"_UOM",n.OpenOverviewMapTime=v.StreetsideModeFeatureName+"_OOM",n.CloseOverviewMapTime=v.StreetsideModeFeatureName+"_COM",n.Succeeded="s",n.Failed="f",n}(),oo=function(){function i(n,t){this._map=null;this._noCoverage=!1;this._perfLog=t;this._bubbleLookupInProgress=!1;this._streetsideBubblePickerOverlay=null}return i.prototype.isAttached=function(){return!(this._map===null)},i.prototype.attach=function(n,t){var r=this;a.assert(!this._map,"An event source has already been attached to this behavior.");this._map=n;this._createStreetSideCoverageLayer();t?(this._streetsideBubblePickerOverlay=t.pickerOverlay,this._attachedTo=t.attachedTo,this._entryPoint=t.entryPoint,this._perfIdentifier=t.perfIdentifier,this._followCursor=t.followCursor,this._insertOverlays(),this._attachKeyHandler(),i._log(ct.Activated,this._entryPoint)):this._map.getContainer().instanceAsync("StreetsideBubblePickerOverlay",function(n){r._streetsideBubblePickerOverlay=n;r._attachedTo="StreetsideCoverageBehavior";r._entryPoint=v.EntryPointCoverageMap;r._perfIdentifier=kt.CoverageLayerClickToImmersionTime;r._followCursor=!0;r._insertOverlays();r._attachKeyHandler();i._log(ct.Activated,r._entryPoint)})},i.prototype.detach=function(){a.assertNotNull(this._map,"No map has been attached to this behavior.");this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.showCoverage(!0);this._bubbleLookupInProgress=!1;this._map&&this._map.getOverlays()&&this._map.getOverlays().remove(this._streetsideBubblePickerOverlay);this._imageryMapLayer.setVisible(!1);this._pointerMovedHandler&&this._pointerMovedHandler.dispose();this._mapViewChangedHandler&&this._mapViewChangedHandler.dispose();this._mapTappedHandler&&this._mapTappedHandler.dispose();this._frameRenderedHandler&&this._frameRenderedHandler.dispose();this._modeChangedHandler&&this._modeChangedHandler.dispose();this._detachKeyHandler();this._pointerMovedHandler=null;this._mapViewChangedHandler=null;this._mapTappedHandler=null;this._frameRenderedHandler=null;this._modeChangedHandler=null;this._streetsideBubblePickerOverlay=null;this._attachedTo=null;this._perfIdentifier=null;this._map=null;i._log(ct.Deactivated,this._entryPoint);this._entryPoint=null},i.prototype.getAttachedTo=function(){return this._attachedTo},i.prototype.toggleStreetsideButton=function(n){if(this._map){var t=u(".slot.streetside"),r=this._map.getNavigationBar(),i=r&&r.getHelper();t&&t.length>0&&i&&i.isEnabled(t)&&(n&&!i.isSwitchButtonTurnedOn(t)||!n&&i.isSwitchButtonTurnedOn(t))&&i.toggleSwitch(t)}},i.prototype._attachKeyHandler=function(){var n=this;this._keyPressedHandler=function(t){t&&t.keyCode===27&&(n.toggleStreetsideButton(!1),n.detach())};u(window).add_event("keyup",this._keyPressedHandler)},i.prototype._detachKeyHandler=function(){u(window).remove_event("keyup",this._keyPressedHandler);this._keyPressedHandler=null},i.prototype._insertOverlays=function(){var n=this;this._map.getOverlays().insert(this._streetsideBubblePickerOverlay);this._imageryMapLayer.setVisible(!0);this._map.getLayers().indexOf(this._imageryMapLayer)===-1&&this._map.getLayers().insert(this._imageryMapLayer);this._followCursor||this._streetsideBubblePickerOverlay.setAlignment(this._map.getView().cameraLocation);this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(t){return n._finalizeAttach(t)})},i.prototype._finalizeAttach=function(n){var t=this;this._map&&(this._streetsideModeBootstrapper=n,this._checkIfCoverageIsInView(null),this._followCursor?this._pointerMovedHandler=this._map.pointerMoved.add(function(n){return t._onPointerMoved(n)}):this._mapViewChangedHandler=this._map.viewChanged.add(function(n){return t._onMapViewChanged(n)}),this._mapTappedHandler=this._map.mapTapped.add(function(n){return t._onMapTapped(n)}),this._frameRenderedHandler=this._map.getFrameManager().frameRendered.add(function(n){return t._checkIfCoverageIsInView(n)}),this._modeChangedHandler=this._map.mapModeChanged.add(function(n){return t._onMapModeChanged(n)}),this._mapTypeChangedHandler=this._map.mapTypeChanged.add(function(){return t._onMapTypeChanged()}))},i.prototype._onMapModeChanged=function(n){n.newMode===2&&this.toggleStreetsideButton(!1);this.detach()},i.prototype._onMapTypeChanged=function(){this._map&&this._map.getMapType().id===n.birdseye&&this.detach()},i.prototype._checkIfCoverageIsInView=function(){var n=this;this._streetsideModeBootstrapper.isAvailable(this._map.getBounds(),function(t){return n._handleIsAvailableResponse(t)},function(){return n._noBubblesFoundInMapView()})},i.prototype._onPointerMoved=function(n){this._streetsideBubblePickerOverlay.setAlignment(n.location)},i.prototype._onMapViewChanged=function(){this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.setAlignment(this._map.getView().cameraLocation)},i.prototype._onMapTapped=function(n){var u=this,i,r,t;!n||n.exclusiveHitTest||this._bubbleLookupInProgress||this._noCoverage||(this._bubbleLookupInProgress=!0,i=this._map.getMode().tryPointToLocation(n.point),i&&(this._streetsideBubblePickerOverlay.showWaiting(),r=this._perfLog.start(this._perfIdentifier),t=this._map.getMapOptions().streetsideOptions||{},t.zoomIn=!0,t.entryPoint=this._entryPoint,t.perfState=r,this._streetsideModeBootstrapper.isAvailable(i,function(n){u._streetsideModeBootstrapper.show(n,t)},function(){return u._noBubblesFound(r)},t)))},i.prototype._noBubblesFound=function(n){var i=this;this._bubbleLookupInProgress=!1;this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.showNoCoverage(t.L_StreetsideNoCoverageInstructions_Text);Microsoft.Maps.setTimeout(function(){i._streetsideBubblePickerOverlay&&i._streetsideBubblePickerOverlay.showCoverage()},c.cursorSwapDelayTimeInMilliseconds);n&&n.end(kt.Failed)},i.prototype._handleIsAvailableResponse=function(n){n?(this._noCoverage=!1,this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.showCoverage()):this._noBubblesFoundInMapView()},i.prototype._noBubblesFoundInMapView=function(){this._noCoverage=!0;this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.showNoCoverage(r.isMobile?t.L_StreetsideMobileNoCoverageInMapView_Text:t.L_StreetsideNoCoverageInMapView_Text)},i.prototype._createStreetSideCoverageLayer=function(){if(!this._imageryMapLayer&&this._map){this._imageryMapLayer=new pf("Microsoft.Maps.StreetsideCoverage",c.coverageLayerZIndex,c.coverageLayerOpacity,null,null,2,null,this._map.getMapOptions().enableCORS);var n=e._updateTfeUrlDomain(c.coverageLayerTileUrlFormat),t=at.toScale(null,c.maxZoomForSS,!0);this._imageryMapLayer.addScene(10,ne.createMercatorImageryScene("SSCoverage",n,"",null,this._map),0,360,t)}},i._log=function(n,t){var i={feature:"SSCL",action:n,data:{EP:t}};g.invokeHandler(w.instrumentationDataHandlerKey,{logData:i})},i._defaultNumberOfBubblesToRequest=10,i}(),st=function(){function n(){}return n.ActionName="NC",n.RotateLeft="RotateLeft",n.RotateReset="RotateReset",n.RotateRight="RotateRight",n.MapMode="MapMode",n.ZoomIn="ZoomIn",n.ZoomOut="ZoomOut",n.MyLocation="MyLocation",n.Streetside="Streetside",n.MapTraffic="MapTraffic",n}(),ti=function(){function i(n){var t=this;this.isEnabled=function(n){var t=n[0].getAttribute("class");return t.indexOf("disabled")===-1};this._map=n;this._mapRoot=this._map.getRootElement();this._isStreetsideSupported=this.isStreetsideSupported();this._isStreetsideButtonEnabled=this._isStreetsideSupported;this._mePoi=new ao(n);this._locateMeErrorDialog=new wu(n);this._disposables=[];this.streetSideExitEvent=new tt;this._disposables.push(this._map.mapModeChanged.add(function(n){return t._onMapModeChanged(n)}));this._isLabelVisible=!0;this._isStreetsideSupported&&this._disposables.push(this._map.mapTypeChanged.add(function(){return t._onMapTypeChanged()}))}return i.prototype.setNavigationBar=function(n){this._navigationBar=n},i.prototype.getMap=function(){return this._map},i.prototype.getMapRoot=function(){return this._mapRoot},i.ignoreEvent=function(n){n.preventDefault()},i.prototype.rotateLeft=function(){var n=this._map.getNavigationBar();n&&n.isRotateLeftEnabled()&&(n.enableRotateLeftButton(!1),this._rotate(90),this._log(st.RotateLeft))},i.prototype.rotateRight=function(){var n=this._map.getNavigationBar();n&&n.isRotateRightEnabled()&&(n.enableRotateRightButton(!1),this._rotate(-90),this._log(st.RotateRight))},i.prototype.zoomIn=function(){var n=this._map.getNavigationBar();n&&n.isZoomInButtonEnabled()&&(this._zoomAroundCenterByDelta(1),this._log(st.ZoomIn))},i.prototype.zoomOut=function(){var n=this._map.getNavigationBar();n&&n.isZoomOutButtonEnabled()&&(this._zoomAroundCenterByDelta(-1),this._log(st.ZoomOut))},i.prototype.locateMe=function(){var n=this,t={callback:function(t){var e=!1,o=!1,s=0,w=n._map.getConfig(),f=r.dynamicProperties,u=null,p,l;if(t.success&&t.location&&t.position&&t.position.coords&&t.position.coords.accuracy>=0&&(s=t.position.coords.accuracy,e=s<=w.locateMeHighAccuracyMeters,o=e||!f.locationIsPreferenceBased,o&&(u=t.location)),u||(f.locationIsPreferenceBased&&f.preferenceBasedLocation?u=h.parseLatLong(f.preferenceBasedLocation):f.location?u=h.parseLatLong(f.location):f.reverseIPLocation?u=h.parseLatLong(f.reverseIPLocation):f.marketLocation&&(u=h.parseLatLong(f.marketLocation)),a.assert(!!u,"Could not find any location")),u){n._mePoi.setVisible(e);var v=n._map.getActualSize(),y=Math.max(v.width,v.height),c=n._map.getMercatorZoomLevel();s>0&&y>0&&(c=at.fromScale(u,6*s/y,!0));c=Math.max(Math.min(c,i._locateMeMaxZoom),i._locateMeMinZoom);e&&n._mePoi.setLocation(u);p=n._map.getView().cameraLocation;l=at.toLocation(u,c,!0);h.areEqual(p,l)?e||n._locateMeErrorDialog.show(o):(e||n._map.viewChanged.addOne(function(){n._locateMeErrorDialog.show(o)}),n._map.setView(new lt(l)))}}};this._geoLocationProvider||(this._geoLocationProvider=new ou(window,null));this._geoLocationProvider.GetCurrentPosition(t);this._log(st.MyLocation)},i.prototype.toggleTraffic=function(n){n.toggle(5);this._log(st.MapTraffic)},i.prototype.streetsideHandler=function(){var n=this;this.getMap().getContainer().instanceAsync("StreetsideModeBootstrapper",function(){g.invokeHandler(w.streetsideDataHandlerKey,{action:"toggleCoverageMap",map:n.getMap()});n._log(st.Streetside)})},i.prototype.toggleSwitch=function(n){var t=n[0].getAttribute("class");t.indexOf(i.selectedClass)===-1?n.add_class(i.selectedClass):n.remove_class(i.selectedClass)},i.prototype.turnSwitchButtonsOff=function(){for(var r,t=this._getRadialMenuSwitchButtons(),n=0;n<t.length;n++)r=t[n].getAttribute("class"),r.indexOf(i.selectedClass)>-1&&t[n].click()},i.prototype.isSwitchButtonTurnedOn=function(n){var t=n[0].getAttribute("class");return t.indexOf(i.selectedClass)!==-1},i.prototype.invokeMapTypeButtonClicked=function(n){var t=this._navigationBar;t&&t.mapTypeButtonClicked.invoke(n)},i.prototype._getRadialMenuSwitchButtons=function(){for(var t,i=[],r=this._mapRoot.select(".menu")[0].childNodes,n=0;n<r.length;n++)t=r[n],t.getAttribute("data-type")==="switch"&&i.push(t);return i},i.prototype.getCurrentZoom=function(){var n=this._map.getView(),t=n.cameraLocation;return at.fromLocation(new h(t.latitude,t.longitude,n.cameraLocation.altitude),!0)},i.prototype.getMapType=function(){return this.getMap().getMapType().id},i.prototype.setMapType=function(t){(t===n.birdseye||t===n.birdseyeV2)&&this._map.getMapOptions().disableBirdseye||(this._map.setMapType(t),this._log(st.MapMode))},i.prototype.dispose=function(){this._disposeMapEvents();this._windowEventHandler&&u(window).remove_event("click,touchend,keyup",this._windowEventHandler);e._nullifyClass(this)},i.prototype._rotate=function(t){for(var u=this,r,i;t<0;)t+=360;r=this._map.getView();i=(r.heading+t)%360;i!==r.heading&&(this._map.getMapType().id===n.birdseyeV2?this._isBirdseyeV2Rotating||i%90!=0||(this._isBirdseyeV2Rotating=!0,f.BirdseyeV2Manager.getIsBirdseyeV2Available(this._map.getConfig(),r.cameraLocation,i,function(n){n?(u._navigationBar&&u._navigationBar.rotateCompass(i),u._map.setView(new lt(r.cameraLocation,i),gr.defaultAnimation)):u.showBirdseyeV2NotAvailableTip(!0);u._isBirdseyeV2Rotating=!1},this._map.getViewport())):(this._navigationBar&&this._navigationBar.rotateCompass(i),this._map.setView(new lt(r.cameraLocation,i),gr.defaultAnimation)))},i.prototype.resetMapHeading=function(t){var i=this,r=this._map.getView();r.heading!==0&&(this._map.getMapType().id===n.birdseyeV2?this._isBirdseyeV2Rotating||(this._isBirdseyeV2Rotating=!0,f.BirdseyeV2Manager.getIsBirdseyeV2Available(this._map.getConfig(),r.cameraLocation,0,function(n){n?(i._navigationBar&&i._navigationBar.setDefaultCompassClass(0),i._map.setView(new lt(r.cameraLocation,0))):i.showBirdseyeV2NotAvailableTip(!0);i._isBirdseyeV2Rotating=!1},this._map.getViewport())):(this._navigationBar&&this._navigationBar.setDefaultCompassClass(0),this._map.setView(new lt(r.cameraLocation,0)),t&&this._log(st.RotateReset)))},i.prototype.toggleDropDownMenu=function(){var n=this._mapRoot.select(".NavBar_DropDown, .menu").has_class("opened");n?this.hideDropDownMenu():(r.isMapsVertical||this.isDropDownShowing()||this.checkBirdseyeV2ForDropdown(),this.showDropDownMenu())},i.prototype.isDropDownShowing=function(){return this._mapRoot.select(".NavBar_DropDown, .menu").has_class("opened")},i.prototype.showDropDownMenu=function(){var n=this,s,h,c,i;this._mapRoot.select(".NavBar_Container, .NavBar_MapTypeButtonContainer").add_class("selected").set_attr("aria-expanded","true");this._navigationBar.getNavigationBarOrientation()!==et.horizontal&&this._setRotateButtonVisible(!1);this._mapRoot.select(".NavBar_DropDown, .menu").add_class("opened");var f=this._map.getActualSize().height,e=parseInt(this._mapRoot.select("#MicrosoftNav").get_style("margin-top"))+parseInt(this._mapRoot.select(".NavBar_MapTypeButtonContainerWrapper").get_style("margin-top")),o=this._mapRoot.select("#MapStyleSelector").get_size().height,t=this._mapRoot.select("#RadialMenu"),l=t.get_size().height;e+l+o>=f&&(s=f-o-e,h={"max-Height":s,"overflow-y":"scroll","overflow-x":"hidden"},t.set_style(h));r.isMapsAnswer||r.isMapsVertical||t.set_style({"margin-top":"0px"});c=this._mapRoot.select("#navbarLabelToggleInput")[0];i=this.supportLabelToggle();c.checked=i?this._map.getLabelController().getIsLabelsEnabled():!0;this.enableLabelToggleButton(i);this._disposables.push(this._map.contextMenuInvoked.add(function(){return n.hideDropDownMenu()}),this._map.mapZoomStarted.add(function(){return n.hideDropDownMenu()}),this._map.mapPanStarted.add(function(){return n.hideDropDownMenu()}),this._map.mapTapped.add(function(){return n.hideDropDownMenu()}));this._windowEventHandler||(this._windowEventHandler=function(t){return n._onWindowEvent(t)},u(window).add_event("click,touchend,keyup",this._windowEventHandler));Microsoft.Maps.setTimeout(function(){n._map.mapRadialMenuChanged.invoke(!0)},200);this._adjustSlotText()},i.prototype.supportLabelToggle=function(){var i=this._map,r=i.getMapOptions(),u=i.getMapType().id,t=!0;switch(u){case n.ordnanceSurvey:case n.mercator:t=!1;break;case n.road:case n.highContrast:case n.grayscale:case n.canvasDark:case n.canvasLight:case n.roadDark:t=r.allowHidingLabelsOfRoad}return t},i.prototype.hideDropDownMenu=function(){this._mapRoot.select(".NavBar_DropDown, .menu").remove_class("opened");this._mapRoot.select(".NavBar_Container, .NavBar_MapTypeButtonContainer").remove_class("selected").set_attr("aria-expanded","false");this._mapRoot.select("#RadialMenu").set_style({"max-Height":"","overflow-y":"","overflow-x":""});var t=this._map.getMapType().id;(t===n.birdseye||t===n.birdseyeV2)&&this._setRotateButtonVisible(!0);this._map.mapRadialMenuChanged.invoke(!1);this._disposeMapEvents()},i.prototype.getNavBarOrientation=function(){return this._navigationBar.getNavigationBarOrientation()},i.prototype.getNavBarMode=function(){return this._navigationBar.getNavigationBarMode()},i.prototype.isKeyUp=function(n,t){if(n&&n.type==="keyup"&&t){var i=n,r=i.keyCode||i.which;return r===t}return!1},i.prototype.setFocusOnMapLayersButton=function(){var n=this;Microsoft.Maps.setTimeout(function(){n._mapRoot.select("#MapStyleSelector")[0].focus()},20)},i.prototype.setFocusOnRadialMenu=function(){var n=this;Microsoft.Maps.setTimeout(function(){var t=n._mapRoot.select("#RadialMenu"),i=u(t[0].children&&t[0].children[0]);i&&i[0].focus()},300)},i.prototype.handleLabelsVisibleOnMapTypeChanged=function(){var t=this.supportLabelToggle(),i=!t||this.getLabelVisible(),n;this.getMap().getLabelController().setIsLabelsEnabled(i);n=this.getMapRoot().select("#navbarLabelToggleInput")[0];n&&(n.checked=i,this.enableLabelToggleButton(t))},i.prototype.checkBirdseyeV2ForDropdown=function(){var i=this,n=this._navigationBar.getRootElement().select(".slot.birdseye"),t;n&&(this.setMapTypeButtonDisabled(n,!1),t=this._map.getView(),f.BirdseyeV2Manager.getIsBirdseyeV2Available(this._map.getConfig(),t.cameraLocation,0,function(t){t&&i.setMapTypeButtonDisabled(n,!0)},this._map.getViewport()))},i.prototype.exitBirdseyeV2=function(){var t=this;this._map.getBirdseyeV2Manager().then(function(i){t._birdseyeV2NotAvailableTip&&t._birdseyeV2NotAvailableTip.add_class("bm_birdseyeV2ReminderHidden");window.clearTimeout(t._birdseyeV2TipAutoFade);t.setMapType(i.previousMapState.mapTypeId||n.road);t.handleLabelsVisibleOnMapTypeChanged()})},i.prototype.updateNavBarForBirdseyeV2=function(n){var r=this._navigationBar.getRootElement().select(".NavBar_MapTypeButtonContainer"),u=this._navigationBar.getBirdseyeV2InfoExitControl(),t=u&&u.getBirdseyeV2ExitButton(),i="BirdseyeV2MapTypeButton";this.getNavBarOrientation()===et.vertical&&this.getNavBarMode()===d["default"]||(i+="ReducedSize");n?(this._navigationBar.getRootElement().select(".birdseyeV2Geochain").set_text(""),r.add_class(i),t&&t.updateHandler(!0),this.updateLabelToggleForBirdseyeV2(null,!0)):(r.remove_class(i),t&&t.updateHandler(!1))},i.prototype.updateLabelToggleForBirdseyeV2=function(n,t){var f=typeof n=="boolean"?n:this.getLabelVisible(),u;if(t){var e=this.getMap().getView().cameraLocation,o=new ht(new h(31.461471801529147,135),45,19.03685253618196),s=new ht(new h(48.378235544143905,146.25),22.5,14.796674949047564),r=" disabled",i=this._navigationBar.getRootElement().select(".be2LabelToggleContainer")[0];o.contains(e)||s.contains(e)?(i.className.indexOf(r)<0&&(i.className+=r),f=!1):i.className=i.className.replace(r,"")}u=this._navigationBar.getRootElement().select("#be2ToggleInput")[0];u&&(u.checked=f)},i.prototype.showBirdseyeV2NotAvailableTip=function(n){var h=this,o="bm_birdseyeV2ReminderHidden",s,i,r,u,f;this._birdseyeV2NotAvailableTip?(this._birdseyeV2NotAvailableTip.select(".bm_primaryMessage").set_text(n?t.L_NavBarBirdseyeV2NotAvailableRotationTip_PrimaryText:t.L_NavBarBirdseyeV2NotAvailableTip_PrimaryText),this._birdseyeV2NotAvailableTip.select(".bm_secondaryMessage").set_text(n?"":t.L_NavBarBirdseyeV2NotAvailableTip_SecondaryText),this._birdseyeV2NotAvailableTip.remove_class(o),window.clearTimeout(this._birdseyeV2TipAutoFade)):(s="bm_birdseyeV2NotAvailableTooltips birdseyeV2Tooltips",i=e._createElement("div").set_attr("class",s),this._birdseyeV2NotAvailableTip=i,r=e._createElement("div").set_attr("class","bm_birdseyeV2NotAvailableTooltipsMessage"),u=e._createElement("div").set_attr("class","bm_primaryMessage"),u.set_text(n?t.L_NavBarBirdseyeV2NotAvailableRotationTip_PrimaryText:t.L_NavBarBirdseyeV2NotAvailableTip_PrimaryText),f=e._createElement("div").set_attr("class","bm_secondaryMessage"),f.set_text(n?"":t.L_NavBarBirdseyeV2NotAvailableTip_SecondaryText),r.append(u).append(f),i.append(r),this._navigationBar.getRootElement().getParent().append(i));this._birdseyeV2TipAutoFade=Microsoft.Maps.setTimeout(function(){h._birdseyeV2NotAvailableTip.add_class(o)},2e3)},i.prototype.getIsBirdseyeV2FullControl=function(){var n=this.getNavBarMode();return(n===d["default"]||n===d.square)&&this.getNavBarOrientation()===et.vertical},i.prototype.getIsBirdseyeV2ControlNewLayout=function(){return r.isMapsVertical||r.isSDK&&this.getNavBarMode()===d.square},i.prototype._adjustSlotText=function(){var f,t,n,a,s;if(this.getMap().getMapOptions().navigationBarMode!=d.compact)for(f=this._mapRoot.select("#RadialMenu")[0].children,t=0,t;t<f.length;t++){var e=f.item(t),l=e.clientHeight,i=e.getElementsByClassName("pie-label-description")[0],o=i?i.clientHeight:0;if(o>0&&l/4<o){if(n=e.getElementsByClassName("labelStyle")[0],a=n?u(n).get_style("visibility"):"hidden",!n||a==="hidden")continue;if(s=n?n.clientHeight:0,s>0){var y=o+s,p=(l-2-y)/2,h=u(n).get_style("marginTop"),r=Number(h.match("\\d{2}")[0]),v=r-p,c=(r-v).toString().split(".")[0];u(n).set_style({marginTop:Number(c)});h=u(i).get_style("marginTop");r=Number(h.match("\\d{2}")[0]);c=(r-v).toString().split(".")[0];u(i).set_style({marginTop:Number(c)})}}}},i.prototype._disposeMapEvents=function(){e._clearDisposables(this._disposables)},i.prototype._zoomAroundCenterByDelta=function(n){var t=this._map,i=t.getMode(),f=t.getTargetView(),r=k.getViewportCenter(t),u=i.tryPointToLocation(r),e=i.getMapViewZoomedAboutLocation(f,u,n,1);t.setView(e,new uu(t,u,r),1)},i.prototype._log=function(n){var t=this._map.getView(),i={feature:si.MapControl,action:st.ActionName,data:{EL:n,CP:t.cameraLocation,H:t.heading,MM:this._map.getMode().getDisplayName(),MS:this._map.getMapType().displayName}};g.invokeHandler(w.instrumentationDataHandlerKey,{logData:i})},i.prototype._onMapModeChanged=function(n){n.oldMode===2&&this.streetSideExitEvent.invoke()},i.prototype._onMapTypeChanged=function(){if(this._map.getMapType().id===n.birdseye){this.enableStreetsideButton(!1);var t=this._getStreetsideButton();t.remove_class(i.selectedClass)}else this.enableStreetsideButton(!0)},i.prototype.isStreetsideSupported=function(){return c&&c.isEnabled},i.prototype.isStreetsideButtonEnabled=function(){return this._isStreetsideButtonEnabled},i.prototype.getLabelVisible=function(){return this._isLabelVisible},i.prototype.setLabelVisible=function(n){this._isLabelVisible=n},i.prototype.enableStreetsideButton=function(n){var t=this._getStreetsideButton();n?this._isStreetsideButtonEnabled||this.setMapTypeButtonDisabled(t,!0):this._isStreetsideButtonEnabled&&this.setMapTypeButtonDisabled(t,!1);this._isStreetsideButtonEnabled=n},i.prototype.setMapTypeButtonDisabled=function(n,t){t?(n.remove_class("disabled"),n.set_attr("tabindex","0")):(n.remove_class(i.selectedClass),n.add_class("disabled"),n.set_attr("tabindex","-1"))},i.prototype.enableLabelToggleButton=function(n){var r=this._navigationBar.getRootElement(),u=r.select("#navbarLabelToggleInput"),i=u.getParent().getParent();n?(i.remove_class("disabled"),i.set_attr("tabindex","0"),i.set_attr("aria-label","")):(i.add_class("disabled"),i.set_attr("tabindex","-1"),i.set_attr("aria-label",t.L_RadialMenuLabelToggleDisabled_Text))},i.prototype.isBirdseyeSupported=function(){var n=r.features.birdseye;return!!(n&&n.isEnabled)},i.prototype.enableBirdseyeButton=function(){var n=this._navigationBar.getRootElement();this.isBirdseyeSupported()?(n.select(".NavBar_Container .birdseye").remove_class("disabled"),n.select(".NavBar_Container .birdseye").set_attr("tabindex","0")):(n.select(".NavBar_Container .birdseye").add_class("disabled"),n.select(".NavBar_Container .birdseye").set_attr("tabindex","-1"))},i.prototype._onWindowEvent=function(n){n instanceof KeyboardEvent&&n.keyCode!==13&&n.keyCode!==27||(n.keyCode==27?(this.isDropDownShowing()&&this.isSwitchButtonTurnedOn(this._getStreetsideButton())&&n.stopImmediatePropagation(),this.hideDropDownMenu()):this.checkHideDropDownMenu(n.target))},i.prototype.checkHideDropDownMenu=function(n){n&&(this.dropDownMenu||(this.dropDownMenu=this._mapRoot.select("#RadialMenu")[0]),this.mapStyleSelector||(this.mapStyleSelector=this._mapRoot.select("#MapStyleSelector")[0]),this.mapStyleSelector&&this.mapStyleSelector.id!=n.id&&!this.mapStyleSelector.contains(n)&&this.dropDownMenu.id!=n.id&&!this.dropDownMenu.contains(n)&&this.isDropDownShowing()&&this.hideDropDownMenu())},i.prototype._getStreetsideButton=function(){if(this.streetsideButton)return this.streetsideButton;var n=this._mapRoot.select(".slot.streetside");return n.length>0&&(this.streetsideButton=n),n},i.prototype._setRotateButtonVisible=function(n){var t=this._map.getNavigationBar();t&&t.setRotateButtonVisible(n)},i._locateMeMinZoom=12,i._locateMeMaxZoom=17,i.selectedClass="selected",i}(),so=function(){function t(n,t,i,r){var u=this;this._map=n;this._mapElement=n.getRootElement()[0];this._aerialBirdsEyeTransitionManager=i;this._options={enabledInteractionModes:65535,tapThreshold:3,doubleTapThreshold:20,doubleTapTimeThreshold:500,autoRepeatDelay:1e3,autoRepeatTimerInterval:32,singlePanDistance:200,repeatPanDistance:20,singleZoomDistance:1,repeatZoomDistance:.05,maximumInitialLinearInertiaSpeed:1.41,maximumInitialExpansionInertiaSpeed:.07,maximumInitialAngularInertiaSpeed:.04};r&&this.setOptions(r);this._keyboardState=new eo;this._activePointers=new kf;this._previousManipulationDeltaTrail=new fo;this._inertia=new io(function(n,t,i){u._inertiaCallback(n,t,i)});this._previousTapTimestamp=0;this._coreConfig=t;this._resetStateToAwaitingInput();this._disposables=[];this._pointerWheelChanged=new tt;this._disposables.push(this._pointerWheelChanged.addThrottled(function(n){return u._zoomOnPointerWheelChanged(n)},75,function(n,t){return u._filterPointerWheelChanged(n,t)}));this._disposables.push(this._map.interactionModeUpdated.add(function(){u._updateMapInteractionModes()}));this._updateMapInteractionModes()}return t.prototype.dispose=function(){e._clearDisposables(this._disposables);clearTimeout(this._hoverDelayTimerId);clearTimeout(this._tapAndHoldTimerId);this._releasePointerCapture()},t.prototype.setOptions=function(n){function t(n,t,i){typeof t[n]!="undefined"&&(i[n]=t[n])}var i=this._options;t("disableAllInteractions",n,i);t("enabledInteractionModes",n,i);t("tapThreshold",n,i);t("doubleTapTimeThreshold",n,i);t("autoRepeatDelay",n,i);t("autoRepeatTimeInterval",n,i);t("singlePanDistance",n,i);t("repeatPanDistance",n,i);t("singleZoomDistance",n,i);t("repeatZoomDistance",n,i);t("maximumInitialLinearInertiaSpeed",n,i);t("maximumInitialExpansionInertiaSpeed",n,i);t("maximumInitialAngularInertiaSpeed",n,i)},t.prototype.disableInteractionModes=function(n){var t=this._options;t.enabledInteractionModes=t.enabledInteractionModes&~n},t.prototype.enableInteractionModes=function(n){var t=this._options;t.enabledInteractionModes=t.enabledInteractionModes|n},t.prototype.getOptions=function(){return this._options},t.prototype.setInertiaOptions=function(n){this._inertia.setOptions(n)},t.prototype.getInertiaOptions=function(){return this._inertia.getOptions()},t.prototype.onKeyDown=function(n){var r=this,t,i;return(this._map.keyPressed.invoke(n),!this._verifyInteractionsAreEnabled()||this._map.getMapOptions().disableKeyboardInput)?!1:(this._keyboardState.processKeyDownEvent(n),t=this._getActiveKeyboardState(this._keyboardState),i=t!==0,i&&(this._state===0||this._state===10)&&(this._state=3,(t===32||t===8)&&(this._keyAutoRepeatTimerId=Microsoft.Maps.setTimeout(function(){return r._onKeyAutoRepeatTimer()},this._options.autoRepeatDelay))),i)},t.prototype.onKeyUp=function(n){this._map.keyReleased.invoke(n);var t=this._getActiveKeyboardState(this._keyboardState),i=t!==0;if(i&&this._state===3){this._captureKeyboardNavProperties();switch(t){case 32:this._raisePanStartedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation);this._applyKeyboardPanOperation(this._options.singlePanDistance,null);this._raisePanStoppedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation);break;case 8:this._applyKeyboardZoomOperation(this._options.singleZoomDistance,1);break;case 1024:this._applyMapTypeSwitchOperation()}this._resetStateToAwaitingInput()}return this._keyboardState.processKeyUpEvent(n),i},t.prototype._getActiveKeyboardState=function(n){var t=0,i=this._map.getMapOptions();return!this._verifyInteractionsAreEnabled()||i.disableKeyboardInput?t:(!i.disablePanning&&this._isModeEnabled(32)&&n.isPanOperationRequested()?t=32:!i.disableZooming&&this._isModeEnabled(8)&&n.isZoomOperationRequested()?t=8:this._isModeEnabled(1024)&&n.isMapTypeSwitchRequested()&&(t=1024),t)},t.prototype._getMouseEventArgs=function(n,t){var i=t,r=f.MouseEventArgs;return r&&(i=new r(n,this._map,t)),i},t.prototype.onPointerEntered=function(n){(this._state===0||this._state===10)&&this._updateHoverState(n);this._map.pointerEntered.invoke(this._getMouseEventArgs("mouseover",n))},t.prototype.onPointerExited=function(n){this._updateHoverState(n);this._map.pointerExited.invoke(this._getMouseEventArgs("mouseout",n))},t.prototype.onPointerMoved=function(n){var t=n[0],e,f,i,r;if(t.buttonsState===0&&(e=u.Browser.is_ie&&u.Browser.ie_version===10,this._state===7||this._state===8||this._state===9&&!e||this._state===6)){t.button=1;t.buttonsState=1;try{this.onPointerReleased(t)}catch(o){this._resetStateToAwaitingInput();throw o;}return}if(this._map.pointerMoved.invoke(this._getMouseEventArgs("mousemove",t)),f=this._activePointers.getItem(t.identifier),f){i=f.get(0);this._updatePointerTrail(n);switch(this._state){case 1:y.getEuclideanDistance2D(t.point,i.point)>this._options.tapThreshold&&(i.primitive&&i.primitive.isMoveEnabled&&i.primitive.isMoveEnabled()&&this._isModeEnabled(512)?(this._state=9,this._raisePrimitiveMoveStartedEvent(t.point,t.location,i)):!this._map.getMapOptions().disablePanning&&this._isModeEnabled(16)?(this._state=8,this._raisePanStartedEvent(t.point,t.location),this._panMapToPoint(i.location,t.point,!0)):this._updateHoverState(t));break;case 2:a.assert(this._activePointers.getCount()>1,"One or fewer pointers being tracked");this._state=6;this._manipulationStartPoint=null;clearTimeout(this._tapAndHoldTimerId);r=this._createManipulationEventArgs(t.timestamp);this._raiseManipulationStartedEvent(r);break;case 7:this._raiseBoxZoomContinuedEvent(t.point,t.location);break;case 8:this._panMapToPoint(i.location,t.point,!0);this._raisePanContinuedEvent(t.point,t.location);break;case 9:this._raisePrimitiveMoveContinuedEvent(t.point,t.location,i);break;case 6:r=this._createManipulationEventArgs(t.timestamp);this._raiseManipulationContinuedEvent(r)}}else(this._state===0||this._state===10)&&this._updateHoverState(t)},t.prototype.onPointerPressed=function(n){if(this._verifyInteractionsAreEnabled()&&(n.originalArgs&&!n.originalArgs.isTrusted?this._previousUntrustedEventArgs=n:(this._previousUntrustedEventArgs&&this._previousUntrustedEventArgs.pointerType!==n.pointerType&&this._resetStateToAwaitingInput(),this._previousUntrustedEventArgs=null),this._map.pointerPressed.invoke(this._getMouseEventArgs("mousedown",n)),this._state===11&&this._resetStateToAwaitingInput(),this._isPointerEventTargetingMe(n)&&(this._activePointerType===0||this._activePointerType===n.pointerType)&&this._activePointers.getCount()<=2)){if(this._activePointers.getItem(n.identifier)){this._state===7&&this._raiseBoxZoomCanceledEvent();this._resetStateToAwaitingInput();return}this._activePointerType=n.pointerType;var t=new ko;t.add(n);this._activePointers.addItem(n.identifier,t);this._state===0?this._allowBoxZoom()&&(n.button===4||n.originalArgs.shiftKey)?(this._state=7,this._raiseBoxZoomStartedEvent(n.point,n.location),this._acquirePointerCapture()):n.button===1&&(this._state=1,(n.pointerType===4||n.pointerType===3)&&this._watchForTapAndHold(),this._acquirePointerCapture(),(this._isPrimitiveTapEnabled(n.primitive,!1)||this._isPrimitiveTapEnabled(n.primitive,!0))&&this._raisePrimitivePointerPressedEvent(n.point,n.location,n)):(this._state===1||this._state===8)&&n.button===1?(this._trimPointers(),this._state=2):this._state===7&&(this._raiseBoxZoomCanceledEvent(),this._resetStateToAwaitingInput())}},t.prototype._updatePointerTrail=function(n){for(var i,t=0;t<n.length;t++)i=this._activePointers.getItem(n[t].identifier),i&&i.add(n[t])},t.prototype._processTapEvent=function(n,t){var i=n.primitive;t&&this._clearTapTimeout();this._isPrimitiveTapEnabled(i,t)?this._raisePrimitiveTappedEvent(n.point,n.location,n,t):(this._raiseMapTappedEvent(n.point,n.location,n,t),!this._map.getMapOptions().disableZooming&&this._isModeEnabled(2)&&t&&k.zoomAroundLocation(this._map,n.location,1,!0,1,1))},t.prototype._clearTapTimeout=function(){clearTimeout(this._tapTimeoutId);this._tapTimeoutId=null},t.prototype.onPointerReleased=function(n){var a=this,i,t,f,e,o,s,h,c,l;if(this._map.pointerReleased.invoke(this._getMouseEventArgs("mouseup",n)),i=this._activePointers.getItem(n.identifier),i){if(t=i.get(0),this._state===1&&n.button===1){if(y.getEuclideanDistance2D(n.point,t.point)<=this._options.tapThreshold){if(f=n.timestamp,this._previousTapTimestamp){var v=f-this._previousTapTimestamp,p=y.getEuclideanDistance2D(t.point,this._previousTapPressEventArgs.point),w=n.pointerType===2?this._options.tapThreshold:this._options.doubleTapThreshold;e=v<=this._options.doubleTapTimeThreshold&&p<=w}o=t.primitive;(this._isPrimitiveTapEnabled(o,!1)||this._isPrimitiveTapEnabled(o,!0))&&this._raisePrimitivePointerReleasedEvent(t.point,t.location,t);s=r.isMapsAnswer&&!r.isMapsVertical;!e&&(this._coreConfig.delayMapClickEvent||s)?this._tapTimeoutId=Microsoft.Maps.setTimeout(function(){return a._processTapEvent(t,!1)},this._options.doubleTapTimeThreshold):this._processTapEvent(t,e);this._previousTapTimestamp=f;this._previousTapPressEventArgs=t}this._resetStateToAwaitingInput()}else this._state===2&&n.button===1?this._state=1:this._state===7?(n.button===t.button?this._raiseBoxZoomStoppedEvent(n.point,n.location):this._raiseBoxZoomCanceledEvent(),this._resetStateToAwaitingInput()):this._state===8&&n.button===1?(this._raisePanContinuedEvent(n.point,n.location),this._panMapToPoint(t.location,n.point,!0),this._releasePointerCapture(),this._map.getMapOptions().enableInertia!=!1?(this._inertia.start([i],{angularVelocity:0,expansionVelocity:0,linearVelocity:this._capLinearVelocity(i.getLastVelocity())}),this._state=11):this._doPostLinearInertiaWork(i)):this._state===9&&n.button===1?(this._raisePrimitiveMoveContinuedEvent(n.point,n.location,t),this._releasePointerCapture(),h=this._map.getMapOptions().enableInertia!=!1&&!(u.Browser.ie_version===10),c=t.primitive.isMoveInertiaEnabled&&t.primitive.isMoveInertiaEnabled(),h&&c?(this._inertia.start([i],{angularVelocity:0,expansionVelocity:0,linearVelocity:this._capLinearVelocity(i.getLastVelocity())}),this._state=11):this._doPostLinearInertiaWork(i)):this._state===6&&n.button===1&&(l=this._createManipulationEventArgs(n.timestamp),this._releasePointerCapture(),this._raiseManipulationStoppedEvent(l),this._resetStateToAwaitingInput());this._activePointers.removeItem(n.identifier)}},t.prototype.onPointerCaptureLost=function(){},t.prototype.onPointerCanceled=function(){this._resetStateToAwaitingInput()},t.prototype._zoomOnPointerWheelChanged=function(n){var r=this._map,f=at.fromLocation(r.getView().cameraLocation,!0),e=at.fromLocation(r.getTargetView().cameraLocation,!0),i=e-f,t=n.wheelDelta/2,u=Math.abs(t);!u||Math.abs(i)>.7||i>0&&t>0&&t<i||i<0&&t<0&&t>i||(t=t/u,k.zoomAroundLocation(r,n.location,t,!0,1,1))},t.prototype._filterPointerWheelChanged=function(n,t){return t.wheelDelta=t.wheelDelta/2+n.wheelDelta,t},t.prototype.onPointerWheelChanged=function(n){this._map.pointerWheelChanged.invoke(this._getMouseEventArgs("mousewheel",n));var t=!this._verifyInteractionsAreEnabled()||!this._isModeEnabled(4)||this._map.getMapOptions().disableZooming;t||(n.originalArgs.preventDefault(),n.originalArgs.stopPropagation(),this._pointerWheelChanged.invoke(n))},t.prototype.onContextMenuInvoked=function(n){this._raiseContextMenuInvokedEvent(n.point,n.location,n);this._resetStateToAwaitingInput()},t.prototype._panMapToPoint=function(n,t,i){var r=this._map.getTargetView(),u=this._map.getMode().getCameraForLocationToPoint(n,t,r.cameraLocation.altitude,0);u&&this._map.setView(new lt(u,r.heading),null,i?2:1,!i)},t.prototype._panMapToSpecificPoint=function(n,t,i){var u=this._map.getMode().tryPointToLocation(n),r=this._map.getMode().getCameraForLocationToPoint(u,t,this._map.getView().cameraLocation.altitude,0),f=this._map.getTargetView();r&&this._map.setView(new lt(r,f.heading),i,1)},t.prototype._applyManipulationToMap=function(n,t){var h=this._map.getMode(),u=this._map.getMapOptions(),c=y.getVectorSum2D(n.point,n.cumulative.translation),o=this._manipulationStartLocation,f=0,l=0,a=null,v=this._map.getTargetView(),s=v,i,e,r,p,w,b;if(!u.disableZooming){var k=at.fromLocation(this._manipulationStartView.cameraLocation,!0),d=at.fromLocation(this._map.getView().cameraLocation,!0),g=(this._manipulationStartLength+n.cumulative.expansion)/this._manipulationStartLength,nt=y.log2(g),tt=k+nt;if(f=tt-d,t&&(a=new uu(this._map,o,c),l=1,i=this._previousManipulationDeltaTrail.getLastN(4),i&&i.length>1)){for(e=0,r=1;r<i.length;r++)e+=i[r].expansion-i[r-1].expansion;e>0?f+=.5:e<0&&(f-=.5)}}u.disablePanning&&u.disableZooming||(p=u.disablePanning?h.tryLocationToPoint(o):c,s=h.getMapViewZoomedAboutLocationAtPoint(v,o,p,f,l));w=this._manipulationStartView.heading;b=w+n.cumulative.rotation;s.heading=b;this._map.setView(s,a,t?1:2)},t.prototype._updateHoverState=function(n){var r=this,t=n.primitive,u=n.hitTarget;if(this._isHoverEnabled(t)||(t=null,u=null),this._previousHoverTarget!==u||this._previousHoverPrimitive!==t){this._changeCursor(t,!!t);this._previousHoverTarget=u;this._previousHoverPrimitive=t;clearTimeout(this._hoverDelayTimerId);var i=this._activeHoverArgs,f=i&&i.primitive,e=i&&i.hitTarget;(t!==f||u!==e)&&(f&&!f.isDisposed&&this._raisePrimitiveHoverStoppedEvent(n.point,n.location,i),t?this._hoverDelayTimerId=Microsoft.Maps.setTimeout(function(){r._isHoverEnabled(t)?(r._activeHoverArgs=n,r._raisePrimitiveHoverStartedEvent(n.point,n.location,n)):r._activeHoverArgs=null},this._coreConfig.primitivesHoverDelay):this._activeHoverArgs=null)}},t.prototype._resetStateToAwaitingInput=function(){this._inertia.stop();this._state=0;this._activePointers.clear();this._activePointerType=0;this._previousManipulationDeltaTrail.clear();this._manipulationStartPoint=null;this._manipulationStartView=null;this._releasePointerCapture();this._resetKeyboardState();this._previousUntrustedEventArgs=null},t.prototype._resetKeyboardState=function(){this._keyboardState.reset();this._keyAutoRepeatTimerId&&(clearTimeout(this._keyAutoRepeatTimerId),this._keyAutoRepeatTimerId=null)},t.prototype._createManipulationEventArgs=function(n){var o=this._activePointers.getAt(0),s=this._activePointers.getAt(1),t=o.get(0),u=s.get(0),h,i;this._manipulationStartPoint||(h=this._manipulationStartView=this._map.getView(),this._manipulationStartPoint=y.getMidpoint2D(t.point,u.point),this._manipulationStartLocation=this._map.getMode().tryPointToLocation(this._manipulationStartPoint,h),this._manipulationStartLength=y.getEuclideanDistance2D(t.point,u.point),this._manipulationStartAngle=y.getAngleOfVector2D(y.getVectorDifference2D(t.point,u.point)));var f=o.getLast(),e=s.getLast(),p=y.getMidpoint2D(f.point,e.point),w=y.getEuclideanDistance2D(f.point,e.point),b=y.getAngleOfVector2D(y.getVectorDifference2D(f.point,e.point)),c=y.getVectorDifference2D(p,this._manipulationStartPoint),l=w-this._manipulationStartLength,a=-((b-this._manipulationStartAngle)*y.degreesPerRadian),r=new pi(l,a,c);this._previousManipulationDeltaTrail.isEmpty()&&(this._previousManipulationDeltaTrail.add(r),this._previousManipulationTimestamp=n);i=this._previousManipulationDeltaTrail.getLastExcluding(r);i||(i=r);var v=new pi(l-i.expansion,a-i.rotation,y.getVectorDifference2D(c,i.translation)),k=n-this._previousManipulationTimestamp,d=this._calculateManipulationVelocities(v,k),g={point:this._manipulationStartPoint,location:this._map.getMode().tryPointToLocation(this._manipulationStartPoint),primitive:t.primitive,layer:t.layer,exclusiveHitTest:t.exclusiveHitTest,cumulative:r,delta:v,isInertial:!1,velocities:d};return this._previousManipulationDeltaTrail.add(r),this._previousManipulationTimestamp=n,g},t.prototype._allowBoxZoom=function(){var i=this._map,r,n,t;return i.getMapOptions().disableZooming||!this._isModeEnabled(1)?!1:(r=i.getMapOptions().navigationOptions,n=!0,r&&r.lockCameraAltitude?n=!1:(t=i.getMode(),n=!!t.allowBoxZoom,typeof t.allowBoxZoom=="function"&&(n=t.allowBoxZoom())),n)},t.prototype._raiseBoxZoomStartedEvent=function(n,t){this._map.boxZoomStarted.invoke({point:n,location:t})},t.prototype._raiseBoxZoomContinuedEvent=function(n,t){this._map.boxZoomContinued.invoke({point:n,location:t})},t.prototype._raiseBoxZoomStoppedEvent=function(n,t){this._map.boxZoomStopped.invoke({point:n,location:t})},t.prototype._raiseBoxZoomCanceledEvent=function(){this._map.boxZoomCancelled.invoke()},t.prototype._raiseMapTappedEvent=function(n,t,i,r){var u=r?this._map.mapDoubleTapped:this._map.mapTapped,f={point:n,location:t,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs};u.invoke(this._getMouseEventArgs(r?"dblclick":"click",f))},t.prototype._raisePrimitiveHoverStoppedEvent=function(n,t,i){var r=i.primitive,u=i.layer,f={point:n,location:t,primitive:r,hitTarget:i.hitTarget,layer:u,exclusiveHitTest:i.exclusiveHitTest},e=this._getMouseEventArgs("mouseout",f);this._map.primitiveHoverStopped.invoke(f);u&&u.primitiveHoverStopped&&u.primitiveHoverStopped.invoke(e);r&&r.mouseout&&r.mouseout.invoke(e)},t.prototype._raisePrimitiveHoverStartedEvent=function(n,t,i){var r=i.primitive,u=i.layer,f={point:n,location:t,primitive:r,hitTarget:i.hitTarget,layer:u,exclusiveHitTest:i.exclusiveHitTest},e=this._getMouseEventArgs("mouseover",f);this._map.primitiveHoverStarted.invoke(f);u&&u.primitiveHoverStarted&&u.primitiveHoverStarted.invoke(e);r&&r.mouseover&&r.mouseover.invoke(e)},t.prototype._changeCursor=function(n,t){var i=n&&n.getCursor?n.getCursor():"pointer";this._map.getRootElement().set_style({cursor:t?i:""})},t.prototype._isPrimitiveTapEnabled=function(n,t){var i=!!n;return t?i&&n.isDoubleTapEnabled&&n.isDoubleTapEnabled()&&this._isModeEnabled(256):i&&n.isTapEnabled&&n.isTapEnabled()&&this._isModeEnabled(128)},t.prototype._raisePrimitivePointerPressedEvent=function(n,t,i){var r=i.primitive,u=i.layer,f=this._getMouseEventArgs("mousedown",{point:n,location:t,primitive:r,hitTarget:i.hitTarget,layer:u,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs});u&&u.primitivePointerPressed&&u.primitivePointerPressed.invoke(f);r&&r.mousedown&&r.mousedown.invoke(f)},t.prototype._raisePrimitivePointerReleasedEvent=function(n,t,i){var r=i.primitive,u=i.layer,f=this._getMouseEventArgs("mouseup",{point:n,location:t,primitive:r,hitTarget:i.hitTarget,layer:u,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs});u&&u.primitivePointerReleased&&u.primitivePointerReleased.invoke(f);r&&r.mouseup&&r.mouseup.invoke(f)},t.prototype._raisePrimitiveTappedEvent=function(n,t,i,r){var u=i.primitive,f=i.layer,o={point:n,location:t,primitive:u,hitTarget:i.hitTarget,layer:f,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs},e=this._getMouseEventArgs(r?"dblclick":"click",o);r?(this._map.primitiveDoubleTapped.invoke(o),f&&f.primitiveDoubleTapped&&f.primitiveDoubleTapped.invoke(e),u&&u.dblclick&&u.dblclick.invoke(e)):(this._map.primitiveTapped.invoke(o),f&&f.primitiveTapped&&f.primitiveTapped.invoke(e),u&&u.click&&u.click.invoke(e))},t.prototype._raisePrimitiveMoveStartedEvent=function(n,t,i){var r=i.primitive,u=i.layer,f={point:n,location:t,primitive:r,layer:u,exclusiveHitTest:i.exclusiveHitTest};r&&r.dragstart&&r.dragstart.invoke(this._getMouseEventArgs("dragstart",f));this._map.primitiveMoveStarted.invoke(f);u&&u.primitiveMoveStarted&&u.primitiveMoveStarted.invoke(f)},t.prototype._raisePrimitiveMoveContinuedEvent=function(n,t,i){var r=i.primitive,u=i.layer,f={point:n,location:t,primitive:r,layer:u,exclusiveHitTest:i.exclusiveHitTest};this._map.primitiveMoveContinued.invoke(f);u&&u.primitiveMoveContinued&&u.primitiveMoveContinued.invoke(f);r&&r.drag&&r.drag.invoke(this._getMouseEventArgs("drag",f))},t.prototype._raisePrimitiveMoveStoppedEvent=function(n,t,i){var r=i.primitive,u=i.layer,f={point:n,location:t,primitive:r,layer:u,exclusiveHitTest:i.exclusiveHitTest};this._map.primitiveMoveStopped.invoke(f);u&&u.primitiveMoveStopped&&u.primitiveMoveStopped.invoke(f);r&&r.dragend&&r.dragend.invoke(this._getMouseEventArgs("dragend",f))},t._manipulationTargetsPrimitive=function(n){return n.primitive&&n.primitive.isManipulationEnabled&&n.primitive.isManipulationEnabled()},t.prototype._raiseManipulationStartedEvent=function(n){t._manipulationTargetsPrimitive(n)?(this._map.primitiveManipulationStarted.invoke(n),n.layer&&n.layer.primitiveManipulationStarted&&n.layer.primitiveManipulationStarted.invoke(n)):(this._applyManipulationToMap(n),this._map.mapManipulationStarted.invoke(n))},t.prototype._raiseManipulationContinuedEvent=function(n){t._manipulationTargetsPrimitive(n)?(this._map.primitiveManipulationContinued.invoke(n),n.layer&&n.layer.primitiveManipulationContinued&&n.layer.primitiveManipulationContinued.invoke(n)):(this._applyManipulationToMap(n),this._map.mapManipulationContinued.invoke(n))},t.prototype._raiseManipulationStoppedEvent=function(n){t._manipulationTargetsPrimitive(n)?(this._map.primitiveManipulationStopped.invoke(n),n.layer&&n.layer.primitiveManipulationStopped&&n.layer.primitiveManipulationStopped.invoke(n)):(this._applyManipulationToMap(n,!0),this._map.mapManipulationStopped.invoke(n))},t.prototype._raiseContextMenuInvokedEvent=function(n,t,i){var f=i.primitive,r=i.layer,e={point:n,location:t,primitive:f,hitTarget:i.hitTarget,layer:r,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs},u=this._getMouseEventArgs("rightclick",e);this._map.contextMenuInvoked.invoke(u);r&&r.contextMenuInvoked&&r.contextMenuInvoked.invoke(u)},t.prototype._raisePanStartedEvent=function(n,t){this._map.mapPanStarted.invoke({point:n,location:t})},t.prototype._raisePanContinuedEvent=function(n,t){this._map.mapPanContinued.invoke({point:n,location:t})},t.prototype._raisePanStoppedEvent=function(n,t){this._map.mapPanStopped.invoke({point:n,location:t})},t.prototype._inertiaCallback=function(n,t,i){this._map&&!this._map.isDisposed()&&t&&(n?this._processLinearInertia(n,t[0],i):this._doPostLinearInertiaWork(t[0]))},t.prototype._processLinearInertia=function(n,t,i){var r=t.get(0),o=t.getLast(),s=new p(n.linearVelocity.x*i,n.linearVelocity.y*i),u=y.getVectorSum2D(o.point,s),e=this._map.getMode().tryPointToLocation(u),f=r.primitive;f&&f.isMoveEnabled&&f.isMoveEnabled()?this._raisePrimitiveMoveContinuedEvent(u,e,r):(this._panMapToPoint(r.location,u,!0),this._raisePanContinuedEvent(u,e));t.add({pointerType:r.pointerType,identifier:r.identifier,point:u,timestamp:Date.now()})},t.prototype._doPostLinearInertiaWork=function(n){var t=n.getLast().point,u=this._map.getMode().tryPointToLocation(t),i=n.get(0),r=i.primitive;r&&r.isMoveEnabled&&r.isMoveEnabled()?this._raisePrimitiveMoveStoppedEvent(t,u,i):(this._panMapToPoint(i.location,t,!1),this._raisePanStoppedEvent(t,u));this._resetStateToAwaitingInput()},t.prototype._calculateManipulationVelocities=function(n,t){var i=null,r=null,u=null;return t>0?(i=n.expansion/t,r=n.rotation/t,u=new p(n.translation.x/t,n.translation.y/t)):(i=0,r=0,u=new p(0,0)),{expansionVelocity:i,angularVelocity:r,linearVelocity:u}},t.prototype._isPointerEventTargetingMe=function(n){for(var t=n.element,r=!1,i;t&&!r;)r=t.className&&t.className.indexOf("ms-composite")!==-1||t.getAttribute("data-events-for")==="ms-composite",r||(t=t.parentElement);if(!r)return!1;for(i=t;i;){if(i.classList.contains("MicrosoftMap"))break;i=i.parentElement}return i!==this._mapElement?!1:!0},t.prototype._captureKeyboardNavProperties=function(){var n=this._map.getActualSize()||{width:0,height:0};this._keyboardNavPreviousCenterPoint=new p(n.width/2,n.height/2)},t.prototype._applyKeyboardPanOperation=function(n,t){var i=new p(this._keyboardNavPreviousCenterPoint.x,this._keyboardNavPreviousCenterPoint.y);this._keyboardState.isPanUpRequested()&&(i.y+=n);this._keyboardState.isPanDownRequested()&&(i.y-=n);this._keyboardState.isPanLeftRequested()&&(i.x+=n);this._keyboardState.isPanRightRequested()&&(i.x-=n);this._panMapToSpecificPoint(this._keyboardNavPreviousCenterPoint,i,t);this._keyboardNavPreviousCenterPoint=i;this._keyboardNavPreviousCenterLocation=this._map.getMode().tryPointToLocation(i)},t.prototype._applyKeyboardZoomOperation=function(n,t){var i=0,e;this._keyboardState.isZoomInRequested()?i=n:this._keyboardState.isZoomOutRequested()&&(i=-n);var r=this._map,u=this._keyboardNavPreviousCenterPoint.clone(),f=k.getViewportCenterOffset(r);u.x+=f.width;u.y+=f.height;e=r.getMode().tryPointToLocation(u);k.zoomAroundLocation(r,e,i,!0,1,t)},t.prototype._applyMapTypeSwitchOperation=function(){var o=this._map.getNavigationBar(),t,i=n.none,s=this._map.getMapType().id,u=!0,l,c,h,a;(o&&(t=o.getHelper(),s=t.getMapType(),u=t.getLabelVisible()),this._keyboardState.isKeyPressed(82)&&s!==n.road?i=n.road:this._keyboardState.isKeyPressed(65)||this._keyboardState.isKeyPressed(72)?(i=n.aerial,u=this._keyboardState.isKeyPressed(72)):this._keyboardState.isKeyPressed(79)||this._keyboardState.isKeyPressed(66)?this._map.getMapOptions().disableBirdseye||(l=r.isMapsVertical&&!e._isFeatureEnabled("birdseyeV2UI"),i=l?n.birdseye:n.birdseyeV2,u=this._keyboardState.isKeyPressed(66)):this._keyboardState.isKeyPressed(83)&&(i=n.ordnanceSurvey),c=this._map.createMapType(i),c.id==i)&&(h=!0,o?(t.isEnabled(o.getRootElement())&&t.hideDropDownMenu(),s!==i?i===n.birdseyeV2?(a=this._map.getView(),f.BirdseyeV2Manager.getIsBirdseyeV2Available(this._map.getConfig(),a.cameraLocation,0,function(n){n?(t.setLabelVisible(!!u),t.setMapType(i),h=t.supportLabelToggle(),t.updateLabelToggleForBirdseyeV2(null,!0)):t.showBirdseyeV2NotAvailableTip(!1)},this._map.getViewport())):(t.setMapType(i),this._aerialBirdsEyeTransitionManager.requestMapType(i),t.setLabelVisible(!!u),h=t.supportLabelToggle()):i===n.birdseyeV2&&(t.setLabelVisible(!!u),t.updateLabelToggleForBirdseyeV2(null,!0))):i!==n.birdseyeV2&&(s!==i&&this._map.setMapType(c),this._aerialBirdsEyeTransitionManager.requestMapType(i)),this._map.getLabelController().setIsLabelsEnabled(h?!!u:!0))},t.prototype._onKeyAutoRepeatTimer=function(){var n=this;this._state===3&&this._keyboardState.isNavigationRequested()&&(this._captureKeyboardNavProperties(),this._keyboardState.isPanOperationRequested()?(this._raisePanStartedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation),this._state=4):this._keyboardState.isZoomOperationRequested()&&(this._state=5),Microsoft.Maps.setTimeout(function(){return n._onKeyRepeatingTimer()},this._options.autoRepeatTimerInterval));this._keyAutoRepeatTimerId=null},t.prototype._onKeyRepeatingTimer=function(){var n=this;this._verifyInteractionsAreEnabled()&&(!this._map.getMapOptions().disablePanning&&this._isModeEnabled(32)&&this._state===4?this._keyboardState.isPanOperationRequested()?(this._applyKeyboardPanOperation(this._options.repeatPanDistance,null),this._raisePanContinuedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation),Microsoft.Maps.setTimeout(function(){return n._onKeyRepeatingTimer()},this._options.autoRepeatTimerInterval)):(this._raisePanStoppedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation),this._resetStateToAwaitingInput()):!this._map.getMapOptions().disableZooming&&this._isModeEnabled(8)&&this._state===5&&(this._keyboardState.isZoomOperationRequested()?(this._applyKeyboardZoomOperation(this._options.repeatZoomDistance),Microsoft.Maps.setTimeout(function(){return n._onKeyRepeatingTimer()},this._options.autoRepeatTimerInterval)):this._resetStateToAwaitingInput()))},t.prototype._capLinearVelocity=function(n){var t=y.getMagnitudeOfVector2D(n),i,r;return t<=this._options.maximumInitialLinearInertiaSpeed?n:(t=this._options.maximumInitialLinearInertiaSpeed,i=y.getAngleOfVector2D(n),r=y.getVector2DFromMagnitudeAndDirection(t,i),r)},t.prototype._capManipulationVelocities=function(n){var f=this._capLinearVelocity(n.linearVelocity),i=n.expansionVelocity,e=Math.abs(i),t,u,r;return e>this._options.maximumInitialExpansionInertiaSpeed&&(r=i>0?1:-1,i=this._options.maximumInitialExpansionInertiaSpeed*r),t=n.angularVelocity,u=Math.abs(t),u>this._options.maximumInitialAngularInertiaSpeed&&(r=t>0?1:-1,t=this._options.maximumInitialAngularInertiaSpeed*r),{linearVelocity:f,expansionVelocity:i,angularVelocity:t}},t.prototype._acquirePointerCapture=function(){u.Events.capture_mouse(this._mapElement)},t.prototype._releasePointerCapture=function(){u.Events.release_mouse()},t.prototype._trimPointers=function(){for(var t,r,n=0,i=this._activePointers.getCount();n<i;n++)t=this._activePointers.getAt(n),r=t.getLast(),t.clear(),t.add(r)},t.prototype._verifyInteractionsAreEnabled=function(){return this._options.disableAllInteractions?(this._resetStateToAwaitingInput(),!1):!0},t.prototype._isHoverEnabled=function(n){return n&&!n.isDisposed&&n.isHoverEnabled&&n.isHoverEnabled()&&!this._options.disableAllInteractions&&this._isModeEnabled(64)},t.prototype._isModeEnabled=function(n){return!!(this._options.enabledInteractionModes&n)},t.prototype._watchForTapAndHold=function(){var i=this,r,n;a.assert(this._state===1,"Must start watch in firstPointerPressed state.");r=this._activePointers.getAt(0);n=r.get(0);a.assert(n.pointerType===4||n.pointerType===3,"Watch is only applicable for touch and pen holds.");this._tapAndHoldTimerId=Microsoft.Maps.setTimeout(function(){if(i._state===1)i.onContextMenuInvoked(n)},t._tapAndHoldInterval)},t.prototype._updateMapInteractionModes=function(){var n=this._map.getMapOptions();n.disableScrollWheelZoom?this.disableInteractionModes(4):this.enableInteractionModes(4);n.disableKeyboardInput&&(this._state===3||this._state===4||this._state===5?this._resetStateToAwaitingInput():this._resetKeyboardState())},t._tapAndHoldInterval=750,t}(),ho=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,i.defineProperty("mapPrimitives",function(n,i){t.onPrimitivesChanged(n,i)}),i.defineProperty("selectedPrimitive"),t.invalidated=new tt,t.events=[],t}return o(t,n),t.prototype.onPrimitivesChanged=function(){this.invalidated.invoke()},t.prototype.getPrimitives=function(n,t){t&&t({primitives:this.getMapPrimitives()})},t.prototype.attach=function(n){var t=this;!this.map&&n&&(this.map=n,this.events.push(n.mapTapped.add(function(n){return t._onMapTapped(n)})),this.events.push(n.primitiveTapped.add(function(n){return t._onMapTapped(n)})),this._createLayer())},t.prototype.dispose=function(){var t,n;if(this.events){for(t=this.events.length,n=0;n<t;n++)this.events[n].dispose();this.events=null}this.layer&&(this.map.getLayers().remove(this.layer),this.layer.dispose(),this.layer=null)},t.prototype.setCenter=function(n){var t=this.map.getActualSize(),r=new p(t.width/2,t.height/2),i=this.map.getView(),u=i.heading,f=i.cameraLocation.altitude,e=this.map.getMode().getCameraForLocationToPoint(n,r,f,0),o=new lt(e,u);this.map.setView(o,null,0)},t.getLocationsForPrimitivesInView=function(n){if(!n)throw"The 'primitives' parameter cannot be null or undefined.";return t._getLocations(n)},t.getUniqueId=function(){var n=t._layerIndex++;return"Layer_"+n},t._getLocations=function(n){var e=[],v,o,t,l,i,u,c,r,s,f;if(n)for(v=n.length,o=0;o<v;o++)if(t=n[o],t.geometry)switch(t.geometryType){case 1:l=t.geometry;e.push(new h(l.y,l.x));break;case 2:for(i=t.geometry,a.assert(i.x.length===i.y.length,"x and y values should be of equal length"),s=i.x.length,u=0;u<s;u++)e.push(new h(i.y[u],i.x[u]));break;case 3:var p=t.geometry,y=p.rings,w=y.length;for(c=0;c<w;c++)for(r=y[c],a.assert(r.x.length===r.y.length,"x and y values should be of equal length"),s=r.x.length,f=0;f<s;f++)e.push(new h(r.y[f],r.x[f]));break;default:a.assert(!1,"Geometry Type is not defined for the primitive")}return e},t.prototype._createLayer=function(){var n=this;this.layer=new bt(t.getUniqueId(),this,null,t._zOrder++);this.map.getLayers().insert(this.layer);this.events.push(this.layer.primitiveTapped.add(function(t){n._onLayerTapped(t)}))},t.prototype._onLayerTapped=function(n){n.primitive&&n.layer&&this.setSelectedPrimitive(n.primitive)},t.prototype._onMapTapped=function(n){n.primitive!==this.getSelectedPrimitive()&&this.setSelectedPrimitive(null)},t._zOrder=8e3,t._layerIndex=1e4,t}(yi),co=function(){function t(n,t){var i=this;this._map=n;t&&(n.getMode()?this._initialize(t):n.mapModeChanged.addOne(function(){i._initialize(t)}))}return t.prototype.serialize=function(){return this._map.getMode().getState()},t.prototype.deserialize=function(n){var r=this,i=this._map,t=n;t&&t.mode!==undefined||(t=this._defaultState);t.mode===0?i.navigationBarLoaded.addOne(function(){return r._initCompositeMode(i,t)},!1,!0):t.mode===2&&this._initStreetsideMode(i,t)},t.prototype._initialize=function(t){var u=this,i=this._map,o=i.getMode();a.assert(!!o,"Initialize called with no map mode");this._defaultState=i.getMode().getState();a.assert(!!this._defaultState,"Map mode has no state");this.serializableObjectChanged=new tt;t.register("MapModeStateHistory",this);var f=function(n){return function(){u._isSettingState||u.serializableObjectChanged.invoke({magnitude:n})}},r=f(1),e=f(2);i.mapModeChanged.add(e);i.mapTypeChanged.add(function(t){t.newMapTypeId===n.birdseyeV2||t.oldMapTypeId===n.birdseyeV2?e():r()});i.getLabelController().labelsEnabledChanged.add(r);i.viewChanged.addThrottled(r,500)},t.prototype._initCompositeMode=function(t,i){var r=this;t.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(i.hasRequestedBE?n.birdseye:n.aerial);t.getContainer().instanceAsync("CompositeMapMode",function(n){var u,f;r._isSettingState=!0;t.setMode(n);e._isFeatureEnabled("birdseyeV2UI")||t.setBaseLayers(i.style);u=i.labelVisibility===ie.visible;t.getNavigationBar().getHelper().setLabelVisible(u);t.getLabelController().setIsLabelsEnabled(u);f=new lt(h.cloneFrom(i.centerPoint),i.direction);t.setView(f,null);e._isFeatureEnabled("birdseyeV2UI")&&t.setBaseLayers(i.style);r._isSettingState=!1})},t.prototype._initStreetsideMode=function(n,t){var i=this;n.getContainer().instanceAsync("StreetsideModeBootstrapper",function(n){var r=t,u=function(){i._isSettingState=!1};i._isSettingState=!0;n.show(h.cloneFrom(r.centerPoint),{heading:r.direction,pitch:r.pitch,overviewMapMode:r.overviewMap,zoomIn:!0,entryPoint:v.EntryPointBrowserHistory,perfClickToImmersionTimeSource:kt.BrowserHistoryToImmersionTime,onSuccessLoading:u,onErrorLoading:u})})},t}(),lo=function(){function t(i){var f=this,r,u;if(!i)throw new Error("map cannot be null");this._map=i;r=i.getMapOptions();u=this._map.getConfig();this._maxZoomLevelBirdsEye=r&&r.aerialCutOffZoom?r.aerialCutOffZoom:u&&u.aerialCutOffZoom?u.aerialCutOffZoom:t.DEFAULT_ZOOM_CUT_OFF_FOR_BIRDSEYE_MODE;this._maxZoomLevelAerial=t.DEFAULT_ZOOM_CUT_OFF_FOR_AERIAL_MODE;this._maxZoomLevel=r.mapType===n.birdseye?this._maxZoomLevelBirdsEye:this._maxZoomLevelAerial;this.changed=new tt;this._mapTypeChangedHandler=i.mapTypeChanged.add(function(){f._handleMapType(!0)});this._handleMapType(!1)}return t.prototype.requestMapType=function(t){var r=this._maxZoomLevel,i=r;t===n.aerial?i=this._maxZoomLevelAerial:t===n.birdseye&&(i=this._maxZoomLevelBirdsEye);r!==i&&(this._maxZoomLevel=i,this._handleZoomChange(this._map.getMercatorZoomLevel()),this.changed.invoke())},t.prototype.hasRequestedBirdsEye=function(){return!this._map.getMapOptions().disableBirdseye&&this._maxZoomLevel===this._maxZoomLevelBirdsEye},t.prototype._handleMapType=function(t){var u=this,r=this._map.getMapType().id,i;r===n.aerial||r===n.birdseye?(this._activate(),i=this._map.getMercatorZoomLevel(),t?Microsoft.Maps.setTimeout(function(){u._handleZoomChange(i)},0):this._handleZoomChange(i)):this._deactivate()},t.prototype.dispose=function(){this._deactivate();this._mapTypeChangedHandler&&(this._mapTypeChangedHandler.dispose(),this._mapTypeChangedHandler=null)},t.prototype._activate=function(){var i=this,n,t;this._isActive||(n=this._map,t=this._handlers=[],t.push(n.mapZoomStopped.add(function(n){return i._handleZoomChange(n.zoom)})),t.push(n.viewChanged.add(function(){i._handleZoomChange(k.getMercatorZoomLevel(n))})),this._isActive=!0)},t.prototype._deactivate=function(){var n,t,i;if(this._isActive){if(n=this._handlers,n){for(t=0,i=n.length;t<i;t++)n[t].dispose();this._handlers=[]}this._isActive=!1}},t.prototype._handleZoomChange=function(t){this._isActive&&(!this._map.getMapOptions().disableBirdseye&&t>this._maxZoomLevel?this._setMapType(n.birdseye):this._setMapType(n.aerial))},t.prototype._setMapType=function(n){this._isActive&&this._map.getMapType().id!==n&&this._map.setBaseLayers(n)},t.DEFAULT_ZOOM_CUT_OFF_FOR_BIRDSEYE_MODE=16,t.DEFAULT_ZOOM_CUT_OFF_FOR_AERIAL_MODE=21,t}(),rt=function(n){function t(t){var i=this,r;return t=t||{},i=n.call(this,null,t)||this,t&&(r=t.helper),i.defineProperty("helper",null,null,{defaultValue:r}),i.defineProperty("style",i.onStyleChanged,i._styleConverter),i.defineProperty("title"),i}return o(t,n),t.prototype._onMouseEnter=function(){var n=this.getHelper();r.isMapsVertical||n.isDropDownShowing()||n.checkBirdseyeV2ForDropdown();n.showDropDownMenu()},t.prototype._onMouseLeave=function(n){var t=this.getHelper();n.toElement?t.checkHideDropDownMenu(n.toElement):t.hideDropDownMenu()},t.prototype._onBlur=function(n){this.getHelper().checkHideDropDownMenu(n.relatedTarget)},t.prototype.boolToVisibility=function(n){return n?"visible":"hidden"},t.prototype.getChildren=function(){var t,n;if(!this._children)for(t=this.getRootElement()[0].childNodes,this._children=[],n=0;n<t.length;n++)this._children.push(u(t[n]));return this._children},t.prototype.onStyleChanged=function(n,t){var i=this.getRootElement(),r;if(t&&e._isArray(t))for(r=0;r<t.length;r++)i.set_style&&i.set_style(t[r]);else i.set_style&&i.set_style(t)},t.prototype._styleConverter=function(n){var i,r,t,u;if(typeof n!="string")return n;i={};r=n.split(";");for(t in r)u=t.split(":"),a.assert(u.length===2,"Style format is invalid"),i[t[0]]=t[1];return i},t}(af),vt=function(n){function t(t){var i=n.call(this,t)||this;return i.rendered.add(function(){return i._postInit()}),i}return o(t,n),t.prototype.init=function(n,t,i,r){var u=this;this.id=n;this.className=t;this.setTitle(i);this._onNavBarButtonClick=r;this.setTemplate(new l(oe,{onClick:function(n){return u._onClick(n)},onMouseOut:function(){try{u.getRootElement()[0].blur()}catch(n){}},onFocus:function(){return u._onFocus()},stopEvent:function(n){return n.stopPropagation()}}))},t.prototype._onClick=function(n){n.stopPropagation();ti.ignoreEvent(n);this._onNavBarButtonClick&&this._onNavBarButtonClick(n)},t.prototype._onFocus=function(){this.getHelper().checkHideDropDownMenu(this.getRootElement()[0])},t.prototype._postInit=function(){this.className&&this.getRootElement().add_class(this.className)},t}(rt),cu=function(n){function i(i){var r=n.call(this,i)||this;return r.keydownEventName="keydown",n.prototype.init.call(r,"BirdseyeV2ExitButton","birdseyeV2Exit",t.L_NavBarBirdseyeV2ExitTip_Text,function(){r.getHelper().exitBirdseyeV2()}),r._keyDownHandler=function(n){r._escHandler(n)},r}return o(i,n),i.prototype.updateHandler=function(n){this._mapRoot||(this._mapRoot=this.getHelper().getMap().getMode().getRootElement());n?this._mapRoot.add_event(this.keydownEventName,this._keyDownHandler):this._mapRoot.remove_event(this.keydownEventName,this._keyDownHandler)},i.prototype._escHandler=function(n){n.keyCode===27&&this.getHelper().exitBirdseyeV2()},i.prototype.dispose=function(){this._mapRoot&&(this._mapRoot.remove_event(this.keydownEventName,this._keyDownHandler),this._mapRoot=null);this._keyDownHandler=undefined;n.prototype.dispose.call(this)},i}(vt);l.registerControl("BirdseyeV2ExitButton",cu);lu=function(t){function i(n){var i=t.call(this,n)||this;return i._updateControlConfigs(),i.setTemplate(new l(i._getSelectorTemplate())),i._navBarControlArgs=n,i._instantiateExitButton(),i._instantiateCopyrightElement(),i}return o(i,t),i.prototype.refreshTemplate=function(){this._updateControlConfigs();this.setTemplate(new l(this._getSelectorTemplate()));this._instantiateExitButton()},i.prototype.getBirdseyeV2ExitButton=function(){return this._birdseyeV2ExitButton},i.prototype.setGeochainManager=function(n){var i=this,t;this._geochainManager=n;this._updateGeochain();t=this.getHelper().getMap();t.mapTypeChanged.add(function(){i._updateGeochain()});t.frameManagerLoaded.addOne(function(){i.disposables.push(t.getFrameManager().frameRendered.add(function(){i._updateGeochain()}))},!1,!0)},i.prototype.dispose=function(){this._birdseyeV2ExitButton&&this._birdseyeV2ExitButton.dispose();t.prototype.dispose.call(this)},i.prototype._updateControlConfigs=function(){var n=this.getHelper();this._isFullControl=n&&n.getIsBirdseyeV2FullControl();this._isNewLayout=n&&n.getIsBirdseyeV2ControlNewLayout()},i.prototype._updateGeochain=function(){var t=this,i=this.getHelper().getMap().getMapType().id;i===n.birdseyeV2&&this._geochainManager.getGeochain(function(n){for(var u,r=[],i=0;i<n.length;i++)r.push(n[i].displayName);u=r.join(", ");t.getRootElement().select(".birdseyeV2Geochain").set_text(u)})},i.prototype._instantiateCopyrightElement=function(){var n=this,t=this.getHelper().getMap();this.disposables.push(t.copyrightControlLoaded.addOne(function(t){n._bindCopyrightUpdatedEvent(t)},!1,!0))},i.prototype._bindCopyrightUpdatedEvent=function(n){var t=this;this.disposables.push(n.copyrightUpdated.add(function(){var i=t.getRootElement().select(".birdseyeV2InfoExitControl.left.top"),r="";n.copyrightString.length>0?(r='<div class="bm_birdseyeV2Attribution">'+n.copyrightString+"<\/div>",i.set_style({display:""})):i.set_style({display:"none"});i.set_html(r)}))},i.prototype._instantiateExitButton=function(){var n,t,i;this._birdseyeV2ExitButton||(this._birdseyeV2ExitButton=new cu(this._navBarControlArgs));n=this._isFullControl?this.getRootElement().select(".birdseyeV2InfoExitControl.right"):this.getRootElement();t=this._birdseyeV2ExitButton.getRootElement();this._isNewLayout?n.append(t):(i=this.getRootElement().select(".be2LabelToggleContainer"),n.insertBefore(t,i))},i.prototype._getSelectorTemplate=function(){var t,i="<BirdseyeV2LabelToggle><\/BirdseyeV2LabelToggle>",u="be2LabelsEnabled",n,f;return this._isFullControl?(n="birdseyeV2InfoExitControl",f=r.isMapsVertical?"birdseyeV2WithTaskBar":"",t=this._isNewLayout?'<div class="'+n+" "+f+" "+u+'">                        <div class="'+n+' top">                            <div class="'+n+' left">                                <div class="'+n+' left top"><\/div>                                <div class="'+n+' left bottom">                                    <div class="birdseyeV2Geochain"><\/div>                                <\/div>                            <\/div>                            <div class="'+n+' right">                            <\/div>                        <\/div>                        <div class="'+n+' label bottom">                            '+i+"                        <\/div>                    <\/div>":'<div class="'+n+" "+u+'">                        <div class="'+n+' left">                            <div class="'+n+' left bottom">                                <div class="birdseyeV2Geochain"><\/div>                            <\/div>                        <\/div>                        <div class="'+n+' right">                            '+i+"                        <\/div>                    <\/div>"):t="<div class='NavBarButton_Container "+u+"'>"+i+"<\/div>",t},i}(rt);au=function(n){function i(i){var r=n.call(this,i)||this,u=ue.replace(/{labelToggleTooltip}/g,t.L_DropDownMenuLabelToggleButtonToolTip_Text);return r.setTemplate(new l(u,{onClick:function(n){return r._onClick(n)}})),r}return o(i,n),i.prototype._onClick=function(n){var i,t,r;ti.ignoreEvent(n);this._isToggleDisabled()||(i=this.getRootElement().select("#be2ToggleInput")[0],t=!i.checked,i.checked=t,this.getHelper().setLabelVisible(t),r=this.getHelper().getMap(),r.getLabelController().setIsLabelsEnabled(t))},i.prototype._isToggleDisabled=function(){return this.getRootElement().has_class("disabled")},i}(rt);l.registerControl("BirdseyeV2LabelToggle",au);fi=function(t){function i(n,i,r,u,f,e){var o=t.call(this,f)||this;return o._classNameFormat="slot {0}",o._mapType=n,o._title=r,e&&(i="NoIcon "+i),o.updateTemplate(i,r,u),o}return o(i,t),i.prototype.updateTemplate=function(n,t,i){var r=this;this.setTemplate(new l('<div class="slot '+n+'" tabindex="0" role="option" aria-selected="false" event:blur="onBlur" event:click="onClick" event:keyup="onKeyUp" event:touchstart="onClick" event:contextmenu="onContextMenu"><div class="mapTypeIcon" /><div class="pie-label labelStyle">'+t+'<\/div><div class="pie-label-description labelStyleDescription">'+i+"<\/div><\/div>",{onClick:function(n){return r._onMapTypeButtonClick(n)},onKeyUp:function(n){return r._onMapTypeButtonKeyUp(n)},onContextMenu:function(n){return n.stopPropagation()},onBlur:function(n){return r._onBlur(n)}}))},i.prototype.onClick=function(){},i.prototype.onKeyUp=function(n){this._onMapTypeButtonClick(n)},i.prototype.setMapType=function(n){this._mapType=n},i.prototype._onMapTypeButtonClick=function(t){var i,f;if(ti.ignoreEvent(t),i=this.getHelper(),f=r.features.birdseyeV2UI,f&&f.isEnabled&&this._mapType==n.birdseye)this.onClick(t);else{if(this._mapType==n.birdseye&&!i.isBirdseyeSupported())return;if(this._mapType!==n.streetside&&!this.getRootElement().has_class("disabled")){i.getMapRoot().select("#NavBar_MapTypeText").set_text(this._title);var u=i.getMapRoot().select("#NavBar_MapTypeIcon"),e=u.get_attr("class"),o=!r.isSDK||i.getNavBarMode()===d.square,s=o?"NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight V8MapStyle":"NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight",h=e.replace(s,"").trim();u.remove_class(h);switch(this._mapType){case n.road:u.add_class("selectorIconRoad");break;case n.aerial:u.add_class("selectorIconAerial");break;case n.birdseye:u.add_class("selectorIconBirdseye");break;case n.ordnanceSurvey:u.add_class("selectorIconOrdnanceSurvey")}}i.invokeMapTypeButtonClicked(this._mapType);this.onClick(t);this._switchMapMode()}},i.prototype._onMapTypeButtonKeyUp=function(n){if(this.getHelper().isKeyUp(n,13))this.onKeyUp(n);else this.getHelper().isKeyUp(n,27)&&this.getHelper().setFocusOnMapLayersButton()},i.prototype._switchMapMode=function(){var i,t,u;this._mapType!==n.streetside&&(i=this.getRootElement(),t=this.getHelper(),t.isEnabled(i)&&(r.isMobile&&t.hideDropDownMenu(),u=t.getMapType(),u!==this._mapType&&(t.setMapType(this._mapType),t.handleLabelsVisibleOnMapTypeChanged())))},i}(rt);ur=function(i){function r(r){return i.call(this,n.aerial,"aerial",t.L_RadialMenuAerialButtonToolTip_Text,t.L_RadialMenuAerialButtonDescription_Text,r)||this}return o(r,i),r.prototype.onClick=function(){this.getHelper().getMap().getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(n.aerial)},r}(fi);l.registerControl("AerialButton",ur);fr=function(i){function u(f){var h=this,o,e,s;return u.birdseyeUIConfig=r.features.birdseyeV2UI,o=!1,e=t.L_RadialMenuBirdseyeButtonDescription_Text,u.birdseyeUIConfig&&u.birdseyeUIConfig.isEnabled&&r.isMapsVertical&&(s='<span class="descriptionHereText"><TextBlock Text=" '+t.RadialMenuBirdseyeV2ButtonAlternateText+' "/><\/span>',e=t.RadialMenuBirdseyeV2ButtonDescriptionText,e=e.replace("{0}",s),o=!0),i.call(this,n.birdseye,"birdseye",t.L_RadialMenuBirdseyeButtonToolTip_Text,e,f,o)||this}return o(u,i),u.prototype.onClick=function(){var t=this.getHelper().getMap();r.isMapsVertical?u.birdseyeUIConfig&&u.birdseyeUIConfig.isEnabled?g.invokeHandler(w.birdsEyeV2DialogDataHandlerKey):t.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(n.birdseye):this.getRootElement().has_class("disabled")||(t.setMapType(t.createMapType(n.birdseyeV2)),this.getHelper().hideDropDownMenu())},u}(fi);l.registerControl("BirdseyeButton",fr);dt=function(i){function r(r,u){var f=this,e=n.road,o=t.L_RadialMenuRoadButtonToolTip_Text,s=t.L_RadialMenuRoadButtonDescription_Text;return f=i.call(this,e,"road",o,s,r)||this,f.defineProperty("type",function(n,t){return f._typeChanged(n,t)},null,{defaultValue:"Road"}),u&&f.setType(u),f}return o(r,i),r.prototype._typeChanged=function(i,r){var u=n.road,f="road",e=t.L_RadialMenuRoadButtonToolTip_Text,o=t.L_RadialMenuRoadButtonDescription_Text;switch(r){case"Grayscale":u=n.grayscale;f="grayscale";e=t.L_RadialMenuGrayscaleButtonToolTip_Text;o=t.L_RadialMenuGrayscaleButtonDescription_Text;break;case"CanvasDark":u=n.canvasDark;f="canvasdark";e=t.L_RadialMenuCanvasDarkButtonToolTip_Text;o=t.L_RadialMenuCanvasDarkButtonDescription_Text;break;case"CanvasLight":u=n.canvasLight;f="canvaslight";e=t.L_RadialMenuCanvasLightButtonToolTip_Text;o=t.L_RadialMenuCanvasLightButtonDescription_Text;break;case"OrdnanceSurvey":u=n.ordnanceSurvey;f="ordnanceSurvey";e=t.L_RadialMenuOrdnanceSurveyButtonToolTip_Text;o=t.L_RadialMenuOrdnanceSurveyButtonDescription_Text;break;case"RoadDark":u=n.roadDark;f="night";e=t.L_RadialMenuRoadDarkButtonToolTip_Text;o=t.L_RadialMenuRoadDarkButtonDescription_Text}this.setMapType(u);this.updateTemplate(f,e,o)},r}(fi);l.registerControl("GeneralMapTypeButton",dt);vu=function(n){function i(i){var r=n.call(this,i)||this,h=t.L_DropDownMenuLabelToggleButtonToolTip_Text,o=r.getHelper().getMap().getMapOptions(),f=o.allowHidingLabelsOfRoad,e=!o.disableBirdseye,u=t.L_DropDownMenuLabelToggleButtonDescription_Text_AerialOnly,s;return f&&e?u=t.L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerialBirdseye:f&&!e?u=t.L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerial:!f&&e&&(u=t.L_DropDownMenuLabelToggleButtonDescription_Text),s=fe.replace("{toggleButtonHoverToolTip}",t.L_RadialMenuLabelToggleToolTip_Text).replace(/{tooltip}/g,h).replace("{description}",u),r.setTemplate(new l(s,{onClick:function(n){return r._onClick(n)},onKeyUp:function(n){return r._onKeyUp(n)},onContextMenu:function(n){return n.stopPropagation()},onBlur:function(n){return r._onBlur(n)}})),r}return o(i,n),i.prototype._onClick=function(n){ti.ignoreEvent(n);this.getHelper().supportLabelToggle()&&this._toggleLabel()},i.prototype._onKeyUp=function(n){this.getHelper().supportLabelToggle()&&(this.getHelper().isKeyUp(n,13)?this._toggleLabel():this.getHelper().isKeyUp(n,27)&&this.getHelper().setFocusOnMapLayersButton())},i.prototype._toggleLabel=function(){var t=this.getRootElement().select("#navbarLabelToggleInput")[0],f=this.getHelper().getMap(),n=!this.getHelper().getLabelVisible(),i;this.getHelper().setLabelVisible(n);t.checked=n;this.getRootElement().set_attr("aria-checked",n+"");t.setAttribute("checked",String(n));f.getLabelController().setIsLabelsEnabled(n);i=u(t.parentElement);n?i.remove_class("unchecked"):i.add_class("unchecked");r.isMobile&&this.getHelper().hideDropDownMenu()},i}(rt);l.registerControl("LabelToggleButton",vu);er=function(i){function u(r){return i.call(this,n.streetside,"streetside",t.L_RadialMenuStreetsideButtonToolTip_Text,t.L_RadialMenuStreetsideButtonDescription_Text,r)||this}return o(u,i),u.prototype.onClick=function(n){this.getHelper().isStreetsideButtonEnabled()?(this._toggleStreetside(n),r.isMobile&&this.getHelper().hideDropDownMenu()):n.stopPropagation()},u.prototype.onKeyUp=function(t){this.getHelper().invokeMapTypeButtonClicked(n.streetside);this.onClick(t)},u.prototype._toggleStreetside=function(n){var r=this,t=this.getRootElement(),i;this.getHelper().isEnabled(t)&&(this._streetSideExitHandler||(this._streetSideExitHandler=this.getHelper().streetSideExitEvent.add(function(){return r._onStreetSideExit()})),this.getHelper().toggleSwitch(t),i=t[0].getAttribute("class"),i.indexOf("selected")===-1?t.set_attr("aria-selected","false"):t.set_attr("aria-selected","true"),this.getHelper().streetsideHandler(n))},u.prototype._onStreetSideExit=function(){var n=this.getRootElement();this.getHelper().isSwitchButtonTurnedOn(n)&&this.getHelper().toggleSwitch(n)},u.prototype.dispose=function(){i.prototype.dispose.call(this);this._streetSideExitHandler&&this._streetSideExitHandler.dispose()},u}(fi);l.registerControl("StreetsideButton",er);or=function(i){function f(n){var t=i.call(this,n)||this;return t._radialMenuControlArgs=n,t.setTemplate(new l(t._getTemplate(),{onMouseEnter:function(){return t._onMouseEnter()},onMouseLeave:function(n){return t._onMouseLeave(n)},onMouseWheel:function(n){return n.stopPropagation()},onContextMenu:function(n){return n.stopPropagation()}})),t.disposables=[],t.rendered.addOne(function(){return t._onRendered()}),t}return o(f,i),f.prototype.getMapTypeButton=function(n){return this._resolveMapTypeButton(n)},f.prototype._onRendered=function(){var t=this,i=this.getHelper().getMap(),f,r,o,s,n;for(this.disposables.push(i.mapTypeChanged.add(function(){t._selectMapTypeButton()})),this.disposables.push(i.getNavigationBar().getAerialBirdsEyeTransitionManager().changed.add(function(){t._selectMapTypeButton()})),f=this.getRootElement().select(".slot"),n=0;n<f.length;n++)u(f[n]).add_event("keydown",this._keyDownHandler);if(r=this.getRootElement().select(".switchSlot"),r&&r.length>0&&u(r[0]).add_event("keydown",this._keyDownHandler),e._isFeatureEnabled("supportedMaps")){for(this._mapTypeButtonMap={},this._mapTypeButtonCollection=new iu,this.disposables.push(i.getMapTypes().changed.add(function(n){return t._mapTypeCollectionChanged(n)})),this.disposables.push(this._mapTypeButtonCollection.changed.add(function(n){return t._mapTypeButtonCollectionChanged(t.getRootElement(),n)})),o=[],s=i.getMapTypes(),n=0;n<s.length;n++)o.push(s[n]);this._mapTypeCollectionChanged({added:o})}else this._selectMapTypeButton()},f.prototype._mapTypeButtonCollectionChanged=function(n,t){var n,i,r;if(t.added)for(n=this.getRootElement(),i=0;i<t.added.length;i++)r=t.added[i],n.insertBefore(r.getRootElement(),n.select(".labelToggle"));else if(t.removed)for(i=0;i<t.removed.length;i++)r=t.removed[i],r.getRootElement().removeFromParent();this._selectMapTypeButton()},f.prototype._mapTypeCollectionChanged=function(n){var i,f,r,t,e,u;if(n.added){for(i=[],t=0;t<n.added.length;t++)f=n.added[t],r=this._resolveMapTypeButton(f),r&&i.push(r);this._mapTypeButtonCollection.insertAll(i)}else if(n.removed)for(t=0;t<n.removed.length;t++)e=n.removed[t],u=this._resolveMapTypeButton(e),u&&this._mapTypeButtonCollection.remove(u)},f.prototype._resolveMapTypeButton=function(t){var i=this._mapTypeButtonMap[t.id],r;if(!i){r=this._radialMenuControlArgs;switch(t.id){case n.road:i=new dt(r,"Road");break;case n.ordnanceSurvey:i=new dt(r,"OrdnanceSurvey");break;case n.grayscale:i=new dt(r,"Grayscale");break;case n.canvasDark:i=new dt(r,"CanvasDark");break;case n.canvasLight:i=new dt(r,"CanvasLight");break;case n.roadDark:i=new dt(r,"RoadDark");break;case n.aerial:i=new ur(r);break;case n.birdseye:case n.birdseyeV2:i=new fr(r);break;case n.streetside:i=new er(r);break;default:t.displayName&&(i=new fi(t.id,t.displayName.toLocaleLowerCase(),t.displayName,"",r))}i&&(this._mapTypeButtonMap[t.id]=i)}return i},f.prototype._selectMapTypeButton=function(){var u=this.getHelper(),e=u.getMap().getMapType().id,t=this.getRootElement(),i=null,f;switch(e){case n.road:case n.highContrast:i=t.select(".slot.road");break;case n.roadDark:i=t.select(".slot.night");break;case n.aerial:i=t.select(".slot.aerial");f=this.getHelper().getMap().getNavigationBar();f&&f.getAerialBirdsEyeTransitionManager().hasRequestedBirdsEye()&&(i=t.select(".slot.birdseye"));break;case n.birdseye:i=t.select(".slot.birdseye");u.setMapTypeButtonDisabled(t.select(".slot.streetside"),!1);break;case n.ordnanceSurvey:i=t.select(".slot.ordnanceSurvey");break;case n.grayscale:i=t.select(".slot.grayscale");break;case n.canvasDark:i=t.select(".slot.canvasDark");break;case n.canvasLight:i=t.select(".slot.canvasLight")}r.isMapsVertical||(u.setMapTypeButtonDisabled(t.select(".slot.birdseye"),!1),u.isDropDownShowing()&&u.checkBirdseyeV2ForDropdown());i&&this._select(i[0])},f.prototype._select=function(n){for(var t,r=this.getRootElement()[0],i=0;i<r.children.length;i++)(t=r.children[i],t.className.indexOf("streetside")>=0)||(t===n?(t.classList.add("selected"),t.setAttribute("aria-selected","true")):(t.classList.remove("selected"),t.setAttribute("aria-selected","false")))},f.prototype._getTemplate=function(){var u=this.getHelper().getMap().getMapOptions(),f=u.disableBirdseye?t.L_NavBarOpenRadialMenuToolTip_NoBirdseye_text:t.L_NavBarOpenRadialMenuToolTip_Text,n='<div id="RadialMenu" class="NavBar_DropDown menu" event:mouseenter="onMouseEnter" event:mouseleave="onMouseLeave" event:mousewheel="onMouseWheel" event:contextmenu="onContextMenu" role="listbox" aria-multiselectable="true" aria-label="'+f+'">',i;return e._isFeatureEnabled("supportedMaps")||(n+='<GeneralMapTypeButton type="Road"/>',r.features.aerial.isEnabled&&(n+="<AerialButton><\/AerialButton>"),u.disableBirdseye!=!0&&r.isSDK&&(n+="<BirdseyeButton><\/BirdseyeButton>"),!u.disableStreetside&&c&&c.isEnabled&&(n+="<StreetsideButton><\/StreetsideButton>"),i=u.supportedMapTypes||[],i.indexOf(Microsoft.Maps.MapTypeId.roadDark)>=0&&(n+='<GeneralMapTypeButton type="RoadDark"/>'),i.indexOf(Microsoft.Maps.MapTypeId.grayscale)>=0&&(n+='<GeneralMapTypeButton type="Grayscale"/>'),i.indexOf(Microsoft.Maps.MapTypeId.canvasDark)>=0&&(n+='<GeneralMapTypeButton type="CanvasDark"/>'),i.indexOf(Microsoft.Maps.MapTypeId.canvasLight)>=0&&(n+='<GeneralMapTypeButton type="CanvasLight"/>'),r.features.ordnanceSurvey.isEnabled&&(u.supportedMapTypes||i.indexOf(Microsoft.Maps.MapTypeId.ordnanceSurvey)>=0)&&(n+='<GeneralMapTypeButton type="OrdnanceSurvey"/>')),n+="<LabelToggleButton><\/LabelToggleButton>",n+"<\/div>"},f.prototype._keyDownHandler=function(n){var t;n.keyCode===40?(t=n.target.nextElementSibling,t&&t.focus()):n.keyCode===38&&(t=n.target.previousElementSibling,t&&t.focus())},f}(rt);l.registerControl("RadialMenu",or);sr=function(i){function f(n,r,f){var e=i.call(this,n)||this;return e.isCompact=typeof r=="undefined"?!1:r,e.tooltip=e.getHelper().getMap().getMapOptions().disableBirdseye?t.L_NavBarOpenRadialMenuToolTip_NoBirdseye_text:t.L_NavBarOpenRadialMenuToolTip_Text,e.setTemplate(new l(e._getSelectorTemplate(),{onTouchStart:function(){return e._onTouchStart()},onClick:function(){e._onTouchStart()},onMouseOut:function(){try{e.getRootElement()[0].blur()}catch(n){}},onMouseEnter:function(){f||e._onMouseEnter()},onMouseLeave:function(n){return e._onMouseLeave(n)},onKeyUp:function(n){return e._onKeyUp(n)},stopEvent:function(n){return n.stopPropagation()}})),e._resizeHandler=function(){e._setText()},u(window).add_event("resize",e._resizeHandler),e.rendered.addOne(function(){return e._onRenderedAfterInit()}),e}return o(f,i),f.prototype.dispose=function(){u(window).remove_event("resize",this._resizeHandler);i.prototype.dispose.call(this)},f.prototype._onRenderedAfterInit=function(){var t=this,n;this.navigationHelper=this.getHelper();this._setText();n=this.navigationHelper.getMap();n.mapTypeChanged.add(function(){return t._setText()});n.getNavigationBar().getAerialBirdsEyeTransitionManager().changed.add(function(){return t._setText()})},f.prototype._setText=function(){var e=this.getRootElement(),c=u("#MapStyleSelector",e[0]),l=u("#NavBar_MapTypeText",e[0]),o=u("#NavBar_MapTypeIcon",e[0]),i="",f="",s;switch(this.navigationHelper.getMapType()){case n.road:case n.mercator:case n.highContrast:i=t.L_RadialMenuRoadButtonToolTip_Text;f="selectorIconRoad";break;case n.roadDark:i=t.L_RadialMenuRoadDarkButtonToolTip_Text;f="selectorIconNight";break;case n.canvasDark:i=t.L_RadialMenuCanvasDarkButtonToolTip_Text;f="selectorIconCanvasDark";break;case n.canvasLight:i=t.L_RadialMenuCanvasLightButtonToolTip_Text;f="selectorIconCanvasLight";break;case n.grayscale:i=t.L_RadialMenuGrayscaleButtonToolTip_Text;f="selectorIconGrayscale";break;case n.aerial:i=t.L_RadialMenuAerialButtonToolTip_Text;f="selectorIconAerial";s=this.navigationHelper.getMap().getNavigationBar();s&&s.getAerialBirdsEyeTransitionManager().hasRequestedBirdsEye()&&(i=t.L_RadialMenuBirdseyeButtonToolTip_Text,f="selectorIconBirdseye");break;case n.birdseye:i=t.L_RadialMenuBirdseyeButtonToolTip_Text;f="selectorIconBirdseye";break;case n.ordnanceSurvey:i=t.L_RadialMenuOrdnanceSurveyButtonToolTip_Text;f="selectorIconOrdnanceSurvey"}var a=o.get_attr("class"),h=a.replace("NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight","").trim(),v=!r.isSDK||this.navigationHelper.getNavBarMode()===d.square;v&&(h=h.replace("V8MapStyle","").trim());o.remove_class(h);o.add_class(f);c.set_attr("title",t.L_CurrentMapTypeToolTip_Text.replace("{mapStyle}",i)+" - "+this.tooltip);l.set_text(i)},f.prototype._onTouchStart=function(){this.navigationHelper.toggleDropDownMenu()},f.prototype._onKeyUp=function(n){(this.navigationHelper.isKeyUp(n,13)||this.navigationHelper.isKeyUp(n,40))&&(this.navigationHelper.showDropDownMenu(),this.navigationHelper.setFocusOnRadialMenu())},f.prototype._getSelectorTemplate=function(){var n=!r.isSDK||this.getHelper().getNavBarMode()===d.square,i="NavBar_MapTypeButtonContainerWrapper"+(n?" V8MapStyle":""),u=n?'<div class="NavBar_MapTypeButtonContainer NavBar_MapTypeButtonHeight NavBar_Delay withBackground V8MapStyle" id="MapStyleSelector" tabindex="0" title="'+this.tooltip+'" role="link" aria-expanded="false" event:click="onClick" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="onMouseOut" event:mouseleave="onMouseLeave" event:touchstart="onTouchStart" event:mouseenter="onMouseEnter" event:keyup="onKeyUp" event:contextmenu="stopEvent">':'<div class="NavBar_MapTypeButtonContainer NavBar_MapTypeButtonHeight NavBar_Delay'+(r.isMapsVertical?"":" withBackground")+'" id="MapStyleSelector" tabindex="0" title="'+this.tooltip+'" role="button" aria-expanded="false" event:click="onClick" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="onMouseOut" event:mouseleave="onMouseLeave" event:touchstart="onTouchStart" event:mouseenter="onMouseEnter" event:keyup="onKeyUp" event:contextmenu="stopEvent">',f='<div class="'+i+'">'+u,e=n?"":'<div class="NavBar_MapTypeButtonDropDownIcon NavBar_MapTypeButtonHeight selectorIconDropDown"><\/div>',o=n?'<div id="NavBar_MapTypeText" class="NavBar_MapTypeButtonText NavBar_MapTypeButtonHeight V8MapStyle"><\/div>':'<div id="NavBar_MapTypeText" class="NavBar_MapTypeButtonText NavBar_MapTypeButtonHeight"><\/div>',s=n?'<div id="NavBar_MapTypeIcon" class="NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight V8MapStyle"><\/div>':'<div id="NavBar_MapTypeIcon" class="NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight"><\/div>',t=f+s+o;return r.isMapsVertical||(t+=e),t+"<\/div><\/div>"},f}(rt);l.registerControl("SelectorControl",sr);yu=function(){function n(n,t,i){this.displayName=n;this.entityId=t;this.index=i}return n}();hr=function(i){function f(n,r){var u=i.call(this)||this;return u._geochainCollapseClass="geochainCollapse",u._geochainUncollapseClass="geochainUncollapse",u._geochainContainerCollapseClass="collapsed",u._storedCollapsedState=!0,u._map=n,u._geochainManager=r,u.resources=t,u._storedCollapsedState=it.getItem("geoChainCollapsed")==="1"?!0:!1,u._autoresizeEnabled=it.getItem("geoChainAutoresizeEnabled")==="0"?!1:!0,u.defineProperty("geochainSegments"),u.defineProperty("isLastLocationVisible",null,null,{defaultValue:!1}),u.defineProperty("isCollapsed",null,null,{defaultValue:u._storedCollapsedState}),u.defineProperty("isVisible",null,null,{defaultValue:!0}),fu&&u.setTemplate(new l(fu,{stopEvent:function(n){return n.stopPropagation()},onSegmentClick:function(n){return u._onSegmentClick(n)},onFocus:function(){return u._onFocus()},onLastLocationClick:function(n){return u._onLastLocationClick(n)},onCollapseClick:function(n){return u._onCollapseClick(n)},boolToDisplay:function(n){return u.boolToDisplay(n)},boolToCollpased:function(n){return u.boolToDisplay(!n)},boolToVisibility:function(n){return u.boolToVisibility(n)},boolToContainerCollapsedClass:function(n){return u.boolToContainerCollapsedClass(n)},boolToCollapsedClass:function(n){return u.boolToCollapsedClass(n)},boolToExpandedString:function(n){return u.boolToExpandedString(n)}})),u.rendered.addOne(function(){return u._onRenderedAfterInit()}),u}return o(f,i),f.prototype.boolToCollapsedClass=function(n){var t=typeof n=="boolean"?n:this._storedCollapsedState;return"geochainActionButton "+(t?this._geochainUncollapseClass:this._geochainCollapseClass)},f.prototype.boolToContainerCollapsedClass=function(n){var t=typeof n=="boolean"?n:this._storedCollapsedState;return"geochainContainer "+(t?this._geochainContainerCollapseClass:"")},f.prototype.boolToExpandedString=function(n){return n?"false":"true"},f.prototype.setNavigationHelper=function(n){this._navigationHelper=n},f.prototype._onRenderedAfterInit=function(){var t=this,i=function(){t.getIsVisible()&&t.getRootElement().get_style("display")!=="none"&&!t.getIsCollapsed()&&t._geochainManager.getGeochain(function(n){t.setGeochainSegments(n)})};this._map.frameManagerLoaded.addOne(function(n){n.frameRendered.add(i);n.frameRendered.isPreviouslyInvoked&&i()},!1,!0);this._setDarkClass(this._map.getMapType().id);this._map.mapTypeChanged.add(function(i){var r=i.newMapTypeId!==n.streetside&&i.newMapTypeId!==n.birdseyeV2;t.setIsVisible(r);t._setDarkClass(i.newMapTypeId)});this._map.actualSizeChanged.add(function(){return t._setAutoCollapsed()});this._setAutoCollapsed()},f.prototype._setDarkClass=function(t){r.isMapsVertical||t!==n.aerial&&t!==n.birdseye&&t!==n.roadDark&&t!==n.birdseyeV2?this.getRootElement().remove_class("dark"):this.getRootElement().add_class("dark")},f.prototype._onSegmentClick=function(n){n.preventDefault();var t=parseInt(n.currentTarget.getAttribute("data-index")),i=this.getGeochainSegments(),r=i[t]},f.prototype._onFocus=function(){this._navigationHelper.checkHideDropDownMenu(this.getRootElement()[0])},f.prototype._onLastLocationClick=function(n){n.preventDefault()},f.prototype._onCollapseClick=function(n){var i=this,t,r;n.stopPropagation();ti.ignoreEvent(n);t=this.getIsCollapsed();t?(this._geochainManager.getGeochain(function(n){i.setGeochainSegments(n);it.setItem("geoChainCollapsed","0")}),this._isAutoCollapsed&&(this._autoresizeEnabled=!1,it.setItem("geoChainAutoresizeEnabled","0"))):(it.setItem("geoChainCollapsed","1"),this._previouslyCollapsed=!0,this._autoresizeEnabled=!0,it.setItem("geoChainAutoresizeEnabled","1"));r=u(n.target);this.setIsCollapsed(!t)},f.prototype._setAutoCollapsed=function(){if(this._autoresizeEnabled){var n=this._map.getActualSize();n.width<ft.geochainAutosizeMaxWidth?this._isAutoCollapsed||(this._previouslyCollapsed=this.getIsCollapsed(),this.setIsCollapsed(!0),this._isAutoCollapsed=!0):this._isAutoCollapsed&&(this.getIsCollapsed()&&this._previouslyCollapsed==!1&&this.setIsCollapsed(!1),this._isAutoCollapsed=!1)}},f}(rt);l.registerControl("Geochain",hr);pu=function(n){function i(i){var r=n.call(this,i)||this;return n.prototype.init.call(r,"LocateMeButton","NavBar_locateMe",t.L_NavBarLocateMeToolTip_Text,function(){r.getHelper().locateMe()}),r}return o(i,n),i.prototype.setVisible=function(i){n.prototype.setVisible.call(this,i);var r=this.getRootElement(),u="aria-label";i?r.set_attr(u,t.L_NavBarLocateMeToolTip_Text):r.remove_attr(u)},i}(vt);cr=function(n){function t(t){var i=n.call(this,t)||this;return i.setTemplate("<div class='bm_LocateMeControl'><\/div>"),i.rendered.addOne(function(){(i._locateMeButton=new pu(t)).appendTo(i.getRootElement());!r.isMobile&&e._isSmallMapShownOnSerp()&&i.setVisible(!1)}),i}return o(t,n),t.prototype.getGeochainControl=function(){return this._geochain},t.prototype.setGeochainControl=function(n){this._geochain&&this._geochain.getRootElement().removeFromParent();this._geochain=n;var i=this.getRootElement();i.insertBefore(this._geochain.getRootElement(),this._locateMeButton.getRootElement());i.add_class(t.withGeochainClass);this._geochain.setNavigationHelper(this.getHelper())},t.prototype.setVisible=function(t){n.prototype.setVisible.call(this,t);this.setLocateMeButtonVisibility(t)},t.prototype.setGeochainVisibility=function(n){if(this._geochain){this._geochain.getRootElement().set_style({display:this.boolToDisplay(n)});var i=this.getRootElement();n?i.add_class(t.withGeochainClass):i.remove_class(t.withGeochainClass)}},t.prototype.setLocateMeButtonVisibility=function(n){this._locateMeButton&&this._locateMeButton.setVisible(n)},t.prototype.dispose=function(){this._locateMeButton&&this._locateMeButton.dispose();this._geochain&&this._geochain.dispose();n.prototype.dispose.call(this);e._nullifyClass(this)},t.withGeochainClass="withGeochain",t}(rt);l.registerControl("LocateMeControl",cr);wu=function(){function n(n){this._map=n}return n.prototype.show=function(n){var e=this,f,i;!this._isVisible&&r.isMapsVertical&&(this._root||(this._root=this._createRootElement()),f=this._setMessage(n),this._addToDom(),this._root.style.marginLeft=(this._map.getActualSize().width-this._root.offsetWidth)/2+"px",this._map.viewChanged.addOne(function(){return e.hide()}),this._isVisible=!0,i=this._root.getElementsByTagName("a")[0],i&&(u(i).set_attr("aria-label",f+t.L_LocateMe_ChangeSettings_Text),i.focus()))},n.prototype.hide=function(){this._isVisible&&(this._removeFromDom(),this._isVisible=!1)},n.prototype._addToDom=function(){var t=this._map.getRootElement(),n=t.get_style("position");a.assert(n==="absolute"||n==="relative","expected mapDiv position to be absolute or relative. found "+n);t.append(this._root)},n.prototype._removeFromDom=function(){this._root&&this._root.parentNode&&this._root.parentNode.removeChild(this._root)},n.prototype._createRootElement=function(){var r=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),n=this._map.getConfig(),u=n.bingSettingsUrl.replace("{origin}",r).replace("{returnUrl}",encodeURIComponent(window.location.href)).replace("{formCode}",n.locateMeFormCode),i=document.createElement("div");return i.innerHTML="<div class='bm_LocateMeErrorDialog'><div data-role='message'><\/div><div><a href='"+u+"'>"+t.L_LocateMe_ChangeSettings_Text+"<\/a><\/div><\/div>",i.firstChild},n.prototype._setMessage=function(n){var i=n?t.L_LocateMe_Error_Text_Approximate_Location:t.L_LocateMe_Error_Text_Setting;return u("[data-role=message]",this._root).set_html(i),i},n}();lr=function(i){function r(u){var f=i.call(this,u)||this,e=f.getHelper().getMapType();return f._secondMapType=e!==n.road&&r._mapTypeToToolTip[e]?e:n.aerial,f._roadText=t.L_NavBarMapTypeSwitcherToolTip_Text.replace("{0}",r._mapTypeToToolTip[f._secondMapType]),f._secondMapTypeText=t.L_NavBarMapTypeSwitcherToolTip_Text.replace("{0}","road"),f._previousClass="road",i.prototype.init.call(f,"MapTypeSwitcherButton","NavBar_mapTypeSwitcher",t.L_NavBarMapTypeSwitcherRoadToolTip_Text,function(){var t=f.getHelper().getMapType(),i=t===n.road||t===n.highContrast?f._secondMapType:n.road;f.getHelper().setMapType(i)}),f.rendered.addOne(function(){var n=f.getHelper().getMap(),t=n.getMapType().id;n.mapTypeChanged.add(function(n){return f._mapTypeChanged(n)});f._mapTypeChanged({oldMapTypeId:t,newMapTypeId:t})}),f}return o(r,i),r.prototype._mapTypeChanged=function(t){var u=t.newMapTypeId===n.road||t.newMapTypeId===n.highContrast?r._mapTypeToClass[this._secondMapType]:r._mapTypeToClass[n.road],i,f;this.getRootElement().remove_class(this._previousClass).add_class(u);this._previousClass=u;i=t.newMapTypeId==n.road?this._roadText:this._secondMapTypeText;this.setTitle(i);f=this.getRootElement();f.set_attr("aria-label",i)},r._mapTypeToToolTip={os:"ordnance survey",a:"aerial"},r._mapTypeToClass={os:"ordnanceSurvey",a:"aerial",r:"road"},r}(vt);l.registerControl("MapTypeSwitcherButton",lr);var ao=function(){function n(n){this._map=n;this._location=new h(0,0);this.invalidated=new tt;this._selector=new lf(n)}return n.prototype.setVisible=function(n){n!=this._isVisible&&(this._isVisible=n,n?(this._layer||(this._layer=new bt("MePoi",this,this._selector,8690),this._layer.setRenderTarget(1)),this._map.getLayers().insert(this._layer)):this._layer&&this._map.getLayers().remove(this._layer))},n.prototype.setLocation=function(n){this._location.latitude=n.latitude;this._location.longitude=n.longitude;this._primitive=new rr(n,{id:"MePoi",collisionBehavior:2,poiType:11});this._primitive.bucket="354";this.invalidated.invoke()},n.prototype.getPrimitives=function(n,t){this._primitive?(this._primitive.layer=this._layer,t({primitives:[this._primitive]})):t({primitives:[]})},n}(),vo=function(n){function t(t){var i=this;if(t){var r=t.getRootElement(),u=new p(0,0);i=n.call(this,r,1,u)||this}return i}return o(t,n),t}(hi),bu=function(i){function f(n,u,f){var e=this,o=new ti(n),h={helper:o,showTrafficOnRendered:!1},s;if(e=i.call(this,h)||this,e._map=n,e._navBarControlArgs=h,o.setNavigationBar(e),e.resources=t,e._transitionManager=f,e.navBarButtons=[],e.mapTypeButtonClicked=new tt,!e._map.getMapOptions().serpMultiMapsAccessible)return e._mapTypeSelectorEnabled=!0,e._enableSquareStyle=(r.isMapsAnswer||r.isMsftPartner)&&!r.isMapsVertical||r.isSDK&&e._map.getMapOptions().navigationBarMode===d.square,e._updateTemplate(),e.disposables.push(e._transitionManager,o,n.mapTypeChanged.add(function(t){e._handleMapType(t.newMapTypeId);e._handleZoomChanged(n)}),n.viewChanged.add(function(){n.isPanning()||e._handleViewChange(n)}),n.mapZoomChanged.add(function(){e._handleZoomChanged(n)}),n.actualSizeChanged.add(function(){e._handleMapSizeChanged(n)})),s=e._map.getMapOptions(),e._currentNavBarMode=-1,e._currentOrientation=-1,e.rendered.addOne(function(){e.setNavigationBarOrientation(s.navigationBarOrientation);e.setNavigationBarMode(s.navigationBarMode);e._handleMapType(n.getMapType().id);e._handleViewChange(n);e._handleZoomChanged(n);e.getHelper().enableBirdseyeButton();u&&!u.enableMapStyleSelector&&(e._mapTypeSelectorEnabled=!1,e.setMapStyleSelectorControlVisible(!1))}),e}return o(f,i),f.prototype.getAerialBirdsEyeTransitionManager=function(){return this._transitionManager},f.prototype.getTrafficButton=function(){return this._trafficButton},f.prototype.getLocateMeControl=function(){return this._locateMeControl},f.prototype.getBirdseyeV2InfoExitControl=function(){return this._birdseyeV2InfoExitControl},f.prototype.getNavigationButtonAtIndex=function(n){return n<0||n>=this.navBarButtons.length?null:this.navBarButtons[n]},f.prototype.getNavigationBarOrientation=function(){return this._currentOrientation},f.prototype.getNavigationBarMode=function(){return this._currentNavBarMode},f.prototype.isSquareStyle=function(){return this._enableSquareStyle},f.prototype.getZoomControl=function(){return this._zoomControl},f.prototype.setLocateMeButtonVisible=function(n){this._locateMeControl&&this._locateMeControl.setLocateMeButtonVisibility(n)},f.prototype.setRotateButtonVisible=function(n){this._rotateControl&&this._setControlDisplay(this._rotateControl,n)},f.prototype.setBirdseyeV2InfoExitControlVisible=function(n){if(this._birdseyeV2InfoExitControl){this._setControlDisplay(this._birdseyeV2InfoExitControl,n);var t=this._map.getLabelController();t&&this.getHelper().updateLabelToggleForBirdseyeV2(t.getIsLabelsEnabled(),!0)}},f.prototype.setZoomInButtonVisible=function(n){this._zoomInButton&&this._setControlDisplay(this._zoomInButton,n)},f.prototype.setZoomOutButtonVisible=function(n){this._zoomOutButton&&this._setControlDisplay(this._zoomOutButton,n)},f.prototype.setMapStyleSelectorControlVisible=function(n){n=this._mapTypeSelectorEnabled&&n;this._mapTypeSwitcherButton&&this._setControlDisplay(this._mapTypeSwitcherButton,n);this._selectorControl&&this._setControlDisplay(this._selectorControl,n)},f.prototype.setRadialMenuControlVisible=function(n){this._radialMenu&&this._setControlDisplay(this._radialMenu,n)},f.prototype.setDefaultCompassClass=function(n){var t,i;this._rotateControl&&(n=this.normalizeHeading(n),t="NavBar_heading_"+n+"D",t!==this._lastHeadingClass&&(i=u(this._rotateControl.getRotateResetButton().getRootElement()),this._lastHeadingClass!==undefined&&i.remove_class(this._lastHeadingClass),i.add_class(t),this._lastHeading=n,this._lastHeadingClass=t))},f.prototype.setNavigationBarOrientation=function(n){this._enableSquareStyle?(this.getRootElement().remove_class("horizontal"),this._currentOrientation=et.vertical):this._currentOrientation!=n&&(n==et.horizontal?this.getRootElement().add_class("horizontal"):this.getRootElement().remove_class("horizontal"),this._currentOrientation=n)},f.prototype.setNavigationBarMode=function(n){if(this._enableSquareStyle=(r.isMapsAnswer||r.isMsftPartner)&&!r.isMapsVertical||r.isSDK&&this._map.getMapOptions().navigationBarMode===d.square,this._currentNavBarMode!=n){this._currentNavBarMode=n;this._resetNavigationBar();this.getRootElement().remove_class("tiny");this.getRootElement().remove_class("minified");this.getRootElement().remove_class("compact");switch(n){case d.minified:this._setMinifiedMode();break;case d.compact:this._setCompactMode();break;default:this._setDefaultMode()}}},f.prototype.setExternalControl=function(n){this._externalControl&&this._externalControl.getRootElement().removeFromParent();this._externalControl=n;this._appendExternalControl()},f.prototype.rotateCompass=function(n){var i,t;n=this.normalizeHeading(n);i=u(this._rotateControl.getRotateResetButton().getRootElement());this._lastHeading===undefined&&(this._lastHeading=0);t="NavBar_heading_";t+=n==0?this._lastHeading==90?"0":"360":n==270?this._lastHeading==0?"90C":"270":n;this._lastHeadingClass!==undefined&&i.remove_class(this._lastHeadingClass);i.add_class(t);this._lastHeadingClass=t;this._lastHeading=n},f.prototype.isZoomInButtonEnabled=function(){return this._zoomInButton&&this._isControlEnabled(this._zoomInButton)},f.prototype.isZoomOutButtonEnabled=function(){return this._zoomInButton&&this._isControlEnabled(this._zoomOutButton)},f.prototype.isRotateLeftEnabled=function(){return this._rotateControl&&this._isControlEnabled(this._rotateControl.getRotateLeftButton())},f.prototype.isRotateRightEnabled=function(){return this._rotateControl&&this._isControlEnabled(this._rotateControl.getRotateRightButton())},f.prototype.enableRotateLeftButton=function(n){if(this._rotateControl){var t=this._rotateControl.getRotateLeftButton().getRootElement();n?t.remove_class(f.disabledClass):t.add_class(f.disabledClass)}},f.prototype.enableRotateRightButton=function(n){if(this._rotateControl){var t=this._rotateControl.getRotateRightButton().getRootElement();n?t.remove_class(f.disabledClass):t.add_class(f.disabledClass)}},f.prototype.addNavigationButton=function(n){n.getHelper()||n.setHelper(this.getHelper());this.navBarButtons.push(n);this.getRootElement().append(n.getRootElement())},f.prototype.insertNavigationButton=function(n,t){if(n<0||n>=this.navBarButtons.length)return!1;t.getHelper()||t.setHelper(this.getHelper());var i=this.navBarButtons[n];return this.navBarButtons.splice(n,0,t),this.getRootElement().insertBefore(t.getRootElement(),i.getRootElement()),!0},f.prototype.removeNavigationButton=function(n){var t=this.navBarButtons.indexOf(n);return t>=0?(this.navBarButtons.splice(t,1),n.getRootElement().removeFromParent(),!0):!1},f.prototype.removeNavigationButtonAt=function(n){if(n<0||n>=this.navBarButtons.length)return null;var t=this.navBarButtons[n];return this.navBarButtons.splice(n,1),t.getRootElement().removeFromParent(),t},f.prototype.dispose=function(){this._resetNavigationBar();this._selectorControl&&this._selectorControl.dispose();this._locateMeControl&&this._locateMeControl.dispose();this._rotateControl&&this._rotateControl.dispose();this._radialMenu&&this._radialMenu.dispose();this._zoomInButton&&this._zoomInButton.dispose();this._zoomOutButton&&this._zoomOutButton.dispose();this._trafficButton&&this._trafficButton.dispose();this._mapTypeSwitcherButton&&this._mapTypeSwitcherButton.dispose();this._birdseyeV2InfoExitControl&&this._birdseyeV2InfoExitControl.dispose();i.prototype.dispose.call(this);e._nullifyClass(this)},f.prototype._setDarkTheme=function(){this.getRootElement().remove_class("Light").add_class("Dark")},f.prototype._setLightTheme=function(){this.getRootElement().remove_class("Dark").add_class("Light")},f.prototype.normalizeHeading=function(n){return n>0&&(n=n%360),n<0&&(n=360-Math.abs(n)%360,n==360&&(n=0)),n},f.prototype._updateTemplate=function(){var t="NavBar_Container",i=t+" V8MapStyle",n=t;r.isMapsVertical?n=i:this._enableSquareStyle&&(n=i+" lm_button",r.isSDK&&(n+=" sdk"));this.setTemplate(new l(ee.replace(t,n)))},f.prototype._handleMapType=function(t){var i=this._map.getMapOptions(),h=typeof i.showDashboard=="boolean"&&!i.showDashboard?!1:!0,u=!1,f=!0,o=!0,c=!1,s=!r.isMapsVertical&&((r.isMapsAnswer||r.isMsftPartner)&&!e._isFeatureEnabled("newNavStyleSerp")||!r.isMapsAnswer&&!r.isMsftPartner&&i.navigationBarMode!==d.square);switch(t){case n.birdseye:u=!0;f=!1;o=!1;s&&this._setDarkTheme();break;case n.birdseyeV2:h=!1;u=!0;f=!1;o=!1;c=!0;s&&this._setDarkTheme();break;case n.aerial:case n.canvasDark:case n.roadDark:s&&this._setDarkTheme();break;default:this._setLightTheme()}this.setLocateMeButtonVisible(h);this.setRotateButtonVisible(u);this.setBirdseyeV2InfoExitControlVisible(c);this.getHelper().enableStreetsideButton(f);o&&this.getHelper().resetMapHeading()},f.prototype._handleViewChange=function(n){var t=n.getView().heading;this.setDefaultCompassClass(t);this.enableRotateLeftButton(!0);this.enableRotateRightButton(!0);this._handleZoomChanged(n)},f.prototype._handleZoomChanged=function(n){var t,i;this._zoomInButton&&(t=n.canZoom(1),this._enableZoomControl(this._zoomInButton,t));this._zoomOutButton&&(i=n.canZoom(-1),this._enableZoomControl(this._zoomOutButton,i))},f.prototype._handleMapSizeChanged=function(n){this._handleZoomChanged(n);this._sizeExternalControl()},f.prototype._sizeExternalControl=function(){if(this._externalControl&&this._externalControl.setMaxHeight){var n=this._externalControl.getRootElement().get_absolute_pos(),t=this._map.getRootElement().select(".bm_bottomRightOverlay").get_absolute_pos();this._externalControl.setMaxHeight(t.y-n.y)}},f.prototype._isControlEnabled=function(n){return!n.getRootElement().has_class(f.disabledClass)},f.prototype._enableZoomControl=function(n,i){var r=n.getRootElement(),e=this._map.getMercatorZoomLevel(),o=n===this._zoomInButton,u=(o?t.L_ZoomInButtonAriaLabel:t.L_ZoomOutButtonAriaLabel).replace("{0}",e);i?(this._isControlEnabled(n)||(r.remove_class(f.disabledClass),r.set_attr("tabindex","")),r.set_attr("aria-label",u)):(this._isControlEnabled(n)&&(r.add_class(f.disabledClass),r.set_attr("tabindex","-1")),r.set_attr("aria-label",u+r.get_attr("title")+" "+t.L_ZoomButtonAriaLabelDisabled))},f.prototype._setMinifiedMode=function(){var n;this._enableSquareStyle?(this._appendMapTypeSelector(!1),this._appendLocateMeControl(),this._appendZoomButtons(),this.setNavigationBarOrientation(et.vertical),this.getRootElement().add_class("minified"),n=this._map.getActualSize(),n.height<158?this.getRootElement().add_class("limitHeight"):this.getRootElement().remove_class("limitHeight")):(this.getNavigationBarOrientation()===et.horizontal?(this._appendTrafficButton(),this._appendMapTypeSelector(!1),this._appendZoomButtons(),this._appendBirdseyeV2InfoExitControl(),this._appendLocateMeControl()):(this._appendLocateMeControl(),this._appendZoomButtons(),this._appendMapTypeSelector(!1),this._appendTrafficButton()),n=this._map.getActualSize(),this.getRootElement().remove_class("SquareNavControl"),this.getRootElement().add_class(n.width*n.height>15e4?"minified":"tiny"))},f.prototype._setCompactMode=function(){this.getNavigationBarOrientation()===et.horizontal?(this._appendLocateMeControl(),this._appendRotateControl(),this._appendZoomButtons(),this._appendBirdseyeV2InfoExitControl(),this._appendMapTypeSelector(!0)):(this._appendMapTypeSelector(!0),this._appendBirdseyeV2InfoExitControl(),this._appendZoomButtons(),this._appendRotateControl(),this._appendLocateMeControl());this._appendExternalControl();this.getRootElement().add_class("compact")},f.prototype._setDefaultMode=function(){if(r.isMapsVertical&&(this.getRootElement().add_class("SquareNavControl"),this._setLightTheme()),this.getRootElement().remove_class("limitHeight"),this.getNavigationBarOrientation()===et.horizontal)this._appendRotateControl(),this._appendZoomButtons(),this._appendLocateMeControl(),this._appendBirdseyeV2InfoExitControl(),this._appendMapTypeSelector(!0);else{this._appendMapTypeSelector(!0);this._appendBirdseyeV2InfoExitControl();this._appendLocateMeControl();var n=!r.isMapsVertical||e._isFeatureEnabled("birdseyeV2UI");n?(this._appendRotateControl(),this._appendZoomButtons()):(this._appendZoomButtons(),this._appendRotateControl())}this._appendExternalControl()},f.prototype._resetNavigationBar=function(){for(this._selectorControl&&this._selectorControl.getRootElement().removeFromParent(),this._locateMeControl&&this._locateMeControl.getRootElement().removeFromParent(),this._rotateControl&&this._rotateControl.getRootElement().removeFromParent(),this._radialMenu&&this._radialMenu.getRootElement().removeFromParent(),this._zoomControl&&this._zoomControl.getRootElement().removeFromParent(),this._externalControl&&this._externalControl.getRootElement().removeFromParent();this.navBarButtons.length>0;)this.removeNavigationButtonAt(0)},f.prototype._appendZoomButtons=function(){var n=this._map.getMapOptions(),f=n.disableZooming||typeof n.showDashboard=="boolean"&&!n.showDashboard||typeof n.showZoomButtons=="boolean"&&!n.showZoomButtons,t,i,u;if(this._enableSquareStyle||r.isMapsVertical&&this._currentNavBarMode===d["default"]){this._zoomControl?(t=this._zoomControl.getRootElement(),this._zoomControl.zoomInButton.appendTo(t),this._zoomControl.zoomOutButton.appendTo(t)):this._zoomControl=new vr(this._navBarControlArgs);f||this._appendControl(this._zoomControl);this._zoomInButton=this._zoomControl.zoomInButton;this._zoomOutButton=this._zoomControl.zoomOutButton;return}this._zoomInButton||(this._zoomInButton=new wi(this._navBarControlArgs));this._zoomOutButton||(this._zoomOutButton=new bi(this._navBarControlArgs));i=this._zoomInButton;u=this._zoomOutButton;this.getNavigationBarOrientation()===et.horizontal&&(i=this._zoomOutButton,u=this._zoomInButton);this.addNavigationButton(i);this.addNavigationButton(u);f&&(this.setZoomOutButtonVisible(!1),this.setZoomInButtonVisible(!1))},f.prototype._appendExternalControl=function(){this._externalControl&&(this.getRootElement().append(this._externalControl.getRootElement()),this._sizeExternalControl())},f.prototype._appendLocateMeControl=function(){var t=this,n=this._map.getMapOptions();n.showLocateMeButton&&(this._locateMeControl||(this._locateMeControl=new cr(this._navBarControlArgs),n.showBreadcrumb===!1||r.disableReverseGeocode||this._map.getContainer().instanceAsync("GeochainControl",function(n){t._locateMeControl.setGeochainControl(n)})),this._appendControl(this._locateMeControl),(r.isMobile||!e._isSmallMapShownOnSerp())&&(typeof n.showDashboard!="boolean"||n.showDashboard)?this._locateMeControl.setVisible(!0):this._locateMeControl.setVisible(!1))},f.prototype._appendBirdseyeV2InfoExitControl=function(){var n=this;this._birdseyeV2InfoExitControl?this._birdseyeV2InfoExitControl.refreshTemplate():(this._birdseyeV2InfoExitControl=new lu(this._navBarControlArgs),this._map.getContainer().instanceAsync("GeochainManager",function(t){n._birdseyeV2InfoExitControl&&n._birdseyeV2InfoExitControl.setGeochainManager(t)}));this._appendControl(this._birdseyeV2InfoExitControl)},f.prototype._appendMapTypeSelector=function(n){n?(this._selectorControl||(this._selectorControl=new sr(this._navBarControlArgs,this._currentNavBarMode===d.compact,this._map.getMapOptions().disableMapTypeSelectorMouseOver),this.disposables.push(this._selectorControl)),this._radialMenu||(this._radialMenu=new or(this._navBarControlArgs)),this._appendControl(this._selectorControl),this._appendControl(this._radialMenu)):(this._mapTypeSwitcherButton||(this._mapTypeSwitcherButton=new lr(this._navBarControlArgs)),this.addNavigationButton(this._mapTypeSwitcherButton));var t=this._map.getMapOptions(),i=t.showMapTypeSelector,r=t.showDashboard;(typeof i=="boolean"&&i===!1||typeof r=="boolean"&&r===!1)&&this.setMapStyleSelectorControlVisible(!1)},f.prototype._appendTrafficButton=function(){var n=this._map.getMapOptions();n.showDashboard!=!1&&n.showTrafficButton&&(this._trafficButton||(this._trafficButton=this._createTrafficButton()),this.addNavigationButton(this._trafficButton))},f.prototype._appendRotateControl=function(){this._map.getMapOptions().disableBirdseye&&r.isMapsVertical||(this._rotateControl||(this._rotateControl=new ku(this._navBarControlArgs)),this._appendControl(this._rotateControl))},f.prototype._createTrafficButton=function(){var t=this,n=new ar(this._navBarControlArgs);return this._map.getContainer().instanceAsync("TrafficLayerV2",function(i){n.setTrafficLayer(i);t.disposables.push(i)}),n},f.prototype._appendControl=function(n){n&&this.getRootElement().append(n.getRootElement())},f.prototype._setControlDisplay=function(n,t){n.getRootElement().set_style({display:this.boolToDisplay(t)})},f.disabledClass="disabled",f}(rt);l.registerControl("NavigationBar",bu);var yo=function(n){function i(i){var r=n.call(this,i)||this;return n.prototype.init.call(r,"RotateLeftButton","NavBar_rotateLeft",t.L_NavBarRotateCCToolTip_Text,function(){return r.getHelper().rotateLeft()}),r}return o(i,n),i}(vt),po=function(n){function i(i){var r=n.call(this,i)||this;return n.prototype.init.call(r,"RotateRightButton","NavBar_rotateRight",t.L_NavBarRotateCToolTip_Text,function(){return r.getHelper().rotateRight()}),r}return o(i,n),i}(vt),wo=function(n){function i(i){var r=n.call(this,i)||this;return n.prototype.init.call(r,"RotateButton","NavBar_rotate NavBar_heading_0D",t.L_NavBarRotateToolTip_Text,function(){return r.getHelper().resetMapHeading(!0)}),r}return o(i,n),i}(vt),ku=function(n){function t(t){var i=n.call(this,t)||this;return i.setTemplate(new l('<div id="RotateButtonContainer" class="NavBarButton_Container"><\/div>')),i.rendered.addOne(function(){(i._rotateLeftButton=new yo(t)).appendTo(i.getRootElement());(i._rotateResetButton=new wo(t)).appendTo(i.getRootElement());(i._rotateRightButton=new po(t)).appendTo(i.getRootElement())}),(!r.isMapsVertical||e._isFeatureEnabled("birdseyeV2UI"))&&(i._updateTopMargin(),i._resizeHandler=function(){i._updateTopMargin()},u(window).add_event("resize",i._resizeHandler)),i}return o(t,n),t.prototype.getRotateLeftButton=function(){return this._rotateLeftButton},t.prototype.getRotateResetButton=function(){return this._rotateResetButton},t.prototype.getRotateRightButton=function(){return this._rotateRightButton},t.prototype._updateTopMargin=function(){var n=this.getHelper(),t=n&&n.getMap(),i;t&&n.getIsBirdseyeV2FullControl()&&(i=(t.getActualSize().height-120)/2-(n.getIsBirdseyeV2ControlNewLayout()?0:60),this.getRootElement().set_style({marginTop:i+"px"}))},t.prototype.dispose=function(){u(window).remove_event("resize",this._resizeHandler);this._resizeHandler=null;this._rotateLeftButton&&this._rotateLeftButton.dispose();this._rotateResetButton&&this._rotateResetButton.dispose();this._rotateRightButton&&this._rotateRightButton.dispose();this._rotateLeftButton=null;this._rotateResetButton=null;this._rotateRightButton=null;n.prototype.dispose.call(this)},t}(rt);l.registerControl("RotateControl",ku);ar=function(n){function i(i,r){var u=n.call(this,i)||this;return u._selectedClass="selected",i&&(u._showTrafficOnRendered=i.showTrafficOnRendered),u._trafficLayer=r,n.prototype.init.call(u,"TrafficToggleButton","NavBar_trafficToggle",t.L_NavBarTrafficToggleToolTip_TurnOn_Text,function(){u._trafficLayer&&u.getHelper().toggleTraffic(u._trafficLayer)}),u.rendered.addOne(function(){u._trafficLayer||u.getRootElement().add_class("disabled")}),u}return o(i,n),i.prototype.setTrafficLayer=function(n){var t=this;this._trafficLayer=n;this._trafficLayer&&(this._showTrafficOnRendered&&n.show(1),this._setTrafficButtonSelected(n.getIsShowing()),this.disposables.push(this._trafficLayer.changed.add(function(n){n.name==="isShowing"&&t._setTrafficButtonSelected(n.newValue)})),this.getRootElement().remove_class("disabled"))},i.prototype.getTrafficLayer=function(){return this._trafficLayer},i.prototype._setTrafficButtonSelected=function(n){n?(this.getRootElement().add_class(this._selectedClass),this.setTitle(t.L_NavBarTrafficToggleToolTip_TurnOff_Text)):(this.getRootElement().remove_class(this._selectedClass),this.setTitle(t.L_NavBarTrafficToggleToolTip_TurnOn_Text))},i}(vt);vr=function(n){function t(t){var i=n.call(this,t)||this;return i.setTemplate(se),i.rendered.addOne(function(){(i.zoomInButton=new wi(t)).appendTo(i.getRootElement());(i.zoomOutButton=new bi(t)).appendTo(i.getRootElement())}),i}return o(t,n),t}(rt);l.registerControl("ZoomControl",vr);wi=function(n){function i(i){var r=n.call(this,i)||this;return n.prototype.init.call(r,"ZoomInButton","NavBar_zoomIn",t.L_NavBarZoomInToolTip_Text,function(){r.getHelper().zoomIn()}),r}return o(i,n),i}(vt);l.registerControl("ZoomInButton",wi);bi=function(n){function i(i){var r=n.call(this,i)||this;return n.prototype.init.call(r,"ZoomOutButton","NavBar_zoomOut",t.L_NavBarZoomOutToolTip_Text,function(){r.getHelper().zoomOut()}),r}return o(i,n),i}(vt);l.registerControl("ZoomOutButton",bi);yr=function(n){function t(t,i,r){var u=this,f={};return u=n.call(this,f)||this,u.text=t,f.defineProperty("cssClass"),u.setCssClass(i),u.handler=r,u.showSeparator=!1,u.mouseoverHandler=null,u}return o(t,n),t}(yi),function(n){n[n.AddEntity=1]="AddEntity";n[n.ViewCollection=2]="ViewCollection";n[n.GetAllCollections=3]="GetAllCollections";n[n.GetAllCollectionNamesAndIds=4]="GetAllCollectionNamesAndIds";n[n.ViewCollectionReadOnly=5]="ViewCollectionReadOnly";n[n.AddCollection=6]="AddCollection";n[n.SetCollectionSharingAccess=7]="SetCollectionSharingAccess";n[n.SetHome=8]="SetHome";n[n.SetWork=9]="SetWork";n[n.AddFavorite=10]="AddFavorite";n[n.GetHomeAndWork=11]="GetHomeAndWork";n[n.GetActiveTasks=12]="GetActiveTasks";n[n.ViewFavorites=15]="ViewFavorites";n[n.ShowTemporaryCollection=17]="ShowTemporaryCollection";n[n.AddToTemporaryCollection=18]="AddToTemporaryCollection";n[n.LoadSharedTemporaryCollection=19]="LoadSharedTemporaryCollection";n[n.UpdateEntity=20]="UpdateEntity";n[n.ProcessCardlessPrimitives=21]="ProcessCardlessPrimitives"}(ci||(ci={}));pr=function(){function n(n,t,i,r,u,f,e,o,s,h,c,l,a){if(this.address=n,this.point=t,this.viaWaypoints=[],u)for(var v=0;v<u.length;v++)this.viaWaypoints.push(u[v]);this.isViaWaypoint=r;this.eid=f;this.type=e;this.stype=o;this.filterUrlParam=s;this.name=i;this.waypointType=h;this.waypointSource=c?c:0;this.locationIdentifier=l;this.isApproximate=!n;this.rawAddress=a}return n.prototype.clear=function(){this.address=null;this.rawAddress=null;this.point=null;this.viaWaypoints=[];this.isViaWaypoint=!1;this.eid=null;this.type=null;this.stype=null;this.filterUrlParam=null;this.name=null;this.waypointSource=0;this.locationIdentifier=null;this.isApproximate=!1;this.asType=0},n.prototype.isEmpty=function(){return!this.address&&!this.name&&!this.point},n.createObjectFrom=function(t){return new n(t.address,t.point,t.name,t.isViaWaypoint,t.viaWaypoints,t.eid,t.type,t.stype,t.filterUrlParam,t.waypointType,t.waypointSource,t.locationIdentifier,t.rawAddress)},n.areEqual=function(n,t){return n.address&&n.address===t.address||n.point&&h.areEqual(n.point,t.point)||n.eid&&n.eid===t.eid},n}(),function(n){n[n.driving=1]="driving";n[n.transit=2]="transit";n[n.walking=3]="walking";n[n.truck=4]="truck";n[n.multimode=5]="multimode"}(ei||(ei={})),function(n){n.avoidCrossing="avoidCrossing";n.minimizeCrossing="minimizeCrossing";n.allowedRegions="allowedRegions"}(du||(du={})),function(n){n[n.arrival=1]="arrival";n[n.departure=2]="departure";n[n.lastAvailable=3]="lastAvailable";n[n.firstAvailable=4]="firstAvailable"}(ki||(ki={})),function(n){n[n.miles=1]="miles";n[n.km=2]="km"}(wr||(wr={})),function(n){n[n.distance=1]="distance";n[n.time=2]="time";n[n.timeWithTraffic=3]="timeWithTraffic";n[n.transfers=4]="transfers";n[n.money=5]="money"}(br||(br={}));var di=function(){function n(){}return n.getDirectionTaskOptions=function(n,t,i,r,u,f,e,o){var h=new pr(n,t,r,!1,null,u),c,l,a,v;h.waypointType=f;h.waypointSource=this._getWaypointSource(i,e);o&&(c={dateTime:o,timeType:ki.arrival});switch(i){case pt.LocalDetails:l=3;break;default:l=2}return a={waypoints:[h],entryPoint:l,options:c?c:null},v={type:s.directionsTask,state:a},v},n.getItineraryItem=function(n,t,i,r,u,f,e){var o={Name:n,Id:i,Lat:t.latitude,Lon:t.longitude,StayDuration:"",InterestTypes:[],Image:{Url:r},CategoryId:u};if(f&&(o.InterestTypes=f.split(",")),e){var s=0,h=/(\d*) hours?/g.exec(e),c=/(\d*) minutes?/g.exec(e);h&&h.length>=2&&(s+=parseInt(h[1])*60);c&&c.length>=2&&(s+=parseInt(c[1]));o.StayDurationInMinutes=s}return o},n.getItineraryAddItemFromSaveOptions=function(t,i,r,u,f,e,o,h){var c=n.getItineraryItem(t,i,r,u,e,o,h),l={action:5,itineraryItem:c,itineraryCollectionId:f};return{type:s.itineraryDetailsTask,requestState:l}},n.getItineraryAddItemOptions=function(t,i,r,u,f,e,o,h){var c=n.getItineraryItem(t,i,r,u,e,o,h),l={action:1,itineraryItem:c};return{type:s.itineraryDetailsTask,requestState:l,taskId:f}},n.createNewItineraryOption=function(t,i,r,u,f,e,o,h,c,l,a,v){var p=n.getItineraryItem(t,i,r,u,e,o,h),w,y;p.Destination=a&&(a.city||a.stateMunicipality||a.country);p.CategoryName=l;c&&c.length&&(p.EntityTypes=c);w={itineraryItem:p};y="";switch(v){case"TransientLens":y=pt.ContextMenu;break;case s.localDetailsTask:y=pt.LocalDetails;break;case s.localListingTask:y=pt.LocalListing;break;default:y=v}return w.entryPoint=y,{type:s.itineraryDetailsTask,state:w}},n.getItineraryDayOptions=function(n,t,i){var r={action:3,travelEntity:n,day:i};return{taskId:t,type:s.itineraryDetailsTask,requestState:r}},n.getMyPlacesTaskOptions=function(n,t,i,r,u,f,e,o,h,c){i===void 0&&(i="");r===void 0&&(r="");var l={title:n,location:t,address:r,description:i,photoUrl:u,categoryId:f,id:e,addressFields:o,metadataString:h,segmentType:c},a={action:ci.AddEntity,data:l};return{type:s.collectionsTask,state:a}},n.getSaveToCollectionOptions=function(n,t,i,r,u,f,e,o){u===void 0&&(u="");f===void 0&&(f="");var h={title:n,location:t,address:f,description:u,photoUrl:e,categoryId:o,id:r},c={action:ci.AddEntity,data:h,collectionId:i};return{type:s.collectionsTask,requestState:c}},n._getWaypointSource=function(n,t){return n===pt.LocalDetails?t?2:1:n===pt.ContextMenu?t?4:3:0},n}(),gu=function(n){function i(t,i,r,u,f,e){var o=this;return f=f||{},o=n.call(this,f)||this,f.defineProperty("title"),f.defineProperty("titleAction"),f.defineProperty("description"),f.defineProperty("actions"),f.defineProperty("address"),f.defineProperty("imageUrl"),f.defineProperty("nickname"),o.setTitle(t),o.setDescription(i),o.setAddress(e||""),r&&o.setTitleAction(r),u&&o.setActions(u),o}return o(i,n),i.prototype._createOverlayDataEntityAction=function(n,t,i,r){return r?new yr(n,t,i):{text:n,cssClass:t,handler:i,mouseoverHandler:null,showSeparator:!1,showSecText:!1,secText:null}},i.prototype.getMyPlacesAction=function(n,i,r,u){return this._createOverlayDataEntityAction(r?u?t.L_OverlayEntity_MoveTo:t.L_OverlayEntity_Save:t.L_OverlayEntity_SaveAsFavorite,u?"savefavorite move":"savefavorite",i,n)},i.prototype.getDirectionsAction=function(n,i){return this._createOverlayDataEntityAction(t.L_OverlayEntity_Directions,"directions",i,n)},i.prototype.getGenericAction=function(n,t,i){return this._createOverlayDataEntityAction(n,t,i,!1)},i.prototype.getLocalListingAction=function(n,i){return this._createOverlayDataEntityAction(t.L_OverlayEntity_OpenCard,"opencard",i,n)},i.prototype.getLocalDetailsAction=function(n,i){return this._createOverlayDataEntityAction(t.L_OverlayEntity_OpenNewCard,"opennewcard",i,n)},i.prototype.getAddPushpinAction=function(n,i){return this._createOverlayDataEntityAction(t.L_OverlayEntity_AddAPushpin,"opencard",i,n)},i.prototype.getNearbyAction=function(n,i){return this._createOverlayDataEntityAction(t.L_OverlayEntity_Nearby,"nearby",i,n)},i.prototype.getStreetsideAction=function(n,i){return this._createOverlayDataEntityAction(t.L_OverlayEntity_Streetside,"streetside",i,n)},i.prototype.getBirdseyeV2Action=function(n,i){return this._createOverlayDataEntityAction(t.L_OverlayEntity_BirdseyeV2,"birdseyeV2",i,n)},i.prototype.getZoomAction=function(n,i){return this._createOverlayDataEntityAction(t.L_OverlayEntity_Zoom,"zoom",i,n)},i.prototype.getDirectionTaskOptions=function(n,t){var i=this.getDescription()||this.getTitle();return di.getDirectionTaskOptions(i,n,t,this.getTitle(),this.id)},i.prototype.getTravelTaskOptions=function(n){return di.getItineraryAddItemOptions(this.getTitle(),n,this.id,this.getImageUrl())},i.prototype.getMyPlacesTaskOptions=function(n){return di.getMyPlacesTaskOptions(this.getTitle(),n,this.getDescription(),this.getAddress(),this.getImageUrl())},i.prototype.getLocalDetailTaskOptions=function(n){var t={id:n};return{type:s.localDetailsTask,state:t}},i}(yi),bo=function(n){function t(t){var i=this,r;return t&&(r=t.getRootElement(),i=n.call(this,r,null,null)||this),i}return o(t,n),t}(hi),nf=function(){function n(n){var t=this;this._map=n;this._disposables=[];this._root=e._createElement("div").set_style({position:"absolute",width:"100%",height:"100%",pointerEvents:"none"});this._disposables.push(n.actualSizeChanged.add(function(){return t._onViewChanged()}));this._disposables.push(n.viewChangingAfterPaint.add(function(){return t._onViewChanged()}));this._disposables.push(this._map.getOverlays().changed.add(function(n){return t._onOverlaysUpdated(n)}));this._onOverlaysUpdated({reset:!0})}return n.prototype._onOverlaysUpdated=function(n){var r,i,u,t;if(n.reset)for(r=this._map.getOverlays(),i=null,this._root.clear(),t=0,u=r.length;t<u;t++)i=r[t],this._addOverlay(i);else{if(n.added)for(t=0;t<n.added.length;t++)i=n.added[t],this._addOverlay(i);if(n.removed)for(t=0;t<n.removed.length;t++)i=n.removed[t],this._removeOverlay(i)}},n.prototype._onViewChanged=function(){for(var t=this._map.getOverlays(),n=0,i=t.length;n<i;n++)this._updateOverlay(t[n])},n.prototype._updateOverlay=function(n){var t=n.getAlignment(),i;t instanceof h&&(i=t,n.setOverlayElement(this._updateOverlayLocation(n.getOverlayElement(),i,n.getAnchor())))},n.prototype._updateOverlayLocation=function(n,t,i){var u=this._map&&this._map.getMode(),r=u&&u.tryLocationToPoint(t),f,e;return r&&(f=r.x-(i?i.x:0),e=r.y-(i?i.y:0),n.set_style({position:"absolute",left:f,top:e})),n},n.prototype._addOverlay=function(t){var l=this,r=t.getOverlayElement(),u=t.getAlignment(),i=t.getAnchor(),f="auto",e="auto",o="auto",s="auto",c;if(i||(i=new p(0,0)),a.assertNotNull(r,"overlayElement"),r){if(u instanceof h)c=u,r=this._updateOverlayLocation(r,c,i);else if(typeof u=="number"){switch(u){case 1:f=-i.x+"px";o=-i.y+"px";break;case 0:f=-i.x+"px";e=-i.y+"px";break;case 3:s=-i.x+"px";o=-i.y+"px";break;case 2:s=-i.x+"px";e=-i.y+"px"}r.set_style({position:"absolute",left:e,top:f,right:o,bottom:s})}this._root.append(r);t[n._changedEventAttributeKey]=t.changed.add(function(){l._updateOverlay(t)})}},n.prototype._removeOverlay=function(t){var r=t.getOverlayElement(),i;r.removeFromParent();i=t[n._changedEventAttributeKey];i.dispose()},n.prototype.getRootElement=function(){return this._root},n.prototype.dispose=function(){for(var n=this._disposables.length;n--;)this._disposables.pop().dispose();this._map=null;this._root&&this._root.clear();this._root=null},n._changedEventAttributeKey="om$changed",n}(),ko=function(){function n(){this._argsList=[];this.length=0}return n.prototype.clear=function(){this._argsList=[];this.length=0},n.prototype.add=function(n){a.assertNotNull(n,"args");this._argsList.push(n);this.length++},n.prototype.get=function(n){return n>=0&&n<this.length?this._argsList[n]:undefined},n.prototype.getLast=function(){return a.assert(this.length>0,"Cannot call getLast when the pointer trail is empty."),this._argsList[this.length-1]},n.prototype.getLastVelocity=function(){var n,t,i,u,f,r,e,o;if(this.length<2)return new p(0,0);n=this.getLast();i=this.length-1;do--i,t=this._argsList[i],u=t.timestamp===n.timestamp,f=t.point.x===n.point.x&&t.point.y===n.point.y;while(i>=1&&(u||f));return(r=n.timestamp-t.timestamp,r===0)?new p(0,0):(e=n.point.x-t.point.x,o=n.point.y-t.point.y,new p(e/r,o/r))},n}(),go=function(n){function t(t,i,r){var u=this,f={},e;if(u=n.call(this,f)||this,u._mapLayers=new iu,f.defineProperty("cssScope"),f.defineProperty("htmlContent"),t&&u.setHtmlContent(t),f.defineProperty("layerIds"),i&&u.setLayerIds(i),r)for(u._mapLayers.clear(),e=0;e<r.length;e++)u._mapLayers.insert(r[e]);return u}return o(t,n),t.prototype.getLayers=function(){return this._mapLayers},t}(yi),ns=function(){function n(){}return n.prototype.reverseGeocode=function(n,t,i,r,u){this.reverseGeocodeWithNetworkId(n,t,i,r,u)},n.prototype.reverseGeocodeWithNetworkId=function(t,i,u,f,e){var o={success:!1,statusCode:null,authenticationResultCode:null,statusDescription:null,location:t,addressList:null,results:null};return t||i(o),t.longitude>180&&(t.longitude=-360+t.longitude),ii.instance.authenticateClientAndRetrieveSessionId(function(s){var h=ft.reverseGeocodeRequestUrlFormat.replace("{session_key}",s).replace("{latitude}",t.latitude.toString()).replace("{longitude}",t.longitude.toString()).replace("{culture}",r.dynamicProperties.uiLanguage).replace("{includeEntityTypes}",u?u.join(","):"").replace("{neighborhood}",f?"1":"0").replace("{incl}",n._getIncludeOptionString(e));return wt.downloadJsonp(h,"revgeocode",function(t){var r,u,f;if(t&&t.authenticationResultCode===n._validAuthenticationCode&&t.statusCode===n._validStatusCode&&t.statusDescription===n._validStatusDescription&&t.resourceSets&&t.resourceSets.length!==0){for(o.success=!0,o.statusCode=n._validStatusCode,o.authenticationResultCode=n._validAuthenticationCode,o.statusDescription=n._validStatusDescription,u=0,f=t.resourceSets.length;u<f;u++)if(r=t.resourceSets[u].resources,r&&r.length!==0){o.addressList=[];o.results=[];r.forEach(function(n){var t=n.address;t&&t.formattedAddress&&(o.addressList.push(t),o.results.push(n))});break}o.traceId=t.traceId}else t?(o.statusCode=t.statusCode,o.authenticationResultCode=t.authenticationResultCode,o.statusDescription=t.statusDescription,o.errorMessage=t.errorDetails&&t.errorDetails.length>0&&t.errorDetails[0],o.traceId=t.traceId):(o.statusCode=400,o.authenticationResultCode="Unknown",o.statusDescription="Unknown");i(o)},function(){o.authenticationResultCode="Unknown";o.statusCode=404;o.statusDescription="Http Error";i(o)},null,null)}),null},n._getIncludeOptionString=function(n){switch(n){case 0:return"ciso2";case 1:return"entityId";default:return""}},n._validAuthenticationCode="ValidCredentials",n._validStatusCode=200,n._validStatusDescription="OK",n}(),gi;(function(t){function i(t,i,u,f,e,o){var s,h,l=4,c=6,v=null,a;return i===1?f===n.aerial?(s=t?"#61a8f1":"#bdd5f5",h=t?"#213ad9":"#6d81f6"):(s=t?"#36a8ff":"#edf7ff",h=t?"#2656e2":"#6d90f6"):i===2&&t?(s=f===n.aerial?"#61a8f1":"#36a8ff",h=f===n.aerial?"#213ad9":"#2656e2"):t&&(s="#cacaca",h="#727272"),u<=7?(l=4,c=6):u<=14?(l=6,c=8):u<=17?(l=7,c=9):(l=8,c=10),s&&(a={visible:!0},e&&(e.isFerry||e.mode==="Ferry"?(h=null,c=null):e.mode==="Walk"||o===ei.walking?v=[0,1.5]:nu.trafficColorRouteLine&&t&&(e.mode==="Heavy"||e.mode==="High"?i===1||i===2?(s="#ed1c24",h="#880015"):(s="#7c7c7c",h="#545454"):e.mode==="Moderate"?i===1||i===2?(s="#ffbe4b",h="#be5a00"):(s="#9f9f9f",h="#686868"):e.mode==="Low"&&(s="#f2d514",h="#ffbe4b"))),r(a,s,h,l,c,v)),a}function r(n,t,i,r,u,f){t&&(n.strokeStyle=t);i&&(n.secondaryStrokeStyle=i);r&&(n.lineWidth=r);u&&(n.secondaryLineWidth=u);f&&(n.strokeDashArray=f)}t.createPolylineOptions=i})(gi||(gi={})),function(n){n[n.none=0]="none";n[n.start=1]="start";n[n.middle=2]="middle";n[n.via=12]="via";n[n.turn=13]="turn";n[n.end=10]="end";n[n.ferry=3]="ferry";n[n.walk=4]="walk";n[n.bus=5]="bus";n[n.train=6]="train";n[n.airline=7]="airline";n[n.tube=8]="tube";n[n.auto=9]="auto";n[n.infopin=15]="infopin";n[n.parkAndRide=16]="parkAndRide"}(oi||(oi={}));tf=function(n){function t(t,i,r,u,f,e,o,s,h){var c=n.call(this)||this;return c.geometryType=2,c._index=i,c.crs=tu.instance,c.geometryType=2,c._locations=t,c._updateLineGeometry(),c._mapType=r,c._taskState=1,c.subLegIndex=f,c.legIndex=u,c._routeMode=e,c._numberOfViaPoints=o,c._maneuverType=s,c._polylineOptions=c._getRoutePolylineOptions(h),c.isHidden=!1,c}return o(t,n),t.prototype.getLocations=function(){return this._locations},t.prototype.getIndex=function(){return this._index},t.prototype.getTemplate=function(){return this.isHidden?null:this._template},t.prototype.update=function(){this._changeTemplate(this.isHidden?null:this.createOptions(this._isRouteSelected,this._taskState,this._currentZoomLevel,this._mapType,this._maneuverType,this._routeMode))},t.prototype.createOptions=function(n,t,i,r,u,f){return gi.createPolylineOptions(n,t,i,r,u,f)},t.prototype.getCurrentZoom=function(){return this._currentZoomLevel},t.prototype.getMapType=function(){return this._mapType},t.prototype.getRouteMode=function(){return this._routeMode},t.prototype.getNumberOfViaPoints=function(){return this._numberOfViaPoints},t.prototype.getManeuverType=function(){return this._maneuverType},t.prototype.isTapEnabled=function(){return!0},t.prototype.isMoveEnabled=function(){return this._isAddingViaAllowed()},t.prototype.isHoverEnabled=function(){return this._isAddingViaAllowed()||!this.isRouteSelected()},t.prototype.changeZoom=function(n){this._currentZoomLevel=n},t.prototype.isRouteSelected=function(){return this._isRouteSelected},t.prototype.setVisibility=function(n){this.isHidden=!n;this.update()},t.prototype.changeRouteSelectionState=function(n){this._isRouteSelected=n},t.prototype.changeCardTaskState=function(n){this._taskState=n},t.prototype.changeMapType=function(n){this._mapType=n},t.prototype._getRoutePolylineOptions=function(n){var t=function(n){return n&&typeof n!="string"?n.toRgba():n},i=function(n){return n?Array.isArray(n)?n:(n=n.split(/[, ]+/).map(function(n){return parseInt(n)}).filter(isFinite),n.length>0?n:null):null};return n?{strokeStyle:t(n.strokeColor),lineWidth:n.strokeThickness,secondaryStrokeStyle:t(n.secondaryStrokeColor),secondaryLineWidth:n.secondaryStrokeThickness,strokeDashArray:i(n.strokeDashArray),visible:n.visible}:null},t.prototype._changeTemplate=function(n){var i,r;if(!n){this._template=null;return}if(i=this._polylineOptions,i&&(n.strokeStyle=i.strokeStyle||n.strokeStyle,n.lineWidth=typeof i.lineWidth=="number"?i.lineWidth:n.lineWidth,n.secondaryStrokeStyle=i.secondaryStrokeStyle||n.secondaryStrokeStyle,n.secondaryLineWidth=typeof i.secondaryLineWidth=="number"?i.secondaryLineWidth:n.secondaryLineWidth,n.strokeDashArray=i.strokeDashArray||n.strokeDashArray,n.visible=typeof i.visible=="boolean"||n.visible),!n.visible){this._template=null;return}r=n.strokeStyle+"_"+n.lineWidth+"_"+n.secondaryStrokeStyle+"_"+n.secondaryLineWidth+"_"+n.strokeDashArray;this._template=t._templateCache.getItem(r);this._template||(this._template=new hf({strokeStyle:n.strokeStyle,lineWidth:n.lineWidth,secondaryStrokeStyle:n.secondaryStrokeStyle,secondaryLineWidth:n.secondaryLineWidth,dashes:n.strokeDashArray,hitTest:1}),t._templateCache.addItem(r,this._template))},t.prototype._isAddingViaAllowed=function(){return!1},t.prototype.getTemplates=function(){return[this._template]},t.prototype._updateLineGeometry=function(){for(var n=this.getLocations(),r=new Array(n.length),i=new Array(n.length),t=i.length;t--;)i[t]=n[t].longitude,r[t]=n[t].latitude;var f=new li,u=f.accumulateLocations(n),e={generalizable:!0,x:i,y:r,bounds:u&&u.bounds};this.geometry=e},t._templateCache=new vi(512),t}(bf);rf=function(){function n(t,i,r,u,f,e,o,s,h,c){this.geometryType=1;this.crs=tu.instance;this.geometryType=1;this.geometry={x:0,y:0,bounds:null};this.id="Direction Pin"+n._index++;this.entity=new gu(s,null);this.entity.id=this.id;this.entity.collisionBehavior=2;this.revision=0;this.pushpinIconType=i;this._isInteractive=u;this.setLocation(t);this._maneuverType=f;this.taskState=1;this.stopPointIndex=e;this.viaPointIndex=o;this._labelText=s;this._iconText=h;this.setLabel(this._labelText,this._iconText);this.isHidden=c;this.routeMode=r}return n.prototype.setLocation=function(n){this._location=n;this._updatePointGeometry(this._location)},n.prototype.getLocation=function(){return this._location},n.prototype.getManeuverType=function(){return this._maneuverType},n.prototype.changeZoom=function(n){this.currentZoomLevel=n},n.prototype.changeRouteSelectionState=function(n){this.isRouteSelected=n},n.prototype.changeCardTaskState=function(n){this.taskState=n;this.taskState===1?this.setLabel(this._labelText,this._iconText):this.setLabel(null,null)},n.prototype.getTemplates=function(){return this.isHidden?null:this._templates},n.prototype.setVisibility=function(n){this.isHidden=!n;this.update();this.entity.changed.invoke()},n.prototype.update=function(){this.revision++},n.prototype.createOptions=function(){return null},n.prototype.isTapEnabled=function(){return!0},n.prototype.isHoverEnabled=function(){return this._isInteractive},n.prototype.isMoveEnabled=function(){return(this.routeMode===ei.transit||nu.enableMultiMode&&this.routeMode===ei.multimode)&&this._isInteractive?this.pushpinIconType===oi.start||this.pushpinIconType===oi.end||this.pushpinIconType===oi.middle:this._isInteractive},n.prototype._changeTemplate=function(t){var e,u,s,i,r,o,f,h;if(!t||!t.length){this._templates=null;return}for(e=[],u=0,s=t.length;u<s;u++)i=t[u],r=null,i.isVectorImage?(o=[i.radius+(i.isSquare?"S":""),i.fillColor,i.borderWidth,i.borderColor,i.innerRadius,i.innerFillColor].join("_"),r=n._templateCache.getItem(o),r||(r=new re(this._createVectorImage(i)),n._templateCache.addItem(o,r))):(f=i.anchor,h=f?new tr(f.x,f.y,1):new tr(Math.ceil(i.width/2),i.height,1),r=new cf(i.icon,1,h)),r&&e.push(r);this._templates=e},n.prototype._updatePointGeometry=function(n){var t=n.latitude,i=n.longitude;this.geometry.x=i;this.geometry.y=t;this.geometry.bounds=[t,i,t,i]},n.prototype._createVectorImage=function(n){var i={records:[],hotspotX:0,hotspotY:0,hitTest:1},t=i.records;return n.isSquare?(n.borderWidth&&n.borderColor&&t.push(this._squareRecord(n.radius+n.borderWidth,n.borderColor)),n.fillColor&&t.push(this._squareRecord(n.radius,n.fillColor))):(n.fillColor&&t.push(this._ellipseRecord(n.radius,{fillStyle:n.fillColor})),n.borderWidth&&n.borderColor&&t.push(this._ellipseRecord(n.radius,{lineWidth:n.borderWidth,strokeStyle:n.borderColor})),n.hasInnerCircle&&n.innerFillColor&&n.innerRadius&&t.push(this._ellipseRecord(n.innerRadius,{fillStyle:n.innerFillColor}))),i},n.prototype._squareRecord=function(n,t){return{pointsList:[{x:-n,y:-n},{x:n,y:-n},{x:n,y:n},{x:-n,y:n}],vectorType:0,style:{fillStyle:t}}},n.prototype._ellipseRecord=function(n,t){return{centerX:0,centerY:0,radiusX:n,radiusY:n,vectorType:2,style:t}},n._templateCache=new vi(64),n._index=0,n}(),function(n){n[n.BusinessWith4Images=0]="BusinessWith4Images";n[n.BusinessWith2Images=1]="BusinessWith2Images";n[n.BusinessWith1Image=2]="BusinessWith1Image";n[n.AddressWith2Images=3]="AddressWith2Images";n[n.MapWith0Image=4]="MapWith0Image"}(nt||(nt={}));var uf=function(){function n(n,t){var r,u,o,f;if(this._imageUrls=[],this._imageWidths=[],this._imageHeights=[],this._imageTopPositions=[],this._imageLeftPositions=[],this._pushpins=[],this._template=nt.MapWith0Image,this._mapMode=n,t&&t.stacks&&t.stacks.length){var s=t.focusedStackIndex?t.focusedStackIndex:0,e=t.stacks[s],i=e?e.tasks[e.tasks.length-1]:null;if(i&&(i.type==="LocalDetails"||i.type==="LocalListing"||i.type==="PolygonEntityDetails")&&i.state){r=i.state;r.imgUrls&&Array.prototype.push.apply(this._imageUrls,i.state.imgUrls);this._imageUrls=this._cleanImageUrls(this._imageUrls);switch(this._imageUrls.length){case 0:this._template=nt.MapWith0Image;break;case 1:this._template=nt.BusinessWith1Image;break;case 2:case 3:this._template=nt.BusinessWith2Images;this._imageUrls=this._imageUrls.slice(0,2);break;default:this._template=nt.BusinessWith4Images;this._imageUrls=this._imageUrls.slice(0,4)}if(r.primerPois)for(u=0;u<r.primerPois.length;u++)o=r.primerPois[u].entity,r.primerPois.length===1&&this._imageUrls.length===0&&(this._template=nt.AddressWith2Images,this._query=o.subtitle),f=r.primerPois[u].geometry,f&&this._pushpins.push({location:new h(f.y,f.x)})}}}return n.prototype.createShareImage=function(n){var t=this;ii.instance.authenticateClientAndRetrieveSessionId(function(i){var r,u;t._setTemplateSize(t._template);t._addMapImages(i,t._template);t._imageUrls=t._reformatImageSizes(t._imageUrls,t._imageWidths,t._imageHeights);t._imageUrls.length===0&&n();r=document.createElement("canvas");r.width=b.shareImgWidth;r.height=b.shareImgHeight;u=r.getContext("2d");u.fillStyle=b.shareImgMarginFill;u.fillRect(0,0,b.shareImgWidth,b.shareImgHeight);t._loadImages(t._imageUrls,function(i){var f,e;i&&i.length===t._imageUrls.length||n();try{for(f=0;f<i.length;f++)e=i[f],u.drawImage(e,t._imageLeftPositions[f],t._imageTopPositions[f]);n(r.toDataURL("image/jpeg",.8))}catch(o){n()}})})},n.prototype._setTemplateSize=function(n){var t=b.shareImgMargin;switch(n){case nt.BusinessWith4Images:this._imageWidths=[250,110-t,240-t,175-t,175-t];this._imageHeights=[315,155,155,160-t,160-t];this._imageLeftPositions=[0,250+t,360+t,250+t,425+t];this._imageTopPositions=[0,0,0,155+t,155+t];break;case nt.BusinessWith2Images:case nt.AddressWith2Images:this._imageWidths=[420,180-t,180-t];this._imageHeights=[315,160-t,155];this._imageLeftPositions=[0,420+t,420+t];this._imageTopPositions=[0,0,160];break;case nt.BusinessWith1Image:this._imageWidths=[600,180];this._imageHeights=[315,90];this._imageLeftPositions=[0,420];this._imageTopPositions=[0,225]}},n.prototype._addMapImages=function(n,t){if(t!==nt.MapWith0Image){var r={width:this._imageWidths.length>0&&this._imageWidths[0],height:this._imageHeights.length>0&&this._imageHeights[0],centerPoint:this._mapMode&&this._mapMode.centerPoint,zoomLevel:this._mapMode&&this._mapMode.level,pushpins:this._pushpins},i;t!==nt.AddressWith2Images?(i=this._createMapSnippetUrl(n,r),i&&this._imageUrls.splice(0,0,i)):this._imageHeights.length>2&&this._imageWidths.length>2&&(this._imageUrls=[],i=this._createMapSnippetUrl(n,r),i&&this._imageUrls.push(i),r.width=this._imageWidths[1],r.height=this._imageHeights[1],r.imagerySet="Aerial",i=this._createMapSnippetUrl(n,r),i&&this._imageUrls.push(i),r.width=this._imageWidths[2],r.height=this._imageHeights[2],r.imagerySet="StreetSide",r.query=this._query,i=this._createMapSnippetUrl(n,r),i&&this._imageUrls.push(i))}},n.prototype._createMapSnippetUrl=function(t,i){var u=!1,r=b.mapSnippetUrl,o,f,s,e;if(i.imagerySet==="Aerial")r=r.replace("Road","Aerial");else if(i.imagerySet==="StreetSide"&&i.query)r=r.replace("Road","StreetSide"),n._latlonRegex.test(i.query)?(o=i.query.replace(/ /g,""),r+="/"+o+"/"+o+"?"):r+="/"+encodeURIComponent(i.query)+"?",u=!0;else if(i.imagerySet&&i.imagerySet!=="Road")return null;if(!u&&i.route&&i.route.sourcePoint&&i.route.destinationPoint)r+="/Routes/"+i.route.mode?i.route.mode:"Driving",r+="?wp.0="+i.route.sourcePoint.latitude+","+i.route.sourcePoint.longitude+"&wp.1="+i.route.destinationPoint.latitude+","+i.route.destinationPoint.longitude,u=!0;else if(!u&&i.imagerySet!=="Aerial"&&i.pushpins&&i.pushpins.length&&i.pushpins[0].location){for(r+="?",s=i.pushpins.length===1&&b.shareImgDetailPushpinType||b.shareImgListPushpinType,e=0;e<i.pushpins.length;e++)f=i.pushpins[e],f.location&&(r+="&pushpin="+f.location.latitude+","+f.location.longitude+";"+(f.type||s));u=!0}else!u&&i.centerPoint&&i.zoomLevel&&(r+="/"+i.centerPoint.latitude+","+i.centerPoint.longitude+"/"+i.zoomLevel+"?",u=!0);return u?(r+="&mapSize={mapWidth},{mapHeight}&key={credentials}",r=r.replace("{mapWidth}",i.width.toString()).replace("{mapHeight}",i.height.toString()).replace("{credentials}",t),i.imagerySet==="Aerial"&&(r+="&da=n"),r):null},n.prototype._cleanImageUrls=function(n){for(var i,f=[],e=[],t,r,u=0;u<n.length;u++)if(t=n[u],i=t.match(/[?&]id=([^&]*)/ig),i&&i.length){if(r=i[0].substr(4),f.indexOf(r)>=0)continue;f.push(r);t=t.replace(/http[s]?:\/\/([^\/]*)/,"");e.push(t)}return e},n.prototype._loadImages=function(n,t){for(var r=[],u=n.length,f=0,i=0;i<u;i++)r.push(new Image),r[i].onload=function(){++f>=u&&t(r)},r[i].onerror=function(){t()},r[i].src=n[i]},n.prototype._reformatImageSizes=function(n,t,i){var u,f,r;if(n.length!==t.length)return[];for(u=/&w=[0-9]*/i,f=/&h=[0-9]*/i,r=0;r<n.length;r++)n[r]=n[r].replace(u,"&w="+t[r]).replace(f,"&h="+i[r]);return n},n._latlonRegex=/\d+\.\d*, ?-?\d+\.\d*$/,n}(),kr=function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._streetsideMiniInstanceName="StreetsideMini",u}return o(t,n),t.prototype.setOptions=function(n){return n&&(n.containerId&&n.containerId.trim().length>0||n.container)&&n.width&&n.width>0&&n.height&&n.height>0?(this._options=n,!0):!1},t.prototype.show=function(n,t){var f=this,i,r,u;if(!n){this._noBubbleAction(t);return}if(i=this._createOverlay(t),this._addOverlayToMap(i,t),t.heading=t.heading||ni.getAngleBetweenTwoLocations(new h(n.la,n.lo),t.locationToLookAt),r=this._getMiniOptions(t),this.setOptions(r))u=function(i){return f._prepStreetsideMini(i,n,t&&t.onSuccessLoading,t&&t.onErrorLoading)},this._map.getContainer().instanceAsync(this._streetsideMiniInstanceName,u);else{this._handleError(t&&t.onErrorLoading);return}this._addEventHandlers(n,t)},t.prototype._handleError=function(n){var t;Microsoft&&Microsoft.Maps&&(t=Microsoft.Maps.logger);t&&t.logObject({feature:v.StreetsideModeFeatureName,action:v.StreetsideErrorAction,data:{ET:v.StreetsideBootstrapError}});n&&n();this.hideStreetside()},t.prototype._noBubbleAction=function(n){this._handleError(n&&n.onErrorLoading)},t.prototype._getMiniOptions=function(n){var t={containerId:dr.id,width:this._overlay.getWidth(),height:this._overlay.getHeight(),cssClasses:["bm_streetsideMiniCircle"],entryPoint:n.entryPoint,heading:n.heading,isInteractive:!1,perfState:n.perfState,perfClickToImmersionTimeSource:n.perfClickToImmersionTimeSource,rotateBubble:!0};return navigator.userAgent.indexOf("Chrome")<0&&navigator.userAgent.indexOf("AppleWebKit")>=0&&navigator.userAgent.indexOf("Safari")>=0&&(t.rotateBubble=!1,t.preferredRenderer="canvas2d"),t},t.prototype._prepStreetsideMini=function(n,t,i,r){var u=null;u=this._options.container?this._options.container[0]:document.getElementById(this._options.containerId);u?(u.appendChild(n.getRootElement()[0]),this._currentBubble=t,e._renderAllPoiAndLabelsGL()&&this._streetsideMini&&this._streetsideMini.dispose(),this._streetsideMini=n,n.loadBubble(t,this._options,i,r)):r&&r()},t.prototype.hideStreetside=function(){this._streetsideMini&&this._streetsideMini.removeSIVContent();this._removeEventHandlers()},t.prototype._createOverlay=function(){return new dr},t.prototype._addOverlayToMap=function(n,t){this._overlay=n;this._overlay.setAlignment(t.locationToLookAt);this._map.getOverlays().insert(this._overlay)},t.prototype._addEventHandlers=function(n,t){var i=this;this._overlayTappedHandler=function(r){return i._onOverlayTapped(r,n,t)};this._overlay.getOverlayElement().add_event("click,touchstart",this._overlayTappedHandler);this._mapTappedHandler=this._map.mapTapped.add(function(){return i.hideStreetside()});this._mapZoomStartedHandler=this._map.mapZoomStarted.add(function(){return i.hideStreetside()});this._mapContextMenuHandler=this._map.contextMenuInvoked.add(function(){return i.hideStreetside()});this._mapModeChangedHandler=this._map.mapModeChanged.add(function(){return i.hideStreetside()});this._primitiveTappedHandler=this._map.primitiveTapped.add(function(){return i.hideStreetside()});this._hideStreetsideHandler=function(n){return i._onWindowTapped(n)};u(window).add_event("click,touchstart",this._hideStreetsideHandler)},t.prototype._removeEventHandlers=function(){this._mapTappedHandler&&this._mapTappedHandler.dispose();this._mapZoomStartedHandler&&this._mapZoomStartedHandler.dispose();this._mapContextMenuHandler&&this._mapContextMenuHandler.dispose();this._mapModeChangedHandler&&this._mapModeChangedHandler.dispose();this._primitiveTappedHandler&&this._primitiveTappedHandler.dispose();this._overlay&&(this._map.getOverlays().remove(this._overlay),this._overlay.getOverlayElement().remove_event("click,touchstart",this._overlayTappedHandler),u(window).remove_event("click,touchstart",this._hideStreetsideHandler))},t.prototype._onWindowTapped=function(n){n.target&&u(n.target.parentElement).has_class("ms-composite")||this.hideStreetside()},t.prototype._onOverlayTapped=function(n,t,i){var s=this,f,e,o,u,r;if(!t){this.hideStreetside();return}f=this._overlay.getWidth()/2;e=this._overlay.getOverlayElement().get_absolute_pos();e.x+=f;e.y+=f;o=new p(n.pageX,n.pageY);u=n;u&&u.touches&&u.touches.length==1&&(r=u.touches[0],o=new p(typeof r.clientX=="number"?r.clientX:r.pageX,typeof r.clientY=="number"?r.clientY:r.pageY));y.pointInCircle(o,e,f)&&(n.stopImmediatePropagation(),i.perfState=this._perfLog&&this._perfLog.start(i.perfClickToImmersionTimeSource),this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(n){n.show(t,i);s.hideStreetside()}))},t}(su),ts=function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._streetsideMiniInstanceName="StreetsideDirectionsMini",u._mapTileUrlFormat=c.directionsOverlayMapTileUrlFormat.replace("{width}",c.directionsViewportWidth.toString()).replace("{height}",c.directionsViewportHeight.toString()),u}return o(t,n),t.prototype.showStreetsideIfAvailable=function(n,t,i){var u=this,r;if(!n||!n.locationToLookAt||!n.locationToLookFrom){i&&i();return}r=this._getAppropriateLookLocation(n);this.isAvailable(r,function(f,e){return u._pickAndShowBestPossibleBubble(e,{locationToLookAt:r,directionsStartupOptions:n,entryPoint:v.EntryPointDrivingDirections,perfClickToImmersionTimeSource:kt.DirectionsClickToImmersionTime,onSuccessLoading:t,onErrorLoading:i})},i)},t.prototype._noBubbleAction=function(n){var t=this._createOverlay(n);this._showZoomedMapTile(t,n.locationToLookAt);this._addOverlayToMap(t,n);this._addEventHandlers(null,n);n&&n.onSuccessLoading&&n.onSuccessLoading()},t.prototype._addEventHandlers=function(t,i){var r=this;n.prototype._addEventHandlers.call(this,t,i);this._mapViewChangedHandler=this._map.viewChanged.add(function(){return r.hideStreetside()})},t.prototype._removeEventHandlers=function(){n.prototype._removeEventHandlers.call(this);this._mapViewChangedHandler&&this._mapViewChangedHandler.dispose();this._mapViewChangedHandler=null},t.prototype._showStreetsideMini=function(n,t,i){var r=this;this._map.getContainer().instanceAsync("StreetsideDirectionsMini",function(u){return r._prepStreetsideMini(u,n,t,i)})},t.prototype._getMiniOptions=function(n){return{containerId:"directionsStreetsideContainer",width:c.directionsViewportWidth,height:c.directionsViewportHeight,cssClasses:["bm_streetsideMiniCircle","streetsideDirectionsCircle"],entryPoint:v.EntryPointDrivingDirections,heading:n.directionsStartupOptions.heading,isInteractive:!1,setViewAnimationMilliseconds:c.setViewAnimationMillisecondsForStreetsideMini,perfState:n.directionsStartupOptions.perfState}},t.prototype._createOverlay=function(n){return new ff(n.directionsStartupOptions.maneuverType)},t.prototype._pickAndShowBestPossibleBubble=function(n,t){var i=null;n&&(this.hideStreetside(),i=this._pickBestPossibleBubbleToLookFrom(t.directionsStartupOptions,n));this.show(i,t)},t.prototype._getAppropriateLookLocation=function(n){return this._isStartManeuver(n.maneuverType)?n.locationToLookFrom:n.locationToLookAt},t.prototype._isStartManeuver=function(n){return n===t._startManeuver},t.prototype._showZoomedMapTile=function(n,t){var i=this._map.getMapType(),u="aerial",f;"Road"!==i.displayName&&"RoadVector"!==i.displayName&&(u="road");f=this._mapTileUrlFormat.replace("{mapStyle}",u).replace("{latitude}",t.latitude.toString()).replace("{longitude}",t.longitude.toString()).replace("{cmnPltParam}",r.platformCommonParam);n.getOverlayElement().set_style({backgroundImage:"url('"+f+"')"});n.getOverlayElement().add_class("bm_streetsideMiniCircle streetsideDirectionsCircle")},t.prototype._pickBestPossibleBubbleToLookFrom=function(n,t){var e=ni.getAngleBetweenTwoLocations(n.locationToLookFrom,n.locationToLookAt),i,r,o,f;if(n.heading=e,this._isStartManeuver(n.maneuverType))return t[0];for(i=null,r=0,o=t.length;r<o;r++){var u=t[r],s=new h(u.la,u.lo),l=ni.getAngleBetweenTwoLocations(s,n.locationToLookAt);if(this._anglesAreSimilar(e,l)){if(f=ni.greatCircleDistance(s,n.locationToLookAt),f>=c.optimalDirectionsBubbleDistanceFromIntersectionInMeters)return i;f>=c.minimumDirectionsBubbleDistanceFromIntersectionInMeters&&(i=u)}}return i},t.prototype._anglesAreSimilar=function(n,t){return y.getAngleDifference(n,t)<c.directionsMaximumAngleDifferenceToConsiderTwoAnglesSimilar},t._startManeuver="start",t}(kr),dr=function(n){function t(i,r,u){var f=this;i=i||t.id;r=r||t.defaultWidth;u=u||t.defaultHeight;var s=new h(0,0),c=new p(r/2,u/2),o=e._createElement("div");return f=n.call(this,o,s,c)||this,f._streetsideMiniOverlayDiv=o,o.set_attr("id",i),o.set_style({width:r+"px",height:u+"px"}),o.add_class("bm_streetsideMiniOverlay"),a.addDataTag(o,"SSMiniOverlay"),f.defineProperty("width"),f.defineProperty("height"),f.setWidth(r),f.setHeight(u),f}return o(t,n),t.prototype._addExtraElements=function(){},t.id="streetsideMiniContainer",t.defaultWidth=295,t.defaultHeight=295,t}(hi),ff=function(n){function t(i){var r=n.call(this,t.id,c.directionsViewportWidth,c.directionsViewportHeight)||this;return r._maneuverType=i,r._addExtraElements(),r}return o(t,n),t.prototype._addExtraElements=function(){var n=e._createElement("div");n.add_class("streetsideDirectionsImage "+this._maneuverType);n.set_attr("id","directionsStreetsideManeuverType");a.addDataTag(n,"DDSSManeuverType");this._streetsideMiniOverlayDiv.append(n)},t.id="directionsStreetsideContainer",t}(dr),is=function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._sivContainerTappedHandler=null,u._streetsideMiniInstanceName="StreetsideLocalDetailsMini",u}return o(t,n),t.prototype.hideStreetside=function(){this._localDetailsStartupOptions&&this._localDetailsStartupOptions.sivImageContainer.set_style({display:"none"})},t.prototype.showStreetsideIfAvailable=function(n,i,r,u,f){var e=this,o;this._localDetailsStartupOptions=i;o={locationToLookAt:n,entryPoint:v.EntryPointLocalDetails,pitch:i&&i.pitch,heading:i&&i.heading,fov:i&&i.fov,perfState:f,perfClickToImmersionTimeSource:kt.LocalDetailsClickToImmersionTime,onSuccessLoading:r,onErrorLoading:u};i&&i.bubbleId&&i.bubbleId.length>0&&i.bubbleId!==t.defaultInvalidBubbleId?this._map.getContainer().instanceAsync("IBubblesSource",function(){return e._getBubbleById(parseInt(i.bubbleId),function(n){return e.show(n,o)},u)}):this._showSSIfAvailableInRadius(i.routablePoint,function(n){e.show(n,o)},function(){e._showSSIfAvailableInRadius(n,function(n){e.show(n,o)},function(){e._handleError(u)})})},t.prototype.showStreetsideModeForLocalDetails=function(n,i,r,u){var e=this,o,f;i?(o={locationToLookAt:n,entryPoint:v.EntryPointLocalDetails,pitch:i.pitch,heading:i.heading,fov:i.fov,perfState:i.perfState,onSuccessLoading:r,onErrorLoading:u},f=i.bubbleId,f&&f.length>0&&f!==t.defaultInvalidBubbleId?this._showStreetsideModeByBubbleId(f,o):n&&this._showSSIfAvailableInRadius(i.routablePoint,function(n){e._startStreetsideMode(n,o)},function(){e._showSSIfAvailableInRadius(n,function(n){e._startStreetsideMode(n,o)},function(){e._handleError(u)})})):this._handleError(u)},t.prototype._startStreetsideMode=function(n,t){this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(i){i.show(n,t)})},t.prototype._createOverlay=function(){return null},t.prototype._addOverlayToMap=function(){this._localDetailsStartupOptions.sivImageContainer.set_style({display:"block"})},t.prototype._addEventHandlers=function(n,t){var r=this,i;this._sivContainerTappedHandler=function(i){return r._onSIVContainerTapped(i,n,t)};i=this._localDetailsStartupOptions.sivImageContainer;i.add_event("click",this._sivContainerTappedHandler)},t.prototype._removeEventHandlers=function(){var n=this._localDetailsStartupOptions.sivImageContainer;n.remove_event("click,touchstart",this._sivContainerTappedHandler)},t.prototype._getMiniOptions=function(n){var t=this._localDetailsStartupOptions.sivImageContainer;return{container:t,width:t.get_size().width,height:t.get_size().height,entryPoint:v.EntryPointLocalDetails,pitch:n.pitch,heading:n.heading,fov:n.fov||35.9,isInteractive:!1,perfState:n.perfState}},t.prototype._showSSIfAvailableInRadius=function(n,t,i){this.isAvailable(n,function(r){var u=r!=null,f,e;u&&(f=new h(r.la,r.lo),e=ni.greatCircleDistance(f,n),u=e<=c.localDetailsMaximumDistanceInMetersBetweenBubbleAndEntity);u?t(r):i&&i()},i)},t.prototype._showStreetsideModeByBubbleId=function(n,t){this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(i){i.show(parseInt(n),t)})},t.prototype._onSIVContainerTapped=function(n,t,i){n.preventDefault();i.perfState=this._perfLog&&this._perfLog.start(i.perfClickToImmersionTimeSource);this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(n){n.show(t,i)})},t.defaultInvalidBubbleId="1234567890",t}(kr),rs=function(){function t(n,i){this._map=null;this._disposables=[];this.attach(n);this._perfLog=i;this._streetsideCoverageBehavior=null;this._attachOptions={pickerOverlay:new us,attachedTo:t._name,entryPoint:v.EntryPointZoomIn,perfIdentifier:kt.AutoEntryToImmersionTime,followCursor:!1};this.showCoverageIfNeeded(k.getMercatorZoomLevel(this._map))}return t.prototype.attach=function(n){var t=this;a.assert(!this._map,"An event source has already been attached to this behavior.");this._map=n;this._lastMapZoomValue=0;this._disposables.push(this._map.mapZoomStopped.add(function(n){return t._onMapZoomStopped(n)}));this._disposables.push(this._map.viewChanged.add(function(n){return t._onViewChanged(n)}));this._disposables.push(this._map.mapTypeChanged.add(function(n){return t.mapTypeChanged(n)}))},t.prototype.detach=function(){a.assertNotNull(this._map,"No map has been attached to this behavior.");for(var n=this._disposables.length;n--;)this._disposables.pop().dispose();this._map=null;this._lastMapZoomValue=0},t.prototype._onMapZoomStopped=function(n){this.showCoverageIfNeeded(n.zoom)},t.prototype._onViewChanged=function(){var n=k.getMercatorZoomLevel(this._map);Math.abs(n-this._lastMapZoomValue)!==0&&(this._lastMapZoomValue=n,this.showCoverageIfNeeded(n))},t.prototype.mapTypeChanged=function(){this.showCoverageIfNeeded(k.getMercatorZoomLevel(this._map))},t.prototype.showCoverageIfNeeded=function(n){var t=this.showStreetSideOverlay(n);t||this.hideStreetSideOverlay()},t.prototype.showStreetSideOverlay=function(n){var t=this,i;return e._isSmallMapShownOnSerp()?!1:this._shouldAttachCoverageBehavior(n)?(i=this._perfLog.start(kt.AutoEntryToImmersionTime),this._streetsideCoverageBehavior?this._attachCoverageBehaviorIfNotAttached():this._map.getContainer().instanceAsync("StreetsideCoverageBehavior",function(n){t._shouldAttachCoverageBehavior(k.getMercatorZoomLevel(t._map))&&(t._streetsideCoverageBehavior=n,t._attachCoverageBehaviorIfNotAttached())}),!0):!1},t.prototype.hideStreetSideOverlay=function(){this._streetsideCoverageBehavior&&this._streetsideCoverageBehavior.isAttached()&&this._streetsideCoverageBehavior.getAttachedTo()===t._name&&(this._streetsideCoverageBehavior.toggleStreetsideButton(!1),this._streetsideCoverageBehavior.detach())},t.prototype._shouldAttachCoverageBehavior=function(i){var r=this._map.getMode();return r&&r.mapModeType!==2&&this._map.getMapType().id!==n.birdseye&&this._map.getMapType().id!==n.birdseyeV2&&i>=t._streetsideAutoEntryZoomLevel},t.prototype._attachCoverageBehaviorIfNotAttached=function(){this._streetsideCoverageBehavior.isAttached()||(this._streetsideCoverageBehavior.attach(this._map,this._attachOptions),this._streetsideCoverageBehavior.toggleStreetsideButton(!0))},t._name="StreetsideAutoEntryBehavior",t._streetsideAutoEntryZoomLevel=19,t}(),us=function(n){function i(){var i=this,r=e._createElement("div"),u=new h(0,0),f=new p(0,0);return i=n.call(this,r,u,f)||this,i._cursorElement=e._createElement("div"),i._cursorElement.set_attr("class","streetsideAutoEntryTooltip"),i._cursorElement.set_attr("data-tag","Streetside.AutoEntryTooltip"),r.append(i._cursorElement),i._tooltipMessageTextElement=e._createElement("p"),i._tooltipMessageTextElement.appendText(t.L_StreetsideAutoEntryTooltip_Text),i._tooltipMessageElement=e._createElement("div"),i._tooltipMessageElement.set_attr("class",ef.streetsideCursorNoCoverageMessageClass),i._tooltipMessageElement.append(i._tooltipMessageTextElement),r.append(i._tooltipMessageElement),i}return o(i,n),i.prototype.showNoCoverage=function(){this._tooltipMessageElement.remove_class(i._tooltipShowClassName)},i.prototype.showCoverage=function(n){it.getItem(i._tooltipShownStorageName)?n&&this._tooltipMessageElement.remove_class(i._tooltipShowClassName):(this._tooltipMessageElement.add_class(i._tooltipShowClassName),it.setItem(i._tooltipShownStorageName,"1",1))},i.prototype.showWaiting=function(){},i._tooltipShownStorageName="streetsideAutoEntryTooltipShown",i._tooltipShowClassName="streetsideTooltipShow",i._tooltipTimeToRemove=9e3,i}(hi),ef=function(n){function i(){var r=this,u=e._createElement("div"),f=new h(0,0),o=new p(5,41);return r=n.call(this,u,f,o)||this,u.set_attr("class",i.streetsideCursorClass),r._cursorManElement=e._createElement("div"),r._cursorManElement.set_attr("class","bm_streetsideCursorMan "+i.streetsideCursorManNormalClass),r._cursorManElement.set_attr("data-tag","Streetside.CursorMan"),u.append(r._cursorManElement),r._noCoverageMessageTextElement=e._createElement("p"),r._noCoverageMessageTextElement.appendText(t.L_StreetsideNoCoverageInstructions_Text),r._noCoverageMessageElement=e._createElement("div"),r._noCoverageMessageElement.set_attr("class",i.streetsideCursorNoCoverageMessageClass),r._noCoverageMessageElement.append(r._noCoverageMessageTextElement),u.append(r._noCoverageMessageElement),r}return o(i,n),i.prototype.showNoCoverage=function(n){this._noCoverageMessageTextElement.set_text(n);this._doSafeClassSwap(i.streetsideCursorManWaitingClass,i.streetsideCursorManNormalClass,i.streetsideCursorManNoCoverageClass);this._noCoverageMessageElement.add_class(i.streetsideCursorNoCoverageMessageShowClass)},i.prototype.showCoverage=function(){this._doSafeClassSwap(i.streetsideCursorManWaitingClass,i.streetsideCursorManNoCoverageClass,i.streetsideCursorManNormalClass);this._noCoverageMessageElement.remove_class(i.streetsideCursorNoCoverageMessageShowClass)},i.prototype.showWaiting=function(){this._cursorManElement.swap_class(i.streetsideCursorManNormalClass,i.streetsideCursorManWaitingClass)},i.prototype._doSafeClassSwap=function(n,t,i){this._cursorManElement.remove_class(n);this._cursorManElement.remove_class(t);this._cursorManElement.add_class(i)},i.streetsideCursorClass="bm_streetsideCursor",i.streetsideCursorManNormalClass="bm_streetsideCursorManNormal",i.streetsideCursorManNoCoverageClass="bm_streetsideCursorManNoCoverage",i.streetsideCursorManWaitingClass="bm_streetsideCursorManWaiting",i.streetsideCursorNoCoverageMessageClass="bm_streetsideCursorNoCoverageMessage",i.streetsideCursorNoCoverageMessageShowClass="bm_streetsideCursorNoCoverageMessageShow",i}(hi),nr=function(){function n(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){this._title=n;this._description=t;this._address=t;this.id=i;this._location=r;this._routableLocation=u;this._menuUrl=f;this._imageUrl=e;this.entitySource=o;this._primaryCategoryPath=s||"";this._primaryCategoryName=h||"";this._vdpId=c;this._locationType=l;this._dateTime=a;this._endDateTime=v;this._utcOffset=y;this._isAllDayEvent=p;this._segmentTypes=w;this.isApproximateLocation=b;this.isPaginationReducedPoi=!1}return n.prototype.getLocation=function(){return this._location},n.prototype.getRoutableLocation=function(){return this._routableLocation},n.prototype.getBoundingBox=function(){return this._boundingBox},n.prototype.setBoundingBox=function(n){this._boundingBox=n},n.prototype.getTitle=function(){return this._title},n.prototype.setTitle=function(n){this._title=n},n.prototype.getDescription=function(){return this._description},n.prototype.setDescription=function(n){this._description=n},n.prototype.getMenuUrl=function(){return this._menuUrl},n.prototype.setMenuUrl=function(n){this._menuUrl=n},n.prototype.getImageUrl=function(){return this._imageUrl},n.prototype.setImageUrl=function(n){this._imageUrl=n},n.prototype.getPrimaryCategoryPath=function(n){return n&&(!this._primaryCategoryPath||this._primaryCategoryPath==="")?this._segmentTypes&&this._segmentTypes.length&&this._segmentTypes[0]||"":this._primaryCategoryPath},n.prototype.setPrimaryCategoryPath=function(n){this._primaryCategoryPath=n},n.prototype.getPrimaryCategoryName=function(){return this._primaryCategoryName},n.prototype.setPrimaryCategoryName=function(n){this._primaryCategoryName=n},n.prototype.getSelectedCategoryForIcon=function(){return this._selectedCategoryForIcon},n.prototype.setSelectedCategoryForIcon=function(n){this._selectedCategoryForIcon=n},n.prototype.getSearchCategory=function(){return this._searchCategory},n.prototype.setSearchCategory=function(n){this._searchCategory=n},n.prototype.getAddress=function(){return this._address},n.prototype.setVdpId=function(n){this._vdpId=n},n.prototype.getVdpId=function(){return this._vdpId},n.prototype.setLocationType=function(n){this._locationType=n},n.prototype.getLocationType=function(){return this._locationType},n.prototype.setSegmentTypes=function(n){this._segmentTypes=n},n.prototype.getSegmentTypes=function(){return this._segmentTypes},n.prototype.getDateTime=function(){return this._dateTime},n.prototype.setDateTime=function(n){this._dateTime=n},n.prototype.getEndDateTime=function(){return this._endDateTime},n.prototype.setEndDateTime=function(n){this._endDateTime=n},n.prototype.getUtcOffset=function(){return this._utcOffset},n.prototype.setUtcOffset=function(n){this._utcOffset=n},n.prototype.getIsAllDayEvent=function(){return this._isAllDayEvent},n.prototype.setIsAllDayEvent=function(n){this._isAllDayEvent=n},n.prototype.setPhone=function(n){this._phone=n},n.prototype.getPhone=function(){return this._phone},n.prototype.setWebsite=function(n){this._website=n},n.prototype.getWebsite=function(){return this._website},n.prototype.setChainId=function(n){this._chainId=n},n.prototype.getChainId=function(){return this._chainId},n.prototype.clone=function(){return n.cloneFrom(this)},n.cloneFrom=function(t){var i=new n(t._title,t._address,t.id,t._location,t._routableLocation,t._menuUrl,t._imageUrl,t.entitySource,t._primaryCategoryPath,t._primaryCategoryName,t._vdpId,t._locationType,t._dateTime,t._endDateTime,t._utcOffset,t._isAllDayEvent,t._segmentTypes,t.isApproximateLocation);return i.setDescription(t._description),i.setBoundingBox(t._boundingBox),i.setSelectedCategoryForIcon(t._selectedCategoryForIcon),i.setPhone(t._phone),i.setWebsite(t._website),i.setChainId(t._chainId),i.htmlElement=t.htmlElement,i.representsTransitStop=t.representsTransitStop,i.isUpHierarchy=t.isUpHierarchy,i.isPermanentlyClosed=t.isPermanentlyClosed,i.poiType=t.poiType,i},n}(),fs=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){return n.call(this,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k)||this}return o(t,n),t.prototype.setRouteRequestState=function(n){this._routeRequestState=n},t.prototype.getRouteRequestOptions=function(){return this._routeRequestState&&this._routeRequestState.requestOptions},t.prototype.getIsHome=function(){return this._routeRequestState&&this._routeRequestState.isHome},t.prototype.hasRouteRequestState=function(){return this._routeRequestState!==undefined},t.prototype.getIndependentHotRegions=function(){return this.hasRouteRequestState()},t}(nr),es=function(){function n(n,t){this.id=n;this._title=t}return n.prototype.getTitle=function(){return this._title},n.prototype.setTitle=function(n){this._title=n},n.prototype.getDescription=function(){return null},n.prototype.getMenuUrl=function(){return null},n.prototype.getAddress=function(){return null},n.prototype.getSelectedCategoryForIcon=function(){return this._selectedCategoryForIcon},n.prototype.setSelectedCategoryForIcon=function(n){this._selectedCategoryForIcon=n},n.prototype.getSearchCategory=function(){return this._searchCategory},n.prototype.setSearchCategory=function(n){this._searchCategory=n},n}(),os=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u,u)||this}return o(t,n),t}(nr);f.DataHandlerKeys=w;f.GlobalDataEventHandler=g;f.HomeOrWorkEnabledLocalSearchEntity=fs;f.ImageFromCssHelper=to;f.ListDataSource=uo;f.LocalSearchEntity=nr;f.NavigationBarOverlay=vo;f.TaskTypes=s;i._HashBasedHistory=ui;i._HistoryWrapper=hu;i._OverlayDataEntityAction=yr;i._OverlayEntity=gu;i._OverlayManager=nf;i.AerialBirdsEyeTransitionManager=lo;i.BrowserHistoryManager=no;i.BrowserKeyProvider=ae;i.BrowserPointerProvider=ye;i.CityPolygonManager=pe;i.DefaultPrimitiveCriteria=gi;i.GeochainControl=hr;i.GeochainOverlay=bo;i.Geocoder=be;i.GeolocationProvider=ou;i.LandmarksManager=ro;i.LocalSearchEntity=nr;i.MapInteraction=so;i.MapInteractionBehavior=ho;i.MapModeStateHistory=co;i.NavigationBar=bu;i.NavigationHelper=ti;i.OverlayManager=nf;i.Permalink=ge;i.PrintContent=go;i.PushpinIconType=oi;i.ReverseGeocoder=ns;i.GeochainManager=we;i.RoutePolyline=tf;i.RoutePushpin=rf;i.SharingInstrumentationAction=ot;i.TrafficToggleButton=ar;i.TransitLandmarkOverlayTemplate=eu;i.CameraMiniOverlayTemplate='<div class="infoboxOverlay trafficMiniInfobox">    <TextBlock Text="{Binding primitive.entity.trafficDescription}" /><\/div>';i._StreetsideAutoEntryBehavior=rs;i._StreetsideBubblePickerOverlay=ef;i._StreetsideCoverageBehavior=oo;i._StreetsideDirectionsBootstrapper=ts;i._StreetsideDirectionsOverlay=ff;i._StreetsideLocalDetailsBootstrapper=is;i._StreetsideLoggerConstants=v;i._StreetsideMiniBootstrapper=kr;i._StreetsideModeBootstrapper=de;i._StreetsidePerfConstants=kt;yt.CollectionActions=ci;yt.Waypoint=pr;yt.DistanceUnit=wr;yt.Optimize=br;yt.RecommendationEntity=es;yt.TimeTypes=ki;yt.DirectionsMode=ei;yt.TravelAttractionEntity=os;i._TaskDataHandlerHelper=di}catch(of){if(f.logger)f.logger.logCriticalError(of);else throw of;}}).call(window)