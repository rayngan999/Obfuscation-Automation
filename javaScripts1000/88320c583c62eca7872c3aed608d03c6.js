"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();!function(){function e(e){window.requestNextAnimationFrame=function(){var e=undefined,t=undefined,n=(undefined,navigator.userAgent),o=0,r=this;return window.webkitRequestAnimationFrame&&(t=function(e){e===undefined&&(e=+new Date),r.callback(e)},e=window.webkitRequestAnimationFrame,window.webkitRequestAnimationFrame=function(n,o){r.callback=n,e(t,o)}),window.mozRequestAnimationFrame&&(o=n.indexOf("rv:"),-1!=n.indexOf("Gecko")&&"2.0"===n.substr(o+3,3)&&(window.mozRequestAnimationFrame=undefined)),window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){var n=void 0,o=void 0;window.setTimeout(function(){n=+new Date,e(n),o=+new Date,r.timeout=1e3/60-(o-n)},r.timeout)}}(),window.requestNextAnimationFrame(e)}function t(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n)}function n(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent&&e.detachEvent("on"+t,n)}function o(e){function t(e){function t(){n||(e(),n=!0)}var n=!1,o=document;if(o.addEventListener)o.addEventListener("DOMContentLoaded",t,!1);else if(o.attachEvent){var r=!1;try{r=null!==window.frameElement}catch(i){}o.documentElement.doScroll&&!r&&function e(){if(!n)try{o.documentElement.doScroll("left"),t()}catch(i){setTimeout(e,10)}}(),o.attachEvent("onreadystatechange",function(){"complete"===o.readyState&&t()})}}e&&!e.ready&&(e.ready=t)}function r(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"}function i(e){return[].slice.call(e)}function a(e,t){var n=e.getBoundingClientRect();return!(!n.width&&!n.height||n.top-window.innerHeight>=t||n.bottom+t<=0||n.right<=0||n.left-window.innerWidth>=0)}function u(e){var t=void 0;return t=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,"none"===t.display||"0px"===t.height&&"0px"===t.width}function d(e){if(!e||!e.length)return console&&console.error("targets is invaild...");if(e&&1===e.length)return e[0].mods;var t=void 0;e.map(function(e){"sort"===e.type&&(t=e)}),t||(t=e[0]);var n=e.indexOf(t);e.splice(n,1);for(var o=t.mods.slice(),r=function(t){var n=o[t],r=!1;e.map(function(e){e.mods.map(function(e){n.moduleId===e.moduleId&&(r=!0)})}),r||o.splice(t,1)},i=o.length-1;i>=0;i--)r(i);return o}function c(){return location.href.indexOf("wh_debugloader")>0&&location.href.indexOf("?")>0}function l(){var e=navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/),t=!1;return e&&e[1]&&("6.0"==e[1]||"7.0"==e[1])&&(t=!0),t}function s(){var e=void 0;try{var t=document.getElementById("J_floorSortCfg").value;e=JSON.parse(t)}catch(n){e={"enable":!1}}return e}function f(){var e=void 0;try{var t=document.getElementById("J_modsAreaCfg").value;e=JSON.parse(t)}catch(n){e={"enable":!1}}return e}function m(e){return((window.$zebra||{}).components||[]).filter(function(t){return t.moduleId===e})[0]||{}}function v(){var e=void 0;try{var t=document.getElementById("J_modsJuCubeCfg").value;e=JSON.parse(t)}catch(n){e={"enable":!1}}return e}function w(){var e=void 0;try{var t=document.getElementById("J_modsJupSortCfg").value;e=JSON.parse(t)}catch(n){e={"enable":!1}}return e}function g(e,t){for(var n=e,o=[],r=0,i=n.length;r<i;r++)o.push(n[r].mod);O(o,function(){for(var e=Array.prototype.slice.call(arguments),t=void 0,o=void 0,r=0,i=e.length;r<i;r++)if(t=e[r],o=n[r],M.isTypeOf("Function",t)&&!o.isRax)if(M.isDebug())t(o.el,o.cfg,o);else try{t(o.el,o.cfg,o)}catch(a){console&&console.error(a)}else z(t,o)},function(e){y(n,t)})}function y(e,t){for(var n=function(t,n){var o=e[t];O(o.mod,function(e){M.getModuleMetaInfoById(o.moduleId);if(M.isTypeOf("Function",e))try{e(o.el,o.cfg,o)}catch(t){console.error&&console.error(t)}else M.isTypeOf("Object",e)&&moduleInfo.isRax&&z(e,o)},function(e){h(o.mod+"\u7ec4\u4ef6\u81ea\u8eab\u811a\u672c\u6216\u8005require\u4f9d\u8d56\u8d44\u6e90\u4e0d\u5b58\u5728\uff0c\u4e3a\u4e86\u907f\u514d\u95ee\u9898\u5f53\u524d\u8282\u70b9\u5df2\u9690\u85cf",e),o.el&&(o.el.style.display="none")})},o=0,r=e.length;o<r;o++)n(o,r)}function h(e,t){e="string"==typeof e?e:"\u6709\u7ec4\u4ef6\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u52a0\u8f7d",console&&console.error(e)}function p(e,t){e=e||[],t=t||{},g(e,t)}function b(e,t){var n=0;if(!T){T=!0;for(var o=0,r=e.length;o<r;o++)n=r-o-1,L.isInViewport(e[n].el,$)&&(J.push(e[n]),e.splice(n,1),E(t));T=!1,e.length||B.removeEvent(window,"scroll",b)}}function E(e){for(var t=void 0;t=J.shift();)!function(e){function t(t){L.getModuleMetaInfoById(e.moduleId);if(L.isTypeOf("Function",t)&&!moduleInfo.isRax)try{t(e.el,e.cfg,e)}catch(n){console.error&&console.error(n)}else R(t,e)}function n(e){}F(function(){setTimeout(function(){N(e.mod,t,n)},15)})}(t)}function A(e,t){function n(){if(!modBukets.async.length)return o&&clearTimeout(o),r&&clearInterval(r),void B.removeEvent(window,"scroll",n);b(t),o&&clearTimeout(o),r&&clearInterval(r),r=setInterval(function(){b(t)},300),o=setTimeout(function(){r&&clearInterval(r)},3e3)}var o=null,r=null;e=e||[],t=t||{},window.CustomEvent&&window.dispatchEvent?(window.$zebraLoader||(window.$zebraLoader={}),window.$zebraLoader.trigger=function(e){var t=new CustomEvent(e);window.dispatchEvent(t)}):console.warn("not support CustomEvent yet"),B.bindEvent(window,"zebraLoader.async",function(){b(t)}),b(t),B.bindEvent(window,"load",function(){b(t)}),B.bindEvent(window,"scroll",n)}function I(){(new V).bootstrap()}var x={"bindEvent":t,"removeEvent":n},C={"isTypeOf":r,"toArray":i,"isInViewport":a,"isHiddenMod":u,"isDebug":c,"isLteIE7":l,"modIntersection":d,"parseRecommend":s,"parseAreaCfg":f,"getModuleMetaInfoById":m,"parseJuCubeCfg":v,"parseJupSortCfg":w},k=window.require,S=function(e,t){e=e||[],t=t||{},window.$zebra=window.$zebra||{},k("rax",function(n){var o=n.createElement;(0,n.render)(o(e,{"data":t.data||{},"theme":t.theme||{},"config":t.config||{},"pageConfig":$zebra.pageConfig||{},"systemConfig":$zebra.systemConfig||{}}),t.el)})},q={"raf":e,"event":x,"raxLoad":S,"tools":C,"ready":o},M=q.tools,z=q.raxLoad,O=window.require,F=q.raf,B=q.event,L=q.tools,R=q.raxLoad,T=!1,J=[],$=window.$zebra&&window.$zebra.diff||50,N=window.require,D=window.$zebra||{},_=function(e){e&&e.sync&&e.async&&("asynk"==D.loadType?A(e.sync):(e.sync=e.sync.concat(e.async),e.async=[],p(e.sync)))},W=window.document,j=q.tools,V=function(){function e(t){_classCallCheck(this,e),this.ctx={},this.ctx.diff=t||50,this.ctx.modBuckets={"async":[],"sync":[],"raxMods":[],"ignore":[]},this.init()}return _createClass(e,[{"key":"init","value":function(){var e=this.ctx;e.loaderMod=_,e.usedList=[],e.loader=feloader||KISSY}},{"key":"getWrapperFrom","value":function(e){if(e.getAttribute("data-module-id"))return e;for(var t=e.parentElement;t&&!t.getAttribute("data-module-id");)t=t.parentElement;return t}},{"key":"getBoxFrom","value":function(e){for(var t=e.firstElementChild;t&&!t.getAttribute("data-mod-name");)t=t.firstElementChild;return t}},{"key":"queryAllModWrappers","value":function(){var e=this.ctx,t=void 0,n=[],o=!1,r=0,i=void 0;if(W.querySelectorAll)n=W.querySelectorAll(".mui-zebra-module[data-module-id]"),t=W.querySelectorAll('div[class="mui-zebra-page"]')[0];else for(var a=W.getElementsByTagName("*"),u=0,d=a.length;u<d;u++){var c=a[u];c&&(c.getAttribute("class")||"").indexOf("mui-zebra-module")>-1&&c.getAttribute("data-module-id")?n.push(c):c&&(c.getAttribute("class")||"").indexOf("mui-zebra-page")>-1&&(t=c)}n=j.toArray(n);for(var l=0,s=n.length;l<s;l++){o=n[l].parentElement===t,o&&i===undefined&&(i=l),o&&r++}e.firstPureModuleIndex=i,e.pureModuleCount=r,e.modContainer=t}},{"key":"queryAllInitMods","value":function(){var e=this.ctx,t=[];if(W.querySelectorAll)t=W.querySelectorAll("[data-mod-name]");else for(var n=W.getElementsByTagName("*"),o=0,r=n.length;o<r;o++){var i=n[o];i&&i.getAttribute("data-mod-name")&&t.push(i)}e.zebraModules=t}},{"key":"bucketingMods","value":function(){function e(e){u=e.getAttribute("data-mod-name"),d="true"==e.getAttribute("data-rax");var t=c.getWrapperFrom(e),n=t&&t.getAttribute("data-module-id"),l=j.getModuleMetaInfoById(n);if(u){if(i=e.getAttribute("data-zebra-load")||e.getAttribute("data-async-load"),a={"mod":u,"el":e,"moduleId":n||"","cfg":e.getAttribute("data-config"),"data":c.getData(e)||{},"config":l.config||{},"theme":l.meta||{},"isRax":d},!i||j.isHiddenMod(e))return void o.sync.push(a);"ignore"===i?o.ignore.push(a):"true"===i||"async"===i||!j.isInViewport(e,r)&&"sync"!==i&&"false"!==i?o.async.push(a):("sync"===i||j.isInViewport(e,r))&&o.sync.push(a)}}for(var t=this.ctx,n=t.zebraModules,o=t.modBuckets,r=t.diff,i=void 0,a=void 0,u=void 0,d=void 0,c=this,l=0,s=n.length;l<s;l++)e(n[l]);this.lodeScript()}},{"key":"getData","value":function(e){var t=e.getElementsByClassName("rax-comp-data")[0];return t=t&&t.value?JSON.parse(t.value):{}}},{"key":"lodeScript","value":function(){var e=this.ctx,t=e.loaderMod,n=e.modBuckets;j.isDebug()&&console&&console.info(this.ctx),t(n)}},{"key":"bootstrap","value":function(){this.queryAllModWrappers(),this.queryAllInitMods(),this.bucketingMods()}}]),e}(),H=window.feloader||window.KISSY;q.ready(H),H.ready(I)}();