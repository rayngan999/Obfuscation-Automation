!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return(u=a()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function s(e){var t="function"==typeof Map?new Map:void 0;return(s=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,i(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),o(r,e)})(e)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){var t=a();return function(){var n,r=i(e);if(t){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=function(t){r(i,t);var n=f(i);function i(){return e(this,i),n.apply(this,arguments)}return i}(s(Error)),y=function(t){r(i,t);var n=f(i);function i(){return e(this,i),n.apply(this,arguments)}return i}(s(Error)),g=function(t){r(i,t);var n=f(i);function i(){return e(this,i),n.apply(this,arguments)}return i}(s(Error)),w=function(t){r(i,t);var n=f(i);function i(){return e(this,i),n.apply(this,arguments)}return i}(g),b=function(t){r(i,t);var n=f(i);function i(){return e(this,i),n.apply(this,arguments)}return i}(g),_=function(t){r(i,t);var n=f(i);function i(){return e(this,i),n.apply(this,arguments)}return i}(b);function S(e){if(!Array.isArray(e))throw new y("Provided argument must be an instance of Array.")}function j(e){return!!Array.isArray(e)&&e.every((function(e){return"number"==typeof e}))}function A(e){return 1/(1+Math.exp(-e))}var O=function(){function t(n){e(this,t),this.feature=n}return n(t,[{key:"transform",value:function(e){if(!(this.feature in e))throw new _("Unable to transform feature ".concat(this.feature,", missing input ").concat(this.feature,". \n                    Provided: ").concat(Object.keys(e),", Required: ").concat(this.dependencies));return e[this.feature]}},{key:"dependencies",get:function(){return[this.feature]}}]),t}(),k=function(t){r(o,t);var i=f(o);function o(t,n){var r;return e(this,o),(r=i.call(this,t)).interactions=n,r}return n(o,[{key:"transform",value:function(e){for(var t=this,n=this.interactions.map((function(n){if(!(n in e))throw new _("Unable to transform feature ".concat(t.feature,", missing input ").concat(n,".\n                    Provided: ").concat(Object.keys(e),", Required: ").concat(t.dependencies));return e[n]})).sort((function(e,t){return t.length-e.length})),r=0;r<n.length-1;r++){if(1!==n[r].length&&n[r].length!==n[r+1].length&&1!==n[r+1].length)throw new _("Unable to perform MultiplicativeInteraction: shapes can not be broadcasted.");if(!j(n[r]))throw new _("Unable to perform MultiplicativeInteraction: not all inputs are of type number[]")}for(var i=h(n[0]),o=1;o<n.length;o++)for(var a=0;a<i.length;a++)n[o].length>1?i[a]=i[a]*n[o][a]:i[a]=i[a]*n[o][0];return i}},{key:"dependencies",get:function(){return this.interactions}}]),o}(O),E=function(t){r(o,t);var i=f(o);function o(t,n,r){var a;return e(this,o),(a=i.call(this,t)).input=n,a.value=r,a}return n(o,[{key:"transform",value:function(e){if(!(this.input in e))throw new _("Unable to transform feature '".concat(this.feature,"'. Missing required input '").concat(this.input,"'."));var t=e[this.input];if(t.length!==this.value.length)return[0];for(var n=0;n<t.length;n++)if(t[n]!==this.value[n])return[0];return[1]}},{key:"dependencies",get:function(){return[this.input]}}]),o}(O),R=function(t){r(o,t);var i=f(o);function o(t,n,r,a){var u;return e(this,o),(u=i.call(this,t)).input=n,u.min=r,u.max=a,u}return n(o,[{key:"transform",value:function(e){if(!(this.input in e))throw new _("Unable to transform feature '".concat(this.feature,"'. Missing required input '").concat(this.input,"'."));for(var t=h(e[this.input]),n=0;n<t.length;n++)this.min&&t[n]<this.min?t[n]=this.min:this.max&&t[n]>this.max&&(t[n]=this.max);return t}},{key:"dependencies",get:function(){return[this.input]}}]),o}(O),C=function(t){r(o,t);var i=f(o);function o(t,n,r,a){var u;return e(this,o),(u=i.call(this,t)).input=n,u.min=r,u.scale=a,u}return n(o,[{key:"transform",value:function(e){if(!(this.input in e))throw new _("Unable to transform feature '".concat(this.feature,"'. Missing required input '").concat(this.input,"'."));var t=e[this.input];if(t.length!==this.min.length||t.length!==this.scale.length)throw new _("Unable to transform feature '".concat(this.feature,"'. Shapes do not match."));if(!j(t))throw new _("Unable to transform feature '".concat(this.feature,"'. The input must be an array of numbers."));for(var n=new Array(t.length),r=0;r<t.length;r++)n[r]=this.scale[r]*t[r]+this.min[r];return n}},{key:"dependencies",get:function(){return[this.input]}}]),o}(O);function P(e){return"type"in e&&"string"==typeof e.type}function I(e){if(!e.transformation)return new O(e.name);if(P(t=e.transformation)&&"multiplication"===t.type)return new k(e.name,e.transformation.features);var t;if(function(e){return P(e)&&"equality"===e.type}(e.transformation))return new E(e.name,e.transformation.input,e.transformation.value);if(function(e){return P(e)&&"clipping"===e.type}(e.transformation))return new R(e.name,e.transformation.input,e.transformation.min,e.transformation.max);if(function(e){return P(e)&&"minmax_scaling"==e.type}(e.transformation))return new C(e.name,e.transformation.input,e.transformation.min,e.transformation.scale);throw new w("Selected transformation (".concat(e.transformation.type,") is not supported."))}var T=function(){function t(n,r,i){e(this,t),this.name=n,this.transformer=r,this.index=i}return n(t,[{key:"dependencies",get:function(){return this.transformer.dependencies}}]),t}();function x(e){var t=e.features;return S(t),t.map((function(t,n){return e.model.features&&(n=e.model.features.indexOf(t.name)),new T(t.name,I(t),n)}))}var M=function(){function t(n,r){e(this,t),this.features=r,this.measurements=n}return n(t,[{key:"_getFeatureValue",value:function(e,t,n){var r=this;if(e.name in n)return n[e.name];if(1===e.dependencies.length&&e.dependencies[0]===e.name){var i=this.measurements.get(e.name,t);return n[e.name]=[i],n[e.name]=e.transformer.transform(n),n[e.name]}return e.dependencies.forEach((function(i){var o=r.features.find((function(e){return e.name===i}));if(!o)throw new b("Feature '".concat(e.name,"' is dependent on ").concat(i,", but this feature has not been defined!"));if(o.transformer.dependencies.includes(e.name))throw new b("IllegalDependency: Feature '".concat(e.name,"' is dependent on ").concat(i,"', but '").concat(i," is also dependent on '").concat(e.name,"'!"));r._getFeatureValue(o,t,n)})),n[e.name]=e.transformer.transform(n),n[e.name]}},{key:"get",value:function(e){var t=this,n={},r={};return this.features.forEach((function(i){-1!==i.index&&(n[i.name]=t._getFeatureValue(i,e,r))})),n}}]),t}(),q=Object.freeze({LOGISTIC_REGRESSION:"logistic_regression",PASSTHROUGH:"passthrough"});function F(e){if(!e.model_id)throw new w("Could not load model: missing required value model_id");if(!e.definition)throw new w("Could not load model: missing required definition");var t,n,r,i,o,a=JSON.parse(e.definition);if(!a.model)throw new w("Could not load model: missing required field 'model' in the model definition.");if(!a.features)throw new w("Could not load model: missing required feature definitions.");return a.model.type===q.PASSTHROUGH?(n=a,r=e.model_id,o=x(n),t=new V(r,o,null!==(i=n.version)&&void 0!==i?i:"")):t=function(e,t){var n;if(e.model.type!==q.LOGISTIC_REGRESSION)throw new w("Could not load model with unsupported type: ".concat(e.model.type));var r=x(e),i=function(e){if(!function(e){var t=e;return"logistic_regression"===(null==t?void 0:t.type)&&j(null==t?void 0:t.weights)&&"number"==typeof(null==t?void 0:t.bias)}(e))throw new w("Received invalid model configuration: the provided config is not a LogisticRegressionConfig");return new U(e.weights,e.bias)}(e.model);return new L(t,r,i,null!==(n=e.version)&&void 0!==n?n:"")}(a,e.model_id),!t.version&&e.version&&(t.version=e.version),t}var U=function(){function t(n,r){if(e(this,t),!j(n))throw new g("Weights must be provided as an Array.");this.weights=n,this.bias=r}return n(t,[{key:"predict",value:function(e){if(!(e instanceof Array))throw new b("FeatureProcessor must be provided as an Array.");var t=function(e){if("number"==typeof e)return A(e);S(e);for(var t=[],n=0;n<e.length;n++)t.push(A(e[n]));return t}(function(e,t){if(S(e),S(t),e.length!==t.length)throw new v("Vectors must have equal length (".concat(e.length," != ").concat(t.length,")"));for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}(e,this.weights)+this.bias);return[1-t,t]}}]),t}(),D=function(){function t(n,r,i){e(this,t),S(r),this.featureColumns=r,this.modelId=n,this.version=i}return n(t,[{key:"getFeatures",value:function(e,t){return new M(e,this.featureColumns).get(t)}}]),t}(),L=function(t){r(o,t);var i=f(o);function o(t,n,r,a){var u;if(e(this,o),u=i.call(this,t,n,a),!(r instanceof U))throw new g("logisticRegression must be an instanceof LogisticRegression");return u.logisticRegression=r,u}return n(o,[{key:"predict",value:function(e){var t=[];return this.featureColumns.reduce((function(e,t){return-1!==t.index&&e.push(t),e}),[]).sort((function(e,t){return e.index-t.index})).forEach((function(n){if(!(n.name in e))throw new b("Missing required feature: ".concat(n.name));t=t.concat(e[n.name])})),this.logisticRegression.predict(t)[1]}}]),o}(D),V=function(t){r(a,t);var o=f(a);function a(t,n,r){return e(this,a),o.call(this,t,n,r)}return n(a,[{key:"getFeatures",value:function(e,t){var n,r,o,u;try{n=l(i(a.prototype),"getFeatures",this).call(this,e,t)}catch(e){var s=this.passthroughFeatureColumn;r={},o=s.name,u=[-1],o in r?Object.defineProperty(r,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[o]=u,n=r}return n}},{key:"predict",value:function(e){var t=this.passthroughFeatureColumn;return t.name in e||(e[t.name]=[-1]),e[t.name][0]}},{key:"passthroughFeatureColumn",get:function(){if(void 0!==this._passthroughFeatureColumn)return this._passthroughFeatureColumn;var e=this.featureColumns.reduce((function(e,t){return-1!==t.index&&e.push(t),e}),[]).sort((function(e,t){return e.index-t.index}));if(e.length<1)throw new b("Could not determine passthrough feature column: model definition is invalid");if(e.length>1)throw new b("Could not determine passthrough feature column: multiple columns were provided");return this._passthroughFeatureColumn=e[0],this._passthroughFeatureColumn}}]),a}(D),G=function(){function t(n){var r=this;e(this,t),this.playSessionSequence=0,this.advanceType="unknown",n.on("playlistItem",(function(){r.playSessionSequence||(r.playSessionSequence=0),r.playSessionSequence++})),n.on("nextAutoAdvance",(function(){r.advanceType="auto"})),n.on("feedAutoAdvance",(function(){r.advanceType="auto"})),n.on("nextClick",(function(){r.advanceType="click"})),n.on("feedClick",(function(){r.advanceType="click"}))}return n(t,[{key:"getPlaySessionSequence",value:function(){return this.playSessionSequence||0}},{key:"getAdvanceType",value:function(){return this.advanceType}}]),t}(),N={viewable:2},H=function(){function t(n,r,i){e(this,t),this.PLAYER_MEASUREMENT_MAP={is_player_viewable_at_inference_time:n.getViewable,is_player_viewable:n.getViewable,is_player_muted:n.getMute,play_session_sequence:r.getPlaySessionSequence,autostart:function(){var e=n.getConfig();return e.autostart&&e.autostart in N?N[e.autostart]:e.autostart?1:0},advance_type:r.getAdvanceType},this.metrics=i}return n(t,[{key:"get",value:function(e,t){if(e in this.PLAYER_MEASUREMENT_MAP)return this.PLAYER_MEASUREMENT_MAP[e]();var n=t&&"mediaid"in t?t.mediaid:null;if(n&&n in this.metrics.media&&e in this.metrics.media[n])return this.metrics.media[n][e];if(this.metrics.domain&&e in this.metrics.domain)return this.metrics.domain[e];if(this.metrics.defaults&&e in this.metrics.defaults)return this.metrics.defaults[e];throw new b("Unsupported measurement: ".concat(e))}}]),t}(),z=function t(n){var r,i,o,a,u,s,c=this;e(this,t),this.domain={},this.media={},this.defaults={},(null===(i=null===(r=null==n?void 0:n.jwpseg)||void 0===r?void 0:r.metrics)||void 0===i?void 0:i.domain)&&(this.domain=null==n?void 0:n.jwpseg.metrics.domain),(null===(a=null===(o=null==n?void 0:n.jwpseg)||void 0===o?void 0:o.metrics)||void 0===a?void 0:a.defaults)&&(this.defaults=null==n?void 0:n.jwpseg.metrics.defaults),(null===(s=null===(u=null==n?void 0:n.jwpseg)||void 0===u?void 0:u.metrics)||void 0===s?void 0:s.media)&&Object.keys(null==n?void 0:n.jwpseg.metrics.media).forEach((function(e){var t,r,i,o;c.media[e]=null!==(o=null===(i=null===(r=null===(t=null==n?void 0:n.jwpseg)||void 0===t?void 0:t.metrics)||void 0===r?void 0:r.media)||void 0===i?void 0:i[e])&&void 0!==o?o:{}}))};(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)("inference","7.0",(function(e,t,n){var r,i,o,a,u=!1,s=new G(e);function c(){var t,n;if(!u){if(!r||!i){if(!(i=e.getPlaylist())||"string"==typeof i)return void(u=!1);var c=e.getPlaylistItem();if(!c||!c.feedData)return;r=null!==(t=c.feedData)&&void 0!==t?t:{}}if(null===(n=null==r?void 0:r.jwpseg)||void 0===n?void 0:n.parameters){try{o=Object.entries(r.jwpseg.parameters).reduce((function(e,t){var n,r=d(t,2),i=r[0],o=r[1];return e[i]=(n=o,Array.isArray(n)?n.map(F):[F(n)]),e}),{})}catch(e){return console.warn("Failed to initialize the inference plugin: ".concat(e)),void f()}a=new H(e,s,new z(r)),u=!0}else f()}}function f(){r=null,i=null,o=null,a=null,u=!1}function l(e,t,n){var r={processed:e.join(",")};return t&&t.jwpseg&&Array.isArray(t.jwpseg)&&(r.historicalApproved=t.jwpseg.join(",")),n&&(r.realTimeApproved=Object.keys(n).filter((function(e){return n[e]})).join(",")),r}return e.on("playlist",(function(e){f(),r=e.feedData,i=e.playlist,c()})),c(),{predict:function(t,n){var i;if(!u||!a)throw new b("The InferencePlugin has not been initialized.");var s=null===(i=null==r?void 0:r.jwpseg)||void 0===i?void 0:i.target_profiles;if(!s)throw new b("Feed did not contain targeting profiles!");var c={},f={};return t.forEach((function(t){var r=null==s?void 0:s[t];if(!r)throw new b("The segment ".concat(t," does not have any targeting criteria defined."));f[t]=Object.keys(r).every((function(t){if(t in c)return c[t].prediction>r[t];var i=function(t){var n,r,i,a=e.getConfig().__ab_inference;if(null===(n=null==a?void 0:a.modelMap)||void 0===n?void 0:n[t]){var u=a.modelMap[t];i=null==o?void 0:o[t].find((function(e){return e.modelId===u}))}else{var s=null!==(r=null==o?void 0:o[t])&&void 0!==r?r:[],c=s.map((function(e){return e.modelId}));c.sort((function(e,t){return e.localeCompare(t)})),i=s.find((function(e){return e.modelId===c[0]}))}if(!i)throw new b("Could not make predictions for target '".concat(t,"': no model available to support the request."));return i}(t),u=i.getFeatures(a,n);return c[t]={modelVersion:i.version,prediction:i.predict(u),modelId:i.modelId},c[t].prediction>r[t]}))})),e.trigger("inference",{predictions:c,playlistItem:n,segments:l(t,n,f)}),f},version:"0.6.0"}}))}();
