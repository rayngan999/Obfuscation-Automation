define(['module.base','defaults','carousels_light','session'],function(Module,defaults,carousels_light,_session){Module.Gallery=function(){var self=this;self.tpl_main='gal';self.tpl=window.templates;self.update=function(data){self.render(data);};self.init=function(elm){elm=$('#data_latest');self.element(elm);$('#gal_loading').show();lat="";long="";ugc_channel="";ugc_collection="";opt_channel_transcoder=null;opt_collection_transcoder=null;ugc_time_limit="";use_lat_long=true;country_code="";lbl_local="Local";lbl_latest="Latest";txt_no_image_found="No Photo Found.";search_radius=null;ugc_sort_by="";if(typeof window._config.lat!='undefined'&&window._config.lat!=null&&typeof window._config.lng!='undefined')
{if(window._config.lat!=63.219233647759&&window._config.lng!=-101.97052754586)
{lat=window._config.lat;long=window._config.lng;if(window._config.country_code){country_code=window._config.country_code;}}}
if(typeof window._config.ugc_collection!='undefined'&&window._config.ugc_collection!==""&&window._config.ugc_collection!=null){ugc_collection=window._config.ugc_collection;}
if(typeof window._config.ugc_channel!='undefined'&&window._config.ugc_channel!==""&&window._config.ugc_channel!=null){ugc_channel=window._config.ugc_channel;}
if(typeof window._config.lbl_local!='undefined'&&window._config.lbl_local!==""&&window._config.lbl_local!=null){lbl_local=window._config.lbl_local;}
if(typeof window._config.lbl_latest!='undefined'&&window._config.lbl_latest!==""&&window._config.lbl_latest!=null){lbl_latest=window._config.lbl_latest;}
if(typeof window._config.txt_no_image_found!='undefined'&&window._config.txt_no_image_found!==""&&window._config.txt_no_image_found!=null){txt_no_image_found=window._config.txt_no_image_found;}
if(typeof window._config.ugc_time_limit!='undefined'&&window._config.ugc_time_limit!==""&&window._config.ugc_time_limit!=null){ugc_time_limit=window._config.ugc_time_limit;}
if(typeof window._config.use_lat_long!='undefined'&&window._config.use_lat_long!==""&&window._config.use_lat_long!=null){use_lat_long=window._config.use_lat_long;}
if(typeof window._config.opt_channel_transcoder!='undefined'&&window._config.opt_channel_transcoder!==""&&window._config.opt_channel_transcoder!=null){opt_channel_transcoder=window._config.opt_channel_transcoder;}
if(typeof window._config.opt_collection_transcoder!='undefined'&&window._config.opt_collection_transcoder!==""&&window._config.opt_collection_transcoder!=null){opt_collection_transcoder=window._config.opt_collection_transcoder;}
if(typeof window._config.search_radius!='undefined'&&window._config.search_radius!==""&&window._config.search_radius!=null){search_radius=window._config.search_radius;}
if(typeof window._config.ugc_sort_by!='undefined'&&window._config.ugc_sort_by!==""&&window._config.ugc_sort_by!=null){ugc_sort_by=window._config.ugc_sort_by;}
var val=_session.fld('pelm_gal');if(location.href.indexOf('lightning')>-1){val="pop";}
if(window._config.widget_hide_nav&&window._config.widget_hide_nav==true){val="local";}
var hdts75=1858,hdts100=1856,hdtm75=1860,hdtm100=1862,spt,indx,v,hdr,q='';var bdy=document.getElementsByTagName('body')[0];if(bdy.className.indexOf('res-')!==-1&&(bdy.className.indexOf('100')!==-1||bdy.className.indexOf('75')!==-1)){spt=bdy.className.split(' ');for(indx=0;indx<spt.length;indx++){v=spt[indx];if(v.indexOf('res-')!==-1){hdr=v.substring(v.indexOf('res-')+4);break;}}}
var format_data="&formatdata=3,2,3,1";var query_data="collection="+ugc_collection+format_data;if(typeof lat!='undefined'&&lat!=""&&typeof long!='undefined'&&long!=""&&use_lat_long==true){query_data="lat="+lat+"&long="+long+"&channel="+ugc_channel+"&country_code="+country_code+"&time_limit="+ugc_time_limit+"&search_radius="+search_radius+"&ugc_sort_by="+ugc_sort_by+format_data;}
var vc_id='data_latest';__.a("/api/gallery/latest_images?"+query_data,function(data){if(data){data=$.parseJSON(data);var isEmpty=jQuery.isEmptyObject(data);if(isEmpty==true){$('#gal_loading').show();text="";__.a("/api/gallery/latest_images?collection="+ugc_collection+format_data,function(data){data=$.parseJSON(data);isEmpty=jQuery.isEmptyObject(data);$('#gal_loading').hide();if(isEmpty===false){$('#data_popular').hide();count=0;$.each(data,function(k,v){text+="<div class='col col-"+v.div_type+"'>";$.each(v.images,function(k1,v1){count++;text+="<a data-event-label='photoModule | "+v1._title+"' href='/"+window._config.url_photos+"/"+window._config.url_view+"/"+v1._seo_channel_name+"/"+v1._seo_title+"/"+v1._media_id[0]+"' title='"+v1._title+"'>";if(hdr){if(parseInt(v1._transcoder)==1437||v1.transcoder=='1437'){v1._transcoder=(hdr==100)?hdts100:hdts75;}else if(parseInt(v1._transcoder)==1439||v1._transcoder=='1439'){v1._transcoder=(hdr==100)?hdtm100:hdtm75;}}
var gal_ch_transcoder=v1._transcoder;if(opt_channel_transcoder!=null){gal_ch_transcoder=opt_channel_transcoder;}
if(count>15)
text+="<img src='"+window._config.image_url+"spacer.gif' data-img='"+v1._public_url+"/"+gal_ch_transcoder+"' alt='"+v1._title+"' height='"+v1._dimension.height+"' width='"+v1._dimension.width+"' />";else
text+="<img src='"+v1._public_url+"/"+gal_ch_transcoder+"' alt='"+v1._title+"' height='"+v1._dimension.height+"' width='"+v1._dimension.width+"' />";text+="</a>";});text+="</div>";});$('#data_latest').html(text).show();$("#most-viewed").css("left",0);$('.gallery-wrap').removeClass("no-photos");}else{$('.gallery-wrap').addClass("no-photos");}});}else if(isEmpty==false){$('#data_popular').hide();text="";count=0;$.each(data,function(k,v){text+="<div class='col col-"+v.div_type+"'>";$.each(v.images,function(k1,v1){count++;text+="<a data-event-label='photoModule | "+v1._title+"' href='/"+window._config.url_photos+"/"+window._config.url_view+"/"+v1._seo_channel_name+"/"+v1._seo_title+"/"+v1._media_id[0]+"' title='"+v1._title+"'>";if(hdr){if(parseInt(v1._transcoder)==1437||v1.transcoder=='1437'){v1._transcoder=(hdr==100)?hdts100:hdts75;}else if(parseInt(v1._transcoder)==1439||v1._transcoder=='1439'){v1._transcoder=(hdr==100)?hdtm100:hdtm75;}}
var gal_ch_transcoder=v1._transcoder;if(opt_channel_transcoder!=null){gal_ch_transcoder=opt_channel_transcoder;}
if(count>15)
text+="<img src='"+window._config.image_url+"spacer.gif' data-img='"+v1._public_url+"/"+gal_ch_transcoder+"' alt='"+v1._title+"' height='"+v1._dimension.height+"' width='"+v1._dimension.width+"' />";else
text+="<img src='"+v1._public_url+"/"+gal_ch_transcoder+"' alt='"+v1._title+"' height='"+v1._dimension.height+"' width='"+v1._dimension.width+"' />";text+="</a>";});text+="</div>";});$('#data_latest').html(text);$('#gal_loading').hide();$("#most-viewed").css("left",0);$('#data_latest').show();$('.gallery-wrap').removeClass("no-photos");}
var lightslider_options={paginationContainer:'gallery_pagination',displaySlideQty:4,movetoleft:630,pageWidth:630}
var initLightSlider=function(){if($('#'+vc_id).children().length>0){carousels_light.bind(vc_id,lightslider_options);}else{setTimeout(function(){initLightSlider();},1000);}};initLightSlider();}},function(){});};};return Module.factory('Gallery');});;