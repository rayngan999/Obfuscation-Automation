!function(f){if(0!==f.length){function u(e,t,r,a,n){n.preventDefault();var u=t.value;if(0!==u.length){var o=u.split(".").reduce(function(e,t){return t.length&&e.push(t),e},[]);if(o.shift().length<3)return!1;if(0===o.length){var s=t.getAttribute("data-default-suffix");null!=s&&(u=u.replace(/\.+$/,"")+s)}var i={};f.forEach(function(e){i[e]="registrar,local"}),function(e,t,r){var a=appState.rest.root+"/domain-search/start/",n=[];if(0===_.size(t))return Promise.reject(new Error("No suffixes provided"));_.each(t,function(e,t){isNaN(t)?n.push({suffix:t,quality:e}):n.push({suffix:e,quality:"registrar,dns,local"})}),e=(e=(e=e.toLowerCase()).replace(/^(https?:\/\/)?(www\.)?/,"")).replace(/[^a-z0-9_.-]/,"");var u=a+encodeURIComponent(e);!0===r&&(u+="?autoSearchPrimarySuffix=1");var o=_.extend({},{headers:{"X-APIKEY":appState.rest.key,"X-APITIME":(new Date).getTime(),"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},url:u,data:JSON.stringify({suffixes:n})});return c(o).then(function(e){try{e=JSON.parse(e)}catch(e){throw new Error("Result error: malformed preheat result returned")}if(_.has(e,"domain"))return{domain:e.domain,suffix:e.suffix};throw new Error("Result error: no preheat result returned")})}(u,i,!0).then(function(e){a.value=e.suffix,t.value=e.domain,r.value="preheat-"+Math.floor(Date.now()/1e3)}).catch(function(e){console.log("Preheat error")}).then(function(){e.submit()})}}var c=function(n){return window.XMLHttpRequest?new Promise(function(e,t){var r=new window.XMLHttpRequest;for(var a in r.onreadystatechange=function(){try{r.readyState===window.XMLHttpRequest.DONE&&(201===r.status?e(r.responseText):t("Request error: preheat request returned status "+r.status))}catch(e){t("Request error: preheat request returned "+e)}},r.open("POST",n.url),n.headers)r.setRequestHeader(a,n.headers[a]);r.send(n.data)}):Promise.reject(new Error("Request error: no XMLHttpRequest"))};Array.prototype.forEach.call(document.getElementsByClassName("domain-search-form"),function(e){var t=e.querySelector("input.keyword"),r=e.querySelector("input.group"),a=e.querySelector("input.suffix");if(null!=t&&null!=r){var n=t.getAttribute("data-backend");"dev"!==n&&"streaming"===n&&e.addEventListener("submit",u.bind(null,e,t,r,a))}})}}(appState.searchPreheat);