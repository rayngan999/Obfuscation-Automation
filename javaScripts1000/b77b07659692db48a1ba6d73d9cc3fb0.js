define(['lib/maps/detectizr','session'],function(detectizr,session){var mapwebglchecker=(function(){var self={},canvas=null,gl=null;self.init=function(){var disallowed_browsers=[];if(typeof window._config.use_webgl!=="undefined"&&window._config.use_webgl==1){if(window._config.locale.split('_')[1]=='gb'){return false;}
if(Detectizr.device.model=='ipad'){return false;}
for(y=0;y<disallowed_browsers.length;y++){if(disallowed_browsers[y]==Detectizr.browser.name){return false;}}
if(!!window.WebGLRenderingContext){var names=["experimental-webgl","webgl","moz-webgl","webkit-3d"];canvas=document.createElement("canvas");for(var i in names){try{gl=canvas.getContext(names[i]);if(gl&&typeof gl.getParameter=="function"){if(window._config.platform&&window._config.platform=='mobile'){if(Detectizr.device.model=='android'&&parseFloat(Detectizr.os.version)>=5){if(Detectizr.browser.name!='chrome'){self.resetcanvas();return false;}else{var regExAppleWebKit=new RegExp(/applewebkit\/([\d.]+)/);var resultAppleWebKitRegEx=regExAppleWebKit.exec(Detectizr.browser.userAgent);var appleWebKitVersion=(resultAppleWebKitRegEx===null?null:parseFloat(resultAppleWebKitRegEx[1]));var regExSamsungBrowser=new RegExp(/samsungbrowser\/([\d.]+)/);var resultSamsungBrowser=regExSamsungBrowser.exec(Detectizr.browser.userAgent);var regExSamsungBrowserVersion=(resultSamsungBrowser===null?null:parseFloat(resultSamsungBrowser[1]));var isAndroidBrowser=(appleWebKitVersion!==null&&appleWebKitVersion<537)||(Detectizr.browser.major<37)||regExSamsungBrowserVersion!=null;if(isAndroidBrowser){self.resetcanvas();return false;}}
session.save_cookie("webglsupported",1);self.resetcanvas();return names[i];}else if((Detectizr.device.model=='iphone'||Detectizr.device.model=='ipad')&&parseFloat(Detectizr.os.version)>=7){session.save_cookie("webglsupported",1);self.resetcanvas();return names[i];}
self.resetcanvas();return false;}
session.save_cookie("webglsupported",1);self.resetcanvas();return names[i];}}catch(e){self.resetcanvas();return false;}}
self.resetcanvas();return false;}else{return false;}}
return false;};self.resetcanvas=function(){if(canvas!==null){canvas.width=canvas.width;canvas=null;}
if(gl!==null){gl=null;}};return self;});return mapwebglchecker();});;