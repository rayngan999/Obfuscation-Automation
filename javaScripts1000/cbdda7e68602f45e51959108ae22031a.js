!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=98)}([function(e,t,r){"use strict";function n(e,t){function r(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function o(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(r[n[o]]=e[n[o]]);return r}function i(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}function s(e,t){return function(r,n){t(r,n,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function a(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function u(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,u)}a((n=n.apply(e,t||[])).next())})}function c(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){a.label=r[1];break}if(6===r[0]&&a.label<s[1]){a.label=s[1],s=r;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(r);break}s[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{o=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u}function f(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function l(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function d(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}function p(e){return this instanceof p?(this.v=e,this):new p(e)}function _(e,t,r){function n(e){f[e]&&(c[e]=function(t){return new Promise(function(r,n){l.push([e,t,r,n])>1||o(e,t)})})}function o(e,t){try{i(f[e](t))}catch(e){a(l[0][3],e)}}function i(e){e.value instanceof p?Promise.resolve(e.value.v).then(s,u):a(l[0][2],e)}function s(e){o("next",e)}function u(e){o("throw",e)}function a(e,t){e(t),l.shift(),l.length&&o(l[0][0],l[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,f=r.apply(e,t||[]),l=[];return c={},n("next"),n("throw"),n("return"),c[Symbol.asyncIterator]=function(){return this},c}function v(e){function t(t,o){e[t]&&(r[t]=function(r){return(n=!n)?{value:p(e[t](r)),done:"return"===t}:o?o(r):r})}var r,n;return r={},t("next"),t("throw",function(e){throw e}),t("return"),r[Symbol.iterator]=function(){return this},r}function y(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof l?l(e):e[Symbol.iterator]()}function g(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}Object.defineProperty(t,"__esModule",{value:!0}),t.__extends=n,r.d(t,"__assign",function(){return m}),t.__rest=o,t.__decorate=i,t.__param=s,t.__metadata=u,t.__awaiter=a,t.__generator=c,t.__exportStar=f,t.__values=l,t.__read=d,t.__spread=h,t.__await=p,t.__asyncGenerator=_,t.__asyncDelegator=v,t.__asyncValues=y,t.__makeTemplateObject=g;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},m=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}},,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e){void 0===e&&(e=i.create()),this.random=e,this._byteToHex=[];for(var t=this._byteToHex,r=0;r<256;++r)t[r]=(r+256).toString(16).substr(1)}return Object.defineProperty(e,"default",{get:function(){return e._default||(e._default=new e)},enumerable:!0,configurable:!0}),e.prototype.next=function(){var e=this.random.next();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,this.bytesToUuid(e)},e.prototype.bytesToUuid=function(e){var t=0,r=this._byteToHex;return r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]},e}();t.GuidProvider=o;var i=function(){function e(){}return e.create=function(e){return void 0===e&&(e=!1),"undefined"!=typeof crypto&&crypto.getRandomValues&&!e?new s:new u},e}();t.Random=i;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.next=function(){var e=new Uint8Array(16);return crypto.getRandomValues(e),e},t}(i);t.CryptoRandom=s;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._rnds=new Array(16),t}return n.__extends(t,e),t.prototype.next=function(){for(var e=0,t=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),this._rnds[e]=t>>>((3&e)<<3)&255;return this._rnds},t}(i);t.SimpleRandom=u},function(e,t){function r(e,t,r){for(var n=r.length,o=0;o<n;o++){var i=r[o];if(i)for(var s in i)i.hasOwnProperty(s)&&e(s,i[s])}}Object.defineProperty(t,"__esModule",{value:!0}),t.traversal=r},,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);n.__exportStar(r(37),t),n.__exportStar(r(13),t),n.__exportStar(r(4),t),n.__exportStar(r(38),t),n.__exportStar(r(18),t),n.__exportStar(r(29),t)},,,,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._listeners=new Array,this._buffer=new Array}return e.prototype.subscribe=function(e){var t=this;return"function"==typeof e&&(this.subscribed(e)<0&&this._listeners.push(e),this._buffer.length>0&&setTimeout(function(){return t.flushBuffer()})),this},e.prototype.unsubscribe=function(e){for(var t=this.subscribed(e);t>=0;)this._listeners.splice(t,1),t=this.subscribed(e);return this},e.prototype.clear=function(){this._listeners.length=0,this._buffer.length=0},e.prototype.emit=function(e){var t=this._listeners.length;if(t>0)for(var r=0;r<t;r++)try{this._listeners[r](e)}catch(e){}else this._buffer.push(e)},e.prototype.redirect=function(e){return this.subscribe(function(t){e.emit(t)}),e},e.prototype.map=function(t){var r=new e;return this.subscribe(function(e){r.emit(t(e))}),r},e.prototype.subscribed=function(e){return this._listeners.indexOf(e)},e.prototype.flushBuffer=function(){var e=this._buffer.slice();this._buffer.length=0;for(var t=e.length,r=0;r<t;r++)this.emit(e[r])},e}();t.EventEmitter=r},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function t(){}return t.current=function(){var t="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==e?e:null;if(!t)throw new Error("Unsupported environment.");return t},t}();t.GlobalProvider=r}).call(t,r(21))},,,,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.now=function(){return+new Date},e}();t.TimeStampProvider=r},function(e,t,r){function n(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e||(e={}),o.traversal(function(t,r){void 0===e[t]&&(e[t]=r)},e,t),e}Object.defineProperty(t,"__esModule",{value:!0});var o=r(5);t.extend=n},,function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},,,,,,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);n.__exportStar(r(19),t),n.__exportStar(r(39),t),n.__exportStar(r(40),t),n.__exportStar(r(41),t)},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return Object.defineProperty(e,"localStorage",{get:function(){return void 0!==e._localStorage?e._localStorage:e._localStorage=e.local()},enumerable:!0,configurable:!0}),e.local=function(){if("undefined"==typeof localStorage)return null;try{localStorage.getItem("")}catch(e){return null}return localStorage},e}();t.WebStorages=r},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.addListener=function(t){switch(e.mode){case"pagehide":return window.addEventListener("pagehide",t),!0;case"unload":return window.addEventListener("unload",t),!0;default:return!1}},e.removeListener=function(t){switch(e.mode){case"pagehide":return window.removeEventListener("pagehide",t),!0;case"unload":return window.removeEventListener("unload",t),!0;default:return!1}},e.mode="undefined"!=typeof window?window.onpagehide||null===window.onpagehide?"pagehide":"unload":"none",e}();t.UnloadEvent=r},,,,,,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){e&&"undefined"!=typeof XDomainRequest?this._xhr=new XDomainRequest:this._xhr=new XMLHttpRequest}return e.prototype.send=function(e){var t=this,r=this._xhr,n=e.type||"POST",o=e.body||"",i=e.url,s=e.timeout;return new Promise(function(e,u){r.open(n,i,!0),void 0!==s&&(r.timeout=s),t.subscribe(e,u,s),r.send(o)})},e.prototype.subscribe=function(e,t,r){var n=this._xhr;n instanceof XMLHttpRequest?n.onreadystatechange=function(r){4===n.readyState&&(n.status>=200&&n.status<300?e(n.responseText):t(n.responseText||n.responseType||"CORS problem"))}:(n.onload=function(){return e(n.responseText)},n.onerror=function(){return t("XDomain CORS problem")},n.onprogress=function(){},n.ontimeout=function(){t("Timeout")},r&&setTimeout(function(){return t("Manual timeout")},r))},e}(),n=function(){function e(){}return e.prototype.send=function(e){if("undefined"!=typeof fetch)return this.fetch(e);var t=e.url.indexOf("://")>0||0===e.url.indexOf("//");return new r(t).send(e)},e.prototype.fetch=function(e){var t={body:e.body,method:e.type};return e.debugHeaders&&(t.headers=e.debugHeaders),fetch(e.url,t).then(function(e){var t=e.text();return e.status>=200&&e.status<300?t:t.then(function(e){return Promise.reject(e)})}).catch(function(e){return e instanceof Error&&(e=e.message),Promise.reject(e)})},e}();t.Ajax=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e){var t=this;this._func=e,this._executed=!1,this.execute=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t._executed?t._result:(t._result=t._func.apply(t,n.__spread(e)),t._executed=!0,t._result)},this.executeOnce=this.execute}return Object.defineProperty(e.prototype,"executed",{get:function(){return this._executed},enumerable:!0,configurable:!0}),e}();t.Singleton=o},function(e,t){function r(e,t){return e.reduce(function(e,r){var n=t(r),o=e.get(n);return o||e.set(n,o=[]),o.push(r),e},new Map)}Object.defineProperty(t,"__esModule",{value:!0}),t.groupBy=r},function(e,t,r){function n(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e||(e={}),o.traversal(function(t,r){e[t]=r},e,t),e}Object.defineProperty(t,"__esModule",{value:!0});var o=r(5);t.override=n},function(e,t,r){function n(e){var t={};return o.traversal(function(e,r){"function"!=typeof r&&(t[e]=r)},t,[e]),t}Object.defineProperty(t,"__esModule",{value:!0});var o=r(5);t.safeClone=n},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._options=e,this.prefix="[messaging-client.js]: "}return e.prototype.fatal=function(e,t){this._options.mute||console.error(this.prefix+e,t)},e.prototype.error=function(e,t){this._options.mute||console.error(this.prefix+e,t)},e.prototype.log=function(e){this._options.mute||console.log(this.prefix+e)},e}();t.ConsoleLogger=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),o=function(){function e(){this.onlog=new n.EventEmitter}return e.prototype.fatal=function(e,t){this.onlog.emit({level:"fatal",message:e,error:t})},e.prototype.error=function(e,t){this.onlog.emit({level:"error",message:e,error:t})},e.prototype.log=function(e){this.onlog.emit({level:"log",message:e})},e}();t.EventLogger=o},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=[]),this.loggers=e,this.enabled=!0}return e.prototype.fatal=function(e,t){this.enabled&&this.logger(function(r){return r.fatal(e,t)})},e.prototype.error=function(e,t){this.enabled&&this.logger(function(r){return r.error(e,t)})},e.prototype.log=function(e){this.enabled&&this.logger(function(t){return t.log(e)})},e.prototype.replace=function(e){this.loggers.length=0;for(var t=e.length,r=0;r<t;r++)this.loggers.push(e[r])},e.prototype.logger=function(e){for(var t=this.loggers,r=t.length,n=0;n<r;n++)e(t[n])},e}();t.UniversalLogger=r},function(e,t){function r(e,t){return e.substr(-t.length,t.length)===t}function n(e,t){if("/"===t[0])return t;var r=e.lastIndexOf("/");return r<0?"/"+t:e.substring(0,r+1)+t}Object.defineProperty(t,"__esModule",{value:!0}),t.endsWith=r,t.mapPath=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);n.__exportStar(r(105),t),n.__exportStar(r(107),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(109),o=function(){function e(){}return e.open=function(e,t,r,o){void 0===o&&(o=3);var i=n.IndexedDBProvider.getIndexedDB();return i?new Promise(function(t,n){var s=0,u=function(){s++;var u=i.open(e,1);u.onsuccess=function(){var e=u.result;t(e)},u.onupgradeneeded=function(){var e=u.result;r(e)},u.onerror=function(){if(s>=o)n("Error on openning IndexedDB '"+e+"'. Attempts count: "+s+".");else try{a()}catch(e){n(e)}},u.onblocked=function(){a()}},a=function(){try{u()}catch(e){n(e.message)}};a()}):Promise.reject("Cannot instantiate IndexedDB factory.")},e.transaction=function(e,t,r){return new Promise(function(n,o){var i=e();i.transaction.oncomplete=function(){n(r)},i.transaction.onabort=i.transaction.onerror=function(e){return o(e.message||e.type)},t(i,r)})},e.request=function(e,t){e.onsuccess=function(e){var r=e.target.result;t&&t(r)},e.onerror=function(){e.transaction.abort()}},e.addArray=function(t,r,n){var o=0,i=function(){if(o<r.length){var s=r[o];o++,e.request(t.add(s),i)}else n&&n()};i()},e.remove=function(e){var t=n.IndexedDBProvider.getIndexedDB();return t?new Promise(function(r,n){var o=t.deleteDatabase(e);o.onsuccess=function(){r()},o.onerror=function(){n("Error on removing IndexedDB '"+e+"'")},o.onblocked=function(){n("Removing '"+e+"' was blocked.")}}):Promise.reject("Cannot instantiate IndexedDB factory.")},e}();t.IndexedDbUtils=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=function(){function e(e,t,r){var o=this;this.type=e,this._sender=t,this._receiver=r,this._dictionary={},this._guid=n.GuidProvider.default,this._response=function(e){var t=e.messageId;if(t){var r=o._dictionary[t];delete o._dictionary[t],r&&(e.error?"function"==typeof r.reject&&r.reject(e.error):"function"==typeof r.resolve&&r.resolve(e.response))}},r.addEventListener(e,this._response)}return e.prototype.send=function(e,t,r){var n=this._guid.next();this._dictionary[n]={resolve:t,reject:r};var o=this._sender.postMessage({type:this.type,messageId:n,request:e});o&&"function"==typeof o.catch&&o.catch(r)},e.prototype.dispose=function(){this._receiver.removeEventListener(this.type,this._response)},e}();t.WorkerRequestSender=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e,t){var r=this;this._receiver=e,this._logger=t,this._dic={},this._buffers={},this._handler=function(e){var t=e.data;if(t&&t.type){var o=r._dic[t.type];if(o)try{for(var i=n.__values(o),s=i.next();!s.done;s=i.next()){var u=s.value;try{u(t)}catch(e){r._logger.error("Error on executing listener for message type "+t.type,e)}}}catch(e){a={error:e}}finally{try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(a)throw a.error}}else{(r._buffers[t.type]||(r._buffers[t.type]=[])).push(e)}}var a,c},e.addEventListener("message",this._handler)}return e.prototype.addEventListener=function(e,t){(this._dic[e]=this._dic[e]||[]).push(t),this.flushBuffer(e)},e.prototype.removeEventListener=function(e,t){var r=this._dic[e];if(r){var n=r.indexOf(t);n>=0&&r.splice(n,1),0===r.length&&delete this._dic[e]}},e.prototype.dispose=function(){this._dic={},this._buffers={},this._receiver.removeEventListener("message",this._handler)},e.prototype.flushBuffer=function(e){var t=this,r=this._buffers[e];r&&0!==r.length&&setTimeout(function(){for(var e=r.length,n=0;n<e;n++)t._handler(r[n]);r.length=0})},e}();t.MessageReceiver=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e,t){var r=this;this.def=e,this.handler=t,this.invoke=function(e){return r.handler?r.handler(e):r.def}}return e.prototype.stop=function(){this.handler=void 0},e}();t.OptionalResponseEmitter=o;var i=function(){function e(e){var t=this;this._handler=e,this._buffer=new Array,this.invoke=function(e){return t.handler?t.handler(e):new Promise(function(r,n){t._buffer.push({request:e,resolve:r})})}}return Object.defineProperty(e.prototype,"handler",{get:function(){return this._handler},set:function(e){this._handler=e,this.flushBuffer()},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this.handler=void 0},e.prototype.flushBuffer=function(){if(this._handler&&this._buffer.length>0)try{for(var e=n.__values(this._buffer),t=e.next();!t.done;t=e.next()){var r=t.value;r.resolve(this.invoke(r.request))}}catch(e){o={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(o)throw o.error}}var o,i},e}();t.MandatoryResponseEmitter=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),o=function(){function e(e,t){var r=this;this.type=e,this._receiver=t,this.event=new n.EventEmitter,this._handler=function(e){e.type===r.type&&r.event.emit(e)},t.addEventListener(e,this._handler)}return e.prototype.dispose=function(){this._receiver.removeEventListener(this.type,this._handler),this.event.clear()},e}();t.WorkerEventReceiver=o},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n){var o=this;this.type=e,this._sender=t,this._receiver=r,this._handler=n,this._response=function(e){var t=e.messageId,r=e.type;o.type===r&&(t?o.awaitResponse(r,e.request,t):o.riseEvent(r,e.request))},r.addEventListener(e,this._response)}return e.prototype.dispose=function(){this._receiver.removeEventListener(this.type,this._response),this._handler.stop()},e.prototype.awaitResponse=function(e,t,r){function n(t){var n="";null!=t&&(n=t instanceof Error?t.message:t.toString()),i.postMessage({type:e,messageId:r,error:{message:n}})}function o(t){i.postMessage({type:e,messageId:r,response:t})}var i=this._sender;try{var s=this._handler.invoke(t);"undefined"!=typeof Promise&&s instanceof Promise?s.then(o,n):o(s)}catch(e){n(e)}},e.prototype.riseEvent=function(e,t){try{this._handler.invoke(t)}catch(e){}},e}();t.WorkerRequestReceiver=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(54);t.PseudoWorkerScopeName="MessagingClient-PseudoWorker";var o=function(){function e(e,r){void 0===r&&(r=new n.ScriptLoader);var o=this;this._listeners=[],this._buffer=[],this._global=window,this._pseudoWorker=this._global[t.PseudoWorkerScopeName]=new i(e,r,{raiseEvent:function(e){return o.raiseEvent(e)}}),r.loadScript(e)}return Object.defineProperty(e.prototype,"pseudoWorker",{get:function(){return this._pseudoWorker},enumerable:!0,configurable:!0}),e.prototype.postMessage=function(e){this._pseudoWorker.raiseEvent({data:e})},e.prototype.addEventListener=function(e,t){var r=this;"message"===e&&(this._listeners.push(t),setTimeout(function(){if(r._buffer.length>0){for(var e=r._buffer.slice(),t=e.length,n=0;n<t;n++)r.raiseEvent(e[n]);r._buffer.length=0}}))},e.prototype.removeEventListener=function(e,t){var r=this._listeners.indexOf(t);r>-1&&this._listeners.splice(r,1)},e.prototype.terminate=function(){this._buffer.length=0,this._listeners.length=0,this._pseudoWorker.close()},e.prototype.raiseEvent=function(e){var t=this._listeners,r=t.length;if(r>0)for(var n=0;n<r;n++){var o=t[n];o(e)}else this._buffer.push(e)},e}();t.PseudoWorker=o;var i=function(){function e(e,t,r){this._scriptLoader=t,this._internal=r,this._listeners=[],this._buffer=[],this.location=e}return e.prototype.postMessage=function(e){var t=this;e=JSON.parse(JSON.stringify(e)),setTimeout(function(){t._internal.raiseEvent({data:e})})},e.prototype.importScripts=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r,n,o=e.length,i=e.length,s=function(){--i<=0&&(n=!0,r&&r())},u=0;u<o;u++)this._scriptLoader.loadScript(e[u],s);return{then:function(e){if(n)return void e();r=e}}},e.prototype.addEventListener=function(e,t){var r=this;"message"===e&&(this._listeners.push(t),setTimeout(function(){if(r._buffer.length){for(var e=r._buffer.slice(),t=e.length,n=0;n<t;n++)r.raiseEvent(e[n]);r._buffer.length=0}}))},e.prototype.removeEventListener=function(e,t){var r=this._listeners.indexOf(t);r>-1&&this._listeners.splice(r,1)},e.prototype.raiseEvent=function(e){if(this._listeners.length)for(var t=this._listeners.length,r=0;r<t;r++)this._listeners[r](e);else this._buffer.push(e)},e.prototype.close=function(){this._buffer.length=0,this._listeners.length=0},e}()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(14),o=function(){function e(t){if(void 0===t&&(t=n.GlobalProvider.current()),void 0!==t.document)return void(this.loadScript=function(r,n){return e.loadViaDom(t.document,r,n)});throw new Error("No DOM environment is not supported.")}return e.loadViaDom=function(e,t,r){var n=e.createElement("script");n.type="text/javascript",n.src=t,r&&(n.onload=r),(e.body||e.head).appendChild(n)},e}();t.ScriptLoader=o},,,,,,,,,,,,,,,,,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);n.__exportStar(r(74),t),n.__exportStar(r(103),t),n.__exportStar(r(130),t),n.__exportStar(r(76),t),n.__exportStar(r(78),t),n.__exportStar(r(131),t),n.__exportStar(r(77),t),n.__exportStar(r(75),t),n.__exportStar(r(133),t)},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=0),this.envelops=e,this.index=t,this.errorCount=0}return e}();t.Batch=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e){var t=this;this.pipes=e,this.queues=new Map,e.forEach(function(e,r){t.queues.set(r,e.batchBuilder.queue)})}return e.prototype.start=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r,o,i,s;return n.__generator(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),e=n.__values(this.pipes.values()),t=e.next(),u.label=1;case 1:return t.done?[3,4]:(r=t.value,[4,r.start()]);case 2:u.sent(),u.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o=u.sent(),i={error:o},[3,7];case 6:try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(i)throw i.error}return[7];case 7:return[2]}})})},e.prototype.terminate=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r,o,i,s;return n.__generator(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),e=n.__values(this.pipes.values()),t=e.next(),u.label=1;case 1:return t.done?[3,4]:(r=t.value,[4,r.terminate()]);case 2:u.sent(),u.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o=u.sent(),i={error:o},[3,7];case 6:try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(i)throw i.error}return[7];case 7:return[2]}})})},e}();t.Bus=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(0).__exportStar(r(123),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(127),i=r(31),s=r(128),u=function(){function e(e,t,r,n,i,s){void 0===s&&(s=new o.LocalStorageTabSyncPoint(e.queue.id+"-pipe")),this.batchBuilder=e,this.endpoint=t,this._flushTimeStrategy=r,this._logger=n,this._auditor=i,this._syncPoint=s,this._active=!0}return Object.defineProperty(e.prototype,"queueId",{get:function(){return this.batchBuilder.queue.id},enumerable:!0,configurable:!0}),e.prototype.start=function(){if(this._intervalId)throw new Error("Pipe already was started.");return this._intervalId={},this.subscribe(),this.schedule()},e.prototype.terminate=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return this._active?(this.dispose(),[4,this.batchBuilder.destroy()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.dispose=function(){this._active&&(this._active=!1,this._intervalId&&(clearTimeout(this._intervalId),this._intervalId=void 0),this._syncPoint.dispose())},e.prototype.schedule=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t=this;return n.__generator(this,function(r){switch(r.label){case 0:return this._active?[4,this._flushTimeStrategy.duration()]:[3,2];case 1:e=r.sent(),this._intervalId=setTimeout(function(){return n.__awaiter(t,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,3,4]),[4,this.flush()];case 1:return t.sent(),[3,4];case 2:return e=t.sent(),this._logger.error("[QID:"+this.queueId+"]: Error on flushing messages into the endpoint.",e),[3,4];case 3:return this.schedule(),[7];case 4:return[2]}})})},e),r.label=2;case 2:return[2]}})})},e.prototype.subscribe=function(){var e=this;i.UnloadEvent.addListener(function(){e.dispose()})},e.prototype.flush=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r,o,i,u=this;return n.__generator(this,function(a){switch(a.label){case 0:return this._active?(e=this._auditor.start(this.batchBuilder.queue),t=!this._syncPoint.capture(this._flushTimeStrategy.syncTime()),[4,this.batchBuilder.next(t)]):[2];case 1:if(!(r=a.sent()))return[2];a.label=2;case 2:return a.trys.push([2,4,,6]),e.dequeued(r.batch),o=this.endpoint.send(r.batch).then(function(){return n.__awaiter(u,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return e.confirmed(s.AjaxRequestStatusResult.Success),[4,r.ack()];case 1:return t.sent(),e.ended(),this._logger.log("[QID:"+this.queueId+"]: Batch "+r.batch.index+" was sent successfully."),[2]}})})}).catch(function(t){return n.__awaiter(u,void 0,void 0,function(){var o;return n.__generator(this,function(n){switch(n.label){case 0:return o=t.errors?s.AjaxRequestStatusResult.MessagesError:s.AjaxRequestStatusResult.NetworkError,e.confirmed(o),o!==s.AjaxRequestStatusResult.NetworkError?[3,2]:[4,r.nack()];case 1:return n.sent(),[3,4];case 2:return[4,r.ack()];case 3:n.sent(),n.label=4;case 4:return e.ended(),this._logger.error("[QID:"+this.queueId+"]: Batch "+r.batch.index+" was sent with error.",t),[2]}})})}),e.sent(),[4,o];case 3:return a.sent(),[3,6];case 4:return i=a.sent(),[4,r.nack()];case 5:throw a.sent(),i;case 6:return[2]}})})},e}();t.Pipe=u},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t={}),this.type=e,this.message=t}return e}();t.Envelop=r},,,,,,,,,,,,,,,,,,,,function(e,t,r){var n=this;Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=r(99),s=r(9),u=r(100),a=r(102),c=r(73),f=r(134),l=r(135),d=r(136),h=r(137),p=r(138),_=r(139),v=r(140),y=r(141),g=r(143);!function(){var e=g.WorkerScope.current(),t=new u.UniversalLogger([]),r=new y.WorkerReceiver(e,t);t.replace([new u.WorkerLogger(r.context.sender)]);var b=new s.Singleton(function(u,y){t.enabled=y.debug,a.Polyfills.load(e,function(){return o.__awaiter(n,void 0,void 0,function(){var e,n,a,g,b,m,w,x,S,P,j=this;return o.__generator(this,function(O){switch(O.label){case 0:return e=new v.Postman(s.GuidProvider.default,new s.TimeStampProvider),a=p.PipeStatsLocalStorage.create(),a?[3,2]:[4,h.PipeStatsIndexedDBStorage.create().catch(function(){return new _.PipeStatsMemoryStorage})];case 1:a=O.sent(),O.label=2;case 2:return n=a,g=new d.PipeStatsProvider(n),b=new c.BusBuilder(r.context,u,y,g,t),[4,b.build()];case 3:return m=O.sent(),w=new c.Router(i.messagesConfiguration,m.queues),x=f.MessengerPerformanceAuditorBuilder.create(y.performanceAudit,b.auditSender),S=new l.MessengerStatisticAuditor(n),P=new c.Messenger(w,e,S,x),r.messages.subscribe(function(e){P.send(e.messages)}),[4,m.start()];case 4:return O.sent(),r.terminate.handler=function(){return o.__awaiter(j,void 0,void 0,function(){return o.__generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,,4,5]),[4,m.terminate()];case 1:return e.sent(),[4,n.clear()];case 2:return e.sent(),[4,n.dispose()];case 3:return e.sent(),[3,5];case 4:return r.dispose(),[7];case 5:return[2]}})})},r.environment.subscribe(function(e){y.debug=t.enabled=e.environment.debug}),t.log("Worker was started successfully."),[2]}})})},y)});r.configuration.subscribe(function(e){try{b.executeOnce(e.configuration,e.environment)}catch(e){t.error(e)}})}()},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.messagesConfiguration={messages:[]}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);n.__exportStar(r(42),t),n.__exportStar(r(43),t),n.__exportStar(r(101),t),n.__exportStar(r(44),t)},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._sender=e,this.prefix=""}return e.prototype.fatal=function(e,t){this._sender.postMessage({type:"log",log:{level:"fatal",message:this.prefix+e,error:t}})},e.prototype.error=function(e,t){this._sender.postMessage({type:"log",log:{level:"error",message:this.prefix+e,error:t}})},e.prototype.log=function(e){this._sender.postMessage({type:"log",log:{level:"log",message:this.prefix+e}})},e}();t.WorkerLogger=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(45),o=function(){function e(){}return e.load=function(t,r,n){if(n.forcePolyfills||"undefined"==typeof Promise||"undefined"==typeof Map||"undefined"==typeof Symbol){var o=t.importScripts(n.polyfillsUrl||e.url(t,"/messaging-client-polyfills.js"));o&&"function"==typeof o.then?o.then(r):r()}else r()},e.url=function(e,t){var r=(e.location||"").toString();return n.mapPath(r,t)},e}();t.Polyfills=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(0).__exportStar(r(104),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(9),i=r(46),s=r(46),u=r(108),a=r(110),c=r(114),f=r(115),l=r(116),d=r(117),h=r(118),p=r(119),_=r(120),v=r(121),y=r(122),g=r(75),b=r(76),m=r(126),w=r(77),x=r(129),S=function(){function e(e,t,r,n,o){this._context=e,this._config=t,this._environment=r,this._statsProvider=n,this._logger=o,this.auditSender=new d.WorkerAuditSender(this._context)}return e.prototype.build=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r,o,i,s,u,a;return n.__generator(this,function(c){switch(c.label){case 0:e=new Map,c.label=1;case 1:c.trys.push([1,6,7,8]),t=n.__values(this._config.endpoints),r=t.next(),c.label=2;case 2:return r.done?[3,5]:(o=r.value,[4,this.pipes(o)]);case 3:i=c.sent(),i.forEach(function(t,r){e.set(r,t)}),c.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return s=c.sent(),u={error:s},[3,8];case 7:try{r&&!r.done&&(a=t.return)&&a.call(t)}finally{if(u)throw u.error}return[7];case 8:return[2,new g.Bus(e)]}})})},e.prototype.pipes=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,o,i,u,a,_,v,y,g,b,x,S,P,j,O,M,I;return n.__generator(this,function(q){switch(q.label){case 0:t=this.endpoint(e),r=new Map,o=f.PipePerformanceAuditorBuilder.create(this._environment.performanceAudit,new d.WorkerAuditSender(this._context)),i=new l.PipeStatisticAuditor(this._statsProvider),q.label=1;case 1:q.trys.push([1,7,8,9]),u=n.__values(e.queues),a=u.next(),q.label=2;case 2:return a.done?[3,6]:(_=a.value,y=s.SampledQueue.bind,[4,this.queue(_)]);case 3:return v=new(y.apply(s.SampledQueue,[void 0,q.sent(),this._logger,_])),[4,this.batchStorage(_)];case 4:g=q.sent(),b=new c.BatchAuditProvider,x=new p.DefaultBatchDropStrategy(_),S=new h.BatchBuilder(v,g,x,b,i,_),P=new m.DynamicFlushTimeStrategy(this._statsProvider.get(v),_),j=new w.Pipe(S,t,P,this._logger,o),r.set(_.id,j),q.label=5;case 5:return a=u.next(),[3,2];case 6:return[3,9];case 7:return O=q.sent(),M={error:O},[3,9];case 8:try{a&&!a.done&&(I=u.return)&&I.call(u)}finally{if(M)throw M.error}return[7];case 9:return[2,r]}})})},e.prototype.batchStorage=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r=this;return n.__generator(this,function(n){return e.persistent?(t=1.5*(e.maxFlushTime||30),[2,_.BatchIndexedDBStorage.create(e.id,t,e.name,e.reset).then(function(t){return t.logger=r._logger,r._logger.log("Created persistent batch storage for id "+e.id),t}).catch(function(t){r._logger.error("Creating IndexedDb for batch storage was failed.",t);var n=v.BatchLocalStorageStorage.create(e.id,e.name,e.reset);return n?(n.logger=r._logger,r._logger.log("Downgraded to local storage batch storage for id "+e.id+"."),n):(r._logger.log("Downgraded to memory batch storage for id "+e.id+"."),new y.BatchMemoryStorage)})]):(this._logger.log("Created memory batch storage for id "+e.id),[2,new y.BatchMemoryStorage])})})},e.prototype.queue=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r=this;return n.__generator(this,function(n){return e.persistent?(t=a.LocalStorageQueue.create(e.id,e.name,e.reset),t?(this._logger.log("Created Local Storage queue for id "+e.id),[2,t]):[2,u.IndexedDBQueue.create(e.id,e.name,e.reset).then(function(t){return r._logger.log("Created persistent queue for id "+e.id),t}).catch(function(){return r._logger.log("Downgraded to memory queue for id "+e.id+"."),new i.MemoryQueue(e.id)})]):(this._logger.log("Created memory queue for id "+e.id),[2,new i.MemoryQueue(e.id)])})})},e.prototype.endpoint=function(e){var t=e;return"fe-analytic-collector"!==e.type&&this._logger.error("Endpoint type '"+e.type+"' is not supported"),new b.FEAnalyticsCollectorEndpoint(this.ajax(),new o.TimeStampProvider,this._logger,t,this._environment)},e.prototype.ajax=function(){return this._environment.fakeMode?new x.PortAjaxProvider(this._context):new o.Ajax},e}();t.BusBuilder=S},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(0).__exportStar(r(106),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e){this.id=e,this._array=[]}return Object.defineProperty(e.prototype,"count",{get:function(){return this._array.length},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){(t=this._array).push.apply(t,n.__spread(e));var t},e.prototype.clear=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return this._array.length=0,[2]})})},e.prototype.dequeue=function(e){var t=this._array.length;return e=Math.min(t,Math.max(e,0)),e<=0?[]:this._array.splice(0,e)},e.prototype.destroy=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return this.clear(),[2]})})},e.prototype.dispose=function(){},e}();t.MemoryQueue=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(29),o=function(){function e(){this.maxMessageCount=15e3,this.maxEnqueueCount=300}return e}(),i=function(){function e(e,t,r){void 0===r&&(r=null),this.queue=e,this._logger=t,this.config=new o,n.override(this.config,r)}return Object.defineProperty(e.prototype,"id",{get:function(){return this.queue.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this.queue.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.config.maxMessageCount},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){var t=this.size-this.queue.count;if(!(t<=0)){var r=this.config.maxEnqueueCount;return e.length>r&&(this._logger.log("Exceed max enqueued count per request ("+r+"). Lost "+(e.length-r)+" messages."),e=e.slice(0,r)),t<e.length&&(e=e.slice(0,t)),this.queue.enqueue(e)}},e.prototype.dequeue=function(e,t){return this.queue.dequeue(e,t)},e.prototype.destroy=function(){return this.queue.destroy()},e.prototype.dispose=function(){return this.queue.dispose()},e}();t.SampledQueue=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(47),i=function(){function e(e,t){this.id=e,this._db=t,this._lastCount=0}return e.create=function(t,r,i){return n.__awaiter(this,void 0,void 0,function(){var s,u,a;return n.__generator(this,function(n){switch(n.label){case 0:return s="mcjs:"+(r||t),[4,o.IndexedDbUtils.open(s,1,function(t){t.objectStoreNames.contains(e.storageName)||t.createObjectStore(e.storageName,{autoIncrement:!0})})];case 1:return u=n.sent(),a=new e(t,u),i?[4,a.clear()]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2,a]}})})},Object.defineProperty(e.prototype,"count",{get:function(){return this._lastCount},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){var t=this;return this.transaction(function(r){o.IndexedDbUtils.addArray(r,e,function(){return t.updateCount(r)})},void 0)},e.prototype.dequeue=function(e){var t=this;return this.transaction(function(r,n){var i=0;o.IndexedDbUtils.request(r.openCursor(),function(o){o&&i<e?(n.push(o.value),o.delete(),i++,o.continue()):t.updateCount(r)})},new Array)},e.prototype.destroy=function(){return this.dispose(),o.IndexedDbUtils.remove(this._db.name)},e.prototype.dispose=function(){this._db.close()},e.prototype.clear=function(){return this.transaction(function(e){e.clear()},void 0)},e.prototype.updateCount=function(e){var t=this;e.count().onsuccess=function(e){t._lastCount=+e.target.result}},e.prototype.open=function(t){return void 0===t&&(t="readwrite"),this._db.transaction([e.storageName],t).objectStore(e.storageName)},e.prototype.transaction=function(e,t){var r=this;return o.IndexedDbUtils.transaction(function(){return r.open()},e,t)},e.storageName="messages",e}();t.IndexedDBQueue=i},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.getIndexedDB=function(){return"undefined"!=typeof indexedDB?indexedDB:"undefined"!=typeof mozIndexedDB?mozIndexedDB:"undefined"!=typeof webkitIndexedDB?webkitIndexedDB:"undefined"!=typeof msIndexedDB?msIndexedDB:void 0},e.isSupported=function(){return!!e.getIndexedDB()},e}();t.IndexedDBProvider=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(30),i=r(46),s=r(111),u=r(113),a=function(){function e(e,t){this.id=e,this._storage=t,this._memory=new i.MemoryQueue(e)}return e.create=function(t,r,n){void 0===n&&(n=!1);var i=o.WebStorages.localStorage;if(!i)return null;var a=new s.LocalStorageKeyValue((r||t)+"",i),c=new u.LocalStorageKeyValueCache(a);return n&&a.clear(),new e(t,c)},Object.defineProperty(e.prototype,"count",{get:function(){return this._memory.count+this._storage.length()},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){try{for(var t=n.__values(e),r=t.next();!r.done;r=t.next()){var o=r.value,i=o.id;this._storage.setItem(i,o)||this._memory.enqueue([o])}}catch(e){s={error:e}}finally{try{r&&!r.done&&(u=t.return)&&u.call(t)}finally{if(s)throw s.error}}var s,u},e.prototype.clear=function(){this._storage.clear()},e.prototype.dequeue=function(e,t){var r=this._memory.dequeue(e);if(r.length>=e)return r;if(e-=r.length,!t){var o=this._storage,i=new Array,s=0;try{for(var u=n.__values(o.enumerate()),a=u.next();!a.done;a=u.next()){var c=a.value,f=c.value;if(f&&(r.push(f),i.push(c.key),s++),s>=e)break}}catch(e){p={error:e}}finally{try{a&&!a.done&&(_=u.return)&&_.call(u)}finally{if(p)throw p.error}}try{for(var l=n.__values(i),d=l.next();!d.done;d=l.next()){var h=d.value;o.removeItem(h)}}catch(e){v={error:e}}finally{try{d&&!d.done&&(y=l.return)&&y.call(l)}finally{if(v)throw v.error}}}return r;var p,_,v,y},e.prototype.destroy=function(){this.dispose(),this.clear()},e.prototype.dispose=function(){this._memory.dispose()},e}();t.LocalStorageQueue=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(112),i=function(){function e(e,t){this.queueId=e,this._storage=t}return e.prototype.length=function(){for(var e=0,t=this.keys();!t.next().done;)e++;return e},e.prototype.clear=function(){try{for(var e=n.__values(this.keys()),t=e.next();!t.done;t=e.next()){var r=t.value;this._storage.removeItem(r.value())}}catch(e){o={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(o)throw o.error}}var o,i},e.prototype.has=function(e){var t=new o.StorageKey(this.queueId,e).value();return!!this._storage.getItem(t)},e.prototype.getItem=function(e){var t=new o.StorageKey(this.queueId,e).value(),r=this._storage.getItem(t);return this.toObject(r,t)},e.prototype.removeItem=function(e){var t=new o.StorageKey(this.queueId,e).value();this._storage.removeItem(t)},e.prototype.setItem=function(e,t){var r=new o.StorageKey(this.queueId,e).value(),n=JSON.stringify(t);try{return this._storage.setItem(r,n),!0}catch(e){return!1}},e.prototype.enumerate=function(){var e,t,r,o,i,s,u,a;return n.__generator(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),e=n.__values(this.keys()),t=e.next(),c.label=1;case 1:return t.done?[3,4]:(r=t.value,o=r.value(),i=this.toObject(this._storage.getItem(o),o),i?[4,{value:i,key:r.key}]:[3,3]);case 2:c.sent(),c.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return s=c.sent(),u={error:s},[3,7];case 6:try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(u)throw u.error}return[7];case 7:return[2]}})},e.prototype.toObject=function(e,t){if(!e)return null;try{return JSON.parse(e)}catch(e){this._storage.removeItem(t)}return null},e.prototype.keys=function(){var e,t,r,i,s;return n.__generator(this,function(n){switch(n.label){case 0:e=this._storage,t=new Map,r=e.length-1,n.label=1;case 1:return r>=0?(r>=e.length&&(r=e.length-1),(i=e.key(r))?!(s=o.StorageKey.parse(i))||s.queue!==this.queueId||t.has(i)?[3,3]:(t.set(i,void 0),[4,s]):[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r--,[3,1];case 4:return t.clear(),[2]}})},e}();t.LocalStorageKeyValue=i},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.queue=e,this.key=t}return e.parse=function(t){if(t&&0===t.indexOf(e.prefix,0)){var r=e.regex.queue.exec(t),n=e.regex.key.exec(t);if(r&&n){var o=new e(r[1],n[1]);return o._key=t,o}}return null},e.prototype.value=function(){return this._key||(this._key=e.prefix+"?q="+encodeURIComponent(this.queue)+"&k="+encodeURIComponent(this.key))},e.prefix="mcjs",e.regex={queue:/q=([\w-]+)/,key:/k=([\w-]+)/},e}();t.StorageKey=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e){this._storage=e,this._cache=new Map,this._length=0,this._updateLength=!0}return e.prototype.length=function(){return this._updateLength&&(this._length=this._storage.length(),this._updateLength=!1),this._length},e.prototype.clear=function(){this._storage.clear(),this._cache.clear(),this._updateLength=!0},e.prototype.has=function(e){return this._storage.has(e)},e.prototype.getItem=function(e){if(!this._storage.has(e))return this._cache.delete(e),null;var t=this._cache.get(e);return t||(t=this._storage.getItem(e),this._cache.set(e,t)),t},e.prototype.removeItem=function(e){this._storage.removeItem(e),this._cache.delete(e),this._updateLength=!0},e.prototype.setItem=function(e,t){var r=this._storage.setItem(e,t);return r&&(this._cache.set(e,t),this._updateLength=!0),r},e.prototype.enumerate=function(){var e,t,r,o,i,s,u,a,r,c,f,l,d,h;return n.__generator(this,function(p){switch(p.label){case 0:p.trys.push([0,5,6,7]),e=n.__values(this._cache.keys()),t=e.next(),p.label=1;case 1:return t.done?[3,4]:(r=t.value,o=this.getItem(r),o?[4,{key:r,value:o}]:[3,3]);case 2:p.sent(),p.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return i=p.sent(),f={error:i},[3,7];case 6:try{t&&!t.done&&(l=e.return)&&l.call(e)}finally{if(f)throw f.error}return[7];case 7:p.trys.push([7,12,13,14]),s=n.__values(this._storage.enumerate()),u=s.next(),p.label=8;case 8:return u.done?[3,11]:(a=u.value,r=a.key,this._cache.has(r)?[3,10]:[4,a]);case 9:p.sent(),p.label=10;case 10:return u=s.next(),[3,8];case 11:return[3,14];case 12:return c=p.sent(),d={error:c},[3,14];case 13:try{u&&!u.done&&(h=s.return)&&h.call(s)}finally{if(d)throw d.error}return[7];case 14:return[2]}})},e}();t.LocalStorageKeyValueCache=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(){}return e.prototype.audit=function(e,t){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(n){switch(n.label){case 0:return[4,t.update(function(t){r={cid:t.statistic.clientId,qid:t.statistic.queueId,bi:t.statistic.batchIndex,tmc:t.statistic.totalMessageCount,trec:t.statistic.totalRequestErrorCount,qmc:t.state.queueMessageCount,qs:t.state.queueSize,rec:t.statistic.requestErrorCount,bmc:e.envelops.length},t.statistic.requestErrorCount=0})];case 1:if(n.sent(),!r)throw new Error("Statistic was not filled.");return[2,r]}})})},e}();t.BatchAuditProvider=o},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.create=function(e,t){return new n(e?t:void 0)},e}();t.PipePerformanceAuditorBuilder=r;var n=function(){function e(e){this._sender=e}return e.prototype.start=function(e){return this._sender,new o},e}(),o=function(){function e(){}return e.prototype.dequeued=function(e){},e.prototype.sent=function(){},e.prototype.confirmed=function(e){},e.prototype.ended=function(){},e}()},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._stats=e}return e.prototype.start=function(e){return new n(this._stats.get(e))},e}();t.PipeStatisticAuditor=r;var n=function(){function e(e){this.stats=e}return e.prototype.result=function(e){return this.stats.update(function(t){var r=t.statistic;e||(r.requestErrorCount++,r.totalRequestErrorCount++),r.lastSendingSuccess=e})},e}()},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._context=e}return e.prototype.batch=function(e){this._context.sender.postMessage({type:"performance",report:{type:"batch",data:e}})},e.prototype.messages=function(e){this._context.sender.postMessage({type:"performance",report:{type:"messages",data:e}})},e}();t.WorkerAuditSender=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(9),i=r(74),s=function(){function e(){this.batchSize=50}return e}(),u=function(){function e(e,t,r,n,i,u){void 0===u&&(u=null),this.queue=e,this._batchStorage=t,this._batchDropStrategy=r,this._auditProvider=n,this._auditor=i,this._config=new s,o.override(this._config,u)}return e.prototype.next=function(e){return void 0===e&&(e=!1),n.__awaiter(this,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:return t=this._auditor.start(this.queue),[4,this.batch(t.stats,e)];case 1:return r=n.sent(),r?[2,new a(r,t,this._batchDropStrategy)]:[2,void 0]}})})},e.prototype.destroy=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return[4,this._batchStorage.destroy()];case 1:return e.sent(),[4,this.queue.destroy()];case 2:return e.sent(),[2]}})})},e.prototype.batch=function(e,t){var r=this;return this._batchStorage.append(function(){return n.__awaiter(r,void 0,void 0,function(){var r,o,s;return n.__generator(this,function(n){switch(n.label){case 0:return[4,this.queue.dequeue(this._config.batchSize,t)];case 1:return r=n.sent(),r.length?[4,e.update(function(e){return new i.Batch(r,++e.statistic.batchIndex)})]:[2,void 0];case 2:return o=n.sent(),s=o,[4,this._auditProvider.audit(o,e)];case 3:return s.audits=n.sent(),[2,o]}})})},t)},e}();t.BatchBuilder=u;var a=function(){function e(e,t,r){this._consumption=e,this._auditor=t,this._batchDropStrategy=r}return Object.defineProperty(e.prototype,"batch",{get:function(){return this._consumption.batch},enumerable:!0,configurable:!0}),e.prototype.ack=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return[4,this._auditor.result(!0)];case 1:return e.sent(),[4,this._consumption.ack()];case 2:return e.sent(),[2]}})})},e.prototype.nack=function(){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return this.batch.errorCount++,[4,this._auditor.result(!1)];case 1:return t.sent(),[4,this._auditor.stats.read()];case 2:return e=t.sent(),this._batchDropStrategy.shouldBeDropped(e,this.batch)?[4,this._consumption.ack()]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,this._consumption.nack()];case 5:t.sent(),t.label=6;case 6:return[2]}})})},e}();t.BatchConsumation=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),o=function(){function e(){this.fillThreshold=.6,this.attemptCount=2}return e}(),i=function(){function e(e){this._config=new o,n.override(this._config,e)}return e.prototype.shouldBeDropped=function(e,t){var r=e.state,n=this._config;return t.errorCount>=n.attemptCount&&r.queueMessageCount/r.queueSize>n.fillThreshold},e}();t.DefaultBatchDropStrategy=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(47),i=function(){function e(e,t,r){this.id=e,this._syncTime=t,this._db=r}return e.create=function(t,r,o,i){return n.__awaiter(this,void 0,void 0,function(){var s,u;return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.db(t,o)];case 1:return s=n.sent(),u=new e(t,r,s),i?[4,u.clear()]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2,u]}})})},e.db=function(t,r){var n="mcjs-batch:"+(r||t);return o.IndexedDbUtils.open(n,1,function(t){t.objectStoreNames.contains(e.storageName)||t.createObjectStore(e.storageName,{keyPath:"batch.index"})})},e.prototype.append=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,o=this;return n.__generator(this,function(n){switch(n.label){case 0:return[4,this.read()];case 1:return t=n.sent(),t?[3,4]:[4,e()];case 2:return t=n.sent(),t?[4,this.save(t)]:[3,4];case 3:n.sent(),n.label=4;case 4:return t?(r=t.index,[2,{batch:t,ack:function(){return o.reset(r)},nack:function(){return o.avoidAccess(r)}}]):[2,void 0]}})})},e.prototype.clear=function(){return this.transaction(function(e){e.clear()},void 0)},e.prototype.destroy=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return this._db.close(),[2,o.IndexedDbUtils.remove(this._db.name).catch()]})})},e.prototype.reset=function(e){return this.remove(e)},e.prototype.read=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r=this;return n.__generator(this,function(n){switch(n.label){case 0:if(this._recovery)return[2,this._recovery];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.transaction(function(e,t){o.IndexedDbUtils.request(e.openCursor(),function(e){if(e){var n=e.value;n&&r.isNotBlocked(n)?(e.update(n),t.batch=n.batch):e.continue()}})},{batch:void 0})];case 2:return e=n.sent(),[2,e.batch];case 3:return t=n.sent(),this.error("Error on reading.",t),[2,void 0];case 4:return[2]}})})},e.prototype.save=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.transaction(function(t){o.IndexedDbUtils.request(t.add({batch:e,lastAccess:+new Date}))},void 0)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),this._recovery=e,this.error("Error on saving.",t),[3,3];case 3:return[2]}})})},e.prototype.remove=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:this._recovery&&this._recovery.index===e&&(this._recovery=void 0),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.transaction(function(t){o.IndexedDbUtils.request(t.delete(e))},void 0)];case 2:return r.sent(),[3,4];case 3:return t=r.sent(),this.error("Error on removing.",t),[3,4];case 4:return[2]}})})},e.prototype.avoidAccess=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.transaction(function(t){o.IndexedDbUtils.request(t.get(e),function(e){e.lastAccess=void 0,t.put(e)})},void 0)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),this.error("Error on access avoiding.",t),[3,3];case 3:return[2]}})})},e.prototype.open=function(t){return this._db.transaction([e.storageName],t).objectStore(e.storageName)},e.prototype.transaction=function(e,t,r){var n=this;return void 0===r&&(r="readwrite"),o.IndexedDbUtils.transaction(function(){return n.open(r)},e,t)},e.prototype.isNotBlocked=function(e){if(this._syncTime){var t=+new Date;if(e.lastAccess&&Math.abs(t-e.lastAccess)<this._syncTime)return!1;e.lastAccess=t}return!0},e.prototype.error=function(e,t){this.logger&&this.logger.error("[IndexedDb BS]:"+e,t)},e.storageName="batch",e}();t.BatchIndexedDBStorage=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(30),i=function(){function e(e,t){this.key=e,this._storage=t}return e.create=function(t,r,n){if(o.WebStorages.localStorage){var i=new e("mcjs-batch:"+(r||t),o.WebStorages.localStorage);return n&&i.clear(),i}},e.prototype.append=function(e,t){return n.__awaiter(this,void 0,void 0,function(){var r,o,i=this;return n.__generator(this,function(n){switch(n.label){case 0:return(r=this._cache||(t?void 0:this.read()))?[3,2]:(o=this,[4,e()]);case 1:r=o._cache=n.sent(),r&&!t&&this.save(r),n.label=2;case 2:return r?[2,{batch:r,ack:function(){i._cache=void 0,t||i.reset()},nack:function(){}}]:[2]}})})},e.prototype.clear=function(){this.reset()},e.prototype.destroy=function(){this.clear()},e.prototype.read=function(){try{var e=this._storage.getItem(this.key);if(e)try{return JSON.parse(e)}catch(e){this._storage.removeItem(this.key)}}catch(e){this.log("Error on reading",e)}},e.prototype.save=function(e){try{var t=JSON.stringify(e);this._storage.setItem(this.key,t)}catch(e){this.log("Error on saving",e)}},e.prototype.reset=function(){try{this._storage.removeItem(this.key)}catch(e){this.log("Error on reseting",e)}},e.prototype.log=function(e,t){this.logger&&this.logger.error("[LStorage BS]:"+e,t)},e}();t.BatchLocalStorageStorage=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(){}return e.prototype.append=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r=this;return n.__generator(this,function(n){switch(n.label){case 0:return this._batch?[3,2]:(t=this,[4,e()]);case 1:t._batch=n.sent(),n.label=2;case 2:return this._batch?[2,{batch:this._batch,ack:function(){return r._batch=void 0},nack:function(){}}]:[2,void 0]}})})},e.prototype.clear=function(){this._batch=void 0},e.prototype.destroy=function(){this.clear()},e}();t.BatchMemoryStorage=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(0).__exportStar(r(124),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(9),i=r(125),s=function(){function e(){this.timeout=2e3}return e.prototype.validate=function(e){if(!this.url){var t="Url for FE Analytics Collector is not setted";throw e.fatal(t),new Error(t)}},e}(),u=function(){function e(e,t,r,n,i){this._ajax=e,this._timestamp=t,this._environment=i,this._config=new s,o.override(this._config,n),this._config.validate(r),this._serializer=new c(i.apiKey),this._error=new f(i)}return e.prototype.send=function(e){var t=this,r=this.serialize(e);return this._ajax.send({type:"POST",url:this.url(),body:r,timeout:this._config.timeout,debugHeaders:this.headers(e)}).then(function(e){var r=t._error.parse(e);return r?Promise.reject(r):Promise.resolve()},function(e){var r=t._error.parse(e)||{message:e};return Promise.reject(r)})},e.prototype.serialize=function(e){var t=this.audit(e);t+="\n\n{}\n";try{for(var r=n.__values(e.envelops),o=r.next();!o.done;o=r.next()){var i=o.value;t+=this._serializer.serialize(i)+"\n"}}catch(e){s={error:e}}finally{try{o&&!o.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}}return t;var s,u},e.prototype.audit=function(e){return JSON.stringify(e.audits||{})},e.prototype.headers=function(e){if(this._environment.debug){var t=this.tabs(e);if(t)return[["X-Requested-With",t]]}},e.prototype.tabs=function(e){var t={},r=!1;try{for(var o=n.__values(e.envelops),i=o.next();!i.done;i=o.next()){var s=i.value,u=t[s.id]=s.tabId;r=r||!!u}}catch(e){a={error:e}}finally{try{i&&!i.done&&(c=o.return)&&c.call(o)}finally{if(a)throw a.error}}return r?JSON.stringify({tabs:t}):void 0;var a,c},e.prototype.url=function(){var e=this._config.url+"/v2_1?p=js&v="+encodeURIComponent(i.Version)+"&t="+this._timestamp.now();return this._environment.debug&&(e+="&debug=true"),e},e}();t.FEAnalyticsCollectorEndpoint=u;var a;!function(e){e[e.measurement=0]="measurement",e[e.generic=1]="generic",e[e.log=2]="log"}(a||(a={}));var c=function(){function e(e){this._apiKey=e,this.valueFilter=function(e,t){if(!(null===t||"number"==typeof t&&isNaN(t)))return t}}return e.prototype.serialize=function(e){var t=new Array;return t.push((e.timestamp||0).toString()),t.push(this._apiKey),t.push(e.name),t.push(""),t.push(this.type(e)),t.push(e.id),t.push(JSON.stringify(e.message,this.valueFilter)),t.join(",")},e.prototype.type=function(t){var r=e.MessageTypes[t.type];return r=void 0===r?e.MessageTypes.default:r,r.toString()},e.MessageTypes={measurement:a.measurement,log:a.log,default:a.generic},e}(),f=function(){function e(e){this._environment=e}return e.prototype.parse=function(e){if(this._environment.debug)try{var t=JSON.parse(e);if(Array.isArray(t)&&t.length>0){var r=new Array;try{for(var o=n.__values(t),i=o.next();!i.done;i=o.next()){var s=i.value;r.push({description:s.errorMsg,data:this.message(s.errorLine)})}}catch(e){u={error:e}}finally{try{i&&!i.done&&(a=o.return)&&a.call(o)}finally{if(u)throw u.error}}return{message:"Errors in messages were occured.",errors:r}}}catch(e){}return;var u,a},e.prototype.message=function(e){if("string"==typeof e){var t=e.split(",",6);if(6===t.length){var r=e.match(/\{.*\}/),n=r?r[0]:void 0;return{name:t[2],type:a[+t[4]],id:t[5],payload:this.payload(n)}}}},e.prototype.payload=function(e){if(!e)return"";try{return JSON.parse(e)}catch(t){return e}},e}()},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Version="1.2.41"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(9),i=function(){function e(){this.flushTime=1e3,this.maxFlushTime=3e4}return e}(),s=function(){function e(e,t){void 0===t&&(t=null),this._repo=e,this.config=t,this._config=new i,o.override(this._config,t),this._lastFlushTime=this._config.flushTime}return e.prototype.duration=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r;return n.__generator(this,function(n){switch(n.label){case 0:return[4,this._repo.read()];case 1:return e=n.sent(),e.statistic.lastSendingSuccess?t=this._config.flushTime:(r=Math.max(e.statistic.requestErrorCount,1),t=Math.min(this._config.flushTime*r,this._config.maxFlushTime)),[2,this._lastFlushTime=t]}})})},e.prototype.syncTime=function(){return Math.max(20*this._lastFlushTime,this._config.maxFlushTime+5)},e}();t.DynamicFlushTimeStrategy=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=r(31),i=r(30),s=function(){function e(t,r){void 0===r&&(r=i.WebStorages.localStorage),this.taskId=t,this._storage=r,this._keys={x:"mcjs-mutex-x:"+t,y:"mcjs-mutex-y:"+t},this._storage&&!e.subscribed&&(e.subscribe(this._storage),e.subscribed=!0)}return e.prototype.capture=function(t){if(void 0===t&&(t=2e4),!this._storage||this._disposed)return!0;var r=this._storage,n=this._keys.x,o=this._keys.y,i=e.tabId,s=+new Date;r.setItem(n,i);var u=r.getItem(o),a=u?JSON.parse(u):null,c=a?Math.abs(s-a.time):NaN,f=!a||a.id===i||c>t;if(f){var l=JSON.stringify({id:i,time:s});r.setItem(o,l),e.allYKeys[this._keys.y]=!0}else e.allYKeys[this._keys.y]=!1;return this._isCaptured=f&&r.getItem(n)===i,this._isCaptured},e.prototype.dispose=function(){this._storage&&this._isCaptured&&!this._disposed&&(this._storage.removeItem(this._keys.y),this._isCaptured=!1,this._disposed=!0)},e.subscribe=function(t){o.UnloadEvent.addListener(function(){e.uncaptureAll(t)})},e.uncaptureAll=function(t){var r=e.allYKeys;for(var n in r)r.hasOwnProperty(n)&&r[n]&&(t.removeItem(n),r[n]=!1)},e.tabId=n.GuidProvider.default.next(),e.allYKeys={},e}();t.LocalStorageTabSyncPoint=s},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Success=0]="Success",e[e.NetworkError=1]="NetworkError",e[e.MessagesError=2]="MessagesError"}(t.AjaxRequestStatusResult||(t.AjaxRequestStatusResult={}))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(48),i=function(){function e(e){this._context=e,this._sender=new o.WorkerRequestSender("ajax",this._context.sender,this._context.receiver)}return e.prototype.send=function(e){return n.__awaiter(this,void 0,void 0,function(){var t=this;return n.__generator(this,function(r){return[2,new Promise(function(r,n){t._sender.send(e,r,n)})]})})},e}();t.PortAjaxProvider=i},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.sender=e,this.receiver=t}return e}();t.Context=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(132),i=function(){function e(e,t,r,n){this._router=e,this._postmaster=t,this._statisticAuditor=r,this._performanceAuditor=n}return e.prototype.send=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,i,s,u,a,c,f,l,d,h,c,f,p,_,v,y,g,b,m,w,x,S,P,j;return n.__generator(this,function(O){switch(O.label){case 0:t=this._performanceAuditor.started(),r=new Map;try{for(i=n.__values(e),s=i.next();!s.done;s=i.next())u=s.value,a=this._postmaster.seal(u),(c=this._router.route(a))&&(f=r.get(c),f?f.push(a):(f=[a],r.set(c,f)))}catch(e){m={error:e}}finally{try{s&&!s.done&&(w=i.return)&&w.call(i)}finally{if(m)throw m.error}}l=new Array;try{for(d=n.__values(r.keys()),h=d.next();!h.done;h=d.next())c=h.value,(f=r.get(c))&&(p=c.enqueue(f),_=this._statisticAuditor.enqueued(c.id,f),l.push([p,_]),t.enqueued(c.id,f))}catch(e){x={error:e}}finally{try{h&&!h.done&&(S=d.return)&&S.call(d)}finally{if(x)throw x.error}}O.label=1;case 1:O.trys.push([1,6,7,8]),v=n.__values(l),y=v.next(),O.label=2;case 2:return y.done?[3,5]:(g=y.value,o.isAsyncAll(g)?[4,Promise.all(l)]:[3,4]);case 3:O.sent(),O.label=4;case 4:return y=v.next(),[3,2];case 5:return[3,8];case 6:return b=O.sent(),P={error:b},[3,8];case 7:try{y&&!y.done&&(j=v.return)&&j.call(v)}finally{if(P)throw P.error}return[7];case 8:return t.completed(),[2]}})})},e}();t.Messenger=i},function(e,t,r){function n(e){if(!(e instanceof Promise))return e}function o(e){try{for(var t=i.__values(e),r=t.next();!r.done;r=t.next()){if(r.value instanceof Promise)return!0}}catch(e){n={error:e}}finally{try{r&&!r.done&&(o=t.return)&&o.call(t)}finally{if(n)throw n.error}}return!1;var n,o}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);t.sync=n,t.isAsyncAll=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e,t){this._queues=t,this._routes=i.createRoutes(e)}return e.prototype.route=function(t){var r=this.findQueue(t)||e.default,n=this._queues.get(r);return!n&&this._queues.size>0&&(n=this._queues.values().next().value),n},e.prototype.findQueue=function(e){var t=this._routes.get(e.type);if(!t||!t.length)return null;try{for(var r=n.__values(t),o=r.next();!o.done;o=r.next()){var i=o.value;if(!i.properties)return i.queue;if(this.isMatch(e.message,i.properties))return i.queue}}catch(e){s={error:e}}finally{try{o&&!o.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}}return null;var s,u},e.prototype.isMatch=function(e,t,r){if(void 0===r&&(r=10),0===r)return!0;for(var n in t)if(t.hasOwnProperty(n)){var o=e[n],i=t[n];if("object"==typeof o&&"object"==typeof i){if(!this.isMatch(o,i,r-1))return!1}else if(e[n]!==t[n])return!1}return!0},e.default="default",e}();t.Router=o;var i=function(){function e(){}return e.createRoutes=function(t){var r=new Map;try{for(var o=n.__values(t.messages),i=o.next();!i.done;i=o.next()){var s=i.value,u=r.get(s.type);u?u.push(s):(u=[s],r.set(s.type,u))}}catch(e){c={error:e}}finally{try{i&&!i.done&&(f=o.return)&&f.call(o)}finally{if(c)throw c.error}}var a=new Map;return r.forEach(function(t,r){t=t.sort(function(t,r){return e.weight(r.properties)-e.weight(t.properties)}),a.set(r,t)}),a;var c,f},e.weight=function(e,t){if(void 0===t&&(t=10),!e||t<=0)return 0;var r=0;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];"object"==typeof o?r+=this.weight(o,t-1):r++}return r},e}()},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.create=function(e,t){return new n(e?t:void 0)},e}();t.MessengerPerformanceAuditorBuilder=r;var n=function(){function e(e){this._sender=e}return e.prototype.started=function(){return this._sender,new o},e}(),o=function(){function e(){}return e.prototype.enqueued=function(e,t){},e.prototype.completed=function(){},e}()},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._pipeStorages=e}return e.prototype.enqueued=function(e,t){return this._pipeStorages.increment(e,{totalMessageCount:t.length})},e}();t.MessengerStatisticAuditor=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e){this._pipeStatsStorage=e,this._dictionary={}}return e.prototype.get=function(e){var t=this._dictionary;return t[e.id]||(t[e.id]=this.create(e))},e.prototype.create=function(e){var t={get queueMessageCount(){return e.count},get queueSize(){return e.size}};return new i(e.id,t,this._pipeStatsStorage)},e}();t.PipeStatsProvider=o;var i=function(){function e(e,t,r){this._queueId=e,this._state=t,this._pipeStatsStorage=r}return e.prototype.update=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:return t=this._state,[4,this._pipeStatsStorage.update(this._queueId,function(n){r=e({statistic:n,state:t})})];case 1:return n.sent(),[2,r]}})})},e.prototype.read=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t;return n.__generator(this,function(r){switch(r.label){case 0:return e=this._state,[4,this._pipeStatsStorage.read(this._queueId)];case 1:return t=r.sent(),[2,{statistic:t,state:e}]}})})},e}()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(4),i=r(47),s=function(){function e(e,t){this._db=e,this._clientId=t,this._recovery={}}return e.create=function(t){return void 0===t&&(t="mcjs-counters"),n.__awaiter(this,void 0,void 0,function(){var r,o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,i.IndexedDbUtils.open(t,1,function(t){t.objectStoreNames.contains(e.PipeStatisticsStorage)||t.createObjectStore(e.PipeStatisticsStorage,{keyPath:"queueId",autoIncrement:!1}),t.objectStoreNames.contains(e.ClientStorage)||t.createObjectStore(e.ClientStorage,{keyPath:"id",autoIncrement:!1})})];case 1:return r=n.sent(),[4,e.clientId(r)];case 2:return o=n.sent(),[2,new e(r,o)]}})})},e.clientId=function(t){return n.__awaiter(this,void 0,void 0,function(){var r,o;return n.__generator(this,function(n){switch(n.label){case 0:return r=t.transaction([e.ClientStorage],"readwrite").objectStore(e.ClientStorage),[4,i.IndexedDbUtils.transaction(function(){return r},function(t,r){i.IndexedDbUtils.request(t.get("default"),function(n){n||(n={id:"default",clientId:e.guid.next()},t.add(n)),r.clientId=n.clientId})},{clientId:""})];case 1:return o=n.sent(),[2,o.clientId]}})})},e.prototype.update=function(e,t){return n.__awaiter(this,void 0,void 0,function(){var r,o,s=this;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.transaction(function(n,o){i.IndexedDbUtils.request(n.get(e),function(o){o=r=s._recovery[e]||o||s.newData(e),t(o),n.put(o)})},void 0,"readwrite")];case 1:return n.sent(),this._recovery[e]=void 0,[3,3];case 2:return o=n.sent(),r||(r=this.newData(e),t(r)),this._recovery[e]=r,[3,3];case 3:return[2]}})})},e.prototype.increment=function(e,t){return this.update(e,function(e){e.totalMessageCount+=t.totalMessageCount})},e.prototype.read=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,o=this;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.transaction(function(t,r){i.IndexedDbUtils.request(t.get(e),function(t){r.stats=o._recovery[e]||t||o.newData(e)})},{stats:{}},"readonly")];case 1:return t=n.sent(),this._recovery[e]=void 0,[2,t.stats];case 2:return r=n.sent(),[2,this._recovery[e]=this.newData(e)];case 3:return[2]}})})},e.prototype.clear=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return this._recovery={},[2,this.transaction(function(e){e.clear()},void 0)]})})},e.prototype.dispose=function(){this._db.close()},e.prototype.destroy=function(){return this.dispose(),this._recovery={},i.IndexedDbUtils.remove(this._db.name)},e.prototype.newData=function(e){return{clientId:this._clientId,queueId:e,batchIndex:0,lastSendingSuccess:!0,requestErrorCount:0,totalMessageCount:0,totalRequestErrorCount:0}},e.prototype.open=function(t){return this._db.transaction([e.PipeStatisticsStorage],t).objectStore(e.PipeStatisticsStorage)},e.prototype.transaction=function(e,t,r){var n=this;return void 0===r&&(r="readwrite"),i.IndexedDbUtils.transaction(function(){return n.open(r)},e,t)},e.guid=o.GuidProvider.default,e.PipeStatisticsStorage="pipe-statistics",e.ClientStorage="client",e}();t.PipeStatsIndexedDBStorage=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(4),i=r(30),s=function(){function e(e){this._storage=e,this._regexp={},this._recovery={}}return e.create=function(t){return void 0===t&&(t=i.WebStorages.localStorage),t?new e(t):null},e.prototype.clientId=function(){var t=e._clientKey,r=this._clientId||this._storage.getItem(t);if(!r){r=o.GuidProvider.default.next();try{this._storage.setItem(t,r)}catch(e){}}return this._clientId=r},e.prototype.update=function(e,t){var r=this.key(e),n=this._recovery[r]||this.get(r)||this.new(e);this.updateIncrements(n),t(n),this.set(r,n)},e.prototype.read=function(e){var t=this.key(e),r=this._recovery[t]||this.get(t);return r||(r=this.new(e),this.set(t,r)),r},e.prototype.increment=function(e,t){var r=this.keyNonBlocked(e);this.set(r,t)},e.prototype.clear=function(){for(var t=this._storage,r=0;r<t.length;r++){var n=t.key(r);n&&0===n.indexOf(e._prefix)&&(t.removeItem(n),this._recovery[n]=void 0)}t.removeItem(e._clientKey)},e.prototype.destroy=function(){this.clear()},e.prototype.dispose=function(){},e.prototype.key=function(t){return e._prefix+t},e.prototype.keyNonBlocked=function(t){return e._notBlockedPrefix+t+"|"+Math.floor(1e5*Math.random())},e.prototype.new=function(e){return{clientId:this.clientId(),queueId:e,batchIndex:0,totalMessageCount:0,totalRequestErrorCount:0,requestErrorCount:0,lastSendingSuccess:!1}},e.prototype.get=function(e){var t=this._storage.getItem(e);if(!t)return null;try{var r=JSON.parse(t);return r&&(r.clientId=this.clientId()),r}catch(e){return null}},e.prototype.set=function(e,t){try{this._storage.setItem(e,JSON.stringify(t,function(e,t){switch(e){case"clientId":return;default:return t}})),this._recovery[e]=void 0}catch(r){this._recovery[e]=t}},e.prototype.incrementRegex=function(t){return this._regexp[t]||(this._regexp[t]=new RegExp("^"+e._notBlockedPrefix+t+"\\|\\d+$"))},e.prototype.collect=function(e){var t,r,o,i,s,u,a;return n.__generator(this,function(n){switch(n.label){case 0:t=this._storage,r=this.incrementRegex(e),o=t.length-1,n.label=1;case 1:if(!(o>=0))return[3,7];if(!(i=t.key(o)))return[3,6];if(!(s=r.test(i)))return[3,6];n.label=2;case 2:return n.trys.push([2,5,,6]),u=t.getItem(i),t.removeItem(i),u?[4,JSON.parse(u)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[3,6];case 5:return a=n.sent(),[3,6];case 6:return o--,[3,1];case 7:return[2]}})},e.prototype.updateIncrements=function(e){var t=0;try{for(var r=n.__values(this.collect(e.queueId)),o=r.next();!o.done;o=r.next()){var i=o.value;i.totalMessageCount&&(t+=i.totalMessageCount)}}catch(e){s={error:e}}finally{try{o&&!o.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}}e.totalMessageCount+=t;var s,u},e._prefix="mcjs-stats:",e._notBlockedPrefix="mcjs-stats-nb:",e._clientKey="mcjs-stats-client",e}();t.PipeStatsLocalStorage=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=function(){function e(){this.clientId=n.GuidProvider.default.next(),this._dictionary={}}return e.prototype.update=function(e,t){t(this.get(e))},e.prototype.increment=function(e,t){this.get(e).totalMessageCount+=t.totalMessageCount},e.prototype.read=function(e){return this.get(e)},e.prototype.clear=function(){this._dictionary={}},e.prototype.destroy=function(){this.clear()},e.prototype.dispose=function(){},e.prototype.get=function(e){var t=this._dictionary;return t[e]||(t[e]={clientId:this.clientId,queueId:e,batchIndex:0,totalMessageCount:0,totalRequestErrorCount:0,requestErrorCount:0,lastSendingSuccess:!1})},e}();t.PipeStatsMemoryStorage=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(78),o=function(){function e(e,t){this._guid=e,this._time=t}return e.prototype.seal=function(e){var t=e._meta;return delete e._meta,this.envelop(t,e)},e.prototype.envelop=function(e,t){var r=new n.Envelop(e.type);return r.id=this._guid.next(),r.timestamp=e.timestamp||this._time.now(),r.tabId=e.tabId,r.name=this.name(r.type,t),r.message=t,r},e.prototype.name=function(t,r){if("measurement"===t){var n=r.name;return delete r.name,n}if("log"===t){var o=e.LogLevel[r.level];return o="number"==typeof o?o:2,delete r.level,o.toString()}return t},e.LogLevel={trace:0,debug:1,info:2,warn:3,error:4,fatal:5},e}();t.Postman=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(73),o=r(49),i=r(50),s=r(51),u=r(52),a=r(142),c=function(){function e(e,t){this.terminate=new i.MandatoryResponseEmitter;var r=this.getSender(e),a=this._receiver=new o.MessageReceiver(e,t);this.context=new n.Context(r,a),this._messages=new s.WorkerEventReceiver("messages",a),this._configuration=new s.WorkerEventReceiver("configuration",a),this._terminate=new u.WorkerRequestReceiver("terminate",r,a,this.terminate),this._environment=new s.WorkerEventReceiver("environment",a)}return Object.defineProperty(e.prototype,"messages",{get:function(){return this._messages.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this._configuration.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"environment",{get:function(){return this._environment.event},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._receiver.dispose(),this._terminate.dispose(),this._messages.dispose(),this._configuration.dispose()},e.prototype.getSender=function(e){if("clients"in e){var t=e;return new a.ServiceWorkerSender(function(){return t.clients.matchAll({includeUncontrolled:!0})})}return e},e}();t.WorkerReceiver=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e){this._clients=e}return e.prototype.postMessage=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,o,i,s,u,a;return n.__generator(this,function(c){switch(c.label){case 0:return[4,this._clients()];case 1:if(t=c.sent(),0===t.length)return[2,Promise.reject("Don't see any clients")];c.label=2;case 2:c.trys.push([2,7,8,9]),r=n.__values(t),o=r.next(),c.label=3;case 3:return o.done?[3,6]:(i=o.value,[4,i.postMessage(e)]);case 4:c.sent(),c.label=5;case 5:return o=r.next(),[3,3];case 6:return[3,9];case 7:return s=c.sent(),u={error:s},[3,9];case 8:try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(u)throw u.error}return[7];case 9:return[2]}})})},e}();t.ServiceWorkerSender=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(14),o=r(53),i=function(){function e(){}return e.current=function(e){if(void 0===e&&(e=n.GlobalProvider.current()),e[o.PseudoWorkerScopeName]){var t=e[o.PseudoWorkerScopeName];return delete e[o.PseudoWorkerScopeName],t}return e},e}();t.WorkerScope=i}])});