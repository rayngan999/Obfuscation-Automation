!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PubSubBundle=t():e.PubSubBundle=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var o,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[],void 0===(i="function"==typeof(o=function(){"use strict";const t=n(1);e.exports=function(){const e=[],n=500,o="_pubsub_uuid_",r="*",i=new t;let c={},u=-1;function s(t={}){setTimeout(function(){const o=new Date;e.length>=n&&e.shift(),t.time=o,e.push(t)},0)}function l(e,t,n,o,r){try{e.call(t,o,n,r)}catch(e){const t=`PubSub Exception: ${e.message}  Stack: ${e.stack}`;return console.error?console.error(t):console.log(t)}}function f(e,t,n,o,r){e.call(t,o,n,r)}function a(e,t,n,o){const{immediateExceptions:r,metadata:u={}}=o,s=c[t],a=r?f:l;if(!c[t])return;const p=Object.keys(s);p.forEach(o=>{if(s[o]){const{callback:r,context:c,guarantee:l}=s[o];l&&i.pickup(t,l),a(r,c,e,n,u)}})}function p(e){const t=String(e);return!!c[t]&&(n=c[t],!!Object.keys(n).length);var n}function d(e,t,n,o){const{deliveryCallback:c,guarantee:u,metadata:s={}}=o,l=function(e,t,n){return function(){let o=String(e),i=o.lastIndexOf(".");for(a(e,r,t,n),a(e,e,t,n);-1!==i;)o=o.substr(0,i),i=o.lastIndexOf("."),a(e,o,t,n)}}(e,t,o),f=function(e){let t=String(e),n=p(t)||p(r),o=t.lastIndexOf(".");for(;!n&&-1!==o;)t=t.substr(0,o),o=t.lastIndexOf("."),n=p(t)||p(r);return n}(e);function d(e){return c&&c({data:t}),e}return u&&i.dropoff(e,t,u,s),f?!0===n?(l(),d(!0)):(setTimeout(function(){l(),d(!0)},0),!0):d(!1)}const b={debug:()=>({topics:c,actionsLog:e,guarantee:i.debug()}),publish:(e,t,n={})=>(s({type:"publish",topic:e}),d(e,t,!1,n)),publishSync:(e,t,n={})=>(s({type:"publishSync",topic:e}),d(e,t,!0,n)),subscribe:(e,t,n,r={})=>{let{guarantee:f}=r;if(s({type:"subscribe",topic:e}),"function"!=typeof t)return!1;if(f){const o=i.pickup(e,f);if(o){const{data:r,metadata:i}=o;setTimeout(()=>l(t,n||t,e,r,i),0)}}c[e]=c[e]||{};const a=o+String(++u);return c[e][a]={callback:t,context:n||t,guarantee:f},a},once:(e,t,n,r={})=>{s({type:"once",topic:e});const{guarantee:c}=r;if(c){const r=i.pickup(e,c);if(r){const{data:i,metadata:c}=r;return setTimeout(()=>l(t,n||t,e,i,c),0),o+String(++u)}}const f=b.subscribe(e,function(...e){b.unsubscribe(f),t.apply(n,e)},n,r);return f},subscribeAll:(e,t)=>(s({type:"subscribeAll",topic:""}),b.subscribe(r,e,t)),clearAllSubscriptions:()=>{s({type:"clearAllSubscriptions",topic:""}),c={}},clearTopicSubscriptions:e=>{s({type:"clearTopicSubscriptions",topic:e});const t=Object.keys(c);return t.forEach(t=>{c[t]&&0===t.indexOf(e)&&delete c[t]}),!1},clearContextSubscriptions:e=>(s({type:"clearContextSubscriptions",topic:e.toString()}),b.unsubscribe(e)),unsubscribe:(e,t,n)=>{const r="string"==typeof e&&e.indexOf(o)>=0,i="string"==typeof e&&!!c[e];let u=!1,l=e,f=t,a=n;if(!f&&a&&(f=a,a=null),l||(l=f,f=void 0),!l)return console.log("Invalid Use of pubsub: No parameters passed"),!1;if(s({type:"unsubscribe",topic:l.toString()}),i&&!f&&!a)return delete c[l],!0;const p=Object.keys(c);return p.forEach(function(e){const t=e,n=c[e];if(r&&n[l])return delete n[l],u=l,!0;const o=Object.keys(n);o.forEach(function(e){const o=e,r=n[e];i&&l===t?a&&r.context===a&&r.callback===f?(u=!0,delete c[t][o]):a||r.context!==f&&r.callback!==f||(u=!0,delete c[t][o]):f?l===r.callback&&f===r.context&&(u=!0,delete c[t][o]):l!==r.callback&&l!==r.context||(u=!0,delete c[t][o])})}),u}};return b}})?o.apply(t,r):o)||(e.exports=i)},function(e,t,n){var o,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[],void 0===(i="function"==typeof(o=function(){"use strict";e.exports=function(){let e={};function t(e){console.error?console.error(e):console.log(e)}return{dropoff:(n,o,r={},i={})=>{const{deliveryVerification:c,override:u=!0}=r;if(!c)return t(`Missing deliveryVerification in Will Call DropOff for topic: '${n}'`),!1;e[n]=e[n]||{};const s=Array.isArray(c)?c:[c];let l=!1;return s.forEach(r=>{const{deliveryId:c}=r;return c?e[n]&&e[n][c]&&!u?(t(`Existing Will Call DropOff for topic: '${n}' deliveryId: '${c}'`),!1):(e[n][c]={dropoffVerification:r,data:o,metadata:i},void(l=!0)):(t(`Missing deliveryId in Will Call DropOff for topic: '${n}'`),!1)}),l},pickup:(t,n={})=>{const{deliveryVerification:o={}}=n,{deliveryId:r}=o;if(e[t]&&e[t][r]&&function(e,t={},n={}){let o=!1;return e&&(o=function e(t,n){return t&&n&&"object"==typeof t&&"object"==typeof n?Object.keys(t).length===Object.keys(n).length&&Object.keys(t).reduce(function(o,r){return o&&e(t[r],n[r])},!0):t===n}(t,n)),o}(r,o,e[t][r].dropoffVerification)){const{data:n,metadata:o={}}=e[t][r];return delete e[t][r],{topic:t,deliveryId:r,data:n,metadata:o}}return null},debug:()=>Object.assign({},e)}}})?o.apply(t,r):o)||(e.exports=i)}])});