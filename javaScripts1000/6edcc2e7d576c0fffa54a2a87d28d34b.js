function initialiseSellingServiceWorker(){"serviceWorker"in navigator&&window.addEventListener("load",function(){this.navigator.serviceWorker.register("/apps/ba-selling/ba-selling-sw.js").then(function(e){console.log("SW registered: ",e)},function(e){console.log("SW Registration failed: ",e)})})}function initialiseHomeServiceWorker(){"serviceWorker"in navigator&&window.addEventListener("load",function(){this.navigator.serviceWorker.register("/apps/ba-home/ba-home-sw.js").then(function(e){console.log("SW registered: ",e)},function(e){console.log("SW Registration failed: ",e)})})}ba.lang.namespace("ba.bahome.account"),ba.bahome.account.Module=angular.module("account-panel-component",["ba-filters-contrib"]),ba.lang.namespace("ba.bahome.auth"),ba.bahome.auth.Module=angular.module("authentication",[]),ba.lang.namespace("ba.bahome.breakpointDetection"),ba.bahome.breakpointDetection.Module=angular.module("breakpoint-detection",[]),ba.lang.namespace("ba.bahome.campaign"),ba.bahome.campaign.Module=angular.module("campaign-component",[]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.Module=angular.module("content-retrieval",[]),ba.lang.namespace("ba.bahome.dynamic"),ba.bahome.dynamic.Module=angular.module("dynamic-component",[]),ba.lang.namespace("ba.bahome.footer"),ba.bahome.footer.Module=angular.module("ba-home-footer",[]),ba.lang.namespace("ba.bahome.genericDisruption"),ba.bahome.genericDisruption.Module=angular.module("generic-disruption",[]),ba.lang.namespace("ba.bahome.header"),ba.bahome.header.Module=angular.module("ba-home-header",[]),ba.lang.namespace("ba.bahome.hero"),ba.bahome.hero.Module=angular.module("hero-component",[]),ba.lang.namespace("ba.bahome.imageIndex"),ba.bahome.imageIndex.Module=angular.module("image-index-component",["ba-analytics","ba-analytics-adobe"]),ba.lang.namespace("ba.bahome.layout"),ba.bahome.layout.Module=angular.module("layout-determiner",[]),ba.lang.namespace("ba.bahome.localStorage"),ba.bahome.localStorage.Module=angular.module("local-storage",[]),ba.lang.namespace("ba.bahome.logging"),ba.bahome.logging.Module=angular.module("logging",[]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.Module=angular.module("ba-home-main",["ba-home-templates","ba-home-header","ba-home-footer","local-storage","user-determiner","layout-determiner","topic-determiner","authentication","angularXml2json","breakpoint-detection","dynamic-component","ba-content-retrieval","content-retrieval","account-panel-component","hero-component","redemption-component","campaign-component","image-index-component","generic-disruption","spinner-component","next-trip-component","pricing-component","recent-searches-component","duScroll","ngTouch","travel-toolbar","ngAnimate","ba-third-party-ads","ba-cookie","ba-moment","ba-page-load","ba-date","ba-loading"]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.Module=angular.module("next-trip-component",[]),ba.lang.namespace("ba.bahome.pricing"),ba.bahome.pricing.Module=angular.module("pricing-component",["ba-filters-contrib"]),ba.lang.namespace("ba.bahome.recentSearches"),ba.bahome.recentSearches.Module=angular.module("recent-searches-component",[]),ba.lang.namespace("ba.bahome.redemption"),ba.bahome.redemption.Module=angular.module("redemption-component",[]),ba.lang.namespace("ba.bahome.routing"),ba.bahome.routing.module=angular.module("ba-home-routing",["ui.router"]),ba.bahome.routing.module.run(["$rootScope","PreConditionService","$state","$window",function(e,t,a,n){var o=e.$on("$stateChangeStart",function(e,o,i){t.canTransition(o.name,i)||(e.preventDefault(),t.otherwise(o.name)?a.go(t.otherwise(o.name)):n.location=n.location.href.split("#")[0])});e.$on("$destroy",o)}]),ba.lang.namespace("ba.bahome.searchBar"),ba.bahome.searchBar.Module=angular.module("search-bar",["ba-searchbar","ba-typeahead"]),ba.lang.namespace("ba.bahome.spinner"),ba.bahome.spinner.Module=angular.module("spinner-component",[]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.Module=angular.module("topic-determiner",[]),ba.lang.namespace("ba.bahome.tracking"),ba.bahome.tracking.Module=angular.module("tracking",[]),ba.lang.namespace("ba.bahome.travelToolbar"),ba.bahome.travelToolbar.Module=angular.module("travel-toolbar",["ba-lang","ba-url","ba-i18n"]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.Module=angular.module("user-determiner",["feature-flags"]),ba.lang.namespace("ba.bahome.account"),ba.bahome.account.Module.constant("AccountPanelConstants",{EC:"EXECUTIVE_CLUB",BARC:"REGISTERED_CUSTOMER",PREM:"PREMIER",ONBUSINESS_LINK:"https://onbusiness.britishairways.com"}),ba.lang.namespace("ba.bahome.campaign"),ba.bahome.campaign.Module.constant("CampaignConstants",{buttonURL:{ROW:["flights-and-holidays/flights/index.page","flights-and-holidays/flights/book-with-confidence/index.page#change","information/incident/coronavirus/latest-information/index.page#cancel ","executive-club/tiers-and-benefits/index.page#vouchers","destinations/index.page","information/incident/coronavirus/latest-information/index.page#faq","information/help-and-contacts/index.page","information/the-ba-experience/welcome-on-board/index.page","information/the-ba-experience/welcome-on-board/index.page#cleaning"],GB:["flights-and-holidays/holidays/index.page","destinations/caribbean-holidays/index.page","destinations/holiday-types/city-breaks/index.page","destinations/holiday-types/all-inclusive-holidays/index.page","executive-club/tiers-and-benefits/index.page#vouchers","offers/flight-deals/index.page","information/ba-on-your-mobile/index.page","information/incident/coronavirus/latest-information/index.page#faqvoucher","information/help-and-contacts/index.page"]},imageURL:{ROW:["/assets/images/MediaHub/Media-Database/Royalty-free-RF/Holidays/Beach-Holidays/77348806_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/People/Using-Technology/53607330_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Aircraft/Other/53797283_1200x675.jpg","/assets/images/MediaHub/Media-Database/Rights-managed-RM/People/Family/am-1105-mb-ba-day-01-00457_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Hong-Kong-HKG/179105160_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Airports/Generic/874914576_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/People/Using-Technology/34326650_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Aircraft/Other/53797283_1200x675.jpg","/assets/images/MediaHub/Media-Database/Rights-managed-RM/Cabins/welcome-on-board/customer-experience-film-18_1200x675.jpg"],GB:["/cms/global/assets/images/ba_home_fallback/1200x675_holidays_530128.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Grenadines/185264892_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Portugal/Lisbon-LIS/564582647_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/St-Lucia-SLU/119065509_1200x675.jpg","/assets/images/MediaHub/Media-Database/Rights-managed-RM/People/Family/am-1105-mb-ba-day-01-00457_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Portugal/Algarve/173413945_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/People/Using-Technology/34326650_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/People/Using-Technology/53607330_1200x675.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/People/Using-Technology/34326650_1200x675.jpg"]},campaignType:{ROW:["image","image","image","image","image","image","image","image","image"],GB:["image","image","image","image","image","image","image","image","image"]}}),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.Module.constant("ContentRetrievalConstants",{PERSONALISED_BANNER:"documentType:personalised/banner",HERO_CAMPAIGN_PATH:"Campain_path:allcampaigns/always-on/home-hero-campaign",PERSONALISED_IMAGE_INDEX:"documentType:personalised/image-index",TYPE_SERIOUS:"documentType:personalised/serious-banner",SERIOUS_EVENT:'Content-Purpose_path:"disruption/serious event"',ALWAYS_ON:"Campain_path:allcampaigns/always-on",QUERY_TARGET_WORLD:"world",QUERY_TYPE_SIMPLE:"simple",PERSONALISED_CAMPAIGN:"documentType:personalised/banner",ACCOUNT_DISRUPTION_CLASS:"account",PERSONALISED_MESSAGE:'documentType:"messages/disruption"',PERSONALISED_MESSAGE_LOGGING:"documentType=messages/disruption",ACC_QUERY:"Content-Purpose_path:disruption/account",P1_QUERY:"Content-Purpose_path:disruption/Priority1",P2_QUERY:"Content-Purpose_path:disruption/Priority2",SITE_LINKS_QUERY:"documentType:furniture/globalFooter",GLOBAL_NAV_QUERY:"documentType:furniture/globalNavigation",SOCIAL_LINKS_QUERY:"documentType:contentPlatform/social-links",TC_QUERY:"id:d75db4498d6de0fe113d115a65c11064",MESSAGE_SALE:"sale-tc",MESSAGE_ACCOUNT:"account",MESSAGE_SALE_FQ:"id:d75db4498d6de0fe113d115a65c11064",MESSAGE_PURPOSE:'Content-Purpose_path:"disruption/',MESSAGE_PURPOSE_LOGGING:"Content-Purpose_path=disruption/",MESSAGE_TIER_FQ_1:"(Membership-Tier_s:zzall OR Membership-Tier_s:*",MESSAGE_TIER_FQ_2:"*)",MARKET:'Market_s:"GB"',MARKET_LIST_FQ_1:"(Market_list:",MARKET_LIST_FQ_2:"+OR+Market_list:zzglobal)",PERSONALISED_REDEMPTION:"documentType:messages/redemption",PERSONALISED_REDEMPTION_LOGGING:"documentType=messages/redemption",YES:"yes",NO:"no",CAMPAIGN_TYPE_FLAT:"flat",TRIP_TYPE_EACH_WAY:"EW",SALES_VALUE:"/Sales",AMEX_VALUE:"/AMEX",MEMBERSHIP_ALL:"Membership-Type_s:zzall",MEMBERSHIP_EXEC:"Membership-Type_s:EXEC",DT_LINK_LIST:"documentType:personalised/link-list",RECENT_SEARCH_REF:{DEP_DATE:3,RETURN_DATE:8,ORIGIN:1,RETURN:{DESTINATION:6,DEST_NAME:7,ADULT:10,CHILD:12,INFANT:13,YOUNGADULT:11,CABIN:14,MOD_DATE:15,PRICE:17},ONEWAY:{DESTINATION:3,DEST_NAME:4,ADULT:5,CHILD:7,INFANT:8,YOUNGADULT:6,CABIN:9,MOD_DATE:10,PRICE:12}},PEGA:"PEGA",CAMPAIGN:"campaign",IMAGE_INDEX:"image-index",DISALLOWED_KEYS:["hero","account-panel","next-trip","redemption"],DATA_TYPES:{P1:"Priority 1",P2:"Priority 2",ACCOUNT:"Account",LINKS:"globalFooter",SOCIAL:"social",NAV:"globalNavigation",SALES:"sales-tc"},BATCH_TOPIC_QUERY_PREFIX:"q=,fq=id:(",BATCH_TOPIC_QUERY_SUFFIX:")",OR:" OR "}),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.imageLoad=function(){return{restrict:"A",scope:{imageLoad:"@",fallback:"=?",fallbackStyle:"=?"},link:function(e,t,a){function n(e,a){var n={"background-image":"url("+e+")"};a&&(n["background-size"]=a),t.css(n),t.addClass("loaded")}var o="/cms/global/assets/images/ba_home_fallback/1200x675_flights_BA_A380_airbourne_19.jpg",i="cover";e.fallback&&(o=e.fallback),e.fallbackStyle&&(i=e.fallbackStyle),a.$observe("imageLoad",function(e){var t=new Image;t.onerror=function(){n(o,i)},t.onload=function(){n(e)},t.src=e})}}},ba.bahome.main.Module.directive("imageLoad",[ba.bahome.main.imageLoad]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.loadPageSection=function(e){return{restrict:"A",scope:{sectionTemplate:"=",topicData:"=",getDynamicContent:"=",startValue:"=?"},link:function(t,a){var n="<div data-ng-include=\"'"+t.sectionTemplate+'\'" data-ng-repeat="startValue in ['+t.startValue+']"></div>';a.append(e(n)(t))}}},ba.bahome.main.Module.directive("loadPageSection",["$compile",ba.bahome.main.loadPageSection]),ba.lang.namespace("ba.bahome.hero"),ba.bahome.hero.Module.constant("HeroConstants",{MINUTES_SECONDS_START_VALUE:59,HOURS_START_VALUE:23,COUNTDOWN_RETURN_VALUE:-1,COUNTDOWN_ADD_ZERO_BELOW:9,HOURS:"hours",ZERO_VALUE:"",CLASS_FOR_CHANGE:"change",TIME_BEFORE_ADD_CLASS:50,TIME_BEFORE_RESHOW:1,YES:!0,NO:!1,FALLBACK:{ROW:{IMAGE_PATH_SMALL:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Barcelona-BCN/894405268_960x540.jpg",IMAGE_PATH_MEDIUM:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Barcelona-BCN/894405268_1920x1080.jpg",IMAGE_PATH_LARGE:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Barcelona-BCN/894405268_1920x1080.jpg"},GB:{IMAGE_PATH_SMALL:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Barcelona-BCN/894405268_960x540.jpg",IMAGE_PATH_MEDIUM:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Barcelona-BCN/894405268_1920x1080.jpg",IMAGE_PATH_LARGE:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Barcelona-BCN/894405268_1920x1080.jpg"},INCIDENT:{IMAGE_PATH:"https://www.britishairways.com/assets/images/corporate-logo-RESTRICTED-USE-ONLY/british-airways-coat-of-arms-crest.png"}}}),ba.lang.namespace("ba.bahome.imageIndex"),ba.bahome.imageIndex.Module.constant("ImageIndexConstants",{FALLBACK_3:{FALLBACK_MORE_URL:"destinations/holiday-types/winter-sun-holidays/index.page",FALLBACK_MORE_IMAGE:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Holidays/Beach-Holidays/157380703-v1_600x337.jpg",FALLBACK_IMAGE_PATHS:["/assets/images/MediaHub/Media-Database/Royalty-free-RF/Holidays/Beach-Holidays/666361340_600x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Netherlands/Amsterdam-AMS/470121156_337x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/UAE/Dubai-DXB/1031039602_337x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Holidays/Beach-Holidays/643048052_600x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Alicante-ALC/26437137_480x270.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Fuerteventura-FUE/77538217_600x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Barcelona-BCN/683919172_337x337.jpg"],FALLBACK_URLS:["destinations/holiday-types/all-inclusive-holidays/index.page","offers/late-deals/index.page","flights-and-holidays/deals/planning-ahead/index.page#half","offers/flight-deals/index.page","low-price-finder?region=EUK","destinations/holiday-types/beach-holidays/index.page","destinations/holiday-types/city-breaks/index.page"]},FALLBACK_9:{FALLBACK_MORE_URL:"flights-and-holidays/travel-insurance/index.page",FALLBACK_MORE_IMAGE:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Icons/ba.com-iconography/png/insurance-rhs_600x337.png",FALLBACK_IMAGE_PATHS:["/assets/images/MediaHub/Media-Database/Royalty-free-RF/Icons/ba.com-iconography/png/flexible-booking-rhs_600x337.png","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Icons/ba.com-iconography/png/clean-plane-rhs_600x337.png","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Icons/ba.com-iconography/png/mask-rhs_600x337.png","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Croatia/Dubrovnik-DBV/151571823_337x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Mauritius-MRU/115081730_337x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Seychelles-SEZ/1021144884_337x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Mallorca/2119945Medium_480x480.jpg"],FALLBACK_URLS:["information/incident/coronavirus/latest-information/index.page#make","information/the-ba-experience/welcome-on-board/index.page#cleaning","information/the-ba-experience/welcome-on-board/index.page","destinations/europe/croatia/index.page","destinations/mauritius/index.page","destinations/seychelles/index.page","destinations/palma/flights-to-palma/index.page"]},FALLBACK_DEFAULT:{FALLBACK_MORE_URL:"destinations/holiday-types/winter-sun-holidays/index.page",FALLBACK_MORE_IMAGE:"/assets/images/MediaHub/Media-Database/Royalty-free-RF/Holidays/Beach-Holidays/157380703-v1_600x337.jpg",FALLBACK_IMAGE_PATHS:["/assets/images/MediaHub/Media-Database/Royalty-free-RF/Holidays/Beach-Holidays/666361340_600x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Netherlands/Amsterdam-AMS/470121156_337x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/UAE/Dubai-DXB/1031039602_337x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Holidays/Beach-Holidays/643048052_600x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Alicante-ALC/26437137_480x270.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Fuerteventura-FUE/77538217_600x337.jpg","/assets/images/MediaHub/Media-Database/Royalty-free-RF/Destinations/Spain/Barcelona-BCN/683919172_337x337.jpg"],FALLBACK_URLS:["destinations/holiday-types/all-inclusive-holidays/index.page","offers/late-deals/index.page","flights-and-holidays/deals/planning-ahead/index.page#half","offers/flight-deals/index.page","low-price-finder?region=EUK","destinations/holiday-types/beach-holidays/index.page","destinations/holiday-types/city-breaks/index.page"]},ELLIPSE_CODE:"â¦"}),ba.lang.namespace("ba.bahome.logging"),ba.bahome.logging.Module.constant("LoggingConstants",{ERRORS:[{code:"BA_HOME_001",filename:"local-storage-service.js",level:"error",message:"Error when calling clear, failed to clear local storage"},{code:"BA_HOME_002",filename:"local-storage-service.js",level:"warn",message:"Warning when calling clear, no local storage available"},{code:"BA_HOME_003",filename:"lscs-determiner.js",level:"error",message:"Error when calling lscsDeterminerProxy.getData, No response from livesite"},{code:"BA_HOME_004",filename:"lscs-determiner-proxy.js",level:"error",message:"Error when calling getData, http request failed"},{code:"BA_HOME_005",filename:"lscs-determiner.js",level:"error",message:"Error when calling lscsDeterminerTransformer.getTopicsFromLivesite, Incorrect response from livesite"},{code:"BA_HOME_006",filename:"default-determiner.js",level:"error",message:"Error when calling defaultDeterminerProxy.getData, no default data available"},{code:"BA_HOME_007",filename:"default-determiner-proxy.js",level:"error",message:"Error when calling getData, http request failed"},{code:"BA_HOME_008",filename:"lscs-determiner-transformer.js",level:"error",message:"Error when calling getTopicsFromLivesite, livesite data is incorrect format"},{code:"BA_HOME_009",filename:"local-storage-service.js",level:"warn",message:"Warn when calling remove, local storage is not available"},{code:"BA_HOME_010",filename:"url-determiner-service.js",level:"info",message:"Info when calling urlProxy.getUrlDetails, successfully obtained user from url"},{code:"BA_HOME_011",filename:"url-determiner-service.js",level:"warn",message:"Warning when calling urlProxy.getUrlDetails, failed to obtain user from url"},{code:"BA_HOME_012",filename:"idc-determiner-service.js",level:"info",message:"Info when calling idcProxy.getUserDetails, successfully obtained PSEUDO/AUTHENTICATED idc user"},{code:"BA_HOME_013",filename:"idc-determiner-service.js",level:"info",message:"Info when calling idcResponseTransformer.transformIdcDetails, successfully obtained TRACKED idc user"},{code:"BA_HOME_014",filename:"idc-determiner-service.js",level:"warn",message:"Warning when calling idcProxy.getIdcDetails, failed to obtain idc user as incorrect response"},{code:"BA_HOME_015",filename:"idc-determiner-service.js",level:"warn",message:"Warning when calling idcProxy.getIdcDetails, failed obtain idc user as no user found"},{code:"BA_HOME_016",filename:"anonymous-determiner-service.js",level:"info",message:"Info when calling determine, successfully managed to get Anonymous user"},{code:"BA_HOME_017",filename:"idc-determiner-service.js",level:"warn",message:"Warning when calling idcProxy.getUserDetails, No additional user data found"},{code:"BA_HOME_018",filename:"idc-determiner-service.js",level:"warn",message:"Warning when calling idcProxy.determine, No user data available"},{code:"BA_HOME_019",filename:"idc-determiner-service.js",level:"warn",message:"Warning when calling determineAdditionalData, successfully obtained additional user information"},{code:"BA_HOME_020",filename:"destination-names-service.js",level:"error",message:"Error when calling getDestinationName, failed to get destination list"},{code:"BA_HOME_021",filename:"ba-home-controller.js",level:"info",message:"Info when calling queryByTopicData, batch request successful, populating dynamic content"},{code:"BA_HOME_022",filename:"destination-names-service.js",level:"info",message:"Info when calling queryByTopicData, batch requests failed, falling back to asychronous approach"},{code:"BA_HOME_023",filename:"destination-names-service.js",level:"info",message:"Info when calling queryByTopicData, batch requests disabled, falling back to asychronous approach"},{code:"BA_HOME_024",filename:"price-provider-service.js",level:"info",message:"Info when calling getPricesByQuery, failed to get price data from SOLR"},{code:"BA_HOME_025",filename:"pricing-directive.js",level:"info",message:"Info when calling getPricesByQuery, unable to retrieve price content"},{code:"BA_HOME_026",filename:"price-transformer.js",level:"info",message:"Info when calling transform, failed to transform prices"},{code:"BA_HOME_027",filename:"content-duplication-handler-service.js",level:"warn",message:"Warning when calling getUniqueContentFromResponse, duplicate treatment id found"},{code:"BA_HOME_028",filename:"lscs-determiner-proxy.js",level:"error",message:"Error when LSCS service timeout"},{code:"BA_HOME_029",filename:"lscs-determiner.js",level:"error",message:"Error when setting the LSCS ruleData"},{code:"BA_HOME_ACCB_001",filename:"content-provider-service.js",level:"info",message:"Info when calling getAccountBarContent, successfully obtained links from solr"},{code:"BA_HOME_ACCB_002",filename:"content-provider-service.js",level:"error",message:"Error when calling getAccountBarContent, failed to get links from solr"},{code:"BA_HOME_ACCB_005",filename:"account-bar-transformer.js",level:"error",message:"Error when calling contentTransform, failed to transform response"},{code:"BA_HOME_CAMP_001",filename:"content-provider.js",level:"info",message:"Info when calling getCampaignContent; Displayed campaign"},{code:"BA_HOME_CAMP_002",filename:"content-provider.js",level:"error",message:"Error when calling getCampaignContent; Failed to get data from content retrieval service"},{code:"BA_HOME_CAMP_003",filename:"campaign-transformer.js",level:"warn",message:"Error when transforming campaign response; served fallback content"},{code:"BA_HOME_HERO_001",filename:"content-provider.js",level:"info",message:"Info in content-provider.js when calling getHeroContent; Displayed campaign"},{code:"BA_HOME_HERO_002",filename:"content-provider.js",level:"error",message:"Error when calling getHeroContent; Failed to get data from content retrieval service"},{code:"BA_HOME_HERO_003",filename:"hero-transformer.js",level:"warn",message:"Error when transforming hero response; served fallback content"},{code:"BA_HOME_IMG_001",filename:"content-provider.js",level:"info",message:"Info when calling getImageIndexContent; Displayed campaign"},{code:"BA_HOME_IMG_002",filename:"content-provider.js",level:"error",message:"Error when calling getImageIndexContent; Failed to get data from content retrieval service"},{code:"BA_HOME_IMG_003",filename:"image-index-transformer.js",level:"warn",message:"Error when transforming image-index response; served fallback content"},{code:"BA_HOME_MSG_001",filename:"content-provider.js",level:"info",message:"Info when calling getMessagingContent; Displayed message"},{code:"BA_HOME_MSG_002",filename:"content-provider.js",level:"info",message:"Info in when calling getMessagingContent; Failed to get data from content retrieval service"},{code:"BA_HOME_MSG_003",filename:"messaging-transformer.js",level:"warn",message:"Error when transforming messaging response"},{code:"BA_HOME_MSG_004",filename:"disruption-directive.js",level:"info",message:"Info when calling removeAndStore; Account message hidden by user"},{code:"BA_HOME_RED_001",filename:"content-provider.js",level:"info",message:"Info when calling getRedemptionContent; Displayed campaign"},{code:"BA_HOME_RED_002",filename:"content-provider.js",level:"error",message:"Error when calling getRedemptionContent; Failed to get data from content retrieval service"},{code:"BA_HOME_RED_003",filename:"redemption-transformer.js",level:"error",message:"Error when transforming redemption response; served fallback content"},{code:"BA_HOME_RCNT_001",filename:"recent-searches-controller.js",level:"info",message:"Info when calling determineAdditional, interactions could not be returned"},{code:"NG_HP_PRICING_11001",filename:"pricing-directive.js",level:"warn",message:"Error in loading currency from teamsite"},{code:"BA_HOME_BAT_001",filename:"batch-content-provider-service.js",level:"info",message:"Info when calling queryGeneralData; Successfully retrieved batch general data response"},{code:"BA_HOME_BAT_002",filename:"batch-content-provider-service.js",level:"warn",message:"Warn when calling queryGeneralData; failed to get batch general data response"},{code:"BA_HOME_BAT_003",filename:"batch-content-provider-service.js",level:"info",message:"Info when calling queryByTopicData; Successfully retrieved batch topic data response"},{code:"BA_HOME_BAT_004",filename:"batch-content-provider-service.js",level:"warn",message:"Warn when calling queryByTopicData; failed to get batch topic data response"},{code:"BA_HOME_BAT_005",filename:"batch-content-provider-service.js",level:"warn",message:"Warn when calling queryByTopicData; no topic data provided by PEGA"}]}),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.Module.constant("MainConstants",{AUTHENTICATED_STATE:"authenticated",PSEUDO_STATE:"pseudo",ANONYMOUS_STATE:"anonymous",SMALL_VIEW:"small",MEDIUM_VIEW:"medium",LARGE_VIEW:"large",SKIN_2:"2",SKIN_3:"3",SKIN_4:"4",SMALL_VIEW_LIMIT:2,LARGE_VIEW_LIMIT:3,RESOURCE_NOT_FOUND:"Resource Not Found!",II_SMALL_POD_LIMIT:3,II_LARGE_POD_LIMIT:7,II_POD_LIMIT:8,CAMPAIGN_IMAGE_TYPE:"image",CAMPAIGN_FLAT_TYPE:"flat",SKIN_2_PRODUCT_LIMIT:3,DEFAULT_PRODUCT_LIMIT:2,HERO_COMPONENT:"hero",CAMPAIGN_COMPONENT:"campaign",IMAGE_INDEX_COMPONENT:"image_index",REDEMPTION_COMPONENT:"redemption",MESSAGE_COMPONENT:"message",PAGE_LOAD_EVENT_TYPE:"page_load",COMPONENT_LOAD_EVENT_TYPE:"component_load",CLICK_EVENT_TYPE:"click",APPLICATION_STATE_DEFAULT:"default",APPLICATION_STATE_TRIPS:"trips",MORE_TITLE:"moreTitle",NEXT_TRIP:"next-trip",MIN_REMAINING_DAYS:0,MAX_REMAINING_DAYS:365,PRIORITY_TRIPS_STATE:"home.priorityTrips",TOPIC_TYPE_LSCS:"lscs",TOPIC_TYPE_SIMPLE:"simple",TOPIC_TYPE_CONTENT:"contentSearch",CAMPAIGN_FALLBACK_LIMIT:7,CAMPAIGN_FALLBACK_LIMIT_INCIDENT:3,EC:"EXECUTIVE_CLUB",BARC:"BARC",SOLR_QUERY_ID_PREFIX:"q=id:",ERROR_CODE:"BADOTCOMADAPTER_PAA_9007",ERROR_CODE_INVALID_DEEPLINK_URL:"NG_FS_10137",ERROR_CODE_FLIGHT_FLOWN:"NG_FS_10138",CONTENT_POS_ADD:1,CORPORATE_BOOKING:"CORPORATE_BOOKING",CONCUR_USER:"CONCUR_USER",COOKIE_PATH:"/",loginTypes:{DEFAULT:"public",EXECUTIVE_CLUB:"execclub",PREMIER:"premier",REGISTERED_CUSTOMER:"barc"}}),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.Module.constant("NextTripConstants",{FLIGHT_STATUS_ONTIME:"On Time",FLIGHT_STATUS_DELAYED:"Delayed",BLANK_SEAT_NUMBER:"__",CHECKIN_STATUS:{TOO_EARLY:"TOO_EARLY",OPEN:"OPEN",CANCELLED:"CANCELLED",IN_PROGRESS:"IN_PROGRESS",COMPLETE:"COMPLETE",OPENS_ON:"CLOSED",UNAVAILABLE:"UNAVAILABLE",CLOSED:"CLOSED"},PAGE_ID:{APIS:"apis",MMB:"managebooking",COMPLETED:"managebooking",OPEN:"managebooking",PROGRESS:"managebooking",CANCELLED:"managebooking",CHANGE_SEAT:"change-seat"},TIMER_INTERVAL:1e3,TEAMSITE_IMAGE_PATH:"/images/destinations/ios/",IMAGE_FILE_SUFFIX:"-p8-1.jpg",IMAGE_FILE_PREFIX:"/p8/ios-",DATE_FORMAT:"dd/MM/yyyy",TIMER_EXPIRED:"timerExpired",NEXT:"next",FUTURE:"future",SHOW_SEAT_NUMBER:"showSeatNumber",MMB_LINK_OBJECTS:{START_CHECKIN:{ID:"start-checkin",EID:"104510",DESCRIBED_BY:"start-checkin",KEY:"startCheckIn"},CONTINUE_CHECKIN:{ID:"continue-checkin",EID:"104510",DESCRIBED_BY:"continue-checkin",KEY:"continueCheckIn"},MMB:{ID:"manage-this-booking",EID:"104002",DESCRIBED_BY:"manage-this-booking",KEY:"mmbCta"},CHANGE_SEAT:{ID:"change-seat",EID:"104005",DESCRIBED_BY:"change-seat",KEY:"changeSeat"},CHOOSE_SEAT:{ID:"choose-seat",EID:"104005",DESCRIBED_BY:"choose-seat",KEY:"chooseSeat"}},MMB_DEEPLINK_AUTH:"&Directional_Authentication=/main/mmbproxy?appName=shoppingBasket"}),ba.lang.namespace("ba.bahome.pricing"),ba.bahome.pricing.Module.constant("PricingConstants",{LAYOUT_TYPE:{FLIGHTS:"flights",FLIGHTS_CLASS:"flightsClass",FLIGHTS_DEST_TRAVEL:"flightsDestTravel",FLIGHTS_DEST:"flightsDest",FLIGHTS_LAST:"flightsLast",FLIGHTS_CHEAP:"flightsCheap",HOTELS:"hotels",CARS:"cars",DEST_HOLS:"destHolidays",DEST_BREAKS:"destBreaks",DEST_NIGHT_HOLS:"destNightHols",DEST_NIGHT_BREAKS:"destNightBreaks",FLIGHT_NIGHTS:"flightNights",DEST_FLIGHT_NIGHT_BREAKS:"destFlightNightBreaks",DEST_FLIGHT_NIGHT_HOLS:"destFlightNightHols",DEST_FLIGHT_HOTEL:"destFlightHotel",FLIGHT_CARS:"flightCars",FLIGHT_CARS_DEST:"flightCarsDest",FLIGHT_CARS_DEST_CLASS:"flightCarsDestClass",FLIGHT_CARS_FLY_DRIVE:"flightCarsFlyDrive"},TEXT_KEY:{FLIGHTS:"flights",FLIGHTS_CLASS:"flights-in-class",FLIGHTS_DEST_TRAVEL:"flights-in-class-destination",FLIGHTS_DEST:"flights-to-dest",FLIGHTS_LAST:"last-minute-flights",FLIGHTS_CHEAP:"cheapest-flights",HOTELS:"nights-hotel",CARS:"car-hire",DEST_HOLS:"flight-hotel-dest-hols",DEST_BREAKS:"flight-hotel-dest-break",DEST_NIGHT_HOLS:"flight-hotel-dest-nights-hols",DEST_NIGHT_BREAKS:"flight-hotel-dest-nights-break",FLIGHT_NIGHTS:"flight-hotel-nights-hotel",DEST_FLIGHT_NIGHT_BREAKS:"flight-hotel-dest-class-break",DEST_FLIGHT_NIGHT_HOLS:"flight-hotel-dest-class-hols",DEST_FLIGHT_HOTEL:"flight-hotel-dest-class-hotel",FLIGHT_CARS:"flight-cars",FLIGHT_CARS_DEST:"flight-cars-dest",FLIGHT_CARS_DEST_CLASS:"flight-cars-dest-class",FLIGHT_CARS_FLY_DRIVE:"flight-cars-fly-drive",FLIGHTS_LINK_SIMPLE:"simple-flights-link",FLIGHTS_LINK:"flights-link",HOTELS_LINK:"hotels-link",CARS_LINK:"cars-link",CARS_FLIGHT_LINK:"cars-flight-link"},TEXT_KEY_M:{FLIGHTS:"flights",FLIGHTS_CLASS:"flights-in-class-m",FLIGHTS_DEST_TRAVEL:"flights-in-class-destination-m",FLIGHTS_DEST:"flights-to-dest",FLIGHTS_LAST:"last-minute-flights",FLIGHTS_CHEAP:"cheapest-flights",HOTELS:"nights-hotel",CARS:"car-hire",DEST_HOLS:"flight-hotel-dest-hols-m",DEST_BREAKS:"flight-hotel-dest-break-m",DEST_NIGHT_HOLS:"flight-hotel-dest-nights-hols-m",DEST_NIGHT_BREAKS:"flight-hotel-dest-nights-break-m",FLIGHT_NIGHTS:"flight-hotel-nights-hotel-m",DEST_FLIGHT_NIGHT_BREAKS:"flight-hotel-dest-class-break-m",DEST_FLIGHT_NIGHT_HOLS:"flight-hotel-dest-class-hols-m",DEST_FLIGHT_HOTEL:"flight-hotel-dest-class-hotel-m",FLIGHT_CARS:"flight-cars",FLIGHT_CARS_DEST:"flight-cars-dest",FLIGHT_CARS_DEST_CLASS:"flight-cars-dest-class",FLIGHT_CARS_FLY_DRIVE:"flight-cars-fly-drive",FLIGHTS_LINK_SIMPLE:"simple-flights-link",FLIGHTS_LINK:"flights-link",HOTELS_LINK:"hotels-link",CARS_LINK:"cars-link",CARS_FLIGHT_LINK:"cars-flight-link"},LINK_TYPE:{LPFOVERRIDE:"LPF",FLIGHTS:"lowPriceFinderFilter",HOLIDAYSOVERRIDE:"holidayFinder",HOLIDAYS:"holidayFinderFilter",HOLIDAYSDATEOVERRIDE:"holidayFinderDate",FXOVERRIDE:"FX",FXFILTER:"flightSellingFilter",DEEPLINKOVERRIDE:"deepLink"},FIRST_CLASS:"First",ECONOMY_CODE:"M",TRIP_TYPE_RETURN:"RT",TRIP_TYPE_PP:"PP",LINK_SOURCE:"BA-HOME",HERO:"hero",BA_CURRENCY:"baExtendedCurrency",LOG_CURRENCY_ERROR:"NG_HP_PRICING_11001",SMALL_SCREEN:"small",LONG_PRICE_CHAR_LIMIT:8,LONG_PRICE:"long-price",SHORT_PRICE:"short-price"}),ba.lang.namespace("ba.bahome.redemption"),ba.bahome.redemption.Module.constant("RedemptionConstants",{FALLBACK_BUTTON_URL:"redeem/execclub/_gf",FALLBACK_MESSAGE_URL:"flightfinder/execclub/_gf?eId=100001"}),ba.lang.namespace("ba.bahome.routing"),ba.bahome.routing.module.config(["$urlRouterProvider","$stateProvider",function(e,t){"use strict";e.otherwise("/"),t.state("home",{url:"?errorCode&membership&topics&pengine&layout&forceCountry?source","abstract":!0,views:{"header@":{controller:"BaHeaderController",controllerAs:"header",templateUrl:"ba-home/templates/header-view.html"
},"content@":{controller:"BaHomeController",controllerAs:"main",templateUrl:"ba-home/templates/main-layout-template.html"},"footer@":{controller:"BaFooterController",controllerAs:"footer",templateUrl:"ba-home/templates/footer-view.html"},"searchbar@home":{controller:"SearchBarController",controllerAs:"SC",templateUrl:"ba-home/templates/search-bar-view.html"}},resolve:{$pageId:function(){return"HOME"},$title:["ResourceBundle",function(e){return e.get("homePageTitle")}],isBeta:["BetaCheckService",function(e){return e.checkBetaQualification()}],GeoLoc:["GeoService",function(e){return e.setGeoLoc()}]}}),t.state("home.first",{url:"/",templateUrl:"ba-home/templates/first-template.html"}),t.state("home.second",{url:"/",templateUrl:"ba-home/templates/second-template.html"}),t.state("home.incident",{url:"/",templateUrl:"ba-home/templates/incident-template.html"})}]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.BetaCheckService=function(e,t,a,n,o,i,r,s,c){this.$q=e,this.$http=t,this.$window=o,this.requestTimeout=a,this.environment=i,this.betaUser=n.getCookieValue("betaUser"),this.url=r.createURLSegmentation(this.$window.location.href),this.local=this.url.local||"en-gb",this.loggedOnState=s.isLoggedOn(),this.country=c.getCountry().toUpperCase(),this.language=c.getLanguage().toUpperCase(),this.betaUser?this.betaUser>1e3&&this.betaUser<=1100&&(this.betaUser=this.betaUser-1e3,n.setCookie("betaUser",this.betaUser,"/",!0,365,"days")):(this.betaUser=Math.floor(100*Math.random())+1,n.setCookie("betaUser",this.betaUser,"/",!0,365,"days"))},ba.bahome.main.BetaCheckService.prototype.checkBetaQualification=function(){var e=this.$q.defer(),t=this,a=t.environment.get("BA_BETA_ENABLED",!0);return t.getThreshold().then(function(n){-1===t.$window.location.href.indexOf("/travel/home")?"false"!==a?t.betaUser<=n&&n>0&&t.checkLocale()||2e3===t.betaUser?e.resolve(!0):t.$window.location.href="/travel/home/public/"+t.language.toLowerCase()+"_"+t.country.toLowerCase():t.$window.location.href="/travel/home/public/"+t.language+"_"+t.country:e.resolve(!0)}),e.promise},ba.bahome.main.BetaCheckService.prototype.checkLocale=function(){var e=this;return!e.morphCountryList||-1===e.morphCountryList.indexOf(e.country)&&-1===e.morphCountryList.indexOf("ALL")?e.languageList&&-1===e.languageList.indexOf(e.language)?!1:!e.countryList||-1!==e.countryList.indexOf(e.country)&&-1===e.countryList.indexOf("ALL")||-1!==e.countryList.indexOf("ALL")&&-1===e.countryList.indexOf(e.country)?!0:!1:!1},ba.bahome.main.BetaCheckService.prototype.checkFlightOnly=function(){var e=this;return e.flightOnlyList&&-1!==e.flightOnlyList.indexOf(e.country)?!0:!1},ba.bahome.main.BetaCheckService.prototype.getThreshold=function(){var e=this.$q.defer(),t=this;return this.$http({method:"GET",url:"/beta/beta_threshold.jsp",timeout:t.requestTimeout.getTimeout(3e3)}).then(function(a){a.data.betaThreshold>=0&&a.data.betaThreshold<=100&&!isNaN(a.data.betaThreshold)?(a.data.betaLanguage&&(t.languageList=a.data.betaLanguage),a.data.betaCountry&&(t.countryList=a.data.betaCountry),a.data.foMarket&&(t.flightOnlyList=a.data.foMarket),a.data.morphCountry&&(t.morphCountryList=a.data.morphCountry),e.resolve(a.data.betaThreshold)):e.resolve(0)})["catch"](function(){e.resolve(100)}),e.promise},ba.bahome.main.Module.service("BetaCheckService",["$q","$http","RequestTimeout","BACookieService","$window","Environment","URLFormulationService","BAAuthenticationService","ClientLocaleService",ba.bahome.main.BetaCheckService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.CommonService=function(e,t,a,n,o,i,r,s,c,l,m,u,d){this.injector=e,this.state=t,this.rootScope=a,this.q=n,this.stateParams=o,this.document=i,this.log=r,this.BALog=u,this.Moment=s,this.environment=c,this.location=l,this.analytics=m,this.resources=d,this.setupUserDetails=function(e,t){e&&e.personalAttributes&&("EXECUTIVE_CLUB"===e.personalAttributes.customerType||"PREMIER"===e.personalAttributes.customerType)?(t.analyticsTrackingService.setAttribute("exec_club_member",!0),t.analyticsTrackingService.setAttribute("exec_club_tier",e.loyalty.tier),t.analyticsTrackingService.setAttribute("avios_ponts",t.formatValue(e.loyalty.individualAccountBalance)),t.analyticsTrackingService.setAttribute("tierpoints",t.formatValue(e.loyalty.pointsBalance)),t.analyticsTrackingService.setAttribute("lifetimepoints",t.formatValue(e.loyalty.lifeTimeTierPoints))):(t.analyticsTrackingService.setAttribute("exec_club_member",!1),t.analyticsTrackingService.setAttribute("exec_club_tier",null),t.analyticsTrackingService.setAttribute("avios_ponts",null),t.analyticsTrackingService.setAttribute("tierpoints",""),t.analyticsTrackingService.setAttribute("lifetimepoints",""))}},ba.bahome.main.Module.service("CommonService",["$injector","$state","$rootScope","$q","$stateParams","$document","LoggingHelperService","Moment","Environment","$location","analytics","BALog","ResourceBundle",ba.bahome.main.CommonService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.CurrencyDetailsService=function(e){this.currencyService=e},ba.bahome.main.CurrencyDetailsService.prototype.getCurrency=function(e){return this.currencyService.getCurrencyDetails(e,[{serverErrorCode:"*",displayType:"disabled"}]).then(function(e){return e})},ba.bahome.main.Module.service("CurrencyDetailsService",["CurrencyService",ba.bahome.main.CurrencyDetailsService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.DestinationNamesService=function(e,t,a,n){this.$q=e,this.$http=t,this.url="/api/sc4/csdm-plm/rs/v1/productlocations;searchText=",this.log=a.log,this.$filter=n},ba.bahome.main.DestinationNamesService.prototype.getDestinationName=function(e){var t,a=this,n=a.$q.defer(),o=e;return t=function(i,r){i&&i.data&&i.data.locations[r]?i.data.locations[r].cityDetails&&i.data.locations[r].cityDetails.code===e?(o=a.$filter("titlecase")(i.data.locations[r].cityDetails.name),n.resolve(o)):i.data.locations[r].airportDetails&&i.data.locations[r].airportDetails.iataCode===e?(o=a.$filter("titlecase")(i.data.locations[r].airportDetails.name)+" ("+a.$filter("titlecase")(i.data.locations[r].cityDetails.name)+")",n.resolve(o)):t(i,r+1):n.resolve(e)},a.$http({method:"GET",url:a.url+e}).then(function(e){t(e,0)})["catch"](function(){a.log.generateLogByCode("BA_HOME_020"),n.resolve(e)}),n.promise},ba.bahome.main.Module.service("DestinationNamesService",["$q","$http","CommonService","$filter",ba.bahome.main.DestinationNamesService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.EnvironmentModel=function(e,t){this.$q=e,this.url=t},ba.bahome.main.EnvironmentModel.prototype.isLiveEnvironment=function(){var e=this.$q.defer();return"ba"!==this.url.host()&&"britishairways"!==this.url.host()?e.resolve("sub-live environment"):e.reject("live environment"),e.promise},ba.bahome.main.Module.service("EnvironmentModel",["$q","$location",ba.bahome.main.EnvironmentModel]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.GetLocalDataService=function(e,t){this.$q=e,this.$http=t},ba.bahome.main.GetLocalDataService.prototype.getLocalDataByName=function(e){var t=this.$q.defer();return this.$http({method:"GET",url:"/apps/ba-home/data/"+e+".json"}).then(function(e){t.resolve(e.data)})["catch"](function(){t.reject()}),t.promise},ba.bahome.main.Module.service("GetLocalDataService",["$q","$http",ba.bahome.main.GetLocalDataService]),ba.bahome.main.ParseHtmlEntities=function(){this.entityNumber=""},ba.bahome.main.ParseHtmlEntities.prototype.get=function(e){var t=this;return e.replace(/&#([0-9]{1,3});/gi,function(e,a){return t.entityNumber=parseInt(a,10),String.fromCharCode(t.entityNumber)})},ba.bahome.main.Module.service("ParseHtmlEntities",[ba.bahome.main.ParseHtmlEntities]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.PlatformDetectionService=function(){var e={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return e.Android()||e.BlackBerry()||e.iOS()||e.Opera()||e.Windows()}};this.getPlatform=function(){return e.any()?"MOBILE":"DESKTOP"},this.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},this.isChrome=function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}},ba.bahome.main.Module.service("PlatformDetectionService",[ba.bahome.main.PlatformDetectionService]),ba.lang.namespace("ba.bahome.routing.services"),ba.bahome.routing.services.PreConditionService=function(){this.preConditions={}},ba.bahome.routing.services.PreConditionService.prototype.registerPreCondition=function(e,t,a){var n;if(!e||"string"!=typeof e)throw"Must provide state name";if(!(t&&t instanceof Function))throw"Must provide transitionEvaluator";for(n in this.preConditions)if(this.preConditions.hasOwnProperty(n)&&n===e)throw"Pre-condition already registered";this.preConditions[e]={transitionEvaluator:t,otherwise:a}},ba.bahome.routing.services.PreConditionService.prototype.canTransition=function(e,t){return this.preConditions[e]?this.preConditions[e].transitionEvaluator(t):!0},ba.bahome.routing.services.PreConditionService.prototype.otherwise=function(e){return this.preConditions[e].otherwise||""},ba.bahome.routing.module.service("PreConditionService",[ba.bahome.routing.services.PreConditionService]),ba.lang.namespace("ba.bahome"),angular.module("ba-q-decorator",[]).config(["$provide",function(e){"use strict";e.decorator("$q",["$delegate",function(e){var t,a,n=e;return n.allSettled=n.allSettled||function(e){return t=angular.isArray(e)?[]:{},a=function(e){return n.when(e).then(function(e){return{state:"fulfilled",value:e}},function(e){return{state:"rejected",reason:e}})},angular.forEach(e,function(e,n){t.hasOwnProperty(n)||(t[n]=a(e))}),n.all(t)},n}])}]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.QueryParamTransformer=function(){var e=function(e){var t,a=[],n={};for(-1!==e.terms.indexOf(",")?a=e.terms.split(","):a.push(e.terms),n.q=a[0].slice(2),n.fq=[],t=1;t<a.length;t++)n.fq.push(a[t].slice(3));return n};return{transform:function(t){return new e(t)}}},ba.bahome.main.Module.factory("QueryParamTransformer",[ba.bahome.main.QueryParamTransformer]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.SaleTcService=function(e){this.isSale=!1,this.defer=e.defer()},ba.bahome.main.SaleTcService.prototype.getSaleStatus=function(){return this.defer.promise},ba.bahome.main.SaleTcService.prototype.setSaleStatus=function(){this.isSale=!0,this.defer.resolve(this.isSale)},ba.bahome.main.Module.service("SaleTcService",["$q",ba.bahome.main.SaleTcService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.ServerTimeService=function(e,t,a,n,o){this.$q=e,this.$http=t,this.environment=a,this.clientTimeLoad=null,this.serverTimeLoad=new Date(this.environment.get("BA_PAGE_LOAD_DATETIME")).getTime(),this.isCorporateBooking=!1,this.concurDataResolved=!0,this.showConcurTab=n.getAccessToken()&&n.getCookieValue(o.CONCUR_USER)?n.getCookieValue(o.CONCUR_USER):!1},ba.bahome.main.ServerTimeService.prototype.getTime=function(){var e,t,a;return a=(new Date).getTime(),e=a-this.clientTimeLoad,t=0!==this.serverTimeLoad?this.serverTimeLoad+e:a},ba.bahome.main.Module.service("ServerTimeService",["$q","$http","Environment","BACookieService","MainConstants",ba.bahome.main.ServerTimeService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.StringLimitService=function(){this.stringLimit=function(e,t){var a=e.slice(0,t),n=a.lastIndexOf(" ");return a=a.slice(0,n),a+"..."}},ba.bahome.main.Module.service("StringLimitService",[ba.bahome.main.StringLimitService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.SymbolLookupService=function(e){return{getValues:{locale:e.getLanguage()+"-"+e.getCountry()},getSymbol:{USD:"&#36;",GBP:"&#163;",YEN:"&#165;",EUR:"&#8364;"}}},ba.bahome.main.Module.service("SymbolLookupService",["ClientLocaleService",ba.bahome.main.SymbolLookupService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.RequestTimeout=function(e,t){this.$q=e,this.$timeout=t},ba.bahome.main.RequestTimeout.prototype.getTimeout=function(e){var t=this.$q.defer(),a=e||5e3;return this.$timeout(function(){t.resolve(void 0)},a),t.promise},ba.bahome.main.Module.service("RequestTimeout",["$q","$timeout",ba.bahome.main.RequestTimeout]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.Module.constant("TopicConstants",{PEGA_TOPIC_TYPE:"contentSearch",PEGA_SEARCH_TERMS_PREFIX:"q=id:",CAMPAIGN:"campaign",INDEX:"image-index",BANNER:"banner",PROPOSITIONS_PATH:"/badotcomadapter-bdca/rs/v1/propositions;channel=ba.com;platform=homepage;",TRACKING_PARAM:"trackingId=",COUNTRY_PARAM:";country=",LANGUAGE_PARAM:";language=",PROPOSITION_DOC_TYPE:"omni-channel/bacom-propositions",AUTHENTICATED:"authenticated",TOPIC_LIMIT:{"default":8,first:8,second:10},RULE:"home-app/GeneratedMasterRule.rule",DETERMINERS:{URL:"URLDeterminerService",PEGA:"PegaDeterminerService",LSCS:"LSCSDeterminerService",DEFAULT:"DefaultDeterminerService"},ACCOUNT_PANEL:{id:"account-panel",type:"simple",container:2},REDEMPTION:{id:"redemption",type:"simple",SLOT:7,INDEX:6},HERO:{id:"hero",type:"contentSearch",source:"lscs",terms:"q=Campain_path:allcampaigns/always-on/home-hero-campaign"},SERIOUS_INCIDENT:{CAMPAIGN:{id:"campaign",type:"contentSearch",source:"lscs",terms:'q=documentType:personalised/serious-banner,fq=!Content-Purpose_path:"disruption/serious event"',notLoaded:!1},HERO:{id:"hero",type:"contentSearch",source:"lscs",terms:'q=documentType:personalised/serious-banner,fq=Content-Purpose_path:"disruption/serious event"'},LAYOUT:"incident"}}),ba.lang.namespace("ba.bahome.travelToolbar"),ba.bahome.travelToolbar.Module.constant("TravelToolbarConstants",{MMB_VALUE:"MMB",OLCI_VALUE:"OLCI",RTAD_VALUE:"RTAD",MMB_BUTTON:"PHP-MMB-button",OLCI_BUTTON:"PHP-OLCI-button",RTAD_BUTTON:"PHP-RTAD-button",FS_BUTTON:"PHP-flightstatus-button",SMALL:"small"}),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.Module.constant("UserConstants",{TIER_LEVEL_PREFIX:"EXECUTIVE_",LOYALTY:"loyalties",LOYALTY_RECENT:"loyaltyRecentTransaction",PERSONAL_ATTRS:"personalAttributes",INTERACTIONS:"interactions",NEXT_TRIP:"nextTrip",FULFILLED:"fulfilled",IDC:"idc",PSEUDO:"pseudo",AUTHENTICATED:"authenticated",TRACKED:"tracked",CONCUR_BOOKING:"CONCUR_BOOKING",CORPORATE_BOOKING:"CORPORATE_BOOKING",CONCUR_USER:"CONCUR_USER",COOKIE_PATH:"/",SECONDS:"seconds",CORPORATEBOOKING:"corporateBooking"}),ba.lang.namespace("ba.bahome.account"),ba.bahome.account.accountPanelComponent=function(e,t,a,n,o,i,r,s,c,l,m){return{scope:{userData:"=",contentPosition:"@"},restrict:"A",link:function(u){var d,g,h,p,b,T=e.isLoggedOn(),f=i.getLockedStatus(),C=c;u.userCountry=l.getCountry(),u.ECMEMBER=t.EC,u.BARCMEMBER=t.BARC,u.errorType="",u.showExecDetails=!1,u.onBusinessLink=t.ONBUSINESS_LINK,u.accountContent={},u.tncAllowLogonCookie=i.getCookieValue("tncAccept"),void 0===u.tncAllowLogon&&(u.tncAllowLogon=void 0!==u.tncAllowLogonCookie?u.tncAllowLogonCookie:!0,i.removeCookie("tncAccept","/")),d=s.generateBanParamObj(u.accountContent,C.typeCodes.account,u.contentPosition),g=s.generateParamString(d),s.triggerImpression(g),b=function(e,t){return e?(e.clickPosition=t,s.click(s.generateParamString(e))):void 0},u.userData&&("authenticated"===u.userData.state||T)&&!f&&u.tncAllowLogon?(u.trackingDataMyAccount=b(d,C.clickPosCodes.callToAction+"2"),u.trackingDataJoin=b(d,C.clickPosCodes.callToAction+"3"),u.userData.personalAttributes.customerType!==t.EC&&u.userData.personalAttributes.customerType!==t.PREM||!u.userData.loyalty.tier?u.userData.personalAttributes.customerType===t.BARC?u.contentUrl="ba-home/templates/barc-logged-in.html":(u.userData.loyalty.tier="",u.contentUrl="ba-home/templates/error-logged-in.html"):u.contentUrl="ba-home/templates/exec-logged-in.html"):(u.trackingDataInfo=b(d,C.clickPosCodes.link+"1"),u.trackingDataForgotten=b(d,C.clickPosCodes.link+"2"),u.trackingDataOnbusiness=b(d,C.clickPosCodes.link+"3"),u.trackingDataRegister=b(d,C.clickPosCodes.callToAction+"1"),u.contentUrl="ba-home/templates/login-form.html"),u.authenticate=function(e,t){u.usernameAttempt=e,e&&""!==e&&t&&""!==t?(a.$emit("account-panel-logon"),m.logOn(e,t,!1)):(u.blurUpdateField(e,"messageuser"),u.blurUpdateField(t,"messagepass"))},h=a.$on(n.LOG_ON_FAILED,function(){u.usernameAttempt?(u.errorType="password",r.trackEvent("Session",{loginfail:"true",interaction:"PHP-Login-Panel"})):r.trackEvent("Session",{loginfail:"true",interaction:"PHP-Login-Top"})}),p=a.$on(n.LOCKED,function(e,t){t.indexOf("LOCK-LEVEL-2")>-1?u.errorType="locked":t.indexOf("LOCK-LEVEL-1")>-1&&(o.location.href=URLFormulationService.formBATeamsiteURL("loginr")),r.trackEvent("Session",{loginfail:"true"})}),u.$on("$destroy",h),u.$on("$destroy",p),u.blurUpdateField=function(e,t){u[t]=!1,e&&""!==e||(u[t]=!0)},u.toggleAviosInformation=function(){u.showModal=!u.showModal}},templateUrl:"ba-home/templates/account-panel-wrapper.html"}},ba.bahome.account.Module.directive("accountPanelComponent",["BAAuthenticationService","AccountPanelConstants","$rootScope","AuthenticationConstants","$window","BACookieService","analytics","BanTrackingHelper","BanConstants","ClientLocaleService","CustomerLoginService",ba.bahome.account.accountPanelComponent]),ba.lang.namespace("ba.bahome.account"),ba.bahome.account.AccountPanelViewModel=function(e){this.build=function(){return e}},ba.bahome.account.Module.service("AccountPanelViewModel",["UserDataModel","NextTripConstants",ba.bahome.account.AccountPanelViewModel]),ba.lang.namespace("ba.bahome.breakpointDetection"),ba.bahome.breakpointDetection.watchResize=function(e,t,a){var n=this;return this.breakpointDetectionService=a,{restrict:"A",scope:{},link:function(a){a.getBreakpoint=function(){a.windowView=n.breakpointDetectionService.getBreakpoint().view},a.getSize=function(){t.cancel(a.resizing),a.resizing=t(function(){a.getBreakpoint()},100)},angular.element(e).on("resize",function(){a.getSize()}),a.getBreakpoint()}}},ba.bahome.breakpointDetection.Module.directive("watchResize",["$window","$timeout","BreakpointDetectionService",ba.bahome.breakpointDetection.watchResize]),ba.lang.namespace("ba.bahome.breakpointDetection"),ba.bahome.breakpointDetection.BreakpointDetectionService=function(e,t){var a=this;return this.$window=e,this.$document=t,{getBreakpoint:function(){var e,t=a.$window.innerWidth||a.$document.documentElement.clientWidth||a.$document.body.clientWidth,n={0:"small",641:"medium",1025:"large"},o={size:null,view:null};for(e in n)t>e&&(o.size=t,o.view=n[e]);return o}}},ba.bahome.breakpointDetection.Module.factory("BreakpointDetectionService",["$window","$document",ba.bahome.breakpointDetection.BreakpointDetectionService]),ba.lang.namespace("ba.bahome.campaign"),ba.bahome.campaign.campaignComponent=function(e,t,a,n,o,i,r){return{scope:{getContent:"&",skin:"@",contentPosition:"@",notLoaded:"=?"},restrict:"A",link:function(s,c){var l,m,u,d=i,g=c.prop("offsetTop")-r.innerHeight;s.loading=!0,e.when(s.getContent()).then(function(e){var i=n.getBreakpoint();s.campaignContent=e,s.campaignContent.contentPosition=s.contentPosition,s.campaignContent.incidentFallback&&(s.notLoaded=!0),s.campaignContent.campaignType===a.CAMPAIGN_IMAGE_TYPE&&s.campaignContent.imgSrc&&s.campaignContent.imgSrc[i.view]&&(s.tempImage=t("imgFilter")(s.campaignContent.imgSrc[i.view]),r.addEventListener("scroll",function(){g=c.prop("offsetTop")-r.innerHeight,u=r.pageYOffset,u>=g&&!s.loadImage&&s.$apply(function(){var e=new Image;e.onload=function(){s.imageURL=s.tempImage,s.$digest()},e.src=s.tempImage,s.loadImage=!0})}),g=c.prop("offsetTop")-r.innerHeight,u=r.pageYOffset,u>=g&&(s.loadImage=!0,s.imageURL=s.tempImage)),s.campaignContent.skin=s.skin,m=o.generateBanParamObj(s.campaignContent,d.typeCodes.campaign,s.contentPosition),l=o.generateParamString(m),o.triggerImpression(l),s.campaignContent.buttonShow?m.clickPosition=d.clickPosCodes.callToAction+"1":m.clickPosition=d.clickPosCodes.link+"1",l=o.generateParamString(m),s.trackingData=o.click(l),s.loading=!1}),s.skin===a.SKIN_2||s.skin===a.SKIN_3?s.limit=a.SKIN_2_PRODUCT_LIMIT:s.limit=a.DEFAULT_PRODUCT_LIMIT},templateUrl:"ba-home/templates/campaign-view.html"}},ba.bahome.campaign.Module.directive("campaignComponent",["$q","$filter","MainConstants","BreakpointDetectionService","BanTrackingHelper","BanConstants","$window",ba.bahome.campaign.campaignComponent]),ba.lang.namespace("ba.bahome.campaign"),ba.bahome.campaign.CampaignViewModelBuilder=function(e,t,a,n,o,i,r,s){this.build=function(c,l){var m=e.defer(),u={},d=o.layout,g=r.getCountry().toUpperCase();return c.content?(c.content.source=s.getDataSource(c),m.resolve(c.content)):a.getCampaignContent(c).then(function(e){e.source=s.getDataSource(c),m.resolve(e)})["catch"](function(){var e="",a=l+1,o=l-2;"incident"===d&&(e="-incident"),u.imgSrc={},u.imgSrcTall={},u.displayGradient=!0,t.get("campaignFallbackTitle"+a+e).then(function(e){u.headerText=e!==n.RESOURCE_NOT_FOUND?e:"",u.incidentFallback=e!==n.RESOURCE_NOT_FOUND?!1:!0}),t.get("campaignFallbackIntroText"+a+e).then(function(e){u.introText=e!==n.RESOURCE_NOT_FOUND?e:""}),t.get("campaignFallbackAdditionalText"+a+e).then(function(e){u.additionalText=e!==n.RESOURCE_NOT_FOUND?e:""}),t.get("campaignFallbackTerms"+a+e).then(function(e){u.terms=e!==n.RESOURCE_NOT_FOUND?e:""}),i.buttonURL[g]&&i.imageURL[g]&&i.campaignType[g]||(g="ROW"),u.campaignType=i.campaignType[g][o],u.displayGradient=u.campaignType===n.CAMPAIGN_FLAT_TYPE?!1:!0,u.flatType=u.campaignType===n.CAMPAIGN_FLAT_TYPE?"icon":"",u.imgSrc.small=i.imageURL[g][o],u.imgSrc.medium=i.imageURL[g][o],u.imgSrc.large=i.imageURL[g][o],u.imageIcon=i.imageURL[g][o],t.get("campaignFallbackButtonText"+a+e).then(function(e){u.buttonText=e!==n.RESOURCE_NOT_FOUND?e:""}),u.buttonURL=i.buttonURL[g][o],u.buttonOpenNewWindow=!1,u.buttonShow=!0,u.source={determiner:c.source,solr:!1},m.resolve(u)}),m.promise}},ba.bahome.campaign.Module.service("CampaignViewModelBuilder",["$q","ResourceBundle","ContentProvider","MainConstants","LayoutDetermination","CampaignConstants","ClientLocaleService","TopicModel",ba.bahome.campaign.CampaignViewModelBuilder]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.GeneralDataModel=function(e,t){var a=this;this["const"]=e,this.trans=t,this.resetGeneralDataModel=function(){a.model={disruption:{account:null,priority1:null,priority2:null},globalNav:null,siteLinks:null,socialLinks:null,sales:null,hasBeenCalled:!1}},this.resetGeneralDataModel(),this.setGeneralDataModel=function(e){angular.forEach(e.docs,function(e){var t=a.determineComponentType(e);t&&(a.model=a.trans.transformDocByComponentType(e,t,a.model))}),a.model.hasBeenCalled=!0},this.getGeneralDataModel=function(){return a.model},this.setModelHasBeenCalled=function(){a.model.hasBeenCalled=!0},this.determineComponentType=function(e){return e.contentPurposePath&&-1!==e.contentPurposePath[0].indexOf(a["const"].DATA_TYPES.P1)?a["const"].DATA_TYPES.P1:e.contentPurposePath&&-1!==e.contentPurposePath[0].indexOf(a["const"].DATA_TYPES.P2)?a["const"].DATA_TYPES.P2:e.contentPurposePath&&-1!==e.contentPurposePath[0].indexOf(a["const"].DATA_TYPES.ACCOUNT)?a["const"].DATA_TYPES.ACCOUNT:e.contentPurposePath&&-1!==e.contentPurposePath[0].indexOf(a["const"].DATA_TYPES.SALES)?a["const"].DATA_TYPES.SALES:e.type&&-1!==e.type.indexOf(a["const"].DATA_TYPES.LINKS)?a["const"].DATA_TYPES.LINKS:e.type&&-1!==e.type.indexOf(a["const"].DATA_TYPES.SOCIAL)?a["const"].DATA_TYPES.SOCIAL:e.type&&-1!==e.type.indexOf(a["const"].DATA_TYPES.NAV)?a["const"].DATA_TYPES.NAV:void 0}},ba.bahome.contentRetrieval.Module.service("GeneralDataModel",["ContentRetrievalConstants","BatchContentTransformer",ba.bahome.contentRetrieval.GeneralDataModel]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.BatchContentProvider=function(e,t,a,n,o,i,r,s,c,l){this["const"]=e,this.transformer=t,this.$q=l.q,this.contentProvider=n,this.queryParamTransformer=o,this.contentRetrievalService=i,this.timeout=a,this.userModel=r,this.generalModel=s,this.filter=c,this.$rootScope=l.rootScope,this.log=l.log},ba.bahome.contentRetrieval.BatchContentProvider.prototype.queryGeneralData=function(){var e,t=this,a=this.$q.defer(),n=this.userModel.getLoyaltyModel(),o={fq:[],q:"*",group:{query:[this["const"].ACC_QUERY,this["const"].P1_QUERY,this["const"].P2_QUERY,this["const"].SITE_LINKS_QUERY,this["const"].GLOBAL_NAV_QUERY,this["const"].SOCIAL_LINKS_QUERY,this["const"].TC_QUERY],limit:1},rows:7,batchRequest:!0},i=this.contentProvider.startTimeoutPromise(a);n.tier&&(e=n.tier?this.filter("titlecase")(n.tier):n.tier,o.fq.push(t["const"].MESSAGE_TIER_FQ_1+e+t["const"].MESSAGE_TIER_FQ_2)),this.contentRetrievalService.getContentInstance(o).then(function(e){t.timeout.cancel(i),t.log.generateLogByCode("BA_HOME_BAT_001"),t.generalModel.setGeneralDataModel(e),t.$rootScope.$emit("generalDataUpdated")})["catch"](function(){t.log.generateLogByCode("BA_HOME_BAT_002",{query:o}),t.generalModel.setModelHasBeenCalled(),t.$rootScope.$emit("generalDataUpdated")})},ba.bahome.contentRetrieval.BatchContentProvider.prototype.resetGeneralDataModel=function(){this.generalModel.resetGeneralDataModel()},ba.bahome.contentRetrieval.BatchContentProvider.prototype.queryByTopicData=function(e){var t,a,n=this,o=this.$q.defer(),i=this.contentProvider.startTimeoutPromise(o);return a=this.stripNonBatchTopics(e),t=this.generateTopicQueryParams(a),t?(t=this.queryParamTransformer.transform(t),t.rows=9,t.batchRequest=!0,this.contentRetrievalService.getContentInstance(t).then(function(t){n.timeout.cancel(i),n.log.generateLogByCode("BA_HOME_BAT_003"),o.resolve(n.transformer.transformBatchTopics(t,e))})["catch"](function(){n.log.generateLogByCode("BA_HOME_BAT_004",{query:t}),o.reject()})):(n.log.generateLogByCode("BA_HOME_BAT_005"),o.reject()),o.promise},ba.bahome.contentRetrieval.BatchContentProvider.prototype.generateTopicQueryParams=function(e){var t=this,a="";return angular.forEach(e,function(n,o){a+=o!==e.length-1?n.treatment+t["const"].OR:n.treatment}),a?{terms:t["const"].BATCH_TOPIC_QUERY_PREFIX+a+t["const"].BATCH_TOPIC_QUERY_SUFFIX}:!1},ba.bahome.contentRetrieval.BatchContentProvider.prototype.stripNonBatchTopics=function(e){var t=this,a=[];return angular.forEach(e,function(e){e&&e.id!==t["const"].DISALLOWED_KEYS[0]&&e.id!==t["const"].DISALLOWED_KEYS[1]&&e.id!==t["const"].DISALLOWED_KEYS[2]&&e.id!==t["const"].DISALLOWED_KEYS[3]&&e.source===t["const"].PEGA&&this.push(e)},a),a},ba.bahome.contentRetrieval.Module.service("BatchContentProvider",["ContentRetrievalConstants","BatchContentTransformer","$timeout","ContentProvider","QueryParamTransformer","ContentRetrievalService","UserDataModel","GeneralDataModel","$filter","CommonService",ba.bahome.contentRetrieval.BatchContentProvider]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.ContentDuplicationHandler=function(e,t){var a=this;this.list=[],this.addContentIdToList=function(e){a.list.push(e)},this.getContentIdList=function(){return a.list},this.resetContentIdList=function(){a.list=[],e.resetIdList()},this.getUniqueContentFromResponse=function(e){var n,o;if(e&&e.docs[0])for(o=0;o<e.docs.length;o+=1){if(!a.checkIdInList(e.docs[o].id)){a.addContentIdToList(e.docs[o].id),n=e.docs[o];break}t.log.generateLogByCode("BA_HOME_027",{treatmentId:e.docs[o].id})}return n},this.checkIdInList=function(e){return-1!==a.list.indexOf(e)?!0:!1}},ba.bahome.contentRetrieval.Module.service("ContentDuplicationHandler",["ContentRetrievalService","CommonService",ba.bahome.contentRetrieval.ContentDuplicationHandler]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.Module.value("ComponentsTransformers",{hero:"HeroTransformer","image-index":"ImageIndexTransformer",campaign:"CampaignTransformer",messaging:"MessagingTransformer",redemption:"RedemptionTransformer"}),ba.bahome.contentRetrieval.ContentProvider=function(e,t,a,n,o,i,r,s,c,l,m,u){var d,g=this,h=[];this.$injector=e,this.log=a.log,this.queryParamTransformer=i,angular.forEach(s,function(e,t){d=g.$injector.get(e),h[t]=d}),this.startTimeoutPromise=function(e){return c(function(){e.reject()},1e4)},this.getHeroContent=function(e){var a,i=t.defer(),r=g.startTimeoutPromise(i);return e.type===o.QUERY_TYPE_SIMPLE?(a={},a.fq=[o.PERSONALISED_CAMPAIGN],a.q=o.QUERY_TARGET_WORLD):a=g.queryParamTransformer.transform(e),a.rows=5,n.getContentInstance(a).then(function(e){c.cancel(r),i.resolve(h.hero.contentTransform(e)),g.log.generateLogByCode("BA_HOME_HERO_001",{campaignId:e.docs[0].id})})["catch"](function(){i.reject(),g.log.generateLogByCode("BA_HOME_HERO_002",{query:a})}),i.promise},this.getImageIndexContent=function(e){var a,i=t.defer(),r=g.startTimeoutPromise(i);return e.type===o.QUERY_TYPE_SIMPLE?(a={},a.fq=[o.PERSONALISED_IMAGE_INDEX],a.q=o.QUERY_TARGET_WORLD):a=g.queryParamTransformer.transform(e),a.rows=3,n.getContentInstance(a).then(function(e){c.cancel(r),i.resolve(h["image-index"].contentTransform(e)),g.log.generateLogByCode("BA_HOME_IMG_001",{campaignId:e.docs[0].id})})["catch"](function(){i.reject(),g.log.generateLogByCode("BA_HOME_IMG_002",{query:a})}),i.promise},this.getCampaignContent=function(e){var a,i,r=t.defer(),s=g.startTimeoutPromise(r);return e.type===o.QUERY_TYPE_SIMPLE?(a={},a.fq=[o.PERSONALISED_CAMPAIGN],a.q=o.QUERY_TARGET_WORLD):a=g.queryParamTransformer.transform(e),a.rows=5,n.getContentInstance(a).then(function(t){c.cancel(s),i=h.campaign.contentTransform(t,e),i?(r.resolve(i),g.log.generateLogByCode("BA_HOME_CAMP_001",{campaignId:t.docs[0].id})):(r.reject(),g.log.generateLogByCode("BA_HOME_CAMP_002",{query:a}))})["catch"](function(){r.reject(),g.log.generateLogByCode("BA_HOME_CAMP_002",{query:a})}),r.promise},this.getMessagingContent=function(e){var a,i=t.defer(),s=r.getLoyaltyModel(),l={fq:[o.PERSONALISED_MESSAGE,o.MESSAGE_PURPOSE+e+'"']},m=g.startTimeoutPromise(i);return e===o.MESSAGE_SALE&&(l.fq=[o.MESSAGE_SALE_FQ]),e===o.MESSAGE_ACCOUNT&&s.tier?(a=s.tier?u("titlecase")(s.tier):s.tier,l.fq.push(o.MESSAGE_TIER_FQ_1+a+o.MESSAGE_TIER_FQ_2)):e===o.MESSAGE_ACCOUNT&&l.fq.push(o.MESSAGE_TIER_FQ_1+o.MESSAGE_TIER_FQ_2),n.getContentInstance(l).then(function(t){c.cancel(m),i.resolve(h.messaging.contentTransform(t)),g.log.generateLogByCode("BA_HOME_MSG_001",{messageId:t.docs[0].id,messageType:e})})["catch"](function(){i.reject(),g.log.generateLogByCode("BA_HOME_MSG_002",{query:l})}),i.promise},this.getRedemptionContent=function(){var e=t.defer(),a={fq:[o.PERSONALISED_REDEMPTION]},i=r.getLoyaltyModel(),s=g.startTimeoutPromise(e);return n.getContentInstance(a).then(function(t){c.cancel(s),e.resolve(h.redemption.contentTransform(t,i)),g.log.generateLogByCode("BA_HOME_RED_001",{treatmentId:t.docs[0].id})})["catch"](function(){e.reject(),g.log.generateLogByCode("BA_HOME_RED_002",{query:a})}),e.promise},this.getAccountBarContent=function(e){var a=t.defer(),i={fq:[o.DT_LINK_LIST]};return e===l.BARC?i.fq.push(o.MEMBERSHIP_ALL):i.fq.push(o.MEMBERSHIP_EXEC),n.getContentInstance(i).then(function(e){a.resolve(m.contentTransform(e)),g.log.generateLogByCode("BA_HOME_ACCB_001")})["catch"](function(){a.reject(),g.log.generateLogByCode("BA_HOME_ACCB_002")}),a.promise}},ba.bahome.contentRetrieval.Module.service("ContentProvider",["$injector","$q","CommonService","ContentRetrievalService","ContentRetrievalConstants","QueryParamTransformer","UserDataModel","ComponentsTransformers","$timeout","AccountBarConstants","AccountBarTransformer","$filter",ba.bahome.contentRetrieval.ContentProvider]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.PriceProvider=function(e,t,a,n,o,i){this.$q=e,this.log=t.log,this.priceService=a,this.contentProvider=n,this.timeout=o,this.priceTransformer=i},ba.bahome.contentRetrieval.PriceProvider.prototype.getPricesByQuery=function(e){var t,a=this,n=this.$q.defer(),o=this.contentProvider.startTimeoutPromise(n);
return this.priceService.getPriceContent(e).then(function(e){a.timeout.cancel(o),t=a.priceTransformer.transform(e),t?n.resolve(t):n.reject()})["catch"](function(){n.reject(),a.log.generateLogByCode("BA_HOME_024",{query:e})}),n.promise},ba.bahome.contentRetrieval.Module.service("PriceProvider",["$q","CommonService","PriceRetrievalService","ContentProvider","$timeout","PriceTransformer",ba.bahome.contentRetrieval.PriceProvider]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.AccountBarTransformer=function(e){var t=this;this.log=e.log,this.contentTransform=function(e){var a,n,o={};if(!(e&&e.docs[0]&&e.docs[0].content["link-list"]&&e.docs[0].content["link-list"].links))throw t.log.generateLogByCode("BA_HOME_ACCB_005"),new Error("Error transforming Account bar response");for(a=e.docs[0].content["link-list"].links,o.linkList=[],n=0;n<a.length;n++)o.linkList.push({heading:a[n].heading,linkUrl:a[n].linkURL});return o}},ba.bahome.contentRetrieval.Module.service("AccountBarTransformer",["CommonService",ba.bahome.contentRetrieval.AccountBarTransformer]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.BatchContentTransformer=function(e,t,a,n){var o=this;this.campaignTransformer=e,this.imageIndexTransformer=t,this["const"]=a,this.transformBatchTopics=function(e,t){var a;return e&&e.docs[0]&&angular.forEach(e.docs,function(e){var n;for(a=0;a<t.length;a++)if(t[a]&&e.id===t[a].treatment){t[a].content=o.transformDocByComponentType(e,n);break}}),t},this.transformDocByComponentType=function(a,i,r){var s={docs:[{id:a.id,content:a.content_translate||a.content,prices:a.prices,query:a.query}]};switch(i){case o["const"].DATA_TYPES.P1:return r.disruption.priority1=n.contentTransform(s),r;case o["const"].DATA_TYPES.P2:return r.disruption.priority2=n.contentTransform(s),r;case o["const"].DATA_TYPES.ACCOUNT:return r.disruption.account=n.contentTransform(s),r;case o["const"].DATA_TYPES.SALES:return r.sales=n.contentTransform(s),r;case o["const"].DATA_TYPES.LINKS:return r.siteLinks=o.getContentFromResponse(s),r;case o["const"].DATA_TYPES.SOCIAL:return r.socialLinks=o.getContentFromResponse(s),r;case o["const"].DATA_TYPES.NAV:return r.globalNav=o.getContentFromResponse(s),r;case o["const"].IMAGE_INDEX:return t.contentTransform(s);default:return e.contentTransform(s)}},this.getContentFromResponse=function(e){return e.docs&&e.docs[0]&&e.docs[0].content?e.docs[0].content:null}},ba.bahome.contentRetrieval.Module.service("BatchContentTransformer",["CampaignTransformer","ImageIndexTransformer","ContentRetrievalConstants","MessagingTransformer",ba.bahome.contentRetrieval.BatchContentTransformer]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.CampaignTransformer=function(e,t,a,n,o,i){var r=this;this.log=e.log,this.contentHandler=n,this.priceTransformer=i,this.contentTransform=function(e){var n,i,s,c,l={},m=r.contentHandler.getUniqueContentFromResponse(e);return m&&m.content&&m.content.banner&&m.content.banner.messageContent?(n=m.content.banner.messageContent,n.messageImagery?(i=n.messageImagery.imageSelection,s=n.messageImagery.flatCampaign):(l.campaignType=t.CAMPAIGN_FLAT_TYPE,l.imageIcon="/cms/global/assets/images/ba_home_site/brand/info-blue.svg"),c=n.messageCta,l.contentId=m.id,l.layout=m.layout,l.headerText=n.heading||"",l.introText=n.introductionText||"",l.additionalText=n.additionalInformation||"",l.additionalText2=n.additionalInformation2||"",l.additionalText=l.additionalText.replace("&#174;","<sup>&#174;</sup>"),l.terms=n.termsConditions||"",n.termsLink&&(l.termsLinkText=n.termsLink.linkTitle||"",l.termsLinkURL=n.termsLink.linkURL||""),l.query=m.query,i&&(l.imgSrc={},l.campaignType=t.CAMPAIGN_IMAGE_TYPE,l.imgSrc.small=i.smallImage?i.smallImage:i.largeImage||"",l.imgSrc.medium=i.mediumImage?i.mediumImage:i.largeImage||"",l.imgSrc.large=i.largeImage||"",l.displayGradient=!0),s&&(l.campaignType=t.CAMPAIGN_FLAT_TYPE,l.flatType=s.type||"",l.imageIcon=s.imageFile||""),c&&(l.buttonText=c.ctaLabel||"",l.buttonURL=c.ctaLink||"",c.ctaShow===a.YES?l.buttonShow=!0:l.buttonShow=!1,c.ctaNewWindow===a.YES?l.buttonOpenNewWindow=!0:l.buttonOpenNewWindow=!1),angular.forEach(m.contentPurposePath,function(e){-1!==e.indexOf(a.AMEX_VALUE)&&(l.amex=!0)}),m.contentPurposePath&&-1!==m.contentPurposePath.indexOf(a.SALES_VALUE)&&o.setSaleStatus(),m.prices&&(l.products=r.priceTransformer.transform(m.prices))):(l=null,r.log.generateLogByCode("BA_HOME_CAMP_003",{response:m})),l}},ba.bahome.contentRetrieval.Module.service("CampaignTransformer",["CommonService","MainConstants","ContentRetrievalConstants","ContentDuplicationHandler","SaleTcService","PriceTransformer",ba.bahome.contentRetrieval.CampaignTransformer]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.HeroTransformer=function(e,t,a,n,o){var i=this;this.log=e.log,this.contentHandler=a,this.priceTransformer=o,this.contentTransform=function(e){var a,o,r,s,c={},l=i.contentHandler.getUniqueContentFromResponse(e);return l&&l.content&&l.content.banner&&l.content.banner.messageContent?(a=l.content.banner.messageContent,a.messageImagery&&(o=a.messageImagery.imageSelection),r=a.messageCta,c.contentId=l.id||"",c.headerText=a.heading||"",c.introText=a.introductionText||"",c.primaryText=a.primaryText||"",c.secondaryText=a.secondaryText||"",c.tertiaryText=a.tertiaryText||"",c.terms=a.termsConditions||"",c.layout=l.layout,c.query=l.query,c.countdownDays=a.countdownDays||null,o&&(c.imgSrc={},c.imgSrc.small=o.smallImage?o.smallImage:o.largeImage||"",c.imgSrc.medium=o.mediumImage?o.mediumImage:o.largeImage||"",c.imgSrc.large=o.largeImage||"",c.displayGradient=!1,"true"===o.toggleImageGradient&&(c.displayGradient=!0)),r&&(c.buttonText=r.ctaLabel||"",c.buttonURL=r.ctaLink||"",r.ctaShow===t.YES?c.buttonShow=!0:c.buttonShow=!1,r.ctaNewWindow===t.YES?c.buttonOpenNewWindow=!0:c.buttonOpenNewWindow=!1),angular.forEach(l.contentPurposePath,function(e){-1!==e.indexOf(t.SALES_VALUE)&&(s=!0)}),s&&(c.countdown=l.expires,n.setSaleStatus()),l.prices&&(c.products=i.priceTransformer.transform(l.prices))):(c=null,i.log.generateLogByCode("BA_HOME_HERO_003",{response:l})),c}},ba.bahome.contentRetrieval.Module.service("HeroTransformer",["CommonService","ContentRetrievalConstants","ContentDuplicationHandler","SaleTcService","PriceTransformer",ba.bahome.contentRetrieval.HeroTransformer]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.ImageIndexTransformer=function(e,t){var a=this;this.log=e.log,this.contentHandler=t,this.contentTransform=function(e){var t,n,o,i,r,s,c,l=[],m=a.contentHandler.getUniqueContentFromResponse(e);if(m&&m.content&&m.content["image-index"]){for(o=m.content["image-index"].thumbnails,i=m.content["image-index"].moreTitle,r=m.content["image-index"].moreLinkURL,"undefined"!=typeof m.content["image-index"].image&&(s=m.content["image-index"].image.imageFile),"undefined"!=typeof m.content["image-index"].mainHeader&&(n=m.content["image-index"].mainHeader),c=0;c<o.length;c+=1)l.push({heading:o[c].heading,image:o[c].image.imageFile,linkUrl:o[c].linkURL});t={mainHeader:n,imageTiles:l,moreTitle:i,moreUrl:r,moreImage:s},t.contentId=m.id}else a.log.generateLogByCode("BA_HOME_IMG_003",{response:m});return t}},ba.bahome.contentRetrieval.Module.service("ImageIndexTransformer",["CommonService","ContentDuplicationHandler",ba.bahome.contentRetrieval.ImageIndexTransformer]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.MessagingTransformer=function(e,t,a,n){var o=this;this.log=e.log,this.stringLimitService=a,this.userData=n,this.contentTransform=function(e){var a,n={},i=240,r=o.userData.getLoyaltyModel()||"",s=o.userData.getPersonalAttributesModel()||"";return e&&e.docs[0]&&e.docs[0].content&&e.docs[0].content.disruption&&e.docs[0].content.disruption.messageContent?(a=e.docs[0].content.disruption.messageContent,n.id=e.docs[0].id||"",n.title=a.title||"",n.message=a.message||"",n["class"]=a["class"]||"",n.memberType=s.customerType||"",a.messageCta&&(n.url=a.messageCta.ctaLink||"",n.label=a.messageCta.ctaLabel||""),n["class"]===t.ACCOUNT_DISRUPTION_CLASS&&r.tier?n.tier=r.tier.toLowerCase():n.tier="",a.message&&a.message.length>i&&(n.snippet=o.stringLimitService.stringLimit(a.message,i))):(n=null,o.log.generateLogByCode("BA_HOME_MSG_003",{response:e})),n}},ba.bahome.contentRetrieval.Module.service("MessagingTransformer",["CommonService","ContentRetrievalConstants","StringLimitService","UserDataModel",ba.bahome.contentRetrieval.MessagingTransformer]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.PriceTransformer=function(e,t){var a=this;this.log=e.log,this.transform=function(e){var n;return e&&e[0]?(n=[],angular.forEach(e,function(e){var a={};a.destination=e.destinationCityName||e.arrivalCityName||e.arrivalAirportNameThree||e.arrivalAirportNameTwo||e.arrivalAirportNameOne,a.destinationHols=e.destinationCityName||e.arrivalCityName||e.hotelCity||e.arrivalAirportNameThree||e.arrivalAirportNameTwo||e.arrivalAirportNameOne,a.departure=e.departureCityName,a.currencyCode=e.currencyCode,a.tripType=e.tripType,a.destinationCode=e.arrivalAirport||e.arrivalAirportOne,a.departureCode=e.departureAirport,a.cabin=e.cabin,a.numNights=e.numberOfNights,a.departureDate=e.outboundDate,a.pricePerPersonPerNight=e.pricePerPersonPerNight,a.pricePp=e.pricePp,a.dailyPrice=e.dailyPrice,a.hotelStars=e.hotelStars,a.layout=e.layout,a.customPriceHeader=e.customPriceHeader,a.starRating=e.starRating,a.boardBasis=e.boardBasis,e.link&&(a.linkOveride=e.link),e.deepLink&&(a.deepLink=e.deepLink),e.eachWayPricing?(a.price=e.roundedLowestEachWayPrice,a.tripType=t.TRIP_TYPE_EACH_WAY):a.price=e.roundedLowestPrice,a.regionCode=e.regionCode,n.push(a)})):a.log.generateLogByCode("BA_HOME_026",{response:e}),n}},ba.bahome.contentRetrieval.Module.service("PriceTransformer",["CommonService","ContentRetrievalConstants",ba.bahome.contentRetrieval.PriceTransformer]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.RecentSearchCookieTransformer=function(e,t,a,n){this.recentSearchData=[],this.symbolLookup=e,this.moment=t,this.searches=[],this.baCookie=a,this.constants=n,this.removeFromCookieList=[]},ba.bahome.contentRetrieval.RecentSearchCookieTransformer.prototype.setCookie=function(){var e,t=this;return e=t.searches.length>0?t.searches.join("||"):"empty",t.baCookie.setCookie("RSR_RESULTS",e,"/"),e},ba.bahome.contentRetrieval.RecentSearchCookieTransformer.prototype.transformCookie=function(e){var t,a,n,o,i,r=this,s=[],c=new Date;for(r.recentSearchData=[],r.searches=e.split("||"),t=0;t<r.searches.length;t++)"undefined"!==r.searches[t]&&"empty"!==r.searches[t]&&(o=r.searches[t].split(","),s.push(o));if(s&&s.length>=1){for(t=0;t<s.length;t++)n={},n.invalidData=!1,n.passengers=[],n.id=t,n.origin=s[t][this.constants.RECENT_SEARCH_REF.ORIGIN].replace(/\s+/g,""),n.departureDate=r.moment(s[t][this.constants.RECENT_SEARCH_REF.DEP_DATE].split("@")[0]).format("D MMMM YYYY"),n.departureTime=s[t][this.constants.RECENT_SEARCH_REF.DEP_DATE].split("@")[1].replace("-",":"),"**"===n.departureTime&&(n.departureTime="23:59"),n.departureDateURL=r.moment(s[t][this.constants.RECENT_SEARCH_REF.DEP_DATE].split("@")[0]).format("YYYY-MM-DD"),s[t][this.constants.RECENT_SEARCH_REF.RETURN_DATE].split("@")[0].match(/^\d{4}-\d{2}-\d{2}$/)?(n.returnDate=r.moment(s[t][this.constants.RECENT_SEARCH_REF.RETURN_DATE].split("@")[0]).format("D MMMM YYYY"),n.returnDateURL=r.moment(s[t][this.constants.RECENT_SEARCH_REF.RETURN_DATE].split("@")[0]).format("YYYY-MM-DD"),n.destination=s[t][this.constants.RECENT_SEARCH_REF.RETURN.DESTINATION].replace(/\s+/g,""),n.destinationName=s[t][this.constants.RECENT_SEARCH_REF.RETURN.DEST_NAME],i=this.constants.RECENT_SEARCH_REF.RETURN):(n.destination=s[t][this.constants.RECENT_SEARCH_REF.ONEWAY.DESTINATION].split(":")[1].replace(/\s+/g,""),n.destinationName=s[t][this.constants.RECENT_SEARCH_REF.ONEWAY.DEST_NAME],i=this.constants.RECENT_SEARCH_REF.ONEWAY),n.passengers.push({count:parseInt(s[t][i.ADULT].split("&&")[1]),passengerType:"ADULT"}),n.passengers.push({count:parseInt(s[t][i.CHILD]),passengerType:"CHILD"}),n.passengers.push({count:parseInt(s[t][i.INFANT]),passengerType:"INFANT"}),n.passengers.push({count:parseInt(s[t][i.YOUNGADULT]),passengerType:"YOUNGADULT"}),n.cabin=s[t][i.CABIN],n.customerModifiedDate=s[t][i.MOD_DATE],n.modifiedUnixTime=parseInt((new Date(n.customerModifiedDate).getTime()/1e3).toFixed(0)),s[t][i.PRICE]?(n.priceQuoted=s[t][i.PRICE].substring(3,s[t][i.PRICE].length),n.priceQuotedCurrency=r.symbolLookup.getSymbol[s[t][i.PRICE].substring(0,3)]):(n.priceQuoted="",n.priceQuotedCurrency=""),6===n.origin.length?(n.originAirport=n.origin.substr(3,3),n.origin=n.origin.substr(3,3)):n.originAirport=n.origin,6===n.destination.length&&(n.destinationAirport=n.destination.substr(3,3),n.destination=n.destination.substr(0,3)),n.redemptionSearch=!1,n.source="cookie",new Date(n.departureDate+" "+n.departureTime)>=c&&!n.invalidData?r.recentSearchData.push(n):r.removeFromCookieList.push(t);for(t=0;t<r.removeFromCookieList.length;t++)a=r.removeFromCookieList[t],r.searches.splice(a,1);return r.setCookie(),r.recentSearchData}return[]},ba.bahome.contentRetrieval.RecentSearchCookieTransformer.prototype.removeCookie=function(e){var t=this;return t.searches.splice(e,1),t.setCookie()},ba.bahome.contentRetrieval.RecentSearchCookieTransformer.prototype.deleteCookie=function(e){var t,a=this;return t=a.removeCookie(e),""===t?[]:a.transformCookie(t)},ba.bahome.contentRetrieval.RecentSearchCookieTransformer.prototype.checkDuplicateSearch=function(e,t){var a,n,o,i,r,s=!1;for(r=0;r<t.length;r+=1)n=!1,o=!1,a=!1,i=!1,t[r].destination!==e.destination&&t[r].destination!==e.destinationAirport&&t[r].destinationAirport!==e.destination||t[r].originAirport!==e.originAirport&&t[r].origin!==e.origin||(n=!0),t[r].cabin===e.cabin&&t[r].redemptionSearch===e.redemptionSearch&&(i=!0),t[r].departureDate===e.departureDate&&t[r].returnDate===e.returnDate&&(o=!0),t[r].passengers&&t[r].passengers[0].count===e.passengers[0].count&&t[r].passengers[1].count===e.passengers[1].count&&t[r].passengers[2].count===e.passengers[2].count&&(a=!0),t[r].passengers[3].count>0||e.passengers[3].count>0?t[r].modifiedUnixTime+120>=e.modifiedUnixTime&&t[r].modifiedUnixTime-120<=e.modifiedUnixTime&&n&&o&&a&&i&&(s=!0):n&&o&&a&&i&&(s=!0);return s},ba.bahome.contentRetrieval.Module.service("RecentSearchCookieTransformer",["SymbolLookupService","Moment","BACookieService","ContentRetrievalConstants",ba.bahome.contentRetrieval.RecentSearchCookieTransformer]),ba.lang.namespace("ba.bahome.contentRetrieval"),ba.bahome.contentRetrieval.RedemptionTransformer=function(e){var t=this;this.log=e.log,this.contentTransform=function(e,a){var n,o,i={};return e&&e.docs[0]&&e.docs[0].content&&e.docs[0].content.redemption&&e.docs[0].content.redemption.messageContent?(n=e.docs[0].content.redemption.messageContent,o=n.messageCta,i.title=n.title||"",i.message=n.message||"",o&&(i.buttonLabel=o.ctaButtonLabel||"",i.buttonUrl=o.ctaButtonLink||"",i.linkMessage=o.ctaLabel||"",i.linkMessageUrl=o.ctaLink||""),i.tier=a.tierLevel?a.tierLevel.toLowerCase():"",i.contentId=e.docs[0].id):(i=null,t.log.generateLogByCode("BA_HOME_RED_003")),i}},ba.bahome.contentRetrieval.Module.service("RedemptionTransformer",["CommonService",ba.bahome.contentRetrieval.RedemptionTransformer]),ba.lang.namespace("ba.bahome.dynamic"),ba.bahome.dynamic.dynamicComponent=function(e,t){return{restrict:"A",scope:{topic:"=",getContent:"&",skin:"@",contentPosition:"=",notLoaded:"=?",showComponent:"=?"},link:function(a,n){var o,i;a.loading=!0,i=function(){t.when(a.getContent()).then(function(t){a.contentValue=t,o="<div data-"+a.topic.id+'-component data-get-content="contentValue" data-skin="'+a.skin+'" data-content-position="'+a.contentPosition+'" data-user-data="contentValue" data-not-loaded="notLoaded" data-show-component="showComponent" class="flex-child '+a.topic.id+" skin-"+a.skin+'" ></div>',n.append(e(o)(a)),a.loading=!1})},a.$watch("topic",function(){a.loading&&a.topic&&i()})},templateUrl:"ba-home/templates/dynamic-component-view.html"}},ba.bahome.dynamic.Module.directive("dynamicComponent",["$compile","$q",ba.bahome.dynamic.dynamicComponent]),ba.lang.namespace("ba.bahome.footer"),ba.bahome.footer.BaFooterController=function(e,t,a){var n,o=this;o.layoutDetermination=e,n=t.$on("generalDataUpdated",function(){o.generalDataModel=a.getGeneralDataModel()}),t.$on("$destroy",n)},ba.bahome.footer.Module.controller("BaFooterController",["LayoutDetermination","$rootScope","GeneralDataModel",ba.bahome.footer.BaFooterController]),ba.lang.namespace("ba.bahome.genericDisruption"),ba.bahome.genericDisruption.disruptionBanner=function(e,t,a,n,o,i,r,s,c){"use strict";return{scope:{getContent:"&"},restrict:"A",link:function(l){var m,u,d,g=r;e.when(l.getContent()).then(function(e){s.getSaleStatus().then(function(e){l.isSale=e}),l.messagingContent=e,l.messagingContent.label||c.get("messagingFindOutMore").then(function(e){l.messagingContent.label=e}),l.loggedOn=n.isLoggedOn,l.accountDisruptionClass=a.ACCOUNT_DISRUPTION_CLASS,l.messagingContent.encodedHeading=l.messagingContent.title,l.messagingContent.priority===g.priorityTypes.disruptionPrio1&&(d=g.typeCodes.disruptionPrio1),l.messagingContent.priority===g.priorityTypes.disruptionPrio2&&(d=g.typeCodes.disruptionPrio2),l.messagingContent.priority===g.priorityTypes.disruptionPrioAcc&&(d=g.typeCodes.disruptionPrioAcc),d&&(u=i.generateBanParamObj(l.messagingContent,d),m=i.generateParamString(u)),l.removeAndStore=function(e){l.visible=!1,o.setCookie(e,!0),t.log.generateLogByCode("BA_HOME_MSG_004",{messageId:e})},l.visible=!1,l.showHide=!0,l.showUrl=!1,l.execRemoveVisible=!1,l.trackingData=i.click(m),l.textCustom=!0,l.toggleCustom=function(){l.textCustom=!l.textCustom},l.messagingContent.title?(l.visible=!0,l.messagingContent.snippet||(l.showHide=!1,l.messagingContent.snippet=l.messagingContent.message,l.messagingContent.url&&(l.showUrl=!0)),l.messagingContent["class"]===l.accountDisruptionClass&&(l.loggedOn()&&(l.execRemoveVisible=!0),""===l.messagingContent.tier&&(l.visible=!1),l.messagingContent.id&&o.getCookieValue(l.messagingContent.id)&&(l.visible=!1))):l.visible=!1,i.triggerImpression(m)})},templateUrl:"ba-home/templates/disruption-template.html"}},ba.bahome.genericDisruption.Module.directive("disruptionBanner",["$q","CommonService","ContentRetrievalConstants","BAAuthenticationService","BACookieService","BanTrackingHelper","BanConstants","SaleTcService","ResourceBundle",ba.bahome.genericDisruption.disruptionBanner]),ba.lang.namespace("ba.bahome.genericDisruption"),ba.bahome.genericDisruption.MessagingViewModelBuilder=function(e,t,a){this.build=function(n){var o=e.defer(),i=a.getGeneralDataModel();return i.disruption[n]?(i.disruption[n].priority=n,o.resolve(i.disruption[n])):!i.disruption[n]&&i.hasBeenCalled?o.reject():t.getMessagingContent(n).then(function(e){e.priority=n,o.resolve(e)})["catch"](function(){o.reject()}),o.promise}},ba.bahome.genericDisruption.Module.service("MessagingViewModelBuilder",["$q","ContentProvider","GeneralDataModel",ba.bahome.genericDisruption.MessagingViewModelBuilder]),ba.lang.namespace("ba.bahome.header"),ba.bahome.header.BaHeaderController=function(e,t,a,n,o,i,r){var s,c,l,m,u,d=this;d.isNewSearchBar=n.getCookieValue("newSearchBar")?!0:!1,d.layoutDetermination=e,d.userInfo="loading",d.disableLogin=n.getNumericalIDCugCookie()&&"di058"===n.getNumericalIDCugCookie(),c=a.$on(o.LOG_OFF_SUCCESS,function(){d.barOpen=!1,d.userInfo=null}),l=a.$on("generalDataUpdated",function(){d.generalDataModel=i.getGeneralDataModel()}),s=a.$on("userPopulated",function(e,a){m=t.getLoyaltyModel(),u=t.getPersonalAttributesModel(),d.barOpen=a,r.isLoggedOn()?u.customerType?(d.userInfo={customerType:u.customerType,loyaltyAccountDetails:{},name:{title:u.title,lastName:u.lastName}},m.tier&&(d.userInfo.loyaltyAccountDetails={tierLevel:m.tier,individualAccountBalance:{balance:m.individualAccountBalance||""},pointsBalance:{balance:m.pointsBalance||""},lifeTimeTierPoints:{balance:m.lifeTimeTierPoints||""}})):d.userInfo="failed":d.userInfo="loading"}),a.$on("$destroy",c),a.$on("$destroy",s),a.$on("$destroy",l)},ba.bahome.header.Module.controller("BaHeaderController",["LayoutDetermination","UserDataModel","$rootScope","BACookieService","AuthenticationConstants","GeneralDataModel","BAAuthenticationService",ba.bahome.header.BaHeaderController]),ba.lang.namespace("ba.bahome.hero"),ba.bahome.hero.heroCountdown=function(e,t,a,n){return{scope:{date:"@",numDays:"=?"},restrict:"A",link:function(o){function i(a){r=new Date(o.date).getTime(),s=t.duration(r-a,"milliseconds"),c=e(function(){s=t.duration(s-l,"milliseconds"),s>0?(o.days=Math.floor(s/1e3/60/60/24),o.hours=s.hours(),o.minutes=s.minutes(),o.seconds=s.seconds()):(e.cancel(c),o.days=0,o.hours=0,o.minutes=0,o.seconds=0)},l)}var r,s,c,l=1e3;o.numDays||(o.numDays=5),o.noAnimation=n.isSafari(),i(a.getTime())},templateUrl:"ba-home/templates/hero-countdown.html"}},ba.bahome.hero.Module.directive("heroCountdown",["$interval","Moment","ServerTimeService","PlatformDetectionService",ba.bahome.hero.heroCountdown]),ba.lang.namespace("ba.bahome.hero"),ba.bahome.hero.heroBanner=function(e,t,a,n,o,i,r,s,c,l){return{scope:{getContent:"&",layout:"=",optionalLinks:"=?",isCug:"<",isHotlineCug:"<",isStaffCug:"="},restrict:"A",link:function(m){var u,d,g,h,p=i,b=r;m.loading=!0,m.breakPoint=a.getBreakpoint(),m.country=l.getCountry(),m.accountTestValue=c.getCookieValue("abValueTest")||"A",m.flightCarSearch=!1,h=s.$on("userChoiceChange",function(e,t){m.flightCarSearch="FlightAndCar"===t?!0:!1}),s.$on("$destroy",h),e.when(m.getContent()).then(function(e){e.imgSrc&&e.imgSrc[m.breakPoint.view]&&"null"!==e.imgSrc[m.breakPoint.view]&&(g=new Image,m.heroImage=t("imgFilter")(e.imgSrc[m.breakPoint.view]),g.onload=function(){m.backgroundStyle=m.heroImage},g.src=m.heroImage),"incident"===m.layout&&(m.heroImageFallback=b.FALLBACK.INCIDENT.IMAGE_PATH,m.backgroundStyle=m.heroImageFallback),m.heroContent=e,m.heroContent.encodedHeading=m.heroContent.headerText,m.heroContent.buttonShow&&(m.heroContent.buttonClass="incident"===m.layout?"incident-btn":"white"),m.position=p.contentPositionStart,u=o.generateBanParamObj(m.heroContent,p.typeCodes.hero,m.position),d=o.generateParamString(u),o.triggerImpression(d),m.heroContent.buttonShow?u.clickPosition=p.clickPosCodes.callToAction+p.contentPositionStart:u.clickPosition=p.clickPosCodes.link+p.contentPositionStart,d=o.generateParamString(u),m.trackingData=o.click(d),s.$broadcast("heroPopulated"),m.loading=!1,s.$emit("heroLoaded")}),m.limit=n.LARGE_VIEW_LIMIT},templateUrl:"ba-home/templates/hero-view.html"}},ba.bahome.hero.Module.directive("heroBanner",["$q","$filter","BreakpointDetectionService","MainConstants","BanTrackingHelper","BanConstants","HeroConstants","$rootScope","BACookieService","ClientLocaleService",ba.bahome.hero.heroBanner]),ba.lang.namespace("ba.bahome.hero"),ba.bahome.hero.heroTicker=function(e){return{restrict:"A",scope:{type:"@",timeValue:"@"},link:function(t){function a(a){var n=e.MINUTES_SECONDS_START_VALUE;return t.type===e.HOURS&&(n=e.HOURS_START_VALUE),a===e.COUNTDOWN_RETURN_VALUE&&(a=n),(e.ZERO_VALUE+a).slice(-2)}function n(){t.$watch("timeValue",function(e){t.timeValue&&(t.current=a(parseInt(e)))})}n()},templateUrl:"ba-home/templates/hero-timer.html"}},ba.bahome.hero.Module.directive("heroTicker",["HeroConstants",ba.bahome.hero.heroTicker]),ba.lang.namespace("ba.bahome.hero"),ba.bahome.hero.HeroViewModelBuilder=function(e,t,a,n,o,i,r){this.build=function(s){var c=e.defer(),l=o.layout;return s.content?(s.content.source=r.getDataSource(s),c.resolve(s.content)):a.getHeroContent(s).then(function(e){e.source=r.getDataSource(s),c.resolve(e)})["catch"](function(){var e={},a="",o=n.getCountry().toUpperCase();e.imgSrc={},"incident"===l&&(a="-incident"),t.get("heroFallbackTitle"+a).then(function(t){e.headerText=t}),t.get("heroFallbackIntro"+a).then(function(t){"incident"===l?e.primaryText=t:e.introText=t}),t.get("heroFallbackButton"+a).then(function(t){" "!==t&&(e.buttonText=t)}),o=i.FALLBACK[o]?o:"ROW","incident"===l?(e.imgSrc=null,e.buttonShow=i.NO):(e.imgSrc.small=i.FALLBACK[o].IMAGE_PATH_SMALL,e.imgSrc.medium=i.FALLBACK[o].IMAGE_PATH_MEDIUM,e.imgSrc.large=i.FALLBACK[o].IMAGE_PATH_SMALL,e.buttonShow=i.YES,e.buttonURL=i.FALLBACK[o].BACK_BUTTON_LINK,e.buttonOpenNewWindow=!1),t.get("heroFallbackTerms"+a).then(function(t){e.terms=t}),e.displayGradient=!0,e.countdown=null,e.source={determiner:s.source,solr:!1},c.resolve(e)}),c.promise}},ba.bahome.hero.Module.service("HeroViewModelBuilder",["$q","ResourceBundle","ContentProvider","ClientLocaleService","LayoutDetermination","HeroConstants","TopicModel",ba.bahome.hero.HeroViewModelBuilder]),ba.lang.namespace("ba.bahome.imageIndex"),ba.bahome.imageIndex.imageIndexComponent=function(e,t,a,n,o,i,r,s){"use strict";return{restrict:"A",scope:{getContent:"&",skin:"@",contentPosition:"@"},link:function(c,l){var m,u,d,g=o,h=l.prop("offsetTop")-i.innerHeight;c.loading=!0,c.breakpoint=t.getBreakpoint(),e.when(c.getContent()).then(function(e){c.viewContent=e,c.viewContent.skin=c.skin,c.viewContent.encodedHeading=c.viewContent.moreTitle,c.viewContent.ellipse=r.ELLIPSE_CODE,m=n.generateBanParamObj(c.viewContent,g.typeCodes.imageIndex,c.contentPosition),u=n.generateParamString(m),n.triggerImpression(u),i.addEventListener("scroll",function(){h=l.prop("offsetTop")-i.innerHeight,d=i.pageYOffset,d>=h&&!c.loadImage&&c.$apply(function(){angular.forEach(c.viewContent.imageTiles,function(e,t){var a=s("imgFilter")(c.viewContent.imageTiles[t].image);c.viewContent.imageTiles[t].img=new Image,c.viewContent.imageTiles[t].img.onload=function(){c.viewContent.imageTiles[t].showImage=a,c.$digest()},c.viewContent.imageTiles[t].img.src=a}),c.loadImage=!0})}),h=l.prop("offsetTop")-i.innerHeight,d=i.pageYOffset,d>=h&&(angular.forEach(c.viewContent.imageTiles,function(e,t){var a=s("imgFilter")(c.viewContent.imageTiles[t].image);c.viewContent.imageTiles[t].img=new Image,c.viewContent.imageTiles[t].img.onload=function(){c.viewContent.imageTiles[t].showImage=a},c.viewContent.imageTiles[t].img.src=a}),c.loadImage=!0),c.loading=!1}),c.skin===a.SKIN_4||c.breakpoint.view===a.SMALL_VIEW?c.limit=a.II_SMALL_POD_LIMIT:c.limit=a.II_LARGE_POD_LIMIT,c.getLinkData=function(e,t){return e+=1,t===a.MORE_TITLE&&(e=c.limit+1),m.clickPosition=g.clickPosCodes.image+e,u=n.generateParamString(m),n.click(u)}},templateUrl:"ba-home/templates/image-index-view.html"}},ba.bahome.imageIndex.Module.directive("imageIndexComponent",["$q","BreakpointDetectionService","MainConstants","BanTrackingHelper","BanConstants","$window","ImageIndexConstants","$filter",ba.bahome.imageIndex.imageIndexComponent]),ba.lang.namespace("ba.bahome.imageIndex"),ba.bahome.imageIndex.ImageIndexViewModelBuilder=function(e,t,a,n,o,i){this.build=function(r,s){var c=e.defer();return r.content?(r.content.source=i.getDataSource(r),c.resolve(r.content)):a.getImageIndexContent(r).then(function(e){e.source=i.getDataSource(r),c.resolve(e)})["catch"](function(){var a,i,l=[],m=s+1,u=1;for(a=function(e,a,n){return t.get(e).then(function(e){return{heading:e,image:a,linkUrl:n}})},o["FALLBACK_"+m]||(m="DEFAULT");u<n.II_POD_LIMIT;u+=1)l.push(a("imageIndexFallBackTitle"+m+"-"+u,o["FALLBACK_"+m].FALLBACK_IMAGE_PATHS[u-1],o["FALLBACK_"+m].FALLBACK_URLS[u-1]));e.all(l).then(function(e){i={imageTiles:e},i.source={determiner:r.source,solr:!1},t.get("imageIndexFallBackMoreTitle"+m).then(function(e){i.moreTitle=e,i.moreUrl=o["FALLBACK_"+m].FALLBACK_MORE_URL,i.moreImage=o["FALLBACK_"+m].FALLBACK_MORE_IMAGE,c.resolve(i)})})}),c.promise}},ba.bahome.imageIndex.Module.service("ImageIndexViewModelBuilder",["$q","ResourceBundle","ContentProvider","MainConstants","ImageIndexConstants","TopicModel",ba.bahome.imageIndex.ImageIndexViewModelBuilder]),ba.lang.namespace("ba.bahome.layout"),ba.bahome.layout.LayoutDetermination=function(e,t,a){var n,o,i=this,r={},s=[];return this.$injector=e,this.availableDeterminers=a.get("BA_LAYOUT_DETERMINERS",["DefaultLayoutDeterminerService"]),this.incidentLayout=a.get("BA_INCIDENT_LAYOUT","false"),r.layout="default","true"===i.incidentLayout&&(r.layout="incident"),angular.forEach(i.availableDeterminers,function(e){n=i.$injector.get(e),s.push(n)}),o=function(e,t,a,n){var i,c,l;n=n||0,i=n+1,c=i===s.length,l=s[n],l[a](t).then(function(t){e.resolve(t),r.layout=t})["catch"](function(){c?e.reject():o(e,t,a,i)})},r.determine=function(e){var a=t.defer();return"true"===i.incidentLayout?(a.resolve("incident"),r.layout="incident"):o(a,e,"determine"),a.promise},r},ba.bahome.layout.Module.factory("LayoutDetermination",["$injector","$q","Environment",ba.bahome.layout.LayoutDetermination]),ba.lang.namespace("ba.bahome.layout"),ba.bahome.layout.DefaultLayoutDeterminerService=function(e){this.determine=function(){var t=e.defer();return t.resolve("second"),t.promise}},ba.bahome.layout.Module.service("DefaultLayoutDeterminerService",["$q",ba.bahome.layout.DefaultLayoutDeterminerService]),ba.lang.namespace("ba.bahome.layout"),ba.bahome.layout.IncidentLayoutDeterminerService=function(e,t,a){this.determine=function(){var n=e.defer(),o={};return o.fq=[a.TYPE_SERIOUS,a.SERIOUS_EVENT],t.getContentInstance(o).then(function(){t.resetIdList(),n.resolve("incident")})["catch"](function(){n.reject()}),n.promise}},ba.bahome.layout.Module.service("IncidentLayoutDeterminerService",["$q","ContentRetrievalService","ContentRetrievalConstants",ba.bahome.layout.IncidentLayoutDeterminerService]),ba.lang.namespace("ba.bahome.layout"),ba.bahome.layout.UrlLayoutDeterminerService=function(e){var t=function(e){var t=e.layout;return t&&"true"!==t&&""!==t||(t=!1),t};this.determine=function(a){var n=e.defer(),o=t(a);return o?n.resolve(o):n.reject(),n.promise}},ba.bahome.layout.Module.service("UrlLayoutDeterminerService",["$q",ba.bahome.layout.UrlLayoutDeterminerService]),ba.lang.namespace("ba.bahome.localStorage"),ba.bahome.localStorage.LocalStorageModel=function(e,t){this.log=e.log,this.$window=t;try{this.localStorage=this.$window.localStorage}catch(a){}},ba.bahome.localStorage.LocalStorageModel.prototype.isSupported=function(){var e,t,a=this;try{e=a.$window.localStorage}catch(n){e=!1}if(e){t="__"+Math.round(1e7*Math.random());try{a.localStorage.setItem(t,t),a.localStorage.removeItem(t)}catch(n){e=!1}}return e},ba.bahome.localStorage.LocalStorageModel.prototype.setItem=function(e,t){var a,n,o=this,i=o.isSupported();if(!i||angular.isUndefined(i))return!1;if(null===e||angular.isUndefined(e))return!1;a=Math.floor((new Date).getTime()/1e3),n=angular.fromJson(o.localStorage.getItem(e))||{value:[],date:""},n.value.push(t);try{return o.localStorage.setItem(e,angular.toJson({value:n.value,timestamp:a})),!0}catch(r){return!1}},ba.bahome.localStorage.LocalStorageModel.prototype.getItem=function(e){var t=this,a=t.isSupported();if(!a||angular.isUndefined(a))return!1;try{return t.items=angular.fromJson(t.localStorage.getItem(e)),t.items?t.items:[]}catch(n){return!1}},ba.bahome.localStorage.LocalStorageModel.prototype.removeItem=function(e){var t=this,a=t.isSupported();if(!a||angular.isUndefined(a))return t.log.generateLogByCode("BA_HOME_009"),!1;try{return t.localStorage.removeItem(e),!0}catch(n){return!1}},ba.bahome.localStorage.LocalStorageModel.prototype.clear=function(){var e=this,t=e.isSupported();if(!t||angular.isUndefined(t))return e.log.generateLogByCode("BA_HOME_002"),!1;try{return e.localStorage.clear(),!0}catch(a){return e.log.generateLogByCode("BA_HOME_001"),!1}},ba.bahome.localStorage.Module.service("LocalStorageModel",["CommonService","$window",ba.bahome.localStorage.LocalStorageModel]),ba.lang.namespace("ba.bahome.logging"),ba.bahome.logging.DetailedLogModel=function(e,t){this.authService=e,this.localeService=t},ba.bahome.logging.DetailedLogModel.prototype.outputObject=function(e){var t,a="";for(t in e)a+=e[t]&&"object"==typeof e[t]?t+"/"+this.outputObject(e[t])+",":t+"="+e[t]+",";
return a.slice(0,-1)},ba.bahome.logging.DetailedLogModel.prototype.addUserInfoToLog=function(e,t){var a=angular.copy(e);return a.authenticated=this.authService.isLoggedOn(),a.locale=this.localeService.getLocale(),t&&"string"==typeof t?a.message+=", EXTRA INFO: "+t:t&&"object"==typeof t&&(a.message+=", EXTRA INFO: "+this.outputObject(t)),a},ba.bahome.logging.Module.service("DetailedLogModel",["BAAuthenticationService","ClientLocaleService",ba.bahome.logging.DetailedLogModel]),ba.lang.namespace("ba.bahome.logging"),ba.bahome.logging.LoggingHelperService=function(e,t,a,n){this.balog=e,this.logs=t.ERRORS,this.filter=a,this.model=n},ba.bahome.logging.LoggingHelperService.prototype.generateLogByCode=function(e,t){var a,n=this.filter("filter")(this.logs,{code:e})[0];n?(a=this.model.addUserInfoToLog(n,t),this.balog[a.level](a)):this.balog.error("development error: no log found for code: "+e)},ba.bahome.logging.Module.service("LoggingHelperService",["BALog","LoggingConstants","$filter","DetailedLogModel",ba.bahome.logging.LoggingHelperService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.BaHomeController=function(e,t,a,n,o,i,r,s,c,l,m,u,d,g,h){var p,b,T,f,C,S,E,D,v,_=this;s.clientTimeLoad=(new Date).getTime(),this.$injector=e.injector,this.$state=e.state,this.$scope=h,this.$document=_.$injector.get("$document"),this.stateParams=e.state.params,this.topicDetermination=a,this.userDetermination=t,this.layoutDetermination=m,this.userDataModel=n,this.mainConstants=_.$injector.get("MainConstants"),this.breakpointDetectionService=_.$injector.get("BreakpointDetectionService"),this.availableComponents=o,this.analytics=e.analytics,this.contentHandler=r,this.$q=e.q,this.startTopic=1,this.nextTripTopicLocation=2,this.getDynamicContent={},this.dataResolved=!1,this.showPageContent=!1,this.components=[],this.layout="blank",this.analyticsTrackingService=c,this.authService=l,this.serverTimeService=s,this.unavailableFlightError=new ba.bahome.main.FlightUnavailableErrorViewData,this.flightFlownError=new ba.bahome.main.FlightFlownErrorViewData,this.$stateParams=e.stateParams,this.bACookieService=u,this.$rootScope=e.rootScope,this.localeUrlChecker=this.$injector.get("LocaleUrlCheckerService"),this.accountPanelLogon=!1,this.showBAHLoading=!1,this.trackingService=this.$injector.get("TrackingService"),this.thirdPartySetupService=this.$injector.get("ThirdPartySetupService"),this.$window=this.$injector.get("$window"),this.$timeout=this.$injector.get("$timeout"),this.platformDetectionService=this.$injector.get("PlatformDetectionService"),this.batchContentProvider=this.$injector.get("BatchContentProvider"),this.refreshAds=!1,this.commonService=e,this.showErrorMessage=!1,this.location=e.location,this.BALog=e.BALog,this.resources=e.resources,_.stateParams.forceCountry&&(_.bACookieService.setCookie("BA_COUNTRY_CHOICE_COOKIE",_.stateParams.forceCountry,"/"),_.bACookieService.setCookie("BA_LANGUAGE_CHOICE_COOKIE","EN","/")),this.resources.get("pageLoadingText").then(function(e){_.loadingText=e}),this.BALog.addPageGeneralValues({locale:g.getLocale(),authenticated:_.authService.isLoggedOn()}),this.isCug=u.getCugCookie(),this.cugID=u.getNumericalIDCugCookie(),this.isHotlineCug="ox231"===this.cugID,this.isFormerStaffCug="xs609"===this.cugID,this.isStaffCug=_.isHotlineCug||_.isFormerStaffCug,D=new Date,v=new Date(D.getUTCFullYear(),D.getUTCMonth(),D.getUTCDate(),D.getUTCHours(),D.getUTCMinutes(),D.getUTCSeconds()),h.$on("optional-link-set",function(e,t){_.optionalLinks=t}),this.localeUrlChecker.setLocaleCookies(),this.getTopicAndUserDataAndPopulatePageContent=function(){_.trackingService.resetTracking(),_.adsData=!1,_.accountPanelLogon=!1,_.dataResolved=!1,_.showPageContent=!1,_.heroLoaded=!1,_.userDataModel.reset(),_.contentHandler.resetContentIdList(),_.determineUserAndTopicData().then(function(e){_.populatePageContent(e)})},S=e.rootScope.$on("TermsAndConditionsBroadcast",function(e,t){t.acceptanceRequired?_.tncAllowLogon=!1:_.tncAllowLogon=!0,_.bACookieService.setCookie("tncAccept",_.tncAllowLogon,"/")}),this.allowLogOnCookie=this.bACookieService.getCookieValue("TermAndCondition"),this.tncAllowLogon=void 0!==this.allowLogOnCookie?this.allowLogOnCookie:!0,this.getTransactionContent=function(){var e=_.$q.defer();return _.userDetermination.determineAdditional("loyaltyRecentTransaction").then(function(t){t.loyaltyRecentTransaction&&t.loyaltyRecentTransaction.registeredCustomer&&t.loyaltyRecentTransaction.registeredCustomer.loyaltyAccountDetails&&t.loyaltyRecentTransaction.registeredCustomer.loyaltyAccountDetails.loyaltyAccountTransactions?(_.userDataModel.setLoyaltyModel(t.loyaltyRecentTransaction),e.resolve(!0)):e.resolve(!1)})["catch"](function(){e.resolve(!1)}),e.promise},this.viewSize=_.breakpointDetectionService.getBreakpoint().view,_.getTopicAndUserDataAndPopulatePageContent(),f=e.rootScope.$on("account-panel-logon",function(){_.accountPanelLogon=!0}),C=e.rootScope.$on("initiateBAHLoading",function(){_.showBAHLoading=!0}),b=e.rootScope.$on(i.LOG_ON_SUCCESS,function(){var e="PHP-Login-Top";_.loadingText="We're processing your details",_.refreshAds=!0,_.accountPanelLogon&&(e="PHP-Login-Panel"),_.BALog.addPageGeneralValues({authenticated:!0}),_.analytics.setCustomDimensions("Session",{PHPLoginStatus:"PHP login"}),_.analytics.trackEvent("Session",{PHPLoginStatus:"PHP login",loginfail:"false",interaction:e}),d.setBanParameterTrackingAttributeEmpty(),_.getTopicAndUserDataAndPopulatePageContent()}),T=e.rootScope.$on(i.LOG_OFF_SUCCESS,function(){angular.element(_.$document[0].getElementById("content")).removeClass("ac-open"),_.barOpen=!1,_.refreshAds=!0,_.serverTimeService.showConcurTab=!1,_.analytics.setCustomDimensions("Session",{PHPLoginStatus:"PHP logout"}),_.getTopicAndUserDataAndPopulatePageContent(),_.bACookieService.removeCookie(_.mainConstants.CONCUR_USER,_.mainConstants.COOKIE_PATH),_.bACookieService.removeCookie(_.mainConstants.CORPORATE_BOOKING,_.mainConstants.COOKIE_PATH),_.tncAllowLogon&&(_.$window.location.href="/travel/home/public/"+g.getLanguage().toLowerCase()+"_"+g.getCountry().toLowerCase())}),E=e.rootScope.$on("generalDataUpdated",function(){_.generalDataModelHasBeenUpdated=!0}),e.rootScope.$on("$destroy",f),e.rootScope.$on("$destroy",C),e.rootScope.$on("$destroy",b),e.rootScope.$on("$destroy",T),e.rootScope.$on("$destroy",S),e.rootScope.$on("$destroy",E),angular.forEach(this.availableComponents,function(e,t){p=_.$injector.get(e),_.components[t]=p}),this.watchConcur=function(){this.$scope.$watch(function(){return _.serverTimeService.showConcurTab},function(e){e&&(_.serverTimeService.concurDataResolved=!0,_.trackingService.addInitTracking({CORP:"TRUE"}))})},this.watchConcur(),_.corpTag=_.serverTimeService.showConcurTab?"TRUE":"FALSE",_.trackingService.addInitTracking({CORP:_.corpTag}),this.getMessagingContent=function(e){return _.components.messaging.build(e)},this.getRedemptionContent=function(){return _.components.redemption.build()},d.setTrackingDetails("HOME",g.getCountry().toUpperCase(),g.getLanguage().toUpperCase(),u.getCountryOfResidence()||"GB",u.getvFirstTracking()||"","Desktop site: Responsive: New homepage","BA",v.getTime()),d.setSourceTrackingAttribute(this.stateParams.source),this.analyticsTrackingService.init(d.getTrackingDetails().trackingData),this.analyticsTrackingService.setGlobalAttributes(),this.bACookieService.removeCookie("loginType","/"),this.bACookieService.removeCookie("execTier","/")},ba.bahome.main.BaHomeController.prototype.navigateToError=function(){this.$document.scrollToElementAnimated(angular.element(this.$document[0].getElementById("flight-error-message")))},ba.bahome.main.BaHomeController.prototype.populatePageContent=function(e){var t,a=this,n=[];this.userData=e.userData,this.topicData=e.topicData,this.authenticated=!1,this.userDataModel.state=this.userData.state,this.loggedOnState=this.authService.isLoggedOn(),this.userData.secondary&&this.userDataModel.setSecondaryCalls(this.userData.secondary),this.userData.loyalties&&this.userDataModel.setLoyaltyModel(this.userData.loyalties),this.userData.personalAttributes&&this.userDataModel.setPersonalAttributesModel(this.userData.personalAttributes),this.userDataModel.state===this.mainConstants.AUTHENTICATED_STATE&&(a.authenticated=!0),(this.loggedOnState||a.authenticated)&&"incident"!==a.layout&&(a.nextTripReplaceTopic=a.topicData[a.nextTripTopicLocation],a.topicData[a.nextTripTopicLocation]=null,this.fallbackTopic=function(){a.topicData[a.nextTripTopicLocation]=a.nextTripReplaceTopic,a.trackingService.addInitTracking({PHPNextTrip:"false"})},this.setTopicCallback=function(){var e=a.components[a.topicData[a.nextTripTopicLocation].id].build(a.topicData[a.nextTripTopicLocation],2);return n.push(e),e},n.push(this.userDetermination.determineAdditional("nextTrip").then(function(e){e.nextTrip&&(!e.nextTrip.noOfTrips||e.nextTrip.noOfTrips>0)?(a.userDataModel.setNextTripModel(e.nextTrip),a.userDataModel.nextTrip.daysRemaining>=a.mainConstants.MIN_REMAINING_DAYS&&a.userDataModel.nextTrip.daysRemaining<=a.mainConstants.MAX_REMAINING_DAYS?(a.topicData[a.nextTripTopicLocation]={id:"next-trip",type:"simple"},a.trackingService.addInitTracking({PHPNextTrip:"true"})):a.fallbackTopic()):a.fallbackTopic(),a.getDynamicContent[a.nextTripTopicLocation]=a.setTopicCallback})["catch"](function(){a.fallbackTopic(),a.getDynamicContent[a.nextTripTopicLocation]=a.setTopicCallback}))),this.$rootScope.$broadcast("userPopulated",a.barOpen),this.getHeroContent=function(){var e=a.components.hero.build(this.topicData[0]);return n.push(e),e},t=this.$rootScope.$on("heroPopulated",function(){a.$timeout(function(){a.loadMore=!0,a.showErrorMessage&&a.navigateToError(),a.heroLoaded=!0,a.$timeout(function(){a.hideLoading=!0},500)},500)}),this.$rootScope.$on("$destroy",t),this.generalDataModelHasBeenUpdated=!1,this.batchContentProvider.resetGeneralDataModel(),this.batchContentProvider.queryGeneralData(),this.formatValue=function(e){return e&&(e=parseInt(e.replace(",",""))),e},this.commonService.environment.get("BATCH_SOLR_REQUESTS")?this.batchContentProvider.queryByTopicData(this.topicData).then(function(e){a.commonService.log.generateLogByCode("BA_HOME_021"),a.populateDynamicContent(e,n)})["catch"](function(){a.commonService.log.generateLogByCode("BA_HOME_022"),a.populateDynamicContent(a.topicData,n)}):(this.commonService.log.generateLogByCode("BA_HOME_023"),a.populateDynamicContent(a.topicData,n)),this.commonService.setupUserDetails(this.userDataModel,a),this.userDataModel&&this.userDataModel.personalAttributes.customerType?(this.bACookieService.setCookie("loginType",this.mainConstants.loginTypes[this.userDataModel.personalAttributes.customerType],"/"),this.bACookieService.setCookie("execTier",this.userDataModel.loyalty.tier||"","/")):(this.bACookieService.setCookie("loginType","public","/"),this.bACookieService.setCookie("execTier","","/"))},ba.bahome.main.BaHomeController.prototype.advertLazyLoad=function(){var e,t,a=this;a.loadAd=!1,a.$timeout(function(){t=angular.element(a.$document[0].getElementById("advert-pod")),e=t.prop("offsetTop")-a.$window.innerHeight},100),a.$window.addEventListener("scroll",function(){a.loadAd||(1e3>e&&(e=t.prop("offsetTop")-a.$window.innerHeight),a.$window.pageYOffset>=e-1e3&&(a.loadAd=!0))})},ba.bahome.main.BaHomeController.prototype.populateDynamicContent=function(e,t){var a=this,n=a.topicDetermination.getTopicLimit();angular.forEach(e,function(e,o){a.getDynamicContent[o]=function(){var i=a.components[e.id].build(e,o);return t.push(i),o===n&&a.$q.all(t).then(function(){a.trackingService.fireTracking(),a.adsData=a.thirdPartySetupService.setUpThirdPartyAds(a.userDataModel)}),i}}),a.dataResolved=!0,a.$timeout(function(){a.showPageContent=!0},300),this.commonService.setupUserDetails(this.userDataModel,a),a.advertLazyLoad()},ba.bahome.main.BaHomeController.prototype.determineUserAndTopicData=function(){var e=this,t=this.$q.defer(),a={};return e.userDetermination.determine(e.stateParams).then(function(n){a.userData=n,e.layoutDetermination.determine(e.stateParams).then(function(o){e.$state.go("home."+o),e.layout=o,e.contentHandler.resetContentIdList(),e.topicDetermination.determine(e.stateParams,n,o).then(function(e){a.topicData=e,t.resolve(a)})})}),t.promise},ba.bahome.main.Module.value("AvailableComponents",{hero:"HeroViewModelBuilder","image-index":"ImageIndexViewModelBuilder",campaign:"CampaignViewModelBuilder",messaging:"MessagingViewModelBuilder",redemption:"RedemptionViewModelBuilder","next-trip":"NextTripViewModel","account-panel":"AccountPanelViewModel"}),ba.bahome.main.Module.controller("BaHomeController",["CommonService","UserDetermination","TopicDetermination","UserDataModel","AvailableComponents","AuthenticationConstants","ContentDuplicationHandler","ServerTimeService","AnalyticsTrackingService","BAAuthenticationService","LayoutDetermination","BACookieService","HomeTrackingDataModelBuilder","ClientLocaleService","$scope",ba.bahome.main.BaHomeController]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.LocaleUrlCheckerService=function(e,t){this.bacookie=e,this.location=t,this.regex=/\/[A-Za-z]{2}\-[A-Za-z]{2}\//},ba.bahome.main.LocaleUrlCheckerService.prototype.getLocale=function(){var e,t=this,a=this.location.absUrl(),n={present:!1};return a.match(t.regex)&&(e=a.match(t.regex)[0],e=e.replace(/\//g,""),n.language=e.substr(0,2).toLowerCase(),n.country=e.substr(3,5).toLowerCase(),n.present=!0),n},ba.bahome.main.LocaleUrlCheckerService.prototype.setLocaleCookies=function(){var e=this.getLocale();e.present&&(this.bacookie.setLanguageCode(e.language),this.bacookie.setCountryOfResidence(e.country))},ba.bahome.main.Module.service("LocaleUrlCheckerService",["BACookieService","$location",ba.bahome.main.LocaleUrlCheckerService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.ThirdPartySetupService=function(e,t,a){this.clientLocaleService=e,this.platformDetectionService=t,this.environment=a},ba.bahome.main.ThirdPartySetupService.prototype.setUpThirdPartyAds=function(e){var t,a=this,n={};return n.third_party_ads_enabled=a.environment.get("BA_THIRD_PARTY_ADS_ENABLED"),n.adUnitPath="/5508/ba.com/Homepage",n.sizeMappings=[{windowWidth:1100,windowHeight:0,advertWidth:970,advertHeight:250},{windowWidth:760,windowHeight:0,advertWidth:728,advertHeight:90},{windowWidth:320,windowHeight:0,advertWidth:300,advertHeight:250}],n.targeting={lan:a.clientLocaleService.getLanguage(),cntry:a.clientLocaleService.getCountry(),device:a.platformDetectionService.getPlatform(),time:(new Date).toLocaleString(),env:"test"},e&&(n.targeting.tier=e.loyalty.tier||"",n.targeting.membertype=e.loyalty.type||"",n.targeting.gender=e.personalAttributes.gender||"",n.targeting.partner_card=e.loyalty.coBrandedCardCode||!1,e.nextTrip&&e.nextTrip.flightDetails&&(t=e.nextTrip.flightDetails,n.targeting.outbound=t.originAirport,n.targeting.inbound=t.destinationAirport,n.targeting.route=t.originAirport+" to "+t.destinationAirport,n.targeting.cabinCode=t.cabinClass,n.targeting.dud=t.daysRemaining||"",n.targeting.ptnrcd=e.nextTrip.bookingReference)),n},ba.bahome.main.Module.service("ThirdPartySetupService",["ClientLocaleService","PlatformDetectionService","Environment",ba.bahome.main.ThirdPartySetupService]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.FlightFlownErrorViewData=function(){"use strict";return{showError:!1,errorType:"",errorMessageType:"warning",serviceErrorCode:"",httpErrorCode:"",httpStatusText:"flightFlownErrorMessage",displayTitle:"welcomeBack",errorMessageFromService:"",errorMessageForTracking:"",errorMessageForDisplay:""}},ba.bahome.main.Module.factory("FlightFlownErrorViewData",[ba.bahome.main.FlightFlownErrorViewData]),ba.lang.namespace("ba.bahome.main"),ba.bahome.main.FlightUnavailableErrorViewData=function(){"use strict";return{showError:!1,errorType:"",errorMessageType:"warning",serviceErrorCode:"",httpErrorCode:"",httpStatusText:"unavailableFlightErrorMessage",displayTitle:"unavailableFlightErrorTitle",errorMessageFromService:"",errorMessageForTracking:"",errorMessageForDisplay:""}},ba.bahome.main.Module.factory("FlightUnavailableErrorViewData",[ba.bahome.main.FlightUnavailableErrorViewData]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.checkin=function(e,t,a,n,o){"use strict";return{restrict:"A",scope:{nextTripContent:"="},link:function(i){function r(n){return i.staticDate=!0,s=new Date(i.nextTripContent.checkInDetails.checkInDate).getTime(),c=a.duration(s-n,"milliseconds"),Math.floor(c/1e3/60/60/24)>6?(i.staticDate=!0,void(i.nextTripContent.showApis=!1)):void(l=t(function(){c=a.duration(c-m,"milliseconds"),c>0?(i.days=Math.floor(c/1e3/60/60/24),i.hours=c.hours(),i.minutes=c.minutes(),i.seconds=c.seconds()):(t.cancel(l),i.days=0,i.hours=0,i.minutes=0,i.seconds=0,i.timerExpired=!0,o.$broadcast(e.TIMER_EXPIRED))},m))}var s,c,l,m=1e3;i.nextTripConstants=e,r(n.getTime())},templateUrl:"ba-home/templates/check-in-template.html"}},ba.bahome.nextTrip.Module.directive("checkin",["NextTripConstants","$interval","Moment","ServerTimeService","$rootScope",ba.bahome.nextTrip.checkin]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.flightDestinations=function(e,t){"use strict";return{restrict:"A",scope:{nextTripContent:"="},link:function(a){var n=e("date")(a.nextTripContent.departureTime,t.DATE_FORMAT),o=e("date")(a.nextTripContent.arrivalTime,t.DATE_FORMAT);n===o&&(a.hideArrivalDate=!0)},templateUrl:"ba-home/templates/flight-destination-template.html"}},ba.bahome.nextTrip.Module.directive("flightDestinations",["$filter","NextTripConstants",ba.bahome.nextTrip.flightDestinations]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.futureFlights=function(e,t,a,n,o){"use strict";return{restrict:"A",scope:{nextTripContent:"="},link:function(i){var r,s,c,l,m=t;for(s=a.generateBanParamObj(i.nextTripContent,m.typeCodes.nextTrip,i.nextTripContent.contentPosition),i.getLinkTrackingData=function(e){return e+=1,s.clickPosition=m.clickPosCodes.link+e,r=a.generateParamString(s),a.click(r)},i.getLinkTrackingString=function(e){return e=parseInt(e),c=i.getLinkTrackingData(e),i.mmbTrackingData="?",c&&"object"==typeof c&&(i.mmbTrackingData+=Object.keys(c).map(function(e){return e+"="+encodeURI(c[e])}).join("&")),i.mmbTrackingData},i.getMoreLinkTrackingData=function(e,t){return t>e?i.getLinkTrackingData(e):i.getLinkTrackingData(t)},i.futureFlightsContent=e.build(),l=0;l<i.futureFlightsContent.length;l++)i.futureFlightsContent[l].fullUrl=n.formBATeamsiteURL(o.PAGE_ID.MMB)+i.getLinkTrackingString(l);i.limitFlights=4},templateUrl:"ba-home/templates/future-flights-template.html"}},ba.bahome.nextTrip.Module.directive("futureFlights",["FutureFlightsViewModel","BanConstants","BanTrackingHelper","URLFormulationService","NextTripConstants",ba.bahome.nextTrip.futureFlights]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.mmb=function(e,t,a,n,o){"use strict";return{restrict:"A",scope:{nextTripContent:"="},link:function(i){var r,s,c,l,m,u={membership:"execclub/_gf"};i.mmbTrackingData=[],l=function(e){var t,a;return t=parseInt(e),r=n.generateBanParamObj(i.nextTripContent,o.typeCodes.nextTrip,i.nextTripContent.contentPosition),r.clickPosition=o.clickPosCodes.callToAction+t,s=n.generateParamString(r),a=n.click(s),i.mmbTrackingData[e]="?",a&&"object"==typeof a&&(i.mmbTrackingData[e]+=Object.keys(a).map(function(e){return e+"="+encodeURI(a[e])}).join("&")),i.mmbTrackingData[e]},m=function(a,n){var o={id:a.ID,describedBy:a.DESCRIBED_BY,key:a.KEY,EID:a.EID};return o.fullLink=t.formBATeamsiteURL(e.PAGE_ID.MMB)+l(n),a.EID===e.MMB_LINK_OBJECTS.CHANGE_SEAT.EID&&(o.fullLink+=e.MMB_DEEPLINK_AUTH),o},i.nextTripContent&&i.nextTripContent.checkInDetails&&i.nextTripContent.checkInDetails.status&&"cancelled"!==i.nextTripContent.flightStatus?i.nextTripContent.checkInDetails.status===e.CHECKIN_STATUS.TOO_EARLY?i.nextTripContent.seatNumber?(i.primaryButton=m(e.MMB_LINK_OBJECTS.CHANGE_SEAT,2),i.secondaryButton=m(e.MMB_LINK_OBJECTS.MMB,1)):(i.primaryButton=m(e.MMB_LINK_OBJECTS.CHOOSE_SEAT,2),i.secondaryButton=m(e.MMB_LINK_OBJECTS.MMB,1)):i.nextTripContent.checkInDetails.status===e.CHECKIN_STATUS.OPEN?(i.primaryButton=m(e.MMB_LINK_OBJECTS.START_CHECKIN,2),i.secondaryButton=m(e.MMB_LINK_OBJECTS.MMB,1)):i.nextTripContent.checkInDetails.status===e.CHECKIN_STATUS.IN_PROGRESS?(i.primaryButton=m(e.MMB_LINK_OBJECTS.CONTINUE_CHECKIN,2),i.secondaryButton=m(e.MMB_LINK_OBJECTS.MMB,1)):i.primaryButton=m(e.MMB_LINK_OBJECTS.MMB,1):i.primaryButton=m(e.MMB_LINK_OBJECTS.MMB,1),c=a.$on(e.TIMER_EXPIRED,function(){i.nextTripContent.checkInDetails.status===e.CHECKIN_STATUS.TOO_EARLY&&(i.primaryButton=m(e.MMB_LINK_OBJECTS.MMB,2),i.secondaryButton=m(e.MMB_LINK_OBJECTS.START_CHECKIN,1),l())}),a.$on("$destroy",c),i.mmbUrl=t.formBATeamsiteURL(e.PAGE_ID.MMB,u)},templateUrl:"ba-home/templates/mmb-template.html"}},ba.bahome.nextTrip.Module.directive("mmb",["NextTripConstants","URLFormulationService","$rootScope","BanTrackingHelper","BanConstants",ba.bahome.nextTrip.mmb]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.nextTripComponent=function(e,t,a,n,o,i,r){"use strict";return{restrict:"A",scope:{getContent:"&",skin:"@",contentPosition:"@"},link:function(s){s.tabOpen=t.NEXT,s.clickTab=function(e){s.tabOpen=e},e.when(s.getContent()).then(function(e){var i,c,l,m={determiner:null,solr:!0},u=[];s.nextTripContent=e,s.nextTripContent.skin=s.skin,s.nextTripContent.sourceRating=a.determineContentSource(m),s.nextTripContent.contentPosition=parseInt(s.contentPosition),s.nextTripContent.totalFlights>1&&(s.futureFlightsAvalible=!0),i=a.generateBanParamObj(s.nextTripContent,n.typeCodes.nextTrip,s.nextTripContent.contentPosition),c=a.generateParamString(i),a.triggerImpression(c),s.trackingData=a.click(c),s.trackingString="?",s.trackingData&&"object"==typeof s.trackingData&&(s.trackingString+=Object.keys(s.trackingData).map(function(e){return e+"="+encodeURI(s.trackingData[e])}).join("&")),s.fullLinkApis=r.formBATeamsiteURL(t.PAGE_ID.MMB)+s.trackingString,l={destination_city_name:s.nextTripContent.destinationCity,origin_airport_name:s.nextTripContent.departureAirport,scheduled_departure_time:s.nextTripContent.departureTime,flight_status:s.nextTripContent.flightStatus},u.push(l),o.setAttribute("future_flights",u)}),s.breakpoint=i.getBreakpoint(),s.nextTripConstants=t,"small"===s.breakpoint.view?(s.toggleIcon=!0,s.apis="apisLabelMobile"):s.apis="apisLabelDesktop"},templateUrl:"ba-home/templates/next-trip-template.html"}},ba.bahome.nextTrip.Module.directive("nextTripComponent",["$q","NextTripConstants","BanTrackingHelper","BanConstants","AnalyticsTrackingService","BreakpointDetectionService","URLFormulationService",ba.bahome.nextTrip.nextTripComponent]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.seating=function(e){"use strict";return{restrict:"A",scope:{nextTripContent:"="},link:function(t){t.nextTripContent.seatNumber&&t.nextTripContent.showSeatNumber&&(t.showSeatNumber=!0),t.nextTripConstants=e},templateUrl:"ba-home/templates/seating-template.html"}},ba.bahome.nextTrip.Module.directive("seating",["NextTripConstants",ba.bahome.nextTrip.seating]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.upSellingComponent=function(e){"use strict";return{restrict:"A",scope:{nextTripContent:"="},link:function(t){t.nextTripConstants=e},templateUrl:"ba-home/templates/up-selling-template.html"}},ba.bahome.nextTrip.Module.directive("upSellingComponent",["NextTripConstants",ba.bahome.nextTrip.upSellingComponent]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.FutureFlightsViewModel=function(e){this.build=function(){var t,a,n=e.getFutureFlightsModel(),o=[];for(a=0;a<n.length;a++)t={},t.bookingRef=n[a].bookingReference,t.lastname=n[a].passengerDetails.lastName,t.origin=n[a].flightDetails.originCity,t.originCode=n[a].flightDetails.originCityCode,t.destination=n[a].flightDetails.destinationCity,t.destinationCode=n[a].flightDetails.destinationCityCode,t.departDate=n[a].flightDetails.scheduledDepartureDateTime.split(".")[0],t.arriveDate=n[a].flightDetails.scheduledArrivalDateTime.split(".")[0],o.push(t);return o}},ba.bahome.nextTrip.Module.service("FutureFlightsViewModel",["UserDataModel",ba.bahome.nextTrip.FutureFlightsViewModel]),ba.lang.namespace("ba.bahome.nextTrip"),ba.bahome.nextTrip.NextTripViewModel=function(e,t){this.build=function(){var a,n,o,i,r=e.getNextTripModel(),s=t.FLIGHT_STATUS_ONTIME,c="";return r.disruptionDetails&&(r.disruptionDetails.publicDepartureStatus&&(s=r.disruptionDetails.publicDepartureStatus.toLowerCase()),c=r.disruptionDetails.flightRescheduledStatus,o=r.disruptionDetails.estimatedArrivalDateTime,i=r.disruptionDetails.estimatedDepartureDateTime),r.flightDetails&&r.flightDetails.destinationCityCode&&(n=t.TEAMSITE_IMAGE_PATH+r.flightDetails.destinationCityCode.toLowerCase()+t.IMAGE_FILE_PREFIX+r.flightDetails.destinationCityCode.toLowerCase()+t.IMAGE_FILE_SUFFIX),r.checkInStatus&&r.checkInStatus!==t.CHECKIN_STATUS.CLOSED&&r.checkInStatus!==t.CHECKIN_STATUS.UNAVAILABLE&&(a=!0),{backgroundImgSrc:n||"",bookingRef:r.bookingReference||"",flightNumber:r.flightDetails.marketingCarrierCode+r.flightDetails.marketingFlightNumber||"",flightStatus:s,checkInDetails:{checkInFlag:!0,status:r.checkInStatus||"",checkInDate:r.checkInDateTime?r.checkInDateTime.split(".")[0]:""},delayed:c,departureCity:r.flightDetails.originCity||"",departureAirport:r.flightDetails.originAirport||"",departureAirportCode:r.flightDetails.originAirportCode||"",departureTime:r.flightDetails.scheduledDepartureDateTime?r.flightDetails.scheduledDepartureDateTime.split(".")[0]:"",departureTimeDelayed:i?i.split(".")[0]:"",departureTerminal:r.flightDetails.originTerminal||"",arrivalTime:r.flightDetails.scheduledArrivalDateTime?r.flightDetails.scheduledArrivalDateTime.split(".")[0]:"",arrivalTimeDelayed:o?o.split(".")[0]:"",destinationCity:r.flightDetails.destinationCity||"",destinationAirport:r.flightDetails.destinationAirport||"",destinationAirportCode:r.flightDetails.destinationAirportCode||"",destinationTerminal:r.flightDetails.destinationTerminal||"",missingApis:!r.passengerDetails.apisStatus,showApis:!0,seatNumber:r.passengerDetails.seatNumber||"",showSeatNumber:a,surname:r.passengerDetails.lastName,totalFlights:r.totalFlights}}},ba.bahome.nextTrip.Module.service("NextTripViewModel",["UserDataModel","NextTripConstants",ba.bahome.nextTrip.NextTripViewModel]),ba.lang.namespace("ba.bahome.pricing"),ba.bahome.pricing.pricingContent=function(e,t,a,n,o,i,r,s,c,l,m,u){return this.breakpointDetectionService=u,{scope:{getContent:"&",contentPosition:"=",limit:"=",calledFrom:"="},restrict:"A",link:function(u){var d,g,h,p=o,b=function(e,n){var o=[],r=i.TEXT_KEY;return"undefined"==typeof n.cabin&&(n.cabin="M"),t.get(n.cabin).then(function(s){return e!==i.LAYOUT_TYPE.FLIGHT_NIGHTS&&s!==i.FIRST_CLASS&&(s=s.toLowerCase()),n.destination&&(n.destination=a("titlecase")(n.destination)),n.destinationHols&&(n.destinationHols=a("titlecase")(n.destinationHols)),n.cabin===i.ECONOMY_CODE&&(r=i.TEXT_KEY_M),o[i.LAYOUT_TYPE.FLIGHTS]={key:r.FLIGHTS,supplant:{destination:n.destination}},o[i.LAYOUT_TYPE.FLIGHTS_CLASS]={key:r.FLIGHTS_CLASS,supplant:{cabin:s}},o[i.LAYOUT_TYPE.FLIGHTS_DEST_TRAVEL]={key:r.FLIGHTS_DEST_TRAVEL,supplant:{cabin:s,destination:n.destination}},o[i.LAYOUT_TYPE.FLIGHTS_DEST]={key:r.FLIGHTS_DEST,supplant:{destination:n.destination}},o[i.LAYOUT_TYPE.FLIGHTS_LAST]={key:r.FLIGHTS_LAST,supplant:{destination:n.destination}},o[i.LAYOUT_TYPE.FLIGHTS_CHEAP]={key:r.FLIGHTS_CHEAP,supplant:{destination:n.destination}},o[i.LAYOUT_TYPE.HOTELS]={key:r.HOTELS,supplant:{numNights:n.numNights}},o[i.LAYOUT_TYPE.CARS]={key:r.CARS,supplant:{numNights:n.numNights}},o[i.LAYOUT_TYPE.DEST_HOLS]={key:r.DEST_HOLS,supplant:{cabin:s,destination:n.destinationHols}},o[i.LAYOUT_TYPE.DEST_BREAKS]={key:r.DEST_BREAKS,supplant:{cabin:s,destination:n.destinationHols}},o[i.LAYOUT_TYPE.DEST_NIGHT_HOLS]={key:r.DEST_NIGHT_HOLS,supplant:{cabin:s,destination:n.destinationHols,numNights:n.numNights}},o[i.LAYOUT_TYPE.DEST_NIGHT_BREAKS]={key:r.DEST_NIGHT_BREAKS,supplant:{cabin:s,destination:n.destinationHols,numNights:n.numNights}},o[i.LAYOUT_TYPE.FLIGHT_NIGHTS]={key:r.FLIGHT_NIGHTS,supplant:{cabin:s,numNights:n.numNights}},o[i.LAYOUT_TYPE.DEST_FLIGHT_NIGHT_BREAKS]={key:r.DEST_FLIGHT_NIGHT_BREAKS,supplant:{cabin:s,destination:n.destinationHols,numNights:n.numNights}},o[i.LAYOUT_TYPE.DEST_FLIGHT_NIGHT_HOLS]={key:r.DEST_FLIGHT_NIGHT_HOLS,supplant:{cabin:s,destination:n.destinationHols,numNights:n.numNights}},o[i.LAYOUT_TYPE.DEST_FLIGHT_HOTEL]={key:r.DEST_FLIGHT_HOTEL,supplant:{cabin:s,destination:n.destinationHols,numNights:n.numNights}},o[i.LAYOUT_TYPE.FLIGHT_CARS]={key:r.FLIGHT_CARS,supplant:{numNights:n.numNights}},o[i.LAYOUT_TYPE.FLIGHT_CARS_DEST]={key:r.FLIGHT_CARS_DEST,supplant:{destination:n.destinationHols,numNights:n.numNights}},o[i.LAYOUT_TYPE.FLIGHT_CARS_DEST_CLASS]={key:r.FLIGHT_CARS_DEST_CLASS,supplant:{cabin:s,destination:n.destinationHols,numNights:n.numNights}},o[i.LAYOUT_TYPE.FLIGHT_CARS_FLY_DRIVE]={key:r.FLIGHT_CARS_FLY_DRIVE,supplant:{destination:n.destinationHols}},t.get(o[e].key,o[e].supplant)})},T=function(e,n){switch(e){case i.LAYOUT_TYPE.DEST_HOLS:case i.LAYOUT_TYPE.DEST_BREAKS:case i.LAYOUT_TYPE.DEST_NIGHT_HOLS:case i.LAYOUT_TYPE.DEST_NIGHT_BREAKS:case i.LAYOUT_TYPE.FLIGHT_NIGHTS:case i.LAYOUT_TYPE.DEST_FLIGHT_NIGHT_HOLS:case i.LAYOUT_TYPE.DEST_FLIGHT_NIGHT_BREAKS:case i.LAYOUT_TYPE.DEST_FLIGHT_HOTEL:n.tripType=i.TRIP_TYPE_PP,n.price=n.pricePp}return t.get(n.tripType).then(function(t){var o;switch(e){case i.LAYOUT_TYPE.HOTELS:o={key:i.TEXT_KEY.HOTELS_LINK,supplant:{price:a(i.BA_CURRENCY)(n.pricePerPersonPerNight,u.currencyDetails.symbol,0,u.currencyDetails.placement,!1)}};break;case i.LAYOUT_TYPE.CARS:o={key:i.TEXT_KEY.CARS_LINK,supplant:{price:a(i.BA_CURRENCY)(n.dailyPrice,u.currencyDetails.symbol,0,u.currencyDetails.placement,!1),numNights:n.numNights}};break;case i.LAYOUT_TYPE.FLIGHT_CARS:case i.LAYOUT_TYPE.FLIGHT_CARS_DEST:case i.LAYOUT_TYPE.FLIGHT_CARS_DEST_CLASS:case i.LAYOUT_TYPE.FLIGHT_CARS_FLY_DRIVE:o={key:i.TEXT_KEY.CARS_FLIGHT_LINK,supplant:{price:a(i.BA_CURRENCY)(n.pricePp,u.currencyDetails.symbol,0,u.currencyDetails.placement,!1)}};break;default:o={key:i.TEXT_KEY.FLIGHTS_LINK,supplant:{price:a(i.BA_CURRENCY)(n.price,u.currencyDetails.symbol,0,u.currencyDetails.placement,!1),tripType:t,departureDate:a("baDateMonthAndYear")(n.departureDate),departure:n.departure}}}return o})},f=function(e,t){var n,o=t.layout;if(t.source||(t.source=i.LINK_SOURCE),t.linkOveride){if(t.linkOveride.manualLink)return l.transformLink(t.linkOveride.manualLink);switch(t.linkOveride.linkType){case i.LINK_TYPE.FXOVERRIDE:n=i.LINK_TYPE.FXFILTER;break;case i.LINK_TYPE.HOLIDAYSOVERRIDE:case i.LINK_TYPE.HOLIDAYSDATEOVERRIDE:n=i.LINK_TYPE.HOLIDAYS;break;case i.LINK_TYPE.LPFOVERRIDE:n=i.LINK_TYPE.FLIGHTS;break;default:n=i.LINK_TYPE.DEEPLINKOVERRIDE}return n===i.LINK_TYPE.DEEPLINKOVERRIDE?l.transformLink(t.deepLink):a(n)(t,e)}switch(o){case i.LAYOUT_TYPE.DEST_HOLS:case i.LAYOUT_TYPE.DEST_BREAKS:case i.LAYOUT_TYPE.DEST_NIGHT_HOLS:case i.LAYOUT_TYPE.DEST_NIGHT_BREAKS:case i.LAYOUT_TYPE.FLIGHT_NIGHTS:case i.LAYOUT_TYPE.DEST_FLIGHT_NIGHT_HOLS:case i.LAYOUT_TYPE.DEST_FLIGHT_NIGHT_BREAKS:case i.LAYOUT_TYPE.DEST_FLIGHT_HOTEL:n=i.LINK_TYPE.HOLIDAYS;break;default:n=i.LINK_TYPE.FLIGHTS}return a(n)(t,e)},C=function(t){var n=[];return angular.forEach(t.products,function(o){var r={},s=[];s.push(b(o.layout,o)),s.push(T(o.layout,o)),e.allSettled(s).then(function(e){r.header=o.customPriceHeader?o.customPriceHeader:e[0].value,r.text=e[1].value,r.link=f(t,o),this.breakpointDetectionService.getBreakpoint().view!==i.SMALL_SCREEN&&r.text.supplant&&r.text.supplant.price&&r.text.supplant.price.length>i.LONG_PRICE_CHAR_LIMIT?r.priceSize=i.LONG_PRICE:r.priceSize=i.SHORT_PRICE,r.currency=o.currencyCode,r.price=o.dailyPrice||o.pricePerPersonPerNight||o.pricePp||o.price,r.trackedPrice=r.price,r.price=a(i.BA_CURRENCY)(r.price,u.currencyDetails.symbol,0,u.currencyDetails.placement,!1),
r.destinationCode=o.destinationCode,o.departureCode&&o.destinationCode&&(r.route=o.departureCode+o.destinationCode),n.push(r)})}),n};e.when(u.getContent()).then(function(e){e.query&&(u.loading=!0,m.getPricesByQuery(e.query).then(function(t){e.products=t,h=e.products[0].currencyCode,r.getCurrency(h).then(function(t){u.loading=!1,u.currencyDetails=t,u.content=C(e),u.layout=e.layout,u.skin=e.skin,u.content.source=e.source,u.content.contentId=e.contentId,g=u.calledFrom===i.HERO?n.generateBanParamObj(u.content,p.typeCodes.hero,u.contentPosition):n.generateBanParamObj(u.content,p.typeCodes.pricing,u.contentPosition)})["catch"](function(e){u.loading=!1,s.log.generateLogByCode(i.LOG_CURRENCY_ERROR,e.status),u.currencyDetails={code:h,symbol:h}})})["catch"](function(){u.loading=!1,s.log.generateLogByCode("BA_HOME_025")}))}),u.getLinkData=function(e,t){return e+=1,g.destination=t.destinationCode,g.clickPosition=p.clickPosCodes.price+e,g.price=t.trackedPrice,g.componentPosition=parseInt(u.contentPosition)+1,g.currency=t.currency,g.route=t.route,d=n.generateParamString(g),n.click(d)},u.currentSlide=1,u.moveToSlide=function(e){u.currentSlide=e,1===e&&angular.element(c[0].getElementById("carousel")).css("margin-left","0"),2===e&&angular.element(c[0].getElementById("carousel")).css("margin-left","-100%"),3===e&&angular.element(c[0].getElementById("carousel")).css("margin-left","-200%")},u.leftSwipe=function(){u.currentSlide<u.content.length&&u.moveToSlide(u.currentSlide+1)},u.rightSwipe=function(){u.currentSlide>1&&u.moveToSlide(u.currentSlide-1)}},templateUrl:"ba-home/templates/pricing-view.html"}},ba.bahome.pricing.Module.directive("pricingContent",["$q","ResourceBundle","$filter","BanTrackingHelper","BanConstants","PricingConstants","CurrencyDetailsService","CommonService","$document","DeeplinkService","PriceProvider","BreakpointDetectionService",ba.bahome.pricing.pricingContent]),ba.lang.namespace("ba.bahome.main"),ba.bahome.pricing.DeeplinkService=function(e){this.country=e.getCountry(),this.language=e.getLanguage()},ba.bahome.pricing.DeeplinkService.prototype.transformLink=function(e){var t=this;if(e.match(/\.ba\.com/)&&(e=e.replace("ba.com/","britishairways.com/")),e.match(/\.britishairways\.com/)){if(e.match(/\/en-/))return e.replace("/en-","/"+t.language+"-");if(e.match(/\/en_/))return e.replace("/en_","/"+t.language+"_");if(!e.match(/\.britishairways\.com\/travel\//))return e.replace("britishairways.com/","britishairways.com/"+t.language+"-"+t.country+"/");if(e.match(/\.britishairways\.com\/travel\//)&&e.match(/\/public\//))return e.replace("/public/","/public/"+t.language+"_"+t.country+"/")}return e},ba.bahome.pricing.Module.service("DeeplinkService",["ClientLocaleService",ba.bahome.pricing.DeeplinkService]),ba.lang.namespace("ba.bahome.recentSearches"),ba.bahome.recentSearches.RecentSearchesController=function(e,t,a,n,o,i,r,s,c,l,m){var u,d=this,g=n,h="empty",p="empty",b=a,T=i,f=[];this.trackingService=m,d.loading=!0,d.log=o.log,l(function(){d.loading=!1},5e3),d.combineSearches=function(){var e={};for(d.recentSearches=[],u=0;u<d.recentSearchesCookie.length;u+=1)b.checkDuplicateSearch(d.recentSearchesCookie[u],d.recentSearches)?b.removeCookie(d.recentSearchesCookie[u].id):(-1===f.indexOf(d.recentSearchesCookie[u].origin)&&f.push(d.recentSearchesCookie[u].origin),d.recentSearches.push(d.recentSearchesCookie[u]));for(u=0;u<d.recentSearchesServer.length;u+=1)b.checkDuplicateSearch(d.recentSearchesServer[u],d.recentSearches)||d.recentSearches.push(d.recentSearchesServer[u]);angular.forEach(f,function(e){T.getDestinationName(e).then(function(t){d.originCodes[e]=t})}),angular.forEach(d.recentSearches,function(e){e.url=c.createURL(e)}),d.recentSearches.length?(e.PHPRecentSearch="true",d.recentSearches.length>2?e.PHPShowMore="true":e.PHPShowMore="false"):e.PHPRecentSearch="false",d.trackingService.addInitTracking(e),d.reLoading=!1,d.loading=!1},d.initRecentSearches=function(){for(d.recentSearchesServer=e.userModel.interactions,d.recentSearchesCookie=[],d.originCodes=[],u=0;u<d.recentSearchesServer.length;u+=1)d.recentSearchesServer[u].priceQuotedObj&&(d.recentSearchesServer[u].priceQuotedCurrency=g.getSymbol[d.recentSearchesServer[u].priceQuotedObj.currencyCode],d.recentSearchesServer[u].priceQuoted=d.recentSearchesServer[u].priceQuotedObj.amount);p=t.getCookieValue("RSR_TEMP"),h=t.getCookieValue("RSR_RESULTS"),p&&"empty"!==p&&(h=h&&"empty"!==h?p+"||"+h:p,t.setCookie("RSR_RESULTS",h,"/"),t.setCookie("RSR_TEMP","empty","/")),h&&"empty"!==h&&(d.recentSearchesCookie=b.transformCookie(h)),d.combineSearches()},"authenticated"===s.state?r.determineAdditional("interactions").then(function(e){e.interactions&&s.setInteractionsModel(e.interactions),d.initRecentSearches()})["catch"](function(){d.initRecentSearches(),d.log.generateLogByCode("BA_HOME_RCNT_001")}):d.initRecentSearches()},ba.bahome.recentSearches.Module.controller("RecentSearchesController",["$scope","BACookieService","RecentSearchCookieTransformer","SymbolLookupService","CommonService","DestinationNamesService","UserDetermination","UserDataModel","RecentUrlModel","$timeout","TrackingService",ba.bahome.recentSearches.RecentSearchesController]),ba.lang.namespace("ba.bahome.recentSearches"),ba.bahome.recentSearches.recentSearchesComponent=function(e,t,a,n,o){return{restrict:"A",controller:"RecentSearchesController",controllerAs:"recentSrchCtrl",scope:{userModel:"="},link:function(i){var r,s,c,l,m,u,d,g=e,h=n;for(i.minDisplayLength=2,i.maxDisplayLength=6,i.displayLength=i.minDisplayLength,i.displayAll=!1,i.searchContent={},i.contentPosition=9,r=a.generateBanParamObj(i.searchContent,h.typeCodes.recent,i.contentPosition),s=a.generateParamString(r),a.triggerImpression(s),c=function(e,t,n){var o;return e?(e.clickPosition=t,o=a.click(a.generateParamString(e)),n&&(o.interaction="PHP-Continue"+n+"-button"),o):void 0},i.tracking={},u=function(e){return Object.keys(e).map(function(t){return"undefined"!=typeof e[t]?t+"="+encodeURI(e[t]):void 0}).join("&")},l=0;6>l;l+=1)d=c(r,h.clickPosCodes.callToAction+(l+1),l+1),d&&"object"==typeof d&&(i.tracking["trackingData"+l]="&"+u(d));i.tracking.trackingDataLink=c(r,h.clickPosCodes.link+1),i.removeRecentSearch=function(e){i.recentSrchCtrl.reLoading=!0,i.recentSrchCtrl.recentSearchesCookie=g.deleteCookie(e),i.recentSrchCtrl.recentSearches=[],t(function(){i.recentSrchCtrl.combineSearches()},1)},i.toggleDeletePanel=function(e){e.toggleDelete=!e.toggleDelete},i.toggleLimit=function(){i.displayAll=!i.displayAll,i.displayAll?(i.displayLength=i.maxDisplayLength,o.trackEvent("Session",{interaction:"PHP-ShowMoreSearches-button"})):(i.displayLength=i.minDisplayLength,o.trackEvent("Session",{interaction:"PHP-ShowLessSearches-button"})),t(function(){m=angular.element(document.querySelector("#search-button-0")),i.displayAll&&(m=angular.element(document.querySelector("#search-button-2"))),m[0].focus()},100)}},templateUrl:"ba-home/templates/recent-searches-template.html"}},ba.bahome.recentSearches.Module.directive("recentSearchesComponent",["RecentSearchCookieTransformer","$timeout","BanTrackingHelper","BanConstants","analytics",ba.bahome.recentSearches.recentSearchesComponent]),ba.lang.namespace("ba.bahome.recentSearches"),ba.bahome.recentSearches.RecentUrlModel=function(e){this.fxLink="/main/booking/#/flightList",this.redempLink="/travel/redeem/execclub/_gf?eId=100002&source=rsrHomepagePHP",this.country=e.getCountry().toLowerCase()},ba.bahome.recentSearches.RecentUrlModel.prototype.createDate=function(e){var t,a=this;return"us"===a.country&&(t=e.split("-"),e=t[0]+"-"+t[2]+"-"+t[1]),e},ba.bahome.recentSearches.RecentUrlModel.prototype.createURL=function(e){var t,a=this,n=0;return e.passengers&&e.passengers[3]&&e.passengers[3].count&&(n=e.passengers[3].count),e.redemptionSearch?(t=a.redempLink,t+=e.originAirport?"&departurePoint="+e.originAirport:"&departurePoint="+e.origin,t+=e.destinationAirport?"&destinationPoint="+e.destinationAirport:"&destinationPoint="+e.destination,t+="&departInputDate="+a.createDate(e.departureDateURL),e.returnDateURL&&(t+="&returnInputDate="+a.createDate(e.returnDateURL)),t+="&NumberOfAdults="+e.passengers[0].count,t+="&NumberOfYoungAdults="+n,t+="&NumberOfChildren="+e.passengers[1].count,t+="&NumberOfInfants="+e.passengers[2].count,t+="&CabinCode="+e.cabin,t+="&redemption_type=STD_RED&tab_selected=redeem&RestrictionType=Restricted"):(t=a.fxLink,t+=e.originAirport?"?origin="+e.originAirport:"?origin="+e.origin,t+=e.destinationAirport?"&destination="+e.destinationAirport:"&destination="+e.destination,t+="&outboundDate="+a.createDate(e.departureDateURL),e.returnDateURL?(t+="&inboundDate="+a.createDate(e.returnDateURL),t+="&journeyType=RTFLT"):t+="&journeyType=OWFLT",t+="&adultCount="+e.passengers[0].count,t+="&youngAdultCount="+n,t+="&childCount="+e.passengers[1].count,t+="&infantCount="+e.passengers[2].count,t+="&cabin="+e.cabin,t+="&ticketFlexibility=LOWEST"),t},ba.bahome.recentSearches.Module.service("RecentUrlModel",["ClientLocaleService",ba.bahome.recentSearches.RecentUrlModel]),ba.lang.namespace("ba.bahome.redemption"),ba.bahome.redemption.redemptionComponent=function(e,t,a){return{scope:{getContent:"&",tierColour:"=",contentPosition:"="},restrict:"A",link:function(n){var o,i,r,s,c=a;n.loading=!0,e.when(n.getContent()).then(function(e){n.redemptionContent=e,n.redemptionContent.tier=n.tierColour,n.loading=!1,s=t.generateBanParamObj(n.redemptionContent,c.typeCodes.redemption,n.contentPosition),o=t.generateParamString(s),t.triggerImpression(o),s.clickPosition=c.clickPosCodes.callToAction+"1",i=t.generateParamString(s),n.trackingDataCTA=t.click(i),s.clickPosition=c.clickPosCodes.link+"1",r=t.generateParamString(s),n.trackingDataLNK=t.click(r)})},templateUrl:"ba-home/templates/redemption-view-template.html"}},ba.bahome.redemption.Module.directive("redemptionComponent",["$q","BanTrackingHelper","BanConstants","MainConstants",ba.bahome.redemption.redemptionComponent]),ba.lang.namespace("ba.bahome.redemption"),ba.bahome.redemption.RedemptionViewModelBuilder=function(e,t,a,n,o){this.build=function(){var i=e.defer();return a.getRedemptionContent().then(function(e){e.source={solr:!0},i.resolve(e)})["catch"](function(){var e={};t.get("redemptionFallbackTitle").then(function(t){e.title=t!==n.RESOURCE_NOT_FOUND?t:""}),t.get("redemptionFallbackMessage").then(function(t){e.message=t!==n.RESOURCE_NOT_FOUND?t:""}),t.get("redemptionFallbackButtonLabel").then(function(t){e.buttonLabel=t!==n.RESOURCE_NOT_FOUND?t:""}),t.get("redemptionFallbackLinkMessage").then(function(t){e.linkMessage=t!==n.RESOURCE_NOT_FOUND?t:""}),e.buttonUrl=o.FALLBACK_BUTTON_URL,e.linkMessageUrl=o.FALLBACK_MESSAGE_URL,e.source={solr:!1},i.resolve(e)}),i.promise}},ba.bahome.redemption.Module.service("RedemptionViewModelBuilder",["$q","ResourceBundle","ContentProvider","MainConstants","RedemptionConstants",ba.bahome.redemption.RedemptionViewModelBuilder]),ba.lang.namespace("ba.bahome.searchBar"),ba.bahome.searchBar.SearchBarController=function(e,t,a,n,o,i){"use strict";var r,s,c,l=this,m=0,u=0,d=0,g=0;l.topAdjustmentValue=0,this.heroLoaded=!1,this.flightOnly=o.checkFlightOnly(),c=function(e){return a[0].getElementsByClassName(e).length>0&&"auto"!==n.getComputedStyle(a[0].getElementsByClassName(e)[0]).getPropertyValue("height")?Number(n.getComputedStyle(a[0].getElementsByClassName(e)[0]).getPropertyValue("height").replace("px","")):0},r=t.$on("heroLoaded",function(){l.heroLoaded=!0,m=c("beta"),u=c("desktop-account-bar"),d=c("disruption-banner"),l.topAdjustmentValue=m+u+d}),t.$on("$destroy",r),s=t.$on("toggleAcBar",function(){m=c("beta"),u=c("desktop-account-bar"),d=c("disruption-banner"),i(function(){g=c("account-bar"),l.topAdjustmentValue=m+u+d+g},2e3)}),t.$on("$destroy",s),this.isConcur=e.showConcurTab,this.updateOriginSuggestions=function(){}},ba.bahome.searchBar.Module.controller("SearchBarController",["ServerTimeService","$rootScope","$document","$window","BetaCheckService","$timeout",ba.bahome.searchBar.SearchBarController]),ba.lang.namespace("ba.bahome.spinner"),ba.bahome.spinner.spinnerComponent=function(){"use strict";return{restrict:"A",scope:{spin:"=?"},templateUrl:"ba-home/templates/spinner-template.html"}},ba.bahome.spinner.Module.directive("spinnerComponent",ba.bahome.spinner.spinnerComponent),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.TopicDetermination=function(e,t,a,n,o,i){var r,s,c,l,m=this,u={},d=[],g=[];return this.$q=e,this.topicModel=t,this.topicConstants=o,this.$injector=a,this.availableDeterminers=n.get("BA_TOPIC_DETERMINERS",[m.topicConstants.DETERMINERS.LSCS,m.topicConstants.DETERMINERS.DEFAULT]),this.layoutDetermination=i,angular.forEach(m.availableDeterminers,function(e){c=m.$injector.get(e),c.name=e,d.push(c)}),l=function(e,t,a){var n,o,i,c,u=m.topicConstants.RULE;a=a||0,n=a+1,o=n===d.length,i=d[a],c={stateParams:t,rule:u,userDetails:s},i.determine(c).then(function(a){var s=!1;i.name===m.topicConstants.DETERMINERS.LSCS&&0===g.length&&(r-=1),i.name===m.topicConstants.DETERMINERS.URL&&m.userData.state===m.topicConstants.AUTHENTICATED&&(angular.forEach(a,function(e){e.container===m.topicConstants.REDEMPTION.SLOT&&(s=!0)}),s||(r-=1)),a.length>0?angular.forEach(a,function(e){g.length<r&&g.push(e)}):g.push(a),g.length<r&&!o?l(e,t,n):m.reformatTopicList(g,e)})["catch"](function(){o&&g.length>0?m.reformatTopicList(g,e):o?e.reject():l(e,t,n)})},this.reformatTopicList=function(e,t){this.mapTopicsBasedOnContainerId(e).then(function(e){m.userData&&m.userData.state===m.topicConstants.AUTHENTICATED&&(e[m.topicConstants.REDEMPTION.INDEX]=m.topicConstants.REDEMPTION),t.resolve(e)})},this.mapTopicsBasedOnContainerId=function(e){var t,a=[],n=this.$q.defer(),o=function(){angular.forEach(e,function(o,i){if(!o.container)for(t=0;t<a.length;t++)if(!a[t]){a[t]=o;break}i===e.length-1&&n.resolve(a)})};return a.length=u.getTopicLimit()+1,angular.forEach(e,function(t,n){t.container&&(!a[t.container-1]||a[t.container-1]&&!a[t.container-1].container)&&(t.id=1===t.container?m.topicConstants.HERO.id:t.id,a[t.container-1]=t),n===e.length-1&&(a[0]&&1===a[0].container||(a[0]=m.topicConstants.HERO),a[1]=m.topicConstants.ACCOUNT_PANEL,o())}),n.promise},this.getSeriousIncidentTopics=function(e){var t=[m.topicConstants.SERIOUS_INCIDENT.HERO,m.topicConstants.SERIOUS_INCIDENT.CAMPAIGN,m.topicConstants.SERIOUS_INCIDENT.CAMPAIGN,m.topicConstants.SERIOUS_INCIDENT.CAMPAIGN];e.resolve(t)},u.getTopicLimit=function(){return m.topicConstants.TOPIC_LIMIT[m.layoutDetermination.layout]||m.topicConstants.TOPIC_LIMIT["default"]},u.determine=function(e,t,a){var n=m.$q.defer();return g=[],r=u.getTopicLimit(),m.userData=t,s=m.topicModel.getUserData(t),a===m.topicConstants.SERIOUS_INCIDENT.LAYOUT?m.getSeriousIncidentTopics(n):l(n,e),n.promise},u},ba.bahome.topicDeterminer.Module.factory("TopicDetermination",["$q","TopicModel","$injector","Environment","TopicConstants","LayoutDetermination",ba.bahome.topicDeterminer.TopicDetermination]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.TopicModel=function(e){var t,a,n,o=this,i={},r=new Date;this.getUserData=function(e){return o.user=e,i.avios="",i.tier="",i.type="",i.state="anonymous",i.country="GB",i.lang="EN",i.nextTrip=!1,i.cabin="",i.productType="FO",i.destination="",i.pax="",i.origin="",i.start="",i.hasRecentSearches=!1,"undefined"!=typeof o.user&&"object"==typeof o.user&&(i.state=o.user.state||"anonymous",o.user.loyalties&&o.user.loyalties.registeredCustomer&&(t=o.user.loyalties.registeredCustomer.loyaltyAccountDetails,i.avios=t.pointsBalance.balance,i.tier=t.tierLevel,i.type=t.type),o.user.interactions&&o.user.interactions.registeredCustomer&&(a=o.user.interactions.registeredCustomer.customerInteraction,a.length>0&&(i.hasRecentSearches=!0)),o.user.nextTrip&&o.user.nextTrip.segment&&o.user.nextTrip.segment[0]&&(n=o.user.nextTrip.segment[0],i.nextTrip=!0,i.destination=n.flightDetail.destinationAirport,i.origin=n.flightDetail.originAirport,i.start=new Date(n.flightDetail.departureDateTime),i.start=Math.round((i.start-r)/864e5))),i},this.getTopicDataFromUrl=function(t,a){return o.topics=t,o.topic={},"undefined"!=typeof o.topics&&(-1!==o.topics.indexOf("|")?(o.topics=o.topics.split("|"),o.topic.id=o.topics[0]||"",o.topic.type=e.TOPIC_TYPE_CONTENT,o.topic.terms=e.SOLR_QUERY_ID_PREFIX+o.topics[1],o.topic.container=o.topics[2]?parseInt(o.topics[2]):a):(o.topic.id=o.topics,o.topic.type=e.TOPIC_TYPE_SIMPLE,o.topic.container=a)),o.topic},this.getTopicDataFromLivesite=function(t){return o.topics=t,o.topic={},"undefined"!=typeof o.topics&&(o.topic.id=o.topics.topicid,o.topic.type=o.topics.type,o.topic.source=e.TOPIC_TYPE_LSCS,o.topics.topicdata&&(o.topic.terms=o.topics.topicdata.searchdata.terms)),o.topic},this.getDataSource=function(e){return{determiner:e.source,solr:!0,containerId:e.container,treatmentId:e.treatment,propositionId:e.proposition,propositionProductId:e.propositionProduct,interactionId:e.interaction}}},ba.bahome.topicDeterminer.Module.service("TopicModel",["MainConstants",ba.bahome.topicDeterminer.TopicModel]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.DefaultDeterminerProxy=function(e,t,a){this.$q=e,this.$http=t,this.log=a.log,this.url="/apps/ba-home/data/default-topics.json"},ba.bahome.topicDeterminer.DefaultDeterminerProxy.prototype.getData=function(){var e=this,t=e.$q.defer();return e.$http({method:"GET",url:e.url}).then(function(e){t.resolve(e.data)})["catch"](function(){e.log.generateLogByCode("BA_HOME_007"),t.reject()}),t.promise},ba.bahome.topicDeterminer.Module.service("DefaultDeterminerProxy",["$q","$http","CommonService",ba.bahome.topicDeterminer.DefaultDeterminerProxy]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.LSCSDeterminerProxy=function(e,t,a,n,o){this.$q=e,this.$http=t,this.log=a.log,this.requestTimeout=n,this.url="/"+o.getLocale()+"/home/lscs/v1/topic-segment-rule"},ba.bahome.topicDeterminer.LSCSDeterminerProxy.prototype.getData=function(e){var t=this,a=t.$q.defer(),n=3e3,o=(new Date).getTime();return t.$http({method:"POST",url:t.url,data:e,timeout:t.requestTimeout.getTimeout(n)}).then(function(e){a.resolve(e.data)})["catch"](function(){var e=(new Date).getTime()-o;t.log.generateLogByCode("BA_HOME_004"),e>=n&&t.log.generateLogByCode("BA_HOME_028"),a.reject()}),a.promise},ba.bahome.topicDeterminer.Module.service("LSCSDeterminerProxy",["$q","$http","CommonService","RequestTimeout","ClientLocaleService",ba.bahome.topicDeterminer.LSCSDeterminerProxy]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.URLDeterminerProxy=function(e){this.GetLocalDataService=e},ba.bahome.topicDeterminer.URLDeterminerProxy.prototype.getData=function(e){return e.topics&&""!==e.topics&&"true"!==e.topics&&(this.topics=e),this.topics},ba.bahome.topicDeterminer.Module.service("URLDeterminerProxy",["GetLocalDataService",ba.bahome.topicDeterminer.URLDeterminerProxy]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.DefaultDeterminerService=function(e,t,a,n){this.$q=e,this.defaultDeterminerProxy=t,this.defaultDeterminerTransformer=a,this.log=n.log},ba.bahome.topicDeterminer.DefaultDeterminerService.prototype.determine=function(){var e=this,t=e.$q.defer();return this.defaultDeterminerProxy.getData().then(function(a){t.resolve(e.defaultDeterminerTransformer.getDefaultData(a))})["catch"](function(){e.log.generateLogByCode("BA_HOME_006"),t.reject()}),t.promise},ba.bahome.topicDeterminer.Module.service("DefaultDeterminerService",["$q","DefaultDeterminerProxy","DefaultDeterminerTransformer","CommonService",ba.bahome.topicDeterminer.DefaultDeterminerService]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.LSCSDeterminerService=function(e,t,a,n){this.$q=e,this.lscsDeterminerProxy=t,this.lscsDeterminerTransformer=a,this.log=n.log},ba.bahome.topicDeterminer.LSCSDeterminerService.prototype.determine=function(e){var t,a,n=this,o=n.$q.defer(),i=e.rule,r=e.userDetails;try{a="<request><rules-to-execute><Rule>"+i+"</Rule></rules-to-execute><input><Customer><Membership><Avios>"+r.avios+"</Avios><Tier>"+r.tier+"</Tier><Type>"+r.type+"</Type></Membership><NextTrip><HasNextTrip>"+r.nextTrip+"</HasNextTrip><Cabin>"+r.cabin+"</Cabin><ProductType>"+r.productType+"</ProductType><Destination>"+r.destination+"</Destination><PAX>"+r.pax+"</PAX><Origin>"+r.origin+"</Origin><Start>"+r.start+"</Start></NextTrip><State>"+r.state+"</State><Locale><Country>"+r.country+"</Country><Language>"+r.lang+"</Language></Locale><Searches><HasRecentSearches>"+r.hasRecentSearches+"</HasRecentSearches></Searches></Customer></input></request>"}catch(s){n.log.generateLogByCode("BA_HOME_029",s.message)}return this.lscsDeterminerProxy.getData(a).then(function(e){t=n.lscsDeterminerTransformer.getTopicsFromLivesite(e),t?o.resolve(t):(n.log.generateLogByCode("BA_HOME_005"),o.reject())})["catch"](function(){n.log.generateLogByCode("BA_HOME_003"),o.reject()}),o.promise},ba.bahome.topicDeterminer.Module.service("LSCSDeterminerService",["$q","LSCSDeterminerProxy","LSCSDeterminerTransformer","CommonService",ba.bahome.topicDeterminer.LSCSDeterminerService]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.URLDeterminerService=function(e,t,a,n){this.$q=e,this.urlDeterminerProxy=t,this.urlDeterminerTransformer=a,this.GetLocalDataService=n},ba.bahome.topicDeterminer.URLDeterminerService.prototype.determine=function(e){var t=this,a=this.$q.defer(),n=e.stateParams,o=this.urlDeterminerProxy.getData(n);return o?a.resolve(t.urlDeterminerTransformer.getTopicsFromUrl(o)):a.reject(),a.promise},ba.bahome.topicDeterminer.Module.service("URLDeterminerService",["$q","URLDeterminerProxy","URLDeterminerTransformer","GetLocalDataService",ba.bahome.topicDeterminer.URLDeterminerService]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.DefaultDeterminerTransformer=function(){var e,t=[];this.getDefaultData=function(a){return a&&a.topics&&a.topics.topic&&(t=a.topics.topic,e=[],angular.forEach(t,function(e){e.id&&this.push(e)},e)),e}},ba.bahome.topicDeterminer.Module.service("DefaultDeterminerTransformer",[ba.bahome.topicDeterminer.DefaultDeterminerTransformer]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.LSCSDeterminerTransformer=function(e,t,a){var n,o,i,r=[];this.log=e.log,this.topicModel=t,this.xml2json=a,n=this,this.getTopicsFromLivesite=function(e){try{if(o=n.xml2json.parser(e),r=o.response.output.action.topics.topic,void 0!==r)return"undefined"!=typeof r.length?(i=[],angular.forEach(r,function(e){this.push(n.topicModel.getTopicDataFromLivesite(e))},i)):i=n.topicModel.getTopicDataFromLivesite(r),i}catch(t){return n.log.generateLogByCode("BA_HOME_008"),i}}},ba.bahome.topicDeterminer.Module.service("LSCSDeterminerTransformer",["CommonService","TopicModel","ngXml2json",ba.bahome.topicDeterminer.LSCSDeterminerTransformer]),ba.lang.namespace("ba.bahome.topicDeterminer"),ba.bahome.topicDeterminer.URLDeterminerTransformer=function(e){var t,a,n=this;this.topicModel=e,this.getTopicsFromUrl=function(e){var o=3;return t=[],a=[],-1===e.topics.indexOf(",")?t.push(e.topics):t=e.topics.split(","),angular.forEach(t,function(e,t){-1!==e.indexOf("hero")?(this.push(n.topicModel.getTopicDataFromUrl(e,1)),o=2):this.push(n.topicModel.getTopicDataFromUrl(e,t+o))},a),a}},ba.bahome.topicDeterminer.Module.service("URLDeterminerTransformer",["TopicModel",ba.bahome.topicDeterminer.URLDeterminerTransformer]),ba.lang.namespace("ba.bahome.tracking"),ba.bahome.tracking.Module.constant("BanConstants",{typeCodes:{hero:"HER",campaign:"CAM",imageIndex:"IMG",pricing:"CAM",disruptionPrio1:"P1M",disruptionPrio2:"P2M",disruptionPrioAcc:"PAM",account:"ACT",redemption:"RED",nextTrip:"NXT",recent:"REC"},priorityTypes:{disruptionPrio1:"priority1",disruptionPrio2:"priority2",disruptionPrioAcc:"account"},contentPositionStart:"0",clickPosCodes:{callToAction:"CTA",image:"IMG",link:"LNK",price:"PRI"},KMdetails:{ver:"1.0",clickTag:"c",impTag:"i"},banTrackingCampaignId:"HOME",banEngagementLevel:"L4",banCustomerState:{anonymous:"anonymous-inspiration",authenticated:"authenticated"},defaultTrackingObj:{dr:"",dt:document.title,tier:{"default":"",blue:"Blue",bronze:"Bronze",silver:"Silver",gold:"Gold",premier:"Premier"},scheme:"",logintype:{"default":"public",EXECUTIVE_CLUB:"execclub",PREMIER:"execclub",BARC:"barc"},audience:"travel",CUSTSEG:"",GGLMember:""},sourceRatings:{"default":0,hardcoded:4,lscs:1,notLscs:2},maxProducts:4,livesiteDeterminer:"lscs"}),ba.lang.namespace("ba.bahome.tracking"),ba.bahome.tracking.HomeTrackingDataModelBuilder=function(e){var t=this;this.homeTrackingDataModel=e,this.getTrackingDetails=function(){return this.homeTrackingDataModel},this.setTrackingDetails=function(e,t,a,n,o,i,r,s){this.homeTrackingDataModel.trackingData.page_name=e,this.homeTrackingDataModel.trackingData.site_country_code=t,this.homeTrackingDataModel.trackingData.site_language=a,this.homeTrackingDataModel.trackingData.booking_country=n,this.homeTrackingDataModel.trackingData.adobe_cookie=o,this.homeTrackingDataModel.trackingData.platform=i,this.homeTrackingDataModel.trackingData.pagename=e,this.homeTrackingDataModel.trackingData.brand=r,this.homeTrackingDataModel.trackingData.userlocaltime_utc=s},this.setTrackingAttribute=function(e,a){t.homeTrackingDataModel.trackingData[e]=a},this.setBannerTrackingAttribute=function(e){t.homeTrackingDataModel.trackingData.banner.push(e)},this.setCarouselTrackingAttribute=function(e){t.homeTrackingDataModel.trackingData.carousel.push(e)},this.setBanParameterTrackingAttribute=function(e){t.homeTrackingDataModel.trackingData.ban.push(e)},this.setBanParameterTrackingAttributeEmpty=function(){t.homeTrackingDataModel.trackingData.ban=[]},this.setSourceTrackingAttribute=function(e){t.homeTrackingDataModel.trackingData.source=e?e:!1}},ba.bahome.tracking.Module.service("HomeTrackingDataModelBuilder",["HomeTrackingDataModel",ba.bahome.tracking.HomeTrackingDataModelBuilder]),ba.lang.namespace("ba.bahome.tracking"),ba.bahome.tracking.HomeTrackingDataModel=function(){"use strict";return{trackingData:{page_name:"",site_country_code:"",site_language:"",booking_country:"",adobe_cookie:"",platform:"",pagename:"",brand:"",userlocaltime_utc:"",kmtag:"",logintype:"",tier:"",kmver:"",domain:"",banner:[],carousel:[],ban:[]}}},ba.bahome.tracking.Module.factory("HomeTrackingDataModel",[ba.bahome.tracking.HomeTrackingDataModel]),ba.lang.namespace("ba.bahome.tracking"),ba.bahome.tracking.BanTrackingHelper=function(e,t,a,n,o,i,r,s){function c(){return this.userModel}function l(e){this.userModel=e}var m={},u=t,d=u.defaultTrackingObj;return m.generateBanParamObj=function(e,t,o){var i,r,s,c,d="",g="",h="";if(l(a),t===u.typeCodes.campaign&&e.products)if(!e.products[1]&&e.products[0])e.price=e.products[0].dailyPrice||e.products[0].pricePerPersonPerNight||e.products[0].pricePp||e.products[0].price,e.currency=e.products[0].currencyCode,e.destinationCode=e.products[0].destinationCode;else for(r=1;r<u.maxProducts;r++)e.products[r]&&(e.products[r].destinationCode===e.products[r-1].destinationCode?e.destinationCode=e.products[r].destinationCode:e.destinationCode=null);return o&&(s=parseInt(o)+n.CONTENT_POS_ADD),e.source&&(e.sourceRating=m.determineContentSource(e.source),d=e.source.propositionId||"",g=e.source.interactionId||"",h=e.source.propositionProductId||""),c=e.contentId||"",i={treatmentId:c,pageId:"",componentType:t,componentPosition:s,clickPosition:"",contentSource:e.sourceRating,currency:e.currency,price:e.price,spare:"",campaignId:u.banTrackingCampaignId,pageVer:"",referrer:"",spare2:"",engagementLevel:u.banEngagementLevel,destination:e.destinationCode,route:e.route,spare3:h,customerState:u.banCustomerState[a.state],spare4:g,spare5:d,spare6:""}},m.generateParamString=function(e){var t=Object.keys(e).map(function(t){return e[t]});return t.join("|")},m.determineContentSource=function(e){var t;return t=e.solr!==!0?u.sourceRatings.hardcoded:e.determiner===u.livesiteDeterminer?u.sourceRatings.lscs:u.sourceRatings.notLscs},m.triggerImpression=function(e){var t=angular.fromJson(angular.toJson(d)),a=c(),n={};t.KMtag=u.KMdetails.impTag,t.KMver=u.KMdetails.ver,t.logintype=d.logintype[a.personalAttributes.customerType]||d.logintype["default"],t.tier=d.tier[a.loyalty.tier]||d.tier["default"],t.ban=e,o.setTracking("Session",t),n.kmtag=u.KMdetails.impTag,n.logintype=d.logintype[a.personalAttributes.customerType]||d.logintype["default"],n.tier=d.tier[a.loyalty.tier]||d.tier["default"],n.kmver=u.KMdetails.ver,angular.forEach(n,function(e,t){i.setTrackingAttribute(t,e)}),i.setBanParameterTrackingAttribute(e),i.setBannerTrackingAttribute(e.split("|")[17]),angular.forEach(i.getTrackingDetails().trackingData,function(e,t){r.setAttribute(t,e)}),s.$emit("impressionTracking")},m.click=function(e){var t=angular.fromJson(angular.toJson(d)),a=c();return t.ban=e,t.KMtag=u.KMdetails.clickTag,t.KMver=u.KMdetails.ver,t.logintype=a?d.logintype[a.personalAttributes.customerType]:d.logintype["default"],t.tier=a?d.tier[a.loyalty.tier]:d.tier["default"],t.clickpage=u.banTrackingCampaignId,t},m},ba.bahome.tracking.Module.factory("BanTrackingHelper",["analytics","BanConstants","UserDataModel","MainConstants","TrackingService","HomeTrackingDataModelBuilder","AnalyticsTrackingService","$rootScope",ba.bahome.tracking.BanTrackingHelper]),ba.lang.namespace("ba.bahome.tracking"),ba.bahome.tracking.TrackingService=function(e,t){this.$timeout=e,this.analytics=t,this.postponedTracking=[],this.initTracking={},this.trackingFired=!1},ba.bahome.tracking.TrackingService.prototype.resetTracking=function(){var e=this;e.trackingFired=!1,e.initTracking={},e.postponedTracking=[]},ba.bahome.tracking.TrackingService.prototype.setTracking=function(e,t){var a=this;a.trackingFired?a.analytics.trackEvent(e,t):a.postponedTracking.push({type:e,obj:t})},ba.bahome.tracking.TrackingService.prototype.addInitTracking=function(e){var t=this;t.trackingFired?t.analytics.trackEvent("Session",e):t.initTracking=angular.merge(t.initTracking,e)},ba.bahome.tracking.TrackingService.prototype.fireTracking=function(){var e=this;e.trackingFired||(e.analytics.trackEvent("Session",e.initTracking),e.$timeout(function(){angular.forEach(e.postponedTracking,function(t){e.analytics.trackEvent(t.type,t.obj)}),e.trackingFired=!0},500))},ba.bahome.tracking.Module.service("TrackingService",["$timeout","analytics",ba.bahome.tracking.TrackingService]),ba.lang.namespace("ba.bahome.travelToolbar"),ba.bahome.travelToolbar.TravelToolbarController=function(e,t,a,n,o,i){var r,s=this;for(s.future=[],s.mmbUrl=t.formBATeamsiteURL("managebooking")+"?source=PHP-Find-Booking",s.olciUrl=t.formBATeamsiteURL("managebooking")+"?source=PHP-Start-OLCI",s.today=new Date,s.flightDate=o("date")(s.today,"yyyy-MM-dd"),s.flightNum="",s.flightArrDep="true",r=0;10>r;r++)s.future[r]=new Date,s.future[r].setDate(s.future[r].getDate()+(r+1));s.yesterday=new Date,s.yesterday.setDate(s.yesterday.getDate()-1),"true"===n.get("RTAD_FALLBACK","true")?s.rtadUrl="/rtad/travel/public/"+a.getLanguage()+"_"+a.getCountry():s.rtadUrl="/travel/flightstatus/public/"+a.getLanguage()+"_"+a.getCountry()+"/search/",s.submitRtad=function(){var e=t.formBATeamsiteURL("flightstatus")+"/results/loaded?searchMethod=flight&date="+s.flightDate+"&isDepartures="+s.flightArrDep+"&flightNumber="+s.flightNum;i.location.href=e}},ba.bahome.travelToolbar.Module.controller("TravelToolbarController",["$scope","URLFormulationService","ClientLocaleService","Environment","$filter","$window",ba.bahome.travelToolbar.TravelToolbarController]),ba.lang.namespace("ba.bahome.travelToolbar"),ba.bahome.travelToolbar.travelToolbar=function(e,t,a,n,o,i){"use strict";return{restrict:"A",controller:"TravelToolbarController",controllerAs:"travelToolbarCtrl",scope:{},link:function(n){n.trackingDataFS={source:t.FS_BUTTON},n.toolClicked=function(e,o,r){var s={};9!==e.keyCode&&(o===t.MMB_VALUE?(n.showCheckin=!1,n.showRtad=!1,n.showMmb=!n.showMmb):o===t.OLCI_VALUE?(n.showMmb=!1,
n.showRtad=!1,n.showCheckin=!n.showCheckin):o===t.RTAD_VALUE&&(n.showMmb=!1,n.showCheckin=!1,n.showRtad=!n.showRtad),n.showMmb?(s.interaction=t.MMB_BUTTON,i.trackEvent("Session",s)):n.showCheckin?(s.interaction=t.OLCI_BUTTON,i.trackEvent("Session",s)):n.showRtad&&(s.interaction=t.RTAD_BUTTON,i.trackEvent("Session",s)),n.toggleToolbar=!n.toggleToolbar,r&&a(function(){o?angular.element(document.querySelector("."+o.toLowerCase()+"-tool-button"))[0].focus():angular.element(document.querySelector(".mmb-tool-button"))[0].focus()},1e3))},e.get("travelToolBarLastname").then(function(e){n.travelToolBarLastname=e}),e.get("travelToolBarBookingRef").then(function(e){n.travelToolBarBookingRef=e}),e.get("travelToolBarFlightNum").then(function(e){n.travelToolBarFlightNum=e}),e.get("travelToolBarToday").then(function(e){n.todayText=e}),e.get("travelToolBarFlightNumText").then(function(e){n.travelToolBarFlightNumText=e}),e.get("travelToolBarDeparting").then(function(e){n.travelToolBarDeparting=e}),e.get("travelToolBarArriving").then(function(e){n.travelToolBarArriving=e}),e.get("travelToolBarFindBooking").then(function(e){n.travelToolBarFindBooking=e}),e.get("travelToolBarOnlineCheckin").then(function(e){n.travelToolBarOnlineCheckin=e}),e.get("travelToolBarRtad").then(function(e){n.travelToolBarRtad=e})},templateUrl:"ba-home/templates/travel-toolbar-template.html"}},ba.bahome.travelToolbar.Module.directive("travelToolbar",["ResourceBundle","TravelToolbarConstants","$timeout","$document","BreakpointDetectionService","analytics",ba.bahome.travelToolbar.travelToolbar]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.UserDetermination=function(e,t,a){var n,o,i=this,r={},s=[];return this.$injector=e,this.availableDeterminers=a.get("BA_USER_DETERMINERS",["AnonymousDeterminerService"]),angular.forEach(i.availableDeterminers,function(e){n=i.$injector.get(e),s.push(n)}),o=function(e,t,a,n){var i,r,c;n=n||0,i=n+1,r=i===s.length,c=s[n],c[a](t).then(function(t){e.resolve(t)})["catch"](function(){r?e.reject():o(e,t,a,i)})},r.determine=function(e){var a=t.defer();return o(a,e,"determine"),a.promise},r.determineAdditional=function(e){var a=t.defer();return o(a,e,"determineAdditionalData"),a.promise},r},ba.bahome.userDeterminer.Module.factory("UserDetermination",["$injector","$q","Environment",ba.bahome.userDeterminer.UserDetermination]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.UserDataModel=function(e,t,a){this.loyalty={},this.loyaltyRecentTransaction={},this.personalAttributes={},this.interactions=[],this.nextTrip={},this.secondaryCalls=[],this.userConstants=e,this.$q=t,this.moment=a},ba.bahome.userDeterminer.UserDataModel.prototype.setLoyaltyModel=function(e){var t,a,n,o,i,r,s,c,l=this,m=[],u=[],d=0;if(this.userData=e,this.userData&&this.userData.registeredCustomer){if(t=this.userData.registeredCustomer,a=t.loyaltyAccountDetails,l.loyalty.loyaltyAccountNumber=a.loyaltyAccountNumber||"",l.loyalty.goldGuestList=a.goldGuestList||!1,l.loyalty.coBrandedCardCode=a.coBrandedCardCode||"",l.loyalty.status=a.status||"",l.loyalty.creationDate=a.creationDate||"",l.loyalty.membershipStartDate=a.membershipStartDate||"",l.loyalty.type=a.type||"",a.tierLevel&&(l.loyalty.tier=a.tierLevel.replace(l.userConstants.TIER_LEVEL_PREFIX,"").toLowerCase()),l.loyalty.tierLevel=a.tierLevel||"",l.loyalty.tierLevelEndDate=a.tierLevelEndDate||"",l.loyalty.tierLevelStartDate=a.tierLevelStartDate||"",l.loyalty.pointsBalance=0,l.loyalty.lifeTimeTierPoints=0,l.loyalty.individualAccountBalance=0,l.loyalty.ggl=t.goldGuestList,a.pointsBalance&&a.pointsBalance.balance&&(l.loyalty.pointsBalance=a.pointsBalance.balance.toLocaleString("en").split(".")[0]),a.lifeTimeTierPoints&&a.lifeTimeTierPoints.balance&&(l.loyalty.lifeTimeTierPoints=a.lifeTimeTierPoints.balance.toLocaleString("en").split(".")[0]),a.individualAccountBalance&&a.individualAccountBalance.balance&&(l.loyalty.individualAccountBalance=a.individualAccountBalance.balance.toLocaleString("en").split(".")[0]),a.householdAccountBalance&&a.householdAccountBalance.balance&&(l.loyalty.householdBalance=a.householdAccountBalance.balance.toLocaleString("en").split(".")[0]),a.houseHoldMembers){if(n=a.houseHoldMembers.houseHoldMember.length,n>0)for(;n>d;d++)o={},i=a.houseHoldMembers.houseHoldMember[d],o.dateOfBirth=i.dateOfBirth||"",o.gender=i.gender||"",o.membershipNumber=i.membershipNumber||"",o.tierLevel=i.tierLevel||"",i.name&&(o.title=i.name.title||"",o.firstName=i.name.firstName||"",o.lastName=i.name.lastName||""),i.enrollmentProgramme&&(o.enrollmentProgramme=i.enrollmentProgramme.name||""),m.push(o);l.loyalty.houseHoldMembers=m}if(a.loyaltyAccountTransactions){if(r=a.loyaltyAccountTransactions.length,r>0)for(d=0;r>d;d++)s={},c=a.loyaltyAccountTransactions[d],s.date=c.date||"",s.description=c.description||"",s.postedDate=c.postedDate||"",s.tierPoints=c.tierPoints||"",0!==c.aviosBurned&&(s.avios="-"+c.aviosBurned,u.push(s)),0!==c.aviosEarned&&(s.avios=c.aviosEarned||"",u.push(s)),0===c.aviosEarned&&0===c.aviosBurned&&(s.avios=c.aviosEarned,u.push(s));l.loyalty.recentTransactions=u}}},ba.bahome.userDeterminer.UserDataModel.prototype.getLoyaltyModel=function(){var e=this;return e.loyalty},ba.bahome.userDeterminer.UserDataModel.prototype.setPersonalAttributesModel=function(e){var t,a=this;this.userData=e,"undefined"!==this.userData&&"object"==typeof this.userData&&(a.personalAttributes.customerType=this.userData.customerType||"",a.personalAttributes.dateOfBirth=this.userData.dateOfBirth||"",a.personalAttributes.gender=this.userData.gender||"",this.userData.name&&(a.personalAttributes.firstName=this.userData.name.firstName||"",a.personalAttributes.lastName=this.userData.name.lastName||"",a.personalAttributes.title=this.userData.name.title||""),this.userData.address&&(a.personalAttributes.city=this.userData.address.City||"",a.personalAttributes.country=this.userData.address.Country||""),this.userData.registeredCustomer&&(a.personalAttributes.profilePercentage=this.userData.registeredCustomer.profilePercentage||0),this.userData.registeredCustomer&&this.userData.registeredCustomer.loyaltyAccountDetails&&(t=this.userData.registeredCustomer.loyaltyAccountDetails,a.personalAttributes.sensitiveCustomer=t.sensitiveCustomer||!1,t.sensitiveCustomerDetails&&(a.personalAttributes.sensitiveCustomerLevel=t.sensitiveCustomerDetails.level||"",a.personalAttributes.sensitiveCustomerReason=t.sensitiveCustomerDetails.reason||"")))},ba.bahome.userDeterminer.UserDataModel.prototype.getPersonalAttributesModel=function(){var e=this;return e.personalAttributes},ba.bahome.userDeterminer.UserDataModel.prototype.setInteractionsModel=function(e){var t,a,n,o,i=this,r=0,s=new Date;if(this.userData=e,"undefined"!==this.userData&&"object"==typeof this.userData&&(t=this.userData.registeredCustomer,a=t.customerInteraction,n=a.length,n>0))for(;n>r;r++)new Date(a[r].departureDate)>s&&(o={},o.customerModifiedDate=a[r].customerModifiedDate||"",o.modifiedUnixTime=parseInt((new Date(o.customerModifiedDate).getTime()/1e3).toFixed(0)),o.departureDate=a[r].departureDate,o.returnDate=a[r].returnDate,o.fixedTravelDate=a[r].fixedTravelDate||!1,o.redemptionSearch=a[r].redemptionSearch||!1,o.shorListIndicator=a[r].shorListIndicator||!1,o.savedSearchChannel=a[r].savedSearchChannel||"",o.priceQuoted=a[r].priceQuoted||"",o.priceQuotedDate=a[r].priceQuotedDate||"",o.priceQuotedObj=a[r].totalAmount||"",o.savedSearchCriteria=a[r].savedSearchCriteria||"",o.ticketFlexibility=a[r].ticketFlexibility||"",o.destinationName=a[r].destinationCityName||a[r].destination||"",o.destination=a[r].destinationCityCode||a[r].destinationCode||"",o.destinationAirportName=a[r].destinationAirportName||"",o.destinationAirport=a[r].destinationAirportCode||"",o.originName=a[r].originCityName||"",o.origin=a[r].originCityCode||"",o.originAirportName=a[r].originAirportName||"",o.originAirport=a[r].originAirportCode||"",o.cabin=a[r].cabin||"",o.source="service",o.departureDate=i.moment(o.departureDate).format("D MMMM YYYY"),o.departureDateURL=i.moment(o.departureDate).format("YYYY-MM-DD"),o.returnDate&&(o.returnDate=i.moment(o.returnDate).format("D MMMM YYYY"),o.returnDateURL=i.moment(o.returnDate).format("YYYY-MM-DD")),a[r].passengerTypeBreakdown&&(o.passengers=a[r].passengerTypeBreakdown),o.passengers&&!o.passengers[3]&&(o.passengers[3]={count:0,passengerType:"YOUNGADULT"}),i.interactions.push(o))},ba.bahome.userDeterminer.UserDataModel.prototype.getInteractionsModel=function(){var e=this;return e.interactions},ba.bahome.userDeterminer.UserDataModel.prototype.setNextTripModel=function(e){var t,a,n,o,i,r,s,c=this,l=new Date;if(c.futureFlights=[],e&&e.segment&&e.segment.length)for(s=0;s<e.segment.length;s++)e.segment[s]&&(r={},o=e.segment[s],r.bookingReference=o.bookingReference.bookingReference||"",r.daysRemaining="",o.checkInDetails&&o.checkInDetails.checkInData&&(r.checkInAvailability=o.checkInDetails.checkInData.checkInAvailability,r.checkInStatus=o.checkInDetails.checkInData.checkInStatus,r.checkInDateTime=o.checkInDetails.checkInData.checkInDateTime),o.flightDetail&&(t=o.flightDetail,r.flightDetails={cabinClass:t.cabinClass||"",cabinName:t.cabinName||"",destinationAirport:t.destinationAirport||"",destinationAirportCode:t.destinationAirportCode||"",destinationCity:t.destinationCity||"",destinationCityCode:t.destinationCityCode||"",destinationTerminal:t.destinationTerminal||"",haulType:t.haulType||"",marketingCarrierCode:t.marketingCarrierCode||"",marketingFlightNumber:t.marketingFlightNumber||"",operatingCarrierCode:t.operatingCarrierCode||"",originAirport:t.originAirport||"",originAirportCode:t.originAirportCode||"",originCity:t.originCity||"",originCityCode:t.originCityCode||"",originTerminal:t.originTerminal||"",scheduledArrivalDateTime:t.scheduledArrivalDateTime||"",scheduledDepartureDateTime:t.scheduledDepartureDateTime||"",sellingClass:t.sellingClass||""},r.flightDetails.scheduledDepartureDateTime&&(i=new Date(r.flightDetails.scheduledDepartureDateTime),r.daysRemaining=Math.round((i-l)/864e5))),o.leadPassengerDetails&&(a=o.leadPassengerDetails,r.passengerDetails={apisStatus:a.apisStatus||"",baggageAllowance:a.baggageAllowance||"",extraSeatIndicator:a.extraSeatIndicator||"",firstName:a.firstName||"",lastName:a.lastName||"",leadPassengerType:a.leadPassengerType||"",prepaidMealIndicator:a.prepaidMealIndicator||"",seatNumber:a.seatNumber||""}),o.disruptionDetails&&o.disruptionDetails.disruptionData&&(n=o.disruptionDetails.disruptionData,r.disruptionDetails={disruptionIndicator:n.disruptionIndicator||!1,flightRescheduledStatus:n.flightRescheduledStatus||!1,involuntaryCancellationStatus:n.involuntaryCancellationStatus||!1,publicDepartureStatus:n.publicDepartureStatus||"ON_TIME",estimatedDepartureDateTime:n.estimatedDepartureDateTIme||"",estimatedArrivalDateTime:n.estimatedArrivalDateTIme||""}),0===s&&(c.nextTrip=r,c.nextTrip.totalFlights=e.segment.length),n&&n.disruptionIndicator===!1&&n.involuntaryCancellationStatus===!1&&c.futureFlights.push(r))},ba.bahome.userDeterminer.UserDataModel.prototype.getNextTripModel=function(){var e=this;return e.nextTrip},ba.bahome.userDeterminer.UserDataModel.prototype.getFutureFlightsModel=function(){var e=this;return e.futureFlights},ba.bahome.userDeterminer.UserDataModel.prototype.setSecondaryCalls=function(e){var t=this;this.userData=e,"undefined"!==this.userData&&"object"==typeof this.userData&&(t.secondaryCalls=this.userData)},ba.bahome.userDeterminer.UserDataModel.prototype.getSecondaryCall=function(e){var t=this,a=this.$q.defer(),n=!1;return angular.forEach(t.secondaryCalls,function(t){t.rel===e&&(n=!0,a.resolve(t))}),n||a.reject(),a.promise},ba.bahome.userDeterminer.UserDataModel.prototype.reset=function(){this.loyalty={},this.personalAttributes={},this.interactions=[],this.nextTrip={},this.secondaryCalls=[]},ba.bahome.userDeterminer.Module.service("UserDataModel",["UserConstants","$q","Moment",ba.bahome.userDeterminer.UserDataModel]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.IdcProxy=function(e,t,a,n,o){this.$q=e,this.$http=t,this.trackingId=a.getvFirstTracking(),this.env=n,this.requestTimeout=o},ba.bahome.userDeterminer.IdcProxy.prototype.getIdcDetails=function(){var e=this,t=this.$q.defer(),a=this.env.get("BA_REST_URL_PREFIX");return this.$http({method:"GET",url:a+"/badotcomadapter-bdca/rs/v1/customerstatesummaries;businessContext=HomePage;trackingId="+this.trackingId,timeout:e.requestTimeout.getTimeout(3e3)}).then(function(e){t.resolve(e.data)})["catch"](function(){t.reject()}),t.promise},ba.bahome.userDeterminer.IdcProxy.prototype.getUserDetails=function(e){var t,a=this,n=[],o=this.$q.defer();return angular.forEach(e,function(e){"nextTrip"===e.rel&&(t=1e4),n.push(a.$http({method:"GET",url:e.href,timeout:a.requestTimeout.getTimeout(t)}).then(function(t){return t.data.rel=e.rel,t.data}))}),this.$q.allSettled(n).then(function(e){e[0]&&"rejected"===e[0].state&&o.reject(),o.resolve(e)}),o.promise},ba.bahome.userDeterminer.IdcProxy.prototype.corporateAccountValidations=function(e){var t=this.$q.defer(),a=this.env.get("BA_REST_URL_PREFIX");return this.$http({method:"GET",url:a+"/badotcomadapter-bdca/rs/v1/customers/corporateaccountvalidations;concurRegionalURI="+e.concurRegionalURI+";loyaltyAccountNumber="+e.loyaltyAccountNumber}).then(function(e){t.resolve(e)})["catch"](function(e){t.resolve(e)}),t.promise},ba.bahome.userDeterminer.Module.service("IdcProxy",["$q","$http","BACookieService","Environment","RequestTimeout",ba.bahome.userDeterminer.IdcProxy]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.UrlProxy=function(e,t){this.$q=e,this.GetLocalDataService=t},ba.bahome.userDeterminer.UrlProxy.prototype.getUrlDetails=function(e){var t=this.$q.defer();return t.resolve(this.GetLocalDataService.getLocalDataByName(e)),t.promise},ba.bahome.userDeterminer.Module.service("UrlProxy",["$q","GetLocalDataService",ba.bahome.userDeterminer.UrlProxy]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.AnonymousDeterminerService=function(e,t){this.determine=function(){var a=e.defer(),n={};return n.determinerMethod="anonymous",n.identifiedCustomer=!1,n.activeFutureBookings=!1,n.state="anonymous",a.resolve(n),t.log.generateLogByCode("BA_HOME_016"),a.promise},this.determineAdditionalData=function(){var t=e.defer();return t.reject(),t.promise}},ba.bahome.userDeterminer.Module.service("AnonymousDeterminerService",["$q","CommonService",ba.bahome.userDeterminer.AnonymousDeterminerService]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.IdcDeterminerService=function(e,t,a,n,o,i,r,s,c,l,m,u){var d=this;this.idcProxy=a,this.idcResponseTransformer=n,this.log=t.log,this.baAuthenticationService=i,this.bACookieService=r,this.serverTimeService=s,this.env=c,this.userConstants=l,this.featureFlags=m,this.storedData=null,this.determine=function(){var t,a,n,o,i,r,s=e.defer(),c=d.baAuthenticationService.isLoggedOn(),l={};return i=function(e){l=d.idcResponseTransformer.transformDetailsForConcur(e),l.concurRegionalURI&&l.loyaltyAccountNumber&&d.featureFlags.isOn(d.userConstants.CORPORATEBOOKING)&&(d.serverTimeService.concurDataResolved=!1,d.serverTimeService.showConcurTab=!1,d.idcProxy.corporateAccountValidations(l).then(function(e){a=e.status,404===a&&(t="LOYALTY_NUMBER_DOES_NOT_EXIST"===e.data.errors[0].reason?!0:!1),200===a||400===a||404===a&&!t?(d.serverTimeService.showConcurTab=!0,d.bACookieService.setCookie(d.userConstants.CONCUR_USER,!0,d.userConstants.COOKIE_PATH,!0,3600,d.userConstants.SECONDS)):(d.serverTimeService.concurDataResolved=!0,d.bACookieService.setCookie(d.userConstants.CONCUR_USER,!1,d.userConstants.COOKIE_PATH,!0,3600,d.userConstants.SECONDS))}))},o=function(e){i(e),r=d.idcResponseTransformer.transformAdditionalDetails(r,e),d.log.generateLogByCode("BA_HOME_012"),s.resolve(r)},n=function(e){e&&!e.code?(r=d.idcResponseTransformer.transformIdcDetails(e,d.storedData),r.core.length?d.idcProxy.getUserDetails(r.core).then(function(e){r.storedData&&(e=e.concat(r)),o(e)})["catch"](function(){d.log.generateLogByCode("BA_HOME_018"),s.resolve(r)}):(d.log.generateLogByCode("BA_HOME_013"),i(r),s.resolve(r))):(d.log.generateLogByCode("BA_HOME_014"),s.reject())},c?u.getCustomerAttributes().then(function(e){d.storedData=e,e&&e.summary?n(e.summary):d.idcProxy.getIdcDetails().then(function(e){n(e)})["catch"](function(){d.log.generateLogByCode("BA_HOME_015"),s.reject()})})["catch"](function(){s.reject()}):s.reject(),s.promise},this.determineAdditionalData=function(t){var a=e.defer(),n=d.baAuthenticationService.isLoggedOn(),i=[];return n?o.getSecondaryCall(t).then(function(e){d.idcProxy.getUserDetails([e]).then(function(e){i=d.idcResponseTransformer.transformAdditionalDetails(i,e),d.log.generateLogByCode("BA_HOME_019"),a.resolve(i)})["catch"](function(){d.log.generateLogByCode("BA_HOME_017"),a.reject()})})["catch"](function(){a.reject()}):a.reject(),a.promise}},ba.bahome.userDeterminer.Module.service("IdcDeterminerService",["$q","CommonService","IdcProxy","IdcResponseTransformer","UserDataModel","BAAuthenticationService","BACookieService","ServerTimeService","Environment","UserConstants","featureFlags","CustomerService",ba.bahome.userDeterminer.IdcDeterminerService]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.UrlDeterminerService=function(e,t,a,n){var o=function(e){var t=e.membership;return t&&"true"!==t&&""!==t||(t=!1),t};this.determine=function(i){var r=this,s=e.defer(),c=o(i);return this.log=t.log,this.urlProxy=a,this.urlResponseTransformer=n,c?r.urlProxy.getUrlDetails(c).then(function(e){r.urlModel=r.urlResponseTransformer.transformUrlDetails(e),r.log.generateLogByCode("BA_HOME_010"),s.resolve(r.urlModel)})["catch"](function(){r.log.generateLogByCode("BA_HOME_011"),s.reject()}):s.reject(),s.promise},this.determineAdditionalData=function(){var t=e.defer();return this.urlModel?t.resolve(this.urlModel):t.reject(),t.promise}},ba.bahome.userDeterminer.Module.service("UrlDeterminerService",["$q","CommonService","UrlProxy","UrlResponseTransformer",ba.bahome.userDeterminer.UrlDeterminerService]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.IdcResponseTransformer=function(e,t){this.authService=e,this.userConstants=t},ba.bahome.userDeterminer.IdcResponseTransformer.prototype.transformIdcDetails=function(e,t){var a,n={},o=this,i={},r=this.authService.isLoggedOn;return this.idcModel=e,n.storedData=!1,a=function(e,t){var a=[];return e.forEach(function(e){e.rel!==t&&a.push(e)}),a},n.core=[],n.secondary=[],n.determinerMethod=this.userConstants.IDC,n.identifiedCustomer=this.idcModel.identifiedCustomer||!1,n.activeFutureBookings=this.idcModel.activeFutureBookings||!1,this.idcModel.links?(r()?n.state=this.userConstants.AUTHENTICATED:n.state=this.userConstants.PSEUDO,angular.forEach(this.idcModel.links,function(e){e.rel===o.userConstants.LOYALTY||e.rel===o.userConstants.PERSONAL_ATTRS?n.core.push(e):e.rel===o.userConstants.NEXT_TRIP?(e.href=e.href.replace("orders/requests","rs/v1/customers/orders"),n.secondary.push(e)):n.secondary.push(e)}),t&&t.loyaltyAccountDetails&&(i.loyaltyAccountDetails=t.loyaltyAccountDetails,i.goldGuestList=t.goldGuestList,i.ectcAcceptanceRequired=t.ectcAcceptanceRequired,n.loyalties={registeredCustomer:i},n.core=a(n.core,"loyalties"),n.storedData=!0),t&&t.registeredCustomer&&(n.personalAttributes={registeredCustomer:t.registeredCustomer,customerType:t.customerType,name:t.name},n.core=a(n.core,"personalAttributes"),n.storedData=!0),t&&t.concurRegionalURI&&(n.concur={concurRegionalURI:t.concurRegionalURI})):n.state=this.userConstants.TRACKED,n},ba.bahome.userDeterminer.IdcResponseTransformer.prototype.transformAdditionalDetails=function(e,t){var a={},n=this;return this.idcModel=e,this.response=t,a=this.idcModel,angular.forEach(this.response,function(e){e.state===n.userConstants.FULFILLED&&(e.value.rel===n.userConstants.LOYALTY||e.value.rel===n.userConstants.PERSONAL_ATTRS||e.value.rel===n.userConstants.INTERACTIONS||e.value.rel===n.userConstants.LOYALTY_RECENT?a[e.value.rel]=e.value.customer:e.value.rel===n.userConstants.NEXT_TRIP&&(a[e.value.rel]=e.value.nextTrips))}),a},ba.bahome.userDeterminer.IdcResponseTransformer.prototype.transformDetailsForConcur=function(e){var t={},a=this;return angular.forEach(e,function(e){e.state===a.userConstants.FULFILLED?e.value.rel===a.userConstants.LOYALTY&&e.value.customer&&e.value.customer.registeredCustomer&&e.value.customer.registeredCustomer.loyaltyAccountDetails?t.loyaltyAccountNumber=e.value.customer.registeredCustomer.loyaltyAccountDetails.loyaltyAccountNumber:e.value.rel===a.userConstants.PERSONAL_ATTRS&&e.value.customer.concurRegionalURI&&(t.concurRegionalURI=e.value.customer.concurRegionalURI.substring(8)):e.registeredCustomer&&e.registeredCustomer.loyaltyAccountDetails?t.loyaltyAccountNumber=e.registeredCustomer.loyaltyAccountDetails.loyaltyAccountNumber:e.concurRegionalURI&&(t.concurRegionalURI=e.concurRegionalURI.substring(8))}),t},ba.bahome.userDeterminer.Module.service("IdcResponseTransformer",["BAAuthenticationService","UserConstants",ba.bahome.userDeterminer.IdcResponseTransformer]),ba.lang.namespace("ba.bahome.userDeterminer"),ba.bahome.userDeterminer.UrlResponseTransformer=function(){},ba.bahome.userDeterminer.UrlResponseTransformer.prototype.transformUrlDetails=function(e){var t={};return this.urlModel=e,t.determinerMethod="url",t.identifiedCustomer=this.urlModel.identifiedCustomer||!1,t.activeFutureBookings=this.urlModel.activeFutureBookings||!1,t.state=this.urlModel.state||"",t.loyalties=this.urlModel.loyalty||"",t.personalAttributes=this.urlModel.personalAttributes||"",t.interactions=this.urlModel.interactions||"",t.nextTrip=this.urlModel.nextTrip||"",t},ba.bahome.userDeterminer.Module.service("UrlResponseTransformer",[ba.bahome.userDeterminer.UrlResponseTransformer]),ba.lang.namespace("ba.bahome"),ba.bahome.App=angular.module("ba-home",["ba-home-main","ba-home-routing","ba-i18n","ba-lang","ba-logging","ngSanitize","ngResource","ba-filters","ba-site-furniture","ba-site-furniture-templates","ba-analytics","ba-analytics-adobe","ba-cookies-popup","ba-q-decorator","ba-auth","tracking","logging","ba-third-party-ads","ba-third-party-ads-templates","ba-account-sidebar","ba-account-sidebar-templates","ba-login-ts-and-cs","search-bar","ba-searchbar","ba-trap-focus","ba-submit-html-form","tmh.dynamicLocale"]),angular.element(document).ready(function(){"use strict";angular.bootstrap(document.getElementById("content"),["ba-home"])}),ba.bahome.App.config(["Environment","BALogProvider","LogToServerInterceptorConfigurationProvider","ResourceBundleProvider","PageTitleProvider","$locationProvider","ContextCaptureProvider",function(e,t,a,n,o,i,r){"use strict";var s=e.get("BA_LOGGING_APPLICATION_ID","ba-home"),c=e.get("BA_LOGGING_PATH","/logcatcher"),l=e.get("BA_LOGGING_SLOW_REQUEST_HTTP_TIMEOUT",5e3),m=e.get("BA_LOGGING_LEVEL",2e3),u={userAgent:navigator.userAgent,windowWidth:window.innerWidth},d=window.location.pathname.toLowerCase();t.configure(s,c,m,1,200,u),a.setLongRequestWarningTimeout(l),n.setContextRoot(e.get("BAA_CONTEXT_ROOT","/apps/ba-home")),o.setDefaultTitle("British Airways | Book Flights, Holidays, City Breaks & Check In Online"),-1!==d.indexOf("travel/home")?i.html5Mode({enabled:!0,requireBase:!1}):i.html5Mode(!1),"prl"===e.get("BA_ENVIRONMENT_RELEASE_STAGE","")&&r.setContextCapture()}]).run(["analytics","BAAuthenticationService","BACookieService","featureFlags","$http","Environment","$window",function(e,t,a,n,o,i,r){var s={platform:"SFDSellingFlow"},c=a.getCookieValue("betaReferrer");n.set(o.get(i.get("BAA_CONTEXT_ROOT","/apps/ba-home")+"/data/toggles.json")),t.isLoggedOn()?s.PHPLoginStatus="Logged in":s.PHPLoginStatus="Not logged in",c&&(s.dr=c,r.dataLayer={},r.dataLayer.referrer=c,a.removeCookie("betaReferrer","/")),e.setCustomDimensions("Session",s)}]);