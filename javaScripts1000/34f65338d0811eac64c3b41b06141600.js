(self.webpackChunkustreamPlayer=self.webpackChunkustreamPlayer||[]).push([[430],{2324:function(e,t,n){"use strict";n.r(t),n.d(t,{initialize:function(){return ph}});var r=n(3884),a=n.n(r),i=n(8294),o=n.n(i),s=n(1164);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var u=function e(){for(var t={},n=0;n<arguments.length;n++)for(var r in arguments[n]){var a=arguments[n][r],i=t[r];i&&"object"==d(a)&&"object"==d(i)?t[r]=e(i,a):t[r]=a}return t},c={STREAM_UPDATE:"streamUpdate",THUMBNAIL_UPDATE:"thumbnailUpdate",BROADCASTER_UPDATE:"broadcasterUpdate",META_UPDATE:"metaUpdate",CONTENT_CUT_UPDATE:"contentCutUpdate",VIEWERS_UPDATE:"viewersUpdate",ALLVIEWERS_UPDATE:"allViewersUpdate",ALLTIMETOTAL_UPDATE:"allTimeTotalUpdate",SHARE_UPDATE:"shareUpdate",LOGO_UPDATE:"logoUpdate",CLIENT_RATE_LIMIT_UPDATE:"clientRateLimitUpdate",CHAT_UPDATE:"chatUpdate",ADVERT_UPDATE:"advertUpdate",STREAM_VERSION_UPDATE:"streamVersionUpdate",LIVE_CTA_UPDATE:"livectaUpdate",CAPTION_UPDATE:"captionUpdate",SLIDES_UPDATE:"slidesUpdate",UNSUPPORTED:"unsupported",LIVE:"live",OFFLINE_MODULE_RECEIVED:"offlineModuleReceived",PLAY:"play",PAUSE:"pause",LOAD:"load",VOLUME:"volume",PLAYING:"playing",SEEK:"seek",PROGRESS:"progress",DURATION:"duration",CREATE_SLIDESHOW:"createSlideShow",DESTROY_SLIDESHOW:"destroySlideShow",CREATE_OFFAIR_VIDEO:"createOffairVideo",DESTROY_OFFAIR_VIDEO:"destroyOffairVideo",NEXT_OFFAIR_VIDEO:"nextOffairVideo",VIDEO_FINISHED:"videoFinished",AUDIO_TRACKS:"audioTracks",URL_RESOLVE_COMPLETE:"urlResolveComplete",URL_RESOLVE_FAILURE:"urlResolveFailure",PLAY_OPTIONS:"playOptions",CHUNK_LENGTH:"chunkLength",ATLAS_METADATA:"atlasMetadata",ATLAS_STORED_UPDATE:"atlasStoredUpdate",ATLAS_BUFFERED_UPDATE:"atlasBufferedUpdate",ATLAS_POSITION_UPDATE:"atlasPositionUpdate",ATLAS_PROGRESS:"atlasProgress",ATLAS_ERROR:"atlasError",ATLAS_LOG:"atlasLog",ATLAS_CLEANUP:"atlasCleanup",ATLAS_THROTTLE:"atlasThrottle",ATLAS_DOWNLOAD_ERROR:"atlasDownloadError",ATLAS_QUALITY_CHANGE_STARTED:"atlasQualityChangeStarted",ATLAS_QUALITY_CHANGE_COMPLETED:"atlasQualityChangeCompleted",ATLAS_QUALITY_CHANGE_CANCELLED:"atlasQualityChangeCancelled",RECORDED_READY:"recordedReady",BANDWIDTH_UPDATED:"bandwidthUpdated",QUALITY_CHANGE:"qualityChange",CHANGE_PROVIDER:"changeProvider",PROVIDER_CHANGE:"providerChange",FLASH_CALL_ERROR:"flashCallError",SEND_REPORT:"sendReport",UMS_CONNECT_START:"umsConnectStart",UMS_CONNECTED:"umsConnected",UMS_REJECT:"umsReject",MODULE_INFO:"moduleInfo",REPORT_BANDWIDTH:"reportBandwidth",REPORT_BUFFER_EMPTY:"reportBufferEmpty",REPORT_BUFFER_FULL:"reportBufferFull",REPORT_DROPPED_FRAMES:"reportDroppedFrames",REPORT_ERROR:"reportError",REPORT_AD_RESPONDED:"reportAdResponded",REPORT_ECDN_TESTS:"reportEcdnTests",REPORT_AUDIO_CHANGED:"reportAudioChanged",CONTENT_AVAILABLE:"contentAvailable",AD_AVAILABLE:"adAvailable",SET_CAPTION_POSITION:"setCaptionPosition",DEBUG_FLOT_LOG:"flotLog"},l=[c.PROGRESS,c.VIEWERS_UPDATE,c.ALLVIEWERS_UPDATE,c.ALLTIMETOTAL_UPDATE,c.MODULE_INFO,c.DEBUG_FLOT_LOG,c.ATLAS_PROGRESS,c.ATLAS_POSITION_UPDATE,c.ATLAS_STORED_UPDATE,c.ATLAS_BUFFERED_UPDATE,c.ATLAS_LOG,c.SEND_REPORT],f=n(475),m=(0,s.w)("facade"),g={};function p(e,t){return e+"."+t}var v,h="command",E="event",y="data",b="report",T=c,S=function(e,t,n){var r=p(e,t);-1===l.indexOf(t)&&m.debug(e+" "+t,n),(0,f.Z)(g,r,n),(0,f.Z)(g,e+".*",t,n)},I=function(e,t,n){var r=p(e,t);g[r]||(g[r]=[]),g[r].push(n)},L="flv",A="flv/segmented",O="mp4",P="mp4/segmented",D="hls",R=n(5662),_=n(4121);function C(){if(!v)throw new Error("uiInstance not inited");return v}var w,N,U,M,k,F,V=n(2977),j=n(3707),x="channel",B="recorded",Z="video",H="image",G="highlight",Y=(0,s.w)("atlas/data/content"),K=location.pathname,W=R.Z.player?R.Z.player.contentType:R.Z.contentType,z=W===Z||W===G,Q=W===x,q=W===G,X=0,$=1,J=0,ee=!1,te="",ne=null,re=0;function ae(){return M===D}function ie(){return($-X)*J}function oe(e){if(ae())return e;var t=J*X;return Math.max(e-t,0)}!K.includes("/embed/")&&R.Z.player?(N=[R.Z.player.contentId],R.Z.player.contentType===G&&N.unshift(R.Z.player.videoId)):N=K.match(/(\d+)/g),U=+N[0],w=Q?x:B,I(E,T.LIVE,(function(e){e&&(te="",k=void 0),ee=e})),I(y,T.META_UPDATE,(function(e){F=u(F,e)})),I(E,T.CREATE_SLIDESHOW,(function(e){te=e.itemType===H?H:"slide",te=H,k=void 0})),I(E,T.CREATE_OFFAIR_VIDEO,(function(e){te=Z,k=e})),I(E,T.DESTROY_OFFAIR_VIDEO,(function(){te="",k=void 0})),I(E,T.ATLAS_PROGRESS,(function(e){var t=e.position;re=t}));var se={TYPE_CHANNEL:x,TYPE_RECORDE:B,TYPE_HIGHLIGHT:G,setStreamType:function(e){M=e},getStreamType:function(){return M},isHLS:ae,isFLV:function(){return M===A||M===L},isMP4:function(){return M===P||M===O},isSegmentedMP4:function(){return M===P},isContentPlayable:function(){return""===te||te===Z},live:function(){return ee},meta:function(){return F},cluster:function(){return F&&F.cluster?F.cluster:void 0},offairType:function(){return te},offairVid:function(){return k},getMediaType:function(){return z?Z:te?"offair"+te:ee?"live":"unknown"},id:function(){return U},app:function(){return w},ids:function(){return N},isCid:function(){return Q},getType:function(){return Q?x:q?G:B},setHighlight:function(e){X=e[0],$=e[1],S(E,T.CONTENT_CUT_UPDATE)},getHighlight:function(){return he.ignoretrim?null:void 0!==X||void 0!==$?{cutStart:X,cutEnd:$}:null},getCutStart:function(){return X},getCutEnd:function(){return $},setDurationInMillisec:function(e){J=e,S(E,T.DURATION)},getDurationInMillisec:function(){return J},getTrimmedDurationInMillisec:ie,getRelativeSeekPositionInMs:oe,getAbsoluteSeekPositionInMs:function(e){var t,n;ae()?(t=0,n=ie()):(t=J*X,n=J*$);var r=t+e;return Math.min(Math.max(t,r),n)},getSavedSeek:function(){return ne},hasSavedSeek:function(){return!!ne},saveSeek:function(e){var t,n=e.positionInMs,r=e.initiator,a=(null===(t=ne)||void 0===t?void 0:t.initiator)===_._.USER,i=r===_._.SYSTEM;a&&i||(ne={positionInMs:n,initiator:r})},resetSavedSeek:function(){ne=null},getOwnerChannelId:function(){return R.Z.cId},isVid:function(){return z},isHid:function(){return q},isOffairVid:function(){return te===Z},isOffairImg:function(){return te===H},getMid:function(){return[this.app()].concat(N).join(".")},isLiveContent:function(){return!this.isVid()&&""===te},getUrl:function(e,t){var n=(0,j.Z)(window,"location.protocol","https:"),r=(0,j.Z)(V.Z,"config.contentUrl","ustream.tv"),a=new URL("".concat(n,"//").concat(r));if(t?a.pathname+="".concat("embed","/"):Q&&(a.pathname+="".concat(x,"/")),z&&(a.pathname+="".concat(B,"/")),a.pathname+="".concat(N[0]),q&&(a.pathname+="/".concat(G,"/").concat(N[1])),e&&(a.pathname+="/pop-out",!this.isLiveContent())){var i=oe(re),o=Math.ceil(i/1e3);o>0&&(a.hash="to".concat(o))}return a.toString()},update:function(e,t){Y.debug("update ",{type:e,ids:t}),Array.isArray(t)||(t=[t]),N=t,te="",X=0,$=1,J=0,e===x?(Q=!0,U=t[0],w=x,z=!1,q=!1):e===Z||e===B?(z=!0,U=t[0],w=B,Q=!1,q=!1):e===G&&(z=!0,q=!0,U=t[0],w=B,Q=!1),C().setContentUpdate()}},de=n(6138),ue=n(699),ce="true",le=(0,s.w)("atlas/data/params"),fe={width:"100%",height:"100%",color:!1,autoplay:!1,controls:!0,wmode:"opaque",locale:R.Z.locale,sitemode:!1,bdtools:!1,playing:!1,live:!1,externalVtt:!1,ignoretrim:!1,showHiddenContextMenuItems:!1,loggedIn:R.Z.loggedIn,isIbmBranded:R.Z.ibmBranding,uumfOffairVods:R.Z.uumfOffAirContentVideoIds},me=location.search.match(/([a-z0-9\-_]+)(?:=([a-z0-9\-_\.\:\%]*))?/gi)||[];function ge(e,t){var n=se.id()+"";fe[n]||(fe[n]={}),fe[n][e]=t}function pe(e,t,n){return e.hasOwnProperty(t)?e[t]=e[t]===ce||1==+e[t]||""===e[t]||void 0===e[t]:e[t]=n,e}var ve,he=((ve=function(e){var t=location.hash.match(/to(\d+(?::\d+){0,2})/);if(t){var n=t[1].split(":").map((function(e){return parseInt(e,10)})),r=n.pop(),a=n.pop()||0;return 60*(n.pop()||0)*60+60*a+r}}())&&ge("startAt",ve),fe=pe(fe=function(e){try{var t=new URL(ue.Z);e.isOnIbm=/ibm\.com$/.test(t.hostname)}catch(t){e.isOnIbm=!1}return e}(fe=function(e){try{var t=new URL(ue.Z);e.isOnUstream=/ustream\.tv(?:\.lh)?$/.test(t.hostname)}catch(t){e.isOnUstream=!1}return e}(fe=function(e){return e.showHiddenContextMenuItems=e.showHiddenContextMenuItems===ce||"1"===e.showHiddenContextMenuItems||de.ZP.get("showHiddenContextMenuItems"),e}(fe=function(e){var t="/pop-out";return e.popout=location.pathname.slice(-1*t.length)===t,e}(fe=function(e){return e.experiment===ce||"1"===e.experiment?e.experiment=!0:e.experiment=!1,e}(fe=function(e){return e.qosplayer===ce||"1"===e.qosplayer?e.qosplayer=!0:e.qosplayer=!1,e}(fe=function(e){return e.bdtools&&(e.bdtools=!0,e.autoplay=!0,e.adFree=!0),e}(fe=function(e){return e.refTest&&(e.refTest=!0),e}(fe=function(e){return e.v=3,e}(fe=function(e){var t={green:"ub85a901:lc85a901:ocffffff:ucffffff",red:"ubff3d23:lcff3d23:ocffffff:ucffffff",pink:"ube166b7:lce166b7:ocffffff:ucffffff",orange:"ubff720a:lcff720a:ocffffff:ucffffff"};return e.color&&e.color in t?e.style=t[e.color]:e.ub||e.gradlow?e.style="ub"+(e.ub||e.gradlow):e.style=!1,e}(fe=function(e){var t=!!se.isCid()&&se.id();return e.quality&&("medium"===e.quality?e.quality="med":"hd"===e.quality?e.quality="best":-1===("|"+["low","med","high","best"].join("|")+"|").indexOf("|"+e.quality+"|")&&delete e.quality),e.abs=!1,12930607===t&&(e.quality="high"),-1!==[0,443086,16427094,13434778,13434793,13434812,16433957,16433959,16433961,16433964,16433967,16434052,16434199,16472054,17881973,0].join("|").indexOf("|"+t+"|")&&(e.quality="auto",e.abs=!0),e}(fe=function(e){return e.volume&&+e.volume>=0&&+e.volume<=100?e.volume=+e.volume:e.volume=100,e}(fe=function(e){return e.lite&&e.lite===ce?e.lite=!0:e.lite=!1,e}(fe=function(e){return e.showtitle&&"false"===e.showtitle?e.showtitle=!1:e.showtitle=!0,e}(fe=function(e){return"false"===e.controls&&(e.controls=!1),e}(fe=function(e){return!e.autoplay||e.autoplay!==ce&&1!=e.autoplay?e.autoplay=!1:e.autoplay=!0,e}(fe=function(e){return R.Z.sessionId&&R.Z.adFree?e.adFree=!0:e.adFree=!1,e}(fe=function(e){return e.longpoll===ce?e.longpoll=!0:e.longpoll=!1,e}(fe=function(e,t){var n,r=Array.isArray(e)?e.filter((function(e){return!/^hash=.+/.test(e)})):[],a=r.length;if(a){for(i=0;i<a;i+=1)t[(n=r[i].split("="))[0]]=n[1];le.debug("params from url",r)}if(window==window.parent&&R.Z.player&&0!==location.pathname.indexOf("/embed"))for(var i in le.debug("params from exposedVars.player expose",R.Z.player),R.Z.player)t[i]=R.Z.player[i];t.autoPlay&&(t.autoplay=t.autoPlay),t.siteMode&&(t.sitemode=t.siteMode),"false"===t.autoplay&&(t.autoplay=!1),t.branchName=R.Z.branchName,t.subscription=R.Z.hasSubscription,t.betaChannel=R.Z.isBetaChannel,t.isLive=R.Z.isLive;var o="channel"===(R.Z.player?R.Z.player.contentType:R.Z.contentType);return t.uumf=!!o||R.Z.isUUMF,t.initialQuality=R.Z.initialQuality,t.forcedQuality=R.Z.forcedQuality,t}(me,fe))))))))))))))))))),"theaterVisible",!1),fe=pe(fe,"popoutVisible",!1),fe=pe(fe,"ads",!1),fe=pe(fe,"allowfullscreen",!0),fe=pe(fe,"cmenu",!0),fe=pe(fe,"combinedstreammodule",!1),fe=pe(fe,"disableCaptionSearch",!1),fe=pe(fe,"hideAudioSwitch",!1),fe=pe(fe,"hideCta",!1),(fe=function(e){return R.Z.align===ce||!0===R.Z.align?e.align=!0:e.align=!1,e}(fe=pe(fe,"ignoretrim",!1))).setByContent=ge,fe.getByContent=function(e){var t=se.id();return fe[t]&&fe[t][e]||ge(e,!1),fe[t][e]},fe.update=function(){},le.debug("params object initiated",fe,!0),fe),Ee=n(6953);function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Te=(0,s.w)("atlas/lib/centralLogger"),Se=function(){var e,t,n,r,i={subdomain:"eventtracking-log",protocol:"localhost"===(null===(e=window)||void 0===e||null===(t=e.location)||void 0===t?void 0:t.hostname)?"https:":"",tag:"eventtracking.web.player",type:"web",callback:function(e,t){e?Te.debug("error:",e):t.forEach((function(e){Te.debug("sent:",e)}))}},o=(0,j.Z)(V.Z.config,"eventtrackingUrl","").match(/^([^.]+)\.(.+)$/);if(o){var s=(r=3,function(e){if(Array.isArray(e))return e}(n=o)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?be(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=s[1],u=s[2];i.subdomain=d,i.domain=u}return a().create(i)}();function Ie(){return o().storage}var Le={isLoggingEnabled:Ie,send:function(e){var t;if(Ie()){"string"==typeof e&&(e={message:e}),e.message=e.message||"";var n=o().swf?o().swf.join("."):"none",r=se.getMediaType(),a=se.app()===se.TYPE_CHANNEL?"channel_id":"recorded_id";e.data=Object.assign((ye(t={cluster:se.cluster()},a,se.id()),ye(t,"branch_name",he.branchName),ye(t,"player_version","v5"),ye(t,"flash_version",n),ye(t,"buildNumber",Ee.Z.BUILD_NUMBER),ye(t,"broadcaster_user_id",R.Z.ownerId),ye(t,"contentType",r),t),e.data||{}),Se.send(e)}}},Ae=n(1767),Oe=n(879),Pe=n(8338),De=n(6734),Re="ADD_VIDEO_TAG",_e="REMOVE_VIDEO_TAG",Ce=n(2959);function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){Ue(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Me={},ke="TOGGLE_CAPTION_SEARCH_COMPONENT",Fe="SET_CAPTION_MODULE",Ve="SET_SEARCH_RESULT",je=n(2547),xe=n(253);function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){He(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ge={activeCues:[],options:{}},Ye="DISABLE",Ke="SET_SLIDES",We="SET_CURRENT_SLIDE",ze=n(1163),Qe={isEnabled:!1,slides:[],currentSlide:null,firstSlide:!1,slideIndexPanelVisible:!1},qe=n(4500),Xe={activeMarkerIndex:void 0},$e="REMOVE_HASH",Je="SET_LOCK_INFO",et=n(4842),tt="SET_STREAM_MODULE",nt="SET_META_MODULE",rt="SET_ALL_TIME_TOTAL_MODULE",at="SET_ALL_VIEWERS_MODULE",it="SET_VIEWERS_MODULE",ot="SET_LOGO_MODULE",st="SET_SHARE_MODULE",dt="SET_BROADCASTER_MODULE",ut="SET_LIVE_CTA_MODULE",ct="SET_THUMBNAIL_MODULE",lt="SET_POLL_MODULE",ft=(0,s.w)("shared/ui/screen/hashlockadvanced");function mt(){var e=se.isVid()?R.Z.cId:se.id();return"c:token-".concat(e)}function gt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se.id();return"v:token-".concat(e)}function pt(e){var t=e.hash,n="video"===e.mediaType?gt():mt();de.ZP.set(n,t,{expires:Et(t)})}function vt(){if(se.isVid()||se.isOffairVid())return de.ZP.get(mt())||de.ZP.get(gt(se.offairVid()))}function ht(){return"ustreamEmbedHash-".concat(se.isVid()?R.Z.cId:se.id())}function Et(e){var t=function(e){var t;try{t=JSON.parse(e)}catch(t){return void ft.error("Failed to parse hash",e)}return t}(e);if(!t)return 14;var n=function(e){var t=function(e){var t=e.find((function(e){return Object.keys(e).includes("hashExpire")}));if(t)return Object.values(t).pop()}(e);return new Date(1e3*t)}(t);return isNaN(n.getTime())?14:n}var yt,bt={saveHashToLocalStorage:pt,getHashFromLocalStorage:function(){var e=(0,j.Z)(R.Z,"hash");if(e)return e;var t=se.isVid()?gt():mt(),n=de.ZP.get(t);if(n)return n;var r=vt();if(r)return r;var a=de.ZP.get(ht());return a&&pt({hash:a}),a},getFallbackHash:vt,removeCurrentHashFromLocalStorage:function(){if(de.ZP.set(ht(),null),se.isVid()){var e=gt();if(de.ZP.get(e))return void de.ZP.set(e,null)}de.ZP.set(mt(),null)},getPasswordFromSessionStorage:function(){var e=(se.isVid()?"v:":"c:")+se.id(),t="c:".concat(R.Z.cId),n="ustreamContentPw-".concat(e),r="ustreamContentPw-".concat(t);try{var a=window.sessionStorage.getItem(n);if(a)return JSON.parse(a).value;var i=window.sessionStorage.getItem(r);return JSON.parse(i).value}catch(e){return}}},Tt={hash:(yt=bt.getHashFromLocalStorage(),St(yt)?yt:void 0),password:bt.getPasswordFromSessionStorage(),info:{},id:null,lock:{type:"",data:{}},hashInvalid:!1};function St(e){return"false"!==e}var It={setWebkitSupportsFullscreen:"SET_WEBKIT_SUPPORTS_FULLSCREEN",setStreamModuleReceivedDate:"SET_STREAM_MODULE_RECEIVED_DATE",setHash:"SET_HASH",setPosition:"SET_POSITION"},Lt=n(3452),At=n(9433);function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){Dt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Dt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Rt={isBufferEmpty:!0,webkitSupportsFullscreen:!1,audioTracks:[],closedCaptionTracks:[],selectedAudio:-1,selectedClosedCaption:-2,closedCaptionSelection:null,closedCaptionVisible:!0,stats:{storages:{},buffers:{}},videoResolution:"",playing:!1,progress:0,position:0,ready:!1,videoTrackDisabled:!1};function _t(e,t){var n=e.event,r=e.ranges,a=e.streamId;return"Atlas.stored"!==n?t:Object.assign({},t,Dt({},a,r))}function Ct(e,t){var n=e.event,r=e.ranges,a=e.bufferId;return"Atlas.buffered"!==n?t:Object.assign({},t,Dt({},a,r))}function wt(e){var t=e.prevTracks,n=e.nextTracks,r=e.selectedTrack,a=t.find((function(e){return e.id===r}));if(!a)return-1;var i=n.filter((function(e){var t=e.language,n=e.country;return t===a.language&&n===a.country})),o=i.find((function(e){return e.id===a.id}));return o?o.id:(0,j.Z)(i,"0.id",-1)}var Nt=n(6336);function Ut(e){for(var t=document.cookie.split(";"),n=0;n<t.length;n+=1){var r=t[n].split("=");if(r[0].trim()===e)return decodeURIComponent(r[1])}}var Mt="notice_preferences",kt={ibmCookie:de.ZP.get(Mt)},Ft=n(4378),Vt=n.n(Ft),jt="SET_TITLE",xt="SET_TRIM_INFO",Bt=n(4843),Zt=n(862);function Ht(){return!(!se.isVid()&&!se.isOffairVid()||R.Z.isDashboard)}function Gt(e,t){var n=e.initialSeekTimeInMs;if(Ht()&&void 0!==t){if(n)return n;var r=se.isOffairVid()?se.offairVid():se.id(),a=Zt.Z.getSavedProgressToVideoId(r);if(a)return a.progress-Ee.Z.CONTINUE_WATCHING_OFFSET_IN_MS}}var Yt=n(2367);function Kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kt(Object(n),!0).forEach((function(t){zt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Qt={title:void 0,duration:void 0,trimmedDuration:void 0,audioOnly:!1,videoOnly:!1,mediaId:"",streamInfo:{},mediaType:void 0,isReplay:!1,thumbnails:{},trimInfo:void 0,defaultLang:void 0,is360Video:void 0,fov360Video:void 0,countryCode:void 0,liveStatus:void 0,initialSeekTimeInMs:void 0,isAudioOnlyPlaybackAvailable:!1};function qt(e){var t=e.streamFormats;return Object.prototype.hasOwnProperty.call(t,"hls/improved")?(0,j.Z)(t,"hls/improved.contentAccess.accessList.0.data.hasAudioOnlyPlaylist",!1):!(Object.prototype.hasOwnProperty.call(t,"flv/segmented")&&!Vt().capabilities.includes(Vt().formats.MP4_SEGMENTED))}var Xt={allTimeTotal:null,allViewers:null,viewers:null};function $t(e){return"secureUrl"in e}function Jt(e){var t=e.find($t);if(!t)return null;var n=t.secureUrl,r=t.clickUrl;return r?{url:n,clickUrl:r}:{url:n}}var en={showDefaultLogo:!1,customLogo:null},tn=n(5119);function nn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nn(Object(n),!0).forEach((function(t){an(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function an(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var on={facebook:void 0,twitter:void 0,mail:void 0,embed:void 0,copyLink:void 0,enabled:!1},sn=n(183),dn={showHiddenContextMenuItems:!1},un={userName:null,benefits:[]},cn=n(153),ln=n(103);function fn(e){var t=(0,j.Z)(e,"location","");return/multicast\//.test(t)}function mn(e){return(mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var gn={finalResult:[],forcedUrl:"",fallback:"",location:"",preferredLocation:[],cdnConfig:{}};function pn(e){return"object"!==mn(e)||null===e?e:Object.assign(e,{isMulticastProvider:fn(e)})}var vn=n(4542),hn={stats:{}},En={},yn="SET_ADS_PLAYING",bn={adsPlaying:!1},Tn=n(9187),Sn=n(94),In={fullScreen:!1,volume:100,speed:1,theaterMode:{visible:function(){if(he.theaterVisible)return!0;var e=document.querySelector(".ve-container"),t=e&&!e.classList.contains("no-rightbar")&&!e.classList.contains("no-socialstream");return!(!he.sitemode||!t)}(),enabled:!1},statsOverlayVisible:!1,debugOverlayVisible:!1,assistedReportingOverlayVisible:!1,playerSize:{width:0,height:0},isBrowserOldNotificationVisible:!1,isAssistedReportingNotificationVisible:!1};function Ln(e){var t=e;return e>100?t=100:e<0&&(t=0),t}var An={},On=n(9138),Pn=n(1693);function Dn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dn(Object(n),!0).forEach((function(t){_n(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cn(e){return function(e){if(Array.isArray(e))return wn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return wn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Nn,Un,Mn=function(e,t){var n=Cn(e),r=n.length,a=n[r-1],i=a&&a[a.length-1],o=function(e){return e.msg===t.msg&&t.timeStamp-e.timeStamp<3e3};return Array.isArray(a)&&o(i)?n[r-1]=[].concat(Cn(a),[t]):a&&o(a)?n[r-1]=[a,t]:n=[].concat(Cn(e),[t]),n},kn={keyFrameInterval:"N/A",INIT:{groupId:"FLOT",status:Pn.Q.LOADING,data:[]},TIMING:{groupId:"FLOT",status:Pn.Q.LOADING,data:[],timeToStartInMs:null},DISCONNECTS:{groupId:"FLOT",status:Pn.Q.SUCCESS,data:[]},REJECTS:{groupId:"FLOT",status:Pn.Q.SUCCESS,data:[]},EMPTY_MODULE:{groupId:"FLOT",status:Pn.Q.SUCCESS,data:[]},DOWNLOAD:{groupId:"QOS",isEcdn:!1,status:Pn.Q.SUCCESS,data:[],highestTotal:0},PLAYBACK_RECOVERABLE:{groupId:"PLAYBACK",status:Pn.Q.SUCCESS,data:[]},PLAYBACK_NON_RECOVERABLE:{groupId:"PLAYBACK",status:Pn.Q.SUCCESS,data:[]},EMPTY_CHUNK:{groupId:"PLAYBACK",status:Pn.Q.SUCCESS,data:[]}},Fn={key:"root",storage:De.Z,whitelist:[]},Vn={key:"provider",storage:De.Z,whitelist:["forcedUrl"]},jn={key:"mte_viewer_volume",storage:De.Z,whitelist:["volume"]},xn={key:"captionSettings",storage:De.Z,whitelist:["options"]},Bn={key:"hidden_context_menu_items",storage:De.Z,whitelist:["showHiddenContextMenuItems"]},Zn=(0,Oe.UY)({videoTag:function(e,t){var n=e||null,r=t.type,a=t.payload;switch(r){case Re:return a.videoTag;case _e:return null;default:return n}},externalVtt:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case Ce.Z.addExternalVtt:var a=r.vtt;return Ne(Ne({},e),{},{hasExternalVtt:!!a.length,vtt:a});default:return e}},captionSearch:function(e,t){var n=e||{panelVisibility:!1,visibility:!1},r=t.type,a=t.payload;switch(r){case ke:return Object.assign({},n,{visibility:a.visibility});case je.Z.toggleCaptionSearchPanel:return Object.assign({},n,{panelVisibility:a.panelVisibility});case je.Z.setSearchText:return Object.assign({},n,{searchText:a.searchText});case Fe:return Object.assign({},n,{module:a.module,visibility:a.visibility});case Ve:return Object.assign({},n,{searchResult:a.searchResult});default:return n}},captionSettings:(0,Pe.OJ)(xn,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ge,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case xe.Z.setActiveCues:return Ze(Ze({},e),{},{activeCues:r});case xe.Z.setOptions:var a=he.externalvtt?e.options:Ze(Ze({},e.options),r);return a.live?(a.textAlignLive=a.textAlign,delete a.textAlign):(a.textAlignVod=a.textAlign,delete a.textAlign),Ze(Ze({},e),{},{options:a});case xe.Z.resetOptions:return Ze(Ze({},e),{},{options:{}});default:return e}})),slideDeck:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qe,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case Ye:return Object.assign({},Qe);case Ke:var a=r.slides.slice().sort((function(e,t){return(0,j.Z)(e,"start",-1)-(0,j.Z)(t,"start",-1)}));return Object.assign({},e,{slides:a,isEnabled:!0,firstSlide:!0});case We:var i=(0,j.Z)(r,"slide.url",""),o=i.length?r.slide:null;return Object.assign({},e,{currentSlide:o,isEnabled:!0});case ze.Z.setOnboarding:return Object.assign({},e,{onboarding:r.onboarding});case ze.Z.toggleSlideIndexPanel:return Object.assign({},e,{slideIndexPanelVisible:r});default:return e}},seekbar:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case qe.Z.setActiveMarker:return Object.assign({},e,{activeMarkerIndex:r.activeMarkerIndex});case qe.Z.clearActiveMarker:return Object.assign({},e,{activeMarkerIndex:void 0});default:return e}},ums:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tt,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case et.Z.addPassword:return Object.assign({},e,{password:r.password,lock:{type:"",data:{}}});case et.Z.addHash:var a=!St(r.hash);return Object.assign({},e,{hashInvalid:a,hash:r.hash,lock:{type:"",data:{}}});case $e:return Object.assign({},e,{hash:null});case et.Z.setUmsInfo:return Object.assign({},e,{info:r.info});case nt:return Object.assign({},e,{id:r.umsId});case Je:return Object.assign({},e,{lock:{type:r.type,data:r.data}});default:return e}},playback:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case Lt.Z.setBufferEmpty:return Object.assign({},e,{isBufferEmpty:r.isBufferEmpty});case It.setWebkitSupportsFullscreen:return Object.assign({},e,{webkitSupportsFullscreen:r.supports});case Lt.Z.setAudioTracks:var a=r.tracks,i=wt({prevTracks:e.audioTracks,nextTracks:a,selectedTrack:e.selectedAudio});return Object.assign({},e,{selectedAudio:i,audioTracks:a});case Lt.Z.selectAudio:var o=r.index,s=e.audioTracks.some((function(e){return e.id===o}));return s?Object.assign({},e,{selectedAudio:o}):e;case It.setStreamModuleReceivedDate:var d=r.ts;return Object.assign({},e,{lastStreamModuleReceived:d});case Lt.Z.selectClosedCaption:var u=r.index;return Object.assign({},e,{selectedClosedCaption:u,closedCaptionVisible:-1!==u});case Lt.Z.setClosedCaptionTracks:var c=r.tracks,l=r.closedCaptionActiveFromLocalStorage,f=e.selectedClosedCaption,m=e.closedCaptionSelection;if(c.length>0&&-2===f){var g=(0,j.Z)(c.find((function(e){return e.default})),"id",null);g||0===g?(f=g,m="broadcaster"):l?(f=0,m="history"):(f=-1,m="manual")}return Object.assign({},e,{closedCaptionTracks:c,selectedClosedCaption:f,closedCaptionSelection:m});case Lt.Z.setCodecInfo:var p=r.codec,v=p.width,h=p.height,E=p.audioCodec,y=p.videoCodec;return Object.assign({},e,{audio:{codec:E},video:{width:v,height:h,codec:y},videoResolution:v&&h?"".concat(v,"x").concat(h):null});case Lt.Z.setPlaybackStats:var b=_t(r.stats,e.stats.storages),T=Ct(r.stats,e.stats.buffers);return Object.assign({},e,{stats:{storages:b,buffers:T}});case Lt.Z.togglePlaying:return Object.assign({},e,{playing:r});case It.setHash:return Object.assign({},e,{hashes:Object.assign({},e.hashes,r)});case Lt.Z.setProgress:return Object.assign({},e,{progress:(0,At.Z)(r,{lower:0,upper:1})});case It.setPosition:var S=r.position;return Object.assign({},e,{position:S});case Lt.Z.setReady:return Object.assign({},e,{ready:r});case Lt.Z.toggleVideoTrack:return Pt(Pt({},e),{},{videoTrackDisabled:r});default:return e}},privacy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kt,t=arguments.length>1?arguments[1]:void 0,n=t.type;switch(n){case Nt.Z.updatePrivacyCookie:return Object.assign({},e,{ibmCookie:Ut(Mt)});default:return e}},content:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qt,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case jt:return Wt(Wt({},e),{},{title:r});case Bt.Z.setDuration:return Wt(Wt({},e),{},{duration:r});case Bt.Z.setTrimmedDuration:return Wt(Wt({},e),{},{trimmedDuration:r,initialSeekTimeInMs:Gt(e,r)});case Bt.Z.toggleAudioOnly:return Wt(Wt({},e),{},{audioOnly:r});case Bt.Z.toggleVideoOnly:return Wt(Wt({},e),{},{videoOnly:r});case Bt.Z.setStreamInfo:return Wt(Wt({},e),{},{streamInfo:r.streamInfo});case Bt.Z.setMediaId:return Wt(Wt({},e),{},{mediaId:r.id});case Bt.Z.setMediaType:return Wt(Wt({},e),{},{mediaType:r});case nt:var a=r.isReplay,i=r.cut,o=r.highlight,s=r.defaultLang,d=r.video360,u=r.video360Fov,c=r.live360,l=r.live360Fov,f=r.countryCode,m=r.regionCode,g=u||l;return g=g?(0,At.Z)(parseInt(g,10),{lower:0,upper:360}):void 0,Wt(Wt({},e),{},{isReplay:a,trimInfo:i||o,defaultLang:s?s.replace("-00",""):void 0,is360Video:d||c,fov360Video:g,countryCode:f,regionCode:m});case tt:var p=e.isAudioOnlyPlaybackAvailable;return(0,Yt.M)(r)||(p=qt(r)),Wt(Wt({},e),{},{isAudioOnlyPlaybackAvailable:p});case ct:return Wt(Wt({},e),{},{thumbnails:r});case xt:return Wt(Wt({},e),{},{trimInfo:r});case Bt.Z.setLiveStatus:return Wt(Wt({},e),{},{liveStatus:r});default:return e}},viewers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case rt:return Object.assign({},e,{allTimeTotal:r});case at:return Object.assign({},e,{allViewers:r});case it:return Object.assign({},e,{viewers:r});default:return e}},logo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case ot:var a=r&&r.some((function(e){return!$t(e)})),i=r?Jt(r):null;return Object.assign({},e,{showDefaultLogo:a,customLogo:i});default:return e}},share:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:on,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case st:var a=(0,tn.Z)(r,["facebook","twitter","mail","embed","copy-link"]),i=a.facebook,o=a.twitter,s=a.mail,d=a.embed,u=a["copy-link"];return rn(rn({},e),{},{facebook:i,twitter:o,mail:s,embed:d,copyLink:u,enabled:!!r});default:return e}},contextMenu:(0,Pe.OJ)(Bn,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dn,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case sn.Z.toggleHiddenContextMenuItems:var a=r.isVisible;return Object.assign({},e,{showHiddenContextMenuItems:a});default:return e}})),broadcaster:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:un,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case nt:var a=Object.assign({},e),i=(0,j.Z)(r,"userName",null);a.userName=i;var o=(0,j.Z)(r,"broadcaster.benefits");return Array.isArray(o)&&(a.benefits=o),a;case dt:var s=(0,j.Z)(r,"benefits",[]);return Object.assign({},e,{benefits:s});default:return e}},settings:function(e,t){var n=t.type,r=t.payload,a={debug:de.ZP.get(de.Bx)||!!he.debug,isTitleVisible:!0},i=void 0===e?a:e;switch(n){case cn.Z.toggleDebug:return Object.assign({},i,{debug:r});case cn.Z.toggleTitleVisibility:return Object.assign({},i,{isTitleVisible:r});default:return i}},qos:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hn,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case vn.Z.setStatsData:return Object.assign({},e,{stats:Object.assign({},e.stats,r.stats)});default:return e}},liveCTA:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:En,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case ut:var a=r.remove;if(a)return{};var i=r.activate;return i?Object.assign({},i):e;default:return e}},poll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:An,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case lt:var a=r.remove;if(a)return{};var i=Object.assign({},e),o=(0,j.Z)(r,"pollStart");o&&(i=Object.assign({},o));var s=(0,j.Z)(r,"pollStop.stoppedAt");return s&&Object.assign(i,{stoppedAt:s}),i;default:return e}},provider:(0,Pe.OJ)(Vn,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gn,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case ln.Z.setProvidersStats:var a=(0,j.Z)(r.stats,"finalResult",e.finalResult),i=(0,j.Z)(r.stats,"fallback",e.fallback),o=(0,j.Z)(r.stats,"location",e.location),s=(0,j.Z)(r.stats,"preferredLocation",e.preferredLocation),d=(0,j.Z)(r.stats,"cdnConfig",e.cdnConfig);return Object.assign({},e,{finalResult:a,fallback:i,location:o,preferredLocation:s,cdnConfig:d});case ln.Z.setCurrentProvider:var u=r.provider,c=pn(u);return Object.assign({},e,{currentProvider:c});case ln.Z.setForcedProviderUrl:return Object.assign({},e,{forcedUrl:r.url});default:return e}})),ads:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bn,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case yn:return Object.assign({},e,{adsPlaying:r.adsPlaying});default:return e}},player:(0,Pe.OJ)(jn,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:In,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case Tn.Z.toggleFullScreen:return Object.assign({},e,{fullScreen:r});case Tn.Z.setVolume:return Object.assign({},e,{volume:Ln(r)});case Tn.Z.setPlaybackSpeed:return Object.assign({},e,{speed:r});case Tn.Z.toggleTheaterMode:var a=Object.assign({},e.theaterMode,r);return Object.assign({},e,{theaterMode:a});case Tn.Z.toggleStatsOverlay:return Object.assign({},e,{statsOverlayVisible:r,debugOverlayVisible:!1,assistedReportingOverlayVisible:!1});case Tn.Z.toggleDebugOverlay:return Object.assign({},e,{debugOverlayVisible:r,statsOverlayVisible:!1,assistedReportingOverlayVisible:!1});case Tn.Z.toggleAssistedReportingOverlay:return Object.assign({},e,{debugOverlayVisible:!1,statsOverlayVisible:!1,assistedReportingOverlayVisible:r});case Tn.Z.resize:return Object.assign({},e,{playerSize:r});case Tn.Z.showNotification:var i=r===Sn.GT.oldBrowser||e.isBrowserOldNotificationVisible,o=r===Sn.GT.assistedReporting||e.isAssistedReportingNotificationVisible,s=Object.assign({},e,{isBrowserOldNotificationVisible:i,isAssistedReportingNotificationVisible:o});return Object.assign({},e,s);case Tn.Z.hideNotification:var d=r!==Sn.GT.oldBrowser&&e.isBrowserOldNotificationVisible,u=r!==Sn.GT.assistedReporting&&e.isAssistedReportingNotificationVisible,c=Object.assign({},e,{isBrowserOldNotificationVisible:d,isAssistedReportingNotificationVisible:u});return Object.assign({},e,c);case Tn.Z.closeAssistedReportingNotificationByUser:var l=Object.assign({},e,{isAssistedReportingNotificationVisible:!1,isAssistedReportingNotificationClosedByUser:!0});return Object.assign({},e,l);default:return e}})),debug:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kn,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case On.Z.addFlotInitDiagnostics:return Object.assign({},e,{INIT:Rn(Rn({},e.INIT),{},{status:r.inited?Pn.Q.SUCCESS:Pn.Q.ERROR})});case On.Z.addFlotDisconnectError:return Object.assign({},e,{DISCONNECTS:Rn(Rn({},e.DISCONNECTS),{},{status:Pn.Q.WARNING,data:[].concat(Cn(e.DISCONNECTS.data),[r])})});case On.Z.addFlotRejectError:return Object.assign({},e,{REJECTS:Rn(Rn({},e.REJECTS),{},{status:Pn.Q.ERROR,data:[].concat(Cn(e.REJECTS.data),[r])})});case On.Z.addFlotTimingDiagnostics:return Object.assign({},e,{TIMING:Rn(Rn({},e.TIMING),{},{status:r.timeToStartInMs<=5e3?Pn.Q.SUCCESS:Pn.Q.WARNING,timeToStartInMs:r.timeToStartInMs})});case On.Z.addFlotEmptyStreamModuleError:var a=r.isEmpty,i=!!e.EMPTY_MODULE.data.length;return i||a?Object.assign({},e,{EMPTY_MODULE:Rn(Rn({},e.EMPTY_MODULE),{},{status:Pn.Q.WARNING,data:[].concat(Cn(e.EMPTY_MODULE.data),[r])})}):e;case On.Z.addSlowChunkWarning:return Object.assign({},e,{DOWNLOAD:Rn(Rn({},e.DOWNLOAD),{},{status:Pn.Q.WARNING,data:[].concat(Cn(e.DOWNLOAD.data),[r]),isEcdn:!!r.isEcdn,highestTotal:e.DOWNLOAD.highestTotal<r.total?r.total:e.DOWNLOAD.highestTotal})});case On.Z.addPlaybackWarning:case On.Z.addPlaybackError:var o=n===On.Z.addPlaybackError,s=o?Pn.Q.ERROR:Pn.Q.WARNING,d=o?"PLAYBACK_NON_RECOVERABLE":"PLAYBACK_RECOVERABLE";return Object.assign({},e,_n({},d,Rn(Rn({},e[d]),{},{status:s,data:Mn(e[d].data,r)})));case On.Z.addChunkEmptyWarning:return Object.assign({},e,{EMPTY_CHUNK:Rn(Rn({},e.EMPTY_CHUNK),{},{status:Pn.Q.WARNING,data:[].concat(Cn(e.EMPTY_CHUNK.data),[r])})});case On.Z.addKeyFrameDiagnostics:return Object.assign({},e,{keyFrameInterval:"number"==typeof r.keyFrameInterval?r.keyFrameInterval:"N/A"});case On.Z.resetDebugOverlay:return kn;default:return e}}}),Hn=(0,Pe.OJ)(Fn,Zn),Gn=n(9804),Yn=(0,s.w)("atlas/logic/api"),Kn={COMMAND:"api_command"},Wn={},zn="api-target-origin";function Qn(e){return Nn||function(e){try{return new URL(e).origin}catch(e){return""}}(e)}function qn(e,t){var n=document.referrer||window.location.href,r=window.parent,a=/^(\/internal)?\/combined-embed\//.test(window.location.pathname);if((window===window.parent||a)&&(n=window.location.href,r=window),"progress"!==e&&Yn.debug("send ",[e,t]),n){var i=Qn(n);if(i){var o={event:{}};e.property?o=e:o.event[e]=t,r.postMessage(JSON.stringify(o),i)}}}window.addEventListener("message",(function(e){var t,n,r=e.origin,a=window.location,i=document.referrer||a.href;if(i){if(r===Qn(i)||(n=[r,a.href].map((function(e){try{return new URL(e).host}catch(e){return""}})))[0]===n[1]){try{t=JSON.parse(e.data)}catch(e){t={}}if(Yn.debug("message event received ",[e.origin,e.data]),"CorsFrame"===t.id&&t.sessionId&&(0,f.Z)(Wn,Kn.COMMAND,{cmd:"setSession",args:[t.sessionId,!1]}),"setSession"===t.cmd&&!function(e){return/(m|www)\.?(dev)?\.ustream\.tv/gi.test(e)}(r))return;t.cmd&&(0,f.Z)(Wn,Kn.COMMAND,t)}}else Yn.debug("message event handler error: no referrer ")})),(Un=document.getElementById("CorsFrame"))&&(o().ssl||he.sitemode||Un.setAttribute("src",Un.getAttribute("data-src")));var Xn=function(){if(void 0===window.postMessage)return{event:Kn,send:function(){},on:function(){}};if(he[zn]){var e=decodeURIComponent(he[zn]);try{var t=new URL(e);Nn=t.origin}catch(e){Yn.error("api-target-origin is not a valid URL")}}return{event:Kn,send:qn,on:function(e,t){Wn[e]||(Wn[e]=[]),Wn[e].push(t)}}}(),$n=[Lt.Z.selectAudio,Lt.Z.setAudioTracks],Jn=[Lt.Z.selectClosedCaption,Lt.Z.setClosedCaptionTracks],er="is_cc_active",tr=n(8989);function nr(e,t){var n=e.find((function(e){return e.id===t}));if(!n)return null;var r=n.country,a=void 0===r?"00":r,i=n.language,o=n.isGenerated;return{language:"".concat(i,"-").concat(a),generated:o}}function rr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ar(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ar(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ir=n(2370),or=(0,Oe.MT)(Hn,{},(0,Gn.Uo)((0,Oe.md)((function(){return function(e){return function(t){return t.type===et.Z.addHash&&("false"!==t.payload.hash?bt.saveHashToLocalStorage(t.payload):bt.removeCurrentHashFromLocalStorage()),t.type===et.Z.removeHash&&bt.removeCurrentHashFromLocalStorage(),e(t)}}}),(function(e){return function(t){return function(n){var r=t(n);if($n.includes(n.type)){var a=e.getState().playback,i=a.selectedAudio,o=a.audioTracks;if(o.length>0){var s=o.map((function(e){var t=e.id;return{index:t,label:e.label,language:e.language,country:e.country,active:i===t}}));Xn.send("audio",s)}}return r}}}),(function(e){return function(t){return function(n){var r=t(n);if(Jn.includes(n.type)){var a=e.getState().playback,i=a.selectedClosedCaption,o=a.closedCaptionTracks;if(o.length>0){var s=o.map((function(e){var t=e.id;return{index:t,label:e.label,language:e.language,country:e.country,active:i===t}}));Xn.send("cc",s)}}return r}}}),(function(e){return function(t){return function(n){if(n.type===Lt.Z.selectClosedCaption){var r=n.payload.index>=0;de.ZP.set(er,r,{expires:3650})}if(n.type===Lt.Z.setClosedCaptionTracks&&-2===e.getState().playback.selectedClosedCaption){var a=de.ZP.get(er),i=Object.assign({},n.payload,{closedCaptionActiveFromLocalStorage:a});return t(Object.assign({},n,{payload:i}))}return t(n)}}}),(function(e){return function(t){return function(n){if(n.type===It.selectClosedCaption){var r=(0,j.Z)(e.getState(),"playback.selectedClosedCaption"),a=(0,j.Z)(n,"payload.index");if(r!==a){var i=(0,j.Z)(e.getState(),"playback.closedCaptionTracks",[]),o=(0,j.Z)(e.getState(),"content.mediaType")===tr.w_.live?"live":"vod";if(a>-1){var s=nr(i,a);s&&Le.send({message:"Turn on CC",data:{category:"Interaction",item:"CC",action:"turn_on",type:o,language:s.language,generated:s.generated}})}else{var d=nr(i,r);d&&Le.send({message:"Turn off CC",data:{category:"Interaction",item:"CC",action:"turn_off",type:o,language:d.language,generated:d.generated}})}}}return t(n)}}}),(function(e){return function(t){return function(n){var r=t(n);if(n.type===cn.Z.toggleDebug){var a=e.getState().settings.debug;de.ZP.set(de.Bx,a)}return r}}}),(function(){return function(e){return function(t){var n=t.type,r=t.payload;if(n===ct){var a=function(e){return/SecureUrl$/.test(e)},i=Object.entries(r).filter((function(e){var t=rr(e,1)[0];return o().ssl&&a(t)||!o().ssl&&!a(t)})).map((function(e){var t=rr(e,2),n=t[0],r=t[1];return[n.replace(/(?:Secure)?Url$/,""),r.replace("#SIZE#","640x360")]})).reduce((function(e,t){var n=rr(t,2),r=n[0],a=n[1];return Object.assign(e,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,a))}),{});return e(Object.assign({},t,{payload:i}))}return e(t)}}}),ir.Z,(function(){return function(e){return function(t){if(t.type===Bt.Z.setTrimmedDuration){if(!Ht())return e(t);var n=t.payload,r=se.isOffairVid()?se.offairVid():se.id(),a=Zt.Z.getSavedProgressToVideoId(r);if(void 0===n||!a)return e(t);var i=a.progress,o=a.cut,s=o?se.getRelativeSeekPositionInMs(i):i,d=o&&(o.cutStart!==se.getCutStart()||o.cutEnd!==se.getCutEnd()),u=1e3*t.payload,c=s-Ee.Z.CONTINUE_WATCHING_OFFSET_IN_MS,l=c<0||c>=u-Ee.Z.CONTINUE_WATCHING_OFFSET_IN_MS-500;(d||l)&&Zt.Z.removeProgressForVideoId(r)}if(t.type===It.setPosition){if(!Ht())return e(t);var f=t.payload,m=f.position,g=f.sourceMedia;Zt.Z.saveProgressToCurrentVideoId(m,"".concat(g),se.getHighlight())}return e(t)}}}))));(0,Pe.p5)(or);var sr=or,dr=(0,n(634).Z)(sr),ur={};function cr(){ur={}}var lr={cleanup:cr,setInitStart:function(){ur.initStart=Date.now();var e=(0,Ae.hz)(dr.getState()),t=e.width,n=e.height;Le.send({message:"Initial loading started",data:{category:"Loading",item:"initial loading",action:"started",width:t,height:n}})},reportUmsConnectionStart:function(e){ur.ums=ur.ums||{},ur.ums[e]={startTime:Date.now()},Le.send({message:"UMS connection started",data:{category:"Loading",item:"UMS connection",action:"connected",autoplay:he.autoplay,time_spent_from_init:ur.ums[e].startTime-ur.initStart}})},reportUmsConnectionFinished:function(e){ur.ums&&ur.ums[e]&&(ur.ums[e].endTime=Date.now(),Le.send({message:"UMS connection completed",data:{category:"Loading",item:"UMS connection",action:"connected",autoplay:he.autoplay,time_spent:ur.ums[e].endTime-ur.ums[e].startTime,time_spent_from_init:ur.ums[e].endTime-ur.initStart}}))},reportStreamModuleReceived:function(){ur.ums&&(ur.streamModule=Date.now(),Le.send({message:"Stream module received",data:{category:"Loading",item:"stream module",action:"received",time_spent_from_init:ur.streamModule-ur.initStart,time_spent:ur.streamModule-Object.keys(ur.ums).reduce((function(e,t){var n=ur.ums[t].endTime;return n>e?n:e}),0),autoplay:he.autoplay}}))},reportFirstTimeUpdate:function(){var e=Date.now();Le.send({message:"First time update",data:{category:"Playback",item:"playback",action:"started",time_spent:e-ur.streamModule,time_spent_from_init:e-ur.initStart,autoplay:he.autoplay}}),cr()},reportFirstPlayCall:function(){ur.firstPlayCall=Date.now(),Le.send({message:"First Play call",data:{category:"Interaction",item:"playback",action:"requested",time_spent:ur.firstPlayCall-ur.streamModule,time_spent_from_init:ur.firstPlayCall-ur.initStart,autoplay:he.autoplay}})}};function fr(e){return{type:nt,payload:e}}function mr(e){return{type:ut,payload:e}}function gr(e){return{type:lt,payload:e}}function pr(e){return(pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var vr=(0,s.w)("atlas/data/datamanager"),hr={},Er=["advert","broadcaster","caption","slides","meta","poll","livecta","qos","share","stream","tcdn"];function yr(e){var t={};if("boolean"==typeof e)return e;for(var n=0;n<e.length;n++)t[e[n].name]=e[n];return t}function br(e){var t,n=e.name,r=e.payload;switch(n){case"stream":return dr.dispatch(function(e){return{type:tt,payload:e}}(r));case"meta":return dr.dispatch(fr(r));case"allTimeTotal":return dr.dispatch(function(e){return{type:rt,payload:e}}(r));case"allViewers":return dr.dispatch(function(e){return{type:at,payload:e}}(r));case"viewers":return dr.dispatch(function(e){return{type:it,payload:e}}(r));case"logo":return dr.dispatch(function(e){return{type:ot,payload:e}}(r));case"share":return dr.dispatch(function(e){return{type:st,payload:e}}(r));case"broadcaster":return dr.dispatch(function(e){return{type:dt,payload:e}}(r));case"livecta":return dr.dispatch(mr(r));case"thumbnail":return dr.dispatch(function(e){return{type:ct,payload:e}}(r));case"poll":if(null===(t=r)||(Array.isArray(t)?0===t.length:"object"===pr(t)&&0===Object.keys(t).length))return;return dr.dispatch(gr(r));default:return vr.debug("".concat(n," module received but haven't added to the store")),null}}var Tr=function(e){vr.debug("createMedia: "+e),hr[e]={}},Sr=function(e,t){if(e&&hr[e]&&void 0!==t&&t instanceof Object){for(var n in t)-1===Er.indexOf(n)&&("object"!==pr(t[n])||null===t[n]||Array.isArray(t[n])||(t[n].mid=e),hr[e][n]=t[n],br({name:n,payload:t[n]}),S(y,n+"Update",t[n]),S(b,T.MODULE_INFO,{mid:e,send:n}));for(var r=0;r<Er.length;++r)void 0!==t[Er[r]]&&("object"!==pr(t[Er[r]])||null===t[Er[r]]||Array.isArray(t[Er[r]])||(t[Er[r]].mid=e),"share"===Er[r]&&(t[Er[r]]=yr(t[Er[r]])),hr[e][Er[r]]=t[Er[r]],br({name:Er[r],payload:t[Er[r]]}),S(y,Er[r]+"Update",t[Er[r]]),S(b,T.MODULE_INFO,{mid:e,send:Er[r]}))}},Ir=function(e){vr.debug("destroyMedia:",e),delete hr[e]},Lr=!(se.isCid()&&o().android&&2===o().android[0])&&!o().swf&&!o().ie&&!!document.createElement("video").canPlayType&&o().android||o().blackberry||o().ios||o().playstation||!!he.ios||!!he.refTest||!!he.html5,Ar={AD_EVENT:"ustreamAdEvent",AD_ERROR:"ustreamProviderError",AD_STARTED:"ustreamAdStarted",AD_FINISHED:"ustreamAdFinished",AD_CHANGED:"ustreamAdChanged",DELAY_STARTED:"ustreamDelayStarted",DELAY_FINISHED:"ustreamDelayFinished",DELAY_ERROR:"ustreamDelayError",types:{PLAY_POSTROLL:"adEvent.type.playPostroll",VIDEO_FINISHED:"adEvent.type.videoFinished",POSTROLL_FINISHED:"adEvent.type.postrollFinished",VIDEO_STARTED:"adEvent.type.videoStarted",PREROLL_DONE:"adEvent.type.prerollDone",COMPANION:"adEvent.type.companion",AD_RESIZE:"adEvent.type.adResize",RULESET_HAS_ADS:"adEvent.type.rulesetHasAds"}},Or=n(4213),Pr=n(4870),Dr=n(5436),Rr=n(2071),_r=(0,s.w)("htmlApiProxy"),Cr=Math.pow(10,3),wr=!1,Nr=0,Ur=0,Mr=0,kr=0;function Fr(e){wr=e}function Vr(e){Nr=e}function jr(e){Ur=e}function xr(e){var t=function(e){var t=se.getDurationInMillisec()/1e3;return 0===e||0===t?0:se.isHLS()?se.getTrimmedDurationInMillisec()/1e3*e:e*t-t*se.getCutStart()}(e);Mr=Math.round(t*Cr)/Cr}function Br(e){kr=e}function Zr(e,t){var n={property:{}};n.property[e]=t,Xn.send(n)}function Hr(e){switch(_r.debug("api command received",e),e.cmd){case"probe":(0,Ae.DK)(dr.getState())&&Xn.send("ready",!0);break;case"play":he.autoplay=!0,C().setPlay();break;case"pause":C().setPause();break;case"stop":C().setPause(),C().setSeek(0);break;case"load":S(h,T.LOAD,e.args),wr&&S(h,T.PLAY);break;case"seek":var t=1e3*e.args[0],n=se.getTrimmedDurationInMillisec();if(!Vt().initialized||!n)return void se.saveSeek({positionInMs:t,initiator:_._.USER});if(t<0||t>n)return;se.resetSavedSeek();var r=t/n;C().setSeek(r);break;case"volume":if(null!==e.args[0])return void dr.dispatch((0,Sn.jA)(e.args[0]));var a=Vt().initialized?100*Vt().getVolume():null;Zr(e.cmd,a);break;case"content":Zr(e.cmd,[se.app()].concat(se.ids()));break;case"playingContent":!function(e){se.isCid()&&!se.live()?Zr(e.cmd,kr?["recorded",kr]:[]):Zr(e.cmd,[se.app()].concat(se.ids()))}(e);break;case"duration":Zr(e.cmd,se.getDurationInMillisec()/1e3);break;case"progress":Zr(e.cmd,Mr);break;case"viewers":Zr(e.cmd,Ur);break;case"allTimeTotalViewers":Zr(e.cmd,Nr);break;case"quality":var i=e.args[0];S(h,T.QUALITY_CHANGE,i);break;case"setSession":C().setSession(e.args);break;case"setTitleVisibility":var o=!!e.args[0];dr.dispatch((0,Dr.w)(o));break;case"pollAnswer":C().setPollAnswer(e.args[0]);break;case"pollTracking":C().setPollTracking(e.args[0]);break;case"cc":dr.dispatch((0,Pr.JM)(parseInt(e.args[0],10)));break;case"setExternalVtt":dr.dispatch((0,Or.R)(e.args[0][0].forVTTCue));break;case"audio":dr.dispatch((0,Pr.Ft)(parseInt(e.args[0],10)));break;case"theater":dr.dispatch((0,Sn.Eu)({visible:e.args[0]}));break;case"stats":var s=(0,Ae.af)(dr.getState());Zr(e.cmd,s);break;case"sendLog":var d=C();d.setLogSendingStarted(),(0,Rr.Z)().then((function(e){d.setLogSendingCompleted(e)})).catch((function(e){_r.error(e.message),d.setLogSendingCompleted()}))}}var Gr=function(){I(y,T.ALLTIMETOTAL_UPDATE,Vr),I(y,T.VIEWERS_UPDATE,jr),I(E,T.PLAYING,Fr),I(E,T.PROGRESS,xr),I(E,T.CREATE_OFFAIR_VIDEO,Br),Xn.on(Xn.event.COMMAND,Hr),he.viewingexperience&&window.$&&(window.$.capture("HIDETHEATERBUTTON",(function(){return dr.dispatch((0,Sn.Eu)({visible:!1}))})),window.$.capture("SHOWTHEATERBUTTON",(function(){return dr.dispatch((0,Sn.Eu)({visible:!0}))})))},Yr=(0,s.w)("atlas/lib/cdngw"),Kr=0,Wr=0,zr=!1;function Qr(e,t,n,r,a){var i;zr=!1,Kr>6?r.call(null):(a?i=a:(i=Math.pow(2,Kr),i*=1e3),Wr=setTimeout((function(){!function(e,t,n,r,a){a?(Yr.debug("gateway timeout."),r.call(null)):(Kr+=1,Yr.debug("gateway timeout. Trying again ..."),Qr(e,t,n,r))}(e,t,n,r,a)}),i),e(t,n,r,a))}function qr(e,t){clearTimeout(Wr),Kr=1,zr||e.call(null,t)}var Xr,$r=(0,s.w)("atlas/logic/ads/provider/delay");function Jr(){Xr&&S(E,Ar.DELAY_FINISHED)}function ea(){$r.debug("reset timer"),Xr&&clearTimeout(Xr),Xr=void 0}var ta,na,ra,aa,ia,oa,sa,da,ua,ca,la,fa,ma,ga={type:"delay",start:function(e){if($r.debug("start delay"),ea(),e&&e.duration){var t=1e3*parseInt(e.duration,10);t>0?($r.debug("start ".concat(t,"ms timeout")),Xr=setTimeout(Jr,t),S(E,Ar.DELAY_STARTED)):S(E,Ar.DELAY_ERROR)}else S(E,Ar.DELAY_ERROR)},reset:ea},pa=n(1682),va={DEFAULT:"default",INITIALIZED:"initialized",STARTED:"started",STOPPED:"stopped",PAUSED:"paused",FAILED:"failed",IN_PROGRESS:"adInProgress"},ha={PRE:"pre",MID:"mid",POST:"post",PARTNER:"partner",LINEAR:"lfeed"},Ea=3e4,ya=3e4,ba=9e5,Ta={},Sa=(0,s.w)("atlas/logic/ads/providers/googleIMA"),Ia=o().ssl?"https://imasdk.googleapis.com/js/sdkloader/ima3.js":"http://imasdk.googleapis.com/js/sdkloader/ima3.js",La=!1,Aa=!1,Oa=!1,Pa=!1,Da=0,Ra=o().ios;function _a(e){void 0!==e&&clearTimeout(e)}function Ca(e){La&&S(E,Ar.AD_ERROR,{code:e})}function wa(){_a(ia),La&&Ca("400")}function Na(){_a(sa),La&&Ca("400")}function Ua(){Sa.debug("googleIMA.onAllAdsCompleted"),La&&S(E,Ar.AD_FINISHED)}function Ma(){Sa.debug("googleIMA.onTimeout"),La&&(_a(aa),Ua())}function ka(e){var t=e.getInnerError(),n={errorCode:e.getErrorCode(),message:e.getMessage()};t&&(n.innerErrorMessage=t.message),Sa.debug("googleIMA.onAdError",n)}function Fa(e){e.getError()&&ka(e.getError()),_a(ia),_a(oa),La&&Ca("200")}function Va(){Sa.debug("googleIMA.onAdLoaded"),_a(oa),La&&(sa=setTimeout(Na,ya))}function ja(){Sa.debug("googleIMA.adBreakReadyHandler"),La&&(sa=setTimeout(Na,ya))}function xa(){Sa.debug("googleIMA.onContentPauseRequested"),na.removeEventListener("ended",Ja),Ra&&(ma=na.src,Da=na.currentTime),S(h,T.PAUSE)}function Ba(){na.seekable.length?na.seekable.end(0)>Da&&(na.currentTime=Da,na.removeEventListener("loadedmetadata",Ba),S(h,T.PLAY)):setTimeout(Ba,100)}function Za(){Sa.debug("googleIMA.onContentResumeRequested"),Ta.isAdBlockPlaying||(na.addEventListener("ended",Ja),Ra?(na.src=ma,na.addEventListener("loadedmetadata",Ba),na.load()):S(h,T.PLAY))}function Ha(){Sa.debug("googleIMA.onAdStarted"),_a(sa),La&&(S(E,Ar.AD_STARTED),(ra.forceTimer||"video"!==ra.type)&&ra.duration&&1e3*parseInt(ra.duration,10)>0&&(Sa.debug("set forceTimer: ".concat(ra.duration,"s")),aa=setTimeout(Ma,1e3*parseInt(ra.duration,10))))}function Ga(){Sa.debug("googleIMA.onAdClicked"),ca&&(fa?ca.resume():ca.pause())}function Ya(){Sa.debug("googleIMA.onAdPaused"),fa=!0}function Ka(){Sa.debug("googleIMA.onAdResumed"),fa=!1}function Wa(){Sa.debug("googleIMA.onAdComplete")}function za(){_a(oa),La&&Ca("400")}function Qa(e){Sa.debug("googleIMA.onAdsManagerLoaded"),_a(ia);var t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!Ra,(ca=e.getAdsManager(na,t)).addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,Fa),ca.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,xa),ca.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,Za),ca.addEventListener(google.ima.AdEvent.Type.LOADED,Va),ca.addEventListener(google.ima.AdEvent.Type.STARTED,Ha),ca.addEventListener(google.ima.AdEvent.Type.COMPLETE,Wa),ca.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,Ua),ca.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,ja),ca.addEventListener(google.ima.AdEvent.Type.CLICK,Ga),ca.addEventListener(google.ima.AdEvent.Type.PAUSED,Ya),ca.addEventListener(google.ima.AdEvent.Type.RESUMED,Ka);try{oa=setTimeout(za,Ea),ca.init(Xa().width,Xa().height,google.ima.ViewMode.NORMAL),ca.start()}catch(e){Sa.error("error during googleIMA ad init and start process"),ka(e),Ca("300")}}function qa(){_a(aa),_a(ia),_a(oa),_a(sa)}function Xa(){return{width:ta.clientWidth,height:ta.clientHeight}}function $a(){Sa.debug("setupIMA"),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),(da=new google.ima.AdDisplayContainer(ta,na)).initialize(),(la=new google.ima.AdsLoader(da)).getSettings().setDisableCustomPlaybackForIOS10Plus(!0),la.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,Qa,!1),la.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,Fa,!1),na.onended=Ja}function Ja(){Sa.debug("content ended detected"),Pa||(la.contentComplete(),S(E,Ar.PLAY_POSTROLL),Pa=!0)}function ei(e,t,n){return n?e.replace(new RegExp("__".concat(t,"__"),"g"),n):e}function ti(){throw Sa.debug("googleIMA.onSdkLoadError"),Oa=!0,new Error("SDK load failed")}function ni(){Sa.debug("googleIMA.onVpaidSdkLoadSuccess"),Oa=!0,void 0!==google.ima&&(Aa=!0)}var ri,ai,ii,oi,si=function(e,t){return e?t?(ta=e,na=t,(Sa.debug("googleIMA.loadSdks"),Aa?Promise.resolve():Oa?(Ca(100),Promise.reject(new Error("SDK load failed"))):pa.Z.js(Ia).then(ni,ti)).then($a)):Promise.reject(new Error("Empty content element")):Promise.reject(new Error("Empty Ad slot element"))},di=function(e){var t,n;Sa.debug("request ad",e),e&&(ra=e),Sa.debug("googleIMA.request. hasSdk: ".concat(Aa," isSdkTriedToLoad: ").concat(Oa)),Aa?(La=!0,da?la&&la.contentComplete():(Sa.debug("AdDisplayContainer not initialized yet"),$a()),(ua=new google.ima.AdsRequest).adTagUrl=(t=function(e){var t=e.adTag;if(t=ei(t,"REFERRER",ue.Z),t=ei(t,"CHANNEL_PAGE_URL",ue.Z),t=ei(t,"CHANNEL",Ta.channelId),t=ei(t,"CACHE_BREAKER",Math.round(1e7*Math.random())),Ta.title){var n=encodeURI(Ta.title.substr(0,100));t=ei(t,"TITLE",n)}return Ta.videoId&&(t=ei(t,"VIDEOID",Ta.videoId)),e.metaData&&Object.keys(e.metaData).forEach((function(n){var r="CUSTOM_META-ID".concat(n),a=e.metaData[n],i="".concat(a.displayName,"=").concat(a.value);t=ei(t,r,i)})),t}(ra),n=new URL(t),!0===Ta.npa&&n.searchParams.set("npa","1"),n.href),ua.linearAdSlotWidth=Xa().width,ua.linearAdSlotHeight=Xa().height,la.requestAds(ua),ia=setTimeout(wa,Ea)):Ca(100)},ui=function(){ca&&ca.resize(Xa().width,Xa().height,"normal")},ci=function(){Sa.debug("googleIMA.destroy"),qa(),ca&&(ca.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,Fa),ca.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,xa),ca.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,Za),ca.removeEventListener(google.ima.AdEvent.Type.LOADED,Va),ca.removeEventListener(google.ima.AdEvent.Type.STARTED,Ha),ca.removeEventListener(google.ima.AdEvent.Type.COMPLETE,Wa),ca.removeEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,Ua),ca.removeEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,ja),ca.removeEventListener(google.ima.AdEvent.Type.CLICK,Ga),ca.removeEventListener(google.ima.AdEvent.Type.PAUSED,Ya),ca.removeEventListener(google.ima.AdEvent.Type.RESUMED,Ka),ca.destroy(),ca=null),la&&(la.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,Qa),la.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,Fa),la.destroy(),la=null),da&&(da.destroy(),da=null),La=!1,Pa=!1},li=function(){Sa.debug("googleIMA.reset"),La=!1,Pa=!1,qa()},fi=(0,s.w)("atlas/logic/ads/ruleset/handler"),mi=[ha.PRE,ha.MID,ha.POST,ha.PARTNER,ha.LINEAR],gi=-1;function pi(){return ii}function vi(){return!!ii&&mi.reduce((function(e,t){var n=ii[t]||[];return e.concat(n)}),[]).length>0}function hi(e){void 0!==e.block?e.block!==gi&&(-1!==gi&&(e.blockEnd=!0),gi=e.block,e.blockStart=!0):-1!==gi&&(e.blockEnd=!0,gi=-1)}function Ei(e){var t=-1!=="delay,googleads".indexOf(e.provider);return t||fi.error("rule provider is not supported"),t}function yi(e){fi.debug("createPartnerDelayForVOD");var t={duration:ba,provider:"delay",rule:1};ii[e].push(t)}function bi(e,t){for(var n,r=[],a=0;a<e.length;a+=1){var i=e[a];i&&Ei(i)&&(t===ha.MID&&(hi(i),a===e.length-1&&(i.blockEnd=!0,gi=-1)),se.isVid()&&t===ha.PARTNER&&yi(t),ai&&(i.metaData=ai),r.push(i))}return t!==ha.PRE&&t!==ha.POST&&t!==ha.PARTNER||(n=r).length>1&&(n[0].blockStart=!0,n[n.length-1].blockEnd=!0),r}var Ti,Si={setData:function(e,t){fi.debug("setData: ",e),e&&t?(oi=t,function(e){Object.prototype.hasOwnProperty.call(e,"info")&&!ri&&(ri=e.info,fi.debug("parseData >> data.info exists",ri)),Object.prototype.hasOwnProperty.call(e,"metadata")&&Object.keys(e.metadata).length>0&&(ai=e.metadata,fi.debug("parseData >> data.metadata exists",ai)),ii={};for(var t=0;t<mi.length;t+=1){var n=mi[t];fi.debug("current position: ",n),Object.prototype.hasOwnProperty.call(e,n)&&e[n].length&&(ii[n]=bi(e[n],n))}fi.debug("parse has ended with ruleSet",ii)}(e),vi()&&S(E,Ar.AD_EVENT,{type:Ar.types.RULESET_HAS_ADS})):fi.error("there is no data")},destroy:function(){fi.debug("destroy"),ri=void 0,ai=void 0,ii=void 0},removeRule:function(e,t){fi.debug("removeRule - pos: ".concat(e," - index: ").concat(t)),e&&void 0!==t&&ii[e][t]&&ii[e].splice(t,1)},getData:pi,getInfo:function(){return ri},hasAds:vi,id:function(){return oi},addRevShareRules:function(e){!function(e,t){fi.debug("updateRulesInPosition",{rules:e,pos:t}),e&&0!==e.length?ii[t]=bi(e,t):fi.error("updateRulesInPosition called without rules")}(e.map((function(e){return e.block=2375423,e})),ha.MID)},isRuleSetReadyForMedia:function(e){return vi()&&pi()&&e===oi},clearPosition:function(e){ii[e]&&(ii[e]=[])},hasPostroll:function(){var e=ii[ha.POST];return e&&e.length>0}},Ii=n(6148),Li=["AT","BE","BG","CH","HR","CY","CZ","DE","DK","EE","ES","FI","FR","GB","GR","HU","IE","IS","IT","LT","LU","LV","MT","NO","NL","PO","PT","RO","SE","SI","SK"],Ai=function(e){return-1!==Li.indexOf(e)};function Oi(){dr.dispatch((0,Ii.X)())}function Pi(){Ti&&clearInterval(Ti),Ti=null}function Di(e){return!e||Ai(e)}var Ri={startCheck:function(){Pi(),Oi(),Ti=setInterval(Oi,5e3)},stopCheck:Pi,isGDPRUser:Di,canStartAutoplay:function(){var e=he.isOnIbm||he.isOnUstream||"unknown"===ue.Z,t=dr.getState().content,n=t.countryCode,r=t.regionCode;return!(e&&(Di(n)||function(e){return!e||"CA"===e}(r))&&!dr.getState().privacy.ibmCookie)},areAdsEnabled:function(e){var t=dr.getState().privacy.ibmCookie;return t&&-1===t.indexOf("0:")&&-1===t.indexOf("1:")||!t&&e&&!Ai(e)}};function _i(e){return{type:yn,payload:{adsPlaying:e}}}var Ci,wi,Ni,Ui=(0,s.w)("atlas/logic/ads/ads"),Mi=!1,ki=va.DEFAULT,Fi=!1,Vi=!1,ji=!1,xi=!1,Bi=!1,Zi=!1,Hi=0,Gi=0,Yi=ha.PRE,Ki=-1,Wi=!1;function zi(){xi||(xi=!0,Ui.debug("dispatchPrerollDone - isPrerollDone: ",xi),S(E,Ar.AD_EVENT,{type:Ar.types.PREROLL_DONE}))}function Qi(){Ui.debug("dispatchCompanion - isCompanionDone: ".concat(Bi," - started: ").concat(Vi)),!Bi&&Vi&&(Bi=!0,S(E,Ar.types.COMPANION))}function qi(){Ui.debug("getNextRule - status: ",ki);var e=Si.getData();if(Ni=void 0,li(),ga.reset(),!Fi&&Vi&&ki!==va.PAUSED){if(ki=va.STARTED,Ki+=1,Ui.debug("getNextRule - pos: ".concat(Yi," - index: ").concat(Ki)),!Object.prototype.hasOwnProperty.call(e,Yi)||Ki===e[Yi].length){if(Ui.debug("there is no rules in current pos: ",!Object.prototype.hasOwnProperty.call(e,Yi)),Ki>0&&Object.prototype.hasOwnProperty.call(e,Yi)&&Ui.debug("end of loop: ",Ki===e[Yi].length),Ki=0,Yi===ha.POST)return void Si.clearPosition(ha.POST);if(Yi===ha.PRE)Yi=ha.MID,Ta.currentPos=Yi,zi();else if(Yi===ha.MID&&Zi)return Ui.debug("revshare block has finished"),Zi=!1,void Si.clearPosition(ha.MID);Ui.debug("current pos: ".concat(Yi," currentIndex:").concat(Ki))}Object.prototype.hasOwnProperty.call(e,Yi)&&e[Yi].length>0?(Ni=e[Yi][Ki],Ui.debug("processCurrentRule"),"googleads"===Ni.provider?(Ui.debug("renderCurrentAd",{currentRule:Ni,currentPos:Yi,currentIndex:Ki}),dr.dispatch(_i(!0)),Ta.width=Hi,Ta.height=Gi,di(Ni)):"delay"===Ni.provider?ga.start(Ni):(Ui.error("No provider defined to current rule."),ro()),Ni&&Ni.remove&&(Si.removeRule(Yi,Ki),Ki-=1)):Ui.debug("there are no more ads")}}function Xi(){Ui.debug("sendPostrollFinishedEvent"),S(E,Ar.AD_EVENT,{type:Ar.types.POSTROLL_FINISHED})}function $i(e){Ui.debug("sendVideoFinishedEvent"),S(E,Ar.AD_EVENT,{type:Ar.types.VIDEO_FINISHED,contentPlaying:e.contentPlaying,controls:e.controls})}function Ji(){(!Ta.isAdBlockPlaying||Ta.isAdBlockPlaying&&Ni.blockEnd)&&(dr.dispatch(_i(!1)),Ta.isAdBlockPlaying=!1)}function eo(){Ui.debug("onDelayStarted"),ki!==va.PAUSED&&(ki=va.IN_PROGRESS)}function to(){Ui.debug("onDelayFinished"),qi()}function no(){Ui.debug("onDelayFinished"),qi()}function ro(){Ui.debug("onAdFinished - isAdBlockPlaying: ".concat(Ta.isAdBlockPlaying," - blockEnd: ").concat(Ni.blockEnd)),li(),Ji(),"video"!==Ni.type||Ta.isAdBlockPlaying||(Fi||Le.send({message:"".concat(Yi,"roll finished"),data:{category:"Ad",item:"".concat(Yi,"roll"),action:"finished"}}),Ui.debug("onAdFinished - currentRule.type: ".concat(Ni.type," - isAdBlockPlaying: ").concat(Ta.isAdBlockPlaying)),Yi===ha.POST?Xi():$i({contentPlaying:!0,controls:!0})),qi()}function ao(){Ui.debug("disposeLogics"),Qi(),Ta.isAdBlockPlaying=!1,Yi=ha.PRE,Ki=-1,ci(),Ni&&(Ji(),$i({contentPlaying:void 0,controls:void 0}),Ni=void 0),ga.reset(),Si.destroy(),Ui.debug("dispose done")}function io(e){var t=e!==Fi;if(Ui.debug("setAdFree",{currentAdFreeStatus:Fi,newAdFreeStatus:e}),t){if(Fi=e)return zi(),void ao();Vi?(Ki=0,Yi=ha.MID,qi()):fo()}}function oo(){Ui.debug("onAdStarted - isAdBlockPlaying: ".concat(Ta.isAdBlockPlaying," - blockStart: ").concat(Ni.blockStart)),dr.dispatch(_i(!0)),ki!==va.PAUSED&&(ki=va.IN_PROGRESS),"video"===Ni.type?(Ta.isAdBlockPlaying||(Fi||Le.send({message:"".concat(Yi,"roll started"),data:{category:"Ad",item:"".concat(Yi,"roll"),action:"started"}}),S(E,Ar.AD_EVENT,{type:Ar.types.VIDEO_STARTED,contentPlaying:!1,controls:!1})),(Ni.blockStart||void 0===Ni.blockStart&&!Ta.isAdBlockPlaying)&&Ni.blockStart&&(Ui.debug("set isAdBlockPlaying"),Ta.isAdBlockPlaying=!0)):"overlay"===Ni.type&&Le.send({message:"Overlay ad displayed",data:{category:"Ad",item:"overlay ad",action:"displayed"}})}function so(){Ui.debug("handleAdError"),li(),Ji(),$i({contentPlaying:!0,controls:!0}),qi()}function uo(e){Ui.debug("onAdvertUpdate",e),e.revShare&&function(e){Ui.debug("revShare modul received");var t=e.ads&&e.ads.mid?e.ads.mid:void 0,n=Zi&&(ki===va.IN_PROGRESS||ki===va.PAUSED),r=Vi&&!Fi&&t;n?Ui.error("revShare ad is still running"):r&&(Zi=!0,Ki=-1,Si.addRevShareRules(t),qi())}(e.revShare),e.disableAds&&io(!0),e.init&&io(!1)}function co(e){Object.keys(e).forEach((function(t){Object.prototype.hasOwnProperty.call(Ta,t)&&Ta[t]===e[t]||(Ta[t]=e[t],Ui.debug("update - key: ".concat(t," - value: ").concat(Ta[t])))}))}function lo(){if(wi)return wi.hasBenefit&&wi.hasSettings}function fo(){var e=Mi||he.adFree,t=document.referrer.indexOf("/dashboard")>-1&&he.loggedIn&&(he.isOnUstream||he.isIbmBranded),n=Ri.areAdsEnabled(Ci);if(Ui.debug("startPlayingAds",{integrationSettings:wi,isCurrentPageDashboard:t,isPremiumMemberFromSession:Mi,isAdFreeFromParams:e,paramsAdFree:he.adFree,enabledFromCookie:n,adfree:Fi}),!Vi)if(e||Fi||!lo()||!n||t)Fi?(zi(),ao()):io(!0);else if(Si.hasAds()&&Si.getData())go().then(qi);else{var r=new Promise((function(e,t){var n=[se.id(),se.app(),Ci,se.isHid()?se.ids()[1]:null,R.Z.locale,ue.Z,"web"];Ui.debug("getRuleset - getAdverts called with params: ",he),function(e,t,n,r){var a;Qr((function(e,t,n,r){var a="http://"+V.Z.config.cdngwPlain,i="https://"+V.Z.config.cdngwSecure,s=e[0],d=e[1],u=e[2],c=e[3],l=e[4],f=e[5],m=e[6],g=o().ssl?i:a,p={brandId:1,mediaId:s,mediaType:d,countryCode:u,locale:l,pageUrl:encodeURIComponent(f)};c&&(p.highlightId=c,p.mediaType="recorded"),m&&(p.device=m);var v=[g,"/rgwjson/Viewer.getAdverts/",encodeURIComponent(JSON.stringify(p))].join(""),h=document.createElement("script");window.jsonpCallback=function(e){t(e),document.body.removeChild(h),delete window.jsonpCallback},h.setAttribute("src","".concat(v,"?jsoncallback=jsonpCallback")),document.body.appendChild(h)}),e,(a=t,function(e){qr(a,e)}),n,r)}(n,e,t,5e3)})).then(mo);Promise.all([r,go()]).then(qi).catch((function(e){Ui.error("ruleset loading failed",e),Ui.debug("handleFailedRulesetLoad"),io(!0)}))}}function mo(e){Ui.debug("handleSuccessfulRulesetLoad",e);var t="".concat(se.app(),"_").concat(se.id());return e&&e.success?e.ads?(Ui.debug("ruleset for media loaded successfully"),Si.setData(e.ads,t),Promise.resolve()):Promise.reject(new Error("no ads found in ruleset")):(Ui.debug("ruleset response was not valid",e),Promise.reject(new Error("ruleset response not valid")))}function go(){var e=document.querySelector("#ViewerContainer video"),t=document.getElementById("AdHolder");return si(t,e).then((function(){Vi=!0})).catch((function(e){"SDK load failed"===e.message?io(!0):(Ui.error("Following error happened while initializing google IMA provider",e),so())}))}function po(e){Ui.debug("privacy cookie changed to",e),io(!Ri.areAdsEnabled(Ci))}function vo(e){co({contentVolume:e})}function ho(){Wi||(Wi=!0,fo())}function Eo(){!Fi&&Vi&&Si.hasPostroll()?(Ui.debug("playPostroll",{adfree:Fi,started:Vi,hasPostRoll:Si.hasPostroll()}),Yi=ha.POST,Ki=-1,qi()):Xi()}var yo={initialize:function(e){Ui.debug("initialize"),ji||(I(y,T.ADVERT_UPDATE,uo),I(E,Ar.AD_ERROR,so),I(E,Ar.AD_FINISHED,ro),I(E,Ar.AD_STARTED,oo),I(E,Ar.DELAY_STARTED,eo),I(E,Ar.DELAY_FINISHED,to),I(E,Ar.DELAY_ERROR,no),I(E,Ar.PLAY_POSTROLL,Eo),Hi=e.width,Gi=e.height,Ta.currentPos=ha.PRE,Ta.channelId=se.getOwnerChannelId(),Ta.npa=he.isOnIbm||he.isOnUstream||"unknown"===ue.Z,se.isVid()&&(Ta.videoId=se.id()),dr.subscribe("privacy.ibmCookie",po),dr.subscribe("player.volume",vo),dr.subscribe("playback.position",ho),ji=!0),e.countryCode&&(Ci=e.countryCode,Ui.debug("countryCode updated",Ci)),e.adIntegration&&(wi=e.adIntegration,Ui.debug("adIntegration updated",wi))},startPlayingAds:fo,destroy:function(){Ui.debug("destroy"),Wi=!1,xi=!1,Bi=!1,Vi=!1,ki=va.DEFAULT,ao()},update:co,resize:function(e,t){Fi||Hi===e&&Gi===t||(Hi=e,Gi=t,ki===va.IN_PROGRESS?Hi<300||Gi<180?(ki=va.PAUSED,ro(),zi(),Qi()):ui():ki===va.PAUSED&&qi())},isPrerollDone:function(){return xi},isAdfree:function(){return Fi},isStarted:function(){return Vi},isAdInProgress:function(){return ki===va.IN_PROGRESS},isInitialized:function(){return ji},getType:function(){return Ni?Ni.type:void 0},setPremiumMember:function(){Ui.debug("setPremiumMember",{settings:lo()});var e=lo();Mi=!0,e||void 0===e||io(!0)},playPostroll:Eo},bo=n(7684),To=n.n(bo);function So(){var e,t=Array.prototype.shift.call(arguments);return arguments.length<2?t.sort():(e=Array.prototype.slice.call(arguments),t.sort((function(t,n){for(var r=e.slice(),a=r.shift();t[a]===n[a]&&r.length;)a=r.shift();return t[a]===n[a]?0:t[a]>n[a]?1:-1})))}var Io,Lo,Ao=n(5098),Oo=n(7104),Po={},Do={},Ro=(0,s.w)("atlas/logic/stats/aggregator");function _o(){var e;if((0,Oo.Z)(Po)){for(e in Po)Po[e].common&&Po[e].common.bufempty.length&&(Po[e].common.bufempty=Po[e].common.bufempty.pop().value),S(b,T.SEND_REPORT,{mid:e,send:{cmd:"stats",data:[Po[e]]}});Po={}}}function Co(){var e,t,n;if((0,Oo.Z)(Do)){for(e in Do){if(Do[e].benchmark&&Do[e].benchmark.bwrpt&&Do[e].benchmark.bwrpt.length)for(t=So(t=Do[e].benchmark.bwrpt,"url"),n=0;n<t.length-1;++n)t[n].url===t[n+1].url&&(t[n].size+=t[n+1].size,t[n].time+=t[n+1].time,t.splice(n+1,1),n--);S(b,T.SEND_REPORT,{mid:e.split("_").join("."),send:{cmd:"stats",data:[Do[e]]}})}Do={}}}function wo(){Po={},Do={},clearInterval(Io),clearInterval(Lo),Io=window.setInterval(_o,1e3),Lo=window.setInterval(Co,5e3)}var No={init:function(){Ro.debug("init"),wo()},feed:function(e,t){Ro.debug("aggregator feed",{mid:e,data:t}),t.common&&void 0!==t.common.bufempty&&(Po[e]=Po[e]?Po[e]:{common:{bufempty:[]}},t.common.strurl&&(Po[e].common.strurl=t.common.strurl,delete t.common.strurl),Po[e].common.bufempty.push({value:t.common.bufempty,time:(new Date).getTime()}),delete t.common.bufempty,(0,Oo.Z)(t.common)||delete t.common),(0,Oo.Z)(t)&&(Do[e]?(0,Ao.Z)(t,Do[e]):Do[e]=t)},feedImmediate:function(e,t){S(b,T.SEND_REPORT,{mid:e,send:{cmd:"stats",data:[t]}})},reset:wo},Uo=n(7560),Mo=n(4563),ko=n(5590),Fo=n(6987);function Vo(e){return function(e){if(Array.isArray(e))return xo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||jo(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jo(e,t){if(e){if("string"==typeof e)return xo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xo(e,t):void 0}}function xo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Bo,Zo,Ho,Go,Yo,Ko,Wo,zo,Qo,qo,Xo=3e5,$o="ecdnPreferredLocation",Jo=0,es={pingPath:"/ping",pingThreads:6,pingRounds:1,pingTimeout:400,addRndParam:!0,locationPriority:[]},ts={},ns={},rs={},as=0,is=de.ZP.get($o)||[],os=!0,ss=(0,s.w)("atlas/logic/sdcdnHandler"),ds=(0,s.w)("atlas/logic/sdcdnHandler"),us=dr.getState().provider.forcedUrl,cs=ko.Z.isString(us)?us:null;function ls(e){var t=e&&e.result&&e.result.time>-1;ss.debug("Ping result",e),t&&((!Qo||Qo.time>e.result.time)&&(Qo=e.result),!Zo&&ts[Wo]&&(Zo=!0,ss.debug("Send first result"),ps([e.result],Wo))),qo.onStat({type:"overlay",data:{pingResult:e}})}function fs(e){var t;as=(new Date).getTime(),rs[Wo]=e,ss.debug("Pings finished",{duration:as-Yo,data:rs[Wo]}),ps(rs[Wo],Wo),Go=Wo,Wo=!1,ns[t=Go]&&(!rs[t]&&ns[t]||!rs[t].some((function(e){return vs(e.url)}))&&ns[t].data.some((function(e){return e.useBestSite})))?function(){var e=Jo?1e3:0;e=Math.min(Xo,e*Math.pow(2,Jo-1))+Math.floor(5e3*Math.random()),ss.debug("Retry ecdn pings in "+Math.round(e/1e3)+"sec"),clearTimeout(Bo),Bo=setTimeout((function(){Jo+=1,ys()}),e)}():Jo=0,qo.onStat({type:"report",data:as-Yo})}function ms(e){ds.debug(e.line,e.data)}function gs(e){ds.error("SDCDN lib error:",e)}function ps(e,t){if(ts[t]&&e)if(cs)!function(e,t){ss.debug("Send forced providers",{mid:t,results:cs});var n=e.find((function(e){return e.url===cs}));if(n){var r=[{url:n.url,location:n.location}];ts[t].providers=r,qo.onComplete(t,{stream:ts[t]}),qo.onStat({type:"overlay",data:{finalResult:rs[t],fallback:"not available",location:"not available",preferredLocation:is,forcedProvider:cs,cdnConfig:ns[Go]}})}}(e,t);else{var n=e,r=function(e){var t=hs(e);if(!t)return!0;var n=function(e){var t=[];return e.forEach((function(e){e.data.forEach((function(n){Object.prototype.hasOwnProperty.call(n,"cdnFallbackEnabled")&&t.push({location:n.location,cdnFallbackEnabled:n.cdnFallbackEnabled,group:e.name})}))})),t}(t);if(!n.length)return!0;if(ko.Z.isArray(is)&&is.length){var r=n.filter((function(e){return is.indexOf(e.group+"/"+e.location)>-1}));if(r.length)return r[0].cdnFallbackEnabled}return n.some((function(e){return e.cdnFallbackEnabled}))}(t),a=Qo&&Qo.location;ss.debug("use cdn fallback: "+r),a&&function(e){if(is&&ko.Z.isArray(is)){var t=is.indexOf(e);t>-1&&is.splice(t,1),is.unshift(e),is=is.slice(0,5)}else is=[e];de.ZP.set($o,is)}(a),r||(n=e.filter((function(e){return e.location===a}))),n=function(e){var t,n,r=(t=e.reduce((function(e,t){return function(e){var t=e.location||"";return/^fallback\//i.test(t)}(t)?e[1].push(t):e[0].push(t),e}),[[],[]]),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(t,n)||jo(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[0],i=r[1];return[].concat(Vo(a),Vo(i))}(n),ts[t].providers=(0,Mo.Z)(n),ss.debug("Send results",{mid:t,results:ts[t].providers}),qo.onComplete(t,{stream:ts[t]}),qo.onStat({type:"overlay",data:{finalResult:n,fallback:r,location:a,preferredLocation:is,forcedProvider:cs,cdnConfig:ns[Go]}}),clearTimeout(Ko),Ko=setTimeout(Es,Xo)}}function vs(e){var t,n,r=decodeURIComponent(e).toLowerCase();for(t in ns)if(Object.prototype.hasOwnProperty.call(ns,t))return(n=ns[t].data,n.filter((function(e){return e.useBestSite})).reduce((function(e,t){var n=t.data.reduce((function(e,t){return e.concat(t.sites)}),[]);return e.concat(n)}),[])).some((function(e){var t=e.host.toLowerCase();return r.indexOf(t)>-1||t.indexOf(r)>-1}));return!1}function hs(e){var t;return ns[e]&&(t=ns[e].data.filter((function(e){return e.useBestSite})).map((function(e){return(0,Mo.Z)(e)}))),t&&t.length?t:null}function Es(e){var t=e||Go;(new Date).getTime()-as>=Xo&&ts[t]&&ns[t]&&!Wo&&(Ko=clearTimeout(Ko),is&&(es.locationPriority=is),(-1===t.indexOf("recorded")||t.indexOf("recorded")>-1&&!rs[t])&&(Yo=(new Date).getTime(),Wo=t,Uo.Z.test(ns[t],es)))}function ys(){Wo||(as=0,ss.debug("Force tests"),Es())}function bs(e){ss.debug("force provider ",e||"off"),cs=cs===e?null:e,ps(rs[Go],Go)}qo={update:function(e,t){e!==Go&&(as=0);var n=(0,Mo.Z)(t);n.stream&&n.stream.version&&(ss.debug("Stream module received"),dr.dispatch({type:It.setStreamModuleReceivedDate,payload:{ts:Date.now()}}),os&&(lr.reportStreamModuleReceived(),os=!1),n.stream.contentAvailable?(ts[e]=(0,Mo.Z)(n.stream),ts[e].mid=e,delete n.stream):(Ko=clearTimeout(Ko),Wo&&Uo.Z.test(),zo=null,Wo=!1,as=0,rs={},ts={},Zo=!1,cs=null,os=!0),ps(rs[e],e)),n.cdnConfig&&(Ho||(Uo.Z.on(Uo.Z.events.PING_RESULT,ls),Uo.Z.on(Uo.Z.events.FINISHED,fs),Uo.Z.on(Uo.Z.events.ERROR,gs),Uo.Z.on(Uo.Z.events.LOG,ms),Ho=!0),Go=Go||e,as=0,ns[e]=(0,Mo.Z)(n.cdnConfig),ns[e].mid=e,ss.debug("CDN config received"),delete n.cdnConfig),(0,Fo.Z)(n)||qo.onComplete(e,n),function(e){return e&&e.streamFormats&&(e.streamFormats.mp4||e.streamFormats.flv)&&!(e.streamFormats.hasOwnProperty("flv/segmented")||e.streamFormats.hasOwnProperty("mp4/segmented")||e.streamFormats.hasOwnProperty("hls/improved"))}(ts[e])?(ss.debug("Mp4 or Flv movie, cdn tests skipped!"),qo.onComplete(e,{stream:ts[e]})):Es(e)},onStat:function(){},onComplete:function(){},onProviderChange:function(e){ss.debug("Provider changed");var t=e&&Object.prototype.hasOwnProperty.call(e,"to")&&!vs(e.to),n=zo&&vs(zo)||!zo&&hs(Go);t&&n&&ys(),zo=e.to},onProviderFailure:function(e){ss.debug("Provider failure",e),(e&&Object.prototype.hasOwnProperty.call(e,"url")&&vs(e.url)||hs(Go))&&ys()},isEcdnProvider:vs,getEcdnConfig:hs,forceProvider:bs},dr.subscribe("provider.forcedUrl",bs);var Ts,Ss,Is=qo,Ls=n(1648),As=(0,s.w)("providers"),Os=-1;function Ps(e){var t=Ts.length;Ts&&t&&e>=0&&e<t?Ss=Ts[Os=e]:(Os=-1,Ss=null)}function Ds(e){var t=function(e){for(var t=Ts.length,n=-1,r=0;r<t;r+=1)if(e===Ts[r].name){n=r;break}return n}(e);Ps(t=Math.max(0,t))}var Rs,_s,Cs,ws=function(e){e.name||(e.name=e.url),Ts.push(e)},Ns=function(){return Ps((Os+1)%Ts.length),Ss},Us=function(e){return e?Ds(e):-1===Os?Ps(0):Ds(Ss.name),dr.dispatch((0,Ls.DJ)(Ss)),As.info("selected provider: ",Ss),Ss},Ms=function(){Ts=[]},ks=function(){return Ss},Fs=(0,s.w)("atlas/logic/stats/collector"),Vs={LOGIC_INITIATED:"lid",UMS_CONNECTED:"ucd",FIRST_MODULE_INFO:"fmi",KEYFRAME_AFTER_PLAY:"kfap",SEEK_COMPLETE:"kfas",JUMP_COMPLETE:"kfaj",BANDWIDTH_REPORT:"bwrpt",DROPPED_FRAMES:"dpfs",UMS_COMMAND_PLAYING:"playing",UMS_COMMAND_SEEK:"seek"},js={},xs=-1,Bs=!1,Zs=!1;function Hs(e){var t=e.send.duration,n=[Math.round(e.send.from*t),Math.round(e.send.to*t)];-1!==xs&&clearTimeout(xs),xs=setTimeout((function(){!function(e,t){xs=-1,S(b,T.SEND_REPORT,{mid:e,send:{cmd:Vs.UMS_COMMAND_SEEK,data:t}})}(e.mid,n)}),1e3)}function Gs(){void 0!==_s&&(Cs=_s,_s=void 0,Ys({playing:!0}))}function Ys(e){var t,n,r=e.playing,a=e.reason,i=void 0===a?"":a,o=(n=Cs,dr.getState().playback.audioTracks.find((function(e){return e.id===n}))),s=(0,j.Z)(o,"language");s&&(t={language:s,country:(0,j.Z)(o,"country","00")}),S(b,T.SEND_REPORT,{mid:Rs,send:{cmd:Vs.UMS_COMMAND_PLAYING,data:[Rs.split(".")[1],r,{reason:i,multiaudio:t}]}})}function Ks(e){Rs=e.mid,Bs?Ys({mid:e.mid,reason:e.reason,playing:e.playing}):Zs=!0}function Ws(e){js[e]={},js[e].start=Date.now(),js[e].success=-1,js[e].firstModule=-1}function zs(e){Rs=e,-1===js[e].success&&(js[e].success=Date.now(),No.feed(e,{benchmark:{ucd:js[e].success-js[e].start}})),function(e){No.feed(e,{branchName:he.branchName})}(e)}function Qs(e){-1===js[e.mid].success&&(js[e.mid].start=-1,js[e.mid].firstModule=-1)}function qs(e){-1!==js[e.mid].success&&-1===js[e.mid].firstModule&&(js[e.mid].firstModule=Date.now(),No.feed(e.mid,{benchmark:{fmi:js[e.mid].firstModule-js[e.mid].success}}))}function Xs(e){var t=Is.isEcdnProvider(e.url);No.feed(Rs,{benchmark:{bwrpt:[{time:e.time,size:e.size,url:e.url,ecdn:t}]}})}function $s(e){No.feed(Rs,{common:{bufempty:e}})}function Js(){$s(!0)}function ed(){$s(!1)}function td(e){var t={type:e.error,details:e.details?e.details:{}},n=Rs.split(".");"channel"===n[0]?t.details.cid=n[1]:t.details.vid=n[1],No.feed(Rs,{error:[t]})}function nd(e){Fs.debug("adResponse",e),No.feed(Rs,{benchmark:{adr:e}})}function rd(e){No.feed(Rs,{benchmark:{ecdnt:e}})}function ad(){var e=Us();if(e&&e.location&&e.url){var t,n=function(e){var t=e.match(/(.+?)\/.+/);if(t)return t[1]}(e.location),r=e.providerHost||(t=e.url,new URL(t).host);No.feed(Rs,{common:{cdnProviderType:n,cdnProviderHostname:r}})}}function id(){js={},Rs=null,No.reset(),_s=void 0,Cs=void 0,Bs=!1,Zs=!1}function od(){se.isHLS()&&(Bs=!0,Zs&&(Zs=!1,Ys({playing:!0})))}function sd(){se.isHLS()||(Bs=!0,Zs&&(Zs=!1,Ys({playing:!0})))}dr.subscribe("playback.selectedAudio",(function(e){void 0===Cs?Cs=e:_s=e}));var dd=function(){Fs.debug("init"),No.init(),id(),I(b,T.PLAYING,Ks),I(b,T.SEEK,Hs),I(b,T.UMS_CONNECT_START,Ws),I(b,T.UMS_CONNECTED,zs),I(b,T.UMS_REJECT,Qs),I(b,T.MODULE_INFO,qs),I(b,T.REPORT_BANDWIDTH,Xs),I(b,T.REPORT_BUFFER_EMPTY,Js),I(b,T.REPORT_BUFFER_FULL,ed),I(b,T.REPORT_ERROR,td),I(b,T.REPORT_AD_RESPONDED,nd),I(E,T.PROVIDER_CHANGE,ad),I(E,T.AUDIO_TRACKS,od),I(E,T.PLAY_OPTIONS,sd),I(b,T.REPORT_AUDIO_CHANGED,Gs),I(b,T.REPORT_ECDN_TESTS,rd)},ud={},cd={},ld=(0,s.w)("atlas/logic/stats/reporter");function fd(e){var t;cd[e.mid]?(t=To()(e.mid))?(ld.debug("report to ums",{cmd:e.send.cmd,data:e.send.data}),t.send(e.send.cmd,e.send.data)):ld.warn("umsInstance not available!",{report:e}):(ld.debug("cache data",{mid:e.mid,data:e.send}),ud[e.mid]=ud[e.mid]?ud[e.mid]:[],ud[e.mid].push(e))}function md(e){if(cd[e]=!0,ud[e]){for(;ud[e].length;)fd(ud[e].shift());delete ud[e]}}var gd,pd=function(){ld.debug("init"),dd(),I(b,T.SEND_REPORT,fd),I(b,T.UMS_CONNECTED,md)},vd=function(){return dr.dispatch({type:$e})},hd=function(e){var t=e.type,n=e.data;return{type:Je,payload:{type:t,data:n}}},Ed=!1,yd=!1,bd=-1,Td=(0,s.w)("atlas/logic/offiarContentHandler"),Sd={},Id={},Ld=!0,Ad=!1,Od=!1;function Pd(){return Sd&&Sd.videos&&Sd.videos.length}function Dd(){return Sd&&Sd.pictures&&Sd.pictures.length}function Rd(){Td.debug("Stop offair content"),yd&&(yd=!1,S(E,T.DESTROY_SLIDESHOW),bd>-1&&Pd()&&S(E,T.DESTROY_OFFAIR_VIDEO,Sd.videos[bd])),bd=-1}function _d(){Pd()&&yd&&(0!==(bd+=1)&&S(E,T.DESTROY_OFFAIR_VIDEO,Sd.videos[bd-1]),Td.debug("Next offair video",{next:Sd.videos[bd]}),S(E,T.CREATE_OFFAIR_VIDEO,Sd.videos[bd]))}function Cd(){Td.debug("Start offair content"),yd||(Ld=!1),yd=!0,Dd()?S(E,T.CREATE_SLIDESHOW,Sd.pictures):Pd()?-1===bd&&(Td.debug("Init offair vids",{videos:Sd.videos}),_d()):(Rd(),Md())}function wd(){yd&&Rd(),Cd()}function Nd(){return Dd()||Pd()}function Ud(){C().setContentAvailable(!0),dr.dispatch(hd({type:""}))}function Md(){C().setContentAvailable(!1),dr.dispatch((0,tr.y5)(tr.w_.offairScreen)),dr.dispatch(hd({type:"offair"}))}function kd(){if(Ad&&Od){var e=Pd()&&!Ld&&!yd;gd||Nd()&&!e?gd?(yd&&Rd(),Ud()):function(){if(void 0===Sd)return!1;var e,t,n=(e=Sd,t=Id,!(JSON.stringify(e)===JSON.stringify(t)));return(!yd||n)&&Nd()}()&&(Ud(),wd()):Md()}}function Fd(e){Ad=!0,(gd=e)&&(Ld=!1),kd()}function Vd(e){var t;Od=!0,void 0!==e.offairContent&&(t=e.offairContent,Id=Ld?t:Sd,Sd=t),kd()}var jd,xd=function(){Ed||(Ed=!0,I(E,T.LIVE,Fd),I(E,T.NEXT_OFFAIR_VIDEO,_d),I(y,T.META_UPDATE,Vd))},Bd=function(){Rd(),gd=void 0,Ad=!1,Od=!1,Ld=!0,Sd={},Id={},Ud()},Zd=function(){return!yd||yd&&Pd()&&bd===Sd.videos.length-1},Hd=function(){var e=bd+1;return e>-1&&Sd.videos&&e<Sd.videos.length},Gd=n(130);function Yd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kd(e){var t=e.hasExternalVtt,n=e.vtt;if(t){var r=n.map((function(e){var t,n,r=(n=3,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return Yd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yd(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[0],i=r[1],o=r[2];return new VTTCue(a,i,o)}));dr.dispatch((0,Gd._r)(r))}else dr.dispatch((0,Gd._r)([]))}var Wd=function(){jd||(jd=!0,dr.subscribe("externalVtt",Kd))},zd=(0,s.w)("contentAvailabilityChecker"),Qd=!1,qd=!1,Xd=!1,$d=!1,Jd=!1;function eu(){return qd&&Xd&&$d}function tu(){zd.debug("runCheck",{isPrerollDone:Qd,isAllInformationAvailableForContent:eu(),contentAvailableEventSent:Jd}),Jd||eu()&&(Xn.send("contentAvailable",!0),S(E,T.CONTENT_AVAILABLE),Jd=!0)}function nu(){Qd=!1,qd=!1,Xd=!1,$d=!1,Jd=!1}var ru=function(){zd.debug("init"),nu()},au=function(){zd.debug("reset"),nu()},iu=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];zd.debug("setHasLiveStatus",e);var t=Xd;Xd=e,!t&&Xd&&tu()},ou=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];zd.debug("setHasMeta",e);var t=$d;$d=e,!t&&$d&&tu()},su=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];zd.debug("setHasPlayBackData",e);var t=qd;qd=e,!t&&qd&&tu()},du=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];zd.debug("setPreRollDone",e);var t=Qd;Qd=e,!t&&Qd&&tu()},uu=function(e){return dr.dispatch({type:Re,payload:{videoTag:e}})},cu=n(9932),lu=(0,s.w)("lockManager"),fu=["reject","ipLock","geoLock","hashLock","passwordLock","referrerLock","sessionAuthLock","viewerHourLimitLock","nonexistent"];var mu=n(9294),gu=function(e){return[function(e){return ko.Z.isObject(e)},function(e){var t=e.size;return ko.Z.isNumber(t)&&t>0},function(e){var t=e.time;return ko.Z.isNumber(t)&&t>25},function(e){var t=e.url;return ko.Z.isString(t)},function(e){var t=e.url;return!/\.m4[va]h$/.test(t)},function(e){var t=e.url;return!/\.vtt$/.test(t)}].every((function(t){return t(e)}))},pu=function(e){return(0,j.Z)(e,"performance.responseStart")&&(0,j.Z)(e,"performance.responseEnd")&&(0,j.Z)(e,"performance.startTime")};function vu(e){if(pu(e)){var t=e.performance;return{waitingTime:t.responseStart-t.startTime,loadingTime:t.responseEnd-t.responseStart}}return{waitingTime:0,loadingTime:e.time}}function hu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Eu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Eu(Object(n),!0).forEach((function(t){bu(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Eu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Tu(e){return function(e){return e.map((function(e){var t=e.language;if("string"!=typeof t)return e;var n=t.match(/(\w+)(?:-(\w+))?/);if(!n)return e;var r,a,i=(a=3,function(e){if(Array.isArray(e))return e}(r=n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(r,a)||function(e,t){if(e){if("string"==typeof e)return hu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hu(e,t):void 0}}(r,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=i[1],s=i[2],d=void 0===s?"00":s;return yu(yu({},e),{},{language:o,country:d})}))}(function(e){return e.map((function(e,t){var n=parseInt(e.id,10);return yu(yu({},e),{},{id:n||0===n?n:t})}))}(e))}var Su,Iu,Lu,Au,Ou,Pu,Du,Ru=o().ios&&"10"===o().ios[0],_u=(0,s.w)("playbackhandler"),Cu=Math.random()<=.05,wu=["m4vh","m4ah","flv"],Nu=!1,Uu=!1,Mu={},ku=0,Fu=[],Vu={playing:!1,pauseTime:0,data:null},ju="",xu=!1,Bu=!1,Zu=!0,Hu=!0,Gu="default",Yu=!0,Ku=-2;function Wu(){Uc("".concat(3," segment not found error")),S(b,T.PLAYING,{mid:se.getMid(),playing:!1}),Mc()}function zu(){Iu=clearTimeout(Iu)}function Qu(e){_u.info("handleMultipleAtlasDownloadError"),Su?(function(){_u.debug("handle multiple atlas download error by getting updated stream module");var e,t=ku?1e3:0;e=t=Math.min(16e3,t*Math.pow(2,ku-1)),zu(),Iu=setTimeout(Wu,e),ku+=1}(),Su=!1):(_u.debug("handle multiple atlas download error by changing provider"),S(h,T.CHANGE_PROVIDER),Su=!0),S(E,T.ATLAS_DOWNLOAD_ERROR,e)}function qu(){kc(),C().showPlayScreen(),Vt().removeListener(Vt().events.ATLAS_FULLY_INITIALIZED,qu)}function Xu(){var e;_u.debug("initializeAtlas"),Vt().initialized||(Vt().initialize("ViewerContainer"),Vt().addListener(Vt().events.BANDWIDTH,Ic),Vt().addListener(Vt().events.BUFFER_EMPTY,Lc),Vt().addListener(Vt().events.BUFFER_FULL,Ac),Vt().addListener(Vt().events.ERROR,Oc),Vt().addListener(Vt().events.POSITION,Dc),Vt().addListener(Vt().events.LOG,Pc),Vt().addListener(Vt().events.FINISHED,gc),Vt().addListener(Vt().events.METADATA,mc),Vt().addListener(Vt().events.THROTTLE,ac),Vt().addListener(Vt().events.AUDIO_TRACKS,ic),Vt().addListener(Vt().events.TEXT_TRACKS,oc),Vt().addListener(Vt().events.TEXT_TRACK_CUE_CHANGE,sc),Vt().addListener(Vt().events.X08_DETECTED,dc),Vt().addListener(Vt().events.WEBKIT_SUPPORTS_FULLSCREEN,uc),Vt().addListener(Vt().events.WEBKIT_ENTER_FULLSCREEN,lc),Vt().addListener(Vt().events.WEBKIT_END_FULLSCREEN,fc),Vt().addListener(Vt().events.STORED,_c),Vt().addListener(Vt().events.BUFFERED,Cc),Vt().addListener(Vt().events.ATLAS_FULLY_INITIALIZED,ec),Vt().addListener(Vt().events.QUALITY_CHANGE_STARTED,pc),Vt().addListener(Vt().events.QUALITY_CHANGE_COMPLETED,vc),Vt().addListener(Vt().events.QUALITY_CHANGE_CANCELLED,hc),Vt().addListener(Vt().events.LANGUAGE_CHANGE_STARTED,Ec),Vt().addListener(Vt().events.LANGUAGE_CHANGE_COMPLETED,yc),Vt().addListener(Vt().events.LANGUAGE_CHANGE_CANCELLED,bc),Vt().addListener(Vt().events.SEEK_STARTED,$u),Vt().addListener(Vt().events.SEEK_COMPLETED,Ju),e={},Lr&&!1!==he.playsinline&&!Ru&&(e["webkit-playsinline"]=!0,e.playsinline=!0),"native"===he.controls&&(e.controls="true"),0===he.volume&&(e.defaultMuted=!0),dr.getState().content.is360Video&&o().ios&&(e.crossOrigin="anonymous"),Vt().setOption(Vt().optionNames.VIDEO_TAG_ATTRIBUTES,e),Vt().setOption(Vt().optionNames.RENDER_TEXT_TRACKS_NATIVELY,!!o().ios),Vt().setOption(Vt().optionNames.HIDE_NATIVE_TRACKS,!!o().ios),Vt().setOption(Vt().optionNames.FLASH_PROXY_URL_PLAIN,"http://".concat(V.Z.config.cdn1)),Vt().setOption(Vt().optionNames.FLASH_PROXY_URL_SECURE,"https://".concat(V.Z.config.staticSecure)),_u.debug("Atlas is initialized"))}function $u(e){var t=e.from,n=e.to,r=e.initiator;Xn.send("seekStarted",{from:se.getRelativeSeekPositionInMs(1e3*t)/1e3,to:se.getRelativeSeekPositionInMs(1e3*n)/1e3,initiator:r}),Le.send({message:"Seek started",data:{category:"Playback",item:"playback",action:"started"}})}function Ju(){Xn.send("seekCompleted",!0),Le.send({message:"Seek completed",data:{category:"Playback",item:"playback",action:"completed"}})}function ec(){Uu=!0,S(E,"onAtlasSeekable")}function tc(){Nc("nextoffair")}function nc(e){return e.split(".").pop()}function rc(e){Vu.data=Object.assign({},e,{isLive:!se.isVid()&&!se.isOffairVid(),lastStreamModuleReceived:dr.getState().playback.lastStreamModuleReceived}),Vu.data.debug=he.showHiddenContextMenuItems,(Lu&&Object.prototype.hasOwnProperty.call(Vu.data,"format")&&Lu!==Vu.data.format||e.format===D&&ju&&function(e){if(e===ju)return!1;if(!e)return!0;var t=new URL(ju),n=new URL(e);return t.searchParams.get("sourceChannel")!==n.searchParams.get("sourceChannel")}(e.url)||Du&&Vu.data.sourceMedia!==Du)&&Nc("Format changed");var t=(0,j.Z)(Vu,"data.representations",[]).map((function(e){return e.contentType})),n=function(e){return e.includes("video/mp4")},r=n(Fu)&&!n(t),a=!n(Fu)&&n(t);if(r||a){if(!Vu.data.isLive&&Vu.position>=0){var i=se.getRelativeSeekPositionInMs(Vu.position);se.saveSeek({positionInMs:i,initiator:_._.SYSTEM})}Nc("Toggle video track")}Fu=t,Lu=Vu.data.format,Du=Vu.data.sourceMedia,ju=e.url,Vt().initialized||Xu();var o=dr.getState().player.volume;Vt().setVolume(o/100),Vu.playing&&wc(Vu.data),su()}function ac(e){var t="throttle"===e.state;S(E,T.ATLAS_THROTTLE,t)}function ic(e){if(se.isHLS()){var t=Tu(e.data);if(dr.dispatch((0,Pr.KS)(t)),Yu){var n=dr.getState().playback.selectedAudio,r=he.defaultLang||he.defaultlang,a=(0,mu.Z)(t,r);if(-1!==n)Vt().selectAudio(n);else if(a)dr.dispatch((0,Pr.Ft)(a.id));else{var i=t.find((function(e){return e.enabled}));i&&dr.dispatch((0,Pr.Ft)(i.id))}Yu=!1}else{var o=t.find((function(e){return e.enabled}));o&&dr.dispatch((0,Pr.Ft)(o.id))}S(E,T.AUDIO_TRACKS,t)}}function oc(e){if(se.isHLS()&&!he.externalvtt){var t=Tu(e.data);dr.dispatch((0,Pr.kY)(t))}}function sc(e){var t=e.data.activeCues;dr.dispatch((0,Gd._r)(t))}function dc(){he.externalvtt||dr.dispatch((0,Pr.kY)([{id:1,label:"ui.closedCaption",shouldTranslate:!0}]))}function uc(e){var t;dr.dispatch((t=e.data,{type:It.setWebkitSupportsFullscreen,payload:{supports:t}}))}function cc(){var e=Vt().getVideoTag();if(e){var t=!e.paused;Vu.playing!==t&&(Vu.playing=t,S(E,T.PLAYING,t))}}function lc(){cc()}function fc(){cc()}function mc(e){S(E,T.ATLAS_METADATA,e)}function gc(){xu&&se.isCid()&&!1===se.isOffairVid()?Sc():(S(E,T.VIDEO_FINISHED),Xn.send("finished",!0))}function pc(){Bu||(Bu=!0,S(E,T.ATLAS_QUALITY_CHANGE_STARTED))}function vc(){Bu&&(Bu=!1,S(E,T.ATLAS_QUALITY_CHANGE_COMPLETED))}function hc(){Bu&&(Bu=!1,S(E,T.ATLAS_QUALITY_CHANGE_CANCELLED))}function Ec(e){e.activeStreamId.includes("text")||C().setAudioLoading(!0)}function yc(e){e.activeStreamId.includes("text")||(S(b,T.REPORT_AUDIO_CHANGED),C().setAudioLoading(!1))}function bc(e){e.activeStreamId.includes("text")||C().setAudioLoading(!1)}function Tc(){xu&&Pu===Vu.position&&(_u.debug("check end of stream"),Sc()),Pu=Vu.position}function Sc(){_u.debug("end of stream"),Ou=clearInterval(Ou),Nc("End of stream"),Mu={},S(E,T.LIVE,!1)}function Ic(e){var t=nc(e.url);Object.prototype.hasOwnProperty.call(Mu,t)&&(Mu[t]=0),ku=0,zu(),function(e){if(Cu||he.chunkReporting){var t=nc(e.url);if(!wu.includes(t)){var n=vu(e),r=n.waitingTime,a=n.loadingTime;Le.send({message:"Chunk download",data:{category:"Chunk",item:"download",action:"success",start_loading:Date.now()-e.time,chunk_size:e.size,chunk_type:t,waiting_time:r,loading_time:a}})}}}(e),S(b,T.REPORT_BANDWIDTH,e)}function Lc(){dr.dispatch((0,Pr.Bt)(!0)),!0!==xu&&!1===(se.isVid()&&Vu.position>Vu.data.contentLength-200)&&S(b,T.REPORT_BUFFER_EMPTY)}function Ac(){dr.dispatch((0,Pr.Bt)(!1)),S(b,T.REPORT_BUFFER_FULL)}function Oc(e){if(S(E,T.ATLAS_ERROR,e),!e.recoverable)return _u.debug("handleAtlasUnrecoverableError"),S(E,T.ATLAS_CLEANUP,"Unrecoverable atlas error"),Uu=!1,Mu={},zu(),Yu=!0,void(Au=setTimeout(xc,750));switch(e.error){case Vt().errors.SEGMENT_NOT_FOUND:case Vt().errors.SEGMENT_LOAD_FAILED:S(b,T.REPORT_ERROR,e),function(e){if(_u.debug("handleAtlasDownloadError"),e.status>=500||0===e.status)!function(e){var t=e.url,n=ks(),r=(0,j.Z)(n,"url");_u.info("serverError",{currentProvider:r,url:t}),r&&!t.includes(r)||S(h,T.CHANGE_PROVIDER)}(e);else if(xu&&!1===se.isOffairVid())Ou||(_u.debug("start end of stream interval"),Ou=setInterval(Tc,1e3));else if(!Iu){var t=nc(e.url);Object.prototype.hasOwnProperty.call(Mu,t)||(Mu[t]=0),Mu[t]+=1,Mu[t]>=3&&Qu(e)}}(e.details);break;case Vt().errors.PLAY_ERROR:"NotAllowedError"===(t=e.details).error.name&&(Uu?qu():Vt().addListener(Vt().events.ATLAS_FULLY_INITIALIZED,qu),Xn.send("error",{name:"autoplayRejected",message:t.error.message}),Rc());break;default:S(b,T.REPORT_ERROR,e)}var t}function Pc(e){s.Z.log(Object.assign({},e,{source:"atlas/".concat(e.source)})),S(E,T.ATLAS_LOG,e)}function Dc(e){var t=se.isHLS()?se.getTrimmedDurationInMillisec():se.getDurationInMillisec();if(t=t||0,e.position>0){var n=function(){if(!se.hasSavedSeek())return null;var e=se.getSavedSeek(),t=e.positionInMs,n=e.initiator;return{positionInMs:se.getAbsoluteSeekPositionInMs(t),initiator:n}}();Vt().initialized&&Uu&&n?(Vt().seek(n.positionInMs,n.initiator),se.resetSavedSeek()):C().showViewerContainer()}if(e.position>=0){var r=t?e.position/t:0;Vu.position=e.position,S(E,T.PROGRESS,r)}Hu&&Rc(),S(E,T.ATLAS_PROGRESS,{position:e.position,sourceMedia:(0,j.Z)(Vu,"data.sourceMedia")})}function Rc(){lr.reportFirstTimeUpdate(),R.Z.isDashboard||R.Z.align||function(e){var t,n=dr.getState().ums.hash;if(!e||!n||!e.watchedUrl)return null;try{t=JSON.parse(n)}catch(e){return lu.error("Parsing hash data failed",n),null}var r=(0,j.Z)(t.find((function(e){return e.hash})),"hash",null),a=function(e,t){return decodeURIComponent(e).replace("@@channelId@@",se.id()).replace("@@contentType@@",se.isCid()?"channel":"recorded").replace("@@contentId@@",se.id()).replace("@@hash@@",t)}(e.watchedUrl,r);fetch(a).then((function(e){return e.json()})).then((function(e){return lu.info("WatchedUrl successfully called",e)})).catch((function(e){return lu.warn(e.message)}))}(R.Z.hashLockData),Hu=!1}function _c(e){S(E,T.ATLAS_STORED_UPDATE,e)}function Cc(e){S(E,T.ATLAS_BUFFERED_UPDATE,e)}function wc(e){Zu&&(lr.reportFirstPlayCall(),Zu=!1),Vu.data&&Object.prototype.hasOwnProperty.call(Vu.data,"format")&&Vu.data.format===A&&C().showViewerContainer(),Vt().play(e)}function Nc(e){_u.debug("atlasReset"),Vt().initialized&&(Vt().removeListener(Vt().events.BANDWIDTH,Ic),Vt().removeListener(Vt().events.BUFFER_EMPTY,Lc),Vt().removeListener(Vt().events.BUFFER_FULL,Ac),Vt().removeListener(Vt().events.ERROR,Oc),Vt().removeListener(Vt().events.POSITION,Dc),Vt().removeListener(Vt().events.FINISHED,gc),Vt().removeListener(Vt().events.METADATA,mc),Vt().removeListener(Vt().events.STORED,_c),Vt().removeListener(Vt().events.BUFFERED,Cc),Vt().removeListener(Vt().events.THROTTLE,ac),Vt().removeListener(Vt().events.AUDIO_TRACKS,ic),Vt().removeListener(Vt().events.TEXT_TRACKS,oc),Vt().removeListener(Vt().events.TEXT_TRACK_CUE_CHANGE,sc),Vt().removeListener(Vt().events.X08_DETECTED,dc),Vt().removeListener(Vt().events.WEBKIT_SUPPORTS_FULLSCREEN,uc),Vt().removeListener(Vt().events.WEBKIT_ENTER_FULLSCREEN,lc),Vt().removeListener(Vt().events.WEBKIT_END_FULLSCREEN,fc),Vt().removeListener(Vt().events.QUALITY_CHANGE_STARTED,pc),Vt().removeListener(Vt().events.QUALITY_CHANGE_COMPLETED,vc),Vt().removeListener(Vt().events.QUALITY_CHANGE_CANCELLED,hc),Vt().removeListener(Vt().events.ATLAS_FULLY_INITIALIZED,ec),Vt().removeListener(Vt().events.LANGUAGE_CHANGE_STARTED,Ec),Vt().removeListener(Vt().events.LANGUAGE_CHANGE_COMPLETED,yc),Vt().removeListener(Vt().events.LANGUAGE_CHANGE_CANCELLED,bc),Vt().removeListener(Vt().events.SEEK_STARTED,$u),Vt().removeListener(Vt().events.SEEK_COMPLETED,Ju),Vt().removeListener(Vt().events.ATLAS_FULLY_INITIALIZED,qu),Vt().cleanup(),Uu=!1,S(E,T.ATLAS_CLEANUP,e||"unknown reason"),lr.cleanup(),lr.setInitStart()),Mu={},ku=0,Ku=-2,Yu=!0,zu()}function Uc(e){_u.debug("reset"),Nc(e),Vu={playing:!1,pauseTime:0,position:0},se.resetSavedSeek(),ku=0,Hu=!0,Zu=!0,lr.setInitStart(),Au=clearTimeout(Au),Du=void 0,Fu=[]}function Mc(){_u.debug("playbackhandler.onPlay()",{playback:Vu});var e=!1;if(Vt().initialized||Xu(),Vu.playing){var t=Date.now();Vt().resume(),_u.debug("resume"),Vu.pauseTime>0&&t-Vu.pauseTime>100&&!se.isVid()&&!se.isOffairVid()?(_u.debug("resume.time: ".concat(t," - diff: ").concat(t-Vu.pauseTime)),Vt().seek(Vu.position+(t-Vu.pauseTime)),Vu.pauseTime=0):e=!0}Vu.playing&&!e||!Vu.data||(Vu.playing=!0,wc(Vu.data),Hu||Vt().resume(),Vt().getVideoTag()&&uu(Vt().getVideoTag())),Vu.playing||(Vu.playing=!0),S(E,T.PLAYING,!0)}function kc(){_u.debug("playbackhandler.onPause()"),Vt().initialized&&(Vu.pauseTime=Date.now(),_u.debug("pause.time",Vu.pauseTime),Iu&&(Mu={},ku=0,zu()),Vt().pause(),Vu.playing=!1,S(E,T.PLAYING,!1))}function Fc(e){var t=e.position,n=e.initiator,r=Vt().getVideoTag(),a=1e3*t;Vt().initialized&&Uu&&(!se.isHLS()||null!=r&&r.seekable.length)?Vt().seek(a,n):se.saveSeek({positionInMs:se.getRelativeSeekPositionInMs(a),initiator:n})}function Vc(){if(Vt().initialized){var e=dr.getState().playback,t=e.selectedClosedCaption,n=e.closedCaptionVisible;Vt().toggleCaptions({trackId:t>-1?t:Ku,isVisible:n}),Vt().setCaptionPosition(Gu),Ku=t}}function jc(e){Gu=e,Vt().initialized&&Vt().setCaptionPosition(e)}function xc(){Vu.playing&&Vu.data&&rc(Vu.data)}_u.debug("atlas",Vt()),dr.subscribe("playback.selectedAudio",(function(e){Vt().initialized&&Vt().selectAudio(e)})),dr.subscribe("playback.selectedClosedCaption",Vc),dr.subscribe("playback.closedCaptionVisible",Vc),dr.subscribe("playback.hashes",(function(e){Vt().initialized&&Vt().setHash(e)})),dr.subscribe("player.volume",(function(e){var t=e/100;Vt().initialized&&Vt().setVolume(t)})),dr.subscribe("player.speed",(function(e){Vt().initialized&&Vt().setPlaybackSpeed(e)}));var Bc={init:function(){Su=!0,Nu?(_u.debug("reinit"),Uc("Atlas init")):(_u.debug("init"),Nu=!0,I(E,T.PLAY_OPTIONS,rc),I(E,T.CONTENT_CUT_UPDATE,(function(){se.getCutStart()&&!Lr&&C().hideViewerContainer()})),I(E,T.NEXT_OFFAIR_VIDEO,tc),I(E,T.LIVE,(function(e){Vu.pauseTime=0,Vu.data=null,xu=!e,!0===e&&(Ou=clearInterval(Ou),Nc("Status changed"))})),I(E,T.OFFLINE_MODULE_RECEIVED,(function(){_u.debug("offline module received",{playing:Vu.playing}),xu=!0,Vu.playing||Sc()})),I(h,T.PLAY,Mc),I(h,T.PAUSE,kc),I(h,T.SEEK,Fc),I(h,T.SET_CAPTION_POSITION,jc))},reset:Uc},Zc=(0,s.w)("atlas/logic/getstream"),Hc={},Gc={SUCCESS:"mte_getstream_success",ERROR:"mte_getstream_error"},Yc=1e3,Kc=1e4,Wc=2e3,zc=null,Qc=0,qc=0,Xc=0,$c=0,Jc=!1;function el(e){var t=e.target;switch(t.readyState){case XMLHttpRequest.HEADERS_RECEIVED:!function(e){switch(Zc.debug("UHLS polling - status ",e.status),e.status){case 202:Zc.debug("UHLS polling - retry in 2 seconds"),e.abort(),rl(),Xc=setTimeout((function(){return nl(e.streamUrl)}),Wc),Jc=!1;break;case 204:Jc?(Zc.debug("UHLS polling - going offline"),(0,f.Z)(Hc,Gc.ERROR,204),Jc=!1):(Zc.debug("UHLS polling - retry in 10 seconds"),e.abort(),rl(),$c=setTimeout((function(){return nl(e.streamUrl)}),Kc),Jc=!0);break;case 404:(0,f.Z)(Hc,Gc.ERROR,404),rl(),Qc=0,clearTimeout(qc),clearTimeout(Xc),clearTimeout($c),qc=0,Xc=0,$c=0,Jc=!1}}(t);break;case XMLHttpRequest.DONE:!function(e){switch(e.status){case 200:Zc.info("Master playlist downloaded",{url:e.responseURL,content:e.responseText}),Qc=1,(0,f.Z)(Hc,Gc.SUCCESS,e.streamUrl),rl(),Jc=!1}}(t)}}function tl(e){var t=e.target;if(Qc>6)(0,f.Z)(Hc,Gc.ERROR,408);else{Qc+=1;var n=Math.pow(2,Qc);Zc.debug("UHLS timeout. Retrying in ".concat(n," secs")),rl(),qc=setTimeout((function(){return nl(t.streamUrl)}),n*Yc)}}function nl(e){Zc.debug("load",e),e?zc&&void 0!==zc.readyState?Zc.debug("current request already sent, abort first"):((zc=new XMLHttpRequest).streamUrl=e,zc.timeout=5e3,zc.onreadystatechange=el,zc.ontimeout=tl,zc.onerror=tl,e&&o().playstation&&(e=e.replace("/iphone/","/sony/")),zc.open("GET",e,!0),zc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),zc.send()):Zc.debug("no url")}function rl(){zc=null}var al,il,ol={event:Gc,load:nl,abort:function(){Zc.debug("abort"),clearTimeout(qc),clearTimeout(Xc),clearTimeout($c),zc&&zc.abort&&zc.abort(),rl()},on:function(e,t){Hc[e]||(Hc[e]=[]),Hc[e].push(t)},setPollingInterval:function(e){Wc=e},setRetryTimeout:function(e){Yc=e},setOfflineTimeout:function(e){Kc=e},setRetryCount:function(e){Qc=e}},sl=[],dl=(0,s.w)("lib/hlsChecker");function ul(e){ol.load(e)}ol.on(ol.event.SUCCESS,(function(){al(il)})),ol.on(ol.event.ERROR,(function(e){dl.debug("hls check error:",e),il.streams.length>0&&(sl.push(il.streams.shift()),ul(il.streams[0].initUrl))}));var cl=function(e,t,n){var r,a;t=t||{},n.forEach((function(n){n.hasOwnProperty("name")&&(r=n.name,a=n.hasOwnProperty("updatedName")?n.updatedName:n.name,t[a]=e.hasOwnProperty(a)?e[a]:e[r])}))},ll=[{name:"name"},{name:"url"},{name:"varnishUrl"},{name:"seek"}],fl=[{name:"width"},{name:"height"},{name:"videoCodec",updatedName:"codec"},{name:"bitrate"},{name:"description"},{name:"contentType"},{name:"initUrl"},{name:"chunkId"},{name:"streamNameService"},{name:"url",updatedName:"initUrl"},{name:"streamName",updatedName:"segmentUrl"},{name:"chunkTime",updatedName:"segmentLength"}],ml=(0,s.w)("shim/legacy"),gl=function(e){return ml.debug("shim"),function(e){return!!(e&&ko.Z.isArray(e)&&e[0]&&e[0].streams&&ko.Z.isArray(e[0].streams)&&e[0].streams[0])}(e)?(e.providers=function(e){return e.map((function(e){var t={};return cl(e,t,ll),t}))}(e),e.hashes=function(e){var t,n=e[0].streams[0];return n.hasOwnProperty("chunkRange")&&(t=n.chunkRange),t}(e),e.streams=function(e){return e[0].streams.map((function(e){var t={};return cl(e,t,fl),ko.Z.isArray(t.segmentUrl)&&(t.segmentUrl=t.segmentUrl[0]),t}))}(e),e.chunkTime=function(e){var t,n;for(n=0;n<e[0].streams.length;n++)if(e[0].streams[n].hasOwnProperty("chunkTime")){t=e[0].streams[n].chunkTime;break}return t}(e),e.streamType=e.hashes?A:L,e):(ml.warn("cannot validate module structure"),null)},pl=(0,s.w)("shim/mp4segmented"),vl=function(e){return pl.debug("shim"),function(e){return!!(e.hasOwnProperty("providers")&&e.hasOwnProperty("streams")&&e.hasOwnProperty("hashes")&&e.hashes)}(e)?(e.streams=function(e){return e.streams.map((function(t){var n={};return cl(t,n,fl),e.hasOwnProperty("chunkTime")&&(n.segmentLength=e.chunkTime),e.hasOwnProperty("chunkId")&&(n.chunkId=e.chunkId),n}))}(e),e):(pl.warn("cannot validate module structure"),null)},hl=(0,s.w)("shim/flvsegmented"),El=function(e){return hl.debug("shim"),function(e){return!!(e.hasOwnProperty("providers")&&e.hasOwnProperty("streams")&&e.hasOwnProperty("hashes")&&e.hashes)}(e)?(e.hashes=function(e){var t={};return e&&e.hashes&&(ko.Z.isArray(e.hashes)?t=e.hashes[0]:ko.Z.isObject(e.hashes)&&(t=e.hashes)),t}(e),e.streams=function(e){var t;return t=e.streams.map((function(e){var t={};return cl(e,t,fl),ko.Z.isArray(t.segmentUrl)&&(t.segmentUrl=t.segmentUrl[0]),t})),e.hasOwnProperty("keyframe")&&ko.Z.isArray(e.keyframe)?e.keyframe.forEach((function(e,n){t[n]&&(t[n].chunkId=+e.chunkId||0)})):t.forEach((function(e){e.chunkId=e.chunkId||0})),t}(e),e.hasOwnProperty("keyframe")&&delete e.keyframe,e):(hl.warn("cannot validate module structure"),null)},yl=(0,s.w)("shim/hls"),bl=function(e){return yl.debug("shim"),function(e){return!!(e&&ko.Z.isArray(e)&&e[0]&&e[0].name&&e[0].url)}(e)?(e.streamType=D,e.streams=function(e){return e.map((function(e){var t={};return cl(e,t,fl),t}))}(e),e):(yl.warn("cannot validate module structure"),null)},Tl=(0,s.w)("shim/mp4movie"),Sl=function(e){return Tl.debug("shim"),function(e){return!!(e&&ko.Z.isArray(e)&&e[0]&&e[0].streams&&e[0].streams[0].mimetype)}(e)?(e.streamType=O,e.streams=function(e){return e[0].streams.map((function(e){var t={};return cl(e,t,fl),t}))}(e),e):(Tl.warn("cannot validate module structure"),null)},Il=(0,s.w)("shim/simple"),Ll=function(e){return Il.debug("shim"),function(e){return!(!e.hasOwnProperty("providers")||!e.hasOwnProperty("streams"))}(e)?(e.streamType=L,e.streams=function(e){return e.streams.map((function(e){var t={};return cl(e,t,fl),t}))}(e),e):(Il.warn("cannot validate module structure"),null)},Al=(0,s.w)("shim/combined/mp4segmented"),Ol=function(e){return Al.debug("shim"),function(e){var t=(0,j.Z)(e,"streamFormats.mp4/segmented"),n=(0,j.Z)(t,"contentAccess.accessList"),r=e.providers.map((function(e){var t=new URL(e.url),r=(0,j.Z)(n,"0.data.protocol");t.protocol=r;var a=(0,j.Z)(n,"0.data.path"),i="".concat(t.pathname,"/").concat(a,"/").replace(/\/{2,}/g,"/");return t.pathname=i,Object.assign(e,{url:t.toString()})})),a=t.streams.map((function(e){return Object.assign({},e,{segmentLength:t.chunkTime,chunkId:t.chunkId})}));return Object.assign({},t,{streams:a,providers:r,streamType:P,sourceMedia:e.sourceMedia})}(e)},Pl=function(e){var t=(0,j.Z)(e,"streamFormats.mp4/segmented.contentAccess.accessList");return Vt().capabilities.includes(Vt().formats.MP4_SEGMENTED)&&e&&1===e.version&&t&&t.length};function Dl(e){return function(e){if(Array.isArray(e))return Cl(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||_l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _l(e,t){if(e){if("string"==typeof e)return Cl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cl(e,t):void 0}}function Cl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var wl=(0,s.w)("shim/combined/flvsegmented");function Nl(e){var t=(0,tn.Z)(e,["language","country","label","default","audioCodec","segmentUrl","segmentLength","chunkId"]);return Object.assign(t,{contentType:"audio",bitrate:(0,j.Z)(t,"audioCodec.audioBitrate")})}function Ul(e){var t=(0,tn.Z)(e,["offsetInMs","offset","preset","transcoded","videoCodec","segmentUrl","segmentLength","chunkId"]);return Object.assign(t,{contentType:"video",bitrate:(0,j.Z)(t,"videoCodec.videoBitrate"),width:(0,j.Z)(t,"videoCodec.width"),height:(0,j.Z)(t,"videoCodec.height")})}function Ml(e){return{audio:Nl(e),video:Ul(e)}}function kl(e){var t=(0,j.Z)(e,"streamFormats.flv/segmented"),n=t.streams,r=t.chunkTime,a=t.chunkId;if(0===n.length)return[];var i=n.map((function(e){return Object.assign(e,{segmentLength:r,chunkId:a})}));if(function(e){var t=Rl(e,1)[0];return-1===(0,j.Z)(t,"videoCodec.videoBitrate",-1)&&-1===(0,j.Z)(t,"videoCodec.height",-1)}(n))return i.map(Nl);if(function(e){var t=Rl(e,1)[0];return-1===(0,j.Z)(t,"audioCodec.audioBitrate",-1)}(n))return i.map(Ul);var o=function(e){var t=e.map(Ml).reduce((function(e,t){var n,r,a,i=t.audio,o=t.video,s=(n=o,r=(0,j.Z)(n,"videoCodec.height",0),a=(0,j.Z)(n,"videoCodec.videoBitrate",0),"".concat(r,":").concat(a));return e.hasOwnProperty(s)||(e[s]=Object.assign(o,{audioVersions:[],segmentUrl:void 0})),e[s].audioVersions.push(i),e}),{});return Object.values(t)}(i),s=o[0].audioVersions.map((function(e){return Object.assign({},e,{segmentUrl:void 0})}));return[].concat(Dl(o),Dl(s))}var Fl=function(e){return wl.debug("shim"),function(e){var t=function(e){var t=(0,j.Z)(e,"providers",[]),n=(0,j.Z)(e,"streamFormats.flv/segmented.contentAccess"),r=(0,j.Z)(n,"accessList.0.data");if(!r)return t;switch(n.accessMode){case"INSERT":return t.map((function(e){var t=new URL(e.url);return r.protocol&&(t.protocol=r.protocol),r.path&&(t.pathname=r.path),Object.assign({},e,{url:t.toString()})}));default:return t}}(e),n=kl(e),r=(0,j.Z)(e,"streamFormats.flv/segmented");return Object.assign({},r,{streams:n,providers:t,streamType:A,sourceMedia:e.sourceMedia})}(e)},Vl=function(e){var t=(0,j.Z)(e,"streamFormats.flv/segmented.contentAccess.accessList");return-1!==Vt().capabilities.indexOf(Vt().formats.FLV_SEGMENTED)&&e&&1===e.version&&t&&t.length};function jl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jl(Object(n),!0).forEach((function(t){Bl(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Zl=(0,s.w)("shim/combined/hlsimproved");var Hl=function(e){return Zl.debug("shim"),function(e){var t=function(e){var t=(0,j.Z)(e,"providers",[]),n=(0,j.Z)(e,"streamFormats.hls/improved.contentAccess"),r=(0,j.Z)(n,"accessList.0.data");if(!r)return t;switch(n.accessMode){case"APPEND":return t.map((function(e){var t=new URL(e.url).host,n=new URL(r.url);return n.searchParams.set(r.parameter,encodeURIComponent(t)),xl(xl({},e),{},{url:n.toString(),providerHost:t})}));default:return t}}(e),n=function(e,t){var n=(0,j.Z)(e,"streamFormats.hls/improved.contentAccess.accessList.0.data.parameter");return t.map((function(e){return{parameter:n,initUrl:e.url}}))}(e,t);return{providers:t,streams:n,streamType:D}}(e)},Gl=function(e){var t=(0,j.Z)(e,"streamFormats.hls/improved.contentAccess.accessList");return t&&t.length&&e&&1===e.version},Yl=(0,s.w)("shim/combined/mp4movie"),Kl=function(e){return Yl.debug("shim"),e.streamType=O,e.streams=[],function(e){var t=(0,j.Z)(e,"streamFormats.mp4.contentAccess.accessList");return e.streams=t.map((function(e){return{mimetype:"video/mp4",segmentUrl:e.data.url}})),e}(e)},Wl=function(e){var t=(0,j.Z)(e,"streamFormats.mp4.contentAccess.accessList");return e&&1===e.version&&t&&t.length},zl=(0,s.w)("shim/combined/flvmovie"),Ql=function(e){return zl.debug("shim"),e.streamType=L,e.streams=[],function(e){var t,n=(0,j.Z)(e,"streamFormats.flv.contentAccess.accessList");return e.providers=[],t=n.map((function(t){return e.providers.push({name:t.data.provider,seek:{mode:"byte",param:"fs"}}),t.data.url})),e.streams=[{segmentUrl:t}],e}(e)},ql=function(e){var t=(0,j.Z)(e,"streamFormats.flv.contentAccess.accessList");return e&&1===e.version&&t&&t.length},Xl=(0,s.w)("streamshim"),$l=function(e){if(!e)return null;if(e.hasOwnProperty("version")&&1===e.version)Pl(e)?e=Ol(e):Vl(e)?e=Fl(e):Gl(e)?e=Hl(e):Wl(e)?e=Kl(e):ql(e)&&(e=Ql(e));else if(e.hasOwnProperty("streamType"))switch(Xl.debug("shim "+e.streamType+" type"),e.streamType){case P:e=vl(e);break;case A:e=El(e)}else e=ko.Z.isArray(e)?function(e){return!(!(e&&ko.Z.isArray(e)&&e[0]&&e[0].name&&e[0].url)||e[0].providers)}(e)?bl(e):function(e){return!!(e&&ko.Z.isArray(e)&&e[0]&&e[0].streams&&e[0].streams[0].mimetype&&"video/mp4"===e[0].streams[0].mimetype)}(e)?Sl(e):gl(e):Ll(e);return e};function Jl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ef=(0,s.w)("streams"),tf={text:[],audio:[],video:[]};function nf(){var e=tf.audio.reduce((function(e,t){var n,r=t.label||"Default",a=e[r]||[];return e[r]=[].concat(function(e){if(Array.isArray(e))return Jl(e)}(n=a)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return Jl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jl(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t]),e}),{});return Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.reduce((function(e,t){return e.transcoded?e:t}))}))}var rf,af,of,sf,df,uf={store:function(e){var t,n=(t=e.contentType)?t.split("/")[0]:"video";if(tf.hasOwnProperty(n)){var r=Object.assign({id:tf[n].length},e);tf[n].push(r)}else ef.warn("Unknown stream type: ".concat(n))},clear:function(){Object.assign(tf,{text:[],audio:[],video:[]})},getAvailableQualities:function(){return tf.video.filter((function(e){return e.height||e.bitrate}))},getVideoVersions:function(){return tf.video},getAudioVersions:nf,getDefaultAudioVersion:function(){var e=nf(),t=he.defaultLang||he.defaultlang;return(0,mu.Z)(e,t)||e.find((function(e){return!!e.default}))||e[0]},getTextVersions:function(){return tf.text},findOneVideoVersionById:function(e){return tf.video.find((function(t){return t.id===e}))},findOneTextVersionBySourceStream:function(e){return tf.text.find((function(t){return t.sourceStreamVersion===e}))},findOneAudioVersionById:function(e){return nf().find((function(t){return t.id===e}))}},cf=null,lf=null,ff=!1,mf=(0,s.w)("streamparser");function gf(){S(E,T.STREAM_VERSION_UPDATE)}function pf(e){return Object.prototype.hasOwnProperty.call(e,"videoLength")?e.videoLength:se.getDurationInMillisec()}function vf(e){(function(e){of=e.streamType,rf=e.hashes;var t=pf(e);t&&t!==se.getDurationInMillisec()&&se.setDurationInMillisec(t),e.streams=e.streams||[],uf.clear(),e.streams.forEach((function(e){!function(e){Object.prototype.hasOwnProperty.call(e,"chunkId")&&(af=e.chunkId)}(e),uf.store(e)})),Ms(),e.providers&&e.providers.forEach((function(e){ws(e)}))})(e),gf()}function hf(e){if(!se.isSegmentedMP4()&&!se.isFLV()){var t=pf(e),n=e.cut&&ff;lf=e,t&&t!==se.getDurationInMillisec()&&(se.setDurationInMillisec(1e3*t),n=!0),n&&gf()}}function Ef(){lf&&lf.cut&&gf(),ff=!0}function yf(e){var t,n;(function(e){return mf.debug("handleLiveStatus",{module:e,previousLiveStatus:df,liveStatus:sf}),(bf(e)||"offline"===e||bf(e)&&e.hasOwnProperty("version"))&&((sf=!("offline"===e||bf(e)&&!1===e.contentAvailable))!==df&&(mf.debug("handleLiveStatusChange",{previousLiveStatus:df,liveStatus:sf}),!df||sf||se.isHLS()?S(E,T.LIVE,sf):S(E,T.OFFLINE_MODULE_RECEIVED,sf),sf&&se.setDurationInMillisec(0),df=sf,mf.debug("Live status has changed to: ".concat(sf))),"offline"===e||!1===e.contentAvailable)?(se.setStreamType(void 0),!1):(function(e){var t=e.mid;return t&&t.indexOf("recorded")>-1}(e)&&(df=!1,sf=!1,S(E,T.RECORDED_READY)),!0)})(e)&&function(e){return e&&e.streamFormats&&Object.keys(e.streamFormats).length}(e)&&(e=$l(e))&&(e.streamType?(se.setStreamType(e.streamType),cf||Le.send({message:"Streamtype selected",data:{category:"Playback",item:"initial loading",action:"selected"}}),t=e,n=cf,JSON.stringify(t)!==JSON.stringify(n)&&(cf=(0,Mo.Z)(e),function(e,t){var n;al=t,il=e,se.isCid()&&(n=il)&&"hls"===n.streamType&&n.streams&&n.streams.length?(dl.debug("check hls",il),sl=[],ol.abort(),ul(il.streams[0].initUrl)):al(il)}(e,vf))):S(E,T.UNSUPPORTED))}function bf(e){var t=e.mid;return t&&t.indexOf("channel")>-1}var Tf=function(){mf.debug("init"),I(E,T.CONTENT_CUT_UPDATE,Ef),I(y,T.STREAM_UPDATE,yf),I(y,T.META_UPDATE,hf)},Sf=function(){return rf},If=function(){return of},Lf=function(){return cf&&cf.sourceMedia},Af=function(){return af},Of=function(){mf.debug("reset"),af=void 0,rf=null,of=void 0,sf=void 0,df=void 0,ff=!1,lf=null,cf=null,uf.clear(),Ms()};function Pf(e){return(Pf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Df(e,t){var n,r=e.length;for(n=0;n<r&&e[n]!=t;n++);return e.splice(n,1),e}var Rf={emit:function(e,t,n,r){if(r=r||"def",e&&e[t]){var a=[];if("def"===r)for(var i in e[t])a=a.concat(e[t][i]);else a=e[t][r];var o,s=a.length;for(i=0;i<s;i++)o=a[i],"undefined"!==Pf(n)?o.call(null,n):o.call(null)}},on:function(e,t,n,r){r=r||"def",e[t]||(e[t]={},e[t].def=[]),e[t][r]||(e[t][r]=[]),e[t][r].push(n)},off:function(e,t,n,r){if(t&&n&&r)e[t][r]=Df(e[t][r],n);else if(t&&n&&!r)for(var a in e[t])e[t][a]=Df(e[t][a],n);else if(!t||n||r){if(t&&!n&&r)e[t][r]=[];else if(!t&&!n&&r)for(var i in e)e[i][r]=[]}else e[t]={def:[]}}};function _f(e){if(!e.length)return 0;var t=e.reduce((function(e,t){return 0!==t?e+1/t:e}),0);return 0===t?0:e.length/t}function Cf(e){return e.length?e.reduce((function(e,t){return e+t}),0)/e.length:0}var wf,Nf,Uf,Mf,kf,Ff,Vf,jf,xf={harmonicFromList:_f,harmonicFromKey:function(e,t){return e.length?_f(e.map((function(e){return e[t]}))):0},fromList:Cf,fromKey:function(e,t){return e.length?Cf(e.map((function(e){return e[t]}))):0}},Bf=function(e){function t(e){var t=Nf.slice(Nf.length-e);return t.map((function(e){return e.sizeInKiloBit/e.loadingTimeInSec}))}function n(e){return e<=Nf.length}return Nf=[],{getName:function(){return e},addThroughputSample:function(e){if(gu(e)){var t=vu(e),n=t.waitingTime,r=t.loadingTime;Nf.push({sizeInKiloBit:.008*e.size,waitingTimeInSec:n/1e3,loadingTimeInSec:r/1e3}),Nf=Nf.slice(-50),Mf=null,Uf=null,kf=null,wf=Date.now()}},getHarmonicMeanWaitingTime:function(e){if(n(e)){if(null===Mf||e!==Mf.calcLength){var t=Nf.slice(Nf.length-e);Mf={calcLength:e,value:xf.harmonicFromKey(t,"waitingTimeInSec")}}return Mf.value}},getHarmonicMeanThroughput:function(e){if(n(e)){if(null===Uf||e!==Uf.calcLength){var r=t(e);Uf={calcLength:e,value:xf.harmonicFromList(r)}}return Uf.value}},getMeanThroughput:function(e){if(n(e)){if(null===kf||e!==kf.calcLength){var r=t(e);kf={calcLength:e,value:xf.fromList(r)}}return kf.value}},getLastUpdatedTimeStamp:function(){return wf}}},Zf=[],Hf={UPDATE:"update",PROVIDER:"stats"},Gf={},Yf=(0,s.w)("atlas/playback/qos/network"),Kf={getCurrentProviderName:function(){return Ff?Ff.getName():void 0},setCurrentProviderName:function(e){Yf.debug("setCurrentProviderName"),void 0===(Ff=function(e){return Zf.find((function(t){return t.name===e}))}(e))&&(Yf.warn("new provider - create new Provider module with name: "+e),Ff=Bf(e),Zf.push(Ff)),Rf.emit(Gf,Hf.PROVIDER,e)},getHarmonicMeanWaitingTime:function(e){return Ff?Ff.getHarmonicMeanWaitingTime(e):void 0},getHarmonicMeanThroughput:function(e){return Ff?Ff.getHarmonicMeanThroughput(e):void 0},getMeanThroughput:function(e){return Ff?Ff.getMeanThroughput(e):void 0},addThroughputSample:function(e){Ff?(Ff.addThroughputSample(e),Rf.emit(Gf,Hf.UPDATE)):Yf.warn("sample data without provider set")},event:Hf,on:Rf.on.bind(null,Gf)},Wf={},zf={BANDWIDTH_UPDATE:"bandwidthUpdate",QUALITY_SELECTED:"qualitySelected",EMPTY_SELECTION:"emptySelection",STATS:"stats"},Qf=(0,s.w)("qos"),qf=[],Xf=[],$f={waitingTimeInSec:0,playerWidth:0,playerHeight:0,shortMean:void 0,longMean:void 0,chunkLengthInSec:0,forcedId:void 0,currentVersion:null};function Jf(e){var t={};return e.forEach((function(e){Object.prototype.hasOwnProperty.call($f,e)?t[e]=$f[e]:Qf.debug("Warning: dependency does not exist")})),t}function em(e,t){var n=[];return t.forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)&&void 0!==e[t]||n.push(t)})),n}function tm(e,t){var n=(0,Mo.Z)(e),r=Jf(t.getDependencies()),a=t.getLeastWorstFilter();return Rf.emit(Wf,zf.EMPTY_SELECTION,t.NAME),a.call(null,n,r)}function nm(e,t){var n=(0,Mo.Z)(e),r=t.getDependencies(),a=Jf(r),i=t.getFilter(),o=em(a,r);return 0===o.length?n=i.call(null,n,a):Qf.warn("Filter "+t.NAME+"function has the following missing dependencies: ",o),n}function rm(){var e;0!==qf.length&&(e=function(e){var t,n,r=(0,Mo.Z)(e);for(n=0;n<Xf.length;n+=1)if(0===(r=nm(r,t=Xf[n])).length){r=tm(e,t);break}return r}(qf),Vf=jf?function(e){var t=e[0],n=jf.getDependencies(),r=Jf(n),a=jf.getRunner(),i=em(r,n);return 0===i.length?t=a.call(null,e,r):Qf.warn("Select module has the following missing dependencies: ",i),t}(e):e[0],Rf.emit(Wf,zf.QUALITY_SELECTED,Vf))}function am(){$f.shortMean=Kf.getHarmonicMeanThroughput(3),$f.longMean=Kf.getHarmonicMeanThroughput(5),$f.waitingTimeInSec=Kf.getHarmonicMeanWaitingTime(5),Rf.emit(Wf,zf.STATS,{throughput:{shortMean:$f.shortMean,longMean:$f.longMean,waitingTimeInSec:$f.waitingTimeInSec}}),Rf.emit(Wf,zf.BANDWIDTH_UPDATE)}function im(e){Rf.emit(Wf,zf.STATS,{provider:{name:e}})}var om={init:function(){Kf.on(Kf.event.UPDATE,am),Kf.on(Kf.event.PROVIDER,im)},reset:function(){},setStreams:function(e){qf=(0,Mo.Z)(e),rm()},setFilters:function(e){var t=(Xf=e).map((function(e){return e.NAME}));Rf.emit(Wf,zf.STATS,{filters:{names:t}})},setSelectModule:function(e){jf=e},setParameters:function(e){$f=Object.assign($f,e),rm()},setForcedId:function(e){$f.forcedId=e>=0?e:void 0},setQualityPlaying:function(e){$f.currentVersion=e},setCurrentProviderName:function(e){Kf.setCurrentProviderName(e)},getAverageBandwidth:function(e){return Kf.getMeanThroughput(e)},addThroughputSample:function(e){Kf.addThroughputSample(e),rm()},getSelectedQuality:function(){return Vf?Vf.id:void 0},getSelectedStreamVerison:function(){return Vf},event:zf,on:Rf.on.bind(null,Wf),off:Rf.off.bind(null,Wf)},sm=function(){return{NAME:"network",getDependencies:function(){return["longMean","shortMean","waitingTimeInSec","chunkLengthInSec"]},getFilter:function(){return function(e,t){var n=function(e){var t=e.shortMean,n=e.longMean;if(t&&n)return Math.min(n,t)}(t);if(!n||void 0===t.chunkLengthInSec)return e;var r=t.chunkLengthInSec;return e.filter((function(e){return e.bitrate*r/n+t.waitingTimeInSec<.8*r}))}},getLeastWorstFilter:function(){return function(e,t){return 0===e.length?[]:[e.reduce((function(e,t){return t.bitrate<e.bitrate?t:e}))]}}}},dm=function(){function e(e){return e.video.width*e.video.height}return{NAME:"initialScreen",getDependencies:function(){return["playerWidth","playerHeight"]},getFilter:function(){return function(t,n){var r=n.playerWidth,a=n.playerHeight;return t.filter((function(t){return!Object.hasOwnProperty.call(t,"video")||e(t)/(r*a)<.6}))}},getLeastWorstFilter:function(){return function(t){return t.length&&Object.hasOwnProperty.call(t[0],"video")?[t.reduce((function(t,n){return e(n)<e(t)?n:t}))]:t}}}},um=function(){return{NAME:"screen",getDependencies:function(){return["playerWidth","playerHeight"]},getFilter:function(){return function(e,t){var n=t.playerWidth,r=t.playerHeight;return e.filter((function(e){return!Object.hasOwnProperty.call(e,"video")||n>=e.video.width||r>=e.video.height}))}},getLeastWorstFilter:function(){return function(e){return e}}}},cm=function(){return{NAME:"streamVersionId",getDependencies:function(){return["forcedId"]},getFilter:function(){return function(e,t){var n=t.forcedId;return e.filter((function(e){return n===e.id}))}},getLeastWorstFilter:function(){return function(e){return e}}}};function lm(e,t){return t.bitrate-e.bitrate}var fm=function(){return{NAME:"select",getDependencies:function(){return[]},getRunner:function(){return function(e){return e.slice().sort(lm)[0]}}}};function mm(e){if(e){var t=["segmentId","hashId"];return e.replace(/%/g,(function(){return"#".concat(t.shift(),"#")}))}}var gm=function(e,t){switch(t){case"mp4/segmented":return function(e){return{contentType:e.contentType,codecs:e.codec,initUrl:mm(e.initUrl),segmentUrl:mm(e.segmentUrl),segmentLength:e.segmentLength,label:e.label,language:e.language,country:e.country}}(e);case"flv/segmented":return function(e){return{contentType:"video/flv",codecs:"",segmentUrl:mm(e.segmentUrl),segmentLength:e.segmentLength,label:e.label,language:e.language,country:e.country}}(e);case"hls":case"mp4":case"flv/movie":return function(e){var t={segmentUrl:e.segmentUrl};return e.streamNameService&&(t.streamNameService=e.streamNameService),t}(e);default:return null}},pm=function(e){return{contentType:e.contentType,segmentUrl:mm(e.segmentUrl),country:e.country,default:e.default,language:e.language,label:e.label,sourceStreamVersion:e.sourceStreamVersion,segmentLength:e.segmentLength}};function vm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vm(Object(n),!0).forEach((function(t){Em(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vm(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Em(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ym(e,t){return"".concat(e,"://").concat(V.Z.config.tcdn,"/").concat(t,"/?protocol=http&version=1")}var bm,Tm=function(e){var t=function(e){switch(e.format){case"hls":return function(e){return{url:e.provider.url||e.videoVersion.initUrl,hlsSdcdnHostParameterName:e.hlsSdcdnHostParameterName}}(e);case"mp4":return function(e){return{url:e.videoVersion.segmentUrl}}(e);case"flv":return function(e){return{url:e.videoVersion.segmentUrl[0],seekParameter:"fs"}}(e);case"flv/segmented":return function(e){var t={contentStart:0,segmentId:e.chunkId,hashes:e.hashes,baseUrl:e.provider.url};if("uhs_tcdn"===e.provider.name){var n=e.ssl?"https":"http";t.streamNameService=ym(n,e.mediaId)}var r,a=e.videoVersion,i=e.audioVersion;if(a)if(i){var o=a.audioVersions.find((function(e){return e.label===i.label})).segmentUrl,s=(0,tn.Z)(a,["segmentLength"]),d=(0,tn.Z)(i,["label","language","country"]),u=hm(hm({segmentUrl:o},s),d);r=gm(u,e.format)}else r=gm(a,e.format);else r=gm(i,e.format);return t.representations=[r],t}(e);default:return function(e){var t={contentStart:0,segmentId:e.chunkId,hashes:e.hashes,baseUrl:e.provider.url,sourceMedia:e.sourceMedia};if("uhs_tcdn"===e.provider.name){var n=e.ssl?"https":"http";t.streamNameService=ym(n,e.mediaId)}t.representations=[];var r=e.videoVersion;if(r){var a=gm(r,e.format);t.representations.push(a)}var i=e.audioVersion;if(i){var o=gm(i,e.format);t.representations.push(o)}var s=e.textVersion;if(s){var d=pm(s);t.representations.push(d)}return t}(e)}}(e),n=function(e){var t={format:e.format};return e.contentLength&&(t.contentLength=e.isHLS?e.trimmedLength:e.contentLength),t}(e);return Object.assign(t,n)},Sm=!1,Im=(0,s.w)("atlas/playback/tcdnurlresolver"),Lm=bm={isInProgress:function(){return Sm},resolve:function(e,t,n){Im.debug("resolving: "+e+" - "+n);var r=new XMLHttpRequest,a=window.setTimeout(r.ontimeout,5e3);function i(n,r){Sm=!1,t&&t({status:n,url:e,resolved:r})}r.ontimeout=function(){window.clearTimeout(a),Im.error("timeout: "+e+" - ",n),i(bm.status.TIMEOUT,this.responseText)},r.onreadystatechange=function(){4===this.readyState&&(window.clearTimeout(a),200===this.status?this.responseText&&this.responseText.length?(Im.info("resolved: "+e+" - ",this.responseText),i(bm.status.SUCCESS,this.responseText)):(Im.warn("resolve failed (empty response): "+e+" - ",this.responseText),i(bm.status.ERROR,this.responseText)):(Im.error("resolve failed (status error): "+e+" - ",this.responseText),i(bm.status.ERROR,this.responseText)))},Sm=!0,r.open("GET",n,!0),r.send(null)},status:{SUCCESS:"success",ERROR:"error",TIMEOUT:"timeout"}};function Am(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Om,Pm,Dm,Rm=null,_m=null;function Cm(){var e=Rm.url||Rm.baseUrl;if(function(e){var t,n,r=e.url||e.baseUrl,a=e.format===D,i=_m.format===D;if(a&&i&&Pm){var o=(t=[_m.url,e.url].map((function(e){try{return new URL(e).searchParams}catch(e){return new URLSearchParams}})).map((function(e){return e.get(Pm)})),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return Am(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Am(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=o[0],d=o[1];return s&&d&&s!==d}return r!==Dm}(Rm)){var t={from:Dm,to:e};Is.onProviderChange(t),S(E,T.PROVIDER_CHANGE,t)}Dm=e}function wm(){var e,t;Cm(),e=(0,j.Z)(Rm,"representations.0.segmentLength"),S(E,T.CHUNK_LENGTH,e),t={format:Rm.format,url:Rm.baseUrl||Rm.url},dr.dispatch((0,tr.Ab)(t)),S(E,T.PLAY_OPTIONS,Rm)}function Nm(e){Rm.hasOwnProperty("representation")?Rm.baseUrl=e:Rm.url=e}function Um(e){e.status===Lm.status.SUCCESS&&e.resolved?(Om[e.url]=e.resolved,Nm(e.resolved),delete Rm.streamNameService,wm()):S(h,T.CHANGE_PROVIDER)}var Mm,km,Fm,Vm,jm,xm,Bm,Zm=function(e){var t,n,r;Pm=e.hlsSdcdnHostParameterName,t=Rm=(0,Mo.Z)(e),n=_m,JSON.stringify(t)!==JSON.stringify(n)&&(_m=(0,Mo.Z)(Rm),Object.prototype.hasOwnProperty.call(Rm,"streamNameService")?Om[Rm.streamNameService]?(Nm(Rm,Om[Rm.streamNameService]),delete Rm.streamNameService,wm()):(r=Rm.url||Rm.baseUrl,Lm.isInProgress()||Lm.resolve(r,Um,Rm.streamNameService)):wm())},Hm=function(){Rm=null,_m=null};function Gm(){km=(new Date).getTime()}function Ym(){if(void 0===jm)return km=void 0,void(Fm=0);if(void 0!==km){var e=(new Date).getTime();Fm+=e-km}km=void 0}function Km(){Vm=Mm?"bandwidth update":"quality change",jm=(new Date).getTime(),km=km?(new Date).getTime():void 0,qm("started",void 0,{from_kbps:Bm.bitrate,from_height:Bm.height})}function Wm(){var e=(new Date).getTime()-jm;if(void 0!==km){var t=(new Date).getTime();Fm+=t-km,km=t}jm=void 0,qm("completed",e,{to_kbps:xm.bitrate,to_height:xm.height}),Fm=0}function zm(){if(void 0!==km){var e=(new Date).getTime();Fm+=e-km}jm=void 0,qm("cancelled",(new Date).getTime()-jm),Fm=0}function Qm(){Xm()}function qm(e,t,n){var r={message:Vm,data:Object.assign({},n,{category:"Playback",item:"quality change",action:e})};void 0!==t&&(r.data.time_spent=t,void 0!==km&&Ym(),r.data.buffer_spent=Fm),Le.send(r)}function Xm(){km=void 0,Fm=void 0,jm=void 0,Bm=void 0,xm=void 0}var $m,Jm,eg,tg,ng,rg=function(){Xm(),I(b,T.REPORT_BUFFER_EMPTY,Gm),I(b,T.REPORT_BUFFER_FULL,Ym),I(E,T.ATLAS_CLEANUP,Qm),I(E,T.ATLAS_QUALITY_CHANGE_STARTED,Km),I(E,T.ATLAS_QUALITY_CHANGE_COMPLETED,Wm),I(E,T.ATLAS_QUALITY_CHANGE_CANCELLED,zm)},ag=function(){Xm()},ig=function(e){Mm=e},og=function(e,t){Bm=e,xm=t},sg=n(3478),dg=10,ug=3,cg=(0,s.w)("atlas/playback/qosHandler"),lg=null,fg=null,mg=!0,gg=!1,pg=1,vg=!1,hg=null,Eg=!1;function yg(){var e=dr.getState().playback,t=e.selectedAudio;return e.audioTracks.find((function(e){return e.id===t}))}function bg(e){return e.filter((function(e){return e&&Object.hasOwnProperty.call(e,"bitrate")})).reduce((function(e,t){return e+t.bitrate}),0)}function Tg(){Eg||(yg()||fg?((0,j.Z)(lg,"id")!==(0,j.Z)(fg,"id")&&(og(lg||fg,fg),lg=fg),function(){var e={};fg&&(e.width=fg.width,e.height=fg.height,e.videoCodec=fg.codec);var t=yg();t&&t.codec&&(e.audioCodec=t.codec),dr.dispatch((0,Pr.h3)(e))}(),function(){var e,t,n,r=dr.getState(),a={format:If(),hashes:Sf(),chunkId:Af(),audioVersion:yg(),videoVersion:(0,Ae.Mr)(r)?null:fg,textVersion:(e=dr.getState().playback,t=e.selectedClosedCaption,n=e.closedCaptionTracks.find((function(e){return e.id===t})),n?(hg=n,n):hg),provider:Us(),contentLength:se.getDurationInMillisec(),trimmedLength:se.getTrimmedDurationInMillisec(),isHLS:se.isHLS(),hlsSdcdnHostParameterName:fg&&fg.parameter,mediaId:se.id(),sourceMedia:Lf(),ssl:o().ssl},i=Tm(a);if(se.isHLS())try{var s=new URL(i.url);(0,Ae.Mr)(r)?s.searchParams.set("audioOnly",!0):s.searchParams.delete("audioOnly"),i.url=s.toString()}catch(e){}Zm(i)}()):cg.warn("No quality selected"))}function Sg(){var e=(0,Ae.hz)(dr.getState()),t=e.width,n=e.height;om.setParameters({playerWidth:t,playerHeight:n})}function Ig(e){var t,n=uf.getVideoVersions();if(!(["high","med","low"].indexOf(e)>=0&&n&&n.length))return parseInt(e,10);switch(e.toLowerCase()){case"high":t=n[0].id;break;case"med":t=n[Math.round((n.length-1)/2)].id;break;case"low":t=n[n.length-1].id}return t}function Lg(){var e=[sm(),um()];cg.debug("setRuningFilterFunction"),om.setFilters(e),om.setSelectModule(fm())}function Ag(){var e=[cm()];cg.debug("setForcedIdFilterFunctions"),om.setFilters(e),om.setSelectModule(fm())}function Og(){$m=clearTimeout($m),Jm&&(Dg(Jm),Jm=null)}function Pg(e){if(e){var t,n,r,a="qos setSelectedVideoVersion id: "+e.id;e&&(a+=" width: "+e.width,a+=" height: "+e.height),cg.debug(a),fg=e,(0!==(t=uf.getAvailableQualities().map((function(e){var t=function(e){var t=20*Math.round(e.height/20);return{text:"".concat(t,"p"),suffix:t>=720?" HD":"",bitrate:function(e){if(e>=1e3){var t=e/1e3,n=Math.round(10*t)/10;return" @ ".concat(n," Mbps")}return" @ ".concat(e," kbps")}(e.bitrate)}}(e),n=fg&&fg.id===e.id&&!mg;return Object.assign({},e,{label:t,active:!0,selected:n})}))).length||se.isHLS())&&(t=function(e){return e.push({id:-1,label:{text:"ui.qualityAuto"},height:0,active:!0,selected:mg||se.isHLS()}),e}(t),C().setQuality(t),Xn.send("quality",t)),_g(),n=yg(),r=bg([fg,n]),dr.dispatch((0,sg.N)({bitrate:r,sourceStreamVersion:fg.sourceStreamVersion})),gg||Tg(),$m=setTimeout(Og,1e3)}else cg.debug("setSelectedVideoVersion No selected version or same")}function Dg(e){e?$m?Jm=e:Pg(e):cg.debug("setSelectedVideoVersion No selected version")}function Rg(e){ig(mg=-1===e)}function _g(){se.isHLS()||se.isFLV()||he.externalvtt||dr.dispatch((0,Pr.kY)(uf.getTextVersions()))}function Cg(){Eg=!0,dr.dispatch(function(e){return{type:It.setHash,payload:e}}(Sf())),function(){if(!se.isHLS()){var e=uf.getAudioVersions();dr.dispatch((0,Pr.KS)(e))}}();var e=yg();e||(e=uf.getDefaultAudioVersion())&&dr.dispatch((0,Pr.Ft)(e.id)),Eg=!1;var t=uf.getVideoVersions();t.length>0&&!e&&!se.isHLS()&&dr.dispatch((0,tr.Sc)(!0));var n,r=0===t.length&&!!e;if(dr.dispatch((0,tr.zp)(r)),r)return _g(),void Tg();if(0!==t.length){fg&&t.some((function(e){return e.initUrl===fg.initUrl&&e.segmentUrl===fg.segmentUrl}))||(lg=null,fg=null,Jm=null,Og(),eg=void 0,pg=1);var a,i,o=(n=e,t.map((function(e,t){var r,a,i,o,s,d,u,c,l=(a=n,i=(r=e)&&r.description||a&&a.description,o=r&&r.sourceStreamVersion||a&&a.sourceStreamVersion,s=r&&r.id,d=a&&a.id,u="number"==typeof s?s:d,c={description:i,sourceStreamVersion:o,bitrate:bg([r,a]),id:u},a&&(c.audio=a),r&&(c.video=r),c);return Object.assign({id:t},l)})));o.length&&(vg||(Rg(i=(i=Ig(ng))>=0?i:Ig(tg)),i>=0?(om.setForcedId(i),a=[cm()]):a=[dm()],cg.debug("setInitialFilterFunctions"),om.setFilters(a),vg=!0),om.setStreams(o))}}function wg(e){e||Ns(),Tg()}function Ng(e){om.setCurrentProviderName(e.to)}function Ug(e){om.setParameters({chunkLengthInSec:e/1e3})}function Mg(e){var t=parseInt(e,10);om.setForcedId(t),Rg(t),mg?Lg():Ag(),Og(),Pg(uf.findOneVideoVersionById(t)),cg.debug("onQualityChange change quality to: "+t)}function kg(e,t){var n=!1;return e&&t?(e.height>t.height&&(n=!0),n):n}function Fg(e){var t=e.video;if(t){var n,r,a,i,o,s=eg&&t.id===eg.id;!mg||(o=dr.getState(),(0,j.Z)(o,"provider.currentProvider.isMulticastProvider",!1))||se.isHLS()?Dg(fg||t):fg?(i=pg=s?pg+1:1,n=(a=eg=t)&&kg(a,fg)&&i>=dg,r=function(e,t,n){return e&&kg(t,e)&&n>=ug}(eg,fg,pg),Dg(n||r?t:fg)):Dg(t)}}function Vg(e){if(vg||se.isHLS()){var t=e.video;t&&Dg(t),om.off(om.event.QUALITY_SELECTED),om.on(om.event.QUALITY_SELECTED,Fg),Ig(ng)>=0?Ag():(om.setForcedId(void 0),mg=!0,Lg())}}function jg(){S(E,T.BANDWIDTH_UPDATED)}function xg(e){dr.dispatch((0,sg.N)(e))}function Bg(){gg=!0,dg=10,ug=3,pg=1,cg.debug("onAtlasQualityChangeStarted change to quality started: "+fg.id)}function Zg(){gg=!1,om.setQualityPlaying(fg),cg.debug("onAtlasQualityChangeCompleted change to quality completed: "+fg.id)}function Hg(){gg=!1}function Gg(e){om.addThroughputSample(e)}function Yg(){Kg()}function Kg(){Eg=!1,lg=null,fg=null,Jm=null,eg=void 0,gg=!1,pg=1,hg=null}dr.subscribe("player.playerSize",(function(){Sg()})),dr.subscribe("playback.selectedAudio",(function(){Tg()})),dr.subscribe("playback.selectedClosedCaption",(function(){Tg()})),dr.subscribe("playback.videoTrackDisabled",(function(){Tg()}));var Wg,zg,Qg,qg,Xg=function(e,t){tg=e,ng=t,cg.debug("init"),I(h,T.QUALITY_CHANGE,Mg),I(E,T.STREAM_VERSION_UPDATE,Cg),I(h,T.CHANGE_PROVIDER,wg),I(E,T.PROVIDER_CHANGE,Ng),I(E,T.CHUNK_LENGTH,Ug),I(b,T.REPORT_BANDWIDTH,Gg),I(E,T.ATLAS_CLEANUP,Yg),I(E,T.ATLAS_QUALITY_CHANGE_STARTED,Bg),I(E,T.ATLAS_QUALITY_CHANGE_COMPLETED,Zg),I(E,T.ATLAS_QUALITY_CHANGE_CANCELLED,Hg),om.init(),om.on(om.event.BANDWIDTH_UPDATE,jg),om.on(om.event.QUALITY_SELECTED,Vg),om.on(om.event.STATS,xg),rg(),ig(mg),Sg()},$g=function(){om.reset(),ag(),Hm(),Kg(),mg=!0},Jg=n(7278),ep=100,tp=200,np=300,rp=400,ap="reloadTime",ip=!1,op=!1,sp={},dp={},up=[{msg:"unrecognized data format",logLevel:ep},{msg:"invalid content type",logLevel:ep},{msg:"no bytes",logLevel:np},{msg:"unable to get segmentId",logLevel:tp},{msg:"VideoPlayer.stalled",logLevel:np}],cp=(0,s.w)("atlas/logic/errorWatcher/watcherHtmlplayback");function lp(e,t,n){var r=(new Date).getTime(),a=e.replace(/(?:^\s+)|(?:\s+$)/g,"").replace(/[^\w]+/g,"_").replace(/[_]{2,}/g,"_");op||(Object.prototype.hasOwnProperty.call(sp,e)||(sp[e]=0),r-sp[e]<29e3||(sp[e]=r,n=u({category:"Error",item:a,action:"",level:rp},n),Qg&&(n.provider=Qg),Le.send({message:t,data:n})))}function fp(e){var t;switch(e.status){case Lm.status.ERROR:t="server error";break;case Lm.status.TIMEOUT:t="timeout";break;default:t="unknown error"}lp("tcdn_error",t,np)}function mp(){var e,t,n={level:rp};"number"==typeof Wg&&(n.position=Math.round(Wg));var r=(0,Ae.C5)(dr.getState()).video;n.videoHeight=null!==(e=null==r?void 0:r.height)&&void 0!==e?e:0,n.videoWidth=null!==(t=null==r?void 0:r.width)&&void 0!==t?t:0,lp("heartbeat","heartbeat",n),dp.heartbeat=setTimeout(mp,3e4)}function gp(){qg=clearTimeout(qg)}function pp(e,t){qg&&gp(),qg=setTimeout((function(){lp(e,t,ep),cp.fatal(t)}),5e3)}function vp(e){(0,Yt.M)(e)?pp("empty_stream_module","empty stream module received"):gp()}function hp(){gp();var e="browser does not support the content type";lp("unsupported_content",e,ep),cp.fatal(e)}var Ep=function(){var e;cp.debug("start error watcher"),op=!1,ip||(e=de.ZP.get(ap),ip=!0,mp(),I(b,T.REPORT_BUFFER_EMPTY,(function(){dp.buffer||(dp.buffer=setTimeout((function(){zg&&lp("long buffer empty","buffer empty more than ".concat(1e4,"ms"),ep)}),1e4))})),I(b,T.REPORT_BUFFER_FULL,(function(){dp.buffer=clearTimeout(dp.buffer)})),I(E,T.PLAYING,(function(e){(zg=e)?Wg||(dp.playing=clearTimeout(dp.playing),dp.playing=setTimeout((function(){var e="playback has not begun for ".concat(15e3,"ms");lp("playback has not begun",e,ep),cp.fatal(e)}),15e3)):(dp.progress=clearTimeout(dp.progress),dp.buffer=clearTimeout(dp.buffer),dp.playing=clearTimeout(dp.playing))})),I(E,T.ATLAS_PROGRESS,(function(e){var t=e.position;Wg!==t&&(dp.playing=clearTimeout(dp.playing),dp.unrecoveredStalled=clearTimeout(dp.unrecoveredStalled),dp.progress=clearTimeout(dp.progress),dp.progress=setTimeout((function(){if(zg){var e="progress stalled more than ".concat(7e3,"ms");lp("progress stalled",e,ep),cp.fatal(e)}}),7e3)),Wg=t})),I(E,T.ATLAS_ERROR,(function(e){if(e.error!==Vt().errors.PLAY_ERROR){var t="atlas_".concat(e.error,"_error"),n="",r={level:np};switch(e.error){case Vt().errors.UNSUPPORTED:case Vt().errors.INVALID_OPTIONS:r.level=ep;break;case Vt().errors.VIDEO_PLAYER:n=e.details.message,r.level=tp;break;case Vt().errors.UNRECOVERED_STALLED:r.level=tp;break;case Vt().errors.SEGMENT_LOAD_FAILED:n=e.details.reason||"UNKNOWN",r.http_status=e.details.status,r.level=tp;break;case Vt().errors.SEGMENT_NOT_FOUND:n=e.details.reason||"UNKNOWN",r.http_status=e.details.status,r.level=np;break;case Vt().errors.CAN_NOT_CREATE_URL:n=e.details.reason,r.level=tp;break;case Vt().errors.NEW_REPRESENTATION:r.level=tp}e.error===Vt().errors.UNRECOVERED_STALLED?dp.unrecoveredStalled||(dp.unrecoveredStalled=setTimeout((function(){lp(t,n,r)}),5e3)):lp(t,n,r)}})),I(E,T.ATLAS_LOG,(function(e){up.forEach((function(t){var n=t.msg,r=t.logLevel;e.line.indexOf(n)>-1&&lp(n,e.line,{level:r})}))})),I(E,T.PLAY_OPTIONS,(function(e){if(e.baseUrl){var t=new URL(e.baseUrl);Qg="".concat(t.protocol,"//").concat(t.hostname)}})),window.addEventListener("beforeunload",(function(){de.ZP.set(ap,{time:(new Date).getTime(),mid:se.getMid()})})),I(E,T.ATLAS_CLEANUP,(function(e){e.indexOf("Unrecoverable atlas error")>-1?lp("atlas_reset",e,{level:ep}):e.indexOf("segment not found error")>-1?lp("atlas_reset",e,{level:np}):lp("atlas_reset",e,{level:rp})})),I(E,T.URL_RESOLVE_FAILURE,fp),I(E,T.PROVIDER_CHANGE,(function(e){var t=new URL(e.to);Qg="".concat(t.protocol,"//").concat(t.hostname)})),lp("load","Error logger loaded",{level:rp}),e&&(new Date).getTime()-e.time<3e4&&e.mid===se.getMid()&&lp("reload","reload",{level:np}),I(y,T.STREAM_UPDATE,vp),I(E,T.UNSUPPORTED,hp),pp("zero_stream_module","zero stream module received"))},yp=function(){op=!0,sp={},Object.getOwnPropertyNames(dp).forEach((function(e){clearTimeout(dp[e])})),dp={},cp.debug("stop error watcher")},bp=(0,s.w)("atlas/logic/errorWatcher/watcher"),Tp=function(){Ep(),bp.debug("Error watcher started.")},Sp=function(){yp(),bp.debug("Error watcher stopped.")},Ip=function(){return dr.dispatch({type:Ye})},Lp=function(e){return dr.dispatch({type:Ke,payload:{slides:e}})},Ap=function(e){return dr.dispatch({type:We,payload:{slide:e}})};function Op(e,t,n,r,a,i,o){try{var s=e[i](o),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(r,a)}function Pp(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Op(i,r,a,o,s,"next",e)}function s(e){Op(i,r,a,o,s,"throw",e)}o(void 0)}))}}var Dp,Rp=(0,s.w)("atlas/logic/slideDeck/slideDeckHandler"),_p=!o().ie||o().ie[0]&&o().ie[0]>9,Cp=(Dp=[],function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e){return(0,j.Z)(e,"url","")})),n=Dp.filter((function(e){return!t.includes(e)}));n.forEach(URL.revokeObjectURL),Dp=t});function wp(e){var t=new Blob([e],{type:"image/jpeg"});return URL.createObjectURL(t)}var Np=function(){if(!_p)return function(){var e=new Error("Browser not supported");return Promise.reject(e)};var e=null,t=null;function r(){return a.apply(this,arguments)}function a(){return(a=Pp(regeneratorRuntime.mark((function r(){var a,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=new Map,r.next=3,Promise.all([n.e(142),n.e(467)]).then(n.bind(n,3262));case 3:a=r.sent,i=a.default,(t=new i).addEventListener("message",(function(t){var n=t.data,r=n.url,a=n.error,i=n.buffer,o=e.get(r);o&&(e.delete(r),a?o(new Error(a),null):o(null,i))})),t.addEventListener("error",(function(e){e.preventDefault(),Rp.error(e.message)}));case 8:case"end":return r.stop()}}),r)})))).apply(this,arguments)}return function(){var n=Pp(regeneratorRuntime.mark((function n(a){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!==t){n.next=3;break}return n.next=3,r();case 3:return n.abrupt("return",new Promise((function(n,r){var i=a.url,o=a.secret;e.set(i,(function(e,t){if(e)r(e);else{var i=Object.assign({},a,{url:wp(t)});n(i)}})),t.postMessage({url:i,secret:o})})));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}();function Up(e){return Object.assign({start:-1/0,end:1/0},e)}dr.subscribe("slideDeck.slides",Cp);var Mp=function(e){_p&&(!Array.isArray(e)||e.length>0)&&(e?function(e){if(0!==e.length){var t=[];e.forEach((function(e){Promise.resolve().then((function(){return function(e){return!!(0,j.Z)(e,"url")}(e)?Np(e):e})).then((function(e){t.push(e),Lp(t)})).catch((function(e){Rp.error('Decoding error: "'.concat(e.message,'"'))}))}))}else Lp([])}(function(e){if(Array.isArray(e))return e.map(Up);if(e.show){var t=e.show;return[Up({url:t.url,secret:t.secret})]}return[]}(e)):Ip())},kp=function(e){var t=1e3*e,n=dr.getState().slideDeck,r=n.slides.find((function(e){var n=e.start,r=e.end;return n<=t&&t<=r}));(0,j.Z)(r,"url")!==(0,j.Z)(n.currentSlide,"url")&&(Rp.info("slide update",r),Ap(r))},Fp=function(){Ip()},Vp=function(e){return dr.dispatch({type:ke,payload:{visibility:e}})},jp=function(e){return dr.dispatch({type:Ve,payload:{searchResult:e}})},xp=function(e){var t=!1;return"boolean"==typeof e?t=e:e.token&&(t=!0),dr.dispatch({type:Fe,payload:{module:e,visibility:t}})},Bp=n(4212),Zp=n(2231),Hp=n(6731);function Gp(e,t){var n="streamFormats.mp4/segmented.chunkId";return void 0===(0,j.Z)(e,n)?e:(0,Zp.Z)(e,n,t)}function Yp(e,t,n,r,a,i,o){try{var s=e[i](o),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(r,a)}function Kp(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Yp(i,r,a,o,s,"next",e)}function s(e){Yp(i,r,a,o,s,"throw",e)}o(void 0)}))}}var Wp,zp=null,Qp="Please stand by while we're loading your Multicast stream.",qp=(0,s.w)("multicast/multicast"),Xp={},$p=!1;function Jp(){return $p}function ev(){var e=dr.getState();return(0,j.Z)(e,"provider.currentProvider.isMulticastProvider",!1)}function tv(){return!Wp||Date.now()-Wp>6e4}function nv(e,t,n){return function(e,t,n){var r=function(e,t){return(e.data||[]).map((function(t){return Object.assign({name:e.name},t)})).map((function(e){return e.sites.map((function(t){return Object.assign({name:e.name,location:e.location},t)}))})).reduce((function(e,t){return e.concat(t)}),[]).map((function(e){var n,r,a=(n=e.host,r=o().ssl?12350:12345,"".concat(n,":").concat(r));return{location:"".concat(e.name,"/").concat(e.location),name:e.host,url:"".concat(t,"://").concat(a).concat(e.path)}}))}(e,t),a=n.providers||[];return a=r.concat(a),Object.assign({},n,{providers:a})}(n.providerGroup,n.protocol,t)}function rv(){return(rv=Kp(regeneratorRuntime.mark((function e(t,r){var a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(qp.debug("Warm up the RAMP client",{mid:t,lastWarmUp:Wp,testURLs:r}),(a=!Wp)&&(i=setTimeout((function(){C().showPermanentMessage(Qp)}),500)),$p=!0,zp){e.next=8;break}return e.next=7,n.e(772).then(n.bind(n,1440));case 7:zp=e.sent;case 8:return e.abrupt("return",zp.warmUp(t,r,{timeoutInMs:3e3,pingDelayInMs:200}).finally((function(){$p=!1,Wp=Date.now(),a&&(clearTimeout(i),C().hideMessage())})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function av(e,t,n){if(!t.stream)return n(t);qp.debug("Process stream module after sdcdn",{mid:e,isMulticastActive:ev(),canRetry:tv(),isWarmUpInProgress:Jp()});var r=t.stream,a=Xp[e];if(!a)return n(Object.assign({},t,{stream:r}));var i=nv(0,t.stream,a);if(ev())return n(Object.assign({},t,{stream:i}));if(Jp())return delete t.stream,n(t);if(!tv())return n(Object.assign({},t,{stream:r}));var o=function(e,t){var n=(0,j.Z)(e,"providers.0.url");if(!n)return[];var r=(0,j.Z)(e,"streamFormats.mp4/segmented");if(!r)return[];var a=(0,j.Z)(r,"contentAccess.accessList.0.data.path"),i=(0,j.Z)(r,"streams",[]).map((function(e){var t=e.initUrl,n=e.segmentUrl;return t||n})).find((function(e){return/\.m4[av]h?$/.test(e)}));if(!a||!i)return[];var o="".concat(n).concat(a).concat(i),s=r.hashes,d=r.chunkId;return s&&"number"==typeof d?(0,Hp.Z)(d,d+t).map((function(e){var t=function(e,t){return e[10*Math.floor(t/10)]}(s,e);return t?{urlPattern:o,hash:t,chunkId:e}:null})).filter((function(e){return!!e})):[]}(i,5);if(0===o.length)return n(Object.assign(t,{stream:r}));(function(e,t){return rv.apply(this,arguments)})(e,o).then((function(r){qp.debug("Successful warm up",{mid:e,reachableURL:r}),setTimeout((function(){var e=a.providerGroup.name;Us(e)}),200);var o=r.chunkId;return n(Object.assign({},t,{stream:Gp(i,o)}))})).catch((function(a){return qp.debug("Unsuccessful warm up",{mid:e,error:a?a.message:null}),n(Object.assign({},t,{stream:r}))}))}var iv,ov,sv,dv,uv,cv,lv,fv=(0,s.w)("atlas/playback/hlsWatcher");function mv(e){var t=e.position;ov=t,Ev()}function gv(e){dv=e}function pv(e){uv=e,clearInterval(cv),Ev(),iv&&uv&&(cv=setInterval(vv,1e3))}function vv(){dv&&dv.url&&dv.format===D&&(sv&&sv===ov&&uv?(fv.debug("hls playback stalled"),lv||(lv=setTimeout(hv,3e3))):Ev(),sv=ov)}function hv(){dv.url&&Is.isEcdnProvider(dv.url)?(Is.onProviderFailure(dv),Ev()):fv.debug("non ecdn provider failure.")}function Ev(){lv=clearTimeout(lv)}var yv=function(){iv||(fv.debug("init"),iv=!0,I(E,T.ATLAS_PROGRESS,mv),I(E,T.PLAYING,pv),I(E,T.PLAY_OPTIONS,gv))};function bv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Tv=(0,s.w)("atlas/logic/ums/connectionParams");function Sv(){return se.isOffairVid()&&Object.values(he.uumfOffairVods).includes(se.offairVid())}function Iv(){if(Vt().capabilities.includes(Vt().formats.FLV_SEGMENTED)||Vt().capabilities.includes(Vt().formats.MP4_SEGMENTED)&&(se.isLiveContent()||se.isVid()||Sv()))return{appId:3,appVersion:2};if(Vt().capabilities.includes(Vt().formats.HLS))return yv(),{appId:11,appVersion:3};if(Vt().capabilities.includes(Vt().formats.MP4_MOVIE))return{appId:3,appVersion:2};var e="Can not play media";throw Tv.info(e,{atlasCapabilities:Vt().capabilities,isVid:se.isVid(),isOffairVid:se.isOffairVid(),isOffairVod:Sv()}),new Error(e)}function Lv(e,t){if(e){if("string"==typeof e)return Av(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Av(e,t):void 0}}function Av(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ov(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var Pv=(0,s.w)("atlas/logic/ums/umsHandler"),Dv=[];function Rv(e,t){lr.reportUmsConnectionFinished(e),Bp.Z.set("mte_use_lonpoll",t.longpoll?"1":"0",{expires:30}),he.getByContent("channelPassword")&&Le.send({message:"Viewer passes lock",data:{category:"Interaction",item:"lock",action:"pass",lock_type:"passwordlock"}}),S(b,T.UMS_CONNECTED,e)}function _v(e){var t={code:(0,j.Z)(e,"closeEvent.code",-1),closeReason:(0,j.Z)(e,"closeEvent.reason",-1)};Le.send({message:"UMS connection lost",data:{category:"Playback",item:"UMS connection",action:"lost",reason:t}})}function Cv(e,t){var n,r,a,i=t[0]||t;n=e,a=function(t){Is.onStat=wv,Is.onComplete=Nv,Is.update(e,t)},(r=i).cdnConfig?(r.cdnConfig=function(e,t){var n=function(e){var t=function(e){return(e.data||[]).findIndex((function(e){return"multicast"===e.name}))}(e);if(-1===t)return{multicastProviderGroup:null,restOfTheCdnConfig:e};var n=e.data,r=n[t];return n.splice(t,1),{multicastProviderGroup:r,restOfTheCdnConfig:Object.assign({},e,{data:n})}}(t),r=n.multicastProviderGroup,a=n.restOfTheCdnConfig;if(!r)return t;var i=-1!==Vt().capabilities.indexOf(Vt().formats.MP4_SEGMENTED);return i&&function(e,t,n){var r=o().ssl?"https":"http";Xp[e]={protocol:t||r,providerGroup:n}}(e,t.protocol,r),qp.info("Multicast provider detected",{mid:e,multicastProviderGroup:r,isSupported:i}),a}(n,r.cdnConfig),a(r)):a(r)}function wv(e){switch(e.type){case"overlay":return dr.dispatch((0,Ls.SX)(e.data));case"report":S(b,T.REPORT_ECDN_TESTS,e.data);break;default:Pv.debug("Unexpected command from sdcdn stats reporting",e.type)}}function Nv(e,t){av(e,t,(function(t){Sr(e,t)}))}function Uv(e,t){Pv.debug("ums reject. mid: ".concat(e),{mid:e,updates:t}),function(e,t){var n=!1;t.forEach((function(t){t.embedLimitExceeded&&n||(Xn.send("mediaReject",!0),n=!0);var r=function(e){return Object.keys(e).find((function(e){return fu.includes(e)}))||"default"}(t),a=r.toLowerCase(),i=t[r];if("hashLock"===r){vd();var o=bt.getFallbackHash();if(o)return void dr.dispatch((0,cu.t_)(o))}var s=dr.getState().ums;"passwordLock"===r&&s.password&&dr.dispatch((0,cu.dM)(null)),dr.dispatch(hd({type:a,data:i})),S(b,T.UMS_REJECT,{mid:e,send:i}),S(h,T.PAUSE)}))}(e,t)}var Mv=function(e){lr.reportUmsConnectionStart(e);var t=function(e){var t,n,r=(t=e.split("."),n=3,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return bv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bv(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a={app:r[0],id:r[1],hid:r[2],referrer:ue.Z,connectParams:Iv(),longpoll:he.useLongpoll||"1"===Bp.Z.get("mte_use_longpoll"),sessionId:R.Z.sessionId,ignoreTrim:he.ignoretrim,hash:dr.getState().ums.hash,password:dr.getState().ums.password,flotAddress:!!he.flot&&decodeURI(he.flot),bdtools:he.bdtools,buildNumber:Ee.Z.BUILD_NUMBER,clusterHost:V.Z.config.ums,isOffairRecorded:se.isOffairVid()};return Tv.debug("create ums connection. mid: ".concat(e),{umsParams:a}),a}(e),n=To()(t);n.on(n.event.OPEN,Rv.bind(null,e)),n.on(n.event.REJECT,Uv.bind(null,e)),n.on(n.event.UPDATE,Cv.bind(null,e)),n.on(n.event.LOG,(function(t){var n,r=function(e){if(Array.isArray(e))return e}(n=t)||Ov(n)||Lv(n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),a=r[0],i=r.slice(2);if(S(E,T.DEBUG_FLOT_LOG,[a].concat(function(e){return function(e){if(Array.isArray(e))return Av(e)}(e)||Ov(e)||Lv(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(i))),"url"===(0,j.Z)(i,"0"))try{var o=new URL(i[1]),s=o.protocol,d=o.hostname;if(/https?/.test(s))return;if((Dv=Dv.filter((function(e){var t=e.checkedAt;return Math.abs(Date.now()-t)<6e4}))).some((function(e){return e.hostname===d})))return;Dv.push({hostname:d,checkedAt:Date.now()}),Pv.debug("Download connection info",{hostname:d});var u=/wss/.test(s)?"https:":"http:",c="".concat(u,"//").concat(d,"/connectioncheck");fetch(c).then((function(e){return e.json()})).then((function(e){return Pv.debug("Connection info received",{hostname:d,info:e})})).catch((function(e){return Pv.error("Connection info failed",{hostname:d,error:e.message})}))}catch(e){}Pv.debug("ums.log ".concat(e),i)})),n.on(n.event.CLOSE,_v),S(b,T.UMS_CONNECT_START,e),n.connect()},kv=n(637);function Fv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Vv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vv(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var jv,xv={CLOSE_NORMAL:1e3,CLOSE_GOING_AWAY:1001,CLOSE_PROTOCOL_ERROR:1002,CLOSE_UNSUPPORTED:1003,CLOSE_NO_STATUS:1005,CLOSE_ABNORMAL:1006,CLOSE_INCONSISTENT_DATA_RECEIVED:1007,CLOSE_POLICY_VIOLATE:1008,CLOSE_TOO_LARGE:1009,CLOSE_MISSING_EXTENSION:1010,CLOSE_UNEXPECTED_CONDITION:1011,CLOSE_FAILED_TLS_HANDSHAKE:1015},Bv=null,Zv=null,Hv=null,Gv=!1,Yv=null,Kv=null,Wv=0,zv=[];function Qv(e){e&&Array.isArray(e)&&(function(e){var t=Fv(e,2)[1],n=Date.now();"string"==typeof t&&"opened"===t.trim()&&(n-Kv<5e3&&clearTimeout(Yv),dr.dispatch((0,kv.pq)({inited:!0})))}(e),function(e){var t=Fv(e,3),n=t[0],r=t[1],a=t[2];if("string"!=typeof r||"opening"!==r.trim()||Bv||(Bv=n),"string"==typeof r&&r.includes("message")){var i=(0,j.Z)(a,"1.0",{});!Zv&&i.meta&&(Zv=n),Hv||!i.stream||(0,Yt.M)(i.stream)||(Hv=n)}if(!Gv&&Zv&&Hv&&Bv){Gv=!0;var o=Math.max(Zv,Hv)-Bv;dr.dispatch((0,kv.mE)({timeToStartInMs:o}))}}(e),function(e){var t=Fv(e,3),n=t[1],r=t[2];if("string"==typeof n&&"closed"===n.trim()&&r){var a=Fv(r,2),i=a[0],o=a[1],s="".concat(xv[i]," ").concat(i);o&&(s="".concat(s," ").concat(o)),dr.dispatch((0,kv.Lv)({level:Pn.Q.WARNING,timeStamp:Date.now(),msg:s}))}}(e),function(e){var t=Fv(e,3),n=t[1],r=t[2];if("string"==typeof n&&"message"===n.trim()&&"reject"===(0,j.Z)(r,"cmd")){Wv+=1;var a=r&&r.args?Object.keys(r.args[0])[0]:"unknown";"cluster"===a.trim()&&dr.dispatch((0,kv.Vl)({level:Pn.Q.ERROR,timeStamp:Date.now(),msg:a})),Wv>3&&dr.dispatch((0,kv.Vl)({level:Pn.Q.ERROR,timeStamp:Date.now(),msg:a}))}}(e),function(e){var t=Fv(e,3),n=t[0],r=t[1],a=t[2];if("string"==typeof r&&r.includes("message")){var i=(0,j.Z)(a,"1.0",{});i.stream&&(0,Yt.M)(i.stream)&&dr.dispatch((0,kv.H$)({level:Pn.Q.ERROR,timeStamp:n,msg:"Stream module empty"}))}}(e))}function qv(e){var t=e.performance,n=e.url;if(0===e.size){var r="unknown";/\.m4a$/.test(n)&&(r="Audio chunk empty"),/\.m4v$/.test(n)&&(r="Video chunk empty"),dr.dispatch((0,kv.n2)({level:Pn.Q.WARNING,timeStamp:Date.now(),msg:r}))}if(t){var a=t.requestStart,i=t.responseStart,o=t.responseEnd;if(a&&i&&o){var s=Math.round(i-a),d=Math.round(o-i),u=s+d,c=Is.isEcdnProvider(n);if(u>5e3){var l="Total: ".concat(u,"ms Req: ").concat(s,"ms Res: ").concat(d,"ms");dr.dispatch((0,kv.Xw)({level:Pn.Q.WARNING,timeStamp:Date.now(),msg:l,request:s,response:d,total:u,isEcdn:c}))}}}}function Xv(e){if(e){var t=e.error,n=e.recoverable;t&&"playError"!==t&&(n?dr.dispatch((0,kv.UG)({level:Pn.Q.WARNING,timeStamp:Date.now(),msg:t})):dr.dispatch((0,kv.XR)({level:Pn.Q.ERROR,timeStamp:Date.now(),msg:t})))}}function $v(e){if(e){var t=e.line;if("string"==typeof t&&t.includes("process segment")){zv.push(e.data);var n=function(e){var t=e.filter((function(e){var t=e.streamId,n=e.keyFrames;return t.includes("video")&&n.length})).reduce((function(e,t){return e.find((function(e){return e.segmentId===t.segmentId}))||e.push(t),e}),[]).sort((function(e,t){return e.segmentId-t.segmentId})).reduce((function(e,t){var n=e[e.length-1],r=n[n.length-1];return r&&r.segmentId!==t.segmentId-1?e.push([t]):n.push(t),e}),[[]]).map((function(e){return e.reduce((function(e,t){return e.concat(t.keyFrames)}),[]).reduce((function(e,t,n,r){if(n>0){var a=r[n-1];e.push(t-a)}return e}),[])})).reduce((function(e,t){return e.concat(t)}),[]),n=t.reduce((function(e,n){return e+n/t.length}),0);return{keyframeIntervals:t,avg:n}}(zv=zv.splice(-20)).avg;dr.dispatch((0,kv.bG)({keyFrameInterval:n/1e3}))}}}function Jv(e){return{type:jt,payload:e}}function eh(e){var t=e.date,n=e.source,r=e.line,a=e.data,i=e.level;if(void 0!==window.console){var d=[t=new Date(t).toISOString().slice(-13,-1),"[".concat(n,"]"),r];d=o().ie?[d.join(" ")]:["%c".concat(d.join("%c ")),"color: #cecece","font-weight:    bold",""],void 0!==a&&d.push(a),i<200&&window.console.error&&window.console.error.apply(console,d),300===i&&window.console.warn&&window.console.warn.apply(console,d),400===i&&window.console.info&&window.console.info.apply(console,d),500===i&&window.console.debug?window.console.debug.apply(console,d):window.console.log.apply(console,d),window.getUstreamPlayerLog||(window.getUstreamPlayerLog=function(){return s.Z.getLogs()})}}function th(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Le.send({message:"Unhandled exception",data:{message:e,stack:t.substring(0,2e3),category:"Unhandled exception"}})}ue.Z.includes("".concat(V.Z.config.siteLocal,"/embed/test"))&&s.Z.addTransport((function(e){var t,n=e.date,r=e.source,a=e.line,i=e.data,o=e.level;try{t=new URL(ue.Z).origin}catch(e){t=""}window.parent.postMessage(JSON.stringify({mte:[n,r,a,i,o]}),t)})),dr.getState().settings.debug&&s.Z.addTransport(eh),jv=window.onerror,window.onerror=function(e,t,n,r,a){return s.Z.fatal({source:"jserror",line:"".concat(e," Cannot continue."),data:{url:t,lineNumber:n}}),th((0,j.Z)(a,"message",e),(0,j.Z)(a,"stack","")),!!jv&&jv(e,t,n)},window.addEventListener("unhandledrejection",(function(e){var t=(0,j.Z)(e,"reason",""),n=(0,j.Z)(e,"promise");n?n.catch((function(e){th((0,j.Z)(e,"message",t),(0,j.Z)(e,"stack",""))})):th(t)})),dr.subscribe("settings.debug",(function(e){e?s.Z.addTransport(eh):s.Z.removeTransport(eh)}));var nh=n(6561),rh=n(62),ah=n(1406),ih=(0,s.w)("atlas/logic/captionSearch/captionSearchService"),oh=V.Z.config.api||V.Z.fallbackConfig.api;function sh(e){ih.error("searchOnError",e),jp(void 0)}var dh,uh={searchCaptions:function(e,t){if(t)if(void 0!==t.token){var n=t.token;e?function(e,t){var n=new XMLHttpRequest;function r(){return sh(n.status+" "+n.statusText)}n.addEventListener("load",(function(){if(200===n.status)try{e=JSON.parse(n.responseText),ih.debug("searchOnSuccess",e.caption_matches),jp(e.caption_matches)}catch(e){sh("Response JSON parse failed")}else r();var e})),n.addEventListener("error",r),n.open("GET",function(e){var t=new URL("https://"+oh),n=se.isOffairVid()?se.offairVid():se.id();return t.pathname="videos/"+n+"/captions/search.json",t.searchParams.set("q",function(e){return e.replace(/\s/g,"+")}(e)),t.searchParams.set("highlight",!0),t.toString()}(e),!0),n.setRequestHeader("Authorization","Bearer "+t),n.send()}(e,n):sh("Cannot call search api with empty search text.")}else ih.error("There is no token for search api.");else ih.error("There is no module for search api")}},ch=n(1358),lh=n(2543);function fh(){var e={waiting:se.isLiveContent()?1e4:2e4,stalled:7e3};lh.S1(e)}function mh(){ch.S1(lh.U2(),(function(e){e?dr.dispatch((0,Sn.c0)(Sn.GT.assistedReporting)):dr.dispatch((0,Sn.yK)(Sn.GT.assistedReporting))}),{recovery:5e3})}function gh(){var e=(0,s.w)("viewer/htmlplayback");e.debug("environment variables: ",o(),!0),e.debug("playback type selected",{playerVersion:Ee.Z.BUILD_NUMBER,playbackType:"atlas",playbackVersion:Vt().version},!0);var t,n,r,a,i,d={featured:!1},u=null,c=!1,l=!1,f=!1;function m(e){dr.getState().playback.playing===e&&c||(c=!0,dr.dispatch((0,Pr.OH)(e)),Xn.send("playing",e))}function g(){dr.dispatch(hd({type:"unsupported"}))}function p(e){e.error===Vt().errors.UNSUPPORTED&&g()}function L(){e.debug("onContentAvailable");var t=dr.getState().content.trimInfo;t&&!l&&(dh.setHighlight(t),l=!0);var n=se.getTrimmedDurationInMillisec()/1e3;dr.dispatch((0,tr.uM)(n)),dh.setDuration(),f=!0,dh.showPlayScreen(),Ri.canStartAutoplay()?he.autoplay&&(dh.hidePlayScreen(),N()):dr.subscribe("privacy.ibmCookie",k),dh.setContentAvailable(!0);var r=lh.U2();r&&(r.setProps({contentAvailable:!0}),dr.getState().playback.playing&&r.setProps({playing:!0}))}function A(){dr.dispatch((0,Gd._r)([])),dr.dispatch((0,Pr.kY)([]))}function O(){he.disableEosSeek||(dh.setSeek(0),dr.dispatch((0,Pr.eE)(0)))}function P(){Zd()&&m(!1),-1!==n.indexOf("recorded")?se.isOffairVid()?Hd()?(au(),se.setHighlight([0,1]),l=!1,S(E,T.NEXT_OFFAIR_VIDEO)):Zd()&&(e.debug("All offair videos played"),O(),U()):o().ios?(O(),U()):yo.playPostroll():-1!==n.indexOf("channel")&&e.info("previous content has just finished and the current is live (channel)")}function D(){var e=om.getAverageBandwidth(2),t=om.getSelectedStreamVerison(),n=t&&t.video,i={category:"Loading",item:"buffering",action:"started",segment_size:e?Math.round(e.size):-1,net_speed:e?Math.round(e.speed):-1,current_kbps:(0,j.Z)(n,"bitrate",void 0),current_height:(0,j.Z)(n,"height",void 0)};Le.send({message:"Buffering started",data:i}),a=(new Date).getTime(),clearTimeout(r),r=setTimeout((function(){return dh.setLoading(!0)}),3e3)}function C(){var e=om.getAverageBandwidth(2),t=om.getSelectedStreamVerison(),n=t&&t.video;if(a){var o={category:"Loading",item:"buffering",action:"completed",time_spent:(new Date).getTime()-a,segment_size:e?Math.round(e.size):-1,net_speed:e?Math.round(e.speed):-1,current_kbps:(0,j.Z)(n,"bitrate",void 0),current_height:(0,j.Z)(n,"height",void 0)};Le.send({message:"Buffering completed",data:o}),a=null}if(!i){i=!0;var s=se.getStreamType()||"unknown";Le.send({message:"Playback started",data:{category:"Playback",item:"playback",action:"started",stream_type:s}});var d=dr.getState().playback,u=d.selectedClosedCaption,c=d.closedCaptionSelection;if(u>-1&&"manual"!==c){var l=(0,j.Z)(dr.getState(),"playback.closedCaptionTracks",[]).find((function(e){return e.id===u}));if(l){var f=l.country,m=void 0===f?"00":f,g=l.language,p=l.isGenerated;Le.send({message:"Playback started with CC",data:{category:"Playback",item:"CC",action:"displayed",cc_type:"broadcaster"===c?"from_broadcaster":"from_viewer",language:"".concat(g,"-").concat(m),generated:p}})}}}clearTimeout(r),dh.setLoading(!1)}function w(t){if(e.debug("onAdEvent",t),t.type===Ar.types.POSTROLL_FINISHED)return O(),m(!1),dh.setAdvertVisibility(!1),void U();void 0===t.contentPlaying||o().ios||(t.contentPlaying?N():U()),void 0!==t.controls&&dh.setUiVisibility(t.controls),t.type===Ar.types.VIDEO_STARTED&&dh.setAdvertVisibility(!0),t.type===Ar.types.VIDEO_FINISHED&&dh.setAdvertVisibility(!1),t.type===Ar.types.PREROLL_DONE&&(e.debug("onPreRollDone"),du())}function N(){e.debug("onPlaycall",{prerollDone:yo.isPrerollDone()}),f&&(dr.getState().playback.playing||(m(!0),S(h,T.PLAY)))}function U(){e.debug("onPause",{prerollDone:yo.isPrerollDone()}),m(!1),S(h,T.PAUSE)}function M(){var e=(0,Ae.hz)(dr.getState()),t=e.width,n=e.height;yo.resize(t,n)}function k(){dh.hidePlayScreen(),N(),Ri.stopCheck()}function F(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"other";Le.send({message:"Troubleshoot playback issue sent",data:{category:"Troubleshoot Playback Issue",item:"troubleshoot playback issue",action:"send",issue_type:t||"other",assisted_reporting_shown:e}})}function x(){if(t){fh(),mh(),function(){n=se.getMid();var e=To()(n);e&&e.destroy()}(),Bc.init(n),Tr(n),Of();try{Mv(n)}catch(t){e.error("Unexpected side effect has been occured while creating ums. Message: ".concat(t.message))}Xn.send("content",[se.app(),se.id()])}}window.addEventListener("unload",(function(){Le.send({message:"Player closed",data:{category:"Playback",item:"playback",action:"player closed"}})})),I(h,T.LOAD,(function(t){var r,a,o,s=t[0];o=t[2]&&"boolean"!=typeof t[2]?[t[1],t[2]]:[t[1]],e.debug("Load media: ".concat(t[0],".").concat(t[1]),{type:s,contentParams:o}),se.update(s,o),dr.dispatch((0,Sn.VV)(1)),dr.dispatch(Jv()),dr.dispatch((0,tr.gg)()),dr.dispatch((0,tr.uM)()),dr.dispatch((0,tr.iT)(se.getMid())),dr.dispatch({type:xt,payload:undefined}),dr.dispatch(fr({is360Video:void 0,fov:void 0})),dr.dispatch((0,tr.Gz)()),Bv=null,Zv=null,Hv=null,Gv=!1,zv=[],null!==Yv&&clearTimeout(Yv),Yv=null,Kv=null,Wv=0,dr.dispatch((0,kv.AB)()),dr.dispatch(gr({remove:!0})),dr.dispatch(mr({remove:!0})),n!==se.getMid()&&(dr.dispatch((0,ah.FD)(void 0)),Vp(!1),dr.dispatch((0,ah.Q3)(!1)),Fp(),dr.dispatch((0,Pr.KS)([])),A(),he.autoplay=!0,i=!1,c=!1,r=n,a=To()(r),e.debug("dispose",{mid:r}),u=null,l=!1,S(E,T.LIVE,!1),Xn.send("live",!1),dh.setContentAvailable(!1),Ir(r),Bd(),a&&a.destroy(),Bc.reset("Media change")),$g(),yo.destroy(),au();var d=se.isVid()?tr.w_.recorded:tr.w_.live;dr.dispatch((0,tr.y5)(d)),x()})),dr.subscribe("ums.password",x),dr.subscribe("ums.hash",x),dr.subscribe("ums.lock.type",(function(e){e&&(ch.ob(),lh.ob())})),dr.subscribe("playback.isBufferEmpty",(function(e){var t=lh.U2();t&&t.setProps({waiting:e})})),function(e){v=e}(dh=new Jg.Z({reduxStore:sr,wrappedStore:dr,exposedVars:R.Z,domainMapping:V.Z,playbackVersion:"".concat(Vt().version," (Atlas)"),allowfullscreen:he.allowfullscreen,viewingexperience:he.viewingexperience,ignoretrim:he.ignoretrim,autoplay:he.autoplay,controls:he.controls,hideCta:he.hideCta,siteMode:he.sitemode,popoutVisible:he.popoutVisible,popout:he.popout,showTitle:he.showtitle,hidePlayScreen:he.hideplayscreen,disableCaptionSearch:he.disableCaptionSearch,getByContent:he.getByContent,getUrl:function(){return se.getUrl.apply(se,arguments)},getId:se.id,getApp:se.app,getCutStart:se.getCutStart,isContentPlayable:se.isContentPlayable,setHighlight:se.setHighlight,isHLS:se.isHLS,isVid:se.isVid,isCid:se.isCid,isLive:se.live,isOffairImg:se.isOffairImg,getAbsoluteSeekPositionInMs:se.getAbsoluteSeekPositionInMs,getRelativeSeekPositionInMs:se.getRelativeSeekPositionInMs,getTrimmedDurationInMillisec:se.getTrimmedDurationInMillisec,saveHashToLocalStorage:bt.saveHashToLocalStorage,getHashFromLocalStorage:bt.getHashFromLocalStorage,isPollAnswered:nh.Z.isAnswered,searchCaptions:uh.searchCaptions,getPlayerState:function(){var e=lh.U2();if(e)return e.state}})),dh.addEventListener(_.Z.REPORT.centralLog,(function(e){var t=e.detail,n=t.message,r=t.data;Le.send({message:n,data:r})})),dh.addEventListener(_.Z.COMMAND.theaterMode,(function(e){var t=e.detail.enabled;Xn.send("theaterMode",t)})),dh.addEventListener(_.Z.COMMAND.poll,(function(e){var t=e.detail;Xn.send("poll",t)})),dh.addEventListener(_.Z.COMMAND.qualityChange,(function(e){var t=e.detail.qualityId;S(h,T.QUALITY_CHANGE,t)})),dh.addEventListener(_.Z.COMMAND.sendLog,(function(t){var n=t.detail,r=n.reason,a=n.logSendingFromAssistedReporting;e.info("Report playback issue",{reason:r}),dh.setLogSendingStarted(),(0,Rr.Z)().then((function(e){dh.setLogSendingCompleted(e),F(a,r)})).catch((function(t){e.error(t.message),dh.setLogSendingCompleted()}))})),dh.addEventListener(_.Z.LOG.fatal,(function(t){var n=t.detail,r=n.line,a=n.data,i=n.keep;e.fatal(r,a,i)})),dh.addEventListener(_.Z.LOG.error,(function(t){var n=t.detail,r=n.line,a=n.data,i=n.keep;e.error(r,a,i)})),dh.addEventListener(_.Z.LOG.warn,(function(t){var n=t.detail,r=n.line,a=n.data,i=n.keep;e.warn(r,a,i)})),dh.addEventListener(_.Z.LOG.info,(function(t){var n=t.detail,r=n.line,a=n.data,i=n.keep;e.info(r,a,i)})),dh.addEventListener(_.Z.LOG.debug,(function(t){var n=t.detail,r=n.line,a=n.data,i=n.keep;e.debug(r,a,i)})),window.sendPlayerLog=function(){dh.setLogSendingStarted(),(0,Rr.Z)().then((function(e){dh.setLogSendingCompleted(e),F(),console.log("Log sending complete. Issue ID: ".concat(e))})).catch((function(t){e.error(t.message),console.error(t),dh.setLogSendingCompleted()}))},he.findText&&(dr.dispatch((0,ah.FD)(decodeURIComponent(he.findText))),dr.dispatch((0,ah.Q3)(!0))),Le.isLoggingEnabled()?Tp():Sp(),ru(),function(){t=!0,e.debug("ui loaded"),Ri.startCheck(),dr.dispatch((0,tr.iT)(se.getMid()));var r=se.isVid()?tr.w_.recorded:tr.w_.live;dr.dispatch((0,tr.y5)(r)),Zt.Z.init("atlas"),pd(),Xg(he.initialQuality,he.forcedQuality),Tf(),xd(),e.info("setup FacadeHandlers"),I(E,T.LIVE,(function(e){if(e!==u){Le.send({message:"Live status changed",data:{category:"Playback",item:"live status",action:"changed",status:e?"live":"off air"}});var t="boolean"==typeof u;t&&Fp(),t&&e&&(fh(),lh.U2().setProps({contentAvailable:!0}),dr.getState().playback.playing&&lh.U2().setProps({playing:!0}),mh()),e||(ch.ob(),lh.ob())}if(Xn.send("live",e),he.isLive=e,u=e,yo.isStarted()&&yo.destroy(),u){n=se.getMid();var r=To()(n);dr.dispatch((0,cu.hD)({umsInfo:r.internals})),dr.dispatch((0,tr.y5)(tr.w_.live))}dr.dispatch((0,tr.Gz)(u)),iu()})),I(E,T.CREATE_SLIDESHOW,(function(e){dh.startSlideShow(e),yo.isStarted()&&yo.destroy(),Le.send({message:"Offair content displayed",data:{category:"Playback",item:"off air content",action:"displayed",offair_content_type:"image"}}),dr.dispatch((0,tr.y5)(tr.w_.offairSlide))})),I(E,T.ATLAS_THROTTLE,(function(e){dh.setThrottle(e)})),I(E,T.DESTROY_SLIDESHOW,(function(){dh.stopSlideShow()})),I(E,T.CREATE_OFFAIR_VIDEO,(function(t){n="recorded.".concat(t),setTimeout((function(){se.setDurationInMillisec(0),dr.dispatch((0,tr.uM)()),Of(),Tr(n),A(),ou(!1),su(!1),fh(),mh();try{Mv(n);var r=To()(n);Xn.send("content",["recorded",t]),dr.dispatch((0,cu.hD)({umsInfo:r.internals})),Le.send({message:"Offair content displayed",data:{category:"Playback",item:"off air content",action:"displayed",offair_content_type:"video"}}),dr.dispatch((0,tr.y5)(tr.w_.offairVideo))}catch(t){e.error("Unexpected side effect has been occured while creating ums. Message ".concat(t.message))}}),100)})),I(E,T.DESTROY_OFFAIR_VIDEO,(function(e){To()("recorded.".concat(e)).destroy()})),I(E,T.ATLAS_STORED_UPDATE,(function(e){dr.dispatch((0,Pr.x4)(e))})),I(E,T.ATLAS_BUFFERED_UPDATE,(function(e){dr.dispatch((0,Pr.x4)(e))})),I(E,T.ATLAS_PROGRESS,(function(e){var t=e.position,n=e.sourceMedia;dh.setAtlasProgress(t),kp(t/1e3),dr.dispatch(function(e,t){return{type:It.setPosition,payload:{position:e,sourceMedia:t}}}(t,n));var r=lh.U2();r&&r.setProps({currentTime:t/1e3})})),I(y,T.THUMBNAIL_UPDATE,(function(e){Xn.send("thumbnail",e)})),I(y,T.BROADCASTER_UPDATE,(function(e){e.featured&&(d.featured=!0)})),I(y,T.META_UPDATE,(function(e){e.title&&(dr.dispatch(Jv(e.title)),Xn.send("title"),d.title=e.title),d.homepage=!1,d.autoplay=he.autoplay,d.mobile=Lr,d.categories=e.category,d.userName=e.userName,d.contentLength=e.videoLength||555555;var t=(0,Ae.hz)(dr.getState()),n=t.width,r=t.height;yo.initialize({countryCode:e.countryCode,adIntegration:e.adIntegration,width:n,height:r}),yo.update(d),Xn.send("meta",e),ou()})),I(y,T.SHARE_UPDATE,(function(e){Xn.send("share",e)})),I(E,"loading",(function(e){dh.setLoading(e)})),I(E,T.DURATION,(function(){var e=se.getDurationInMillisec()/1e3;dr.dispatch((0,tr.gg)(e)),dh.setDuration(),Xn.send("duration",e)})),I(E,T.PLAYING,(function(e){m(e),S(b,T.PLAYING,{mid:n,playing:e});var t=lh.U2();t&&(t.setProps({playing:e}),e&&dr.getState().playback.isBufferEmpty&&t.setProps({waiting:!0}))})),I(E,T.PROGRESS,(function(e){var t=function(e){if(se.isHLS())return e;var t=se.getCutStart();return(e-t)/(se.getCutEnd()-t)}(e);dh.setProgress(t),dr.dispatch((0,Pr.eE)(t))})),I(E,T.RECORDED_READY,(function(){iu()})),I(E,Ar.AD_EVENT,w),I(b,T.REPORT_BUFFER_EMPTY,D),I(b,T.REPORT_BUFFER_FULL,C),I(E,T.VIDEO_FINISHED,P),I(E,T.ATLAS_DOWNLOAD_ERROR,Is.onProviderFailure),I(E,T.CONTENT_AVAILABLE,L),I(y,T.LIVE_CTA_UPDATE,(function(e){Xn.send("liveCtaUpdate",e)})),I(y,T.CAPTION_UPDATE,(function(e){xp(e)})),I(y,T.SLIDES_UPDATE,(function(e){Mp(e)})),I(E,T.UNSUPPORTED,g),I(E,T.ATLAS_ERROR,p),e.debug("setup UiHandlers"),dh.addEventListener(_.Z.COMMAND.play,N),dh.addEventListener(_.Z.COMMAND.pause,U),dh.addEventListener(_.Z.COMMAND.seek,(function(e){var t=e.detail;!function(e,t){var r=dr.getState().playback.progress,a=dr.getState().content.trimmedDuration;S(b,T.SEEK,{mid:n,send:{from:r,to:e/a,duration:a}}),S(h,T.SEEK,{position:e,initiator:t})}(t.position,t.initiator)})),dh.addEventListener(_.Z.COMMAND.videoFinished,P),dh.addEventListener(_.Z.COMMAND.playScreenClicked,N),dh.addEventListener(_.Z.COMMAND.setCaptionPosition,(function(e){var t=e.detail.captionPosition;S(h,T.SET_CAPTION_POSITION,t)})),dh.addEventListener(_.Z.COMMAND.sendPollAnswer,(function(e){var t=e.detail,n=se.getMid();To()(n).send("api/poll/vote",[t]),nh.Z.setPollAnswered(t.pollInstanceId)})),dr.subscribe("player.playerSize",M),Gr(),null===Yv&&(Kv=Date.now(),Yv=setTimeout((function(){dr.dispatch((0,kv.pq)({inited:!1}))}),5e3)),I(E,T.DEBUG_FLOT_LOG,Qv),I(b,T.REPORT_BANDWIDTH,qv),I(E,T.ATLAS_ERROR,Xv),I(E,T.ATLAS_LOG,$v),he.externalvtt&&Wd(),x(),dh.setUiVisibility(!0),dh.setReady(!0),dr.dispatch((0,Pr.Uc)(!0)),Xn.send("ready",!0),Le.send({message:"Initial loading completed",data:{category:"Loading",item:"initial loading",action:"completed"}}),he.autoplay&&!i&&Le.send({message:"Playback requested",data:{category:"Playback",item:"playback",action:"requested - autoplay"}}),he.volume<100&&setTimeout((function(){return dr.dispatch((0,Sn.jA)(he.volume))}),0),(0,rh.a)()&&dr.dispatch((0,Sn.c0)(Sn.GT.oldBrowser))}()}function ph(){lr.cleanup(),lr.setInitStart(),gh()}},4378:function(e){self,e.exports=function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:function(){return Yi}});var n="Atlas",r={POSITION:"".concat(n,".position"),FINISHED:"".concat(n,".finished"),BUFFER_EMPTY:"".concat(n,".bufferEmpty"),BUFFER_FULL:"".concat(n,".bufferFull"),METADATA:"".concat(n,".metadata"),BANDWIDTH:"".concat(n,".bandwidth"),STORED:"".concat(n,".stored"),BUFFERED:"".concat(n,".buffered"),SEEK_STARTED:"".concat(n,".seekStarted"),SEEK_COMPLETED:"".concat(n,".seekCompleted"),QUALITY_CHANGE_STARTED:"".concat(n,".qualityChangeStarted"),QUALITY_CHANGE_COMPLETED:"".concat(n,".qualityChangeCompleted"),QUALITY_CHANGE_CANCELLED:"".concat(n,".qualityChangeCancelled"),LANGUAGE_CHANGE_STARTED:"".concat(n,".languageChangeStarted"),LANGUAGE_CHANGE_COMPLETED:"".concat(n,".languageChangeCompleted"),LANGUAGE_CHANGE_CANCELLED:"".concat(n,".languageChangeCancelled"),ERROR:"".concat(n,".error"),LOG:"".concat(n,".log"),THROTTLE:"".concat(n,".throttle"),AUDIO_TRACKS:"".concat(n,".audioTracks"),TEXT_TRACKS:"".concat(n,".textTracks"),TEXT_TRACK_CUE_CHANGE:"".concat(n,".textTrackCueChange"),X08_DETECTED:"".concat(n,".x08Detected"),WEBKIT_SUPPORTS_FULLSCREEN:"".concat(n,".webkitSupportsFullscreen"),WEBKIT_ENTER_FULLSCREEN:"".concat(n,".webkitEnterFullscreen"),WEBKIT_END_FULLSCREEN:"".concat(n,".webkitEndFullscreen"),GAP_RECOVERING:"".concat(n,".gapRecovering"),ATLAS_SEEKABLE:"".concat(n,".atlasSeekable"),ATLAS_FULLY_INITIALIZED:"".concat(n,".atlasFullyInitialized")},a={UNSUPPORTED:"unsupported",INVALID_OPTIONS:"invalidOptions",SEGMENT_NOT_FOUND:"segmentNotFound",SEGMENT_LOAD_FAILED:"segmentLoadFailed",VIDEO_PLAYER:"videoPlayer",UNRECOVERED_STALLED:"unrecoveredStalled",CAN_NOT_CREATE_URL:"canNotCreateUrl",NEW_REPRESENTATION:"newRepresentation",PLAY_ERROR:"playError"},i={FLV_MOVIE:"flv",FLV_SEGMENTED:"flv/segmented",MP4_MOVIE:"mp4",MP4_SEGMENTED:"mp4/segmented",HLS:"hls",VTT:"text/vtt"},o=function(){var e={};function t(t,n,r){r=isNaN(+r)?0:Math.max(-2,Math.min(2,+r)),e||(e={}),e[t]||(e[t]=[]);for(var a=e[t],i=0;a[i]&&a[i].priority>r;)++i;a.splice(i,0,{callback:n,priority:r})}function n(t,n){if(e&&e[t]){for(var r=0;r<e[t].length;++r)e[t][r].callback===n&&e[t].splice(r--,1);e[t].length||delete e[t]}}function r(t){return e&&e.hasOwnProperty(t)?e[t].length:0}function a(t,n){for(var r=0;e&&e[t]&&r<e[t].length;++r)if(e[t][r].callback===n)return!0;return!1}return{addListener:t,removeListener:n,hasListener:function(t){return e&&e.hasOwnProperty(t)&&!!e[t].length},listenerCount:r,allListenerCount:function(){return e?Object.getOwnPropertyNames(e).map(r).reduce((function(e,t){return e+t}),0):0},on:t,off:n,dispatch:function(t,n){if(e&&e[t]){var r,i=[];for(r=0;r<e[t].length;++r)i.push(e[t][r].callback);for(r=0;r<i.length;++r)a(t,i[r])&&i[r](n)}},cleanup:function(){e=null},MINIMUM_PRIORITY:-2,MAXIMUM_PRIORITY:2}},s={FATAL:100,ERROR:200,WARN:300,INFO:400,DEBUG:500},d=o(),u={LOG:"log"};function c(e,t,n,r){var a=new Date;if(d.hasListener(u.LOG)){var i={timestamp:a,source:e,line:t,data:n,level:r};d.dispatch(u.LOG,i)}}var l={create:function(e){return{debug:function(t,n){c(e,t,n,s.DEBUG)},info:function(t,n){c(e,t,n,s.INFO)},warn:function(t,n){c(e,t,n,s.WARN)},error:function(t,n){c(e,t,n,s.ERROR)},fatal:function(t,n){c(e,t,n,s.FATAL)}}},log:c,getStack:function(){return(new Error).stack.split("\n").slice(2).map((function(e){return e.substr(7)}))},events:u,levels:s,addListener:function(e,t){d.addListener(e,t)},removeListener:function(e,t){d.removeListener(e,t)},cleanup:function(){d.cleanup()}},f="Controller.finished",m="Controller.streamURL",g="Controller.addBuffer",p="Controller.removeBuffer",v="Controller.requestSegment",h="Controller.loadSegment",E="Controller.abortDownload",y="Controller.contentMoved",b="Controller.broadcasterTimeUpdate",T="Controller.requestKeyFramePosition",S="Controller.cancelKeyFrameRequest",I="Controller.switchStream",L="Controller.cancelStreamSwitch",A="Controller.missingRapAtPoint",O="Controller.canNotCreateUrl",P="Controller.newRepresentation",D="Controller.qualityChangeStarted",R="Controller.qualityChangeCompleted",_="Controller.qualityChangeCancelled",C="Controller.languageChangeStarted",w="Controller.languageChangeCompleted",N="Controller.languageChangeCancelled",U="Controller.atlasFullyInitialized",M="Debug.log",k="SegmentDownloader.loadInit",F="SegmentDownloader.loadStart",V="SegmentDownloader.loadComplete",j="SegmentDownloader.raw",x="SegmentDownloader.segment",B="SegmentDownloader.emptySegment",Z="SegmentDownloader.config",H="SegmentDownloader.failed",G="SegmentDownloader.destroy",Y="StorageManager.eosPositionDetected",K="StorageManager.segmentStorageCreated",W="StorageManager.segmentStorageUpdated",z="SegmentStorage.segmentMissing",Q="SegmentStorage.segmentMissingById",q="SegmentStorage.keyFramePosition",X="SegmentStorage.segmentChange",$="VideoPlayer",J={BASE:$,ERROR:"".concat($,".error"),POSITION:"".concat($,".position"),BUFFERED:"".concat($,".buffered"),BUFFER_EMPTY:"".concat($,".bufferEmpty"),BUFFER_FULL:"".concat($,".bufferFull"),SEEK_COMPLETED:"".concat($,".seekCompleted"),STREAM_INFO:"".concat($,".streamInfo"),THROTTLE:"".concat($,".throttle"),RENDERER_CHANGE:"".concat($,".rendererChange"),CC_DETECTED:"".concat($,".ccDetected"),AUDIO_TRACKS:"".concat($,".audioTracks"),TEXT_TRACKS:"".concat($,".textTracks"),RESIZE:"".concat($,".resize"),UNRECOVERED_STALLED:"".concat($,".unrecoveredStalled"),PLAY_ERROR:"".concat($,".playError"),WEBKIT_SUPPORTS_FULLSCREEN:"".concat($,".webkitSupportsFullscreen")},ee={ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",DURATION_CHANGE:"durationchange",EMPTIED:"emptied",ENCRYPTED:"encrypted",ENDED:"ended",ERROR:"error",INTERRUPT_BEGIN:"interruptbegin",INTERRUPT_END:"interruptend",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",LOAD_START:"loadstart",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechange",SEEKED:"seeked",SEEKING:"seeking",STALLED:"stalled",SUSPEND:"suspend",TIME_UPDATE:"timeupdate",VOLUME_CHANGE:"volumechange",WAITING:"waiting",WEBKIT_ENTER_FULLSCREEN:"webkitenterfullscreen",WEBKIT_END_FULLSCREEN:"webkitendfullscreen"},te={BASE:"videoTagProxyEvents"};for(var ne in ee)ee.hasOwnProperty(ne)&&(te[ne]="videoTagProxyEvents."+ee[ne]);var re=te,ae="Buffer.streamSwitch",ie="Buffer.bufferClear",oe="Buffer.bufferUpdating",se="Buffer.bufferUpdated",de="Buffer.append",ue="Buffer.remove",ce="Buffer.purge",le="BufferManager.bufferAdded",fe="BufferManager.bufferRemoved",me="BufferManager.appendToBuffer",ge=l.create("Facade"),pe=o(),ve=[y,b,M,k,F,G,x,B,j,Z,K,X,J.POSITION,J.BUFFERED,J.STREAM_INFO,oe,se,de,me,re.PROGRESS,re.TIME_UPDATE],he={dispatch:function(e,t,n){0!==t.indexOf("Flash:")&&(t="Js:"+t),-1===ve.indexOf(e)&&ge.debug("dispatch : "+e+" from "+t+" to "+pe.listenerCount(e)+" listener(s)",n);var r={type:e,originId:t,data:n};pe.dispatch(r.type,r);var a=r.type.split(".");for(a.push("*");a.length>1;)a.splice(a.length-2,1),pe.dispatch(a.join("."),r)},addListener:function(e,t,n){void 0!==e?pe.addListener(e,t,n):ge.warn("undefined event type listener adding is prohibited")},removeListener:function(e,t){pe.removeListener(e,t)},validateNotificationData:function(e,t){for(var n=[],r=0;t&&r<t.length;++r)void 0===e.data[t[r]]&&n.push(t[r]);if(n.length)throw ge.error("missing data from notification ("+n.join(", ")+")",e),new Error("Missing data from notification ("+n.join(", ")+")")},allListenerCount:function(){return pe.allListenerCount()},cleanup:function(){pe.cleanup()},MINIMUM_PRIORITY:pe.MINIMUM_PRIORITY,MAXIMUM_PRIORITY:pe.MAXIMUM_PRIORITY},Ee={MINIMUM_REMAINING_THRESHOLD:"minimumRemainingThreshold",MOVING_WINDOW_INTERVAL_DELAY:"movingWindowIntervalDelay",CONCURRENT_DOWNLOAD_COUNT:"concurrentDownloadCount",COLDSTART_THRESHOLD:"coldstartThreshold",BUFFER_COLLECT_DELAY_IN_MILLISEC:"bufferCollectTimeoutInMillisec",QUALITY_SWITCH_BUFFER_THRESHOLD:"qualitySwitchBufferThreshold",VIDEO_TAG_ATTRIBUTES:"videoTagAttributes",CHUNK_PRELOAD_COUNT:"chunkPreloadCount",MEMORY_LIMIT_IN_BYTES:"memoryLimitInBytes",FLASH_PROXY_URL_PLAIN:"flashProxyUrlPlain",FLASH_PROXY_URL_SECURE:"flashProxyUrlSecure",RENDER_TEXT_TRACKS_NATIVELY:"renderTextTracksNatively",HIDE_NATIVE_TRACKS:"hideNativeTracks"},ye={};ye[Ee.MINIMUM_REMAINING_THRESHOLD]=5e3,ye[Ee.MOVING_WINDOW_INTERVAL_DELAY]=500,ye[Ee.CONCURRENT_DOWNLOAD_COUNT]=2,ye[Ee.COLDSTART_THRESHOLD]=1e3,ye[Ee.BUFFER_COLLECT_DELAY_IN_MILLISEC]=1500,ye[Ee.QUALITY_SWITCH_BUFFER_THRESHOLD]=2e3,ye[Ee.VIDEO_TAG_ATTRIBUTES]=null,ye[Ee.CHUNK_PRELOAD_COUNT]=5,ye[Ee.MEMORY_LIMIT_IN_BYTES]=134217728,ye[Ee.RENDER_TEXT_TRACKS_NATIVELY]=!0,ye[Ee.HIDE_NATIVE_TRACKS]=!1;var be,Te=ye,Se="AtlasAPI",Ie={BASE:Se,PAUSE:"".concat(Se,".pause"),RESUME:"".concat(Se,".resume"),PLAYBACK_SPEED:"".concat(Se,".playbackSpeed"),SEEK:"".concat(Se,".seek"),SET_OPTION:"".concat(Se,".setOption"),UPDATE_HASHES:"".concat(Se,".updateHashes"),VOLUME:"".concat(Se,".volume"),CAPTIONS:"".concat(Se,".captions"),CAPTION_POSITION:"".concat(Se,".captionPosition"),SELECT_AUDIO:"".concat(Se,".selectAudio"),SUSPEND:"".concat(Se,".suspend"),WAKE:"".concat(Se,".wake"),CLEANUP:"".concat(Se,".cleanup"),UPDATE_OPTIONS:"".concat(Se,".updateOptions"),SET_MAX_MEMORY_USAGE:"".concat(Se,".setMaxMemoryUsage")},Le="Options",Ae=l.create(Le);function Oe(e){return be?be[e]:void 0}function Pe(e){return"number"==typeof e&&e>0&&e<1/0}var De={init:function(){be||(be=Object.assign({},Te))},get:Oe,set:function(e,t,n){if(be[e]===t)return!1;var r,a,i=!0;switch(e){case Ee.MINIMUM_REMAINING_THRESHOLD:i=function(e){return!!Pe(e)&&(be[Ee.MINIMUM_REMAINING_THRESHOLD]=e,!0)}(t);break;case Ee.MOVING_WINDOW_INTERVAL_DELAY:i=function(e,t){return!(t||!Pe(e)||(be[Ee.MOVING_WINDOW_INTERVAL_DELAY]=e,0))}(t,n);break;case Ee.CONCURRENT_DOWNLOAD_COUNT:i=function(e){return!!Pe(e)&&(be[Ee.CONCURRENT_DOWNLOAD_COUNT]=e,!0)}(t);break;case Ee.QUALITY_SWITCH_BUFFER_THRESHOLD:i=function(e){return!(!Pe(e)&&0!==e||(be[Ee.QUALITY_SWITCH_BUFFER_THRESHOLD]=e,0))}(t);break;case Ee.VIDEO_TAG_ATTRIBUTES:i=function(e){return be[Ee.VIDEO_TAG_ATTRIBUTES]=e,!0}(t);break;case Ee.CHUNK_PRELOAD_COUNT:i=function(e){return!!Pe(e)&&(e>20&&Ae.warn('"'+Ee.CHUNK_PRELOAD_COUNT+'" is too high, the recommended maximum is 20'),be[Ee.CHUNK_PRELOAD_COUNT]=e,!0)}(t);break;case Ee.MEMORY_LIMIT_IN_BYTES:i=function(e){if(!Pe(e))return!1;var t=5242880,n=1073741824;return e<t?Ae.warn('"'+Ee.MEMORY_LIMIT_IN_BYTES+'" is too low, the recommended minimum is '+t):e>n&&Ae.warn('"'+Ee.MEMORY_LIMIT_IN_BYTES+'" is too high, the recommended maximum is '+n),be[Ee.MEMORY_LIMIT_IN_BYTES]=e,!0}(t);break;default:be[e]=t}return i&&(r=Ie.SET_OPTION,a={name:e,value:Oe(e),externalCall:n},he.dispatch(r,Le,a)),i},cleanup:function(){be=!1}},Re={},_e="MSEProxy.sourceObjectURL",Ce="MSEProxy.sourceOpen",we="MSEProxy.sourceClose",Ne="MSEProxy.sourceBufferAdded",Ue="MSEProxy.sourceBufferRemoved";function Me(e,t){for(var n=0;t&&n<t.length;++n)if(t[n].start<=e&&t[n].end>=e)return t[n];return null}var ke={buffered:function(e){for(var t=[],n=0;n<e.length;++n)t.push({start:Math.floor(1e3*e.start(n)),end:Math.floor(1e3*e.end(n))});return t},current:Me,next:function(e,t){for(var n=0;n<t.length&&!(t[n].start>e);)n++;return n<t.length?t[n]:null},remaining:function(e,t){var n=Me(e,t);return n?n.end-e:0},remainingTotal:function(e,t){for(var n=0,r=0;r<t.length;++r)t[r].end>e&&(n+=t[r].end-Math.max(t[r].start,e));return n},intersect:function(e,t){if(!e&&!t)return[];if(e&&!t)return e;for(var n=0,r=0,a=[];n<e.length&&r<t.length;){var i=Math.max(e[n].start,t[r].start),o=Math.min(e[n].end,t[r].end);i<o&&a.push({start:i,end:o}),e[n].end<t[r].end?n++:(t[r].end<e[n].end||n++,r++)}return a}},Fe=function(e){var t=[];function n(){for(;e&&t&&t.length;)e.removeEventListener(t[0].type,t[0].closure),t.shift()}return{addListener:function(n,r){t&&(t.push({type:n,closure:r}),e&&e.addEventListener(n,r))},removeListener:function(n,r){for(var a=0;t&&a<t.length;++a)t[a].type===n&&t[a].closure===r&&(t.splice(a--,1),e&&e.removeEventListener(n,r))},clearListeners:n,setTarget:function(n){!function(){for(var n=0;e&&t&&n<t.length;++n)e.removeEventListener(t[n].type,t[n].closure)}(),e=n,function(){for(var n=0;e&&t&&n<t.length;++n)e.addEventListener(t[n].type,t[n].closure)}()},destroy:function(){n(),t=null,e=null}}},Ve="bytes",je="remove",xe="purge";function Be(e,t){he.dispatch(e,"ActionQueue",t)}var Ze="Component.create",He="Component.destroy";function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Ye="undefined",Ke="Shockwave Flash",We="application/x-shockwave-flash",ze=navigator,Qe=ze.mimeTypes,qe=ze.userAgent.toLowerCase(),Xe=ze.platform.toLowerCase();function $e(){var e=/android/i.test(qe);return e&&(e=qe.match(/android (\d+)(?:\.(\d+))?(?:\.(\d+))?/i)).shift(),e}function Je(){var e=/iphone|ipad|ipod/.test(qe);return e&&(e=qe.match(/os (\d*)?\_?(\d*)?\_?(\d*)/i)).shift(),e}function et(){return/BB10(.*)Mobile/i.test(qe)}function tt(){return qe.indexOf("playstation")>-1}function nt(){var e=/chrome/i.test(qe);return e&&!rt()&&(e=qe.match(/chrome\/(\d*)\.(\d*)?\.?(\d*)/i)).shift(),e}function rt(){var e=!1;return void 0!==window.opera&&"[object Opera]"===window.opera.toString()?e=window.opera.version().split("."):navigator&&(e=qe.match(/opr\/(\d+)\.(\d+)\.(\d+)\.(\d+)/i)),e}function at(){var e,t;if(Ge(window.ActiveXObject)===Ye)return!1;try{if(e=new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!(t=e.GetVariable("$version"))||(t=t.split(" ")[1].split(","),[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)])}catch(e){}return!1}var it,ot,st,dt,ut={win:/win/.test(Xe||qe),mac:/mac/.test(Xe||qe),desktop:!($e()||Je()||et()||tt()),ios:Je(),android:$e(),blackberry:et(),playstation:tt(),chrome:nt(),opera:rt(),ff:/firefox/.test(qe),safari:/safari/.test(qe)&&!nt()&&!rt(),ie:(dt=document.getElementsByTagName("html")[0].className.indexOf("ie ")>-1,dt||(dt=qe.indexOf("trident")>-1),dt),ssl:/https/.test(location.protocol),swf:(st=[0,0,0],Ge(ze.plugins)!==Ye&&"object"===Ge(ze.plugins[Ke])?!(ot=ze.plugins[Ke].description)||Ge(Qe)!==Ye&&Qe[We]&&!Qe[We].enabledPlugin||(ot=ot.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),st[0]=+ot.replace(/^(.*)\..*$/,"$1"),st[1]=+ot.replace(/^.*\.(.*)\s.*$/,"$1"),st[2]=/[a-zA-Z]/.test(ot)?+ot.replace(/^.*[a-zA-Z]+(.*)$/,"$1"):0):at()&&(st=at()),"000"===st.join("")&&(st=!1),st),flashPPAPI:(it=Qe&&Qe[We]&&Qe[We].enabledPlugin&&Qe[We].enabledPlugin.filename||"","pepflashplayer.dll"===(it=it.toLowerCase())||"libpepflashplayer.so"===it||"pepperflashplayer.plugin"===it||"chrome.plugin"===it.slice(-13)),flashActiveX:at(),nav:{appCodeName:ze.appCodeName,appName:ze.appName,appVersion:ze.appVersion,cpuClass:ze.cpuClass,platform:ze.platform,product:ze.product,userAgent:ze.userAgent,vendor:ze.vendor,vendorSub:ze.vendorSub}},ct=4294967295,lt="4.0.4",ft="MSEProxy",mt=l.create(ft),gt="sourceopen",pt="sourceclose",vt=window.MediaSource||window.WebKitMediaSource;function ht(e,t){he.dispatch(e,ft,t)}function Et(){return!!vt}mt.info(ut.nav.appName+" "+ut.nav.appVersion);var yt=function(e){var t,n,r={};function a(){he.removeListener(Ie.SUSPEND,a),he.addListener(Ie.WAKE,i),u()}function i(){he.removeListener(Ie.WAKE,i),he.addListener(Ie.SUSPEND,a),d()}function o(e){he.validateNotificationData(e,["bufferId","contentType"]);var t=e.data.contentType.indexOf("vtt")>-1;r[e.data.bufferId]||t?t||mt.warn("there is already a sourceBuffer for "+e.data.bufferId):(r[e.data.bufferId]=function(e,t){var n=l.create("ActionQueue."+t),r=[],a=!1,i=Fe(e);function o(){he.removeListener(J.ERROR,p),he.removeListener(de,d),he.removeListener(ue,u),he.removeListener(ce,c),he.removeListener(we,o),he.removeListener(fe,s),i.destroy(),r=null}function s(e){he.validateNotificationData(e,["bufferId"]),e.data.bufferId===t&&o()}function d(e){he.validateNotificationData(e,["streamId","bufferId","start","end","duration","bytes"]),e.data.bufferId===t&&f({streamId:e.data.streamId,type:Ve,start:e.data.start,end:e.data.end,duration:e.data.duration,bytes:e.data.bytes})}function u(e){he.validateNotificationData(e,["streamId","bufferId","start","end"]),e.data.bufferId===t&&f({streamId:e.data.streamId,type:je,start:e.data.start,end:e.data.end})}function c(e){he.validateNotificationData(e,["streamId","bufferId"]),e.data.bufferId===t&&f({streamId:e.data.streamId,type:xe})}function f(e){a?(e.type===xe&&(r=[]),r.push(e)):m(e)}function m(i){var o="execute action";switch(i.type){case Ve:n.debug(o,{streamId:i.streamId,type:i.type,start:i.start,end:i.end,duration:i.duration,length:i.bytes.length}),e.appendBuffer(i.bytes);break;case je:n.debug(o,{streamId:i.streamId,type:i.type,start:i.start,end:i.end}),e.remove(i.start/1e3,i.end/1e3);break;case xe:if(n.debug(o,{streamId:i.streamId,type:i.type,bufferedLength:e.buffered.length,actionsLength:r.length}),!e.buffered.length)return void g();e.remove(e.buffered.start(0),e.buffered.end(e.buffered.length-1))}a||(a=!0,Be(oe,{bufferId:t}))}function g(){r.length?m(r.shift()):(a=!1,Be(se,{bufferId:t,ranges:ke.buffered(e.buffered)}))}function p(){r=[],a=!1,n.error("onVideoTagError")}return he.addListener(J.ERROR,p),he.addListener(de,d),he.addListener(ue,u),he.addListener(ce,c),he.addListener(we,o),he.addListener(fe,s),i.addListener("updateend",g),i.addListener("error",(function(){r=[],n.error("onError")})),i.addListener("abort",(function(){n.warn("abort")})),{bufferId:t,sourceBuffer:e}}(n.addSourceBuffer(e.data.contentType),e.data.bufferId),mt.debug("created sourceBuffer for "+e.data.bufferId),ht(Ne,{bufferId:e.data.bufferId}))}function s(e){if(he.validateNotificationData(e,["bufferId"]),r[e.data.bufferId]){try{n.removeSourceBuffer(r[e.data.bufferId].sourceBuffer)}catch(e){}delete r[e.data.bufferId],ht(Ue,{bufferId:e.data.bufferId})}else mt.warn("there is no sourceBuffer for "+e.data.bufferId)}function d(){n=new vt,t.setTarget(n),ht(_e,{source:URL.createObjectURL(n)})}function u(){n=null,r={},ht(we)}function c(t){switch(mt.debug("onMediaSourceEvent",t),t.type){case gt:n.duration=e&&e<1/0?e/1e3:ct,ht(Ce);break;case pt:for(var a in r)r.hasOwnProperty(a)&&(ht(Ue,{bufferId:r[a].bufferId}),delete r[a]);ht(we)}}return mt.debug("create"),(t=Fe()).addListener(gt,c),t.addListener("sourceended",c),t.addListener(pt,c),d(),he.addListener(le,o),he.addListener(fe,s),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(le,o),he.removeListener(fe,s),he.removeListener(Ie.CLEANUP,e),he.removeListener(Ie.SUSPEND,a),he.removeListener(Ie.WAKE,i),u(),t.destroy(),t=null,ht(He)})),he.addListener(Ie.SUSPEND,a),ht(Ze),{name:ft}},bt=Et(),Tt=function(e){return!!Et()&&vt.isTypeSupported(e)},St=function(){var e,t,n,r,a,i,o="undefined",s="object",d="Shockwave Flash",u="application/x-shockwave-flash",c="SWFObjectExprInst",l="onreadystatechange",f=window,m=document,g=navigator,p=!1,v=[],h=[],E=[],y=[],b=!1,T=!1,S=!0,I=!1,L=function(){var e=typeof m.getElementById!==o&&typeof m.getElementsByTagName!==o&&typeof m.createElement!==o,t=g.userAgent.toLowerCase(),n=g.platform.toLowerCase(),r=/win/.test(n||t),a=/mac/.test(n||t),i=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),c="Microsoft Internet Explorer"===g.appName,l=[0,0,0],v=null;if(typeof g.plugins!==o&&typeof g.plugins[d]===s)(v=g.plugins[d].description)&&typeof g.mimeTypes!==o&&g.mimeTypes[u]&&g.mimeTypes[u].enabledPlugin&&(p=!0,c=!1,v=v.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),l[0]=x(v.replace(/^(.*)\..*$/,"$1")),l[1]=x(v.replace(/^.*\.(.*)\s.*$/,"$1")),l[2]=/[a-zA-Z]/.test(v)?x(v.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof f.ActiveXObject!==o)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");h&&(v=h.GetVariable("$version"))&&(c=!0,l=[x((v=v.split(" ")[1].split(","))[0]),x(v[1]),x(v[2])])}catch(e){}return{w3:e,pv:l,wk:i,ie:c,win:r,mac:a}}();function A(){if(!b&&document.getElementsByTagName("body")[0]){try{var e,t=j("span");t.style.display="none",(e=m.getElementsByTagName("body")[0].appendChild(t)).parentNode.removeChild(e),e=null,t=null}catch(e){return}b=!0;for(var n=v.length,r=0;r<n;r++)v[r]()}}function O(e){b?e():v[v.length]=e}function P(){var e=h.length;if(e>0)for(var t=0;t<e;t++){var n=h[t].id,r=h[t].callbackFn,a={success:!1,id:n};if(L.pv[0]>0){var i=V(n);if(i)if(!B(h[t].swfVersion)||L.wk&&L.wk<312)if(h[t].expressInstall&&R()){var s={};s.data=h[t].expressInstall,s.width=i.getAttribute("width")||"0",s.height=i.getAttribute("height")||"0",i.getAttribute("class")&&(s.styleclass=i.getAttribute("class")),i.getAttribute("align")&&(s.align=i.getAttribute("align"));for(var d={},u=i.getElementsByTagName("param"),c=u.length,l=0;l<c;l++)"movie"!==u[l].getAttribute("name").toLowerCase()&&(d[u[l].getAttribute("name")]=u[l].getAttribute("value"));_(s,d,n,r)}else C(i),r&&r(a);else H(n,!0),r&&(a.success=!0,a.ref=D(n),a.id=n,r(a))}else if(H(n,!0),r){var f=D(n);f&&typeof f.SetVariable!==o&&(a.success=!0,a.ref=f,a.id=f.id),r(a)}}}function D(e){var t=null,n=V(e);return n&&"OBJECT"===n.nodeName.toUpperCase()&&(t=typeof n.SetVariable!==o?n:n.getElementsByTagName(s)[0]||n),t}function R(){return!T&&B("6.0.65")&&(L.win||L.mac)&&!(L.wk&&L.wk<312)}function _(a,i,s,d){var u=V(s);if(s=F(s),T=!0,n=d||null,r={success:!1,id:s},u){"OBJECT"===u.nodeName.toUpperCase()?(e=w(u),t=null):(e=u,t=s),a.id=c,(typeof a.width===o||!/%$/.test(a.width)&&x(a.width)<310)&&(a.width="310"),(typeof a.height===o||!/%$/.test(a.height)&&x(a.height)<137)&&(a.height="137");var l=L.ie?"ActiveX":"PlugIn",g="MMredirectURL="+encodeURIComponent(f.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+l+"&MMdoctitle="+encodeURIComponent(m.title.slice(0,47)+" - Flash Player Installation");if(typeof i.flashvars!==o?i.flashvars+="&"+g:i.flashvars=g,L.ie&&4!=u.readyState){var p=j("div");s+="SWFObjectNew",p.setAttribute("id",s),u.parentNode.insertBefore(p,u),u.style.display="none",M(u)}N(a,i,s)}}function C(e){if(L.ie&&4!=e.readyState){e.style.display="none";var t=j("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(w(e),t),M(e)}else e.parentNode.replaceChild(w(e),e)}function w(e){var t=j("div");if(L.win&&L.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(s)[0];if(n){var r=n.childNodes;if(r)for(var a=r.length,i=0;i<a;i++)1==r[i].nodeType&&"PARAM"===r[i].nodeName||8==r[i].nodeType||t.appendChild(r[i].cloneNode(!0))}}return t}function N(e,t,n){var r,a,i,d,c=V(n);if(n=F(n),L.wk&&L.wk<312)return r;if(c){var l,f,m,g=L.ie?j("div"):j(s);for(m in typeof e.id===o&&(e.id=n),t)t.hasOwnProperty(m)&&"movie"!==m.toLowerCase()&&U(g,m,t[m]);for(l in L.ie&&(a=e.data,i=g.innerHTML,(d=j("div")).innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+a+"'>"+i+"</object>",g=d.firstChild),e)e.hasOwnProperty(l)&&("styleclass"===(f=l.toLowerCase())?g.setAttribute("class",e[l]):"classid"!==f&&"data"!==f&&g.setAttribute(l,e[l]));L.ie?E[E.length]=e.id:(g.setAttribute("type",u),g.setAttribute("data",e.data)),c.parentNode.replaceChild(g,c),r=g}return r}function U(e,t,n){var r=j("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function M(e){var t=V(e);t&&"OBJECT"===t.nodeName.toUpperCase()&&(L.ie?(t.style.display="none",function e(){if(4==t.readyState){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}else setTimeout(e,10)}()):t.parentNode.removeChild(t))}function k(e){return e&&e.nodeType&&1===e.nodeType}function F(e){return k(e)?e.id:e}function V(e){if(k(e))return e;var t=null;try{t=m.getElementById(e)}catch(e){}return t}function j(e){return m.createElement(e)}function x(e){return parseInt(e,10)}function B(e){e+="";var t=L.pv,n=e.split(".");return n[0]=x(n[0]),n[1]=x(n[1])||0,n[2]=x(n[2])||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]}function Z(e,t,n,r){var s=m.getElementsByTagName("head")[0];if(s){var d="string"==typeof n?n:"screen";if(r&&(a=null,i=null),!a||i!=d){var u=j("style");u.setAttribute("type","text/css"),u.setAttribute("media",d),a=s.appendChild(u),L.ie&&typeof m.styleSheets!==o&&m.styleSheets.length>0&&(a=m.styleSheets[m.styleSheets.length-1]),i=d}a&&(typeof a.addRule!==o?a.addRule(e,t):typeof m.createTextNode!==o&&a.appendChild(m.createTextNode(e+" {"+t+"}")))}}function H(e,t){if(S){var n=t?"visible":"hidden",r=V(e);b&&r?r.style.visibility=n:"string"==typeof e&&Z("#"+e,"visibility:"+n)}}function G(e){return null!==/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!==o?encodeURIComponent(e):e}return L.w3&&((typeof m.readyState!==o&&("complete"===m.readyState||"interactive"===m.readyState)||typeof m.readyState===o&&(m.getElementsByTagName("body")[0]||m.body))&&A(),b||(typeof m.addEventListener!==o&&m.addEventListener("DOMContentLoaded",A,!1),L.ie&&(m.attachEvent(l,(function e(){"complete"===m.readyState&&(m.detachEvent(l,e),A())})),f==top&&function e(){if(!b){try{m.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}A()}}()),L.wk&&function e(){b||(/loaded|complete/.test(m.readyState)?A():setTimeout(e,0))}())),v[0]=function(){p?function(){var e=m.getElementsByTagName("body")[0],t=j(s);t.setAttribute("style","visibility: hidden;"),t.setAttribute("type",u);var n=e.appendChild(t);if(n){var r=0;!function a(){if(typeof n.GetVariable!==o)try{var i=n.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),L.pv=[x(i[0]),x(i[1]),x(i[2])])}catch(e){L.pv=[8,0,0]}else if(r<10)return r++,void setTimeout(a,10);e.removeChild(t),n=null,P()}()}else P()}():P()},L.ie&&window.attachEvent("onunload",(function(){for(var e=y.length,t=0;t<e;t++)y[t][0].detachEvent(y[t][1],y[t][2]);for(var n=E.length,r=0;r<n;r++)M(E[r]);for(var a in L)L[a]=null;for(var i in L=null,St)St[i]=null;St=null})),{registerObject:function(e,t,n,r){if(L.w3&&e&&t){var a={};a.id=e,a.swfVersion=t,a.expressInstall=n,a.callbackFn=r,h[h.length]=a,H(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(L.w3)return D(e)},embedSWF:function(e,t,n,r,a,i,d,u,c,l){var f=F(t),m={success:!1,id:f};L.w3&&!(L.wk&&L.wk<312)&&e&&t&&n&&r&&a?(H(f,!1),O((function(){n+="",r+="";var g={};if(c&&typeof c===s)for(var p in c)g[p]=c[p];g.data=e,g.width=n,g.height=r;var v={};if(u&&typeof u===s)for(var h in u)v[h]=u[h];if(d&&typeof d===s)for(var E in d)if(d.hasOwnProperty(E)){var y=I?encodeURIComponent(E):E,b=I?encodeURIComponent(d[E]):d[E];typeof v.flashvars!==o?v.flashvars+="&"+y+"="+b:v.flashvars=y+"="+b}if(B(a)){var T=N(g,v,t);g.id==f&&H(f,!0),m.success=!0,m.ref=T,m.id=T.id}else{if(i&&R())return g.data=i,void _(g,v,t,l);H(f,!0)}l&&l(m)}))):l&&l(m)},switchOffAutoHideShow:function(){S=!1},enableUriEncoding:function(e){I=typeof e===o||e},ua:L,getFlashPlayerVersion:function(){return{major:L.pv[0],minor:L.pv[1],release:L.pv[2]}},hasFlashPlayerVersion:B,createSWF:function(e,t,n){return L.w3?N(e,t,n):void 0},showExpressInstall:function(e,t,n,r){L.w3&&R()&&_(e,t,n,r)},removeSWF:function(e){L.w3&&M(e)},createCSS:function(e,t,n,r){L.w3&&Z(e,t,n,r)},addDomLoadEvent:O,addLoadEvent:function(e){if(typeof f.addEventListener!==o)f.addEventListener("load",e,!1);else if(typeof m.addEventListener!==o)m.addEventListener("load",e,!1);else if(typeof f.attachEvent!==o)!function(e,t,n){e.attachEvent(t,n),y[y.length]=[e,t,n]}(f,"onload",e);else if("function"==typeof f.onload){var t=f.onload;f.onload=function(){t(),e()}}else f.onload=e},getQueryParamValue:function(e){var t=m.location.search||m.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),!e)return G(t);for(var n=t.split("&"),r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return G(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(T){var a=V(c);a&&e&&(a.parentNode.replaceChild(e,a),t&&(H(t,!0),L.ie&&(e.style.display="block")),n&&n(r)),T=!1}},version:"2.3"}}(),It=St,Lt=function(e,t,n,r){var a,i="",o="";if((void 0===t||t)&&(i+="abcdefghijklmnopqrstuvwxyz"),n&&(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),r&&(i+="0123456789"),i.length)for(a=0;a<e;++a)o+=i.substr(Math.floor(i.length*Math.random()),1);return o},At=function(e,t){for(var n="0";n.length<t;)n+=n;return(n+e).substr(-t,t)},Ot="FlashProxy",Pt="window.ustream.",Dt=l.create(Ot);function Rt(e,t){he.dispatch(e,Ot,t)}Dt.info("FlashPlayer version",{version:ut.swf});var _t=ut.swf[0]>=11&&!ut.safari,Ct="videoTagHandler.pause",wt="videoTagHandler.play",Nt="videoTagHandler.seek",Ut="coldStart";function Mt(e,t){he.dispatch(e,Ut,t)}var kt=function(){var e=l.create(Ut),t=!1;function n(){he.addListener(re.LOADED_METADATA,a),he.addListener(re.CAN_PLAY_THROUGH,c),he.addListener(re.DURATION_CHANGE,d)}function r(){he.removeListener(re.LOADED_METADATA,a),he.removeListener(re.CAN_PLAY_THROUGH,c),he.removeListener(re.DURATION_CHANGE,d),he.removeListener(re.PROGRESS,u)}function a(){he.removeListener(re.LOADED_METADATA,a),ut.ios&&Mt(wt)}function i(){he.removeListener(re.TIME_UPDATE,i),t=!0}function o(){t||(he.removeListener(re.TIME_UPDATE,i),r()),he.removeListener(Ie.SUSPEND,o),he.addListener(Ie.WAKE,s)}function s(){he.removeListener(Ie.WAKE,s),he.addListener(Ie.SUSPEND,o),t||(he.addListener(re.TIME_UPDATE,i),n())}function d(t){e.debug("onDurationChange"),he.removeListener(re.DURATION_CHANGE,d),f(t)||he.addListener(re.PROGRESS,u)}function u(t){e.debug("onProgress"),f(t)}function c(){r(),Mt(wt)}function f(t){he.validateNotificationData(t,["buffered"]);var n=ke.remainingTotal(0,t.data.buffered,!0),r=De.get(Ee.COLDSTART_THRESHOLD);return e.debug("checkBufferOnColdStart",{buffered:t.data.buffered,remaining:n}),n>r&&n<1/0&&(e.info("buffer full, starting playback"),c(),!0)}return he.addListener(Ie.CLEANUP,(function e(){he.removeListener(Ie.CLEANUP,e),he.removeListener(Ie.SUSPEND,o),he.removeListener(Ie.WAKE,s),he.removeListener(re.TIME_UPDATE,i),r(),t=!1,Mt(He)})),he.addListener(Ie.SUSPEND,o),he.addListener(re.TIME_UPDATE,i),n(),{name:Ut}},Ft="buffercollector";function Vt(e,t){he.dispatch(e,Ft,t)}var jt=function(){var e,t=l.create(Ft),n=!1;function r(){n=!0}function a(){n=!1}function i(){n&&(t.debug("buffercollector - bufferempty stop stream (PAUSE)"),Vt(Ct),he.removeListener(re.PROGRESS,s),he.removeListener(re.TIME_UPDATE,s),he.addListener(re.PROGRESS,s),he.addListener(re.TIME_UPDATE,s))}function o(){t.debug("buffercollector - delay is over start stream (PLAY)"),Vt(wt)}function s(n){he.validateNotificationData(n,["position","buffered"]);var r=De.get(Ee.BUFFER_COLLECT_DELAY_IN_MILLISEC),a=ke.remainingTotal(n.data.position,n.data.buffered,!0);a>0&&a<1/0&&(t.debug("buffercollector - buffer collected, start delay"),e=setTimeout(o,r),he.removeListener(re.TIME_UPDATE,s),he.removeListener(re.PROGRESS,s))}return he.addListener(Ie.CLEANUP,(function t(){he.removeListener(Ie.CLEANUP,t),he.removeListener(re.WAITING,r),he.removeListener(re.PLAYING,a),he.removeListener(J.BUFFER_EMPTY,i),he.removeListener(re.PROGRESS,s),e=clearTimeout(e),Vt(He)})),he.addListener(re.WAITING,r),he.addListener(re.PLAYING,a),he.addListener(J.BUFFER_EMPTY,i),{name:Ft}},xt="mseBuffered";function Bt(e,t){he.dispatch(e,xt,t)}var Zt="GapRecovery.gapRecovering",Ht=ut.chrome||ut.safari,Gt=ut.safari,Yt="mseGapRecovery",Kt="gap detected";function Wt(e,t){he.dispatch(e,Yt,t)}var zt,Qt,qt=function(){var e=l.create("gapRecovery"),t=null,n=null,r=null,a=0;function i(){he.addListener(re.PROGRESS,s),he.addListener(re.STALLED,s)}function o(){he.removeListener(re.PROGRESS,s),he.removeListener(re.STALLED,s),he.removeListener(re.WAITING,u)}function s(i){he.validateNotificationData(i,["position","buffered"]),a=i.data.position;var o,s=ke.current(a,i.data.buffered),c=ke.next(a,i.data.buffered);if(r=c?c.start:null,!s&&c)e.warn(Kt),u();else if(s&&c&&n!==s.end){var l=(n=s.end)-a;e.warn(Kt,{playPosition:a,gapPosition:n,remainingUntilGap:l})}else null===n||c||(n=null,e.warn("gap cleared"));Ht&&(null!==n&&null!==r?(o=a,null===t&&(t=setTimeout(u,Math.max(0,n-o-66)))):d()),he.removeListener(re.WAITING,u),null!==n&&he.addListener(re.WAITING,u)}function d(){null!==t&&(clearInterval(t),t=null)}function u(){he.removeListener(re.WAITING,u),Ht&&d(),Wt(Zt,{position:r,gapLength:n?r-n:r-a}),Wt(Ct),Wt(Nt,{position:r}),Wt(wt),e.warn("gap recovered",{playPosition:r}),n=null,r=null}function c(){d(),o(),he.removeListener(Nt,f),he.addListener(Nt,f,he.MINIMUM_PRIORITY)}function f(){he.removeListener(Nt,f),i()}return he.addListener(Ie.CLEANUP,(function e(){he.removeListener(Ie.CLEANUP,e),he.removeListener(Ie.SEEK,c),o(),he.removeListener(Nt,f),d(),Wt(He)})),he.addListener(Ie.SEEK,c),i(),{name:Yt}},Xt="mseStalledRecovery";function $t(e,t){he.dispatch(e,Xt,t)}var Jt=function(){var e,t=l.create(Xt),n=void 0,r=0,a=!1;function i(){a=!0}function o(){a=!1}function s(){e&&d(),a?t.debug("The stalled events are not handled when the buffer is empty"):e=setTimeout(c,1e3)}function d(){e=clearTimeout(e)}function u(e){he.validateNotificationData(e,["start","end"]),(zt=zt||[]).push(e.data)}function c(){if($t(J.UNRECOVERED_STALLED,{position:n,remaining:r}),void 0===n||Re.isLive&&0===n)return t.warn("unrecovered stalled event, but no playPosition for repair seek"),void s();t.warn("unrecovered stalled event, dispatching seek for repair"),e=void 0;var a=De.get(Ee.MOVING_WINDOW_INTERVAL_DELAY);$t(Ie.SEEK,{position:n+a})}function f(e){he.validateNotificationData(e,["position"]),e.data.position>Qt&&(zt=void 0,y(),he.addListener(re.STALLED,g))}function m(e){e.data.position!==n&&d(),v(e)}function g(t){v(t),e||s()}function p(e){var r=function(e){if(!zt)return null;var t,n;for(n=0;n<zt.length;n++)if(e<=(t=zt[n]).end&&e>=t.start)return t;return null}(n);r?0!==r.start?$t(Ie.SEEK,{position:r.start-1}):t.warn("would have tried to seek before 0 position"):g(e)}function v(e){he.validateNotificationData(e,["position","remaining"]),n=e.data.position,r=e.data.remaining}function h(){he.removeListener(re.STALLED,g),d()}function E(){he.addListener(re.STALLED,g)}function y(){he.removeListener(A,u),he.removeListener(re.STALLED,p),he.removeListener(re.TIME_UPDATE,f)}function b(e){he.validateNotificationData(e,["position"]),d(),he.removeListener(re.STALLED,g),n=e.data.position,Qt=n,y(),he.addListener(A,u),he.addListener(re.STALLED,p),he.addListener(re.TIME_UPDATE,f)}return he.addListener(Ie.CLEANUP,(function e(){he.removeListener(Ie.CLEANUP,e),he.removeListener(Ie.PAUSE,h),he.removeListener(Ie.RESUME,E),he.removeListener(Ie.SEEK,b),he.removeListener(re.TIME_UPDATE,m),he.removeListener(re.STALLED,g),he.removeListener(J.BUFFER_EMPTY,i),he.removeListener(J.BUFFER_FULL,o),y(),d(),$t(He),a=!1})),he.addListener(Ie.PAUSE,h),he.addListener(Ie.RESUME,E),he.addListener(Ie.SEEK,b),he.addListener(re.TIME_UPDATE,m),he.addListener(re.STALLED,g),he.addListener(J.BUFFER_EMPTY,i),he.addListener(J.BUFFER_FULL,o),{name:Xt}},en="mseSeek";function tn(e,t){he.dispatch(e,en,t)}var nn=function(){var e=l.create(en),t=null,n=!1;function r(){he.addListener(re.TIME_UPDATE,s,he.MAXIMUM_PRIORITY),he.addListener(re.SEEKED,s,he.MAXIMUM_PRIORITY)}function a(){he.removeListener(re.TIME_UPDATE,s),he.removeListener(re.SEEKED,s)}function i(){n=!0}function o(e){he.validateNotificationData(e,["position"]),n||tn(Ie.SEEK,{position:e.data.position}),n=!1}function s(e){he.validateNotificationData(e,["position","remaining"]),tn(J.POSITION,{position:e.data.position,remaining:e.data.remaining})}function d(e){he.validateNotificationData(e,["position"]),t=e.data.position,a(),he.removeListener(re.PROGRESS,u),he.addListener(re.PROGRESS,u),tn(Ct)}function u(n){if(he.validateNotificationData(n,["buffered"]),ke.remainingTotal(t,n.data.buffered)>=250){var a=Math.max(n.data.buffered[0].start,t);e.debug("onVideoProgressAfterSeek seeking to "+a+", seekPosition: "+t),tn(Nt,{position:a}),tn(wt),r(),he.removeListener(re.PROGRESS,u),t=null}}return he.addListener(re.SEEKING,o),he.addListener(Ie.SEEK,d),he.addListener(Nt,i),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(re.SEEKING,o),he.removeListener(Ie.SEEK,d),he.removeListener(Nt,i),he.removeListener(Ie.CLEANUP,e),a(),he.removeListener(re.PROGRESS,u),n=!1,tn(He)})),r(),{name:en}},rn="directSeek";function an(e,t){he.dispatch(e,rn,t)}var on="directBuffered";function sn(e,t){he.dispatch(e,on,t)}var dn="directSeek";function un(e,t){he.dispatch(e,dn,t)}var cn="TextTrackProxy",ln={BASE:cn,EMPTY_CUE_ADDED:"".concat(cn,".emptyCueAdded"),TEXT_TRACK_ADDED:"".concat(cn,".textTrackAdded"),TEXT_TRACK_CUE_CHANGE:"".concat(cn,".textTrackCueChange")};function fn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return mn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function mn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var gn,pn,vn="VideoTagProxy",hn=l.create(vn);function En(e,t){he.dispatch(e,vn,t)}function yn(){if(gn)return gn;var e,t,n,r="atlas.".concat(Lt(3)),a=Promise.resolve(),i=!0,o=!0,s=!1;function d(){u(),l()}function u(){if(pn&&ut.ios){!function(){var e,t=fn(pn.textTracks);try{for(t.s();!(e=t.n()).done;)e.value.removeEventListener("cuechange",c)}catch(e){t.e(e)}finally{t.f()}}();var e,t=fn(pn.textTracks);try{for(t.s();!(e=t.n()).done;)e.value.addEventListener("cuechange",c)}catch(e){t.e(e)}finally{t.f()}}}function c(e){var t=De.get(Ee.RENDER_TEXT_TRACKS_NATIVELY),n=De.get(Ee.HIDE_NATIVE_TRACKS);if(t&&n){var r=e.target;En(ln.TEXT_TRACK_CUE_CHANGE,{cues:Array.from(r.cues),activeCues:Array.from(r.activeCues)})}}function l(){if(pn){var e=Array.from(pn.textTracks||[]).filter((function(e){return e.language})).map((function(e){var t=e.id,n=e.label,r=e.language,a=e.mode;return{id:t,label:n,language:r,mode:void 0===a?"disabled":a}}));En(J.TEXT_TRACKS,e)}}function g(){var e=Array.from(pn.audioTracks||[]).filter((function(e){return e.language})).map((function(e){var t=e.id,n=e.label,r=e.language,a=e.enabled;return{id:t,label:n,language:r,enabled:void 0!==a&&a}}));En(J.AUDIO_TRACKS,e)}function p(){he.removeListener(Ie.SUSPEND,p),he.removeListener(m,_),he.removeListener(_e,_),n.setTarget(null),pn.onerror=null,t="",pn.src=t,he.addListener(Ie.WAKE,v),he.addListener(m,N),he.addListener(_e,N)}function v(){he.removeListener(Ie.WAKE,v),he.removeListener(m,N),he.removeListener(_e,N),n.setTarget(pn),pn.onerror=U,pn.src=t,he.addListener(Ie.SUSPEND,p),he.addListener(m,_),he.addListener(_e,_)}function h(e){he.validateNotificationData(e,["volume"]),pn.volume=e.data.volume}function E(e){he.validateNotificationData(e,["speed"]),pn.playbackRate=e.data.speed}function y(){hn.info("pausing"),i=!1,pn.pause()}function b(){pn.pause()}function T(){hn.info("resuming"),i=!0,A()}function S(e){if(De.get(Ee.RENDER_TEXT_TRACKS_NATIVELY)&&pn&&pn.textTracks&&pn.textTracks.length){var t,n=e.data,r=n.isVisible,a=(t=n.trackId)>=pn.textTracks.length?0:t,i=Array.from(pn.textTracks),o=i.find((function(e){var t=e.mode;return["hidden","showing"].some((function(e){return e===t}))}));if(o&&(o.mode="disabled"),r){var s=i[a];if(s){var d=De.get(Ee.HIDE_NATIVE_TRACKS);s.mode=d?"hidden":"showing"}}}}function I(e){if(pn&&pn.audioTracks&&(r=pn.audioTracks,Array.from(r).filter((function(e){return e.label})).length>1)){var t=Array.from(pn.audioTracks||[]).find((function(e){return e.enabled})),n=pn.audioTracks.getTrackById(e.data.id);if(!n||t.id===n.id)return;En(C,{activeStreamId:"audio:".concat(t.id),targetStreamId:"audio:".concat(n.id)}),t.enabled=!1,n.enabled=!0,setTimeout((function(){he.addListener(re.TIME_UPDATE,(function e(){he.removeListener(re.TIME_UPDATE,e),En(w,{prevStreamId:"audio:".concat(t.id),activeStreamId:"audio:".concat(n.id)})}))}),500)}var r}function L(){A()}function A(){pn&&pn.paused&&i&&(a=a.then((function(){return pn.play()})).catch((function(e){return En(J.PLAY_ERROR,{error:e})})))}function O(){pn.pause()}function P(e){he.validateNotificationData(e,["position"]),pn.currentTime=e.data.position/1e3}function D(e){var t=Math.floor(1e3*pn.currentTime),n=ke.buffered(pn.buffered),r=ke.remaining(t,n);if(e.type!==ee.STALLED||!pn.paused)switch(En("videoTagProxyEvents.".concat(e.type),{position:t,buffered:n,remaining:r,readyState:pn.readyState,networkState:pn.networkState}),e.type){case ee.PROGRESS:En(J.BUFFERED,{bufferId:"player",ranges:n});break;case ee.TIME_UPDATE:o&&(hn.info("First timeUpdate event, the playback starts",{position:t,buffered:n,remaining:r}),o=!1),pn&&!s&&(u(),l(),g(),s=!0);break;case ee.LOADED_METADATA:pn&&ut.safari&&En(J.WEBKIT_SUPPORTS_FULLSCREEN,!!pn.webkitSupportsFullscreen)}}function R(e){switch(he.validateNotificationData(e,["source"]),e.type){case m:kt(),jt(),function(){function e(e){he.validateNotificationData(e,["position"]),an(J.POSITION,{position:e.data.position})}he.addListener(re.TIME_UPDATE,e),he.addListener(Ie.CLEANUP,(function t(){he.removeListener(re.TIME_UPDATE,e),he.removeListener(Ie.CLEANUP,t),an(He)}))}(),function(){var e=!0,t=0;function n(n){he.validateNotificationData(n,["readyState"]),n.type===re.TIME_UPDATE&&(t=n.data.position),!e&&n.data.readyState<2?(e=!0,sn(J.BUFFER_EMPTY,{position:t})):e&&n.data.readyState>=2&&(e=!1,sn(J.BUFFER_FULL))}he.addListener(re.BASE+".*",n),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(re.BASE+".*",n),he.removeListener(Ie.CLEANUP,e),sn(He)}))}(),function(){function e(e){he.validateNotificationData(e,["position"]),un(Nt,{position:e.data.position})}he.addListener(Ie.SEEK,e),he.addListener(Ie.CLEANUP,(function t(){he.removeListener(Ie.SEEK,e),he.removeListener(Ie.CLEANUP,t),un(He)}))}();break;case _e:kt(),jt(),function(){var e=!0;function t(t){he.validateNotificationData(t,["position","buffered"]);var n=ke.remaining(t.data.position,t.data.buffered);!e&&n<100?(e=!0,Bt(J.BUFFER_EMPTY,{position:t.data.position})):e&&n>500&&(e=!1,Bt(J.BUFFER_FULL))}he.addListener(re.TIME_UPDATE,t),he.addListener(re.PROGRESS,t),he.addListener(re.STALLED,t),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(re.TIME_UPDATE,t),he.removeListener(re.PROGRESS,t),he.removeListener(re.STALLED,t),he.removeListener(Ie.CLEANUP,e),Bt(He)}))}(),qt(),Jt(),nn()}he.removeListener(m,R),he.removeListener(_e,R),he.addListener(m,_),he.addListener(_e,_),_(e)}function _(e){he.validateNotificationData(e,["source"]),t=e.data.source,pn.src=t}function N(e){he.validateNotificationData(e,["source"]),t=e.data.source}function U(e){var t={code:e.target.error.code};switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:t.message="aborted";break;case e.target.error.MEDIA_ERR_NETWORK:t.message="network";break;case e.target.error.MEDIA_ERR_DECODE:t.message="decode";break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:t.message="unsupported";break;default:t.message="unknown"}hn.fatal("videotag error",t),En(J.ERROR,t)}return he.addListener(Ie.VOLUME,h),he.addListener(Ie.PLAYBACK_SPEED,E),he.addListener(Ie.PAUSE,y),he.addListener(Ie.RESUME,T),he.addListener(f,b),he.addListener(Ie.CLEANUP,(function r(){he.removeListener(Ie.VOLUME,h),he.removeListener(Ie.PLAYBACK_SPEED,E),he.removeListener(Ie.PAUSE,y),he.removeListener(Ie.RESUME,T),he.removeListener(f,b),he.removeListener(Ie.CLEANUP,r),he.removeListener(Ie.SUSPEND,p),he.removeListener(Ie.WAKE,v),he.removeListener(Ie.CAPTIONS,S),he.removeListener(Ie.SELECT_AUDIO,I),he.removeListener(m,R),he.removeListener(_e,R),he.removeListener(m,_),he.removeListener(_e,_),he.removeListener(m,N),he.removeListener(_e,N),he.removeListener(wt,L),he.removeListener(Ct,O),he.removeListener(Nt,P),pn&&pn.textTracks&&pn.textTracks.removeEventListener("change",d),pn&&pn.audioTracks&&pn.audioTracks.removeEventListener("change",g),e.removeChild(pn),e=null,t=void 0,n.destroy(),n=null,a=Promise.resolve(),o=!1,s=!1,i=!1,pn=null,delete Re.player,gn=void 0,En(He)})),he.addListener(Ie.SUSPEND,p),he.addListener(Ie.CAPTIONS,S),he.addListener(Ie.SELECT_AUDIO,I),he.addListener(m,R),he.addListener(_e,R),he.addListener(wt,L),he.addListener(Ct,O),he.addListener(Nt,P),gn={name:vn,initVideo:function(t){var a;(pn=document.createElement("video")).style.width="100%",pn.style.height="100%",pn.id=r,pn.onerror=U,(a=De.get(Ee.VIDEO_TAG_ATTRIBUTES))&&Object.keys(a).forEach((function(e){pn.setAttribute(e,a[e])})),n=Fe(),Object.values(ee).forEach((function(e){n.addListener(e,D)})),n.setTarget(pn),pn.textTracks&&pn.textTracks.addEventListener("change",d),pn.audioTracks&&pn.audioTracks.addEventListener("change",g),(e=document.getElementById(t)).appendChild(pn),Re.player={type:"html",id:r,element:pn},En(Ze)},getMetrics:function(){if("function"==typeof pn.getVideoPlaybackQuality){var e=pn.getVideoPlaybackQuality();return{total:e.totalVideoFrames,dropped:e.droppedVideoFrames}}return{total:pn.webkitDecodedFrameCount,dropped:pn.webkitDroppedFrameCount}}}}var bn={name:vn,create:yn,isSupported:!!document.createElement("video").canPlayType,isCompatible:function(e){return!!document.createElement("video").canPlayType(e)},getInstance:function(){return gn||yn(),gn},getCurrentTime:function(){return pn?pn.currentTime:0}},Tn=l.create("capabilities"),Sn=[];bt&&Sn.push(i.MP4_SEGMENTED),_t&&(Sn.push(i.FLV_SEGMENTED),Sn.push(i.FLV_MOVIE)),bn.isSupported&&(Sn.push(i.MP4_MOVIE),bn.isCompatible("application/vnd.apple.mpegURL")&&Sn.push(i.HLS)),Tn.info("capabilities",{capabilities:Sn});var In=Sn;function Ln(e){return(Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var An=l.create("validator"),On=["audio/mp4","video/mp4","text/vtt"],Pn=["video/flv"],Dn={baseUrl:"string","[contentStart]":"number","[contentLength]":"number",segmentId:"number",representations:[{contentType:"string",codecs:"string","[initUrl]":"string",segmentUrl:"string",segmentLength:"number"}],"[hashes]":"object"},Rn={baseUrl:"string","[contentStart]":"number","[contentLength]":"number",segmentId:"number",representations:[{contentType:"string",segmentUrl:"string"}],"[hashes]":"object"},_n={baseUrl:"string","[contentStart]":"number","[contentLength]":"number",segmentId:"number",representations:[{contentType:"string",segmentUrl:"string",segmentLength:"number"}],"[hashes]":"object"},Cn={url:"string",seekParameter:"string"},wn={url:"string"},Nn={url:"string"};function Un(e,t){var n=!0;if(e.representations&&e.representations.length)for(var r=0;r<e.representations.length;++r)-1===t.indexOf(e.representations[r].contentType)&&(An.error("invalid content type: "+e.representations[r].contentType),n=!1);else n=!1;return n}function Mn(e,t,n){n=n||"options";var r=!0;for(var a in t)if(t.hasOwnProperty(a)){var i="["===a.substr(0,1)&&"]"===a.substr(-1,1),o=a.substr(+i,a.length-2*i),s=t[a];if("string"==typeof t[a])i||e.hasOwnProperty(o)?e.hasOwnProperty(o)&&Ln(e[o])!==s&&(An.error(n+" invalid type of "+o+": "+Ln(e[o])+" needed: "+s),r=!1):(An.error(n+" missing property: "+o),r=!1);else if(Ln(e[o])!==Ln(t[a]))An.error(n+" invalid type of "+o+": "+Ln(e[o])+" needed: "+Ln(t[a])),r=!1;else if(t[a].shift)for(var d=0;d<e[o].length;++d){var u=n+"."+o+"["+d+"]";r=Mn(e[o][d],t[a][0],u)&&r}}return r}var kn="MetaDownloader.metadata",Fn="MetaDownloader.failed",Vn=[],jn=["url","initUrl","segmentUrl"];function xn(e){return e.contentType?e.contentType.split("/")[0]:e.format}function Bn(e){for(var t="",n=0;n<jn.length;++n)t+=":",t+=e.hasOwnProperty(jn[n])?e[jn[n]]:"";return function(e,t){for(var n=0,r=0;r<e.length;++r)n=(1&n)<<31|n>>>1,n^=e.charCodeAt(r);return function(e,t){for(var n="",r=0;r<Math.ceil(t/4);++r)n=(15&e).toString(16)+n,e>>>=4;return n}(n,t)}(t,32)}var Zn,Hn=function(e){return[xn(e),Bn(e)].join(":")},Gn=function(e){var t=e.split(":");return{mediaType:t[0],hash:t[1]}},Yn="TextTrackProxy",Kn=l.create(Yn),Wn=window.VTTCue?window.VTTCue:window.TextTrackCue,zn="default",Qn={top:2};function qn(e,t){he.dispatch(e,Yn,t)}function Xn(){if(Zn)return Zn;var e=[],t=void 0,n=[],r={},a=!1,i="bytes",o="purge";function s(e){if(he.validateNotificationData(e,["streamId","bufferId","contentType"]),"text"!==Gn(e.data.streamId).mediaType)return!1;t=e.data.bufferId,qn(se,{bufferId:e.data.bufferId,ranges:[{start:0,end:0}]})}function d(n){if(he.validateNotificationData(n,["bufferId","start","end","duration","bytes"]),t!==n.data.bufferId)return!1;e.push({type:i,payload:n.data}),u()}function u(){if(a)return!1;for(;e.length;){var t=e.shift();switch(t.type){case i:l(t.payload);break;case o:a=!0,p()}}}function c(e){he.validateNotificationData(e,["position"]),zn=e.data.position}function l(e){var t,r,a,i=function(e){if(""===String(e.start)||""===String(e.end)||!e.bytes.text)return null;var t=e.start/1e3,n=e.end/1e3;return function(e,t){var n=t.meta||{},r={id:t.id||void 0,line:-4,mode:"showing"},a=function(e){return"default"!==zn&&Qn[zn]?Qn[zn]:e.line&&e.line>=10?-4:e.line}(n);if(void 0!==a&&(n.line=a),!n.positionAlign&&n.align)switch(n.align){case"left":n.positionAlign=ut.ff?"line-left":"start";break;case"right":n.positionAlign=ut.ff?"line-right":"end"}var i=Object.assign(r,n);try{e=Object.assign(e,i)}catch(e){Kn.warn("couldn't set meta properties to vtt cue")}return e}(new Wn(t,n,e.bytes.text),e.bytes)}(e),o=m();if((a=function(e,t){return!!n.length&&n.filter((function(n){return n.start<=t&&n.end>=e}))[0]}(t=e.start,r=e.end))?a.end=Math.max(r,a.end):n.push({start:t,end:r}),n=n,i&&o)return o.addCue(i),void qn(se,{bufferId:e.bufferId,ranges:n});qn(ln.EMPTY_CUE_ADDED,{track:o,bufferId:e.bufferId})}function f(e){return"stream_"+e}function m(){var e=function(e){return Vn[e]}(t),n=f(e.sourceStreamVersion);return r.hasOwnProperty(n)?r[n]:function(e){var t;t=Re.player.element.textTracks,Object.keys(t).forEach((function(e){var n=t[e];n.mode="disabled",n.removeEventListener("cuechange",g)}));var n=Re.player.element.addTextTrack("subtitles",e.label,e.language);qn(ln.TEXT_TRACK_ADDED,{label:e.label,language:e.language});var a=f(e.sourceStreamVersion);return n.mode=De.get(Ee.RENDER_TEXT_TRACKS_NATIVELY)?"showing":"hidden",n.addEventListener("cuechange",g),r[a]=n,r[a]}(e)}function g(e){if(!De.get(Ee.RENDER_TEXT_TRACKS_NATIVELY)){var t=e.target;qn(ln.TEXT_TRACK_CUE_CHANGE,{cues:Array.from(t.cues),activeCues:Array.from(t.activeCues)})}}function p(){var e=m();for(n=[];e.cues.length;)e.removeCue(e.cues[0]);qn(ie,{bufferId:t})}return Kn.debug("create"),he.addListener(de,d),he.addListener(se,(function(e){if(e.data.bufferId!==t)return!1;a=!1})),he.addListener(le,s),he.addListener(Ie.CLEANUP,(function i(){he.removeListener(de,d),he.removeListener(le,s),he.removeListener(Ie.CAPTION_POSITION,c),he.removeListener(Ie.CLEANUP,i),e=[],t=void 0,n=[],r={},a=!1,zn="default",Zn=void 0,qn(He)})),he.addListener(Ie.CAPTION_POSITION,c),he.addListener(ce,(function(n){if(n.data.bufferId!==t)return!1;e.push({type:o}),u()})),qn(Ze),Zn={name:Yn}}var $n={create:Xn,name:Yn,getInstance:function(){return Zn||Xn(),Zn}};function Jn(e){var t;function n(){return t.bytes[t.position++]}function r(e){e=e||0,t.bytes[t.position++]=255&e}function a(e){r((e=e||0)>>>24&255),r(e>>>16&255),r(e>>>8&255),r(255&e)}return e instanceof Uint8Array||(e=new Uint8Array(e)),t={bytes:e,position:0,readUnsignedByte:n,readUnsignedInt16:function(){for(var e=0,t=0;t<2;++t)e=e<<8|n();return e},readUnsignedInt24:function(){for(var e=0,t=0;t<3;++t)e=e<<8|n();return e},readUnsignedInt32:function(){for(var e=0,t=0;t<4;++t)e=256*e+n();return e},readUnsignedInt64:function(){for(var e=0,t=0;t<8;++t)e=256*e+n();return e},readString:function(e){for(var n="",r=0;r<e;++r)n+=String.fromCharCode(t.bytes[t.position++]);return n},readBytes:function(e){var n=er(t.bytes,t.position,e);return t.position+=e,n},writeUnsignedByte:r,writeUnsignedInt16:function(e){r((e=e||0)>>>8&255),r(255&e)},writeUnsignedInt24:function(e){r((e=e||0)>>>16&255),r(e>>>8&255),r(255&e)},writeUnsignedInt32:a,writeUnsignedInt64:function(e){a(Math.floor(e/Math.pow(2,32))),a(Math.floor(e%Math.pow(2,32)))},writeString:function(e){for(var n=0;n<e.length;++n)t.bytes[t.position++]=e.charCodeAt(n)},writeBytes:function(e){t.bytes.set(e,t.position),t.position+=e.length}}}function er(e,t,n){if("function"==typeof e.slice)return e.slice(t,t+n);for(var r=new Uint8Array(n),a=0;a<n;++a)r[a]=e[t+a];return r}var tr={create:Jn,slice:er,concat:function(e){var t,n=0;for(t=0;t<e.length;++t)n+=e[t].length;var r=Jn(new Uint8Array(n));for(t=0;t<e.length;++t)r.writeBytes(e[t]);return r.bytes},stringify:function(e,t,n){var r="";n=n||1,t=t||4;for(var a=0;a<e.length;++a)r+=At(e[a].toString(16),2),a<e.length-1&&(n>1&&(a+1)%(t*n)==0?r+="\n":(a+1)%t==0&&(r+=" "));return r}},nr={"text/vtt":"text","audio/mp4":"arraybuffer","video/mp4":"arraybuffer"},rr="DownloadManager";function ar(e,t){he.dispatch(e,rr,t)}var ir=function(){function e(e){he.validateNotificationData(e,["loaderId","segmentId","streamId","url","contentType"]),function(e){var t,n,r="SegmentDownloader."+e.loaderId,a=l.create(r),i=new Date;function o(){t&&(t.onload=null,t.onerror=null,t.onprogress=null,t.abort(),t=null),he.removeListener(Ie.CLEANUP,u),he.removeListener(E,c),n=clearTimeout(n),s(G,{loaderId:e.loaderId})}function s(e,t){he.dispatch(e,r,t)}function d(){var n={streamId:e.streamId,segmentId:e.segmentId,url:e.url,contentType:e.contentType,status:t.status};0===t.status?n.reason="TIMEOUT":400<=t.status&&t.status<500&&(n.reason=function(){var e;if("string"==typeof t.response)e=t.response;else{if(!(window.ArrayBuffer&&window.Uint8Array&&t.response instanceof ArrayBuffer))return;var n=tr.create(new Uint8Array(t.response));e=n.readString(n.bytes.length)}try{return JSON.parse(e).error}catch(e){return}}()),a.error("segment download error",n),s(H,n),o()}function u(){o()}function c(t){he.validateNotificationData(t,["streamId"]),t.data.streamId===e.streamId&&o()}he.addListener(Ie.CLEANUP,u),he.addListener(E,c),(t=new XMLHttpRequest).open("GET",e.url,!0),t.responseType=nr[e.contentType],t.send(),t.onprogress=function(){n=clearTimeout(n),200===t.status&&s(F,{streamId:e.streamId,segmentId:e.segmentId,url:e.url,contentType:e.contentType}),t.onprogress=null},t.onload=function(){var n,r=new Date;if(200===t.status){switch(t.responseType){case"text":n=""+t.response;break;default:n=new Uint8Array(t.response)}s(j,{raw:n,streamId:e.streamId,segmentId:e.segmentId,contentType:e.contentType}),s(V,{url:e.url,time:r-i,size:n.length,streamId:e.streamId,segmentId:e.segmentId,contentType:e.contentType}),o()}else d()},t.onerror=d,s(k,{streamId:e.streamId,segmentId:e.segmentId,url:e.url,contentType:e.contentType}),n=setTimeout((function(){t&&(t.abort(),d())}),7e3),e.loaderId,e.url}(e.data)}return he.addListener(h,e),he.addListener(Ie.CLEANUP,(function t(){he.removeListener(h,e),he.removeListener(Ie.CLEANUP,t),ar(He)})),ar(Ze),{name:rr}},or="GarbageCollector.discardStartSegment",sr="GarbageCollector.discardEndSegment",dr=function(e,t){var n,r="SegmentStorage."+e,a=t,i=l.create(r),o={},s=[],d=0,u=null,c=-1;function f(e,t){he.dispatch(e,r,t)}function m(){null!==u&&T(u),b()}function g(e,t){return t.segmentId===e.firstId-1}function p(e,t){return t.segmentId===e.lastId+1}function v(e,t){return e.firstId<=t.segmentId&&e.lastId>=t.segmentId}function h(){for(var e=y(),t=0;s.length>1&&t<s.length-1;++t)s[t].lastId+1===s[t+1].firstId&&(t===d?(s[t].appendSegments(s[t+1].segments),s.splice(t+1,1),t--):(s[t+1].prependSegments(s[t].segments),s.splice(t--,1)));d=s.indexOf(e)}function E(){for(var e=y(),t=s.length;--t>=0;)s[t].start===s[t].end&&s.splice(t,1);(d=s.indexOf(e))<0&&(s.length?(d=0,L(y().start),i.warn("removeEmptyBundles: currentBundle removed, bundleIndex set to 0")):i.debug("removeEmptyBundles: no remaining bundles"))}function y(){return s&&s.length>d?s[d]:null}function b(){var t;n.streamId=e,n.activeFragmentStartTime=(t=y())?t.activeFragmentStartTime:ct,n.hasNextFragment=!!y()&&y().hasNextFragment,n.hasNextRAPFragment=!!y()&&y().hasNextRAPFragment,n.nextFragmentContainsRAP=!!y()&&y().nextFragmentContainsRAP,n.nextFragmentStartTime=y()?y().nextFragmentStartTime:ct}function T(t,n){if(s.length&&0===s[0].firstId&&t<s[0].start&&t>=0)return d=0,void L(y().start);for(var r=0;s&&r<s.length;++r)if(I(s[r])<=t&&s[r].end>=t)return d=r,void L(t);d=ct,u=t,b(),n||f(z,{streamId:e,position:t})}function S(e){return 0!==e.duration}function I(e){var t=e.segments.findIndex(S);if(t<=0)return e.start;var n=t*a,r=a-e.segments[t].duration;return e.start-(n+r)}function L(t){!function(){if(y().end-u<250){var t=y().lastId+1;i.warn("active bundle available content is not enough after seek, requesting the next segment",{streamId:e,segmentId:t,seekPosition:u}),f(Q,{streamId:e,segmentId:t})}}(),u=null,i.debug("setTimePosition "+t),y().setTimePosition(t),b()}return i.debug("construct "+e),n={getNextFragment:function(){var t,n=y()?y().getNextFragment():null;return b(),t=y().activeSegment.segmentId,c!==t&&(c=t,setTimeout((function(){f(X,{segmentId:t,streamId:e})}),0)),n},getEoSPosition:function(){var e=s.find((function(e){return e.hasLastSegment}));return e&&e.duration>0?e.end:ct},getSegmentWithKeyframe:function(e){var t=y();if(t)return t.getSegmentWithKeyframe(e)},setTimePosition:T,removeSegmentFromBeginning:function(){var e=s&&s.length?s[0]:null;return!!e&&(e.removeSegmentFromBeginning(),E(),m(),!0)},removeSegmentFromEnd:function(){var e=s&&s.length?s[s.length-1]:null;return!!e&&(e.removeSegmentFromEnd(),E(),m(),!0)},destroy:function(){o={},s=[],d=0,u=null,c=-1},insertSegment:function(e){return!!function(e){for(var t=0;t<s.length;++t){if(g(s[t],e))return s[t].prependSegment(e),h(),!0;if(p(s[t],e))return s[t].appendSegment(e),h(),!0;if(v(s[t],e))return i.warn("findBundleForSegment : segment overlaps existing bundle",{bundleStart:s[t].start,bundleEnd:s[t].end,segmentStart:e.firstTimestamp,segmentEnd:e.lastTimestamp}),!1}return i.debug("creating new bundle for segment",{segmentId:e.segmentId,start:e.firstTimestamp,end:e.lastTimestamp}),s.push(function(){var e,t=[],n=0;function r(){return n<t.length?t[n]:null}function a(){if(!r())return!1;for(;!r().hasNextFragment&&n<t.length-1;)n<t.length-1&&n++,r()&&r().reset(),o(),r();return r().hasNextFragment}function i(e){return r().keyFrames.length&&r().keyFrames[0]<=e}function o(){var n;e.start=t&&t.length?function(){for(var e=0;e<t.length;){if(t[e].firstTimestamp!==ct)return t[e].firstTimestamp;e++}return 0}():0,e.end=t&&t.length?function(){for(var e=t.length-1;e>=0;){if(t[e].lastTimestamp!==ct)return t[e].lastTimestamp;e--}return 0}():0,e.firstId=t&&t.length?t[0].segmentId:-1,e.lastId=t&&t.length?t[t.length-1].segmentId:-1,e.duration=function(){for(var e=0,n=0;n<t.length;++n)e+=t[n].duration;return e}(),e.avgSegmentDuration=e.duration/t.length,e.size=function(){for(var e=0,n=0;n<t.length;++n)e+=t[n].size;return e}(),e.segments=t,e.hasNextFragment=a(),e.hasNextRAPFragment=!!r()&&r().hasNextRAPFragment,e.nextFragmentContainsRAP=!!a()&&r().nextFragmentContainsRAP,e.nextFragmentStartTime=a()?r().nextFragmentStartTime:ct,e.activeSegment=r(),e.activeFragmentStartTime=(n=r())?n.activeFragmentStartTime:ct,e.hasLastSegment=t.some((function(e){return e.lastSegment}))}return e={getNextFragment:function(){var e=a()?r().getNextFragment():null;return o(),e},appendSegment:function(e){t.push(e),n===ct&&e.fragments.length&&(n=0),o()},prependSegment:function(e){t.unshift(e),n++,o()},appendSegments:function(e){t=t.concat(e),o()},prependSegments:function(e){t=e.concat(t),n+=t.length,o()},removeSegmentFromBeginning:function(){t.splice(0,1),n--,o()},removeSegmentFromEnd:function(){t.splice(-1,1),o()},setTimePosition:function(e){n=ct;for(var a=0;a<t.length;++a)t[a].firstTimestamp<=e&&(n=a);if(r()){for(;!i(e)&&n>0;)n--;r().setTimePosition(e)}o()},getSegmentWithKeyframe:function(e){return e=e||0,t.find((function(t){return t.keyFrames.some((function(t){return t>=e}))}))}},o(),e}()),s[s.length-1].appendSegment(e),n=y(),s.sort((function(e,t){return e.start>t.start?1:e.start<t.start?-1:0})),d=s.indexOf(n),!0;var n}(e)&&(m(),!0)},getState:function(){for(var t=[],n=[],r=0,a=[],i=[],o=0;o<s.length;++o)r+=s[o].size,t.push({start:s[o].start,end:s[o].end}),n.push({start:s[o].firstId,end:s[o].lastId}),a.push(s[o].duration),i.push(s[o].size);return{streamId:e,size:r,ranges:t,ids:n,bundleDurations:a,bundleSizes:i}},getConfigForHash:function(e){return o[e]},insertConfig:function(e,t){o[e]=t}},b(),n};function ur(e){return(Re.representations||[]).find((function(t){return t.streamId===e}))}function cr(e){var t=ur(e);if(void 0!==t){var n=Re.representations.indexOf(t);return Re.representations.splice(n,1)}}var lr,fr={addRepresentation:function(e,t,n){void 0===n&&(n="active"),Re.representations=Re.representations||[],cr(t);var r=Object.assign({},e,{streamId:t,status:n});Re.representations.push(r)},getRepresentation:ur,removeRepresentation:cr,cleanup:function(){Object.getOwnPropertyNames(Re).forEach((function(e){delete Re[e]}))}},mr="StorageManager";function gr(e,t){he.dispatch(e,mr,t)}function pr(){if(lr)return lr;var e={},t=-1/0,n={};function r(e){he.validateNotificationData(e,["position"]),t=e.data.position}function a(){t=-1/0}function i(e){he.validateNotificationData(e,["streamId","segment"]);var t=u(e.data.streamId);t.insertSegment(e.data.segment)&&gr(W,t.getState()),function(e){var t=u(e).getEoSPosition();t!==ct&&gr(Y,{position:t})}(e.data.streamId)}function o(e){he.validateNotificationData(e,["streamId","after"]),n[e.data.streamId]=e.data.after,d(e.data.streamId)}function s(e){he.validateNotificationData(e,["streamId"]),delete n[e.data.streamId]}function d(e){var t=n[e];if(t||0===t){var r=u(e).getSegmentWithKeyframe(t);r&&(delete n[e],function(e,t){var n=e.keyFrames.find((function(e){return e>=t}));gr(q,{streamId:e.streamId,position:n})}(r,t))}}function u(t){return function(t){if(!e.hasOwnProperty(t)){var n=function(e){return fr.getRepresentation(e).segmentLength}(t),r=dr(t,n);e[t]=r,function(e){gr(K,{streamId:e})}(t)}}(t),e[t]}function c(t){n.hasOwnProperty(t)&&delete n[t],e.hasOwnProperty(t)&&(e[t].destroy(),delete e[t],gr("StorageManager.segmentStorageRemoved",{streamId:t}))}function l(e){he.validateNotificationData(e,["streamId","position"]);var n=u(e.data.streamId),r=Math.max(e.data.position,t+250);n.setTimePosition(r)}function f(e){he.validateNotificationData(e,["streamId","ranges"]),e.data.ranges.length?d(e.data.streamId):c(e.data.streamId)}function m(e){he.validateNotificationData(e,["streamId"]);var t,n=u(e.data.streamId);switch(e.type){case or:t=n.removeSegmentFromBeginning();break;case sr:t=n.removeSegmentFromEnd()}t&&gr(W,n.getState())}function g(e){he.validateNotificationData(e,["streamId","config","hash"]),u(e.data.streamId).insertConfig(e.data.hash,e.data.config)}return Re.player&&"flash"===Re.player.type||(he.addListener(I,l,he.MINIMUM_PRIORITY),he.addListener(Ie.SEEK,r),he.addListener(Ie.CLEANUP,(function t(){he.removeListener(I,l),he.removeListener(Ie.SEEK,r),he.removeListener(Ie.CLEANUP,t),he.removeListener(W,f),he.removeListener(Nt,a),he.removeListener(or,m),he.removeListener(sr,m),he.removeListener(x,i),he.removeListener(B,i),he.removeListener(Z,g),he.removeListener(T,o),he.removeListener(S,s),Object.getOwnPropertyNames(e).forEach(c),e={},n={},lr=void 0,gr(He)})),he.addListener(W,f),he.addListener(Nt,a),he.addListener(or,m),he.addListener(sr,m),he.addListener(x,i),he.addListener(B,i),he.addListener(Z,g),he.addListener(T,o),he.addListener(S,s),gr(Ze)),lr={name:mr,getSegmentStorage:u,removeSegmentStorage:c}}var vr={name:mr,create:pr,getInstance:function(){return lr||pr(),lr}},hr=function(e){return function(t,n){var r=t.segmentId,a=n.segmentId;return Math.min(r,a)>=e?r-a:a-r}},Er={},yr={};function br(e){return Gn(e).mediaType}var Tr=function(e,t){Er[e]=function(e){return{segmentUrl:e.segmentUrl?e.baseUrl+e.segmentUrl:""}}(t),t.hashes&&function(e,t){var n=br(e);yr[n]||(yr[n]=function(){var e={};return{add:function(t){if(!t.hasOwnProperty("id"))throw new Error('Invalid hashObject: missing "id"');if(!t.hasOwnProperty("hash"))throw new Error('Invalid hashObject: missing "hash"');e[t.id]=t.hash},getHashBySegmentId:function(t){var n=Object.keys(e).filter((function(e){return t-t%10===parseInt(e,10)})).pop();return e[n]}}}()),Object.getOwnPropertyNames(t).forEach((function(e){var r=t[e];yr[n].add({id:e,hash:r})}))}(e,t.hashes)},Sr=function(e,t){return function(e,t){return n=Er[e].segmentUrl,(r={segmentId:t,hashId:function(e,t){var n=br(e);if(!yr[n])throw new Error('no hashes for "'+n+'"');var r=yr[n].getHashBySegmentId(t);if(!r)throw new Error("cannot find hash for "+t);return r}(e,t)}).hasOwnProperty("segmentId")&&(r["segmentId%06d"]=At(r.segmentId,6),r["segmentId%04d"]=At(r.segmentId,4)),Object.getOwnPropertyNames(r).reduce((function(e,t){var n=r[t];return e.replace("#"+t+"#",n)}),n);var n,r}(e,t)},Ir=function(e){delete Er[e];var t=br(e);delete yr[t]},Lr="DownloadQueue",Ar=l.create(Lr);function Or(e,t){he.dispatch(e,Lr,t)}function Pr(e){return Gn(e).mediaType}function Dr(){return(new Date).getTime()}var Rr=function(){var e,t,n,r,a,i,o=[],s=[],d={},u={},c={},l=null;function f(){i=!0,k()}function m(e){if(he.validateNotificationData(e,["segmentId","streamId","contentType"]),t=e.data,!s.some((function(e){return t.segmentId===e.segmentId&&t.streamId===e.streamId}))){var t,n=x(e.data.streamId,e.data.segmentId);n&&!function(e){return o.some((function(t){return t.url===e}))}(n)&&(N(e.data),F())}}function g(e){he.validateNotificationData(e,["streamId"]);var t=[];s=s.filter((function(n){return n.streamId!==e.data.streamId||(t.push(n),!1)})),t.length&&Ar.debug("removed downloads with specific a streamId",{streamId:e.data.streamId,removedDownloads:t});var n=Pr(e.data.streamId);delete d[n],u[n]=0,B()}function p(r){he.validateNotificationData(r,["bufferId","currentId","playPosition"]),"video"===r.data.bufferId.substr(0,5)&&(e=r.data.currentId,t=r.data.playPosition,n=r.data.videoTagSegmentId||null)}function b(e){he.validateNotificationData(e,["streamId"]);var t=Gn(e.data.streamId);c[t.mediaType]=t.hash}function T(e){he.validateNotificationData(e,["streamId"]),A(e.data.streamId)}function S(e){he.validateNotificationData(e,["streamId"]),A(e.data.streamId)}function A(e){var t=Gn(e);c[t.mediaType]=void 0,k()}function P(e){he.validateNotificationData(e,["loaderId"]),o=o.filter((function(t){return t.loaderId!==e.data.loaderId})),B(),F()}function D(e){he.validateNotificationData(e,["segmentId","streamId","contentType"]);var t=Pr(e.data.streamId);u[t]=u[t]?u[t]+1:1;var n=1e3*u[t];!function(e,t){d[e]=Dr()+t}(t,n),N(e.data),r||(r=setTimeout((function(){r=void 0,F()}),n))}function R(){i=!1}function _(){var e;do{e=Lt(5)}while(!C(e));return e}function C(e){return o.every((function(t){return t.loaderId!==e}))}function w(e){he.validateNotificationData(e,["streamId"]);var t=Pr(e.data.streamId);u[t]=0}function N(e){var t=Pr(e.streamId);s.push({segmentId:e.segmentId,mediaType:t,streamId:e.streamId,contentType:e.contentType})}function U(){return Object.getOwnPropertyNames(c).some((function(e){return!!c[e]}))}function M(){return n&&!i?n:e||0}function k(){var e=[],t=M();s=s.filter((function(n){return!(n.segmentId<t&&(e.push(n),1))})),e.length&&Ar.debug("removed downloads which are passed by the play position",{removedDownloads:e}),B()}function F(){for(var e,n,r,a,i,u=(r=U()&&function(){var e,n=(e=(Re.representations||[]).find((function(e){return"active"===e.status&&"video"===Pr(e.streamId)})))?e.streamId:void 0;if(!n)return!1;var r=l.getSegmentStorage(n),a=t+De.get(Ee.QUALITY_SWITCH_BUFFER_THRESHOLD),i=r.getSegmentWithKeyframe(a);return!!i&&i.segmentId}(),a=M(),U()?function(e,t,n){var r=hr(n||e);return function(e,n){var a=t[e.mediaType]===e.streamId,i=t[n.mediaType]===n.streamId;return a&&!i?-1:!a&&i?1:r(e,n)}}(a,c,r):hr(a));s.length&&o.length<De.get(Ee.CONCURRENT_DOWNLOAD_COUNT)-Object.getOwnPropertyNames(d).filter(j).length;){if(!(e=s.filter((function(e){return!j(e.mediaType)})).sort(u)).length)return Ar.debug("resortedQueue is empty",{locks:d,queue:s}),!1;Ar.debug("resorted the queue before downloading a segment",{resortedQueue:e}),(n=e.shift()).loaderId=_(),n.url=x(n.streamId,n.segmentId),n.url&&(o.push(n),i=n,s.splice(s.indexOf(i),1),Or(h,n))}B()}function j(e){if(!d.hasOwnProperty(e))return!1;var t=d[e];return Dr()<t}function x(e,t){try{return Sr(e,t)}catch(n){return void Or(O,{streamId:e,segmentId:t,reason:n.message})}}function B(){a.activeDownloaders=o,a.queue=s}return he.addListener(v,m),he.addListener(E,g),he.addListener(y,p),he.addListener(I,b),he.addListener(L,T),he.addListener(ae,S),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(v,m),he.removeListener(E,g),he.removeListener(y,p),he.removeListener(I,b),he.removeListener(L,T),he.removeListener(ae,S),he.removeListener(Ie.CLEANUP,e),he.removeListener(Ie.SEEK,f),he.removeListener(H,D),he.removeListener(V,w),he.removeListener(G,P),he.removeListener(Nt,R),l=null,o=null,s=null,d=null,r=clearTimeout(r),u=null,B(),Or(He)})),he.addListener(Ie.SEEK,f),he.addListener(H,D),he.addListener(V,w),he.addListener(G,P),he.addListener(Nt,R),l=vr.getInstance(),Or(Ze),a={name:Lr,isMediaTypeLocked:j},B(),a},_r={decorate:function(e){var t,n=tr.create(e.bytes);for(n.position=e.fourCC?e.start+8:e.start,e.boxes=[];n.position<e.start+e.length;)(t={}).start=n.position,t.length=n.readUnsignedInt32(),t.fourCC=n.readString(4),t.bytes=e.bytes,e.boxes.push(t),n.position+=t.length-8}},Cr={fmov:_r,free:_r,mdia:_r,minf:_r,moof:_r,moov:_r,mvex:_r,stbl:_r,traf:_r,trak:_r,ustm:_r,fhst:{decorate:function(e){function t(){var t,n=tr.create(e.bytes);n.position=e.start+8,e.hashes=[];for(var r=0;r<Math.floor((e.length-8)/4);++r)t=n.readUnsignedInt32(),e.hashes.push(At(t.toString(16),8))}e.parseBytes=t,t()}},hash:{decorate:function(e){function t(){var t=tr.create(e.bytes);t.position=e.start+8;var n=t.readUnsignedInt32();e.hash=At(n.toString(16),8)}e.parseBytes=t,t()}},idta:{decorate:function(e){function t(){var t=tr.create(e.bytes);t.position=e.start+8,e.rawInit=t.readBytes(e.length-8)}e.parseBytes=t,t()}},sidx:{decorate:function(e){var t,n,r=tr.create(e.bytes);r.position=e.start+8,e.version=r.readUnsignedByte(),e.rawFlags=r.readUnsignedInt24(),e.referenceId=r.readUnsignedInt32(),e.timeScale=r.readUnsignedInt32(),e.version?(e.earliestPresentationTime=r.readUnsignedInt64(),e.firstOffset=r.readUnsignedInt64()):(e.earliestPresentationTime=r.readUnsignedInt32(),e.firstOffset=r.readUnsignedInt32()),r.readUnsignedInt16(),e.referenceCount=r.readUnsignedInt16(),e.references=[];for(var a=0;a<e.referenceCount;++a)t={},n=r.readUnsignedInt32(),t.referenceType=!!(2147483648&n),t.subsegmentSize=2147483647&n,t.subsegmentDuration=r.readUnsignedInt32(),n=r.readUnsignedInt32(),t.containsRAP=!!(2147483648&n),t.rapType=(1879048192&n)>>>28,t.rapDeltaTime=268435455&n,e.references.push(t)}},styp:{decorate:function(e){var t=tr.create(e.bytes);for(t.position=e.start+8,e.majorBrand=t.readString(4),e.minorVersion=t.readUnsignedInt32(),e.compatibleBrands=[];t.position<e.start+e.length;)e.compatibleBrands.push(t.readString(4))}},trun:{decorate:function(e){function t(){var t=tr.create(e.bytes);t.position=e.start+8,e.version=t.readUnsignedByte(),e.flags=function(e){return{dataOffsetPresent:!!(1&e),firstSampleFlagsPresent:!!(4&e),sampleDurationsPresent:!!(256&e),sampleSizesPresent:!!(512&e),sampleFlagsPresent:!!(1024&e),sampleCompositionTimeOffsetsPresent:!!(2048&e)}}(t.readUnsignedInt24()),e.sampleCount=t.readUnsignedInt32(),e.flags.dataOffsetPresent&&(e.dataOffset=t.readUnsignedInt32()),e.flags.firstSampleFlagsPresent&&(e.firstSampleFlags=t.readUnsignedInt32()),e.samples=[];for(var n=0;n<e.sampleCount;++n){var r={};e.flags.sampleDurationsPresent&&(r.duration=t.readUnsignedInt32()),e.flags.sampleSizesPresent&&(r.size=t.readUnsignedInt32()),e.flags.sampleFlagsPresent&&(r.flags=t.readUnsignedInt32()),e.flags.sampleCompositionTimeOffsetsPresent&&(r.compositionTimeOffset=t.readUnsignedInt32()),e.samples.push(r)}}e.parseBytes=t,e.writeBytes=function(){e.flags=e.flags||{};var t=4*e.flags.dataOffsetPresent,n=4*e.flags.firstSampleFlagsPresent,r=4*(e.flags&&e.flags.sampleDurationsPresent)+4*(e.flags&&e.flags.sampleSizesPresent)+4*(e.flags&&e.flags.sampleFlagsPresent)+4*(e.flags&&e.flags.sampleCompositionTimeOffsetsPresent);e.length=16+t+n+e.sampleCount*r;var a=tr.create(new Uint8Array(e.length));a.writeUnsignedInt32(e.length),a.writeString(e.fourCC),a.writeUnsignedByte(e.version),a.writeUnsignedInt24(function(e){var t=0;return t|=1*e.dataOffsetPresent,t|=4*e.firstSampleFlagsPresent,t|=256*e.sampleDurationsPresent,t|=512*e.sampleSizesPresent,(t|=1024*e.sampleFlagsPresent)|2048*e.sampleCompositionTimeOffsetsPresent}(e.flags)),a.writeUnsignedInt32(e.sampleCount),e.flags.dataOffsetPresent&&a.writeUnsignedInt32(e.dataOffset),e.flags.firstSampleFlagsPresent&&a.writeUnsignedInt32(e.firstSampleFlags);for(var i=0;i<e.sampleCount;++i)e.flags.sampleDurationsPresent&&a.writeUnsignedInt32(e.samples[i].duration),e.flags.sampleSizesPresent&&a.writeUnsignedInt32(e.samples[i].size),e.flags.sampleFlagsPresent&&a.writeUnsignedInt32(e.samples[i].flags),e.flags.sampleCompositionTimeOffsetsPresent&&a.writeUnsignedInt32(e.samples[i].compositionTimeOffset);e.bytes=a.bytes,e.start=0},t()}},tfdt:{decorate:function(e){function t(){var t=tr.create(e.bytes);t.position=e.start+8,e.version=t.readUnsignedByte(),e.rawFlags=t.readUnsignedInt24(),e.version?e.baseMediaDecodeTime=t.readUnsignedInt64():e.baseMediaDecodeTime=t.readUnsignedInt32()}e.parseBytes=t,e.writeBytes=function(){e.length=12+(e.version?8:4);var t=tr.create(new Uint8Array(e.length));t.writeUnsignedInt32(e.length),t.writeString(e.fourCC),t.writeUnsignedByte(e.version),t.writeUnsignedInt24(e.rawFlags),e.version?t.writeUnsignedInt64(e.baseMediaDecodeTime):t.writeUnsignedInt32(e.baseMediaDecodeTime),e.bytes=t.bytes,e.start=0},t()}},tfhd:{decorate:function(e){function t(){var t=tr.create(e.bytes);t.position=e.start+8,e.version=t.readUnsignedByte(),e.flags=function(e){return{baseDataOffsetPresent:!!(1&e),sampleDescriptionIndexPresent:!!(2&e),defaultSampleDurationPresent:!!(8&e),defaultSampleSizePresent:!!(16&e),defaultSampleFlagsPresent:!!(32&e)}}(t.readUnsignedInt24()),e.trackId=t.readUnsignedInt32(),e.flags.baseDataOffsetPresent&&(e.baseDataOffset=t.readUnsignedInt64()),e.flags.sampleDescriptionIndexPresent&&(e.sampleDescriptionIndex=t.readUnsignedInt32()),e.flags.defaultSampleDurationPresent&&(e.defaultSampleDuration=t.readUnsignedInt32()),e.flags.defaultSampleSizePresent&&(e.defaultSampleSize=t.readUnsignedInt32()),e.flags.defaultSampleFlagsPresent&&(e.defaultSampleFlags=t.readUnsignedInt32())}e.parseBytes=t,e.writeBytes=function(){e.flags=e.flags||{},e.length=16,e.length+=8*e.flags.baseDataOffsetPresent,e.length+=4*e.flags.sampleDescriptionIndexPresent,e.length+=4*e.flags.defaultSampleDurationPresent,e.length+=4*e.flags.defaultSampleSizePresent,e.length+=4*e.flags.defaultSampleFlagsPresent;var t=tr.create(new Uint8Array(e.length));t.writeUnsignedInt32(e.length),t.writeString(e.fourCC),t.writeUnsignedByte(e.version),t.writeUnsignedInt24(function(e){var t=0;return t|=1*e.baseDataOffsetPresent,t|=2*e.sampleDescriptionIndexPresent,t|=8*e.defaultSampleDurationPresent,(t|=16*e.defaultSampleSizePresent)|32*e.defaultSampleFlagsPresent}(e.flags)),t.writeUnsignedInt32(e.trackId),e.flags.baseDataOffsetPresent&&t.writeUnsignedInt64(e.baseDataOffset),e.flags.sampleDescriptionIndexPresent&&t.writeUnsignedInt32(e.sampleDescriptionIndex),e.flags.defaultSampleDurationPresent&&t.writeUnsignedInt32(e.defaultSampleDuration),e.flags.defaultSampleSizePresent&&t.writeUnsignedInt32(e.defaultSampleSize),e.flags.defaultSampleFlagsPresent&&t.writeUnsignedInt32(e.defaultSampleFlags),e.bytes=t.bytes,e.start=0},t()}},mfhd:{decorate:function(e){function t(){var t=tr.create(e.bytes);t.position=e.start+8,e.version=t.readUnsignedByte(),e.rawFlags=t.readUnsignedInt24(),e.sequenceNumber=t.readUnsignedInt32()}e.parseBytes=t,e.writeBytes=function(){e.length=16;var t=tr.create(new Uint8Array(e.length));t.writeUnsignedInt32(e.length),t.writeString(e.fourCC),t.writeUnsignedByte(e.version),t.writeUnsignedInt24(e.rawFlags),t.writeUnsignedInt32(e.sequenceNumber),e.bytes=t.bytes,e.start=0},t()}}},wr=l.create("MP4Parser");function Nr(e){var t=e.fourCC?Cr[e.fourCC]:_r;if(t&&(t.decorate(e),e.boxes)){for(var n=0;n<e.boxes.length;++n)Nr(e.boxes[n]);e.boxes.length&&(delete e.bytes,delete e.start,delete e.length)}}function Ur(e){if(e.bytes)return e.length;if(e.boxes){for(var t=e.fourCC?8:0,n=0;n<e.boxes.length;++n)t+=Ur(e.boxes[n]);return t}return 0}function Mr(e,t){if(t.bytes)e.writeBytes(tr.slice(t.bytes,t.start,t.length));else if(t.boxes){t.fourCC&&(e.writeUnsignedInt32(Ur(t)),e.writeString(t.fourCC));for(var n=0;n<t.boxes.length;++n)Mr(e,t.boxes[n])}else wr.error("error writing "+t.fourCC+", no bytes/boxes")}var kr=function(e){var t={bytes:e,start:0,length:e.length};return Nr(t),t},Fr=function(e){var t=tr.create(new Uint8Array(Ur(e)));return Mr(t,e),t.bytes};function Vr(e,t){for(var n=0;n<e.boxes.length;++n)if(e.boxes[n].fourCC===t)return e.boxes[n];return null}var jr={getBoxByPath:function(e,t){for(var n=t.split(".");e&&n.length;)e=Vr(e,n.shift());return e},getBoxByFourCC:Vr},xr=function(e){return{sampleDegradationPriority:65535&e,sampleIsDifferenceSample:!!(e>>>16&1),samplePaddingValue:e>>>17&7,sampleHasRedundancy:e>>>20&3,sampleIsDependedOn:e>>>22&3,sampleDependsOn:e>>>24&3,reserved:e>>>26&63}},Br=function(e){var t=0;return t|=65535&e.sampleDegradationPriority,t|=+e.sampleIsDifferenceSample<<16,t|=(7&e.samplePaddingValue)<<17,t|=(3&e.sampleHasRedundancy)<<20,t|=(3&e.sampleIsDependedOn)<<22,(t|=(3&e.sampleDependsOn)<<24)|(63&e.reserved)<<26};function Zr(e,t){for(var n=t.baseMediaDecodeTime,r=0;r<e.sampleCount;++r)n+=e.samples[r].duration;return n}function Hr(e,t){for(var n=[],r=0;r<e.length;++r)n.push(jr.getBoxByPath(e[r],t));return n}var Gr=function(e,t,n){var r,a,i,o,s,d="Buffer."+e,u=l.create(d),c=t,f=!0,m={},g=[];function p(e,t){he.dispatch(e,"Buffer",t)}function v(e){he.validateNotificationData(e,["position"]),a&&(T(),S()),o.getSegmentStorage(c).setTimePosition(e.data.position),P()}function h(t){he.validateNotificationData(t,["bufferId","streamId","position"]),t.data.bufferId===e&&(r=t.data.position,a=t.data.streamId,t.data.streamId.indexOf("text")>-1&&P())}function E(t){he.validateNotificationData(t,["bufferId"]),t.data.bufferId===e&&(r=void 0,a=void 0)}function y(){if(Gt&&!e.includes("text")){u.debug("request append config",{bufferId:e});var t=o.getSegmentStorage(c).getConfigForHash(i);t?p(de,{streamId:c,bufferId:e,start:0,end:0,duration:0,bytes:t}):i=void 0}}function b(t){if(he.validateNotificationData(t,["bufferId"]),t.data.bufferId===e){var s,d=o.getSegmentStorage(c);if(function(){if(!a)return!1;if(c.indexOf("text")>-1)return!0;var e=o.getSegmentStorage(c).activeFragmentStartTime;if(e===ct)return!1;var t=o.getSegmentStorage(a);return t.setTimePosition(e),t.activeFragmentStartTime!==ct&&t.nextFragmentStartTime>=r&&t.nextFragmentContainsRAP}())return void T();for(;d&&d.hasNextFragment&&!s;)s=d.getNextFragment(),f&&!s.containsRAP?s=null:f=!1;s&&(function(t){var n=o.getSegmentStorage(c);i!==t.hash&&n.getConfigForHash(t.hash)&&(u.info("appending config",{streamId:c,fragmentHash:t.hash,fragmentStart:t.start}),p(de,{streamId:c,bufferId:e,start:t.start,end:t.end,duration:t.duration,bytes:n.getConfigForHash(t.hash)}),i=t.hash)}(s),function(t){var r=o.getSegmentStorage(c),a=t.bytes,i={start:t.start,end:t.end};"video"===n.substr(0,5)&&(t.containsRAP?r.hasNextFragment&&!r.nextFragmentContainsRAP&&(a=function(e,t){var n,r=o.getSegmentStorage(c),a=[];for(u.debug("merging subsequent fragments without RAP");r.hasNextFragment&&!r.nextFragmentContainsRAP;)n=r.getNextFragment(),e.end=n.end,a.push(n.bytes);return function(e){var t=function(e){for(var t=[],n=0;n<e.length;++n)t.push(kr(e[n]));return t}(e),n=t.shift(),r=jr.getBoxByPath(n,"moof.traf.trun"),a=jr.getBoxByPath(n,"moof.traf.tfdt"),i=r.length;!function(e,t,n){for(var r,a=Hr(n,"moof.traf.trun"),i=Hr(n,"moof.traf.tfdt"),o=0;o<a.length;++o)r=Zr(e,t),e.samples[e.sampleCount-1].duration+=i[o].baseMediaDecodeTime-r,e.samples=e.samples.concat(a[o].samples),e.sampleCount=e.samples.length}(r,a,t);for(var o=0;o<r.sampleCount;++o)r.samples[o].size;r.writeBytes(),r.dataOffset+=r.length-i,r.writeBytes();var s=jr.getBoxByFourCC(n,"mdat");return s.bytes=function(e){var t,n,r,a=8;for(t=0;t<e.length;++t)a+=jr.getBoxByFourCC(e[t],"mdat").length-8;(r=tr.create(new Uint8Array(a))).writeUnsignedInt32(a),r.writeString("mdat");var i=[];for(t=0;t<e.length;++t){n=jr.getBoxByFourCC(e[t],"mdat");var o=tr.slice(n.bytes,n.start+8,n.length-8);i.push(o),r.writeBytes(o)}return r.bytes}([n].concat(t)),s.start=0,s.length=s.bytes.length,Fr(n)}([t].concat(a))}(i,a)):(a=function(e){var t=kr(e),n=jr.getBoxByPath({boxes:t.boxes},"moof.traf.trun"),r=function(e){return e.flags.sampleFlagsPresent?xr(e.samples[0].flags):e.flags.firstSampleFlagsPresent?xr(e.firstSampleFlags):null}(n);return r.sampleIsDifferenceSample&&(r.sampleIsDifferenceSample=!1,r.sampleDependsOn=2,function(e,t){e.flags.sampleFlagsPresent?e.samples[0].flags=Br(t):e.flags.firstSampleFlagsPresent&&(e.firstSampleFlags=Br(t)),e.writeBytes()}(n,r)),Fr(t)}(a),p(A,{start:t.start,end:t.end}))),g.push(i),p(de,{streamId:c,bufferId:e,start:t.start,end:t.end,duration:t.duration,bytes:a})}(s))}}function T(){if(c=a,a=void 0,r=void 0,u.info("switching stream"),c.indexOf("text")>-1)S();else{var e=o.getSegmentStorage(c);s=e.activeFragmentStartTime}}function S(){s=void 0,p(ae,{bufferId:e,streamId:c})}function O(t){if(he.validateNotificationData(t,["position"]),void 0!==s&&s<=t.data.position&&S(),g.length&&t.data.position-3e4>g[0].start){for(var n=g.shift(),r=t.data.position-5e3;g.length&&g[0].end<r;)n.end=g.shift().end;p(ue,{streamId:c,bufferId:e,start:n.start,end:n.end})}}function P(){g=[],p(ce,{streamId:c,bufferId:e})}function D(t){if(e!==t.data.bufferId)return!1;p(oe,{bufferId:e}),p(se,{bufferId:e,ranges:g=[{start:0,end:0}]})}return he.addListener(Ie.SEEK,v),he.addListener(I,h),he.addListener(L,E),he.addListener(ln.TEXT_TRACK_ADDED,y),he.addListener(me,b),he.addListener(fe,(function t(n){he.validateNotificationData(n,["bufferId"]),n.data.bufferId===e&&(he.removeListener(Ie.SEEK,v),he.removeListener(I,h),he.removeListener(L,E),he.removeListener(ln.TEXT_TRACK_ADDED,y),he.removeListener(me,b),he.removeListener(fe,t),he.removeListener(J.POSITION,O),he.removeListener(ie,D),c=null,a=null,o=null,s=void 0)})),he.addListener(J.POSITION,O),he.addListener(ie,D),o=vr.getInstance(),m.bufferId=e,m.contentType=n,m},Yr="BufferManager",Kr=l.create(Yr);function Wr(e,t){he.dispatch(e,Yr,t)}var zr=function(e,t){return Math.floor(1e3*function(e,t){return e/t}(e,t))},Qr=["moof","mdat"],qr=l.create("FragmentExtractor");function Xr(e,t,n,r){var a=jr.getBoxByPath({boxes:e},"moof.traf.tfdt"),i=jr.getBoxByPath({boxes:e},"moof.traf.trun");if(a&&i){var o=zr(a.baseMediaDecodeTime,n),s=zr(t.subsegmentDuration,n);return{start:o,duration:s,end:o+s,bytes:Fr({boxes:e}),containsRAP:!!t.containsRAP,rapType:t.rapType,rapDeltaTime:t.rapDeltaTime,sampleCount:i.samples.length,hash:r}}qr.warn("a mandatory box is missing from the fragment, skip parsing.",{hash:r})}function $r(e,t,n){he.dispatch(Z,"ConfigExtractor",{config:e,hash:t,streamId:n})}var Jr=function(e,t,n,r){var a,i=0,o=[],s=0,d=ct,u=ct,c=0;function l(){return n&&n.length}function f(){return l()&&(0===i||i-1<n.length)}function m(){if(f())return n[0===i?i:i-1]}function g(){return l()&&i<n.length}function p(){i=0,v()}function v(){var e;a.hasActiveFragment=f(),a.activeFragmentStartTime=(e=m())?e.start:ct,a.hasNextFragment=g(),a.hasNextRAPFragment=function(){for(var e=i;e<n.length;){if(n[e].containsRAP)return!0;++e}return!1}(),a.nextFragmentContainsRAP=!!g()&&n[i].containsRAP,a.nextFragmentStartTime=g()?n[i].start:ct}return function(){for(var e=0;n&&e<n.length;++e)(n[e].containsRAP||"audio"===t.split(":")[0])&&o.push(n[e].start),s+=n[e].bytes.length;l()&&(d=n[0].start,u=n[n.length-1].start+n[n.length-1].duration,c=u-d)}(),a={getActiveFragment:m,lastSegment:!!r,getNextFragment:function(){var e=g()?n[i++]:void 0;return v(),e},setTimePosition:function(e){p();for(var t=0;n&&t<n.length;++t)if(n[t].containsRAP){if(!(n[t].start<=e))break;i=t}v()},reset:p,segmentId:e,streamId:t,fragments:n,size:s,keyFrames:o,firstTimestamp:d,lastTimestamp:u,duration:c},v(),a},ea="MP4SegmentWrapper",ta=["video/mp4","audio/mp4"],na=function(){var e=l.create(ea);function t(e,t){he.dispatch(e,ea,t)}function n(n){he.validateNotificationData(n,["segmentId","streamId","raw","contentType"]),-1!==ta.indexOf(n.data.contentType)&&(0===n.data.raw.length?(e.warn("zero byte segment",{streamId:n.data.streamId,segmentId:n.data.segmentId}),function(e){var n=Jr(e.segmentId,e.streamId,[]);t(B,{segment:n,streamId:e.streamId,segmentId:e.segmentId})}({segmentId:n.data.segmentId,streamId:n.data.streamId})):function(n){var r,a,i,o=kr(n.raw);(function(e,t){!function(e,t){for(var n,r=0;t&&r<t.boxes.length;++r)"fmov"===t.boxes[r].fourCC&&(n=jr.getBoxByFourCC(t.boxes[r],"hash"),$r(jr.getBoxByFourCC(t.boxes[r],"idta").rawInit,n.hash,e))}(e,jr.getBoxByPath(t,"free.ustm"))})(n.streamId,o),jr.getBoxByFourCC(o,"styp")&&(r=function(e,t){for(var n,r,a,i=jr.getBoxByFourCC(t,"sidx"),o=[],s=[],d=function(e,t){var n=[e],r=jr.getBoxByPath(t,"free.ustm.fhst");return r&&(n=r.hashes),n}(e,t),u=0;u<t.boxes.length;++u)r=t.boxes[u],-1!==Qr.indexOf(r.fourCC)&&(s.push(r),Qr.indexOf(r.fourCC)===Qr.length-1&&(a=d[Math.min(o.length,d.length-1)],(n=Xr(s,i.references[o.length],i.timeScale,a))&&o.push(n),s=[]));return o}(n.streamId,o),i=function(e){var t=!1,n=jr.getBoxByFourCC(e,"styp");return n&&(t=-1!==n.compatibleBrands.indexOf("lmsg")),t}(o),a=Jr(n.segmentId,n.streamId,r,i),e.debug("process segment",{streamId:n.streamId,segmentId:n.segmentId,firstTimestamp:a.firstTimestamp,lastTimestamp:a.lastTimestamp,duration:a.duration,keyFrames:a.keyFrames,lastSegment:a.lastSegment}),t(x,{segment:a,streamId:n.streamId,segmentId:n.segmentId,firstTimestamp:a.firstTimestamp,lastTimestamp:a.lastTimestamp,duration:a.duration,keyFrames:a.keyFrames}))}({segmentId:n.data.segmentId,streamId:n.data.streamId,raw:n.data.raw}))}return he.addListener(Ie.CLEANUP,(function e(){he.removeListener(Ie.CLEANUP,e),he.removeListener(j,n),t(He)})),he.addListener(j,n),t(Ze),{name:ea}},ra=new RegExp("([0-9:.]+) --\x3e ([0-9.:]+)(.*)");function aa(e){var t=e.replace(/[^0-9.:]/gi,"").split(":");return 60*Number(t[0])*60+60*Number(t[1])+Number(t[2])}var ia,oa="VTTSegmentWrapper",sa=[i.VTT],da=function(){var e=l.create(oa);function t(e,t){he.dispatch(e,oa,t)}function n(n){he.validateNotificationData(n,["segmentId","streamId","raw","contentType"]),-1!==sa.indexOf(n.data.contentType)&&function(n){var r=function(e,t){for(var n=[];e.length;){var r=e.shift(),a=1e3*r.start,i=1e3*r.end,o=r.payload.join("\n");n.push({start:a,duration:i-a,end:i,bytes:{id:r.id,meta:r.meta,text:o,length:o.length},containsRAP:!0,rapType:0,rapDeltaTime:0,sampleCount:r.payload.length,hash:t})}return n}(function(e){var t=[],n=e.replace(/\r\n/g,"\n").split("\n\n"),r=function(e){for(var t=0;t<e.length;){var n=e[t];if(ra.test(n))return t;t++}return-1}(n);return-1===!r?t:t=n.slice(r).map((function(e){return e.split("\n").filter((function(e){return""!==e}))})).filter((function(e){return e.length>=2})).map((function(e){return r=0===(n=function(e){var t=e.filter((function(e){return new RegExp(" --\x3e ").test(e)}));return e.indexOf(t[0])}(t=e))?null:t[0],a=n+1,o=(i=t[n].match(ra))[1],s=i[2],d=i[3]?function(e){return e.split(" ").filter((function(e){return!!e})).reduce((function(e,t){var n,r=t.split(":");switch(r[0]){case"A":r[0]="align";break;case"T":r[0]="position";break;case"L":r[0]="line";break;case"S":r[0]="size";break;case"D":r[0]="vertical"}return e[r[0]]=function(e){return/%$/.test(e)}(n=r[1])?+n.slice(0,-1):parseInt(n,10)||n,e}),{})}(i[3]):null,u=t.slice(a).filter((function(e){return""!==e})),{id:r,start:aa(o),end:aa(s),payload:u,meta:d};var t,n,r,a,i,o,s,d,u}))}(n.raw),n.streamId),a=Jr(n.segmentId,n.streamId,r);e.debug("process segment",{segment:a,streamId:n.streamId,segmentId:n.segmentId,firstTimestamp:a.firstTimestamp,lastTimestamp:a.lastTimestamp,duration:a.duration,keyFrames:a.keyFrames}),t(x,{segment:a,streamId:n.streamId,segmentId:n.segmentId,firstTimestamp:a.firstTimestamp,lastTimestamp:a.lastTimestamp,duration:a.duration,keyFrames:a.keyFrames})}({segmentId:n.data.segmentId,streamId:n.data.streamId,raw:n.data.raw})}return he.addListener(Ie.CLEANUP,(function e(){he.removeListener(Ie.CLEANUP,e),he.removeListener(j,n),t(He)})),he.addListener(j,n),t(Ze),{name:oa}},ua="BroadcasterTimer",ca=l.create(ua);function la(){return(new Date).getTime()}var fa,ma=function(e){var t,n,r,a,i,o=e.bufferId,s=e.segmentLength,d=(ia||(ia=function(){var e,t,n=v(),r=0,a=[];function i(){ca.info("destroyed"),he.removeListener(Ie.PAUSE,c),he.removeListener(Ie.SUSPEND,c),he.removeListener(Ie.RESUME,l),he.removeListener(Ie.WAKE,l),he.removeListener(Ie.SET_OPTION,m),he.removeListener(Ie.CLEANUP,i),he.removeListener(f,g),o()}function o(){d(),a=[],r=0,t=void 0,ia=null}function s(){e=setInterval(p,n)}function d(){clearInterval(e)}function u(){return(new Date).getTime()}function c(){d()}function l(){s()}function m(e){he.validateNotificationData(e,["name"]),e.data.name===Ee.MOVING_WINDOW_INTERVAL_DELAY&&(n=v(),d(),s())}function g(){d()}function p(){var e=t?u()-t:n;r+=e,t=u(),he.dispatch(b,ua,{position:r,bufferIds:a})}function v(){return De.get(Ee.MOVING_WINDOW_INTERVAL_DELAY)}return he.addListener(Ie.PAUSE,c),he.addListener(Ie.SUSPEND,c),he.addListener(Ie.RESUME,l),he.addListener(Ie.WAKE,l),he.addListener(Ie.SET_OPTION,m),he.addListener(Ie.CLEANUP,i),he.addListener(f,g),s(),{startInterval:s,reset:o,destroy:i,tickAhead:function(e){r=Math.max(0,r+e)},getPosition:function(){return r},setMovingWindow:p,addBufferId:function(e){a.push(e)}}}()),ia),u=l.create("ContentRangeLive."+o),c=Date.now()-e.lastStreamModuleReceived,m=e.segmentStartId+Math.floor((c||0)/s),g=m,p=m,v=e.segmentStartId+Math.floor((e.contentLength||0)/s),h=m,E=e.contentLength?0:null;function T(e){he.validateNotificationData(e,["position"]),I(e.data.position)}function S(e){he.validateNotificationData(e,["position"]),I(e.data.position)}function I(e){a=la(),g=A(r=e)||null,d.setMovingWindow()}function L(e){if(he.validateNotificationData(e,["position","bufferIds"]),e.data.bufferIds.includes(o)){var t=h,n=E;if(a){var i=la()-a,d=r+i;d>=E&&(E=d)}(Re.firstReferenceId||0===Re.firstReferenceId)&&(h=Re.firstReferenceId+Math.floor(e.data.position/s),p=h-10,v=h+1),O(),(t!==h||n!==E)&&he.dispatch(y,"ContentRangeLive",{bufferId:o,currentId:h,playPosition:E,videoTagSegmentId:g})}}function A(e){if("number"!=typeof n||"number"!=typeof e)return h;var r=e-n;return Math.max(0,t+Math.floor(r/s))}function O(){i.startId=p,i.endId=v,i.currentId=h,i.playPosition=E}return he.addListener(J.POSITION,T,he.MAXIMUM_PRIORITY),he.addListener(re.STALLED,S,he.MAXIMUM_PRIORITY),he.addListener(Ie.SEEK,T,he.MAXIMUM_PRIORITY),he.addListener(b,L),d.addBufferId(o),i={setReferencePoint:function(e,r){t=e,n=r,Re.firstReferencePosition=Re.firstReferencePosition||n,Re.firstReferenceId=Re.firstReferenceId||t},getSegmentIdForPosition:function(e){d.setMovingWindow();var t=A(e);return t>=p&&t<=v?t:void 0},setContentEnd:function(e){v=e,O()},broadcasterTickAhead:d.tickAhead,destroy:function(){u.info("destroyed"),he.removeListener(J.POSITION,T),he.removeListener(Ie.SEEK,T),he.removeListener(re.STALLED,S),he.removeListener(b,L),p=null,v=null,h=null,t=null,n=null,r=null,a=null,O()},getPlayPosition:function(){return E}},O(),i},ga="ContentRangeRecorded",pa=function(e){var t,n,r=e.bufferId,a=e.segmentLength,i=l.create("ContentRangeRecorded."+r),o=e.segmentStartId,s=o,d=0,u=Math.floor(e.contentLength/a),c=Math.floor(e.startTime/a),f=e.contentLength?0:null;function m(e){he.validateNotificationData(e,["position"]),t=e.data.position,s=p(t)||null,g(e)}function g(e){he.validateNotificationData(e,["position"]);var t=c,n=f;f=e.data.position,c=o+Math.floor(f/a),v(),(t!==c||n!==f)&&he.dispatch(y,ga,{bufferId:r,currentId:c,playPosition:f,videoTagSegmentId:s})}function p(e){return Math.floor(e/a)}function v(){n.currentId=c,n.playPosition=f,n.startId=d,n.endId=u}return he.addListener(Ie.SEEK,g),he.addListener(Zt,g),he.addListener(J.POSITION,m,he.MAXIMUM_PRIORITY),n={getSegmentIdForPosition:p,setContentEnd:function(e){u=e,v()},destroy:function(){i.info("destroyed"),he.removeListener(Ie.SEEK,g),he.removeListener(Zt,g),he.removeListener(J.POSITION,m),d=null,u=null,c=null,t=null,v()}},v(),he.dispatch(U,ga),n},va="livePauseHandler",ha=null,Ea=null,ya=function(e){return ha||(ha=function(e){function t(){var r=e.getPlayPosition()||Re.firstReferencePosition,a=Date.now()-Ea;he.dispatch(Ie.SEEK,va,{position:r+a}),he.removeListener(Ie.RESUME,t),he.addListener(Nt,n)}function n(){he.addListener(Ie.PAUSE,r),he.removeListener(Nt,n)}function r(){Ea=Date.now(),he.addListener(Ie.RESUME,t),he.removeListener(Ie.PAUSE,r)}return he.addListener(Ie.PAUSE,r),he.dispatch(U,va),{destroy:function(){he.removeListener(Ie.RESUME,t),he.removeListener(Ie.PAUSE,r),he.removeListener(Nt,n),ha=null,Ea=null}}}(e)),ha},ba=function(e,t){var n,r,a;function i(t){n=t.data.position,r=e.getSegmentIdForPosition(n),he.addListener(W,s)}function o(e,t){return e.start<=t&&e.end>=t}function s(e){he.validateNotificationData(e,["streamId","ranges","ids"]),a===e.data.streamId&&function(e){var t=function(e){var t=e.ids.findIndex((function(e){return o(e,r)}));return e.ranges[t]}(e);0!==(t?Math.abs(t.end-t.start):0)&&(o(t,n)?d():function(e){var t=function(e){return e.start>n?e.start:e.end}(e);fa.getSegmentStorage(a).setTimePosition(t),d()}(t))}({ranges:e.data.ranges,ids:e.data.ids})}function d(){n=null,r=null,he.removeListener(W,s)}return a=t,fa=vr.getInstance(),he.addListener(Ie.SEEK,i),{setStreamId:function(e){a=e},destroy:function(){return d(),he.removeListener(Ie.SEEK,i),a=null,fa=null,null}}},Ta=function(e){var t=e.bufferId,n=e.representationsOptions,r=e.lastStreamModuleReceived,a=l.create("ContentLoader."+t),i=!n.contentLength;Re.startTime=Re.startTime||(new Date).getTime(),Re.isLive=i;var o,s,d,u,c,f,m,g={},p={},h=Hn(n),b=0,T=0,S=0;function A(){he.removeListener(Ie.CLEANUP,A),he.removeListener(Ie.SUSPEND,M),he.removeListener(z,$),he.removeListener(Q,ee),he.removeListener(x,Y),he.removeListener(B,K),he.removeListener(H,q),he.removeListener(W,G),he.removeListener(y,F),he.removeListener(I,V),he.removeListener(L,j),he.removeListener(ae,Z),he.removeListener(Ie.PAUSE,N),he.removeListener(Ie.SEEK,O),he.removeListener(Ie.WAKE,k),he.removeListener(x,X),o=o.destroy(),s&&(s=s.destroy()),d=clearTimeout(d),m=m.destroy(),g={},D(E,{streamId:h}),c&&D(E,{streamId:c})}function O(e){S=e.data.position,w(),he.removeListener(Ie.SEEK,O),he.addListener(Nt,P,he.MINIMUM_PRIORITY),he.addListener(J.SEEK_COMPLETED,P,he.MINIMUM_PRIORITY)}function P(){he.addListener(y,F),he.addListener(Ie.PAUSE,N),he.removeListener(Nt,P),he.removeListener(J.SEEK_COMPLETED,P)}function D(e,t){he.dispatch(e,"ContentLoader",t)}function R(e,t,n){if(!function(e,t){return null!==C(e,t)}(e,t)){var r={streamId:e,segmentId:t,contentType:p[e].contentType,reason:n};D(v,r)}}function _(e,t,n){d=setTimeout((function(){R(e,t,n)}),10)}function C(e,t){var n=g[e];if(!n)return null;for(var r=n.ids,a=0;a<r.length;a+=1){var i=r[a];if(i.start<=t&&t<=i.end)return i}return null}function w(){if(o){var e,t,n=function(){var e=g[h];if(!e)return null;if(!o)return null;var t,n,r,a=e.ranges,i=e.ids,s=(n=function(e){var t=e.start,n=e.end;return S>=t&&S<=n+200},-1===(r=(t=a).slice().reverse().findIndex(n))?-1:t.length-1-r);return-1===s?null:i[s]}();if(n)e=ke.remaining(o.playPosition,g[h].ranges),t=n.end+1;else{e=0,t=o.currentId;var r=C(h,t);r&&(t=r.end+1)}e<function(){if(i)return 1/0;var e=De.get(Ee.CHUNK_PRELOAD_COUNT);return p[h].segmentLength*e}()&&U(t)&&(R(h,t,"check remaining time"),c&&t>f&&R(c,t,"check remaining time while switching quality"))}}function N(){he.removeListener(Ie.SEEK,O),he.removeListener(y,F),he.removeListener(Ie.PAUSE,N),he.addListener(Ie.SEEK,O)}function U(e){return o.startId<=e&&o.endId>=e}function M(){he.removeListener(Ie.SUSPEND,M),he.removeListener(y,F),he.addListener(Ie.WAKE,k)}function k(){he.removeListener(Ie.WAKE,k),he.addListener(y,F),he.addListener(Ie.SUSPEND,M)}function F(e){he.validateNotificationData(e,["bufferId","playPosition"]),S=e.data.playPosition,e.data.bufferId===t&&w()}function V(e){if(he.validateNotificationData(e,["bufferId","streamId","position"]),e.data.bufferId===t){if(c===h)return f=void 0,void(c=void 0);if(c===e.data.streamId)return;if(void 0!==(f=o.getSegmentIdForPosition(e.data.position))){R(c=e.data.streamId,f,"start quality change");var n=o.currentId,r=C(h,f);r&&(n=Math.max(n,r.end));for(var i=1;i<=n-f;i++)R(c,f+i,"request chunks before contentrange endId")}else a.error("unable to get segmentId for "+e.data.position)}}function j(e){he.validateNotificationData(e,["bufferId"]),e.data.bufferId===t&&(c&&D(E,{streamId:c}),c=void 0,f=void 0)}function Z(e){he.validateNotificationData(e,["bufferId","streamId"]),e.data.bufferId===t&&e.data.streamId===c&&(D(E,{streamId:h}),h=c,c=void 0,m.setStreamId(h),te())}function G(e){he.validateNotificationData(e,["streamId","ranges","ids"]);var t=e.data.streamId;p.hasOwnProperty(t)&&(g[t]={ranges:e.data.ranges,ids:e.data.ids},w())}function Y(e){if(he.validateNotificationData(e,["streamId","segmentId","firstTimestamp","duration","segment"]),p.hasOwnProperty(e.data.streamId)&&e.data.firstTimestamp!==ct){i&&o.setReferencePoint(e.data.segmentId,e.data.firstTimestamp),e.data.segment.lastSegment&&o.setContentEnd(e.data.segmentId),Math.abs(p[e.data.streamId].segmentLength-e.data.duration)>.2*p[e.data.streamId].segmentLength&&a.warn("unusual segment duration: "+e.data.duration+", segmentId: "+e.data.segmentId),b+=e.data.duration,T+=p[e.data.streamId].segmentLength;var t=b-T;a.debug("downloaded duration: "+b+", expected duration: "+T+", diff: "+t)}}function K(e){if(he.validateNotificationData(e,["streamId","segmentId"]),p.hasOwnProperty(e.data.streamId)){var t=e.data.segmentId+1;!i&&U(t)&&R(e.data.streamId,t,"zero byte segment")}}function q(e){he.validateNotificationData(e,["streamId","segmentId","status"]),p.hasOwnProperty(e.data.streamId)&&i&&404===e.data.status&&(he.removeListener(x,X),he.addListener(x,X,he.MAXIMUM_PRIORITY))}function X(e){he.validateNotificationData(e,["streamId","segmentId","firstTimestamp"]),p.hasOwnProperty(e.data.streamId)&&(he.removeListener(x,X),o.broadcasterTickAhead(-1e3))}function $(e){if(he.validateNotificationData(e,["streamId","position"]),p.hasOwnProperty(e.data.streamId)){var t=o.getSegmentIdForPosition(e.data.position);void 0!==t?_(e.data.streamId,t,"segment missing by position"):a.error("unable to get segmentId for position: "+e.data.position)}}function ee(e){he.validateNotificationData(e,["streamId","segmentId"]),p.hasOwnProperty(e.data.streamId)&&_(e.data.streamId,e.data.segmentId,"segment missing by id")}function te(){u.baseUrl=p[h].baseUrl,u.segmentUrl=p[h].segmentUrl,u.initUrl=p[h].initUrl,u.streamId=h}return a.debug("init",{bufferId:t,activeStreamId:h,representations:n}),he.addListener(Ie.CLEANUP,A),he.addListener(Ie.SUSPEND,M),he.addListener(z,$),he.addListener(Q,ee),he.addListener(x,Y),he.addListener(B,K),he.addListener(H,q),he.addListener(W,G),he.addListener(y,F),he.addListener(I,V),he.addListener(L,j),he.addListener(ae,Z),p[h]=n,function(e){var n,a=p[h];if(!a.contentLength)return o=ma({bufferId:t,segmentStartId:e,segmentLength:a.segmentLength,lastStreamModuleReceived:r}),s=ya(o),he.addListener(Ie.PAUSE,N),he.addListener(Ie.SEEK,O),!1;n=Re.player&&Re.player.element?1e3*Re.player.element.currentTime:Date.now()-Re.startTime,o=pa({bufferId:t,segmentStartId:e,segmentLength:a.segmentLength,contentLength:a.contentLength,startTime:n})}(p[h].segmentId),m=new ba(o,h),p[h].initUrl?R(h,o.currentId,"start with header"):R(h,o.currentId,"start with segment"),u={update:function(e){var t=Hn(e);p[t]=e},destroy:A},te(),u},Sa=function(e){var t,n,r,a=Hn(e),i=l.create("Representation."+e.contentType),o=e.contentType+';codecs="'+e.codecs+'"',s=0,d=!1;function u(e,t){he.dispatch(e,"buffer",t)}function c(){he.removeListener(Ie.SUSPEND,c),he.addListener(Ie.WAKE,f)}function f(){he.addListener(Ie.SUSPEND,c),he.removeListener(Ie.WAKE,f),m()}function m(){u(g,{streamId:a,contentType:o})}function p(e,t){var n=fr.getRepresentation(e),r=fr.getRepresentation(t);return n.label!==r.label||n.country!==r.country||n.language!==r.language?"language":"quality"}function v(e){"BufferManager"===e.originId.split(":")[1]&&m()}function h(e){he.validateNotificationData(e,["position"]),s=e.data.position}function E(r){if(he.validateNotificationData(r,["bufferId","contentType"]),r.data.contentType===o){he.removeListener(le,E),t=r.data.bufferId,i.debug("onBufferAdded "+t);var s=fr.getRepresentation(a);n=Ta({bufferId:t,representationsOptions:s,lastStreamModuleReceived:e.lastStreamModuleReceived})}}function y(e){he.validateNotificationData(e,["streamId","position"]),d&&e.data.streamId===a&&u(I,{bufferId:t,streamId:r,position:e.data.position})}function b(e){if(he.validateNotificationData(e,["bufferId","streamId"]),e.data.bufferId===t){u("language"===p(a,r)?w:R,{prevStreamId:a,activeStreamId:r}),fr.removeRepresentation(a);var n=fr.getRepresentation(e.data.streamId);fr.addRepresentation(n,e.data.streamId,"active"),d=!1,a=e.data.streamId,r=void 0,A()}}function A(){var e=fr.getRepresentation(a);De.set(Ee.MOVING_WINDOW_INTERVAL_DELAY,e.segmentLength/10)}return fr.addRepresentation(e,a,"active"),A(),Tr(a,e),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(Ie.CLEANUP,e),he.removeListener(Ie.SUSPEND,c),he.removeListener(Ie.WAKE,c),he.removeListener(Ze,v),he.removeListener(le,E),he.removeListener(J.POSITION,h),he.removeListener(q,y),he.removeListener(ae,b),Ir(a),r&&Ir(r),a=void 0,t=void 0,o=void 0,n=void 0,s=0,r=void 0,d=!1,fr.cleanup()})),he.addListener(Ie.SUSPEND,c),he.addListener(Ze,v),he.addListener(le,E),he.addListener(J.POSITION,h),he.addListener(q,y),he.addListener(ae,b),m(),{updateHash:function(e){var t=Hn(e);Tr(t,e)},update:function(e){var c=Hn(e);Tr(c,e);var l=c===a?"active":"requested";fr.addRepresentation(e,c,l),n&&n.update(e),d&&c!==r&&(i.debug("cancel stream switch",{activeStreamId:a,targetStreamId:r}),u("language"===p(a,r)?N:_,{activeStreamId:a,targetStreamId:r}),fr.removeRepresentation(r),u(S,{streamId:a}),u(L,{bufferId:t,streamId:r}),r=void 0,d=!1),d||c===a||function(e){r=e,d=!0;var n=fr.getRepresentation(e).segmentLength;i.debug("switch stream, searching switch position",{activeStreamId:a,targetStreamId:r,playPosition:s,segmentLength:n}),u("language"===p(a,r)?C:D,{activeStreamId:a,targetStreamId:r}),o.indexOf("video")>-1?u(T,{after:s,streamId:a}):u(I,{bufferId:t,streamId:r,position:s})}(c)},destroy:function(){fr.removeRepresentation(a),fr.removeRepresentation(r),n.destroy()}}},Ia="SegmentedController";function La(e,t){he.dispatch(e,Ia,t)}var Aa=function(e){var t,n,r=l.create(Ia),a=1/0,o=!1;function s(e){he.validateNotificationData(e,["position"]),a=Math.min(a,e.data.position),r.info("last segment reached, content finishes at "+a)}function d(){o=!1}function u(e){var t=e.type===J.BUFFER_EMPTY?200:0;he.validateNotificationData(e,["position"]),e.data.position>=a-t&&!o&&(r.info("content finished"),o=!0,n=setTimeout((function(){La(f)}),10))}function c(){for(var t,n,r=[],a=0;a<e.representations.length;++a)n=e.representations[a],(t={}).contentType=n.contentType,t.codecs=n.codecs,t.mediaType=n.contentType,t.initUrl=n.initUrl,t.baseUrl=e.baseUrl,t.segmentUrl=n.segmentUrl,t.segmentId=e.segmentId,t.segmentLength=n.segmentLength||5e3,t.hashes=e.hashes,t.contentLength=e.contentLength,t.contentStart=e.contentStart,t.lastStreamModuleReceived=e.lastStreamModuleReceived,t.label=n.label,t.country=n.country,t.language=n.language,r.push(t);return r}function m(n){he.validateNotificationData(n,["hashes"]),e=Object.assign(e,{hashes:n.data.hashes}),c().forEach((function(e){var n=e.mediaType;t[n]&&t[n].updateHash(e)}))}function g(n){he.validateNotificationData(n,["options"]),e=n.data.options;for(var r=c(),a=[],i=0;i<r.length;++i){if(t.hasOwnProperty(r[i].mediaType))t[r[i].mediaType].update(r[i]);else{if(["video/mp4","audio/mp4"].includes(r[i].mediaType))return void La(P,{mediaType:r[i].mediaType});t[r[i].mediaType]=Sa(r[i])}a.push(r[i].mediaType)}for(var o in t)t.hasOwnProperty(o)&&a.indexOf(o)<0&&(t[o].destroy(),delete t[o])}function p(t){var n;he.validateNotificationData(t,["bufferId","contentType"]),-1!==t.data.contentType.indexOf(i.VTT)&&function(e,t){if(Vn[e])return!1;Vn[e]=t}(t.data.bufferId,(n=i.VTT,e.representations.filter((function(e){return e.contentType===n}))[0]))}return e.contentLength&&(a=void 0!==e.contentStart?e.contentStart:0,a+=e.contentLength),function(e){t={};for(var n=0;n<e.length;++n)t.hasOwnProperty(e[n].mediaType)?r.warn("duplicated media type: "+e[n].mediaType):t[e[n].mediaType]=Sa(e[n])}(c()),he.addListener(Y,s),he.addListener(J.POSITION,u),he.addListener(J.BUFFER_EMPTY,u),he.addListener(Ie.SEEK,d),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(Y,s),he.removeListener(J.POSITION,u),he.removeListener(J.BUFFER_EMPTY,u),he.removeListener(Ie.SEEK,d),he.removeListener(Ie.CLEANUP,e),he.removeListener(Ie.UPDATE_OPTIONS,g),he.removeListener(Ie.UPDATE_HASHES,m),he.removeListener(le,p),t=null,n=clearTimeout(n),La(He)})),he.addListener(Ie.UPDATE_OPTIONS,g),he.addListener(Ie.UPDATE_HASHES,m),he.addListener(le,p),La(Ze),{name:Ia}},Oa=l.create("URLTools"),Pa=function(e){Oa.debug("serializeURLVariables ",e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return t.join("&")},Da="FLVSegmenterController",Ra=l.create(Da);function _a(e,t){he.dispatch(e,Da,t)}var Ca=function(e){var t,n,r,a,i,o,s,d,u=Hn(e),c=!1,l=0;function m(){he.removeListener(Ie.CLEANUP,m),he.removeListener(kn,T),he.removeListener(Fn,b),he.removeListener(le,O),he.removeListener(V,A),he.removeListener(W,y),he.removeListener(Ie.UPDATE_OPTIONS,P),he.removeListener(Ze,p),he.removeListener(z,S),he.removeListener(Ie.SEEK,I),he.removeListener(J.POSITION,I),he.removeListener(J.POSITION,L),he.removeListener(J.BUFFER_EMPTY,L),_a(He)}function p(e){var t=e.originId.split(":")[1];Ra.warn("onComponentCreate "+t+" DownloadQueue"),"DownloadManager"===t&&v()}function v(){_a("Controller.loadMovieMeta",{url:i+"?"+Pa(o),streamId:u})}function y(e){he.validateNotificationData(e,["streamId","ranges","ids"]),e.data.streamId===u&&(void 0===l&&e.data.ranges.length&&(l=e.data.ranges[0].start),s=e.data.ranges,d=e.data.ids,D())}function b(e){he.validateNotificationData(e,["streamId"]),Ra.error("onDownloaderFailure"),m()}function T(e){if(he.validateNotificationData(e,["streamId","metadata"]),u===e.data.streamId)if(Ra.debug("onDownloaderMetadata",e.data.metadata),e.data.metadata.segments){r=e.data.metadata.contentLength,a=e.data.metadata.contentSize,n=e.data.metadata.segments.positions,t=e.data.metadata.segments.times;for(var i=1;i<t.length;++i)t[i]===t[i-1]&&(t.splice(i,1),n.splice(i,1),i--);_a(g,{streamId:u,contentType:"flv"})}else Ra.error("onDownloaderMetadata : no segment info in metadata, unable to continue"),m()}function S(e){he.validateNotificationData(e,["streamId","position"]),e.data.streamId===u&&(l=e.data.position,D())}function I(e){he.validateNotificationData(e,["position"]),l=e.data.position,D()}function L(e){he.validateNotificationData(e,["position"]);var t=e.type===J.BUFFER_EMPTY?200:0;e.data.position>=r-t&&(Ra.info("content finished"),_a(f))}function A(e){he.validateNotificationData(e,["streamId"]),e.data.streamId===u&&(Ra.debug("download complete"),c=!1)}function O(e){he.validateNotificationData(e,["streamId"]),R()}function P(e){he.validateNotificationData(e,["options"]),C(e.data.options)}function D(){ke.remaining(l,s)<5e3&&!c&&R()}function R(){var f=ke.current(l,s),m=f?d[s.indexOf(f)]:null,g=m?m.end+1:function(e){for(var n=1;n<t.length;++n)if(t[n]>e)return n-1;return 1/0}(l),p=function(e){for(var n,a,i,o=0,s=0;s<15e3&&e+o<t.length;)o++,s+=(i=r,((a=e+o)<(n=t).length?n[a]:i)-t[e]);return o}(g);g!==1/0&&p&&function(s,d){c&&_a(E,{streamId:u});for(var l=[],f=[],m=[],g=s;g<s+d;++g)l.push(g),m.push(_(n,a,g)),f.push(_(t,r,g));o[e.seekParameter]=n[s];var p=i+"?"+Pa(o);c=!0,_a(h,{streamId:u,segmentIds:l,segmentDurations:f,segmentSizes:m,url:p})}(g,p)}function _(e,t,n){return(n<e.length-1?e[n+1]:t)-e[n]}function C(e){i=e.url.split("?")[0],o=function(e){Oa.debug("parseURLVariables "+e);var t,n={};if(-1!==e.indexOf("?")){t=e.split("?")[1].split("&");for(var r=0;r<t.length;++r)n[t[r].split("=")[0]]=t[r].split("=")[1]}return n}(e.url)}return C(e),fr.addRepresentation(e,u,"active"),Ra.debug("baseUrl: "+i,o),o.ri=0,o.rs=0,he.addListener(Ie.CLEANUP,m),he.addListener(kn,T),he.addListener(Fn,b),he.addListener(le,O),he.addListener(V,A),he.addListener(W,y),he.addListener(Ie.UPDATE_OPTIONS,P),he.addListener(Ze,p),he.addListener(z,S),he.addListener(Ie.SEEK,I),he.addListener(J.POSITION,I),he.addListener(J.POSITION,L),he.addListener(J.BUFFER_EMPTY,L),_a(Ze),_a(U,Da),v(),{name:Da}},wa="DirectController";function Na(e,t){he.dispatch(e,wa,t)}var Ua="GarbageCollector",Ma="unused",ka="used",Fa="switch",Va=.8,ja=l.create(Ua);function xa(){return De.get(Ee.MEMORY_LIMIT_IN_BYTES)}function Ba(e,t){he.dispatch(e,Ua,t)}var Za=function(){var e=0,t=!1,n={},r={},a=null;function i(){var n=xa();return e>n*(t?Va:1)}function o(d){he.validateNotificationData(d,["streamId"]);var u=xa();if(!i())return t=!1,ja.info("memory usage is back to normal",{memoryLimit:u,limitThreshold:u*Va,memoryUsage:e}),void he.removeListener(W,o);var c=Object.getOwnPropertyNames(n).sort(s),l=!!c.length&&c.shift();if(!function(e){return n[e].usage===ka||n[e].usage===Fa}(l)&&n[l].size>e-u)return a.removeSegmentStorage(l),void delete n[l];var f=!!l&&function(e){return function(e){return n[e]&&n[e].ids.length&&n[e].ids[0].start<r[e]}(e)?or:!!function(e){return n[e]&&n[e].ids.length&&n[e].ids[n[e].ids.length-1].end>r[e]}(e)&&sr}(l);f?(t=!0,Ba(f,{streamId:l})):(ja.warn("memory usage is high but there is no segment to discard",{memoryLimit:u,limitThreshold:u*Va,memoryUsage:e}),he.removeListener(W,o))}function s(e,t){if(n[e].usage!==n[t].usage){if(n[t].usage===Ma)return 1;if(n[e].usage===Ma)return-1;if(n[t].usage===ka)return 1;if(n[e].usage===ka)return-1}return n[t].length-n[e].length}function d(e,t){if(t!==Ma){var r={mediaType:Gn(e).mediaType,usage:t};for(var a in n)u(a,r)&&(n[a].usage=Ma);n[e]=n[e]||{},n[e].usage=t}else n[e].usage=t}function u(e,t){if(n.hasOwnProperty(e))return!1;for(var r in t)if(t.hasOwnProperty(r)&&e[r]!==t[r])return!1;return!0}function c(t){var r;he.validateNotificationData(t,["streamId","size","ranges","ids"]),n[t.data.streamId]=n[t.data.streamId]||{},(r=n[t.data.streamId]).ids=t.data.ids,r.size=t.data.size,r.ranges=t.data.ranges,r.length=function(e){for(var t=0,n=0;n<e.length;++n)t+=e[n].end-e[n].start;return t}(t.data.ranges),r.usage=r.usage||Ma,r.mediaType=Gn(t.data.streamId).mediaType,function(){for(var t in e=0,n)n.hasOwnProperty(t)&&(e+=n[t].size)}()}function l(n){he.validateNotificationData(n,["streamId","segmentId"]),r[n.data.streamId]=n.data.segmentId,d(n.data.streamId,ka),t||function(t){if(i()){var n=xa();ja.info("memory usage exceeds limit",{memoryLimit:n,limitThreshold:n*Va,memoryUsage:e}),he.addListener(W,o,he.MINIMUM_PRIORITY),o(t)}}(n)}function f(e){he.validateNotificationData(e,["streamId"]),d(e.data.streamId,ka)}function m(e){he.validateNotificationData(e,["streamId"]),d(e.data.streamId,Fa)}function g(e){he.validateNotificationData(e,["limit"]),ja.warn("apiEvents.SET_MAX_MEMORY_USAGE is deprecated, use the options module!"),De.set(Ee.MEMORY_LIMIT_IN_BYTES,e.data.limit)}return ja.debug("init"),he.addListener(W,c),he.addListener(X,l),he.addListener(ae,f),he.addListener(le,m),he.addListener(Ie.SET_MAX_MEMORY_USAGE,g),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(W,c),he.removeListener(W,o),he.removeListener(X,l),he.removeListener(ae,f),he.removeListener(le,m),he.removeListener(Ie.SET_MAX_MEMORY_USAGE,g),he.removeListener(Ie.CLEANUP,e),n=null,r=null,a=null,Ba(He)})),a=vr.getInstance(),Ba(Ze),{name:Ua}},Ha=l.create("ComponentFactory");function Ga(e){return e.some((function(e){return e.contentType===i.VTT}))}var Ya=function(e,t){!function(e,t){switch(t.format){case i.MP4_SEGMENTED:bn.create().initVideo(e),yt(t.contentLength),Ga(t.representations)&&$n.create(t),function(){var e,t,n,r,a=[],i=!1,o={},s={},d={},u=0;function c(){for(i=!0;a.length;){var t=a.shift();m(t.streamId,t.contentType)}e=setInterval(I,1e3)}function l(){i=!1,h(),clearInterval(e)}function f(e){he.validateNotificationData(e,["streamId","contentType"]),i?m(e.data.streamId,e.data.contentType):a.push({streamId:e.data.streamId,contentType:e.data.contentType})}function m(e,t){var n,a=t.split("/")[0],i=Object.keys(o).filter((function(e){return e.indexOf(a)>-1}))[0];i?n=i:(n=a+"."+Lt(3),o[n]=Gr(n,e,t)),Re.firstReferencePosition&&r.getSegmentStorage(e).setTimePosition(Re.firstReferencePosition+(Date.now()-Re.startTime)),s[n]=[],Wr(le,{streamId:e,bufferId:n,contentType:t})}function v(e){o.hasOwnProperty(e)&&(delete o[e],delete s[e],delete d[e],Wr(fe,{bufferId:e}))}function h(){for(var e in o)o.hasOwnProperty(e)&&v(e)}function E(e){he.validateNotificationData(e,["bufferId"]),v(e.data.bufferId)}function y(e){he.validateNotificationData(e,["bufferId"]),d[e.data.bufferId]=!0}function b(e){he.validateNotificationData(e,["bufferId","ranges"]),d[e.data.bufferId]=!1,s[e.data.bufferId]=e.data.ranges,I()}function T(e){he.validateNotificationData(e,["position"]),u=e.data.position,I()}function S(e){var t=e.substring(0,e.indexOf("."));return Re.representations.some((function(e){return e.mediaType.indexOf(t)>-1}))}function I(){var e,r=function(){var e=["audio","video"].filter((function(e){return(Re.representations||[]).some((function(t){return t.mediaType.indexOf(e)>-1}))}));return Object.getOwnPropertyNames(s).reduce((function(t,n){var r=n.split(".")[0];return-1!==e.indexOf(r)&&(t[n]=s[n]),t}),{})}(),a=(e=r,Object.getOwnPropertyNames(e).every((function(n){var r=e[n];return ke.remainingTotal(u,r)>=t}))),i=Object.getOwnPropertyNames(r).map((function(e){return r[e]})),o=ke.intersect.apply(null,i),c=ke.remainingTotal(u,o);for(var l in a&&c<n?t+=1e3:t=De.get(Ee.MINIMUM_REMAINING_THRESHOLD),s)if(s.hasOwnProperty(l)&&!d[l]){var f=ke.remainingTotal(u,s[l]);f||!Re.representations||S(l)?f<t&&Wr(me,{bufferId:l}):v(l)}}Kr.debug("create"),he.addListener(Ce,c),he.addListener(we,l),he.addListener(g,f),he.addListener(p,E),he.addListener(Ie.CLEANUP,(function n(){he.removeListener(Ce,c),he.removeListener(we,l),he.removeListener(g,f),he.removeListener(p,E),he.removeListener(Ie.CLEANUP,n),he.removeListener(oe,y),he.removeListener(se,b),he.removeListener(J.POSITION,T),he.removeListener(Ie.SEEK,T),he.removeListener(W,I),he.removeListener(Ne,I),he.removeListener(ln.EMPTY_CUE_ADDED,I),h(),clearInterval(e),o=null,a=null,u=null,s=null,d=null,t=null,Wr(He)})),he.addListener(oe,y),he.addListener(se,b),he.addListener(J.POSITION,T),he.addListener(Ie.SEEK,T),he.addListener(W,I),he.addListener(Ne,I),he.addListener(ln.EMPTY_CUE_ADDED,I),t=De.get(Ee.MINIMUM_REMAINING_THRESHOLD),n=De.get(Ee.COLDSTART_THRESHOLD),Wr(Ze),r=vr.getInstance()}(),ir(),Rr(),vr.create(),na(),da();break;case i.HLS:case i.MP4_MOVIE:bn.create().initVideo(e);break;case i.FLV_MOVIE:case i.FLV_SEGMENTED:(function(e,t){var n,r,a=function(e){var t=De.get(Ee.FLASH_PROXY_URL_SECURE),n=De.get(Ee.FLASH_PROXY_URL_PLAIN);if(void 0!==t&&void 0!==n)return"".concat(ut.ssl?t:n,"/player/atlas/atlas-4.0.0.swf");Dt.error("flash url is missing")}(),i="atlas."+Lt(3);function o(e){e.type===M?l.log(e.data.source,e.data.line,e.data.data,e.data.level):0!==e.originId.indexOf("Flash:")&&r&&r.dispatch(e.type,e.originId,e.data?encodeURIComponent(JSON.stringify(e.data)):null)}(n=function(e){var t=e.split("."),n=window;for(t.shift();t.length;)n[t[0]]||(n[t[0]]={}),n=n[t.shift()];return n}(Pt+i)).ready=function(){r=document.getElementById(i),Rt(Ze)},n.dispatch=function(e){he.dispatch(e.type,e.originId,e.data?JSON.parse(decodeURIComponent(e.data)):null)},function(){var t=document.createElement("div");t.id=i,document.getElementById(e).appendChild(t);var n={url:a,width:"100%",height:"100%",minVersion:"11.0.0",params:{wmode:"opaque",allowfullscreen:!0,bgcolor:"#000000",allowscriptaccess:"always"},flashVars:{cpath:Pt+i}};It.embedSWF(n.url,i,n.width,n.height,n.minVersion,null,n.flashVars,n.params),Re.player={type:"flash",id:i}}(),he.addListener("*",o),he.addListener(Ie.CLEANUP,(function e(){he.removeListener("*",o),he.removeListener(Ie.CLEANUP,e),r&&r.parentNode.removeChild(r),delete Re.player,function(e){var t=e.split("."),n=window;for(t.shift();t.length>1;)n=n[t.shift()];delete n[t.shift()]}(Pt+i),Rt(He)}))})(e,t.debug),Rr()}}(e,t),function(e){switch(e.format){case i.FLV_MOVIE:Za(),Ca(e);break;case i.FLV_SEGMENTED:case i.MP4_SEGMENTED:Za(),Aa(e);break;case i.HLS:case i.MP4_MOVIE:!function(e){var t;function n(){Na(Nt,{position:t}),he.removeListener(re.TIME_UPDATE,n)}function r(){Na(wt),he.removeListener(re.EMPTIED,r),!Re.isLive&&t>0&&he.addListener(re.TIME_UPDATE,n)}function a(n){he.validateNotificationData(n,["options"]);var a=e.url,i=n.data.options.url;a!==i&&function(e){he.addListener(re.EMPTIED,r),t=1e3*bn.getCurrentTime(),Na(m,{source:e})}(i),e=n.data.options}function i(){Na(f)}function o(){Na(m,{source:e.url})}he.addListener(re.ENDED,i),he.addListener(Ie.CLEANUP,(function e(){he.removeListener(re.ENDED,i),he.removeListener(Ie.CLEANUP,e),he.removeListener(Ie.WAKE,o),he.removeListener(re.TIME_UPDATE,n),he.removeListener(Ie.UPDATE_OPTIONS,a),he.removeListener(re.EMPTIED,r),fr.cleanup(),Na(He)})),he.addListener(Ie.WAKE,o),he.addListener(Ie.UPDATE_OPTIONS,a),fr.addRepresentation(e,"direct","active"),Na(m,{source:e.url}),Na(U,wa)}(e)}}(t)};function Ka(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wa(e){return(Wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var za,Qa,qa,Xa,$a=1,Ja=l.create("Atlas"),ei=null;function ti(){ci(r.ATLAS_FULLY_INITIALIZED)}function ni(){fi(),qa.cleanup(),qa=null,Qa=null,ei=null,De.cleanup(),ri(),di(Ze,mi),di(J.ERROR,vi),di(J.POSITION,yi),di(J.RESIZE,bi),di(J.BUFFERED,Ti),di(J.BUFFER_EMPTY,_i),di(J.BUFFER_FULL,_i),di(J.THROTTLE,Ci),di(J.CC_DETECTED,wi),di(J.AUDIO_TRACKS,ki),di(J.TEXT_TRACKS,Fi),di(J.SEEK_COMPLETED,Bi),di(J.WEBKIT_SUPPORTS_FULLSCREEN,Mi),di(re.WEBKIT_ENTER_FULLSCREEN,Ni),di(re.WEBKIT_END_FULLSCREEN,Ui),di(J.UNRECOVERED_STALLED,ji),di(J.PLAY_ERROR,xi),di(Nt,Bi),di(ln.TEXT_TRACK_CUE_CHANGE,Vi),di(se,Ti),di(V,gi),di(H,pi),di(W,Di),di(f,Ri),di(O,hi),di(P,Ei),di(D,Si),di(_,Ii),di(R,Li),di(U,ti),di(C,Ai),di(N,Oi),di(w,Pi),di(kn,Zi),di(Zt,Hi),ui(Ie.CLEANUP),l.cleanup()}function ri(){Xa.initialized=!!qa}function ai(e){fi(),ui(Ie.VOLUME,{volume:$a=e})}function ii(e,t){fi(),e===r.LOG?l.addListener(l.events.LOG,t):qa.addListener(e,t)}function oi(e,t){fi(),e===r.LOG?l.removeListener(l.events.LOG,t):qa.removeListener(e,t)}function si(e,t){he.addListener(e,t,he.MINIMUM_PRIORITY)}function di(e,t){he.removeListener(e,t)}function ui(e,t){he.dispatch(e,"atlas",t)}function ci(e,t){var n={event:e};"object"===Wa(t)&&null!==t&&Object.entries(t).forEach((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),2!==i.length);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e)||function(e,t){if(e){if("string"==typeof e)return Ka(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ka(e,2):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e),r=t[0],a=t[1];"event"===r?Ja.warn('notify: "event" property ignored on data'):n[r]=a})),qa.dispatch("Atlas.*",n),qa.dispatch(e,n)}function li(e,t,n){ci(r.ERROR,{error:e,recoverable:n=void 0===n||n,details:t})}function fi(){if(!qa)throw new Error("Initialize Atlas before usage!")}function mi(e){var t=e.originId.split(":")[1].split(".")[0];"QueueStreamProxy"!==t&&t!==bn.name||ai($a)}function gi(e){he.validateNotificationData(e,["time","size","url"]);var t={time:e.data.time,size:e.data.size,url:e.data.url};if(window.performance&&"function"==typeof window.performance.getEntriesByName){var n=performance.getEntriesByName(e.data.url);n.length&&(t.performance=n[0],performance.clearResourceTimings())}ci(r.BANDWIDTH,t)}function pi(e){he.validateNotificationData(e,["url","status"]),li(404===e.data.status||0===e.data.status?a.SEGMENT_NOT_FOUND:a.SEGMENT_LOAD_FAILED,{url:e.data.url,status:e.data.status,reason:e.data.reason})}function vi(e){he.validateNotificationData(e,["code","message"]);var t={code:e.data.code,message:e.data.message};li(a.VIDEO_PLAYER,t,!1),ni()}function hi(e){he.validateNotificationData(e,["streamId","segmentId","reason"]),li(a.CAN_NOT_CREATE_URL,e.data,!1),ni()}function Ei(e){he.validateNotificationData(e,["mediaType"]),li(a.NEW_REPRESENTATION,e.data,!1),ni()}function yi(e){he.validateNotificationData(e,["position"]),ci(r.POSITION,{position:e.data.position})}function bi(e){he.validateNotificationData(e,["width","height"]),ei={width:e.data.width,height:e.data.height}}function Ti(e){he.validateNotificationData(e,["bufferId","ranges"]),ci(r.BUFFERED,{ranges:e.data.ranges,bufferId:e.data.bufferId})}function Si(e){he.validateNotificationData(e,["activeStreamId","targetStreamId"]),ci(r.QUALITY_CHANGE_STARTED,{activeStreamId:e.data.activeStreamId,targetStreamId:e.data.targetStreamId})}function Ii(e){he.validateNotificationData(e,["activeStreamId","targetStreamId"]),ci(r.QUALITY_CHANGE_CANCELLED,{activeStreamId:e.data.activeStreamId,targetStreamId:e.data.targetStreamId})}function Li(e){he.validateNotificationData(e,["prevStreamId","activeStreamId"]),ci(r.QUALITY_CHANGE_COMPLETED,{prevStreamId:e.data.prevStreamId,activeStreamId:e.data.activeStreamId})}function Ai(e){he.validateNotificationData(e,["activeStreamId","targetStreamId"]),ci(r.LANGUAGE_CHANGE_STARTED,{activeStreamId:e.data.activeStreamId,targetStreamId:e.data.targetStreamId})}function Oi(e){he.validateNotificationData(e,["activeStreamId","targetStreamId"]),ci(r.LANGUAGE_CHANGE_CANCELLED,{activeStreamId:e.data.activeStreamId,targetStreamId:e.data.targetStreamId})}function Pi(e){he.validateNotificationData(e,["prevStreamId","activeStreamId"]),ci(r.LANGUAGE_CHANGE_COMPLETED,{prevStreamId:e.data.prevStreamId,activeStreamId:e.data.activeStreamId})}function Di(e){he.validateNotificationData(e,["streamId","ranges"]),ci(r.STORED,{ranges:e.data.ranges,streamId:e.data.streamId})}function Ri(){ci(r.FINISHED)}function _i(e){switch(e.type){case J.BUFFER_EMPTY:Ja.warn("buffer empty"),ci(r.BUFFER_EMPTY);break;case J.BUFFER_FULL:Ja.info("buffer full"),ci(r.BUFFER_FULL)}}function Ci(e){he.validateNotificationData(e,["state"]),ci(r.THROTTLE,{state:e.data.state})}function wi(){ci(r.X08_DETECTED)}function Ni(){ci(r.WEBKIT_ENTER_FULLSCREEN)}function Ui(){ci(r.WEBKIT_END_FULLSCREEN)}function Mi(e){ci(r.WEBKIT_SUPPORTS_FULLSCREEN,e)}function ki(e){ci(r.AUDIO_TRACKS,e)}function Fi(e){ci(r.TEXT_TRACKS,e)}function Vi(e){ci(r.TEXT_TRACK_CUE_CHANGE,e)}function ji(e){he.validateNotificationData(e,["position","remaining"]);var t={position:e.data.position,remaining:e.data.remaining};ci(a.UNRECOVERED_STALLED,t)}function xi(e){he.validateNotificationData(e,["error"]);var t={error:e.data.error};li(a.PLAY_ERROR,t)}function Bi(){ci(r.SEEK_COMPLETED)}function Zi(e){he.validateNotificationData(e,["metadata"]),ci(r.METADATA,{type:"flv",data:e.data.metadata})}function Hi(e){he.validateNotificationData(e,["position","gapLength"]),ci(r.GAP_RECOVERING,{gapEndPosition:e.data.position,gapLength:e.data.gapLength})}function Gi(){return Re.player&&Re.player.element?Re.player.element:null}Xa={events:r,errors:a,logLevels:l.levels,formats:i,capabilities:In,version:lt,internals:Re,initialized:!1,initialize:function(e){za=e,Ja.debug("initializing atlas ".concat(lt),{containerId:za}),qa=o(),De.init(),ri(),he.addListener(Ze,mi)},cleanup:ni,suspend:function(){fi(),ui(Ie.SUSPEND)},wake:function(){fi(),ui(Ie.WAKE)},play:function(e){if(Ja.debug("play",e),fi(),function(e){var t=!0;if(!e||"object"!==Ln(e))return!1;switch(e.format){case i.MP4_SEGMENTED:return(t=function(e){return!!e.representations&&e.representations.some((function(e){return!!e.contentType&&-1!==e.contentType.indexOf("text")}))}(e)?t&&Mn(e,Rn):t&&Mn(e,Dn))&&Un(e,On);case i.FLV_SEGMENTED:return(t=t&&Mn(e,_n))&&Un(e,Pn);case i.FLV_MOVIE:return Mn(e,Cn);case i.HLS:return Mn(e,wn);case i.MP4_MOVIE:return Mn(e,Nn);default:return An.error("unrecognized data format: "+e.format),!1}}(e)){var t,n=!Qa;Re.isLive=e.isLive,Qa=e,n?function(e){return-1===In.indexOf(e.format)?(Ha.error("unsupported format",{format:e.format}),!1):!(e.format===i.MP4_SEGMENTED&&!function(e){for(var t,n,r,a=!0,o=0;e.representations&&o<e.representations.length;++o)(n=e.representations[o]).contentType===i.VTT?(t='application/mp4; codecs="text/vtt"',r=!0):(t=n.contentType+';codecs="'+n.codecs+'"',r=Tt(t)),r?Ha.info("playable type",{mediaType:t}):Ha.error("unplayable type",{mediaType:t}),a=a&&r;return a}(e))}(t=e)?(si(J.ERROR,vi),si(J.POSITION,yi),si(J.RESIZE,bi),si(J.BUFFERED,Ti),si(J.BUFFER_EMPTY,_i),si(J.BUFFER_FULL,_i),si(J.THROTTLE,Ci),si(J.SEEK_COMPLETED,Bi),si(J.CC_DETECTED,wi),si(J.AUDIO_TRACKS,ki),si(J.TEXT_TRACKS,Fi),si(J.WEBKIT_SUPPORTS_FULLSCREEN,Mi),si(re.WEBKIT_ENTER_FULLSCREEN,Ni),si(re.WEBKIT_END_FULLSCREEN,Ui),si(J.UNRECOVERED_STALLED,ji),si(J.PLAY_ERROR,xi),si(Nt,Bi),si(ln.TEXT_TRACK_CUE_CHANGE,Vi),si(se,Ti),si(V,gi),si(H,pi),si(W,Di),si(f,Ri),si(O,hi),si(P,Ei),si(D,Si),si(_,Ii),si(R,Li),si(U,ti),si(C,Ai),si(N,Oi),si(w,Pi),si(kn,Zi),si(Zt,Hi),Ya(za,t)):li(a.UNSUPPORTED):(function(e){switch(e.format){case i.MP4_SEGMENTED:Ga(e.representations)&&$n.create()}}(e),ui(Ie.UPDATE_OPTIONS,{options:e}))}else li(a.INVALID_OPTIONS)},pause:function(){fi(),ui(Ie.PAUSE)},resume:function(){fi(),ui(Ie.RESUME)},seek:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";fi(),Ja.info("seek",{position:e});var n=Gi();ci(r.SEEK_STARTED,{from:n&&n.currentTime,to:e/1e3,initiator:t}),ui(Ie.SEEK,{position:Math.floor(e)})},getOption:function(e){return fi(),De.get(e)},setOption:function(e,t){return fi(),De.set(e,t,!0)},optionNames:Ee,getVideoTag:Gi,getFlashObjectSize:function(){return ei},setHash:function(e){fi(),ui(Ie.UPDATE_HASHES,{hashes:e})},setVolume:ai,getVolume:function(){return fi(),$a},setPlaybackSpeed:function(e){fi(),ui(Ie.PLAYBACK_SPEED,{speed:e})},setCaptionPosition:function(e){fi(),ui(Ie.CAPTION_POSITION,{position:e})},toggleCaptions:function(e){var t=e.trackId,n=e.isVisible;fi(),ui(Ie.CAPTIONS,{trackId:t,isVisible:n})},selectAudio:function(e){fi(),ui(Ie.SELECT_AUDIO,{id:e})},getVideoMetrics:function(){return fi(),bn.getInstance().getMetrics()},on:ii,off:oi,addListener:ii,removeListener:oi},ri();var Yi=Xa;return t}()}}]);