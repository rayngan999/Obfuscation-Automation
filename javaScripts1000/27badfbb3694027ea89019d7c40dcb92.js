ï»¿(window.webpackJsonp=window.webpackJsonp||[]).push([["audioplayer"],{"4bNW":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return onRowOver}));var core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("HEwt"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("Btvt"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("rGqo"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("ioFf"),_lib_dom__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("zxIV"),_lib_dom_events__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("Egk5");function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],a=!0,o=!1,s=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){o=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function onRowOver(audioEl,event,forceRedraw){Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.ab)(audioEl,"podcast_list_snippet")||Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.ab)(audioEl,"podcast_snippet__controls")||(Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.l)(audioEl,"leaved",!1),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.l)(audioEl,"actions")&&!forceRedraw||Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.ab)(audioEl,"no_extra")||(clearTimeout(window.audioRowHoverTO),window.audioRowHoverTO=setTimeout(()=>{window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(audioEl);var audio=AudioUtils.getAudioFromEl(audioEl),audioObject=AudioUtils.getAudioFromEl(audioEl,!0),actions=[],moreActions=[],context=AudioUtils.getContextPlaylist(audioEl,!0),_AudioUtils$contextSp=AudioUtils.contextSplit(context),_AudioUtils$contextSp2=_slicedToArray(_AudioUtils$contextSp,2),sectionContext=_AudioUtils$contextSp2[0],blockContext=_AudioUtils$contextSp2[1],extra=AudioUtils.getAudioExtra(audioObject);if(context=sectionContext,audioObject.isDeleted)if(AudioUtils.isPodcast(audioObject))actions.push(["add",AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"===context)actions.push(["restore_recoms",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{var deleteRestoreInfo=AudioUtils.getAddRestoreInfo();deleteRestoreInfo[audioObject.fullId]&&deleteRestoreInfo[audioObject.fullId].deleteAll&&actions.push(["delete",AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{var actionsList=["next","add","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(AudioUtils.isPodcast(audioObject))actionsList=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.ab)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"current_delete","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=["recoms","next","edit","add","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=["add"];else if(context)switch(context){case"album_page":actionsList=["recoms","next","edit","add","share","open_album","add_to_playlist"];break;case"my":case"module":case"user_list":case"group_list":actionsList=["recoms","edit","next","add","delete","share","open_album","add_to_playlist"];break;case"edit_playlist":actionsList=["add","next","edit"];break;case"recoms_recoms":actionsList=["recoms","next","add","recoms_delete","share","open_album","add_to_playlist"];break;case"recoms_recent_audios":actionsList=["recoms","edit","next","add","listened_delete","share","open_album","add_to_playlist"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;case"search_results":"search_owned_audios"===blockContext&&(actionsList=["recoms","edit","next","add","delete","share","open_album","add_to_playlist"]);break;case"recommendations":"recoms_recoms_detail"===blockContext&&(actionsList=["recoms","next","add","recoms_delete","share","open_album","add_to_playlist"]);break;case"apps_edit":actionsList=["apps_edit_delete"];break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add","share","open_album","add_to_playlist"])}("moderation_video"===context||window.AdminVideoCatalogue)&&(actionsList=["link_to_clip"]),actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&each(extra.moder_actions,(i,act)=>{moreActions.push(["moder_"+i,(audioEl,audio)=>{eval(act[1])},act[2]])}),audioObject.isCurrentAlbumSnippet&&(actionsList=actionsList.filter(e=>"open_album"!==e)),vk.id||(actionsList=actionsList.filter(e=>"open_album"===e));var ap=getAudioPlayer(),currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget&&(AudioUtils.isPodcast(audioObject)||inArray(context,["my","group_list","search_results","my_playlists"]));each(actionsList,(e,t)=>{switch(t){case"link_to_clip":audioObject.isUMA&&actions.push(["link",window.AdminVideoCatalogue.processAudioInShortVideo,"LINK"]);break;case"next":audioObject.isCurrent||audioObject.isClaimed||AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":var i=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&cur.audioPage.getOwnerId()!==audioObject.ownerId&&(i=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=i&&actions.push(["add",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",()=>{showAudioClaimWarning(audioObject,extra.claim,AudioUtils.replaceWithOriginal.bind(AudioUtils,audioEl,audioObject))},getLang("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",AudioUtils.isPodcast(audioObject)?AudioUtils.editEpisode:AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":!audioObject.canDelete||audioObject.isInRecomsBlock||vk.widget||actions.push(["delete",AudioUtils.isPodcast(audioObject)?AudioUtils.deleteEpisode:AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"current_delete":actions.push(["current_delete",AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms_delete":actions.push(["recoms_delete",AudioUtils.deleteRecomsAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"listened_delete":audioObject.isInRecomsBlock||actions.push(["listened_delete",AudioUtils.deleteListenedAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"apps_edit_delete":actions.push(["delete",window.AppsEdit.removeAudio,"",'onmouseover="AppsEdit.showRemoveAudioTooltip(this)"']);break;case"fave":AudioUtils.isPodcast(audioObject)&&actions.push(["fave",AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"share":audioObject.isClaimed||moreActions.push(["share",AudioUtils.shareAudio,getLang("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",getLang("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",AudioUtils.showAudioAlbum,getLang("audio_open_album")]);break;case"open_episode":AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",AudioUtils.openEpisode,getLang("audio_podcast_open_episode")])}}),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",AudioUtils.unclaim.bind(this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",AudioUtils.claim.bind(this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){var actionsEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.rb)('<div class="_audio_row__actions audio_row__actions"></div>');each(actions,(e,t)=>{var i=AudioUtils.getRowActionName(t[0],audioObject,audioEl),a=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.rb)(`<button aria-label="${i}" data-action="${t[0]}" class="audio_row__action audio_row__action_${t[0]} _audio_row__action_${t[0]}${t[4]?" "+t[4]:""}" ${t[3]||""}>${t[2]||""}</button>`);t[1]&&a.addEventListener("click",e=>(t[1]&&t[1].call(window,audioEl,audioObject),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_7__.c)(e))),actionsEl.appendChild(a)});var rectoreInfo=AudioUtils.getAddRestoreInfo(),audioRestorationInfo=rectoreInfo[audioObject.fullId];audioRestorationInfo&&rectoreInfo[audioRestorationInfo.addedFullId]&&(audioRestorationInfo=null),audioRestorationInfo&&"added"===audioRestorationInfo.state&&addClass(audioEl,"audio_row__added");var rowInfoEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.L)("_audio_row__info",audioEl),rowDurationEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.L)("_audio_row__duration",audioEl),rowAlreadyActionsEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.L)("_audio_row__actions",audioEl);if(!rowInfoEl)return;Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.kb)(rowAlreadyActionsEl),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.vb)(rowDurationEl,"visibility","hidden"),rowInfoEl.appendChild(actionsEl);var moreActionsBtnEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.L)("_audio_row__action_more",actionsEl);moreActions.length&&moreActionsBtnEl&&setMoreAction(audioEl,audio,audioObject,moreActions,moreActionsBtnEl),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.l)(audioEl,"actions",1)}},forceRedraw?0:10)))}function setMoreAction(e,t,i,a,o){var s=gpeByClass("im-page_classic",e),r=gpeByClass("_im_peer_history_w",e),l=gpeByClass("_im_peer_history",e),n=gpeByClass("_im_chat_body_abs",e),d=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.rb)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),_=gpeByClass("wk_history_audio_content",e),u={};l?(u.getWrapEl=()=>s?null:n,u.appendTo=l):_?u.appendTo=_:gpeByClass("post",e)?u.appendTo=document.body:u.appendToParent=!0;var c=new ElementTooltip(o,extend({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:d,bottomGap:s&&r?parseInt(getStyle(r,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(e,t){Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.v)(t,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:()=>{Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.l)(e,"leaved")&&AudioUtils.onRowLeave(e)}},u));each(a,(a,o)=>{var s=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.rb)(Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.qb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,o));switch(o[0]){case"add_to_playlist":var r,l;s.addEventListener("mouseenter",r=()=>{clearTimeout(l),l=setTimeout(()=>{s.removeEventListener("mouseenter",r),AudioUtils.initRowPlaylistsChooser(t,s,c)},150)}),s.addEventListener("click",()=>{l||AudioUtils.initRowPlaylistsChooser(t,s,c)}),s.addEventListener("mouseleave",()=>{clearTimeout(l)});break;default:s.addEventListener("click",t=>(o[1].call(window,e,i),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_7__.c)(t)))}d.appendChild(s)}),addEvent(o,"click",e=>{c.isShown()||c.show(),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_7__.c)(e)}),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.l)(e,"tt",c)}},"4e3S":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AudioLayer}));var _lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("98sY");class AudioLayer{static prepare(e){stManager.add([jsc("web/audio.js"),"audio.css",jsc("web/suggester.js"),jsc("web/auto_list.js"),jsc("web/indexer.js")],()=>{e&&e()})}constructor(){this._els={layerPlace:ge("top_audio_layer_place"),topPlayBtn:geByClass1("_top_audio_player_play"),topNotaBtn:geByClass1("TopNavBtn__audio"),topNotaBtnGroup:ge("top_audio_btn_group")}}toggle(e,t){this._initTooltip();var i=this._els.tooltip,a=void 0!==e?e:!i.isShown();a&&this.initPage(),a?(i.show(),cancelStackPush("top_audio",()=>{this.toggle(!1,!0)},!0)):(t||cancelStackPop(),i.hide()),toggleClass(this._els.topNotaBtn,"TopNavBtn--active",a)}hide(){this._els.tooltip.hide()}isShown(){return this._els.tooltip&&this._els.tooltip.isShown()}updatePosition(){return this._els.tooltip&&this._els.tooltip.updatePosition()}_layerPosition(){var e=getXY(this._els.layerPlace),t=getXY("ts_wrap")[0]-e[0]-1,i=0;isVisible(this._els.topNotaBtnGroup)?i=-t+(getXY(this._els.topNotaBtn)[0]-e[0])+15:i=-t+(getXY(this._els.topPlayBtn)[0]-e[0])+3;return{left:t,top:0,arrowPosition:i}}getPageInstance(){return this._page}getTemplate(){return`\n      <div class="audio_layer_container">\n        <div class="top_audio_loading">\n          ${rs(vk.pr_tpl,{id:"",cls:"pr_big"})}\n        </div>\n      </div>\n    `}_initTooltip(){this._els.tooltip||(this._els.container=se(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:()=>{this._page&&this._page.onLayerHide()},onShow:()=>{this._page&&this._page.onLayerShow(this._initSection)}}))}initPage(){this._page||ajax.post("al_audio.php",{act:"layer",is_layer:1,section:window.ap.getCurrentPlaylist()?"current":"all"},{onDone:(html,data,templatesScript)=>{if(this._els.tooltip.isShown()){try{eval(templatesScript)}catch(e){Object(_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.d)(e,templatesScript)}this._els.container.innerHTML=html,this._page=new AudioPage(geByClass1("_audio_page_layout",this._els.container),data),this._initSection="recoms"==data.initSection?data.initSection:void 0,this._page.onLayerShow(this._initSection)}},onFail:()=>!0})}}},"5xrp":function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));i("91GP");var a=i("6ng+"),o=i("fY4C"),s=i("/PiP"),r=i("lXup"),l=i("pOqz");function n(e){var t,i=window.currentAudioPage&&window.currentAudioPage(e),a=i&&i.getPageCurrentPlaylist(),o=Object(r.a)(e,!0);return o&&(o=Object(l.a)(o),Array.isArray(o)&&o.length>0&&(t=o[0])),("search"===t&&a&&a.getSearchQid()||"search"===window.cur.module&&window.cur.qid)&&(t="search:external"),t}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function _(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new a.a(new o.a(Object(s.l)())),l=t&&t.context||e&&n(e)||"",_=t&&t.album&&t.album.slice(0,2).join("_"),u=d({},t,{context:l,playlistId:_},i);r.sendCurrentAudioEvent({type:u.type,subtype:u.subtype||r.getPlaySubtype(),ownerId:u.ownerId,audioId:u.id,trackCode:u.trackCode,state:r.playerAdapter.getState(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):"",context:u.context,playlistId:u.playlistId})}},B3ia:function(e,t,i){"use strict";i.d(t,"a",(function(){return oe}));var a=i("4e3S"),o=i("pp2G"),s=i("zxIV"),r=i("rEJs"),l="top_audio_player_enabled";class n{constructor(e){this.ap=getAudioPlayer(),this._el=e,this._playIconBtn=Object(s.J)("top_audio"),this._audioBtnGroup=Object(s.J)("top_audio_btn_group"),this.init()}static init(){var e=Object(s.J)("top_audio_player"),t=Object(s.l)(e,"object");t||(t=new n(e),Object(s.l)(e,"object",t))}init(){var e=this;function t(t){return Object(s.ab)(this,"top_audio_player_play")?(e.ap.podcastSetActionRef(e.ap.getCurrentAudio(),e.ap.isPlaying()?o.a.PodcastsLogs.ACTION_PAUSE:o.a.PodcastsLogs.ACTION_PLAY,"top_player"),e.ap.isPlaying()?e.ap.pause():e.ap.play(),!1):Object(s.ab)(this,"top_audio_player_prev")?(e.ap.playPrev(),!1):Object(s.ab)(this,"top_audio_player_next")?(e.ap.playNext(),!1):void 0}this.ap.on(this,r.a.UPDATE,this.onUpdate.bind(this)),this.ap.on(this,r.a.PLAY,this.onPlay.bind(this)),this.ap.on(this,r.a.PLAY_REQUESTED,this.onPlay.bind(this)),this.ap.on(this,[r.a.PAUSE,r.a.STOP],this.onPause.bind(this)),this.ap.top=this,each(["prev","play","next"],(function(i,a){addEvent(Object(s.L)("top_audio_player_"+a,e._el),"click",t)})),addEvent(this._el,"mousedown",(function(e){if(!Object(s.ab)(Object(s.C)(e.target),"top_audio_player_btn"))return 1!=e.which||Object(s.ab)(e.target,"top_audio_player_btn")||Object(s.ab)(e.target,"top_audio_player_act_icon")||o.a.getLayer().toggle(),cancelEvent(e)})),addEvent(Object(s.J)("top_audio"),"mousedown",(function(e){return!0!==checkEvent(e)&&(o.a.getLayer().toggle(),cancelEvent(e))})),browser.safari||addEvent(document,"keydown keyup",(function(e){Object(s.zb)(Object(s.J)("top_audio_play"),"shuffle",e.shiftKey)})),this._resetAudio(),this._updateTitle(this.ap.getCurrentAudio())}onPause(){Object(s.mb)(this._el,"top_audio_player_playing");var e=Object(s.L)("_top_audio_player_play_blind_label");e&&(e.innerHTML=getLang("global_audio_play"))}onPlay(e,t,i){this._hideButton(),requestAnimationFrame((function(){var e=o.a.getLayer();e&&e.isShown()&&e.updatePosition()})),Object(s.c)(this._el,l),Object(s.zb)(this._el,"top_audio_player_playing",!0);var a=Object(s.L)("_top_audio_player_play_blind_label");a&&(a.innerHTML=this.ap.isPlaying()?getLang("global_audio_pause"):getLang("global_audio_play")),this._updateTitle(e,i)}onUpdate(e){e?(this._updateTitle(e),this._hideButton(),Object(s.c)(this._el,l)):this._resetAudio()}_updateTitle(e,t){if(t=intval(t),e=o.a.asObject(e),Object(s.zb)(this._el,"audio_player_podcast",o.a.isPodcast(e)),e){void 0!==this._currTitleReTO&&clearTimeout(this._currTitleReTO);var i=Object(s.L)("top_audio_player_title_out",this._el);Object(s.kb)(i);var a=Object(s.L)("top_audio_player_title",this._el);if(0!==t){var r=t<0?-10:10,l=`opacity: 0; top: ${r}px; left: ${a.offsetLeft}px`,d=this.getTitleText(e),_=Object(s.rb)('<div class="top_audio_player_title top_audio_player_title_next" style="'+l+'">'+d+"</div>");_.setAttribute("onmouseover","setTitle(this)"),t>0?domInsertAfter(_,a):domInsertBefore(_,a),Object(s.c)(a,"top_audio_player_title_out"),Object(s.vb)(a,{top:-r,opacity:0}),setTimeout((function(){Object(s.vb)(_,{top:0,opacity:1})}),10),clearTimeout(this._currTitleReTO),this._currTitleReTO=setTimeout((function(){Object(s.kb)(a),Object(s.mb)(_,"top_audio_player_title_next")}),n.TITLE_CHANGE_ANIM_SPEED)}else a&&(a.innerHTML=this.getTitleText(e),a.titleSet=0,a.setAttribute("onmouseover","setTitle(this)"))}}getTitleText(e){return e.performer+" &mdash; "+e.title}_resetAudio(){Object(s.mb)(this._playIconBtn,l),Object(s.mb)(this._el,l),Object(s.mb)(this._el,"top_audio_player_playing"),Object(s.mb)(this._el,"audio_player_podcast"),Object(s.xb)(this._audioBtnGroup);var e=o.a.getLayer();e&&e.isShown()&&e.updatePosition()}_hideButton(){Object(s.bb)(this._audioBtnGroup),Object(s.ab)(this._playIconBtn,l)||Object(s.c)(this._playIconBtn,l)}}n.TITLE_CHANGE_ANIM_SPEED=190;var d,_=i("D33C"),u=(i("HEwt"),i("a1Th"),i("rGqo"),i("rE2o"),i("ioFf"),i("OEbY"),i("VRzm"),i("Btvt"),i("KKXr"),i("fY4C")),c=i("6ng+"),h=i("Emh1"),p=i("YvCB"),g=i("XBHu"),f=i("xk4V"),A=i("YQfe"),y=i("S0WU"),b=i("C13D"),v=i("tGJf"),P=(i("pIFo"),i("nAFc")),m=i("DM2o"),O=i("QChX"),I=i("W0fz");function E(){d&&!d.getCurrentAudio()&&Object(O.b)()}function w(){if(O.a){var e=d.getCurrentPlaylist(),t=d.getCurrentAudio(),i=Object(b.a)(t);if(i){var a=Object(P.a)(i.title+(i.subTitle?` (${i.subTitle})`:"")).replace(/<[^>]*>?/gm,""),o=Object(P.a)(i.performer||"").replace(/<[^>]*>?/gm,""),s=Object(P.a)(e&&e.getTitle&&e.getTitle()||"").replace(/<[^>]*>?/gm,""),r=i.coverUrl_p||i.coverUrl_s,l=r?[{sizes:"160x160",src:r}]:[];!function(){if(!O.a)return;if(d.ads.isPlaying())navigator.mediaSession.setActionHandler("play",C),navigator.mediaSession.setActionHandler("pause",T),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null);else{navigator.mediaSession.setActionHandler("play",C),navigator.mediaSession.setActionHandler("pause",T);var e=d.getCurrentPlaylist(),t=d.getCurrentAudio();if(e&&e.isLive()?(navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null)):(navigator.mediaSession.setActionHandler("seekbackward",L),navigator.mediaSession.setActionHandler("seekforward",S)),e&&!Object(I.a)(t)){var i=e.indexOfAudio(t),a=e.getAudioAt(i-1),o=e.getAudioAt(i+1);a?navigator.mediaSession.setActionHandler("previoustrack",D):navigator.mediaSession.setActionHandler("previoustrack",null),o?navigator.mediaSession.setActionHandler("nexttrack",j):navigator.mediaSession.setActionHandler("nexttrack",null)}else navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null)}}(),Object(O.c)({title:a,artist:o,album:s,artwork:l})}}}function C(){d.play(),Object(m.a)("global_media_controls","audio_player","play")}function T(){d.pause(),Object(m.a)("global_media_controls","audio_player","pause")}function L(){var e=Object(b.a)(d.getCurrentAudio()),t=d.getCurrentProgress()*e.duration,i=Math.max(0,(t-10)/e.duration);i>0?d.seek(i):d.playPrev(),Object(m.a)("global_media_controls","audio_player","seek_backward")}function S(){var e=Object(b.a)(d.getCurrentAudio()),t=d.getCurrentProgress()*e.duration,i=Math.min(1,(t+10)/e.duration);i<1?d.seek(i):d.playNext(),Object(m.a)("global_media_controls","audio_player","seek_forward")}function D(){d.playPrev(),Object(m.a)("global_media_controls","audio_player","previous_track")}function j(){d.playNext(),Object(m.a)("global_media_controls","audio_player","next_track")}var U,x=i("wNya"),k=i("/0DE"),R=(U=function(e,t){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}U(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),M=function(e){function t(t){return e.call(this,t)||this}return R(t,e),t.prototype.connect=function(e){var t=this;e&&this.listenQueueKey!==e.key&&(this.connected=!0,this.listenQueueKey=e.key,window.Notifier.addKey({key:e.key,ts:e.timestamp},(function(e,i){return t.queueHandler(i)})))},t}(k.a),B=i("8zW9"),N=i("W9Tc"),F=null,H=null,W=!1,K=0,Y=new M((function(e){if(e.failed)return void G(!0);for(var t=getAudioPlayer(),i=t.isPlaying(),a=t.getCurrentAudio(),o=AudioUtils.isPodcast(a),s=0;s<e.events.length;s++){var r=e.events[s].data;if("start"===r.type&&AudioPlayer.getDeviceId()!==r.uuid&&!H&&!o&&i){t.pausedByQueue=Date.now(),t.pause(),H=showBox("al_audio.php",{act:"start_playback_box",uuid:r.uuid,device_name:r.device_name},{params:{hideButtons:!0,onHide:()=>{H=!1}},containerClass:"audio_playback_box"});break}}})),X=new M((function(e){e.events.length&&e.events.forEach(e=>{1===e.data.product_id&&(vk.audioAdsConfig.enabled=!e.data.active)})}));function G(e){if(window.Notifier&&vk.id){var t=window.ap&&getAudioPlayer(),i=t&&t.getCurrentAudio(),a=window.Notifier&&!vk.widget,o=!W&&i?Y.listenQueueKey:X.listenQueueKey,s=AudioUtils.isPodcast(i);(e||a&&!s&&!o)&&(i||Object(N.b)("audio_subscription_update"))&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;ajax.post("al_audio.php",{act:"queue_params",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{onDone:t,onFail:i})}(i=i?AudioUtils.asObject(i):{},e=>{var t=function(e){var t=Object(B.a)(e);t.audio&&Y.connect(t.audio);t.subscription&&X.connect(t.subscription);return t}(e);W=!i||!t.audio,(t.audio||t.subscription)&&(F&&clearTimeout(F),F=window.setTimeout(()=>G(!0),3e4))},()=>(++K<3&&G(!0),!0))}}var V=i("DM26"),q=i("OOHW"),$=i("tWcy"),Q=i("eH33");function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],a=!0,o=!1,s=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){o=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return J(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return J(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var Z={},ee=Object(V.f)(()=>{},1500,!0);class te{constructor(){if(this.ensureUrlReject=null,this._currentAudio=!1,this._isPlaying=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlists=[],this.subscribers=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!0,!vk.isBanned){o.a.debugLog("Player creation"),this.eventBus=new y.a;var e,t=new u.a(this);this.stats=new c.a(t),this.ads=new g.a(this,te.getVersion()),this.connectEvents(),G(),this._restoreVolumeState(),this._initImpl(),this._initEvents(),this._podcastCleanStates(),this._listenStatusExport(),setTimeout(()=>{this.restoreState(),o.a.toggleAudioHQBodyClass(),this.updateCurrentPlaying()}),e=this,O.a&&(d&&(d.eventBus.unsubscribe(r.a.PLAY,w),d.eventBus.unsubscribe(r.a.PLAYLIST_CHANGED,E)),(d=e).eventBus.subscribe(r.a.PLAY,w),d.eventBus.subscribe(r.a.PLAYLIST_CHANGED,E))}}static getVersion(){return 15}static _sendLCNotification(){var e=window.Notifier;e&&e.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(e){}}static showHQLabel(e){var t="_audio_show_hq_label";return void 0===e?!!ls.get(t):(e=!!e,ls.set(t,e),o.a.toggleAudioHQBodyClass(),e)}static getAudioElementsByAudioId(e,t){return geByClass("_audio_row_"+e,t)}static getDeviceId(){var e=ls.get(te.LS_PREFIX+te.LS_UUID);return e||(e=f(),ls.set(te.LS_PREFIX+te.LS_UUID,e)),e}static showSubscriptionPopup(){showBox("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})}static getDurationType(){return intval(ls.get(te.LS_PREFIX+te.LS_DURATION_TYPE))}static _setTabIcon(e){setFavIcon(te.tabIcons[e])}static _lsGet(e){return ls.get(te.LS_PREFIX+e)}static _lsSet(e,t){return ls.set(te.LS_PREFIX+e,t)}static _podcastGetStates(){return(te._lsGet(te.LS_PODCASTS)||Z).states||{}}static _podcastSetStates(e){var t=te._lsGet(te.LS_PODCASTS)||Z;t.states=e,te._lsSet(te.LS_PODCASTS,t),Z=t}static podcastToggleFave(e,t){if(t){t=o.a.asObject(t);var i=o.a.getAudioExtra(t).faveHash;i&&bookmarkPodcast(e,t.fullId,i)}}static podcastGetPlaybackRate(){return(te._lsGet(te.LS_PODCASTS)||Z).rate||1}static getLang(e){var t=getAudioPlayer();return t&&t.langs?t.langs[e]:e}static clearDeprecatedCacheKeys(){te._iterateCacheKeys(e=>e===te.LS_VER)}static clearOutdatedCacheKeys(){(ls.get(te.LS_PREFIX+te.LS_SAVED)||0)<vkNow()-72e5&&te._iterateCacheKeys((e,t)=>!inArray(t,[te.LS_PL,te.LS_TRACK,te.LS_PROGRESS]))}getCurrentAudioLs(){return ap.getCurrentAudio()||te._lsGet(te.LS_TRACK)}static clearAllCacheKeys(){te._iterateCacheKeys(()=>!1),setCookie("remixcurr_audio","",-1)}static _iterateCacheKeys(e){v.a.getPrefixedKeys(te.LS_KEY_PREFIX+"_").forEach(t=>{var i=z(t.split("_"),3),a=i[1],o=i[2];e(a,o)||v.a.removeItem(o)})}_initImpl(){this._impl&&this._impl.destroy();var e=0,t=!1,i=t=>{if(-1!==e){if(t&&(e++,this.implTaskManager.delay(200),e>3)){e=-1;var i=new MessageBox({title:getLang("global_error")}).content(getLang("audio_error_loading")).setButtons("Ok",(function(){e=0,curBox().hide()}));return i.show(),Object(p.a)((function(){e=0,i.hide()}),3e3),this.notify(r.a.ENDED),void this.notify(r.a.FAILED)}o.a.isPodcast(this.getCurrentAudio())?(this.setIsPlaying(!1),this.notify(r.a.PAUSE),this.notify(r.a.ENDED),this.stop()):this._repeatCurrent?(this._autoNext=!0,this.notify(r.a.ENDED),this.notify(r.a.PROGRESS,0),this.implTaskManager.seekImmediate(0),Object(p.a)(()=>{this._impl&&this._impl.clearAudioNode&&(this._impl.stop(),this._implSetUrl(this.getCurrentAudio())),this._implPlay()})):(this.setIsPlaying(!1),this.notify(r.a.ENDED),this.playNext(!0))}},a={onPause:()=>{this.setIsPlaying(!1),this.notify(r.a.PAUSE),t=!1},onPlay:()=>{this.setIsPlaying(!0),this.setVolume(this.getVolume()),this.notify(r.a.PLAY),t=!1},onBufferUpdate:e=>{this.notify(r.a.BUFFERED,e)},onEnd:i,onFail:()=>{this._sendPlayerErrorStats(this._impl),i(!0)},onCanPlay:()=>this.notify(r.a.CAN_PLAY),onProgressUpdate:(e,i)=>{var a=this.getCurrentAudio();if(!this._muteProgressEvents&&a){var s=this._impl.getDuration()||a[o.a.AUDIO_ITEM_INDEX_DURATION];this.notify(r.a.PROGRESS,e,s,i),!vk.id&&s-i<te.UNAUTH_FADE_TIME&&!t&&(t=!0,this.fadeOut(1e3*te.UNAUTH_FADE_TIME))}},onFrequency:e=>{this.notify(r.a.FREQ_UPDATE,e)},defaultVolume:this._userVolume};this._impl=new h.a(a),this.implTaskManager=new x.a(this._impl),this.implTaskManager.setVolume(0)}fadeIn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300;this.implTaskManager.setVolume(this.getVolume(),!0,e)}fadeOut(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300;this.implTaskManager.setVolume(0,!0,e)}onMediaKeyPressedEvent(e){var t=this.getCurrentAudio();this.getCurrentPlaylist();if(t)switch(e.keyCode){case 179:this.isPlaying()?this.pause():this.play();break;case 178:this.seek(0),this.pause();break;case 177:this.playPrev();break;case 176:this.playNext()}}setAdsConfig(e){this.ads&&this.ads.setAdsConfig(e)}deletePlaylist(e){for(var t=0;t<this._playlists.length;t++)this._playlists[t]===e&&this._playlists.splice(t,1)}mergePlaylistData(e,t){this._playlists.forEach(i=>{i.getId()===e.getId()&&i.getOwnerId()===e.getOwnerId()&&(i.hasMore()?i.mergeWith(t):i.mergeInfo(t))})}deleteCurrentPlaylist(){this._currentPlaylist.removeSortedList(),delete this._currentAudio,delete this._currentPlaylist,this.notify(r.a.UPDATE),this.notify(r.a.PLAYLIST_CHANGED),this.stop(),this.updateCurrentPlaying()}updateCurrentPlaying(e){e=!!e;var t=o.a.asObject(this.getCurrentAudio()),i=[];if(t){var a=geByClass("_audio_row_"+t.fullId);i=i.concat([].slice.call(a))}for(var s=0,r=this._currentPlayingRows.length;s<r;s++){var l=this._currentPlayingRows[s];l&&!inArray(l,i)&&this.toggleCurrentAudioRow(l,!1,e)}if(t)for(var n=0,d=i.length;n<d;n++){var _=i[n];if(_){if(gpeByClass("article_editor_canvas",_))continue;this.toggleCurrentAudioRow(_,!0,e)}}this._currentPlayingRows=i,each(geByClass("_audio_pl"),(e,t)=>removeClass(t,"audio_pl__playing"));var u=this.getCurrentPlaylist();if(this.isPlaying()&&u){var c=geByClass(`_audio_pl_${u.getOwnerId()}_${u.getPlaylistId()}`);c&&each(c,(e,t)=>addClass(t,"audio_pl__playing"))}}scrollToCurrentPlaying(e,t){var i=te.getAudioElementsByAudioId(e);window.AudioPage&&i.forEach(e=>{var i=window.currentAudioPage(e);if(i&&i._scroll){var a=i.getCurrentSectionEl()||i.getPageContainer();te.getAudioElementsByAudioId(t,a).length||i.drawMore(),i.scrollIntoView(te.getAudioElementsByAudioId(t,a)[0],150)}})}toggleCurrentAudioRow(e,t,i){var a=o.a.getAudioFromEl(e,!0);addClass(e,o.a.AUDIO_CURRENT_CLS),a.withInlinePlayer&&toggleClass(e,"audio_row__player_transition",i),(i=!!a.withInlinePlayer&&i)?setTimeout(()=>this._updateAudioEl(t,e,a,i),0):this._updateAudioEl(t,e,a,i)}_updateAudioEl(e,t,i,a){var s=geByClass1("_audio_row__play_btn",t),l=geByClass1("_audio_row__title",t),n=geByClass1("_audio_row__duration",t),d=o.a.getDurationMod(e?i.duration:i.duration*this.getCurrentProgress());e&&t&&!1===this.isPlaying()&&(removeClass(t,"audio_row__playing"),s&&attr(s,"aria-label",getLang("global_audio_play")),l&&attr(l,"role",""));var _=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(n){var i=o.a.getDurationMod(e);n.innerHTML=t+formatTime(e),i!==d&&(replaceClass(n,o.a.AUDIO_DURATION_CLS+"-"+d,o.a.AUDIO_DURATION_CLS+"-"+i),d=i)}};if(i.withInlinePlayer&&(e?this._addRowPlayer(t):this._removeRowPlayer(t)),e){this.on(t,[r.a.PLAY,r.a.PLAY_REQUESTED],e=>{o.a.asObject(e).fullId===i.fullId&&(addClass(t,o.a.AUDIO_PLAYING_CLS),s&&attr(s,"aria-label",getLang("global_audio_pause")),l&&attr(l,"role","heading"))}),this.on(t,r.a.PROGRESS,(e,t,a)=>{if(i.withInlinePlayer||!this.ads.isPlaying()){a=intval(a);var o=0,s="";te.getDurationType()?(o=Math.round(a-t*a),s="-"):o=Math.round(t*a),_(o,s)}else _(i.duration)});var u=data(t,"bars");if(!u&&(i.isWithCovers||i.isNumeric||i.isPodcastListSnippet)){if(u=se('<canvas class="audio_row__sound_bars"></canvas>'),i.isPodcastListSnippet?geByClass1("podcast_list_snippet__cover",t).appendChild(u):t.appendChild(u),u.width=o.a.AUDIO_ROW_COVER_SIZE*(isRetina()?2:1),u.height=o.a.AUDIO_ROW_COVER_SIZE*(isRetina()?2:1),u.style.width=o.a.AUDIO_ROW_COVER_SIZE,u.style.height=o.a.AUDIO_ROW_COVER_SIZE,isRetina())u.getContext("2d").scale(2,2);var c=i.isNumeric;this.on(t,r.a.FREQ_UPDATE,(e,t)=>ae(u,t,c)),ae(u,[0,0,0,0],c),data(t,"bars",u)}toggleClass(t,o.a.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(t),removeClass(t,o.a.AUDIO_PLAYING_CLS),removeClass(t,o.a.AUDIO_CURRENT_CLS),_(i.duration),s&&attr(s,"aria-label",getLang("global_audio_play")),l&&attr(l,"role","");var h=data(t,"bars");h&&(re(h),data(t,"bars",null))}a?setTimeout(()=>{var e=o.a.getAudioFromEl(t,!0);toggleClass(t,o.a.AUDIO_CURRENT_CLS,!!e.isCurrent)},0):toggleClass(t,o.a.AUDIO_CURRENT_CLS,e)}_removeRowPlayer(e){removeClass(e,o.a.AUDIO_CURRENT_CLS);var t=data(e,"player_inited");if(t){setTimeout(()=>re(geByClass1("_audio_inline_player",e)),200);var i=geByClass1("_audio_duration",e);i&&(i.innerHTML=formatTime(o.a.getAudioFromEl(e,!0).duration)),this.off(e),each(t.sliders,(e,t)=>t.destroy()),data(e,"player_inited",!1);var a=geByClass1("has_audio_player",e);a&&removeClass(a,"has_audio_player")}}_addRowPlayer(e){if(!(geByClass1("_audio_inline_player",e)||hasClass(e,"podcast_list_snippet")||hasClass(e,"podcast_snippet__controls")||hasClass(e,"PodcastWidget__player"))){var t=se(vk.audioInlinePlayerTpl||getTemplate("audio_inline_player")),i=geByClass1("_audio_player__place",e);i.appendChild(t),addClass(i,"has_audio_player");var a=new Slider(geByClass1("audio_inline_player_volume",t),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>this.setVolume(e)}),s=new Slider(geByClass1("audio_inline_player_progress",t),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>formatTime(Math.round(e*this._impl.getDuration())),onEndDragging:e=>{var i=o.a.asObject(this.getCurrentAudio());i&&o.a.isPodcast(i)&&this.podcastSetActionRef(i,o.a.PodcastsLogs.ACTION_SEEK,"",t),this.seek(e)}});this.ads.isPlaying()&&s.toggleAdState(!0),vk.id||s.setBlocked(!0),this.on(e,r.a.AD_DEINITED,()=>{}),this.on(e,r.a.AD_READY,()=>{}),this.on(e,r.a.AD_STARTED,()=>{s.toggleAdState(!0),s.setBackValue(0)}),this.on(e,r.a.AD_COMPLETED,()=>s.toggleAdState(!1)),this.on(e,r.a.START_LOADING,()=>s.toggleLoading(!0)),this.on(e,r.a.CAN_PLAY,()=>s.toggleLoading(!1)),this.on(e,r.a.BUFFERED,(e,t)=>s.setBackValue(t)),this.on(e,r.a.PROGRESS,(e,t)=>{s.toggleLoading(!1),s.setValue(t)}),this.on(e,r.a.VOLUME,(e,t)=>{a.setValue(t,!0)}),data(e,"player_inited",{sliders:[a,s]})}}hasStatusExport(){for(var e in this._statusExport)if(this._statusExport.hasOwnProperty(e)&&this._statusExport[e])return!0;return!1}getStatusExportInfo(){return this._statusExport}setStatusExportInfo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._statusExport=e,t&&this.setStatusExportInfoStorage(e)}setStatusExportInfoStorage(e){te._lsSet(te.LS_STATUS_EXPORT,e)}deleteAudioFromAllPlaylists(e){e=isObject(e)||isArray(e)?o.a.asObject(e).fullId:e,each(this._playlists,(t,i)=>i.removeAudio(e))}updateAudio(e,t){var i="";return isString(e)?i=e:isArray(e)&&(i=o.a.asObject(e).fullId),t||(t=e),each(this._playlists,(e,a)=>{for(var s=a.getAudiosList(),r=function(e,a){`${s[e][o.a.AUDIO_ITEM_INDEX_OWNER_ID]}_${s[e][o.a.AUDIO_ITEM_INDEX_ID]}`===i&&(isObject(t)&&each(t,(t,i)=>s[e][t]=i),isArray(t)&&(s[e]=t))},l=0,n=s.length;l<n;l++)r(l)}),`${this._currentAudio[o.a.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[o.a.AUDIO_ITEM_INDEX_ID]}`===i&&(isObject(t)&&each(t,(e,t)=>this._currentAudio[e]=t),isArray(t)&&(this._currentAudio=t,this.notify(r.a.CURRENT_CHANGED))),this.notify(r.a.UPDATE),e}_triggerTNSPixel(){var e=te._lsGet("tns_triggered_time_v3")||0,t=vkNow();t-e<864e5||(te._lsSet("tns_triggered_time_v3",t),vkImage().src="https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/"+irand(1,1e9))}_restoreVolumeState(){te.clearDeprecatedCacheKeys(),te.clearOutdatedCacheKeys();var e=te._lsGet(te.LS_VOLUME);this._userVolume=null==e||!1===e?A.a:e}restoreState(){if(!vk.widget&&(te.clearDeprecatedCacheKeys(),te.clearOutdatedCacheKeys(),!window.cur.audioPreventRestoreTrack)){this._currentAudio=te._lsGet(te.LS_TRACK);var e=te._lsGet(te.LS_PL);e&&(e=JSON.parse(e),this._currentPlaylist=new AudioPlaylist(e),this._initPlayingContext(e.context),e.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=e.originalPlaylistRawId)),this._currentPlaylist&&this._currentAudio?this.notify(r.a.UPDATE):this._currentPlaylist=this._currentAudio=!1;var t=0;if(o.a.isPodcast(this._currentAudio)){var i=te._podcastGetStates(),a=`${this._currentAudio[o.a.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[o.a.AUDIO_ITEM_INDEX_ID]}`;t=((i[a]||{}).position||0)/this._currentAudio[o.a.AUDIO_ITEM_INDEX_DURATION]}else t=te._lsGet(te.LS_PROGRESS)||0;this._currentAudio&&this._impl&&this._implSetUrl(this._currentAudio,!0).then(()=>{t&&t<1?this.implTaskManager.seek(t):this.implTaskManager.setVolume(0),this.notify(r.a.CURRENT_CHANGED)}).catch(()=>{this.deleteCurrentPlaylist(),this.notify(r.a.CURRENT_CHANGED)}),this._updatePlaybackRate()}}_implPlay(){var e=o.a.asObject(this.getCurrentAudio());this.implTaskManager.play().then(()=>{if(this._muteProgressEvents=!1,this._allowPrefetchNext=!browser.safari,e.actionHash&&(G(),ajax.post("al_audio.php",{act:"start_playback",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash,uuid:te.getDeviceId()},{onFail:()=>!0})),o.a.isPodcast(e)){var t=this._podcastRestoreState();this._podcastUpdateState(e,t,0,o.a.PodcastsLogs.ACTION_PLAY)}})}_implSetUrl(e,t){this.implTaskManager.clearTask(x.b.URL),t||this.notify(r.a.START_LOADING);var i=Object(b.a)(e);return this._ensureHasURL(i).then(e=>{if(e.url)return this.implTaskManager.setUrl(e.url).catch(()=>{this.implTaskManager.clearAllTasks(),this.notify(r.a.FAILED),this.isPlaying()&&(this.pause(),this.playNext(!0,!0))});throw new Error})}toggleDurationType(){var e=te.LS_PREFIX+te.LS_DURATION_TYPE,t=intval(ls.get(e));ls.set(e,!t),this.notify(r.a.UPDATE,this.getCurrentProgress())}getCurrentProgress(){return this._impl?this._impl.getCurrentProgress():0}getCurrentBuffered(){return this._impl?this._impl.getCurrentBuffered():0}_initEvents(){var e=window.Notifier;e&&(e.addRecvClbk("audio_start","audio",()=>{(this.isPlaying()||this.ads.isPlaying())&&(this.pausedByAudio=Date.now(),this.pause()),delete this.pausedByVideo}),e.addRecvClbk("video_start","audio",()=>{(this.isPlaying()||this.ads.isPlaying())&&(this.pause(),this.pausedByVideo=Date.now())}),e.addRecvClbk("video_hide","audio",()=>{!this.isPlaying()&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.play(),delete this.pausedByVideo)}),e.addRecvClbk("logged_off","audio",()=>{cur.loggingOff=!0,te.clearAllCacheKeys(),this.stop()}),e.addRecvClbk("stories_video_start","audio",()=>{this.isPlaying()&&(this.pause(),this.pausedByStories=vkNow())}),e.addRecvClbk("stories_video_end","audio",()=>{!this.isPlaying()&&this.pausedByStories&&(vkNow()-this.pausedByStories<18e4&&this.play(),delete this.pausedByStories)}))}addPlaylist(e){var t=this.hasPlaylist(e.getId());this.hasPlaylist(e.getId())?t.mergeWith(e.asObject()):this._playlists.push(e)}_cleanUpPlaylists(){for(var e=0,t=-1,i=this._playlists.length-1;i>=0;i--){var a=this._playlists[i];if(!a.isReference()&&(e+=a.getAudiosCount())>4e3){t=i;break}}if(-1!==t){t+=1;for(var o=this._playlists.slice(0,t),s=this.getCurrentPlaylist(),r=[],l=0;l<o.length;l++){var n=o[l];if(s===n&&(n=!1),n&&!n.isReference())for(var d=t;d<this._playlists.length;d++){var _=this._playlists[d];_.isReference()&&_.getSelf()===n&&(n=!1)}n&&r.push(l)}for(var u=0;u<r.length;u++){var c=r[u];this._playlists.splice(c,1)}r.length&&debugLog("AudioPlayer - "+r.length+" playlists removed")}}hasPlaylist(e,t,i,a){var o;if(a)return this._playlists.find(e=>e.getBlockId()===a||e.getAlbumId()===a)||!1;o=void 0!==t&&void 0!==i?`${e}_${t}_${i}`:e;for(var s=0;s<this._playlists.length;s++){var r=this._playlists[s];if(!r.isReference()&&r.getId()===o)return r}return!1}getPlaylistByBlockId(e){return this.hasPlaylist(null,null,null,e)||null}getPlaylistsByType(e){return this._playlists.filter(t=>t.getType()===e)||null}getPlaylist(e,t,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(e&&!t&&!i){var s=z(AudioPlaylist.splitId(e),3);e=s[0],t=s[1],i=s[2]}var r=this.hasPlaylist(e,t,i,o);return r?(r.mergeWith({accessHash:a}),r):new AudioPlaylist({type:e,ownerId:t,albumId:i,hasMore:e!==AudioPlaylist.TYPE_TEMP,accessHash:a,blockId:o})}isFromNextSequence(){return 1===this._seq}isFromPrevSequence(){return-1===this._seq}isAutoPlayed(){return!!this._autoNext}hasPrevAudio(){return!(!this._prevAudio||o.a.getAudioFullId(this._currentAudio)===o.a.getAudioFullId(this._prevAudio))}hasPrevPlaylist(){return!!this._prevPlaylist}toggleRepeatCurrentAudio(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1}isRepeatCurrentAudio(){return!!this._repeatCurrent}toggleRepeatAll(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1}isRepeatAll(){return!!this._repeatAll}setNext(e,t){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;if(!hasClass(e,"audio_row__added_next")){addClass(e,"audio_row__added_next");var i=this.getCurrentPlaylist();if(i){var a=o.a.asObject(this.getCurrentAudio());if(a&&t.fullId===a.fullId)return;var s=i.indexOfAudio(a);if(-1===s)return;this.notify(r.a.PLAY_NEXT,a.fullId,t.fullId);var l=i.indexOfAudio(t);-1!==l?i.moveAudio(l,s+1):i.addAudio(Object(q.a)(t),s+1)}else{var n=o.a.getContextPlaylist(e);this.play(t,n.playlist,n.context)}var d=window.AudioPage&&currentAudioPage(e);if(d){var _=d.getPageCurrentPlaylist();_&&d.onUserAction(t,_)}}}on(e,t,i){isArray(t)||(t=[t]),each(t,(t,a)=>this.subscribers.push({context:e,et:a,cb:i}))}off(e){this.subscribers=this.subscribers.filter(t=>t.context!==e)}connectEvents(){var e=this;this.eventBus.precheck=e=>!!this._impl&&!(!this.ads.isPlaying()&&this._muteProgressEvents&&inArray(e,[r.a.BUFFERED,r.a.PROGRESS])),this.eventBus.onAnyCallBack=function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return e.onEvent(t,...a)},this.subscribe(r.a.VOLUME,()=>te._lsSet(te.LS_VOLUME,this._userVolume)),this.subscribe(r.a.PLAY_REQUESTED,()=>{this.updateCurrentPlaying(!0),this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),te._setTabIcon("play"),this._sendStatusExport()}),this.subscribe(r.a.PLAY,()=>this.updateCurrentPlaying(!0)),this.subscribe(r.a.PLAYLIST_CHANGED,()=>{this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio()}),this.subscribe(r.a.PROGRESS,(e,t,i)=>{var a=this.getCurrentAudio(),s=Object(b.a)(a);if(this._listenedTime=i,o.a.isPodcast(s))e&&i&&this._podcastUpdateState(s,e,i,o.a.PodcastsLogs.ACTION_HEARTBEAT);else if(!this.ads.isPlaying()){var r=this.getCurrentPlaylist(),l=this._impl.getCurrentProgress();if(vk.widget||te._lsSet(te.LS_PROGRESS,l),!vk.widget&&this._allowPrefetchNext&&l>=.8){var n=r.getNextAudio(a);n&&this._impl.isFullyLoaded()&&(this._allowPrefetchNext=!1,this._prefetchAudio(n))}}}),this.subscribe(r.a.PAUSE,()=>{this.updateCurrentPlaying(!0);var e=this.getCurrentAudio(),t=Object(b.a)(e);o.a.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),o.a.PodcastsLogs.ACTION_PAUSE),te._setTabIcon("pause")}),this.subscribe(r.a.SEEK,()=>{var e=this.getCurrentAudio(),t=Object(b.a)(e);o.a.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),o.a.PodcastsLogs.ACTION_SEEK)}),this.subscribe(r.a.ENDED,()=>{var e=this.getCurrentAudio(),t=Object(b.a)(e);o.a.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),o.a.PodcastsLogs.ACTION_HEARTBEAT),window.Unauthorized&&window.vk&&!window.vk.widget&&!window.vk.id&&Object(N.b)("audio_unauth_preview_box")&&(this.stop(),window.Unauthorized.showMoreBox(null,0,Q.a.AUDIO))})}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}onEvent(e,t,i,a){inArray(e,[r.a.PLAY,r.a.PLAY_REQUESTED,r.a.PAUSE])&&(this.subscribers=this.subscribers.filter(e=>!(e.context instanceof Element)||bodyNode.contains(e.context))),each(this.subscribers||[],(o,s)=>{s.et===e&&s.cb(this.getCurrentAudio(),t,i,a)})}notify(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];this.eventBus.emit(e,...i)}addWithReplacePlaylists(e){var t=e.reduce((e,t)=>(e[t.getFullId()]=t,e),{}),i={};this._playlists.forEach((e,a)=>{var o=e.getFullId();t[o]&&(this._playlists[a]=t[o],i[o]=!0)}),t.forEach(e=>{i[e.getFullId()]||this._playlists.push(e)})}_sendPlayerErrorStats(e){var t=o.a.asObject(this.getCurrentAudio());if(t){var i=t.full_id,a=extend({audio:i,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},e.getErrorData());ajax.post("al_audio.php?act=player_error_stats",a)}}playLive(e,t){var i=this.getPlaylist(AudioPlaylist.TYPE_LIVE,vk.id,data[0]);i.mergeWith({live:e,hasMore:!1}),e=i.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:e.audioId,host_id:e.hostId,hash:e.hash},extend(t,{onDone:(e,t,a)=>{i.mergeWith({title:t&&t.title,list:[e]}),this.play(e,i,a)},onFail:()=>!0}))}_listenStatusExport(){window.addEventListener("storage",e=>{if(e.key===te.LS_PREFIX+te.LS_STATUS_EXPORT){var t=te._lsGet(te.LS_STATUS_EXPORT);this.setStatusExportInfo(t),cur.audioPage&&cur.audioPage.updateStatusExportControls()}})}_sendStatusExport(){var e=o.a.asObject(this.getCurrentAudio());if(e){var t=this.statusSent?this.statusSent.split(","):[!1,0],i=vkNow()-intval(t[1]);if(this.hasStatusExport()&&!o.a.isPodcast(e)&&(e.id!=t[0]||i>3e5)){var a=this.getCurrentPlaylist(),s=a?a.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:e.fullId,hash:vk.statusExportHash,top:intval(s&&(s.top_audio||s.top))},{onFail:()=>!0}),0),this.statusSent=e.id+","+vkNow()}}}saveStateCurrentPlaylist(){if(!vk.widget){var e=this.getCurrentPlaylist(),t=e?e.serialize():null;te._lsSet(te.LS_PL,t),te._lsSet(te.LS_SAVED,vkNow())}}_saveStateCurrentAudio(){if(!vk.widget){var e=this.getCurrentAudio();if(e){var t=clone(e);t[o.a.AUDIO_ITEM_INDEX_URL]="",te._lsSet(te.LS_TRACK,t),setCookie("remixcurr_audio",`${e[o.a.AUDIO_ITEM_INDEX_OWNER_ID]}_${e[o.a.AUDIO_ITEM_INDEX_ID]}`,1)}else te._lsSet(te.LS_TRACK,null),setCookie("remixcurr_audio",null,1)}}getListenedTime(){return this._listenedTime}seekCurrentAudio(e,t){if(this.ads.isPlaying())return!1;var i=(t=t||10)/o.a.asObject(this.getCurrentAudio()).duration,a=this.getCurrentProgress()+(e?i:-i);a=Math.max(0,Math.min(1,a)),this.seek(a)}setVolume(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Math.min(1,Math.max(0,e));this._userVolume!==i&&(this._userVolume=i,this.notify(r.a.VOLUME,i)),this.implTaskManager.setVolume(i,t),this.ads.updateVolume()}getVolume(){return void 0===this._userVolume?.8:this._userVolume}seek(e){this.implTaskManager.seek(e),this.notify(r.a.SEEK)}seekToTime(e,t){var i=this.getCurrentAudio();if(!i)return 0;var a=e/i[o.a.AUDIO_ITEM_INDEX_DURATION];if(a=Math.max(0,a),a=Math.min(a,1),this.seek(a),o.a.isPodcast(i)){var s="",r=o.a.asObject(i);t&&(s=o.a.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(r,o.a.PodcastsLogs.ACTION_SEEK,t)),this._podcastUpdateState(r,a,0,s)}return a}_ensureHasURL(e){this._currentUrlEnsure=this._currentUrlEnsure||{};var t,i=[];if(!e)return Promise.reject();if(e.url)return Promise.resolve(e);if(!this._currentUrlEnsure[e.fullId]){var a=this.getCurrentPlaylist(),s=a.indexOfAudio(e);if(s>=0)for(var r=s;r<s+5;r++){var l=o.a.asObject(a.getAudioAt(r));!l||l.url||this._currentUrlEnsure[l.fullId]||!l.urlHash&&!l.isFromQueue||(i.push(l.fullId+"_"+l.actionHash+"_"+l.urlHash),this._currentUrlEnsure[l.fullId]=!0)}}return!i.length&&this.currentEnsureUrlPromise?t=this.currentEnsureUrlPromise:(t=new Promise((e,t)=>{this.ensureUrlReject&&this.ensureUrlReject(),this.ensureUrlReject=t,ee().then(()=>this.fetchAudioUrls(i)).then(t=>{this.ensureUrlReject=null,e(t)}).catch(a=>{switch(a){case"bad_hash":this.ensureUrlReject=null,this.fetchAudios(i).then(e=>this.fetchAudioUrls(e)).then(e).catch(()=>!0);break;case"no_audios":this.ensureUrlReject=null,t()}return!0})}),this.currentEnsureUrlPromise=t),t.then(t=>(Array.isArray(t)&&t.forEach(t=>{if(e.fullId===Object($.a)(t)){var i=Object(b.a)(t);e.url=i.url,e.ads=i.ads,e.flags=i.flags,e.extra=i.extra}}),e))}fetchAudioUrls(e){return new Promise((t,i)=>{ajax.post("al_audio.php?act=reload_audio",{ids:e.join(",")},{onDone:(e,i,a,s)=>{this.setStatusExportInfo(i),this._listenedHash=a,s&&this._podcastSaveData(s),each(e,(e,t)=>{t=o.a.asObject(t);var i={};i[o.a.AUDIO_ITEM_INDEX_URL]=t.url,i[o.a.AUDIO_ITEM_INDEX_ADS]=t.ads,i[o.a.AUDIO_ITEM_INDEX_FLAGS]=t.flags,i[o.a.AUDIO_ITEM_INDEX_EXTRA]=t.extra,this.updateAudio(t.fullId,i),this._currentAudio&&Object($.a)(this._currentAudio)===t.fullId&&(this._currentAudio[o.a.AUDIO_ITEM_INDEX_URL]=t.url,this._currentAudio[o.a.AUDIO_ITEM_INDEX_ADS]=t.ads,this._currentAudio[o.a.AUDIO_ITEM_INDEX_FLAGS]=t.flags,this._currentAudio[o.a.AUDIO_ITEM_INDEX_EXTRA]=t.extra),delete this._currentUrlEnsure[t.fullId]}),t(e)},onFail:e=>(i(e),!0)})})}fetchAudios(e){return new Promise((t,i)=>{ajax.post("al_audio.php?act=reload_audios",{audio_ids:e.join(",")},{onDone:e=>{var a=[],o=this.getCurrentPlaylist().getAudiosList();if(Array.isArray(e)){for(var s=e.reduce((e,t)=>(e[Object($.a)(t)]=t,e),{}),r=0;r<o.length;r++){var l=Object($.a)(o[r]);if(s[l]){o[r]=s[l];var n=Object(b.a)(s[l]);a.push(`${n.fullId}_${n.actionHash}_${n.urlHash}`)}}t(a)}else i()}})})}toggleAudio(e,t){if(vk&&vk.widget&&window.Widgets&&!vk.widgetPodcast&&!vk.id&&!Object(N.b)("audio_unauth_preview"))return Widgets.oauth(),!1;if(domClosest("_audio_row__tt",t.target))return cancelEvent(t);var i=domClosest("_audio_row",e),a=o.a.getAudioFromEl(i,!0);if(window.getSelection&&window.getSelection().rangeCount){var s=window.getSelection().getRangeAt(0);if(s){var r=s.commonAncestorContainer;if(r&&domClosest("_audio_row",r)===i&&s.startOffset!==s.endOffset)return!1}}if(t&&hasClass(t.target,"mem_link"))return nav.go(attr(t.target,"href"),t,{navigateToUploader:!0}),cancelEvent(t);if(hasClass(t.target,"_audio_row__title_inner")){if(o.a.isPodcast(a))return showPodcast(i,a.fullId),cancelEvent(t);if(a.lyrics&&!a.isInAttach)return o.a.toggleAudioLyrics(i,a),cancelEvent(t)}if(hasClass(t.target.parentNode,"audio_row__performers")){if(checkEvent(t)||vk.widget)return!0;if(!gpeByClass("_ape_audio_item",t.target)){var l=domData(t.target,"performer");if(l)return o.a.audioSearchPerformer(t.target,l,t),cancelEvent(t)}return!0}var n=cur.cancelClick||t&&(hasClass(t.target,"audio_lyrics")||domClosest("_audio_duration_wrap",t.target)||domClosest("_audio_inline_player",t.target)||domClosest("audio_performer",t.target)),d=hasClass(t.target,"slider")||domClosest("slider",t.target),_=cur._sliderMouseUpNowEl&&(cur._sliderMouseUpNowEl===geByClass1("audio_inline_player_progress",i)||cur._sliderMouseUpNowEl===geByClass1("audio_inline_player_volume",i));if((d||_)&&(n=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,n)return!0;if(o.a.isClaimedAudio(a)||a.isReplaceable){var u=o.a.getAudioExtra(a).claim;if(u)return void(hasClass(i,"no_actions")||a.isInEditBox||showAudioClaimWarning(a,u,o.a.replaceWithOriginal.bind(o.a,i,a)))}if(this.podcastSetActionRef(a,a.isPlaying?o.a.PodcastsLogs.ACTION_PAUSE:o.a.PodcastsLogs.ACTION_PLAY,"",i),a.isPlaying)this.pause();else{var c=o.a.getContextPlaylist(i);this.play(a.fullId,c.playlist,a.context||c.context),cur.audioPage&&cur.audioPage.onUserAction(a,c.playlist)}o.a.onRowOver(i,!1,!0)}playNextPlaylist(e,t,i){var a=this.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t,i);a.loadAll(()=>{var e=this.getCurrentPlaylist();if(e)e.addAudio(a.getAudiosList());else{this._currentPlaylist=new AudioPlaylist(a);var t=a.getAudioAt(0);t&&(this._currentAudio=t,this.notify(r.a.UPDATE),this.notify(r.a.PLAYLIST_CHANGED),this.updateCurrentPlaying(),this.isPlaying()||this.play(t.fullId,a))}}),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()}playPlaylist(e,t,i,a,o){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!Object(N.b)("audio_unauth_preview"))return Widgets.oauth(),!1;this.playNextInPlaylist(e,t,i,a,{shuffled:o,preDoPlay:e=>{o&&(e.isShuffled()&&e.shuffle(0),e.shuffle(irand(1,999999),!0))}})}playBlock(e,t,i,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"default";this.playNextInPlaylist(e,t,i,a,{type:o,trackType:s,shuffled:!1})}playNextInPlaylist(e,t,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=this.getCurrentPlaylist(),r=this.getPlaylist(o.type||AudioPlaylist.TYPE_PLAYLIST,e,t,i);if(r.setContext(a),s&&s.getId()===r.getId()&&this.isPlaying()&&!o.shuffled)this.pause();else{var l=!1,n=()=>{if(!l){l=!0,o.preDoPlay&&o.preDoPlay(r);var e=r.getNextAudio(!1,!0);e&&this.play(e,r,a)}};if(r.getAudiosCount()&&!o.shuffled&&!r.isExpired())return void n();this._impl&&this._impl.preparePlay&&!this.ads.isPlaying()&&this._impl.preparePlay(),r.load(0,n,null,o.trackType)}}_initPlayingContext(e){this._playingContext=e}getListenedHash(){return this._listenedHash||""}_getPlayingContext(){return this._playingContext||""}_getPlayingContextSection(){return this._getPlayingContext().split(":")[0]}play(e,t,i,a,s){if(!cur.loggingOff&&this._impl){this._seq=a,this._autoNext=s,this._prevAudio=this._currentAudio,(isObject(e)||isArray(e))&&(e=o.a.asObject(e))&&(e=e.fullId);var l=o.a.asObject(this._currentAudio),n=this.getCurrentPlaylist();!e&&l&&(e=l.fullId);var d=!1,_=e&&l&&e==l.fullId;t?n&&(d=_?t.getFullId()===n.getSelf().getFullId():t===n.getSelf()||t===n):(t=n,d=!0),d||i||debugLog("New playlist play init without context"),i&&(this._prevContext=this._playingContext,this._initPlayingContext(i));var u=t.getAudio(e);_||(u&&t.load(t.indexOfAudio(u)+3),t.getType()===AudioPlaylist.TYPE_SEARCH&&t.indexOfAudio(u)>=t.getLocalFoundCount()&&t.sendSearchStats("search_play"),l&&o.a.isPodcast(l)&&this.isPlaying()&&this._podcastUpdateState(l,this.getCurrentProgress(),this._impl.getPlayedTime(),o.a.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0}),this.ads.isPlaying()||this.ads.deinit()),d||(this._cleanUpPlaylists(),this._currentPlaylist&&(this._prevPlaylist=this._currentPlaylist,this._prevAudio=this._currentAudio),this._currentPlaylist=new AudioPlaylist(t),this.notify(r.a.PLAYLIST_CHANGED)),te._sendLCNotification(),_?this.ads.isPlaying()?this.ads.resume():this.isPlaying()||(this.setIsPlaying(!0),this.implTaskManager.clearAllTasks(),this._implSetUrl(l).then(()=>{this._implPlay(),this._updatePlaybackRate(),this.implTaskManager.setVolume(this.getVolume(),!!this._impl.getCurrentProgress()),o.a.isPodcast(u)&&this._podcastUpdateState(o.a.asObject(u),this.getCurrentProgress(),this._impl.getPlayedTime())}).catch(()=>{})):e&&u&&(!s&&l&&this._impl.setUrl(A.b),this._currentAudio=u,this.setIsPlaying(!0),this.ads.isPlaying()?this.ads.resume():(this.notify(r.a.PLAY_REQUESTED,!0,intval(a),s),this._muteProgressEvents=!0,this.implTaskManager.clearAllTasks(),this._impl.preparePlay&&this._impl.preparePlay(),this.ads.startPlay(o.a.asObject(u),()=>this.playAfterAd()),this.notify(r.a.PROGRESS,0)),this.updateCurrentPlaying(!0),l&&this.scrollToCurrentPlaying(l.fullId,e))}}playAfterAd(){this.notify(r.a.CURRENT_CHANGED);var e=this.getCurrentAudio();e&&(this.notify(r.a.UPDATE),this._implSetUrl(e).then(()=>{this._implPlay(),this._updatePlaybackRate(),vk.id?this.implTaskManager.setVolume(this.getVolume()):this.fadeIn(1e3*te.UNAUTH_FADE_TIME),this._triggerTNSPixel()}).catch(()=>(this.pause(),!0)))}instantPlay(e,t,i){var a=!browser.safari&&t&&t.shiftKey;this.playPlaylist(vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID,i,"header",a),statlogsValueEvent("client_header_play_button",a?"shuffle":"play"),setTimeout(()=>{addClass(e,"loading")},400)}_prefetchAudio(e){(e=o.a.asObject(e))&&e.url&&this._impl.prefetch(e.url)}getCurrentPlaylist(){return this._currentPlaylist}getPlaylists(){return clone(this._playlists)}pause(){this.ads.isPlaying()&&setTimeout(()=>this.ads.pause(),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause()}stop(){this.setIsPlaying(!1),this.ads.isPlaying()?this.ads.stop():this._impl.stop(),this.notify(r.a.STOP)}isPlaying(){return this._isPlaying}setIsPlaying(e){this._isPlaying=e}getCurrentAudio(){return this._currentAudio}playNext(e){this._playNext(1,e)}playPrev(){this._playNext(-1)}_playNext(e,t){if(!this.ads.isPlaying()){var i=10,a=this.getCurrentAudio(),s=this.getCurrentPlaylist(),l=(e,i)=>{o.a.isClaimedAudio(e)||this.play(e,s,!1,i,t)};if(a&&s)if(e>0){for(var n=s.getNextAudio(a);i&&n&&o.a.isClaimedAudio(n);)n=s.getNextAudio(n),i--;if(n)l(n,1);else if(s.isLive())this._muteProgressEvents=!0,s.fetchNextLiveAudio(e=>l(e,1));else{if(n=s.getAudioAt(0),o.a.isClaimedAudio(n))for(var d=s.getAudiosList(),_=s.getAudiosCount(),u=0;u<_;u++){var c=d[u];if(!o.a.isClaimedAudio(c)){n=c;break}}if(!this.isRepeatAll())if(s.indexOfAudio(a)+1===s.getAudiosCount())return this.implTaskManager.seekImmediate(0),this.stop(),void(o.a.isClaimedAudio(n)||(this._currentAudio=n,this._implSetUrl(this._currentAudio),this.updateCurrentPlaying(!0),this.notify(r.a.CURRENT_CHANGED),this.notify(r.a.UPDATE)));l(n,1)}}else{var h=s.indexOfAudio(this._currentAudio)-1;if(h<0||this._impl.getCurrentTime()>5)this.seek(0);else{for(var p=s.getAudioAt(h);i&&p&&o.a.isClaimedAudio(p);)p=s.getAudioAt(--h),i--;p?l(p,-1):this.seek(0)}}}}adsGetCurrentProgress(){return this.ads.getCurrentProgress()}_podcastUpdateState(e,t,i,a,o){var s=te._podcastGetStates(),r=Math.round(e.duration*t);s[e.fullId]={t:vkNow(),position:r},te._podcastSetStates(s),a&&this._podcastSendLogs(a,e,i,r,o)}_podcastSendLogs(e,t,i,a,s){if(t&&e&&o.a.isPodcast(t)&&(!cur._podcastsActionId||!cur._podcastsActionId[e]||this._podcastsActionLastId[e]!==cur._podcastsActionId[e])){var r=this._podcastsActionRef[t.fullId]||{},l=r[e]||{};o.a.PodcastsLogs.log(e,extend({audio:t,position:a,listen:i},l,s||{})),delete r[e],this._podcastsActionLastId[e]=cur._podcastsActionId?cur._podcastsActionId[e]:null}}podcastSetActionRef(e,t,i,a){e=o.a.asObject(e),t&&o.a.isPodcast(e)&&(this._podcastsActionRef[e.fullId]=this._podcastsActionRef[e.fullId]||{},this._podcastsActionRef[e.fullId][t]={ref:i,refEl:a},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[t]=irand(0,1e6))}_podcastCleanStates(){var e=te._podcastGetStates(),t=!1;return each(e,(i,a)=>{Date.now()-a.t>2419200&&(delete e[i],t=!0)}),t&&te._podcastSetStates(e),e}_podcastSaveData(e){var t=te._podcastGetStates();each(e,(e,i)=>{var a=i.state;if(a){var o=+a[1];(!t[e]||!t[e][1]||o&&o>t[e][1])&&(t[e]={position:+a[0],t:Date.now()})}}),te._podcastSetStates(t)}_podcastRestoreState(){var e=o.a.asObject(this.getCurrentAudio());if(!o.a.isPodcast(e))return 0;var t=0;cur.podcastSeekToTime?(t=this.seekToTime(cur.podcastSeekToTime,cur.podcastSeekToTimeRef),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef):(t=((te._podcastGetStates()[e.fullId]||{}).position||0)/e.duration)&&t<1&&this.implTaskManager.seek(t);return t&&t<1?(this.updateCurrentPlaying(),t):0}getCurrentFaveStatus(){return!!o.a.isPodcast(this._currentAudio)&&o.a.getAudioExtra(this._currentAudio).fave}_updatePlaybackRate(){var e=!this.ads.isPlaying()&&o.a.isPodcast(this._currentAudio)?te.podcastGetPlaybackRate():1;this.implTaskManager.updatePlaybackRate(e)}podcastChangePlaybackRate(e){var t=te._lsGet(te.LS_PODCASTS)||Z,i=t.rate||1;e?i-=te.PLAYBACK_RATE_STEP:i+=te.PLAYBACK_RATE_STEP,!e&&i>te.PLAYBACK_RATE_MAX?i=1:e&&i<1&&(i=te.PLAYBACK_RATE_MAX),t.rate=i,te._lsSet(te.LS_PODCASTS,t),Z=t,this._updatePlaybackRate()}playAudio(e){var t=new AudioPlaylist(AudioPlaylist.TYPE_TEMP);t.mergeWith({list:[e]}),this.play(e,t)}}te.UNAUTH_FADE_TIME=.8,te.LS_VER="v20",te.LS_KEY_PREFIX="audio",te.LS_PREFIX=te.LS_KEY_PREFIX+"_"+te.LS_VER+"_",te.LS_STATUS_EXPORT=te.LS_KEY_PREFIX+"_status_export",te.LS_VOLUME="vol",te.LS_PL="pl",te.LS_TRACK="track",te.LS_SAVED="saved",te.LS_PROGRESS="progress",te.LS_PODCASTS="podcasts",te.LS_DURATION_TYPE="dur_type",te.LS_UUID="uuid",te.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",te.PLAYBACK_RATE_STEP=.5,te.PLAYBACK_RATE_MAX=3;var ie=window.devicePixelRatio>=2?"_2x":"";function ae(e,t,i){var a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),a.fillStyle=i?"#3D6899":"#ffffff";for(var o=0;o<4;o++){var s=2+12*t[o];a.fillRect(13+4*o,12-s+14,2,s)}}function oe(){window.AudioLayer=a.a,window.AudioUtils=o.a,window.TopAudioPlayer=n,window.AudioPlaylist=_.a,window.AudioPlayer=te}te.tabIcons={def:`/images/icons/favicons/fav_logo${ie}.ico`,play:`/images/icons/favicons/fav_play${ie}.ico`,pause:`/images/icons/favicons/fav_pause${ie}.ico`}},D33C:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AudioPlaylist}));var core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Btvt"),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("HEwt"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("rGqo"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("ioFf"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("OG14"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("Vd3H"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("KKXr"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("jE6c"),_utils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("pp2G"),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("PMB/");function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}class AudioPlaylist{static splitId(e){var t=_toArray(e.split("_")),i=t[0],a=t[1],o=t.slice(2);return[i,a,o=o.join("_")]}constructor(e,t,i){var a={};if(e&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.j)(e.getId))return e.isReference()?(getAudioPlayer().addPlaylist(this),e):(this._ref=e,void getAudioPlayer().addPlaylist(this));isObject(e)?a=e:(a.ownerId=t,a.type=e,a.albumId=i||++AudioPlaylist.plIndex),this._type=a.type,this._ownerId=a.ownerId||vk.id,this._albumId=a.albumId||0,this._fromId=a.fromId||0,this._list=[],this._context=a.context||"",this._blockId=a.blockId,this._nextOffset=a.nextOffset,this._isFakeId=!1,this._expire=a.expire||null,this._noDiscover=a.hasOwnProperty("noDiscover")?a.noDiscover:null,this.mergeWith(a),getAudioPlayer().addPlaylist(this)}updatePlaylist(e){var t=this.getSelf(),i=!1;return t&&e?(t._title!==e.title&&(t._title=e.title,i=!0),t._titleLang!==e.titleLang&&(t._titleLang=e.titleLang,i=!0),i):i}getIsFakeId(){return this.getSelf()._isFakeId}setIsFakeId(e){this.getSelf()._isFakeId=e}getId(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()}getFullId(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")}isReference(){return!!this._ref}getSelf(){return this._ref&&isObject(this._ref)?this._ref:this}getType(){return this.getSelf()._type}getExpire(){return this.getSelf()._expire}getOwnerId(){return+this.getSelf()._ownerId}getAlbumId(){return this.getSelf()._albumId}getPlaylistId(){return this.getSelf()._albumId}getOriginalPlaylistRawId(){return this.getSelf()._originalPlaylistRawId}getFollowHash(){return this.getSelf()._followHash}getContext(){return this.getSelf()._context}setContext(e){this.getSelf()._context=e}getRef(){return this.getSelf()._ref}getRawId(){return this.getSelf()._rawId}getGridCovers(){return this.getSelf()._gridCovers||""}getTitle(){return this.getSelf()._title||""}getTitleLang(){return this.getSelf()._titleLang||""}getSubtitle(){return this.getSelf()._subTitle||""}getDescription(){return this.getSelf()._description||""}getRawDescription(){return this.getSelf()._rawDescription||""}getAccessHash(){return this.getSelf()._accessHash||""}getFromId(){return this.getSelf()._fromId||0}setFromId(e){this.getSelf()._fromId=e}getAuthorLine(){return this.getSelf()._authorLine||""}getAuthorHref(){return this.getSelf()._authorHref||""}getAuthorName(){return this.getSelf()._authorName||""}getInfoLine1(){return this.getSelf()._infoLine1||""}getInfoLine2(){return this.getSelf()._infoLine2||""}getListens(){return this.getSelf()._listens||0}getAddClasses(){return this.getSelf()._addClasses||""}getLastUpdated(){return this.getSelf()._lastUpdated||""}getEditHash(){return this.getSelf()._editHash||""}getDeleteHash(){return this.getSelf()._deleteHash||""}getReplaceHash(){return this.getSelf()._replaceHash||""}getCoverUrl(){return this.getSelf()._coverUrl||""}getBlocks(){return this.getSelf()._blocks||{}}getFeedFrom(){return this.getSelf()._feedFrom}getFeedOffset(){return this.getSelf()._feedOffset}getSearchParams(){return this.getSelf()._searchParams||null}getSearchQid(){return this.getSelf()._searchQid||null}getLocalFoundCount(){return this.getSelf()._localFoundTotal||0}getTotalCount(){return this.getSelf()._totalCount}getTotalCountHash(){return this.getSelf()._totalCountHash}getShuffle(){return this.getSelf()._shuffle}getFriendId(){return this.getSelf()._friend}getNoDiscover(){return this.getSelf()._noDiscover}getNextOffset(){var e=this.getSelf();return e._forceReload?0:""===e._nextOffset?e._nextOffset:e._nextOffset||this.getAudiosCount()}getAudiosList(){return this.getSelf()._list||[]}getUnshuffledAudiosList(){var e=this.getSelf();return e._originalList?e._originalList:e._list}getItemsList(){return this.getSelf()._items||[]}getPostId(){return this.getSelf()._postId}getWallQuery(){return this.getSelf()._wallQuery}getWallType(){return this.getSelf()._wallType}getCommunititesBlock(){return this.getSelf()._communitiesBlock}getArtistsBlock(){return this.getSelf()._artistsBlock}getPlaylistsBlock(){return this.getSelf()._playlistsBlock}getLiveInfo(){var e=this.getSelf()._live;return!!e&&{hostId:(e=e.split(","))[0],audioId:e[1],hash:e[2]}}getAudioAt(e){var t=this.getSelf();return Array.isArray(t._list)&&t._list.length>e?t._list[e]:null}getAudiosCount(){var e=this.getSelf();return Array.isArray(e._list)?e._list.length:0}getTotalDuration(){var e=this.getAudiosList(),t=0;return each(e,(function(e,i){t+=i[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_DURATION]})),t}getItemsCount(){var e=this.getSelf();return e._items=e._items||[],e._items.length}getForceReload(){return this.getSelf()._forceReload}setForceReload(e){this.getSelf()._forceReload=e}setLocalFoundCount(e){this.getSelf()._localFoundTotal=e}setAdsAllowed(e){return this.getSelf()._isAdsAllowed=e}setFollowed(e){var t=this.getAddClasses()||"";return t=t.replace("audio_playlist__followed",""),e&&(t+=" audio_playlist__followed"),this.getSelf()._addClasses=t,this.getSelf()._isFollowed=e}isBlocked(){return!!this.getSelf()._isBlocked}hasMore(){return!!this.getSelf()._hasMore}isOfficial(){return!!this.getSelf()._isOfficial}isFollowed(){return this.getSelf()._isFollowed}isShuffled(){return!!this.getShuffle()}isAdsAllowed(){return!!this.getSelf()._isAdsAllowed}isInitedSortedList(){return!!this.getSelf()._sorted}isFullyLoadable(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST}isLive(){return!!this.getLiveInfo()}_unref(){var e=this._ref;if(isObject(e)){var t={};for(var i in e)if(e.hasOwnProperty(i)&&!Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.j)(e[i])&&0===i.indexOf("_")){var a=e[i];t[i.substr(1)]=isObject(a)?clone(a):a}t.hasMore=!1,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._albumId=t.albumId,this._list=[],this.mergeWith(t)}}equals(e){return this.getSelf()===e.getSelf()}serialize(){return JSON.stringify(this.asObject())}asObject(){var e={},t=getAudioPlayer().getCurrentAudio(),i=Math.max(0,this.indexOfAudio(t));return e.list=clone(this.getAudiosList().slice(Math.max(0,i-100),i+300),!0),each(e.list,(function(e,t){t[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_URL]=""})),e.type=this.getType()||AudioPlaylist.TYPE_TEMP,e.ownerId=this.getOwnerId(),e.albumId=this.getAlbumId(),e.accessHash=this.getAccessHash(),e.hasMore=this.hasMore(),e.nextOffset=this.getNextOffset(),e.title=this.getTitle(),e.titleLang=this.getTitleLang(),e.context=getAudioPlayer()._getPlayingContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),e.expire=this.getExpire?this.getExpire():null,this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(e.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),e}asPlaylistData(){return{type:this.getType(),ownerId:this.getOwnerId(),id:this.getId(),title:this.getTitle(),hasMore:this.hasMore(),list:this.getAudiosList(),nextOffset:this.getNextOffset(),subtitle:this.getSubtitle(),totalCount:this.getTotalCount(),blockId:this.getBlockId()}}toString(){return this.getId()}_moveCurrentAudioAtFirstPosition(){var e=getAudioPlayer().getCurrentAudio(),t=this.getSelf(),i=this.indexOfAudio(e);-1!==i&&(t._list.splice(i,1),t._list.unshift(e),t._movedAudioToFirstPos=i)}_resetMovedAudioToInitialPosition(){var e=this.getSelf();if(e._movedAudioToFirstPos){var t=e._list.splice(0,1);e._list.splice(e._movedAudioToFirstPos,0,t[0]),delete e._movedAudioToFirstPos}}_ensureIndex(e){var t=this.getSelf();if(t._index)e&&e();else{var i=function(e,t){var i=intval(t);return i>=33&&i<48?String.fromCharCode(i):e};t._index=new vkIndexer(t._list,(function(e){return(e[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_PERFORMER]+" "+e[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,i)}),e)}}clean(e){e||this._unref();var t=this.getSelf();t._hasMore=!0,t._list=[],t._items=[],t._feedOffset=t._feedFrom=0,t._nextOffset=0}cleanIndex(){this.getSelf()._index=null}initSortedList(e){if(!Array.isArray(e))return!1;var t=this.getSelf();t._originalList||(t._originalList=[].concat(t._list)),t._sorted=!0,t._list=e}removeSortedList(){var e=this.getSelf();e._originalList&&(e._list=[].concat(e._originalList)),e._sorted=!1,e._shuffle=!1}shuffle(e,t){if(!(this.isShuffled()&&e||!this.isShuffled()&&!e)){var i=this.getSelf(),a=!1;if(delete i._sorted,e){var o;if(!this.hasMore()||this.getBlockId())i._originalList=i._originalList||[].concat(i._list),shuffle(i._list),t||this._moveCurrentAudioAtFirstPosition(),o=!0;else if(this.getType()===AudioPlaylist.TYPE_SEARCH)i._originalList=i._originalList||[].concat(i._list),shuffle(i._list),t||this._moveCurrentAudioAtFirstPosition(),o=!0;else if(inArray(this.getType(),[AudioPlaylist.TYPE_RECOM])){var s=getAudioPlayer().getCurrentAudio(),r=this.indexOfAudio(s);this.clean(!0),r>=0&&i.addAudio(s,0),o=!0,a=!0}else this._unref(),(i=this.getSelf())._originalList=i._originalList||[].concat(i._list),shuffle(i._list),t||this._moveCurrentAudioAtFirstPosition(),o=!0;o&&(i._shuffle=e)}else i._originalList?i._list=i._originalList:this.clean(!0),a=!0,delete i._shuffle,delete i._originalList;return a&&this.load(this.getNextOffset()),!0}}getNextAudio(e,t){if(!e)return!!(e=this.getAudioAt(0))&&(t&&_utils__WEBPACK_IMPORTED_MODULE_11__.a.asObject(e).isClaimed?this.getNextAudio(e,!0):e);var i=this.indexOfAudio(e);if(i<0)return!1;if(i+1<this.getAudiosCount()){var a=this.getAudioAt(i+1);return t&&_utils__WEBPACK_IMPORTED_MODULE_11__.a.asObject(a).isClaimed?this.getNextAudio(a,!0):a}return!1}removeAudio(e){var t=this.indexOfAudio(e);if(t>=0){this._unref();var i=this._list.splice(t,1);return this._index&&this._index.remove(i[0]),t}return-1}addAudio(e,t){this._unref();var i=void 0===t,a=e=>{var a=this.getUnshuffledAudiosList(),o=this.indexOfAudio(e);if(o>=0){if(i)return;a.splice(o,1)}(e=clone(e))[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_TITLE]=clean(replaceEntities(e[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),e[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_PERFORMER]=clean(replaceEntities(e[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,"")),i?a.push(e):a.splice(t,0,e),this._index&&this._index.add(e)};if(isArray(e)&&isArray(e[0]))for(var o=0,s=e.length;o<s;o++)a(e[o]);else e&&e.length&&a(e)}moveAudio(e,t){this._unref();var i=this._list.splice(e,1);e<t&&(t-=1),this._list.splice(t,0,i[0])}indexOfAudio(e){if(!e)return-1;var t;isString(e)?t=e.split("_"):isObject(e)?t=[e.ownerId,e.id]:isArray(e)&&(t=[e[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_OWNER_ID],e[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_ID]]);var i=this.getSelf()._list;if(!i)return-1;for(var a=0,o=i.length;a<o;a++)if(i[a]&&t[0]==i[a][_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==i[a][_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_ID])return a;return-1}getAudio(e){if(!e)return null;var t=this.getSelf();e=e.split("_");for(var i=0,a=t._list.length;i<a;i++)if(e[0]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_ID])return t._list[i];return null}getBlockId(){return this.getSelf()._blockId}loadAll(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.isFullyLoadable())return e&&e();this.load(0,e,!0,"default",t)}loadByBlockId(e,t,i){var a=this,o=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=a._onDoneLoading;delete a._onDoneLoading,delete a._loadingAll,each(i||[],(e,i)=>{i&&i(a,t)})}),s=this.getNextOffset();return!this.getAudiosCount()||e&&e===s?(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(t),this._loadingAll?void 0:i?(this._loadingAll=!0,void Object(_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_12__.a)(this,o)):void ajax.post("al_audio.php?act=load_block_playlist",{block_id:this._blockId,start_from:s},{onDone:e=>{this._blockId=e.blockId;var t=getAudioPlayer();t.mergePlaylistData(this,e),o(this),t.saveStateCurrentPlaylist(),""===this.getNextOffset()&&(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}})):t&&t(this)}load(offset,_onDone,needAll){var trackType=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",viewType=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.j)(offset)?(_onDone=offset,offset=0):offset=intval(offset),this.isExpired()&&(this.getSelf()._hasMore=!0,this.setForceReload(!0));var searchParams=this.getSearchParams(),wasPreload=!1,countAvailable=this.getType()===AudioPlaylist.TYPE_FEED?this.getItemsCount():this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore(),callOnDones=(e,t,i)=>{var a=this._onDoneLoading;i||(delete this._onDoneLoading,delete this._loadingAll),(!wasPreload||wasPreload&&cur.audioChooseBox&&curBox())&&each(a||[],(e,i)=>{this.cleanIndex(),i&&i(this,t)}),i&&(wasPreload=!0)};if(!this.getForceReload()&&(offset<countAvailable&&!isGoingToLoadAll||""===this.getNextOffset()||!this.hasMore()||searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery))return _onDone&&_onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(_onDone),!this._loadingAll){if(needAll)return this._loadingAll=!0,void Object(_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_12__.a)(this,callOnDones,viewType);var params;offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout),this.getForceReload()&&this.setForceReload(!1);var isCatalog=!1;if(this._blockId)params={act:"load_block_playlist",block_id:this._blockId,start_from:this.getNextOffset()},isCatalog=!0;else{var ownerId=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();params={act:"load_section",type:this.getType(),owner_id:ownerId,playlist_id:this.getPlaylistId(),offset,context:this.getContext(),access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?intval(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),shuffle:this.getShuffle(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:intval(nav.objLoc.claim),track_type:trackType}}ajax.post("al_audio.php",params,{onDone:(loadedPlaylist,tpl,langs,templatesScript,data)=>{if(!loadedPlaylist)return this.getSelf()._nextOffset="",void(isCatalog?_onDone&&_onDone(loadedPlaylist):callOnDones());if(addTemplates({audio_playlist_snippet:tpl}),extend(cur.lang,langs),templatesScript&&eval(templatesScript),!this._loadingAll||needAll){var audioPlayer=getAudioPlayer();audioPlayer.mergePlaylistData(this,loadedPlaylist),isCatalog?_onDone&&_onDone(loadedPlaylist.list):callOnDones(),audioPlayer.saveStateCurrentPlaylist(),offset&&""!==loadedPlaylist.nextOffset||(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}},onFail:()=>!0,cache:this.getType()===AudioPlaylist.TYPE_SEARCH?1:0})}}isExpired(){var e=this.getExpire();return!!e&&new Date(1e3*e).getTime()<(new Date).getTime()}mergeInfo(e){this._albumId=e.id||this._albumId;each(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","originalList","ownerId","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","shuffle","subTitle","title","titleLang","noDiscover","totalCount","totalCountHash","type","wallQuery","wallType","expire"],(t,i)=>{void 0!==e[i]&&(this["_"+i]=e[i])})}mergeWith(e){var t=e.list;if(this.isExpired()&&(this.getSelf()._list=[]),t&&this.addAudio(e.list),e.items){this._items=this._items||[];for(var i=0,a=e.items.length;i<a;i++)this._items.push(e.items[i])}this.mergeInfo(e)}search(e,t){var i=this.getSelf();isObject(e)||(e={q:e}),this._ensureIndex(()=>{var a=i._index?i._index.search(e.q):[];return a=a.filter((function(t){return!e.lyrics||""!==t[_utils__WEBPACK_IMPORTED_MODULE_11__.a.AUDIO_ITEM_INDEX_LYRICS]})),t(a)})}sendSearchStats(e){if("search_play"===e){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:e,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})}fetchNextLiveAudio(e){var t=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:t.hostId,hash:t.hash},{onDone:t=>{if(t){var i=this.indexOfAudio(t);i>=0?this.moveAudio(i,this.getAudiosCount()-1):this.addAudio(t)}e&&e(t)},onFail:()=>!0})}}AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_MY="my",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_FEED="feed",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.DEFAULT_PLAYLIST_ID=-1},Oupy:function(e,t,i){"use strict";function a(e,t,i,a){stManager.add([jsc("web/audio.js"),"audio.css",jsc("web/auto_list.js")],(function(){ajax.post("al_audio.php?act=playlists_edit_data",{owner_id:e,playlist_id:t},{onDone:function(o){o.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[e]=o.audio_playlist_cover_upload_options),o.editorial_playlists_params&&(cur.editorialPlaylistsParams=o.editorial_playlists_params),AudioPage.editPlaylist(e,t,i,a)},onFail:()=>!0})}))}i.d(t,"a",(function(){return a}))},"PMB/":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return loadAllPlaylistAudios}));var AUDIO_LOAD_CHUNK_SIZE=1e3,chunks,isDeleted,isAttach,onDone,playlist,preloadedCount,totalCount=void 0;function loadAllPlaylistAudios(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.getForceReload())e.list=[];else if(!e.hasMore()||!e.isFullyLoadable())return onDone&&onDone();e.setForceReload(!1),chunks=[],isAttach="attach"===i,onDone=t,playlist=e,preloadedCount=0,totalCount=e.getTotalCount(),loadChunk(0,()=>{isDeleted?onAllLoaded():(isAttach&&onAllLoaded(),loadAllChunks(onAllLoaded,1))})}function onAllLoaded(){if(isDeleted)return onDone&&onDone(null,isDeleted);var e=[];(each(chunks,(function(t,i){i&&(e=e.concat(i))})),getAudioPlayer().getPlaylists().forEach(t=>{t.getId()===playlist.getId()&&(t._list=e)}),getAudioPlayer().mergePlaylistData(playlist,{hasMore:!1}),onDone)&&onDone(playlist,!1,isAttach&&totalCount>preloadedCount)}function loadAllChunks(e,t){t=t||0;var i=Math.max(0,Math.ceil((totalCount-preloadedCount)/AUDIO_LOAD_CHUNK_SIZE));isAttach&&t&&totalCount>preloadedCount&&i===t&&i++,i-t<=0?e():function(){for(var a=new CallHub(e,i-t),o=t;o<i;o++)loadChunk(o,()=>{a.done()})}()}function loadChunk(chunkIndex,callback){var isPreload=isAttach&&!chunkIndex?1:0,offset=chunkIndex*AUDIO_LOAD_CHUNK_SIZE;preloadedCount&&(offset=Math.abs(AUDIO_LOAD_CHUNK_SIZE-preloadedCount-chunkIndex*AUDIO_LOAD_CHUNK_SIZE)),ajax.post("al_audio.php?act=load_section",{type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset,is_loading_all:1,is_preload:isPreload,context:playlist.getContext(),claim:intval(nav.objLoc.claim),ref:playlist.getRef()},{onDone:function onDone(data,tpl,langs,templatesScript){if(0===chunkIndex){if(addTemplates({audio_playlist_snippet:tpl}),extend(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,callback();isDeleted=!1,totalCount=data.totalCount,preloadedCount=data.list.length,getAudioPlayer().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,callback()},onFail:()=>!0})}},"Se/q":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var a=i("zxIV");function o(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=e+"_"+t,r=cur.audioPage&&-cur.audioPage._ownerId||cur.group_id;if(r>0)var l=window.showBox("al_audio.php",{act:"delete_from_group_box",playlist_id:s,group_id:r}).setButtons(getLang("global_yes"),()=>{ajax.post("al_audio.php",{act:"delete_from_group",group_id:r,hash:i,playlist_id:s},{onDone(e){if(l.hide(),showDoneBox(e),o){var t=Object(a.Y)("audio_pl_snippet2",o);t&&t.classList.remove("audio_pl__can_remove_from_club")}},onFail:e=>(l.hide(),showDoneBox(e),!0)})},getLang("global_cancel"),()=>l.hide()).show()}},fY4C:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var a=i("XLUH"),o=i("pp2G"),s=i("zxIV"),r=i("C13D");class l extends a.a{getPausedBy(e){var t=this.player,i=t.pausedByVideo,a=t.pausedByStories,o=t.pausedByAudio,s=t.pausedByQueue;return i&&e<i||window.Videoview&&Videoview.isLayerShown()?"video":a&&e<a||window.cur&&cur.storyLayer?"stories":o&&e<o?"audio":s&&e<s?"queue":null}getState(){var e=super.getState(),t=this.getAudioId();if(t){var i=Object(s.K)("_audio_row_"+t+" audio_row__current",Object(s.J)("page_layout"));if(i&&i.length)return a.b}return e}getAudio(){return Object(r.a)(this.player.getCurrentAudio())}getProgress(){return this.player.getCurrentProgress()}getProgressInSeconds(){var e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[o.a.AUDIO_ITEM_INDEX_DURATION]):0}getVolume(){return Math.round(100*(e=this.player.getVolume(),Math.log(1+34*e)/Math.log(35)));var e}getAudioId(){var e=this.player.getCurrentAudio();if(e)return e[o.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[o.a.AUDIO_ITEM_INDEX_ID]}getAudioTrackCode(){var e=this.player.getCurrentAudio();if(e)return e[o.a.AUDIO_ITEM_INDEX_TRACK_CODE]}getPrevAudioId(){var e=this.player._prevAudio;if(e)return e[o.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[o.a.AUDIO_ITEM_INDEX_ID]}getPrevPlaylistId(){var e=this.player._prevPlaylist;return e&&!e.getIsFakeId()?e.getFullId():null}getPlaylistId(){var e=this.player.getCurrentPlaylist();return e&&!e.getIsFakeId()?e.getFullId():null}getContext(){return this.player._getPlayingContext()}getSequence(){return this.player._seq}getType(){if(this.player._impl)return this.player._impl.type}getSearchParams(){var e=this.player.getCurrentPlaylist();if(e)return e.getSearchParams()}isShuffledPlaylist(){var e=this.player.getCurrentPlaylist();if(e)return e.isShuffled()}isRealPlaylist(){var e=this.player.getCurrentPlaylist();return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isRealPrevPlaylist(){var e=this.player._prevPlaylist;return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isPodcast(){var e=this.player.getCurrentAudio();return o.a.isPodcast(e)}isLastTrack(){var e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();return!!e&&(!(!e||t)||t.indexOfAudio(e)+1===t.getAudiosCount())}hasPlaylist(){return Boolean(this.player.getCurrentPlaylist())}hasSearchParams(){return this.getContext()===AudioPlaylist.TYPE_SEARCH}isDebug(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))}sendListenedData(e){var t=this.player.getListenedHash();!t&&window.cur&&cur.audioPage&&(t=cur.audioPage._data.listenedHash);var i=extend({act:"listened_data",impl:this.getType(),hash:t,v:5,loc:nav.strLoc},e);ajax.post("al_audio.php",i,{onDone:e=>{this.player.setAdsConfig&&this.player.setAdsConfig(e)},onFail:()=>!0})}}},lXup:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i("HEwt"),i("a1Th"),i("Btvt"),i("rGqo"),i("rE2o"),i("ioFf"),i("pIFo"),i("KKXr");var a=i("zxIV");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],a=!0,o=!1,s=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){o=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function r(e,t){var i=getAudioPlayer(),s=AudioUtils.getAudioFromEl(e,!0);if(s){var r=null,l=[],n=Object(a.v)(e,"new-post"),d=!1,_=null,u=AudioPlaylist.TYPE_TEMP,c=vk.id,h=null,p={},g=window.AudioPage&&currentAudioPage(e);if((window.traverseParent||function(e,t){for(e=Object(a.J)(e);e&&!t(e)&&(e=Object(a.C)(e))!=document;);return null})(e,e=>d=Object(a.v)(e,"audio-context")),d=(d=s.context||d)||("audio"==cur.module?cur.submodule:cur.module),t)return{context:d};var f=o(AudioUtils.contextSplit(d),2),A=f[0],y=f[1],b=Object(a.Y)("_audio_pl",e),v=!1;if(b){var P=Object(a.v)(b,"playlist-id");(_=i.getPlaylistByBlockId(P))||(_=i.getPlaylist(...AudioPlaylist.splitId(P||"")));var m=Object(a.v)(b,"title")||"";m&&_.mergeWith({title:clean(m)});var O=Object(a.v)(b,"access-hash")||"";O&&_.mergeWith({accessHash:O});var I=g&&g.getPageCurrentPlaylist(),E=i.getCurrentPlaylist();I&&I.equals(_)&&E&&i.getCurrentPlaylist().getFullId()===I.getFullId()&&g.getSortedList()?_.initSortedList(g.getSortedList()):s.isFromCurrentPlaylist||(g&&g.clearSortedList(),_.removeSortedList(),_.shuffle(0))}else if(g&&g.getPageCurrentPlaylist())_=g.getPageCurrentPlaylist();else if("module"==A){var w=y;_=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,w||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),l=[r]}else if(0===s.context.indexOf("admin"))(_=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,s.ownerId,0,s.accessKey)).getAudiosCount()||_.setForceReload(!0);else if(0===s.context.indexOf("im"))r=(r=Object(a.Y)("_im_peer_history",e))||Object(a.Y)("_fc_tab_log_msgs",e),h="im"+(cur.peer||"");else if(0===s.context.indexOf("board"))v=!0,h=s.context,l=x(Object(a.K)("_wall_audio_rows",r));else if(0===s.context.indexOf("widget"))v=!0,h=s.context;else if(0===s.context.indexOf("wiki"))v=!0,h="wiki";else if(0===s.context.indexOf("post")){u=AudioPlaylist.TYPE_WALL,h=s.context,v=!0;var C=s.context.replace("post","").split("_");c=C[0],p={postId:C[1]}}else if(0===s.context.indexOf("choose"))h=s.context;else if("feed"==n||0===s.context.indexOf("feed")||0===s.context.indexOf("feedsearch"))h="feed",v=!0,l=x(Object(a.K)("wall_text",r));else if("group_wall"==A||"user_wall"==A||0===s.context.indexOf("reply")||"wall"==n){u=AudioPlaylist.TYPE_WALL,c=cur.oid;var T=(y||"").split("_")[1],L=cur.wallQuery||"",S=Object(a.J)("wall_search"),D=inArray(cur.wallType,["own","full_own"])?"own":"all";h=hashCode(D+"_"+L),v=!0,"wall"==cur.module&&Object(a.Cb)(S)&&(L=Object(a.Cb)(S)),T&&(p={postId:T,wallQuery:L,wallType:D}),0===s.context.indexOf("reply")&&(l=x([Object(a.Y)("_replies_list",e)]),h="reply"+h,v=!0);var j=Object(a.Y)("wide_column",e);if(j){var U=Object(a.K)("wall_text",j);l=Array.isArray(U)&&U.length>0?l.concat(U):l.concat(x([r]))}else l=l.concat(x([r]))}else"article"==A&&(_=cur.articlePlaylist);return r||(r=Object(a.C)(e)),(l=l.filter((function(e){return!!e})))&&0!=l.length||(l=[r]),"function"==typeof(_=_||i.getPlaylist(u,c,h)).setIsFakeId&&_.setIsFakeId(v),(_=_.getAudiosCount()?_:AudioUtils.initDomPlaylist(_,l)).mergeWith(p||{}),-1==_.indexOfAudio(s)&&(_=AudioUtils.initDomPlaylist(_,[Object(a.C)(e)])),{playlist:_,context:d}}function x(e){return[].slice.call(e)}}},pOqz:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));i("KKXr");function a(e){return isObject(e)&&(e=e.context),(e||"").split(":")}},pp2G:function(e,t,i){"use strict";i.d(t,"a",(function(){return V}));var a={};i.r(a),i.d(a,"ACTION_PLAY",(function(){return U})),i.d(a,"ACTION_PAUSE",(function(){return x})),i.d(a,"ACTION_SEEK",(function(){return k})),i.d(a,"ACTION_HEARTBEAT",(function(){return R})),i.d(a,"ACTION_TIME_MARKER",(function(){return M})),i.d(a,"log",(function(){return B}));i("91GP");var o=i("uk5P");i("pIFo");var s=i("zxIV");var r=i("4bNW");i("KKXr");var l=i("6ng+"),n=i("5xrp");i("rGqo"),i("Btvt");var d=i("v+DW"),_=i("4+be"),u=i("BJj/");var c=i("t7n3"),h=i("EasH"),p=i("lXup");var g=i("pOqz"),f=i("ldAL");function A(e){return e&&e<=-2e9&&e>=-2002e6}function y(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=A(e)?"album":"playlist",s=`/music/${o}/${e}_${t}${i?"_"+i:""}`;return a?`${location.protocol}//${location.host}${s}`:s}var b=i("Egk5");var v=i("Oupy"),P=i("rEJs"),m=[];var O=i("jE6c");var I=i("TGUg"),E=i("eVa8");function w(e){return e<600?"s":e<3600?"m":e<36e3?"l":"n"}function C(e,t){for(var i=JSON.parse(getTemplate("audio_bits_to_cls")),a=e[AudioUtils.AUDIO_ITEM_INDEX_FLAGS],o=[],s=0;s<32;s++){var r=1<<s;a&r&&o.push(i[r])}var l=AudioUtils.isPodcast(e);l&&(o.push("audio_podcast"),AudioUtils.isPrivatePodcast(e)&&o.push("audio_podcast_private")),t&&o.push(t);var n="";if(e[AudioUtils.AUDIO_ITEM_INDEX_COVER_URL]){var d=e[AudioUtils.AUDIO_ITEM_INDEX_COVER_URL].split(",");n="background-image: url("+d[0]+")"}var _,u=AudioUtils.getAudioPerformers(e),c=e[AudioUtils.AUDIO_ITEM_INDEX_DURATION],h=formatTime(c),p=clean(JSON.stringify(e));try{var g=getTemplate("podcast_row",e);_=l&&g?g:getTemplate("audio_row",e)}catch(e){return""}return _=(_=(_=(_=(_=(_=(_=(_=_.replace(/%cls%/,()=>o.join(" "))).replace(/%duration%/,()=>h)).replace(/%serialized%/,()=>p)).replace(/%cover_style%/,()=>n)).replace(/%performers%/,()=>u)).replace(/%duration_mod%/,()=>w(c))).replace(/%chart_info_position%/,()=>{return(t=e[AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].position)?`<div class="audio_row__position">${t}</div>`:"";var t})).replace(/%chart_info_state%/,()=>function(e){var t="";switch(e){case 0:t="audio_row__state-new_release";break;case 1:t="audio_row__state-no_changes";break;case 2:t="audio_row__state-moved_up";break;case 3:t="audio_row__state-moved_down";break;case 4:t="audio_row__state-crown";break;default:t=""}return t?`<div class="audio_row__state ${t}"></div>`:""}(e[AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].state))}i("OEbY");var T=i("tWcy"),L=i("C13D");var S=i("Se/q"),D=i("wtP8"),j=i("W0fz");var U="play",x="pause",k="seek",R="heartbeat",M="time_marker";function B(e,t){var i=t.audio;AudioUtils.isPodcast(i)&&stManager.add([jsc("web/podcast.js")],(function(){Podcast.log(e,t)}))}var N=i("RbYe");var F=i("aong"),H=i("/PiP"),W=i("XzvV");function K(e){Object(h.d)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:()=>{Object(W.bb)("audio_restriction_popup","hide",e.restrictionStatus)}},`\n    <button class="audio_restriction_box__close" onclick="curBox().hide()">${getLang("global_close")}</button>\n    <div class="audio_restriction_box__icon audio_restriction_box__icon_pensive_face"></div>\n    <div class="audio_restriction_box__title">${getLang("audio_restriction_title_claim")}</div>\n    <div class="audio_restriction_box__controls">\n        <button class="flat_button" onclick="curBox().hide()">${getLang("global_close")}</button>\n    </div>\n  `)}function Y(e){var t=Object(s.K)("_audio_row_"+e.fullId);if(!t||!t.length)return!1;var i=Object(F.l)(Object(s.v)(t[0],"audio"));if(!i)return!1;var a=Object(F.l)(i[o.a.AUDIO_ITEM_INDEX_EXTRA]);a&&delete a.claim,i[o.a.AUDIO_ITEM_INDEX_RESTRICTION]=0,i[o.a.AUDIO_ITEM_INDEX_FLAGS]&=~o.a.AUDIO_ITEM_CLAIMED_BIT,i[o.a.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(a);var r=Object(H.l)().getCurrentPlaylist(),l=Object(s.rb)(C(i,"no_extra"));if(r){var n=i[o.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+i[o.a.AUDIO_ITEM_INDEX_ID],d=r.getAudio(n);d&&(d[o.a.AUDIO_ITEM_INDEX_RESTRICTION]=i[o.a.AUDIO_ITEM_INDEX_RESTRICTION],d[o.a.AUDIO_ITEM_INDEX_FLAGS]=i[o.a.AUDIO_ITEM_INDEX_FLAGS],d[o.a.AUDIO_ITEM_INDEX_EXTRA]=i[o.a.AUDIO_ITEM_INDEX_EXTRA])}return each(t,(e,t)=>{var a=e>0?Object(s.rb)(C(i,"no_extra")):l;t.parentElement.insertBefore(a,t),t.parentElement.removeChild(t)}),l}function X(){return(X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}var V=G({},o.a,{audioSearchPerformer:function(e,t,i){var a=!!window.AudioPage&&currentAudioPage(e),o=window.AudioPage&&currentAudioPage(e)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout((function(){a&&o?(t=unclean(t).replace(/<em>|<\/em>/g,""),nav.change({q:t,performer:1},i,{searchPerformer:!0,nav:!0,isLayer:a.isLayer()})):nav.go(e,i)}),50)},toggleAudioLyrics:function(e,t){var i=Object(s.L)("_audio_row__lyrics",e);if(i){if(Object(s.yb)(i)){var a=Object(s.S)(e)[1],o=Object(s.S)(i)[1];Object(s.vb)(e,"height",a+o),Object(s.l)(e,"prevHeight",a)}else{var r=Object(s.l)(e,"prevHeight");Object(s.vb)(e,"height",r)}}else{Object(s.c)(e,"audio_loading");var l={act:"get_lyrics",aid:t.fullId,lid:t.lyrics};AudioUtils.isPodcast(t)&&(l.podcast=!0),ajax.post("al_audio.php",l,{onDone:function(a){Object(s.mb)(e,"audio_loading"),i=Object(s.rb)(`<div class="_audio_row__lyrics audio_row__lyrics" data-nodrag="1" style="display:none;"><div class="audio_row__lyrics_inner">${a}</div></div>`),Object(s.L)("_audio_row_content",e).appendChild(i),AudioUtils.toggleAudioLyrics(e,t)},onFail:()=>!0})}},getRowActionName:function(e,t,i){var a,o=AudioUtils.getAddRestoreInfo();switch(e){case"current_delete":a=getLang("audio_delete_from_current");break;case"recoms_delete":a=getLang("audio_dont_show");break;case"listened_delete":a=getLang("audio_remove_from_list");break;case"delete":if(AudioUtils.isPodcast(t))a=getLang("audio_podcast_delete_episode");else if(window.AudioPage&&AudioPage.isInRecentPlayed(i))a=getLang("audio_remove_from_list");else{var s=o[t.fullId];a=s&&s.deleteAll?s.deleteAll.text:getLang("global_delete_audio")}break;case"restore_recoms":a=getLang("audio_restore_audio");break;case"more":a=getLang("global_media_selector_more");break;case"add":var r=o[t.fullId];if(r&&o[r.addedFullId]&&(r=null),AudioUtils.isPodcast(t))a=getLang("audio_podcast_restore_episode");else if(r&&"deleted"==r.state)a=getLang("audio_restore_audio");else if(r&&"added"==r.state)a=getLang("global_delete_audio");else{var l=!!window.AudioPage&&currentAudioPage(i);a=l&&l.getOwnerId()<0&&l.canAddToGroup()&&l.getOwnerId()!==t.ownerId?getLang("audio_add_to_group"):getLang("audio_add_to_audio")}break;case"edit":a=AudioUtils.isPodcast(t)?getLang("audio_podcast_edit_episode"):getLang("audio_edit_audio");break;case"next":a=cur.lang&&cur.lang.global_audio_set_next_audio||getLang("audio_set_next_audio");break;case"recoms":a=getLang("audio_show_recommendations");break;case"fave":a=AudioUtils.isPodcast(t)?getLang("audio_podcast_listen_later"):"";break;default:a=""}return a},initRowPlaylistsChooser:function(e,t,i){var a,o=AudioUtils.asObject(e);a=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,AudioUtils.playlistsByAudioDataCache=AudioUtils.playlistsByAudioDataCache||{};var s=AudioUtils.playlistsByAudioDataCache,r=a+"_"+o.ownerId+"_"+o.id;s[r]?AudioUtils._showPlaylistsChooser(i,t,s[r],a,o,e):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:a,audio_owner_id:o.ownerId,audio_id:o.id},{onDone:(l,n,d)=>{var _=s[r]={playlists:l,morePlaylists:n,newPlaylistHash:d};AudioUtils._showPlaylistsChooser(i,t,_,a,o,e)},onFail:()=>!0})},addToPlaylistsBoxInit:function e(t,i,a,o,r){if("undefined"==typeof AutoList)return stManager.add(jsc("web/auto_list.js"),()=>{e(t,i,a,o,r)});var l=curBox(),n=Object(s.L)("_audio_atp_content",l.bodyNode),c=Object(s.L)("_audio_atp_list",l.bodyNode),h=Object(s.J)("audio_atp_search"),p=Object(s.L)("_audio_atp_empty"),g=Object(s.S)(n)[1];Object(s.vb)(c,{height:g-Object(s.S)(h)[1]});var f,A="";function y(){f&&f.destroy(),c.innerHTML="";var e=[];e=A?o.filter(e=>e[2].toLowerCase().indexOf(A)>=0):o,Object(s.yb)(c,0!=e.length),Object(s.yb)(p,0==e.length),f=new AutoList(c,{onNeedRows:(t,i)=>{for(var a=[],o=i,s=Math.min(e.length,i+30),r=o;r<s;r++){var l=e[r];if(l){var n=`<div class="ape_pl_item _ape_pl_item ${l[4]?"ape_selected":""}" data-id="${l[1]}"><div class="ape_check"><div class="ape_check_icon"></div></div><div class="ape_pl_item_inner"><span class="ape_pl_title">${l[2]}</span> <span class="ape_pl_size">${l[3]}</span></div></div>`;a.push(n)}}t(a)}})}y(),cur.addToPlaylistSearch=Object(u.a)((function(e){A=trim(e).toLowerCase(),y()}),200);var b={},v={};addEvent(c,"click",e=>{var t=Object(s.q)("_ape_pl_item",e.target),i=Object(s.v)(t,"id");Object(s.zb)(t,"ape_selected")?(v[i]=!0,delete b[i]):(b[i]=!0,delete v[i])}),l.removeButtons(),l.addButton(Object(_.d)("global_save"),e=>{var o=Object.keys(v),s=Object.keys(b);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:o.join(","),remove_pl_ids:s.join(","),owner_id:t,audio_owner_id:i,audio_id:a,hash:r},{showProgress:d.o.pbind(e),hideProgress:d.w.pbind(e),onDone:()=>{l.hide()},onFail:()=>(l.hide(),!0)})},"ok",!0),l.addButton(Object(_.d)("global_cancel"),l.hide.bind(this),"no",!0)},showRecoms:function(e,t){cur.audioPage&&cur.audioPage.showRecoms(!1,t.fullId)},shareAudio:function(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(t=t||getAudioPlayer().getCurrentAudio()){t=AudioUtils.asObject(t);var i=AudioUtils.isPodcast(t)?"podcast":"audio";return Object(n.a)(e,t,{type:l.i}),!showBox("like.php",{act:"publish_box",object:i+t.fullId,list:t.actionHash,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css",jsc("web/sharebox.js")],onFail:function(e){return showDoneBox(e),!0}})}},showAudioAlbum:function(e,t){return cur.viewAsBox?cur.viewAsBox():(t=AudioUtils.asObject(t),layers.fullhide&&layers.fullhide(),Object(n.a)(e,t,{type:l.j}),AudioUtils.showAudioPlaylist(t.album[0],t.album[1],t.album[2]))},openEpisode:function(e,t){t=AudioUtils.asObject(t),AudioUtils.isPodcast(t)&&showPodcast(e,t.fullId,null,"audio")},replaceWithOriginal:function(e,t,i){(t=t||getAudioPlayer().getCurrentAudio())&&(t=AudioUtils.asObject(t),ajax.post("al_audio.php",{act:"replace_with_original",hash:t.replaceHash,audio_id:t.fullId},{onDone:function(a){var o=JSON.parse(t.extra).claim.original;o[AudioUtils.AUDIO_ITEM_INDEX_ID]=a,o[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]=t.ownerId;var r=Object(s.rb)(AudioUtils.drawAudio(o));e.parentElement.insertBefore(r,e),e.parentElement.removeChild(e),i&&i()},onFail:()=>(i(),!0)}))},editAudio:function(e,t,i){showBox("al_audio.php",{act:"edit_audio_box",aid:t.fullId,force_edit_hash:i},{params:{width:"456px",bodyStyle:"padding: 20px; background-color: #F7F7F7;",hideButtons:1},dark:1})},editEpisode:function(e,t){AudioUtils.isPodcast(t)&&(cur.podcastEditData={audioId:t.fullId},stManager.add([jsc("web/podcast.js")],(function(){Podcast.edit(t.fullId)})))},deleteCurrentAudio:function(e,t){window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(e);var i=getAudioPlayer().getCurrentPlaylist();i&&i.removeAudio(t.fullId),Object(s.kb)(e)},deleteRecomsAudio:function(e,t){AudioUtils.deleteAudio(e,t,!1,!0)},deleteListenedAudio:function(e,t){AudioUtils.deleteAudio(e,t,!1,!1,!0)},deleteAudio:function(e,t,i,a,o){function r(t){return Object(s.v)(e,"in-progress",Object(c.r)(t))}if(window.tooltips&&tooltips.hideAll(),!Object(c.r)(Object(s.v)(e,"in-progress"))){r(!0);var u=!1;t.isClaimed&&(u=!0);var g=V.getAddRestoreInfo(),f=g[t.fullId];if(f&&f.deleteAll)Object(h.d)({title:Object(_.d)("audio_delete_all_title"),dark:1,onHide:()=>r(!1)},f.deleteConfirmMsg||"",Object(_.d)("global_delete"),(function(e){var t=extend({act:"delete_all"},f.deleteAll);ajax.post("al_audio.php",t,{showProgress:d.o.pbind(e),onDone:function(){var e=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,f.deleteAll.from_id,AudioPlaylist.DEFAULT_PLAYLIST_ID);getAudioPlayer().deletePlaylist(e),nav.reload()},onFail:()=>!0})}),Object(_.d)("global_cancel"));else{if(u?Object(s.kb)(e):Object(s.c)(e,"audio_row__deleted"),o){ajax.post("al_audio.php",{act:"remove_listened",audio_id:t.id,audio_owner_id:t.ownerId,hash:t.actionHash},{onFail:()=>!0}),Object(s.kb)(e);var A=getAudioPlayer().getCurrentPlaylist();A&&A.getType()==AudioPlaylist.TYPE_RECOM&&A.getAlbumId()==V.AUDIO_RECOMS_TYPE_LISTENED&&A.removeAudio(t.fullId)}else if(a){var y=V.getAudioExtra(t).recom,b=null,v=Object(p.a)(e);v&&(b=v.playlist&&v.playlist.getAlbumId());var P={act:"hide_recommendation",hash:y.hash,audio_id:t.fullId,playlist_id:b};nav.objLoc.audio_id&&(P.recommendation_type="query"),ajax.post("al_audio.php",P,{onDone:()=>{Object(n.a)(e,t,{type:l.g}),r(!1)},onFail:()=>(r(!1),!0)}),g[t.fullId]={state:"recom_hidden"};var m=getAudioPlayer().getCurrentPlaylist();m&&m.getType()==AudioPlaylist.TYPE_RECOM&&(g[t.fullId].removedCurrentPos=m.removeAudio(t))}else ajax.post("al_audio.php",{act:"delete_audio",oid:t.ownerId,aid:t.id,hash:t.deleteHash,restore:1,track_code:t.trackCode},{onDone:(i,a)=>{Object(n.a)(e,t,{type:l.h}),u||r(!1),g[t.fullId]={state:"deleted",deleteAll:i,deleteConfirmMsg:a},u&&V.deleteDeletedAudios(),V.onRowOver(e,!1,!0)},onFail:()=>!0});V.onRowOver(e,!1,!0)}}},deleteEpisode:function(e,t){AudioUtils.isPodcast(t)&&stManager.add([jsc("web/podcast.js")],(function(){Podcast.deleteEpisode(t.fullId,t.deleteHash)}))},restoreEpisode:function(e,t){AudioUtils.isPodcast(t)&&stManager.add([jsc("web/podcast.js")],(function(){Podcast.restoreEpisode(t.fullId,t.editHash)}))},deleteDeletedAudios:function(){each(AudioUtils._audioAddRestoreInfo||{},(e,t)=>{"deleted"!=t.state&&"recom_hidden"!=t.state||getAudioPlayer().deleteAudioFromAllPlaylists(e)})},faveEpisode:function(e,t){if(AudioUtils.isPodcast(t)){var i=AudioUtils.getAudioExtra(t).faveHash;bookmarkPodcast(Object(s.L)("audio_row__action_fave",e),t.fullId,i)}},contextSplit:g.a,showAudioPlaylist:function(e,t,i,a,o,r){if(cur.apLayer)return cancelEvent(o);if(vk.widget)return!0;if(!o||!(o.metaKey&&browser.mac||o.ctrlKey)){var l=null;return window.Photoview&&window.cur&&cur.pvShown&&(l=clone(nav.objLoc),Photoview.hide(!0)),boxRefreshCoords(boxLoader),Object(s.xb)(boxLoader),Object(s.xb)(boxLayerWrap),stManager.add([jsc("web/auto_list.js"),"audio.css"],(function(){var o,n,d=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t,i);function _(e){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,o&&removeEvent(window.audioPlaylistLayerWrap,"click",o),n&&removeEvent(bodyNode,"keydown",n),delete cur.apLayer,delete cur.apLayerPlaylistId,Object(s.mb)(layerBG,"ap_layer_bg_dark"),l?nav.change(l):nav.change({z:!1}),layerQueue.pop()}d.setContext(a),d.setForceReload(!0),d.setFromId(cur.oid),d.loadAll((function(d,u){if(Object(s.bb)(boxLoader),Object(s.bb)(boxLayerWrap),u){var c=getLang("audio_error_deleted_playlist_box").split("/");return new MessageBox({title:c[0]}).content(c[1]).setButtons(getLang("global_close"),(function(){curBox().hide(),l&&nav.change(l)})).show(),void nav.setLoc(extend(nav.objLoc,{z:!1}))}var h=extend(nav.objLoc,{z:"audio_playlist"+e+"_"+t+(i?"/"+i:"")});nav.setLoc(h),window.audioPlaylistLayerWrap||(window.audioPlaylistLayerWrap=Object(s.rb)('<div class="ap_layer_wrap"></div>'),bodyNode.appendChild(window.audioPlaylistLayerWrap));window.audioPlaylistLayerWrap.innerHTML="";var p=d.getAudiosList().length,g=d.isBlocked&&d.isBlocked(),A=y(d.getOwnerId(),d.getPlaylistId(),d.getAccessHash()),b=getTemplate("audio_playlist_snippet",{title:d.getTitle(),subTitle:d.getSubtitle(),description:d.getDescription(),coverStyle:d.getCoverUrl()?"background-image:url('"+d.getCoverUrl()+"'); background-size: cover;":"",authorLine:d.getAuthorLine(),infoLine1:d.getInfoLine1(),infoLine2:d.getInfoLine2(),id:d.getPlaylistId(),ownerId:d.getOwnerId(),href:A,addCls:d.getAddClasses(),followHash:d.getFollowHash(),accessHash:d.getAccessHash(),editHash:d.getEditHash(),deleteHash:d.getDeleteHash(),replaceHash:d.getReplaceHash(),gridCovers:d.getGridCovers(),type:d.getType(),context:a,followButtonText:d.isFollowed()?getLang("audio_playlist_btn_added"):getLang("audio_playlist_btn_add")});if(cur.apLayer=Object(s.rb)(`\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            ${b}\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      `),g){Object(s.L)("audio_pl_snippet__body",cur.apLayer).innerHTML=getTemplate("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),addEvent(window.audioPlaylistLayerWrap,"click",o=function(e){e.target!=window.audioPlaylistLayerWrap&&e.target!=Object(s.L)("_ap_layer__close",cur.apLayer)||layers.fullhide()}),addEvent(bodyNode,"keydown",n=function(e){if(27==e.keyCode)return layers.fullhide(),cancelEvent(e)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),Object(s.c)(layerBG,"ap_layer_bg_dark");var v=Object(s.L)("_audio_pl_snippet__list",cur.apLayer),P=AudioUtils.getAlbumParts(d),m=0;p&&!g&&(cur.apLayerAutoList=new f.a(v,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(e,t){for(var i=[],a=d.getUnshuffledAudiosList(),o=t-=m;o<t+30;o++){var s=a[o];if(!s)break;if(P&&P.length&&P[0].offset===o){var r=P.shift();m++,i.push(AudioUtils.drawAlbumPartRow(r.number))}i.push(AudioUtils.drawAudio(s))}e(i)}}));boxRefreshCoords(cur.apLayer),getAudioPlayer().updateCurrentPlaying(),layers.fullhide=_,cur.apLayerPlaylistId=[e,t],r&&r()}))})),!1}},editPlaylist:v.a,followPlaylist:function(e,t,i,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function r(a){var o=Object(s.v)(e,"text-followed"),r=Object(s.v)(e,"text-follow"),l=a?o:r;Object(s.v)(e,"tooltip-text",l),(geByClass1("audio_pl_snippet__action_btn_add_text",e)||e).innerHTML=l,_.setFollowed(a);var n=_.getAddClasses()||"";n=n.replace("audio_pl__followed",""),a&&(n+=" audio_pl__followed"),_.mergeWith({addClasses:n}),each(Object(s.K)(`_audio_pl_${t}_${i}`),(t,i)=>{Object(s.zb)(i,"audio_pl__followed",a);var o=i.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];o&&(o.innerHTML=e.innerHTML)})}function l(e){if(cur.audioPage&&cur.audioPage._data.playlists&&cur.audioPage.getOwnerId()===vk.id){if(e){var a=null;m=m.filter(e=>{var o=e.playlistId===i&&e.playlistOwnerId===t;return o&&(a=e.pl),!o}),a&&cur.audioPage._data.playlists.unshift(a)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter(e=>{var a=e.id===i&&e.owner_id===t;return a&&m.push({playlistId:i,playlistOwnerId:t,pl:e}),!a});cur.audioPage.updatePlaylistsCounter(vk.id)}}var n=Object(s.Y)("_audio_pl",e),d=Object(s.zb)(n,"audio_pl__followed"),_=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,i);r(d),l(d),ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:t,playlist_id:i,hash:a,showcase:o},{onDone(e){isObject(e)&&d&&getAudioPlayer().notify(P.a.MUSIC_PLAYLISTS_ADD,e)},onFail:e=>(new MessageBox({title:getLang("global_error")}).content(e).setButtons(getLang("audio_ok"),(function(){curBox().hide()})).show(),r(!1),l(!1),!0)})},getLayer:function(){var e=window.audioLayer;return e||(window.audioLayer=e=new AudioLayer),e},updateQueueReceivedPost:function(e){e&&each(Object(s.K)("_audio_row",e),(function(){Object(s.v)(this,"new-post","groups"==cur.module?"wall":"feed")}))},toggleAudioHQBodyClass:function(){var e=AudioPlayer.showHQLabel();Object(s.zb)(document.body,AudioUtils.AUDIO_HQ_LABEL_CLS,e)},hasAudioHQBodyClass:function(){return Object(s.ab)(document.body,AudioUtils.AUDIO_HQ_LABEL_CLS)},getAddRestoreInfo:function(){return AudioUtils._audioAddRestoreInfo=AudioUtils._audioAddRestoreInfo||{},AudioUtils._audioAddRestoreInfo},addAudio:function(e,t,i){if(cur.viewAsBox)return cur.viewAsBox();if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function a(t){return Object(s.v)(e,"in-progress",Object(c.r)(t))}if(!Object(c.r)(Object(s.v)(e,"in-progress"))){a(!0),t||(t=AudioUtils.getAudioFromEl(e,!0));var o=window.AudioPage&&currentAudioPage(e),r=o&&o.getOwnerId()<0&&o.canAddToGroup()&&o.getOwnerId()!==t.ownerId?-o.getOwnerId():0,d=AudioUtils.getAddRestoreInfo(),_=d[t.fullId];_&&d[_.addedFullId]&&(_=null);var u=Object(s.L)("_audio_row_"+t.fullId);u=u!=e&&u;var h=o&&o.getPageCurrentPlaylist(),g=Object(p.a)(e,!0),f={group_id:r,audio_owner_id:t.ownerId,audio_id:t.id,hash:t.addHash,from:g&&g.context||"",track_code:t.trackCode};_?"recom_hidden"==_.state?(o&&(o.restoreRecommendation(e),a(!1)),AudioUtils.onRowOver(e,!1,!0)):"deleted"==_.state?(ajax.post("al_audio.php",{act:"restore_audio",oid:t.ownerId,aid:t.id,hash:t.restoreHash,track_code:t.trackCode},{onDone:function(){Object(n.a)(e,t,{type:l.e}),a(!1)},onFail:()=>(a(!1),!0)}),Object(s.mb)(e,"audio_row__deleted"),delete d[t.fullId],AudioUtils.onRowOver(e,!1,!0)):"added"==_.state&&(ajax.post("al_audio.php",{act:"delete_audio",oid:_.audio.ownerId,aid:_.audio.id,hash:_.audio.deleteHash,track_code:t.trackCode},{onDone:function(){Object(n.a)(e,t,{type:l.h});var i=window.getAudioPlayer&&window.getAudioPlayer();i&&i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,r?-r:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(_.addedFullId),a(!1)},onFail:()=>(a(!1),!0)}),Object(s.mb)(e,"audio_row__added"),u&&Object(s.mb)(u,"audio_row__added"),delete d[t.fullId],getAudioPlayer().notify(P.a.REMOVED,t.fullId,_.addedFullId)):(ajax.post("al_audio.php?act=add",f,{onDone:function(o){if(Object(n.a)(e,t,{type:l.e}),o){var s=o[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+o[AudioUtils.AUDIO_ITEM_INDEX_ID];d[t.fullId]={state:"added",addedFullId:s,audio:AudioUtils.asObject(o)},getAudioPlayer().notify(P.a.MUSIC_AUDIOS_ADD),Object(O.j)(i)&&i()}a(!1)},onFail:function(t){return t&&new MessageBox({title:getLang("global_error")}).content(t).setButtons(getLang("global_close"),()=>curBox().hide()).show(),Object(s.mb)(e,"audio_row__added"),a(!1),!0}}),Object(s.c)(e,"audio_row__added"),u&&Object(s.c)(u,"audio_row__added"),getAudioPlayer().notify(P.a.ADDED,t.fullId),o&&h&&o.onUserAction(t,h))}},addAudioToOwner:function(e,t){return window.onAudioPageLoaded=function(){return this.uploadAudio({})},nav.go("audios"+e),cancelEvent(t)},chooseAudioBox:function(e,t,i){if(void 0!==e.selected)cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,Object(s.mb)(Object(s.C)(e),"audio_selected"),e.innerHTML=t.labels.add;else{var a=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",t.owner_id+"_"+t.id,t.info),(!cur.attachCount||cur.attachCount()>a)&&cur.lastAddMedia&&(e.selected=cur.lastAddMedia.chosenMedias.length-1,Object(s.c)(Object(s.C)(e),"audio_selected"),e.innerHTML=t.labels.cancel)}return Object(b.c)(i)},getAudioArtistsString:I.a,getAudioPerformers:E.a,drawAudio:C,isClaimedAudio:function(e){return!!e&&(e=AudioUtils.asObject(e)).flags&AudioUtils.AUDIO_ITEM_CLAIMED_BIT},getDurationMod:w,getAudioExtra:function(e){return"object"==typeof(e=AudioUtils.asObject(e)).extra?e.extra:JSON.parse(e.extra||"{}")},getAudioFromEl:function(e,t){e=Object(s.q)("_audio_row",e);var i=Object(s.l)(e,"audio")||JSON.parse(Object(s.v)(e,"audio"));if(!i)return null;if(t){(i=AudioUtils.asObject(i)).isDeleted=Object(s.ab)(e,"audio_row__deleted"),i.isCurrent=Object(s.ab)(e,AudioUtils.AUDIO_CURRENT_CLS),i.isPlaying=Object(s.ab)(e,AudioUtils.AUDIO_PLAYING_CLS),i.isFromCurrentPlaylist=!!Object(s.Y)("_audio_section__current",e),i.isNumeric=!!Object(s.Y)("audio_numeric",e),i.isWithCovers=!!Object(s.Y)("audio_w_covers",e),i.withInlinePlayer=!i.isWithCovers&&!Object(s.Y)("audio_no_inline_player",e),i.isInSnippet=!!Object(s.Y)("_audio_pl_snippet__list",e),i.isInEditBox=!!Object(s.Y)("_audio_pl_edit_box",e),i.isInRecomsBlock=!!Object(s.Y)("_audio_recoms_blocks",e),i.isInFastChat=!!Object(s.Y)("fc_tab",e),i.isInAttach=!!Object(s.Y)("media_preview",e),i.isSetClaimed=Object(s.ab)(e,"audio_moder_claimed"),i.isPodcastListSnippet=Object(s.ab)(e,"podcast_list_snippet");var a=Object(s.Y)("_audio_pl",e);i.isCurrentAlbumSnippet=!!i.album&&!!a&&a.dataset.playlistId===`playlist_${i.album[0]}_${i.album[1]}`}return i},getAudioFullId:T.a,asObject:L.a,initDomPlaylist:function(e,t){var i=[];return each(t,(function(e,t){t&&each(Object(s.K)("_audio_row",t),(function(e){i.push(AudioUtils.getAudioFromEl(this))}))})),e.addAudio(i),e},getContextPlaylist:p.a,renderAudioDiag:function(){var e=Object(s.J)("audio_diag_log"),t=ls.get(AudioUtils.LOG_LS_KEY)||[];e&&each(t,(function(t,i){var a=new Date(i.shift()).toUTCString();i=i.join(", "),e.appendChild(Object(s.rb)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+a+"</span>"+i+"</div>"))}))},claim:function(e,t,i){Object(s.c)(t,"audio_moder_claimed"),AudioUtils.onRowOver(t,!1,!0),e=AudioUtils.asObject(e),ajax.post("al_claims.php",{act:"a_claim",claim:i,type:"audio",id:e.id,owner_id:e.ownerId})},unclaim:function(e,t,i){Object(s.mb)(t,"audio_moder_claimed"),AudioUtils.onRowOver(t,!1,!0),e=AudioUtils.asObject(e),ajax.post("al_claims.php",{act:"a_unclaim",claim:i,type:"audio",id:e.id,owner_id:e.ownerId,hash:e.actionHash})},getUMAInfo:function(e,t){t.isInEditBox||showBox("al_audio.php",{act:"get_uma_restrictions",id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{width:1e3}})},getUMAInfoAlbum:function(e,t){t.isInEditBox||showBox("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e},{params:{width:750}})},cancelReplacement:function(e,t,i){ajax.post("al_audio.php",{act:"cancel_replacement",hash:t,audio_id:e},{onFail:()=>!0}),Object(s.kb)(i)},removeFromGroup:S.a,addToGroupBox:D.a,showAudioRestriction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;if((e=Object(L.a)(e)).restrictionStatus){if(e.actionHash){Object(W.bb)("audio_restriction_popup","show",e.restrictionStatus);var i=showBox("al_audio.php",{act:"restriction_box",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{hideButtons:!0,onShow:function(){var i=curBox();Object(O.j)(t.onShow)&&t.onShow(),i&&i.once("click:ok",()=>{Object(W.bb)("audio_restriction_popup","click",e.restrictionStatus)})},onHide:i=>{Object(O.j)(t.onHide)&&t.onHide(),i||Object(W.bb)("audio_restriction_popup","hide",e.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+e.restrictionStatus,onDone:(t,i)=>{if(i&&i.play){t.hide();var a=Y(i.audio?Object(L.a)(i.audio):e),o=Object(H.l)();a&&o.toggleAudio(a,{target:a})}},onFail:()=>(i&&i.hide(),K(e),!0)})}else K(e);return!0}return!1},isPodcast:j.a,isPrivatePodcast:function(e){return!(!AudioUtils.isPodcast(e)||!AudioUtils.getAudioExtra(e).private)},followArtist:function(e,t,i,a){Object(d.o)(a),ajax.post("al_artist.php",{act:"follow",artist_id:e,ref:t,hash:i},{onFail:()=>Object(d.w)(a),onDone:i=>{Object(d.w)(a),a.classList.add("MusicAuthor__follow_btn__followed"),a.onclick=o=>{o.preventDefault(),AudioUtils.unfollowArtist(e,t,i,a)}}})},unfollowArtist:function(e,t,i,a){Object(d.o)(a),ajax.post("al_artist.php",{act:"unfollow",artist_id:e,ref:t,hash:i},{onFail:()=>Object(d.w)(a),onDone:i=>{a&&(Object(d.w)(a),Object(s.ab)(a,"MusicAuthor__follow_btn__can_follow")?(a.classList.remove("MusicAuthor__follow_btn__followed"),a.onclick=o=>{o.preventDefault(),AudioUtils.followArtist(e,t,i,a)}):re(a))}})},followCurator:function(e,t,i){Object(d.o)(i),ajax.post("al_curator.php",{act:"follow",curator_id:e,hash:t},{onFail:()=>Object(d.w)(i),onDone:t=>{Object(d.w)(i),i.classList.add("MusicAuthor__follow_btn__followed"),i.onclick=a=>{a.preventDefault(),AudioUtils.unfollowCurator(e,t,i)}}})},unfollowCurator:function(e,t,i){Object(d.o)(i),ajax.post("al_curator.php",{act:"unfollow",curator_id:e,hash:t},{onFail:()=>Object(d.w)(i),onDone:t=>{Object(d.w)(i),i.classList.remove("MusicAuthor__follow_btn__followed"),i.onclick=a=>{a.preventDefault(),AudioUtils.followCurator(e,t,i)}}})},trackArtistToOfficial:function(e,t){ajax.post("al_artist.php",{act:"track_to_official",hash:e,url:t},{onFail:()=>!0})},PodcastsLogs:a,copyPlaylistLink:function(e,t,i){statlogsValueEvent("audio_copy_link",vk.id),Object(N.b)(y(e,t,i,!0)),showDoneBox(getLang("audio_playlist_link_copied"))},getAlbumParts:function(e){if(e&&e.getAudiosCount()&&e.isFullyLoadable()&&!e.hasMore()){for(var t=e.getAudiosList(),i=e.getAudiosCount(),a=[],s=0,r=0;r<i;r++){var l=t[r][o.a.AUDIO_ITEM_INDEX_ALBUM_PART];l>s&&(s=l,a.push({number:l,offset:r}))}if(a.length>1)return a}return!1},drawAlbumPartRow:function(e){return`<div class="audio_album_part_row">${getLang("audio_album_part").replace("{part}",e)}</div>`},onRowOver:r.a,onRowLeave:function(e){Object(s.l)(e,"leaved",!0);var t=Object(s.l)(e,"tt");if((!t||!t.isShown())&&(clearTimeout(window.audioRowHoverTO),Object(s.l)(e,"actions"))){var i=Object(s.L)("_audio_row__actions",e),a=Object(s.L)("_audio_row__duration",e);re(i),Object(s.vb)(a,"visibility","visible"),Object(s.l)(e,"actions",0)}},onAudioAddedToPlaylist:function(e,t,i,a){getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t).addAudio(a,0),each(Object(s.K)(`_audio_pl_${e}_${t}`),(e,t)=>{domReplaceEl(t,Object(s.rb)(i))})},onAudioChoose:function(e,t,i,a){if(Object(c.B)(t.selected)){var o=cur.attachCount&&cur.attachCount()||0,r=i.fullId+(i.accessKey?"_"+i.accessKey:"");if(cur.chooseMedia("audio",r,a),(!cur.attachCount||cur.attachCount()>o)&&cur.lastAddMedia){t.selected=cur.lastAddMedia.chosenMedias.length-1,Object(s.c)(Object(s.C)(t),"audio_selected");var l=Object(s.S)(t)[0];Object(s.vb)(t,"width",l),t.innerHTML=getLang("global_cancel")}}else cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,Object(s.mb)(Object(s.C)(t),"audio_selected"),t.innerHTML=getLang("global_add_media");return Object(b.c)(e)},onPlaylistChoose:function(e,t){var i=t.getAccessHash();cur.chooseMedia("audio_playlist",t.getOwnerId()+"_"+t.getPlaylistId()+(i?":"+i:""),{id:t.getPlaylistId(),ownerId:t.getOwnerId(),coverUrl:t.getCoverUrl(),gridCovers:t.getGridCovers(),title:t.getTitle(),authorName:t.getAuthorName(),authorHref:t.getAuthorHref(),accessHash:t.getAccessHash()})},claimPlaylist:function(e,t,i){var a=nav.objLoc.claim;if(a){var o={act:i?"a_unclaim_playlist":"a_claim_playlist",claim:a,type:"audio",owner_id:e,playlist_id:t};ajax.post("al_claims.php",o,{onDone:e=>{showDoneBox(e)}})}},initUpload:function(e,t,i,a,o,s,r,l,n,d,_,u){cur.loadAudioDone=function(t,i){if(cur.audioPage){if(cur.boxClose&&cur.audioPage.onAudioAllUploaded(),cur.audioPage.onAudioUploaded(t,i),cur.boxClose){delete cur.boxClose;var a=cur.audiosLoaded>1?getLang("audio_success_msg_multiple"):getLang("audio_success_msg");e.setOptions({title:getLang("audio_uploading_over"),bodyStyle:"padding: 16px 23px;"}),e.content(a),hide(e.progress),setTimeout((function(){e.hide(200)}),2e3),delete cur.audiosLoaded,_tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(_tbLink.loc))}}else cur.boxClose&&nav.go("/audios"+i[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],!1,{onDone:function(){cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(nav.objLoc[0])}})},cur.loadAudioFailed=function(i,a){hide(e.progress),Upload.embed(i);var o=ge("audio_new_error"),s=o&&domFC(o),r=a.split("|");s&&(a=r[0],r=r[1],s.innerHTML=r||(t[a]||getLang("audio_loading_error").replace("{code}",intval(a))),show(o))},Upload.init("audio_add_upload_btn",i,a,{file_name:"file",file_size_limit:o,file_types_description:"Audio files (*.mp3)",file_types:"*.mp3;*.MP3",accept:"audio/mpeg",lang:s,onUploadStart:function(t,i){"form"===Upload.types[t]&&show(e.progress),"form"!==Upload.types[t]&&"fileApi"!==Upload.types[t]||(geByClass1("file",ge("audio_add_upload_btn")).disabled=!0),curBox().changed=!0},onUploadProgress:function(e,t,i){if(!ge("form"+e+"_progress")){for(var a=Upload.obj[e],o=getSize(a)[1]/2+10,s=a.firstChild;s;)1===s.nodeType&&(s.id==="uploader"+e&&browser.msie?setStyle(s,{position:"relative",left:"-5000px"}):setStyle(s,{visibility:"hidden"})),s=s.nextSibling;a.appendChild(ce("div",{innerHTML:'<div class="audio_progress_wrap"><div id="form'+e+'_progress" class="audio_progress" style="width: 0%;"></div></div></div>'},{height:o+"px",marginTop:-o+"px"}))}var r=intval(t/i*100);setStyle(ge("form"+e+"_progress"),{width:r+"%"})},onUploadComplete:function(e,t){var i;this.use_go_uploader||(t=t.replace(/\+/g," "));try{i=JSON.parse(t)}catch(e){i=AjaxConvert.fromQueryString(t)}var a={};this.use_go_uploader?a={act:"done_add",upldr:1,go_uploader_response:t}:(i.title=decodeURIComponent(i.title),i.artist=decodeURIComponent(i.artist),a=X({},i,{},{act:"done_add",upldr:1})),i.code?cur.loadAudioFailed(e,i.code):ajax.post("al_audio.php",a,{onDone:function(t){cur.loadAudioDone(e,t)},onFail:function(t){return cur.loadAudioFailed(e,t),!0}})},onUploadCompleteAll:function(e,t){cur.boxClose=!0},onUploadError:cur.loadAudioFailed,clear:1,multiple:1,force_max_files:!0,max_files:r,max_files_hide_last:1,type:"audio",max_attempts:3,reverse_files:1,server:l,error:n,error_hash:d,dropbox:"choose_audio_dropbox",use_go_uploader:u}),e.setControlsText(_)},_showPlaylistsChooser:function(e,t,i,a,o,r){var d=i.playlists,_=i.newPlaylistHash,u=i.morePlaylists;AudioUtils.copiedToPlaylistAudios=AudioUtils.copiedToPlaylistAudios||{},AudioUtils.copiedToPlaylistAudiosHashes=AudioUtils.copiedToPlaylistAudiosHashes||{};var c=t,h=Object(s.rb)(Object(s.qb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,getLang("audio_add_to_new_pl"),"audio_row__action_playlist"]));if(domInsertAfter(h,c),c=h,h.addEventListener("click",()=>{AudioUtils.editPlaylist(a,!1,"edit",{addAudio:r,newPlaylistHash:_})}),each(d,(e,t)=>{var i=!0,a=t[0]+"_"+t[1]+"_"+o.fullId,r=AudioUtils.copiedToPlaylistAudios[a],d="audio_row__action_playlist";(t[3]||r)&&(i=!1,d+=" audio_row__more_playlist_added");var _=Object(s.rb)(Object(s.qb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+t[0]+"_"+t[1],0,t[2],d]));domInsertAfter(_,c),c=_;var u=!1;_.addEventListener("click",()=>{if(!u){u=!0;var e=o.ownerId,r=o.id,d=AudioUtils.copiedToPlaylistAudios[a];d&&(e=(d=d.split("_"))[0],r=d[1]),i&&(AudioUtils.copiedToPlaylistAudiosHashes[a]=t[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:t[4],playlist_id:t[1],playlist_owner_id:t[0],audio_owner_id:e,audio_id:r,do_add:intval(i)},{onDone:(e,s,r)=>{Object(n.a)(_,o,{type:i?l.e:l.h,playlistId:t[0]+"_"+t[1]}),AudioUtils.copiedToPlaylistAudios[a]=!!i&&r,t[4]=i?e:AudioUtils.copiedToPlaylistAudiosHashes[a],i=!i,u=!1},onFail:()=>!0}),Object(s.zb)(_,"audio_row__more_playlist_added",i)}})}),u){var p=Object(s.rb)(Object(s.qb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,getLang("audio_row_show_all_playlists"),"audio_row__action_playlist"]));p.addEventListener("click",()=>{showBox("al_audio.php?act=more_playlists_add",{owner_id:a,audio_owner_id:o.ownerId,audio_id:o.id},{params:{bodyStyle:"padding: 0px",width:560}})}),domInsertAfter(p,c),c=p}e.updatePosition()},debugLog:function(){}})},tWcy:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var a=i("uk5P");function o(e){return e[a.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[a.a.AUDIO_ITEM_INDEX_ID]}},wtP8:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var a=i("zxIV");function o(e,t,i){var o=e+"_"+t,s=window.showBox("al_audio.php",{act:"add_to_groups_box",playlist_id:o,access_hash:i}).setButtons(getLang("Save"),()=>{var e=[];for(var t in cur.wdd.follow_playlist_wwd.selected)e.push(cur.wdd.follow_playlist_wwd.selected[t][0]);e.length&&(Object(a.J)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:e,hash:Object(a.J)("add_playlist_to_group_hash").value,playlist_id:o},{onDone(e){s.hide(),showDoneBox(e)},onFail:e=>(Object(a.J)("add_playlist_to_group_fail").innerHTML=e,!0)}))})}}}]);try{stManager.done("dist/bundles/audioplayer.9876ecffc0617fed460d.js")}catch(e){}