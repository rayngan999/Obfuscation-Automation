(self.webpackChunkweb_shell=self.webpackChunkweb_shell||[]).push([[5413],{5413:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>H});var r=n(3003),i=n(4321),o=n(8912),a=n(6859),s=n(2676);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e){if(!s.Z.isImplementedBy(e))throw new Error("Dispatcher: Invalid actionType. Action type should be an instance of ActionType class")}function p(e){if(!e)return[];if(Array.isArray(e))return e;if("function"==typeof e.getAllTypes)return e.getAllTypes();const t=[];return Object.keys(e).forEach((n=>{if(s.Z.isImplementedBy(e[n])){const r=e[n];t.push(r)}})),t}let u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._actionsTypes=t.supportedActionTypes,this._extendedActionsTypes=t.supportedExtendedActionTypes,this._supportedActionTypesMap=function(e,t){const n={};function r(e,t){l(e),t&&function(e){const{category:t}=e;if(!t.endsWith("-extended"))throw new Error("Dispatcher: Invalid category for extended action type. Category names for extended types should end with '-extended'")}(e);const r=e.name;if(n[r])throw new Error("Dispatcher: Duplicate action type name: ".concat(r));n[r]={actionType:e,isExtended:t}}return e.forEach((e=>{r(e,!1)})),t.forEach((e=>{r(e,!0)})),n}(p(this._actionsTypes),p(this._extendedActionsTypes)),this._registry={},this._logger=o.Z.getLogger()}var t,n;return t=e,(n=[{key:"register",value:function(e,t){if(!e||!t)throw new Error("Dispatcher.register: The ActionType and AppDelegate should be provided");if(!s.Z.isImplementedBy(e))throw new Error("Dispatcher.register: The parameter actionType should be of type ActionType");const n=e.name;if(!this.isSupportedActionType(e))throw new Error("Dispatcher.register: Unrecognized actionType: ".concat(n));if(!a.Z.isImplementedBy(t))throw new Error("Dispatcher.register: Invalid AppDelegate provided. AppDelegate should extend from BaseAppDelegate");this._registerDelegateForActionType(e,t)}},{key:"isSupportedActionType",value:function(e){l(e);const{name:t}=e;return!!this._supportedActionTypesMap[t]}},{key:"getSupportedActionTypeByName",value:function(e){const t=this._supportedActionTypesMap[e];return t?t.actionType:null}},{key:"canDispatchForActionType",value:function(e){return l(e),this._hasRegisteredDelegates(e)}},{key:"dispatch",value:function(e){return Promise.resolve().then((()=>{const t=e.type;if(!t)throw new Error("Dispatcher.dispatch: Cannot dispatch an action without a type");if(!s.Z.isImplementedBy(t))throw new Error("Dispatcher.dispatch: Invalid type for action. Type should be of type ActionType");const n=t.name;if(!this.isSupportedActionType(t))throw new Error("Dispatcher.dispatch: Unrecognized actionType: ".concat(n));if(!this._hasRegisteredDelegates(t))throw new Error("Dispatcher.dispatch: No registered handlers found for the action type: ".concat(n));return this._dispatchAction(t,e)})).catch((e=>{throw this._logger.error(e.message),e}))}},{key:"_registerDelegateForActionType",value:function(e,t){const n=e.name;let r=this._registry[n];if(r){if(-1!==r.indexOf(t))throw new Error("Dispatcher.register: The AppDelegate is already registered to handle the actionType : ".concat(e.name));this._canRegisterMultipleDelegatesForActionType(e)||this._logger.log("Dispatcher.register: Overriding previous handler for the actionType: ".concat(e.name))}else r=[],this._registry[n]=r;r.unshift(t)}},{key:"_canRegisterMultipleDelegatesForActionType",value:function(e){return!(!1===e.allowMultipleHandlers&&!1===e.allowConditionalHandling)}},{key:"_hasRegisteredDelegates",value:function(e){const t=e.name,n=this._registry[t];return!!(n&&n.length>0)}},{key:"_createDispatchableAction",value:function(e,t){const n={};return n.typeName=e.name,n.category=e.category,n.command=e.command,n.payload=t.payload,n.context=t.context,n}},{key:"_dispatchAction",value:function(e,t){const n=e.name,r=this._registry[n];let i;return t=this._createDispatchableAction(e,t),Promise.resolve().then((()=>(i=!0===e.allowConditionalHandling?!1===e.allowMultipleHandlers?this._dispatchSingleConditional(r,t):this._dispatchMultipleConditional(r,t):!1===e.allowMultipleHandlers?this._dispatchSingleNonConditional(r,t):this._dispatchMultipleNonConditional(r,t),i))).then((t=>{if("CommandForResponseActionType"===e._type)return t})).catch((e=>{const t=e&&e.message?" Details: ".concat(e.message):"";throw new Error("Dispatcher.dispatch: An error occurred trying to dispatch action with type ".concat(n,".").concat(t))}))}},{key:"_getFirstHandler",value:function(e,t,n){if(n>=e.length)return null;const r=e[n];return Promise.resolve(r.canHandleAction(t)).then((i=>!0===i?r:this._getFirstHandler(e,t,++n))).catch((r=>(console.log(r.message),this._getFirstHandler(e,t,++n))))}},{key:"_dispatchMultipleConditional",value:function(e,t){const n=[];return e.forEach((e=>{n.push(this._dispatchConditional(e,t))})),Promise.all(n)}},{key:"_dispatchSingleConditional",value:function(e,t){return this._getFirstHandler(e,t,0).then((e=>e?e.handleAction(t):Promise.reject(new Error("Cannot find an AppDelegate that can handle the action"))))}},{key:"_dispatchMultipleNonConditional",value:function(e,t){const n=[];return e.forEach((e=>{n.push(e.handleAction(t))})),Promise.all(n)}},{key:"_dispatchSingleNonConditional",value:function(e,t){const n=e[0];if(n)return n.handleAction(t)}},{key:"_dispatchConditional",value:function(e,t){return Promise.resolve(e.canHandleAction(t)).then((n=>{if(n)return e.handleAction(t)}))}}])&&c(t.prototype,n),e}();function h(e){const t={message:e.message,level:e.level,levelName:o.Z.levelNames[e.level],props:e.props};return e.exception&&(t.exception=e.exception),e.options&&(t.options=e.options),t}function d(e){const{dispatcher:t}=e;return{dispatchLog:(e,r)=>function(e,r){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:i}=n;const o={type:i.LOG_EVENT,payload:h(r),context:e};return t.dispatch(o)}))}(e,r)}}const f="error",y="loadError",g="networkRequestError";function E(e){const{dispatcher:t}=e;function r(e,r){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:i}=n;const o={type:i.WEB_SHELL_EVENT,payload:{name:e},context:{}};return function(e){return e===y||e===f||e===g}(e)?o.payload.error=r||{}:o.payload.data=r||{},t.dispatch(o)}))}return{emitLoaded:e=>r("loaded",e),emitLoadError:e=>{if(!e)throw new Error("An error object is required to dispatch WEB_SHELL_EVENT for loadError");return r(y,e)},emitError:e=>{if(!e)throw new Error("An error object is required to dispatch WEB_SHELL_EVENT for error");return r(f,e)},emitSessionExpired:()=>r("sessionExpired"),emitNetworkRequestError:e=>{if(!e)throw new Error("An error object is required to dispatch WEB_SHELL_EVENT for networkRequestError");return r(g,e)}}}function w(e){const{dispatcher:t}=e;return{dispatchNavigate:e=>function(e){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:r}=n;const i={type:r.NAVIGATE,payload:{url:e}};return t.dispatch(i)}))}(e)}}const _="error";function m(e){const{dispatcher:t}=e,r=e.applicationContext.getCorePlugin("widgetManager");function i(e,i,o){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:a}=n;return async function(e){return r.then((t=>{const n=e.pluginId||t.getWidgetContributor(e.widgetId,{version:e.widgetVersion});return{widgetId:e.widgetId,widgetVersion:e.widgetVersion,pluginId:n}}))}(i).then((n=>{const r={type:a.WIDGET_EVENT,payload:{name:e},context:n};return e===_?r.payload.error=o||{}:r.payload.data=o||{},t.dispatch(r)}))}))}function o(e){if(!e)throw new Error("widgetContext is required for WIDGET_EVENT action");if(!e.widgetId||!e.widgetVersion)throw new Error("Invalid context object for a widget: ".concat(e))}return{emitWaitStart:(e,t)=>(o(e),i("waitStart",e,t)),emitWaitFinish:(e,t)=>(o(e),i("waitFinish",e,t)),emitError(e,t){if(o(e),!t)throw new Error("An error object is required to dispatch WIDGET_EVENT for error");return i(_,e,t)},emitDone:(e,t)=>(o(e),i("done",e,t)),emitCancel:(e,t)=>(o(e),i("cancel",e,t))}}function v(e){const{dispatcher:t}=e;return{dispatchDisplayShellElements:(e,r)=>function(e,r){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:i}=n;const o={type:i.DISPLAY_SHELL_ELEMENTS,payload:{data:r},context:e};return t.dispatch(o)}))}(e,r)}}function b(e){const{dispatcher:t}=e;return{dispatchShowHelpTopic:(e,r)=>function(e,r){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:i}=n;const o={type:i.SHOW_HELP_TOPIC,payload:{data:r},context:e};return t.dispatch(o)}))}(e,r)}}function A(e){return{profileType:e.type,profile:e.profile,options:e.options}}function T(e){const{dispatcher:t}=e;return{dispatchRecord:(e,r)=>function(e,r){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:i}=n;const o={type:i.PERF_EVENT,payload:A(r),context:e};return t.dispatch(o)}))}(e,r)}}function D(e){return{event:e.message,data:e.data}}function C(e){const{dispatcher:t}=e;return{dispatchPublish:(e,r)=>function(e,r){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:i}=n;const o={type:i.PUB_SUB_EVENT,payload:D(r),context:e};return t.dispatch(o)}))}(e,r)}}function x(e){return{businessUnit:e.businessUnit,entityId:e.entityId,context:e.context,assignmentFilter:e.assignmentFilter,assignmentOptions:e.assignmentOptions,environment:e.environment}}function k(e){const{dispatcher:t}=e;return{dispatchExperimentRequestWithContext:(e,r)=>function(e,r){return Promise.resolve().then(n.bind(n,4321)).then((n=>{let{default:i}=n;const o={type:i.EXPERIMENT_REQUEST_WITH_CONTEXT,payload:x(r),context:e};return t.dispatch(o)}))}(e,r)}}var P=n(2093),S=n(2768);function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}let H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(s,e);var t,n,r,o,a=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(r);if(o){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return L(this,e)});function s(){var e;I(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=a.call(this,...n))._activeDelegates=[],e._actionCreators=[];const o=e._applicationCtx.config.extendedActionTypes||null;return e._dispatcher=new u({supportedActionTypes:i.default,supportedExtendedActionTypes:o}),e}return t=s,(n=[{key:"getActiveDelegates",value:function(){return this._activeDelegates}},{key:"getDispatcher",value:function(){return this._dispatcher}},{key:"getActionCreators",value:function(){return this._actionCreators}},{key:"onBeforeApplicationReady",value:function(){return this._initializeActionCreators(),this._initializeEventListeners(),this._initializeAppDelegates()}},{key:"_initializeEventListeners",value:function(){const e=this._applicationCtx.channel;e.get("app-ready-completed").subscribe((e=>{const{webShellEvents:t}=this._actionCreators;t&&((()=>{if("undefined"==typeof window)return!1;const e=window.location.href,t=S.Z.queryToObject(e.substring(e.indexOf("?")+1,e.length));return Boolean(window.MobileShell||t&&"true"===t._embeddedMobile)})()&&(e.pluginsConfig=this.config&&this.config.pluginsConfig||null),t.emitLoaded(e))})),e.get("app-start-failed").subscribe((e=>{const{webShellEvents:t}=this._actionCreators;t&&t.emitLoadError(e.error||null)}))}},{key:"_initializeActionCreators",value:function(){var e;this._actionCreators={logEvents:d(e={dispatcher:this.getDispatcher(),applicationContext:this._applicationCtx}),performanceEvents:T(e),webShellEvents:E(e),navigateAction:w(e),widgetEvents:m(e),uiActions:v(e),helpActions:b(e),pubsubEvents:C(e),experimentEvents:k(e)}}},{key:"_initializeAppDelegates",value:function(){const{appDelegates:e}=this._applicationCtx.config;let t=Promise.resolve();return e&&0!==e.length?(e.forEach((e=>{t=t.then((()=>{return t=e,Promise.resolve().then((()=>{if(!t)throw new Error('Expected class or promise got "'.concat(typeof t,'"'));return"function"!=typeof t||(0,P.Z)(t)?t:Function.prototype.toString.call(t).match(/import\(\)|\.then\(/)?t().then((e=>{let{default:t}=e;return t})):t}));var t})).then((e=>{const t=function(e){let t,n,r;if("function"==typeof e?n=e:"object"==typeof e&&(n=e.appDelegateClass,t=e.config),!n)throw r="Error parsing AppDelgate entry, Each entry should be a constructor function or an object with 'appDelegateClass' property which is a constructor function",new Error("Error parsing AppDelgate entry, Each entry should be a constructor function or an object with 'appDelegateClass' property which is a constructor function");return{appDelegateClass:n,appDelegateConfig:t||null}}(e);return this._initializeAppDelegate(t)}))})),t):t}},{key:"_initializeAppDelegate",value:function(e){const t=new e.appDelegateClass({dispatcher:this._dispatcher,applicationContext:this._applicationCtx,appDelegateConfig:e.appDelegateConfig});return Promise.resolve(t.onBeforeReady()).then((()=>{this._activeDelegates.push(t)}))}}])&&N(t.prototype,n),s}(r.Z)}}]);
//# sourceMappingURL=5413.js.map