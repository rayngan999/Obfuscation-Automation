(this.msPlayerJsonp=this.msPlayerJsonp||[]).push([[51],{157:function(t,i,e){"use strict";e.d(i,"a",function(){return a});var i=e(0),n=e.n(i),i=e(73),s=(e.n(i),e(159));function a(t){var i=this;return"string"==typeof t?s.a[t]:t.map(function(t){return n()(this,i),s.a[t]}.bind(this))}},176:function(t,i,e){"use strict";var n=e(7),s=e(55),d=e(15),_=e(86),h=e(19),u=[].slice;n(n.P+n.F*e(9)(function(){s&&u.call(s)}),"Array",{slice:function(t,i){var e=h(this.length),n=d(this);if(i=void 0===i?e:i,"Array"==n)return u.call(this,t,i);for(var s=_(t,e),e=_(i,e),a=h(e-s),o=new Array(a),r=0;r<a;r++)o[r]="String"==n?this.charAt(s+r):this[s+r];return o}})},283:function(t,i,e){"use strict";var n=e(8),s=e.n(n),n=e(0),a=e.n(n),n=e(146),o=e.n(n),n=e(2),r=e.n(n),n=e(45),n=(e.n(n),e(77)),n=(e.n(n),e(144)),n=e.n(n),d=e(154),n=function(e){function t(t){var i=e.call(this,t)||this;return i.state={_shouldRestart:!1,_options:Object.assign({},t)},i}o()(t,e),t.getDerivedStateFromProps=function(i,e){var n=this,t=Object.keys(i),s=Object.keys(e._options);return t.length!==s.length||t.some(function(t){return a()(this,n),i[t]!==e._options[t]}.bind(this))?{_options:Object.assign({},e._options,i),_shouldRestart:!0}:null};var i,n=t.prototype;return n.restart=function(){console.log("Must implement")},n.componentDidUpdate=(i=s()(r.a.mark(function t(){var i=this;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state._shouldRestart)return t.next=3,this.restart();t.next=4;break;case 3:setTimeout(function(){a()(this,i),this.setState({_shouldRestart:!1})}.bind(this));case 4:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)}),n.componentWillUnmount=function(){this.restart(!0)},n.render=function(){return null},t}(n.a.PureComponent);n.wrap=function(i,t){var e=this;return a()(this,void 0),Object(d.d)(function(t){return a()(this,e),Object.assign({setData:t.setData},i(t))}.bind(this))(t)}.bind(void 0),i.a=n},702:function(t,i,e){"use strict";e.r(i);var n,s=e(0),_=e.n(s),a=e(146),o=e.n(a),s=e(283),r=e(159),d=e(157),a=e(8),h=e.n(a),a=(e(45),e(176),e(47),e(74),e(76),e(77),e(2)),u=e.n(a),c=e(13),p=e(367),l=e(25),f=e(152);function g(t){var d=this;void 0===t&&(t=c.l),this._startTracking=function(){_()(this,d);var t=this._api,i=this._isTracking;t&&(i||(this._isTracking=!0,t.on(c.b._buffering,this._onBuffering),t.on(c.b._seeking,this._onSeeking),t.on(c.b._seeked,this._onSeeked),t.on(c.b._ended,this._onEnded),t.on(c.b._ready,this._trackAborted),t.on(c.b._emptied,this._trackAborted),t.on(c.b._timeupdate,this._onTimeupdate),t.on(c.b._adsTimeUpdate,this._onAdsTimeUpdate),t.on(c.b._adsDurationChange,this._onAdsDurationChange),t.on(c.b._adsRequested,this._onAdsRequested),t.on(c.b._adsStarted,this._onAdsStarted),t.on(c.b._adsContentPauseRequested,this._onAdsContentPauseRequested),t.on(c.b._adsContentResumeRequested,this._onAdsContentResumeRequested),t.on(c.b._adsViewableImpression,this._onAdsViewableImpression),t.on(c.b._error,this._onError)),t.off(c.b._pause,this._pauseTracking),t.once(c.b._pause,this._pauseTracking),this._createPing())}.bind(this),this._pauseTracking=h()(u.a.mark(function t(){var i,e,n;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=d._api,e=d._lastUpdateTime,n=d._duration,i)return i.off(c.b._play,d._startTracking),i.once(c.b._play,d._startTracking),d._adsPlaying?d._onAdPlaying():d._onPlaying(),d._addPing("pause",{data:d._getTrackInternalData({position:parseInt(1e3*e),duration:n?parseInt(1e3*n):null})}),t.next=8,d._doPost(null,!1);t.next=8;break;case 8:case"end":return t.stop()}},t)})),this._onSeeking=function(){_()(this,d);var t=this._api.currentTime;this._lastUpdateTime!==t&&(this._bufferingStart&&this._setBufferingPing(),this._onPlaying(),this._seekFromPosition=parseInt(1e3*this._lastUpdateTime),this._lastUpdateTime=this._oldPosition=t)}.bind(this),this._onSeeked=function(){_()(this,d),null!==this._seekFromPosition&&this._seekFromPosition!==parseInt(1e3*this._oldPosition)&&this._addPing("seek",{data:this._getTrackInternalData({position:parseInt(1e3*this._oldPosition),from_position:this._seekFromPosition})}),this._seekFromPosition=null}.bind(this),this._onBuffering=function(){var t=this;_()(this,d);var i=this._api;i.paused||this._bufferingStart||(this._bufferingStart=(new Date).valueOf(),i.once(c.b._canplay,function(){_()(this,t),this._setBufferingPing(),this._bufferingStart=null}.bind(this)))}.bind(this),this._onEnded=function(){_()(this,d),this._onPlaying(),this._doPost([Object.assign({name:"content_end",data:this._getTrackInternalData({position:parseInt(1e3*this._lastUpdateTime)})},this._getTrackData())])}.bind(this),this._onPlay=function(){_()(this,d),null!==this._seekFromPosition&&this._onSeeked();var t=this._api.currentTime,i=this._lastUpdateTime,i=void 0===i?t:i;this._addPing("play",{data:this._getTrackInternalData({position:parseInt(1e3*i)})}),this._lastUpdateTime=this._oldPosition=i}.bind(this),this._onPlaying=function(){var t;_()(this,d),!this._lastUpdateTime||(t=this._relativeStreamedSeconds(this._lastUpdateTime,!0))&&this._addPing("playing",{data:this._getTrackInternalData({position:parseInt(1e3*this._lastUpdateTime),duration:this._duration?parseInt(1e3*this._duration):null,relative_streamed_time:t})})}.bind(this),this._trackAborted=function(){_()(this,d),this._shouldFakeSeek=!0}.bind(this),this._onAdPlaying=function(){_()(this,d),this._addPing("ad_playing",{data:this._getTrackInternalData({position:parseInt(1e3*this._lastAdsUpdateTime),duration:parseInt(1e3*this._adsDuration),relative_streamed_time:this._relativeStreamedAdSeconds(this._lastAdsUpdateTime,!0)})})}.bind(this),this._onAdsDurationChange=function(t){_()(this,d),this._adsDuration=t}.bind(this),this._onAdsRequested=function(){_()(this,d),this._addPing("ad_requested",{data:this._getTrackInternalData({position:parseInt(1e3*this._lastUpdateTime)})})}.bind(this),this._onAdsContentPauseRequested=function(){_()(this,d),this._adsPlaying=!0,this._addPing("ad_content_resquest",{data:this._getTrackInternalData({position:parseInt(1e3*this._lastUpdateTime)})})}.bind(this),this._onAdsContentResumeRequested=function(){_()(this,d),this._adsPlaying=!1}.bind(this),this._onAdsViewableImpression=function(){_()(this,d),this._addPing("ad_impression",{data:this._getTrackInternalData({position:parseInt(1e3*this._lastUpdateTime)})})}.bind(this),this._onAdsStarted=function(){_()(this,d),this._oldAdPosition=0,this._lastAdsUpdateTime=0,this._addPing("ad_start",{data:this._getTrackInternalData({position:parseInt(1e3*this._lastUpdateTime)})})}.bind(this),this._onTimeupdate=h()(u.a.mark(function t(){var i;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(document.hidden){t.next=6;break}if(d._api.paused){t.next=4;break}return t.next=4,d._defer();case 4:1<d._api.currentTime-d._lastUpdateTime&&(d._shouldFakeSeek=!0);case 6:d._fakeSeek(),i=d._api.currentTime,d._lastUpdateTime=i,d._duration=d._config._duration||("live"!==d._config._type?d._api.duration:0);case 10:case"end":return t.stop()}},t)})),this._onAdsTimeUpdate=function(t){_()(this,d),this._lastAdsUpdateTime=t}.bind(this),this._onFirstPlaying=function(){_()(this,d),this._firstPlaying=!0,this._startTracking()}.bind(this),this._onPlayerLoaded=function(){_()(this,d),this._startTracking(),this._firstPlayTime=new Date,this._doPost([Object.assign({name:"player_loaded",data:this._getTrackInternalData({player_loading_time:(new Date).valueOf()-this._playerOpenTime.valueOf()})},this._getTrackData())])}.bind(this),this._onError=function(t){_()(this,d),this._addPing("error",{data:this._getTrackInternalData({type:t.type||c.a._default,detail:t.message,fatal:!!t.fatal})}),t.fatal&&this._doPost(null,!1)}.bind(this),this._addPing=function(t,i){var e;_()(this,d),i&&((e=this._pings.slice(-1)[0])&&e.name===t&&e.data.position===i.data.position&&"buffering"===t&&e.data.buffering_time+i.data.buffering_time<=1e4?(e.data.buffering_time+=i.data.buffering_time,e.date=i.date||this._getNowDate(),e.data.timestamp=i.data.timestamp):this._pings.push(Object.assign({name:t},i,this._getTrackData())))}.bind(this),this._defer=function(){var i=this;return _()(this,d),new Promise(function(t){_()(this,i),setTimeout(t,0)}.bind(this))}.bind(this),this._doPost=function(a,o){var r=this;return void 0===o&&(o=!0),new Promise(function(t){var i=this;_()(this,r),clearTimeout(d._pingTimeout),d._pingTimeout=null;var e=function(){_()(this,i),t(),o&&d._createPing()}.bind(this);d._bufferingStart&&d._setBufferingPing();var n=[].concat(d._pings.splice(0,d._pings.length),a||[]);if(n.length<=0)return e();var s=Object(p.stringify)({data:n});Object(l.b)(d._pingUrl,{body:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e).catch(function(t){_()(this,i),t&&console.log("StreamMetrics > Tracker: Could not track: "+t.message),d._pings=[].concat(n,d._pings),e()}.bind(this))}.bind(this))},this._sendBeacon=function(){var t;return _()(this,d),(navigator||{}).sendBeacon&&(this._onPlaying(),this._pings.length&&(t=Object(p.stringify)({data:this._pings.splice(0,this._pings.length)}),t=new Blob([t],{type:"application/x-www-form-urlencoded"}),navigator.sendBeacon(this._pingUrl,t))),!0}.bind(this),this._pingUrl=t,this._playerOpenTime=new Date,this._pings=[],this._oldPosition=0,this._rss=0,this._lastUpdateTime=0,this._lastAdsUpdateTime=0,this._duration=0,this._oldAdPosition=0,this._rssAd=0,this._config={},this._adsDuration=0,this._adsPlaying=!1,this._pingInterval=1e4,window.addEventListener("unload",this._sendBeacon,!1)}var b=((a=g.prototype).start=function(t){if(void 0===t&&(t={}),this._playerOpenTime=new Date,this._stopTracking(),this._config=this._loadConfig(t),this._pingInterval=this._config._ping||1e4,!this._hasRightData())throw new Error("Invalid StreamMetrics data");t=this._config._api;(this._api=t).once(c.b._ready,this._onPlayerLoaded),t.once(c.b._playing,this._onFirstPlaying),t.on(c.b._play,this._onPlay)},a.stop=function(){return this._stopTracking()},a._loadConfig=function(t){return{_account:t.account,_playId:t.playId,_sessionId:t.sessionId,_uniqueId:t.uniqueId,_id:t.id,_type:t.type,_api:t.api,_duration:t.duration,_ping:t.ping}},a._hasRightData=function(){var t=this._config,i=t._account,e=t._playId,n=t._sessionId,s=t._id,a=t._type,t=t._api;return s&&e&&n&&i&&t&&~["media","live"].indexOf(a)},a._stopTracking=(n=h()(u.a.mark(function t(){var i;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this._api)return this._onPlaying(),i.off(c.b._ready,this._onPlayerLoaded),i.off(c.b._play,this._onPlay),i.off(c.b._playing,this._onFirstPlaying),i.off(c.b._buffering,this._onBuffering),i.off(c.b._adsRequested,this._onAdsRequested),i.off(c.b._adsStarted,this._onAdsStarted),i.off(c.b._adsContentPauseRequested,this._onAdsContentPauseRequested),i.off(c.b._adsContentResumeRequested,this._onAdsContentResumeRequested),i.off(c.b._adsViewableImpression,this._onAdsViewableImpression),i.off(c.b._adsTimeUpdate,this._onAdsTimeUpdate),i.off(c.b._adsDurationChange,this._onAdsDurationChange),i.off(c.b._seeking,this._onSeeking),i.off(c.b._seeked,this._onSeeked),i.off(c.b._ended,this._onEnded),i.off(c.b._ready,this._trackAborted),i.off(c.b._emptied,this._trackAborted),i.off(c.b._timeupdate,this._onTimeupdate),i.off(c.b._play,this._startTracking),i.off(c.b._pause,this._pauseTracking),i.off(c.b._error,this._onError),t.next=25,this._doPost();t.next=25;break;case 25:this._oldPosition=0,clearTimeout(this._pingTimeout),this._lastUpdateTime=0,this._lastAdsUpdateTime=0,this._adsDuration=0,this._duration=0,this._pingTimeout=null,this._firstPlayTime=null,this._params={},this._firstPlaying=!1,this._isTracking=!1,this._bufferingStart=null,this._seekFromPosition=null,this._rss=0,this._rssAd=0,this._adsPlaying=!1,this._shouldFakeSeek=!1;case 42:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)}),a._createPing=function(){var i=this;this._pingTimeout||(this._pingTimeout=setTimeout(h()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i._adsPlaying||i._api.paused?i._adsPlaying&&i._onAdPlaying():i._onPlaying(),t.next=3,i._doPost();case 3:case"end":return t.stop()}},t)})),this._pingInterval))},a._relativeStreamedAdSeconds=function(t,i){void 0===i&&(i=!1);var e=t-this._oldAdPosition;this._oldAdPosition=t;e=this._rssAd+e;return this._rssAd=i?this._rssAd-e:e,parseInt(1e3*e)},a._relativeStreamedSeconds=function(t,i){void 0===i&&(i=!1);var e=t-this._oldPosition,i=parseInt(1e3*e);return this._oldPosition=t-(1e3*e-i)/1e3,parseInt(i)},a._setBufferingPing=function(){var t,i;this._bufferingStart&&(t=this._lastUpdateTime,i=(new Date).valueOf(),this._addPing("buffering",{data:this._getTrackInternalData({position:parseInt(1e3*t),buffering_time:i-this._bufferingStart})}),this._bufferingStart=i)},a._fakeSeek=function(){var t=this._api.currentTime-this._oldPosition;(this._shouldFakeSeek||t<0)&&(this._shouldFakeSeek=!1,this._onSeeking(),this._onSeeked())},a._cleanUndefinedAndNull=function(e){var n=this;return void 0===e&&(e={}),Object.keys(e).reduce(function(t,i){return _()(this,n),~[void 0,null,NaN].indexOf(e[i])||(t[i]=e[i]),t}.bind(this),{})},a._getTrackData=function(){return this._cleanUndefinedAndNull(Object.assign({date:this._getNowDate(),account_id:this._config._account,content_id:this._config._id},this._params))},a._getTrackInternalData=function(t){void 0===t&&(t={});var i=this._api.videoHeight&&this._api.videoWidth?this._api.videoWidth+"x"+this._api.videoHeight:void 0,e=this._api.bandwidth||void 0;return this._cleanUndefinedAndNull(Object.assign({},{timestamp:this._getNowDate(),playback_id:this._config._playId,session_id:this._config._sessionId,unique_id:this._config._uniqueId,content_resolution:i,bandwidth:e},t))},a._pad=function(t,i){return("000"+t).substr(-(i=void 0===i?2:i))},a._getNowDate=function(){var t=new Date;return t.getUTCFullYear()+"-"+this._pad(t.getUTCMonth()+1)+"-"+this._pad(t.getUTCDate())+"T"+this._pad(t.getUTCHours())+":"+this._pad(t.getUTCMinutes())+":"+this._pad(t.getUTCSeconds())+"."+this._pad(t.getUTCMilliseconds(),3)+"Z"},a.wrap=function(e){var n=this;e.on=f.b.on.bind(f.b),e.once=f.b.once.bind(f.b),e.off=f.b.off.bind(f.b),e.emit=f.b.emit.bind(f.b);var t=function(t){var i=this;_()(this,n),e.addEventListener(t,function(){_()(this,i),f.b.emit(t===c.b._waiting?c.b._buffering:t)}.bind(this))}.bind(this);return t(c.b._canplay),t(c.b._waiting),t(c.b._ended),t(c.b._emptied),t(c.b._pause),t(c.b._play),t(c.b._playing),t(c.b._seeking),t(c.b._seeked),t(c.b._timeupdate),t(c.b._ready),t(c.b._error),e},g),a=e(145),e=e.n(a),a=function(i){function t(t){t=i.call(this,t)||this;return t._tracker=new b,t}o()(t,i);var e=t.prototype;return e._getType=function(){return{dvr:"live",episode:"media",vod:"media"}[this.state._options._type]||this.state._options._type},e.componentDidMount=function(){this.props.setData("streammetrics",this),Object(r.b)("streammetrics",this),this._startTracker()},e.restart=function(t){t?this._tracker.stop():this._startTracker()},e._startTracker=function(){try{var t=this.state._options,i=t._account,e=t._id,n=t._playId,s=t._sessionId,a=t._uniqueId,o=this.props._duration,r=this._getType();this._tracker.start({account:i,playId:n,sessionId:s,uniqueId:a,id:e,type:r,duration:o,api:Object(d.a)("api")})}catch(t){console.log("Could not start streammetrics tracker",t)}},t}(s.a);a.propTypes={setData:e.a.func};e=function(t){return _()(this,void 0),{_account:t.account,_playId:(t.metadata||{}).MDSTRMPID,_sessionId:(t.metadata||{}).MDSTRMSID,_uniqueId:(t.metadata||{}).MDSTRMUID,_type:t.type,_id:(t.metadata||{}).mediaId||t.id,_duration:t.duration}}.bind(void 0),i.default=s.a.wrap(e,a)}}]);