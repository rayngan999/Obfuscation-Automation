/*! fangcloud - v1.0.1 */
!function(a,b){"function"==typeof define&&define.cmd?define("lib/egeui/0.1.8/egeui",["jquery"],function(a,c,d){var e=a("jquery");d.exports=b(e)}):a.egeui=b(a.jQuery||a.$)}(this,function(a){function b(){return"widget-"+s++}function c(b){a(w.blurOverlays).each(function(c,d){if(d){if(!e(d.element))throw new Error("Overlay Error: an instance element is not existed, it should be destroyed.");if(d.delayHideBlur||!d.visible)return;for(var f=0;f<d._relativeElements.length;f++){var g=d._relativeElements[f];if(g===b.target||a.contains(g,b.target))return}d.hide()}})}function d(a,b){for(var c=0;c<b.length;c++)if(a===b[c])return b.splice(c,1),b}function e(b){return a.contains(document.documentElement,b)}function f(a,b,c,d){a+=A,d?p(d).on(a,b,c):p(b).on(a,c)}function g(b){a.each(b,function(c,d){if(o(d))b[c]={value:d};else if(a.isPlainObject(d))for(var e in d)d[e]&&(d[e]={value:d[e]})})}function h(a,b){return function(){a.apply(b,arguments)}}function i(b){if(J){var c=b.value;b.attachEvent("onpropertychange",function(d){if("value"===d.propertyName){var e=d.srcElement.value;e!==c&&(c=e,a(b).trigger("textchange"))}}),a(b).on("selectionchange keyup keydown",function(){b.value!==c&&(c=b.value,a(b).trigger("textchange"))})}else a(b).on("input",function(c){a(b).trigger("textchange")})}function j(a,b,c){var d=/(.*?)\{\{([\w\-]+)\}\}(.*?)/g;return a.replace(d,function(a,d,e,f){return d+(b[e]&&b[e].hlIndex?k(b[e].value,b[e].hlIndex):c[e])+f})}function k(a,b){if(!b)return a;var c=a.length;return a.substr(0,b[0])+"<b>"+a.substr(b[0],b[1])+"</b>"+a.substr(b[0]+b[1],c)}function l(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function m(a,b){return a=(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),b=(b||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),a===b}function n(a){return a.replace(/^([a-z])/,function(a,b){return b.toUpperCase()})}function o(a){return"[object String]"===Object.prototype.toString.call(a)}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){if(void 0===this||null===this)throw new TypeError('"this" is null or not defined');var c=this.length>>>0;for(b=+b||0,Math.abs(b)===1/0&&(b=0),b<0&&(b+=c,b<0&&(b=0));b<c;b++)if(this[b]===a)return b;return-1});var p=function(b){return b instanceof a?b:a(b)},q={};q.pin=function(b,c){if(b=p(b),!b[0])throw new Error("Position Error: pin element not specified");var d,e,f,g,h,i=c.collision||"flip",j=b.outerHeight(),k=b.outerWidth();if(c.top&&c.left)d=c.top,e=c.left,f=g=0;else{var l=p(c.elem);if(!l[0])throw new Error("Position Error: base element not specified");h=l.offset();var m=c.pos;if(f=l.outerHeight(),g=l.outerWidth(),m.indexOf("top")>-1&&(d=h.top-j),m.indexOf("bottom")>-1&&(d=h.top+f),"bottom"!==m&&"top"!==m||(e=h.left),m.indexOf("right")>-1&&(e=h.left+g),m.indexOf("left")>-1&&(e=h.left-k),"right"!==m&&"left"!==m||(d=h.top),c.offset){var n=c.offset.split(" ");n[0].indexOf("%")>-1?d-=parseInt(n[0].slice(0,-1),10)/100*j-f/2:d+=parseInt(n[0],10),n.length>1&&(n[1].indexOf("%")>-1?e-=parseInt(n[1].slice(0,-1),10)/100*k-g/2:e+=parseInt(n[1],10))}}if("none"!==i){var o=a(document).scrollTop(),q=a(document).scrollLeft(),r=a(document).height(),s=a(document).width(),t=a(window).height(),u=a(window).width();d<o?(!h||h.top>o)&&("fit"===i?d=o:"flip"===i&&(d=d+j+f,d+j>r&&(d=r-j))):d+j-o>t&&("fit"===i?d=t+o-j:"flip"===i&&(d=d-j-f+1,d<0&&(d=0))),e<q?(!h||h.left>q)&&("fit"===i?e=q:"flip"===i&&(e=e+k+g,e+k>s&&(e=s-k))):e+k-q>u&&("fit"===i?e=u+q-k:"flip"===i&&(e=e-k-g,e<0&&(e=0)))}var v=b.offsetParent().offset();e-=v.left,d-=v.top,b.css({top:d,left:e})},q.center=function(b,c){if(b=p(b[0]),!b)throw new Error("Position Error: pin element not specified");c=p(c||window);var d=parseInt((c.width()-b.outerWidth())/2,10),e=c.height()-b.outerHeight();e=(e<0?0:parseInt(e/2,10))+a(document).scrollTop(),b.css({top:e,left:d})};var r=/^(\S+)\s*(.*)$/,s=0,t={};a(window).unload(function(){try{for(var a in t)t[a].destroy()}catch(a){}});var u=function(){};u.prototype={on:function(b,c,d){var e=b.split(/\s+/),f=this;return a.each(e,function(a,b){var e=f._getEvents(b,"on");e.push([c,d||f])}),this},before:function(a,b,c){var d=this._getEvents(a,"before");return d.push([b,c||this]),this},after:function(a,b,c){var d=this._getEvents(a,"after");return d.push([b,c||this]),this},trigger:function(b){var c="on",d=Array.prototype.slice.call(arguments,1);if("before"!==b&&"after"!==b||(c=b,b=arguments[1],d=Array.prototype.slice.call(arguments,2)),this._widgetEvents&&this._widgetEvents[c]&&this._widgetEvents[c][b])for(var e=this._widgetEvents[c][b],f=0;f<e.length;f++)a.isFunction(e[f][0])?e[f][0].apply(e[f][1],d):o(e[f][0])&&this[e[f][0]].apply(e[f][1],d)},_getEvents:function(a,b){this._widgetEvents=this._widgetEvents||{};var c=this._widgetEvents[b]||(this._widgetEvents[b]={});return c[a]||(c[a]=[])}},u.extend=function(b,c){var d,e=this;d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return e.apply(this,arguments)},a.extend(d,e,c);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,b&&a.extend(d.prototype,b),d.superClass=e.prototype,d};var v=u.extend({constructor:function(a){this.options=a,this.setup()},rendered:!1,setup:function(){var c={parentNode:document.body},d=this.options=a.extend(c,this.options);if(this._isTemplate=!d.element,this.$element=p(this.$element||d.element||d.template),!this.$element[0])throw new Error("Overlay Error: element or template not specified");this.element=this.$element[0],d.id&&this.$element.attr("id",d.id),d.className&&this.$element.addClass(d.className),d.themeClass&&this.$element.addClass(d.themeClass),this.cid=b(),t[this.cid]=this},render:function(){return this.rendered||(this.rendered=!0),this.trigger("before","render"),e(this.element)||this.$element.appendTo(this.options.parentNode),this.trigger("after","render"),this._delegateEvents(),this},destroy:function(){this.trigger("before","destroy"),this.$element.off(".egeuiEvents"+this.cid),delete t[this.cid],this._isTemplate&&this.$element.remove(),this.trigger("after","destroy"),this._widgetEvents=null,this.events=null,this.$element=null},_delegateEvents:function(){var b=a.extend({},this.events,this.options.events);if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=c.match(r),e=d[1]+".egeuiEvents"+this.cid,f=d[2]||void 0;!function(b,c){var g=function(d){a.isFunction(b)?b.call(c,d):c[b](d)};f?"change"===d[1]?c.$element.find(f).on(e,g):c.$element.on(e,f,g):c.$element.on(e,g)}(b[c],this)}},$:function(a){return this.$element.find(a)}}),w=v.extend({setup:function(){var b={position:"absolute",top:0,left:0,zIndex:99,visible:!1},c=this.options=a.extend(b,this.options);w.superClass.setup.call(this),this.$element.css({position:c.position,"z-index":c.zIndex,top:c.top,left:c.left,display:"none"}),c.width&&this.$element.css("width",c.width),c.height&&this.$element.css("height",c.height),c.align&&(c.align.after=c.align.after||"render",this.after(c.align.after,this.align),delete c.align.after),c.visible&&this.show()},render:function(){return w.superClass.render.call(this),this.options.align&&w.alignOverlays.push(this),this.options.hideBlur&&this._hideBlur(p(this.options.trigger)),this},visible:!1,align:function(a){return a=a||this.options.align,a&&("center"===a.pos?q.center(this.$element,a.elem):q.pin(this.$element,a)),this},setPosition:function(a){return this.rendered||this.render(),q.pin(this.$element,a),this},show:function(){if(this.rendered||this.render(),"contextmenu"===this.options.hideBlur){this.delayHideBlur=!0;var a=this;setTimeout(function(){delete a.delayHideBlur},100)}return this.trigger("before","show"),this.$element.show(),this.trigger("after","show"),this.visible=!0,this},hide:function(){return this.trigger("before","hide"),this.$element.hide(),this.trigger("after","hide"),this.visible=!1,this},destroy:function(){w.superClass.destroy.call(this),d(this,w.blurOverlays),d(this,w.alignOverlays)},_hideBlur:function(b,c){b=a.makeArray(b),b.push(this.element),this._relativeElements=b,c||w.blurOverlays.push(this)}});w.alignOverlays=[];var x,y=a(window).width(),z=a(window).height();a(window).resize(function(){x&&clearTimeout(x),x=setTimeout(function(){var b=a(window).width(),c=a(window).height();y===b&&z===c||a(w.alignOverlays).each(function(a,b){if(b){if(!e(b.element))throw new Error("Overlay Error: an instance element is not existed, it should be destroyed.");b.align()}}),y=b,z=c,x=null},100)}),w.blurOverlays=[],a(document).on("click",function(a){c(a)});var A=".egeui-popup",B=w.extend({setup:function(){var b={triggerType:"hover",delay:200},c=this.options=a.extend(b,this.options);if(c.align&&!c.align.elem&&(c.align.elem=c.trigger),"click"===c.triggerType&&(c.hideBlur=!0),B.superClass.setup.call(this),this._bindTrigger(),c.delegateNode&&c.hideBlur){this.before("show",function(){this._hideBlur(p(c.trigger),!0)})}this.options.showAlign&&(this.options.align=this.options.showAlign,this.after("show",function(){this.options.showAlign.elem=this.activeTrigger,this.align(this.options.showAlign)}))},_bindTrigger:function(){var a=this.options.triggerType,b=this.options.trigger,c=this.options.delegateNode,d=this.options.delay,e=this;if("click"===a)f("click",b,function(){e.activeTrigger=this,e.show()},c);else if("focus"===a)f("focus",b,function(){e.activeTrigger=this,e.show()},c),f("blur",b,function(){setTimeout(function(){!e._downOnElement&&e.hide(),e._downOnElement=!1},d)},c),f("mousedown",this.element,function(a){e._downOnElement=!0});else{var g,h,i=function(a){clearTimeout(g),g=null,e.visible&&(h=setTimeout(function(){e.hide()},d))};f("mouseenter",b,function(){clearTimeout(h),h=null,e.activeTrigger=this,g=setTimeout(function(){e.show()},d)},c),f("mouseleave",b,i,c),f("mouseenter",this.$element,function(){clearTimeout(h)}),f("mouseleave",this.$element,i),f("mouseleave","select",function(a){a.stopPropagation()},this.$element)}this.before("destroy",function(){c?p(c).off(A,b):p(b).off(A),"click"!==a&&this.$element.off(A)})}}),C=B.extend({setup:function(){var b={zIndex:"2999",pos:"top",template:'<div class="egeui-tip"></div>'},c=this.options=a.extend(b,this.options);c.align||(c.align={pos:c.pos,offset:"top"===c.pos||"bottom"===c.pos?"0 50%":"50% 0",collision:"none"}),C.superClass.setup.call(this),c.delegateNode?(this.before("show",function(){this.setContent(p(this.activeTrigger))}).after("show",function(){this.options.align.elem=this.activeTrigger,this.align(this.options.align)}),c.width||this.$element.css("white-space","nowrap")):this.setContent(),this.$element.addClass("tip-"+c.pos)},setContent:function(a){a=a||p(this.options.trigger);var b=this.options.content;if(b||!a.attr("title")&&!a.attr("data-title")||(b=a.attr("title")||a.attr("data-title"),J?a.attr("title",""):a.removeAttr("title"),a.attr("data-title",b)),!b)throw new Error("Tip Error: content or title not specified.");this.$element.html(b)}}),D=w.extend({setup:function(){var b={width:"100%",height:"100%",position:"fixed",zIndex:499,opacity:.5,backgroundColor:"#000",template:'<div class="egeui-mask"></div>'},c=this.options=a.extend(b,this.options);D.superClass.setup.call(this),this.$element.css({"background-color":c.backgroundColor,opacity:c.opacity}).attr("tabIndex",0)}}),E=w.extend({_dialogTpl:'<div class="{{classPrefix}}"></div>',_closeTpl:'<div class="{{classPrefix}}-close" data-role="close"></div>',_titleTpl:'<div class="{{classPrefix}}-title" data-role="title"></div>',_contentTpl:'<div class="{{classPrefix}}-content" data-role="content"></div>',setup:function(){var b={align:{pos:"center"},classPrefix:"egeui-dialog",closeTpl:"x",title:"",zIndex:999+2*F,closeOnEscape:!0},c=this.options=a.extend(b,this.options);if(this.$element=a(this._parseTpl(this._dialogTpl)),c.closeTpl&&a(this._parseTpl(this._closeTpl)).appendTo(this.$element).append(c.closeTpl),c.title&&a(this._parseTpl(this._titleTpl)).appendTo(this.$element).append(c.title),!c.content)throw new Error("Dialog Error: content not specified");if(this.$contentElement=a(this._parseTpl(this._contentTpl)).append(c.content),this.$element.append(this.$contentElement),c.actions&&this.$element.append(c.actions),c.mask){var d=c.mask===!0?{zIndex:c.zIndex-1}:c.mask;this.mask=new D(d),this.before("show",function(){this.mask.show()}).after("hide",function(){this.mask.hide()}).after("destroy",function(){this.mask.destroy()})}if(c.closeOnEscape){this.$element.attr("tabIndex",-1);var e=[this.$element];c.mask&&e.push(this.mask.$element);var f=this;a.each(e,function(){this.keydown(function(a){27===a.which&&f.hide()})})}E.superClass.setup.call(this),this._isTemplate=!0,F++,this.after("show",function(){this.$element.focus()}).after("destroy",function(){F--})},events:{"click [data-role=close]":function(a){a.preventDefault(),this.hide()}},_parseTpl:function(a){return a.replace(/\{\{classPrefix\}\}/g,this.options.classPrefix)}}),F=0,G=E.extend({_messageTpl:'<div class="{{classPrefix}}-message" data-role="message"></div>',_actionTpl:'<div class="{{classPrefix}}-action" data-role="action"></div>',setup:function(){var b={message:"",classPrefix:"egeui-confirmbox",confirmTpl:'<button class="pure-button button-primary confirm" data-role="confirm">ç¡®å®</button>',cancelTpl:'<button class="pure-button cancel" data-role="cancel">åæ¶</button>',mask:!0,closeTpl:null,confirmOnEnter:!0},c=this.options=a.extend(b,this.options);this.options.content=a(this._parseTpl(this._messageTpl)).append(c.message);var d=a(this._parseTpl(this._actionTpl));c.cancelTpl&&(d.append(c.cancelTpl),c.cancelText&&d.find("[data-role=cancel]").text(c.cancelText)),c.confirmTpl&&(d.append(c.confirmTpl),c.confirmText&&d.find("[data-role=confirm]").text(c.confirmText)),c.title||(c.themeClass="no-title"),this.options.actions=d,G.superClass.setup.call(this),this.render().show(),c.confirmOnEnter&&this.$element.keydown(a.proxy(function(a){13===a.which&&this.$("[data-role=confirm]").trigger("click")},this))},events:{"click [data-role=confirm]":function(a){this.options.onConfirm&&this.options.onConfirm(),this.destroy()},"click [data-role=cancel]":function(a){this.options.onCancel&&this.options.onCancel(),this.destroy()}}}),H=u.extend({constructor:function(a){this.source=a.source,this.filter=a.filter,this.locator=a.locator,this.valueField=a.valueField,this.init()},init:function(){if(a.isArray(this.source)?this.type="array":a.isFunction(this.source)?this.type="function":a.isPlainObject(this.source)?this.source.data&&this.source.fields?(this.type="array",this.search_fields=this.source.fields):this.type="object":o(this.source)&&(this.type="url"),"url"!==this.type){if(this.filter=this.filter||"startsWith",!a.isFunction(this.filter)&&(this.filter=I[this.filter],!this.filter))throw new Error("DataSource Error: Specified filter is not existed.");this._initDataSource()}this.id=0,this.callbacks=[]},getData:function(a){this["_get"+n(this.type)+"Data"](a||"")},abort:function(){this.callbacks=[]},_done:function(a){this.trigger("data",a)},_getFilteredData:function(b,c){return this.locator?b=a.isFunction(this.locator)?this.locator(b,c):b[this.locator]:this.filter&&(b=this.filter(b,c)),b},_getFunctionData:function(b){var c=this.source(b),d=this;a.isFunction(c)?c(function(a){d._done(d._getFilteredData(a,b))}):this._done(this._getFilteredData(c,b))},_getArrayData:function(a){var b=this.filter(this.data,a);return this._done(b),b},_getUrlData:function(b){var c=this,d={cache:!1},e={query:b?encodeURIComponent(b):"",timestamp:(new Date).getTime()},f=this.source.replace(/\{\{(.*?)\}\}/g,function(a,b){return e[b]}),g="callback_"+this.id++;this.callbacks.push(g),/^(https?:\/\/)/.test(f)?d.dataType="jsonp":d.dataType="json",a.ajax(f,d).success(function(d){c.locator&&(d=a.isFunction(c.locator)?c.locator(d,b):d[c.locator]),d&&a.inArray(g,c.callbacks)>-1&&(delete c.callbacks[g],c._done(d))}).error(function(){a.inArray(g,c.callbacks)>-1&&(delete c.callbacks[g],c._done({}))})},_initDataSource:function(a){if("array"===this.type){if(this.data=this.source,this.search_fields){this.source=this.source.data;var b=this.source,c=this.search_fields,d=b.length;this.data=[];for(var e=0;e<d;e++){for(var f={},h=0;h<c.length;h++)f[c[h]]=b[e][c[h]];this.data[e]=f}}g(this.data)}}}),I={startsWith:function(b,c){var d=new RegExp("^"+l(c),"i"),e=[],f=c.length;return a.each(b,function(b,c){var g={},h=!1;for(var i in c)a.isPlainObject(c[i])||"value"!==i?a.isPlainObject(c[i])&&(g[i]={value:c[i].value},d.test(c[i].value)&&(g[i].hlIndex=[0,f],h=!0)):(g.value=c.value,d.test(c.value)&&(g.hlIndex=[0,f],h=!0));h&&(g.index=b,e.push(g))}),e},stringMatch:function(b,c){var d,e=new RegExp(l(c),"i"),f=[],g=c.length;return a.each(b,function(b,c){var h={},i=!1;for(var j in c)a.isPlainObject(c[j])||"value"!==j?a.isPlainObject(c[j])&&(h[j]={value:c[j].value},d=c[j].value.search(e),d>-1&&(h[j].hlIndex=[d,g],i=!0)):(h.value=c.value,d=c.value.search(e),d>-1&&(h.hlIndex=[d,g],i=!0));i&&(h.index=b,f.push(h))}),f}},J=/\bMSIE [6789]\.0\b/.test(navigator.userAgent),K={27:"esc",13:"enter",38:"up",40:"down"},L=v.extend({setup:function(){L.superClass.setup.call(this),this.render(),i(this.element)},events:{textchange:function(b){var c=a(b.target).val().replace(/^\s*/,"");this.options.delay?(this.delayTimer&&clearTimeout(this.delayTimer),this.delayTimer=setTimeout(h(function(){this.trigger("change",c),this.delayTimer=null},this),this.options.delay)):this.trigger("change",c)},keydown:function(a){var b=K[a.which];if(b){var c="key"+n(b);this.trigger(c,b,a)}},blur:function(){this.trigger("blur")}}}),M=w.extend({_selectTpl:'<div class="{{classPrefix}}"><ul data-role="items" class="item-list"></ul></div>',_itemWrapTpl:'<li class="{{classPrefix}}-item" data-role="item">{{item}}</li>',setup:function(){var b={align:{pos:"bottom",collision:"none"},classPrefix:"egeui-select",selectTpl:this._selectTpl,itemSelectedClass:"item-selected",selectFirst:!1,submitOnEnter:!1,changeOnSelect:!0,delay:200,showMenu:!0},c=this.options=a.extend(!0,b,this.options);this.$element=a(this._parseTpl(c.selectTpl)),this._itemWrapTpl=this._parseTpl(this._itemWrapTpl),c.align&&(c.align.elem=c.align.elem||c.trigger),M.superClass.setup.call(this),c.dataSource&&(this.dataSource=new H({source:c.dataSource,filter:c.filter,locator:c.locator,valueField:c.valueField})),this.createInput(),this._bindEvents()},show:function(){this.visible||(!this._isEmpty()||this.options.searchMoreTpl||this.options.allowEmptyShow)&&(M.superClass.show.call(this),this.$element.scrollTop(0))},reset:function(){J&&(this.silent=!0),""!==this.query&&(this.input.$element.val(this.query=""),this._clear())},destroy:function(){this.dataSource=null,this.data=null,this.input.destroy(),this._clear(),M.superClass.destroy.call(this)},query:"",lastIndex:-1,selectedIndex:-1,allowMouseMove:!0,events:{"mouseenter [data-role=items] li":function(a){return this.allowMouseMove?(this.lastIndex=this.selectedIndex,this.selectedIndex=this.items.index(a.currentTarget),void this.trigger("indexChange")):void(this.allowMouseMove=!0)},"mousedown [data-role=items] li":function(a){if(J){var b=this.input.element;b.onbeforedeactivate=function(){window.event.returnValue=!1,b.onbeforedeactivate=null}}a.preventDefault(),this.trigger("itemSelected")},mousedown:function(b){if(!a(b.target).closest("[data-role=items] [data-role=item]").length){this.cancelBlur=!0;var c=this;setTimeout(function(){delete c.cancelBlur},50)}}},queryData:function(a){return this.options.allowEmptyQuery||void 0!==a||""!==this.query?(this.dataSource.abort(),void this.dataSource.getData(a||this.query)):(this.data=[],void this.hide())},createInput:function(){var a=this.options;this.input&&this.input.destroy(),a.inputAdapter?this.input=a.inputAdapter:this.input=new L({element:a.trigger,delay:a.delay}),this._bindInputEvents()},_bindInputEvents:function(){this.input.on("change",function(a){return J&&this.silent?void(this.silent=!1):void(!this.options.isTextComplete&&m(this.query,a)||(this.query=a,this.queryData()))},this).on("blur",function(){if(this.cancelBlur){var a=this.input.$element;return void setTimeout(function(){a.focus()},50)}this.hide()},this).on("keyDown keyUp",function(a,b){this.options.isTextComplete&&!this.visible||(b.preventDefault(),this._handleKeyDownUp(a))},this).on("keyEnter",this._handleKeyEnter,this).on("keyEsc",this.hide,this)},_bindEvents:function(){this.options;this.dataSource&&this.dataSource.on("data",function(a){this.data=a,this.trigger("response",a),this.options.showMenu&&(this._clear(),this.data.length?this._fillItems():this.options.allowEmptyShow?this.input.$element.is(":focus")&&this.show():this.hide())},this),this.after("hide",function(){this.items&&(this.lastIndex=this.selectedIndex,this.selectedIndex=-1,this.trigger("indexChange"))}),this.on("indexChange",this._handleItemHover).on("itemSelected",function(){if(this.selectedIndex>=this.data.length)return this.hide(),void this.trigger("searchMore");var a=this.data[this.selectedIndex];if(!a.disabled){if(this.dataSource.search_fields)this.trigger("selected",this.dataSource.source[a.index]);else{if(this.options.changeOnSelect){var b=a[this.dataSource.valueField||"value"]||a;J&&(this.silent=!0),this.input.$element.val(b),this.query=b}this.trigger("selected",a.value||a)}this.hide()}})},_fillItems:function(){var b="";if(a.each(this.data,h(function(a,c){c=this._renderItem(c),b+=this._itemWrapTpl.replace("{{item}}",c)},this)),this.items=this.$("[data-role=items]").html(b).children(),this.options.searchMoreTpl){var c=a(this._itemWrapTpl.replace("{{item}}",this.options.searchMoreTpl(this.items))).appendTo(this.$("[data-role=items]")).removeAttr("data-role").addClass("search-more");this.items.push(c[0])}this.options.selectFirst&&(this.selectedIndex=0,this.trigger("indexChange")),this.input.$element.is(":focus")&&this.show(),this.trigger("itemsChange")},_renderItem:function(b){return b.value&&!a.isPlainObject(b.value)?k(b.value,b.hlIndex):this.options.itemTpl?j(a.isFunction(this.options.itemTpl)?this.options.itemTpl(b):this.options.itemTpl,b,this.dataSource.source[b.index]||b):b},_handleKeyEnter:function(a,b){this.items&&this.items[this.selectedIndex]&&(!this.options.submitOnEnter&&b.preventDefault(),this.trigger("itemSelected"),b.stopPropagation())},_handleKeyDownUp:function(b,c){if(!this.items)return void(this.options.allowEmptyQuery&&""===this.query&&this.queryData());this.show(),this.allowMouseMove=!1,this.lastIndex=this.selectedIndex,"down"===b?this.selectedIndex++:this.selectedIndex--,this.selectedIndex===this.items.length&&(this.selectedIndex=-1),this.selectedIndex===-2&&(this.selectedIndex=this.items.length-1),this.trigger("indexChange");var d=a(this.items[this.selectedIndex]);if(d[0]){var e=d.offset().top-d.parent().offset().top,f=this.$('[data-role="items"]'),g=e+d.outerHeight()-f.outerHeight()+18;g>0?f.scrollTop(g+f.scrollTop()):e<0&&f.scrollTop(Math.max(0,f.scrollTop()+e))}},_adjustMaxHeight:function(){var b=a(window).height()+a(window).scrollTop()-this.$element.outerHeight(),c=parseInt(this.$element.css("top"),10);this.$element.css("max-height",c>b?Math.max(0,b-c+this.$element.innerHeight())+"px":""),this.trigger("maxHeightChange")},_handleItemHover:function(){a(this.items[this.lastIndex]).removeClass(this.options.itemSelectedClass),a(this.items[this.selectedIndex]).addClass(this.options.itemSelectedClass)},_isEmpty:function(){var a=this.data;return!(a&&a.length>0)},_clear:function(){this.$("[data-role=items]").empty(),delete this.items,this.selectedIndex=-1},_parseTpl:function(a){return a.replace(/\{\{classPrefix\}\}/g,this.options.classPrefix)}}),N=v.extend({setup:function(b){b=a.extend({idField:"id",inputTpl:'<input type="text" autocomplete="off">',contactTpl:"<span>{{name}}</span>",removeTpl:'<i data-role="remove" title="å é¤" class="icon icon-pill-remove"></i>',itemTpl:function(a){return['<i class="icon icon-collab-',a.user_count?"group":"person",'"></i><span class="name">{{name}}</span><span>({{',a.user_count?"user_count":"login","}})</span>"].join("")},selectTpl:'<div class="{{classPrefix}}"><ul data-role="items" class="item-list"></ul></div>',inputMinWidth:60,showOnClick:!0,delay:400,multiple:!0,insertBack:!0},b);var c=this.options=a.extend(b,this.options);if(!c.contactTpl)throw new Error("ContactSelect Error: contactTpl not specified");N.superClass.setup.call(this),this.input=a(c.inputTpl).appendTo(this.element).css("border","none"),this.items=[],this.contacts=[],this.adjustInputWidth();var d=this;this.selector=new M({trigger:this.input,selectFirst:c.selectFirst,dataSource:c.data,filter:c.filter,locator:c.locator,selectTpl:c.selectTpl,itemTpl:c.itemTpl,changeOnSelect:!1,allowEmptyQuery:c.showOnClick,allowEmptyShow:c.showOnClick,delay:c.delay,zIndex:9999,align:{elem:c.alignElement||this.$element,offset:c.alignOffset||"-1 0",after:"show"},themeClass:"contact-select",width:p(c.alignElement)[0]&&p(c.alignElement).innerWidth()}).on("selected",function(a){d.trigger("beforeAdd",a),d.multiSelected?d.multiSelected=!1:""!==this.query&&this.reset(),c.insertBack&&d.insertItem(a),d.trigger("add",a)}),this.$element.attr("placeholder")&&this.input.attr("placeholder",this.$element.attr("placeholder")),this.render()},events:{"click input":function(){this.options.showOnClick&&(this.selector.items?this.selector.show():this.selector.queryData(""))},"keydown input":function(a){8===a.which&&""===a.target.value&&this.items.length&&this.removeItem(this.items.length-1)},"click [data-role='remove']":"removeItem"},destroy:function(){this.selector.destroy(),this.input.remove(),delete this.items,delete this.contacts,N.superClass.destroy.call(this)},resetItems:function(a){this.contacts=a;for(var b="",c=0,d=a.length;c<d;c++)b+=this.renderItemTpl(a[c]);var e=this.$element;e.html(b),this.items=e.children().toArray(),e.append(this.input),this.selector.createInput(),this.options.multiple?(this.adjustInputWidth(),this.input.focus()):this.input.hide(),this.contacts=a},renderItemTpl:function(b){var c=/(.*?)\{\{([\w\-]+)\}\}(.*?)/g,d=this.options.contactTpl;a.isFunction(d)&&(d=d(b)),d=d.replace(c,function(a,c,d,e){return c+b[d]+e});var e=a(d);return this.options.removeTpl&&a(this.options.removeTpl).appendTo(e),a("<div/>").html(e).html()},insertItem:function(b){for(var c=this.contacts.length-1;c>=0;c--)if(this.contacts[c][this.options.idField]==b[this.options.idField])return;var d=/(.*?)\{\{([\w\-]+)\}\}(.*?)/g,e=this.options.contactTpl;a.isFunction(e)&&(e=e(b)),e=e.replace(d,function(a,c,d,e){return c+b[d]+e});var f=a(e).insertBefore(this.input);this.options.removeTpl&&a(this.options.removeTpl).appendTo(f),this.items.push(f[0]),this.options.multiple?this.adjustInputWidth():this.input.hide(),this.contacts.push(b)},removeItem:function(b){var c,d;a.isNumeric(b)?(c=b,d=this.items[c]):(b.stopPropagation(),d=a(b.target).parent()[0],c=this.items.indexOf(d));var e=this.contacts[c];this.items.splice(c,1),this.contacts.splice(c,1),a(d).remove(),this.options.multiple||this.input.show(),this.adjustInputWidth(),this.trigger("remove",c,e)},adjustInputWidth:function(){var b=this.$element.width()-12,c=b;if(this.items.length){var d=a(this.items.slice(-1)[0]);c=b-d.offset().left+this.$element.offset().left-d.outerWidth(),c<this.options.inputMinWidth&&(c=b)}this.input.css("width",c)},clear:function(){a(this.items).remove(),this.items=[],this.contacts=[]}}),O=v.extend({_nodeListTpl:'<ul class="node-list" data-role="nodes"></ul>',_nodeWrapTpl:'<li class="node" data-role="node"><div class="item" data-role="item"></div></li>',_switchTpl:'<i class="tree-switcher icon icon-tree-{{switch_class}}" data-role="switcher"></i>',_checkboxTpl:'<i class="icon icon-checkbox" data-role="checkbox"></i>',setup:function(){var b={nodeTpl:'<span class="name" data-role="name">{{name}}</span>',childField:"children",nodeFields:[],idField:"id",isParentField:"is_parent",classPrefix:"egeui-tree",expandDepth:0},c=this.options=a.extend(b,this.options);if(!c.nodeTpl)throw new Error("Tree Error: nodeTpl not specified");if(!c.data)throw new Error("Tree Error: data not specified");O.superClass.setup.call(this),this._checkedNodesData={},this._disabledNodesData={},this.render()},render:function(){O.superClass.render.call(this),this.$element.addClass(this.options.classPrefix);var a=this._normalizeData(this.options.data);this._renderNodes(a,1,this.$element)},reDraw:function(a,b){var c,d;b?(c=this.$("#etn"+b[this.options.idField]),d=c.data("level")+1,c=c.parent(),this.setNode(b,b),c.find('[data-role="nodes"]').remove(),this._setNodeCustomData(b,{has_render_children:!0})):(c=this.$element,d=1,c.empty()),c[0]&&(a=this._normalizeData(a),this._renderNodes(a,d,c))},events:{'click [data-role="switcher"]':function(b){b.stopPropagation();var c=a(b.target).parent().parent();this._toggleNode(c)},'click [data-role="item"]':function(b){this._selectNode(a(b.currentTarget))},'mouseenter [data-role="item"]':function(b){var c=a(b.currentTarget);this.trigger("nodeEnter",c)},'mouseleave [data-role="item"]':function(b){var c=a(b.currentTarget);this.trigger("nodeLeave",c)},'click [data-role="checkbox"]:not(.disabled)':function(b){b.stopPropagation(),this._checkNode(a(b.target).parent())}},getSelectedNode:function(){return this._selectedNodeData},findNodeById:function(a){return this.$("#etn"+a).data("nodeData")},getCheckedNodes:function(){var a,b=[];for(a in this._checkedNodesData)b.push(this._checkedNodesData[a]);return b},isDisabledNode:function(a){var b=this._getNodeId(a);return this.$("#etn"+b+' [data-role="checkbox"]').hasClass("disabled")},disableNode:function(a,b,c){var d=this._getNodeId(a),e=this.$("#etn"+d);e.length?this._disableNode(this.$("#etn"+d),b,c):this._modifyDisabledNodeData(a,b,c)},disableNodes:function(b,c,d){var e=this;a.each(b,function(a,b){e.disableNode(b,c,d)})},disableAllNodes:function(b,c){var d=this;this.$('[data-role="item"]').each(function(){d._checkNode(a(this),b,c)})},isCheckedNode:function(a){var b=this._getNodeId(a);return this.$("#etn"+b+' [data-role="checkbox"]').hasClass("checked")},checkNode:function(a,b,c){var d=this._getNodeId(a),e=this.$("#etn"+d);e.length?this._checkNode(e,b,c):this._modifyCheckedNodeData(a,b,c)},checkNodes:function(b,c,d){var e=this;a.each(b,function(a,b){e.checkNode(b,c,d)})},checkAllNodes:function(b,c){var d=this;if(!c){var e=b?'[data-role="checkbox"]:not(.checked)':'[data-role="checkbox"].checked',f=this.$(e).parents('[data-role="item"]'),g=f.map(function(){return a(this).data("nodeData")});this.trigger(b?"beforeCheckAll":"beforeUnCheckAll",g)}this.$('[data-role="item"]').each(function(){d._checkNode(a(this),b,c)})},selectNode:function(a,b){var c=this._getNodeId(a),d=this.$("#etn"+c);d.length?this._selectNode(d,b):this._modifySelectedNodeData(a,b)},setNode:function(b,c){var d=this,e=this._getNodeId(b),f=this.$("#etn"+e),g=f.data("nodeData");a.each(c,function(a,b){if(g[a]=b,f.find("[data-role="+a+"]").text(b),a===d.options.isParentField)if(b){if(!f.find('[data-role="switcher"]').length){var c=d._switchTpl.replace("{{switch_class}}","collapse");f.find(".leaf").remove(),f.find("b")[0]?f.find("b:last").after(c):f.prepend(c)}}else f.find('[data-role="switcher"]').length&&(f.find('[data-role="switcher"]').remove(),f.prepend('<b class="leaf"></b>'))}),f.data("nodeData",g)},addNode:function(a,b){var c=this.$("#etn"+b[this.options.idField]);if(c[0]){var d=c.data("level")+1;c=c.parent(),this._expandParent(c),this._renderNodes([a],d,c)}},removeNode:function(a){var b=this._getNodeId(a),c=this.$("#etn"+b).parent();c[0]&&(c.siblings().length||c.parent().prev('[data-role="item"]').prepend('<b class="leaf"></b>').find('[data-role="switcher"]').remove(),c.remove())},expandNode:function(b,c){var d=this._getNodeId(b),e=this.$("#etn"+d).parent();if(e[0]){this._toggleNode(e,"expand",c);var f=this;a.each(e.parents('[data-role="node"]'),function(){f._toggleNode(a(this),"expand",c)})}},_getNodeId:function(b){var c=b;return a.isPlainObject(b)&&(c=b[this.options.idField]),c},_getNodeCustomData:function(a){var b=this._getNodeId(a),c=this.$("#etn"+b);if(!c.length)return!1;var d=c.data("nodeCustomData");return d||(d={},c.data("nodeCustomData",d)),d},_setNodeCustomData:function(a,b){var c,d=this._getNodeCustomData(a);if(d)for(c in b)"undefined"!=typeof b[c]&&(d[c]=b[c]);
return d},_disableNode:function(a,b,c){var d=a.find('[data-role="checkbox"]'),e=a.data("nodeData");b?d.addClass("disabled"):d.removeClass("disabled"),e&&this._modifyDisabledNodeData(e,b,c)},_checkNode:function(a,b,c){var d=a.find('[data-role="checkbox"]');if(d.hasClass("disabled"))return!1;if(void 0===b||d.hasClass("checked")!==b){void 0===b&&(b=!d.hasClass("checked"));var e=a.data("nodeData");c||this.trigger(b?"beforeCheck":"beforeUnCheck",a.data("nodeData")),b?d.addClass("checked"):d.removeClass("checked"),e&&this._modifyCheckedNodeData(e,b,c)}},_modifyCheckedNodeData:function(a,b,c){var d=this._getNodeId(a);b?(a&&(this._checkedNodesData[d]=a),c||this.trigger("checked",a)):(a&&delete this._checkedNodesData[d],c||this.trigger("unChecked",a))},_modifyDisabledNodeData:function(a,b,c){var d=this._getNodeId(a);b?(a&&(this._disabledNodesData[d]=1),c||this.trigger("disabled",a)):(a&&delete this._disabledNodesData[d],c||this.trigger("unDisabled",a))},_selectNode:function(a,b){this.$(".highlight").removeClass("highlight"),a.addClass("highlight");var c=a.data("nodeData");c&&this._modifySelectedNodeData(c,b)},_modifySelectedNodeData:function(a,b){a&&(this._selectedNodeData=a),b||this.trigger("nodeSelected",a)},_toggleNode:function(a,b,c){var d="collapse",e="expand";if(a.hasClass("expand")&&(d="expand",e="collapse"),!b||b!==d){a.removeClass(d).addClass(e).children('[data-role="item"]').find(".tree-switcher").removeClass("icon-tree-"+d).addClass("icon-tree-"+e);var f=a.children('[data-role="item"]').data("nodeData");"expand"===e&&(c||this.trigger("expand",f,this._getNodeCustomData(f),a.children('[data-role="item"]')))}},_expandParent:function(a){var b=a.children('[data-role="item"]');if(!b.find('[data-role="switcher"]')[0]){b.find(".leaf").remove();var c=this._switchTpl.replace("{{switch_class}}","expand");b.find("b")[0]?b.find("b:last").after(c):b.prepend(c)}this._toggleNode(a,"expand")},_normalizeData:function(b){return a.isArray(b)||(void 0===b[this.options.childField]&&(b[this.options.childField]=[]),b=[b]),b},_parseNodeTpl:function(b){var c=this.options.nodeTpl;return a.isFunction(c)?c(b):j(c,b,b)},_renderNodes:function(b,c,d){var e=0===this.options.expandDepth||c<=this.options.expandDepth?"expand":"collapse",f=a(this._nodeListTpl).appendTo(d),g=this._switchTpl.replace("{{switch_class}}",e),h=this.options.checkbox?this._checkboxTpl:"",i=(this.options.nodeTpl,this);a.map(b,function(b){var d=i._parseNodeTpl(b),j=a(i._nodeWrapTpl).appendTo(f).addClass(e),k=j.children().append(Array(c).join("<b></b>")).attr("data-level",c);i._bindNodeData(k,b),b[i.options.childField]||b[i.options.isParentField]?k.append(g):k.prepend('<b class="leaf"></b>'),k.append(h+d),i._selectedNodeData&&b[i.options.idField]===i._selectedNodeData[i.options.idField]&&i._selectNode(k,!0,!0),i._checkedNodesData&&i._checkedNodesData[b[i.options.idField]]&&i._checkNode(k,!0,!0),i._disabledNodesData&&i._disabledNodesData[b[i.options.idField]]&&i._disableNode(k,!0,!0),b[i.options.childField]&&(i._renderNodes(b[i.options.childField],c+1,j),i._setNodeCustomData(b,{has_render_children:!0})),i.trigger("render",b,i._getNodeCustomData(b))})},_bindNodeData:function(b,c){this.options.dataProcess&&(c=this.options.dataProcess(c));var d={};this.options.nodeFields.length?a.map(this.options.nodeFields,function(a){d[a]=c[a]}):d=c,this.options.idField&&b.attr("id","etn"+c[this.options.idField]),b.data("nodeData",d)}}),P={};!function(){var b=L.extend({setup:function(){L.superClass.setup.call(this),this.options.events={keyup:function(a){this.options.delay&&8!==a.which?(this.delayTimer&&clearTimeout(this.delayTimer),this.delayTimer=setTimeout(h(function(){this._keyUp(a),this.delayTimer=null},this),this.options.delay)):this._keyUp(a)}},this.render()},select:function(){throw new Error("Not implemented")},destroy:function(){this.$element.off("."+this.cid),b.superClass.destroy.call(this)},getCaretPosition:function(){var a=this._getCaretRelativePosition(),b=this.$element.offset();return a.top+=b.top,a.left+=b.left,a.collision="fit",a},focus:function(){this.$element.focus()},_keyUp:function(a){this._skipSearch(a)||this.trigger("search",this.getTextFromHeadToCaret())},_skipSearch:function(a){switch(a.keyCode){case 40:case 38:return!0}if(a.ctrlKey)switch(a.keyCode){case 78:case 80:return!0}}}),c=b.extend({select:function(b,c){var d=this.getTextFromHeadToCaret(),e=this.element.value.substring(this.element.selectionEnd),f=c.replace(b);a.isArray(f)&&(e=f[1]+e,f=f[0]),d=d.replace(c.match,f),this.$element.val(d+e),this.element.selectionStart=this.element.selectionEnd=d.length},_getCaretRelativePosition:function(){var b=this.getTextFromHeadToCaret();"number"!=typeof this.element.selectionEnd&&(b=b.replace(/\n/g,""));var c=a("<div></div>").css(this._copyCss()).text(b),d=a("<span></span>").text(".").appendTo(c);this.$element.before(c);var e=d.position();return e.top+=d.height()-this.$element.scrollTop(),e.lineHeight=d.height(),c.remove(),e},_copyCss:function(){return a.extend({overflow:this.element.scrollHeight>this.element.offsetHeight?"scroll":"auto"},c.DIV_PROPERTIES,this._getStyles())},_getStyles:function(a){var b=a("<div></div>").css(["color"]).color;return"undefined"!=typeof b?function(){return this.$element.css(c.COPY_PROPERTIES)}:function(){var b=this.$element,d={};return a.each(c.COPY_PROPERTIES,function(a,c){d[c]=b.css(c)}),d}}(a),getTextFromHeadToCaret:function(){return this.element.value.substring(0,this.element.selectionEnd)}});c.DIV_PROPERTIES={left:-9999,position:"absolute",top:0,whiteSpace:"pre-wrap"},c.COPY_PROPERTIES=["border-width","font-family","font-size","font-style","font-variant","font-weight","height","letter-spacing","word-spacing","line-height","text-decoration","text-align","width","padding-top","padding-right","padding-bottom","padding-left","margin-top","margin-right","margin-bottom","margin-left","border-style","box-sizing","tab-size"],P.Textarea=c;var d="å¶",e=c.extend({setup:function(){e.superClass.setup.call(this),a("<span>"+d+"</span>").css({position:"absolute",top:-9999,left:-9999}).insertBefore(this.element)},select:function(b,c){var d=this.getTextFromHeadToCaret(),e=this.element.value.substring(d.length),f=c.replace(b);a.isArray(f)&&(e=f[1]+e,f=f[0]),d=d.replace(c.match,f),this.$element.val(d+e),this.element.focus();var g=this.element.createTextRange();g.collapse(!0),g.moveEnd("character",d.length),g.moveStart("character",d.length),g.select()},getTextFromHeadToCaret:function(){this.element.focus();var a=document.selection.createRange();a.moveStart("character",-this.element.value.length);var b=a.text.split(d);return 1===b.length?b[0]:b[1]}});P.IETextarea=e;var f=b.extend({select:function(b,c){var d=this.getTextFromHeadToCaret(),e=window.getSelection(),f=e.getRangeAt(0),g=f.cloneRange();g.selectNodeContents(f.startContainer);var h=g.toString(),i=h.substring(f.startOffset),j=c.replace(b);a.isArray(j)&&(i=j[1]+i,j=j[0]),d=d.replace(c.match,j),f.selectNodeContents(f.startContainer),f.deleteContents();var k=document.createTextNode(d+i);f.insertNode(k),f.setStart(k,d.length),f.collapse(!0),e.removeAllRanges(),e.addRange(f)},_getCaretRelativePosition:function(){var b=window.getSelection().getRangeAt(0).cloneRange(),c=document.createElement("span");b.insertNode(c),b.selectNodeContents(c),b.deleteContents();var d=a(c),e=d.offset();return e.left-=this.$element.offset().left,e.top+=d.height()-this.$element.offset().top,e.lineHeight=d.height(),d.remove(),e},getTextFromHeadToCaret:function(){var a=window.getSelection().getRangeAt(0),b=a.cloneRange();return b.selectNodeContents(a.startContainer),b.toString().substring(0,a.startOffset)}});P.ContentEditable=f}();var Q=v.extend({setup:function(){var b={delay:200};this.options=a.extend(b,this.options),Q.superClass.setup.call(this),this.strategies=this.options.strategies;var c,d;d=this.$element.is("textarea")?"number"==typeof this.element.selectionEnd?"Textarea":"IETextarea":"ContentEditable",c=P[d],this.adapter=new c({element:this.element,delay:this.options.delay}).on("search",this.search,this);var e=a.extend({isTextComplete:!0,inputAdapter:this.adapter,changeOnSelect:!1,allowEmptyQuery:!0,selectFirst:!0,themeClass:this.options.themeClass,align:null},this.options.dropdown_options||{});this.dropdown=new M(e).before("show",function(){this.setPosition(this.input.getCaretPosition())}).on("selected",function(a){this.adapter.select(a,this.strategy)},this).after("hide",function(){this._term=null},this);var f=this;a.map(this.strategies,function(a){o(a.data)&&(a.data={source:a.data}),a.dataSource=new H(a.data),a.dataSource.on("data",function(a){this.dropdown.data=a,a.length?this.dropdown._fillItems():this.dropdown.hide()},f),a.index=a.index||1})},destroy:function(){delete this.strategies,this.dropdown.destroy(),Q.superClass.destroy.call(this)},search:function(a){null!=a||(a=this.adapter.getTextFromHeadToCaret());var b=this._extractSearchQuery(a);if(b.length){var c=b[1];if(this._term===c)return;this._term=c,this._search.apply(this,b)}else this.dropdown.hide()},_search:function(a,b,c){this.dropdown.dataSource=a.dataSource,this.dropdown.options.itemTpl=a.template,this.dropdown.input.trigger("change",b),this.strategy=a},_extractSearchQuery:function(a){for(var b=0;b<this.strategies.length;b++){var c=this.strategies[b],d=a.match(c.match);if(d)return[c,d[c.index],d]}return[]}}),R={};return R.Overlay=w,R.Popup=B,R.Tip=C,R.Dialog=E,R.ConfirmBox=G,R.AutoComplete=M,R.ContactSelect=N,R.TextComplete=Q,R.Tree=O,R});