
try{!function(e,t){e.Models=e.Models||{},e.Models.Login=Backbone.Model.extend({url:t.Services("/IBPTheme/services/ibp").maintenance,backValidationExists:!1,backValidationMessage:"",defaults:{Module:"IBP",documentType:"C",isMobile:!1,isStress:!1,onMaintenance:!1},validation:{User:[{required:!0},{fn:function(e){if("C"===this.get("documentType")&&!/^\d+$/.test(e))return"* Usuario incorrecto"}}],Password:[{required:!0}],Captcha:[{required:!0}]},labels:{User:"*",Password:"*",Captcha:"*"},initialize:function(){this.set("isMobile",window.top.location.href.toLowerCase().indexOf("/banking")>-1),this.set("isStress",window.top.location.href.toLowerCase().indexOf("stress")>-1)},backValidation:function(e,t,i){if(this.backValidationExists)return this.backValidationMessage},setOnMaintenance:function(){this.set("onMaintenance",!0)},setMaintenanceMessage:function(e){this.set("message",e)},login:function(){var e=this;this.save({},{headers:{Authorization:$.base64.encode(JSON.stringify(this.attributes))},data:{},success:function(i,o,s){o&&"true"===String(o.success)?(t.Utils.clearSession(),t.Utils.setInSession("UserId",e.get("User")),e.trigger("successOnLogin",i,o,s)):e.trigger("errorOnLogin",i,o,s)},error:function(t,i,o){e.trigger("errorOnLogin",t,i,o)}})}}),e.Models.Captcha=Backbone.Model.extend({url:jQuery(".captchaEndpoint").html(),generateCaptcha:function(){var e=this;this.save({},{success:function(t,i,o){i&&"true"===String(i.success)?e.trigger("successOnCaptcha",t,i,o):e.trigger("errorOnCaptcha",t,i,o)},error:function(t,i,o){e.trigger("errorOnCaptcha",t,i,o)}})}})}(BHDLeon.module("Login.Portlet"),BHDLeon.module("Global")),function(e,t){e.Views=e.Views||{},e.Views.Login=Backbone.View.extend({el:".loginContainer",template:Handlebars.templates.login,ui:{topWindowLoginIframe:".loginPortlet",topWindowFormContainer:".bhd-form",topWindowLoginTab:".bhd-login-btn",topWindowLoader:".bhd-form .loadingoverlay",inputs:"input",combo:".loginCombo",captchaImg:".captchaImg img",portalSiteLink:".linkto",resetPasswordLink:".forgottenPassword a",lockScreen:{el:".lockScreen",title:".lockScreen .top",body:".lockScreen .text"},loginURLWrapper:".endpoint",loader:".loadingoverlay"},messages:{maintenance:{general:"En este momento estamos realizando tareas de mantenimiento, por favor ingresa mÃ¡s tarde.</br></br>Disculpa los inconvenientes, agradecemos tu comprensiÃ³n."},login:{errorHeader:"Lo sentimos",error:"No es posible iniciar sesiÃ³n en estos momentos. Contacte al administrador."},captcha:{errorHeader:"Lo sentimos",error:"No fue posible generar la imagen de seguridad. Por favor vuelva a intentarlo."}},urls:{ibe:"/wps/portal/ibe/login",ibeStress:"/wps/portal/ibe/loginstress",ibpStress:"/wps/portal/ibploginstress",paymentOptions:"https://bankoffice.bhdleon.com.do/factoring/",supplyChain:{internal:"https://test.invoinet.com/QAEIPP/Chappaai.aspx?ReturnUrl=%2fQAEIPP%2fPortal.aspx%3fPortalTheme%3dBHDLeonTheme&PortalTheme=BHDLeonTheme",production:"https://secure.invoinet.com/EIPP/Chappaai.aspx?ReturnUrl=%2fEIPP%2fPortal.aspx%3fPortalTheme%3dBHDLeonTheme&PortalTheme=BHDLeonTheme"},resetPassword:"/wps/portal/BHD/Otros/validarid/",portalSite:"/wps/portal/BHD/"},events:{"click .submit":"submit","change .loginCombo":"goToLogin","click .idNumber":"checkIdLoginType","click .passportNumber":"checkPassportLoginType","click .lockScreen .continue":"hideLockScreen","click .captchaRefresh":"generateCaptcha","click .forgottenPassword a":"goToResetPassword","click .linkTo a":"goToPortalSite"},bindings:{"[name=User]":{observe:"User",setOptions:{validate:!0}},"[name=Password]":{observe:"Password",setOptions:{validate:!0}},"[name=Captcha]":{observe:"Captcha",setOptions:{validate:!0}}},initialize:function(){this.listenTo(this.model,"successOnMaintenanceCheck",this.maintenanceCheckSuccess),this.listenTo(this.model,"errorOnMaintenanceCheck",this.maintenanceCheckError),this.listenTo(this.model,"successOnLogin",this.loginSuccess),this.listenTo(this.model,"errorOnLogin",this.loginError),this.captchaModel=new e.Models.Captcha,this.listenTo(this.captchaModel,"successOnCaptcha",this.captchaFetchSuccess),this.listenTo(this.captchaModel,"errorOnCaptcha",this.captchaFetchError),this.model.getData("MaintenanceCheck")},render:function(){this.$el.append(this.template(this.model.attributes)),Backbone.Validation.bind(this),this.stickit(),window.top.$(this.ui.topWindowLoader).hide(),this.$(this.ui.loader).hide(),this.model.get("isMobile")&&this.$(this.ui.portalSiteLink).show(),this.model.get("isStress")&&(window.location.href.toLowerCase().indexOf("stress")===-1&&window.top.$(this.ui.topWindowLoginIframe).attr("src",this.urls.ibpStress),this.urls.ibe=this.urls.ibeStress),window.top.$(this.ui.topWindowFormContainer).height()>0&&this.setHeight(),this.$(this.ui.combo).msDropdown();var e=this;window.top.$(this.ui.topWindowLoginTab).click(function(){e.setHeight(),e.model.get("onMaintenance")&&e.generateCaptcha()}),$(this.ui.inputs).iCheck({checkboxClass:"icheckbox_flat-grey",radioClass:"iradio_flat",labelClick:!1}),this.model.get("onMaintenance")||this.captchaModel.generateCaptcha()},maintenanceCheckSuccess:function(e){e.get("onMaintenance")||(this.model.url=$(this.ui.loginURLWrapper).html()),this.render()},maintenanceCheckError:function(e,t){this.model.setOnMaintenance(),this.model.setMaintenanceMessage(t.error&&t.error.message?t.error.message:this.messages.maintenance.general),this.render()},generateCaptcha:function(){this.hideLockScreen(),this.$(this.ui.loader).show(),this.model.unset("Captcha","",{silent:!0}),this.captchaModel.generateCaptcha()},captchaFetchSuccess:function(e,t,i){this.$(this.ui.captchaImg).attr("src",t.data),this.$(this.ui.loader).hide()},captchaFetchError:function(e,t,i){this.$(this.ui.lockScreen.title).html(this.messages.captcha.errorHeader),this.$(this.ui.lockScreen.body).html(this.messages.captcha.error),this.$(this.ui.lockScreen.el).fadeIn(),this.$(this.ui.loader).hide()},submit:function(e){e.preventDefault(),this.model.isValid(!0)&&(this.$(this.ui.loader).show(),"undefined"!=typeof TLT&&TLT.logScreenviewLoad("Login"),this.model.login())},loginSuccess:function(e,t){window.top.location.href=t.data.redirect},loginError:function(e,t){this.$(this.ui.loader).hide();var i=t.error.code||"99",o=t.error.message||this.messages.login.error,s=t.data.errorMessageHeader||this.messages.login.errorHeader;"01"===i?(this.model.validation.Password.push({fn:"backValidation"}),this.model.backValidationExists=!0,this.model.backValidationMessage=o,this.model.validate(),this.model.validation.Password=this.model.validation.Password.slice(0,-1)):"03"===i?(this.model.validation.Captcha.push({fn:"backValidation"}),this.model.backValidationExists=!0,this.model.backValidationMessage=o,this.model.validate(),this.model.validation.Captcha=this.model.validation.Captcha.slice(0,-1)):(this.$(this.ui.lockScreen.title).html(s),this.$(this.ui.lockScreen.body).html(o),this.$(this.ui.lockScreen.el).fadeIn())},goToLogin:function(e){switch(e.preventDefault(),e.currentTarget.value){case"2":this.$el.hide(),window.top.$(this.ui.topWindowLoader).show(),window.top.$(this.ui.topWindowLoginIframe).attr("src",this.urls.ibe);break;case"3":window.open(this.urls.paymentOptions,"_blank"),this.$(this.ui.combo).msDropdown().data("dd").setIndexByValue("1");break;case"4":t.Properties.deployEnvironment===t.Properties.deployEnvironments.production?window.open(this.urls.supplyChain.production,"_blank"):window.open(this.urls.supplyChain.internal,"_blank"),this.$(this.ui.combo).msDropdown().data("dd").setIndexByValue("1")}},hideLockScreen:function(){this.$(this.ui.lockScreen.el).fadeOut()},setHeight:function(){var e;e=this.model.get("isMobile")||this.model.get("isStress")?this.model.get("onMaintenance")?"309px":"450px":"390px",window.top.loginFrameHeight=e,window.top.$(this.ui.topWindowFormContainer).css("height",e),this.$(this.ui.lockScreen.el).css("height",e),this.$(this.ui.loader).css("height",e)},goToResetPassword:function(){window.top.location.href=this.urls.resetPassword},goToPortalSite:function(){window.top.location.href=this.urls.portalSite}})}(BHDLeon.module("Login.Portlet"),BHDLeon.module("Global")),jQuery(document).ready(function(){var e=BHDLeon.module("Login.Portlet");e.Views.login=new e.Views.Login({model:new e.Models.Login})});
}catch(e){console.log("Module 'bhdlo_loginPortlet': ",e);}