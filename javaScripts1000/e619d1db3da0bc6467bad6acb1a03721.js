define("components/navigationDesktop",["FR","underscore","hammerjs","services/responsiveUtil","services/freerideRestApi","services/megaNav","services/adobeTargetHelper","services/adaHelper","components/dab375/dab375Helper"],function(e,n,t,o,i,a,r,s,l){var d,_={addReverseColors:function(){e.$el.mainNav.addClass("main_nav--reversed")},removeReverseColors:function(){e.$el.mainNav.removeClass("main_nav--reversed")},checkScrollPosition:function(){var n=d.hero.length>0&&!d.hero.hasClass("hidden"),t=!e.$el.body.hasClass("checkout-page"),o=e.$el.window.scrollTop()<=0;n&&t&&o?_.removeReverseColors():_.addReverseColors()},setDropdownProps:function(e){var n={};return n.navItemWidth=$(e).outerWidth()+40,n.navItemWidthOffset=Math.ceil(n.navItemWidth/2),n.headerRight=$(d.headerInner)[0].offsetWidth,n.headerHeight=$(e).position().top+$(e).outerHeight(!0)+$(e).find(".main_nav__dropdown__arrow").outerHeight(!0),n.eleMidpoint=function(e){return $(e).hasClass("nav_weather_search")?$(e)[0].offsetLeft+$(e).outerWidth()/2-11:$(e).hasClass("level1_icon")?$(e)[0].offsetLeft+$(e).outerWidth()/2:$(e)[0].offsetLeft+$(e).width()/2}(e),n.dropPos=n.eleMidpoint<n.headerRight/2?"left":"right",n.dropElement=$(e).find(".main_nav__dropdown"),n.dropArrowWidth=$(n.dropElement).find(".main_nav__dropdown__arrow").width()/2,n.dropElementSplit=Math.round($(n.dropElement)[0].getBoundingClientRect().width/2),n.dropFitRange="left"==n.dropPos?n.eleMidpoint>n.dropElementSplit?n.eleMidpoint-n.dropElementSplit:0:"right"==n.dropPos?n.headerRight-n.eleMidpoint>n.dropElementSplit?n.eleMidpoint-n.dropElementSplit:0:void 0,n},setMaxHeightWithinViewport:function(e){var n=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);if(n.bottom>=t){var o=t-n.top;$(e).css({height:o+"px","overflow-y":"scroll"})}},centerDropdowns:function(e,n){var t=n(e),o=t.dropElement,i=$(o).find(".main_nav__dropdown__arrow-container");i.css({width:t.navItemWidth}),"right"==t.dropPos&&0===t.dropFitRange?($(o).css({right:0,top:t.headerHeight}),$(i).css({right:t.headerRight-(t.eleMidpoint+t.navItemWidthOffset+12)})):"left"==t.dropPos&&0===t.dropFitRange?($(o).css({left:t.dropFitRange,top:t.headerHeight}),$(i).css({left:t.eleMidpoint-t.navItemWidth+t.navItemWidthOffset})):($(o).css({left:t.dropFitRange,top:t.headerHeight}),$(i).css({left:t.dropElementSplit-t.navItemWidth+t.navItemWidthOffset}))},signout:function(){e.$el.window.trigger("loading-spinner-on",[".main-container"]),i.logOut({},function(n){!0===n.success?e.$el.body.hasClass("checkout-page")?window.location=d.cartLink.attr("href"):window.location.reload():console.error("restApi.logOut response: ",n.error)})},updateCartCount:function(e){if(void 0!==e&&"number"==typeof e)if(d.cartCount.removeClass("cart_count--empty"),e>0){var n=1===e?"item.":"items.";d.cartCount.text(e),d.cartCountSrText.text(n),d.cartUtilityItem.addClass("main_nav__utility_item--cart_count_set")}else d.cartCount.text("").addClass("cart_count--empty"),d.cartCountSrText.text(""),d.cartUtilityItem.removeClass(".main_nav__utility_item--cart_count_set")},adaLinkNavigate:function(e,n){var t=e.find("a").first();switch(n.which){case 13:if(e.hasClass("focused"))break;e.addClass("focused hover"),t.attr("aria-expanded",!0),_.focusFirstElementInDropDown(e);break;case 27:e.removeClass("focused hover"),t.attr("aria-expanded",!1),t.focus()}},focusFirstElementInDropDown:function(e){var t=e.find(".main_nav__focusable_element");n.delay(function(){t.first().focus()},50)},closeDropDown:function(e){e.hide(),n.delay(function(){e.show()},0)},activateSubmenu:function(e){$(e).addClass("hover").trigger("opened")},deactivateSubmenu:function(e){$(e).removeClass("hover").trigger("closed"),$(e).removeClass("hover")},selectMultiLevelTab:function(e){var n="mouseenter"===e.type,t=s.isKeyboardSelect(e);if(n||t){var o=$(e.currentTarget),i=o.data("tab-id"),a=o.closest(".main_nav__multi_level"),r=a.find(".main_nav__multi_level__tab"),l=a.find(".main_nav__multi_level__panel"),d=l.filter('[data-tab-id="'.concat(i,'"]'));r.removeClass("selected"),o.addClass("selected"),l.removeClass("selected"),d.addClass("selected"),t&&(e.stopPropagation(),e.preventDefault(),d.find(".main_nav__multi_level__link").first().focus())}}},c={init:function(){d={headerInner:$("#mainNavInner"),signOutButton:$("#signOut"),hero:$(".hero, .hero__epic, .hero_with_promotion"),mainNavSignIn:$(".main_nav__utility-sign-in").parent(),mainNavSearch:$(".main_nav__utility-search").parent(),mainNavResortsDropdownLink:$(".main_nav__level1_list.siteselector .main_nav__level1_item.level1_icon"),mainNavResortsDropdown:$(".main_nav__dropdown__content.main_nav__regions_resorts"),accountDropdown:$(".main_nav__dropdown.account__login"),searchDropdown:$(".main_nav__dropdown.site__search")},c.setSelectors(),c.bindEvents(),_.checkScrollPosition(),window.shoppingCart&&_.updateCartCount(window.shoppingCart.TotalProducts),d.hero.length<=0&&e.$el.bodyContent.removeClass("position-top"),d.level3Item.removeAttr("title")},setSelectors:function(){d.l1Links=d.headerInner.find(".main_nav__level1_item, .main_nav__utility_item"),d.l1LinksFocus=d.headerInner.find(".main_nav__level1_item:focus, .main_nav__utility_item:focus"),d.allDropdowns=d.l1Links.find(".main_nav__dropdown"),d.allDropdownArrows=d.l1Links.find(".main_nav__dropdown__arrow"),d.cartUtilityItem=e.$el.mainNav.find(".main_nav__utility_item--cart"),d.cartCount=e.$el.mainNav.find(".cart_count"),d.cartCountSrText=e.$el.mainNav.find(".sr_cart_count"),d.closeLink=e.$el.mainNav.find(".nav_mobile__close"),d.cartLink=e.$el.mainNav.find("#nav_cart"),d.level2Heading=e.$el.mainNav.find(".main_nav__level2_heading"),d.level3Item=e.$el.mainNav.find(".main_nav__level3_item")},bindEvents:function(){if(o.isDesktop()){d.allDropdowns.each(function(e,n){var t=$(n).parent();_.centerDropdowns(t,_.setDropdownProps)}),d.l1Links.on("keydown",function(e){var n=$(e.currentTarget);_.adaLinkNavigate(n,e)}),d.l1Links.on("keydown",".main_nav__dropdown__close",function(e){var n=$(e.currentTarget);e.which=27,_.adaLinkNavigate(n,e)}),d.l1Links.on("click",".main_nav__dropdown__close",function(e){$(e.currentTarget).parents(".main_nav__utility_item").removeClass("hover")}),e.$el.mainNav.on("focusin focusout",".main_nav__focusable_element",function(e){var n=$(e.currentTarget).parents(".main_nav__level1_item"),t=n.find("a").first(),o="focusin"===e.type;n.toggleClass("focused",o),t.attr("aria-expanded","focusin"===e.type)}),d.signOutButton.on("click",function(e){e.preventDefault(),_.signout()}),e.$el.mainNav.on("click",".main_nav__dropdown__close",function(e){var n=$(e.currentTarget);if(1===e.which){var t=n.parents(".main_nav__dropdown");_.closeDropDown(t)}}),e.$el.mainNav.off("mouseenter",".main_nav__multi_level__tab").on("mouseenter",".main_nav__multi_level__tab",_.selectMultiLevelTab),e.$el.mainNav.off("keydown",".main_nav__multi_level__tab").on("keydown",".main_nav__multi_level__tab",_.selectMultiLevelTab);var n=e.$el.mainNav.find(".level1").filter(':contains("Lessons")');n.off("mouseover").one("mouseover",function(e){e.preventDefault(),e.stopPropagation(),r.getOffer({mbox:"SkiSchoolNavigation"}).done(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l.updateGlobalNav(e),n.trigger("mouseover")}).fail(function(e){n.trigger("mouseover")})});var t=e.$el.mainNav.find(".main_nav__regions_resorts__panel__body--resorts .main_nav__resort_list__item"),i=e.$el.mainNav.find(".main_nav__regions_resorts__map .selected_resort_pin"),a=i.find(".resort_icon"),s=$(".main_nav__regions_resorts__panel__body--resorts"),v=$(".main_nav__regions_resorts__map .region_map");t.on("mouseenter focusin",function(e){var n=$(e.currentTarget),t=n.data("x-coordinate"),o=n.data("y-coordinate"),r=n.data("icon-class");a.addClass(r),i.css({left:t,top:o}),i.show()}),t.on("mouseleave focusout",function(e){a.removeClass().addClass("resort_icon"),i.hide()}),s.on("show.bs.collapse",function(e){var n=$(this).data("region-index");v.find("div").hide(),v.find(".region_map_"+n).removeClass("hidden").show(),s.collapse("hide"),$.cloudinary.responsive()}),s.on("hide.bs.collapse",function(e){var n=$(this).data("region-index");if(v.find(".region_map_"+n).is(":visible"))return e.preventDefault()}),c.initMegaMenu()}e.$el.window.on("cart-count-update",function(e,n){_.updateCartCount(n)}),e.$el.mainNav.trigger("loaded"),d.headerInner.on("opened",function(e){d.l1Links.not(e.target).removeClass("hover focused")}),d.mainNavSignIn.on("opened",function(e){d.accountDropdown.find(".returningCustomerFormId").trigger("shown")}),d.mainNavSearch.on("opened",function(e){d.searchDropdown.find(".main_nav__search_box").trigger("shown")}),d.mainNavResortsDropdownLink.on("opened",function(e){_.setMaxHeightWithinViewport(d.mainNavResortsDropdown[0])}),d.mainNavResortsDropdownLink.on("closed",function(e){d.mainNavResortsDropdown.css({height:"100%","overflow-y":""})}),c.setWatches()},setWatches:function(){var t=n.debounce(function(){o.isDesktop()&&(c.unbindEvents(),c.bindEvents())},150);e.$el.window.on("resize",t),e.$el.window.on("pageManager_weatherLoaded",t);var i=n.debounce(function(){_.checkScrollPosition()},0);e.$el.window.on("scroll",i),e.$el.window.on("hero-dynamically-hidden",_.checkScrollPosition)},unbindEvents:function(){for(var e in d.allDropdowns.removeAttr("style"),d.allDropdownArrows.removeAttr("style"),d)"window"!==e&&"body"!==e&&"cartLink"!==e&&d[e].off()},initMegaMenu:function(){d.headerInner.menuAim({activate:_.activateSubmenu,deactivate:_.deactivateSubmenu,exitOnMouseOut:!0,rowSelector:".main_nav__level1_item,.main_nav__utility_item",submenuDirection:"below",tolerance:5})}};$(function(){return c.init()})});
//# sourceMappingURL=navigationDesktop.js.map
