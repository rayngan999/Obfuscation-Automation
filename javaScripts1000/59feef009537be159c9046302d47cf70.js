webshop.common=webshop.common||{};webshop.common.Abbreviate={_abbreviateWithTail:function(str,maxLength){if(str==null||maxLength<0){return str;}
if(str.length<=maxLength){return str;}
var head=str.substring(0,maxLength/2);var tail=str.substring(str.length-maxLength/2);return head+'...'+tail;},_abbreviate:function(str,maxLength){if(str==null||maxLength<0){return str;}
if(str.length<=maxLength){return str;}
var head=str.substring(0,maxLength);return head+'...';},abbreviateTextInContainer:function(str,strContainer,testContainer,maxHeight,useTail){strContainer.text(str);if(testContainer.offsetHeight<=maxHeight){return false;}
var left=0;var right=str.length;while(right>0&&(testContainer.offsetHeight>maxHeight||(right-left>1))){var next=Math.floor((left+right)/2);var text=useTail?webshop.common.Abbreviate._abbreviateWithTail(str,next):webshop.common.Abbreviate._abbreviate(str,next);strContainer.text(text);if(testContainer.offsetHeight>maxHeight){right=next-1;}else{left=next;}}
return true;}};(function(factory){if(typeof define==='function'&&define.amd){define(factory);}else if(typeof exports==='object'){module.exports=factory();}else{var _OldCookies=window.Cookies;var api=window.Cookies=factory();api.noConflict=function(){window.Cookies=_OldCookies;return api;};}}(function(){function extend(){var i=0;var result={};for(;i<arguments.length;i++){var attributes=arguments[i];for(var key in attributes){result[key]=attributes[key];}}
return result;}
function init(converter){function api(key,value,attributes){var result;if(arguments.length>1){attributes=extend({path:'/'},api.defaults,attributes);if(typeof attributes.expires==='number'){var expires=new Date();expires.setMilliseconds(expires.getMilliseconds()+attributes.expires*864e+5);attributes.expires=expires;}
try{result=JSON.stringify(value);if(/^[\{\[]/.test(result)){value=result;}}catch(e){}
value=encodeURIComponent(String(value));value=value.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);key=encodeURIComponent(String(key));key=key.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);key=key.replace(/[\(\)]/g,escape);return(document.cookie=[key,'=',value,attributes.expires&&'; expires='+attributes.expires.toUTCString(),attributes.path&&'; path='+attributes.path,attributes.domain&&'; domain='+attributes.domain,attributes.secure?'; secure':''].join(''));}
if(!key){result={};}
var cookies=document.cookie?document.cookie.split('; '):[];var rdecode=/(%[0-9A-Z]{2})+/g;var i=0;for(;i<cookies.length;i++){var parts=cookies[i].split('=');var name=parts[0].replace(rdecode,decodeURIComponent);var cookie=parts.slice(1).join('=');if(cookie.charAt(0)==='"'){cookie=cookie.slice(1,-1);}
try{cookie=converter&&converter(cookie,name)||cookie.replace(rdecode,decodeURIComponent);if(this.json){try{cookie=JSON.parse(cookie);}catch(e){}}
if(key===name){result=cookie;break;}
if(!key){result[name]=cookie;}}catch(e){}}
return result;}
api.get=api.set=api;api.getJSON=function(){return api.apply({json:true},[].slice.call(arguments));};api.defaults={};api.remove=function(key,attributes){api(key,'',extend(attributes,{expires:-1}));};api.withConverter=init;return api;}
return init();}));webshop.common=webshop.common||{};webshop.common.Recommendations={init:function(){this.requestRecommendations();this.registerHideRecommendations();},requestRecommendations:function(){var recsSidebar=jQ('#recsSidebar');if(recsSidebar.length>0){jQ.ajax({url:document.URL,data:{ajax:true,recommendations:"true",pageViewId:webshop.common.jsTopBodyVariables.pageViewId,recsPT:jQ('#recsPT').val()},success:function(itemsContainer){if(itemsContainer.match('productList')){recsSidebar.append(itemsContainer).fadeIn("slow",function(){recsSidebar.removeClass("isHidden");});jQ(document.body).trigger('webshop:gtm:newProductsLoaded')}}});}},registerHideRecommendations:function(){var sidebarSuggestions=jQ('#sideBarCustomerSuggestions');sidebarSuggestions.on('click','a.hideRecommendation',function(){var itemToRemove=jQ(this).parents(".product");var cross=itemToRemove.find('.hideRecommendation');var href=cross.attr('href');cross.remove();jQ.ajax({url:href,data:{ajax:true},success:function(itemToAdd){webshop.common.Recommendations.addSidebarSuggestion(itemToAdd,sidebarSuggestions);webshop.common.Recommendations.removeSidebarSuggestion(itemToRemove,sidebarSuggestions);}});return false;});},addSidebarSuggestion:function(itemToAdd,sidebarSuggestions){if(itemToAdd.match('productDetails')){sidebarSuggestions.append(itemToAdd);sidebarSuggestions.children().last().fadeIn('slow');}},removeSidebarSuggestion:function(itemToRemove,sidebarSuggestions){if(sidebarSuggestions.children().length<=2){this.removeSuggestionsContainer(sidebarSuggestions);}else{itemToRemove.fadeOut('slow',function(){itemToRemove.remove();webshop.common.Recommendations.removeLastItemCSSClass(sidebarSuggestions);});}},removeLastItemCSSClass:function(sidebarSuggestions){var lastItem=sidebarSuggestions.children().last();sidebarSuggestions.children().not(lastItem).removeClass('last');lastItem.addClass('last');},removeSuggestionsContainer:function(sidebarSuggestions){sidebarSuggestions.fadeOut('slow',function(){sidebarSuggestions.remove();});}};webshop=window.webshop||{};webshop.common=webshop.common||{};webshop.common.Util={checkTypes:function(args,expectedTypes){for(var i=0;i<args.length;i++){this.checkType(args[i],expectedTypes[i]);}
return true;},checkType:function(argument,expectedType){if(expectedType===Event&&argument){Event.stop(argument);}
return true;},getSmallLoadingIcon:function(id){this.checkType(id,String);var image=new Element('img',{'src':application.url+'/static/images/icons/loading/order.gif','id':id,'style':'vertical-align: middle; display: inline'});return image;},getInlineLoadingText:function(text,options){this.checkType(text,String);options=Object.extend({id:'loadingSpan'},options||{});var loadingIcon=this.getSmallLoadingIcon('loadingIcon');var span=new Element('span',{id:options.id}).insert("<strong style=\"padding-top:2px\">"+text+"</strong>&nbsp;&nbsp;").insert(loadingIcon);return span;},updateText:function(element,text,options){this.checkTypes(arguments,[Element,String]);options=Object.extend({queue:'end'},options||{});if(element){if(element.empty()||element.getOpacity()!==1){element.setStyle('display: block;').setOpacity(0);element.update(text);element.fade({from:0,to:1,duration:0.5,queue:options.queue});}else{element.fade({from:1,to:0,duration:0.5,queue:options.queue,afterFinish:function(element){element.update(text);element.setStyle('display: block;').setOpacity(0);element.fade({from:0,to:1,duration:0.5,queue:options.queue});}.curry(element)});}}},preloadImage:function(src){var img=new Image();img.src=src;return img;},setHash:function(value){var url=window.top.location.href;if(url.indexOf('#')!==-1){url=url.substring(0,url.indexOf('#'));}
window.top.location.href=url+"#"+value;},parseDate:function(dateString){if(!dateString){return null;}
var parts=dateString.split("-");var date=new Date(0);var year=parts[0];var month=parseInt(parts[1]);if(month<10){month=parseInt(parts[1].replace('0',''))-1;}else{month=month-1;}
var day=parseInt(parts[2]);date.setUTCFullYear(year,month,day);return date.stripTime();},toISOString:function(levels){var month=this.getMonth()+1<10?"0"+(this.getMonth()+1):(this.getMonth()+1);var date=this.getDate()<10?"0"+this.getDate():this.getDate();switch(levels){case 1:return this.getFullYear();case 2:return this.getFullYear()+"-"+month;case 3:return this.getFullYear()+"-"+month+"-"+date;default:return this.getFullYear()+"-"+month+"-"+date;}},stripTime:function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;},cloneDate:function(){return new Date(this.getTime());},getMonthName:function(){switch(this.getMonth()){case 0:return"January";case 1:return"February";case 2:return"March";case 3:return"April";case 4:return"May";case 5:return"June";case 6:return"July";case 7:return"August";case 8:return"September";case 9:return"October";case 10:return"November";case 11:return"December";default:return"";};},displayHelper:function(helper,text,elementName){if(helper&&text&&elementName){helper.update(text);helper.show().clonePosition(elementName,{setWidth:false,setHeight:false,setLeft:false,offsetTop:-10});}},encodeDescription:function(desc){return desc.replace(/\W+/g,'-').replace(/(^-+|-+$)/g,'');},startsWith:function(string,prefix){return string.substr(0,prefix.length)===prefix;},isPushStateSupported:function(){return!!(window.history&&window.history.pushState);},isScreenBigEnoughToFix:function(){return jQ(window).height()>600&&jQ(window).width()>920;},isIPad:function(){return navigator.userAgent.indexOf("iPad")!=-1;},isIOS:function(){return!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i)||!!navigator.userAgent.match(/iPod/i);},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);},_hoverSelectorSupported:null,isHoverSelectorSupported:function(){if(this._hoverSelectorSupported===null){this._hoverSelectorSupported=false;if(document.querySelector){try{document.querySelector('body:hover');this._hoverSelectorSupported=true;}catch(_e){}}}
return this._hoverSelectorSupported;},_pointerEventsSupported:null,isPointerEventsSupported:function(){if(this._pointerEventsSupported===null){var element=document.createElement('x');element.style.cssText='pointer-events:auto';return element.style.pointerEvents==='auto';}
return this._pointerEventsSupported;},displayAddedMessage:function(message,duration){var $span=jQ('#addedMessage span'),addedMessage=$span.parent(),wrapper=addedMessage.parent(),messageHeight,clonedAddedMessage;if(message){$span.html(message);}
messageHeight=addedMessage.outerHeight(true);addedMessage.css('top',-messageHeight).hide();clonedAddedMessage=addedMessage.clone(false);addedMessage.remove();wrapper.prepend(clonedAddedMessage);clonedAddedMessage.show().delay(100).animate({top:10},500).delay(duration?duration:3500).animate({top:-messageHeight},500).delay(500).hide(1);},mySupermarketControl:function(evt){var screenDimensions={left:(window.screenLeft)?window.screenLeft:window.screenX,top:(window.screenTop)?window.screenTop:window.screenY},mySupermarketWindow={};evt.preventDefault();mySupermarketWindow=window.open(this.href,'popup','height=462,width=662,scrollbars=no,resizeable=no,toolbar=no,directories=no,menubar=no,status=no'+',top='+(screenDimensions.top+((window.innerHeight/2)-231))+',left='+(screenDimensions.left+((window.innerWidth/2)-331)));}};(function(Backbone){'use strict';Backbone.Webshop.mixins.isCheckout=function(){return Boolean(webshop.common.jsVariables.get('isCheckout'));};})(Backbone);