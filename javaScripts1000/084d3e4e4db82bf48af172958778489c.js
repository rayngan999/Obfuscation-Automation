angular.module("bot_home",[]).controller("BotHomeController",["$scope","$http","$interval","$q","$timeout","$compile","$sce","$rootScope","$state",function(r,l,n,o,i,a,e,t,s){var u,c,g,p,_,f,d,h=s.params.user_hash;window.parent.postMessage({hash:h},"*");var m,b,w,v,y,I,k,x,M={};function C(){l.post("/getQaBotsForUser",{userHash:h}).then(function(t){var e,o,n=t.data;e=n,angular.forEach(e,function(n,t){if(1==n.activeStatus){var a=!1;angular.forEach(n.miscInfo.urlBlacklist,function(t,e){0<t.length&&-1!=_.indexOf(t)&&(a=!0)}),a||angular.forEach(n.miscInfo.urlPattern,function(t,e){0<t.length&&-1!=_.indexOf(t)&&(o=n)})}}),(b=o)&&1==b.activeStatus?q():window.parent.postMessage({event_id:"destroy_bot"},"*")})}function q(){var t;window.parent.postMessage({active_bot:b},"*"),(b=function(t){if("string"==typeof t.greetingInfo.greetingMsg&&-1!=t.greetingInfo.greetingMsg.indexOf("{")){var e=JSON.parse(t.greetingInfo.greetingMsg);t.greetingInfo.greetingMsg=e}if(t.greetingInfo.journeys&&t.greetingInfo.journeys.list){e=JSON.parse(t.greetingInfo.journeys.list);t.greetingInfo.journeys.list=e}return t}(b)).greetingInfo.journeys&&(b=S(b)),b.miscInfo&&b.miscInfo.other&&b.miscInfo.other.customFont&&(t=b,"undefined"!=typeof WebFont&&(WebFont.load({google:{families:[t.miscInfo.other.customFont]}}),$("#parent-container, #frase-bot-footer input").css("font-family",t.miscInfo.other.customFont))),"true"==g&&(b.miscInfo.searchBar=null,b.greetingInfo.greetingMsg.outer="Questions?"),b.miscInfo.searchBar&&!u?window.parent.postMessage({event_id:"show_search_mode"},"*"):window.parent.postMessage({event_id:"show_bot_avatar"},"*"),I||b.miscInfo.minimizeBot||"true"==g?(r.mini_avatar=!0,window.parent.postMessage({event_id:"minimize_bot"},"*")):r.mini_avatar=!1,(x||I&&!b.greetingInfo.showGreetingMsg)&&(window.parent.postMessage({event_id:"remove_greeting"},"*"),r.mini_avatar=!0,b.greetingInfo.showGreetingMsg=!1),b.avatar&&(b.inner_avatar=b.avatar),r.bot=b,function(){b.datasets||(b.datasets=[]);P=b.datasets.slice(0),angular.forEach(b.crawls,function(t,e){P.push(t+"_kb")}),P.push("bot_"+b.id)}();var e,n,a,o,i=!1;angular.forEach(b.miscInfo.chatIntegrations,function(t,e){1==t&&(i=!0)}),i&&1==function(t){var e=!0;if(t.miscInfo&&t.miscInfo.other&&t.miscInfo.other.timezone){var n=t.miscInfo.other.timezone,a=parseInt(moment().tz(n).format("HH:mm"));0==a&&(a=1);var o=moment().tz(n).format("ddd");if("Sat"!=o&&"Sun"!=o&&t.miscInfo.other.weekdaySchedule){var i=JSON.parse(t.miscInfo.other.weekdaySchedule),s=i[0];0==(s=parseInt(s))&&(s=1);var r=i[1];r=parseInt(r),e=!!(s&&r&&s<=a&&a<r)}if("Sat"!=o&&"Sun"!=o||!t.miscInfo.other.weekendSchedule)"Sat"!=o&&"Sun"!=o||(e=!1);else{var l=JSON.parse(t.miscInfo.other.weekendSchedule);s=l[0];0==(s=parseInt(s))&&(s=1);r=l[1];r=parseInt(r),e=!!(s&&r&&s<=a&&a<r)}}return e}(b)?r.enable_chat=i:r.bot.miscInfo.chatIntegrations.fallback=!1,r.custom_frase_input=w,e=b.miscInfo.brandColor,n=function(t,e){var n=parseInt(t.slice(1),16),a=e<0?0:255,o=e<0?-1*e:e,i=n>>16,s=n>>8&255,r=255&n;return"#"+(16777216+65536*(Math.round((a-i)*o)+i)+256*(Math.round((a-s)*o)+s)+(Math.round((a-r)*o)+r)).toString(16).slice(1)}(e,.2),a="",a+="<style type='text/css'>",a+=".brand-bg-color {color: white;",a+="background-image: linear-gradient(to right, "+n+", "+e+");",a+="background: -moz-linear-gradient(to right, "+n+", "+e+");",a+="background: -o-linear-gradient(to right, "+n+", "+e+");",a+="background: -ms-linear-gradient(to right, "+n+", "+e+");",a+="}",a+=".brand-bg-color-solid{background-color: "+e+"}",a+=".brand-color {color : "+e+"}",a+=".brand-border-color {border-color: "+e+" !important}",a+="</style>",$(a).appendTo("head"),E(),$("#frase-bot-convo").scroll(function(){0<$("#frase-bot-convo").scrollTop()?$("#frase-bot-panel-header").addClass("shadow"):$("#frase-bot-panel-header").removeClass("shadow")}),u?r.openBotPanel(u):!I||b.journey||r.test_bot||(o={bot_ids:[""+b.id],cookie_ids:[""+k],size:20,light:!1},l.post("/getLogs",o).then(function(t){var e=t.data.results;e&&0<e.length&&function(t){r.bot_interactions||(r.bot_interactions=[]);angular.forEach(t.reverse(),function(t,e){if("unknown_answer"!=t.answer_type&&t.answer_passage){r.bot_interactions.push({type:"human-input",text:t.question});var n={loaded:!0,user_input:t.question,type:"bot-answer",answer_type:"history_answer",answers:[{title:t.answer_title,url:t.answer_url,display_answer:t.answer_passage,text:t.answer_passage}]};r.bot_interactions.push(n)}}),L()}(e)}));var s={bot_id:b.id.toString(),base_url:"request",port:"request",route:"store_bot_stats"};I?s.is_new_user=!1:(r.known_cookie=!1,s.is_new_user=!0),l.post("/qa/fetchInfoFromServices",s),b.glossaries&&0<b.glossaries.length&&(b.glossary_id=b.glossaries[0])}function S(t){var a,e=t.greetingInfo.journeys.list;return angular.forEach(e,function(n,t){angular.forEach(n.url_pattern,function(t,e){t&&-1!=_.indexOf(t)&&(a=n)}),f&&0<f.length&&f==n.url_hash&&(a=n)}),a&&(a.avatar_greeting&&(t.greetingInfo.greetingMsg.outer=a.avatar_greeting),a.chat_greeting&&(t.greetingInfo.greetingMsg.inner=a.chat_greeting),a.buttons&&(t.miscInfo.sampleQuestions=a.buttons),a.fallback_msg&&(t.greetingInfo.fallbackMsg=a.fallback_msg),a.fallback_email&&(t.emailCaptureInfo.isUnknownAnsEmailCapture=!0),a.fallback_email_recipients&&(t.emailCaptureInfo.emailNotificationRecipients=a.fallback_email_recipients),t.journey=a),t}function E(){if("false"==g){t=(t=p)-50-100,$("#frase-bot-convo").css("height",t+"px")}else{var t=p-50-100;$("#frase-bot-convo").css("height",t+"px")}}r.gdpr_message="Cookies may be stored to provide a better user experience. You may optionally share your email address to connect with our team.",r.chat_cta="Talk to a human",r.removeGreeting=function(){r.mini_avatar=!0,r.known_cookie=!0,r.bot.greetingInfo.showGreetingMsg=!1,window.parent.postMessage({event_id:"remove_greeting"},"*")},r.clickSearchBar=function(){r.activeSearchBar=!0},r.openBotPanel=function(t){if(r.showPanel)r.showPanel=!1,r.bot.miscInfo.searchBar?window.parent.postMessage({event_id:"show_search_mode"},"*"):window.parent.postMessage({event_id:"show_bot_avatar"},"*");else{if(r.input=null,r.showPanel=!0,window.parent.postMessage({event_id:"show_panel"},"*"),r.bot.miscInfo.gdprDisclaimer||r.bot_interactions&&0!=r.bot_interactions.length)r.bot.miscInfo.gdprDisclaimer&&(r.bot_interactions=[{loaded:!1,type:"gdpr_consent"}]);else{if(r.bot.greetingInfo.greetingMsg.inner&&10<r.bot.greetingInfo.greetingMsg.inner.length)var e=r.bot.greetingInfo.greetingMsg.inner;else e=r.bot.greetingInfo.greetingMsg.outer;r.bot_interactions=[{text:e,type:"bot-greeting"}],L()}t&&(r.bot_interactions.push({type:"human-input",text:t}),r.bot_interactions.push({loaded:!1,type:"bot-answer"}),T(t)),i(function(){z(!0)},500)}m||$.ajax({url:"https://api.ipdata.co/?api-key=7f3d873a00f1fd397a9e582d813a3b2b884e5042d460be34fd236764",success:function(t){var e="";t.city&&(e+=""+t.city),t.region&&1<e.length?e+=", "+t.region:t.region&&(e+=""+t.region),t.country_name&&1<e.length?e+=", "+t.country_name:t.country_name&&(e+=""+t.country_name),m=e}})},window.addEventListener("message",function(t,e){t&&t.data&&t.data.window_height?(p=t.data.window_height,E()):t&&t.data&&t.data.parent_url?(_=t.data.parent_url,f=t.data.parent_url_hash,g=t.data.is_mobile,p=t.data.height,u=t.data.question,w=t.data.custom_frase_input,k=t.data.frase_cookie,I=t.data.known_user,x=t.data.frase_widget_closed_cookie,t.data.test_bot?(r.test_bot=!0,b=t.data.test_bot,i(function(){q()},100)):C()):t&&t.data.parent_url_hash?(f=t.data.parent_url_hash,r.bot=S(r.bot),r.bot.journey&&(r.$apply(),r.showPanel||(r.bot_interactions=[{text:r.bot.greetingInfo.greetingMsg.inner,type:"bot-greeting"}],i(function(){r.showPanel=!0,window.parent.postMessage({event_id:"show_panel"},"*"),L()})))):t&&t.data&&t.data.settings?((y=t.data.settings)&&"left"==y.position&&"left"==y.position&&($("#frase-mini-greeting-avatar, #frase-mini-greeting-message").css({right:"initial",left:"20px"}),$("#frase-mini-greeting .fa-times").css({left:"initial",right:"-8px"})),y&&y.chat_cta&&(r.chat_cta=y.chat_cta),y&&y.inner_avatar&&(r.bot.inner_avatar=y.inner_avatar)):t&&t.data&&t.data.site_search?H(t.data.question,t.data.answer):t&&t.data&&t.data.question?(c=t.data.question_source,r.showPanel?(r.bot_interactions.push({type:"human-input",text:t.data.question}),r.bot_interactions.push({loaded:!1,type:"bot-answer"}),z(!0),T(t.data.question)):r.openBotPanel(t.data.question)):t&&t.data&&t.data.open?r.showPanel||(t.data.greeting&&(r.bot.greetingInfo.greetingMsg.inner=t.data.greeting),r.bot_interactions=[{text:r.bot.greetingInfo.greetingMsg.inner,type:"bot-greeting"}],i(function(){r.showPanel=!0,window.parent.postMessage({event_id:"show_panel"},"*"),L()})):t&&t.data.voice?(function(t){if("microphone_request"==t){var e={loaded:!0,type:"bot-answer",answer_type:"custom_message_answer",text:"It looks like your microphone is not accessible yet. Please enable your microphone and try again."};r.bot_interactions.push(e),z(!0)}else if(t&&0<t.length)r.ask(t),M[t]=!0;else{e={loaded:!0,type:"bot-answer",answer_type:"custom_message_answer",text:"I did't get that. Can you try again please?"};r.bot_interactions&&r.bot_interactions.push(e),z(!0),r.listening=!1,r.$apply()}}(t.data.text),r.listening=!1):t&&t.data.traits?v=t.data.traits:t&&t.data.showGreeting&&"false"==t.data.showGreeting?(r.known_cookie=!0,r.bot.greetingInfo.showGreetingMsg=!1,r.$apply()):t&&t.data.showGreeting&&"true"==t.data.showGreeting?(r.bot.greetingInfo.showGreetingMsg=!0,r.$apply()):t&&t.data.disableChatFallback&&"true"==t.data.disableChatFallback&&(r.enable_chat=!1,r.bot.miscInfo.chatIntegrations.fallback=!1,r.$apply())}),r.acceptGDPRConsent=function(t){if(r.gdpr_consent_completed=!0,r.bot_interactions.push({type:"human-input",text:t,gdpr:!0}),"Accept"==t)if(r.bot.greetingInfo.greetingMsg.inner&&10<r.bot.greetingInfo.greetingMsg.inner.length)var e=r.bot.greetingInfo.greetingMsg.inner;else e=r.bot.greetingInfo.greetingMsg.outer;else{e="No worries, no cookies or personal data will be stored. Please enter your question and I will seek information across the website.";k=null}r.bot_interactions.push({text:e,type:"bot-greeting"}),L()},r.talkToHuman=function(){if(r.test_bot){r.bot_interactions.push({type:"human-input",text:"Live chat"}),r.bot_interactions.push({text:"Live chat integrations can only be tested live on your website.",type:"bot-answer",loaded:!0})}else{var n=[],a={};angular.forEach(r.bot_interactions,function(t,e){"human-input"!=t.type||!t.text||a[t.text]||t.email_input||t.gdpr||(n.push(t.text),a[t.text]=!0)}),n=n.toString().split(",").join(", "),J("live_chat","true"),window.parent.postMessage({event_id:"talk_to_human",questions:n},"*")}};var P=[];var O,A=!1,N=!1;function j(t){if(t&&0<t.length){var e={datasets:P,query:t,full_object:"true",thresh:-50,ranker_thresh:.25,top_n:10,use_ranker:"true",base_url:"qa",port:"regular",route:"qa_autosuggest"};N=!1,l.post("/qa/fetchInfoFromServices",e).then(function(t){t.data&&t.data.suggestions&&0<t.data.suggestions.length?r.autosuggest=t.data.suggestions:r.autosuggest=null,N=!0})}}function z(t){if(O=$("#frase-bot-convo").scrollTop(),t)var e=$("#frase-bot-convo").get(0).scrollHeight;else e=O+200;$("#frase-bot-convo").animate({scrollTop:e})}r.type=function(t,e){r.typing=!0,32==e.keyCode&&t&&1<t.split(" ").length&&5<t.length&&P&&0<P.length?(j(t),i(function(){N&&j(r.input)},1e3)):t&&t.length<6&&(r.autosuggest=null)},r.capitalizeFirst=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},r.hideAutosuggest=function(){r.typing=null,r.autosuggest=null},r.ask=function(t,e,n){n=n&&n,A=e,r.hideAutosuggest(),r.input=null,r.bot_interactions||(r.bot_interactions=[]),r.bot_interactions.push({type:"human-input",text:t}),r.bot_interactions.push({loaded:!1,type:"bot-answer"}),T(t)};var F,R=0;function B(){R+=1}var G={};function T(a){if(a=a&&a.trim(),window.parent.postMessage({ga:!0,event:{name:"frase_input"}},"*"),a&&a.length<2){var t={loaded:!0,type:"bot-answer",answer_type:"custom_message_answer",text:"That's too short for me to understand context. Can you elaborate a bit more or phrase it as a question?"};r.bot_interactions[r.bot_interactions.length-1]=t,z(!0)}else if(a&&150<a.length){t={loaded:!0,type:"bot-answer",answer_type:"custom_message_answer",text:"That's too long for me to understand. Can you please simplify question?"};r.bot_interactions[r.bot_interactions.length-1]=t,z(!0)}else if(F=n(B,100),G[a]){t=G[a];D(r.bot_interactions[r.bot_interactions.length-1]=t)}else{var e={question:a,bot_id:b.id,datasets:b.datasets,custom_crawls:b.crawls,glossary_id:b.glossary_id,base_url:"qa",port:"regular",route:"fetch_qa_asset_crawl"};r.bot.miscInfo&&r.bot.miscInfo.other&&r.bot.miscInfo.other.translation&&(e.translate_lang="true"),z(!0),l.post("/qa/fetchInfoFromServices",e).then(function(t){var n={loaded:!0,user_input:a,type:"bot-answer",answer_type:t.data.result_type,related_pages:t.data.related_pages,embed:null},e=t.data.answers;angular.forEach(e,function(t,e){1==t.email_capture&&(n.email_capture=!0,t.email_capture_msg?n.email_capture_msg=t.email_capture_msg:n.email_capture_msg="Leave us your email, and we'll get back to you soon!"),t.live_chat_msg?n.live_chat_msg=t.live_chat_msg:n.live_chat_msg="Live chat with us now","unknown_answer"!=n.answer_type||t.snippet||(t.snippet=t.display_answer),"confident_title_match"!=t.answer_type||t.snippet&&t.title!=t.snippet||(t.display_answer="<div class='answer-body'>Navigate to this <a href="+t.url+"><u>page</u>.</a></div>"),t.embed&&(n.embed=t.embed)}),"unknown_answer"==n.answer_type&&0==e.length&&n.related_pages&&0<n.related_pages.length?(e=n.related_pages,n.answer_type="confident_title_match"):"unknown_answer"==n.answer_type&&(r.bot.emailCaptureInfo.isAllowEmailCapture&&r.bot.emailCaptureInfo.isUnknownAnsEmailCapture&&(n.email_capture=!0,n.email_capture_msg="Please share your email, so we can follow up with you as soon as possible."),0==e.length&&1==a.split(" ").length?n.text="That's too short for me to understand context. Can you elaborate a bit more or phrase it as a question?":0==e.length&&1<a.split(" ").length?n.text=r.bot.greetingInfo.fallbackMsg:0<e.length&&(n.fallback=!0)),n.answers=e,(G[a]=n).embed?(function(t){if(t&&t.code&&-1!=t.code.indexOf("hbspt"))var e="//js.hsforms.net/forms/v2.js";if(e){var n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=e,document.head.append(n)}}(n.embed),i(function(){D(n)},1e3)):D(n),"chitchat_answer"!=n.answer_type&&H(a,n)}).catch(function(){D({loaded:!0,user_input:a,type:"bot-answer",answer_type:"error_answer",text:"Sorry, it seems like something went wrong. Please check your Internet connection, or try refreshing the page."})})}}function D(t){R<10?i(function(){r.bot_interactions[r.bot_interactions.length-1]=t,L(),z()},2e3):(r.bot_interactions[r.bot_interactions.length-1]=t,L(),z()),R=0,n.cancel(F)}function L(){i(function(){var t=$(".conversation-text a");$(t).each(function(t,e){var n=$(this).attr("href");n&&-1==n.indexOf("tel:")&&-1==n.indexOf("mailto:")&&(-1==n.indexOf("http")&&(n="https://"+n),$(this).attr("ng-click",'openLink("'+n+'")'),$(this).removeAttr("href"),a($(this))(r))})},500)}function H(t,e,n){"unknown_answer"==e.answer_type&&0<e.answers.length&&(e.answer_type="unknown_with_fallback");var a={question:t,answer_type:e.answer_type,bot_id:r.bot.id.toString(),url:_,cookie:k},o=e.answers[0];o&&o.buttons&&0<o.buttons.length?(o.answer_url=o.buttons[0].link,o.answer_title=o.buttons[0].text):(o&&o.url&&(a.answer_url=o.url),o&&o.title&&(a.answer_title=o.title)),o&&o.question&&(a.trained_question=o.question),o&&o.display_answer&&(a.answer_passage=o.display_answer),M[t]&&(a.voice="true"),"true"==g&&(a.mobile="true"),m&&0<m.length&&(a.localization=m),n&&(a.next_answer="true"),A&&(a.auto_suggest="true",A=!1),c&&(a.question_source=c),v&&v.email&&(a.email=v.email),r.test_bot&&(a.test_env="true"),"site search"==a.answer_type&&(a.question_source="site search",a.pageview_completion=e.url),l.post("/storeAnswerLog",a).then(function(t){d=t.data.AnswerID})}function J(t,e){var n=o.defer(),a={answer_id:d,field:t,value:e,base_url:"request",port:"request",route:"update_bot_log_item"};return l.post("/qa/fetchInfoFromServices",a).then(function(t){n.resolve(t)}).catch(function(){n.resolve("error")}),n.promise}function U(t,e){if(null!=t){var n="";return 0==t.indexOf("http://")?t=t.substr(7):0==t.indexOf("https://")&&(t=t.substr(8)),0==t.indexOf("www.")&&(t=t.substr(4)),n=t.split("/")[0],e&&3==t.split(".").length&&(n=n.split(".").slice(1,3).join(".")),n}}r.hideFeedbackVoting=function(t){return!(!t.email_capture&&"chitchat_answer"!=t.answer_type&&"history_answer"!=t.answer_type&&"sorry_answer"!=t.answer_type&&"unsupported_query"!=t.answer_type&&"unknown_answer"!=t.answer_type&&"error_answer"!=t.answer_type&&"successful_capture"!=t.answer_type&&"custom_message_answer"!=t.answer_type)},r.rateAnswer=function(t){if(r.bot_interactions[r.bot_interactions.length-1].rated=!0,1==t&&r.bot.miscInfo.positiveRatingMsg){if(r.bot_interactions[r.bot_interactions.length-1].rating_message=r.bot.miscInfo.positiveRatingMsg,r.bot.emailCaptureInfo.isAllowEmailCapture&&r.bot.emailCaptureInfo.isPositiveRatingEmailCapture){r.bot_interactions[r.bot_interactions.length-1].email_capture=!0;var e=r.bot.emailCaptureInfo.emailCapturePositiveMsg;r.bot_interactions[r.bot_interactions.length-1].email_capture_msg=e}}else if(0==t&&r.bot.miscInfo.negativeRatingMsg){if(r.bot_interactions[r.bot_interactions.length-1].rating_message=r.bot.miscInfo.negativeRatingMsg,r.bot.emailCaptureInfo.isAllowEmailCapture&&r.bot.emailCaptureInfo.isNegativeRatingEmailCapture){r.bot_interactions[r.bot_interactions.length-1].email_capture=!0;e=r.bot.emailCaptureInfo.emailCaptureNegativeMsg;r.bot_interactions[r.bot_interactions.length-1].email_capture_msg=e}}else r.bot_interactions[r.bot_interactions.length-1].rating_message="Thanks for your feedback.";var n={answer_type:r.bot_interactions[r.bot_interactions.length-1].answer_type,expected_answer:t.toString(),id:d};if(r.bot_interactions[r.bot_interactions.length-1].answers){var a=r.bot_interactions[r.bot_interactions.length-1].answers[0].count;a&&(n.count=a)}l.post("/qa/rateBotAnswer",n)},r.openLink=function(t,e){if(t){var n={answer_id:d,field:"pageview_completion",value:t,base_url:"request",port:"request",route:"update_bot_log_item"};if(l.post("/qa/fetchInfoFromServices",n).then(function(t){console.log("funnel logged")}),e&&e.target&&e.target.textContent){var a={name:"frase_funnel",anchor_text:e.target.textContent};window.parent.postMessage({event:a,ga:!0},"*")}else window.parent.postMessage({event:{name:"frase_funnel"},ga:!0},"*");if(-1==t.indexOf("http")&&(t="https://"+t),i=t,new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(i)){var o=U(_,!0);-1!=U(t,!0).indexOf(o)?window.parent.parent.window.location=t:window.open(t,"_blank")}}var i},r.getNextAnswer=function(t){var e=r.bot_interactions[r.bot_interactions.length-1],n=e.answers;t=t||e.user_input,(n=n.slice(0)).shift(),r.bot_interactions.push({type:"human-input",text:"Next Answer"});var a={loaded:!0,user_input:"Next Answer",type:"bot-answer",answer_type:n[0].type,answers:n,original_question:t};r.bot_interactions.push(a),z(),H(t,a,!0)},r.sanitizeMe=function(t){return"string"==typeof t?e.trustAsHtml(t):t},r.triggerEmailCapture=function(t){var e={loaded:!1,type:"human-input",text:"Not helpful"};r.bot_interactions.push(e);e={loaded:!1,type:"bot-answer"};r.bot_interactions.push(e),z();e={loaded:!0,type:"bot-answer",answer_type:"unknown_answer",answers:[],text:r.bot.greetingInfo.fallbackMsg,email_capture:t.email_capture,email_capture_msg:t.email_capture_msg};R=0,D(e)},r.enterEmail=function(t,e,n){if(/\S+@\S+\.\S+/.test(t)){r.bot_interactions[r.bot_interactions.length-1].invalid_email=!1,r.bot_interactions.push({type:"human-input",text:t,email_input:!0});var a={loaded:!1,type:"bot-answer"};r.bot_interactions.push(a);var o=[],i={};angular.forEach(r.bot_interactions,function(t,e){"human-input"!=t.type||!t.text||i[t.text]||t.email_input||t.gdpr||(o.push(t.text),i[t.text]=!0)}),r.bot.emailCaptureInfo.integrationID&&l.post("/addContactToCRM",{integration_id:r.bot.emailCaptureInfo.integrationID,fullName:e,email:t,inbound_questions:o}).then(function(){console.log("contact sent to CRM")}),r.bot.emailCaptureInfo.emailNotificationRecipients&&l.post("/sendEmailCaptureNotification",{user_email:t,question:o.toString().split(",").join(", "),email_notification_recipients:r.bot.emailCaptureInfo.emailNotificationRecipients,url_location:_,note:n,name:e}).then(function(){console.log("email notification sent")});a={loaded:!0,type:"bot-answer",answer_type:"successful_capture",message:r.bot.emailCaptureInfo.emailCaptureSuccessMsg};r.bot_interactions[r.bot_interactions.length-1]=a;var s={email:t,name:e,note:n};J("email",s=JSON.stringify(s)).then(function(t){console.log("success")}),window.parent.postMessage({event_id:"email_capture"},"*")}else r.bot_interactions[r.bot_interactions.length-1].invalid_email=!0},r.getUrlDomain=function(t){return U(t)},window.hasOwnProperty("webkitSpeechRecognition")&&navigator.mediaDevices?r.speech_support=!0:r.speech_support=!1,r.startDictation=function(t,e){window.parent.postMessage({event_id:"ask_audio"},"*"),z(r.listening=!0)}}]);