/*! vidora-client 1.3.4 03-12-2021 */

!function(n,t){var s={version:"1.3.4",rev:"4a354580d3cf929b5a8a7d86ed03be7f4218d021"},i=window,c=document,u=navigator;function a(n){i.console&&console.log&&console.log(n)}function f(n){i.console&&console.error&&console.error(n)}function d(n){throw new Error(n)}function l(n){return void 0===n}function e(n){return null===n}function v(n){return l(n)||e(n)}function p(n){return!e(n)&&"object"==typeof n}function h(n){return!v(n)&&n.constructor===Array}function g(n,t){return v(n)?t:n}function m(n,t){var e=g(n,{}),r=g(t,{});for(var o in r)e[o]=r[o];return e}function y(n){var t=g(n,{});return p(t)||d("Options should be an object."),t}function r(n){return JSON.parse(n)}function o(n){return JSON.stringify(n)}function _(n){return encodeURIComponent(n).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}function I(n){var t=[];for(var e in n){var r=n[e],o=l(r)?[e]:[e,r];t.push(o)}return t.sort(function(n,t){return(e=n)<(r=t)?-1:r<e?1:0;var e,r}),t.map(function(n){return n.map(_).join("=")}).join("&")}function S(){return(new Date).getTime()}function w(){return Math.random()}function T(){return Math.floor(65536*w())}var U,k=!l(i.Uint16Array)&&!l(i.crypto)?function(n){var t=new Uint16Array(n);crypto.getRandomValues(t);for(var e=[],r=0;r<t.length;r++)e.push(t[r]);return e}:function(n){for(var t=[],e=0;e<1&&e<n;e++)t.push(65535&(T()^S()));for(;e<n;e++)t.push(T());return t};function H(){return k(10).map(function(n){var t=(n>>1).toString(32);return"000".slice(t.length)+t}).join("")}try{i.sessionStorage,U=i.localStorage}catch(n){}function b(n){if(n){var t="string"==typeof n.setItem;return!v(n)&&!t}return!1}function R(n,t,e){try{return n.setItem(t,o(e)),!0}catch(n){return a(n),!1}}function x(n,t){var e=n.getItem(t);return v(e)?null:r(e)}function q(n,t){n.removeItem(t)}function A(n,t){for(var e=0;e<n.length;e++){t(n.key(e))}}function E(){return b(U)}function O(n,t){return E()&&R(U,n,t)}function C(n){if(E())return x(U,n)}function j(n){E()&&q(U,n)}function D(n){E()&&A(U,n)}function M(n,t,e,r){var o=[];if(o.push(n+"="+encodeURIComponent(t)),e){var i=new Date;i.setTime(i.getTime()+1e3*e);var u="expires="+i.toUTCString();o.push(u)}o.push("path=/"),r&&o.push("domain="+r);var a=o.join("; ");c.cookie=a}var V=50,P=V,K=3,X=5,J=3*X,N="vidoraRequest:",B=".clock";function F(){return S()+":"+w()}function L(n){return n+B}function $(n){return C(n)}function z(n){j(n),setTimeout(function(){j(n)},100)}function G(n){return C(n)}function Q(n){var t=L(n);j(n),z(t)}function W(n,t,e){var r,o,i=N+F(),u=(r=L(i),o=0,setInterval(function(){O(r,o+=1)},X));return O(i,{data:n,guid:e,retry:0}),{key:i,guid:e,clock:u}}function Y(){var e={};return D(function(n){var t;0===(t=n).indexOf(N)&&-1!==t.indexOf(B)&&(e[n]=$(n))}),e}function Z(){var e=[];return D(function(n){var t;0===(t=n).indexOf(N)&&-1===t.indexOf(B)&&e.push(n)}),e}var nn=!1;var tn=4;function en(n,t,e){a("XHR Request Succeded: "+e.url)}function rn(n,t,e){f("XHR Request Failed: "+e.url+" "+n)}function on(n,t,e){f("XHR Timeout: "+e.url)}function un(n){return n}function an(n){return n}function cn(n,t){var e=function(n,t,e){var r=new XMLHttpRequest;r.open(n,t.url,e);var o="onSuccess"in t?t.onSuccess:en,i="onError"in t?t.onError:rn,u="onTimeout"in t?t.onTimeout:on,a="unmarshall"in t?t.unmarshall:un;return"crossDomainCredentials"in t&&(r.withCredentials=!0===t.crossDomainCredentials),"timeoutMs"in t&&(r.timeout=t.timeoutMs,r.ontimeout=function(){u.call({},t)}),r.onload=function(){r.readyState===tn&&200===r.status?o.call({},a(r.responseText),r.status,t):i.call({},r.statusText,r.status,r.readyState,t)},r.onerror=function(){var n="Unknown Error.";v(r.status)&&v(r.statusText)?n="Unknown Error.":"statusText"in r&&(n=r.statusText),i.call({},n,r.status,r.readyState,t)},r}(n,t,!0);if("data"in t){var r="marshall"in t?t.marshall:an;"dataType"in t&&e.setRequestHeader("Content-type",t.dataType),e.send(r(t.data))}else e.send();return e}var sn="sendBeacon";var fn=document.currentScript||document.scripts[document.scripts.length-1],ln=(fn&&fn.src||"").match(/:(\/\/[^\/?#]+)(?:[\/?#]|$)/i),dn=ln&&ln[1]||"//alloy.vidora.com",vn="https:"+dn,pn=dn,hn={marshall:o,dataType:"text/plain"};function gn(){}var mn=gn,yn=gn,_n=gn;function In(n,t){var e,r;if(!v(n))if(m(t,hn),t.data.guid=n.guid,t.data.user_agent=window.navigator.userAgent,t.data.url=window.location.href,!v(u[sn])&&v(t.onSuccess)){(e=t.url,r=t.marshall(t.data),u[sn](e,r))&&yn(n)}else{var o=t.onSuccess||gn;t.onSuccess=function(){yn(n),o()},cn("POST",t)}}function Sn(n,t){var e,r,o,i,u,a,c=t.map(function(n){return n[0]}),s={};0<t.length&&2<t[0].length&&(s=t[0][2]),e=n,r=c,o=y(s),i=m({api_key:e.token},o._params),u={url:g(o._baseURI,e._analyticsHost)+"/"+e.apiVersion+"/validate?"+I(i),data:{data:r}},a=mn(u),"success"in o&&(u.onSuccess=o.success),In(a,u)}function wn(n,t,e){n in e&&(t[n]=e[n])}function Tn(n){v(n)?d("Vidora API constructed without any options."):p(n)?"apiKey"in n||d("Vidora API constructed without an API Key"):d("Vidora API should be constructed with an option object.");var t=m({},n);this.token=t.apiKey,this.apiVersion="v1";var e,r,o,i,u,a=this;function c(){e(i),i=[]}this._queue=(e=function(n){Sn(a,n)},r=500,o=30,i=[],u=setTimeout(function(){},0),{add:function(n){clearTimeout(u),i.push(n),i.length>=o?c():u=setTimeout(c,r)},flush:function(){clearTimeout(u),c()}}),this._analyticsHost=vn,this._apiHost=pn,this._sendMode=0,this._build=s,this._userId=null,_n(In)}E()&&(mn=function(n){return W(n,0,F())},yn=function(n){var t,e,r=n.key,o=n.clock;e=L(r),(t=o)&&clearInterval(t),z(e),Q(r)},_n=function(i,u){if(!nn){nn=!0;var a=Z(),c=Y();!function(n){if(n.length>V){n.sort();for(var t=n.length-P,e=0;e<t;e++){Q(n.shift())}}}(a);setTimeout(function(){!function(n){for(var t in n){var e=n[t],r=$(t);!v(r)&&r!==e||(delete n[t],z(t))}}(c);var t,e,r,o,n=(t=c,e=[],a.forEach(function(n){L(n)in t||e.push(n)}),e);r=i,o=[],n.forEach(function(n){var t=G(n);if(!v(t)&&t.retry+1<K){var e=W(t.data,0,t.guid);o.push(e)}Q(n)}),o.forEach(function(n){var t=G(n.key);r(n,t.data,t.guid)}),nn=!1,u&&u()},J)}}),Tn.prototype.config=function(n){var t=y(n);"analyticsHost"in t&&(this._analyticsHost=t.analyticsHost),"apiHost"in t&&(this._apiHost=t.apiHost)},Tn.prototype.send=function(n,t,e){for(var r=h(t)?t:[t],o=this.getUserId(),i=this.getSessionId(),u=0;u<r.length;u++){var a=r[u],c=y(e),s={type:String(n),user_id:String(o),session_id:String(i)};v(a)||(s.content_id=String(a)),m(s,c.params);var f={};wn("success",f,c),wn("error",f,c),wn("timeout",f,c);var l=this._sendMode;switch("click"!==s.type&&!c.quicksend||(l=1),l){case 1:this._queue.add([s,f,c]),this._queue.flush();break;case 0:this._queue.add([s,f,c]);break;default:d()}}};var Un="vidoraUserId";Tn.prototype.getUUID=function(){var n=function(n){for(var t=c.cookie.split("; "),e=0;e<t.length;e++){var r=t[e],o=r.indexOf("=");if(-1!==o)if(r.slice(0,o)===n){var i=r.slice(o+1);return decodeURIComponent(i)}}return null}(Un);return e(n)&&(n=H(),M(Un,n,5256e3)),n},Tn.prototype.setUUID=function(n){M(Un,n,5256e3)};var kn=H().slice(0,10);Tn.prototype.getSessionId=function(){return kn},Tn.prototype.setUserId=function(n){this._userId=n},Tn.prototype.getUserId=function(){return!v(this._userId)&&""!==this._userId||(this._userId=this.getUUID()),this._userId};var Hn="vidora-client",bn=Tn,Rn="vidora_ns",xn="vidora",qn={},An={};function En(t){return function(n){n.call({},qn[t],An)}}function On(o){return function(n){var t=n[0],e=n.slice(1),r=qn[o];t in r||d("Invalid api call '"+t+"'"),r[t].apply(r,e)}}function Cn(t){return function(n){h(n)?On(t)(n):"function"==typeof n?En(t)(n):d("typeof call item '"+typeof n+"' not supported.")}}An._i=function(n,t,e){var r=m({apiKey:n},e),o=new bn(r);v(t)&&(t=xn),qn[t]=o,a(Hn+" "+o._build.version+" "+o._build.rev)},function(n,t){Rn in n?n[Rn].includes(xn)||n[Rn].push(xn):n[Rn]=[xn];for(var e=0;e<n[Rn].length;e++){var r=n[Rn][e];if(n[r]&&!0===n[r]._init)f(Hn+": "+r+" included twice!");else{c=t;var o=(i=n)[r];r in n||(n[r]={}),n[r].push=On(r),n[r].ready=En(r),n[r]._init=!0,o&&(o.ready=En(r),o.push=On(r),o._q.forEach(Cn(r)),o=null)}}}(n,t)}(window,document);