define(['jquery','session'],function($,session){function megaMenu(){var $navLinks=null,$navBtn=null,$dropNav=null,$subNav=null,subDropIsOpen=false,findNav=function(){$navLinks=$('.nav-links');$navBtn=$navLinks.find('.main-menu');$dropNav=$navLinks.find('.drop-nav');$subNav=$navLinks.find('.sub-drop-nav');if($navBtn&&$dropNav&&$subNav){initNav();}else{setTimeout(function(){findNav();},500);}},initNav=function(){if($navBtn){var closeAllNav=function(){var delay=20;var handleAnimationComplete=function($evt){$dropNav.attr("data-state","hidden");};$dropNav.find("li").each(function(){$(this).off("click");});$(document).off("click",handleDocumentClick);if(subDropIsOpen===true){handleSubDropClose();delay=200;}
$dropNav.attr("data-state","transition");window.animationTimeout=setTimeout(function(){$dropNav.slideUp(handleAnimationComplete);clearTimeout(window.animationTimeout);delete window.animationTimeout;},delay);};var handleSubDropClose=function(options){options=options||{};$dropNav.show();var handleSubDropCloseAnimationComplete,animLength=20;handleSubDropCloseAnimationComplete=function(){$subNav.hide();subDropIsOpen=false;}
if(options.animate!==true){animLength=300;}
$subNav.animate({opacity:0,width:0},animLength,handleSubDropCloseAnimationComplete);};var handleDocumentClick=function(event){if($(event.target).closest($navLinks.get()).length<1){closeAllNav();}};var handleNavClick=function($evt){var handleAnimationComplete,curState=$dropNav.attr("data-state");if(curState==="hidden"){var handleAnimationComplete=function($evt){$dropNav.attr("data-state","display");var handleDropNavClick=function(e){var $activePanel,$activePanelBackBtn,handleSubDropAnimationComplete
typeid=$(e.target).data("type");$subNav.find('.nav-item').hide();if($(this).hasClass('has-children')){e.preventDefault();}
$activePanel=$subNav.find('.nav-item[data-type="'+typeid+'"]');if($activePanel.length&&$activePanel.length>0){$subNav.css({opacity:0,width:0});$subNav.find('.nav-item').hide();$activePanel=$subNav.find('.nav-item[data-type="'+typeid+'"]');$activePanelBackBtn=$activePanel.find('span a');$dropNav.hide();$activePanel.show();handleSubDropAnimationComplete=function(){var handleSubDropBackClick=function(){handleSubDropClose();$activePanelBackBtn.off("click");};$activePanel.find('span a').click(handleSubDropBackClick);subDropIsOpen=true;}
$subNav.show().animate({opacity:1,width:"100%"},300,handleSubDropAnimationComplete);}};$dropNav.find("li a").each(function(){$(this).click(handleDropNavClick);});$(document).click(handleDocumentClick);};$dropNav.attr("data-state","transition");$dropNav.slideDown(handleAnimationComplete);}else if(curState==="display"){closeAllNav();}};$dropNav.attr("data-state","hidden");$navBtn.click(handleNavClick)}};findNav();}
return{init:megaMenu};});;