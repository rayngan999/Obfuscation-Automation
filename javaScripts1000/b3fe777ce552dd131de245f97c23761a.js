(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{847:
/*!******************************************!*\
  !*** ../node_modules/hls.js/dist/hls.js ***!
  \******************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,r){var i;i=function(){return a={},i.m=r=[function(t,e,r){"use strict";r.d(e,"a",function(){return l}),r.d(e,"b",function(){return u});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function a(){}var n={trace:a,debug:a,log:a,warn:a,info:a,error:a},o=n;function s(n){var o=self.console[n];return o?function(){for(var t,e,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];i[0]&&(i[0]=(t=n,e=i[0],e="["+t+"] > "+e)),o.apply(self.console,i)}:a}var l=function(t){if(!0===t||"object"===("undefined"==typeof t?"undefined":i(t))){!function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(t){o[t]=e[t]?e[t].bind(e):s(t)})}(t,"debug","log","info","warn","error");try{o.log()}catch(t){o=n}}else o=n},u=o},function(t,e,r){"use strict";e.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(t,e,r){"use strict";r.d(e,"b",function(){return i}),r.d(e,"a",function(){return a});var i={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},a={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(t,e,r){"use strict";r.d(e,"b",function(){return i});s.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},s.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},s.getID3Data=function(t,e){for(var r=e,i=0;s.isHeader(t,e);)i+=10,i+=s._readSize(t,e+6),s.isFooter(t,e+10)&&(i+=10),e+=i;if(0<i)return t.subarray(r,r+i)},s._readSize=function(t,e){var r=(127&t[e])<<21;return r|=(127&t[e+1])<<14,r|=(127&t[e+2])<<7,r|=127&t[e+3]},s.getTimeStamp=function(t){for(var e=s.getID3Frames(t),r=0;r<e.length;r++){var i=e[r];if(s.isTimeStampFrame(i))return s._readTimeStamp(i)}},s.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},s._getFrameData=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),r=s._readSize(t,4);return{type:e,size:r,data:t.subarray(10,10+r)}},s.getID3Frames=function(t){for(var e=0,r=[];s.isHeader(t,e);){for(var i=s._readSize(t,e+6),a=(e+=10)+i;e+8<a;){var n=s._getFrameData(t.subarray(e)),o=s._decodeFrame(n);o&&r.push(o),e+=n.size+10}s.isFooter(t,e)&&(e+=10)}return r},s._decodeFrame=function(t){return"PRIV"===t.type?s._decodePrivFrame(t):"T"===t.type[0]?s._decodeTextFrame(t):"W"===t.type[0]?s._decodeURLFrame(t):void 0},s._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),t=1&e[3],e=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return e/=45,t&&(e+=47721858.84),Math.round(e)}},s._decodePrivFrame=function(t){if(!(t.size<2)){var e=s._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}},s._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,r=s._utf8ArrayToStr(t.data.subarray(1));e+=r.length+1;e=s._utf8ArrayToStr(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=s._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:e}}},s._decodeURLFrame=function(t){if("WXXX"!==t.type){var e=s._utf8ArrayToStr(t.data);return{key:t.type,data:e}}if(!(t.size<2)){var r=1,e=s._utf8ArrayToStr(t.data.subarray(1));r+=e.length+1;r=s._utf8ArrayToStr(t.data.subarray(r));return{key:t.type,info:e,data:r}}},s._utf8ArrayToStr=function(t){for(var e,r,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=t.length,n=void 0,o="",s=0;s<a;){if(0===(e=t[s++])&&i)return o;if(0!==e&&3!==e)switch(e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:n=t[s++],o+=String.fromCharCode((31&e)<<6|63&n);break;case 14:n=t[s++],r=t[s++],o+=String.fromCharCode((15&e)<<12|(63&n)<<6|(63&r)<<0)}}return o},r=s;function s(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s)}var i=r._utf8ArrayToStr;e.a=r},function(t,e,r){"use strict";function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.subtle=t,this.aesIV=e}var s=(i.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},i);function a(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),this.subtle=t,this.key=e}var l=(a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a);function n(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var u=(n.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},n.prototype.initTable=function(){for(var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],a=r[1],n=r[2],o=r[3],r=this.invSubMix,s=r[0],l=r[1],u=r[2],d=r[3],c=new Uint32Array(256),h=0,f=0,p=0,p=0;p<256;p++)c[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var g=f^f<<1^f<<2^f<<3^f<<4;t[h]=g=g>>>8^255&g^99;var y=c[e[g]=h],v=c[y],m=c[v],_=257*c[g]^16843008*g;i[h]=_<<24|_>>>8,a[h]=_<<16|_>>>16,n[h]=_<<8|_>>>24,o[h]=_,s[g]=(_=16843009*m^65537*v^257*y^16843008*h)<<24|_>>>8,l[g]=_<<16|_>>>16,u[g]=_<<8|_>>>24,d[g]=_,h?(h=y^c[c[c[m^y]]],f^=c[c[f]]):h=f=1}},n.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var a=this.keySize=e.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);for(var n=this.ksRows=4*(a+6+1),o=void 0,s=void 0,l=this.keySchedule=new Uint32Array(n),u=this.invKeySchedule=new Uint32Array(n),d=this.sBox,c=this.rcon,t=this.invSubMix,h=t[0],f=t[1],p=t[2],g=t[3],y=void 0,v=void 0,o=0;o<n;o++)o<a?y=l[o]=e[o]:(v=y,o%a==0?(v=d[(v=v<<8|v>>>24)>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[255&v],v^=c[o/a|0]<<24):6<a&&o%a==4&&(v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[255&v]),l[o]=y=(l[o-a]^v)>>>0);for(s=0;s<n;s++)o=n-s,v=3&s?l[o]:l[o-4],u[s]=s<4||o<=4?v:h[d[v>>>24]]^f[d[v>>>16&255]]^p[d[v>>>8&255]]^g[d[255&v]],u[s]=u[s]>>>0}},n.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},n.prototype.decrypt=function(t,e,r){for(var i,a,n,o,s,l,u=this.keySize+6,d=this.invKeySchedule,c=this.invSBox,h=this.invSubMix,f=h[0],p=h[1],g=h[2],y=h[3],r=this.uint8ArrayToUint32Array_(r),v=r[0],m=r[1],_=r[2],b=r[3],E=new Int32Array(t),T=new Int32Array(E.length),w=void 0,R=void 0,S=void 0,A=void 0,L=void 0,D=void 0,k=void 0,O=void 0,I=this.networkToHostOrderSwap;e<E.length;){for(i=I(E[e]),a=I(E[e+1]),n=I(E[e+2]),o=I(E[e+3]),L=i^d[0],D=o^d[1],k=n^d[2],O=a^d[3],s=4,l=1;l<u;l++)w=f[L>>>24]^p[D>>16&255]^g[k>>8&255]^y[255&O]^d[s],R=f[D>>>24]^p[k>>16&255]^g[O>>8&255]^y[255&L]^d[s+1],S=f[k>>>24]^p[O>>16&255]^g[L>>8&255]^y[255&D]^d[s+2],A=f[O>>>24]^p[L>>16&255]^g[D>>8&255]^y[255&k]^d[s+3],L=w,D=R,k=S,O=A,s+=4;w=c[L>>>24]<<24^c[D>>16&255]<<16^c[k>>8&255]<<8^c[255&O]^d[s],R=c[D>>>24]<<24^c[k>>16&255]<<16^c[O>>8&255]<<8^c[255&L]^d[s+1],S=c[k>>>24]<<24^c[O>>16&255]<<16^c[L>>8&255]<<8^c[255&D]^d[s+2],A=c[O>>>24]<<24^c[L>>16&255]<<16^c[D>>8&255]<<8^c[255&k]^d[s+3],s+=3,T[e]=I(w^v),T[e+1]=I(A^m),T[e+2]=I(S^_),T[e+3]=I(R^b),v=i,m=a,_=n,b=o,e+=4}return T.buffer},n.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},n),o=r(2),d=r(0);c.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},c.prototype.decrypt=function(e,r,i,a){var t,n,o=this;this.disableWebCrypto&&this.config.enableSoftwareAES?(this.logEnabled&&(d.b.log("JS AES decrypt"),this.logEnabled=!1),(t=this.decryptor)||(this.decryptor=t=new u),t.expandKey(r),a(t.decrypt(e,0,i))):(this.logEnabled&&(d.b.log("WebCrypto AES decrypt"),this.logEnabled=!1),n=this.subtle,this.key!==r&&(this.key=r,this.fastAesKey=new l(n,r)),this.fastAesKey.expandKey().then(function(t){new s(n,i).decrypt(e,t).catch(function(t){o.onWebCryptoError(t,e,r,i,a)}).then(function(t){a(t)})}).catch(function(t){o.onWebCryptoError(t,e,r,i,a)}))},c.prototype.onWebCryptoError=function(t,e,r,i,a){this.config.enableSoftwareAES?(d.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,r,i,a)):(d.b.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},c.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},r=c;function c(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),this.observer=t,this.config=e,this.logEnabled=!0;try{var r=crypto||self.crypto;this.subtle=r.subtle||r.webkitSubtle}catch(t){}this.disableWebCrypto=!this.subtle}e.a=r},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(t){return"function"==typeof t}function u(t){return"object"==typeof t&&null!==t}function d(t){return void 0===t}((t.exports=i).EventEmitter=i).prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,r,i,a,n,o;if(this._events||(this._events={}),"error"===t&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var s=new Error('Uncaught, unspecified "error" event. ('+e+")");throw s.context=e,s}if(d(r=this._events[t]))return!1;if(l(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(u(r))for(a=Array.prototype.slice.call(arguments,1),i=(o=r.slice()).length,n=0;n<i;n++)o[n].apply(this,a);return!0},i.prototype.on=i.prototype.addListener=function(t,e){var r;if(!l(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,l(e.listener)?e.listener:e),this._events[t]?u(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,u(this._events[t])&&!this._events[t].warned&&(r=d(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.once=function(t,e){if(!l(e))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(t,i),r||(r=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var r,i,a,n;if(!l(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(r=this._events[t]).length,i=-1,r===e||l(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(u(r)){for(n=a;0<n--;)if(r[n]===e||r[n].listener&&r[n].listener===e){i=n;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(l(r=this._events[t]))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){t=this._events&&this._events[t]?l(this._events[t])?[this._events[t]]:this._events[t].slice():[];return t},i.prototype.listenerCount=function(t){if(this._events){t=this._events[t];if(l(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,r){var i,o,a,n,s;i=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,o=/^([^\/;?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var i=this.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");return i.path=s.normalizePath(i.path),s.buildURLFromParts(i)}i=this.parseURL(e);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=s.normalizePath(i.path),s.buildURLFromParts(i)):e;var a=this.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");!a.netLoc&&a.path&&"/"!==a.path[0]&&(n=o.exec(a.path),a.netLoc=n[1],a.path=n[2]),a.netLoc&&!a.path&&(a.path="/");var n,t={scheme:a.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};return i.netLoc||(t.netLoc=a.netLoc,"/"!==i.path[0]&&(i.path?(n=(n=a.path).substring(0,n.lastIndexOf("/")+1)+i.path,t.path=s.normalizePath(n)):(t.path=a.path,i.params||(t.params=a.params,i.query||(t.query=a.query))))),null===t.path&&(t.path=r.alwaysNormalize?s.normalizePath(i.path):i.path),s.buildURLFromParts(t)},parseURL:function(t){t=i.exec(t);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(a,"");t.length!==(t=t.replace(n,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s},function(t,e,r){"use strict";var q=r(1),H=r(2),g=r(4),W=r(0);function i(t,e){return 255===t[e]&&240==(246&t[e+1])}function s(t,e){return 1&t[e+1]?7:9}function l(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function p(t,e){return!!(e+1<t.length&&i(t,e))}function y(t,e,r,i,a){t.samplerate||(a=function(t,e,r,i){var a,n,o=navigator.userAgent.toLowerCase(),s=i,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],u=1+((192&e[r+2])>>>6),d=(60&e[r+2])>>>2;if(!(l.length-1<d))return a=(1&e[r+2])<<2,a|=(192&e[r+3])>>>6,W.b.log("manifest codec:"+i+",ADTS data:type:"+u+",sampleingIndex:"+d+"["+l[d]+"Hz],channelConfig:"+a),i=/firefox/i.test(o)?6<=d?(u=5,n=new Array(4),d-3):(u=2,n=new Array(2),d):-1!==o.indexOf("android")?(u=2,n=new Array(2),d):(u=5,n=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&6<=d?d-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(6<=d&&1==a||/vivaldi/i.test(o))||!i&&1==a)&&(u=2,n=new Array(2)),d)),n[0]=u<<3,n[0]|=(14&d)>>1,n[1]|=(1&d)<<7,n[1]|=a<<3,5===u&&(n[1]|=(14&i)>>1,n[2]=(1&i)<<7,n[2]|=8,n[3]=0),{config:n,samplerate:l[d],channelCount:a,codec:"mp4a.40."+u,manifestCodec:s};t.trigger(Event.ERROR,{type:H.b.MEDIA_ERROR,details:H.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+d})}(e,r,i,a),t.config=a.config,t.samplerate=a.samplerate,t.channelCount=a.channelCount,t.codec=a.codec,t.manifestCodec=a.manifestCodec,W.b.log("parsed codec:"+t.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount))}function f(t){return 9216e4/t}function v(t,e,r,i,a){var n=function(t,e,r,i,a){var n=t.length,o=s(t,e),t=l(t,e);if(0<(t-=o)&&e+o+t<=n)return{headerLength:o,frameLength:t,stamp:r+i*a}}(e,r,i,a,f(t.samplerate));if(n){i=n.stamp,a=n.headerLength,n=n.frameLength,i={unit:e.subarray(r+a,r+a+n),pts:i,dts:i};return t.samples.push(i),t.len+=n,{sample:i,length:n+a}}}var m=r(3);function a(t,e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),this.observer=t,this.config=r,this.remuxer=e}var w=(a.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(t){if(!t)return!1;for(var e=(m.a.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(function(t,e){if(e+1<t.length&&i(t,e)){var r=s(t,e),r=e+(e+5<t.length?l(t,e):r);if(r===t.length||r+1<t.length&&i(t,r))return 1}}(t,e))return W.b.log("ADTS sync word found !"),!0;return!1},a.prototype.append=function(t,e,r,i){for(var a=this._audioTrack,n=m.a.getID3Data(t,0)||[],o=m.a.getTimeStamp(n),s=o?90*o:9e4*e,l=0,u=s,d=t.length,c=n.length,h=[{pts:u,dts:u,data:n}];c<d-1;)if(p(t,c)&&c+5<d){y(a,this.observer,t,c,a.manifestCodec);var f=v(a,t,c,s,l);if(!f){W.b.log("Unable to parse AAC frame");break}c+=f.length,u=f.sample.pts,l++}else m.a.isHeader(t,c)?(n=m.a.getID3Data(t,c),h.push({pts:u,dts:u,data:n}),c+=n.length):c++;this.remuxer.remux(a,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},e,r,i)},a.prototype.destroy=function(){},a);var n=Math.pow(2,32)-1;function u(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),this.observer=t,this.remuxer=e}var R=(u.prototype.resetTimeStamp=function(t){this.initPTS=t},u.prototype.resetInitSegment=function(t,e,r,i){var a,n;t&&t.byteLength?(null==e&&(e="mp4a.40.5"),null==r&&(r="avc1.42e01e"),n={},(a=this.initData=u.parseInitSegment(t)).audio&&a.video?n.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:i?t:null}:(a.audio&&(n.audio={container:"audio/mp4",codec:e,initSegment:i?t:null}),a.video&&(n.video={container:"video/mp4",codec:r,initSegment:i?t:null})),this.observer.trigger(q.a.FRAG_PARSING_INIT_SEGMENT,{tracks:n})):(e&&(this.audioCodec=e),r&&(this.videoCodec=r))},u.probe=function(t){return 0<u.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length},u.bin2str=function(t){return String.fromCharCode.apply(null,t)},u.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);e=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return e<0?4294967296+e:e},u.writeUint32=function(t,e,r){t.data&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r},u.findBox=function(t,e){var r,i,a,n,o,s=[];if(t.data?(n=t.start,i=t.end,t=t.data):(n=0,i=t.byteLength),!e.length)return null;for(r=n;r<i;)o=1<(a=u.readUint32(t,r))?r+a:i,u.bin2str(t.subarray(r+4,r+8))===e[0]&&(1===e.length?s.push({data:t,start:r+8,end:o}):(a=u.findBox({data:t,start:r+8,end:o},e.slice(1))).length&&(s=s.concat(a))),r=o;return s},u.parseInitSegment=function(t){var a=[];return u.findBox(t,["moov","trak"]).forEach(function(t){var e,r,i=u.findBox(t,["tkhd"])[0];i&&(r=i.data[i.start],e=u.readUint32(i,0===r?12:20),(i=u.findBox(t,["mdia","mdhd"])[0])&&(r=i.data[i.start],i=u.readUint32(i,0===r?12:20),!(r=u.findBox(t,["mdia","hdlr"])[0])||(r={soun:"audio",vide:"video"}[u.bin2str(r.data.subarray(r.start+8,r.start+12))])&&((t=u.findBox(t,["mdia","minf","stbl","stsd"])).length&&(t=t[0],t=u.bin2str(t.data.subarray(t.start+12,t.start+16)),W.b.log("MP4Demuxer:"+r+":"+t+" found")),a[e]={timescale:i,type:r},a[r]={timescale:i,id:e})))}),a},u.getStartDTS=function(r,t){var t=u.findBox(t,["moof","traf"]),t=[].concat.apply([],t.map(function(e){return u.findBox(e,["tfhd"]).map(function(t){var t=u.readUint32(t,4),t=r[t].timescale||9e4;return u.findBox(e,["tfdt"]).map(function(t){var e=t.data[t.start],r=u.readUint32(t,4);return 1===e&&(r*=Math.pow(2,32),r+=u.readUint32(t,8)),r})[0]/t})})),t=Math.min.apply(null,t);return isFinite(t)?t:0},u.offsetStartDTS=function(r,t,a){u.findBox(t,["moof","traf"]).map(function(e){return u.findBox(e,["tfhd"]).map(function(t){var t=u.readUint32(t,4),i=r[t].timescale||9e4;u.findBox(e,["tfdt"]).map(function(t){var e=t.data[t.start],r=u.readUint32(t,4);0===e?u.writeUint32(t,4,r-a*i):(r*=Math.pow(2,32),r+=u.readUint32(t,8),r-=a*i,r=Math.max(r,0),e=Math.floor(r/(1+n)),r=Math.floor(r%(1+n)),u.writeUint32(t,4,e),u.writeUint32(t,8,r))})})})},u.prototype.append=function(t,e,r,i){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec),a=this.initData);var n,o,s=this.initPTS;void 0===s&&(o=u.getStartDTS(a,t),this.initPTS=s=o-e,this.observer.trigger(q.a.INIT_PTS_FOUND,{initPTS:s})),u.offsetStartDTS(a,t,s),n=u.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,n,r,i,t)},u.prototype.destroy=function(){},u),d={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,r,i,a){if(!(r+24>e.length)){var n=this.parseHeader(e,r);if(n&&r+n.frameLength<=e.length){a=i+a*(9e4*n.samplesPerFrame/n.sampleRate),a={unit:e.subarray(r,r+n.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=n.channelCount,t.samplerate=n.sampleRate,t.samples.push(a),t.len+=n.frameLength,{sample:a,length:n.frameLength}}}},parseHeader:function(t,e){var r=t[e+1]>>3&3,i=t[e+1]>>1&3,a=t[e+2]>>4&15,n=t[e+2]>>2&3,o=t[e+2]>>1&1;if(1!=r&&0!=a&&15!=a&&3!=n){a=1e3*d.BitratesMap[14*(3==r?3-i:3==i?3:4)+a-1],n=d.SamplingRateMap[3*(3==r?0:2==r?1:2)+n],t=t[e+3]>>6==3?1:2,e=d.SamplesCoefficients[r][i],r=d.BytesInSlot[i],i=8*e*r;return{sampleRate:n,channelCount:t,frameLength:parseInt(e*a/n+o,10)*r,samplesPerFrame:i}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var r=this.parseHeader(t,e),i=4,i=e+(i=r&&r.frameLength?r.frameLength:i);if(i===t.length||i+1<t.length&&this.isHeaderPattern(t,i))return!0}return!1}},_=d;function o(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var S=(o.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),e=Math.min(4,e);if(0===e)throw new Error("no bytes available");i.set(t.subarray(r,r+e)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},o.prototype.skipBits=function(t){var e;this.bitsAvailable>t||(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},o.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return 32<t&&W.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,0<this.bitsAvailable?this.word<<=e:0<this.bytesAvailable&&this.loadWord(),0<(e=t-e)&&this.bitsAvailable?r<<e|this.readBits(e):r},o.prototype.skipLZ=function(){for(var t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},o.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},o.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},o.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},o.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},o.prototype.readBoolean=function(){return 1===this.readBits(1)},o.prototype.readUByte=function(){return this.readBits(8)},o.prototype.readUShort=function(){return this.readBits(16)},o.prototype.readUInt=function(){return this.readBits(32)},o.prototype.skipScalingList=function(t){for(var e=8,r=8,i=0;i<t;i++)e=0===(r=0!==r?(e+this.readEG()+256)%256:r)?e:r},o.prototype.readSPS=function(){var t,e,r,i,a=0,n=0,o=0,s=0,l=this.readUByte.bind(this),u=this.readBits.bind(this),d=this.readUEG.bind(this),c=this.readBoolean.bind(this),h=this.skipBits.bind(this),f=this.skipEG.bind(this),p=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);if(l(),t=l(),u(5),h(3),l(),p(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var y=d();if(3===y&&h(1),p(),p(),h(1),c())for(r=3!==y?8:12,i=0;i<r;i++)c()&&g(i<6?16:64)}p();var y=d();if(0===y)d();else if(1===y)for(h(1),f(),f(),e=d(),i=0;i<e;i++)f();p(),h(1),y=d(),p=d(),0===(u=u(1))&&h(1),h(1),c()&&(a=d(),n=d(),o=d(),s=d());var v=[1,1];if(c()&&c())switch(l()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[l()<<8|l(),l()<<8|l()]}return{width:Math.ceil(16*(y+1)-2*a-2*n),height:(2-u)*(p+1)*16-(u?2:4)*(o+s),pixelRatio:v}},o.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},o);function c(t,e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),this.decryptdata=r,this.discardEPB=i,this.decrypter=new g.a(t,e)}var h=(c.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},c.prototype.decryptAacSample=function(e,r,i,a){var n=e[r].unit,t=n.subarray(16,n.length-n.length%16),t=t.buffer.slice(t.byteOffset,t.byteOffset+t.length),o=this;this.decryptBuffer(t,function(t){t=new Uint8Array(t),n.set(t,16),a||o.decryptAacSamples(e,r+1,i)})},c.prototype.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,i),!i)return}}},c.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,a=32;a<=t.length-16;a+=160,i+=16)r.set(t.subarray(a,a+16),i);return r},c.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var r=0,i=32;i<=t.length-16;i+=160,r+=16)t.set(e.subarray(r,r+16),i);return t},c.prototype.decryptAvcSample=function(e,r,i,a,n,o){var s=this.discardEPB(n.data),t=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(t.buffer,function(t){n.data=l.getAvcDecryptedUnit(s,t),o||l.decryptAvcSamples(e,r,i+1,a)})},c.prototype.decryptAvcSamples=function(t,e,r,i){for(;;e++,r=0){if(e>=t.length)return void i();for(var a=t[e].units;!(r>=a.length);r++){var n=a[r];if(!(n.length<=48||1!==n.type&&5!==n.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,i,n,o),!o)return}}}},c);var b={video:0,audio:1,id3:2,text:3};function I(t,e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,I),this.observer=t,this.config=r,this.typeSupported=i,this.remuxer=e,this.sampleAes=null}var A=(I.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new h(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},I.probe=function(t){t=I._syncOffset(t);return!(t<0)&&(t&&W.b.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),!0)},I._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),r=0;r<e;){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},I.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:b[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},I.prototype.resetInitSegment=function(t,e,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=I.createTrack("video",i),this._audioTrack=I.createTrack("audio",i),this._id3Track=I.createTrack("id3",i),this._txtTrack=I.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=r,this._duration=i},I.prototype.resetTimeStamp=function(){},I.prototype.append=function(t,e,r,i){var a,n,o,s,l,u=t.length,d=!1;this.contiguous=r;var c=this.pmtParsed,h=this._avcTrack,f=this._audioTrack,p=this._id3Track,g=h.pid,y=f.pid,v=p.pid,m=this._pmtId,_=h.pesData,b=f.pesData,E=p.pesData,T=this._parsePAT,w=this._parsePMT,R=this._parsePES,S=this._parseAVCPES.bind(this),A=this._parseAACPES.bind(this),L=this._parseMPEGPES.bind(this),D=this._parseID3PES.bind(this),k=I._syncOffset(t);for(u-=(u+k)%188,a=k;a<u;a+=188)if(71===t[a]){if(n=!!(64&t[a+1]),o=((31&t[a+1])<<8)+t[a+2],1<(48&t[a+3])>>4){if((s=a+5+t[a+4])===a+188)continue}else s=a+4;switch(o){case g:n&&(_&&(l=R(_))&&S(l,!1),_={data:[],size:0}),_&&(_.data.push(t.subarray(s,a+188)),_.size+=a+188-s);break;case y:n&&(b&&(l=R(b))&&(f.isAAC?A:L)(l),b={data:[],size:0}),b&&(b.data.push(t.subarray(s,a+188)),b.size+=a+188-s);break;case v:n&&(E&&(l=R(E))&&D(l),E={data:[],size:0}),E&&(E.data.push(t.subarray(s,a+188)),E.size+=a+188-s);break;case 0:n&&(s+=t[s]+1),m=this._pmtId=T(t,s);break;case m:n&&(s+=t[s]+1);var O=w(t,s,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(g=O.avc)&&(h.pid=g),0<(y=O.audio)&&(f.pid=y,f.isAAC=O.isAAC),0<(v=O.id3)&&(p.pid=v),d&&!c&&(W.b.log("reparse from beginning"),d=!1,a=k-188),c=this.pmtParsed=!0;break;case 17:case 8191:break;default:d=!0}}else this.observer.trigger(q.a.ERROR,{type:H.b.MEDIA_ERROR,details:H.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});_&&(l=R(_))?(S(l,!0),h.pesData=null):h.pesData=_,b&&(l=R(b))?((f.isAAC?A:L)(l),f.pesData=null):(b&&b.size&&W.b.log("last AAC PES packet truncated,might overlap between fragments"),f.pesData=b),E&&(l=R(E))?(D(l),p.pesData=null):p.pesData=E,null==this.sampleAes?this.remuxer.remux(f,h,p,this._txtTrack,e,r,i):this.decryptAndRemux(f,h,p,this._txtTrack,e,r,i)},I.prototype.decryptAndRemux=function(t,e,r,i,a,n,o){var s;t.samples&&t.isAAC?(s=this).sampleAes.decryptAacSamples(t.samples,0,function(){s.decryptAndRemuxAvc(t,e,r,i,a,n,o)}):this.decryptAndRemuxAvc(t,e,r,i,a,n,o)},I.prototype.decryptAndRemuxAvc=function(t,e,r,i,a,n,o){var s;e.samples?(s=this).sampleAes.decryptAvcSamples(e.samples,0,0,function(){s.remuxer.remux(t,e,r,i,a,n,o)}):this.remuxer.remux(t,e,r,i,a,n,o)},I.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},I.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},I.prototype._parsePMT=function(t,e,r,i){var a,n={audio:-1,avc:-1,id3:-1,isAAC:!0},o=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<o;){switch(a=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!i){W.b.log("unkown stream type:"+t[e]);break}case 15:-1===n.audio&&(n.audio=a);break;case 21:-1===n.id3&&(n.id3=a);break;case 219:if(!i){W.b.log("unkown stream type:"+t[e]);break}case 27:-1===n.avc&&(n.avc=a);break;case 3:case 4:r?-1===n.audio&&(n.audio=a,n.isAAC=!1):W.b.log("MPEG audio found, not supported in this browser for now");break;case 36:W.b.warn("HEVC stream type found, not supported for now");break;default:W.b.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return n},I.prototype._parsePES=function(t){var e,r,i,a,n,o=0,s=t.data;if(!t||0===t.size)return null;for(;s[0].length<19&&1<s.length;){var l=new Uint8Array(s[0].length+s[1].length);l.set(s[0]),l.set(s[1],s[0].length),s[0]=l,s.splice(1,1)}if(1!==((h=s[0])[0]<<16)+(h[1]<<8)+h[2])return null;if((e=(h[4]<<8)+h[5])&&e>t.size-6)return null;192&(r=h[7])&&(4294967295<(i=536870912*(14&h[9])+4194304*(255&h[10])+16384*(254&h[11])+128*(255&h[12])+(254&h[13])/2)&&(i-=8589934592),64&r?(4294967295<(a=536870912*(14&h[14])+4194304*(255&h[15])+16384*(254&h[16])+128*(255&h[17])+(254&h[18])/2)&&(a-=8589934592),54e5<i-a&&(W.b.warn(Math.round((i-a)/9e4)+"s delta between PTS and DTS, align them"),i=a)):a=i),r=h[8],t.size-=n=r+9;for(var u=new Uint8Array(t.size),d=0,c=s.length;d<c;d++){var h,f=(h=s[d]).byteLength;if(n){if(f<n){n-=f;continue}h=h.subarray(n),f-=n,n=0}u.set(h,o),o+=f}return e&&(e-=r+3),{data:u,pts:i,dts:a,len:e}},I.prototype.pushAccesUnit=function(t,e){var r,i;t.units.length&&t.frame&&(i=(r=e.samples).length,!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(i||this.contiguous)?(t.id=i,r.push(t)):e.dropped++),t.debug.length&&W.b.log(t.pts+"/"+t.dts+":"+t.debug)},I.prototype._parseAVCPES=function(f,t){function p(t,e,r,i){return{key:t,pts:e,dts:r,units:[],debug:i}}var g,y,v,m=this,_=this._avcTrack,e=this._parseAVCNALu(f.data),b=this.avcSample,E=!1,T=this.pushAccesUnit.bind(this);f.data=null,b&&e.length&&!_.audFound&&(T(b,_),b=this.avcSample=p(!1,f.pts,f.dts,"")),e.forEach(function(t){switch(t.type){case 1:y=!0,(b=b||(m.avcSample=p(!0,f.pts,f.dts,""))).frame=!0;var e=t.data;E&&4<e.length&&(2!==(u=new S(e).readSliceType())&&4!==u&&7!==u&&9!==u||(b.key=!0));break;case 5:y=!0,(b=b||(m.avcSample=p(!0,f.pts,f.dts,""))).key=!0,b.frame=!0;break;case 6:y=!0,(g=new S(m.discardEPB(t.data))).readUByte();for(var r=0,i=0,a=!1,n=0;!a&&1<g.bytesAvailable;){for(r=0;r+=n=g.readUByte(),255===n;);for(i=0;i+=n=g.readUByte(),255===n;);if(4===r&&0!==g.bytesAvailable){var a=!0,o=g.readUByte();if(181===o)if(49===g.readUShort()){o=g.readUInt();if(1195456820===o)if(3===g.readUByte()){var o=g.readUByte(),s=31&o,l=[o,g.readUByte()];for(v=0;v<s;v++)l.push(g.readUByte()),l.push(g.readUByte()),l.push(g.readUByte());m._insertSampleInOrder(m._txtTrack.samples,{type:3,pts:f.pts,bytes:l})}}}else if(i<g.bytesAvailable)for(v=0;v<i;v++)g.readUByte()}break;case 7:if(E=y=!0,!_.sps){var u=(g=new S(t.data)).readSPS();_.width=u.width,_.height=u.height,_.pixelRatio=u.pixelRatio,_.sps=[t.data],_.duration=m._duration;var d=t.data.subarray(1,4),c="avc1.";for(v=0;v<3;v++){var h=d[v].toString(16);c+=h=h.length<2?"0"+h:h}_.codec=c}break;case 8:y=!0,_.pps||(_.pps=[t.data]);break;case 9:y=!1,_.audFound=!0,b&&T(b,_),b=m.avcSample=p(!1,f.pts,f.dts,"");break;case 12:y=!1;break;default:y=!1,b&&(b.debug+="unknown NAL "+t.type+" ")}b&&y&&b.units.push(t)}),t&&b&&(T(b,_),this.avcSample=null)},I.prototype._insertSampleInOrder=function(t,e){var r=t.length;if(0<r){if(e.pts>=t[r-1].pts)t.push(e);else for(var i=r-1;0<=i;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)},I.prototype._getLastNalUnit=function(){var t,e=this.avcSample,r=void 0;return r=(e=!e||0===e.units.length?(t=this._avcTrack.samples)[t.length-1]:e)?(e=e.units)[e.length-1]:r},I.prototype._parseAVCNALu=function(t){var e,r,i,a,n,o=0,s=t.byteLength,l=this._avcTrack,u=p=l.naluState||0,d=[],c=-1;for(-1===p&&(i=31&t[c=0],p=0,o=1);o<s;){var h,f,p,g=t[o++];p?p=1!==p?g?1===g?(0<=c?(r={data:t.subarray(c,o-p-1),type:i},d.push(r)):(h=this._getLastNalUnit())&&(u&&o<=4-u&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-u)),0<(e=o-p-1)&&((f=new Uint8Array(h.data.byteLength+e)).set(h.data,0),f.set(t.subarray(0,e),h.data.byteLength),h.data=f)),o<s?(i=31&t[c=o],0):-1):0:3:g?0:2:p=g?0:1}return 0<=c&&0<=p&&(r={data:t.subarray(c,s),type:i,state:p},d.push(r)),0!==d.length||(a=this._getLastNalUnit())&&((n=new Uint8Array(a.data.byteLength+t.byteLength)).set(a.data,0),n.set(t,a.data.byteLength),a.data=n),l.naluState=p,d},I.prototype.discardEPB=function(t){for(var e=t.byteLength,r=[],i=1;i<e-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return t;for(var a=e-r.length,n=new Uint8Array(a),o=0,i=0;i<a;o++,i++)o===r[0]&&(o++,r.shift()),n[i]=t[o];return n},I.prototype._parseAACPES=function(t){var e,r,i,a,n=this._audioTrack,o=t.data,s=t.pts,l=this.aacOverFlow,u=this.aacLastPTS;for(l&&((t=new Uint8Array(l.byteLength+o.byteLength)).set(l,0),t.set(o,l.byteLength),o=t),r=0,a=o.length;r<a-1&&!p(o,r);r++);if(r){var d,c=r<a-1?(d="AAC PES did not start with ADTS header,offset:"+r,!1):(d="no ADTS header found in AAC PES",!0);if(W.b.warn("parsing error:"+d),this.observer.trigger(q.a.ERROR,{type:H.b.MEDIA_ERROR,details:H.a.FRAG_PARSING_ERROR,fatal:c,reason:d}),c)return}for(y(n,this.observer,o,r,this.audioCodec),e=0,c=f(n.samplerate),l&&u&&(c=u+c,1<Math.abs(c-s)&&(W.b.log("AAC: align PTS for overlapping frames by "+Math.round((c-s)/90)),s=c));r<a;)if(p(o,r)&&r+5<a){var h=v(n,o,r,s,e);if(!h)break;r+=h.length,i=h.sample.pts,e++}else r++;l=r<a?o.subarray(r,a):null,this.aacOverFlow=l,this.aacLastPTS=i},I.prototype._parseMPEGPES=function(t){for(var e=t.data,r=e.length,i=0,a=0,n=t.pts;a<r;)if(_.isHeader(e,a)){var o=_.appendFrame(this._audioTrack,e,a,n,i);if(!o)break;a+=o.length,i++}else a++},I.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},I);function E(t,e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,E),this.observer=t,this.config=r,this.remuxer=e}var L=(E.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},E.prototype.resetTimeStamp=function(){},E.probe=function(t){var e,r,i=m.a.getID3Data(t,0);if(i&&void 0!==m.a.getTimeStamp(i))for(e=i.length,r=Math.min(t.length-1,e+100);e<r;e++)if(_.probe(t,e))return W.b.log("MPEG Audio sync word found !"),!0;return!1},E.prototype.append=function(t,e,r,i){for(var a=m.a.getID3Data(t,0),n=m.a.getTimeStamp(a),o=n?90*n:9e4*e,s=a.length,l=t.length,u=0,d=0,c=this._audioTrack,h=[{pts:o,dts:o,data:a}];s<l;)if(_.isHeader(t,s)){var f=_.appendFrame(c,t,s,o,u);if(!f)break;s+=f.length,d=f.sample.pts,u++}else m.a.isHeader(t,s)?(a=m.a.getID3Data(t,s),h.push({pts:d,dts:d,data:a}),s+=a.length):s++;this.remuxer.remux(c,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},e,r,i)},E.prototype.destroy=function(){},E);function T(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,T)}var U=(T.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},T);var D=Math.pow(2,32)-1;function k(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,k)}var V=(k.init=function(){for(var t in k.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})k.types.hasOwnProperty(t)&&(k.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);k.HDLR_TYPES={video:e,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);k.STTS=k.STSC=k.STCO=a,k.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),k.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),k.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),k.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);e=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]);k.FTYP=k.box(k.types.ftyp,e,a,e,r),k.DINF=k.box(k.types.dinf,k.box(k.types.dref,i))},k.box=function(t){for(var e,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;a--;)i+=r[a].byteLength;for((e=new Uint8Array(i))[0]=i>>24&255,e[1]=i>>16&255,e[2]=i>>8&255,e[3]=255&i,e.set(t,4),a=0,i=8;a<n;a++)e.set(r[a],i),i+=r[a].byteLength;return e},k.hdlr=function(t){return k.box(k.types.hdlr,k.HDLR_TYPES[t])},k.mdat=function(t){return k.box(k.types.mdat,t)},k.mdhd=function(t,e){e*=t;var r=Math.floor(e/(1+D)),e=Math.floor(e%(1+D));return k.box(k.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},k.mdia=function(t){return k.box(k.types.mdia,k.mdhd(t.timescale,t.duration),k.hdlr(t.type),k.minf(t))},k.mfhd=function(t){return k.box(k.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},k.minf=function(t){return"audio"===t.type?k.box(k.types.minf,k.box(k.types.smhd,k.SMHD),k.DINF,k.stbl(t)):k.box(k.types.minf,k.box(k.types.vmhd,k.VMHD),k.DINF,k.stbl(t))},k.moof=function(t,e,r){return k.box(k.types.moof,k.mfhd(t),k.traf(r,e))},k.moov=function(t){for(var e=t.length,r=[];e--;)r[e]=k.trak(t[e]);return k.box.apply(null,[k.types.moov,k.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(k.mvex(t)))},k.mvex=function(t){for(var e=t.length,r=[];e--;)r[e]=k.trex(t[e]);return k.box.apply(null,[k.types.mvex].concat(r))},k.mvhd=function(t,e){e*=t;var r=Math.floor(e/(1+D)),e=Math.floor(e%(1+D)),e=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return k.box(k.types.mvhd,e)},k.sdtp=function(t){for(var e,r=t.samples||[],i=new Uint8Array(4+r.length),a=0;a<r.length;a++)e=r[a].flags,i[a+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return k.box(k.types.sdtp,i)},k.stbl=function(t){return k.box(k.types.stbl,k.stsd(t),k.box(k.types.stts,k.STTS),k.box(k.types.stsc,k.STSC),k.box(k.types.stsz,k.STSZ),k.box(k.types.stco,k.STCO))},k.avc1=function(t){for(var e,r,i=[],a=[],n=0;n<t.sps.length;n++)r=(e=t.sps[n]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(e));for(n=0;n<t.pps.length;n++)r=(e=t.pps[n]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(e));var o=k.box(k.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(a))),s=t.width,l=t.height,u=t.pixelRatio[0],d=t.pixelRatio[1];return k.box(k.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},k.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},k.mp4a=function(t){var e=t.samplerate;return k.box(k.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),k.box(k.types.esds,k.esds(t)))},k.mp3=function(t){var e=t.samplerate;return k.box(k.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},k.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?k.box(k.types.stsd,k.STSD,k.mp4a(t)):k.box(k.types.stsd,k.STSD,k.mp3(t)):k.box(k.types.stsd,k.STSD,k.avc1(t))},k.tkhd=function(t){var e=t.id,r=t.duration*t.timescale,i=t.width,a=t.height,t=Math.floor(r/(1+D)),r=Math.floor(r%(1+D));return k.box(k.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))},k.traf=function(t,e){var r=k.sdtp(t),i=t.id,a=Math.floor(e/(1+D)),e=Math.floor(e%(1+D));return k.box(k.types.traf,k.box(k.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),k.box(k.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,e>>24,e>>16&255,e>>8&255,255&e])),k.trun(t,r.length+16+20+8+16+8+8),r)},k.trak=function(t){return t.duration=t.duration||4294967295,k.box(k.types.trak,k.tkhd(t),k.mdia(t))},k.trex=function(t){t=t.id;return k.box(k.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},k.trun=function(t,e){var r,i,a,n,o,s=t.samples||[],l=s.length,t=12+16*l,u=new Uint8Array(t);for(u.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,(e+=8+t)>>>24&255,e>>>16&255,e>>>8&255,255&e],0),r=0;r<l;r++)i=(o=s[r]).duration,a=o.size,n=o.flags,o=o.cts,u.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,a>>>24&255,a>>>16&255,a>>>8&255,255&a,n.isLeading<<2|n.dependsOn,n.isDependedOn<<6|n.hasRedundancy<<4|n.paddingValue<<1|n.isNonSync,61440&n.degradPrio,15&n.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*r);return k.box(k.types.trun,u)},k.initSegment=function(t){k.types||k.init();var e=k.moov(t),t=new Uint8Array(k.FTYP.byteLength+e.byteLength);return t.set(k.FTYP),t.set(e,k.FTYP.byteLength),t},k);function O(t,e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,O),this.observer=t,this.config=e,this.typeSupported=r;r=navigator.userAgent;this.isSafari=i&&-1<i.indexOf("Apple")&&r&&!r.match("CriOS"),this.ISGenerated=!1}var x=(O.prototype.destroy=function(){},O.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},O.prototype.resetInitSegment=function(){this.ISGenerated=!1},O.prototype.remux=function(t,e,r,i,a,n,o){var s,l,u,d,c,h;this.ISGenerated||this.generateIS(t,e,a),this.ISGenerated&&(c=t.samples.length,s=e.samples.length,u=l=a,c&&s&&(d=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale,l+=Math.max(0,d),u+=Math.max(0,-d)),c?(t.timescale||(W.b.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,a)),c=this.remuxAudio(t,l,n,o),s&&(h=void 0,c&&(h=c.endPTS-c.startPTS),e.timescale||(W.b.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,a)),this.remuxVideo(e,u,n,h,o))):(h=void 0,(h=s?this.remuxVideo(e,u,n,o):h)&&t.codec&&this.remuxEmptyAudio(t,l,n,h))),r.samples.length&&this.remuxID3(r,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(q.a.FRAG_PARSED)},O.prototype.generateIS=function(t,e,r){var i,a,n=this.observer,o=t.samples,s=e.samples,l=this.typeSupported,u="audio/mp4",d={},c={tracks:d},h=void 0===this._initPTS;h&&(i=a=1/0),t.config&&o.length&&(t.timescale=t.samplerate,W.b.log("audio sampling rate : "+t.samplerate),t.isAAC||(l.mpeg?(u="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),d.audio={container:u,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array:V.initSegment([t]),metadata:{channelCount:t.channelCount}},h&&(i=a=o[0].pts-t.inputTimeScale*r)),e.sps&&e.pps&&s.length&&(t=e.inputTimeScale,e.timescale=t,d.video={container:"video/mp4",codec:e.codec,initSegment:V.initSegment([e]),metadata:{width:e.width,height:e.height}},h&&(i=Math.min(i,s[0].pts-t*r),a=Math.min(a,s[0].dts-t*r),this.observer.trigger(q.a.INIT_PTS_FOUND,{initPTS:i}))),Object.keys(d).length?(n.trigger(q.a.FRAG_PARSING_INIT_SEGMENT,c),this.ISGenerated=!0,h&&(this._initPTS=i,this._initDTS=a)):n.trigger(q.a.ERROR,{type:H.b.MEDIA_ERROR,details:H.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},O.prototype.remuxVideo=function(t,e,r,i,a){var n,o,s=8,l=t.timescale,u=t.samples,d=[],c=u.length,h=this._PTSNormalize,f=this._initDTS,p=this.nextAvcDts,g=this.isSafari;g&&(r|=u.length&&p&&(a&&Math.abs(e-p/l)<.1||Math.abs(u[0].pts-p-f)<l/5)),r||(p=e*l),u.forEach(function(t){t.pts=h(t.pts-f,p),t.dts=h(t.dts-f,p)}),u.sort(function(t,e){var r=t.dts-e.dts,i=t.pts-e.pts;return r||i||t.id-e.id});var y=u.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(y<0){W.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(y/90)+" ms to overcome this issue");for(var v=0;v<u.length;v++)u[v].dts+=y}var a=u[0],m=Math.max(a.dts,0),_=Math.max(a.pts,0),e=Math.round((m-p)/90);r&&e&&(1<e?W.b.log("AVC:"+e+" ms hole between fragments detected,filling it"):e<-1&&W.b.log("AVC:"+-e+" ms overlapping between fragments detected"),u[0].dts=m=p,_=Math.max(_-e,p),u[0].pts=_,W.b.log("Video/PTS/DTS adjusted: "+Math.round(_/90)+"/"+Math.round(m/90)+",delta:"+e+" ms")),a=u[u.length-1],r=Math.max(a.dts,0),e=Math.max(a.pts,0,r),g&&(n=Math.round((r-m)/(u.length-1)));for(var b=0,E=0,T=0;T<c;T++){for(var w=u[T],R=w.units,S=R.length,A=0,L=0;L<S;L++)A+=R[L].data.length;E+=A,b+=S,w.length=A,w.dts=g?m+T*n:Math.max(w.dts,m),w.pts=Math.max(w.pts,w.dts)}a=E+4*b+8;try{o=new Uint8Array(a)}catch(t){return void this.observer.trigger(q.a.ERROR,{type:H.b.MUX_ERROR,details:H.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:a,reason:"fail allocating video mdat "+a})}var D=new DataView(o.buffer);D.setUint32(0,a),o.set(V.types.mdat,4);for(var k=0;k<c;k++){for(var O,I,x,P=u[k],C=P.units,M=0,N=void 0,F=0,U=C.length;F<U;F++){var B=C[F],G=B.data,B=B.data.byteLength;D.setUint32(s,B),s+=4,o.set(G,s),s+=B,M+=4+B}N=g?Math.max(0,n*Math.round((P.pts-P.dts)/n)):(k<c-1?n=u[k+1].dts-P.dts:(x=this.config,O=P.dts-u[0<k?k-1:k].dts,x.stretchShortVideoTrack?(I=x.maxBufferHole,x=x.maxSeekHole,Math.floor(Math.min(I,x)*l)<(x=(i?_+i*l:this.nextAudioPts)-P.pts)?((n=x-O)<0&&(n=O),W.b.log("It is approximately "+x/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=O):n=O),Math.round(P.pts-P.dts)),d.push({size:M,duration:n,cts:N,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:P.key?2:1,isNonSync:P.key?0:1}})}this.nextAvcDts=r+n;var j,r=t.dropped;t.len=0,t.nbNalu=0,t.dropped=0,d.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")&&((j=d[0].flags).dependsOn=2,j.isNonSync=0),t.samples=d,j=V.moof(t.sequenceNumber++,m,t),t.samples=[];r={data1:j,data2:o,startPTS:_/l,endPTS:(e+n)/l,startDTS:m/l,endDTS:this.nextAvcDts/l,type:"video",nb:d.length,dropped:r};return this.observer.trigger(q.a.FRAG_PARSING_DATA,r),r},O.prototype.remuxAudio=function(t,e,r,i){var a,n,o,s,l=t.inputTimeScale,u=t.timescale,d=l/u,c=(t.isAAC?1024:1152)*d,h=this._PTSNormalize,f=this._initDTS,p=!t.isAAC&&this.typeSupported.mpeg,g=t.samples,y=[],v=this.nextAudioPts;if(r|=g.length&&v&&(i&&Math.abs(e-v/l)<.1||Math.abs(g[0].pts-v-f)<20*c),g.forEach(function(t){t.pts=t.dts=h(t.pts-f,e*l)}),0!==(g=g.filter(function(t){return 0<=t.pts})).length){if(r||(v=i?e*l:g[0].pts),t.isAAC)for(var m=this.config.maxAudioFramesDrift,_=0,b=v;_<g.length;){var E=g[_],T=E.pts-b,w=Math.abs(1e3*T/l);if(T<=-m*c)W.b.warn("Dropping 1 audio frame @ "+(b/l).toFixed(3)+"s due to "+Math.round(w)+" ms overlap."),g.splice(_,1),t.len-=E.unit.length;else if(m*c<=T&&w<1e4&&b){var R=Math.round(T/c);W.b.warn("Injecting "+R+" audio frame @ "+(b/l).toFixed(3)+"s due to "+Math.round(1e3*T/l)+" ms gap.");for(var S=0;S<R;S++){var A,L=Math.max(b,0);(A=U.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(W.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),A=E.unit.subarray()),g.splice(_,0,{unit:A,pts:L,dts:L}),t.len+=A.length,b+=c,_++}E.pts=E.dts=b,b+=c,_++}else Math.abs(T),E.pts=E.dts=b,b+=c,_++}for(var D=0,k=g.length;D<k;D++){var O=g[D],I=O.unit,O=O.pts;if(void 0!==s)a.duration=Math.round((O-s)/d);else{var x=Math.round(1e3*(O-v)/l),P=0;if(r&&t.isAAC&&x){if(0<x&&x<1e4)P=Math.round((O-v)/c),W.b.log(x+" ms hole between AAC samples detected,filling it"),0<P&&(A=(A=U.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||I.subarray(),t.len+=P*A.length);else if(x<-12){W.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(v/l).toFixed(3)+"s/"+(O/l).toFixed(3)+"s/"+-x+"ms"),t.len-=I.byteLength;continue}O=v}if(o=O,!(0<t.len))return;var x=p?t.len:t.len+8,C=p?0:8;try{n=new Uint8Array(x)}catch(t){return void this.observer.trigger(q.a.ERROR,{type:H.b.MUX_ERROR,details:H.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:x,reason:"fail allocating audio mdat "+x})}p||(new DataView(n.buffer).setUint32(0,x),n.set(V.types.mdat,4));for(var M=0;M<P;M++)(A=U.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(W.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),A=I.subarray()),n.set(A,C),C+=A.byteLength,a={size:A.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(a)}n.set(I,C);x=I.byteLength;C+=x,y.push(a={size:x,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}}),s=O}var N=0,F=y.length;if(2<=F&&(N=y[F-2].duration,a.duration=N),F){this.nextAudioPts=v=s+d*N,t.len=0,t.samples=y,u=p?new Uint8Array:V.moof(t.sequenceNumber++,o/d,t),t.samples=[];i=o/l,N=v/l,F={data1:u,data2:n,startPTS:i,endPTS:N,startDTS:i,endDTS:N,type:"audio",nb:F};return this.observer.trigger(q.a.FRAG_PARSING_DATA,F),F}return null}},O.prototype.remuxEmptyAudio=function(t,e,r,i){var a=t.inputTimeScale,n=t.samplerate||a,o=this.nextAudioPts,s=(void 0!==o?o:i.startDTS*a)+this._initDTS,i=i.endDTS*a+this._initDTS,l=1024*(a/n),u=Math.ceil((i-s)/l),d=U.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(W.b.warn("remux empty Audio"),d){for(var c=[],h=0;h<u;h++){var f=s+h*l;c.push({unit:d,pts:f,dts:f}),t.len+=d.length}t.samples=c,this.remuxAudio(t,e,r)}else W.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},O.prototype.remuxID3=function(t,e){var r,i=t.samples.length,a=t.inputTimeScale,n=this._initPTS,o=this._initDTS;if(i){for(var s=0;s<i;s++)(r=t.samples[s]).pts=(r.pts-n)/a,r.dts=(r.dts-o)/a;this.observer.trigger(q.a.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[]},O.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var r,i=t.samples.length,a=t.inputTimeScale,n=this._initPTS;if(i){for(var o=0;o<i;o++)(r=t.samples[o]).pts=(r.pts-n)/a;this.observer.trigger(q.a.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]},O.prototype._PTSNormalize=function(t,e){var r;if(void 0===e)return t;for(r=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=r;return t},O);function P(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,P),this.observer=t}var C=(P.prototype.destroy=function(){},P.prototype.resetTimeStamp=function(){},P.prototype.resetInitSegment=function(){},P.prototype.remux=function(t,e,r,i,a,n,o,s){var l=this.observer,u="";t&&(u+="audio"),e&&(u+="video"),l.trigger(q.a.FRAG_PARSING_DATA,{data1:s,startPTS:a,startDTS:a,type:u,nb:1,dropped:0}),l.trigger(q.a.FRAG_PARSED)},P);M.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},M.prototype.push=function(t,r,i,a,n,o,s,l,u,d,c,h){if(0<t.byteLength&&null!=r&&null!=r.key&&"AES-128"===r.method){var e=this.decrypter;null==e&&(e=this.decrypter=new g.a(this.observer,this.config));var f,p=this;try{f=performance.now()}catch(t){f=Date.now()}e.decrypt(t,r.key.buffer,r.iv.buffer,function(t){var e;try{e=performance.now()}catch(t){e=Date.now()}p.observer.trigger(q.a.FRAG_DECRYPTED,{stats:{tstart:f,tdecrypt:e}}),p.pushDecrypted(new Uint8Array(t),r,new Uint8Array(i),a,n,o,s,l,u,d,c,h)})}else this.pushDecrypted(new Uint8Array(t),r,new Uint8Array(i),a,n,o,s,l,u,d,c,h)},M.prototype.pushDecrypted=function(t,e,r,i,a,n,o,s,l,u,d,c){if(!(E=this.demuxer)||o&&!this.probe(t)){for(var h=this.observer,f=this.typeSupported,p=this.config,g=[{demux:A,remux:x},{demux:R,remux:C},{demux:w,remux:x},{demux:L,remux:x}],y=0,v=g.length;y<v;y++){var m=g[y],_=m.demux.probe;if(_(t)){var b=this.remuxer=new m.remux(h,p,f,this.vendor),E=new m.demux(h,b,p,f);this.probe=_;break}}if(!E)return void h.trigger(q.a.ERROR,{type:H.b.MEDIA_ERROR,details:H.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=E}var T=this.remuxer;(o||s)&&(E.resetInitSegment(r,i,a,u),T.resetInitSegment()),o&&(E.resetTimeStamp(c),T.resetTimeStamp(c)),"function"==typeof E.setDecryptData&&E.setDecryptData(e),E.append(t,n,l,d)},r=M;function M(t,e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,M),this.observer=t,this.typeSupported=e,this.config=r,this.vendor=i}e.a=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={};r.d(i,"newCue",function(){return Zt});var a=r(6),n=r.n(a),T=r(1),w=r(2),R=r(0),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function s(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}var l=(s.prototype.destroy=function(){this.unregisterListeners()},s.prototype.isEventHandler=function(){return"object"===o(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},s.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if("hlsEventGeneric"===t)throw new Error("Forbidden event name: "+t);this.hls.on(t,this.onEvent)},this)},s.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},s.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},s.prototype.onEventGeneric=function(e,t){try{!function(t,e){var r="on"+t.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,e)}.call(this,e,t).call()}catch(t){R.b.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(T.a.ERROR,{type:w.b.OTHER_ERROR,details:w.a.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},s);var u=/^(\d+)x(\d+)$/,d=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;function c(t){for(var e in!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),t="string"==typeof t?c.parseAttrList(t):t)t.hasOwnProperty(e)&&(this[e]=t[e])}var S=(c.prototype.decimalInteger=function(t){t=parseInt(this[t],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},c.prototype.hexadecimalInteger=function(t){if(this[t]){for(var e=(1&(e=(this[t]||"0x").slice(2)).length?"0":"")+e,r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},c.prototype.hexadecimalIntegerAsNumber=function(t){t=parseInt(this[t],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},c.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},c.prototype.enumeratedString=function(t){return this[t]},c.prototype.decimalResolution=function(t){t=u.exec(this[t]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},c.parseAttrList=function(t){var e,r={};for(d.lastIndex=0;null!==(e=d.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1]]=i}return r},c),h={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function f(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}var p=function(t,e,r){return e&&g(t.prototype,e),r&&g(t,r),t};function g(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var v=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,m=/#EXT-X-MEDIA:(.*)/g,A=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),L=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,D=(p(_,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=n.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),_);function _(){y(this,_),this.method=null,this.key=null,this.iv=null,this._uri=null}var b,k=(E.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e},E.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var r=t;return t&&t.method&&t.uri&&!t.iv&&((r=new D).method=t.method,r.baseuri=t.baseuri,r.reluri=t.reluri,r.iv=this.createInitializationVector(e)),r},E.prototype.cloneObj=function(t){return JSON.parse(JSON.stringify(t))},p(E,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=n.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){var t,e,r;return this._byteRange||(t=this._byteRange=[],this.rawByteRange&&(1===(e=this.rawByteRange.split("@",2)).length?(r=this.lastByteRangeEndOffset,t[0]=r||0):t[0]=parseInt(e[1]),t[1]=parseInt(e[0])+t[0])),this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),E);function E(){y(this,E),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}function O(t){y(this,O);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,b.call(this,t,T.a.MANIFEST_LOADING,T.a.LEVEL_LOADING,T.a.AUDIO_TRACK_LOADING,T.a.SUBTITLE_TRACK_LOADING));return t.loaders={},t}var I,x=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(O,b=l),O.prototype.destroy=function(){for(var t in this.loaders){t=this.loaders[t];t&&t.destroy()}this.loaders={},l.prototype.destroy.call(this)},O.prototype.onManifestLoading=function(t){this.load(t.url,{type:"manifest"})},O.prototype.onLevelLoading=function(t){this.load(t.url,{type:"level",level:t.level,id:t.id})},O.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:"audioTrack",id:t.id})},O.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:"subtitleTrack",id:t.id})},O.prototype.load=function(t,e){var r=this.loaders[e.type];if(void 0!==r){var i=r.context;if(i&&i.url===t)return void R.b.trace("playlist request ongoing");R.b.warn("abort previous loader for type:"+e.type),r.abort()}var a=this.hls.config,n=void 0,o=void 0,s=void 0,i=void 0;"manifest"===e.type?(n=a.manifestLoadingMaxRetry,o=a.manifestLoadingTimeOut,s=a.manifestLoadingRetryDelay,i=a.manifestLoadingMaxRetryTimeout):"level"===e.type?(n=0,o=a.levelLoadingTimeOut):(n=a.levelLoadingMaxRetry,o=a.levelLoadingTimeOut,s=a.levelLoadingRetryDelay,i=a.levelLoadingMaxRetryTimeout,R.b.log("loading playlist for "+e.type+" "+(e.level||e.id))),r=this.loaders[e.type]=e.loader=new("undefined"!=typeof a.pLoader?a.pLoader:a.loader)(a),e.url=t,e.responseType="";a=void 0,t=void 0,a={timeout:o,maxRetry:n,retryDelay:s,maxRetryDelay:i},t={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(e,a,t)},O.prototype.resolve=function(t,e){return n.a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},O.prototype.parseMasterPlaylist=function(t,e){var r,i=[];function a(i,a){["video","audio"].forEach(function(r){var t,e=i.filter(function(t){return e=t,!!(t=h[t=r])&&!0===t[e.slice(0,4)];var e});e.length&&(t=e.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}),a[r+"Codec"]=(0<t.length?t:e)[0],i=i.filter(function(t){return-1===e.indexOf(t)}))}),a.unknownCodecs=i}for(v.lastIndex=0;null!=(r=v.exec(t));){var n={},o=n.attrs=new S(r[1]);n.url=this.resolve(r[2],e);var s=o.decimalResolution("RESOLUTION");s&&(n.width=s.width,n.height=s.height),n.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),n.name=o.NAME,a([].concat((o.CODECS||"").split(/[ ,]+/)),n),n.videoCodec&&-1!==n.videoCodec.indexOf("avc1")&&(n.videoCodec=this.avc1toavcoti(n.videoCodec)),i.push(n)}return i},O.prototype.parseMasterPlaylistMedia=function(t,e,r){var i,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],n=[],o=0;for(m.lastIndex=0;null!==(i=m.exec(t));){var s={},l=new S(i[1]);l.TYPE===r&&(s.groupId=l["GROUP-ID"],s.name=l.NAME,s.type=r,s.default="YES"===l.DEFAULT,s.autoselect="YES"===l.AUTOSELECT,s.forced="YES"===l.FORCED,l.URI&&(s.url=this.resolve(l.URI,e)),s.lang=l.LANGUAGE,s.name||(s.name=s.lang),a.length&&(l=function(t,e){if(!t)return null;for(var r=null,i=0;i<t.length;i++){var a=t[i];a.id===e&&(r=a)}return r}(a,s.groupId),s.audioCodec=(l||a[0]).codec),s.id=o++,n.push(s))}return n},O.prototype.avc1toavcoti=function(t){var e,r=t.split(".");return 2<r.length?(e=r.shift()+".",e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):e=t,e},O.prototype.parseLevelPlaylist=function(t,e,r,i){var a,n,o=0,s=0,l={type:null,version:null,url:e,fragments:[],live:!0,startSN:0},u=new D,d=0,c=null,h=new k;for(A.lastIndex=0;null!==(a=A.exec(t));){var f,p=a[1];if(p){h.duration=parseFloat(p);var g=(" "+a[2]).slice(1);h.title=g||null,h.tagList.push(g?["INF",p,g]:["INF",p])}else if(a[3])isNaN(h.duration)||(f=o++,h.type=i,h.start=s,h.levelkey=u,h.sn=f,h.level=r,h.cc=d,h.baseurl=e,h.relurl=(" "+a[3]).slice(1),l.fragments.push(h),s+=(c=h).duration,h=new k);else if(a[4])h.rawByteRange=(" "+a[4]).slice(1),!c||(f=c.byteRangeEndOffset)&&(h.lastByteRangeEndOffset=f);else if(a[5])h.rawProgramDateTime=(" "+a[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]),void 0===l.programDateTime&&(l.programDateTime=new Date(new Date(Date.parse(a[5]))-1e3*s));else{for(a=a[0].match(L),n=1;n<a.length&&void 0===a[n];n++);var y=(" "+a[n+1]).slice(1),v=(" "+a[n+2]).slice(1);switch(a[n]){case"#":h.tagList.push(v?[y,v]:[y]);break;case"PLAYLIST-TYPE":l.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":o=l.startSN=parseInt(y);break;case"TARGETDURATION":l.targetduration=parseFloat(y);break;case"VERSION":l.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(y);break;case"KEY":var m=new S(y),_=m.enumeratedString("METHOD"),b=m.URI,m=m.hexadecimalInteger("IV");_&&(u=new D,b&&0<=["AES-128","SAMPLE-AES"].indexOf(_)&&(u.method=_,u.baseuri=e,u.reluri=b,u.key=null,u.iv=m));break;case"START":var E=new S(y).decimalFloatingPoint("TIME-OFFSET");isNaN(E)||(l.startTimeOffset=E);break;case"MAP":E=new S(y);h.relurl=E.URI,h.rawByteRange=E.BYTERANGE,h.baseurl=e,h.level=r,h.type=i,h.sn="initSegment",l.initSegment=h,h=new k;break;default:R.b.warn("line parsed but not handled: "+a)}}}return(h=c)&&!h.relurl&&(l.fragments.pop(),s-=h.duration),l.totalduration=s,l.averagetargetduration=s/l.fragments.length,l.endSN=o-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=d,l},O.prototype.loadsuccess=function(t,e,r){var i,a,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=t.data,s=t.url,l=r.type,u=r.id,d=r.level,t=this.hls;(this.loaders[l]=void 0)!==s&&0!==s.indexOf("data:")||(s=r.url),e.tload=performance.now(),0===o.indexOf("#EXTM3U")?0<o.indexOf("#EXTINF:")?(r="audioTrack"!==l&&"subtitleTrack"!==l,i=isNaN(d)?isNaN(u)?0:u:d,(i=this.parseLevelPlaylist(o,s,i,"audioTrack"===l?"audio":"subtitleTrack"===l?"subtitle":"main")).tload=e.tload,"manifest"===l&&t.trigger(T.a.MANIFEST_LOADED,{levels:[{url:s,details:i}],audioTracks:[],url:s,stats:e,networkDetails:n}),e.tparsed=performance.now(),i.targetduration?r?t.trigger(T.a.LEVEL_LOADED,{details:i,level:d||0,id:u||0,stats:e,networkDetails:n}):"audioTrack"===l?t.trigger(T.a.AUDIO_TRACK_LOADED,{details:i,id:u,stats:e,networkDetails:n}):"subtitleTrack"===l&&t.trigger(T.a.SUBTITLE_TRACK_LOADED,{details:i,id:u,stats:e,networkDetails:n}):t.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:w.a.MANIFEST_PARSING_ERROR,fatal:!0,url:s,reason:"invalid targetduration",networkDetails:n})):(i=this.parseMasterPlaylist(o,s)).length?(u=i.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),u=this.parseMasterPlaylistMedia(o,s,"AUDIO",u),o=this.parseMasterPlaylistMedia(o,s,"SUBTITLES"),u.length&&(a=!1,u.forEach(function(t){t.url||(a=!0)}),!1===a&&i[0].audioCodec&&!i[0].attrs.AUDIO&&(R.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main"}))),t.trigger(T.a.MANIFEST_LOADED,{levels:i,audioTracks:u,subtitles:o,url:s,stats:e,networkDetails:n})):t.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:w.a.MANIFEST_PARSING_ERROR,fatal:!0,url:s,reason:"no level found in manifest",networkDetails:n}):t.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:w.a.MANIFEST_PARSING_ERROR,fatal:!0,url:s,reason:"no EXTM3U delimiter",networkDetails:n})},O.prototype.loaderror=function(t,e){var r,i,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;switch(e.type){case"manifest":r=w.a.MANIFEST_LOAD_ERROR,i=!0;break;case"level":r=w.a.LEVEL_LOAD_ERROR,i=!1;break;case"audioTrack":r=w.a.AUDIO_TRACK_LOAD_ERROR,i=!1}n&&(n.abort(),this.loaders[e.type]=void 0),this.hls.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:r,fatal:i,url:n.url,loader:n,response:t,context:e,networkDetails:a})},O.prototype.loadtimeout=function(t,e){var r,i,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;switch(e.type){case"manifest":r=w.a.MANIFEST_LOAD_TIMEOUT,i=!0;break;case"level":r=w.a.LEVEL_LOAD_TIMEOUT,i=!1;break;case"audioTrack":r=w.a.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}n&&(n.abort(),this.loaders[e.type]=void 0),this.hls.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:r,fatal:i,url:n.url,loader:n,context:e,networkDetails:a})},O);function P(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,P);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,I.call(this,t,T.a.FRAG_LOADING));return t.loaders={},t}var C,M=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(P,I=l),P.prototype.destroy=function(){var t,e=this.loaders;for(t in e){var r=e[t];r&&r.destroy()}this.loaders={},l.prototype.destroy.call(this)},P.prototype.onFragLoading=function(t){var e=t.frag,r=e.type,i=this.loaders[r],a=this.hls.config;e.loaded=0,i&&(R.b.warn("abort previous fragment loader for type:"+r),i.abort());var n,i=this.loaders[r]=e.loader=new("undefined"!=typeof a.fLoader?a.fLoader:a.loader)(a),o=void 0,t=void 0,o={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1},r=e.byteRangeStartOffset,e=e.byteRangeEndOffset;isNaN(r)||isNaN(e)||(o.rangeStart=r,o.rangeEnd=e),n={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},t={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(o,n,t)},P.prototype.loadsuccess=function(t,e,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,t=t.data,r=r.frag;r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(T.a.FRAG_LOADED,{payload:t,frag:r,stats:e,networkDetails:i})},P.prototype.loaderror=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:w.a.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:r})},P.prototype.loadtimeout=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:w.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:r})},P.prototype.loadprogress=function(t,e,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,e=e.frag;e.loaded=t.loaded,this.hls.trigger(T.a.FRAG_LOAD_PROGRESS,{frag:e,stats:t,networkDetails:i})},P);function N(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,N);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,C.call(this,t,T.a.KEY_LOADING));return t.loaders={},t.decryptkey=null,t.decrypturl=null,t}var F=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(N,C=l),N.prototype.destroy=function(){for(var t in this.loaders){t=this.loaders[t];t&&t.destroy()}this.loaders={},l.prototype.destroy.call(this)},N.prototype.onKeyLoading=function(t){var e,r=t.frag,i=r.type,a=this.loaders[i],n=r.decryptdata,o=n.uri;o!==this.decrypturl||null===this.decryptkey?(e=this.hls.config,a&&(R.b.warn("abort previous key loader for type:"+i),a.abort()),r.loader=this.loaders[i]=new e.loader(e),this.decrypturl=o,this.decryptkey=null,i=a=t=void 0,t={url:o,frag:r,responseType:"arraybuffer"},a={timeout:e.fragLoadingTimeOut,maxRetry:e.fragLoadingMaxRetry,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.loader.load(t,a,i)):this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(T.a.KEY_LOADED,{frag:r}))},N.prototype.loadsuccess=function(t,e,r){r=r.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(T.a.KEY_LOADED,{frag:r})},N.prototype.loaderror=function(t,e){var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:w.a.KEY_LOAD_ERROR,fatal:!1,frag:r,response:t})},N.prototype.loadtimeout=function(t,e){var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(T.a.ERROR,{type:w.b.NETWORK_ERROR,details:w.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},N),U={search:function(t,e){for(var r=0,i=t.length-1,a=null,n=null;r<=i;){var o=e(n=t[a=(r+i)/2|0]);if(0<o)r=1+a;else{if(!(o<0))return n;i=a-1}}return null}},B={isBuffered:function(t,e){try{if(t)for(var r=t.buffered,i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}catch(t){}return!1},bufferInfo:function(t,e,r){try{if(t){for(var i=t.buffered,a=[],n=0;n<i.length;n++)a.push({start:i.start(n),end:i.end(n)});return this.bufferedInfo(a,e,r)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},bufferedInfo:function(t,e,r){var i,a,n,o,s,l=[];for(t.sort(function(t,e){var r=t.start-e.start;return r||e.end-t.end}),s=0;s<t.length;s++){var u,d=l.length;d?(u=l[d-1].end,t[s].start-u<r?t[s].end>u&&(l[d-1].end=t[s].end):l.push(t[s])):l.push(t[s])}for(i=s=0,a=n=e;s<l.length;s++){var c=l[s].start,h=l[s].end;if(c<=e+r&&e<h)a=c,i=(n=h)-e;else if(e+r<c){o=c;break}}return{len:i,start:a,end:n,nextStart:o}}},G=r(7),j=r(5),q=r.n(j),H=r(9),W=r.n(H);function V(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}var K=V();function Y(r,t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Y),this.hls=r,this.id=t;var a=this.observer=new q.a,e=r.config;a.trigger=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.emit.apply(a,[t,t].concat(r))},a.off=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.removeListener.apply(a,[t].concat(r))};var i=function(t,e){(e=e||{}).frag=this.frag,e.id=this.id,r.trigger(t,e)}.bind(this);a.on(T.a.FRAG_DECRYPTED,i),a.on(T.a.FRAG_PARSING_INIT_SEGMENT,i),a.on(T.a.FRAG_PARSING_DATA,i),a.on(T.a.FRAG_PARSED,i),a.on(T.a.ERROR,i),a.on(T.a.FRAG_PARSING_METADATA,i),a.on(T.a.FRAG_PARSING_USERDATA,i),a.on(T.a.INIT_PTS_FOUND,i);var n={mp4:K.isTypeSupported("video/mp4"),mpeg:K.isTypeSupported("audio/mpeg"),mp3:K.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(e.enableWorker&&"undefined"!=typeof Worker){R.b.log("demuxing in webworker");i=void 0;try{i=this.w=W()(10),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(t){r.trigger(T.a.ERROR,{type:w.b.OTHER_ERROR,details:w.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},i.postMessage({cmd:"init",typeSupported:n,vendor:o,id:t,config:JSON.stringify(e)})}catch(t){R.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),i&&URL.revokeObjectURL(i.objectURL),this.demuxer=new G.a(a,n,e,o),this.w=void 0}}else this.demuxer=new G.a(a,n,e,o)}var z=(Y.prototype.destroy=function(){var t=this.w;t?(t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null):(e=this.demuxer)&&(e.destroy(),this.demuxer=null);var e=this.observer;e&&(e.removeAllListeners(),this.observer=null)},Y.prototype.push=function(t,e,r,i,a,n,o,s){var l=this.w,u=isNaN(a.startDTS)?a.start:a.startDTS,d=a.decryptdata,c=this.frag,h=!(c&&a.cc===c.cc),f=!(c&&a.level===c.level),c=c&&a.sn===c.sn+1,c=!f&&c;h&&R.b.log(this.id+":discontinuity detected"),f&&R.b.log(this.id+":switch detected"),this.frag=a,l?l.postMessage({cmd:"demux",data:t,decryptdata:d,initSegment:e,audioCodec:r,videoCodec:i,timeOffset:u,discontinuity:h,trackSwitch:f,contiguous:c,duration:n,accurateTimeOffset:o,defaultInitPTS:s},t instanceof ArrayBuffer?[t]:[]):(l=this.demuxer)&&l.push(t,d,e,r,i,u,h,f,c,n,o,s)},Y.prototype.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case T.a.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},Y);function X(t,e,r){var i=t[e],a=t[r],t=a.startPTS;isNaN(t)?a.start=e<r?i.start+i.duration:Math.max(i.start-a.duration,0):e<r?(i.duration=t-i.start,i.duration<0&&R.b.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-t,a.duration<0&&R.b.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!"))}function J(t,e,r,i,a,n){var o=r;isNaN(e.startPTS)||(s=Math.abs(e.startPTS-r),isNaN(e.deltaPTS)?e.deltaPTS=s:e.deltaPTS=Math.max(s,e.deltaPTS),o=Math.max(r,e.startPTS),r=Math.min(r,e.startPTS),i=Math.max(i,e.endPTS),a=Math.min(a,e.startDTS),n=Math.max(n,e.endDTS));var s=r-e.start;e.start=e.startPTS=r,e.maxStartPTS=o,e.endPTS=i,e.startDTS=a,e.endDTS=n,e.duration=i-r;var l,u,r=e.sn;if(!t||r<t.startSN||r>t.endSN)return 0;for(r=r-t.startSN,(l=t.fragments)[r]=e,u=r;0<u;u--)X(l,u,u-1);for(u=r;u<l.length-1;u++)X(l,u,u+1);return t.PTSKnown=!0,s}function Q(t,e){var r,i=Math.max(t.startSN,e.startSN)-e.startSN,a=Math.min(t.endSN,e.endSN)-e.startSN,n=e.startSN-t.startSN,o=t.fragments,s=e.fragments,l=0;if(a<i)e.PTSKnown=!1;else{for(var u=i;u<=a;u++){var d=o[n+u],c=s[u];c&&d&&(l=d.cc-c.cc,isNaN(d.startPTS)||(c.start=c.startPTS=d.startPTS,c.endPTS=d.endPTS,c.duration=d.duration,c.backtracked=d.backtracked,c.dropped=d.dropped,r=c))}if(l)for(R.b.log("discontinuity sliding from playlist, take drift into account"),u=0;u<s.length;u++)s[u].cc+=l;if(r)J(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(0<=n&&n<o.length)for(var h=o[n].start,u=0;u<s.length;u++)s[u].start+=h;e.PTSKnown=t.PTSKnown}}var $={toString:function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}};function Z(t,e){t=t.fragments,e=e.fragments;if(e.length&&t.length){e=function(t,e){for(var r=null,i=0;i<t.length;i+=1){var a=t[i];if(a&&a.cc===e){r=a;break}}return r}(t,e[0].cc);if(e&&(!e||e.startPTS))return e;R.b.log("No frag in previous level to align on")}else R.b.log("No fragments to align")}function tt(r,t){t.fragments.forEach(function(t){var e;t&&(e=t.start+r,t.start=t.startPTS=e,t.endPTS=e+t.duration)}),t.PTSKnown=!0}function et(t,e,r){var i,a,n,o;i=t,a=r,n=!1,(n=!!((t=e)&&t.details&&a&&(a.endCC>a.startCC||i&&i.cc<a.startCC))||n)&&(o=Z(e.details,r))&&(R.b.log("Adjusting PTS using last level due to CC increase within current level"),tt(o.start,r)),!1===r.PTSKnown&&e&&e.details&&(o=e.details.programDateTime,e=(r.programDateTime-o)/1e3+e.details.fragments[0].start,isNaN(e)||(R.b.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),tt(e,r)))}var rt=function(t,e,r){return e&&it(t.prototype,e),r&&it(t,r),t};function it(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var at,nt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"};function ot(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,ot);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,at.call(this,t,T.a.MEDIA_ATTACHED,T.a.MEDIA_DETACHING,T.a.MANIFEST_LOADING,T.a.MANIFEST_PARSED,T.a.LEVEL_LOADED,T.a.KEY_LOADED,T.a.FRAG_LOADED,T.a.FRAG_LOAD_EMERGENCY_ABORTED,T.a.FRAG_PARSING_INIT_SEGMENT,T.a.FRAG_PARSING_DATA,T.a.FRAG_PARSED,T.a.ERROR,T.a.AUDIO_TRACK_SWITCHING,T.a.AUDIO_TRACK_SWITCHED,T.a.BUFFER_CREATED,T.a.BUFFER_APPENDED,T.a.BUFFER_FLUSHED));return e.config=t.config,e.audioCodecSwap=!1,e.ticks=0,e._state=nt.STOPPED,e.ontick=e.tick.bind(e),e}var st,lt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(ot,at=l),ot.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),l.prototype.destroy.call(this),this.state=nt.STOPPED},ot.prototype.startLoad=function(t){var e,r,i;this.levels?(e=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(i=r.startLevel)&&(this.bitrateTest=!(i=0)),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1),0<e&&-1===t&&(R.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=nt.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this.forceStartLoad=!0,this.state=nt.STOPPED)},ot.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=nt.STOPPED,this.forceStartLoad=!1},ot.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},ot.prototype.doTick=function(){switch(this.state){case nt.ERROR:break;case nt.BUFFER_FLUSHING:this.fragLoadError=0;break;case nt.IDLE:this._doTickIdle();break;case nt.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=nt.IDLE);break;case nt.FRAG_LOADING_WAITING_RETRY:var e=performance.now(),t=this.retryDate;(!t||t<=e||this.media&&this.media.seeking)&&(R.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=nt.IDLE);break;case nt.ERROR:case nt.STOPPED:case nt.FRAG_LOADING:case nt.PARSING:case nt.PARSED:case nt.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},ot.prototype._doTickIdle=function(){var t=this.hls,e=t.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&e.startFragPrefetch)){var i=void 0,i=this.loadedmetadata?r.currentTime:this.nextLoadPosition,a=t.nextLoadLevel,n=this.levels[a];if(n){var o=n.bitrate,s=void 0,s=o?Math.max(8*e.maxBufferSize/o,e.maxBufferLength):e.maxBufferLength;s=Math.min(s,e.maxMaxBufferLength);o=B.bufferInfo(this.mediaBuffer||r,i,e.maxBufferHole),e=o.len;if(!(s<=e)){R.b.trace("buffer length of "+e.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=a;n=n.details;if(void 0===n||!0===n.live&&this.levelLastLoaded!==a)this.state=nt.WAITING_LEVEL;else{a=this.fragPrevious;if(!n.live&&a&&!a.backtracked&&a.sn===n.endSN&&!o.nextStart)if(Math.min(r.duration,a.start+a.duration)-Math.max(o.end,a.start)<=Math.max(.2,a.duration)){a={};return this.altAudio&&(a.type="video"),this.hls.trigger(T.a.BUFFER_EOS,a),void(this.state=nt.ENDED)}this._fetchPayloadOrEos(i,o,n)}}}}},ot.prototype._fetchPayloadOrEos=function(t,e,r){var i=this.fragPrevious,a=this.level,n=r.fragments,o=n.length;if(0!==o){var s=n[0].start,l=n[o-1].start+n[o-1].duration,u=e.end,d=void 0;if(r.initSegment&&!r.initSegment.data)d=r.initSegment;else if(r.live){e=this.config.initialLiveManifestSize;if(o<e)return void R.b.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+e);if(null===(d=this._ensureFragmentAtLivePoint(r,u,s,l,i,n,o)))return}else u<s&&(d=n[0]);(d=d||this._findFragment(s,i,o,n,u,l,r))&&this._loadFragmentOrKey(d,a,r,t,u)}},ot.prototype._ensureFragmentAtLivePoint=function(t,e,r,i,a,n,o){var s=this.hls.config,l=this.media,u=void 0,d=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*t.targetduration;return e<Math.max(r-s.maxFragLookUpTolerance,i-d)&&(r=this.liveSyncPosition=this.computeLivePosition(r,t),R.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+r.toFixed(3)),e=r,l&&l.readyState&&l.duration>r&&(l.currentTime=r),this.nextLoadPosition=r),t.PTSKnown&&i<e&&l&&l.readyState?null:(this.startFragRequested&&!t.PTSKnown&&(a&&((l=a.sn+1)>=t.startSN&&l<=t.endSN&&(t=n[l-t.startSN],a.cc===t.cc&&R.b.log("live playlist, switching playlist, load frag with next SN: "+(u=t).sn)),u||(u=U.search(n,function(t){return a.cc-t.cc}))&&R.b.log("live playlist, switching playlist, load frag with same CC: "+u.sn)),u||(u=n[Math.min(o-1,Math.round(o/2))],R.b.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))),u)},ot.prototype._findFragment=function(t,e,r,i,a,n,o){var s=this.hls.config,l=void 0,u=void 0,d=s.maxFragLookUpTolerance,c=e?i[e.sn-i[0].sn+1]:void 0,h=function(t){var e=Math.min(d,t.duration+(t.deltaPTS||0));return t.start+t.duration-e<=a?1:t.start-e>a&&t.start?-1:0};return(u=a<n?(n-d<a&&(d=0),c&&!h(c)?c:U.search(i,h)):i[r-1])&&(h=(l=u).sn-o.startSN,r=e&&l.level===e.level,u=i[h-1],i=i[1+h],e&&l.sn===e.sn&&(r&&!l.backtracked?l.sn<o.endSN?(o=e.deltaPTS)&&o>s.maxBufferHole&&e.dropped&&h?(l=u,R.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),e.loadCounter--):R.b.log("SN just loaded, load next one: "+(l=i).sn):l=null:l.backtracked&&(i&&i.backtracked?(R.b.warn("Already backtracked from fragment "+i.sn+", will not backtrack to fragment "+l.sn+". Loading fragment "+i.sn),l=i):(R.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),l.dropped=0,u?(u.loadCounter&&u.loadCounter--,(l=u).backtracked=!0):h&&(l=null))))),l},ot.prototype._loadFragmentOrKey=function(t,e,r,i,a){var n=this.hls,o=n.config;if(t.decryptdata&&null!=t.decryptdata.uri&&null==t.decryptdata.key)R.b.log("Loading key for "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+e),this.state=nt.KEY_LOADING,n.trigger(T.a.KEY_LOADING,{frag:t});else{if(R.b.log("Loading "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+e+", currentTime:"+i.toFixed(3)+",bufferEnd:"+a.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,t.loadCounter){t.loadCounter++;o=o.fragLoadingLoopThreshold;if(t.loadCounter>o&&Math.abs(this.fragLoadIdx-t.loadIdx)<o)return void n.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:t})}else t.loadCounter=1;t.loadIdx=this.fragLoadIdx,t.autoLevel=n.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.fragCurrent=t,this.startFragRequested=!0,isNaN(t.sn)||t.bitrateTest||(this.nextLoadPosition=t.start+t.duration),n.trigger(T.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new z(n,"main")),this.state=nt.FRAG_LOADING}},ot.prototype.getBufferedFrag=function(e){return U.search(this._bufferedFrags,function(t){return e<t.startPTS?-1:e>t.endPTS?1:0})},ot.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},ot.prototype._checkFragmentChanged=function(){var t,e,r=this.media;r&&r.readyState&&!1===r.seeking&&((e=r.currentTime)>r.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=e),B.isBuffered(r,e)?t=this.getBufferedFrag(e):B.isBuffered(r,e+.1)&&(t=this.getBufferedFrag(e+.1)),!t||(e=t)!==this.fragPlaying&&(this.hls.trigger(T.a.FRAG_CHANGED,{frag:e}),t=e.level,this.fragPlaying&&this.fragPlaying.level===t||this.hls.trigger(T.a.LEVEL_SWITCHED,{level:t}),this.fragPlaying=e))},ot.prototype.immediateLevelSwitch=function(){var t;R.b.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,e=void 0,(t=this.media)?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e);var e=this.fragCurrent;e&&e.loader&&e.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},ot.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,B.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},ot.prototype.nextLevelSwitch=function(){var t,e,r,i,a=this.media;a&&a.readyState&&((i=t=r=void 0)!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),(t=this.getBufferedFrag(a.currentTime))&&1<t.startPTS&&this.flushMainBuffer(0,t.startPTS-1),r=a.paused?0:(e=this.hls.nextLoadLevel,t=this.levels[e],(e=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*t.bitrate/(1e3*e)+1:0),(i=(i=this.getBufferedFrag(a.currentTime+r))&&this.followingBufferedFrag(i))&&((r=this.fragCurrent)&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.maxStartPTS,Number.POSITIVE_INFINITY)))},ot.prototype.flushMainBuffer=function(t,e){this.state=nt.BUFFER_FLUSHING;e={startOffset:t,endOffset:e};this.altAudio&&(e.type="video"),this.hls.trigger(T.a.BUFFER_FLUSHING,e)},ot.prototype.onMediaAttached=function(t){t=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);t=this.config;this.levels&&t.autoStartLoad&&this.hls.startLoad(t.startPosition)},ot.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(R.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0,t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},ot.prototype.onMediaSeeking=function(){var t=this.media,e=t?t.currentTime:void 0,r=this.config;isNaN(e)||R.b.log("media seeking to "+e.toFixed(3));var i,a,n=this.mediaBuffer||t,o=B.bufferInfo(n,e,this.config.maxBufferHole);this.state===nt.FRAG_LOADING?(i=this.fragCurrent,0===o.len&&i&&(a=r.maxFragLookUpTolerance,n=i.start-a,a=i.start+i.duration+a,e<n||a<e?(i.loader&&(R.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=nt.IDLE):R.b.log("seeking outside of buffer but within currently loaded fragment range"))):this.state===nt.ENDED&&(0===o.len&&(this.fragPrevious=0),this.state=nt.IDLE),t&&(this.lastCurrentTime=e),this.state!==nt.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*r.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},ot.prototype.onMediaSeeked=function(){var t=this.media,t=t?t.currentTime:void 0;isNaN(t)||R.b.log("media seeked to "+t.toFixed(3)),this.tick()},ot.prototype.onMediaEnded=function(){R.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},ot.prototype.onManifestLoading=function(){R.b.log("trigger BUFFER_RESET"),this.hls.trigger(T.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},ot.prototype.onManifestParsed=function(t){var e,r=!1,i=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(r=!0),-1!==e.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&R.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;t=this.config;(t.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(t.startPosition)},ot.prototype.onLevelLoaded=function(t){var e=t.details,r=t.level,i=this.levels[this.levelLastLoaded],a=this.levels[r],n=e.totalduration,o=0;R.b.log("level "+r+" loaded ["+e.startSN+","+e.endSN+"],duration:"+n),e.live?(t=a.details)&&0<e.fragments.length?(Q(t,e),o=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,t),e.PTSKnown&&!isNaN(o)?R.b.log("live playlist sliding:"+o.toFixed(3)):(R.b.log("live playlist - outdated PTS, unknown sliding"),et(this.fragPrevious,i,e))):(R.b.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,et(this.fragPrevious,i,e)):e.PTSKnown=!1,a.details=e,this.levelLastLoaded=r,this.hls.trigger(T.a.LEVEL_UPDATED,{details:e,level:r}),!1===this.startFragRequested&&(-1!==this.startPosition&&-1!==this.lastCurrentTime||(r=e.startTimeOffset,isNaN(r)?e.live?(this.startPosition=this.computeLivePosition(o,e),R.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(r<0&&(R.b.log("negative start time offset "+r+", count from end of last fragment"),r=o+n+r),R.b.log("start time offset found in playlist, adjust startPosition to "+r),this.startPosition=r),this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition),this.state===nt.WAITING_LEVEL&&(this.state=nt.IDLE),this.tick()},ot.prototype.onKeyLoaded=function(){this.state===nt.KEY_LOADING&&(this.state=nt.IDLE,this.tick())},ot.prototype.onFragLoaded=function(t){var e,r,i,a,n,o=this.fragCurrent,s=t.frag;this.state===nt.FRAG_LOADING&&o&&"main"===s.type&&s.level===o.level&&s.sn===o.sn&&(i=t.stats,n=(e=this.levels[o.level]).details,R.b.log("Loaded  "+o.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+o.level),this.bitrateTest=!1,this.stats=i,!0===s.bitrateTest&&this.hls.nextLoadLevel?(this.state=nt.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(T.a.FRAG_BUFFERED,{stats:i,frag:o,id:"main"}),this.tick()):"initSegment"===s.sn?(this.state=nt.IDLE,i.tparsed=i.tbuffered=performance.now(),n.initSegment.data=t.payload,this.hls.trigger(T.a.FRAG_BUFFERED,{stats:i,frag:o,id:"main"}),this.tick()):(this.state=nt.PARSING,r=n.totalduration,a=o.level,s=o.sn,i=this.config.defaultAudioCodec||e.audioCodec,this.audioCodecSwap&&(R.b.log("swapping playlist audio codec"),i=(i=void 0===i?this.lastAudioCodec:i)&&(-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,R.b.log("Parsing "+s+" of ["+n.startSN+" ,"+n.endSN+"],level "+a+", cc "+o.cc),s=(s=this.demuxer)||(this.demuxer=new z(this.hls,"main")),a=!((a=this.media)&&a.seeking)&&(n.PTSKnown||!n.live),n=n.initSegment?n.initSegment.data:[],s.push(t.payload,n,i,e.videoCodec,o,r,a,void 0))),this.fragLoadError=0},ot.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,r=t.frag;if(e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===nt.PARSING){var i,a,n=t.tracks;for(i in n.audio&&this.altAudio&&delete n.audio,(a=n.audio)&&(r=this.levels[this.level].audioCodec,e=navigator.userAgent.toLowerCase(),r&&this.audioCodecSwap&&(R.b.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===e.indexOf("firefox")&&(r="mp4a.40.5"),-1!==e.indexOf("android")&&"audio/mpeg"!==a.container&&R.b.log("Android: force audio codec to "+(r="mp4a.40.2")),a.levelCodec=r,a.id=t.id),(a=n.video)&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=t.id),this.hls.trigger(T.a.BUFFER_CODECS,n),n){a=n[i],R.b.log("main track:"+i+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var o=a.initSegment;o&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(T.a.BUFFER_APPENDING,{type:i,data:o,parent:"main",content:"initSegment"}))}this.tick()}},ot.prototype.onFragParsingData=function(e){var r=this,t=this.fragCurrent,i=e.frag;if(t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&("audio"!==e.type||!this.altAudio)&&this.state===nt.PARSING){var a=this.levels[this.level],i=t;if(isNaN(e.endPTS)&&(e.endPTS=e.startPTS+t.duration,e.endDTS=e.startDTS+t.duration),R.b.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(i.dropped=e.dropped,i.dropped)if(i.backtracked)R.b.warn("Already backtracked on this fragment, appending with the gap");else{t=a.details;if(!t||i.sn!==t.startSN)return R.b.warn("missing video frame(s), backtracking fragment"),i.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=nt.IDLE,this.fragPrevious=i,void this.tick();R.b.warn("missing video frame(s) on first frag, appending with gap")}else i.backtracked=!1;var i=J(a.details,i,e.startPTS,e.endPTS,e.startDTS,e.endDTS),n=this.hls;n.trigger(T.a.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:i,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(t){t&&t.length&&r.state===nt.PARSING&&(r.appended=!0,r.pendingBuffering=!0,n.trigger(T.a.BUFFER_APPENDING,{type:e.type,data:t,parent:"main",content:"data"}))}),this.tick()}},ot.prototype.onFragParsed=function(t){var e=this.fragCurrent,r=t.frag;e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===nt.PARSING&&(this.stats.tparsed=performance.now(),this.state=nt.PARSED,this._checkAppendedParsed())},ot.prototype.onAudioTrackSwitching=function(t){var e,r=!!t.url,t=t.id;r||(this.mediaBuffer!==this.media&&(R.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(e=this.fragCurrent).loader&&(R.b.log("switching to main audio track, cancel main fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=nt.IDLE),(e=this.hls).trigger(T.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),e.trigger(T.a.AUDIO_TRACK_SWITCHED,{id:t}),this.altAudio=!1)},ot.prototype.onAudioTrackSwitched=function(t){var e=t.id,t=!!this.hls.audioTracks[e].url;!t||(e=this.videoBuffer)&&this.mediaBuffer!==e&&(R.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e),this.altAudio=t,this.tick()},ot.prototype.onBufferCreated=function(t){var e,r=t.tracks,i=void 0,a=void 0,n=!1;for(e in r){var o=r[e];"main"===o.id?(i=o,"video"===(a=e)&&(this.videoBuffer=r[e].buffer)):n=!0}n&&i?(R.b.log("alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},ot.prototype.onBufferAppended=function(t){var e;"main"===t.parent&&((e=this.state)!==nt.PARSING&&e!==nt.PARSED||(this.pendingBuffering=0<t.pending,this._checkAppendedParsed()))},ot.prototype._checkAppendedParsed=function(){var t,e,r;this.state!==nt.PARSED||this.appended&&this.pendingBuffering||((t=this.fragCurrent)&&(e=this.mediaBuffer||this.media,R.b.log("main buffered : "+$.toString(e.buffered)),(r=this._bufferedFrags.filter(function(t){return B.isBuffered(e,(t.startPTS+t.endPTS)/2)})).push(t),this._bufferedFrags=r.sort(function(t,e){return t.startPTS-e.startPTS}),this.fragPrevious=t,(r=this.stats).tbuffered=performance.now(),this.fragLastKbps=Math.round(8*r.total/(r.tbuffered-r.tfirst)),this.hls.trigger(T.a.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.state=nt.IDLE),this.tick())},ot.prototype.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var r,i=!!this.media&&B.isBuffered(this.media,this.media.currentTime)&&B.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case w.a.FRAG_LOAD_ERROR:case w.a.FRAG_LOAD_TIMEOUT:case w.a.KEY_LOAD_ERROR:case w.a.KEY_LOAD_TIMEOUT:t.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),e.loadCounter=0,R.b.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=nt.FRAG_LOADING_WAITING_RETRY):(R.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=nt.ERROR));break;case w.a.FRAG_LOOP_LOADING_ERROR:t.fatal||(i?(this._reduceMaxBufferLength(e.duration),this.state=nt.IDLE):e.autoLevel&&0!==e.level||(t.fatal=!0,this.state=nt.ERROR));break;case w.a.LEVEL_LOAD_ERROR:case w.a.LEVEL_LOAD_TIMEOUT:this.state!==nt.ERROR&&(t.fatal?(this.state=nt.ERROR,R.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==nt.WAITING_LEVEL||(this.state=nt.IDLE));break;case w.a.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==nt.PARSING&&this.state!==nt.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=nt.IDLE):(R.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},ot.prototype._reduceMaxBufferLength=function(t){var e=this.config;e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,R.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*e.fragLoadingLoopThreshold))},ot.prototype._checkBuffer=function(){var t,e,r,i,a,n,o,s,l=this.media,u=this.config;l&&l.readyState&&(t=l.currentTime,e=(a=this.mediaBuffer||l).buffered,!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,s=l.seeking?t:this.startPosition,r=B.isBuffered(a,s),o=e.start(0),i=!r&&Math.abs(s-o)<u.maxSeekHole,t===s&&!i||(R.b.log("target start position:"+s),i&&R.b.log("target start position not buffered, seek to buffered.start(0) "+(s=o)),R.b.log("adjust currentTime from "+t+" to "+s),l.currentTime=s)):this.immediateSwitch?this.immediateLevelSwitchEnd():(n=B.bufferInfo(l,t,0),a=!(l.paused||l.ended||0===l.buffered.length),t!==this.lastCurrentTime?(this.stallReported&&(R.b.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0):a&&(e=performance.now(),r=this.hls,this.stalled?(i=e-this.stalled,o=n.len,s=this.nudgeRetry||0,o<=.5&&i>1e3*u.lowBufferWatchdogPeriod?(this.stallReported||(this.stallReported=!0,R.b.warn("playback stalling in low buffer @"+t),r.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:o})),n=(a=n.nextStart)-t,a&&n<u.maxSeekHole&&0<n&&(this.nudgeRetry=++s,n=s*u.nudgeOffset,R.b.log("adjust currentTime from "+l.currentTime+" to next buffered @ "+a+" + nudge "+n),l.currentTime=a+n,this.stalled=void 0,r.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:a+n-t}))):.5<o&&i>1e3*u.highBufferWatchdogPeriod&&(this.stallReported||(this.stallReported=!0,R.b.warn("playback stalling in high buffer @"+t),r.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:o})),this.stalled=void 0,this.nudgeRetry=++s,s<u.nudgeMaxRetry?(s=(o=l.currentTime)+s*u.nudgeOffset,R.b.log("adjust currentTime from "+o+" to "+s),l.currentTime=s,r.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.BUFFER_NUDGE_ON_STALL,fatal:!1})):(R.b.error("still stuck in high buffer @"+t+" after "+u.nudgeMaxRetry+", raise fatal error"),r.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.BUFFER_STALLED_ERROR,fatal:!0})))):(this.stalled=e,this.stallReported=!1))))},ot.prototype.onFragLoadEmergencyAborted=function(){this.state=nt.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},ot.prototype.onBufferFlushed=function(){var e=this.mediaBuffer||this.media;this._bufferedFrags=this._bufferedFrags.filter(function(t){return B.isBuffered(e,(t.startPTS+t.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=nt.IDLE,this.fragPrevious=null},ot.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},ot.prototype.computeLivePosition=function(t,e){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-r)},rt(ot,[{key:"state",set:function(t){var e;this.state!==t&&(e=this.state,this._state=t,R.b.log("main stream:"+e+"->"+t),this.hls.trigger(T.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t}))},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){t=this.getBufferedFrag(t.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}]),ot),ut=function(t,e,r){return e&&dt(t.prototype,e),r&&dt(t,r),t};function dt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ct(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,ct);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,st.call(this,t,T.a.MANIFEST_LOADED,T.a.LEVEL_LOADED,T.a.FRAG_LOADED,T.a.ERROR));return t.canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,t}var ht,ft=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(ct,st=l),ct.prototype.destroy=function(){this.cleanTimer(),this.manualLevelIndex=-1},ct.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},ct.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},ct.prototype.stopLoad=function(){this.canload=!1},ct.prototype.onManifestLoaded=function(t){var e,r=[],i={},a=null,n=!1,o=!1,s=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=[];if(t.levels.forEach(function(t){t.loadError=0,t.fragmentError=!1,n=n||!!t.videoCodec,o=o||!!t.audioCodec||!(!t.attrs||!t.attrs.AUDIO),!0===s&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),void 0===(a=i[t.bitrate])?(t.url=[t.url],t.urlId=0,i[t.bitrate]=t,r.push(t)):a.url.push(t.url)}),r=(r=!0===n&&!0===o?r.filter(function(t){return!!t.videoCodec}):r).filter(function(t){var e=t.audioCodec,t=t.videoCodec;return(!e||f(e))&&(!t||f(t))}),t.audioTracks&&(l=t.audioTracks.filter(function(t){return!t.audioCodec||f(t.audioCodec,"audio")})),0<r.length){e=r[0].bitrate,r.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=r;for(var u=0;u<r.length;u++)if(r[u].bitrate===e){this._firstLevel=u,R.b.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+e);break}this.hls.trigger(T.a.MANIFEST_PARSED,{levels:r,audioTracks:l,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:n,altAudio:0<l.length})}else this.hls.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},ct.prototype.setLevelInternal=function(t){var e,r=this._levels,i=this.hls;0<=t&&t<r.length?(this.cleanTimer(),this.currentLevelIndex!==t&&(R.b.log("switching to level "+t),(e=r[this.currentLevelIndex=t]).level=t,i.trigger(T.a.LEVEL_SWITCH,e),i.trigger(T.a.LEVEL_SWITCHING,e)),(r=(e=r[t]).details)&&!0!==r.live||(r=e.urlId,i.trigger(T.a.LEVEL_LOADING,{url:e.url[r],level:t,id:r}))):i.trigger(T.a.ERROR,{type:w.b.OTHER_ERROR,details:w.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},ct.prototype.onError=function(t){if(!0!==t.fatal){var e=!1,r=!1,i=void 0;switch(t.details){case w.a.FRAG_LOAD_ERROR:case w.a.FRAG_LOAD_TIMEOUT:case w.a.FRAG_LOOP_LOADING_ERROR:case w.a.KEY_LOAD_ERROR:case w.a.KEY_LOAD_TIMEOUT:i=t.frag.level,r=!0;break;case w.a.LEVEL_LOAD_ERROR:case w.a.LEVEL_LOAD_TIMEOUT:i=t.context.level,e=!0;break;case w.a.REMUX_ALLOC_ERROR:i=t.level,e=!0}void 0!==i&&this.recoverLevel(t,i,e,r)}else t.type===w.b.NETWORK_ERROR&&this.cleanTimer()},ct.prototype.recoverLevel=function(t,e,r,i){var a,n,o,s=this,l=this.hls.config,u=t.details,d=this._levels[e];if(d.loadError++,d.fragmentError=i,!0===r){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return R.b.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.cleanTimer(),void(t.fatal=!0);n=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return s.loadLevel()},n),t.levelRetry=!0,this.levelRetryCount++,R.b.warn("level controller, "+u+", retry in "+n+" ms, current retry count is "+this.levelRetryCount)}!0!==r&&!0!==i||(1<(a=d.url.length)&&d.loadError<a?(R.b.warn("level controller, "+u+" for level "+e+": switching to redundant stream id "+d.urlId),d.urlId=(d.urlId+1)%a,d.details=void 0):-1===this.manualLevelIndex?(o=0===e?this._levels.length-1:e-1,R.b.warn("level controller, "+u+": switch to "+o),this.hls.nextAutoLevel=this.currentLevelIndex=o):!0===i&&(R.b.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},ct.prototype.onFragLoaded=function(t){t=t.frag;void 0===t||"main"!==t.type||void 0!==(t=this._levels[t.level])&&(t.fragmentError=!1,t.loadError=0,this.levelRetryCount=0)},ct.prototype.onLevelLoaded=function(t){var e,r,i=this,a=t.level;a===this.currentLevelIndex&&(!1===(r=this._levels[a]).fragmentError&&(r.loadError=0,this.levelRetryCount=0),(e=t.details).live?(a=1e3*(e.averagetargetduration||e.targetduration),(r=r.details)&&e.endSN===r.endSN&&(a/=2,R.b.log("same live playlist, reload twice faster")),a-=performance.now()-t.stats.trequest,a=Math.max(1e3,Math.round(a)),R.b.log("live playlist, reload in "+a+" ms"),this.timer=setTimeout(function(){return i.loadLevel()},a)):this.cleanTimer())},ct.prototype.loadLevel=function(){var t,e;null!==this.currentLevelIndex&&!0===this.canload&&void 0!==(t=this._levels[this.currentLevelIndex])&&0<t.url.length&&(e=t.urlId,this.hls.trigger(T.a.LEVEL_LOADING,{url:t.url[e],level:this.currentLevelIndex,id:e}))},ut(ct,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&void 0!==e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),ct),pt=r(3);function gt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,gt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,ht.call(this,t,T.a.MEDIA_ATTACHED,T.a.MEDIA_DETACHING,T.a.FRAG_PARSING_METADATA));return t.id3Track=void 0,t.media=void 0,t}var yt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(gt,ht=l),gt.prototype.destroy=function(){l.prototype.destroy.call(this)},gt.prototype.onMediaAttached=function(t){this.media=t.media,this.media},gt.prototype.onMediaDetaching=function(){this.media=void 0},gt.prototype.onFragParsingMetadata=function(t){var e=t.frag,r=t.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden");for(var i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,a=0;a<r.length;a++){var n=pt.a.getID3Frames(r[a].data);if(n){var o=r[a].pts,s=a<r.length-1?r[a+1].pts:e.endPTS;o===s&&(s+=1e-4);for(var l=0;l<n.length;l++){var u,d=n[l];pt.a.isTimeStampFrame(d)||((u=new i(o,s,"")).value=d,this.id3Track.addCue(u))}}}},gt);function vt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,vt),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}var mt=(vt.prototype.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},vt.prototype.getTotalWeight=function(){return this.totalWeight_},vt.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},vt);function _t(t,e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,_t),this.hls=t,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new mt(e),this.fast_=new mt(r)}var bt,Et=(_t.prototype.sample=function(t,e){e=8e3*e/(t=Math.max(t,this.minDelayMs_)),t/=1e3;this.fast_.sample(t,e),this.slow_.sample(t,e)},_t.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},_t.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},_t.prototype.destroy=function(){},_t),Tt=function(t,e,r){return e&&wt(t.prototype,e),r&&wt(t,r),t};function wt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Rt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Rt);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,bt.call(this,t,T.a.FRAG_LOADING,T.a.FRAG_LOADED,T.a.FRAG_BUFFERED,T.a.ERROR));return e.lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=t,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(e),e}var St=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Rt,bt=l),Rt.prototype.destroy=function(){this.clearTimer(),l.prototype.destroy.call(this)},Rt.prototype.onFragLoading=function(t){var e,r,i,a,n=t.frag;"main"===n.type&&(this.timer||(this.timer=setInterval(this.onCheck,100)),this._bwEstimator||(e=this.hls,a=t.frag.level,r=e.levels[a].details.live,i=e.config,a=t=void 0,a=r?(t=i.abrEwmaFastLive,i.abrEwmaSlowLive):(t=i.abrEwmaFastVoD,i.abrEwmaSlowVoD),this._bwEstimator=new Et(e,a,t,i.abrEwmaDefaultEstimate)),this.fragCurrent=n)},Rt.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,r=this.fragCurrent,i=r.loader,a=t.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return R.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var n=i.stats;if(e&&n&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&r.autoLevel&&r.level){var o=performance.now()-n.trequest,s=Math.abs(e.playbackRate);if(o>500*r.duration/s){var l=t.levels,u=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/o),d=l[r.level],c=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,d=n.total||Math.max(n.loaded,Math.round(r.duration*c/8)),c=e.currentTime,d=(d-n.loaded)/u,h=(B.bufferInfo(e,c,t.config.maxBufferHole).end-c)/s;if(h<2*r.duration/s&&h<d){for(var f=void 0,p=void 0,p=r.level-1;a<p;p--){var g=l[p].realBitrate?Math.max(l[p].realBitrate,l[p].bitrate):l[p].bitrate;if((f=r.duration*g/(6.4*u))<h)break}f<d&&(R.b.warn("loading too slow, abort fragment loading and switch to level "+p+":fragLoadedDelay["+p+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+f.toFixed(1)+"<"+d.toFixed(1)+":"+h.toFixed(1)),t.nextLoadLevel=p,this._bwEstimator.sample(o,n.loaded),i.abort(),this.clearTimer(),t.trigger(T.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n}))}}}},Rt.prototype.onFragLoaded=function(t){var e,r,i=t.frag;"main"!==i.type||isNaN(i.sn)||(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(i=((e=this.hls.levels[i.level]).loaded?e.loaded.bytes:0)+t.stats.loaded,r=(e.loaded?e.loaded.duration:0)+t.frag.duration,e.loaded={bytes:i,duration:r},e.realBitrate=Math.round(8*i/r)),t.frag.bitrateTest&&((r=t.stats).tparsed=r.tbuffered=r.tload,this.onFragBuffered(t)))},Rt.prototype.onFragBuffered=function(t){var e=t.stats,r=t.frag;!0===e.aborted||1!==r.loadCounter||"main"!==r.type||isNaN(r.sn)||r.bitrateTest&&e.tload!==e.tbuffered||(t=e.tparsed-e.trequest,R.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(t,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=t/1e3:this.bitrateTestDelay=0)},Rt.prototype.onError=function(t){switch(t.details){case w.a.FRAG_LOAD_ERROR:case w.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},Rt.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Rt.prototype._findBestLevel=function(t,e,r,i,a,n,o,s,l){for(var u=a;i<=u;u--){var d=l[u].details,c=d?d.totalduration/d.fragments.length:e,h=!!d&&d.live,f=void 0,f=u<=t?o*r:s*r,p=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,d=p*c/f;if(R.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(f)+"/"+p+"/"+c+"/"+n+"/"+d),p<f&&(!d||h&&!this.bitrateTestDelay||d<n))return u}return-1},Tt(Rt,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;e=this._nextABRAutoLevel;return e=-1!==t?Math.min(t,e):e},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,r=t.levels,i=t.config,a=t.minAutoLevel,n=t.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,c=(B.bufferInfo(n,l,i.maxBufferHole).end-l)/u,h=this._findBestLevel(o,s,d,a,e,c,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(0<=h)return h;R.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");t=s?Math.min(s,i.maxStarvationDelay):i.maxStarvationDelay,n=i.abrBandWidthFactor,l=i.abrBandWidthUpFactor;return 0!=c||(u=this.bitrateTestDelay)&&(t=(s?Math.min(s,i.maxLoadingDelay):i.maxLoadingDelay)-u,R.b.trace("bitrate test took "+Math.round(1e3*u)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*t)+" ms"),n=l=1),h=this._findBestLevel(o,s,d,a,e,c+t,n,l,r),Math.max(h,0)}}]),Rt);var At,Lt=V();function Dt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Dt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,At.call(this,t,T.a.MEDIA_ATTACHING,T.a.MEDIA_DETACHING,T.a.MANIFEST_PARSED,T.a.BUFFER_RESET,T.a.BUFFER_APPENDING,T.a.BUFFER_CODECS,T.a.BUFFER_EOS,T.a.BUFFER_FLUSHING,T.a.LEVEL_PTS_UPDATED,T.a.LEVEL_UPDATED));return t._msDuration=null,t._levelDuration=null,t._live=null,t._objectUrl=null,t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t.pendingTracks={},t.tracks={},t}var kt,Ot=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Dt,At=l),Dt.prototype.destroy=function(){l.prototype.destroy.call(this)},Dt.prototype.onLevelPtsUpdated=function(t){var e=t.type,r=this.tracks.audio;if("audio"===e&&r&&"audio/mpeg"===r.container){e=this.sourceBuffer.audio;if(.1<Math.abs(e.timestampOffset-t.start)){r=e.updating;try{e.abort()}catch(t){r=!0,R.b.warn("can not abort audio buffer: "+t)}r?this.audioTimestampOffset=t.start:(R.b.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+t.start),e.timestampOffset=t.start)}}},Dt.prototype.onManifestParsed=function(t){var e=t.audio,r=t.video||t.levels.length&&t.audio,i=0;t.altAudio&&(e||r)&&R.b.log((i=(e?1:0)+(r?1:0))+" sourceBuffer(s) expected"),this.sourceBufferNb=i},Dt.prototype.onMediaAttaching=function(t){var e=this.media=t.media;e&&(t=this.mediaSource=new Lt,this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),t.addEventListener("sourceopen",this.onmso),t.addEventListener("sourceended",this.onmse),t.addEventListener("sourceclose",this.onmsc),e.src=URL.createObjectURL(t),this._objectUrl=e.src)},Dt.prototype.onMediaDetaching=function(){R.b.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){R.b.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):R.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(T.a.MEDIA_DETACHED)},Dt.prototype.onMediaSourceOpen=function(){R.b.log("media source opened"),this.hls.trigger(T.a.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},Dt.prototype.checkPendingTracks=function(){var t=this.pendingTracks,e=Object.keys(t).length;e&&(this.sourceBufferNb<=e||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},Dt.prototype.onMediaSourceClose=function(){R.b.log("media source closed")},Dt.prototype.onMediaSourceEnded=function(){R.b.log("media source ended")},Dt.prototype.onSBUpdateEnd=function(){this.audioTimestampOffset&&(t=this.sourceBuffer.audio,R.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset),this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var r=this.parent,t=this.segments.reduce(function(t,e){return e.parent===r?t+1:t},0);this.hls.trigger(T.a.BUFFER_APPENDED,{parent:r,pending:t}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},Dt.prototype.onSBUpdateError=function(t){R.b.error("sourceBuffer error:",t),this.hls.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.BUFFER_APPENDING_ERROR,fatal:!1})},Dt.prototype.onBufferReset=function(){var t,e=this.sourceBuffer;for(t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},Dt.prototype.onBufferCodecs=function(t){if(0===Object.keys(this.sourceBuffer).length){for(var e in t)this.pendingTracks[e]=t[e];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}},Dt.prototype.createSourceBuffers=function(t){var e,r=this.sourceBuffer,i=this.mediaSource;for(e in t)if(!r[e]){var a=t[e],n=a.levelCodec||a.codec,o=a.container+";codecs="+n;R.b.log("creating sourceBuffer("+o+")");try{var s=r[e]=i.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[e]={codec:n,container:a.container},a.buffer=s}catch(t){R.b.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:o})}}this.hls.trigger(T.a.BUFFER_CREATED,{tracks:t})},Dt.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},Dt.prototype.onBufferAppendFail=function(t){R.b.error("sourceBuffer error:",t.event),this.hls.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.BUFFER_APPENDING_ERROR,fatal:!1})},Dt.prototype.onBufferEos=function(t){var e,r=this.sourceBuffer,i=t.type;for(e in r)i&&e!==i||r[e].ended||(r[e].ended=!0,R.b.log(e+" sourceBuffer now EOS"));this.checkEos()},Dt.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(e&&"open"===e.readyState){for(var r in t){r=t[r];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}R.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){R.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},Dt.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},Dt.prototype.onLevelUpdated=function(t){t=t.details;0<t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._live=t.live,this.updateMediaElementDuration())},Dt.prototype.updateMediaElementDuration=function(){var t,e=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(R.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||t===1/0||isNaN(t))&&(R.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},Dt.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,r=this.sourceBuffer;try{for(var i in r)e+=r[i].buffered.length}catch(t){R.b.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(T.a.BUFFER_FLUSHED)}},Dt.prototype.doAppending=function(){var e=this.hls,t=this.sourceBuffer,r=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void R.b.error("trying to append although a media error occured, flush segment and abort");if(!this.appending&&(r&&r.length)){var i=r.shift();try{var a=t[i.type];a?a.updating?r.unshift(i):(a.ended=!1,this.parent=i.parent,a.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){R.b.error("error while trying to append buffer:"+t.message),r.unshift(i);i={type:w.b.MEDIA_ERROR,parent:i.parent};if(22===t.code)return this.segments=[],i.details=w.a.BUFFER_FULL_ERROR,i.fatal=!1,void e.trigger(T.a.ERROR,i);if(this.appendError?this.appendError++:this.appendError=1,i.details=w.a.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry)return R.b.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],i.fatal=!0,void e.trigger(T.a.ERROR,i);i.fatal=!1,e.trigger(T.a.ERROR,i)}}}},Dt.prototype.flushBuffer=function(t,e,r){var i,a,n,o,s,l,u=this.sourceBuffer;if(Object.keys(u).length){if(R.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if((i=u[d]).ended=!1,i.updating)return R.b.warn("cannot flush, sb updating in progress"),!1;try{for(a=0;a<i.buffered.length;a++)if(n=i.buffered.start(a),o=i.buffered.end(a),l=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&e===Number.POSITIVE_INFINITY?(s=t,e):(s=Math.max(n,t),Math.min(o,e)),.5<Math.min(l,o)-s)return this.flushBufferCounter++,R.b.log("flush "+d+" ["+s+","+l+"], of ["+n+","+o+"], pos:"+this.media.currentTime),i.remove(s,l),!1}catch(t){R.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else R.b.warn("abort flushing too many retries");R.b.log("buffer flushed")}return!0},Dt),a=function(t,e,r){return e&&It(t.prototype,e),r&&It(t,r),t};function It(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function xt(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,xt),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,kt.call(this,t,T.a.FPS_DROP_LEVEL_CAPPING,T.a.MEDIA_ATTACHING,T.a.MANIFEST_PARSED))}var Pt,p=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(xt,kt=l),xt.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},xt.prototype.onFpsDropLevelCapping=function(t){xt.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},xt.prototype.onMediaAttaching=function(t){this.media=t.media instanceof HTMLVideoElement?t.media:null},xt.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],e.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=t.levels,e.firstLevel=this.getMaxLevel(t.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},xt.prototype.detectPlayerSize=function(){var t,e;!this.media||(t=this.levels?this.levels.length:0)&&((e=this.hls).autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping)},xt.prototype.getMaxLevel=function(r){var i=this;if(!this.levels)return-1;var t=this.levels.filter(function(t,e){return xt.isLevelAllowed(e,i.restrictedLevels)&&e<=r});return xt.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)},xt.isLevelAllowed=function(t){return-1===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]).indexOf(t)},xt.getMaxLevelByMediaSize=function(t,e,r){if(!t||t&&!t.length)return-1;for(var i,a,n=t.length-1,o=0;o<t.length;o+=1){var s=t[o];if((s.width>=e||s.height>=r)&&(i=s,!(a=t[o+1])||(i.width!==a.width||i.height!==a.height))){n=o;break}}return n},a(xt,[{key:"mediaWidth",get:function(){var t=void 0,e=this.media;return e&&(t=e.width||e.clientWidth||e.offsetWidth,t*=xt.contentScaleFactor),t}},{key:"mediaHeight",get:function(){var t=void 0,e=this.media;return e&&(t=e.height||e.clientHeight||e.offsetHeight,t*=xt.contentScaleFactor),t}}],[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}]),xt);function Ct(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ct),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,Pt.call(this,t,T.a.MEDIA_ATTACHING))}(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)})(Ct,Pt=l),Ct.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},Ct.prototype.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},Ct.prototype.checkFPS=function(t,e,r){var i,a,n,o,s=performance.now();e&&(this.lastTime&&(n=s-this.lastTime,i=r-this.lastDroppedFrames,o=e-this.lastDecodedFrames,a=1e3*i/n,(n=this.hls).trigger(T.a.FPS_DROP,{currentDropped:i,currentDecoded:o,totalDroppedFrames:r}),0<a&&i>n.config.fpsDroppedMonitoringThreshold*o&&(o=n.currentLevel,R.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+o),0<o&&(-1===n.autoLevelCapping||n.autoLevelCapping>=o)&&(n.trigger(T.a.FPS_DROP_LEVEL_CAPPING,{level:o-=1,droppedLevel:n.currentLevel}),n.autoLevelCapping=o,n.streamController.nextLevelSwitch()))),this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=e)},Ct.prototype.checkFPSInterval=function(){var t,e=this.video;e&&(this.isVideoPlaybackQualityAvailable?(t=e.getVideoPlaybackQuality(),this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)):this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount))},j=Ct;function Mt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Mt),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}var Nt,H=(Mt.prototype.destroy=function(){this.abort(),this.loader=null},Mt.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},Mt.prototype.load=function(t,e,r){this.context=t,this.config=e,this.callbacks=r,this.stats={trequest:performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},Mt.prototype.loadInternal=function(){var e=this.context,r=this.loader=new XMLHttpRequest,i=this.stats;i.tfirst=0,i.loaded=0;i=this.xhrSetup;try{if(i)try{i(r,e.url)}catch(t){r.open("GET",e.url,!0),i(r,e.url)}r.readyState||r.open("GET",e.url,!0)}catch(t){return void this.callbacks.onError({code:r.status,text:t.message},e,r)}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),r.send()},Mt.prototype.readystatechange=function(t){var e,r=t.currentTarget,i=r.readyState,a=this.stats,n=this.context,o=this.config;a.aborted||2<=i&&(window.clearTimeout(this.requestTimeout),0===a.tfirst&&(a.tfirst=Math.max(performance.now(),a.trequest)),4===i?200<=(e=r.status)&&e<300?(a.tload=Math.max(a.tfirst,performance.now()),i=t=void 0,i="arraybuffer"===n.responseType?(t=r.response).byteLength:(t=r.responseText).length,a.loaded=a.total=i,t={url:r.responseURL,data:t},this.callbacks.onSuccess(t,a,n,r)):a.retry>=o.maxRetry||400<=e&&e<499?(R.b.error(e+" while loading "+n.url),this.callbacks.onError({code:e,text:r.statusText},n,r)):(R.b.warn(e+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),a.retry++):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout))},Mt.prototype.loadtimeout=function(){R.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},Mt.prototype.loadprogress=function(t){var e=t.currentTarget,r=this.stats;r.loaded=t.loaded,t.lengthComputable&&(r.total=t.total);t=this.callbacks.onProgress;t&&t(r,this.context,null,e)},Mt),rt=function(t,e,r){return e&&Ft(t.prototype,e),r&&Ft(t,r),t};function Ft(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ut(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ut);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,Nt.call(this,t,T.a.MANIFEST_LOADING,T.a.MANIFEST_PARSED,T.a.AUDIO_TRACK_LOADED,T.a.ERROR));return t.ticks=0,t.ontick=t.tick.bind(t),t}(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)})(Ut,Nt=l),Ut.prototype.destroy=function(){this.cleanTimer(),l.prototype.destroy.call(this)},Ut.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},Ut.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},Ut.prototype.doTick=function(){this.updateTrack(this.trackId)},Ut.prototype.onError=function(t){t.fatal&&t.type===w.b.NETWORK_ERROR&&this.cleanTimer()},Ut.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},Ut.prototype.onManifestParsed=function(t){var e=this,t=t.audioTracks||[],r=!1;this.tracks=t,this.hls.trigger(T.a.AUDIO_TRACKS_UPDATED,{audioTracks:t});var i=0;t.forEach(function(t){return t.default&&!r?(e.audioTrack=i,void(r=!0)):void i++}),!1===r&&t.length&&(R.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},Ut.prototype.onAudioTrackLoaded=function(t){t.id<this.tracks.length&&(R.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration)),!t.details.live&&this.timer&&this.cleanTimer())},Ut.prototype.setAudioTrackInternal=function(t){var e,r,i,a;0<=t&&t<this.tracks.length&&(this.cleanTimer(),this.trackId=t,R.b.log("switching to audioTrack "+t),a=this.tracks[t],e=this.hls,i=a.type,r=a.url,e.trigger(T.a.AUDIO_TRACK_SWITCH,i={id:t,type:i,url:r}),e.trigger(T.a.AUDIO_TRACK_SWITCHING,i),a=a.details,!r||void 0!==a&&!0!==a.live||(R.b.log("(re)loading playlist for audioTrack "+t),e.trigger(T.a.AUDIO_TRACK_LOADING,{url:r,id:t})))},Ut.prototype.updateTrack=function(t){var e,r;0<=t&&t<this.tracks.length&&(this.cleanTimer(),this.trackId=t,R.b.log("updating audioTrack "+t),e=(r=this.tracks[t]).url,r=r.details,!e||void 0!==r&&!0!==r.live||(R.b.log("(re)loading playlist for audioTrack "+t),this.hls.trigger(T.a.AUDIO_TRACK_LOADING,{url:e,id:t})))},rt(Ut,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.trackId===t&&void 0!==this.tracks[t].details||this.setAudioTrackInternal(t)}}]),ut=Ut,Tt=function(t,e,r){return e&&Bt(t.prototype,e),r&&Bt(t,r),t};function Bt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Gt,jt={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"};function qt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,qt);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,Gt.call(this,t,T.a.MEDIA_ATTACHED,T.a.MEDIA_DETACHING,T.a.AUDIO_TRACKS_UPDATED,T.a.AUDIO_TRACK_SWITCHING,T.a.AUDIO_TRACK_LOADED,T.a.KEY_LOADED,T.a.FRAG_LOADED,T.a.FRAG_PARSING_INIT_SEGMENT,T.a.FRAG_PARSING_DATA,T.a.FRAG_PARSED,T.a.ERROR,T.a.BUFFER_RESET,T.a.BUFFER_CREATED,T.a.BUFFER_APPENDED,T.a.BUFFER_FLUSHED,T.a.INIT_PTS_FOUND));return e.config=t.config,e.audioCodecSwap=!1,e.ticks=0,e._state=jt.STOPPED,e.ontick=e.tick.bind(e),e.initPTS=[],e.waitingFragment=null,e.videoTrackCC=null,e}function Ht(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}}var a=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(qt,Gt=l),qt.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),l.prototype.destroy.call(this),this.state=jt.STOPPED},qt.prototype.onInitPtsFound=function(t){var e=t.id,r=t.frag.cc,t=t.initPTS;"main"===e&&(this.initPTS[r]=t,this.videoTrackCC=r,R.b.log("InitPTS for cc:"+r+" found from video track:"+t),this.state===jt.WAITING_INIT_PTS&&this.tick())},qt.prototype.startLoad=function(t){var e;this.tracks?(e=this.lastCurrentTime,this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),(this.fragLoadError=0)<e&&-1===t?(R.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=jt.IDLE):(this.lastCurrentTime=this.startPosition||t,this.state=jt.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()):(this.startPosition=t,this.state=jt.STOPPED)},qt.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=jt.STOPPED},qt.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},qt.prototype.doTick=function(){var t,e,r,i=this.hls,a=i.config;switch(this.state){case jt.ERROR:case jt.PAUSED:case jt.BUFFER_FLUSHING:break;case jt.STARTING:this.state=jt.WAITING_TRACK,this.loadedmetadata=!1;break;case jt.IDLE:var n=this.tracks;if(!n)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;if(this.loadedmetadata)_=this.media.currentTime;else if(void 0===(_=this.nextLoadPosition))break;var o=this.mediaBuffer||this.media,s=this.videoBuffer||this.media,l=B.bufferInfo(o,_,a.maxBufferHole),u=B.bufferInfo(s,_,a.maxBufferHole),d=l.len,c=l.end,h=this.fragPrevious,f=Math.max(a.maxBufferLength,u.len),p=this.audioSwitch,s=this.trackId;if((d<f||p)&&s<n.length){if("undefined"==typeof(e=n[s].details)){this.state=jt.WAITING_TRACK;break}if(!p&&!e.live&&h&&h.sn===e.endSN&&!l.nextStart&&(!this.media.seeking||this.media.duration-c<h.duration/2)){this.hls.trigger(T.a.BUFFER_EOS,{type:"audio"}),this.state=jt.ENDED;break}var u=e.fragments,d=u.length,f=u[0].start,n=u[d-1].start+u[d-1].duration,g=void 0;if(p)if(e.live&&!e.PTSKnown)R.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),c=0;else if(c=_,e.PTSKnown&&_<f){if(!(l.end>f||l.nextStart))return;R.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=f+.05}if(e.initSegment&&!e.initSegment.data)g=e.initSegment;else if(c<=f){if(g=u[0],null!==this.videoTrackCC&&g.cc!==this.videoTrackCC&&(v=u,r=this.videoTrackCC,g=U.search(v,function(t){return t.cc<r?1:t.cc>r?-1:0})),e.live&&g.loadIdx&&g.loadIdx===this.fragLoadIdx){var y=l.nextStart||f;return R.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(y+.05)),void(this.media.currentTime=y+.05)}}else{var v=void 0,m=a.maxFragLookUpTolerance,l=h?u[h.sn-u[0].sn+1]:void 0,y=function(t){var e=Math.min(m,t.duration);return t.start+t.duration-e<=c?1:t.start-e>c&&t.start?-1:0};(v=c<n?(n-m<c&&(m=0),l&&!y(l)?l:U.search(u,y)):u[d-1])&&(f=(g=v).start,h&&g.level===h.level&&g.sn===h.sn&&(g.sn<e.endSN?(g=u[g.sn+1-e.startSN],R.b.log("SN just loaded, load next one: "+g.sn)):g=null))}if(g)if(g.decryptdata&&null!=g.decryptdata.uri&&null==g.decryptdata.key)R.b.log("Loading key for "+g.sn+" of ["+e.startSN+" ,"+e.endSN+"],track "+s),this.state=jt.KEY_LOADING,i.trigger(T.a.KEY_LOADING,{frag:g});else{if(R.b.log("Loading "+g.sn+", cc: "+g.cc+" of ["+e.startSN+" ,"+e.endSN+"],track "+s+", currentTime:"+_+",bufferEnd:"+c.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,g.loadCounter){g.loadCounter++;var _=a.fragLoadingLoopThreshold;if(g.loadCounter>_&&Math.abs(this.fragLoadIdx-g.loadIdx)<_)return void i.trigger(T.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:g})}else g.loadCounter=1;g.loadIdx=this.fragLoadIdx,this.fragCurrent=g,this.startFragRequested=!0,isNaN(g.sn)||(this.nextLoadPosition=g.start+g.duration),i.trigger(T.a.FRAG_LOADING,{frag:g}),this.state=jt.FRAG_LOADING}}break;case jt.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=jt.IDLE);break;case jt.FRAG_LOADING_WAITING_RETRY:var b=performance.now(),g=this.retryDate,E=(o=this.media)&&o.seeking;(!g||g<=b||E)&&(R.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=jt.IDLE);break;case jt.WAITING_INIT_PTS:b=this.videoTrackCC;if(void 0===this.initPTS[b])break;E=this.waitingFragment;E?b!==(E=E.frag.cc)?(t=this.tracks[this.trackId]).details&&t.details.live&&(R.b.warn("Waiting fragment CC ("+E+") does not match video track CC ("+b+")"),this.waitingFragment=null,this.state=jt.IDLE):(this.state=jt.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null):this.state=jt.IDLE;break;case jt.STOPPED:case jt.FRAG_LOADING:case jt.PARSING:case jt.PARSED:case jt.ENDED:}},qt.prototype.onMediaAttached=function(t){t=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);t=this.config;this.tracks&&t.autoStartLoad&&this.startLoad(t.startPosition)},qt.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(R.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.tracks;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},qt.prototype.onMediaSeeking=function(){this.state===jt.ENDED&&(this.state=jt.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},qt.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},qt.prototype.onAudioTracksUpdated=function(t){R.b.log("audio tracks updated"),this.tracks=t.audioTracks},qt.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=jt.PAUSED,this.waitingFragment=null,e?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=jt.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},qt.prototype.onAudioTrackLoaded=function(t){var e=t.details,r=t.id,i=this.tracks[r],a=e.totalduration,t=0;R.b.log("track "+r+" loaded ["+e.startSN+","+e.endSN+"],duration:"+a),e.live?(a=i.details)&&0<e.fragments.length?(Q(a,e),t=e.fragments[0].start,e.PTSKnown?R.b.log("live audio playlist sliding:"+t.toFixed(3)):R.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,R.b.log("live audio playlist - first load, unknown sliding")):e.PTSKnown=!1,i.details=e,this.startFragRequested||(-1===this.startPosition&&(e=e.startTimeOffset,isNaN(e)?this.startPosition=0:(R.b.log("start time offset found in playlist, adjust startPosition to "+e),this.startPosition=e)),this.nextLoadPosition=this.startPosition),this.state===jt.WAITING_TRACK&&(this.state=jt.IDLE),this.tick()},qt.prototype.onKeyLoaded=function(){this.state===jt.KEY_LOADING&&(this.state=jt.IDLE,this.tick())},qt.prototype.onFragLoaded=function(t){var e,r,i,a,n,o,s,l=this.fragCurrent,u=t.frag;this.state===jt.FRAG_LOADING&&l&&"audio"===u.type&&u.level===l.level&&u.sn===l.sn&&(r=(e=(s=this.tracks[this.trackId]).details).totalduration,i=l.level,a=l.sn,n=l.cc,o=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",u=this.stats=t.stats,"initSegment"===a?(this.state=jt.IDLE,u.tparsed=u.tbuffered=performance.now(),e.initSegment.data=t.payload,this.hls.trigger(T.a.FRAG_BUFFERED,{stats:u,frag:l,id:"audio"}),this.tick()):(this.state=jt.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new z(this.hls,"audio")),s=this.initPTS[n],u=e.initSegment?e.initSegment.data:[],e.initSegment||void 0!==s?(this.pendingBuffering=!0,R.b.log("Demuxing "+a+" of ["+e.startSN+" ,"+e.endSN+"],track "+i),this.demuxer.push(t.payload,u,o,null,l,r,!1,s)):(R.b.log("unknown video PTS for continuity counter "+n+", waiting for video PTS before demuxing audio frag "+a+" of ["+e.startSN+" ,"+e.endSN+"],track "+i),this.waitingFragment=t,this.state=jt.WAITING_INIT_PTS))),this.fragLoadError=0},qt.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,r=t.frag;e&&"audio"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===jt.PARSING&&(r=void 0,(e=t.tracks).video&&delete e.video,(r=e.audio)&&(r.levelCodec=r.codec,r.id=t.id,this.hls.trigger(T.a.BUFFER_CODECS,e),R.b.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]"),(r=r.initSegment)&&(r={type:"audio",data:r,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[r]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(T.a.BUFFER_APPENDING,r))),this.tick()))},qt.prototype.onFragParsingData=function(e){var t,r,i,a,n=this,o=this.fragCurrent,s=e.frag;o&&"audio"===e.id&&"audio"===e.type&&s.sn===o.sn&&s.level===o.level&&this.state===jt.PARSING&&(t=this.trackId,i=this.tracks[t],r=this.hls,isNaN(e.endPTS)&&(e.endPTS=e.startPTS+o.duration,e.endDTS=e.startDTS+o.duration),R.b.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),J(i.details,o,e.startPTS,e.endPTS),s=this.audioSwitch,i=this.media,o=!1,s&&i&&(i.readyState?(i=i.currentTime,R.b.log("switching audio track : currentTime:"+i),i>=e.startPTS&&(R.b.log("switching audio track : flushing all audio"),this.state=jt.BUFFER_FLUSHING,r.trigger(T.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),this.audioSwitch=!(o=!0),r.trigger(T.a.AUDIO_TRACK_SWITCHED,{id:t}))):(this.audioSwitch=!1,r.trigger(T.a.AUDIO_TRACK_SWITCHED,{id:t}))),a=this.pendingData,this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&a.push({type:e.type,data:t,parent:"audio",content:"data"})}),!o&&a.length&&(a.forEach(function(t){n.state===jt.PARSING&&(n.pendingBuffering=!0,n.hls.trigger(T.a.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick())},qt.prototype.onFragParsed=function(t){var e=this.fragCurrent,r=t.frag;e&&"audio"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===jt.PARSING&&(this.stats.tparsed=performance.now(),this.state=jt.PARSED,this._checkAppendedParsed())},qt.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},qt.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},qt.prototype.onBufferAppended=function(t){var e;"audio"===t.parent&&((e=this.state)!==jt.PARSING&&e!==jt.PARSED||(this.pendingBuffering=0<t.pending,this._checkAppendedParsed()))},qt.prototype._checkAppendedParsed=function(){var t,e,r;this.state!==jt.PARSED||this.appended&&this.pendingBuffering||(r=this.fragCurrent,t=this.stats,e=this.hls,r&&(this.fragPrevious=r,t.tbuffered=performance.now(),e.trigger(T.a.FRAG_BUFFERED,{stats:t,frag:r,id:"audio"}),r=this.mediaBuffer||this.media,R.b.log("audio buffered : "+$.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,e.trigger(T.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=jt.IDLE),this.tick())},qt.prototype.onError=function(t){var e,r,i,a=t.frag;if(!a||"audio"===a.type)switch(t.details){case w.a.FRAG_LOAD_ERROR:case w.a.FRAG_LOAD_TIMEOUT:t.fatal||((e=this.fragLoadError)?e++:e=1,e<=(r=this.config).fragLoadingMaxRetry?(this.fragLoadError=e,a.loadCounter=0,i=Math.min(Math.pow(2,e-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout),R.b.warn("audioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.state=jt.FRAG_LOADING_WAITING_RETRY):(R.b.error("audioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=jt.ERROR));break;case w.a.FRAG_LOOP_LOADING_ERROR:case w.a.AUDIO_TRACK_LOAD_ERROR:case w.a.AUDIO_TRACK_LOAD_TIMEOUT:case w.a.KEY_LOAD_ERROR:case w.a.KEY_LOAD_TIMEOUT:this.state!==jt.ERROR&&(this.state=t.fatal?jt.ERROR:jt.IDLE,R.b.warn("audioStreamController: "+t.details+" while loading frag,switch to "+this.state+" state ..."));break;case w.a.BUFFER_FULL_ERROR:"audio"!==t.parent||this.state!==jt.PARSING&&this.state!==jt.PARSED||(r=this.mediaBuffer,i=this.media.currentTime,r&&B.isBuffered(r,i)&&B.isBuffered(r,i+.5)?((i=this.config).maxMaxBufferLength>=i.maxBufferLength&&(i.maxMaxBufferLength/=2,R.b.warn("audio:reduce max buffer length to "+i.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.state=jt.IDLE):(R.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=jt.BUFFER_FLUSHING,this.hls.trigger(T.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})))}},qt.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(R.b.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(T.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=jt.PARSED):(this.state=jt.IDLE,this.fragPrevious=null,this.tick())},Tt(qt,[{key:"state",set:function(t){var e;this.state!==t&&(e=this.state,this._state=t,R.b.log("audio stream:"+e+"->"+t))},get:function(){return this._state}}]),qt),Wt=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var b={"":!0,lr:!0,rl:!0},e={start:!0,middle:!0,end:!0,left:!0,right:!0};function E(t){return"string"==typeof t&&(!!e[t.toLowerCase()]&&t.toLowerCase())}function T(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)t[r]=i[r]}return t}function t(t,e,r){var i=this,a=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),n={};a?i=document.createElement("custom"):n.enumerable=!0,i.hasBeenReset=!1;var o="",s=!1,l=t,u=e,d=r,c=null,h="",f=!0,p="auto",g="start",y=50,v="middle",m=50,_="middle";if(Object.defineProperty(i,"id",T({},n,{get:function(){return o},set:function(t){o=""+t}})),Object.defineProperty(i,"pauseOnExit",T({},n,{get:function(){return s},set:function(t){s=!!t}})),Object.defineProperty(i,"startTime",T({},n,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"endTime",T({},n,{get:function(){return u},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");u=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"text",T({},n,{get:function(){return d},set:function(t){d=""+t,this.hasBeenReset=!0}})),Object.defineProperty(i,"region",T({},n,{get:function(){return c},set:function(t){c=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"vertical",T({},n,{get:function(){return h},set:function(t){t="string"==typeof(t=t)&&(!!b[t.toLowerCase()]&&t.toLowerCase());if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"snapToLines",T({},n,{get:function(){return f},set:function(t){f=!!t,this.hasBeenReset=!0}})),Object.defineProperty(i,"line",T({},n,{get:function(){return p},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"lineAlign",T({},n,{get:function(){return g},set:function(t){t=E(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"position",T({},n,{get:function(){return y},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"positionAlign",T({},n,{get:function(){return v},set:function(t){t=E(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"size",T({},n,{get:function(){return m},set:function(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"align",T({},n,{get:function(){return _},set:function(t){t=E(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),i.displayState=void 0,a)return i}return t.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},t}();function Vt(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Ht,this.regionList=[]}function Kt(){this.values=Object.create(null)}function Yt(t,e,r,i){var a,n,o=i?t.split(i):[t];for(a in o)"string"==typeof o[a]&&(2===(n=o[a].split(r)).length&&e(n[0],n[1]))}Kt.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(e=parseFloat(e))&&e<=100)&&(this.set(t,e),!0)}};var zt=new Wt(0,0,0),Xt="middle"===zt.align?"middle":"center";function Jt(r,t,n){var e,i,o,a=r;function s(){var t,t=(t=(t=r).match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/))?t[3]?e(t[1],t[2],t[3].replace(":",""),t[4]):59<t[1]?e(t[1],t[2],0,t[4]):e(0,t[1],t[2],t[4]):null;function e(t,e,r,i){return 3600*(0|t)+60*(0|e)+(0|r)+(0|i)/1e3}if(null===t)throw new Error("Malformed timestamp: "+a);return r=r.replace(/^[^\sa-zA-Z-]+/,""),t}function l(){r=r.replace(/^\s+/,"")}if(l(),t.startTime=s(),l(),"--\x3e"!==r.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+a);r=r.substr(3),l(),t.endTime=s(),l(),e=r,i=t,o=new Kt,Yt(e,function(t,e){switch(t){case"region":for(var r=n.length-1;0<=r;r--)if(n[r].id===e){o.set(t,n[r].region);break}break;case"vertical":o.alt(t,e,["rl","lr"]);break;case"line":var i=e.split(","),a=i[0];o.integer(t,a),o.percent(t,a)&&o.set("snapToLines",!1),o.alt(t,a,["auto"]),2===i.length&&o.alt("lineAlign",i[1],["start",Xt,"end"]);break;case"position":i=e.split(","),o.percent(t,i[0]),2===i.length&&o.alt("positionAlign",i[1],["start",Xt,"end","line-left","line-right","auto"]);break;case"size":o.percent(t,e);break;case"align":o.alt(t,e,["start",Xt,"end","left","right"])}},/:/,/\s/),i.region=o.get("region",null),i.vertical=o.get("vertical",""),"auto"===(e=o.get("line","auto"))&&-1===zt.line&&(e=-1),i.line=e,i.lineAlign=o.get("lineAlign","start"),i.snapToLines=o.get("snapToLines",!0),i.size=o.get("size",100),i.align=o.get("align",Xt),"auto"===(e=o.get("position","auto"))&&50===zt.position&&(e="start"===i.align||"left"===i.align?0:"end"===i.align||"right"===i.align?100:50),i.position=e}function Qt(t){return t.replace(/<br(?: \/)?>/gi,"\n")}Vt.prototype={parse:function(t){var i=this;function e(){for(var t=0,e=Qt(e=i.buffer);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,i.buffer=e.substr(t),r}t&&(i.buffer+=i.decoder.decode(t,{stream:!0}));try{if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var r,a=(r=e()).match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var n=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(n?n=!1:r=e(),i.state){case"HEADER":/:/.test(r)?Yt(r,function(t,e){"Region"===t&&console.log("parse region",e)},/:/):r||(i.state="ID");continue;case"NOTE":r||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){i.state="NOTE";break}if(!r)continue;if(i.cue=new Wt(0,0,""),i.state="CUE",-1===r.indexOf("--\x3e")){i.cue.id=r;continue}case"CUE":try{Jt(r,i.cue,i.regionList)}catch(t){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var o=-1!==r.indexOf("--\x3e");if(!r||o&&(n=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+="\n"),i.cue.text+=r;continue;case"BADCUE":r||(i.state="ID");continue}}}catch(t){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),!t.cue&&"HEADER"!==t.state||(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}};var $t=Vt;function Zt(t,e,r,i){for(var a,n,o,s,l,u=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(o=!0,s=0,l="",!(a=i.rows[d]).isEmpty()){for(var c=0;c<a.chars.length;c++)a.chars[c].uchar.match(/\s/)&&o?s++:(l+=a.chars[c].uchar,o=!1);(a.cueStartTime=e)===r&&(r+=1e-4),n=new u(e,r,Qt(l.trim())),16<=s?s--:s++,navigator.userAgent.match(/Firefox\//)?n.line=d+1:n.line=7<d?d-2:d+1,n.align="left",n.position=Math.max(0,Math.min(100,s/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(n)}}function te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ee(t){var e=t;return ie.hasOwnProperty(t)&&(e=ie[t]),String.fromCharCode(e)}function re(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e}var ie={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ae=15,ne=100,oe={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},se={17:2,18:4,21:6,22:8,23:10,19:13,20:15},le={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ue={25:2,26:4,29:6,30:8,31:10,27:13,28:15},de=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],ce={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){var r=this.verboseFilter[t];this.verboseLevel>=r&&console.log(this.time+" ["+t+"] "+e)}},he=(fe.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},fe.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},fe.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},fe.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},fe.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},fe.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},fe);function fe(t,e,r,i,a){te(this,fe),this.foreground=t||"white",this.underline=e||!1,this.italics=r||!1,this.background=i||"black",this.flash=a||!1}var pe=(ge.prototype.reset=function(){this.uchar=" ",this.penState.reset()},ge.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},ge.prototype.setPenState=function(t){this.penState.copy(t)},ge.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},ge.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},ge.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},ge);function ge(t,e,r,i,a,n){te(this,ge),this.uchar=t||" ",this.penState=new he(e,r,i,a,n)}var ye=(ve.prototype.equals=function(t){for(var e=!0,r=0;r<ne;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},ve.prototype.copy=function(t){for(var e=0;e<ne;e++)this.chars[e].copy(t.chars[e])},ve.prototype.isEmpty=function(){for(var t=!0,e=0;e<ne;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},ve.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(ce.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>ne&&(ce.log("ERROR","Too large cursor position "+this.pos),this.pos=ne)},ve.prototype.moveCursor=function(t){var e=this.pos+t;if(1<t)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},ve.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},ve.prototype.insertChar=function(t){144<=t&&this.backSpace();var e=ee(t);this.pos>=ne?ce.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},ve.prototype.clearFromPos=function(t){for(var e=t;e<ne;e++)this.chars[e].reset()},ve.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},ve.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},ve.prototype.getTextString=function(){for(var t=[],e=!0,r=0;r<ne;r++){var i=this.chars[r].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},ve.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},ve);function ve(){te(this,ve),this.chars=[];for(var t=0;t<ne;t++)this.chars.push(new pe);this.pos=0,this.currPenState=new he}var me=(_e.prototype.reset=function(){for(var t=0;t<ae;t++)this.rows[t].clear();this.currRow=ae-1},_e.prototype.equals=function(t){for(var e=!0,r=0;r<ae;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},_e.prototype.copy=function(t){for(var e=0;e<ae;e++)this.rows[e].copy(t.rows[e])},_e.prototype.isEmpty=function(){for(var t=!0,e=0;e<ae;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},_e.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},_e.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},_e.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},_e.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},_e.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},_e.prototype.setCursor=function(t){ce.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},_e.prototype.setPAC=function(t){ce.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<ae;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var n=a.rows[i].cueStartTime;if(n&&n<ce.time)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(a.rows[i+o])}}this.currRow=e;var s=this.rows[this.currRow];null!==t.indent&&(n=t.indent,n=Math.max(n-1,0),s.setCursor(t.indent),t.color=s.chars[n].penState.foreground);t={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(t)},_e.prototype.setBkgData=function(t){ce.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},_e.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},_e.prototype.rollUp=function(){var t;null!==this.nrRollUpRows?(ce.log("TEXT",this.getDisplayText()),t=this.currRow+1-this.nrRollUpRows,(t=this.rows.splice(t,1)[0]).clear(),this.rows.splice(this.currRow,0,t),ce.log("INFO","Rolling up")):ce.log("DEBUG","roll_up but nrRollUpRows not set yet")},_e.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],r="",i=0;i<ae;i++){var a=this.rows[i].getTextString();a&&(t?e.push("Row "+(i+1)+": '"+a+"'"):e.push(a.trim()))}return r=0<e.length?t?"["+e.join(" | ")+"]":e.join("\n"):r},_e.prototype.getTextAndFormat=function(){return this.rows},_e);function _e(){te(this,_e),this.rows=[];for(var t=0;t<ae;t++)this.rows.push(new ye);this.currRow=ae-1,this.nrRollUpRows=null,this.reset()}var be=(Ee.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[ae-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},Ee.prototype.getHandler=function(){return this.outputFilter},Ee.prototype.setHandler=function(t){this.outputFilter=t},Ee.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},Ee.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},Ee.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,ce.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},Ee.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";ce.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(ce.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},Ee.prototype.ccRCL=function(){ce.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},Ee.prototype.ccBS=function(){ce.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},Ee.prototype.ccAOF=function(){},Ee.prototype.ccAON=function(){},Ee.prototype.ccDER=function(){ce.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},Ee.prototype.ccRU=function(t){ce.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},Ee.prototype.ccFON=function(){ce.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},Ee.prototype.ccRDC=function(){ce.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},Ee.prototype.ccTR=function(){ce.log("INFO","TR"),this.setMode("MODE_TEXT")},Ee.prototype.ccRTD=function(){ce.log("INFO","RTD"),this.setMode("MODE_TEXT")},Ee.prototype.ccEDM=function(){ce.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},Ee.prototype.ccCR=function(){ce.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},Ee.prototype.ccENM=function(){ce.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},Ee.prototype.ccEOC=function(){var t;ce.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(t=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,ce.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())),this.outputDataUpdate(!0)},Ee.prototype.ccTO=function(t){ce.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},Ee.prototype.ccMIDROW=function(t){var e={flash:!1};e.underline=t%2==1,e.italics=46<=t,e.italics?e.foreground="white":(t=Math.floor(t/2)-16,e.foreground=["white","green","blue","cyan","red","yellow","magenta"][t]),ce.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},Ee.prototype.outputDataUpdate=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=ce.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},Ee.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},Ee);function Ee(t,e){te(this,Ee),this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new me,this.nonDisplayedMemory=new me,this.lastOutputScreen=new me,this.currRollUpRow=this.displayedMemory.rows[ae-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}function Te(t,e,r){te(this,Te),this.field=t||1,this.outputs=[e,r],this.channels=[new be(1,e),new be(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}var we=(Te.prototype.getHandler=function(t){return this.channels[t].getHandler()},Te.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},Te.prototype.addData=function(t,e){var r,i=!1;this.lastTime=t,ce.setTime(t);for(var a=0;a<e.length;a+=2){var n=127&e[a],o=127&e[a+1];0!=n||0!=o?(ce.log("DATA","["+re([e[a],e[a+1]])+"] -> ("+re([n,o])+")"),(r=(r=(r=(r=this.parseCmd(n,o))||this.parseMidrow(n,o))||this.parsePAC(n,o))||this.parseBackgroundAttributes(n,o))||(i=this.parseChars(n,o))&&(this.currChNr&&0<=this.currChNr?this.channels[this.currChNr-1].insertChars(i):ce.log("WARNING","No channel found yet. TEXT-MODE?")),r?this.dataCounters.cmd+=2:i?this.dataCounters.char+=2:(this.dataCounters.other+=2,ce.log("WARNING","Couldn't parse cleaned data "+re([n,o])+" orig: "+re([e[a],e[a+1]])))):this.dataCounters.padding+=2}},Te.prototype.parseCmd=function(t,e){var r=null;if(!((20===t||28===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&33<=e&&e<=35))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,ce.log("DEBUG","Repeated command ("+re([t,e])+") is dropped"),!0;var i=this.channels[(r=20===t||23===t?1:2)-1];return 20===t||28===t?32===e?i.ccRCL():33===e?i.ccBS():34===e?i.ccAOF():35===e?i.ccAON():36===e?i.ccDER():37===e?i.ccRU(2):38===e?i.ccRU(3):39===e?i.ccRU(4):40===e?i.ccFON():41===e?i.ccRDC():42===e?i.ccTR():43===e?i.ccRTD():44===e?i.ccEDM():45===e?i.ccCR():46===e?i.ccENM():47===e&&i.ccEOC():i.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=r,!0},Te.prototype.parseMidrow=function(t,e){var r=null;return(17===t||25===t)&&32<=e&&e<=47&&((r=17===t?1:2)!==this.currChNr?(ce.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[r-1].ccMIDROW(e),ce.log("DEBUG","MIDROW ("+re([t,e])+")"),!0))},Te.prototype.parsePAC=function(t,e){if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127)&&!((16===t||24===t)&&64<=e&&e<=95))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,!(this.lastCmdB=null);var r=t<=23?1:2,i=this.interpretPAC((64<=e&&e<=95?1==r?oe:le:1==r?se:ue)[t],e);return this.channels[r-1].setPAC(i),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=r,!0},Te.prototype.interpretPAC=function(t,e){var r=e,t={color:null,italics:!1,indent:null,underline:!1,row:t};return t.underline=1==(1&(r=95<e?e-96:e-64)),r<=13?t.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(t.italics=!0,t.color="white"):t.indent=4*Math.floor((r-16)/2),t},Te.prototype.parseChars=function(t,e){var r,i=null,a=null,n=null;return 17<=(n=25<=t?(i=2,t-8):(i=1,t))&&n<=19?(r=e,ce.log("INFO","Special char '"+ee(r=17===n?e+80:18===n?e+112:e+144)+"' in channel "+i),a=[r]):32<=t&&t<=127&&(a=0===e?[t]:[t,e]),a&&(e=re(a),ce.log("DEBUG","Char codes =  "+e.join(",")),this.lastCmdA=null,this.lastCmdB=null),a},Te.prototype.parseBackgroundAttributes=function(t,e){var r,i;return((16===t||24===t)&&32<=e&&e<=47||(23===t||31===t)&&45<=e&&e<=47)&&(r={},16===t||24===t?(i=Math.floor((e-32)/2),r.background=de[i],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0)),this.channels[(t<24?1:2)-1].setBkgData(r),this.lastCmdA=null,!(this.lastCmdB=null))},Te.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},Te.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},Te);function Re(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Re),this.timelineController=t,this.track=e,this.startTime=null,this.endTime=null,this.screen=null}function Se(t,e,r){return t.substr(r||0,e.length)===e}function Ae(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()}var Le,De=(Re.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},Re.prototype.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.track)},Re),ke={parse:function(t,n,i,a,e,r){var t=Object(pt.b)(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),o="00:00.000",s=0,l=0,u=0,d=[],c=void 0,h=!0,f=new $t;f.oncue=function(t){var e=i[a],r=i.ccOffset;e&&e.new&&(void 0!==l?r=i.ccOffset=e.start:function(t,e,r){var i=t[e],a=t[i.prevCC];if(!a||!a.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,i.new=!1;for(;a&&a.new;)t.ccOffset+=i.start-a.start,i.new=!1,a=t[(i=a).prevCC];t.presentationOffset=r}(i,a,u)),u&&(r=u+i.ccOffset-i.presentationOffset),t.startTime+=r-l,t.endTime+=r-l,t.id=Ae(t.startTime.toString())+Ae(t.endTime.toString())+Ae(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),0<t.endTime&&d.push(t)},f.onparsingerror=function(t){c=t},f.onflush=function(){c&&r?r(c):e(d)},t.forEach(function(e){if(h){if(Se(e,"X-TIMESTAMP-MAP=")){h=!1,e.substr(16).split(",").forEach(function(t){Se(t,"LOCAL:")?o=t.substr(6):Se(t,"MPEGTS:")&&(s=parseInt(t.substr(7)))});try{s-=n=n<0?n+8589934592:n,t=o,r=parseInt(t.substr(-3)),i=parseInt(t.substr(-6,2)),a=parseInt(t.substr(-9,2)),t=9<t.length?parseInt(t.substr(0,t.indexOf(":"))):0,l=(isNaN(r)||isNaN(i)||isNaN(a)||isNaN(t)?-1:(r+=1e3*i,r+=6e4*a,r+=36e5*t))/1e3,u=s/9e4,-1===l&&(c=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){c=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(h=!1)}var t,r,i,a;f.parse(e+"\n")}),f.flush()}};function Oe(t){if(t&&t.cues)for(;0<t.cues.length;)t.removeCue(t.cues[0])}function Ie(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ie);var e,r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,Le.call(this,t,T.a.MEDIA_ATTACHING,T.a.MEDIA_DETACHING,T.a.FRAG_PARSING_USERDATA,T.a.FRAG_DECRYPTED,T.a.MANIFEST_LOADING,T.a.MANIFEST_LOADED,T.a.FRAG_LOADED,T.a.LEVEL_SWITCHING,T.a.INIT_PTS_FOUND));return r.hls=t,r.config=t.config,r.enabled=!0,r.Cues=t.config.cueHandler,r.textTracks=[],r.tracks=[],r.unparsedVttFrags=[],r.initPTS=void 0,r.cueRanges=[],r.config.enableCEA708Captions&&(e=new De(r,1),t=new De(r,2),r.cea608Parser=new we(0,e,t)),r}var xe,rt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Ie,Le=l),Ie.prototype.addCues=function(t,e,r,i){for(var a,n,o,s=this.cueRanges,l=!1,u=s.length;u--;){var d=s[u],c=(a=d[0],n=d[1],c=e,o=r,Math.min(n,o)-Math.max(a,c));if(0<=c&&(d[0]=Math.min(d[0],e),d[1]=Math.max(d[1],r),l=!0,.5<c/(r-e)))return}l||s.push([e,r]),this.Cues.newCue(this[t],e,r,i)},Ie.prototype.onInitPtsFound=function(t){var e=this;"undefined"==typeof this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){e.onFragLoaded(t)}),this.unparsedVttFrags=[])},Ie.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var i=e.textTracks[r];if(!0===i["textTrack"+t])return i}return null},Ie.prototype.sendAddTrackEvent=function(t,e){var r=null;try{r=new window.Event("addtrack")}catch(t){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)},Ie.prototype.createCaptionsTrack=function(t){var e,r="textTrack"+t;this[r]||((e=this.getExistingTrack(t))?(this[r]=e,Oe(this[r]),this.sendAddTrackEvent(this[r],this.media)):(t=this.createTextTrack("captions",this.config["captionsTextTrack"+t+"Label"],this.config.captionsTextTrack1LanguageCode))&&(t[r]=!0,this[r]=t))},Ie.prototype.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},Ie.prototype.destroy=function(){l.prototype.destroy.call(this)},Ie.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},Ie.prototype.onMediaDetaching=function(){Oe(this.textTrack1),Oe(this.textTrack2)},Ie.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},Ie.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)Oe(e[r])}},Ie.prototype.onManifestLoaded=function(t){var n,o=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT&&(this.tracks=t.subtitles||[],n=this.media?this.media.textTracks:[],this.tracks.forEach(function(t,e){var r,i,a=void 0;e<n.length&&(r=n[e],i=t,!(e=r)||e.label!==i.name||e.textTrack1||e.textTrack2||(a=r)),(a=a||o.createTextTrack("subtitles",t.name,t.lang)).mode=t.default?"showing":"hidden",o.textTracks.push(a)}))},Ie.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},Ie.prototype.onFragLoaded=function(t){var e,r,i=t.frag,a=t.payload;"main"===i.type?((r=i.sn)===this.lastSn+1||(e=this.cea608Parser)&&e.reset(),this.lastSn=r):"subtitle"===i.type&&(a.byteLength?"undefined"!=typeof this.initPTS?null!=(r=i.decryptdata)&&null!=r.key&&"AES-128"===r.method||this._parseVTTs(i,a):this.unparsedVttFrags.push(t):this.hls.trigger(T.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i}))},Ie.prototype._parseVTTs=function(e,t){var r=this.vttCCs;r[e.cc]||(r[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var a=this.textTracks,n=this.hls;ke.parse(t,this.initPTS,r,e.cc,function(t){var i=a[e.trackId];t.forEach(function(e){if(!i.cues.getCueById(e.id))try{i.addCue(e)}catch(t){var r=new window.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}}),n.trigger(T.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){R.b.log("Failed to parse VTT cue: "+t),n.trigger(T.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},Ie.prototype.onFragDecrypted=function(t){var e=t.payload,r=t.frag;"subtitle"===r.type&&("undefined"!=typeof this.initPTS?this._parseVTTs(r,e):this.unparsedVttFrags.push(t))},Ie.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var r=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,r)}},Ie.prototype.extractCea608Data=function(t){for(var e,r,i,a=31&t[0],n=2,o=[],s=0;s<a;s++)e=t[n++],r=127&t[n++],i=127&t[n++],0==r&&0==i||0!=(4&e)&&0==(3&e)&&(o.push(r),o.push(i));return o},Ie),Tt=function(t,e,r){return e&&Pe(t.prototype,e),r&&Pe(t,r),t};function Pe(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ce(t){for(var e=[],r=0;r<t.length;r++)"subtitles"===t[r].kind&&e.push(t[r]);return e}function Me(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Me);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,xe.call(this,t,T.a.MEDIA_ATTACHED,T.a.MEDIA_DETACHING,T.a.MANIFEST_LOADING,T.a.MANIFEST_LOADED,T.a.SUBTITLE_TRACK_LOADED));return t.tracks=[],t.trackId=-1,t.media=void 0,t.subtitleDisplay=!1,t}var Tt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Me,xe=l),Me.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=Ce(this.media.textTracks),r=0;r<e.length;r++)"showing"===e[r].mode&&(t=r);this.subtitleTrack=t}},Me.prototype.destroy=function(){l.prototype.destroy.call(this)},Me.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},Me.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},Me.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},Me.prototype.onManifestLoaded=function(t){var e=this,t=t.subtitles||[];this.tracks=t,this.trackId=-1,this.hls.trigger(T.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:t}),t.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},Me.prototype.onTick=function(){var t,e=this.trackId,r=this.tracks[e];r&&(void 0!==(t=r.details)&&!0!==t.live||(R.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(T.a.SUBTITLE_TRACK_LOADING,{url:r.url,id:e})))},Me.prototype.onSubtitleTrackLoaded=function(t){var e=this;t.id<this.tracks.length&&(R.b.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},Me.prototype.setSubtitleTrackInternal=function(t){var e,r;t<-1||t>=this.tracks.length||(this.timer&&(clearInterval(this.timer),this.timer=null),r=Ce(this.media.textTracks),-1!==this.trackId&&this.subtitleDisplay&&(r[this.trackId].mode="hidden"),this.trackId=t,R.b.log("switching to subtitle track "+t),this.hls.trigger(T.a.SUBTITLE_TRACK_SWITCH,{id:t}),-1!==t&&(e=this.tracks[t],this.subtitleDisplay&&(r[t].mode="showing"),void 0!==(r=e.details)&&!0!==r.live||(R.b.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(T.a.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))))},Tt(Me,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&this.setSubtitleTrackInternal(t)}}]),Me),Ne=r(4);var Fe,Ue={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},r=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Be,Fe=l),Be.prototype.destroy=function(){l.prototype.destroy.call(this),this.state=Ue.STOPPED},Be.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},Be.prototype.nextFrag=function(){var t;null===this.currentlyProcessing&&-1<this.currentTrackId&&this.vttFragQueues[this.currentTrackId].length&&(t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift(),this.fragCurrent=t,this.hls.trigger(T.a.FRAG_LOADING,{frag:t}),this.state=Ue.FRAG_LOADING)},Be.prototype.onSubtitleFragProcessed=function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.state=Ue.IDLE,this.nextFrag()},Be.prototype.onMediaAttached=function(){this.state=Ue.IDLE},Be.prototype.onError=function(t){t=t.frag;t&&"subtitle"!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},Be.prototype.tick=function(){var t=this;this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(function(){t.tick()},1),this.ticks=0)},Be.prototype.doTick=function(){var i=this;switch(this.state){case Ue.IDLE:var t,e=this.tracks,a=this.currentTrackId,n=this.vttFragSNsProcessed[a],o=this.vttFragQueues[a],s=this.currentlyProcessing?this.currentlyProcessing.sn:-1;if(!e)break;if("undefined"==typeof(t=a<e.length?e[a].details:t))break;t.fragments.forEach(function(t){var e,r;r=t,-1<n.indexOf(r.sn)||t.sn===s||(e=t,o.some(function(t){return t.sn===e.sn}))||(t.decryptdata&&null!=t.decryptdata.uri&&null==t.decryptdata.key?(R.b.log("Loading key for "+t.sn),i.state=Ue.KEY_LOADING,i.hls.trigger(T.a.KEY_LOADING,{frag:t})):(t.trackId=a,o.push(t),i.nextFrag()))})}},Be.prototype.onSubtitleTracksUpdated=function(t){var e=this;R.b.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){e.vttFragSNsProcessed[t.id]=[]})},Be.prototype.onSubtitleTrackSwitch=function(t){this.currentTrackId=t.id,this.clearVttFragQueues()},Be.prototype.onSubtitleTrackLoaded=function(){this.tick()},Be.prototype.onKeyLoaded=function(){this.state===Ue.KEY_LOADING&&(this.state=Ue.IDLE,this.tick())},Be.prototype.onFragLoaded=function(t){var r,e=this.fragCurrent,i=t.frag.decryptdata,a=t.frag,n=this.hls;if(this.state===Ue.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&0<t.payload.byteLength&&null!=i&&null!=i.key&&"AES-128"===i.method){try{r=performance.now()}catch(t){r=Date.now()}this.decrypter.decrypt(t.payload,i.key.buffer,i.iv.buffer,function(t){var e;try{e=performance.now()}catch(t){e=Date.now()}n.trigger(T.a.FRAG_DECRYPTED,{frag:a,payload:t,stats:{tstart:r,tdecrypt:e}})})}},Be);function Be(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Be);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,Fe.call(this,t,T.a.MEDIA_ATTACHED,T.a.ERROR,T.a.KEY_LOADED,T.a.FRAG_LOADED,T.a.SUBTITLE_TRACKS_UPDATED,T.a.SUBTITLE_TRACK_SWITCH,T.a.SUBTITLE_TRACK_LOADED,T.a.SUBTITLE_FRAG_PROCESSED));return e.config=t.config,e.vttFragSNsProcessed={},e.vttFragQueues=void 0,e.currentlyProcessing=null,e.state=Ue.STOPPED,e.currentTrackId=-1,e.ticks=0,e.decrypter=new Ne.a(t.observer,t.config),e}var Ge={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:H,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:St,bufferController:Ot,capLevelController:p,fpsController:j,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};Ge.subtitleStreamController=r,Ge.subtitleTrackController=Tt,Ge.timelineController=rt,Ge.cueHandler=i,Ge.enableCEA708Captions=!0,Ge.enableWebVTT=!0,Ge.captionsTextTrack1Label="English",Ge.captionsTextTrack1LanguageCode="en",Ge.captionsTextTrack2Label="Spanish",Ge.captionsTextTrack2LanguageCode="es",Ge.audioStreamController=a,Ge.audioTrackController=ut;ut=function(t,e,r){return e&&je(t.prototype,e),r&&je(t,r),t};function je(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}qe.isSupported=function(){return t=V(),e=window.SourceBuffer||window.WebKitSourceBuffer,t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,!!t&&!!e;var t,e},ut(qe,null,[{key:"version",get:function(){return"0.8.9"}},{key:"Events",get:function(){return T.a}},{key:"ErrorTypes",get:function(){return w.b}},{key:"ErrorDetails",get:function(){return w.a}},{key:"DefaultConfig",get:function(){return qe.defaultConfig||Ge},set:function(t){qe.defaultConfig=t}}]),qe.prototype.destroy=function(){R.b.log("destroy"),this.trigger(T.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},qe.prototype.attachMedia=function(t){R.b.log("attachMedia"),this.media=t,this.trigger(T.a.MEDIA_ATTACHING,{media:t})},qe.prototype.detachMedia=function(){R.b.log("detachMedia"),this.trigger(T.a.MEDIA_DETACHING),this.media=null},qe.prototype.loadSource=function(t){t=n.a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),R.b.log("loadSource:"+t),this.url=t,this.trigger(T.a.MANIFEST_LOADING,{url:t})},qe.prototype.startLoad=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;R.b.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},qe.prototype.stopLoad=function(){R.b.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},qe.prototype.swapAudioCodec=function(){R.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},qe.prototype.recoverMediaError=function(){R.b.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},ut(qe,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){R.b.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){R.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){R.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){R.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){R.b.log("set startLevel:"+t);-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){R.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this.levels,e=this.config.minAutoBitrate,r=t?t.length:0,i=0;i<r;i++)if(e<(t[i].realBitrate?Math.max(t[i].realBitrate,t[i].bitrate):t[i].bitrate))return i;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}}]),ut=qe;function qe(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,qe);var r,i=qe.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(r in i)r in t||(t[r]=i[r]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(R.a)(t.debug),this.config=t,this._autoLevelCapping=-1;var a=this.observer=new q.a;a.trigger=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.emit.apply(a,[t,t].concat(r))},a.off=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.removeListener.apply(a,[t].concat(r))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a);var n=this.abrController=new t.abrController(this),o=new t.bufferController(this),s=new t.capLevelController(this),l=new t.fpsController(this),u=new x(this),d=new M(this),c=new F(this),h=new yt(this),f=[this.levelController=new ft(this),this.streamController=new lt(this)],p=t.audioStreamController;p&&f.push(new p(this)),this.networkControllers=f;var g=[u,d,c,n,o,s,l,h];(p=t.audioTrackController)&&(h=new p(this),this.audioTrackController=h,g.push(h)),(p=t.subtitleTrackController)&&(p=new p(this),this.subtitleTrackController=p,g.push(p)),[t.subtitleStreamController,t.timelineController].forEach(function(t){t&&g.push(new t(e))}),this.coreComponents=g}e.default=ut},function(t,e,a){function n(t,e){for(var r=[e],i=[],a={};r.length;){var n=r.pop();!a[n]&&t[n]&&(a[n]=!0,i.push(n),n=function(t){var e=[],r=t.toString();if(!(t=r.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/)))return e;for(var i,t=t[1],a=new RegExp("(\\\\n|\\W)"+(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");i=a.exec(r);)e.push(i[3]);return e}(t[n]),r=r.concat(n))}return i}t.exports=function(t,e){var r=a.m,i=(e=e||{}).all?Object.keys(r):n(r,t),i="("+function(r){var i={};function a(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=r,a.c=i,a.i=function(t){return t},a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a.oe=function(t){throw console.error(t),t};var t=a(a.s=ENTRY_MODULE);return t.default||t}.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i.map(function(t){return JSON.stringify(t)+": "+r[t].toString()}).join(",")+"})(self);",i=new window.Blob([i],{type:"text/javascript"});if(e.bare)return i;e=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(i),i=new window.Worker(e);return i.objectURL=e,i}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r(7),s=r(1),l=r(0),i=r(5),u=r.n(i);e.default=function(i){var a=new u.a;a.trigger=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.emit.apply(a,[t,t].concat(r))},a.off=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.removeListener.apply(a,[t].concat(r))};function n(t,e){i.postMessage({event:t,data:e})}i.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var r=JSON.parse(e.config);i.demuxer=new o.a(a,e.typeSupported,r,e.vendor);try{Object(l.a)(!0===r.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}n("init",null);break;case"demux":i.demuxer.push(e.data,e.decryptdata,e.initSegment,e.audioCodec,e.videoCodec,e.timeOffset,e.discontinuity,e.trackSwitch,e.contiguous,e.duration,e.accurateTimeOffset,e.defaultInitPTS)}}),a.on(s.a.FRAG_DECRYPTED,n),a.on(s.a.FRAG_PARSING_INIT_SEGMENT,n),a.on(s.a.FRAG_PARSED,n),a.on(s.a.ERROR,n),a.on(s.a.FRAG_PARSING_METADATA,n),a.on(s.a.FRAG_PARSING_USERDATA,n),a.on(s.a.INIT_PTS_FOUND,n),a.on(s.a.FRAG_PARSING_DATA,function(t,e){var r=[],t={event:t,data:e};e.data1&&(t.data1=e.data1.buffer,r.push(e.data1.buffer),delete e.data1),e.data2&&(t.data2=e.data2.buffer,r.push(e.data2.buffer),delete e.data2),i.postMessage(t,r)})}}],i.c=a,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=8).default;function i(t){if(a[t])return a[t].exports;var e=a[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var r,a},t.exports=i()},960:
/*!*********************************************!*\
  !*** ../node_modules/mux-embed/dist/mux.js ***!
  \*********************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,r){t.exports=function(r){function i(t){if(a[t])return a[t].exports;var e=a[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var a={};return i.m=r,i.c=a,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=16)}([function(e,t,r){!function(t){t="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};e.exports=t}.call(t,r(6))},function(t,e){function r(t,e){var r,i,a=A(t)||function(t){return function(t){return!!t&&"object"==typeof t}(t)&&d(t)}(r=t)&&b.call(r,"callee")&&(!T.call(r,"callee")||E.call(r)==g)?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],n=a.length,o=!!n;for(i in t)!e&&!b.call(t,i)||o&&("length"==i||s(i,n))||a.push(i);return a}function l(t,e,r){var i=t[e];b.call(t,e)&&u(i,r)&&(void 0!==r||e in t)||(t[e]=r)}function i(n,o){return o=R(void 0===o?n.length-1:o,0),function(){for(var t=arguments,e=-1,r=R(t.length-o,0),i=Array(r);++e<r;)i[e]=t[o+e];for(var e=-1,a=Array(o+1);++e<o;)a[e]=t[e];return a[o]=i,function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(n,this,a)}}function s(t,e){return(e=null==e?p:e)&&("number"==typeof t||m.test(t))&&-1<t&&t%1==0&&t<e}function a(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||_)}function u(t,e){return t===e||t!=t&&e!=e}function d(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=p)&&!function(t){t=c(t)?E.call(t):"";return t==y||t==v}(t);var e}function c(t){var e=typeof t;return t&&("object"==e||"function"==e)}function n(t){return(d(t)?r:function(t){if(!a(t))return w(t);var e,r=[];for(e in Object(t))b.call(t,e)&&"constructor"!=e&&r.push(e);return r})(t)}var h,o,f,p=9007199254740991,g="[object Arguments]",y="[object Function]",v="[object GeneratorFunction]",m=/^(?:0|[1-9]\d*)$/,_=Object.prototype,b=_.hasOwnProperty,E=_.toString,T=_.propertyIsEnumerable,w=(o=Object.keys,f=Object,function(t){return o(f(t))}),R=Math.max,S=!T.call({valueOf:1},"valueOf"),A=Array.isArray,L=(h=function(t,e){if(S||a(e)||d(e))!function(t,e,r,i){r=r||{};for(var a=-1,n=e.length;++a<n;){var o=e[a],s=i?i(r[o],t[o],o,r,t):void 0;l(r,o,void 0===s?t[o]:s)}}(e,n(e),t);else for(var r in e)b.call(e,r)&&l(t,r,e[r])},i(function(t,e){var r=-1,i=e.length,a=1<i?e[i-1]:void 0,n=2<i?e[2]:void 0,a=3<h.length&&"function"==typeof a?(i--,a):void 0;for(n&&function(t,e,r){if(c(r)){var i=typeof e;return("number"==i?d(r)&&s(e,r.length):"string"==i&&e in r)&&u(r[e],t)}}(e[0],e[1],n)&&(a=i<3?void 0:a,i=1),t=Object(t);++r<i;){var o=e[r];o&&h(t,o)}return t}));t.exports=L},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r){r=void 0===r?1:r,t[e]=t[e]||0,t[e]+=r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=r(0),i=r&&r.__esModule?r:{default:r},r={now:function(){var t=i.default.performance,e=t&&t.timing;return e&&"number"==typeof e.navigationStart&&"function"==typeof t.now?e.navigationStart+t.now():Date.now()}};e.default=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=r(18),r=r&&r.__esModule?r:{default:r},a=r.default.methodFactory;r.default.methodFactory=function(t,e,r){var i=a(t,e,r);return function(){for(var t=["[mux]"],e=0;e<arguments.length;e++)t.push(arguments[e]);i.apply(void 0,t)}},r.default.setLevel(r.default.getLevel()),e.default=r.default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if("string"!=typeof t||""===t)return["localhost"];var e=(t.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4],t=void 0;return e&&(t=(e.match(/[^\.]+\.[^\.]+$/)||[])[0]),[e,t]};e.extractHostnameAndDomain=i,e.extractHostname=function(t){return i(t)[0]},e.extractDomain=function(t){return i(t)[1]}},function(t,e){var r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},e.generateShortID=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var r={};return(t=t||"").trim().split(/[\r\n]+/).forEach(function(t){var e;!t||(t=(e=t.split(": ")).shift())&&0<=i.indexOf(t.toLowerCase())&&(r[t]=e.join(": "))}),r};var i=["x-cdn","content-type"]},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.findMediaElement=e.getMuxPlayerId=void 0;function i(t){return t&&void 0!==t.nodeName?(t.muxId||(t.muxId=t.id||(0,a.generateShortID)()),t.muxId):t}var a=r(7);e.getMuxPlayerId=i,e.findMediaElement=function(t){var e=void 0;return t&&void 0!==t.nodeName?t=i(e=t):e=document.querySelector(t),[e,t,e&&e.nodeName?e.nodeName.toLowerCase():""]}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return"1"===(i.default.doNotTrack||i.default.navigator&&(i.default.navigator.doNotTrack||i.default.navigator.msDoNotTrack))};var r=r(0),i=r&&r.__esModule?r:{default:r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=r(0),i=r&&r.__esModule?r:{default:r},r={exists:function(){var t=i.default.performance;return void 0!==(t&&t.timing)},domContentLoadedEventEnd:function(){var t=i.default.performance,t=t&&t.timing;return t&&t.domContentLoadedEventEnd},navigationStart:function(){var t=i.default.performance,t=t&&t.timing;return t&&t.navigationStart}};e.default=r},function(t,e,r){"use strict";var i=r(42),a=r(43),r=r(14);t.exports={formats:r,parse:a,stringify:i}},function(t,n,e){"use strict";var o=Object.prototype.hasOwnProperty,s=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}();n.arrayToObject=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},i=0;i<t.length;++i)void 0!==t[i]&&(r[i]=t[i]);return r},n.merge=function(r,i,a){if(!i)return r;if("object"!=typeof i){if(Array.isArray(r))r.push(i);else{if("object"!=typeof r)return[r,i];!a.plainObjects&&!a.allowPrototypes&&o.call(Object.prototype,i)||(r[i]=!0)}return r}if("object"!=typeof r)return[r].concat(i);var t=r;return Array.isArray(r)&&!Array.isArray(i)&&(t=n.arrayToObject(r,a)),Array.isArray(r)&&Array.isArray(i)?(i.forEach(function(t,e){o.call(r,e)?r[e]&&"object"==typeof r[e]?r[e]=n.merge(r[e],t,a):r.push(t):r[e]=t}),r):Object.keys(i).reduce(function(t,e){var r=i[e];return o.call(t,e)?t[e]=n.merge(t[e],r,a):t[e]=r,t},t)},n.assign=function(t,r){return Object.keys(r).reduce(function(t,e){return t[e]=r[e],t},t)},n.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},n.encode=function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),r="",i=0;i<e.length;++i){var a=e.charCodeAt(i);45===a||46===a||95===a||126===a||48<=a&&a<=57||65<=a&&a<=90||97<=a&&a<=122?r+=e.charAt(i):a<128?r+=s[a]:a<2048?r+=s[192|a>>6]+s[128|63&a]:a<55296||57344<=a?r+=s[224|a>>12]+s[128|a>>6&63]+s[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&e.charCodeAt(i)),r+=s[240|a>>18]+s[128|a>>12&63]+s[128|a>>6&63]+s[128|63&a])}return r},n.compact=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],i=0;i<e.length;++i)for(var a=e[i],n=a.obj[a.prop],o=Object.keys(n),s=0;s<o.length;++s){var l=o[s],u=n[l];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(e.push({obj:n,prop:l}),r.push(u))}return function(t){for(;t.length;){var e=t.pop(),r=e.obj[e.prop];if(Array.isArray(r)){for(var i=[],a=0;a<r.length;++a)void 0!==r[a]&&i.push(r[a]);e.obj[e.prop]=i}}return r}(e)},n.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},n.isBuffer=function(t){return null!=t&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}},function(t,e,r){"use strict";var i=String.prototype.replace,a=/%20/g;t.exports={default:"RFC3986",formatters:{RFC1738:function(t){return i.call(t,a,"+")},RFC3986:function(t){return t}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function a(t){var e,r={};for(e in t)t.hasOwnProperty(e)&&(r[t[e]]=e);return r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n){var o={},s={};return Object.keys(n).forEach(function(e){var t,r,i,a=!1;n.hasOwnProperty(e)&&void 0!==n[e]&&(r=(t=e.split("_"))[0],(i=d[r])||(l.default.info("Data key word `"+t[0]+"` not expected in "+e),i=r+"_"),t.splice(1).forEach(function(t){"url"===t&&(a=!0),c[t]?i+=c[t]:(l.default.info("Data key word `"+t+"` not expected in "+e),i+="_"+t+"_")}),a?s[i]=n[e]:o[i]=n[e])}),(0,u.default)(o,s)};var l=i(r(4)),u=i(r(1)),d=a({a:"env",b:"beacon",d:"ad",e:"event",f:"experiment",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),c=a({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"})},function(t,e,r){"use strict";t.exports=r(17).default},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});function a(t){var e=arguments;"string"==typeof t?a.hasOwnProperty(t)?o.default.setTimeout(function(){e=Array.prototype.splice.call(e,1),a[t].apply(null,e)},0):l.default.warn("`"+t+"` is an unknown task"):"function"==typeof t?o.default.setTimeout(function(){t(a)},0):l.default.warn("`"+t+"` is invalid.")}var n=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,a=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){a=!0,n=t}finally{try{!i&&s.return&&s.return()}finally{if(a)throw n}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=i(r(0)),s=r(9),l=i(r(4)),u=i(r(10)),d=i(r(3)),c=i(r(19)),h=i(r(50)),r=i(r(51)),f={};a.loaded=d.default.now(),a.NAME="mux-embed",a.VERSION="4.0.1",a.API_VERSION="2.1",a.PLAYER_TRACKED=!1,a.monitor=function(t,e){return(0,h.default)(a,t,e)},a.destroyMonitor=function(t){var e=(0,s.findMediaElement)(t),e=n(e,1)[0];e&&e.mux&&"function"==typeof e.mux.destroy?e.mux.destroy():l.default.error("A video element monitor for `"+t+"` has not been initialized via `mux.monitor`.")},a.addHLSJS=function(t,e){t=(0,s.getMuxPlayerId)(t);f[t]?f[t].addHLSJS(e):l.default.error("A monitor for `"+t+"` has not been initialized.")},a.addDashJS=function(t,e){t=(0,s.getMuxPlayerId)(t);f[t]?f[t].addDashJS(e):l.default.error("A monitor for `"+t+"` has not been initialized.")},a.removeHLSJS=function(t){t=(0,s.getMuxPlayerId)(t);f[t]?f[t].removeHLSJS():l.default.error("A monitor for `"+t+"` has not been initialized.")},a.removeDashJS=function(t){t=(0,s.getMuxPlayerId)(t);f[t]?f[t].removeDashJS():l.default.error("A monitor for `"+t+"` has not been initialized.")},a.init=function(t,e){(0,u.default)()&&e&&e.respectDoNotTrack&&l.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");t=(0,s.getMuxPlayerId)(t);f[t]=new c.default(a,t,e)},a.emit=function(t,e,r){t=(0,s.getMuxPlayerId)(t);f[t]?(f[t].emit(e,r),"destroy"===e&&delete f[t]):l.default.error("A monitor for `"+t+"` has not been initialized.")},void 0!==o.default&&"function"==typeof o.default.addEventListener&&o.default.addEventListener("unload",function(){a.WINDOW_UNLOADING=!0},!1),a.checkDoNotTrack=u.default,a.log=l.default,a.utils=r.default,e.default=a},function(t,e,r){var i;!function(){"use strict";void 0!==(i="function"==typeof(i=function(){"use strict";function e(t,e){var r=t[e];if("function"==typeof r.bind)return r.bind(t);try{return Function.prototype.bind.call(r,t)}catch(e){return function(){return Function.prototype.apply.apply(r,[t,arguments])}}}function r(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function i(t){return"debug"===t&&(t="log"),typeof console!==c&&("trace"===t&&s?r:void 0!==console[t]?e(console,t):void 0!==console.log?e(console,"log"):o)}function u(t,e){for(var r=0;r<h.length;r++){var i=h[r];this[i]=r<t?o:this.methodFactory(i,t,e)}this.log=this.debug}function a(t,e,r){return function(){typeof console!==c&&(u.call(this,e,r),this[t].apply(this,arguments))}}function d(t,e,r){return i(t)||a.apply(this,arguments)}function n(r,t,e){function i(t){var e=(h[t]||"silent").toUpperCase();if(typeof window!==c&&s){try{return void(window.localStorage[s]=e)}catch(t){}try{window.document.cookie=encodeURIComponent(s)+"="+e+";"}catch(t){}}}function a(){var t;if(typeof window!==c&&s){try{t=window.localStorage[s]}catch(t){}if(typeof t===c)try{var e=window.document.cookie,r=e.indexOf(encodeURIComponent(s)+"=");-1!==r&&(t=/^([^;]+)/.exec(e.slice(r))[1])}catch(t){}return void 0===o.levels[t]&&(t=void 0),t}}var n,o=this,s="loglevel";"string"==typeof r?s+=":"+r:"symbol"==typeof r&&(s=void 0),o.name=r,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=e||d,o.getLevel=function(){return n},o.setLevel=function(t,e){if("string"==typeof t&&void 0!==o.levels[t.toUpperCase()]&&(t=o.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(n=t,!1!==e&&i(t),u.call(o,t,r),typeof console===c&&t<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(t){a()||o.setLevel(t,!1)},o.enableAll=function(t){o.setLevel(o.levels.TRACE,t)},o.disableAll=function(t){o.setLevel(o.levels.SILENT,t)};var l=a();null==l&&(l=null==t?"WARN":t),o.setLevel(l,!1)}var o=function(){},c="undefined",s=typeof window!==c&&typeof window.navigator!==c&&/Trident\/|MSIE /.test(window.navigator.userAgent),h=["trace","debug","info","warn","error"],l=new n,f={};l.getLogger=function(t){if("symbol"!=typeof t&&"string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=f[t];return e||(e=f[t]=new n(t,l.getLevel(),l.methodFactory)),e};var t=typeof window!==c?window.log:void 0;return l.noConflict=function(){return typeof window!==c&&window.log===l&&(window.log=t),l},l.getLoggers=function(){return f},l.default=l})?i.call(e,r,e,t):i)&&(t.exports=i)}()},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,a=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){a=!0,n=t}finally{try{!i&&s.return&&s.return()}finally{if(a)throw n}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=i(r(4)),l=i(r(1)),u=r(7),n=r(5),d=i(r(0)),c=i(r(11)),o=i(r(2)),h=i(r(20)),f=r(25),p=r(26),g=i(r(27)),y=i(r(28)),v=i(r(29)),m=i(r(30)),_=i(r(31)),b=i(r(32)),E=i(r(33)),T=i(r(34)),w=i(r(35)),R=i(r(36)),S=i(r(37)),A=i(r(38)),L=i(r(39)),D=i(r(40)),k=i(r(49)),O=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],r=function(t,e,r){var i=this;this.DOM_CONTENT_LOADED_EVENT_END=c.default.domContentLoadedEventEnd(),this.NAVIGATION_START=c.default.navigationStart();this.mux=t,this.id=e,(r=(0,l.default)({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,errorTranslator:function(t){return t}},r)).data=r.data||{},r.data.property_key&&(r.data.env_key=r.data.property_key,delete r.data.property_key),s.default.setLevel(r.debug?"debug":"warn"),this.getPlayheadTime=r.getPlayheadTime,this.getStateData=r.getStateData||function(){},this.getAdData=r.getAdData||function(){},this.minimumRebufferDuration=r.minimumRebufferDuration,this.sustainedRebufferThreshold=r.sustainedRebufferThreshold,this.playbackHeartbeatTime=r.playbackHeartbeatTime,this.disableRebufferTracking=r.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=r.errorTranslator,this.playbackEventDispatcher=new D.default(t,r.data.env_key,r),this.data={player_instance_id:(0,u.generateUUID)(),mux_sample_rate:r.sampleRate,beacon_domain:r.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(t,e){e=(0,l.default)({viewer_time:this.mux.utils.now()},e),this.oldEmit(t,e)};var a=function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",function(t,e){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,l.default)(this.data,e),this._initializeViewData(),this.one("play",a),this.one("adbreakstart",a)});var n=function(t){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",t)}.bind(this);this.on("videochange",function(t,e){n(e)}),this.on("programchange",function(t,e){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),n((0,l.default)(e,{view_program_changed:!0})),a()}),this.on("destroy",this.destroy);var o=this.destroy.bind(this);void 0!==d.default&&"function"==typeof d.default.addEventListener&&d.default.addEventListener("unload",o,!1),this.on("destroy",function(){void 0!==d.default&&"function"==typeof d.default.removeEventListener&&d.default.removeEventListener("unload",o)}),this.on("playerready",function(t,e){(0,l.default)(this.data,e)}),O.forEach(function(r){i.on(r,function(t,e){0!==r.indexOf("ad")&&this._updateStateData(),(0,l.default)(this.data,e),this._sanitizeData()}),i.on("after"+r,function(){"error"===r&&!this.viewErrored||this.send(r)})}),this.on("viewend",function(t,e){(0,l.default)(i.data,e)});this.one("playerready",function(t){var e=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=e-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),v.default.apply(this),L.default.apply(this),R.default.apply(this),b.default.apply(this),y.default.apply(this),w.default.apply(this),m.default.apply(this),_.default.apply(this),S.default.apply(this),E.default.apply(this),T.default.apply(this),A.default.apply(this),k.default.apply(this),r.hlsjs&&this.addHLSJS(r),r.dashjs&&this.addDashJS(r),this.emit("viewinit",r.data)};(0,l.default)(r.prototype,g.default.prototype),(0,l.default)(r.prototype,b.default.prototype),(0,l.default)(r.prototype,R.default.prototype),(0,l.default)(r.prototype,y.default.prototype),(0,l.default)(r.prototype,m.default.prototype),(0,l.default)(r.prototype,_.default.prototype),(0,l.default)(r.prototype,S.default.prototype),(0,l.default)(r.prototype,E.default.prototype),(0,l.default)(r.prototype,T.default.prototype),r.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),d.default.clearTimeout(this._heartBeatTimeout))},r.prototype.send=function(t){var e,r,i=(0,l.default)({},this.data);1===i.player_error_code&&(delete i.player_error_code,delete i.player_error_message),i.player_source_duration===1/0||i.video_source_duration===1/0?i.video_source_is_live=!0:(0<i.player_source_duration||0<i.video_source_duration)&&(i.video_source_is_live=!1),i.video_source_url=i.video_source_url||i.player_source_url,i.video_source_url&&(e=(0,n.extractHostnameAndDomain)(i.video_source_url),e=(r=a(e,2))[0],r=r[1],i.video_source_domain=r,i.video_source_hostname=e),delete i.ad_request_id,this.playbackEventDispatcher.send(t,i),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},r.prototype._updateStateData=function(){(0,l.default)(this.data,this.getStateData()),this.getPlayheadTime&&(this.data.player_playhead_time=this.getPlayheadTime()),this._sanitizeData()},r.prototype._sanitizeData=function(){var r=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(t){var e=parseInt(r.data[t],10);r.data[t]=isNaN(e)?void 0:e}),["player_source_url","video_source_url"].forEach(function(t){var e;r.data[t]&&(0!==(e=r.data[t].toLowerCase()).indexOf("data:")&&0!==e.indexOf("blob:")||(r.data[t]="MSE style URL"))})},r.prototype._resetVideoData=function(t,e){var r=this;Object.keys(this.data).forEach(function(t){0===t.indexOf("video_")&&delete r.data[t]})},r.prototype._resetViewData=function(){var e=this;Object.keys(this.data).forEach(function(t){0===t.indexOf("view_")&&delete e.data[t]}),this.data.view_sequence_number=1},r.prototype._resetErrorData=function(t,e){delete this.data.player_error_code,delete this.data.player_error_message},r.prototype._initializeViewData=function(){var t=this,e=this.data.view_id=(0,u.generateUUID)();this.data.video_id||(this.data.video_id=(0,h.default)(this.data.player_source_url));function r(){e===t.data.view_id&&(0,o.default)(t.data,"player_view_count",1)}this.data.player_is_paused?this.one("play",r):r()},r.prototype._restartHeartBeat=function(){var t=this;d.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=d.default.setTimeout(function(){t.data.player_is_paused||t.emit("hb")},1e4))},r.prototype.addHLSJS=function(t){return t.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=t.hlsjs,void(0,f.monitorHlsJs)(this.mux,this.id,t.hlsjs,{},t.Hls||d.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},r.prototype.removeHLSJS=function(){this.hlsjs&&((0,f.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},r.prototype.addDashJS=function(t){return t.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=t.dashjs,void(0,p.monitorDashJS)(this.mux,this.id,t.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},r.prototype.removeDashJS=function(){this.dashjs&&((0,p.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},e.default=r},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=a.default.createElement("a");return e.href=t,t=e.pathname.replace(/\.[^\/.]+$/,""),n.default.encode(e.host+t).split("=")[0]};var a=i(r(21)),n=i(r(23))},function(i,t,a){!function(t){var e,r=void 0!==t?t:"undefined"!=typeof window?window:{},t=a(22);"undefined"!=typeof document?e=document:(e=r["__GLOBAL_DOCUMENT_CACHE@4"])||(e=r["__GLOBAL_DOCUMENT_CACHE@4"]=t),i.exports=e}.call(t,a(6))},function(t,e){},function(t,a,n){!function(r,t){var i;!function(){function e(t){this.message=t}"object"==typeof r&&r&&r.exports;(e.prototype=new Error).name="InvalidCharacterError";function u(t){throw new e(t)}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=/[\t\n\f\r ]/g,t={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var e,r,i,a,n=t.length%3,o="",s=-1,l=t.length-n;++s<l;)e=t.charCodeAt(s)<<16,r=t.charCodeAt(++s)<<8,i=t.charCodeAt(++s),o+=d.charAt((a=e+r+i)>>18&63)+d.charAt(a>>12&63)+d.charAt(a>>6&63)+d.charAt(63&a);return 2==n?(e=t.charCodeAt(s)<<8,r=t.charCodeAt(++s),o+=d.charAt((a=e+r)>>10)+d.charAt(a>>4&63)+d.charAt(a<<2&63)+"="):1==n&&(a=t.charCodeAt(s),o+=d.charAt(a>>2)+d.charAt(a<<4&63)+"=="),o},decode:function(t){var e=(t=String(t).replace(s,"")).length;(e=e%4==0?(t=t.replace(/==?$/,"")).length:e)%4!=1&&!/[^+a-zA-Z0-9\/]/.test(t)||u("Invalid character: the string to be decoded is not correctly encoded.");for(var r,i,a=0,n="",o=-1;++o<e;)i=d.indexOf(t.charAt(o)),r=a%4?64*r+i:i,a++%4&&(n+=String.fromCharCode(255&r>>(-2*a&6)));return n},version:"0.1.0"};void 0!==(i=function(){return t}.call(a,n,a,r))&&(r.exports=i)}()}.call(a,n(24)(t),n(6))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.stopMonitoringHlsJs=e.monitorHlsJs=void 0;function f(t){if(!t)return{};var e=g.default.navigationStart(),r=(a=t.loading)?a.start:t.trequest,i=a?a.first:t.tfirst,a=a?a.end:t.tload;return{bytesLoaded:t.total,requestStart:Math.round(e+r),responseStart:Math.round(e+i),responseEnd:Math.round(e+a)}}function p(t){if(t&&"function"==typeof t.getAllResponseHeaders)return(0,a.default)(t.getAllResponseHeaders())}var a=i(r(8)),g=i(r(11)),y=r(5);e.monitorHlsJs=function(r,i,a){var u,t,e,n,o,s,l,d,c=arguments[4],h=r.log;g.default.exists()?(u=function(t,e){return r.emit(i,t,e)},a.on(c.Events.MANIFEST_LOADED,t=function(t,e){var r=e.levels,i=e.audioTracks,a=e.url,n=e.stats,o=e.networkDetails,s={},l={};r.forEach(function(t,e){s[e]={width:t.width,height:t.height,bitrate:t.bitrate,attrs:t.attrs}}),i.forEach(function(t,e){l[e]={name:t.name,language:t.lang,bitrate:t.bitrate}});e=f(n),r=e.bytesLoaded,i=e.requestStart,n=e.responseStart,e=e.responseEnd;u("requestcompleted",{request_event_type:t,request_bytes_loaded:r,request_start:i,request_response_start:n,request_response_end:e,request_type:"manifest",request_hostname:(0,y.extractHostname)(a),request_response_headers:p(o),request_rendition_lists:{media:s,audio:l,video:{}}})}),a.on(c.Events.LEVEL_LOADED,e=function(t,e){var r=e.details,i=e.level,a=e.networkDetails,n=e.stats,o=f(n),s=o.bytesLoaded,e=o.requestStart,n=o.responseStart,o=o.responseEnd;u("requestcompleted",{request_event_type:t,request_bytes_loaded:s,request_start:e,request_response_start:n,request_response_end:o,request_current_level:i,request_type:"manifest",request_hostname:(0,y.extractHostname)(r.url),request_response_headers:p(a)})}),a.on(c.Events.AUDIO_TRACK_LOADED,n=function(t,e){var r=e.details,i=e.networkDetails,a=e.stats,n=f(a),o=n.bytesLoaded,e=n.requestStart,a=n.responseStart,n=n.responseEnd;u("requestcompleted",{request_event_type:t,request_bytes_loaded:o,request_start:e,request_response_start:a,request_response_end:n,request_type:"manifest",request_hostname:(0,y.extractHostname)(r.url),request_response_headers:p(i)})}),a.on(c.Events.FRAG_LOADED,o=function(t,e){var r=e.stats,i=e.networkDetails,e=e.frag,r=f(r),i={request_event_type:t,request_bytes_loaded:r.bytesLoaded,request_start:r.requestStart,request_response_start:r.responseStart,request_response_end:r.responseEnd,request_hostname:i?(0,y.extractHostname)(i.responseURL):void 0,request_response_headers:p(i),request_media_duration:e.duration};"main"===e.type?(i.request_type="media",i.request_current_level=e.level,i.request_video_width=(a.levels[e.level]||{}).width,i.request_video_height=(a.levels[e.level]||{}).height):i.request_type=e.type,u("requestcompleted",i)}),a.on(c.Events.ERROR,s=function(t,e){var r=e.details,i=e.response,a=e.context,e=e.frag;r!==c.ErrorDetails.MANIFEST_LOAD_ERROR&&r!==c.ErrorDetails.MANIFEST_LOAD_TIMEOUT&&r!==c.ErrorDetails.FRAG_LOAD_ERROR&&r!==c.ErrorDetails.FRAG_LOAD_TIMEOUT&&r!==c.ErrorDetails.LEVEL_LOAD_ERROR&&r!==c.ErrorDetails.LEVEL_LOAD_TIMEOUT||(a=e&&e.url||a&&a.url||"",u("requestfailed",{request_error:r,request_url:a,request_hostname:(0,y.extractHostname)(a),request_type:r===c.ErrorDetails.FRAG_LOAD_ERROR||r===c.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:i&&i.code,request_error_text:i&&i.text}))}),a.on(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,l=function(t,e){e=e.frag,e=e&&e._url||"";u("requestcanceled",{request_cancel:t,request_url:e,request_type:"media",request_hostname:(0,y.extractHostname)(e)})}),d=function(t,e){var r=e.level,i=a.levels.find(function(t){return t.level===r});i&&i.attrs&&i.attrs.BANDWIDTH&&((e=i.attrs.BANDWIDTH)?u("renditionchange",{video_source_bitrate:e,video_source_width:i.width,video_source_height:i.height}):h.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js"))},a.on(c.Events.LEVEL_SWITCHED,d),a._stopMuxMonitor=function(){a.off(c.Events.MANIFEST_LOADED,t),a.off(c.Events.LEVEL_LOADED,e),a.off(c.Events.AUDIO_TRACK_LOADED,n),a.off(c.Events.FRAG_LOADED,o),a.off(c.Events.ERROR,s),a.off(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,l),a.off(c.Events.LEVEL_SWITCHED,d),a.off(c.Events.DESTROYING,a._stopMuxMonitor),delete a._stopMuxMonitor},a.on(c.Events.DESTROYING,a._stopMuxMonitor)):h.warn("performance timing not supported. Not tracking HLS.js.")},e.stopMonitoringHlsJs=function(t){t&&"function"==typeof t._stopMuxMonitor&&t._stopMuxMonitor()}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.stopMonitoringDashJS=e.monitorDashJS=void 0;function g(t,e){if(!t||"function"!=typeof t.getRequests)return{};if(0===(s=t.getRequests({state:"executed"})).length)return{};var r=s[s.length-1],i=(0,c.extractHostname)(r.url),a=r.bytesLoaded,n=new Date(r.requestStartDate).getTime(),o=new Date(r.firstByteDate).getTime(),t=new Date(r.requestEndDate).getTime(),s=isNaN(r.duration)?0:r.duration,e="function"==typeof e.getMetricsFor?e.getMetricsFor(r.mediaType).HttpList:e.getDashMetrics().getHttpRequests(r.mediaType),r=void 0;return{requestStart:n,requestResponseStart:o,requestResponseEnd:t,requestBytesLoaded:a,requestResponseHeaders:r=0<e.length?(0,l.default)(e[e.length-1]._responseHeaders||""):r,requestMediaDuration:s,requestHostname:i}}var d=i(r(0)),l=i(r(8)),c=r(5);e.monitorDashJS=function(r,i,f){var p,t,u,e,a,n,o,s,l=r.log;f&&f.on?(p=function(t,e){return r.emit(i,t,e)},f.on("manifestLoaded",t=function(t){var e=t.type,t=t.data;p("requestcompleted",{request_event_type:e,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,c.extractHostname)((t||{}).url)})}),u={},f.on("initFragmentLoaded",e=function(t){var e=t.type,r=t.fragmentModel,i=(t.chunk||{}).mediaInfo||{},a=i.type,n={};(i.bitrateList||[]).forEach(function(t,e){n[e]={},n[e].width=t.width,n[e].height=t.height,n[e].bitrate=t.bandwidth,n[e].attrs={}}),"video"===a?u.video=n:"audio"===a?u.audio=n:u.media=n;var o=g(r,f),s=o.requestStart,l=o.requestResponseStart,t=o.requestResponseEnd,i=o.requestResponseHeaders,r=o.requestMediaDuration,o=o.requestHostname;p("requestcompleted",{request_event_type:e,request_start:s,request_response_start:l,request_response_end:t,request_bytes_loaded:-1,request_type:a+"_init",request_response_headers:i,request_hostname:o,request_media_duration:r,request_rendition_lists:u})}),f.on("mediaFragmentLoaded",a=function(t){var e=t.type,r=t.fragmentModel,i=t.chunk||{},a=i.start,n=(i.mediaInfo||{}).type,o=g(r,f),s=o.requestStart,l=o.requestResponseStart,u=o.requestResponseEnd,d=o.requestBytesLoaded,c=o.requestResponseHeaders,h=o.requestMediaDuration,t=o.requestHostname,o=(i=n,o=(r=f).getQualityFor(i),(i=r.getCurrentTrackFor(i).bitrateList)?{currentLevel:o,renditionWidth:i[o].width||null,renditionHeight:i[o].height||null,renditionBitrate:i[o].bandwidth}:{});p("requestcompleted",{request_event_type:e,request_start:s,request_response_start:l,request_response_end:u,request_bytes_loaded:d,request_type:n,request_response_headers:c,request_hostname:t,request_media_start_time:a,request_media_duration:h,request_current_level:o.currentLevel,request_labeled_bitrate:o.renditionBitrate,request_video_width:o.renditionWidth,request_video_height:o.renditionHeight})}),n={video:void 0,audio:void 0,totalBitrate:void 0},o=function(e,t,r){var i,a;"number"==typeof e.newQuality?"audio"!==(i=e.mediaType)&&"video"!==i||((a=f.getBitrateInfoListFor(i).find(function(t){return t.qualityIndex===e.newQuality}))&&"number"==typeof a.bitrate?(n[i]=a,(a=function(){if(n.video&&"number"==typeof n.video.bitrate){if(n.video.width&&n.video.height){var t=n.video.bitrate;return n.audio&&"number"==typeof n.audio.bitrate&&(t+=n.audio.bitrate),t!==n.totalBitrate?{video_source_bitrate:n.totalBitrate=t,video_source_height:n.video.height,video_source_width:n.video.width}:void 0}l.warn("have bitrate info for video but missing width/height")}}())&&p("renditionchange",a)):l.warn("missing bitrate info for "+i)):l.warn("missing evt.newQuality in qualityChangeRendered event",e)},f.on("qualityChangeRendered",o),f.on("error",s=function(t){var e=t.error,r=t.event,i=(r=r||{}).request||{},t=d.default.event&&d.default.event.currentTarget||{};p("requestfailed",{request_error:e+"_"+r.id+"_"+i.type,request_url:r.url,request_hostname:(0,c.extractHostname)(r.url),request_type:i.mediaType,request_error_code:t.status,request_error_type:t.statusText})}),f._stopMuxMonitor=function(){f.off("manifestLoaded",t),f.off("initFragmentLoaded",e),f.off("mediaFragmentLoaded",a),f.off("qualityChangeRendered",o),f.off("error",s),delete f._stopMuxMonitor}):l.warn("Invalid dash.js player reference. Monitoring blocked.")},e.stopMonitoringDashJS=function(t){t&&"function"==typeof t._stopMuxMonitor&&t._stopMuxMonitor()}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function i(){}var n=0;i.prototype.on=function(t,e,r){return e._eventEmitterGuid=e._eventEmitterGuid||++n,this._listeners=this._listeners||{},this._listeners[t]=this._listeners[t]||[],r&&(e=e.bind(r)),this._listeners[t].push(e),e},i.prototype.off=function(t,r){var i=this._listeners&&this._listeners[t];i&&i.forEach(function(t,e){t._eventEmitterGuid===r._eventEmitterGuid&&i.splice(e,1)})},i.prototype.one=function(t,e,r){var i=this;e._eventEmitterGuid=e._eventEmitterGuid||++n;function a(){i.off(t,a),e.apply(r||this,arguments)}a._eventEmitterGuid=e._eventEmitterGuid,this.on(t,a)},i.prototype.emit=function(r,t){var e,i,a,n,o=this;this._listeners&&(e=this._listeners["before*"]||[],i=this._listeners[r]||[],a=this._listeners["after"+r]||[],(n=function(t,e){(t=t.slice()).forEach(function(t){t.call(o,{type:r},e)})})(e,t=t||{}),n(i,t),n(a,t))},e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=r(0),i=r&&r.__esModule?r:{default:r},r=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",function(){this._playheadShouldBeProgressing=!0}),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()}),this.on("timeupdate",function(){null!==this._playbackHeartbeatInterval&&this.emit("playbackheartbeat")}),this.on("devicesleep",function(t,e){null!==this._playbackHeartbeatInterval&&(i.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:e.viewer_time}),this._playbackHeartbeatInterval=null)})};r.prototype._startPlaybackHeartbeatInterval=function(){var t=this;null===this._playbackHeartbeatInterval&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=i.default.setInterval(function(){t.emit("playbackheartbeat")},this.playbackHeartbeatTime))},r.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(i.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},e.default=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var e=this;this.on("viewinit",function(){e.viewErrored=!1}),this.on("error",function(){try{var t=e.errorTranslator({player_error_code:e.data.player_error_code,player_error_message:e.data.player_error_message});t?(e.data.player_error_code=t.player_error_code,e.data.player_error_message=t.player_error_message,e.viewErrored=!0):(delete e.data.player_error_code,delete e.data.player_error_message)}catch(t){e.mux.log.warn("Exception in error translator callback.",t),e.viewErrored=!0}})}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=r(2),i=r&&r.__esModule?r:{default:r},r=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};r.prototype._updateWatchTime=function(t,e){e=e.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=e),(0,i.default)(this.data,"view_watch_time",e-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=e},r.prototype._clearWatchTimeState=function(t,e){this._updateWatchTime(t,e),this._watchTimeTrackerLastCheckedTime=null},e.default=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=r(2),i=r&&r.__esModule?r:{default:r},r=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};r.prototype._updatePlaybackTime=function(){var t,e=this.data.player_playhead_time;0<=this._playbackTimeTrackerLastPlayheadPosition&&e>this._playbackTimeTrackerLastPlayheadPosition&&((t=e-this._playbackTimeTrackerLastPlayheadPosition)<=1e3&&(0,i.default)(this.data,"view_content_playback_time",t)),this._playbackTimeTrackerLastPlayheadPosition=e},r.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},e.default=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function i(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",function(){this.off("timeupdate",this._updatePlayheadTime)})}i.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=void 0===this.data.view_max_playhead_position?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},i.prototype._updatePlayheadTime=function(t,e){e.player_playhead_time?(this.data.player_playhead_time=e.player_playhead_time,this._updateMaxPlayheadPosition()):!this.getPlayheadTime||void 0!==(e=this.getPlayheadTime())&&(this.data.player_playhead_time=e,this._updateMaxPlayheadPosition())},e.default=i},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(r(3)),n=i(r(2)),r=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",function(){this._cleanupRebufferTracker(null,{viewer_time:a.default.now()})})};r.prototype._checkIfRebuffering=function(t,e){if(!this.disableRebufferTracking)if(this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing)this._cleanupRebufferTracker(t,e);else{if(null===this._lastCheckedTime)return this._prepareRebufferTrackerState(e.viewer_time),void this._updateRebufferMetrics();var r;this._lastPlayheadTime===this.data.player_playhead_time?((r=e.viewer_time-this._lastPlayheadTimeUpdatedTime)>=this.sustainedRebufferThreshold&&(this._rebuffering?this._updateRebufferMetrics(e.viewer_time-this._lastCheckedTime):(this._rebuffering=!0,(0,n.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(r),this.emit("rebufferstart"))),this._lastCheckedTime=e.viewer_time):this._cleanupRebufferTracker(t,e,!0)}},r.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},r.prototype._prepareRebufferTrackerState=function(t){this._lastCheckedTime=t,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=t},r.prototype._cleanupRebufferTracker=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!this.disableRebufferTracking){if(this._rebuffering)this._rebuffering=!1,this._updateRebufferMetrics(e.viewer_time-this._lastCheckedTime),this.emit("rebufferend",{viewer_time:e.viewer_time});else{if(null===this._lastCheckedTime)return void this._updateRebufferMetrics();var i=this.data.player_playhead_time-this._lastPlayheadTime,a=e.viewer_time-this._lastPlayheadTimeUpdatedTime;0<i&&a-i>this.minimumRebufferDuration?((0,n.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(a-i),this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+a-i})):this._updateRebufferMetrics()}r?this._prepareRebufferTrackerState(e.viewer_time):this._clearRebufferTrackerState()}},r.prototype._updateRebufferMetrics=function(t){0<t&&(0,n.default)(this.data,"view_rebuffer_duration",t),0<=this.data.view_watch_time&&0<this.data.view_rebuffer_count&&(this.data.view_rebuffer_frequency=this.data.view_rebuffer_count/this.data.view_watch_time,this.data.view_rebuffer_percentage=this.data.view_rebuffer_duration/this.data.view_watch_time)},e.default=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=r(3),i=r&&r.__esModule?r:{default:r},r=function(){this.on("viewinit",function(){var t,e=this.data,r=e.view_id;e.view_program_changed||(t=function(t,e){e=e.viewer_time;("playing"===t.type&&void 0===this.data.view_time_to_first_frame||"adplaying"===t.type&&(void 0===this.data.view_time_to_first_frame||this.inPrerollPosition()))&&this.calculateTimeToFirstFrame(e||i.default.now(),r)},this.one("playing",t),this.one("adplaying",t),this.one("viewend",function(){this.off("playing",t),this.off("adplaying",t)}))})};r.prototype.calculateTimeToFirstFrame=function(t,e){e===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:t}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},e.default=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var e=this;this.on("viewinit",function(){this._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(t){e.on(t,function(){if(0<=this._lastPlayheadPosition&&0<=this.data.player_playhead_time&&0<=this._lastPlayerWidth&&0<this._lastSourceWidth&&0<=this._lastPlayerHeight&&0<this._lastSourceHeight){var t=this.data.player_playhead_time-this._lastPlayheadPosition;if(t<0)return void(this._lastPlayheadPosition=-1);var e=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),r=Math.max(0,e-1),e=Math.max(0,1-e);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,r),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,e),(0,i.default)(this.data,"view_total_content_playback_time",t),(0,i.default)(this.data,"view_total_upscaling",r*t),(0,i.default)(this.data,"view_total_downscaling",e*t)}this._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(t){e.on(t,function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height})})};var r=r(2),i=r&&r.__esModule?r:{default:r}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.isSeeking=!1,this.on("seeking",function(t,e){(0,o.default)(this.data,e),this._lastSeekingTime=a.default.now(),!1===this.isSeeking&&(this.isSeeking=!0,this.send("seeking"))}),this.on("seeked",function(){this.isSeeking=!1;var t=this._lastSeekingTime||a.default.now(),e=a.default.now()-t;(0,n.default)(this.data,"view_seek_count",1),(0,n.default)(this.data,"view_seek_duration",e);t=this.data.view_max_seek_time||0;this.data.view_max_seek_time=Math.max(t,e)}),this.on("viewend",function(){this.isSeeking=!1})};var a=i(r(3)),n=i(r(2)),o=i(r(1))},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});function a(t,e){t.push(e),t.sort(function(t,e){return t.viewer_time-e.viewer_time})}var n=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,a=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){a=!0,n=t}finally{try{!i&&s.return&&s.return()}finally{if(a)throw n}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=i(r(2)),s=r(5),l=i(r(1)),u=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],r=function(){var e=this;this.on("viewinit",function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0}),u.forEach(function(t){return e.on(t,e._updateAdData)});function t(){e.isAdBreak=!1}this.on("adbreakstart",function(){this.isAdBreak=!0}),this.on("play",t),this.on("playing",t),this.on("viewend",t),this.on("adrequest",function(t,e){e=(0,l.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},e),a(this._adRequests,e),(0,o.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,o.default)(this.data,"view_preroll_request_count"))}),this.on("adresponse",function(t,e){e=(0,l.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},e),a(this._adResponses,e);var r=this.findAdRequest(e.ad_request_id);r&&(0,o.default)(this.data,"view_ad_request_time",Math.max(0,e.viewer_time-r.viewer_time))}),this.on("adplay",function(t,e){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,o.default)(this.data,"view_ad_played_count"),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,0<this._adRequests.length&&(this.data.view_preroll_request_time=Math.max(0,e.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,e.viewer_time-this.data.view_start)),this._prerollPlayTime=e.viewer_time)}),this.on("adplaying",function(t,e){this.inPrerollPosition()&&void 0===this.data.view_preroll_load_time&&void 0!==this._prerollPlayTime&&(this.data.view_preroll_load_time=e.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=e.viewer_time-this._prerollPlayTime)}),this.on("adended",function(){this._wouldBeNewAdPlay=!0}),this.on("aderror",function(){this._wouldBeNewAdPlay=!0})};r.prototype.inPrerollPosition=function(){return void 0===this.data.view_content_playback_time||this.data.view_content_playback_time<=1e3},r.prototype.findAdRequest=function(t){for(var e=0;e<this._adRequests.length;e++)if(this._adRequests[e].ad_request_id===t)return this._adRequests[e]},r.prototype._updateAdData=function(t,e){var r,i;this.inPrerollPosition()&&(!this.data.view_preroll_ad_tag_hostname&&e.ad_tag_url&&(i=(0,s.extractHostnameAndDomain)(e.ad_tag_url),i=(r=n(i,2))[0],r=r[1],this.data.view_preroll_ad_tag_domain=r,this.data.view_preroll_ad_tag_hostname=i),!this.data.view_preroll_ad_asset_hostname&&e.ad_asset_url&&(i=(0,s.extractHostnameAndDomain)(e.ad_asset_url),i=(e=n(i,2))[0],e=e[1],this.data.view_preroll_ad_asset_domain=e,this.data.view_preroll_ad_asset_hostname=i))},e.default=r},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(){r.disableRebufferTracking||i&&((0,s.default)(r.data,"view_waiting_rebuffer_duration",o.default.now()-i),i=!1,window.clearInterval(a))}function e(){n=!1,t()}var r=this,i=void 0,a=void 0,n=!1;this.on("waiting",function(){n&&(r.disableRebufferTracking||((0,s.default)(r.data,"view_waiting_rebuffer_count",1),i=o.default.now(),a=window.setInterval(function(){var t;i&&(t=o.default.now(),(0,s.default)(r.data,"view_waiting_rebuffer_duration",t-i),i=t)},250)))}),this.on("playing",function(){t(),n=!0}),this.on("pause",e),this.on("seeking",e)};var o=i(r(3)),s=i(r(2))},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=this;this.one("playbackheartbeat",o),this.on("playbackheartbeatend",function(){t.off("before*",s),t.one("playbackheartbeat",o)})};var a=i(r(1)),n=i(r(3)),o=function(){this.lastWallClockTime=n.default.now(),this.on("before*",s)},s=function(t){var e=n.default.now(),r=this.lastWallClockTime;3e4<(this.lastWallClockTime=e)-r&&(this.emit("devicesleep",{viewer_time:r}),(0,a.default)(this.data,{viewer_time:r}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:e}),(0,a.default)(this.data,{viewer_time:e}),this.send("devicewake"))}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=i(r(0)),n=r(41),o=i(r(4)),s=i(r(45)),l=i(r(10)),u=i(r(46)),d=i(r(15)),h=i(r(47)),f=i(r(1)),p=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],g=["viewstart","error","ended","viewend"],r=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.mux=t,this.envKey=e,this.eventQueue=new h.default((0,s.default)(e,r.beaconDomain)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=r.sampleRate,this.disableCookies=r.disableCookies,this.respectDoNotTrack=r.respectDoNotTrack;r=r.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:r.name,viewer_application_version:r.version,viewer_application_engine:r.layout,viewer_device_name:r.product,viewer_device_category:"",viewer_device_manufacturer:r.manufacturer,viewer_os_family:r.os&&r.os.family,viewer_os_architecture:r.os&&r.os.architecture,viewer_os_version:r.os&&r.os.version};r=(0,u.default)();r&&(this.pageLevelData=(0,f.default)(this.pageLevelData,{viewer_connection_type:r})),void 0!==a.default&&a.default.location&&a.default.location.href&&(this.pageLevelData.page_url=a.default.location.href),this.viewerData=this.disableCookies?{}:(0,n.getAndUpdateViewerData)()};r.prototype.send=function(t,e){if(t){if(this.respectDoNotTrack&&(0,l.default)())return o.default.info("Not sending `"+t+"` because Do Not Track is enabled");if(!e||"object"!==(void 0===e?"undefined":c(e)))return o.default.error("A data object was expected in send() but was not provided");var r=this.disableCookies?{}:(0,n.getAndUpdateSessionData)(),i={};(0,f.default)(i,this.pageLevelData),(0,f.default)(i,e),(0,f.default)(i,r),(0,f.default)(i,this.viewerData),i.event=t,i.env_key=this.envKey,i.user_id&&(i.viewer_user_id=i.user_id,delete i.user_id);e=i.mux_sample_number>=this.sampleRate,r=this._deduplicateBeaconData(t,i),r=(0,d.default)(r);if(this.lastEventTime=this.mux.utils.now(),e)return o.default.info("Not sending event due to sample rate restriction",t,i,r);if(!this.envKey)return o.default.info("Not sending event due to missing environment key",t,i,r);if(!this.rateLimited)if(o.default.info("Sending event",t,i,r),this.rateLimited=!this.eventQueue.queueEvent(t,r),this.mux.WINDOW_UNLOADING&&"viewend"===t)this.eventQueue.destroy(!0);else if(0<=g.indexOf(t)&&this.eventQueue.flushEvents(),this.rateLimited)return i.event="eventrateexceeded",r=(0,d.default)(i),this.eventQueue.queueEvent(i.event,r),o.default.error("Beaconing disabled due to rate limit.")}},r.prototype.destroy=function(){this.eventQueue.destroy(!1)};r.prototype._deduplicateBeaconData=function(o,s){var l,u=this,d={},t=s.view_id;return!t||"viewstart"===o||"viewend"===o||!this.previousBeaconData||6e5<=this.mux.utils.now()-this.lastEventTime?(d=(0,f.default)({},s),t&&(this.previousBeaconData=d),t&&"viewend"===o&&(this.previousBeaconData=null)):(l=0===o.indexOf("request"),Object.keys(s).forEach(function(t){var e,r,i,a,n=s[t];!(n!==u.previousBeaconData[t]||-1<p.indexOf(t))&&(e=l,r=t,i=n,a=u.previousBeaconData[t],!e||0!==r.indexOf("request_")||"request_response_headers"!==r&&"object"===(void 0===i?"undefined":c(i))&&"object"===(void 0===a?"undefined":c(a))&&Object.keys(i||{}).length===Object.keys(a||{}).length)&&(a=t,"renditionchange"!==o||0!==a.indexOf("video_source_"))||(d[t]=n,u.previousBeaconData[t]=n)})),d},e.default=r},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.getAndUpdateSessionData=e.getAndUpdateViewerData=void 0;function a(){var e=void 0;try{e=o.default.parse(s.default.get("muxData")||"")}catch(t){e={}}return e}function n(t){try{s.default.set("muxData",o.default.stringify(t),{expires:7300})}catch(t){}}var o=i(r(12)),s=i(r(44)),l=r(7),u=i(r(3));e.getAndUpdateViewerData=function(){var t=a();return t.mux_viewer_id=t.mux_viewer_id||(0,l.generateUUID)(),t.msn=t.msn||Math.random(),n(t),{mux_viewer_id:t.mux_viewer_id,mux_sample_number:t.msn}},e.getAndUpdateSessionData=function(){var t=a(),e=u.default.now();return t.session_start&&(t.sst=t.session_start,delete t.session_start),t.session_id&&(t.sid=t.session_id,delete t.session_id),t.session_expires&&(t.sex=t.session_expires,delete t.session_expires),(!t.sex||t.sex<e)&&(t.sid=(0,l.generateUUID)(),t.sst=e),t.sex=e+15e5,n(t),{session_id:t.sid,session_start:t.sst,session_expires:t.sex}}},function(t,e,r){"use strict";function _(t,e,r,i,a,n,o,s,l,u,d,c){var h=t;if("function"==typeof o)h=o(e,h);else if(h instanceof Date)h=u(h);else if(null===h){if(i)return n&&!c?n(e,w.encoder):e;h=""}if("string"==typeof h||"number"==typeof h||"boolean"==typeof h||b.isBuffer(h))return n?[d(c?e:n(e,w.encoder))+"="+d(n(h,w.encoder))]:[d(e)+"="+d(String(h))];var f,p=[];if(void 0===h)return p;f=Array.isArray(o)?o:(t=Object.keys(h),s?t.sort(s):t);for(var g=0;g<f.length;++g){var y=f[g];a&&null===h[y]||(p=Array.isArray(h)?p.concat(_(h[y],r(e,y),r,i,a,n,o,s,l,u,d,c)):p.concat(_(h[y],e+(l?"."+y:"["+y+"]"),r,i,a,n,o,s,l,u,d,c)))}return p}var b=r(13),E=r(14),T={brackets:function(t){return t+"[]"},indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},i=Date.prototype.toISOString,w={delimiter:"&",encode:!0,encoder:b.encode,encodeValuesOnly:!1,serializeDate:function(t){return i.call(t)},skipNulls:!1,strictNullHandling:!1};t.exports=function(t,e){var r=t,i=e?b.assign({},e):{};if(null!==i.encoder&&void 0!==i.encoder&&"function"!=typeof i.encoder)throw new TypeError("Encoder has to be a function.");var t=(void 0===i.delimiter?w:i).delimiter,a=("boolean"==typeof i.strictNullHandling?i:w).strictNullHandling,n=("boolean"==typeof i.skipNulls?i:w).skipNulls,o=("boolean"==typeof i.encode?i:w).encode,s=("function"==typeof i.encoder?i:w).encoder,l="function"==typeof i.sort?i.sort:null,u=void 0!==i.allowDots&&i.allowDots,d=("function"==typeof i.serializeDate?i:w).serializeDate,c=("boolean"==typeof i.encodeValuesOnly?i:w).encodeValuesOnly;if(void 0===i.format)i.format=E.default;else if(!Object.prototype.hasOwnProperty.call(E.formatters,i.format))throw new TypeError("Unknown format option provided.");var h,f=E.formatters[i.format];"function"==typeof i.filter?r=(h=i.filter)("",r):Array.isArray(i.filter)&&(y=h=i.filter);var p=[];if("object"!=typeof r||null===r)return"";var e=i.arrayFormat in T?i.arrayFormat:!("indices"in i)||i.indices?"indices":"repeat",g=T[e],y=y||Object.keys(r);l&&y.sort(l);for(var v=0;v<y.length;++v){var m=y[v];n&&null===r[m]||(p=p.concat(_(r[m],m,g,a,n,o?s:null,h,l,u,d,f,c)))}t=p.join(t),i=!0===i.addQueryPrefix?"?":"";return 0<t.length?i+t:""}},function(t,e,r){"use strict";function l(t,e,r){if(t){var i=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,a=/(\[[^[\]]*])/g,n=/(\[[^[\]]*])/.exec(i),t=n?i.slice(0,n.index):i,o=[];if(t){if(!r.plainObjects&&d.call(Object.prototype,t)&&!r.allowPrototypes)return;o.push(t)}for(var s=0;null!==(n=a.exec(i))&&s<r.depth;){if(s+=1,!r.plainObjects&&d.call(Object.prototype,n[1].slice(1,-1))&&!r.allowPrototypes)return;o.push(n[1])}return n&&o.push("["+i.slice(n.index)+"]"),function(t,e,r){for(var i=e,a=t.length-1;0<=a;--a){var n,o,s,l=t[a];"[]"===l?n=(n=[]).concat(i):(n=r.plainObjects?Object.create(null):{},o="["===l.charAt(0)&&"]"===l.charAt(l.length-1)?l.slice(1,-1):l,s=parseInt(o,10),!isNaN(s)&&l!==o&&String(s)===o&&0<=s&&r.parseArrays&&s<=r.arrayLimit?(n=[])[s]=i:n[o]=i),i=n}return i}(o,e,r)}}var u=r(13),d=Object.prototype.hasOwnProperty,c={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:u.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1};t.exports=function(t,e){var r=e?u.assign({},e):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter=("string"==typeof r.delimiter||u.isRegExp(r.delimiter)?r:c).delimiter,r.depth=("number"==typeof r.depth?r:c).depth,r.arrayLimit=("number"==typeof r.arrayLimit?r:c).arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder=("function"==typeof r.decoder?r:c).decoder,r.allowDots=("boolean"==typeof r.allowDots?r:c).allowDots,r.plainObjects=("boolean"==typeof r.plainObjects?r:c).plainObjects,r.allowPrototypes=("boolean"==typeof r.allowPrototypes?r:c).allowPrototypes,r.parameterLimit=("number"==typeof r.parameterLimit?r:c).parameterLimit,r.strictNullHandling=("boolean"==typeof r.strictNullHandling?r:c).strictNullHandling,""===t||null==t)return r.plainObjects?Object.create(null):{};for(var i="string"==typeof t?function(t,e){for(var r={},i=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,t=e.parameterLimit===1/0?void 0:e.parameterLimit,a=i.split(e.delimiter,t),n=0;n<a.length;++n){var o,s=a[n],l=s.indexOf("]="),l=-1===l?s.indexOf("="):l+1,l=-1===l?(o=e.decoder(s,c.decoder),e.strictNullHandling?null:""):(o=e.decoder(s.slice(0,l),c.decoder),e.decoder(s.slice(l+1),c.decoder));d.call(r,o)?r[o]=[].concat(r[o]).concat(l):r[o]=l}return r}(t,r):t,a=r.plainObjects?Object.create(null):{},n=Object.keys(i),o=0;o<n.length;++o)var s=n[o],s=l(s,i[s],r),a=u.merge(a,s,r);return u.compact(a)}},function(t,e,r){"use strict";var i,a,n,o,s,l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};s=!(a=function(){var f=function(){for(var t=0,e={};t<arguments.length;t++){var r,i=arguments[t];for(r in i)e[r]=i[r]}return e};return function t(c){function h(t,e,r){var i,a;if("undefined"!=typeof document){if(1<arguments.length){"number"==typeof(r=f({path:"/"},h.defaults,r)).expires&&((a=new Date).setMilliseconds(a.getMilliseconds()+864e5*r.expires),r.expires=a);try{i=JSON.stringify(e),/^[\{\[]/.test(i)&&(e=i)}catch(t){}return e=c.write?c.write(e,t):encodeURIComponent(String(e)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[t,"=",e,r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("")}t||(i={});for(var n=document.cookie?document.cookie.split("; "):[],o=/(%[0-9A-Z]{2})+/g,s=0;s<n.length;s++){var l=n[s].split("=");'"'===(d=l.slice(1).join("=")).charAt(0)&&(d=d.slice(1,-1));try{var u=l[0].replace(o,decodeURIComponent),d=c.read?c.read(d,u):c(d,u)||d.replace(o,decodeURIComponent);if(this.json)try{d=JSON.parse(d)}catch(t){}if(t===u){i=d;break}t||(i[u]=d)}catch(t){}}return i}}return(h.set=h).get=function(t){return h.call(h,t)},h.getJSON=function(){return h.apply({json:!0},[].slice.call(arguments))},h.defaults={},h.remove=function(t,e){h(t,"",f(e,{expires:-1}))},h.withConverter=t,h}(function(){})}),void 0!==(i="function"==typeof(i=a)?i.call(e,r,e,t):i)&&(t.exports=i),s=!0,"object"===l(e)&&(t.exports=a(),s=!0),s||(n=window.Cookies,(o=window.Cookies=a()).noConflict=function(){return window.Cookies=n,o})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return e=e||"litix.io",(t=t||"").match(/^[a-z0-9]+$/)?"https://"+t+"."+e:"https://img.litix.io/a.gif"}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=r(0),i=r&&r.__esModule?r:{default:r},a=function(){var t=i.default.navigator,t=t&&(t.connection||t.mozConnection||t.webkitConnection);return t&&t.type};e.default=function(){var t=void 0;switch(a()){case"cellular":t="cellular";break;case"ethernet":t="wired";break;case"wifi":t="wifi";break;case void 0:break;default:t="other"}return t}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(r(0)),n=i(r(4)),o=i(r(48)),s=i(r(1)),l=i(r(15)),u=!!a.default.XMLHttpRequest&&"withCredentials"in new a.default.XMLHttpRequest,d={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:5e3},r=function(t,e){this._beaconUrl=t||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,s.default)({},d,e)};r.prototype.queueEvent=function(t,e){e=(0,s.default)({},e);return u?(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===t)&&(this._eventQueue.push(e),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(o.default.send(this._beaconUrl,e),!0)},r.prototype.flushEvents=function(){u&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},r.prototype.destroy=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,t?this._clearBeaconQueue():this.flushEvents(),a.default.clearTimeout(this._sendTimeout)},r.prototype._clearBeaconQueue=function(){var t=a.default.navigator,e=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,r=this._eventQueue.slice(e);0<e&&(0,s.default)(r[r.length-1],(0,l.default)({mux_view_message:"event queue truncated"})),t.sendBeacon?t.sendBeacon(this._beaconUrl,JSON.stringify({events:r})):a.default.XMLHttpRequest?((t=new a.default.XMLHttpRequest).open("POST",this._beaconUrl),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({events:r}))):o.default.send(this._beaconUrl,r[r.length-1])},r.prototype._sendBeaconQueue=function(){var t,e,r=this;a.default.XMLHttpRequest&&!this._postInFlight&&(t=new a.default.XMLHttpRequest,e=this._eventQueue.slice(0,this._options.maxBeaconSize),this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,t.onreadystatechange=function(){4===t.readyState&&(200!==t.status?(r._eventQueue=e.concat(r._eventQueue),r._failureCount+=1,n.default.info("Error sending beacon: "+t.status),n.default.info(t.responseText)):r._failureCount=0,r._postInFlight=!1)},t.open("POST",this._beaconUrl),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({events:e})))},r.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var t=Math.pow(2,this._failureCount-1);return(1+(t*=Math.random()))*this._options.baseTimeBetweenBeacons},r.prototype._startBeaconSending=function(){var t=this;a.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=a.default.setTimeout(function(){t._eventQueue.length&&t._sendBeaconQueue(),t._startBeaconSending()},this._getNextBeaconTime()))},e.default=r},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(r(12)),s=i(r(0)),r={send:function(t,e){function r(){i.src=n+(a?"&rc="+a:"")}var i=new Image,a=0,n=t+"?"+o.default.stringify(e);return i.addEventListener("error",function(){3<a||s.default.setTimeout(function(){a++,r()},5e3*a)}),r(),i}};e.default=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var s=0,l=0,u=0,d=0,c=0,r=0,i=0;this.on("requestcompleted",function(t,e){var r=e.request_start,i=e.request_response_start,a=e.request_response_end,n=e.request_bytes_loaded;d++;var o=void 0,e=void 0;0<(e=i?(o=i-r,a-i):a-r)&&0<n&&(c++,l+=n,u+=e,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,n/e*8e3),this.data.view_average_request_throughput=l/u*8e3,this.data.view_request_count=d,0<o&&(s+=o,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,o),this.data.view_average_request_latency=s/c))}),this.on("requestfailed",function(t,e){d++,r++,this.data.view_request_count=d,this.data.view_request_failed_count=r}),this.on("requestcanceled",function(t,e){d++,i++,this.data.view_request_count=d,this.data.view_request_canceled_count=i})}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,a=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){a=!0,n=t}finally{try{!i&&s.return&&s.return()}finally{if(a)throw n}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};e.default=function(i,t,r){var e=(0,c.findMediaElement)(t),a=(t=u(e,3))[0],n=t[1],e=t[2],t=i.log,o=i.utils.getComputedStyle,s=i.utils.secondsToMs;return a?"video"!==e&&"audio"!==e?t.error("The element of `"+n+"` was not a media element."):((r=(0,d.default)({automaticErrorTracking:!0},r)).data=(0,d.default)({player_software:"HTML5 Video Element",player_software_version:"No Versions",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.0.1"},r.data),r.getPlayheadTime=function(){return s(a.currentTime)},r.getStateData=function(){var t=this.hlsjs&&this.hlsjs.url,e=this.dashjs&&l("function"===this.dashjs.getSource)&&this.dashjs.getSource();return{player_is_paused:a.paused,player_playhead_time:s(a.currentTime),player_width:parseInt(o(a,"width")),player_height:parseInt(o(a,"height")),player_autoplay_on:a.autoplay,player_preload_on:a.preload,video_poster_url:a.poster,video_source_url:t||e||a.currentSrc,video_source_duration:s(a.duration),video_source_height:a.videoHeight,video_source_width:a.videoWidth}},a.mux=a.mux||{},a.mux.emit=function(t,e){i.emit(n,t,e)},a.mux.destroy=function(){Object.keys(a.mux.listeners).forEach(function(t){a.removeEventListener(t,a.mux.listeners[t],!1)}),delete a.mux.listeners,i.emit(n,"destroy")},a.mux.swapElement=function(t){var e=(0,c.findMediaElement)(t),t=u(e,3),r=t[0],e=t[1],t=t[2];return r?"video"!==t&&"audio"!==t?i.log.error("The element of `"+e+"` was not a media element."):(r.muxId=a.muxId,delete a.muxId,r.mux=r.mux||{},r.mux.listeners=(0,d.default)({},a.mux.listeners),delete a.mux.listeners,Object.keys(r.mux.listeners).forEach(function(t){a.removeEventListener(t,r.mux.listeners[t],!1),r.addEventListener(t,r.mux.listeners[t],!1)}),r.mux.swapElement=a.mux.swapElement,r.mux.destroy=a.mux.destroy,delete a.mux,void(a=r)):i.log.error("No element was found with the `"+e+"` query selector.")},a.mux.addHLSJS=function(t){i.addHLSJS(n,t)},a.mux.addDashJS=function(t){i.addDashJS(n,t)},a.mux.removeHLSJS=function(){i.removeHLSJS(n)},a.mux.removeDashJS=function(){i.removeDashJS(n)},i.init(n,r),i.emit(n,"playerready"),a.paused||(i.emit(n,"play"),2<a.readyState&&i.emit(n,"playing")),a.mux.listeners={},void h.forEach(function(e){"error"===e&&!r.automaticErrorTracking||(a.mux.listeners[e]=function(){var t={};"error"===e&&(t.player_error_code=a.error&&a.error.code,t.player_error_message=a.error&&f[a.error.code]),i.emit(n,e,t)},a.addEventListener(e,a.mux.listeners[e],!1))})):t.error("No element was found with the `"+n+"` query selector.")};var e=r(1),d=e&&e.__esModule?e:{default:e},c=r(9),h=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],f={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(r(52)),n=i(r(2)),o=i(r(53)),s=i(r(54)),l=i(r(1)),u=i(r(8)),d=r(5),c=i(r(3)),r={};r.safeCall=a.default,r.safeIncrement=n.default,r.getComputedStyle=o.default,r.secondsToMs=s.default,r.assign=l.default,r.headersStringToObject=u.default,r.extractHostnameAndDomain=d.extractHostnameAndDomain,r.extractHostname=d.extractHostname,r.now=c.default.now,e.default=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r,i){if(t&&"function"==typeof t[e])try{i=t[e].apply(t,r)}catch(t){a.default.info("safeCall error",t)}return i};var r=r(4),a=r&&r.__esModule?r:{default:r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(t&&e&&i.default&&"function"==typeof i.default.getComputedStyle){var r=void 0;return(r=a&&a.has(t)?a.get(t):r)||(r=i.default.getComputedStyle(t,null),a&&a.set(t,r)),r.getPropertyValue(e)}};var r=r(0),i=r&&r.__esModule?r:{default:r},a=void 0;i.default&&i.default.WeakMap&&(a=new WeakMap)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return Math.floor(1e3*t)}}])}}]);