(self.webpackChunkweb_shell=self.webpackChunkweb_shell||[]).push([[890],{890:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>O});var o=n(697),r=n(3003),i=n(3262),a=n(7580),s=n(2959);function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}let g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=h(o);if(r){var n=h(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return c(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e=i.call(this,t),"undefined"!=typeof window&&(e._history=window.history),e._ignorePopState=t&&t._ignorePopState||!1,e._eventMixin=new s.Z,Object.getOwnPropertyNames(s.Z.prototype).forEach((t=>{e[t]||(e[t]=e._eventMixin[t])})),e}return e=a,(n=[{key:"pushState",value:function(t,e,n){this._history.pushState(this._getHistoryState(t,e,n),e,n),this._emitHistoryStateChange("pushstate")}},{key:"replaceState",value:function(t,e,n){this._history.replaceState(this._getHistoryState(t,e,n),e,n),this._emitHistoryStateChange("replacestate")}},{key:"onBeforeStart",value:function(){this._initEvents()}},{key:"onBeforeStop",value:function(){this._stopEvents()}},{key:"_emitHistoryStateChange",value:function(t){const e={state:this._history.state,src:t};this.emit("history-state-changed",e)}},{key:"_getHistoryState",value:function(t,e,n){return{data:t,title:e,url:n}}},{key:"_initEvents",value:function(){this._historyPopStateHandler=this._onHistoryPopstate.bind(this),"undefined"!=typeof window&&window.addEventListener("popstate",this._historyPopStateHandler)}},{key:"_stopEvents",value:function(){"undefined"!=typeof window&&window.removeEventListener("popstate",this._historyPopStateHandler)}},{key:"_onHistoryPopstate",value:function(){this._emitHistoryStateChange("popstate")}}])&&u(e.prototype,n),a}(a.Z);var d=n(8912),p=n(9262),f=n(631);function _(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}let v=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._registry={}}var e,n;return e=t,(n=[{key:"put",value:function(t,e,n){let o=this._registry[t];o||(o={},this._registry[t]=o),o[e]=n}},{key:"get",value:function(t,e){const n=this._registry[t];if(!n)return null;const o=Object.keys(n);return n[f.Z.getSuitableVersion(o,e)]||null}}])&&_(e.prototype,n),t}();function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){w(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function C(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function R(t,e){return(R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const E=/^(?:[^/#?:]+:\/\/|\/\/)[^/]*/,P="routes";let O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(u,t);var e,n,r,a,s=(r=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=k(r);if(a){var n=k(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return m(this,t)});function u(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),e=s.call(this,t);const{config:n}=t,o={};return e.stopControllerOnUnload=!0,e.navigationRoot=null,e.supportHashInUrl=!1,e._navigationErrorEventHandler=null,e._startupPromise=null,o.root=n&&n.navigationRoot,e.navigationRoot=n&&n.navigationArea||"undefined"!=typeof document&&document.body||void 0,e.supportHashInUrl=n&&n.supportHashInUrl,e._initRouter(o),e._responseCache={},e._historyManager=new g,e._origin="undefined"!=typeof window&&E.exec(window.location.href)[0],e._baseURI=e._getBaseURI(),e._currentOrigin=e._isDifferentOrigin(e._baseURI)?e._origin:"",e._logger=d.Z.getLogger(),e._extensionRoutes={},e._controllerCache={},e._widgetEntryMap=new v,e._navigateOnStart=!n||"boolean"!=typeof n.navigateOnStart||n.navigateOnStart,e}return e=u,(n=[{key:"setNavigationErrorEventHandler",value:function(t){this._navigationErrorEventHandler=t}},{key:"navigate",value:function(t,e){return Promise.resolve().then((()=>{if(!this.isStarted())throw new Error("navigate called with the NavigationManager not started.");return"undefined"!=typeof window&&e&&e.hardPageRefresh&&(window.location.href=t),(0,o.Z)(this._router.navigate(t,e)).then((e=>e&&e.status&&(e.status.didCancel||e.status.didAbort)?{status:e.status}:(0,o.Z)(this._processNavigationResponse(e)).then((n=>(this._responseCache[this._router._removeRootFromPath(t)]=n,e&&e.status?{status:e.status}:{status:{didComplete:!0}})))),(n=>{let o,r=null;if("function"==typeof this._navigationErrorEventHandler){const i=this;o={err:n,path:t,preventDefault(){this.defaultPrevented=!0},defaultPrevented:!1,navigate(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i._logger.log("Navigation triggered by App Plugin (path: ".concat(t,")")),i.navigate(t,b(b({},e),n))}},r=Promise.resolve(this._navigationErrorEventHandler(o)).catch((t=>({err:t})))}const i=o=>{if(this._logger.error("Navigation.navigate returning error",n,{path:t}),"route not found"===o.message&&this.config.pageNotFoundRoute&&(!e||!e.pageNotFoundRoute))return this._logger.warn(" Rendering 404 page",o,{path:t}),this.navigate(this.config.pageNotFoundRoute,b(b({},e||{}),{},{pageNotFoundRoute:!0}));throw o};return Promise.resolve(r).then((t=>o&&o.defaultPrevented?t&&t.err?(this._logger.error("Error handling navigation error from app controller, performing default error handling",{},t.err),i(n)):t:i(n)))}))}))}},{key:"navigateToWidget",value:function(t,e){return Promise.resolve().then((()=>{const n=e&&e.version;if(!t)throw new Error("NavigationManager.navigateToWidget: Widget id parameter is required");if(!n)throw new Error("NavigationManager.navigateToWidget: Widget version is required in the options parameter");const o=this._widgetEntryMap.get(t,e.version);if(o)return this.navigate(o).catch((t=>{throw t.message="Failed to navigate to ".concat(o,": ").concat(t.message),t}));const r="".concat(t,"@").concat(e.version),i="NavigationManager: Could not fulfill navigation request. No suitable path mapping exists for widget '".concat(r,"'");throw new Error(i)}))}},{key:"onBeforeStart",value:function(){const t=this._applicationCtx.channel;return t.get("extension-registered").subscribe(this._onExtensionRegistered.bind(this)),t.get("extension-unregistered").subscribe(this._onExtensionUnregistered.bind(this)),t.get("app-core-plugins-started").subscribe(this._onCorePluginsStarted.bind(this)),Promise.all([this._historyManager.start(),this._router.start()]).then((()=>this._initEvents()))}},{key:"onBeforeStop",value:function(){this._historyManager.stop(),this._router.stop(),this._stopEvents()}},{key:"onBeforeSuspend",value:function(){this._super(arguments),this._historyManager.suspend(),this._router.suspend()}},{key:"onBeforeResume",value:function(){this._super(arguments),this._historyManager.resume(),this._router.resume()}},{key:"onApplicationReady",value:function(){if("undefined"==typeof window)return;const t=this._getPathInWindow(window);t&&!0===this._navigateOnStart&&this.navigate(t).catch((e=>{this._logger.logException("onApplicationReady: Failed to navigate to path",e,{path:t})}))}},{key:"_getPathInWindow",value:function(t){let e=t.location.pathname+(t.location.search||"");return this.supportHashInUrl&&(e+=t.location.hash||""),e}},{key:"_initEvents",value:function(){const{navigationRoot:t}=this;this._clickHandler=this._globalClickHandler.bind(this),null==t||t.addEventListener("click",this._clickHandler),this._historyManager.on("history-state-changed",this._onHistoryStateChanged.bind(this))}},{key:"_onHistoryStateChanged",value:function(t){const e=t.state&&t.state.url,{src:n}=t;"popstate"===n&&e&&this.navigate(e,{src:n}).catch((t=>{this._logger.logException("history-state-changed: Failed to navigate to path",t,{path:e,src:n})}))}},{key:"_globalClickHandler",value:function(t){const{target:e}=t;if(/input|button|textarea/i.test(e.targetName)||"number"==typeof t.button&&(0!==t.button||0===t.button&&(t.ctrlKey||t.metaKey)))return;const n=this._getEnclosingAnchor(e);n&&this._handleAnchorClickEvent(n,t)}},{key:"_handleAnchorClickEvent",value:function(t,e){let n=t&&t.pathname+t.search||"";const o=t?t.href:"",r=t?t.target:"",i="noshellroute"in t.dataset;if(!t||!n||this._isExternalUrl(o)||this._isBlobUrl(o)||this._isHashOnly(t)||"_blank"===r||i)return;this.supportHashInUrl&&t&&t.hash&&(n+=t.hash);const a={src:"click"};this.navigate(n,a).catch((t=>{this._logger.logException("handleAnchorClickEvent: Failed to navigate to path",t,b(b({},a),{},{path:n}))})),e.preventDefault(),e.stopPropagation()}},{key:"_isHashOnly",value:function(t){return!!t.hasAttribute("href")&&"#"===t.getAttribute("href")}},{key:"_isBlobUrl",value:function(t){return!!t&&0===t.indexOf("blob:")}},{key:"_isExternalUrl",value:function(t){const e=E.exec(t),n=e?e[0]:null;return!(!t||!(t.indexOf("javascript:")>-1||t.indexOf("data:")>-1||t.indexOf("mailto:")>-1||t.indexOf("tel:")>-1))||!!n&&(n!==this._origin||!t.replace(E,"").match(this._router._rootStripper))}},{key:"_getBaseURI",value:function(){if("undefined"==typeof window)return"";if(!window.document.baseURI){const t=document.getElementsByTagName("base");return t.length>0?t[0].href:window.location.origin}return window.document.baseURI}},{key:"_isDifferentOrigin",value:function(t){const e=E.exec(t),n=e?e[0]:null;return!!n&&n!==this._origin}},{key:"_getEnclosingAnchor",value:function(t){let e=t;const{navigationRoot:n}=this;for(;e&&e!==n;){if("A"===e.tagName.toUpperCase())return e;e=e.parentNode}return null}},{key:"_stopEvents",value:function(){const{navigationRoot:t}=this;null==t||t.removeEventListener("click",this._clickHandler)}},{key:"_initRouter",value:function(t){t=Object.assign(t,{routes:[]});const e=new i.Z(t);e.on(e.events.NAVIGATION_STARTED,this._onRouterNavigationStart.bind(this)),e.on(e.events.NAVIGATION_CANCELLED,this._onRouterNavigationCancelled.bind(this)),e.on(e.events.NAVIGATION_COMPLETED,this._onRouterNavigationCompleted.bind(this)),e.on(e.events.NAVIGATION_ABORTED,this._onRouterNavigationAborted.bind(this)),this._router=e}},{key:"_requestLoggerMiddleware",value:function(t,e,n){return console.log("Request logger middleware: ".concat(t.path)),n()}},{key:"_responseCacheMiddleware",value:function(t,e,n){const r=this._responseCache[t.path];r?((0,o.Z)(e.getPromise(),(e=>{this._responseCache[t.path]=e})),(e=Object.assign(r,e)).end()):n()}},{key:"_handleNavigation",value:function(t,e){const{extension:n}=t.route;return delete t.route,(0,o.Z)(this._getControllerForExtension(n)).then((o=>o?Promise.resolve().then((()=>this._delegateNavigationToController(o,t,e).then((()=>{this._currentExtension=n})))):Promise.resolve()))}},{key:"_getControllerForExtension",value:function(t){const e=t.config.controller;let n,r;r=t.config.widget?t.config.widget.class||t.config.widget.id:e,r="".concat(r,"_").concat(t.id);const i=this._getControllerFromCache(r);return i&&!i.isStopped()?i:(n=t.config.widget?this._getWidgetControllerForExtension.bind(this,t):t.getDefaultExecutableInstance.bind(t),(0,o.Z)(n()).then((t=>(this._addControllerToCache(r,t),t))))}},{key:"_getWidgetControllerForExtension",value:function(t){const e=t.config.widget.id,n=t.config.widget.class,o=t.contributorId,r=this._getDefaultWidgetRouteController();if(!r)return void this._logger.error("Cannot route to widgets. No defaultWidgetRouteController provided");if(!e&&!n)return void this._logger.error("Invalid route extension for widget. Should either provide widget id or widget class");let i;if(e){const n=b(b({},t.config.widget),{},{consumer:{pluginId:o}}),r=this._applicationCtx.getCorePlugin("widgetManager");i=r.then((t=>Promise.all([t.getWidgetDescriptorForConsumer(e,n),t.getWidgetForConsumer(e,n)]).then((t=>({descriptor:t[0],class:t[1]})))))}else n&&(i=t.getExecutable(n).then((t=>({class:t}))));return this._applicationCtx.getCorePlugin("appDelegateManager").then((e=>i.then((n=>{const i=this._applicationCtx.getPluginManager().getPlugin(o),a=e&&e.getActionCreators().widgetEvents||null,s=i.getSandbox();return new r({extension:t,widgetClass:n.class,widgetDescriptor:n.descriptor,sandbox:s,widgetEvents:a})}))))}},{key:"_getDefaultWidgetRouteController",value:function(){return this._applicationCtx.config.defaultWidgetRouteController||null}},{key:"_addControllerToCache",value:function(t,e){this._controllerCache[t]=e;const n=e.stop,o=this;e.stop=function(){o._removeControllerFromCache(t),n.apply(e)}}},{key:"_getControllerFromCache",value:function(t){return this._controllerCache[t]||null}},{key:"_removeControllerFromCache",value:function(t){delete this._controllerCache[t]}},{key:"_delegateNavigationToController",value:function(t,e,n){return this._router.isRouteAborted(n)?Promise.resolve():Promise.resolve().then((()=>t!==this._currentController?(this._unloadCurrentController(),this._prepareControllerForNavigation(t)):Promise.resolve())).then((()=>{try{n.render=function(t){this.type="view",this.value=t.view,this.header=this.header||{},this.header.displayOptions={layout:t.layout},this.send(this)}}catch(t){throw t.message="Error setting up delegated navigation to controller: ".concat(t.message),t}return(0,o.Z)(t.handleNavigationRequest(e,n)).catch((t=>{throw this._logger.logException("Error calling handleNavigationRequest via delegated controller",t,{routeInfo:e}),t}))}))}},{key:"_processNavigationResponse",value:function(t){return t&&"view"===t.type?this._renderView(t.value,t.header.displayOptions):Promise.resolve()}},{key:"_renderView",value:function(t,e){return this._getLayoutManager().then((n=>n.displayView(t,e)))}},{key:"_prepareControllerForNavigation",value:async function(t){t.isStarted()||t.isSuspended()?t.isSuspended()&&await t.resume():await t.start(),this._currentController=t}},{key:"_onBeforeNavigate",value:function(t,e){if(!this._firstNavigationCompleted)return this._historyManager.replaceState(null,"",this._currentOrigin+this._router._root+t),void(this._firstNavigationCompleted=!0);this._isSrcPopState(e)||t===this._router._lastRoutedPath||e&&e.pageNotFoundRoute||this._historyManager.pushState(null,"",this._currentOrigin+this._router._root+t)}},{key:"_onRouterNavigationStart",value:function(t){const{ack:e}=t,n={navRequest:{path:t.path,options:t.options}};p.default.get("app-route-change-requested").publishSync({activeRoute:this._router._lastRoutedPath,routeChangeRequest:n.navRequest}),this._getLayoutManager().then((t=>{(0,o.Z)(this._canChangeRoute(n),(o=>{!0===o?(t._resetLayoutsOnRouteChange(n),p.default.get("app-route-change-started").publishSync({activeRoute:this._router._lastRoutedPath,routeChangeRequest:n.navRequest}),this._onBeforeNavigate(n.navRequest.path,n.navRequest.options),e.confirm()):e.cancel()}))}))}},{key:"_onRouterNavigationCancelled",value:function(t){const{options:e}=t,n={activeRoute:this._router._lastRoutedPath,routeChangeRequest:t};this._router._lastRoutedPath&&this._isSrcPopState(e)&&this._historyManager.pushState(null,"",this._currentOrigin+this._router._root+this._router._lastRoutedPath),p.default.get("app-route-change-canceled").publishSync(n)}},{key:"_onRouterNavigationAborted",value:function(t){const e={activeRoute:this._router._lastRoutedPath,routeChangeRequest:t};p.default.get("app-route-change-aborted").publishSync(e)}},{key:"_onRouterNavigationCompleted",value:function(t){const e={activeRoute:this._router._lastRoutedPath,routeChangeRequest:t};p.default.get("app-route-change-completed").publishSync(e)}},{key:"_isSrcPopState",value:function(t){return!(!t||"popstate"!==t.src)}},{key:"_getLayoutManager",value:function(){return this._applicationCtx.getCorePlugin("layoutManager")}},{key:"_canChangeRoute",value:function(t){const{pageNotFoundRoute:e}=t.navRequest.options;return!this._currentController||e?Promise.resolve(!0):this._getLayoutManager().then((e=>Promise.all([this._currentController.readyToUnload(t),e.readyToUnload(t)]).then((t=>{console.log("readyToUnload");for(let e=0;e<t.length;e++)if(!t[e])return!1;return!0}))))}},{key:"_unloadCurrentController",value:function(){this._currentController&&(!this._currentController.isStopped()&&this.stopControllerOnUnload&&this._currentController.stop(),this._currentExtension&&(this._currentExtension.controllerInstance=null,this._currentExtension=null),this._currentController=null)}},{key:"_onExtensionRegistered",value:function(t){const{extension:e}=t,n=e.config;if(e.extensionPointId===P&&!1!==n.accessible){if(n.widget&&n.widget.id&&!1===this._addWidgetRouteMapping(e))return;this._router.addRoute({matcher:"".concat(n.path,"/*"),handler:this._handleNavigation.bind(this),extension:e})}}},{key:"_addWidgetRouteMapping",value:function(t){const e=t.contributorId,n=this._applicationCtx.getPluginManager().getPlugin(e),o=t.config.widget.id;let r=t.config.widget.version;const{path:i}=t.config,a=r?"".concat(o,"@").concat(r):o,s=n.config.dependencies&&n.config.dependencies.widgets,u="NavigationManager: Error registering route extension for path '".concat(i,"' by contributor '").concat(e,"'. No dependency specified for widget '").concat(a,"'");if(!s||!s.length)return this._logger.error(u),!1;const l=s.filter((t=>t.split("@")[0]===o)).map((t=>t.split("@")[1]));if(!l.length||r&&-1===l.indexOf(r))return this._logger.error(u),!1;if(l.length>1&&!r){const t="NavigationManager: Error registering route extension for path '".concat(i,"' by contributor '").concat(e,"'. Multiple version dependencies specified for widget '").concat(a,"' in the contributor. Include version in the route extension widget info to resolve ambiguity");return this._logger.error(t),!1}return r=r||l[0],this._widgetEntryMap.put(o,r,i),!0}},{key:"_onCorePluginsStarted",value:function(){this._applicationCtx.getExtensionRegistry().registerExtensionPoint({id:P})}},{key:"_onExtensionUnregistered",value:function(t){const{extension:e}=t;e.extensionPointId===P&&this._router.removeRoute((t=>t.extension&&t.extension.id===e.id))}}])&&C(e.prototype,n),u}(r.Z)}}]);
//# sourceMappingURL=890.js.map