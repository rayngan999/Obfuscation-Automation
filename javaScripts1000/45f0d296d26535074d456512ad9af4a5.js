var lang="USD";var pageLang=$("html")[0].lang;var containerLoaded=false;var ipCanada=false;function fromCanada(){if(pageLang!="en")return false;var browserLang=window.navigator.userLanguage||window.navigator.language;var countryField=$("#en__field_supporter_country").val();if(browserLang=="en-CA"||countryField=="CA")return true;return ipCanada;}
function loadLang(lang,currency){var info="";switch(lang){case "en":info='<p class="langInfo">All gifts are processed in U.S. dollars (USD). To see the '+
currencyLang("en",currency)+
' equivalent choose an amount in USD below and this calculator will display both amounts. FX rates provided by Fixer.io.</p><hr class="currencyDivider"><h3 id="pseudoRates"></h3>';break;case "es":info='<p class="langInfo">Todos los donativos se convierten a dÃ³lares estadounidenses (USD). Usa esta calculadora para determinar el monto de tu donativo en '+
currencyLang("es",currency)+
' segÃºn el tipo de cambio actual provisto por Fixer.io.</p><hr class="currencyDivider"><h3 id="pseudoRates"></h3>';break;default:info='<p class="langInfo">All gifts are processed in U.S. dollars (USD). To see the '+
currencyLang("en",currency)+
' equivalent choose an amount in USD below and this calculator will display both amounts. FX rates provided by Fixer.io.</p><hr class="currencyDivider"><h3 id="pseudoRates"></h3>';}
return info;}
function currencyLang(lang,currency){var info={};switch(currency){case "MXN":info={es:"pesos Mexicanos (MXN)",en:"Mexican peso (MXN)"};break;case "EUR":info={es:"Euros (EUR)",en:"Euro (EUR)"};break;case "ARS":info={es:"pesos Argentinos (ARS)",en:"Argentine peso (ARS)"};break;case "COP":info={es:"pesos Colombianos (COP)",en:"Colombian peso (COP)"};break;case "CAD":info={es:"dÃ³lares Canadienses (CAD)",en:"Canadian dollar (CAD)"};break;case "CLP":info={es:"pesos Chilenos (CLP)",en:"Chilean peso (CLP)"};break;case "GBP":info={es:"libras esterlinas (GBP)",en:"British Pound (GBP)"};break;default:info={es:"("+currency+")",en:"("+currency+")"};}
return info[lang];}
const countryCodeExpression=/loc=([\w]{2})/;const userIPExpression=/ip=([\w\.]+)/;function initCountry(){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest();xhr.open("GET","https://www.cloudflare.com/cdn-cgi/trace",true);xhr.timeout=3000;xhr.onreadystatechange=function(){if(this.readyState==4){if(this.status==200){countryCode=countryCodeExpression.exec(this.responseText);ip=userIPExpression.exec(this.responseText);if(countryCode===null||countryCode[1]===""||ip===null||ip[1]===""){reject("IP/Country code detection failed");}
let result={countryCode:countryCode[1],IP:ip[1],};resolve(result);}else{reject(xhr.status);}}};xhr.ontimeout=function(){reject("timeout");};xhr.send();});}
function loadConversionContainer(){if(containerLoaded)return false;$.ajax({type:"get",url:"https://resources.peta.org/engaging-networks/services/currency-conversion-backend/fixer-io.php",dataType:"JSON",success:function(res){if(fromCanada()||pageLang!=="en"){appendConverter(res);}},error:function(res){console.error(res.responseText);},});}
function appendConverter(res){if(containerLoaded)return;var node=[res];$(".en__field--donationAmt").before('<style>p.currencySelectLabel{display:inline;}p.langInfo{font-size:.74rem;}.en__field--pseudo-currencyConverter{width:100%;max-width:450px;}.en__field--pseudo-currencyText{width: 120px; display: inline-block !important;     margin-left: 0.1rem;}#en__field_pseudo_currencyConverter{max-width: 110px !important;min-width: 80px !important;background-position: calc(100% + 1rem); background-origin: content-box; padding-right: 1.5rem;padding-left: 1rem;margin-left: .5rem;margin-bottom: 0;}select#en__field_pseudo_currencyConverter:focus{box-shadow: 0 0 0;}#pseudo_Info{padding: 1rem;display: block;border: 1px solid rgb(204, 204, 204);border-radius: 5px;margin-top: .25rem;} hr.currencyDivider{margin: 0 0 1rem 0;}</style><div class="en__field en__field--select en__field--0000 en__field--pseudo-currencyConverter"><div class="en__field__element en__field__element--select en__field--pseudo-currencyText"><select id="en__field_pseudo_currencyConverter" class="en__field__input en__field__input--select" name="currencyConverter"></select></div><div id="pseudo_Info" style="display:none;"></div></div>');if(node[0].success==false||node==null){$(".en__field--pseudo-currencyConverter").css("display","none");if(node[0].success==false){console.error(node[0].error["info"]+" https://fixer.io/");}
containerLoaded=false;return false;}
if(fromCanada()&&pageLang!="es"){node[0].rates={USD:node[0].rates.USD,CAD:node[0].rates.CAD,EUR:node[0].rates.EUR,GBP:node[0].rates.GBP,MXN:node[0].rates.MXN,};}else{node[0].rates={USD:node[0].rates.USD,MXN:node[0].rates.MXN,EUR:node[0].rates.EUR,ARS:node[0].rates.ARS,COP:node[0].rates.COP,CAD:node[0].rates.CAD,CLP:node[0].rates.CLP,};}
jQuery.each(node[0].rates,function(key,value){if(key==lang){if(pageLang=="es"){$("div.en__field--pseudo-currencyText").before('<p class="currencySelectLabel">Moneda de Preferencia</p>');$("select#en__field_pseudo_currencyConverter").append('<option value="'+key+'">'+key+"</option>");}else{$("div.en__field--pseudo-currencyText").before('<p class="currencySelectLabel">Preferred Currency</p>');$("select#en__field_pseudo_currencyConverter").append('<option value="'+key+'">'+key+"</option>");}}else{$("select#en__field_pseudo_currencyConverter").append('<option value="'+key+'">'+key+"</option>");}});function numberFormatter(num){var toFixedNum=parseFloat(num).toFixed(2);var wholeAndDecimal=String(toFixedNum).split(".");var reversedWholeNumber=wholeAndDecimal[0].split("").reverse();var formattedOutput=[];jQuery.each(reversedWholeNumber,function(index,digit){formattedOutput.push(digit);if((index+1)%3===0&&index<reversedWholeNumber.length-1){formattedOutput.push(",");}});formattedOutput=formattedOutput.reverse().join("")+"."+wholeAndDecimal[1];return formattedOutput;}
function conversionRate(currentLangRate,selectedAmt,calc,currency){var symbol="$";if(currency=="EUR"){symbol="â¬";}
var conversionRate=lang+
"&nbsp;$"+
numberFormatter(selectedAmt)+
" <wbr>= "+
currency+
"&nbsp;"+
symbol+
numberFormatter(calc);$("h3#pseudoRates").html(conversionRate);}
$(document).on("change","select#en__field_pseudo_currencyConverter",function(){console.log("Currency Converter Changed");if(this.value!=lang){$("div#pseudo_Info").css("display","block");}else{$("div#pseudo_Info").css("display","none");}
var selectedRate=node[0].rates[this.value];var currentLangRate=node[0].rates[lang];var selectedAmt=$('input[name="transaction.donationAmt"]:checked').val();$("#pseudo_Info").html(loadLang(pageLang,this.value));var calc=(selectedAmt*selectedRate)/currentLangRate;if(!selectedAmt){if(!$('input[name="transaction.donationAmt.other"]').val()){selectedAmt=0;}else{selectedAmt=$('input[name="transaction.donationAmt.other"]').val();}
calc=(selectedAmt*selectedRate)/currentLangRate;}
conversionRate(currentLangRate,selectedAmt,calc,this.value);});$(document).on("change",'input[name="transaction.recurrpay"]',function(){console.log("Recurrance Changed");var selectedRate=node[0].rates[$("select#en__field_pseudo_currencyConverter option:selected").val()];var currentLangRate=node[0].rates[lang];var selectedAmt=$('input[name="transaction.donationAmt"]:checked').val();var calc=(selectedAmt*selectedRate)/currentLangRate;if(!selectedAmt){if(!$('input[name="transaction.donationAmt.other"]').val()){selectedAmt=0;calc=0;}else{selectedAmt=$('input[name="transaction.donationAmt.other"]').val();calc=(selectedAmt*selectedRate)/currentLangRate;}}
conversionRate(currentLangRate,selectedAmt,calc,$("select#en__field_pseudo_currencyConverter option:selected").val());});$("select#en__field_pseudo_currencyConverter option:selected").each(function(){var selectedRate=node[0].rates[this.value];var currentLangRate=node[0].rates[lang];var selectedAmt=$('input[name="transaction.donationAmt"]:checked').val();$("div#pseudo_Info").html(loadLang(pageLang,this.value));var calc=(selectedAmt*selectedRate)/currentLangRate;if(!selectedAmt){if(!$('input[name="transaction.donationAmt.other"]').val()){selectedAmt=0;}else{selectedAmt=$('input[name="transaction.donationAmt.other"]').val();}
calc=(selectedAmt*selectedRate)/currentLangRate;}
conversionRate(currentLangRate,selectedAmt,calc,this.value);});$(document).on("click",'input[name="transaction.donationAmt"]',function(){console.log("Donation Amount Clicked");selectedAmt=$('input[name="transaction.donationAmt"]:checked').val();currency=$("select#en__field_pseudo_currencyConverter option:selected").val();selectedRate=node[0].rates[currency];currentLangRate=node[0].rates[lang];calc=(selectedAmt*selectedRate)/currentLangRate;if(!selectedAmt){conversionRate(currentLangRate,0,0,currency);}else{conversionRate(currentLangRate,selectedAmt,calc,currency);}});$('input[name="transaction.donationAmt.other"]').keyup(function(){currency=$("select#en__field_pseudo_currencyConverter option:selected").val();selectedRate=node[0].rates[currency];currentLangRate=node[0].rates[lang];calc=(this.value*selectedRate)/currentLangRate;if(!this.value){conversionRate(currentLangRate,0,0,currency);}else{$("h3#pseudoRates").html(conversionRate(currentLangRate,this.value,calc,currency));}});containerLoaded=true;}
initCountry().then(function(result){ipCanada=result.countryCode==="CA";loadConversionContainer();}).catch(function(e){console.log(e);});$("#en__field_supporter_country").change(function(){loadConversionContainer();});