"use strict";!function(){var L=window.freedom.nsPubSub||{};function o(o){var r=o.querySelector("[data-search-suggestion-wrapper]"),i=o.querySelector("[data-search-field]"),e=o.parentElement.querySelector("[data-search-field-form]");if(!r||!i||!e)throw new Error("Main structure is missing. Verify SearchField component.");var t,s,a={lastTypedQuery:"",searchTimeoutId:null,lastRequestedQuery:"",selectedSuggestionLastPosition:-1},u="selected",d="loading",l={up:38,down:40,esc:27},c={suggestion:"/refactoring/suggestion",topResults:"/refactoring/suggestion/top-results"};function n(e,t){var o,s=e;return s=(s=s.toLowerCase()).trim(),t?(s=s.replace(/\s+/g,"+"),encodeURI(s)):(window.freedom.nsDiacritics.normalize(e),s=s.replace(/\s\s+/g," "),document.querySelector(".search-in-seller__checkbox")&&!0===document.querySelector(".search-in-seller__checkbox").checked&&(o=document.querySelector(".search-in-seller").getAttribute("data-seller-id"),document.cookie="search_in_seller_enabled="+o+";path=/"),s)}function g(){window.clearTimeout(a.searchTimeoutId),a.searchTimeoutId=null;var e=r?r.querySelectorAll("[data-suggestion-list] a"):[];if(e&&e.length)for(var t=0;t<e.length;t++)e[t].removeEventListener("mouseover",S);L.pub("overlay.display","hide"),window.freedom.removeClass(o,"suggestion-active"),r.innerHTML="",a.selectedSuggestionLastPosition=-1}function f(e){g(),"string"==typeof e&&(r.innerHTML=e,function(){for(var e=r?r.querySelectorAll("[data-suggestion-list] a"):[],t=0;t<e.length;t++)e[t].addEventListener("mouseover",S),e[t].addEventListener("mouseleave",y);L.pub("overlay.display","show"),window.freedom.addClass(o,"suggestion-active")}(),window.freedom.nsPubSub.pub("Searchfield.suggestion.loaded"),window.freedom.nsPubSub.pub("Searchfield.suggestion.loaded.float.mobile"))}function w(t,e){e&&2<e.length&&window.freedom.restClient.request(t+"?q="+e,{complete:function(e){if(a.searchTimeoutId){if(t===c.suggestion)return void f(e);!function(e){var t=r.querySelector("[data-suggestion-top-results-wrapper]");"string"==typeof e&&e&&t&&(t.innerHTML=e,window.freedom.nsPubSub.pub("Searchfield.suggestion.loaded"));var o=r.querySelector("."+d);o&&window.freedom.removeClass(o,d)}(e)}}})}function m(e,t){return(t=n(t,!0)).toLowerCase()!==a.lastRequestedQuery.toLowerCase()&&(a.lastRequestedQuery=t,window.clearTimeout(a.searchTimeoutId),a.searchTimeoutId=window.setTimeout(function(){w(e,t)},400),1)}function v(){var e=r.querySelector("."+u);e&&(window.freedom.removeClass(e,u),window.freedom.removeClass(e,d))}function b(e){var t=r?r.querySelectorAll("[data-suggestion-list] a"):[];if(t.length){switch(-1===a.selectedSuggestionLastPosition&&(a.lastTypedQuery=i.value),e.keyCode){case l.up:0<=a.selectedSuggestionLastPosition?a.selectedSuggestionLastPosition--:a.selectedSuggestionLastPosition=t.length-1;break;case l.down:a.selectedSuggestionLastPosition===t.length-1?a.selectedSuggestionLastPosition=-1:a.selectedSuggestionLastPosition++;break;default:return}if(e.preventDefault(),-1===a.selectedSuggestionLastPosition)return i.value=a.lastTypedQuery,o=e,window.freedom.removeClass(o.currentTarget,u),i.value=a.lastTypedQuery,i.focus(),void v();var o,s,n=t[a.selectedSuggestionLastPosition];i&&n&&(i.value=n.innerText),v(),n&&(s=n,window.freedom.addClass(s,u),s&&m(c.topResults,s.innerText)&&window.freedom.addClass(s,d))}}function h(e){if(e.value?window.freedom.addClass(o,"clear-active"):window.freedom.removeClass(o,"clear-active"),e.value.length<3)return g(),void window.freedom.nsPubSub.pub("SearchSuggestion.mobile.disable.Fixed");m(c.suggestion,e.value)}function p(e){var t=e.currentTarget;if(e.keyCode===l.esc)return window.freedom.nsPubSub.pub("Searchfield.esc.pressed"),void g();e.keyCode!==l.up&&e.keyCode!==l.down?h(t):b(e)}function S(e){v(),e&&e.currentTarget&&m(c.topResults,e.currentTarget.innerText)&&window.freedom.addClass(e.target,d)}function y(e){setTimeout(function(){window.freedom.removeClass(e.target,d)},20)}function T(e){i.value?(i.value.replace(/<[a-zA-Z\/][^>]*>|">|<"/g,""),i.value=n(i.value)):(window.freedom.preventDefault(e),window.location.pathname&&"/"!==window.location.pathname&&window.location.assign("/"))}t=o.getAttribute("data-suggestion"),s=!(t&&"ENABLED"!==t),e.addEventListener("submit",T),s&&(g(),window.freedom.nsPubSub.sub("overlay.clicked",g),window.freedom.nsPubSub.sub("searchField.clearSuggestion",g),window.freedom.nsPubSub.sub("float.searchField.clearSuggestion",g),window.freedom.nsPubSub.sub("searchField.valueUpdated",h),i.addEventListener("keyup",p))}function e(){var e=document.querySelectorAll("[data-search-field-wrapper]");if(e.length)for(var t=0;t<e.length;t++)o(e[t])}L.sub("nsDiacritics.loaded",e)}();