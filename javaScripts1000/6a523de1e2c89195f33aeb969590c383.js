function processBackUpName(e,t){return e+"."+t.replace(/ /g,"").replace(/,/g,".")+".pdf"}function updateProgress(e,t,n){var o=e.querySelector(".progressBar-progress"),a=Math.floor(100*t/n);o.style.width=a+"%"}function disableNewDownload(e,t,n){1!=n&&(document.querySelectorAll(".card")[n-1].style.filter="grayscale(0)"),e.classList.remove("hidden"),t.classList.add("disabled"),t.removeAttribute("onclick")}function downloadFile(e,t,n,o){var a=new Blob(e,{type:"application/pdf"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download=t?t.split("=")[1]:processBackUpName(n,o),document.body.appendChild(i),i.click()}function setUpNewDownload(e,t,n){(e.classList.add("hidden"),e.querySelector(".progressBar-progress").style.width="0%",t.classList.remove("disabled"),t.setAttribute("onclick","downloadPagesUrl(event)"),1!=n)&&document.querySelectorAll(".card")[n-1].style.removeProperty("filter")}function downloadPagesUrl(e){var t=e.target,n=t.dataset.index,o=t.dataset.pub,a=t.dataset.date,i=t.dataset.resource,s=document.querySelector(".progressBar.item"+n);disableNewDownload(s,t,n),fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/pdf"},body:'["fullIssue"]'}).then(function(e){var i=e.headers.get("Content-Length")?e.headers.get("Content-Length"):6e7,r=e.headers.get("Content-Disposition"),d=e.body.getReader(),c=0,l=[],u=0;d.read().then(function e(m){var p=m.value;return m.done?(downloadFile(l,r,o,a),setUpNewDownload(s,t,n),null):(l.push(p),c+=p.length,150===(u+=1)&&(u=0,updateProgress(s,c,i)),d.read().then(e))})}).catch(function(e){console.log(e)})}var UD=UD||{},scriptMomentLoaded=!1;if(!window.moment){var momentScript=document.createElement("script");$("head").append(momentScript),momentScript.src="/wps/source/scripts/libs/moment.min.js",momentScript.onload=function(){scriptMomentLoaded=!0}}function nativoFn(){var e=1,t="";function n(o){var a,i={video:function(){$("#nativo-video-list-1").length&&$(".more-videos .wf-gallery-playlist article:eq(1)").after($("#nativo-video-list-1")),a=mi.pageInfo.getConf("nativo.video.placements")},story:function(){a=mi.pageInfo.getConf("nativo.story.placements")},default:function(){a=void 0}};return(i[o]||i.default)(),function(o){var a=mi.pageInfo.getConf("marketInfo.allow_nativo");void 0!==a&&"true"!=a||("object"==typeof PostRelease&&"function"==typeof PostRelease.Start?void 0===o?PostRelease.Start():PostRelease.Start(o):e<=60&&window.setTimeout(function(){e++,n(t)},500))}(a)}window.digitalData&&window.digitalData.page&&window.digitalData.page.type&&n(t=window.digitalData.page.type)}if(UD.updateDate=function(){var e={validateMomentScript:function(e,t,n){scriptMomentLoaded?this.getListUpdateDate(e,t,n):setTimeout(()=>this.validateMomentScript(e,t,n),500)},getListUpdateDate:function(t,n,o){$(".update-date").each(function(){var a=$(this).attr("data-originaldate");e.getDiffDate(this,a,t,n,o)})},getDiffDate:function(e,t,n,o,a){"es"===o&&moment.updateLocale(o,{months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]});var i=moment().utcOffset(a).format(),s=moment.unix(t).utcOffset(a).format(),r="",d=moment(i),c=moment(s),l={updated:"Updated",minuteAgo:"minute ",minutesAgo:"minutes ",hours:"hours ",hour:"hour ",ago:" ago ",just:"Updated less than one minute ago"};"es"===o&&(l={updated:"Actualizado",minuteAgo:"minuto",minutesAgo:"minutos",hours:"horas",hour:"hora",ago:" atras",just:"Actualizado hace menos de un minuto"});var u=d.diff(c,"minutes");if(u<=720)if(1===u)r=l.updated+" "+u+" "+l.minuteAgo+l.ago;else if(0===u)r=l.just;else if(u<60)r=l.updated+" "+u+" "+l.minutesAgo+l.ago;else{var m=Math.floor(u/60||0),p=Math.floor(u%60||0),v=l.ago;0!==p&&(v=1===p?p+" "+l.minuteAgo+l.ago:p+" "+l.minutesAgo+l.ago),r=m>1?l.updated+" "+m+" "+l.hours+" "+v:l.updated+" "+m+" "+l.hour+" "+v}else r=l.updated+" "+moment.unix(t).utcOffset(a).format(n);$(e).html(r)}};return{functionsUpdateDate:e}}(),window.untv){if(!("true"===((window.digitalData||{}).user||{}).adFree)){const e=document.createElement("script");e.async=!0,e.src="https://s.ntv.io/serve/load.js",e.addEventListener("load",()=>{nativoFn()}),document.querySelector("body").appendChild(e)}}document.addEventListener("DOMContentLoaded",function(){$(".js-cards, .immersive").one("click",".video-modal__trigger",function(){var e=$($(this).data("target")),t={isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},togglePlayPause:function(e,t){if(e.data("hasvideo")){var n=videojs(e.find("video").attr("id"));"play"===t?n.el().classList.contains("vjs-ad-playing")?n.ima.resumeAd():n.play():"pause"===t&&(n.el().classList.contains("vjs-ad-playing")?n.ima.pauseAd():n.pause())}},toggleFullScreenMobile:function(e,n){var o=videojs(e);t.isMobile()&&(o.isFullscreen()?o.exitFullscreen():(o.requestFullscreen(),n.modal("hide")))}};e.on("shown.bs.modal",function(){t.togglePlayPause(e,"play")}),e.on("hidden.bs.modal",function(){t.togglePlayPause(e,"pause")})})});"use strict";var mi=mi||{};mi.commentingFaceboook=function(){var e=$("#commenting-container"),t=e.find(".glyphicon-chevron-down"),n=$("#fb-comments");function o(){n.hasClass("in")?(n.removeClass("in"),t.removeClass("rotate")):(n.addClass("in"),t.addClass("rotate"))}return{init:function(){var t="";1===$("meta[property='fb:app_id']").length&&"true"===$("meta[name='allow-comments']").prop("content")?(e.on("click","a.comments-toggle",function(){void 0===mi.commenting&&(mi.commenting=new mi.Commenting,mi.commenting.setConf({accountName:mi.pageInfo.getConf("marketInfo.domain"),fbapp_id:mi.pageInfo.getConf("facebook.app.id"),fb_comment_div:{"data-width":"100%"}}),mi.commenting.display(),FB.XFBML.parse(document.getElementById("fb-comments"))),o()}),document.addEventListener("DOMContentLoaded",function(){o()})):(t="Comments have been disabled for this story.",n.prepend("<p><strong>"+t+"</strong></p>"))}}}();var subnavSection=function(){var e,t,n,o=$(".subnav-section-front-organism .subnav-section-list-more"),a=$(".subnav-section-front-organism .subnav-overflow"),i=document.body.querySelectorAll(".subnav-section-front-organism .subnav-overflow"),s=[];function r(){e=e||$(".subnav-section-front-organism"),t=t||$(".subnav-section-front-organism .subnav-section-list"),(n=o.hasClass("hidden")?e.width():e.width()-o.width()-30)>480?($(".subnav-section-name").attr("aria-expanded","true"),t.width()>n?(s.push(t.width()),t.children().last().prependTo(a),o.hasClass("hidden")&&o.removeClass("hidden")):(n>s[s.length-1]&&(a.children().first().appendTo(t),s.pop()),s.length<1&&(o.addClass("hidden"),a.addClass("hidden"))),t.width()>n&&r()):(a.children().appendTo(t),o.addClass("hidden"),a.addClass("hidden"),$(".subnav-section-container").hide())}function d(e,t){let n;(n=null===(n=null===(n=e instanceof NodeList?e:null)&&e instanceof HTMLElement?[e]:n)&&"string"==typeof e?document.body.querySelectorAll(e):n)&&n.forEach(e=>{e.classList.toggle(t)})}return{init:function(){var e;window.addEventListener("resize",function(){r()}),o.on("click",function(){a.toggleClass("hidden"),d(".subnav-section-list-more","active"),d(".list-more-icon","close")}),r(),document.querySelectorAll(".subnav-section-title").forEach(e=>{e.addEventListener("click",function(){$(".subnav-section-container").toggle(),d(".subnav-section-icon","close"),this.removeAttr("aria-expanded")})}),e=function(){d(i,"hidden"),d(".subnav-section-list-more","active"),d(".list-more-icon","close")},i.forEach(t=>{t.addEventListener("mouseleave",e)})}}}();subnavSection.init();var masthead=function(){function e(){var e=this.querySelector("input[type=text]");e&&(e.focus(),e.classList.add("open"))}function t(e){e.preventDefault();var t=document.querySelectorAll(".account-popup"),n=$(t);n.hasClass("show")||(n.addClass("show"),$(this).attr("aria-expanded","true"))}function n(){var e=document.querySelectorAll(".account-popup"),t=$(e);t.hasClass("show")&&(t.removeClass("show"),$(".account-links").removeAttr("aria-expanded"))}function o(e){var t=$(e.currentTarget),n=$(e.target);return"a"===$(n).prop("tagName").toLowerCase()?(this.stopPropagation(),!0):"li"!==t.prop("tagName").toLowerCase()||(t.toggleClass("active"),"true"===t.attr("aria-expanded")?t.removeAttr("aria-expanded"):t.attr("aria-expanded","true"),!1)}function a(){var e=$(document.querySelectorAll("#sectionsmenu, #quickNavMore")),t=document.querySelector("#mainNav"),n=$(t);$("#mainNav").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(e){"transform"===e.originalEvent.propertyName&&($(this).hasClass("open")?$(this).removeClass("hidden"):$(this).addClass("hidden"))}),n.hasClass("open")&&(n.removeClass("open"),n.attr("aria-hidden","true"),e.removeAttr("aria-expanded"))}function i(e){var t,n=this.contains(e.relatedTarget);return n||(a(),t=document.querySelector(".main-nav div.search"),$(t).removeClass("open")),n}function s(){if(!$(".main-nav").hasClass("jsready")){document.querySelectorAll(".main-nav .nav-item.expandable, .main-nav .nav-item.expandable span").forEach(function(e){$(e).on("click",o)}),$(".subcategory-title").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).css({outline:"none"})});var e=document.querySelectorAll("#sectionsmenu, #quickNavMore"),t=document.querySelector("#closenavigation");$(e).on({click:function(e){!function(e){e.preventDefault();var t=$(document.querySelectorAll("#sectionsmenu, #quickNavMore")),n=document.querySelector("#mainNav"),o=$(n);o.hasClass("open")||(t.attr("aria-expanded","true"),o.outerHeight(),o.removeClass("hidden"),o.addClass("open"),o.removeAttr("aria-hidden"),document.querySelector("#mainNav button:first-child").focus())}(e)}}),$(t).on("click",a),$(".main-nav").addClass("jsready").on("focusout",i)}}return{init:function(){var o,a,i,r;(o=document.querySelector("form.searchbox"))&&(o.addEventListener("click",e),o.addEventListener("focusout",function(e){var t=this.contains(e.relatedTarget);return t||function(){var e=this.querySelector("input[type=text]");e&&e.classList.remove("open")}.call(this),t})),a=document.querySelectorAll(".paywall-links .main.account-links"),i=document.querySelectorAll(".account-popup .close"),$(a).on("click",t),$(i).on("click",n),s(),$(".top-navigation li ul").hide().removeClass("quick-nav-second-level"),"ontouchstart"in window||document.querySelectorAll(".top-navigation .item-first-level").forEach(function(e){e.addEventListener("mouseover",function(){$("ul",e).addClass("expanded-submenu").slideDown(400)}),e.addEventListener("mouseout",function(){$("ul",e).stop().slideUp(200,function(){e.classList.remove("expanded-submenu")})})}),$(".search").on("keydown",function(e){var t=e.which;9!==t&&13!==t||$(this).addClass("open")}),(r=document.getElementById("search-icon"))&&r.addEventListener("click",function(e){e.preventDefault();var t=document.getElementById("flag");t&&t.classList.toggle("searching")})}}}();masthead.init();var $articles=$("#story-series").find(".card"),artToShow=12,changePage=function(e){var t=(e-1)*artToShow,n=e*artToShow,o=$("#curPage");$articles.hide();for(var a=t;a<n;a+=1)$articles.eq(a).show();$("#page"+o.val()).removeClass("pgSelected"),o.val(e),$("#page"+o.val()).addClass("pgSelected")},relatedSeriesLength=$("#story-series").find(".card").length;$(".expand").on("click",function(){relatedSeriesLength>5&&($("#overlay-wrapper").addClass("overlay-open"),$("body").css("overflow","hidden"),window.scrollTo(0,0))}),$(".backLink").on("click",function(){$("#overlay-wrapper").removeClass("overlay-open"),$("body").css("overflow","")});var mia11y=function(){return{init:function(){var e;(e=document.querySelector("body")).addEventListener("keyup",function(t){if("tab"===t.key.toLowerCase()){var n=e.classList;n.contains("keyboard-nav")||n.add("keyboard-nav")}}),e.addEventListener("mousedown",function(){var t=e.classList;t.contains("keyboard-nav")&&t.remove("keyboard-nav")})}}}();mia11y.init();