!function(){const e=function(){if(window.hindsight_referrer)return!0;const e=document.querySelector("script[src*='hindsight']");if(!e)return!1;if(e.parentElement.classList.contains("GoogleActiveViewElement"))return!0;const t=document.querySelector(".GoogleActiveViewElement");return!(!t||!t.innerHTML.includes("clickfuse.com"))||!(!document.querySelector(".GoogleActiveViewInnerContainer")||!document.body.innerHTML.includes("clickfuse.com"))}(),t=function(e){try{return console.log(window.parent.document),e?window.parent:window}catch(t){return window}}(e),r=t.document,n=t.location.hostname;window.hindsight_referrer&&(window.hindsight_referrer=decodeURIComponent(window.hindsight_referrer));const i=["music","movies"];let s={},o="",l={},c="";const a="staging-smart-tags-admin.solutionshindsight.net"===n?"STAGING":"PRODUCTION",u="STAGING"===a?"https://staging-api.solutionshindsight.net/v1":"https://api.solutionshindsight.net/v1";function d(e){const t=new URL(e).host,r=t.match(/(www[0-9]?\.)?(.[^\/:]+)/i);return null!=r&&r.length>2&&"string"==typeof r[2]&&r[2].length>0?r[2]:t}l=t.hindsightConfig?{articleUrl:window.hindsight_referrer||t.hindsightConfig.articleURL||t.location.href,publisherId:t.hindsightConfig.publisherId}:{articleUrl:window.hindsight_referrer||t.location.href,publisherId:""};const h=["client-selected-entity","client-blocklisted-article"];class f{constructor(){this.context=Object.freeze(f.createBaseContext()),this.startTime=(new Date).getTime(),this.logs=[]}static createBaseContext(){return{trace_id:g()+"-"+Date.now(),url:l.articleUrl,domain:d(l.articleUrl),device:e?"GAM":t.screen.width<767?"MOBILE":"DESKTOP",agent:t.navigator.userAgent||null}}getTimeDifference(){return(new Date).getTime()-this.startTime}setLibrary(e){return this.context=p(this.context,{library:e}),this}setPublisherId(e){return this.context=p(this.context,{publisher_id:e}),this}setArticleId(e){return this.context=p(this.context,{article_id:e}),this}setExtraData(e){return this.context=p(this.context,e||{}),this}createLog(e,t){const r={time:this.getTimeDifference()};return{name:e,timestamp:(new Date).toISOString(),data:{hindsight:Object.assign(r,t,this.context)}}}log(e,t){const r=this.createLog(e,t);return this.logs.push(r),h.includes(e)&&this.flushEvents(),this}flushEvents(){let e="https://api.solutionshindsight.net/v2/events/_bulk";return"STAGING"===a&&(e="https://staging-api.solutionshindsight.net/v2/events/_bulk"),fetch(e,{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify({events:this.logs})}),this.logs=[],this}}function p(e,t){const r=Object.assign({},e);return Object.freeze(Object.assign(r,t))}function g(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}const m=new f;function b(e){return{status:"error",error:e,entity:null}}function w(e,{articleSection:r}){if(!r)return!1;const n=t.document.querySelector(r.selector);return!!n&&(n[r.select||"content"]||"").toLowerCase()===e.toLowerCase()}function _(e){const t={"article/section/eq":w};for(const r of e.music_overrides||[])for(const n of Object.keys(r.match)){const i=t[n];i&&i(r.match[n],e)&&(e=Object.assign(e,r.values||{}))}return e}function y(){const e=Array.from(r.querySelectorAll(s.frontend_setup.articleBodySelector));return e.find(e=>!e.hindsight_processed)||e[e.length-1]}function I(e){return new Promise((t,r)=>{const n=new XMLHttpRequest,i=u+"/ads?referrer="+encodeURIComponent(e);n.open("GET",i,!0),n.send(null),n.onreadystatechange=function(){if(4!==n.readyState)return null;if(200!==n.status)return r(b("failed_to_fetch_entities"));let e={};return e=JSON.parse(n.responseText)||{},t(e)}})}function x(e){const r=(t.location||{}).search||"",n=new URLSearchParams(r),i=n.get("hindsight_debug")||n.get("hindsight");return!!i&&i.split(",").indexOf(e)>-1}function v(e=""){return(e[0]||"").toUpperCase()+e.slice(1)}function S(e,t){let r=e;if(e&&t){const n=new RegExp(t),i=parseInt(e.match(n),10);isNaN(i)||(r=i)}return r}function O(e,t){Object.keys(t).forEach(r=>{(t[r].entity||"music"===r)&&function(e,t,r){const n={publisher_id:e.publisherId,publisher_name:e.publisherName,article_id:o,label:t,entity:r.entity,fallback:r.is_fallback};m.log("client-selected-entity",n)}(e,r,t[r])})}m.setLibrary("music").log("browser-loaded-client").setArticleId(l.articleUrl),window.getArticleEntities=t.getArticleEntities=function(){const e=function(){const e=t.location.pathname,r=[{host:"rottentomatoes.com",selector:"meta[property='og:title']",publisherId:"5f21c48f1d403a57d1956ed8",publisherName:"Rotten Tomatoes",label:"movies"},{host:"fandango.com",selector:"meta[property='twitter:title']",publisherId:"5f21c59c1d403a57d1956edb",publisherName:"Fandango",label:"movies"},{host:"blabbermouth.net",selector:".tags > a",publisherId:"5e3841184df7272d52ec9f92",publisherName:"Blabbermouth",label:"music",articleBodySelector:".entry-content"},{host:"www.last.fm",path:"/music/",selector:".header-new-title",publisherId:"5f442278e3842154ada805e8",publisherName:"lastfm",label:"music"},{host:"www.last.fm",path:"/event/",selector:".header-title > a",publisherId:"5f442278e3842154ada805e8",publisherName:"lastfm",label:"music"},{host:"letras2.com",selector:".post-tag > a",publisherId:"60e8519caeec57732d808557",publisherName:"Letras",label:"music"}];for(const t of r)if(n.indexOf(t.host)>-1){if(!t.path)return t;if(e.startsWith(t.path))return t}return null}();return e?function(e){const n=r.querySelector(e.selector)||{};let s=n.content||n.text||n.textContent||n.innerText;s=(s||"").replace("\u307e\u3068\u3081","");const l=i.reduce((t,r)=>(r===e.label?t[e.label]={entity:v(s),is_fallback:!1}:t[r]={entity:"",is_fallback:!1},t),{});o=window.hindsight_referrer||t.location.href,c=r.title,O(e,l);let a={};return e.articleBodySelector&&(a=function(e,t,r={}){if(!e)return{term:""};const n=["covid-19","covid 19","covid19","covid","coronavirus","coronovirus","corona","rape","rapist","abuse","murder","porn","cunt","nigger","penis","fag","faggot","cock","cum","anal","twat","slut","vagina","racist","sexual","shooting","bomb","terrorist","gunman","massacre","riot","violar","violador","abuso","abusar","asesino","asesinato","porno","morbo","puta","negro","pene","marica","maricon","verga","semen","anao","ano","chimba","perra","racista","balacera","tiroteo","bomba","terrorista","pistolero","masacre","disturbio","alboroto","violaci\xf3n","pedophile","trump"];if(x("blacklist"))return{term:n[0]};const i=r.articleBodySelector?r.articleBodySelector+" > p":"p";let s=e.querySelectorAll(i);0===s.length&&(s=e.querySelectorAll("p"));for(const o of n){const e=new RegExp(`\\b${o}\\b`,"gmi");if(e.test(t))return console.log("blacklisted title: "+o),{term:o,title:!0,paragraph:0};for(let t=0;t<s.length;t+=1){const r=s[t];if(e.test(r.innerText))return console.log("blacklisted term: "+o),console.log("blacklisted paragraph: "+r.innerText),{term:o,title:!1,paragraph:t+1}}}return{term:""}}(r.querySelector(e.articleBodySelector),c)),Promise.resolve(function(e,t){return{status:"success",entities:e,is_blacklisted:Boolean(t),blacklisted_word:t||""}}(l,a.term))}(e):async function(){const e=await function(e,t,r){const n=t||new URL(r).host,i=`${function(e){return"STAGING"===e?"https://static-staging.solutionshindsight.net":"https://static.solutionshindsight.net"}(e)}/assets/${btoa(n)}`;return fetch(i).then(e=>e.json()).catch(()=>null)}(a,l.publisherId,l.articleUrl);return s={frontend_setup:_(e)},m.setPublisherId(e.publisherId).setExtraData(e.eventsExtraData).log("client-loaded-config").log("client-detected-opportunity"),s}().then(()=>function(){const e=r.querySelector("meta[property='og:title']");return c=e?e.content:r.title,I(o=function(){if(window.hindsight_referrer)return window.hindsight_referrer;if(t.hindsightConfig&&t.hindsightConfig.articleURL)return t.hindsightConfig.articleURL;const e=s.frontend_setup;if(e.articleId&&e.articleId.selector){const t=y();let r;r=e.articleId.ancestorsSelector?t.closest(e.articleId.selector)||{}:t.querySelector(e.articleId.selector)||{};const n=e.articleId.extractAttribute||"href";let i=r[n]||r.getAttribute(n);if(i)return i.startsWith("http")||(i=window.location.origin+i),m.setArticleId(i),i}let n=null,i=null;if(["Oricon","MuteLeg","Otohako","Cinra","MiyearnZZ Labo","MUSIC LIFE CLUB","Musicman","J-Total"].indexOf(s.frontend_setup.publisherName)>-1&&(n=l.articleUrl),null===n){const e=s.frontend_setup.articleIdSelectorMode;let o=null;if(s.frontend_setup.articleIdRegex&&(o=s.frontend_setup.articleIdRegex),s.frontend_setup.articleIdSelectorAsUrl)if(i=r.querySelector(e),"Under The Radar"===s.frontend_setup.publisherName){const e=i.getAttribute("content").split("//"),t="//www."+e[1]+"/";n=e[0].concat(t)}else n=i?i.getAttribute("content")||i.getAttribute("href"):t.location.href.split("?")[0];else if("Hip-Hop Lately"===s.frontend_setup.publisherName){if(null===t.VUUKLE_CONFIG)return null;n=t.VUUKLE_CONFIG.articleId}else{if(!(i=r.querySelector(e)))return null;if(-1!==e.indexOf("article.id"))n=i.attributes.content.value;else if(-1!==e.indexOf("postid-"))n=function(e){let t=null;return e.classList.forEach(e=>{-1!==e.indexOf("postid")&&(t=parseInt(e.replace(/^\D+/g,""),10))}),t}(i);else if(-1!==e.indexOf("post-"))n=function(e){let t=null;return-1!==e.id.indexOf("post")&&(t=parseInt(e.id.replace(/^\D+/g,""),10)),t}(i);else if(-1!==e.indexOf("og:url"))n=S(i.content,o);else if(-1!==e.indexOf("input"))n=parseInt(i.value,10);else if(-1!==e.indexOf("span[class^"))n=parseInt(i.className.match(/\d+/),10);else if(-1!==e.indexOf("shortlink"))n=S(i.href,o);else if(-1!==e.indexOf("canonical"))n=S(i.href,o);else if(-1!==e.indexOf("og:image")){const e=i.content.split(".");n=e[e.length-2]}else-1!==e.indexOf("metalinjection")&&(n=i.getAttribute("data-post-id"))}}return n}()).then(e=>s.frontend_setup.urlFallbackEnable&&"ready"!==e.message?(m.log("client-received-api_error",{error:e.message}),I(o="https:"+t.location.href.substring(t.location.protocol.length))):e).then(e=>s.frontend_setup.urlFallbackEnable&&"ready"!==e.message?(m.log("client-received-api_error",{error:e.message}),I(o="http:"+t.location.href.substring(t.location.protocol.length))):e).then(e=>{if(e.message)throw m.log("client-received-api_error",{error:e}),b(e.message);if(e.response&&"error"===e.response.status)throw m.log("client-received-api_error",{error:e.response}),b(e.response);return e.response})}()).then(e=>(m.log("client-received-api_success"),e.is_blacklisted&&!x("blacklist")?function(e){const t={publisher_id:s.frontend_setup.publisherId,publisher_name:s.frontend_setup.publisherName,article_id:o,word:e.term,title:e.title,paragraph:e.paragraph};m.log("client-blocklisted-article",t)}({term:e.blacklisted_word}):O(s.frontend_setup,e.entities),(y()||{}).hindsight_processed=!0,e)).catch(e=>{if("error"===e.status)throw e;throw b(e.message)})}}();