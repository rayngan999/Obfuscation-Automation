/*Copyright (c) 2011, 2021, Oracle and/or its affiliates.  All rights reserved.*/


!function(){try{!function(u,m){window.getVPAIDAd=function(){try{if(S.ad)return S.ad;var e=function(){S.Util=n(),S.Queue=s(),S.VpaidAd=o(),S.MoatTag=a(),r();var e=S.Util.parseQS();if(e&&!S.Util.isEmptyObject(e)){S.qs=e;var t={};for(var i in e)t[i]=e[i];return t.wrapperType="js",new S.MoatTag(S.qs.pcode,t),new S.VpaidAd}S.Util.fireError("Unable to parse qs params")}();return S.ad=e}catch(e){S.Util.fireError("Error during MoatWrapper init",!0)}};function E(){function e(){this.availableResources=["StaticResource","IFrameResource","HTMLResource"],this.availableTypesMap={"image/gif":"img","image/jpeg":"img","image/png":"img","application/x-javascript":"js","application/x-shockwave-flash":"swf"},this.availableTypes=["swf","img"]}return e.prototype.loadCompanion=function(r,a,o,s,d,e,l,u){var h=this;function p(e,t,i,n,r,a,o,s){s=s||[];for(var d="",l=0;l<s.length;l++)d+='<img src="'+s[l]+'" style="display:none" width="1" height="1">';if("StaticResource"===r){if("img"==a){var u='<img src="'+t+'" width="'+i+'" height="'+n+'">';d+=o?'<a href="'+o+'" target="_blank">'+u+"</a>":u}if("swf"==a){var p=m.floor(1e7*m.random());d+='<object type="application/x-shockwave-flash" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/sho ckwave/cabs/flash/swflash.cab#version=8,0,0,0" width="'+i+'" height="'+n+'" id="companion'+(p-1)+'"><param name="allowScriptAccess" value="always" /><param name= "movie" value="'+t+'" />'+(o?'<param name="FlashVars" value="clickTag='+encodeURIComponent(o)+'" />':"")+'<param name="wmode" value="opaque" /><embed type="application/x-shockwave-flash" src="'+t+'" '+(o?'flashvars="clickTag='+encodeURIComponent(o)+'" ':"")+'wmode="opaque" width="'+i+'" height="'+n+'" id="companion'+p+'"name="companion'+p+'"allowscriptaccess="always" /></object>'}}return"IFrameResource"===r&&(d+="<iframe style='border:0px; padding:0px; margin:0px;' width='"+i+"' height='"+n+"' frameborder='no' scrolling='no' marginheight='0' marginwidth='0' src='"+t+"'></iframe>"),"HTMLResource"===r&&(d+=t,e&&(i&&(e.style.width=i+"px"),n&&(e.style.height=n+"px"))),S.HCP.companionAdRendered=!0,d}a=h.availableTypesMap[a];var c=!1;function t(){if(c)return!0;try{var e=a,t=function(e,t,n,r){var i,l="moatCompanionDiv_"+e+"x"+t;function a(e){var t=[],i=e.getElementById(l);i&&t.push(i);for(var n=0,r=h.availableResources.length;n<r;n++){var a;if("StaticResource"==h.availableResources[n])for(var o=0,s=h.availableTypes.length;o<s;o++){var d=e.getElementById(l+"_"+h.availableResources[n]+"_"+h.availableTypes[o]);d&&t.push(d)}else a=e.getElementById(l+"_"+h.availableResources[n]);a&&t.push(a)}return 0<t.length&&t}function o(e){if(!e||0==e.length)return!1;if(1==e.length)return e[0];for(var t=0,i=e.length;t<i;t++)if(r){if(e[t].id===l+"_"+n+"_"+r)return e[t]}else if(e[t].id===l+"_"+n)return e[t];return!1}try{i=o(a(document))||o(a(window.top.document))}catch(e){}if(i)return i;var s=[];try{for(var d=window.frames,u=0,p=d.length;u<p;u++){try{var c=a(d[u].document)}catch(e){}c&&(s=s.concat(c))}}catch(e){}return(i=o(s))||!1}(o,s,r,e);if(!t)return!1;if("DIV"!==t.nodeName){var i=t;i.id="";var n=S.Util.getParentNode(i);if(!n)return!1;t=document.createElement("div"),S.Util.addTagSafely(t,n)}else t.id="";t.innerHTML=p(t,d,o,s,r,e,l,u)}catch(e){return!1}return!0}var i,n,f,v=t();return v||(setTimeout(function(){!function e(t,i,n,r){r<=n||t()||(n++,setTimeout(function(){e(t,i,n,r)},i))}(t,500,0,10)},500),i=window,n="message",f=function(e){var t,i,n;c||"string"==typeof e.data&&(t=e.data.match(/^zMoatPlaceholder#([0-9]+)x([0-9]+)$/))&&(i=t[1],n=t[2],i==o&&n==s&&(c=function(e){try{var t=p(null,d,o,s,r,a,l,u);e.postMessage("zMoatAdContent#"+t,"*")}catch(e){return!1}return!0}(e.source)))},i.addEventListener?i.addEventListener(n,f,!1):i.attachEvent("on"+n,f)),v},e}function t(){function e(e){this.skipContainer,this.textContainer,this.iconContainer,this.skipIconUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAAKBJREFUOBFjYBgFsBD4////TCBmg/Hx0UB1FUD8CYi7cKoDSoLAMSCWxKkIKgFU8xSkGAh+4VQLkQeTz4CkJU6FQAmg/CuYepzqYAqg9E8gnYZLMVCOZANh5mMNV0oMBBmMEa6UGggyFCVckQ1kwhUuVBcHOQMHoKqXqRYpVE02KBGALWyBQUN0OsQILxwGEpX1sIYXDgNhhUM3NvlhLgYAYuCVi7Jf+AUAAAAASUVORK5CYII=",this.init(e)}return e.prototype.init=function(e){this.createContainer(),this.createTextContainer(),this.createIconContainer(),e.appendChild(this.skipContainer),this.updateButtonTextSubscription=S.Queue.subscribe("skip-button",this.updateButtonText.bind(this)),S.Queue.subscribe("vpaid-events",this.addClickHandler.bind(this)),S.HCP.skipButtonRendered=!0},e.prototype.createContainer=function(){this.skipContainer=document.createElement("div"),this.skipContainer.style.background="rgba(0,0,0,0.8)",this.skipContainer.style.color="#ffffff",this.skipContainer.style.fontSize="11px",this.skipContainer.style.fontFamily="arial,sans-serif",this.skipContainer.style.position="absolute",this.skipContainer.style.textAlign="center",this.skipContainer.style.right="0px",this.skipContainer.style.bottom="10%",this.skipContainer.style.padding="2%",this.skipContainer.style.cursor="default",S.Util.addListener(this.skipContainer,"click",this.stopEventPropagation,"stopEvtPropagationFn")},e.prototype.createTextContainer=function(){this.textContainer=document.createElement("span"),this.textContainer.style.verticalAlign="middle",this.skipContainer.appendChild(this.textContainer)},e.prototype.createIconContainer=function(){this.iconContainer=document.createElement("img"),this.iconContainer.style.display="none",this.iconContainer.style.verticalAlign="middle",this.iconContainer.setAttribute("src",this.skipIconUrl),this.skipContainer.appendChild(this.iconContainer)},e.prototype.updateButtonText=function(e){this.textContainer&&this.iconContainer&&this.skipContainer&&(0<e.timeLeft?this.textContainer.innerHTML="you can skip this ad in "+e.timeLeft:(this.textContainer.innerHTML="Skip Ad",this.textContainer.style.fontSize="18px",this.iconContainer.style.display="inline",this.updateButtonTextSubscription.remove(),this.skipContainer.style.cursor="pointer"))},e.prototype.skipAd=function(){S.underlyingAsset&&S.underlyingAsset.skipAd()},e.prototype.addClickHandler=function(e){e.type===S.VPAIDevents.AdSkippableStateChange&&(S.Util.addListener(this.skipContainer,"click",this.skipAd,"skipClickHandlerFn"),S.Util.removeListener(this.skipContainer,"click",this.stopEventPropagation,"stopEvtPropagationFn"))},e.prototype.stopEventPropagation=function(e){"function"==typeof e.stopPropagation&&e.stopPropagation()},e.prototype.cleanUp=function(){this.updateButtonTextSubscription.remove(),this.skipContainer.parentNode.removeChild(this.skipContainer),this.skipContainer=null,this.textContainer=null,this.iconContainer=null},e}var S={ad:null,version:"2.0",startTime:(new u).getTime(),rand:m.floor(m.random()*m.pow(10,8)),playerProvidedEventCallbacks:{},HCP:{},DispatchedQuartiles:{AdVideoStart:!1,AdVideoFirstQuartile:!1,AdVideoMidpoint:!1,AdVideoThirdQuartile:!1,AdVideoComplete:!1},VPAIDevents:{AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdRemainingTimeChange:"AdRemainingTimeChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",AdProgress:"AdProgress"},VPAIDmethods:{resizeAd:"resizeAd",startAd:"startAd",stopAd:"stopAd",pauseAd:"pauseAd",resumeAd:"resumeAd",expandAd:"expandAd",collapseAd:"collapseAd",skipAd:"skipAd"},AssetTypeMapping:{unknown:"-",asset:"1",vast:"2",vpaid:"3"}},n=function(){var o={safeCallbacks:{},findMoatScript:function(){for(var e=/moatwrapper/,t=document.getElementsByTagName("script"),i=t.length-1;0<=i;i--){var n=t[i];if(e.test(n.src))return n}},parseQS:function(){var e={},t=o.findMoatScript();if(!t)return!1;for(var i=t.src.split("#")[1].split("&"),n=i.length-1;0<=n;n--){var r=i[n].split("=");e[r[0]]=decodeURIComponent(r.slice(1).join("="))}return e.vast&&(e.vast=o.expandCachebuster(e.vast)),e},getScrUrls:function(){var e,t=S&&S.qs,i=[],n=new RegExp(/^scr\d{1,}/);if(!t)return i;for(var r in t)0===r.search(n)&&"string"==typeof(e=t[r])&&i.push(e);return i},getParentNode:function(e){return e.parentNode||e.parentElement||!1},getElementNodeTree:function(e){if(!e)return!1;for(var t="number"==typeof cap?cap:50,i=[e],n=!1,r=0;r<t&&((n=o.getParentNode(e))&&1===n);r++)e=n,i.push(e)},getSafeNode:function(e){if(!e)return!1;if("OBJECT"!==e.nodeName&&"EMBED"!==e.nodeName)return e;for(var t=o.getElementNodeTree(e),i=!1,n=0;n<t.length;n++){var r=t[n];if(r&&"OBJECT"!==r.nodeName&&"EMBED"!==r.nodeName){i=r;break}}return i},hasChildNodes:function(e){return e&&e.childNodes&&0<e.childNodes.length},addTagSafely:function(e,t){if(!e||!t)return!1;var i=o.getSafeNode(t);if(!i)return!1;if(o.hasChildNodes(i)){var n=i.childNodes[m.max(0,i.childNodes.length-1)]||null;i.insertBefore(e,n)}else i.appendChild(e);return i},addScriptToDOM:function(e,t,i){if("string"!=typeof e||!t||!document)return!1;var n=i||document.createElement("script");n.type="text/javascript";var r=o.addTagSafely(n,t);return!!r&&(n.src=e,r)},isANumber:function(e){return"number"==typeof e&&!isNaN(e)},expandCachebuster:function(e){return e.replace("[MOAT_CB]",""+(new u).getTime())},createXMLcompanionNode:function(e){if(!e||0===e.length)return"";for(var t,i,n,r,a,o,s,d,l=document.implementation.createDocument(null,"CompanionAds",null),u=e.length-1;0<=u;u--){if(t=e[u],(i=l.createElementNS("","Companion")).setAttributeNS("","width",t.width),i.setAttributeNS("","height",t.height),(n=l.createElementNS("","StaticResource")).setAttributeNS("","type",t.type),n.appendChild(l.createCDATASection(t.staticResource)),i.appendChild(n),t.companionClickThroughURLTemplate&&((r=l.createElementNS("","CompanionClickThrough")).appendChild(l.createCDATASection(t.companionClickThroughURLTemplate)),i.appendChild(r)),t.trackingEvents&&t.trackingEvents.creativeView){a=l.createElementNS("","TrackingEvents");for(var p=(o=t.trackingEvents.creativeView).length-1;0<=p;p--)s=o[p],(d=l.createElementNS("","Tracking")).setAttributeNS("","event","creativeView"),d.appendChild(l.createCDATASection(s)),a.appendChild(d);i.appendChild(a)}l.documentElement.appendChild(i)}return(new XMLSerializer).serializeToString(l)},emptyObj:{},isArray:function(e){try{return"[object Array]"===o.emptyObj.toString.call(e)}catch(e){return!1}},indexOf:function(e,t){if(!e)return-1;if(o.isArray(e)){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}return"string"==typeof e&&(t||"string"!=typeof t)?e.indexOf(t):-1},arrayContains:function(e,t){return-1!==o.indexOf(e,t)},isFunction:function(e){try{return"[object Function]"===o.emptyObj.toString.call(e)}catch(e){return!1}},isEmptyObject:function(e){try{for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}catch(e){return!1}},isNumber:function(e){try{return"[object Number]"===o.emptyObj.toString.call(e)}catch(e){return!1}},getQueryString:function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=i+"="+encodeURIComponent(n);t.push(r)}return t.join("&")}};return o.getHash=function(e,t){var i=new u;return function(e){var t=0;if(e.length<1)return t;for(var i=0;i<e.length;i++){t=(t<<5)-t+e.charCodeAt(i),t&=t}return m.abs(t)}(e+=t+[i.getFullYear(),("0"+(i.getMonth()+1)).slice(-2),("0"+i.getDate()).slice(-2)].join("-"))},o.timeouts=[],o.loops={},o.fireError=function(e,t){var i,n,r,a;try{i=S.qs.level1+"%3A"+S.qs.level2+"%3A"+S.qs.level3+"%3A"+S.qs.level4}catch(e){i="data%3Adata%3Adata%3Adata"}try{n=(n=S.qs.vast||S.qs.asset).replace(/gdpr_consent=[^&]*&?/i,"")}catch(e){n="-"}try{r=S.moatTag?S.moatTag.pcode:S.PARTNER_CODE}catch(e){r="-"}try{a=S.AssetTypeMapping[S.underlyingTagType]}catch(e){a=S.AssetTypeMapping.unknown}var o="//px.moatads.com/pixel.gif?e=24&d="+i+"&i="+encodeURIComponent("SMILEWANTED1")+"&rp=1&gw="+r+"&ac=1&k="+encodeURIComponent(e)+"&ar="+encodeURIComponent("3955ada-clean")+"&iw="+encodeURIComponent("bbe4201")+"&j="+encodeURIComponent(document.referrer)+"&zMoatVast="+encodeURIComponent(n)+"&dMoatUTT="+a+"&dMoatIT="+!!t+"&cs="+(new u).getTime(),s=new Image;t&&(s.onload=function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdError,args:[e]})}),s.src=o},o.makeSafe=function(e,i,n){var r=!1;return function(){try{return i?n?e.apply(n,arguments):e.apply(this,arguments):e.apply(null,arguments)}catch(e){if(!r){S.HCP.hadMSE=!0;var t=e.name+" in makeSafe: "+e.message+", stack="+e.stack;r=!0,S.Util.fireError(t,!0)}}}},o.setSafeTimeout=function(e,t){var i;return e=o.makeSafe(e),window&&window.setTimeout&&(i=window.setTimeout(e,t),o.timeouts.push(i)),i},o.setSafeLoop=function(e,t,i){if(o.isFunction(e)&&o.isArray(t)&&o.isNumber(i)){var n=(new u).getTime()+"";o.loops[n]&&window.clearTimeout(o.loops[n].tid),o.loops[n]={},o.loops[n].callback=o.makeSafe(e,t),o.loops[n].interval=i,o.loops[n].tid=o.setSafeTimeout(o.runLoop(n),i),n=i=t=e=null}},o.runLoop=function(t){return function(){if(!o.loops||!o.loops[t])return!1;var e=o.loops[t].callback.call(null);if("boolean"==typeof e&&!1===e)return window.clearTimeout(o.loops[t].tid),o.loops[t]=!1;o.loops[t].tid=o.setSafeTimeout(o.runLoop(t),o.loops[t].interval),t=e=null}},o.objectToQueryString=function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=i+"="+encodeURIComponent(n);t.push(r)}return t.join("&")},o.addListener=function(e,t,i,n){var r,a=this.makeSafe(i);if(r=e.addEventListener?{name:"addEventListener",evtPrefix:""}:{name:"attachEvent",evtPrefix:"on"},e&&r.name&&e[r.name])try{e[r.name](r.evtPrefix+t,a,!1)}catch(e){}!1!==n&&(o.safeCallbacks[t+n]=a)},o.removeListener=function(e,t,i,n){var r,a=t+n;if(!e)return delete o.safeCallbacks[a],!1;try{e.removeEventListener;e.detachEvent}catch(e){return delete o.safeCallbacks[a],!1}i=!1!==n?o.safeCallbacks[a]:i,r=e.removeEventListener?{name:"removeEventListener",evtPrefix:""}:{name:"detachEvent",evtPrefix:"on"};try{e[r.name](r.evtPrefix+t,i,!1)}catch(e){}delete o.safeCallbacks[a]},o.getVastUrl=function(){var t;try{t=(t=S.qs.vast||S.qs.asset).replace(/gdpr_consent=[^&]*&?/i,"")}catch(e){t="-"}return t},o.sendHealthCheckPixel=function(e,t){var i;if((i=t)&&S.Util.arrayContains(["WrapperFound","AdStarted","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdStopped","AdSkipped"],i))if(S.DispatchedQuartiles.hasOwnProperty(t))!1===S.DispatchedQuartiles[t]&&(S.DispatchedQuartiles[t]=!0);else{var n="VPAID_HC",r={},a=encodeURIComponent(e.pcode)||"-",o=S.Util.getVastUrl(),s={WrapperFound:17,AdStarted:0,AdVideoStart:29,AdVideoFirstQuartile:29,AdVideoMidpoint:29,AdVideoThirdQuartile:29,AdVideoComplete:29,AdStopped:28,AdSkipped:33}[t];r.e=s,r.i=n,r.dMoatWVH=encodeURIComponent("SMILEWANTED1")+"_WRAPPER",r.gw=a,r.d="data:data:data:data",r.de=S.rand,r.t=S.startTime,r.ac=1,r.bq=8,r.ar="3955ada-clean",r.iw="bbe4201",r.j=encodeURIComponent(document.referrer),r.ah=(new u).getTime()-S.startTime,S.HCP.moatVideoLoaded&&(r.wvl=1),S.DispatchedQuartiles.AdVideoStart&&(r.wrf=1),S.DispatchedQuartiles.AdVideoFirstQuartile&&(r.wrg=1),S.DispatchedQuartiles.AdVideoMidpoint&&(r.wrh=1),S.DispatchedQuartiles.AdVideoThirdQuartile&&(r.wri=1),S.DispatchedQuartiles.AdVideoComplete&&(r.wrj=1),r.dMoatVAST=o,S.underlyingTagType?r.dMoatUTT=S.AssetTypeMapping[S.underlyingTagType]:r.dMoatUTT=S.AssetTypeMapping.unknown,S.HCP.adIconAvailable&&(r.dMoatIconAvailable=1),S.HCP.adIconRendered&&(r.dMoatIconRendered=1),S.HCP.skipButtonAvailable&&(r.dMoatSkipButtonAvailable=1),S.HCP.skipButtonRendered&&(r.dMoatSkipButtonRendered=1),S.HCP.companionAdAvailable&&(r.dMoatCompanionAdAvailable=1),S.HCP.companionAdRendered&&(r.dMoatCompanionAdRendered=1),S.HCP.hadMSE&&(r.dMoatHadMSE=1);var d=this.getQueryString(r),l="//px.moatads.com/pixel.gif?"+(d=d.replace(/\x27/g,"%27"))+"&na="+this.getHash(d,n)+"&cs=0";if(0)(new Image).src=l}},o.getDocAndWinOfEl=function(e){var t,i;try{i=(t=e.ownerDocument)&&(t.defaultView||t.parentWindow)}catch(e){}return{elDoc:t,elWin:i}},o.isPromise=function(e){return!!e&&"function"==typeof e.then&&"function"==typeof e.catch},o.isANumber=function(e){return"number"==typeof e&&!isNaN(e)},o},r=function(){S.Queue.subscribe("vpaid-events",function(e){var t=e.type,i=e.args;if(S.playerProvidedEventCallbacks[t])for(var n=S.playerProvidedEventCallbacks[t],r=n.length-1;0<=r;r--){var a=n[r],o=a.fn,s=a.listenerScope;s=s||null;try{o.apply(s,i)}catch(e){}}})},a=function(){function e(e,t){(S.moatTag=this).pcode=e,this.ids=t,this.moatapi,this.eventBuffer=[],this.init()}return e.prototype.init=function(){var a=this;S.Util.sendHealthCheckPixel(a.ids,"WrapperFound"),S.Queue.subscribe("moat-tag",function(e){a.initMoatTracking(e.videoElement,e.duration)}),S.Queue.subscribe("vpaid-events",function(e){var t;t=e.type!==S.VPAIDevents.AdError?S.ad.getAdVolume():-1;var i={type:e.type,adVolume:t};if(e.type===S.VPAIDevents.AdDurationChange&&(i.duration=e.args[0],i.confirmed=!0),"moat_DURATION_DEBUG"===e.type){if(!e.args||e.length<2)return;i[e.args[0]]=e.args[1]}if(a.moatapi&&"function"==typeof a.moatapi.dispatchEvent){if(a.eventBuffer&&0<a.eventBuffer.length)for(var n=a.eventBuffer.length-1;0<=n;n--){var r=a.eventBuffer[n];a.moatapi.dispatchEvent(r)}a.eventBuffer=!1,a.moatapi.dispatchEvent(i)}else a.eventBuffer&&a.eventBuffer.push(i);S.Util.sendHealthCheckPixel(a.ids,i.type)}),S.Queue.subscribe("moatapi-events",function(e){a.moatapi&&a.moatapi.adData&&a.moatapi.adData.ids&&!a.moatapi.adData.ids[e.property]?a.moatapi.adData.ids[e.property]=e.value:a.ids&&!a.ids[e.property]&&(a.ids[e.property]=e.value)}),S.Queue.subscribe("moatvideo-events",function(e){e.type&&"AdClicked"===e.type&&S.underlyingAsset&&S.underlyingAsset.onAdClickHandler&&S.underlyingAsset.onAdClickHandler()})},e.prototype.initMoatTracking=function(e,t){var i=document.createElement("script"),n=[],r={vidIntType:"2",vidIntVersion:"6.1",adData:{ids:this.ids,duration:t},dispatchEvent:function(e){this.sendEvent?(n&&(n.push(e),e=n,n=!1),this.sendEvent(e)):n&&n.push(e)},publishToWrapper:function(e){S.Queue.publish("moatvideo-events",e)}},a="_moatApi"+m.floor(1e8*m.random()),o=S.Util.getDocAndWinOfEl(e),s=(o.elDoc,o.elWin);if(!s)return!1;this.moatapi=s[a]=r,i.type="text/javascript",e&&e.insertBefore(i,e.childNodes[0]||null);var d="#"+a;i.src="https://z.moatads.com/"+this.pcode+"/moatvideo.js"+d},e},o=function(){function e(){this._width,this._height,this._viewMode,this._desiredBitrate,this._creativeData,this._environmentVars,this._slot,this._videoSlot,this._domElToTrack,this._hasIcons=!1,this._adStopped}return e.prototype={initAd:S.Util.makeSafe(function(e,t,i,n,r,a){if(this._width=e,this._height=t,this._viewMode=i||"normal",this._desiredBitrate=n,this._creativeData=r,this._environmentVars=a,this._slot=a.slot,this._videoSlot=a.videoSlot,"string"==typeof this._videoSlot.nodeName&&"number"==typeof this._videoSlot.nodeType?this._domElToTrack=this._videoSlot:this._domElToTrack=this._slot,S&&S.moatTag&&S.moatTag.ids&&this._domElToTrack){t="number"==typeof this._domElToTrack.offsetHeight?this._domElToTrack.offsetHeight:"-",e="number"==typeof this._domElToTrack.offsetWidth?this._domElToTrack.offsetHeight:"-";S.moatTag.ids.origSize=e+"x"+t}if(this._domElToTrack&&this._domElToTrack.parentNode&&this._domElToTrack.parentNode.id&&"fw-pdk-plugin-video-display-base"==this._domElToTrack.parentNode.id){var o=this._domElToTrack.offsetHeight,s=this._domElToTrack.offsetWidth;("number"==typeof o&&!isNaN(o)&&0==o||"number"==typeof s&&!isNaN(s)&&0==s)&&this._height&&this._width&&this._domElToTrack.style&&(this._domElToTrack.style.height=this._height+"px",this._domElToTrack.style.width=this._width+"px")}S.qs.vast,S.qs.asset;if(S.qs.vast)S.VastLoader=p(),(new S.VastLoader).request(S.qs.vast),S.underlyingTagType="vast";else if(S.qs.asset){S.VideoPlayer=w();var d=new S.VideoPlayer;S.underlyingAsset=d;var l=[{fileURL:S.qs.asset,mimeType:"video/mp4",height:this._height,width:this._width,bitrate:this._desiredBitrate}];S.underlyingTagType="asset",d.init(l,!1,S.qs.clickTag,!1)}else S.Util.fireError("Problem retrieving video file from underlying tag/asset",!0)},!0),collapseAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.collapseAd()},!0),constructor:S.Util.makeSafe(constructor,!0),expandAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.expandAd()},!0),getAdCompanions:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdCompanions()},!0),getAdDuration:S.Util.makeSafe(function(){return S.underlyingAsset?S.underlyingAsset.getAdDuration():-2},!0),getAdExpanded:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdExpanded()},!0),getAdHeight:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdHeight()},!0),getAdIcons:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdIcons()||S.ad._hasIcons},!0),getAdLinear:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdLinear()},!0),getAdRemainingTime:S.Util.makeSafe(function(){return S.underlyingAsset?S.underlyingAsset.getAdRemainingTime():-2},!0),getAdSkippableState:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdSkippableState()},!0),getAdVolume:S.Util.makeSafe(function(){return S.underlyingAsset?S.underlyingAsset.getAdVolume():1},!0),getAdWidth:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdWidth()},!0),handshakeVersion:S.Util.makeSafe(function(e){return S.version},!0),pauseAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.pauseAd()},!0),resizeAd:S.Util.makeSafe(function(e,t,i){S.underlyingAsset&&S.underlyingAsset.resizeAd(e,t,i)},!0),resumeAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.resumeAd()},!0),setAdVolume:S.Util.makeSafe(function(e){!1===isNaN(e)&0<=e&&e<=1&&S.underlyingAsset&&S.underlyingAsset.setAdVolume(e)},!0),skipAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.skipAd()},!0),startAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.startAd()},!0),stopAd:S.Util.makeSafe(function(){!0!==this._adStopped&&S.underlyingAsset&&(S.underlyingAsset.stopAd(),this._adStopped=!0)},!0),subscribe:S.Util.makeSafe(function(e,t,i){var n=S.playerProvidedEventCallbacks;n[t]?n[t].push({fn:e,listenerScope:i}):n[t]=[{fn:e,listenerScope:i}]},!0),unsubscribe:S.Util.makeSafe(function(e,t){var i=S.playerProvidedEventCallbacks[t];if(i&&i.length)for(var n=i.length-1;0<=n;n--){e===i[n].fn&&i.splice(n,1)}},!0)},e},s=function(){var a={"vpaid-events":[],"moat-tag":[],"internal-events":[],"skip-button":[],"moatapi-events":[],"brandsafety::ready":[],"moatvideo-events":[],"wrapper-to-moatvideo-events":[]};return{subscribe:function(e,t){if(a[e]){var i=a[e].push(t)-1;return{remove:function(){delete a[e][i]}}}},publish:function(e,t){if(a[e])for(var i=a[e],n=i.length-1;0<=n;n--){var r=i[n];"function"==typeof r&&r.call(null,t)}}}},d=(e.prototype.init=function(){if(this.icons&&this.icons.length){for(var e=0;e<this.icons.length;e++)this.createIcon(this.icons[e]);this.iconsCreated=!0,S.ad._hasIcons=!0}},e.prototype.createIconContainer=function(e){var t=document.createElement("DIV");return t.id="icon"+e.program,t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.position="absolute",t.style.left="number"==typeof e.xPosition?e.xPosition+"px":this.calculateLeft(e.xPosition,e.width),t.style.top="number"==typeof e.yPosition?e.yPosition+"px":this.calculateTop(e.yPosition,e.height),t.style.zIndex="2147483647",t},e.prototype.createIconAnchor=function(e){var t=document.createElement("A");return t.href=e,t.target="_blank",t},e.prototype.createIconLogo=function(e){var t=document.createElement("IMG");return t.src=e,t.border="0px",t.style.width="100%",t.style.height="100%",t},e.prototype.createIcon=function(e){if(S.Util.isANumber(e.width)&&S.Util.isANumber(e.height)&&e.staticResource){var t=this.createIconContainer(e),i=this.createIconLogo(e.staticResource);if(e.iconClickThroughURLTemplate){var n=this.createIconAnchor(e.iconClickThroughURLTemplate);n.appendChild(i),t.appendChild(n)}else t.appendChild(i);"VIDEO"===this.playerEl.nodeName?this.playerEl.parentNode&&"function"==typeof this.playerEl.parentNode.insertBefore&&this.playerEl.parentNode.insertBefore(t,this.playerEl.nextSibling):this.playerEl.appendChild(t),S.Util.addListener(t,"click",l,"iconClickListener"+this.iconNodes.length),this.iconNodes.push(t),S.HCP.adIconRendered=!0}},e.prototype.calculateLeft=function(e,t){if("string"==typeof e&&"left"===e.toLowerCase())return"0px";var i=this.playerEl.offsetWidth||this.playerEl.clientWidth||0;return Number(i)-Number(t)+"px"},e.prototype.calculateTop=function(e,t){if("string"==typeof e&&"top"===e.toLowerCase())return"0px";var i=this.playerEl.offsetHeight||this.playerEl.clientHeight||0;return Number(i)-Number(t)+"px"},e.prototype.adjustIconPostionOnResize=function(){if(null!==this.iconNodes&&0!==this.iconNodes.length)for(var e=0;e<this.iconNodes.length;e++){var t=this.iconNodes[e];"0px"!==t.style.left&&(t.style.left=this.calculateLeft(null,t.style.width.slice(0,-2))),"0px"!==t.style.top&&(t.style.top=this.calculateTop(null,t.style.height.slice(0,-2)))}},e.prototype.vpaidEventSubscription=function(e){switch(e.type){case S.VPAIDevents.AdVideoStart:this.iconsCreated||this.init();break;case S.VPAIDevents.AdSizeChange:this.iconsCreated&&this.adjustIconPostionOnResize();break;case S.VPAIDevents.AdVideoComplete:case S.VPAIDevents.AdStopped:case S.VPAIDevents.AdSkipped:case S.VPAIDevents.AdError:this.cleanUpCalled||this.cleanUp();break;default:break}},e.prototype.cleanUp=function(){this.subscription.remove();for(var e=0;e<this.iconNodes.length;e++){var t=this.iconNodes[e];S.Util.removeListener(t,"click",l,"iconClickListener"+e);var i=t.parentNode;i&&i.removeChild&&i.removeChild(t)}this.playerEl=null,this.icons=null,this.iconNodes=null,this.cleanUpCalled=!0,S.ad._icons=!1},e);function e(e,t){this.iconNodes=[],this.icons=e,this.playerEl=t,this.iconsCreated=!1,this.cleanUpCalled=!1,this.subscription=S.Queue.subscribe("vpaid-events",this.vpaidEventSubscription.bind(this))}function l(e){return e.stopPropagation(),!1}var U=function(){var g={AdSkipped:"skip",AdStarted:"creativeView",AdVideoStart:"start",AdVideoFirstQuartile:"firstQuartile",AdVideoMidpoint:"midpoint",AdVideoThirdQuartile:"thirdQuartile",AdVideoComplete:"complete",AdUserAcceptInvitation:"acceptInvitation",AdUserMinimize:"collapse",AdUserClose:"close",AdPaused:"pause",AdPlaying:"resume",AdError:"error",AdProgress:"progress"};function A(e,t){return t&&e&&e[t]?e[t]:[]}return ProgressEventDetails=function(e,t,i){this.urls=e,this.format=t,this.value=i},(U=function(e,t,i,n,r,a){this.trackingEvents=e,this.impressionURLs=t,this.scrURLS=S.Util.getScrUrls(),this.errorURLs=i,this.clicktrackingURLs=n,this.customTrackingEvents=a,this.lastVolume=!1,this.surveys=r,this.init()}).prototype.init=function(){var m=this;m.progressEvents=function(e){var t={},i=/progress-([0-9]+)/;for(var n in e)if(-1<S.Util.indexOf(n,"progress")){var r=n.match(i);if(!r||r.length<2)continue;var a=e[n],o=r[1];-1<S.Util.indexOf(n,"%")?t[n]=new ProgressEventDetails(a,"percentage",parseFloat(o/100)):t[n]=new ProgressEventDetails(a,"number",parseFloat(o))}return t}(this.trackingEvents),S.Queue.subscribe("internal-events",function(e){m.lastVolume=e.volume}),S.Queue.subscribe("vpaid-events",function(e){var t,i,n=!1;switch(e.type){case S.VPAIDevents.AdImpression:m.handleSurveys(),t=m.impressionURLs,n=!0;break;case S.VPAIDevents.AdVolumeChange:var r,a=S.underlyingAsset&&S.underlyingAsset.getAdVolume();"number"==typeof m.lastVolume&&"number"==typeof a&&(0===a&&0<m.lastVolume?r="mute":0<a&&0===m.lastVolume&&(r="unmute")),m.lastVolume=a,r&&(t=m.trackingEvents[r]);break;case S.VPAIDevents.AdClickThru:t=m.clicktrackingURLs;break;case S.VPAIDevents.AdError:t=m.errorURLs;break;case S.VPAIDevents.AdProgress:var o=[];for(var s in m.progressEvents){var d=m.progressEvents[s],l=e.time;if("percentage"==d.format){var u=-2!=S.underlyingAsset.getAdDuration(),p=d.value*S.underlyingAsset.getAdDuration();u&&p<l&&(o=o.concat(d.urls),delete m.progressEvents[s])}else l>d.value&&(o=o.concat(d.urls),delete m.progressEvents[s])}t=o;break;default:var c=g[e.type];t=A(m.trackingEvents,c).concat(A(m.customTrackingEvents,c));break}if(t)for(var h=t.length-1;0<=h;h--)if("string"==typeof(i=t[h]))try{(new Image).src=i}catch(e){}if(n)for(var f=m.scrURLS,v=f.length-1;0<=v;v--)S.Util.addScriptToDOM(f[v],S.ad._domElToTrack)})},U.prototype.handleSurveys=function(){if(this.surveys&&S.ad._domElToTrack)for(var e,t,i,n=S.ad._domElToTrack,r=this.surveys,a=!1,o=0;o<r.length;o++)if("js"===u(i=r[o])){if(!a){var s=S.Util.getDocAndWinOfEl(n);e=s.elDoc,t=s.elWin,a=!0}if(!t)continue;var d=e.createElement("script");d.src=i.url,d.type="text/javascript";var l=S.Util.getParentNode(n)||n;l.insertBefore(d,l.childNodes[0]||null)}else(new Image).src=i.url;function u(e){var t="";if(e.type){var i=e.type.split("/");t="javascript"===i[i.length-1]?"js":"pixel"}else{var n=e.url.match(/([^/&?#]+)(?:$|#|\?)/i),r=n&&2===n.length&&n[1],a=r&&r.split(".");t=a&&a[a.length-1]}return"js"===t?"js":"pixel"}},U},p=function(){function e(){}function b(e,t){var i;for(var n in t)"id"===n.toLowerCase()?e.creativeId=t[n]:"adid"===n.toLowerCase()&&(i=t[n]);e.creativeId?i&&(e.creativeAdId=i):i&&(e.creativeId=i),e.creativeId&&S.Queue.publish("moatapi-events",{property:"zMoatCreativeId",value:e.creativeId}),e.creativeAdId&&S.Queue.publish("moatapi-events",{property:"zMoatCreativeAdId",value:e.creativeAdId})}return e.prototype.request=function(e){var t=this,i=!1;e&&e.match("ad.doubleclick.net")&&(i=!0),DMVAST.client.get(e,{withCredentials:i},S.Util.makeSafe(function(e){e?t.extractStuff(e):S.Util.fireError("no VAST tag response",!0)}))},e.prototype.extractStuff=function(e){var t=["progressive"];if(e&&e.ads&&0!==e.ads.length){var i={linearCreatives:[],companions:[]},n=e.ads[0];n.id&&"null"!==n.id&&S.Queue.publish("moatapi-events",{property:"zMoatAdId",value:n.id});var r=n&&n.creatives&&n.creatives[0]&&n.creatives[0].videoClickThroughURLTemplate;r&&S.Queue.publish("moatapi-events",{property:"zMoatClickThrough",value:r});for(var a=n.creatives,o=0;o<a.length;o++){var s=a[o];switch(s.type){case"linear":for(var d={duration:s.duration,adParameters:s.adParameters,trackingEvents:s.trackingEvents,clickthroughURL:s.videoClickThroughURLTemplate,clicktrackingURLs:s.videoClickTrackingURLTemplates,vpaid:[],videos:[],skipoffset:s.skipDelay,icons:s.icons},l=s.mediaFiles,u=0;u<l.length;u++){var p=l[u];if(p&&p.fileURL){var c=p.mimeType.toLowerCase(),h=p.deliveryType.toLowerCase();"VPAID"!==p.apiFramework||"application/javascript"!==c&&"application/x-javascript"!==c||!S.Util.arrayContains(t,h)||d.vpaid.push(p),S.Util.arrayContains(t,h)&&d.videos.push(p)}}i.linearCreatives.push(d),n.creativeId||b(n,s.attributes);break;case"companion":for(var f=0;f<s.variations.length;f++)i.companions.push(s.variations[f])}}var v,m=i.linearCreatives.length;if(1===m)v=i.linearCreatives[0];else for(o=0;o<m;o++){var g=i.linearCreatives[o];if(0<g.videos.length||0<g.vpaid.length){v=g;break}}if(v||S.Util.fireError("No suitable assets found",!0),v.customTrackingEvents=function(e){var t=e.extensions,a={};function o(e){if(void 0!==e.children&&0!==e.children.length)for(var t=e.children,i=0;i<t.length;i++){if("Tracking"===t[i].name){var n=t[i].attributes.event,r=t[i].value;a[n]=[r]}o(t[i])}}for(var i in t)o(t[i]);return a}(n),S.TrackerManager=U(),new S.TrackerManager(v.trackingEvents,n.impressionURLTemplates,n.errorURLTemplates,v.clicktrackingURLs,n.surveys,v.customTrackingEvents),0<i.companions.length){S.HCP.companionAdAvailable=!0,S.CompanionLoader=E();for(var A=new S.CompanionLoader,y=0;y<i.companions.length;y++){var _,k,C=i.companions[y];C.htmlResource?(_="HTMLResource",k=C.htmlResource):C.iframeResource?(_="IFrameResource",k=C.iframeResource):C.staticResource&&(_="StaticResource",k=C.staticResource),A.loadCompanion(_,C.type,C.width,C.height,k,!1,C.companionClickThroughURLTemplate,C.trackingEvents.creativeView)}}if(0<v.vpaid.length)return S.underlyingTagType="vpaid",S.VpaidPlayer=V(),void(T=new S.VpaidPlayer).init(v.vpaid[0],v.adParameters,v.duration,i.companions,v.icons,v.clickthroughURL);if(0<v.videos.length){S.Queue.publish("vpaid-events",{type:"moat_DURATION_DEBUG",args:["mediafile","video"]}),S.Queue.publish("vpaid-events",{type:"moat_DURATION_DEBUG",args:["vast-duration",v.duration]}),S.VideoPlayer=w();var T=new S.VideoPlayer;(S.underlyingAsset=T).init(v.videos,v.duration,v.clickthroughURL,i.companions,v.skipoffset,v.icons)}else S.Util.fireError("No suitable assets found",!0)}else S.Util.fireError("problem parsing underlying VAST, missing <ad> nodes")},e},w=function(){function e(){this._videoEl,this._adIsStarted,this._firstQuartileTime,this._firstQuartileReached,this._midpointTime,this._midpointReached,this._thirdQuartileTime,this._thirdQuartileReached,this._videoIsCompleted,this._lastViewMode,this._originalSlotCursorStyle,this._originalVideoSlotCursorStyle,this._pauseAdOnClickThru=!0,this._clickthroughURL,this._lastClickTime,this._skipoffset,this._cleanupCalled,this._durationConfirmed=!1,this._adLinear=!0,this._adWidth=S.ad._width,this._adHeight=S.ad._height,this._adExpanded=!1,this._adSkippableState=!1,this._adRemainingTime=-2,this._adDuration=-2,this._adVolume=1,this._adCompanions="",this._adIcons=!1,this._skipButtonModule=t(),this._skipButtonManager,this._icons,this._iconManager}function a(e){return"string"==typeof e.message&&""!==e.message?e.message:e.target&&e.target.error&&"string"==typeof e.target.error.message?""===e.target.error.message?"unknown error triggered by player":e.target.error.message:"unknown error triggered by player"}return e.prototype.init=function(e,t,i,n,r,a){this._videoEl=S.ad._videoSlot,this._adDuration=this._adRemainingTime=t,this._mediaFile=this.pickMediaFile(e);this._skipoffset=function(){var e=r;if(S.Util.isANumber(e))return e;var t=parseInt(S.qs.skip,10);if(S.Util.isANumber(t))return t;var i=parseInt(S.qs.zMoatSkip,10);return S.Util.isANumber(i)?i:null}();var o=S&&S.ad&&S.ad._slot,s=S&&S.ad&&S.ad._videoSlot;o&&o.style&&(this._originalSlotCursorStyle=o.style.cursor,o.style.cursor="pointer"),s&&s.style&&(this._originalVideoSlotCursorStyle=s.style.cursor,s.style.cursor="pointer"),void 0!==this._videoEl.volume&&"number"==typeof this._videoEl.volume&&(this._adVolume=this._videoEl.volume),S.Queue.publish("internal-events",{volume:this._adVolume}),this._clickthroughURL=i,this._lastViewMode=S.ad._viewMode,this._adCompanions=S.Util.createXMLcompanionNode(n),this._icons=a,this.onAdClickHandler=this.onAdClick.bind(this),this.onErrorHandler=this.videoErrorHandlerFn,this.createListeners(),"1"===S.qs.noctp&&(this._pauseAdOnClickThru=!1),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdLoaded}),this._adDuration&&(this.determineQuartiles(),S.Queue.publish("moat-tag",{videoElement:S.ad._domElToTrack,duration:this._adDuration}))},e.prototype.resizeAd=function(e,t,i,n){"string"==typeof i&&(i=i.toLowerCase());var r=i&&"fullscreen"===i,a="number"==typeof e&&"number"==typeof t&&!isNaN(e)&&!isNaN(t),o=!r&&a;!r&&!a||o&&!this._videoEl||(o&&(this._adHeight=t,this._adWidth=e,this._videoEl.width=e,this._videoEl.height=t),n&&S.ad._slot&&(S.ad._slot.style.width=e+"px",S.ad._slot.style.height=t+"px"),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdSizeChange}))},e.prototype.playVideoEl=function(e){var t=this._videoEl.play();return S.Util.isPromise(t)?t.then(e).catch(this.onErrorHandler):(e(),null)},e.prototype.playVideoElandFireStartEvents=function(){var e=this._videoEl,t=!1,i=!1;function n(){this._adIsStarted||(this._adIsStarted=!0,this._adTimeFrequency=0,this.timer(),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdStarted}),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdImpression}),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoStart}))}function r(){i&&t&&(S.Util.removeListener(e,"playing",a,"videoPlayingHandlerFn"),n())}function a(){t=!0,r()}n=n.bind(this),S.Util.addListener(e,"playing",a,"videoPlayingHandlerFn"),this.playVideoEl(function(){i=!0,r()})},e.prototype.startAd=function(){if(!this._adIsStarted){if(this.setVideoElSrc(this._mediaFile),S.ad&&S.ad._slot){var e="function"==typeof window.getComputedStyle&&window.getComputedStyle(S.ad._slot)||S.ad._slot.style||S.ad._slot.currentStyle;e&&S.ad._width&&S.ad._height&&("0px"==e.width&&0<S.ad._width||"0px"==e.height&&0<S.ad._height)&&this.resizeAd(S.ad._width,S.ad._height,S.ad._viewMode||"normal",!0)}S.Util.isANumber(this._skipoffset)?(this._skipButtonManager=new this._skipButtonModule(S.ad._slot),S.HCP.skipButtonAvailable=!0):this._skipButtonManager=null,this._videoEl.load(),this.playVideoElandFireStartEvents(),this._icons&&this._icons.length&&(this._iconManager=new d(this._icons,S.ad._domElToTrack),this._adIcons=!0,S.HCP.adIconAvailable=!0)}},e.prototype.stopAd=function(){this.cleanUp(),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdStopped})},e.prototype.pauseAd=function(){this._videoEl.paused||(this._videoEl.pause(),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdPaused}))},e.prototype.resumeAd=function(){this.playVideoEl(function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdPlaying})})},e.prototype.skipAd=function(){this.cleanUp(),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdSkipped});S.Util.setSafeTimeout(function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdStopped})},400)},e.prototype.getAdLinear=function(){return this._adLinear},e.prototype.getAdCompanions=function(){return this._adCompanions},e.prototype.getAdExpanded=function(){return this._adExpanded},e.prototype.getAdHeight=function(){return this._adHeight},e.prototype.getAdWidth=function(){return this._adWidth},e.prototype.getAdVolume=function(){var e=1,t=this._videoEl.volume,i=this._adVolume;return this._videoEl.muted?e=0:"number"!=typeof t||isNaN(t)?"number"!=typeof i||isNaN(i)||(e=i):e=t,e},e.prototype.setAdVolume=function(e){this._adVolume=e,"number"==typeof this._videoEl.volume&&(this._videoEl.volume=e),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVolumeChange})},e.prototype.getAdRemainingTime=function(){return this._adDuration-this._videoEl.currentTime},e.prototype.getAdDuration=function(){return this._adDuration},e.prototype.getAdIcons=function(){return this._adIcons},e.prototype.getAdSkippableState=function(){return this._adSkippableState},e.prototype.setVideoElSrc=function(e){e&&"string"==typeof e.fileURL&&e.fileURL.length?this._videoEl.src=e.fileURL:S.Util.fireError("Invalid mediaFile or mediaFile fileUrl",!0)},e.prototype.pickMediaFile=function(e){for(var n=this._adWidth*this._adHeight,t=function(e){var t={};t.isWebm="video/webm"===e.mimeType?0:1,t.isMp4="video/mp4"===e.mimeType?0:1,t.bitrateRange=e.bitrate<5e3?0:1,t.canPlayType="probably"===this._videoEl.canPlayType(e.mimeType)?0:1;var i=e.width*e.height;return t.sizeDiff=m.abs(n-i),t.bitrate=e.bitrate,t.mediaFile=e,t}.bind(this),i=[],r=0;r<e.length;r++){var a=e[r];if(""!==this._videoEl.canPlayType(a.mimeType)){var o=t(a);i.push(o)}}return 0===i.length&&S.Util.fireError("There are no valid mediaFiles in underlying VAST tag",!0),i.sort(function(e,t){var i=e.isWebm-t.isWebm;if(0!=i)return i;var n=e.isMp4-t.isMp4;if(0!=n)return n;var r=e.bitrateRange-t.bitrateRange;if(0!=r)return r;var a=e.canPlayType-t.canPlayType;if(0!=a)return a;var o=e.sizeDiff-t.sizeDiff;return 0!=o?o:t.bitrate-e.bitrate}),i[0].mediaFile},e.prototype.onAdClick=function(){var e=(new u).getTime();if(!(void 0===this._lastClickTime)){if(e-this._lastClickTime<100)return}this._lastClickTime=e,void 0!==this._adIsStarted?this._videoEl.paused?this.resumeAd():(S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdClickThru,args:[this._clickthroughURL,null,!0]}),this._pauseAdOnClickThru&&this.pauseAd()):this.startAd()},e.prototype.videoErrorHandlerFn=function(e){var t=function(e){var t=a(e);if("unknown error triggered by player"===t)return!1;var i=["request is not allowed by the user agent or the platform in the current context","can only be initiated by a user gesture"];for(var n in i){var r=i[n];if(S.Util.arrayContains(t,r))return!0}return!1}(e)?"Autoplay attempted and is not allowed":a(e);S.Util.fireError(t,!0)},e.prototype.createListeners=function(){S.Util.addListener(S.ad._slot,"click",this.onAdClickHandler,"slotClickHandlerFn"),S.Util.addListener(S.ad._videoSlot,"click",this.onAdClickHandler,"videoSlotClickHandlerFn"),S.Util.addListener(this._videoEl,"error",this.onErrorHandler,"videoErrorHandlerFn")},e.prototype.determineQuartiles=function(){var e=this._adDuration/4;this._firstQuartileTime=0+e,this._midpointTime=this._firstQuartileTime+e,this._thirdQuartileTime=this._midpointTime+e},e.prototype.onConfirmDuration=function(e){if(!this._adDuration&&0!==this._adDuration){if(!S.ad._domElToTrack)return S.Util.fireError("no video element to track",!0),!1;S.Queue.publish("moat-tag",{videoElement:S.ad._domElToTrack,duration:e})}this._adDuration=e,this.determineQuartiles(),this._durationConfirmed=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdDurationChange,args:[e]})},e.prototype.confirmDuration=function(){if(!this._durationConfirmed){var e=this._videoEl&&this._videoEl.duration;"number"==typeof e&&!isNaN(e)&&0<e&&this.onConfirmDuration(m.round(e))}},e.prototype.timer=function(){var e,t=(e=this,function(){e.confirmDuration(),e._adDuration&&e.progressWatcher()});S.Util.setSafeLoop(t,[],500)},e.prototype.progressWatcher=function(){if(this._skipButtonManager&&!this._adSkippableState&&this._videoEl.currentTime>this._skipoffset&&(this._adSkippableState=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdSkippableStateChange})),S.Queue.publish("skip-button",{timeLeft:m.max(m.round(this._skipoffset-this._videoEl.currentTime),0)}),this._adIsStarted&&!this._firstQuartileReached&&this._videoEl.currentTime>this._firstQuartileTime)this._firstQuartileReached=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoFirstQuartile});else if(this._adIsStarted&&this._firstQuartileReached&&!this._midpointReached&&this._videoEl.currentTime>this._midpointTime)this._midpointReached=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoMidpoint});else if(this._adIsStarted&&this._firstQuartileReached&&this._midpointReached&&!this._thirdQuartileReached&&this._videoEl.currentTime>this._thirdQuartileTime)this._thirdQuartileReached=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoThirdQuartile});else if(this._adIsStarted&&this._firstQuartileReached&&this._midpointReached&&this._thirdQuartileReached&&!this._videoIsCompleted&&(this._videoEl.currentTime>=this._adDuration||this._videoEl.ended)){this.cleanUp(),this._videoIsCompleted=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoComplete});S.Util.setSafeTimeout(function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdStopped})},400)}this._adIsStarted&&!this._videoIsCompleted&&S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdProgress,time:this._videoEl.currentTime})},e.prototype.cleanUp=function(){this._cleanupCalled||(this._cleanupCalled=!0,S.Util.removeListener(this._videoEl,"playing",function(){},"videoPlayingHandlerFn"),S.Util.removeListener(S.ad._slot,"click",this.onAdClickHandler,"slotClickHandlerFn"),S.Util.removeListener(S.ad._videoSlot,"click",this.onAdClickHandler,"videoSlotClickHandlerFn"),S.Util.removeListener(this._videoEl,"error",this.onErrorHandler,"videoErrorHandlerFn"),S.ad._slot.style&&(S.ad._slot.style.cursor=this._originalSlotCursorStyle),S.ad._videoSlot.style&&(S.ad._videoSlot.style.cursor=this._originalVideoSlotCursorStyle),this._skipButtonManager&&this._skipButtonManager.cleanUp(),this._adIcons=!1)},e},V=function(){return(V=function(){this._iframe,this._adCompanions,this._lastAdVolume,this._adParameters,this._icons,this._iconManager,this._clickthroughURL}).prototype.init=function(e,t,i,n,r,a){var o=m.random()+"";if(window["moatstartvpaid"+o]=this.startVPAID.bind(this),window["moatstartvpaiderr"+o]=this.handleError.bind(this),e&&e.fileURL&&e.fileURL.match(/^https?:\/\/(s0\.2mdn\.net|imasdk\.googleapis\.com)/)){var s=document.createElement("script");s.type="text/javascript",s.onload=function(){window["moatstartvpaid"+o]()},s.onerror=function(){window["moatstartvpaiderr"+o]()},s.src=e.fileURL,S.Util.addTagSafely(s,document.body)}else{var d=document.createElement("iframe");(this._iframe=d).style.display="none",document.body.appendChild(d);var l='<html><head><body><script>function startVPAID() {window.parent["moatstartvpaid'+o+'"]();};function errVPAID() {window.parent["moatstartvpaiderr'+o+'"]();};<\/script><script onerror="errVPAID();" onload="startVPAID();" src="'+e.fileURL+'"><\/script></body></head></html>';d.contentWindow.moatsrc=l,d.src="javascript:window.moatsrc"}this._adCompanions=n,this._adParameters=t,this._icons=r,this._clickthroughURL=a,S.Queue.publish("moat-tag",{videoElement:S.ad._domElToTrack,duration:i})},V.prototype.handleError=function(){S.Util.fireError("no VPAID response",!0)},V.prototype.wrapGetAdCompanions=function(){var e=this,t=this._vpaid.getAdCompanions;this._vpaid.getAdCompanions=function(){return 0<e._adCompanions.length?S.Util.createXMLcompanionNode(e._adCompanions):t?t.call(e._vpaid):""}},V.prototype.createCallbacks=function(){var e={},t=this;for(var i in S.VPAIDevents){var n=function(){var e=i;return function(){"AdClickThru"===e&&arguments&&!arguments[0]&&(arguments[0]=t._clickthroughURL),S.Queue.publish("vpaid-events",{type:e,args:arguments})}}();e[i]=n}return e},V.prototype.startVPAID=function(){var r,a=this,o=!1,s=0;r=a._iframe?a._iframe.contentWindow:window;S.Util.setSafeLoop(function(){if(20<++s||o)return a.handleError(),!1;var e=r.getVPAIDAd&&"function"==typeof r.getVPAIDAd&&r.getVPAIDAd();if(e){a._vpaid=e,o=!0;e.handshakeVersion(S.version);var t=a.createCallbacks();for(var i in t)e.subscribe(t[i],i);a.wrapGetAdCompanions(),S.underlyingAsset=e;var n={AdParameters:a._adParameters};return e.initAd(S.ad._width,S.ad._height,S.ad._viewMode,S.ad._desiredBitrate,n,S.ad._environmentVars),e.getAdIcons&&e.getAdIcons()||!a._icons||!a._icons.length||(this._iconManager=new d(a._icons,S.ad._domElToTrack),S.HCP.adIconAvailable=!0),function(e){var t;try{t=e.getAdVolume()}catch(e){t=-1}S.Queue.publish("internal-events",{volume:t})}(e),!1}},[],100)},V}}(Date,Math)}catch(e){try{var t=e.name+" in VPAID wrapper global t/c: "+e.message+", stack="+e.stack,i="//px.moatads.com/pixel.gif?e=24&d=data%3Adata%3Adata%3Adata&i="+encodeURIComponent("SMILEWANTED1")+"&rp=1&gw=smilewanted101495534310&ac=1&k="+encodeURIComponent(t)+"&ar="+encodeURIComponent("3955ada-clean")+"&iw="+encodeURIComponent("bbe4201")+"&j="+encodeURIComponent(document.referrer)+"&cs="+(new Date).getTime();(new Image).src=i}catch(e){}}}();


/**
* Copyright (c) 2013 Olivier Poitrey <rs@dailymotion.com>
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*/
 
!function(){try{!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.DMVAST=e()}}(function(){return function r(s,o,a){function l(i,e){if(!o[i]){if(!s[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(h)return h(i,!0);throw new Error("Cannot find module '"+i+"'")}var n=o[i]={exports:{}};s[i][0].call(n.exports,function(e){var t=s[i][1][e];return l(t||e)},n,n.exports,r,s,o,a)}return o[i].exports}for(var h="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}({1:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function l(e){return"object"==typeof e&&null!==e}function h(e){return void 0===e}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,r,s,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(h(i=this._events[e]))return!1;if(a(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,r=new Array(n-1),s=1;s<n;s++)r[s-1]=arguments[s];i.apply(this,r)}else if(l(i)){for(n=arguments.length,r=new Array(n-1),s=1;s<n;s++)r[s-1]=arguments[s];for(n=(o=i.slice()).length,s=0;s<n;s++)o[s].apply(this,r)}return!0},n.prototype.on=n.prototype.addListener=function(e,t){var i;if(!a(t))throw TypeError("listener must be a function");this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?l(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,!l(this._events[e])||this._events[e].warned||(i=h(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace());return this},n.prototype.once=function(e,t){if(!a(t))throw TypeError("listener must be a function");var i=!1;function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var i,n,r,s;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(i=this._events[e]).length,n=-1,i===t||a(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(l(i)){for(s=r;0<s--;)if(i[s]===t||i[s].listener&&i[s].listener===t){n=s;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(a(i=this._events[e]))this.removeListener(e,i);else for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){return e._events&&e._events[t]?a(e._events[t])?1:e._events[t].length:0}},{}],2:[function(e,t,i){var n;n=function(){this.id=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[],this.surveys=[]},t.exports=n},{}],3:[function(e,t,o){var i,a,n,r,s;function l(){}a=e("./parser"),n=e("./util"),l.cappingFreeLunch=0,l.cappingMinimumTimeInterval=0,l.options={withCredentials:!1,timeout:0},l.get=function(e,t,i){var n,r,s;if(r=+new Date,n=o.extend=function(e,t){var i,n;for(i in t)n=t[i],e[i]=n;return e},i||("function"==typeof t&&(i=t),s={}),s=n(this.options,t),this.totalCallsTimeout<r?(this.totalCalls=1,this.totalCallsTimeout=36e5+r):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls)i(null);else{if(!(r-this.lastSuccessfullAd<this.cappingMinimumTimeInterval))return a.parse(e,s,function(e){return i(e)});i(null)}},s=n.storage,r=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(t){r(l,t,{get:function(){return s.getItem(t)},set:function(e){return s.setItem(t,e)},configurable:!1,enumerable:!0})}),null==l.totalCalls&&(l.totalCalls=0),null==l.totalCallsTimeout&&(l.totalCallsTimeout=0),i=l,t.exports=i},{"./parser":12,"./util":19}],4:[function(e,t,i){var n;n=function(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.companionClickThroughURLTemplate=null,this.trackingEvents={}},t.exports=n},{}],5:[function(e,t,i){function n(e,t){for(var i in t)l.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e}var r,s,o,a,l={}.hasOwnProperty;function h(){h.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null,this.icons=[]}function u(){u.__super__.constructor.apply(this,arguments),this.type="nonlinear",this.variations=[],this.videoClickTrackingURLTemplates=[]}function c(){this.type="companion",this.variations=[],this.videoClickTrackingURLTemplates=[]}n(h,r=function(){this.trackingEvents={}}),o=h,n(u,r),a=u,n(c,r),s=c,t.exports={VASTCreativeLinear:o,VASTCreativeNonLinear:a,VASTCreativeCompanion:s}},{}],6:[function(e,t,i){var n;n=function(){this.attributes={},this.children=[]},t.exports=n},{}],7:[function(e,t,i){var n;n=function(e,t){this.name=e,this.value=t,this.attributes={},this.children=[]},t.exports=n},{}],8:[function(e,t,i){var n;n=function(){this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null},t.exports=n},{}],9:[function(e,t,i){t.exports={client:e("./client"),tracker:e("./tracker"),parser:e("./parser"),util:e("./util")}},{"./client":3,"./parser":12,"./tracker":15,"./util":19}],10:[function(e,t,i){var n;n=function(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null},t.exports=n},{}],11:[function(e,t,i){var n;n=function(){this.id=null,this.width=0,this.height=0,this.minSuggestedDuration="00:00:00",this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null},t.exports=n},{}],12:[function(e,t,i){var n,r,v,a,l,E,_,oe,I,ae,le,B,s,m,T,o,h,g=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function u(){}r=e("./urlhandler"),m=e("./response"),v=e("./ad"),a=e("./extension"),l=e("./extensionchild"),o=e("./util"),oe=e("./creative").VASTCreativeLinear,_=e("./creative").VASTCreativeCompanion,I=e("./creative").VASTCreativeNonLinear,le=e("./mediafile"),ae=e("./icon"),E=e("./companionad"),B=e("./nonlinear"),T=e("./survey"),n=e("events").EventEmitter,h=[],u.addURLTemplateFilter=function(e){"function"==typeof e&&h.push(e)},u.removeURLTemplateFilter=function(){return h.pop()},u.countURLTemplateFilters=function(){return h.length},u.clearUrlTemplateFilters=function(){return h=[]},u.parse=function(e,t,i){return i||("function"==typeof t&&(i=t),t={}),this._parse(e,null,t,function(e,t){return i(t)})},u.vent=new n,u.track=function(e,t){return this.vent.emit("VAST-error",t),o.track(e,t)},u.on=function(e,t){return this.vent.on(e,t)},u.once=function(e,t){return this.vent.once(e,t)},u._parse=function(c,p,d,f){var e,t,i,L;for(f||("function"==typeof d&&(f=d),d={}),t=0,i=h.length;t<i;t++)e=h[t],c=e(c);return null==p&&(p=[]),p.push(c),r.get(c,d,(L=this,function(e,t){var r,y,i,n,k,s,o,a,l,h,u;if(null!=e)return f(e);if(k=new m,null==(null!=t?t.documentElement:void 0)||"VAST"!==t.documentElement.nodeName)return f();for(s=0,a=(h=t.documentElement.childNodes).length;s<a;s++)"Error"===(n=h[s]).nodeName&&k.errorURLTemplates.push(L.parseNodeText(n));for(o=0,l=(u=t.documentElement.childNodes).length;o<l;o++)"Ad"===(n=u[o]).nodeName&&(null!=(r=L.parseAdElement(n))?k.ads.push(r):L.track(k.errorURLTemplates,{ERRORCODE:101}));for(y=function(e){var t,i,n;if(null==e&&(e=!1),k){for(t=0,i=(n=k.ads).length;t<i;t++)if(null!=(r=n[t]).nextWrapperURL)return;return 0===k.ads.length&&(e||L.track(k.errorURLTemplates,{ERRORCODE:303}),k=null),f(null,k)}},i=k.ads.length;i--;)null!=(r=k.ads[i]).nextWrapperURL&&function(T){var e,t,i;10<=p.length||(i=T.nextWrapperURL,0<=g.call(p,i))?(L.track(T.errorURLTemplates,{ERRORCODE:302}),k.ads.splice(k.ads.indexOf(T),1),y()):(0===T.nextWrapperURL.indexOf("//")?(t=location.protocol,T.nextWrapperURL=""+t+T.nextWrapperURL):-1===T.nextWrapperURL.indexOf("://")&&(e=c.slice(0,c.lastIndexOf("/")),T.nextWrapperURL=e+"/"+T.nextWrapperURL),L._parse(T.nextWrapperURL,p,d,function(e,t){var i,n,r,s,o,a,l,h,u,c,p,d,f,m,g,v;if(n=!1,null!=e)L.track(T.errorURLTemplates,{ERRORCODE:301}),k.ads.splice(k.ads.indexOf(T),1),n=!0;else if(null==t)L.track(T.errorURLTemplates,{ERRORCODE:303}),k.ads.splice(k.ads.indexOf(T),1),n=!0;else for(k.errorURLTemplates=k.errorURLTemplates.concat(t.errorURLTemplates),s=k.ads.indexOf(T),k.ads.splice(s,1),h=0,u=(m=t.ads).length;h<u;h++){for((a=m[h]).errorURLTemplates=T.errorURLTemplates.concat(a.errorURLTemplates),a.impressionURLTemplates=T.impressionURLTemplates.concat(a.impressionURLTemplates),o=!0,d=0,c=(g=a.creatives).length;d<c;d++){if(i=g[d],null!=T.trackingEvents&&("linear"===i.type||"nonlinear"===i.type))for(f=0,p=(v=Object.keys(T.trackingEvents)).length;f<p;f++)r=v[f],(l=i.trackingEvents)[r]||(l[r]=[]),i.trackingEvents[r]=i.trackingEvents[r].concat(T.trackingEvents[r]);null!=T.videoClickTrackingURLTemplates&&("linear"!==i.type&&"nonlinear"!==i.type||(i.videoClickTrackingURLTemplates=i.videoClickTrackingURLTemplates.concat(T.videoClickTrackingURLTemplates))),T.tempCompanionAd&&"companion"===i.type&&(o=!1)}T.tempCompanionAd&&o&&a.creatives.push(T.tempCompanionAd),k.ads.splice(s,0,a)}return delete T.nextWrapperURL,y(n)}))}(r);return y()}))},u.childByName=function(e,t){var i,n,r,s;for(n=0,r=(s=e.childNodes).length;n<r;n++)if((i=s[n]).nodeName===t)return i},u.childsByName=function(e,t){var i,n,r,s,o;for(n=[],r=0,s=(o=e.childNodes).length;r<s;r++)(i=o[r]).nodeName===t&&n.push(i);return n},u.parseAdElement=function(e){var t,i,n,r,s;for(i=0,n=(r=e.childNodes).length;i<n;i++)if("Wrapper"===(s=(t=r[i]).nodeName)||"InLine"===s){if(t.setAttribute("id",e.getAttribute("id")),"Wrapper"===t.nodeName)return this.parseWrapperElement(t);if("InLine"===t.nodeName)return this.parseInLineElement(t)}},u.parseWrapperElement=function(e){var t,i,n,r,s,o,a;for(t=this.parseInLineElement(e),null!=(r=this.childByName(e,"VASTAdTagURI"))?t.nextWrapperURL=this.parseNodeText(r):null!=(r=this.childByName(e,"VASTAdTagURL"))&&(t.nextWrapperURL=this.parseNodeText(this.childByName(r,"URL"))),s=0,o=(a=t.creatives).length;s<o;s++)n=null,"linear"!==(i=a[s]).type&&"nonlinear"!==i.type||null!=(n=i)&&(null!=n.trackingEvents&&(t.trackingEvents=n.trackingEvents),null!=n.videoClickTrackingURLTemplates&&(t.videoClickTrackingURLTemplates=n.videoClickTrackingURLTemplates)),"companion"===i.type&&(t.tempCompanionAd=i);if(null!=t.nextWrapperURL)return t},u.parseInLineElement=function(e){var t,i,n,r,s,o,a,l,h,u,c,p,d,f,m,g;for((t=new v).id="function"==typeof e.getAttribute&&e.getAttribute("id"),l=0,c=(f=e.childNodes).length;l<c;l++)switch((o=f[l]).nodeName){case"Error":t.errorURLTemplates.push(this.parseNodeText(o));break;case"Impression":t.impressionURLTemplates.push(this.parseNodeText(o));break;case"Survey":(a=new T).type=o.getAttribute("type"),a.url=this.parseNodeText(o),t.surveys.push(a);break;case"Creatives":for(h=0,p=(m=this.childsByName(o,"Creative")).length;h<p;h++)for(r=m[h],i=this.storeNodeAttributes(r),u=0,d=(g=r.childNodes).length;u<d;u++)switch((s=g[u]).nodeName){case"Linear":(n=this.parseCreativeLinearElement(s))&&(n.attributes=i,t.creatives.push(n));break;case"NonLinearAds":(n=this.parseNonLinear(s))&&(n.attributes=i,t.creatives.push(n));break;case"CompanionAds":(n=this.parseCompanionAd(s))&&(n.attributes=i,t.creatives.push(n))}break;case"Extensions":this.parseExtension(t.extensions,this.childsByName(o,"Extension"))}return t},u.parseChildren=function(e,t){var i,n,r,s,o,a;for(a=[],r=0,s=(o=e.childNodes).length;r<s;r++)"#text"!==(i=o[r]).nodeName?((n=new l(i.nodeName,this.parseNodeText(i))).attributes=this.storeNodeAttributes(i),n?(t.children.push(n),null!=i.childNodes?a.push(this.parseChildren(i,n)):a.push(void 0)):a.push(void 0)):a.push(void 0);return a},u.parseExtension=function(e,t){var i,n,r,s,o;for(o=[],r=0,s=t.length;r<s;r++)i=t[r],(n=new a).attributes=this.storeNodeAttributes(i),this.parseChildren(i,n),o.push(e.push(n));return o},u.storeNodeAttributes=function(e){var t,i,n,r,s;if(i={},e.attributes)for(n=0,r=(s=e.attributes).length;n<r;n++)i[(t=s[n]).nodeName]=t.nodeValue;return i},u.parseCreativeLinearElement=function(e){var t,i,n,r,s,o,a,l,h,u,c,p,d,f,m,g,v,T,y,k,L,R,x,N,w,C,A,b,U,E,_,I,B,D,O,S,M,F,P,V,W,q,H,X,j,G,Q,Y,z,J,K,Z,$,ee,te,ie,ne,re,se;if((n=new oe).duration=this.parseDuration(this.parseNodeText(this.childByName(e,"Duration"))),-1===n.duration&&"Wrapper"!==e.parentNode.parentNode.parentNode.nodeName)return null;if(null==(k=e.getAttribute("skipoffset"))?n.skipDelay=null:"%"===k.charAt(k.length-1)?(T=parseInt(k,10),n.skipDelay=n.duration*(T/100)):n.skipDelay=this.parseDuration(k),null!=(w=this.childByName(e,"VideoClicks"))){for(n.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(w,"ClickThrough")),A=0,_=(Y=this.childsByName(w,"ClickTracking")).length;A<_;A++)i=Y[A],n.videoClickTrackingURLTemplates.push(this.parseNodeText(i));for(b=0,I=(z=this.childsByName(w,"CustomClick")).length;b<I;b++)r=z[b],n.videoCustomClickURLTemplates.push(this.parseNodeText(r))}for(null!=(t=this.childByName(e,"AdParameters"))&&(n.adParameters=this.parseNodeText(t)),U=0,D=(K=this.childsByName(e,"TrackingEvents")).length;U<D;U++)for(x=K[U],E=0,O=(Z=this.childsByName(x,"Tracking")).length;E<O;E++)if(s=(R=Z[E]).getAttribute("event"),N=this.parseNodeText(R),null!=s&&null!=N){if("progress"===s){if(!(v=R.getAttribute("offset")))continue;s="%"===v.charAt(v.length-1)?"progress-"+v:"progress-"+Math.round(this.parseDuration(v))}null==(C=n.trackingEvents)[s]&&(C[s]=[]),n.trackingEvents[s].push(N)}for(q=0,S=($=this.childsByName(e,"MediaFiles")).length;q<S;q++)for(g=$[q],H=0,M=(ee=this.childsByName(g,"MediaFile")).length;H<M;H++)m=ee[H],(f=new le).id=m.getAttribute("id"),f.fileURL=this.parseNodeText(m),f.deliveryType=m.getAttribute("delivery"),f.codec=m.getAttribute("codec"),f.mimeType=m.getAttribute("type"),f.apiFramework=m.getAttribute("apiFramework"),f.bitrate=parseInt(m.getAttribute("bitrate")||0),f.minBitrate=parseInt(m.getAttribute("minBitrate")||0),f.maxBitrate=parseInt(m.getAttribute("maxBitrate")||0),f.width=parseInt(m.getAttribute("width")||0),f.height=parseInt(m.getAttribute("height")||0),(y=m.getAttribute("scalable"))&&"string"==typeof y&&("true"===(y=y.toLowerCase())?f.scalable=!0:"false"===y&&(f.scalable=!1)),(d=m.getAttribute("maintainAspectRatio"))&&"string"==typeof d&&("true"===(d=d.toLowerCase())?f.maintainAspectRatio=!0:"false"===d&&(f.maintainAspectRatio=!1)),n.mediaFiles.push(f);if(null!=(c=this.childByName(e,"Icons")))for(X=0,F=(te=this.childsByName(c,"Icon")).length;X<F;X++){for(u=te[X],(a=new ae).program=u.getAttribute("program"),a.height=parseInt(u.getAttribute("height")||0),a.width=parseInt(u.getAttribute("width")||0),a.xPosition=this.parseXPosition(u.getAttribute("xPosition")),a.yPosition=this.parseYPosition(u.getAttribute("yPosition")),a.apiFramework=u.getAttribute("apiFramework"),a.offset=this.parseDuration(u.getAttribute("offset")),a.duration=this.parseDuration(u.getAttribute("duration")),j=0,P=(ie=this.childsByName(u,"HTMLResource")).length;j<P;j++)o=ie[j],a.type=o.getAttribute("creativeType")||"text/html",a.htmlResource=this.parseNodeText(o);for(G=0,V=(ne=this.childsByName(u,"IFrameResource")).length;G<V;G++)p=ne[G],a.type=p.getAttribute("creativeType")||0,a.iframeResource=this.parseNodeText(p);for(Q=0,W=(re=this.childsByName(u,"StaticResource")).length;Q<W;Q++)L=re[Q],a.type=L.getAttribute("creativeType")||0,a.staticResource=this.parseNodeText(L);if(null!=(h=this.childByName(u,"IconClicks")))for(a.iconClickThroughURLTemplate=this.parseNodeText(this.childByName(h,"IconClickThrough")),se=0,B=(J=this.childsByName(h,"IconClickTracking")).length;se<B;se++)l=J[se],a.iconClickTrackingURLTemplates.push(this.parseNodeText(l));a.iconViewTrackingURLTemplate=this.parseNodeText(this.childByName(u,"IconViewTracking")),n.icons.push(a)}return n},u.parseNonLinear=function(e){var t,i,n,r,s,o,a,l,h,u,c,p,d,f,m,g,v,T,y,k,L,R,x,N,w,C,A,b,U;for(t=new I,p=0,g=(N=this.childsByName(e,"TrackingEvents")).length;p<g;p++)for(h=N[p],d=0,v=(w=this.childsByName(h,"Tracking")).length;d<v;d++)i=(l=w[d]).getAttribute("event"),u=this.parseNodeText(l),null!=i&&null!=u&&(null==(c=t.trackingEvents)[i]&&(c[i]=[]),t.trackingEvents[i].push(u));for(f=0,T=(C=this.childsByName(e,"NonLinear")).length;f<T;f++){for(o=C[f],(s=new B).id=o.getAttribute("id")||null,s.width=o.getAttribute("width"),s.height=o.getAttribute("height"),s.minSuggestedDuration=o.getAttribute("minSuggestedDuration"),s.apiFramework=o.getAttribute("apiFramework"),m=0,y=(A=this.childsByName(o,"HTMLResource")).length;m<y;m++)n=A[m],s.type=n.getAttribute("creativeType")||"text/html",s.htmlResource=this.parseNodeText(n);for(R=0,k=(b=this.childsByName(o,"IFrameResource")).length;R<k;R++)r=b[R],s.type=r.getAttribute("creativeType")||0,s.iframeResource=this.parseNodeText(r);for(x=0,L=(U=this.childsByName(o,"StaticResource")).length;x<L;x++)a=U[x],s.type=a.getAttribute("creativeType")||0,s.staticResource=this.parseNodeText(a);s.nonlinearClickThroughURLTemplate=this.parseNodeText(this.childByName(o,"NonLinearClickThrough")),t.variations.push(s)}return t},u.parseCompanionAd=function(e){var t,i,n,r,s,o,a,l,h,u,c,p,d,f,m,g,v,T,y,k,L,R,x,N,w,C,A,b,U;for(n=new _,p=0,g=(N=this.childsByName(e,"Companion")).length;p<g;p++){for(i=N[p],(t=new E).id=i.getAttribute("id")||null,t.width=i.getAttribute("width"),t.height=i.getAttribute("height"),d=0,v=(w=this.childsByName(i,"HTMLResource")).length;d<v;d++)s=w[d],t.type=s.getAttribute("creativeType")||"text/html",t.htmlResource=this.parseNodeText(s);for(f=0,T=(C=this.childsByName(i,"IFrameResource")).length;f<T;f++)o=C[f],t.type=o.getAttribute("creativeType")||0,t.iframeResource=this.parseNodeText(o);for(m=0,y=(A=this.childsByName(i,"StaticResource")).length;m<y;m++)a=A[m],t.type=a.getAttribute("creativeType")||0,t.staticResource=this.parseNodeText(a);for(R=0,k=(b=this.childsByName(i,"TrackingEvents")).length;R<k;R++)for(h=b[R],x=0,L=(U=this.childsByName(h,"Tracking")).length;x<L;x++)r=(l=U[x]).getAttribute("event"),u=this.parseNodeText(l),null!=r&&null!=u&&(null==(c=t.trackingEvents)[r]&&(c[r]=[]),t.trackingEvents[r].push(u));t.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(i,"CompanionClickThrough")),t.companionClickTrackingURLTemplate=this.parseNodeText(this.childByName(i,"CompanionClickTracking")),n.variations.push(t)}return n},u.parseDuration=function(e){var t,i,n,r,s;return null==e?-1:3!==(t=e.split(":")).length?-1:(s=t[2].split("."),r=parseInt(s[0]),2===s.length&&(r+=parseFloat("0."+s[1])),n=parseInt(60*t[1]),i=parseInt(60*t[0]*60),isNaN(i||isNaN(n||isNaN(r||3600<n||60<r)))?-1:i+n+r)},u.parseXPosition=function(e){var t;return"left"===(t=e.toLowerCase())||"right"===t?e:parseInt(e||0)},u.parseYPosition=function(e){var t;return"top"===(t=e.toLowerCase())||"bottom"===t?e:parseInt(e||0)},u.parseNodeText=function(e){return e&&(e.textContent||e.text||"").trim()},s=u,t.exports=s},{"./ad":2,"./companionad":4,"./creative":5,"./extension":6,"./extensionchild":7,"./icon":8,"./mediafile":10,"./nonlinear":11,"./response":13,"./survey":14,"./urlhandler":16,"./util":19,events:1}],13:[function(e,t,i){var n;n=function(){this.ads=[],this.errorURLTemplates=[]},t.exports=n},{}],14:[function(e,t,i){var n;n=function(){this.type=null,this.url=null},t.exports=n},{}],15:[function(e,t,i){var s,o,n,r,a={}.hasOwnProperty;function l(e,t){var i,n,r;for(i in this.ad=e,this.creative=t,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],r=this.creative.trackingEvents)n=r[i],this.trackingEvents[i]=n.slice(0);this.creative instanceof o?(this.setDuration(this.creative.duration),this.skipDelay=this.creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1),this.on("start",function(){s.lastSuccessfullAd=+new Date})}s=e("./client"),r=e("./util"),o=e("./creative").VASTCreativeLinear,function(e,t){for(var i in t)a.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(l,e("events").EventEmitter),l.prototype.setDuration=function(e){return this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}},l.prototype.setProgress=function(e){var t,i,n,r,s,o,a,l,h;if(-1===(s=null===this.skipDelay?this.skipDelayDefault:this.skipDelay)||this.skipable||(e<s?this.emit("skip-countdown",s-e):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&0<this.assetDuration){if(i=[],0<e)for(r in i.push("start"),n=Math.round(e/this.assetDuration*100),i.push("progress-"+n+"%"),i.push("progress-"+Math.round(e)),h=this.quartiles)(o=h[r])<=e&&e<=o+1&&i.push(r);for(a=0,l=i.length;a<l;a++)t=i[a],this.track(t,!0);e<this.progress&&this.track("rewind")}return this.progress=e},l.prototype.setMuted=function(e){return this.muted!==e&&this.track(e?"mute":"unmute"),this.muted=e},l.prototype.setPaused=function(e){return this.paused!==e&&this.track(e?"pause":"resume"),this.paused=e},l.prototype.setFullscreen=function(e){return this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen"),this.fullscreen=e},l.prototype.setSkipDelay=function(e){if("number"==typeof e)return this.skipDelay=e},l.prototype.load=function(){if(!this.impressed)return this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView")},l.prototype.errorWithCode=function(e){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:e})},l.prototype.complete=function(){return this.track("complete")},l.prototype.close=function(){return this.track(this.linear?"closeLinear":"close")},l.prototype.stop=function(){},l.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},l.prototype.click=function(){var e,t,i;if((null!=(i=this.clickTrackingURLTemplates)?i.length:void 0)&&this.trackURLs(this.clickTrackingURLTemplates),null!=this.clickThroughURLTemplate)return this.linear&&(t={CONTENTPLAYHEAD:this.progressFormated()}),e=r.resolveURLTemplates([this.clickThroughURLTemplate],t)[0],this.emit("clickthrough",e)},l.prototype.track=function(e,t){var i,n;null==t&&(t=!1),"closeLinear"===e&&null==this.trackingEvents[e]&&null!=this.trackingEvents.close&&(e="close"),n=this.trackingEvents[e],i=this.emitAlwaysEvents.indexOf(e),null!=n?(this.emit(e,""),this.trackURLs(n)):-1!==i&&this.emit(e,""),!0===t&&(delete this.trackingEvents[e],-1<i&&this.emitAlwaysEvents.splice(i,1))},l.prototype.trackURLs=function(e,t){return null==t&&(t={}),this.linear&&(t.CONTENTPLAYHEAD=this.progressFormated()),r.track(e,t)},l.prototype.progressFormated=function(){var e,t,i,n;return(e=(n=parseInt(this.progress))/3600).length<2&&(e="0"+e),(t=n/60%60).length<2&&(t="0"+t),(i=n%60).length<2&&(i="0"+t),e+":"+t+":"+i+"."+parseInt(100*(this.progress-n))},n=l,t.exports=n},{"./client":3,"./creative":5,"./util":19,events:1}],16:[function(r,e,t){var i,s,o;function n(){}o=r("./urlhandlers/xmlhttprequest"),s=r("./urlhandlers/flash"),n.get=function(e,t,i){var n;return i||("function"==typeof t&&(i=t),t={}),null!=t.response?i(null,t.response):(null!=(n=t.urlhandler)?n.supported():void 0)?t.urlhandler.get(e,t,i):"undefined"==typeof window||null===window?r("./urlhandlers/node").get(e,t,i):o.supported()?o.get(e,t,i):s.supported()?s.get(e,t,i):i()},i=n,e.exports=i},{"./urlhandlers/flash":17,"./urlhandlers/xmlhttprequest":18}],17:[function(e,t,i){var n;function r(){}r.xdr=function(){var e;return window.XDomainRequest&&(e=new XDomainRequest),e},r.supported=function(){return!!this.xdr()},r.get=function(e,t,i){var n,r;return(r="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(r.async=!1,(n=this.xdr()).open("GET",e),n.timeout=t.timeout||0,n.withCredentials=t.withCredentials||!1,n.send(),n.onprogress=function(){},n.onload=function(){return r.loadXML(n.responseText),i(null,r)}):i()},n=r,t.exports=n},{}],18:[function(e,t,i){var n;function r(){}r.xhr=function(){var e;if("withCredentials"in(e=new window.XMLHttpRequest))return e},r.supported=function(){return!!this.xhr()},r.get=function(e,t,i){var n;if("https:"===window.location.protocol&&0===e.indexOf("http://"))return i(new Error("Cannot go from HTTPS to HTTP."));try{return(n=this.xhr()).open("GET",e),n.timeout=t.timeout||0,n.withCredentials=t.withCredentials||!1,n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){if(4===n.readyState)return i(null,n.responseXML)},n.send()}catch(e){return i()}},n=r,t.exports=n},{}],19:[function(e,t,i){var n;function r(){}r.track=function(e,t){var i,n,r,s,o,a;for(a=[],s=0,o=(n=this.resolveURLTemplates(e,t)).length;s<o;s++)i=n[s],"undefined"!=typeof window&&null!==window&&(r=new Image,a.push(r.src=i));return a},r.resolveURLTemplates=function(e,t){var i,n,r,s,o,a,l,h;i=[],null==t&&(t={}),"CACHEBUSTING"in t||(t.CACHEBUSTING=Math.round(1e10*Math.random())),t.random=t.CACHEBUSTING;for(l=0,h=e.length;l<h;l++)if(o=e[l]){for(n in t)a=t[n],r="["+n+"]",s="%%"+n+"%%",o=(o=o.replace(r,a)).replace(s,a);i.push(o)}return i},r.storage=function(){var i,t;try{t="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){t=null}return null!=t&&!function(e){var t;try{if(t="__VASTUtil__",e.setItem(t,t),e.getItem(t)!==t)return 1}catch(e){return 1}return 0}(t)||(i={},t={length:0,getItem:function(e){return i[e]},setItem:function(e,t){i[e]=t,this.length=Object.keys(i).length},removeItem:function(e){delete i[e],this.length=Object.keys(i).length},clear:function(){i={},this.length=0}}),t}(),n=r,t.exports=n},{}]},{},[9])(9)})}catch(e){try{var t=e.name+" in VPAID wrapper global t/c: "+e.message+", stack="+e.stack,i="//px.moatads.com/pixel.gif?e=24&d=data%3Adata%3Adata%3Adata&i="+encodeURIComponent("SMILEWANTED1")+"&rp=1&gw=smilewanted101495534310&ac=1&k="+encodeURIComponent(t)+"&ar="+encodeURIComponent("3955ada-clean")+"&iw="+encodeURIComponent("bbe4201")+"&j="+encodeURIComponent(document.referrer)+"&cs="+(new Date).getTime();(new Image).src=i}catch(e){}}}();

