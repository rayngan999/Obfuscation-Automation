/*! UA-Web-Push: b406fcc:1626988534860 */(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=0)})([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _1=__webpack_require__(1);var is_supported_1=__webpack_require__(48);var secure_bridge_1=__webpack_require__(64);var push_worker_src_1=__webpack_require__(81);var configure_1=__webpack_require__(65);try{var script=document.getElementById("_uasdk");var rel=script.rel;var uaWin=window;if(script&&rel&&uaWin[rel]){if(typeof uaWin[rel]._async_setup==="function"){uaWin[rel]._async_setup(asyncSetup)}else if(typeof uaWin[rel]._setup==="function"){uaWin[rel]._setup(setup)}}else if(script&&script.getAttribute("rel")==="secureBridge"){window.uaSetup={secureBridge:secure_bridge_1.setupBridge}}}catch(e){if(e instanceof ReferenceError&&self){self.uaSetup={worker:push_worker_src_1.default}}}function setup(opts){if(opts===void 0){opts={}}configure_1.default(opts);if(!is_supported_1.default()){throw new Error("Browser is not supported")}var sdk=new _1.default;sdk._legacySetup();return sdk}function asyncSetup(opts){if(opts===void 0){opts={}}configure_1.default(opts);if(!is_supported_1.default()){var err=new Error("Browser is not supported");if("Promise"in window){return Promise.reject(err)}throw err}var sdk=new _1.default;return sdk._setup().then((function(){return sdk}))}},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var event_target_shim_1=__webpack_require__(4);var channel_1=__webpack_require__(5);var plugins_1=__webpack_require__(31);var reports_1=__webpack_require__(33);var data_collection_1=__webpack_require__(10);var custom_events_1=__webpack_require__(40);var can_register_1=__webpack_require__(47);var promise_1=__webpack_require__(52);var db_1=__webpack_require__(11);var db_rename_1=__webpack_require__(53);var is_registration_domain_1=__webpack_require__(51);var debug_1=__webpack_require__(7);var is_after_1=__webpack_require__(38);var is_supported_1=__webpack_require__(48);var location_1=__webpack_require__(42);var is_secure_1=__webpack_require__(50);var get_worker_registration_1=__webpack_require__(54);var get_registration_1=__webpack_require__(56);var request_1=__webpack_require__(8);var storage_1=__webpack_require__(9);var gesture_required_1=__webpack_require__(63);var secure_bridge_1=__webpack_require__(64);var is_safari_1=__webpack_require__(49);var locale_override_1=__webpack_require__(25);var contact_1=__webpack_require__(68);var storage_2=__webpack_require__(74);var client_1=__webpack_require__(75);var deferred_1=__webpack_require__(76);var utils_1=__webpack_require__(17);var registration_1=__webpack_require__(77);var remote_data_1=__webpack_require__(78);var preference_center_1=__webpack_require__(79);var client_2=__webpack_require__(80);var i18n_1=__webpack_require__(24);var UaSDK=function(_super){__extends(UaSDK,_super);function UaSDK(){var _this=_super.call(this)||this;_this.dataCollectionEnabledSync=true;_this._isSetup=new deferred_1.default;_this._channelPromise=new Promise((function(resolve){_this.addEventListener("channel",(function(ev){return resolve(ev.detail)}),{once:true})}));_this._workerRegistration=get_worker_registration_1.default();_this._workerRegistration.catch((function(e){return debug_1.default("SW Registration Error",e)}));_this._channelPromise.then(_this.heartbeat.bind(_this));_this._channelPromise.then(_this.checkPermission.bind(_this));_this.isSupported=is_supported_1.default();_this.canRegister=can_register_1.default();_this.isRegistrationDomain=is_registration_domain_1.default();_this.gestureRequired=gesture_required_1.default();_this.setDataCollectionEnabled=function(enabled){return data_collection_1.setDataCollectionEnabled(enabled,_this)};_this.isDataCollectionEnabled=data_collection_1.isDataCollectionEnabled;if(config_1.default.secureBridgeUrl&&config_1.default.secureBridgeUrl.match(/accengage\.net/)&&!config_1.default.mixedRegistrationDomains){console.warn("WARNING: you should set 'mixedRegistrationDomains' to true if you are migrating from Accengage and were using an Accengage-owned domain")}debug_1.default("[main] Web SDK environment:");var debugData={isSecure:is_secure_1.default(),isRegistrationDomain:_this.isRegistrationDomain,mixedRegistrationDomains:config_1.default.mixedRegistrationDomains,secureBridgeUrl:config_1.default.secureBridgeUrl,allowedDomains:config_1.default.allowedDomains};if(config_1.default.secureBridgeUrl){debugData.sbOriginDifferentFromCurrent=new URL(config_1.default.secureBridgeUrl).origin!==window.location.origin}debug_1.default(debugData);var shouldSetupIframe=(!is_secure_1.default()||!_this.isRegistrationDomain||config_1.default.mixedRegistrationDomains)&&config_1.default.secureBridgeUrl&&new URL(config_1.default.secureBridgeUrl).origin!==window.location.origin&&!is_safari_1.default();if(shouldSetupIframe&&!config_1.default.secureBridgeUrl){console.warn("Airship SDK is integrated on a non-secured domain but 'secureIframeUrl' is not provided.")}_this.hasExistingSubscription=Promise.resolve();if(shouldSetupIframe&&config_1.default.secureBridgeUrl){secure_bridge_1.setupIframe(_this,config_1.default.secureBridgeUrl);if(config_1.default.mixedRegistrationDomains){var getBridgeSubscription=new Promise((function(resolve){_this.addEventListener("subscriptiondomain",(function(ev){return resolve(ev.detail)}),{once:true})}));_this.hasExistingSubscription=Promise.race([getBridgeSubscription,promise_1.promiseTimeout(1e3)])}}else{_this._channelPromise.then((function(channel){return reports_1.startSession(channel)}))}_this.channel=null;_this.localeOverride=new locale_override_1.default;_this.CustomEvent=custom_events_1.default;_this.plugins=new plugins_1.default;_this._contactPromise=_this.createContact().catch((function(e){}));window.addEventListener("storage",storage_1.default.onStorage((function(data){return _this._set(data)})));if(navigator.serviceWorker){navigator.serviceWorker.addEventListener("message",(function(message){debug_1.default("Push event from worker",message);if(message.data.type==="push"){_this.dispatchEvent({type:"push",push:message.data.push})}}))}return _this}UaSDK.prototype.createContact=function(){return __awaiter(this,void 0,void 0,(function(){var storage,client,registration,contact;var _this=this;return __generator(this,(function(_a){switch(_a.label){case 0:if(!config_1.default.contacts._enabled){throw new Error("contacts are not enabled")}return[4,this._isSetup.promise];case 1:_a.sent();storage=new storage_2.default({prefix:config_1.default.storagePrefix,sessionLengthMs:config_1.default.contacts.sessionLengthMs},db_1.default,self.sessionStorage);client=new client_1.default({paths:config_1.default.paths.contact},utils_1.createRequest(config_1.default));registration=new registration_1.default({paths:config_1.default.paths.contact.registration},utils_1.createRequest(config_1.default));contact=new contact_1.default((function(){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this.channel]}))}))}),(function(){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this.localeOverride]}))}))}),this,storage,client,registration,{isDataCollectionEnabled:this.isDataCollectionEnabled});return[2,contact]}}))}))};UaSDK.prototype.checkDataCollection=function(){var _this=this;return Promise.resolve(this.dataCollectionEnabled).then((function(enabled){_this.dataCollectionEnabledSync=enabled}))};UaSDK.prototype.checkPermission=function(channel){return __awaiter(this,void 0,void 0,(function(){var domain;return __generator(this,(function(_a){switch(_a.label){case 0:if(!config_1.default.mixedRegistrationDomains)return[3,2];return[4,this.hasExistingSubscription];case 1:domain=_a.sent();if(domain){return[2]}_a.label=2;case 2:if(this.permission&&this.permission!=="granted"&&channel.optedIn&&this.isRegistrationDomain){channel.optOut()}return[2]}}))}))};UaSDK.prototype.heartbeat=function(channel){var _a=is_after_1.default("heartbeat",24),after=_a.after,store=_a.store;if(after){debug_1.default("SENDING heartbeat");store();if(channel.optedIn&&this.isRegistrationDomain){this.register().catch((function(){return channel.update()}))}else{channel.update()}}};UaSDK.prototype.getChannel=function(){return this._channelPromise};UaSDK.prototype._legacySetup=function(){try{var channel=storage_1.default.getJSON("channel");if(channel===null||channel===void 0?void 0:channel.channel_id){this._setChannel(channel)}this._isSetup.resolve()}catch(e){this._isSetup.reject(e);throw e}};UaSDK.prototype._setup=function(){return __awaiter(this,void 0,void 0,(function(){var setupPromises;var _this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,db_rename_1.renameDbIfNeed()];case 1:_a.sent();setupPromises=[];setupPromises.push(db_1.default.get("channel").then((function(channel){if(channel&&channel.channel_id){_this._setChannel(channel)}})).then((function(){return locale_override_1.default.getStoredLocale().then((function(loc){_this.localeOverride.set(loc);_this.channel&&_this.localeOverride.setChannel(_this.channel)}))})));setupPromises.push(db_1.default.get("subscriptionDomain").then((function(domain){if(domain){_this._setSubscriptionDomain(domain)}})));setupPromises.push(this.checkDataCollection());return[2,Promise.all(setupPromises).then((function(){return _this._isSetup.resolve()})).catch((function(e){_this._isSetup.reject(e);throw e}))]}}))}))};Object.defineProperty(UaSDK.prototype,"disableAnalytics",{get:function(){return db_1.default.get(config_1.default.consts.DISABLE_ANALYTICS).then((function(value){return!!value}))},set:function(bool){db_1.default.set(config_1.default.consts.DISABLE_ANALYTICS,!!bool)},enumerable:false,configurable:true});Object.defineProperty(UaSDK.prototype,"dataCollectionEnabled",{get:function(){return data_collection_1.isDataCollectionEnabled()},set:function(bool){data_collection_1.setDataCollectionEnabled(!!bool,this);this.dataCollectionEnabledSync=!!bool},enumerable:false,configurable:true});Object.defineProperty(UaSDK.prototype,"permission",{get:function(){var _a;if(is_secure_1.default()){return(_a=window.Notification)===null||_a===void 0?void 0:_a.permission}return undefined},enumerable:false,configurable:true});Object.defineProperty(UaSDK.prototype,"contact",{get:function(){return this._contactPromise.then((function(contact){if(!contact){throw new Error("contact not available")}return contact}))},enumerable:false,configurable:true});UaSDK.prototype.register=function(){return __awaiter(this,void 0,void 0,(function(){var workerRegistration,e_1,existingSub,registration,response,_a,body,store;return __generator(this,(function(_b){switch(_b.label){case 0:if(!is_safari_1.default()){if(!is_secure_1.default()){return[2,Promise.reject("Registration not possible on a non-secure context.")]}if(!this.isRegistrationDomain){return[2,Promise.reject("Domain is not allowed for registration.")]}}if(!this.dataCollectionEnabledSync){return[2,Promise.reject("Data collection is disabled. Cannot register user.")]}workerRegistration=null;_b.label=1;case 1:_b.trys.push([1,3,,4]);return[4,this._workerRegistration];case 2:workerRegistration=_b.sent();return[3,4];case 3:e_1=_b.sent();return[3,4];case 4:return[4,this.hasExistingSubscription];case 5:existingSub=_b.sent();if(existingSub&&existingSub!==location_1.default().hostname){return[2,Promise.reject("An existing registration exists on "+existingSub)]}return[4,get_registration_1.default(workerRegistration)];case 6:registration=_b.sent();if(!this.channel)return[3,8];return[4,request_1.default(this.channel.path,{method:"put",body:registration})];case 7:_a=_b.sent();return[3,10];case 8:return[4,request_1.default(config_1.default.paths.cra,{method:"post",body:registration})];case 9:_a=_b.sent();_b.label=10;case 10:response=_a;return[4,response.json()];case 11:body=_b.sent();store=is_after_1.default("heartbeat",24).store;store();this._setSubscriptionDomain(location_1.default().hostname);return[2,this._setChannel(body)]}}))}))};Object.defineProperty(UaSDK.prototype,"_intlDetails",{get:function(){return i18n_1.getIntlDetails(this.localeOverride)},enumerable:false,configurable:true});Object.defineProperty(UaSDK.prototype,"_remoteData",{get:function(){var _this=this;if(!this._remoteDataProvider){var remoteDataClient=new client_2.default({paths:config_1.default.paths.remote_data,sdkVersion:config_1.default.VERSION,appKey:config_1.default.appKey},utils_1.createRequest(config_1.default));this._remoteDataProvider=new remote_data_1.default({cacheTtlMs:config_1.default.remoteData.cacheTtlMs,prefix:config_1.default.storagePrefix},remoteDataClient,(function(){return __awaiter(_this,void 0,void 0,(function(){var intlDetails;return __generator(this,(function(_a){intlDetails=this._intlDetails;return[2,{country:intlDetails.localeCountry,language:intlDetails.localeLanguage}]}))}))}),self.sessionStorage)}return this._remoteDataProvider},enumerable:false,configurable:true});Object.defineProperty(UaSDK.prototype,"preferenceCenters",{get:function(){if(!this._preferenceCenterManager){this._preferenceCenterManager=new preference_center_1.default(this._remoteData)}return this._preferenceCenterManager},enumerable:false,configurable:true});UaSDK.prototype._set=function(data){if(data===void 0){data={}}if(data.channel&&data.channel.channel_id){this._setChannel(data.channel)}if(data.tags&&this.channel){this.channel.tags.sync(data.tags)}if(data.subscriptionDomain){this._setSubscriptionDomain(data.subscriptionDomain)}if(data.session){this._setSession(data.session)}};UaSDK.prototype._setSubscriptionDomain=function(domain){db_1.default.set("subscriptionDomain",domain);var event=new CustomEvent("subscriptiondomain",{detail:domain});this.dispatchEvent(event)};UaSDK.prototype._setChannel=function(channelData){var _this=this;if(this.channel){this.channel.set(channelData);return this.channel}this.channel=new channel_1.default(channelData);this.localeOverride.setChannel(this.channel);this.channel.addEventListener("channel",(function(ev){ev.channel=ev.detail;_this.dispatchEvent(ev)}));this.channel.tags.addEventListener("tags",(function(ev){var event=new CustomEvent("tags",{detail:ev.detail});event.tags=ev.detail;_this.dispatchEvent(event)}));return this.channel};UaSDK.prototype._setSession=function(session){storage_1.default.setJSON("session",session);this._channelPromise.then((function(channel){reports_1.startSession(channel,session)}))};Object.defineProperty(UaSDK.prototype,"isSetup",{get:function(){return this._isSetup.promise},enumerable:false,configurable:true});return UaSDK}(event_target_shim_1.EventTarget);exports.default=UaSDK},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var VERSION=__webpack_require__(3).version;var API_URL=false?undefined:"https://aswpapius.com";var config={VERSION:VERSION,configured:false,workerUrl:"/push-worker.js",apiUrl:API_URL,storagePrefix:"_ua_sdk",deprecatedStoragePrefix:null,disableAnalytics:false,appKey:null,secret:null,token:null,defaultIcon:"",defaultTitle:"",defaultActionURL:"",vapidPublicKey:null,debug:false,websitePushId:null,registrationDomain:null,mixedRegistrationDomains:false,secureHost:"",secureBridgePath:null,secureBridgeUrl:null,dataCollectionOptInEnabled:false,secureIframeUrl:null,skipWaiting:true,allowedDomains:null,safariServiceUrl:API_URL+"/api/safari/web-service/",paths:{cla:"/api/channels",cra:"/api/web-channels",tags:"/api/web-channels/tags",attributes:"/api/channels/attributes",custom_events:"/api/web-events/custom",remote_data:{app:"/api/remote-data/app"},subscription_lists:{list:"/api/subscription_lists/channels",update:"/api/channels/subscription_lists"},named_user:{associate:"/api/named_users/associate",disassociate:"/api/named_users/disassociate",tags:"/api/named_users/tags"},contact:{identify:"/api/contacts/identify",resolve:"/api/contacts/resolve",reset:"/api/contacts/reset",batch:"/api/contacts",registration:{email:"/api/channels/restricted/email",sms:"/api/channels/restricted/sms",open:"/api/channels/restricted/open"}},reports:{direct:"/api/web-events/direct",session:"/api/web-events/session",customEvent:"/api/web-events/custom"}},consts:{DISABLE_ANALYTICS:"disable_analytics"},contacts:{_enabled:false,sessionLengthMs:60*60*1e3*1},subscriptionLists:{cacheTtlMs:5*60*1e3},remoteData:{cacheTtlMs:10*60*1e3*1}};exports.default=config},function(module){module.exports=JSON.parse('{"version":"1.13.0"}')},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const privateData=new WeakMap;const wrappers=new WeakMap;function pd(event){const retv=privateData.get(event);console.assert(retv!=null,"'this' is expected an Event object, but got",event);return retv}function setCancelFlag(data){if(data.passiveListener!=null){if(typeof console!=="undefined"&&typeof console.error==="function"){console.error("Unable to preventDefault inside passive event listener invocation.",data.passiveListener)}return}if(!data.event.cancelable){return}data.canceled=true;if(typeof data.event.preventDefault==="function"){data.event.preventDefault()}}function Event(eventTarget,event){privateData.set(this,{eventTarget:eventTarget,event:event,eventPhase:2,currentTarget:eventTarget,canceled:false,stopped:false,immediateStopped:false,passiveListener:null,timeStamp:event.timeStamp||Date.now()});Object.defineProperty(this,"isTrusted",{value:false,enumerable:true});const keys=Object.keys(event);for(let i=0;i<keys.length;++i){const key=keys[i];if(!(key in this)){Object.defineProperty(this,key,defineRedirectDescriptor(key))}}}Event.prototype={get type(){return pd(this).event.type},get target(){return pd(this).eventTarget},get currentTarget(){return pd(this).currentTarget},composedPath(){const currentTarget=pd(this).currentTarget;if(currentTarget==null){return[]}return[currentTarget]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return pd(this).eventPhase},stopPropagation(){const data=pd(this);data.stopped=true;if(typeof data.event.stopPropagation==="function"){data.event.stopPropagation()}},stopImmediatePropagation(){const data=pd(this);data.stopped=true;data.immediateStopped=true;if(typeof data.event.stopImmediatePropagation==="function"){data.event.stopImmediatePropagation()}},get bubbles(){return Boolean(pd(this).event.bubbles)},get cancelable(){return Boolean(pd(this).event.cancelable)},preventDefault(){setCancelFlag(pd(this))},get defaultPrevented(){return pd(this).canceled},get composed(){return Boolean(pd(this).event.composed)},get timeStamp(){return pd(this).timeStamp},get srcElement(){return pd(this).eventTarget},get cancelBubble(){return pd(this).stopped},set cancelBubble(value){if(!value){return}const data=pd(this);data.stopped=true;if(typeof data.event.cancelBubble==="boolean"){data.event.cancelBubble=true}},get returnValue(){return!pd(this).canceled},set returnValue(value){if(!value){setCancelFlag(pd(this))}},initEvent(){}};Object.defineProperty(Event.prototype,"constructor",{value:Event,configurable:true,writable:true});if(typeof window!=="undefined"&&typeof window.Event!=="undefined"){Object.setPrototypeOf(Event.prototype,window.Event.prototype);wrappers.set(window.Event.prototype,Event)}function defineRedirectDescriptor(key){return{get(){return pd(this).event[key]},set(value){pd(this).event[key]=value},configurable:true,enumerable:true}}function defineCallDescriptor(key){return{value(){const event=pd(this).event;return event[key].apply(event,arguments)},configurable:true,enumerable:true}}function defineWrapper(BaseEvent,proto){const keys=Object.keys(proto);if(keys.length===0){return BaseEvent}function CustomEvent(eventTarget,event){BaseEvent.call(this,eventTarget,event)}CustomEvent.prototype=Object.create(BaseEvent.prototype,{constructor:{value:CustomEvent,configurable:true,writable:true}});for(let i=0;i<keys.length;++i){const key=keys[i];if(!(key in BaseEvent.prototype)){const descriptor=Object.getOwnPropertyDescriptor(proto,key);const isFunc=typeof descriptor.value==="function";Object.defineProperty(CustomEvent.prototype,key,isFunc?defineCallDescriptor(key):defineRedirectDescriptor(key))}}return CustomEvent}function getWrapper(proto){if(proto==null||proto===Object.prototype){return Event}let wrapper=wrappers.get(proto);if(wrapper==null){wrapper=defineWrapper(getWrapper(Object.getPrototypeOf(proto)),proto);wrappers.set(proto,wrapper)}return wrapper}function wrapEvent(eventTarget,event){const Wrapper=getWrapper(Object.getPrototypeOf(event));return new Wrapper(eventTarget,event)}function isStopped(event){return pd(event).immediateStopped}function setEventPhase(event,eventPhase){pd(event).eventPhase=eventPhase}function setCurrentTarget(event,currentTarget){pd(event).currentTarget=currentTarget}function setPassiveListener(event,passiveListener){pd(event).passiveListener=passiveListener}const listenersMap=new WeakMap;const CAPTURE=1;const BUBBLE=2;const ATTRIBUTE=3;function isObject(x){return x!==null&&typeof x==="object"}function getListeners(eventTarget){const listeners=listenersMap.get(eventTarget);if(listeners==null){throw new TypeError("'this' is expected an EventTarget object, but got another value.")}return listeners}function defineEventAttributeDescriptor(eventName){return{get(){const listeners=getListeners(this);let node=listeners.get(eventName);while(node!=null){if(node.listenerType===ATTRIBUTE){return node.listener}node=node.next}return null},set(listener){if(typeof listener!=="function"&&!isObject(listener)){listener=null}const listeners=getListeners(this);let prev=null;let node=listeners.get(eventName);while(node!=null){if(node.listenerType===ATTRIBUTE){if(prev!==null){prev.next=node.next}else if(node.next!==null){listeners.set(eventName,node.next)}else{listeners.delete(eventName)}}else{prev=node}node=node.next}if(listener!==null){const newNode={listener:listener,listenerType:ATTRIBUTE,passive:false,once:false,next:null};if(prev===null){listeners.set(eventName,newNode)}else{prev.next=newNode}}},configurable:true,enumerable:true}}function defineEventAttribute(eventTargetPrototype,eventName){Object.defineProperty(eventTargetPrototype,`on${eventName}`,defineEventAttributeDescriptor(eventName))}function defineCustomEventTarget(eventNames){function CustomEventTarget(){EventTarget.call(this)}CustomEventTarget.prototype=Object.create(EventTarget.prototype,{constructor:{value:CustomEventTarget,configurable:true,writable:true}});for(let i=0;i<eventNames.length;++i){defineEventAttribute(CustomEventTarget.prototype,eventNames[i])}return CustomEventTarget}function EventTarget(){if(this instanceof EventTarget){listenersMap.set(this,new Map);return}if(arguments.length===1&&Array.isArray(arguments[0])){return defineCustomEventTarget(arguments[0])}if(arguments.length>0){const types=new Array(arguments.length);for(let i=0;i<arguments.length;++i){types[i]=arguments[i]}return defineCustomEventTarget(types)}throw new TypeError("Cannot call a class as a function")}EventTarget.prototype={addEventListener(eventName,listener,options){if(listener==null){return}if(typeof listener!=="function"&&!isObject(listener)){throw new TypeError("'listener' should be a function or an object.")}const listeners=getListeners(this);const optionsIsObj=isObject(options);const capture=optionsIsObj?Boolean(options.capture):Boolean(options);const listenerType=capture?CAPTURE:BUBBLE;const newNode={listener:listener,listenerType:listenerType,passive:optionsIsObj&&Boolean(options.passive),once:optionsIsObj&&Boolean(options.once),next:null};let node=listeners.get(eventName);if(node===undefined){listeners.set(eventName,newNode);return}let prev=null;while(node!=null){if(node.listener===listener&&node.listenerType===listenerType){return}prev=node;node=node.next}prev.next=newNode},removeEventListener(eventName,listener,options){if(listener==null){return}const listeners=getListeners(this);const capture=isObject(options)?Boolean(options.capture):Boolean(options);const listenerType=capture?CAPTURE:BUBBLE;let prev=null;let node=listeners.get(eventName);while(node!=null){if(node.listener===listener&&node.listenerType===listenerType){if(prev!==null){prev.next=node.next}else if(node.next!==null){listeners.set(eventName,node.next)}else{listeners.delete(eventName)}return}prev=node;node=node.next}},dispatchEvent(event){if(event==null||typeof event.type!=="string"){throw new TypeError('"event.type" should be a string.')}const listeners=getListeners(this);const eventName=event.type;let node=listeners.get(eventName);if(node==null){return true}const wrappedEvent=wrapEvent(this,event);let prev=null;while(node!=null){if(node.once){if(prev!==null){prev.next=node.next}else if(node.next!==null){listeners.set(eventName,node.next)}else{listeners.delete(eventName)}}else{prev=node}setPassiveListener(wrappedEvent,node.passive?node.listener:null);if(typeof node.listener==="function"){try{node.listener.call(this,wrappedEvent)}catch(err){if(typeof console!=="undefined"&&typeof console.error==="function"){console.error(err)}}}else if(node.listenerType!==ATTRIBUTE&&typeof node.listener.handleEvent==="function"){node.listener.handleEvent(wrappedEvent)}if(isStopped(wrappedEvent)){break}node=node.next}setPassiveListener(wrappedEvent,null);setEventPhase(wrappedEvent,0);setCurrentTarget(wrappedEvent,null);return!wrappedEvent.defaultPrevented}};Object.defineProperty(EventTarget.prototype,"constructor",{value:EventTarget,configurable:true,writable:true});if(typeof window!=="undefined"&&typeof window.EventTarget!=="undefined"){Object.setPrototypeOf(EventTarget.prototype,window.EventTarget.prototype)}exports.defineEventAttribute=defineEventAttribute;exports.EventTarget=EventTarget;exports.default=EventTarget;module.exports=EventTarget;module.exports.EventTarget=module.exports["default"]=EventTarget;module.exports.defineEventAttribute=defineEventAttribute},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var event_target_shim_1=__webpack_require__(4);var tags_1=__webpack_require__(6);var db_1=__webpack_require__(11);var request_1=__webpack_require__(8);var storage_1=__webpack_require__(9);var attributes_1=__webpack_require__(14);var named_user_1=__webpack_require__(15);var get_registration_base_1=__webpack_require__(22);var config_1=__webpack_require__(2);var data_collection_1=__webpack_require__(10);var locale_override_1=__webpack_require__(25);var utils_1=__webpack_require__(26);var subscriptions_1=__webpack_require__(28);var utils_2=__webpack_require__(17);var MAX_NAMED_USER_CHANGES=10;var Channel=function(_super){__extends(Channel,_super);function Channel(channelData){var _this=_super.call(this)||this;_this.opt_in=true;_this.namedUserChanges=0;_this.channel_id=channelData.channel_id;_this._named_user_id=null;_this._tags=new tags_1.default(config_1.default.paths.tags,(function(){return{web_channel:_this.channel_id}}),{isNamedUser:false});_this._attributes=new attributes_1.default((function(){return{channel:_this.channel_id}}));_this._namedUser=new named_user_1.default({getName:function(){return _this._named_user_id},setName:function(name){_this.set({named_user_id:name})},getChannelId:function(){return _this.channel_id}});_this.set(channelData);return _this}Object.defineProperty(Channel.prototype,"id",{get:function(){return this.channel_id},enumerable:false,configurable:true});Object.defineProperty(Channel.prototype,"optedIn",{get:function(){return utils_1._convertOptInStorageValue(this.opt_in)},enumerable:false,configurable:true});Object.defineProperty(Channel.prototype,"named_user_id",{get:function(){console.warn("accessing the `named_user_id` of a channel may return a non-canonical response. its use is deprecated.");return this._named_user_id},enumerable:false,configurable:true});Channel.prototype._createSubscriptionManager=function(){var _this=this;var subscriptionClient=utils_1.CachingChannelSubscriptionListClient.createClient({paths:config_1.default.paths.subscription_lists,prefix:config_1.default.storagePrefix,ttlMs:config_1.default.subscriptionLists.cacheTtlMs},utils_2.createRequest(config_1.default),self.sessionStorage);return new subscriptions_1.default(subscriptionClient,(function(){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this.channel_id]}))}))}),(function(){return data_collection_1.isDataCollectionEnabled()}))};Object.defineProperty(Channel.prototype,"subscriptions",{get:function(){if(!this._subscriptions){this._subscriptions=this._createSubscriptionManager()}return this._subscriptions},enumerable:false,configurable:true});Channel.fromStorage=function(){return __awaiter(this,void 0,void 0,(function(){var stored;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,db_1.default.get("channel")];case 1:stored=_a.sent();if(stored){return[2,new Channel(stored)]}return[2]}}))}))};Channel.prototype.optOut=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.set({opt_in:false})];case 1:_a.sent();return[2,this.update(false)]}}))}))};Object.defineProperty(Channel.prototype,"namedUser",{get:function(){return this._namedUser},enumerable:false,configurable:true});Object.defineProperty(Channel.prototype,"path",{get:function(){return config_1.default.paths.cra+"/"+this.id},enumerable:false,configurable:true});Object.defineProperty(Channel.prototype,"tags",{get:function(){return this._tags},enumerable:false,configurable:true});Object.defineProperty(Channel.prototype,"attributes",{get:function(){return this._attributes},enumerable:false,configurable:true});Channel.prototype._setLocaleOverride=function(locale){this.localeOverride=locale};Channel.prototype.toJSON=function(){return Object.assign(get_registration_base_1.default(this.localeOverride),{channel_id:this.id,opt_in:this.optedIn})};Channel.prototype._set=function(channelData){console.warn("Channel._set() is deprecated and will be removed in the future. Please use Channel.set() instead.");return this.set(channelData)};Channel.prototype.set=function(channelData){var keys=Object.keys(channelData);var namedUserOnlyChange=keys.every((function(k){return k==="named_user_id"}));if(namedUserOnlyChange){this.namedUserChanges++}if(channelData.channel_id){this.channel_id=channelData.channel_id}if(typeof channelData.opt_in!=="undefined"){this.opt_in=channelData.opt_in}else{this.opt_in=true}if(typeof channelData.named_user_id!=="undefined"){this._named_user_id=channelData.named_user_id}return this._store(namedUserOnlyChange)};Channel.prototype._store=function(namedUserOnlyChange){return __awaiter(this,void 0,void 0,(function(){var dataCol,channelData,_a,event_1,e_1;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,data_collection_1.isDataCollectionEnabled()];case 1:dataCol=_b.sent();if(!dataCol){console.warn("Data collection is disabled. Skipping channel storage.");return[2,false]}channelData={channel_id:this.id,opt_in:this.optedIn,named_user_id:this._named_user_id};storage_1.default.setJSON("channel",channelData);_b.label=2;case 2:_b.trys.push([2,6,,7]);if(!!this.localeOverride)return[3,4];_a=this;return[4,locale_override_1.default.fromStorage()];case 3:_a.localeOverride=_b.sent();_b.label=4;case 4:return[4,db_1.default.set("channel",channelData)];case 5:_b.sent();if(namedUserOnlyChange&&this.namedUserChanges>MAX_NAMED_USER_CHANGES){console.error("Airship SDK: Maximum named user changes reached");return[2,false]}event_1=new CustomEvent("channel",{detail:this});this.dispatchEvent(event_1);return[2,true];case 6:e_1=_b.sent();console.error("Airship SDK: Error while storing channel",e_1);return[2,false];case 7:return[2]}}))}))};Channel.prototype._update=function(omitOptIn){if(omitOptIn===void 0){omitOptIn=true}console.warn("Channel._update() is deprecated and will be removed in the future. Please use Channel.update() instead.");return this.update(omitOptIn)};Channel.prototype.update=function(omitOptIn){if(omitOptIn===void 0){omitOptIn=true}return __awaiter(this,void 0,void 0,(function(){var channel,dataCol,e_2;return __generator(this,(function(_a){switch(_a.label){case 0:channel=this.toJSON();if(omitOptIn){delete channel.opt_in}return[4,data_collection_1.isDataCollectionEnabled()];case 1:dataCol=_a.sent();if(!dataCol){console.warn("Data collection is disabled. Skipping channel update.");return[2,false]}_a.label=2;case 2:_a.trys.push([2,4,,5]);return[4,request_1.default(this.path,{method:"put",body:{channel:channel}})];case 3:_a.sent();return[2,true];case 4:e_2=_a.sent();console.error("Airship SDK: Error while updating channel",e_2);return[2,false];case 5:return[2]}}))}))};return Channel}(event_target_shim_1.EventTarget);exports.default=Channel},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __values=this&&this.__values||function(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};Object.defineProperty(exports,"__esModule",{value:true});var event_target_shim_1=__webpack_require__(4);var debug_1=__webpack_require__(7);var request_1=__webpack_require__(8);var storage_1=__webpack_require__(9);var data_collection_1=__webpack_require__(10);var types_1=__webpack_require__(13);var DEVICE_GROUP="device";var Tags=function(_super){__extends(Tags,_super);function Tags(apiPath,getAudience,_a){var isNamedUser=_a.isNamedUser;var _this=_super.call(this)||this;_this._apiPath=apiPath;_this._tagList={};_this.tagMap=new Map;_this._getAudience=getAudience;_this._isNamedUser=isNamedUser;_this.storeName=_this._isNamedUser?"namedUserTags":"tags";_this._load();return _this}Tags.prototype.has=function(tag,group){if(group===void 0){group="device"}console.warn("Tags.has() is deprecated, and will be removed in a future version.");var groupTags=this.tagMap.get(group);return groupTags?groupTags.has(tag):false};Tags.prototype.add=function(tag,group){var _a;if(group===void 0){group=""}return __awaiter(this,void 0,void 0,(function(){var dataCol;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,data_collection_1.isDataCollectionEnabled()];case 1:dataCol=_b.sent();if(!dataCol){console.warn("Data collection is disabled. Adding tags is not allowed.");return[2,false]}group=this.groupValidator(group);if(this.has(tag,group)){return[2,true]}if(!this.tagMap.has(group)){this.tagMap.set(group,new Set([tag]))}else{(_a=this.tagMap.get(group))===null||_a===void 0?void 0:_a.add(tag)}return[2,this._send(types_1.TagAction.ADD,[tag],group)]}}))}))};Tags.prototype.remove=function(tag,group){var _a;if(group===void 0){group=""}return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_b){group=this.groupValidator(group);if(!this.has(tag,group)){return[2,true]}(_a=this.tagMap.get(group))===null||_a===void 0?void 0:_a.delete(tag);return[2,this._send(types_1.TagAction.REMOVE,[tag],group)]}))}))};Tags.prototype.clear=function(){this.tagMap=new Map;this.set([],"device")};Tags.prototype.set=function(newTags,group){if(group===void 0){group=""}return __awaiter(this,void 0,void 0,(function(){var dataCol;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,data_collection_1.isDataCollectionEnabled()];case 1:dataCol=_a.sent();if(!dataCol&&newTags.length){console.warn("Data collection is disabled. Setting tags is not allowed.");return[2,false]}group=this.groupValidator(group);this.tagMap.set(group,new Set(newTags));return[2,this._send(types_1.TagAction.SET,newTags,group)]}}))}))};Object.defineProperty(Tags.prototype,"list",{get:function(){var e_1,_a;console.warn("Tags.list is deprecated, and will be removed in a future version.");var tagObj={};try{for(var _b=__values(this.tagMap),_c=_b.next();!_c.done;_c=_b.next()){var _d=__read(_c.value,2),group=_d[0],tags=_d[1];if(tags.size){tagObj[group]=Array.from(tags)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(_c&&!_c.done&&(_a=_b.return))_a.call(_b)}finally{if(e_1)throw e_1.error}}return tagObj},enumerable:false,configurable:true});Tags.prototype._load=function(storedTags){var e_2,_a;if(storedTags===void 0){storedTags=storage_1.default.getJSON(this.storeName)}var tags=new Map;try{if(storedTags){try{for(var _b=__values(Object.keys(storedTags)),_c=_b.next();!_c.done;_c=_b.next()){var group=_c.value;tags.set(group,new Set(storedTags[group]))}}catch(e_2_1){e_2={error:e_2_1}}finally{try{if(_c&&!_c.done&&(_a=_b.return))_a.call(_b)}finally{if(e_2)throw e_2.error}}}}catch(err){debug_1.default("Error loading tags:",err)}this.tagMap=tags;return this.tagMap};Tags.prototype._send=function(verb,tags,group){return __awaiter(this,void 0,void 0,(function(){var body,response,e_3;var _a;return __generator(this,(function(_b){switch(_b.label){case 0:body={audience:this._getAudience()};body[verb]=(_a={},_a[group]=tags,_a);this._store();_b.label=1;case 1:_b.trys.push([1,3,,4]);return[4,request_1.default(this._apiPath,{method:"post",body:body})];case 2:response=_b.sent();return[2,response.ok];case 3:e_3=_b.sent();return[2,false];case 4:return[2]}}))}))};Tags.prototype.sync=function(storedTags){this._load(storedTags);this._store()};Tags.prototype._store=function(){var newTags=this.list;if(newTags!==this._tagList){storage_1.default.setJSON("tags",newTags);this._tagList=newTags;var event_1=new CustomEvent("tags",{detail:newTags});this.dispatchEvent(event_1)}};Tags.prototype.groupValidator=function(group){if(this._isNamedUser){switch(group){case"":throw Error("group is mandatory.");case"device":throw Error('"device" group is not available for a named user.')}}return group||DEVICE_GROUP};return Tags}(event_target_shim_1.EventTarget);exports.default=Tags},function(module,exports,__webpack_require__){"use strict";var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};var __spreadArray=this&&this.__spreadArray||function(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to};Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);function debug(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(config_1.default.debug){if(args.length===1&&(Array.isArray(args[0])||typeof args[0]==="object")&&console.table){return console.table(args[0])}console.log.apply(console,__spreadArray([],__read(args)))}}exports.default=debug},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var debug_1=__webpack_require__(7);function request(path,options){path=""+config_1.default.apiUrl+path;var headers={Accept:"application/vnd.urbanairship+json; version=3;"};if(config_1.default.appKey&&config_1.default.token){headers["X-UA-Appkey"]=config_1.default.appKey;headers.Authorization="Bearer "+config_1.default.token}else if(config_1.default.appKey&&config_1.default.secret){var authstr=self.btoa(config_1.default.appKey+":"+config_1.default.secret);headers.Authorization="Basic "+authstr}options.credentials="include";if(options.body){headers["Content-type"]="application/json";if(typeof options.body!=="string"){options.body=JSON.stringify(options.body)}}options.headers=options.headers||{};Object.assign(options.headers,headers);debug_1.default("REQUEST",path,options);return self.fetch(path,options)}exports.default=request},function(module,exports,__webpack_require__){"use strict";var __values=this&&this.__values||function(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var EVENT_TYPES=["tags","channel"];exports.default={set:function(key,value){var _a;return(_a=self.localStorage)===null||_a===void 0?void 0:_a.setItem(keyName(key),value)},get:function(key){var _a;return(_a=self.localStorage)===null||_a===void 0?void 0:_a.getItem(keyName(key))},setJSON:function(key,value){return this.set(key,JSON.stringify(value))},getJSON:function(key){var value=this.get(key);if(value){return JSON.parse(value)}},clear:function(){var _a;(_a=self.localStorage)===null||_a===void 0?void 0:_a.clear()},remove:function(key){var _a;return(_a=self.localStorage)===null||_a===void 0?void 0:_a.removeItem(keyName(key))},onStorage:function(ready){return function onStorage(ev){var e_1,_a;try{for(var EVENT_TYPES_1=__values(EVENT_TYPES),EVENT_TYPES_1_1=EVENT_TYPES_1.next();!EVENT_TYPES_1_1.done;EVENT_TYPES_1_1=EVENT_TYPES_1.next()){var type=EVENT_TYPES_1_1.value;var key=config_1.default.storagePrefix+":"+type;if(ev.key===key){var data={};data[type]=JSON.parse(ev.newValue||"");ready(data)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(EVENT_TYPES_1_1&&!EVENT_TYPES_1_1.done&&(_a=EVENT_TYPES_1.return))_a.call(EVENT_TYPES_1)}finally{if(e_1)throw e_1.error}}}}};function keyName(key){return config_1.default.storagePrefix+":"+key}},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.setDataCollectionEnabled=exports.isDataCollectionEnabled=void 0;var config_1=__webpack_require__(2);var db_1=__webpack_require__(11);var DATA_COLLECTION_USER_FLAG="dataCollectionEnabled";function isDataCollectionEnabled(){return __awaiter(this,void 0,void 0,(function(){var shouldAsk,enabled;return __generator(this,(function(_a){switch(_a.label){case 0:shouldAsk=config_1.default.dataCollectionOptInEnabled;return[4,db_1.default.get(DATA_COLLECTION_USER_FLAG)];case 1:enabled=_a.sent();if(enabled!==undefined){return[2,enabled]}return[4,db_1.default.set(DATA_COLLECTION_USER_FLAG,!shouldAsk)];case 2:_a.sent();return[2,!shouldAsk]}}))}))}exports.isDataCollectionEnabled=isDataCollectionEnabled;function setDataCollectionEnabled(enabled,sdk){var _a,_b,_c,_d,_e,_f;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_g){switch(_g.label){case 0:if(!!enabled)return[3,3];(_b=(_a=sdk.channel)===null||_a===void 0?void 0:_a.tags)===null||_b===void 0?void 0:_b.clear();return[4,(_d=(_c=sdk.channel)===null||_c===void 0?void 0:_c.namedUser)===null||_d===void 0?void 0:_d.remove()];case 1:_g.sent();return[4,(_e=sdk.channel)===null||_e===void 0?void 0:_e.optOut()];case 2:_g.sent();return[3,5];case 3:if(!(sdk.permission==="granted"))return[3,5];return[4,(_f=sdk.channel)===null||_f===void 0?void 0:_f.set({opt_in:true})];case 4:_g.sent();_g.label=5;case 5:return[4,db_1.default.set(DATA_COLLECTION_USER_FLAG,enabled)];case 6:_g.sent();return[2]}}))}))}exports.setDataCollectionEnabled=setDataCollectionEnabled},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var db_utils_1=__webpack_require__(12);var db=db_utils_1.default((function(){return config_1.default.storagePrefix+":db"}),"blob",{keyPath:"type"},(function(ev){var _a;return(_a=ev.target.result)===null||_a===void 0?void 0:_a.value}),1);exports.default=db},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var debug_1=__webpack_require__(7);var global;try{global=window}catch(e){global=self}function createDbModule(getDbName,store,storeOpts,resultMapper,dbVersion){var DB;function getDB(){if(DB){return DB}DB=new Promise((function(resolve,reject){var request=global.indexedDB.open(getDbName(),dbVersion);request.addEventListener("upgradeneeded",(function(ev){var db=ev.target.result;try{db.createObjectStore(store,storeOpts)}catch(err){debug_1.default('Error when "upgrading" indexedDB',err)}}));request.addEventListener("success",(function(){return resolve(request.result)}));request.addEventListener("error",(function(ev){return reject(ev)}))}));return DB}function getObjectStore(db,writable){if(writable===void 0){writable=false}var readwrite=writable?"readwrite":"readonly";return db.transaction([store],readwrite).objectStore(store)}function requestToPromise(request,success,error){if(success===void 0){success=function(ev){return ev.target.result}}if(error===void 0){error=function(ev){return ev.target.error}}return new Promise((function(resolve,reject){request.addEventListener("success",(function(ev){resolve(success(ev))}));request.addEventListener("error",(function(ev){return reject(error(ev))}))}))}function get(key){return getDB().then((function(db){return requestToPromise(getObjectStore(db).get(key),(function(ev){if(ev.target.result===undefined){return undefined}return resultMapper(ev)}))}))}function getAll(){return getDB().then((function(db){return requestToPromise(getObjectStore(db).getAll())}))}function count(){debug_1.default("Db.count(): counting db %s",getDbName());return getDB().then((function(db){return requestToPromise(getObjectStore(db).count())}))}function set(key,value){return getDB().then((function(db){if(!storeOpts.keyPath){return requestToPromise(getObjectStore(db,true).put(value,key))}return requestToPromise(getObjectStore(db,true).put({type:key,value:value}))}))}function remove(key){return getDB().then((function(db){return requestToPromise(getObjectStore(db,true).delete(key))}))}function copy(to){return __awaiter(this,void 0,void 0,(function(){var destCount,data,promises;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,to.count()];case 1:destCount=_a.sent();if(destCount){return[2,false]}return[4,getAll()];case 2:data=_a.sent();if(!(data===null||data===void 0?void 0:data.length))return[3,4];debug_1.default("Db.copy(): coppying db");promises=data.map((function(entry){return to.set(entry.type,entry.value)}));return[4,Promise.all(promises)];case 3:_a.sent();return[2,true];case 4:return[2,false]}}))}))}return{getDB:getDB,getObjectStore:getObjectStore,requestToPromise:requestToPromise,get:get,getAll:getAll,set:set,count:count,remove:remove,copy:copy}}exports.default=createDbModule},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TagAction=exports.AttributeAction=exports.NamedUserMethod=void 0;var NamedUserMethod;(function(NamedUserMethod){NamedUserMethod["ASSOCIATE"]="associate";NamedUserMethod["DISASSOCIATE"]="disassociate"})(NamedUserMethod=exports.NamedUserMethod||(exports.NamedUserMethod={}));var AttributeAction;(function(AttributeAction){AttributeAction["SET"]="set";AttributeAction["REMOVE"]="remove"})(AttributeAction=exports.AttributeAction||(exports.AttributeAction={}));var TagAction;(function(TagAction){TagAction["ADD"]="add";TagAction["SET"]="set";TagAction["REMOVE"]="remove"})(TagAction=exports.TagAction||(exports.TagAction={}))},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var request_1=__webpack_require__(8);var types_1=__webpack_require__(13);var data_collection_1=__webpack_require__(10);var Attributes=function(){function Attributes(getAudience){this._getAudience=getAudience}Attributes.prototype.set=function(attributes){return __awaiter(this,void 0,void 0,(function(){var dataCol;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,data_collection_1.isDataCollectionEnabled()];case 1:dataCol=_a.sent();if(!dataCol){console.warn("Data collection is disabled. Setting attributes is not allowed.");return[2,false]}return[2,this.send(this.buildSetPayload(attributes))]}}))}))};Attributes.prototype.remove=function(){var keys=[];for(var _i=0;_i<arguments.length;_i++){keys[_i]=arguments[_i]}return this.send(this.buildRemovePayload(keys))};Attributes.prototype.send=function(body,_a){var _b=_a===void 0?{path:config_1.default.paths.attributes,method:"post"}:_a,path=_b.path,method=_b.method;return __awaiter(this,void 0,void 0,(function(){var response,err_1;return __generator(this,(function(_c){switch(_c.label){case 0:if(body.attributes.length<1){return[2,Promise.resolve(false)]}_c.label=1;case 1:_c.trys.push([1,3,,4]);return[4,request_1.default(path,{method:method,body:body})];case 2:response=_c.sent();return[2,response.ok||Promise.reject(false)];case 3:err_1=_c.sent();return[2,Promise.reject(err_1)];case 4:return[2]}}))}))};Attributes.prototype.buildSetPayload=function(attributes){var _a=__read((new Date).toISOString().split("."),1),timestamp=_a[0];var payload=Object.entries(attributes).map((function(_a){var _b=__read(_a,2),key=_b[0],value=_b[1];value=value instanceof Date?value.toISOString().split(".")[0]:value;return{key:key,value:value,action:types_1.AttributeAction.SET,timestamp:timestamp}}));return{audience:this._getAudience(),attributes:payload}};Attributes.prototype.buildRemovePayload=function(keys){var _a=__read((new Date).toISOString().split("."),1),timestamp=_a[0];var payload=keys.map((function(key){return{key:key,action:types_1.AttributeAction.REMOVE,timestamp:timestamp}}));return{audience:this._getAudience(),attributes:payload}};return Attributes}();exports.default=Attributes},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var types_1=__webpack_require__(13);var config_1=__webpack_require__(2);var attributes_1=__webpack_require__(14);var tags_1=__webpack_require__(6);var debouncePromise=__webpack_require__(16);var utils_1=__webpack_require__(17);var NamedUser=function(){function NamedUser(_a){var _this=this;var getName=_a.getName,setName=_a.setName,getChannelId=_a.getChannelId,_b=_a.request,request=_b===void 0?utils_1.createRequest(config_1.default):_b;this._getName=getName;this._setName=setName;this._getChannelId=getChannelId;this._attributes=new attributes_1.default((function(){return{named_user_id:_this._getName()}}));this._tags=new tags_1.default(config_1.default.paths.named_user.tags,(function(){return{named_user_id:_this._getName()}}),{isNamedUser:true});this._request=request}Object.defineProperty(NamedUser.prototype,"id",{get:function(){console.warn("accessing the `id` of a named user may return a non-canonical response. its use is deprecated.");return this._getName()},enumerable:false,configurable:true});Object.defineProperty(NamedUser.prototype,"attributes",{get:function(){return this._attributes},enumerable:false,configurable:true});Object.defineProperty(NamedUser.prototype,"channelId",{get:function(){return this._getChannelId()},enumerable:false,configurable:true});Object.defineProperty(NamedUser.prototype,"tags",{get:function(){return this._tags},enumerable:false,configurable:true});NamedUser.prototype.set=function(name){var existing=this._getName();if(!name||existing===name){return Promise.resolve(false)}return this._set(name,types_1.NamedUserMethod.ASSOCIATE)};NamedUser.prototype.remove=function(){var existing=this._getName();if(!existing){return Promise.resolve(false)}return this._set(null,types_1.NamedUserMethod.DISASSOCIATE)};NamedUser.prototype._set=function(name,method){return __awaiter(this,void 0,void 0,(function(){var path,body,e_1;return __generator(this,(function(_a){switch(_a.label){case 0:path=config_1.default.paths.named_user[method];body={channel_id:this._getChannelId(),device_type:"web"};if(name){body.named_user_id=name}_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,this._request.post(path,body)];case 2:_a.sent();this._setName(name||null);return[2,true];case 3:e_1=_a.sent();return[2,false];case 4:return[2]}}))}))};return NamedUser}();NamedUser.prototype.set=debouncePromise(NamedUser.prototype.set,1e3);exports.default=NamedUser},function(module,exports,__webpack_require__){"use strict";module.exports=function debounce(fn){var wait=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var lastCallAt=void 0;var deferred=void 0;var timer=void 0;var pendingArgs=[];return function debounced(){var currentWait=getWait(wait);var currentTime=(new Date).getTime();var isCold=!lastCallAt||currentTime-lastCallAt>currentWait;lastCallAt=currentTime;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(isCold&&options.leading){return options.accumulate?Promise.resolve(fn.call(this,[args])).then((function(result){return result[0]})):Promise.resolve(fn.call.apply(fn,[this].concat(args)))}if(deferred){clearTimeout(timer)}else{deferred=defer()}pendingArgs.push(args);timer=setTimeout(flush.bind(this),currentWait);if(options.accumulate){var argsIndex=pendingArgs.length-1;return deferred.promise.then((function(results){return results[argsIndex]}))}return deferred.promise};function flush(){var thisDeferred=deferred;clearTimeout(timer);Promise.resolve(options.accumulate?fn.call(this,pendingArgs):fn.apply(this,pendingArgs[pendingArgs.length-1])).then(thisDeferred.resolve,thisDeferred.reject);pendingArgs=[];deferred=null}};function getWait(wait){return typeof wait==="function"?wait():wait}function defer(){var deferred={};deferred.promise=new Promise((function(resolve,reject){deferred.resolve=resolve;deferred.reject=reject}));return deferred}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createRequest=void 0;var _1=__webpack_require__(18);function createRequest(config){if(config.appKey&&config.token){return new _1.default({apiBase:config.apiUrl,appKey:config.appKey,type:"bearer",token:config.token})}else if(config.appKey&&config.secret){return new _1.default({apiBase:config.apiUrl,appKey:config.appKey,type:"basic",secret:config.secret})}throw new Error("invalid auth configuration: appKey and at least one of token or secret must be configured.")}exports.createRequest=createRequest},function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var arrayify_1=__webpack_require__(19);var errors_1=__webpack_require__(20);var fetch_1=__webpack_require__(21);var AirshipApiRequest=function(){function AirshipApiRequest(config){this._config=config}AirshipApiRequest.prototype.get=function(path,options){return this._jsonRequestResponse("GET",path,options)};AirshipApiRequest.prototype.put=function(path,body,options){return this._jsonRequestResponse("PUT",path,options,body)};AirshipApiRequest.prototype.post=function(path,body,options){return this._jsonRequestResponse("POST",path,options,body)};AirshipApiRequest.prototype.patch=function(path,body,options){return this._jsonRequestResponse("PATCH",path,options,body)};AirshipApiRequest.prototype.delete=function(path,options){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._requestResponse("DELETE",path,options!==null&&options!==void 0?options:{})];case 1:_a.sent();return[2]}}))}))};AirshipApiRequest.prototype._authHeaders=function(){switch(this._config.type){case"basic":return{Authorization:"Basic "+self.btoa(this._config.appKey+":"+this._config.secret)};case"bearer":return{"X-UA-Appkey":this._config.appKey,Authorization:"Bearer "+this._config.token};default:var msg=this._config;throw new Error("invalid config: "+msg)}};AirshipApiRequest.prototype._requestResponse=function(method,pathFragment,_a){var headers=_a.headers,_b=_a.queryParams,queryParams=_b===void 0?{}:_b,body=_a.body;return __awaiter(this,void 0,void 0,(function(){var path,fetchOptions,defaultHeaders,params,response;return __generator(this,(function(_c){switch(_c.label){case 0:path=new URL(""+this._config.apiBase+pathFragment);fetchOptions={method:method};defaultHeaders=__assign({Accept:AirshipApiRequest.V3_ACCEPT_HEADER},this._authHeaders());params=new URLSearchParams(path.search.slice(1));Object.keys(queryParams).forEach((function(key){arrayify_1.default(queryParams[key]).forEach((function(param){params.append(key,param.toString())}))}));path.search=params.toString();fetchOptions.credentials="include";if(body){defaultHeaders["Content-Type"]="application/json";fetchOptions.body=typeof body==="string"?body:JSON.stringify(body)}fetchOptions.headers=__assign(__assign({},defaultHeaders),headers!==null&&headers!==void 0?headers:{});return[4,fetch_1.default(path.toString(),fetchOptions)];case 1:response=_c.sent();if(!response.ok){throw new errors_1.RequestError(response.status,response.statusText)}return[2,response]}}))}))};AirshipApiRequest.prototype._jsonRequestResponse=function(method,path,_a,body){var _b=_a===void 0?{}:_a,headers=_b.headers,queryParams=_b.queryParams,predicate=_b.predicate;return __awaiter(this,void 0,void 0,(function(){var response,responseData;return __generator(this,(function(_c){switch(_c.label){case 0:return[4,this._requestResponse(method,path,{headers:headers,queryParams:queryParams,body:body})];case 1:response=_c.sent();return[4,response.json()];case 2:responseData=_c.sent();if(predicate&&!predicate(responseData)){throw new errors_1.PredicateUnsatisfiedError}return[2,responseData]}}))}))};AirshipApiRequest.V3_ACCEPT_HEADER="application/vnd.urbanairship+json; version=3;";return AirshipApiRequest}();exports.default=AirshipApiRequest},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.maybeArrayify=void 0;function arrayify(a){if(Array.isArray(a)){return a}return[a]}exports.default=arrayify;function maybeArrayify(a){if(typeof a==="undefined"){return a}if(Array.isArray(a)){return a}return[a]}exports.maybeArrayify=maybeArrayify},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.RequestError=exports.PredicateUnsatisfiedError=void 0;var PredicateUnsatisfiedError=function(_super){__extends(PredicateUnsatisfiedError,_super);function PredicateUnsatisfiedError(message){if(message===void 0){message="Predicate was not satisfied."}var _this=_super.call(this,message)||this;Object.setPrototypeOf(_this,PredicateUnsatisfiedError.prototype);if(Error.captureStackTrace){Error.captureStackTrace(_this,PredicateUnsatisfiedError)}_this.name=_this.constructor.name;return _this}return PredicateUnsatisfiedError}(TypeError);exports.PredicateUnsatisfiedError=PredicateUnsatisfiedError;var RequestError=function(_super){__extends(RequestError,_super);function RequestError(statusCode,message){if(message===void 0){message="Request Error"}var _this=_super.call(this,message)||this;_this._statusCode=statusCode;Object.setPrototypeOf(_this,RequestError.prototype);if(Error.captureStackTrace){Error.captureStackTrace(_this,RequestError)}_this.name=_this.constructor.name;return _this}Object.defineProperty(RequestError.prototype,"statusCode",{get:function(){return this._statusCode},enumerable:false,configurable:true});return RequestError}(Error);exports.RequestError=RequestError},function(module,exports,__webpack_require__){"use strict";var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};var __spreadArray=this&&this.__spreadArray||function(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to};Object.defineProperty(exports,"__esModule",{value:true});var fetch=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}return self.fetch.apply(self,__spreadArray([],__read(args)))};exports.default=fetch},function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:true});var Bowser=__webpack_require__(23);var config_1=__webpack_require__(2);var i18n_1=__webpack_require__(24);var SUPPORTED_BROWSERS=["chrome","edge","firefox","opera","safari","yandex browser"];function getRegistrationBase(localeOverride){var _a=Bowser.parse(navigator.userAgent),browser=_a.browser,platform=_a.platform;var windowOpts={};try{var _b=i18n_1.getIntlDetails(localeOverride),locale_country=_b.localeCountry,locale_language=_b.localeLanguage,timezone=_b.timezone;windowOpts={timezone:timezone,locale_country:locale_country,locale_language:locale_language}}catch(e){}var user_agent_string=navigator.userAgent;var browser_name=getBrowserName(browser.name);var browser_version=browser_name+"-"+browser.version;var browser_type=platform.type==="mobile"||platform.type==="tablet"?"mobile":"desktop";var web_sdk_version=config_1.default.VERSION;return __assign(__assign({},windowOpts),{device_type:"web",opt_in:true,web:{user_agent_string:user_agent_string,browser_name:browser_name,browser_version:browser_version,browser_type:browser_type,web_sdk_version:web_sdk_version}})}exports.default=getRegistrationBase;function getBrowserName(name){if(!name){return"unknown"}name=name.toLowerCase();if(!SUPPORTED_BROWSERS.includes(name)){return"unknown"}return name.split(" ")[0]}},function(module,exports,__webpack_require__){!function(e,t){true?module.exports=t():undefined}(this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),s=e.getVersionPrecision(r),o=Math.max(i,s),a=0,u=e.map([t,r],(function(t){var r=o-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(a=o-Math.min(i,s)),o-=1;o>=a;){if(u[0][o]>u[1][o])return 1;if(u[0][o]===u[1][o]){if(o===a)return 0;o-=1}else if(u[0][o]<u[1][o])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var a=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=s.length;t<r;t+=1)a();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0;t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"};t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"};t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"};t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"};t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},s=r(18);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){}var t,r,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],(r=null)&&o(t.prototype,r),n&&o(t,n),e}();t.default=a,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=u(r(92)),i=u(r(93)),s=u(r(94)),o=u(r(95)),a=u(r(17));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},s=0;if(Object.keys(e).forEach((function(t){var o=e[t];"string"==typeof o?(i[t]=o,s+=1):"object"==typeof o&&(r[t]=o,n+=1)})),n>0){var o=Object.keys(r),u=a.default.find(o,(function(e){return t.isOS(e)}));if(u){var d=this.satisfies(r[u]);if(void 0!==d)return d}var c=a.default.find(o,(function(e){return t.isPlatform(e)}));if(c){var f=this.satisfies(r[c]);if(void 0!==f)return f}}if(s>0){var l=Object.keys(i),h=a.default.find(l,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(i[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=a.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(a.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e){return this.isBrowser(e)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n};var s=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18);var o=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(e){var t=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return{name:s.OS_MAP.iOS,version:t}}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:s.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:s.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18);var o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18);var o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=o,e.exports=t.default}})}))},function(module,exports,__webpack_require__){"use strict";var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};Object.defineProperty(exports,"__esModule",{value:true});exports.getIntlDetails=exports.getTranslation=void 0;function getTranslation(translations,defaultLanguage){var ciTranslations=Object.keys(translations).reduce((function(acc,val){acc[val.toLowerCase()]=translations[val];return acc}),{});var locales=Object.keys(ciTranslations);var languages=window.navigator.languages.map((function(l){return l.toLowerCase()}));var exactMatch=languages.find((function(l){return locales.includes(l)}));if(exactMatch){return ciTranslations[exactMatch]}var partialMatch=locales.find((function(loc){return languages.includes(loc.substr(0,2))}));if(partialMatch){return ciTranslations[partialMatch]}return ciTranslations[defaultLanguage.toLowerCase()]||ciTranslations.en}exports.getTranslation=getTranslation;function getIntlDetails(locale){var localeOptions=Intl.DateTimeFormat().resolvedOptions();var timezone=localeOptions.timeZone;var _a=__read(localeOptions.locale.split("-"),2),browserLanguage=_a[0],browserCountry=_a[1];var localeLanguage=(locale===null||locale===void 0?void 0:locale.language)||browserLanguage;var localeCountry=(locale===null||locale===void 0?void 0:locale.country)||browserCountry;if(!localeCountry&&navigator.languages){var countryFound=navigator.languages.reduce((function(acc,lng){if(!acc){acc=lng.includes("-")?lng.split("-")[1]:null}return acc}),null);localeCountry=countryFound||""}return{localeCountry:localeCountry,localeLanguage:localeLanguage,timezone:timezone}}exports.getIntlDetails=getIntlDetails},function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var db_1=__webpack_require__(11);var LocaleOverride=function(){function LocaleOverride(locale){this._country=null;this._language=null;this._channel=null;if(locale===null||locale===void 0?void 0:locale.country){this.setCountry(locale===null||locale===void 0?void 0:locale.country)}if(locale===null||locale===void 0?void 0:locale.language){this.setLanguage(locale===null||locale===void 0?void 0:locale.language)}}Object.defineProperty(LocaleOverride.prototype,"country",{get:function(){return this._country},enumerable:false,configurable:true});Object.defineProperty(LocaleOverride.prototype,"language",{get:function(){return this._language},enumerable:false,configurable:true});LocaleOverride.getStoredLocale=function(){return __awaiter(this,void 0,void 0,(function(){var override;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,db_1.default.get("localeOverride")];case 1:override=_a.sent();return[2,{country:(override===null||override===void 0?void 0:override.locale_country)||null,language:(override===null||override===void 0?void 0:override.locale_language)||null}]}}))}))};LocaleOverride.fromStorage=function(){return __awaiter(this,void 0,void 0,(function(){var data;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,LocaleOverride.getStoredLocale()];case 1:data=_a.sent();return[2,new LocaleOverride(data)]}}))}))};LocaleOverride.prototype.setCountry=function(country){if(typeof country==="string"&&country.trim().length!==2){return Promise.reject("setCountry(): country should be two characters long")}this._country=typeof country==="string"?country.trim().toUpperCase():null;return this._store()};LocaleOverride.prototype.setLanguage=function(language){if(typeof language==="string"&&language.trim().length!==2){return Promise.reject("setLanguage(): language should be two characters long")}this._language=typeof language==="string"?language.trim().toLowerCase():null;return this._store()};LocaleOverride.prototype.set=function(locale){var promises=[];if(locale.country!==undefined){promises.push(this.setCountry(locale.country))}if(locale.language!==undefined){promises.push(this.setLanguage(locale.language))}return Promise.all(promises).then((function(){return void 0}))};LocaleOverride.prototype.setChannel=function(channel){this._channel=channel;this._channel._setLocaleOverride(this)};LocaleOverride.prototype.clear=function(){var _this=this;this._language=null;this._country=null;return db_1.default.remove("localeOverride").then((function(){var _a;return(_a=_this._channel)===null||_a===void 0?void 0:_a._store(false)})).then((function(){return void 0}))};LocaleOverride.prototype.toJSON=function(){return __assign(__assign({},this.country?{locale_country:this.country}:{}),this.language?{locale_language:this.language}:{})};LocaleOverride.prototype._store=function(){var _a,_b;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_c){switch(_c.label){case 0:return[4,db_1.default.set("localeOverride",this.toJSON())];case 1:_c.sent();return[4,(_a=this._channel)===null||_a===void 0?void 0:_a._store(false)];case 2:_c.sent();return[4,(_b=this._channel)===null||_b===void 0?void 0:_b.update()];case 3:_c.sent();return[2]}}))}))};return LocaleOverride}();exports.default=LocaleOverride},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.CachingChannelSubscriptionListClient=exports.ChannelSubscriptionListClient=exports._convertOptInStorageValue=void 0;var subscription_lists_1=__webpack_require__(27);function _convertOptInStorageValue(optIn,_a){var _b=_a===void 0?{}:_a,_c=_b.defaultValue,defaultValue=_c===void 0?true:_c;if(typeof optIn==="boolean"){return optIn}if(typeof optIn==="undefined"){return defaultValue}try{return JSON.parse(optIn)}catch(e){return defaultValue}}exports._convertOptInStorageValue=_convertOptInStorageValue;var ChannelSubscriptionListClient=function(){function ChannelSubscriptionListClient(config,request){this._config=config;this._request=request}ChannelSubscriptionListClient.prototype.listSubscriptions=function(channelId){return __awaiter(this,void 0,void 0,(function(){var path,response;return __generator(this,(function(_a){switch(_a.label){case 0:path=this._config.paths.list+"/"+channelId;return[4,this._request.get(path)];case 1:response=_a.sent();if(!response.ok){throw new Error("unexpected response")}return[2,response.list_ids]}}))}))};ChannelSubscriptionListClient.prototype.updateSubscriptions=function(channelId,mutations){return __awaiter(this,void 0,void 0,(function(){var path,body;return __generator(this,(function(_a){switch(_a.label){case 0:if(!mutations.length){return[2]}path=this._config.paths.update;body={subscription_lists:subscription_lists_1.serializeSubscriptionListMutations(mutations),audience:{web_channel:channelId}};return[4,this._request.post(path,body)];case 1:_a.sent();return[2]}}))}))};return ChannelSubscriptionListClient}();exports.ChannelSubscriptionListClient=ChannelSubscriptionListClient;var CachingChannelSubscriptionListClient=function(){function CachingChannelSubscriptionListClient(_a,client,storage){var prefix=_a.prefix,ttlMs=_a.ttlMs,_getNow=_a._getNow;this._prefix=prefix;this._ttlMs=ttlMs;this._getNow=_getNow!==null&&_getNow!==void 0?_getNow:function(){return Date.now()};this._client=client;this._storage=storage}CachingChannelSubscriptionListClient.prototype.updateSubscriptions=function(channelId,mutations){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._client.updateSubscriptions(channelId,mutations)];case 1:_a.sent();this._clearLists(channelId);return[2]}}))}))};CachingChannelSubscriptionListClient.prototype.listSubscriptions=function(channelId){return __awaiter(this,void 0,void 0,(function(){var cached,lists;return __generator(this,(function(_a){switch(_a.label){case 0:cached=this._loadLists(channelId);if(cached){return[2,cached]}return[4,this._client.listSubscriptions(channelId)];case 1:lists=_a.sent();this._storeLists(channelId,lists);return[2,lists]}}))}))};CachingChannelSubscriptionListClient.prototype._storeLists=function(channelId,lists){return __awaiter(this,void 0,void 0,(function(){var key,toStore;return __generator(this,(function(_a){key=this._listKey(channelId);toStore={expires:this._getNow()+this._ttlMs,lists:lists};this._storage.setItem(key,JSON.stringify(toStore));return[2]}))}))};CachingChannelSubscriptionListClient.prototype._loadLists=function(channelId){var key=this._listKey(channelId);var raw=this._storage.getItem(key);if(!raw){return null}var fromStore;try{fromStore=JSON.parse(raw)}catch(e){this._clearLists(channelId);return null}if(this._getNow()>fromStore.expires){this._clearLists(channelId);return null}return fromStore.lists};CachingChannelSubscriptionListClient.prototype._clearLists=function(channelId){var key=this._listKey(channelId);this._storage.removeItem(key)};CachingChannelSubscriptionListClient.prototype._listKey=function(channelId){return this._prefix+":"+channelId+":subscription_lists"};CachingChannelSubscriptionListClient.createClient=function(config,request,storage){var client=new ChannelSubscriptionListClient(config,request);return new CachingChannelSubscriptionListClient(config,client,storage)};return CachingChannelSubscriptionListClient}();exports.CachingChannelSubscriptionListClient=CachingChannelSubscriptionListClient},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.serializeSubscriptionListMutations=void 0;function serializeSubscriptionListMutations(mutations){var seen=[];return mutations.reverse().filter((function(mutation){if(seen.includes(mutation.listId)){return false}seen.push(mutation.listId);return true})).map(serializeSubscriptionListMutation).reverse()}exports.serializeSubscriptionListMutations=serializeSubscriptionListMutations;function serializeSubscriptionListMutation(mutation){return{action:mutation.action,list_id:mutation.listId,timestamp:mutation.timestamp}}},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var datetime_1=__webpack_require__(29);var errors_1=__webpack_require__(30);var ChannelSubscriptionListManager=function(){function ChannelSubscriptionListManager(client,channel,dataCollectionEnabled){this._client=client;this._channel=channel;this._datCollectionEnabled=dataCollectionEnabled}ChannelSubscriptionListManager.prototype.list=function(){return __awaiter(this,void 0,void 0,(function(){var channelId;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._channel()];case 1:channelId=_a.sent();return[2,this._client.listSubscriptions(channelId)]}}))}))};ChannelSubscriptionListManager.prototype.edit=function(){return __awaiter(this,void 0,void 0,(function(){var channelId;var _this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._channel()];case 1:channelId=_a.sent();return[2,createListEditor((function(mutations){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._datCollectionEnabled()];case 1:if(!_a.sent()){throw new errors_1.DataCollectionDisabledError}return[2,this._client.updateSubscriptions(channelId,mutations)]}}))}))}))]}}))}))};return ChannelSubscriptionListManager}();exports.default=ChannelSubscriptionListManager;function createListEditor(applyFn){var ChannelSubscriptionListEditor=function(){function ChannelSubscriptionListEditor(){this._mutations=[]}ChannelSubscriptionListEditor.prototype.apply=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,applyFn(this._mutations)];case 1:_a.sent();return[2]}}))}))};ChannelSubscriptionListEditor.prototype.subscribe=function(listId){this._mutations.push({action:"subscribe",listId:listId,timestamp:datetime_1.apiTimestamp()})};ChannelSubscriptionListEditor.prototype.unsubscribe=function(listId){this._mutations.push({action:"unsubscribe",listId:listId,timestamp:datetime_1.apiTimestamp()})};return ChannelSubscriptionListEditor}();return new ChannelSubscriptionListEditor}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.apiTimestamp=void 0;function apiTimestamp(date){var dt=date!==null&&date!==void 0?date:new Date;return dt.toISOString().split(".")[0]}exports.apiTimestamp=apiTimestamp},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.DataCollectionDisabledError=void 0;var DataCollectionDisabledError=function(_super){__extends(DataCollectionDisabledError,_super);function DataCollectionDisabledError(message){if(message===void 0){message="Data collection is not enabled."}var _this=_super.call(this,message)||this;Object.setPrototypeOf(_this,DataCollectionDisabledError.prototype);if(Error.captureStackTrace){Error.captureStackTrace(_this,DataCollectionDisabledError)}_this.name=_this.constructor.name;return _this}return DataCollectionDisabledError}(Error);exports.DataCollectionDisabledError=DataCollectionDisabledError},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __values=this&&this.__values||function(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:true});var createScript_1=__webpack_require__(32);var Plugins=function(){function Plugins(){this.plugins=new Map;this.loaders=new Map}Object.defineProperty(Plugins.prototype,"list",{get:function(){var e_1,_a;var plugins=[];try{for(var _b=__values(this.plugins.keys()),_c=_b.next();!_c.done;_c=_b.next()){var p=_c.value;plugins.push(p)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(_c&&!_c.done&&(_a=_b.return))_a.call(_b)}finally{if(e_1)throw e_1.error}}return plugins},enumerable:false,configurable:true});Plugins.prototype.load=function(name,url,opts){var _this=this;var exists=this.loaders.get(name);if(exists){return exists}var loader=new Promise((function(resolve){var setLoaded=function(loadedPlugin){resolve(loadedPlugin)};var plugin={url:url,opts:opts,setLoaded:setLoaded};_this.plugins.set(name,plugin)}));this.loaders.set(name,loader);var script=createScript_1.default(name,url);script.addEventListener("error",(function(){_this.loaders.delete(name);throw new Error("Error while loading plugin at URL: '"+url+"'")}));return loader};Plugins.prototype._setLoaded=function(name,setupFromPlugin,ua){var plugin=this.plugins.get(name);if(!plugin){throw new Error("Airship Plugin "+name+" does not match any currently loading plugins: "+this.list.join(", "))}return plugin.setLoaded(setupFromPlugin(plugin.opts,ua))};Plugins.prototype.get=function(name){return __awaiter(this,void 0,void 0,(function(){var plugin;return __generator(this,(function(_a){plugin=this.loaders.get(name);if(plugin){return[2,plugin]}throw new Error("The plugin '"+name+"' is not loaded. Make sure you have called plugins.load(...) correctly.")}))}))};return Plugins}();exports.default=Plugins},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function createScript(name,url,d){if(d===void 0){d=document}var script=d.createElement("script");script.src=url;script.async=true;script.setAttribute("rel",name);d.head.appendChild(script);return script}exports.default=createScript},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.shouldReport=exports.getSession=exports.sendSession=exports.startSession=exports.buttonClick=exports.direct=void 0;var uuid=__webpack_require__(34);var request_1=__webpack_require__(8);var storage_1=__webpack_require__(9);var db_1=__webpack_require__(11);var is_after_1=__webpack_require__(38);var get_send_id_1=__webpack_require__(39);var config_1=__webpack_require__(2);var data_collection_1=__webpack_require__(10);function direct(channel,sendId){return __awaiter(this,void 0,void 0,(function(){var shouldRep,path,body;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,shouldReport(channel.optedIn)];case 1:shouldRep=_a.sent();if(!shouldRep){return[2,false]}path=config_1.default.paths.reports.direct;body={channel:channel.toJSON(),send_id:sendId};return[2,request_1.default(path,{method:"post",body:body})]}}))}))}exports.direct=direct;function buttonClick(channel,sendId,buttonId){return __awaiter(this,void 0,void 0,(function(){var shouldRep,path,body;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,shouldReport(channel.optedIn)];case 1:shouldRep=_a.sent();if(!shouldRep){return[2,false]}path=config_1.default.paths.reports.customEvent;body={occurred:new Date(Date.now()).toISOString().split(".")[0],user:{web_channel:channel.id},send_id:sendId,body:{name:"button--"+buttonId.toLowerCase(),interaction_type:"ua_interactive_notification"}};return[2,request_1.default(path,{method:"post",body:body})]}}))}))}exports.buttonClick=buttonClick;function startSession(channel,sessionObj){return __awaiter(this,void 0,void 0,(function(){var newSession;return __generator(this,(function(_a){switch(_a.label){case 0:if(sessionObj){return[2,sendSession(channel,sessionObj)]}return[4,getSession()];case 1:newSession=_a.sent();if(newSession){return[2,sendSession(channel,newSession)]}return[2,false]}}))}))}exports.startSession=startSession;function sendSession(channel,sessionObj){return __awaiter(this,void 0,void 0,(function(){var shouldRep,body,response,e_1;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,shouldReport(channel.optedIn)];case 1:shouldRep=_a.sent();if(!shouldRep){return[2,false]}body={session_id:sessionObj.id,send_id:sessionObj.send_id,channel:channel.toJSON()};storage_1.default.setJSON("session",sessionObj);_a.label=2;case 2:_a.trys.push([2,4,,5]);return[4,request_1.default(config_1.default.paths.reports.session,{method:"post",body:body})];case 3:response=_a.sent();return[2,response.ok];case 4:e_1=_a.sent();return[2,false];case 5:return[2]}}))}))}exports.sendSession=sendSession;function getSession(){return __awaiter(this,void 0,void 0,(function(){var _a,after,store,sendId,sessionId;return __generator(this,(function(_b){switch(_b.label){case 0:_a=is_after_1.default("activity",.5),after=_a.after,store=_a.store;store();return[4,get_send_id_1.default()];case 1:sendId=_b.sent();if(sendId||after){sessionId=uuid();return[2,{id:sessionId,send_id:sendId}]}return[2]}}))}))}exports.getSession=getSession;function shouldReport(optedIn){return __awaiter(this,void 0,void 0,(function(){var analyticsDisabled;return __generator(this,(function(_a){switch(_a.label){case 0:if(!optedIn||config_1.default.disableAnalytics){return[2,false]}return[4,db_1.default.get(config_1.default.consts.DISABLE_ANALYTICS)];case 1:analyticsDisabled=_a.sent();if(analyticsDisabled){return[2,false]}return[2,data_collection_1.isDataCollectionEnabled()]}}))}))}exports.shouldReport=shouldReport},function(module,exports,__webpack_require__){var rng=__webpack_require__(35);var bytesToUuid=__webpack_require__(37);function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;++ii){buf[i+ii]=rnds[ii]}}return buf||bytesToUuid(rnds)}module.exports=v4},function(module,exports,__webpack_require__){(function(global){var rng;var crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(rnds8);return rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;rnds[i]=r>>>((i&3)<<3)&255}return rnds}}module.exports=rng}).call(this,__webpack_require__(36))},function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){if(typeof window==="object")g=window}module.exports=g},function(module,exports){var byteToHex=[];for(var i=0;i<256;++i){byteToHex[i]=(i+256).toString(16).substr(1)}function bytesToUuid(buf,offset){var i=offset||0;var bth=byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}module.exports=bytesToUuid},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var storage_1=__webpack_require__(9);function isAfter(key,hours){key="last_"+key;var HOUR=1e3*60*60;var now=+new Date;var lastActivity=storage_1.default.getJSON(key);var store=function(){return storage_1.default.setJSON(key,now)};var after=!lastActivity||now-lastActivity>HOUR*hours;return{store:store,after:after}}exports.default=isAfter},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var db_1=__webpack_require__(11);var DELTA=20*1e3;function getSendId(now){if(now===void 0){now=Date.now()}return __awaiter(this,void 0,void 0,(function(){var result;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,db_1.default.get("last_send_id")];case 1:result=_a.sent();if(!(result&&now-result.timestamp<=DELTA))return[3,3];return[4,db_1.default.remove("last_send_id")];case 2:_a.sent();return[2,result.id];case 3:return[2]}}))}))}exports.default=getSendId},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var utils_1=__webpack_require__(41);var location_1=__webpack_require__(42);var storage_1=__webpack_require__(9);var request_1=__webpack_require__(8);var reports_1=__webpack_require__(33);var config_1=__webpack_require__(2);var isIsoDate=__webpack_require__(43);var MAX_PROPERTIES_SIZE_BYTES=32768;var CustomEvent=function(){function CustomEvent(name,value,properties,transactionId){if(properties===void 0){properties={}}if(!name){throw new ReferenceError("argument: `name` is required.")}var channel=storage_1.default.getJSON("channel");if(!(channel===null||channel===void 0?void 0:channel.channel_id)){throw new ReferenceError("You must have a registered channel to send events.")}this._channel=channel;this._name=name;this.value=value;this.properties=properties;this.transactionId=transactionId;this.interactionId=location_1.default().href;this.interactionType="url"}Object.defineProperty(CustomEvent.prototype,"value",{get:function(){return this._value},set:function(value){if(value){value=Number(value);if(Number.isNaN(value)||typeof value!=="number"){throw new TypeError("`value` must be a number")}}this._value=value},enumerable:false,configurable:true});Object.defineProperty(CustomEvent.prototype,"name",{get:function(){return this._name},enumerable:false,configurable:true});CustomEvent.prototype._prepareProperties=function(){return this.properties};CustomEvent.prototype._prepareInteractionId=function(){return __awaiter(this,void 0,void 0,(function(){var buffer,hash,digest;return __generator(this,(function(_a){switch(_a.label){case 0:if(this.interactionId===location_1.default().href&&this.interactionId.length<=255){return[2,false]}buffer=new window.TextEncoder("utf-8").encode(this.interactionId);return[4,window.crypto.subtle.digest("SHA-256",buffer)];case 1:hash=_a.sent();digest=Array.from(new Uint8Array(hash)).map((function(b){return("0"+b.toString(16)).slice(-2)})).join("");this.interactionId=this.interactionId.slice(0,230)+"..."+digest.slice(0,20);return[2,true]}}))}))};CustomEvent.prototype.validate=function(){var properties=this._prepareProperties();this._validateProperties(properties);var stringProperties=["name","transactionId","interactionId","interactionId"];utils_1.checkStrings(this,stringProperties)};CustomEvent.prototype._validateProperties=function(properties){if(Array.isArray(properties)||typeof properties!=="object"){throw new TypeError("CustomEvent: properties must be an object")}var propertiesStr;try{propertiesStr=JSON.stringify(properties)}catch(e){throw new TypeError("CustomEvent: properties must be JSON serializable.")}if(propertiesStr.length>MAX_PROPERTIES_SIZE_BYTES){throw new RangeError("CustomEvent: properties are "+propertiesStr.length+" when JSON "+("encoded, exceeding the maximum of "+MAX_PROPERTIES_SIZE_BYTES+"."))}};CustomEvent.prototype._validateBooleanProperty=function(prop){if(this.properties&&this.properties.hasOwnProperty(prop)&&typeof this.properties[prop]!=="boolean"){throw new TypeError("CustomEvent property '"+prop+"' must be a Boolean")}};CustomEvent.prototype._validateIsoDateProperty=function(prop){if(this.properties&&this.properties.hasOwnProperty(prop)&&!isIsoDate(this.properties[prop])){throw new TypeError("CustomEvent property '"+prop+"' must be an ISO_8601 date string")}};CustomEvent.prototype.toJSON=function(){var session=storage_1.default.getJSON("session")||{};var user={web_channel:this._channel.channel_id};var occurred=(new Date).toISOString().split(".")[0]+"Z";var sendId=session.send_id;var properties=this._prepareProperties();var body={name:this.name,value:this.value,transaction:this.transactionId,interaction_id:this.interactionId,interaction_type:this.interactionType,template_type:this.templateType,session_id:session.id,properties:Object.keys(properties).length?properties:undefined};var json={occurred:occurred,user:user,send_id:sendId,body:body};return json};CustomEvent.prototype.track=function(){return __awaiter(this,void 0,void 0,(function(){var should,response;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,reports_1.shouldReport(this._channel.opt_in)];case 1:should=_a.sent();if(!should){return[2,{ok:false,message:"Channel is not opted in or analytics/data-collection are disabled."}]}return[4,this._prepareInteractionId()];case 2:_a.sent();this.validate();return[4,request_1.default(config_1.default.paths.custom_events,{method:"post",body:this.toJSON()})];case 3:response=_a.sent();return[2,response.json()]}}))}))};return CustomEvent}();exports.default=CustomEvent;Object.defineProperty(CustomEvent,"templates",{value:{account:__webpack_require__(44).default,media:__webpack_require__(45).default,retail:__webpack_require__(46).default}})},function(module,exports,__webpack_require__){"use strict";var __values=this&&this.__values||function(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:true});exports.checkStrings=void 0;var MAX_STRING_LENGTH=255;function checkStrings(obj,keys,name){var e_1,_a;if(name===void 0){name="CustomEvent"}try{for(var keys_1=__values(keys),keys_1_1=keys_1.next();!keys_1_1.done;keys_1_1=keys_1.next()){var str=keys_1_1.value;var val=obj[str];if(val===undefined){return}if(typeof val!=="string"){throw new TypeError(name+"."+str+" must be a string")}if(typeof val==="string"&&val.length>MAX_STRING_LENGTH){throw new RangeError(name+"."+str+" has a "+MAX_STRING_LENGTH+" character limit")}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(keys_1_1&&!keys_1_1.done&&(_a=keys_1.return))_a.call(keys_1)}finally{if(e_1)throw e_1.error}}}exports.checkStrings=checkStrings},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function getLocation(){return window.location}exports.default=getLocation},function(module,exports){module.exports=isIsodate;var matcher=new RegExp("^\\d{4}-\\d{2}-\\d{2}"+"((T\\d{2}:\\d{2}(:\\d{2})?)"+"(\\.\\d{1,6})?"+"(Z|(\\+|-)\\d{2}:\\d{2})?)?$");function isIsodate(string){return typeof string==="string"&&matcher.test(string)&&!isNaN(Date.parse(string))}},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var __1=__webpack_require__(40);var RegisterEvent=function(_super){__extends(RegisterEvent,_super);function RegisterEvent(value,properties,transactionId){if(properties===void 0){properties={}}var _this=_super.call(this,"registered_account",value,properties,transactionId)||this;_this.templateType="account";return _this}RegisterEvent.prototype._prepareProperties=function(){if(this.value){this.properties.ltv=true}return _super.prototype._prepareProperties.call(this)};return RegisterEvent}(__1.default);exports.default=RegisterEvent},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var __1=__webpack_require__(40);var MediaEvent=function(_super){__extends(MediaEvent,_super);function MediaEvent(name,value,properties,transactionId){if(properties===void 0){properties={}}var _this=_super.call(this,name,value,properties,transactionId)||this;_this.templateType="media";return _this}MediaEvent.prototype.validate=function(){this._validateBooleanProperty("feature");this._validateIsoDateProperty("published_date");_super.prototype.validate.call(this)};MediaEvent.prototype._prepareProperties=function(){if(this.value){this.properties.ltv=true}return _super.prototype._prepareProperties.call(this)};return MediaEvent}(__1.default);var BrowsedContentEvent=function(_super){__extends(BrowsedContentEvent,_super);function BrowsedContentEvent(value,properties,transactionId){if(properties===void 0){properties={}}return _super.call(this,"browsed_content",value,properties,transactionId)||this}return BrowsedContentEvent}(MediaEvent);var ConsumedContentEvent=function(_super){__extends(ConsumedContentEvent,_super);function ConsumedContentEvent(value,properties,transactionId){if(properties===void 0){properties={}}return _super.call(this,"consumed_content",value,properties,transactionId)||this}return ConsumedContentEvent}(MediaEvent);var StarredContentEvent=function(_super){__extends(StarredContentEvent,_super);function StarredContentEvent(value,properties,transactionId){if(properties===void 0){properties={}}return _super.call(this,"starred_content",value,properties,transactionId)||this}return StarredContentEvent}(MediaEvent);var SharedContentEvent=function(_super){__extends(SharedContentEvent,_super);function SharedContentEvent(source,medium,properties,transactionId){if(properties===void 0){properties={}}var _this=_super.call(this,"shared_content",undefined,properties,transactionId)||this;_this.properties.source=source;_this.properties.medium=medium;return _this}return SharedContentEvent}(MediaEvent);exports.default={_MediaEvent:MediaEvent,BrowsedContentEvent:BrowsedContentEvent,ConsumedContentEvent:ConsumedContentEvent,StarredContentEvent:StarredContentEvent,SharedContentEvent:SharedContentEvent}},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var __1=__webpack_require__(40);var RetailEvent=function(_super){__extends(RetailEvent,_super);function RetailEvent(name,value,properties,transactionId){if(properties===void 0){properties={}}var _this=_super.call(this,name,value,properties,transactionId)||this;_this.templateType="retail";return _this}RetailEvent.prototype.validate=function(){this._validateBooleanProperty("new_item");_super.prototype.validate.call(this)};return RetailEvent}(__1.default);var BrowsedEvent=function(_super){__extends(BrowsedEvent,_super);function BrowsedEvent(value,properties,transactionId){if(properties===void 0){properties={}}return _super.call(this,"browsed",value,properties,transactionId)||this}return BrowsedEvent}(RetailEvent);var AddedToCartEvent=function(_super){__extends(AddedToCartEvent,_super);function AddedToCartEvent(value,properties,transactionId){if(properties===void 0){properties={}}return _super.call(this,"added_to_cart",value,properties,transactionId)||this}return AddedToCartEvent}(RetailEvent);var PurchasedEvent=function(_super){__extends(PurchasedEvent,_super);function PurchasedEvent(value,properties,transactionId){if(properties===void 0){properties={}}return _super.call(this,"purchased",value,properties,transactionId)||this}PurchasedEvent.prototype._prepareProperties=function(){if(this.value){this.properties.ltv=true}return _super.prototype._prepareProperties.call(this)};return PurchasedEvent}(RetailEvent);var StarredProductEvent=function(_super){__extends(StarredProductEvent,_super);function StarredProductEvent(value,properties,transactionId){if(properties===void 0){properties={}}return _super.call(this,"starred_product",value,properties,transactionId)||this}return StarredProductEvent}(RetailEvent);var SharedProductEvent=function(_super){__extends(SharedProductEvent,_super);function SharedProductEvent(source,medium,properties,transactionId){if(properties===void 0){properties={}}var _this=_super.call(this,"shared_product",undefined,properties,transactionId)||this;_this.properties.source=source;_this.properties.medium=medium;return _this}return SharedProductEvent}(RetailEvent);exports.default={_RetailEvent:RetailEvent,AddedToCartEvent:AddedToCartEvent,BrowsedEvent:BrowsedEvent,PurchasedEvent:PurchasedEvent,StarredProductEvent:StarredProductEvent,SharedProductEvent:SharedProductEvent}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var is_supported_1=__webpack_require__(48);var is_secure_1=__webpack_require__(50);var is_registration_domain_1=__webpack_require__(51);function canRegister(){return Boolean(is_supported_1.default()&&is_secure_1.default()&&is_registration_domain_1.default()&&Notification.permission!=="denied")}exports.default=canRegister},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var is_safari_1=__webpack_require__(49);var config_1=__webpack_require__(2);function isSupported(){var isChrome=navigator.userAgent.match(/Chrome\/(\d\d)\./);if(isChrome&&Number(isChrome[1])<52){return false}return Boolean("PushManager"in window||is_safari_1.default()&&config_1.default.websitePushId&&"safari"in window&&"pushNotification"in window.safari)}exports.default=isSupported},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function isSafari(global){if(global===void 0){global=self}return Boolean("safari"in global||navigator.userAgent.match(/Safari/)&&!navigator.userAgent.match(/Chrome/))}exports.default=isSafari},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var location_1=__webpack_require__(42);function isSecure(){var secureContext=window.isSecureContext;if(typeof secureContext!=="undefined"){return secureContext}return Boolean(location_1.default().protocol.match("https"))}exports.default=isSecure},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);function isRegistrationDomain(){var hostname=window.location.hostname;return!config_1.default.registrationDomain||hostname===config_1.default.registrationDomain}exports.default=isRegistrationDomain},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.promiseTimeout=void 0;function promiseTimeout(timeout){return new Promise((function(resolve){setTimeout(resolve,timeout)}))}exports.promiseTimeout=promiseTimeout},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.renameDbIfNeed=void 0;var config_1=__webpack_require__(2);var db_utils_1=__webpack_require__(12);var db_1=__webpack_require__(11);function renameDbIfNeed(){return __awaiter(this,void 0,void 0,(function(){var count,oldDb;return __generator(this,(function(_a){switch(_a.label){case 0:if(!config_1.default.deprecatedStoragePrefix){return[2,false]}return[4,db_1.default.count()];case 1:count=_a.sent();if(count){return[2,false]}oldDb=db_utils_1.default((function(){return config_1.default.deprecatedStoragePrefix+":db"}),"blob",{keyPath:"type"},(function(ev){var _a;return(_a=ev.target.result)===null||_a===void 0?void 0:_a.value}),1);return[4,oldDb.copy(db_1.default)];case 2:_a.sent();return[2,true]}}))}))}exports.renameDbIfNeed=renameDbIfNeed},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var is_safari_1=__webpack_require__(49);var wait_until_active_1=__webpack_require__(55);function getWorkerRegistration(){if(!is_safari_1.default()&&navigator.serviceWorker){return navigator.serviceWorker.register(config_1.default.workerUrl).then(wait_until_active_1.default)}else{return Promise.reject("Worker registration not available in this context")}}exports.default=getWorkerRegistration},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ACTIVE_STATES=["activating","activated"];function waitUntilActive(registration){return new Promise((function(resolve,reject){if(registration.active){resolve(registration)}var inactiveWorker=registration.installing||registration.waiting;if(inactiveWorker){inactiveWorker.addEventListener("statechange",(function(){if(ACTIVE_STATES.includes(inactiveWorker.state)){resolve(registration)}}))}else{reject("Service worker in an unknown state")}}))}exports.default=waitUntilActive},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var is_safari_1=__webpack_require__(49);var subscribe_safari_1=__webpack_require__(57);var subscribe_vapid_1=__webpack_require__(58);var get_safari_data_1=__webpack_require__(61);var get_vapid_data_1=__webpack_require__(62);var get_registration_base_1=__webpack_require__(22);var locale_override_1=__webpack_require__(25);function getRegistration(workerRegistration){if(is_safari_1.default()){return subscribe_safari_1.default().then((function(sub){return locale_override_1.default.fromStorage().then((function(loc){var regBase=get_registration_base_1.default(loc);return get_safari_data_1.default(sub,regBase)}))}))}var showPerm=function(swRegistration){return Notification.requestPermission().then((function(perm){if(perm==="granted"){return swRegistration}throw new Error("Notification permission is denied.")}))};if(workerRegistration){return showPerm(workerRegistration).then(subscribe_vapid_1.default).then((function(sub){return locale_override_1.default.fromStorage().then((function(loc){var regBase=get_registration_base_1.default(loc);return get_vapid_data_1.default(sub,regBase)}))}))}return Promise.reject("Worker registration failed")}exports.default=getRegistration},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var location_1=__webpack_require__(42);function getSafariSubscription(){var websitePushId=config_1.default.websitePushId;if(typeof websitePushId!=="string"){return Promise.reject("No websitePushId configured.")}return new Promise((function(resolve,reject){window.safari.pushNotification.requestPermission(new window.URL(config_1.default.appKey+"/",config_1.default.safariServiceUrl).href,websitePushId,{},(function(data){if(data.permission==="granted"){return resolve(data)}reject("Registration failed: permission denied.\nYou may want to check that '"+location_1.default().host+"' is one of your allowed domains.")}))}))}exports.default=getSafariSubscription},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var compare_arrays_1=__webpack_require__(59);var base64_to_uint8array_1=__webpack_require__(60);function getSubscription(registration){return __awaiter(this,void 0,void 0,(function(){var vapidPublicKey,vapidKey,sub,keymatch;return __generator(this,(function(_a){switch(_a.label){case 0:vapidPublicKey=config_1.default.vapidPublicKey;if(typeof vapidPublicKey!=="string"){return[2,Promise.reject("vapidPublicKey not configured")]}vapidKey=base64_to_uint8array_1.default(vapidPublicKey);return[4,registration.pushManager.getSubscription()];case 1:sub=_a.sent();if(!sub)return[3,3];keymatch=compare_arrays_1.default(new Uint8Array(sub.options.applicationServerKey),vapidKey);if(keymatch){return[2,sub]}return[4,sub.unsubscribe()];case 2:_a.sent();_a.label=3;case 3:return[2,newSubscription(registration,vapidKey)]}}))}))}exports.default=getSubscription;function newSubscription(registration,vapidKey){return registration.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:vapidKey})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function compareArrays(a1,a2){return a1.length===a2.length&&a1.every((function(val,i){return val===a2[i]}))}exports.default=compareArrays},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function urlBase64ToUint8Array(base64String){var global;try{global=window}catch(e){global=self}var padding="=".repeat((4-base64String.length%4)%4);var base64=(base64String+padding).replace(/-/g,"+").replace(/_/g,"/");var rawData=global.atob(base64);var outputArray=new Uint8Array(rawData.length);for(var i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i)}return outputArray}exports.default=urlBase64ToUint8Array},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var get_registration_base_1=__webpack_require__(22);function getSafariData(subscription,channel){if(channel===void 0){channel=get_registration_base_1.default()}channel.push_address=subscription.permission==="granted"?subscription.deviceToken:undefined;channel.web.subscription={subscription_type:"apns"};return{channel:channel}}exports.default=getSafariData},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var get_registration_base_1=__webpack_require__(22);function getVapidData(subscription,channel){if(channel===void 0){channel=get_registration_base_1.default()}channel.push_address=subscription.endpoint;channel.web.subscription=subscription.toJSON().keys;return{channel:channel}}exports.default=getVapidData},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Bowser=__webpack_require__(23);function gestureRequired(){var _a;var browser=Bowser.parse(navigator.userAgent).browser;var browserName=((_a=browser.name)===null||_a===void 0?void 0:_a.toLowerCase())||"";var browserVersion=(browser===null||browser===void 0?void 0:browser.version)?parseFloat(browser.version):0;return browserName.includes("safari")&&browserVersion>=12.1||browserName.includes("firefox")&&browserVersion>=72}exports.default=gestureRequired},function(module,exports,__webpack_require__){"use strict";var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};Object.defineProperty(exports,"__esModule",{value:true});exports.setupIframe=exports.onBridgeMessage=exports.setupBridge=void 0;var config_1=__webpack_require__(2);var configure_1=__webpack_require__(65);var reports_1=__webpack_require__(33);var storage_1=__webpack_require__(9);var location_1=__webpack_require__(42);var db_1=__webpack_require__(11);var utils_1=__webpack_require__(67);var debug_1=__webpack_require__(7);function setupBridge(opts){if(location_1.default().protocol!=="https:"){throw new Error("The secure bridge must be run on an HTTPS domain that "+"is shared with the push registration page.")}configure_1.default(opts,true);var targetOrigin=utils_1.getTargetOrigin(opts.allowedDomains);window.addEventListener("storage",storage_1.default.onStorage(post));window.addEventListener("message",utils_1.debounceMessage(onBridgeMessage,targetOrigin));var subscriptionDomainPromise=db_1.default.get("subscriptionDomain");var channelPromise=db_1.default.get("channel");var tags=storage_1.default.getJSON("tags");return Promise.all([channelPromise,subscriptionDomainPromise]).then((function(_a){var _b=__read(_a,2),channel=_b[0],subscriptionDomain=_b[1];if(subscriptionDomain){debug_1.default("[secure-bridge] Subscription domain found in secure-bridge: %s",subscriptionDomain)}post({channel:channel,tags:tags,subscriptionDomain:subscriptionDomain});if(channel){return reports_1.getSession().then((function(session){if(session){storage_1.default.setJSON("session",session);post({session:session})}}))}}));function post(objs){window.parent.postMessage(utils_1.prefixObject(objs),targetOrigin)}}exports.setupBridge=setupBridge;function onBridgeMessage(data){if(data.tags){debug_1.default("[secure-bridge] Setting channel tags from message data: %o",data.tags);storage_1.default.setJSON("tags",data.tags)}if(data.channel){debug_1.default("[secure-bridge] Setting channel data from message data: %o",data.channel);db_1.default.set("channel",data.channel)}if(data.subscriptionDomain){debug_1.default("[secure-bridge] Setting subscriptionDomain from message data: %s",data.subscriptionDomain);db_1.default.set("subscriptionDomain",data.subscriptionDomain)}}exports.onBridgeMessage=onBridgeMessage;function setupIframe(sdk,url){debug_1.default("Setting up secure-bridge with %s",url);var secureOrigin=config_1.default.secureHost;var el=document.createElement("iframe");var ready=new Promise((function(resolve){el.onload=function(){return resolve(el)}}));var finalUrl=new URL(url);finalUrl.searchParams.append("__ua_secondary_origin",location_1.default().origin);el.style.display="none";el.src=finalUrl.toString();document.body.appendChild(el);window.addEventListener("message",onMessage);sdk.addEventListener("tags",(function(ev){queue({tags:ev.tags})}));sdk.addEventListener("channel",(function(){db_1.default.get("channel").then((function(result){queue({channel:result})}))}));sdk.addEventListener("subscriptiondomain",(function(ev){queue({subscriptionDomain:ev.detail})}));function onMessage(ev){var data=utils_1.getMessageDataFrom(ev,secureOrigin);sdk._set(data)}function queue(obj){ready.then((function(frame){var _a;debug_1.default("[main] Sending data to secure-bridge (%s): %o",secureOrigin,obj);(_a=frame.contentWindow)===null||_a===void 0?void 0:_a.postMessage(utils_1.prefixObject(obj),secureOrigin)}))}}exports.setupIframe=setupIframe},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var build_securebridge_url_1=__webpack_require__(66);function configure(opts,isSecureBridge){if(opts===void 0){opts={}}if(isSecureBridge===void 0){isSecureBridge=false}if(config_1.default.configured){return config_1.default}delete opts.paths;delete opts.consts;Object.assign(config_1.default,opts);var workerUrlObj=new URL(config_1.default.workerUrl,config_1.default.workerUrl.startsWith("/")?self.location.href:undefined);config_1.default.deprecatedStoragePrefix=self.btoa(config_1.default.storagePrefix+":"+config_1.default.appKey+":"+config_1.default.workerUrl);var workerPath=workerUrlObj.pathname.replace(/[^/]+$/,"");config_1.default.storagePrefix=self.btoa(config_1.default.storagePrefix+":"+config_1.default.appKey+":"+workerPath);config_1.default.secureBridgeUrl=build_securebridge_url_1.default(config_1.default);if(config_1.default.registrationDomain){config_1.default.secureHost="https://"+config_1.default.registrationDomain}else if(config_1.default.secureBridgeUrl){config_1.default.secureHost=new URL(config_1.default.secureBridgeUrl).origin}if(config_1.default.debug){var debugStr=isSecureBridge?"secure-bridge":"main";console.log("UA[%s] configured with:",debugStr,config_1.default)}config_1.default.configured=true;return config_1.default}exports.default=configure},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function buildSecureBridgeURL(config){if(config.secureIframeUrl||config.secureBridgeUrl){return config.secureIframeUrl||config.secureBridgeUrl}if(config.registrationDomain&&config.secureBridgePath){return new URL(config.secureBridgePath,"https://"+config.registrationDomain).href}return null}exports.default=buildSecureBridgeURL},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getTargetOrigin=exports.prefixObject=exports.getMessageDataFrom=exports.debounceMessage=void 0;var location_1=__webpack_require__(42);var config_1=__webpack_require__(2);function debounceMessage(onMessage,fromHost){var timeout;var cache={};return function call(ev){window.clearTimeout(timeout);var data=getMessageDataFrom(ev,fromHost);Object.assign(cache,data);timeout=window.setTimeout((function(){onMessage(cache);cache={}}),20)}}exports.debounceMessage=debounceMessage;function getMessageDataFrom(ev,fromHost){var data=ev.data[config_1.default.storagePrefix];if(fromHost!=="*"&&ev.origin!==fromHost||!data){return{}}return data}exports.getMessageDataFrom=getMessageDataFrom;function prefixObject(obj){var _a;var data=(_a={},_a[config_1.default.storagePrefix]=obj,_a);return data}exports.prefixObject=prefixObject;function getTargetOrigin(allowedDomains){if(Array.isArray(allowedDomains)&&allowedDomains.length){var params=new URL(location_1.default().href).searchParams;var secondaryOrigin=params.get("__ua_secondary_origin");if(!secondaryOrigin){throw new Error("Secondary origin not specified. Missing `__ua_secondary_origin` query parameter.")}if(!allowedDomains.includes(secondaryOrigin)&&secondaryOrigin!==location_1.default().origin){throw new Error("Secondary origin not allowed. Got: "+secondaryOrigin+". Allowed: "+JSON.stringify(allowedDomains))}return secondaryOrigin}return"http://"+location_1.default().host}exports.getTargetOrigin=getTargetOrigin},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};Object.defineProperty(exports,"__esModule",{value:true});var await_lock_1=__webpack_require__(69);var event_target_shim_1=__webpack_require__(4);var debug_1=__webpack_require__(7);var i18n_1=__webpack_require__(24);var errors_1=__webpack_require__(30);var attributes_1=__webpack_require__(70);var tags_1=__webpack_require__(71);var utils_1=__webpack_require__(73);var errors_2=__webpack_require__(72);var Contact=function(_super){__extends(Contact,_super);function Contact(channel,locale,emitter,storage,client,registration,flags){var _this=_super.call(this)||this;_this._channel=channel;_this._locale=locale;_this._emitter=emitter;_this._storage=storage;_this._client=client;_this._registration=registration;_this._flags=flags;_this._mutex=new await_lock_1.default;_this._ready=_this._init();_this._emitter.addEventListener("channel",(function(ev){return _this._onChannel(ev)}));return _this}Contact.prototype._init=function(){return __awaiter(this,void 0,void 0,(function(){var channel,namedUserId,_a,contactId;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,this._channel()];case 1:channel=_b.sent();return[4,this._storage.getNamedUserId()];case 2:namedUserId=_b.sent();if(!channel){debug_1.default("contact: initialized without channel");return[2]}return[4,this._migrate(channel,namedUserId)];case 3:if(_b.sent()){debug_1.default("contact: successful migration");return[2]}return[4,this._resolve(channel.id)];case 4:_a=__read.apply(void 0,[_b.sent(),1]),contactId=_a[0];return[4,this._applyPendingAttributeMutations(contactId)];case 5:_b.sent();return[4,this._applyPendingTagMutations(contactId)];case 6:_b.sent();debug_1.default("contact: initialized");return[2]}}))}))};Contact.prototype.identify=function(namedUserId){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._ready];case 1:_a.sent();return[2,this._mutex.acquireAsync().then((function(){return _this._identify(namedUserId)})).finally((function(){return _this._mutex.release()}))]}}))}))};Contact.prototype._identify=function(namedUserId){return __awaiter(this,void 0,void 0,(function(){var _a,channelId;return __generator(this,(function(_b){switch(_b.label){case 0:_a=namedUserId;return[4,this._storage.getNamedUserId()];case 1:if(_a===_b.sent()){debug_1.default("contact: identify, not setting as user is already identified");return[2]}return[4,this._nonCanonicalChannelId()];case 2:channelId=_b.sent();if(!channelId){throw new errors_2.ChannelNotPresentError}return[4,this._doIdentify(namedUserId,channelId)];case 3:_b.sent();debug_1.default("contact: identified",namedUserId,channelId);return[2]}}))}))};Contact.prototype.reset=function(){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._ready];case 1:_a.sent();return[4,this._mutex.acquireAsync().then((function(){return _this._reset()})).finally((function(){return _this._mutex.release()}))];case 2:_a.sent();return[2]}}))}))};Contact.prototype._reset=function(){return __awaiter(this,void 0,void 0,(function(){var channel;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._channel()];case 1:channel=_a.sent();return[4,this._doReset(channel===null||channel===void 0?void 0:channel.id)];case 2:_a.sent();return[2]}}))}))};Contact.prototype.editAttributes=function(){return __awaiter(this,void 0,void 0,(function(){var contactId,_a;var _this=this;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,this._ready];case 1:_b.sent();return[4,this._storage.getOrCreateContactId()];case 2:contactId=_b.sent();_a=attributes_1.default;return[4,this._storage.getPendingAttributeMutations()];case 3:return[2,_a.apply(void 0,[_b.sent(),function(mutations){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._flags.isDataCollectionEnabled()];case 1:if(!_a.sent()){throw new errors_1.DataCollectionDisabledError}return[4,this._isRelevantToAirship()];case 2:if(!!_a.sent())return[3,4];return[4,this._storage.setPendingAttributeMutations(mutations)];case 3:_a.sent();return[2];case 4:return[4,this._applyPendingAttributeMutations(contactId,mutations)];case 5:_a.sent();return[2]}}))}))}])]}}))}))};Contact.prototype._applyPendingAttributeMutations=function(contactId,mutations){return __awaiter(this,void 0,void 0,(function(){var pending,_a;return __generator(this,(function(_b){switch(_b.label){case 0:if(!(mutations!==null&&mutations!==void 0))return[3,1];_a=mutations;return[3,3];case 1:return[4,this._storage.getPendingAttributeMutations()];case 2:_a=_b.sent();_b.label=3;case 3:pending=_a;if(!pending.length)return[3,7];return[4,this._client.updateAttributes(contactId,pending)];case 4:_b.sent();return[4,this._storage.setPendingAttributeMutations([])];case 5:_b.sent();return[4,this._storage.appendAttributeMutations(contactId,pending)];case 6:_b.sent();_b.label=7;case 7:return[2]}}))}))};Contact.prototype.editTags=function(){return __awaiter(this,void 0,void 0,(function(){var contactId,_a;var _this=this;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,this._ready];case 1:_b.sent();return[4,this._storage.getOrCreateContactId()];case 2:contactId=_b.sent();_a=tags_1.default;return[4,this._storage.getPendingTagMutations()];case 3:return[2,_a.apply(void 0,[_b.sent(),function(mutations){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._flags.isDataCollectionEnabled()];case 1:if(!_a.sent()){throw new errors_1.DataCollectionDisabledError}return[4,this._isRelevantToAirship()];case 2:if(!!_a.sent())return[3,4];return[4,this._storage.setPendingTagMutations(mutations)];case 3:_a.sent();return[2];case 4:return[4,this._applyPendingTagMutations(contactId,mutations)];case 5:_a.sent();return[2]}}))}))}])]}}))}))};Contact.prototype._applyPendingTagMutations=function(contactId,mutations){return __awaiter(this,void 0,void 0,(function(){var pending,_a;return __generator(this,(function(_b){switch(_b.label){case 0:if(!(mutations!==null&&mutations!==void 0))return[3,1];_a=mutations;return[3,3];case 1:return[4,this._storage.getPendingTagMutations()];case 2:_a=_b.sent();_b.label=3;case 3:pending=_a;if(!pending.length)return[3,7];return[4,this._client.updateTags(contactId,pending)];case 4:_b.sent();return[4,this._storage.setPendingTagMutations([])];case 5:_b.sent();return[4,this._storage.appendTagMutations(contactId,pending)];case 6:_b.sent();_b.label=7;case 7:return[2]}}))}))};Contact.prototype._associateChannel=function(registrationFn){return __awaiter(this,void 0,void 0,(function(){var contactId,intl,_a,associated;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,this._ready];case 1:_b.sent();return[4,this._storage.getOrCreateContactId()];case 2:contactId=_b.sent();_a=i18n_1.getIntlDetails;return[4,this._locale()];case 3:intl=_a.apply(void 0,[_b.sent()]);return[4,registrationFn(intl)];case 4:associated=_b.sent();return[4,this._client.associateChannel(contactId,associated)];case 5:_b.sent();return[4,this._storage.appendAssociatedChannel(contactId,associated)];case 6:_b.sent();return[4,this._applyPendingAttributeMutations(contactId)];case 7:_b.sent();return[4,this._applyPendingTagMutations(contactId)];case 8:_b.sent();return[2]}}))}))};Contact.prototype.registerEmail=function(emailAddress,options){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){return[2,this._associateChannel((function(intl){return __awaiter(_this,void 0,void 0,(function(){var channelId;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._registration.registerEmail(emailAddress,__assign(__assign({},options),intl))];case 1:channelId=_a.sent();return[2,{channelId:channelId,platform:"email"}]}}))}))}))]}))}))};Contact.prototype.registerSms=function(msisdn,options){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){return[2,this._associateChannel((function(intl){return __awaiter(_this,void 0,void 0,(function(){var channelId;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._registration.registerSms(msisdn,__assign(__assign({},options),intl))];case 1:channelId=_a.sent();return[2,{channelId:channelId,platform:"sms"}]}}))}))}))]}))}))};Contact.prototype.registerOpen=function(address,options){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){return[2,this._associateChannel((function(intl){return __awaiter(_this,void 0,void 0,(function(){var channelId;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._registration.registerOpen(address,__assign(__assign({},options),intl))];case 1:channelId=_a.sent();return[2,{channelId:channelId,platform:"open"}]}}))}))}))]}))}))};Contact.prototype._migrate=function(channel,namedUserId){return __awaiter(this,void 0,void 0,(function(){var oldNamedUserId,_a,isAnonymous;return __generator(this,(function(_b){switch(_b.label){case 0:oldNamedUserId=channel===null||channel===void 0?void 0:channel.named_user_id;if(!oldNamedUserId){debug_1.default("contact: no old nu, no migration needed");return[2,false]}if(oldNamedUserId===namedUserId){debug_1.default("contact: old nu matches new nu, no migration needed");return[2,false]}return[4,this._resolve(channel.id,true)];case 1:_a=__read.apply(void 0,[_b.sent(),2]),isAnonymous=_a[1];if(isAnonymous){debug_1.default("contact: migration for existing user resolved to anonymous");return[2,false]}return[4,this._storage.setNamedUserId(oldNamedUserId)];case 2:_b.sent();return[2,true]}}))}))};Contact.prototype._resolve=function(channelId,force){return __awaiter(this,void 0,void 0,(function(){var existingContactId,namedUserId,_a,_b,newContactId,isAnonymous,contactIdSame,namedUserStatusSame;return __generator(this,(function(_c){switch(_c.label){case 0:return[4,this._storage.getOrCreateContactId()];case 1:existingContactId=_c.sent();return[4,this._storage.getNamedUserId()];case 2:namedUserId=_c.sent();_a=!force;if(!_a)return[3,4];return[4,this._storage.sessionResolved()];case 3:_a=_c.sent();_c.label=4;case 4:if(_a){return[2,[existingContactId,!namedUserId]]}return[4,this._client.resolve(channelId)];case 5:_b=__read.apply(void 0,[_c.sent(),2]),newContactId=_b[0],isAnonymous=_b[1];return[4,this._storage.setSessionResolved(true)];case 6:_c.sent();contactIdSame=existingContactId===newContactId;namedUserStatusSame=!namedUserId===isAnonymous;if(contactIdSame&&namedUserStatusSame){return[2,[newContactId,isAnonymous]]}return[4,this._storage.setContactId(newContactId)];case 7:_c.sent();if(!isAnonymous)return[3,9];return[4,this._storage.clearNamedUserId()];case 8:_c.sent();_c.label=9;case 9:return[4,this._maybeEmitConflict(existingContactId,namedUserId)];case 10:_c.sent();return[2,[newContactId,isAnonymous]]}}))}))};Contact.prototype._doIdentify=function(namedUserId,channelId){return __awaiter(this,void 0,void 0,(function(){var existingContactId,newContactId;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._storage.getOrCreateContactId()];case 1:existingContactId=_a.sent();return[4,this._client.identify(namedUserId,channelId,{contactId:existingContactId})];case 2:newContactId=_a.sent();if(!(existingContactId!==newContactId))return[3,4];return[4,this._maybeEmitConflict(existingContactId)];case 3:_a.sent();_a.label=4;case 4:return[4,this._storage.setContactId(newContactId)];case 5:_a.sent();return[4,this._storage.setNamedUserId(namedUserId)];case 6:_a.sent();return[4,this._storage.setSessionResolved(true)];case 7:_a.sent();return[2]}}))}))};Contact.prototype._doReset=function(channelId){return __awaiter(this,void 0,void 0,(function(){var existingContactId,newContactId,_a,_b;return __generator(this,(function(_c){switch(_c.label){case 0:return[4,this._storage.getOrCreateContactId()];case 1:existingContactId=_c.sent();if(!channelId)return[3,3];return[4,this._client.reset(channelId)];case 2:newContactId=_c.sent();return[3,5];case 3:return[4,this._storage.clearContactId()];case 4:newContactId=_c.sent();_c.label=5;case 5:if(!(existingContactId!==newContactId))return[3,8];_a=this._maybeEmitConflict;_b=[existingContactId];return[4,this._storage.getNamedUserId()];case 6:return[4,_a.apply(this,_b.concat([_c.sent()]))];case 7:_c.sent();_c.label=8;case 8:return[4,this._storage.setContactId(newContactId)];case 9:_c.sent();return[4,this._storage.clearNamedUserId()];case 10:_c.sent();return[4,this._storage.setPendingAttributeMutations([])];case 11:_c.sent();return[4,this._storage.setPendingTagMutations([])];case 12:_c.sent();return[2]}}))}))};Contact.prototype._onChannel=function(ev){return __awaiter(this,void 0,void 0,(function(){var channel,_a,contactId,event;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,this._ready];case 1:_b.sent();channel=ev.detail;if(!channel){return[2]}return[4,this._isRelevantToAirship()];case 2:if(!_b.sent()){return[2]}return[4,this._resolve(channel.id)];case 3:_a=__read.apply(void 0,[_b.sent(),1]),contactId=_a[0];return[4,this._applyPendingAttributeMutations(contactId)];case 4:_b.sent();return[4,this._applyPendingTagMutations(contactId)];case 5:_b.sent();event=new CustomEvent("_channel_handled");this.dispatchEvent(event);return[2]}}))}))};Contact.prototype._maybeEmitConflict=function(conflictingContactId,namedUserId){return __awaiter(this,void 0,void 0,(function(){var attributeMutations,tagMutations,associatedChannels,detail,event;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._storage.getAttributeMutations(conflictingContactId)];case 1:attributeMutations=_a.sent();return[4,this._storage.getTagMutations(conflictingContactId)];case 2:tagMutations=_a.sent();return[4,this._storage.getAssociatedChannels(conflictingContactId)];case 3:associatedChannels=_a.sent();if(!namedUserId&&!attributeMutations.length&&!tagMutations.length&&!associatedChannels.length){return[2]}detail={namedUserId:namedUserId,attributes:utils_1.serializeAttributeMutations(attributeMutations),tags:utils_1.serializeTagMutations(tagMutations),associatedChannels:associatedChannels};event=new CustomEvent("conflict",{detail:detail});this.dispatchEvent(event);return[2]}}))}))};Object.defineProperty(Contact.prototype,"ready",{get:function(){return this._ready},enumerable:false,configurable:true});Contact.prototype._isRelevantToAirship=function(){return __awaiter(this,void 0,void 0,(function(){var channel,contactId,associated;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._channel()];case 1:channel=_a.sent();return[4,this._storage.getOrCreateContactId()];case 2:contactId=_a.sent();return[4,this._storage.getAssociatedChannels(contactId)];case 3:associated=_a.sent();return[2,!!channel||!!associated.length]}}))}))};Contact.prototype._nonCanonicalChannelId=function(){var _a;return __awaiter(this,void 0,void 0,(function(){var channel,contactId,associated;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,this._channel()];case 1:channel=_b.sent();if(channel){return[2,channel.id]}return[4,this._storage.getOrCreateContactId()];case 2:contactId=_b.sent();return[4,this._storage.getAssociatedChannels(contactId)];case 3:associated=_b.sent();return[2,(_a=associated[0])===null||_a===void 0?void 0:_a.channelId]}}))}))};return Contact}(event_target_shim_1.EventTarget);exports.default=Contact},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});class AwaitLock{constructor(){this._acquired=false;this._waitingResolvers=[]}get acquired(){return this._acquired}acquireAsync(){if(!this._acquired){this._acquired=true;return Promise.resolve()}return new Promise(resolve=>{this._waitingResolvers.push(resolve)})}tryAcquire(){if(!this._acquired){this._acquired=true;return true}return false}release(){if(!this._acquired){throw new Error(`Cannot release an unacquired lock`)}if(this._waitingResolvers.length>0){let resolve=this._waitingResolvers.shift();resolve()}else{this._acquired=false}}}exports.default=AwaitLock},function(module,exports,__webpack_require__){"use strict";var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};var __spreadArray=this&&this.__spreadArray||function(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to};Object.defineProperty(exports,"__esModule",{value:true});var datetime_1=__webpack_require__(29);function createAttributeEditor(initialMutations,applyFn){var AttributeEditorInstance=function(){function AttributeEditorInstance(){this._mutations=__spreadArray([],__read(initialMutations))}AttributeEditorInstance.prototype.apply=function(){return applyFn(this._mutations)};AttributeEditorInstance.prototype.remove=function(key){this._mutations.push({action:"remove",key:key,timestamp:datetime_1.apiTimestamp()})};AttributeEditorInstance.prototype.set=function(key,value){this._mutations.push({action:"set",key:key,value:value,timestamp:datetime_1.apiTimestamp()})};return AttributeEditorInstance}();return new AttributeEditorInstance}exports.default=createAttributeEditor},function(module,exports,__webpack_require__){"use strict";var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};var __spreadArray=this&&this.__spreadArray||function(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to};Object.defineProperty(exports,"__esModule",{value:true});var datetime_1=__webpack_require__(29);var errors_1=__webpack_require__(72);var FORBIDDEN_TAG_GROUPS=["device"];var FORBIDDEN_TAG_GROUP_PREFIXES=["ua_"];function createTagEditor(initialMutations,applyFn){var TagEditorInstance=function(){function TagEditorInstance(){this._mutations=__spreadArray([],__read(initialMutations))}TagEditorInstance.prototype.apply=function(){return applyFn(this._mutations)};TagEditorInstance.prototype.add=function(group,tag){checkGroup(group);var tags=Array.isArray(tag)?tag:[tag];this._mutations.push({action:"add",tags:tags,group:group,timestamp:datetime_1.apiTimestamp()})};TagEditorInstance.prototype.remove=function(group,tag){checkGroup(group);var tags=Array.isArray(tag)?tag:[tag];this._mutations.push({action:"remove",tags:tags,group:group,timestamp:datetime_1.apiTimestamp()})};TagEditorInstance.prototype.set=function(group,tag){checkGroup(group);var tags=Array.isArray(tag)?tag:[tag];this._mutations.push({action:"set",tags:tags,group:group,timestamp:datetime_1.apiTimestamp()})};return TagEditorInstance}();return new TagEditorInstance}exports.default=createTagEditor;function checkGroup(group){if(FORBIDDEN_TAG_GROUPS.includes(group)){throw new errors_1.InvalidTagGroupError("invalid tag group for contact: "+group)}if(FORBIDDEN_TAG_GROUP_PREFIXES.some((function(prefix){return group.startsWith(prefix)}))){throw new errors_1.InvalidTagGroupError("forbidden tag group prefix for contact: "+group)}}},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.InvalidTagGroupError=exports.ChannelNotPresentError=void 0;var ChannelNotPresentError=function(_super){__extends(ChannelNotPresentError,_super);function ChannelNotPresentError(message){if(message===void 0){message="Cannot perform this operation without an associated channel."}var _this=_super.call(this,message)||this;Object.setPrototypeOf(_this,ChannelNotPresentError.prototype);if(Error.captureStackTrace){Error.captureStackTrace(_this,ChannelNotPresentError)}_this.name=_this.constructor.name;return _this}return ChannelNotPresentError}(Error);exports.ChannelNotPresentError=ChannelNotPresentError;var InvalidTagGroupError=function(_super){__extends(InvalidTagGroupError,_super);function InvalidTagGroupError(message){if(message===void 0){message="Invalid tag group."}var _this=_super.call(this,message)||this;Object.setPrototypeOf(_this,InvalidTagGroupError.prototype);if(Error.captureStackTrace){Error.captureStackTrace(_this,InvalidTagGroupError)}_this.name=_this.constructor.name;return _this}return InvalidTagGroupError}(Error);exports.InvalidTagGroupError=InvalidTagGroupError},function(module,exports,__webpack_require__){"use strict";var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};var __spreadArray=this&&this.__spreadArray||function(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to};Object.defineProperty(exports,"__esModule",{value:true});exports.serializeTagMutations=exports.serializeAttributeMutations=void 0;var types_1=__webpack_require__(13);function serializeAttributeMutations(mutations){var seen=[];return mutations.reverse().filter((function(mutation){if(seen.includes(mutation.key)){return false}seen.push(mutation.key);return true})).map(serializeAttributeMutation).reverse()}exports.serializeAttributeMutations=serializeAttributeMutations;function serializeTagMutations(mutations){var add={};var remove={};var set={};mutations.forEach((function(mutation){switch(mutation.action){case"add":if(!add[mutation.group]){add[mutation.group]=new Set}mutation.tags.forEach((function(t){add[mutation.group].add(t);if(remove[mutation.group]){remove[mutation.group].delete(t)}}));return;case"remove":if(!remove[mutation.group]){remove[mutation.group]=new Set}mutation.tags.forEach((function(t){remove[mutation.group].add(t);if(add[mutation.group]){add[mutation.group].delete(t)}}));return;case"set":if(!set[mutation.group]){set[mutation.group]=new Set}delete add[mutation.group];delete remove[mutation.group];mutation.tags.forEach((function(t){return set[mutation.group].add(t)}));return;default:var msg=mutation;throw new Error("invalid tag mutation action: "+msg)}}));return{add:serializeTagMutation(add),remove:serializeTagMutation(remove),set:serializeTagMutation(set)}}exports.serializeTagMutations=serializeTagMutations;function serializeAttributeMutation(mutation){switch(mutation.action){case"set":return{action:types_1.AttributeAction.SET,key:mutation.key,value:mutation.value,timestamp:mutation.timestamp};case"remove":return{action:types_1.AttributeAction.REMOVE,key:mutation.key,timestamp:mutation.timestamp};default:var msg=mutation;throw new Error("invalid attribute mutation action: "+msg)}}function serializeTagMutation(mutation){var result={};Object.keys(mutation).forEach((function(key){var values=__spreadArray([],__read(mutation[key].values()));if(values.length){result[key]=values}}));return Object.keys(result).length?result:undefined}},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};var __spreadArray=this&&this.__spreadArray||function(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to};Object.defineProperty(exports,"__esModule",{value:true});var uuid=__webpack_require__(34);var CONTACT_ID_KEY="contact.id";var CONTACT_NAME_KEY="contact.name";var PENDING_TAG_MUTATIONS_KEY="contact.pending_tag_mutations";var PENDING_ATTRIBUTE_MUTATIONS_KEY="contact.pending_attribute_mutations";var TAG_MUTATIONS_KEY_FN=function(contactId){return"contact."+contactId+".tag_mutations"};var ATTRIBUTE_MUTATIONS_KEY_FN=function(contactId){return"contact."+contactId+".attribute_mutations"};var SESSION_RESOLVED_KEY="session_resolved_timestamp";var ASSOCIATED_CHANNELS_KEY_FN=function(contactId){return"contact."+contactId+".associated_channels"};var ContactStorage=function(){function ContactStorage(_a,db,session){var prefix=_a.prefix,sessionLengthMs=_a.sessionLengthMs,_getNow=_a._getNow;this._db=db;this._session=session;this._prefix=prefix;this._sessionLengthMs=sessionLengthMs;this._getNow=_getNow!==null&&_getNow!==void 0?_getNow:function(){return Date.now()}}ContactStorage.prototype._key=function(key){return this._prefix+":"+key};ContactStorage.prototype.sessionResolved=function(){var _a,_b;return __awaiter(this,void 0,void 0,(function(){var key,raw,value;return __generator(this,(function(_c){key=this._key(SESSION_RESOLVED_KEY);raw=(_a=this._session)===null||_a===void 0?void 0:_a.getItem(key);if(!raw){return[2,false]}value=Number.parseInt(raw,10);if(Number.isNaN(value)){(_b=this._session)===null||_b===void 0?void 0:_b.removeItem(key);return[2,false]}return[2,this._getNow()-value<this._sessionLengthMs]}))}))};ContactStorage.prototype.setSessionResolved=function(resolved){var _a,_b;return __awaiter(this,void 0,void 0,(function(){var key;return __generator(this,(function(_c){key=this._key(SESSION_RESOLVED_KEY);return[2,resolved?(_a=this._session)===null||_a===void 0?void 0:_a.setItem(key,String(this._getNow())):(_b=this._session)===null||_b===void 0?void 0:_b.removeItem(key)]}))}))};ContactStorage.prototype.getOrCreateContactId=function(){return __awaiter(this,void 0,void 0,(function(){var id;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.get(CONTACT_ID_KEY)];case 1:id=_a.sent();if(!!id)return[3,3];id=uuid();return[4,this.setContactId(id)];case 2:_a.sent();_a.label=3;case 3:return[2,id]}}))}))};ContactStorage.prototype.setContactId=function(id){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.set(CONTACT_ID_KEY,id)];case 1:_a.sent();return[2]}}))}))};ContactStorage.prototype.clearContactId=function(){return __awaiter(this,void 0,void 0,(function(){var id;return __generator(this,(function(_a){switch(_a.label){case 0:id=uuid();return[4,this._db.set(CONTACT_ID_KEY,id)];case 1:_a.sent();return[2,id]}}))}))};ContactStorage.prototype.getNamedUserId=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.get(CONTACT_NAME_KEY)];case 1:return[2,_a.sent()]}}))}))};ContactStorage.prototype.setNamedUserId=function(id){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.set(CONTACT_NAME_KEY,id)];case 1:_a.sent();return[2]}}))}))};ContactStorage.prototype.clearNamedUserId=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.remove(CONTACT_NAME_KEY)];case 1:_a.sent();return[2]}}))}))};ContactStorage.prototype.getPendingTagMutations=function(){return __awaiter(this,void 0,void 0,(function(){var mutations;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.get(PENDING_TAG_MUTATIONS_KEY)];case 1:mutations=_a.sent();return[2,mutations!==null&&mutations!==void 0?mutations:[]]}}))}))};ContactStorage.prototype.setPendingTagMutations=function(mutations){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.set(PENDING_TAG_MUTATIONS_KEY,mutations)];case 1:_a.sent();return[2]}}))}))};ContactStorage.prototype.appendTagMutations=function(contactId,mutations){return __awaiter(this,void 0,void 0,(function(){var existing;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.getTagMutations(contactId)];case 1:existing=_a.sent();return[4,this._db.set(TAG_MUTATIONS_KEY_FN(contactId),existing.concat.apply(existing,__spreadArray([],__read(mutations))))];case 2:_a.sent();return[2]}}))}))};ContactStorage.prototype.getTagMutations=function(contactId){return __awaiter(this,void 0,void 0,(function(){var mutations;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.get(TAG_MUTATIONS_KEY_FN(contactId))];case 1:mutations=_a.sent();return[2,mutations!==null&&mutations!==void 0?mutations:[]]}}))}))};ContactStorage.prototype.getPendingAttributeMutations=function(){return __awaiter(this,void 0,void 0,(function(){var mutations;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.get(PENDING_ATTRIBUTE_MUTATIONS_KEY)];case 1:mutations=_a.sent();return[2,mutations!==null&&mutations!==void 0?mutations:[]]}}))}))};ContactStorage.prototype.setPendingAttributeMutations=function(mutations){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.set(PENDING_ATTRIBUTE_MUTATIONS_KEY,mutations)];case 1:_a.sent();return[2]}}))}))};ContactStorage.prototype.appendAttributeMutations=function(contactId,mutations){return __awaiter(this,void 0,void 0,(function(){var existing;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.getAttributeMutations(contactId)];case 1:existing=_a.sent();return[4,this._db.set(ATTRIBUTE_MUTATIONS_KEY_FN(contactId),existing.concat.apply(existing,__spreadArray([],__read(mutations))))];case 2:_a.sent();return[2]}}))}))};ContactStorage.prototype.getAttributeMutations=function(contactId){return __awaiter(this,void 0,void 0,(function(){var mutations;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.get(ATTRIBUTE_MUTATIONS_KEY_FN(contactId))];case 1:mutations=_a.sent();return[2,mutations!==null&&mutations!==void 0?mutations:[]]}}))}))};ContactStorage.prototype.getAssociatedChannels=function(contactId){return __awaiter(this,void 0,void 0,(function(){var channels;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.get(ASSOCIATED_CHANNELS_KEY_FN(contactId))];case 1:channels=_a.sent();return[2,channels!==null&&channels!==void 0?channels:[]]}}))}))};ContactStorage.prototype.appendAssociatedChannel=function(contactId,channel){return __awaiter(this,void 0,void 0,(function(){var channels;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.getAssociatedChannels(contactId)];case 1:channels=_a.sent();return[4,this._db.set(ASSOCIATED_CHANNELS_KEY_FN(contactId),__spreadArray(__spreadArray([],__read(channels)),[channel]))];case 2:_a.sent();return[2]}}))}))};ContactStorage.prototype.clearAssociatedChannels=function(contactId){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._db.remove(ASSOCIATED_CHANNELS_KEY_FN(contactId))];case 1:_a.sent();return[2]}}))}))};return ContactStorage}();exports.default=ContactStorage},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var utils_1=__webpack_require__(73);var ContactClient=function(){function ContactClient(config,requester){this._config=config;this._request=requester}ContactClient.prototype.identify=function(id,channelId,_a){var _b=_a===void 0?{}:_a,_c=_b.platform,platform=_c===void 0?"web":_c,contactId=_b.contactId;return __awaiter(this,void 0,void 0,(function(){var path,body,response;return __generator(this,(function(_d){switch(_d.label){case 0:path=this._config.paths.identify;body={named_user_id:id,channel_id:channelId,device_type:platform};if(contactId){body.contact_id=contactId}return[4,this._request.post(path,body)];case 1:response=_d.sent();return[2,response.contact_id]}}))}))};ContactClient.prototype.resolve=function(channelId,_a){var _b=_a===void 0?{}:_a,_c=_b.platform,platform=_c===void 0?"web":_c;return __awaiter(this,void 0,void 0,(function(){var path,body,response;return __generator(this,(function(_d){switch(_d.label){case 0:path=this._config.paths.resolve;body={channel_id:channelId,device_type:platform};return[4,this._request.post(path,body)];case 1:response=_d.sent();return[2,[response.contact_id,response.is_anonymous]]}}))}))};ContactClient.prototype.reset=function(channelId,_a){var _b=_a===void 0?{}:_a,_c=_b.platform,platform=_c===void 0?"web":_c;return __awaiter(this,void 0,void 0,(function(){var path,body,response;return __generator(this,(function(_d){switch(_d.label){case 0:path=this._config.paths.reset;body={channel_id:channelId,device_type:platform};return[4,this._request.post(path,body)];case 1:response=_d.sent();return[2,response.contact_id]}}))}))};ContactClient.prototype.updateAttributes=function(contactId,attributes){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this._batch(contactId,{attributes:attributes})]}))}))};ContactClient.prototype.updateTags=function(contactId,tags){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this._batch(contactId,{tags:tags})]}))}))};ContactClient.prototype._batch=function(contactId,_a){var _b=_a.attributes,attributes=_b===void 0?[]:_b,_c=_a.tags,tags=_c===void 0?[]:_c,_d=_a.associate,associate=_d===void 0?[]:_d;return __awaiter(this,void 0,void 0,(function(){var path,body;return __generator(this,(function(_e){switch(_e.label){case 0:path=this._config.paths.batch+"/"+contactId;body={};if(attributes.length){body.attributes=utils_1.serializeAttributeMutations(attributes)}if(tags.length){body.tags=utils_1.serializeTagMutations(tags)}if(associate.length){body.associate=associate.map((function(c){return{channel_id:c.channelId,device_type:c.platform}}))}return[4,this._request.post(path,body)];case 1:_e.sent();return[2]}}))}))};ContactClient.prototype.associateChannel=function(contactId,channel){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this._batch(contactId,{associate:[channel]})]}))}))};return ContactClient}();exports.default=ContactClient},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Deferred=function(){function Deferred(){var _this=this;this.promise=new Promise((function(resolve,reject){_this.resolve=resolve;_this.reject=reject}))}return Deferred}();exports.default=Deferred},function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var datetime_1=__webpack_require__(29);var RegistrationClient=function(){function RegistrationClient(config,requester){this._config=config;this._request=requester}RegistrationClient.prototype.registerEmail=function(address,options){return __awaiter(this,void 0,void 0,(function(){var payload;return __generator(this,(function(_a){payload=__assign({type:"email",address:address,commercial_opted_in:optionalTimestamp(options.commercialOptedIn),transactional_opted_in:optionalTimestamp(options.transactionalOptedIn)},serializeRegistrationOptions(options));return[2,this._register(this._config.paths.email,payload)]}))}))};RegistrationClient.prototype.registerSms=function(msisdn,options){return __awaiter(this,void 0,void 0,(function(){var payload;return __generator(this,(function(_a){payload=__assign({msisdn:msisdn,sender:options.senderId},serializeRegistrationOptions(options));return[2,this._register(this._config.paths.sms,payload)]}))}))};RegistrationClient.prototype.registerOpen=function(address,options){return __awaiter(this,void 0,void 0,(function(){var payload;return __generator(this,(function(_a){payload=__assign({type:"open",address:address,opt_in:true,open:{open_platform_name:options.platformName,identifiers:options.identifiers}},serializeRegistrationOptions(options));return[2,this._register(this._config.paths.open,payload)]}))}))};RegistrationClient.prototype._register=function(path,registration){return __awaiter(this,void 0,void 0,(function(){var body,response;return __generator(this,(function(_a){switch(_a.label){case 0:body={channel:registration};return[4,this._request.post(path,body)];case 1:response=_a.sent();return[2,response.channel_id]}}))}))};return RegistrationClient}();exports.default=RegistrationClient;function serializeRegistrationOptions(options){return{timezone:options.timezone,locale_country:options.localeCountry,locale_language:options.localeLanguage}}function optionalTimestamp(dt){if(!dt){return}return datetime_1.apiTimestamp(dt)}},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var RemoteData=function(){function RemoteData(_a,client,locale,storage){var cacheTtlMs=_a.cacheTtlMs,prefix=_a.prefix,_getNow=_a._getNow;this._cacheTtlms=cacheTtlMs;this._prefix=prefix;this._getNow=_getNow!==null&&_getNow!==void 0?_getNow:function(){return Date.now()};this._client=client;this._locale=locale;this._storage=storage}RemoteData.prototype.get=function(){return __awaiter(this,void 0,void 0,(function(){var cached,data,_a,_b;var _c;return __generator(this,(function(_d){switch(_d.label){case 0:return[4,this._loadData()];case 1:cached=_d.sent();if(cached){return[2,cached]}_b=(_a=this._client).get;_c={};return[4,this._locale()];case 2:return[4,_b.apply(_a,[(_c.locale=_d.sent(),_c)])];case 3:data=_d.sent();return[4,this._storeData(data)];case 4:_d.sent();return[2,data]}}))}))};RemoteData.prototype._loadData=function(){return __awaiter(this,void 0,void 0,(function(){var key,_a,_b,_c,raw,fromStore;return __generator(this,(function(_d){switch(_d.label){case 0:_b=(_a=RemoteData)._cacheKey;_c=[this._prefix];return[4,this._locale()];case 1:key=_b.apply(_a,_c.concat([_d.sent()]));raw=this._storage.getItem(key);if(!raw){return[2,null]}try{fromStore=JSON.parse(raw)}catch(e){this._clearData();return[2,null]}if(this._getNow()>fromStore.expires){this._clearData();return[2,null]}return[2,fromStore.data]}}))}))};RemoteData.prototype._storeData=function(data){return __awaiter(this,void 0,void 0,(function(){var key,_a,_b,_c,toStore;return __generator(this,(function(_d){switch(_d.label){case 0:_b=(_a=RemoteData)._cacheKey;_c=[this._prefix];return[4,this._locale()];case 1:key=_b.apply(_a,_c.concat([_d.sent()]));toStore={expires:this._getNow()+this._cacheTtlms,data:data};this._storage.setItem(key,JSON.stringify(toStore));return[2]}}))}))};RemoteData.prototype._clearData=function(){return __awaiter(this,void 0,void 0,(function(){var key,_a,_b,_c;return __generator(this,(function(_d){switch(_d.label){case 0:_b=(_a=RemoteData)._cacheKey;_c=[this._prefix];return[4,this._locale()];case 1:key=_b.apply(_a,_c.concat([_d.sent()]));this._storage.removeItem(key);return[2]}}))}))};RemoteData._cacheKey=function(prefix,locale){var _a,_b;var localeString=[(_a=locale.language)!==null&&_a!==void 0?_a:"default",(_b=locale.country)!==null&&_b!==void 0?_b:"default"].join("-");return prefix+":remote_data:"+localeString};return RemoteData}();exports.default=RemoteData},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __values=this&&this.__values||function(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:true});var client_1=__webpack_require__(80);var PreferenceCenters=function(){function PreferenceCenters(remote){this._remote=remote}PreferenceCenters.prototype.get=function(id){return __awaiter(this,void 0,void 0,(function(){var preferenceCenters,preferenceCenters_1,preferenceCenters_1_1,pref;var e_1,_a;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,this.list()];case 1:preferenceCenters=_b.sent();try{for(preferenceCenters_1=__values(preferenceCenters),preferenceCenters_1_1=preferenceCenters_1.next();!preferenceCenters_1_1.done;preferenceCenters_1_1=preferenceCenters_1.next()){pref=preferenceCenters_1_1.value;if(pref.id===id){return[2,pref]}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(preferenceCenters_1_1&&!preferenceCenters_1_1.done&&(_a=preferenceCenters_1.return))_a.call(preferenceCenters_1)}finally{if(e_1)throw e_1.error}}return[2,null]}}))}))};PreferenceCenters.prototype.list=function(){return __awaiter(this,void 0,void 0,(function(){var data,preferenceCenters;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this._remote.get()];case 1:data=_a.sent();preferenceCenters=[];data.filter(client_1.isPreferenceCenterPayload).forEach((function(item){item.data.preference_forms.forEach((function(form){return preferenceCenters.push(form.form)}))}));return[2,preferenceCenters]}}))}))};return PreferenceCenters}();exports.default=PreferenceCenters},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.isPreferenceCenterPayload=void 0;function isPreferenceCenterPayload(payload){return payload.type==="preference_forms"}exports.isPreferenceCenterPayload=isPreferenceCenterPayload;var RemoteDataClient=function(){function RemoteDataClient(config,request){this._config=config;this._request=request}RemoteDataClient.prototype.get=function(_a){var locale=_a.locale;return __awaiter(this,void 0,void 0,(function(){var _b,paths,sdkVersion,appKey,path,queryParams,response;return __generator(this,(function(_c){switch(_c.label){case 0:_b=this._config,paths=_b.paths,sdkVersion=_b.sdkVersion,appKey=_b.appKey;path=paths.app+"/"+appKey+"/web/";queryParams={sdk_version:sdkVersion};if((locale===null||locale===void 0?void 0:locale.language)&&(locale===null||locale===void 0?void 0:locale.country)){queryParams.language=locale.language;queryParams.country=locale.country}return[4,this._request.get(path,{queryParams:queryParams})];case 1:response=_c.sent();if(!response.ok){throw new Error("unexpected response")}return[2,response.payloads]}}))}))};return RemoteDataClient}();exports.default=RemoteDataClient},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var configure_1=__webpack_require__(65);var install_1=__webpack_require__(82);var activate_1=__webpack_require__(86);var pushsubscriptionchange_1=__webpack_require__(88);var notificationclick_1=__webpack_require__(89);var push_1=__webpack_require__(92);function setupWorker(self,opts){if(opts===void 0){opts={}}configure_1.default(opts);self.addEventListener("push",(function(ev){return push_1.default(self,ev)}));self.addEventListener("notificationclick",(function(ev){return notificationclick_1.default(self,ev)}));self.addEventListener("install",(function(ev){return install_1.default(self,ev)}));self.addEventListener("activate",(function(ev){return activate_1.default(self,ev)}));self.addEventListener("pushsubscriptionchange",(function(ev){return pushsubscriptionchange_1.default(self,ev)}))}exports.default=setupWorker},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};Object.defineProperty(exports,"__esModule",{value:true});var debug_1=__webpack_require__(7);var get_channel_id_1=__webpack_require__(83);var get_acc_id_1=__webpack_require__(84);var subscribe_vapid_1=__webpack_require__(58);var get_vapid_data_1=__webpack_require__(62);var channel_1=__webpack_require__(5);var db_1=__webpack_require__(11);var request_1=__webpack_require__(8);var config_1=__webpack_require__(2);function installEventHandler(self,ev){if(config_1.default.skipWaiting){debug_1.default("Skipping waiting in service-worker.");self.skipWaiting()}var p=handleRegistration(self);ev.waitUntil(p);return p}exports.default=installEventHandler;function handleRegistration(self){return __awaiter(this,void 0,void 0,(function(){var _a,channelId,accId,subscription,response,_b,e_1;return __generator(this,(function(_c){switch(_c.label){case 0:return[4,Promise.all([get_channel_id_1.default(),get_acc_id_1.default()])];case 1:_a=__read.apply(void 0,[_c.sent(),2]),channelId=_a[0],accId=_a[1];if(channelId||!self.registration.active){debug_1.default("Channel id already exists or registration is not active.",channelId,self.registration.active);return[2]}_c.label=2;case 2:_c.trys.push([2,6,,7]);return[4,subscribe_vapid_1.default(self.registration)];case 3:subscription=_c.sent();return[4,register(subscription,accId)];case 4:response=_c.sent();_b=saveChannel;return[4,response.json()];case 5:return[2,_b.apply(void 0,[_c.sent()])];case 6:e_1=_c.sent();registrationError(e_1);return[3,7];case 7:return[2]}}))}))}function buildRegistrationPayload(subscription,accengageId){var regOpts=accengageId?{identity_hints:{accengage_device_id:accengageId}}:{};var registration=get_vapid_data_1.default(subscription);return Object.assign(registration,regOpts)}function register(subscription,accengageId){var registration=buildRegistrationPayload(subscription,accengageId);return request_1.default(config_1.default.paths.cra,{method:"post",body:registration})}function registrationError(err){debug_1.default("Unable to migrate registration on service worker startup.","Proceeding with installation.",err)}function saveChannel(channelBody){var channel=new channel_1.default(channelBody);return db_1.default.set("channel",channel.toJSON())}},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var db_1=__webpack_require__(11);var debug_1=__webpack_require__(7);function getChannelId(){return __awaiter(this,void 0,void 0,(function(){var channel,err_1;return __generator(this,(function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,db_1.default.get("channel")];case 1:channel=_a.sent();return[2,channel===null||channel===void 0?void 0:channel.channel_id];case 2:err_1=_a.sent();debug_1.default("Error fetching channel ID from indexedDB",err_1);return[3,3];case 3:return[2]}}))}))}exports.default=getChannelId},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var db_acc_1=__webpack_require__(85);var debug_1=__webpack_require__(7);function getAccId(){return __awaiter(this,void 0,void 0,(function(){var user,err_1;return __generator(this,(function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,db_acc_1.default.get("me")];case 1:user=_a.sent();return[2,user===null||user===void 0?void 0:user.UDID];case 2:err_1=_a.sent();debug_1.default("Error fetching Accengage ID from indexedDB",err_1);return[3,3];case 3:return[2]}}))}))}exports.default=getAccId},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var db_utils_1=__webpack_require__(12);var db=db_utils_1.default((function(){return"ACC"}),"settings",{},(function(ev){return ev.target.result}),2);exports.default=db},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var store_subscription_domain_1=__webpack_require__(87);function activateEventHandler(self,ev){ev.waitUntil(Promise.all([self.clients.claim(),store_subscription_domain_1.default(self)]))}exports.default=activateEventHandler},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var db_1=__webpack_require__(11);var debug_1=__webpack_require__(7);function storeSubscriptionDomain(self){return __awaiter(this,void 0,void 0,(function(){var sub,domain,e_1;return __generator(this,(function(_a){switch(_a.label){case 0:_a.trys.push([0,3,,4]);return[4,self.registration.pushManager.getSubscription()];case 1:sub=_a.sent();domain=sub?self.location.hostname:null;return[4,db_1.default.set("subscriptionDomain",domain)];case 2:_a.sent();return[2,true];case 3:e_1=_a.sent();debug_1.default("Error while storing subscription domain",e_1);return[2,false];case 4:return[2]}}))}))}exports.default=storeSubscriptionDomain},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var request_1=__webpack_require__(8);var subscribe_vapid_1=__webpack_require__(58);var get_channel_id_1=__webpack_require__(83);var get_vapid_data_1=__webpack_require__(62);function changeEventHandler(self,ev){return __awaiter(this,void 0,void 0,(function(){var subscription,channelId;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,subscribe_vapid_1.default(self.registration)];case 1:subscription=_a.sent();return[4,get_channel_id_1.default()];case 2:channelId=_a.sent();if(!channelId){return[2]}return[2,updateChannel(subscription,channelId)]}}))}))}exports.default=changeEventHandler;function updateChannel(subscription,channelId){var registration=get_vapid_data_1.default(subscription);var path=config_1.default.paths.cra+"/"+channelId;return request_1.default(path,{method:"put",body:registration})}},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var db_1=__webpack_require__(11);var request_1=__webpack_require__(8);var reports_1=__webpack_require__(33);var payload_1=__webpack_require__(90);var model_1=__webpack_require__(91);var locale_override_1=__webpack_require__(25);var arrayify_1=__webpack_require__(19);function clickEventHandler(self,ev){var _a,_b;ev.notification.close();var buttonId=ev.action;var button;var data=ev.notification.data;var action;if(buttonId){button=(_a=data.buttons)===null||_a===void 0?void 0:_a.find((function(b){return b.id===buttonId}));action=(_b=button===null||button===void 0?void 0:button.actions)!==null&&_b!==void 0?_b:{}}else{action=payload_1.expandAirshipAction(data.action||{})}var channelId=data.channel_id;var sendId=data.send_id;var promises=[];var link=payload_1.getActionUrl(action);if(link&&self.clients.openWindow){promises.push(self.clients.openWindow(link))}if(channelId){promises.push(handleTags(channelId,action))}if(sendId&&channelId){var reportPromise=model_1.default.fromStorage(db_1.default,(function(){return locale_override_1.default.fromStorage()})).then((function(channel){channel=channel!==null&&channel!==void 0?channel:new model_1.default({channelId:channelId,optedIn:true});return buttonId?reports_1.buttonClick(channel,sendId,buttonId):reports_1.direct(channel,sendId)}));promises.push(reportPromise,storeSendId(sendId))}var all=Promise.all(promises);ev.waitUntil(all);return all.then((function(){return true}))}exports.default=clickEventHandler;function handleTags(channelId,action){if(action===void 0){action={}}return __awaiter(this,void 0,void 0,(function(){var add,remove,body,response,e_1;return __generator(this,(function(_a){switch(_a.label){case 0:add=arrayify_1.maybeArrayify(action.add_tag);remove=arrayify_1.maybeArrayify(action.remove_tag);if(!add&&!remove){return[2,true]}body={audience:{channel:channelId}};if(add){body.add={device:add}}if(remove){body.remove={device:remove}}_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,request_1.default(config_1.default.paths.tags,{method:"post",body:body})];case 2:response=_a.sent();return[2,response.ok];case 3:e_1=_a.sent();console.error(e_1);return[2,false];case 4:return[2]}}))}))}function storeSendId(id){return __awaiter(this,void 0,void 0,(function(){var timestamp,e_2;return __generator(this,(function(_a){switch(_a.label){case 0:timestamp=Date.now();_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,db_1.default.set("last_send_id",{id:id,timestamp:timestamp})];case 2:_a.sent();return[2,true];case 3:e_2=_a.sent();return[2,false];case 4:return[2]}}))}))}},function(module,exports,__webpack_require__){"use strict";var __values=this&&this.__values||function(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};var __read=this&&this.__read||function(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar};Object.defineProperty(exports,"__esModule",{value:true});exports.getActionUrl=exports.expandAirshipAction=exports.isAccPayload=exports.isAirshipPayload=void 0;var config_1=__webpack_require__(2);var get_channel_id_1=__webpack_require__(83);function isAirshipPayload(payload){return"channel_id"in payload&&typeof payload.channel_id==="string"&&typeof payload.send_id==="string"}exports.isAirshipPayload=isAirshipPayload;function isAccPayload(payload){return"a4sid"in payload&&typeof payload.a4sid==="string"}exports.isAccPayload=isAccPayload;function buildUrl(payload){var e_1,_a;if(payload===null||payload===void 0?void 0:payload.onClick){var url=new URL(payload.onClick.url);var params=url.searchParams;try{for(var _b=__values(Object.entries(payload.onClick.params||{})),_c=_b.next();!_c.done;_c=_b.next()){var _d=__read(_c.value,2),key=_d[0],value=_d[1];params.set(key,value)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(_c&&!_c.done&&(_a=_b.return))_a.call(_b)}finally{if(e_1)throw e_1.error}}url.search=params.toString();return url.toString()}}function expandAirshipAction(actions){var url=actions["^u"]||actions["^d_a"]||actions["^p_a"];var mapped={};mapped.open=url?{type:"url",content:url}:{type:"home"};if(actions["^+t"]){mapped.add_tag=actions["^+t"]}if(actions["^-t"]){mapped.remove_tag=actions["^-t"]}return mapped}exports.expandAirshipAction=expandAirshipAction;function getActionUrl(actions){var _a,_b;if(((_a=actions.open)===null||_a===void 0?void 0:_a.type)==="home"){return config_1.default.defaultActionURL}if(((_b=actions.open)===null||_b===void 0?void 0:_b.type)==="url"){return actions.open.content}return null}exports.getActionUrl=getActionUrl;function mapFromAccPayload(payload){return get_channel_id_1.default().then((function(channelId){var uaPayload={channel_id:channelId,body:payload.body,title:payload.title,icon:payload.icon,require_interaction:"reqInt"in payload&&Boolean(payload.reqInt)};var url=buildUrl(payload);if(url){uaPayload.action={"^u":url}}if(payload.a4sb&&Array.isArray(payload.a4sb)&&payload.a4sb.length){uaPayload.buttons=payload.a4sb.reduce((function(acc,btn){var button={id:String(btn.id),label:btn.title,icon:btn.icon,actions:{open:{type:"url",content:btn.url}}};acc.push(button);return acc}),[])}if("a4sbigpicture"in payload){uaPayload.image=payload.a4sbigpicture}return uaPayload}))}exports.default=mapFromAccPayload},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var get_registration_base_1=__webpack_require__(22);var utils_1=__webpack_require__(26);var ChannelModel=function(){function ChannelModel(params){var _a;this._channelId=params.channelId;this._namedUserId=(_a=params.namedUserId)!==null&&_a!==void 0?_a:null;this._optedIn=params.optedIn;this._localeOverride=params.localeOverride}Object.defineProperty(ChannelModel.prototype,"id",{get:function(){return this._channelId},enumerable:false,configurable:true});Object.defineProperty(ChannelModel.prototype,"named_user_id",{get:function(){console.warn("accessing the `named_user_id` of a channel may return a non-canonical response. its use is deprecated.");return this._namedUserId},enumerable:false,configurable:true});Object.defineProperty(ChannelModel.prototype,"optedIn",{get:function(){return this._optedIn},enumerable:false,configurable:true});ChannelModel.fromStorage=function(db,localeOverrideProvider){var _a;return __awaiter(this,void 0,void 0,(function(){var stored,locale;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,db.get("channel")];case 1:stored=_b.sent();if(!stored)return[3,3];return[4,localeOverrideProvider()];case 2:locale=_b.sent();return[2,new ChannelModel({channelId:stored.channel_id,namedUserId:(_a=stored.named_user_id)!==null&&_a!==void 0?_a:undefined,optedIn:utils_1._convertOptInStorageValue(stored.opt_in),localeOverride:locale})];case 3:return[2]}}))}))};ChannelModel.prototype.toJSON=function(){return Object.assign(get_registration_base_1.default(this._localeOverride),{channel_id:this.id,opt_in:this.optedIn})};return ChannelModel}();exports.default=ChannelModel},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __values=this&&this.__values||function(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:true});var config_1=__webpack_require__(2);var payload_1=__webpack_require__(90);var store_subscription_domain_1=__webpack_require__(87);function pushEventHandler(self,ev){var _a;var now=Date.now()/1e3;var payload=((_a=ev.data)===null||_a===void 0?void 0:_a.json())||{};var promise;if((payload===null||payload===void 0?void 0:payload.expiry)<now){promise=clearExpiredNotifications(self)}else{promise=process(self,payload)}ev.waitUntil(promise);return promise}exports.default=pushEventHandler;function process(self,rawPayload){var _a;return __awaiter(this,void 0,void 0,(function(){var payloadPromise,payload,promises,title,requireInteraction,sendId;return __generator(this,(function(_b){switch(_b.label){case 0:payloadPromise=payload_1.isAccPayload(rawPayload)?payload_1.default(rawPayload):Promise.resolve(rawPayload);return[4,payloadPromise];case 1:payload=_b.sent();promises=[store_subscription_domain_1.default(self)];promises.push(sendToClients(self,payload));title=payload.title||config_1.default.defaultTitle;requireInteraction=payload.require_interaction||false;sendId=payload.send_id;if(payload.body){promises.push(self.registration.showNotification(title,{body:payload.body,icon:payload.icon||config_1.default.defaultIcon,image:payload.image,data:payload,actions:(_a=payload.buttons)===null||_a===void 0?void 0:_a.map((function(btn){return{title:btn.label,action:btn.id,icon:btn.icon}})),requireInteraction:requireInteraction}))}return[2,Promise.all(promises).catch((function(err){return console.error("error processing notification",err)})).then((function(){return clearExpiredNotifications(self,sendId)})).catch((function(err){return console.error("error clearing notifications",err)}))]}}))}))}function clearExpiredNotifications(self,sendId){return __awaiter(this,void 0,void 0,(function(){var notifications,now,notifications_1,notifications_1_1,notification;var e_1,_a;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,self.registration.getNotifications()];case 1:notifications=_b.sent();if(!notifications){return[2]}now=Date.now()/1e3;try{for(notifications_1=__values(notifications),notifications_1_1=notifications_1.next();!notifications_1_1.done;notifications_1_1=notifications_1.next()){notification=notifications_1_1.value;if(sendId&&notification.data.send_id===sendId){continue}if(notification.data.expiry&&notification.data.expiry<now){notification.close()}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(notifications_1_1&&!notifications_1_1.done&&(_a=notifications_1.return))_a.call(notifications_1)}finally{if(e_1)throw e_1.error}}return[2]}}))}))}function sendToClients(self,payload){var msg={type:"push",push:payload};return self.clients.matchAll().then((function(clients){clients.forEach((function(client){return client.postMessage(msg)}))}))}}]);