define(['module.base','defaults','session','jquery'],function(Module,defaults,session,$){Module.Header=function(){var self=this;window._config.isNitroHeader=true;self.init=function(){require(['jquery'],function($){self.tempConvert();self.searchSetup();self.alerts();self.alertFavicon();(function($){$.fn.textfill=function(maxFontSize){maxFontSize=parseInt(maxFontSize,10);return this.each(function(){var theText=$("span",this),parent=theText.parent(),maxHeight=parent.height(),maxWidth=parent.width(),fontSize=parseInt(theText.css("fontSize"),10),multiplier=maxWidth/theText.width(),newSize=parseInt(fontSize*multiplier,10)-1;if(newSize==(maxFontSize-1)){newSize=maxFontSize;}
parent.css("fontSize",(maxFontSize>0&&newSize>maxFontSize)?maxFontSize:newSize);});};})($);$("h1").textfill(24);window.$=window.jQuery=$;});self.countrySelection();self.savedLocations();self.signin();self.viafoura();self.sticky();};self.tempConvert=function(){$("body").removeClass("unit_c");$("body").removeClass("unit_f");$('#tempunitc').removeClass("pelm-unit-active");$('#tempunitf').removeClass("pelm-unit-active");if(session.fld('pelm_unit')==null||typeof session.fld('pelm_unit')=='undefined'){var elem="#tempunitc",defaultTempunit='c';if(typeof window._config.domain_countrycode!=="undefined"&&window._config.domain_countrycode=="us"){elem="#tempunitf";defaultTempunit='f';}
if(typeof window._config.tempunit!=="undefined"){var p_unit=window._config.tempunit;elem="#tempunit"+p_unit;session.save_cookie('pelm_unit',p_unit);}
$(elem).addClass("pelm-unit-active");$("body").addClass("unit_"+defaultTempunit);}else{var pelm_unit=session.fld('pelm_unit');elem="#tempunit"+pelm_unit;$(elem).addClass("pelm-unit-active");$("body").addClass("unit_"+pelm_unit);}
$('.tempunit').click(function(){var pelm_unit=$(this).text().toLowerCase().slice(-1);session.save_cookie('pelm_unit',pelm_unit);var elem="#tempunit"+pelm_unit;$("#tempunitc, #tempunitf").removeClass("pelm-unit-active");$(elem).addClass("pelm-unit-active");if(typeof window.Package!=='undefined'&&typeof window.Package.unit==='function'){window.Package.unit(pelm_unit);}
$("body").removeClass("unit_c");$("body").removeClass("unit_f");$("body").addClass("unit_"+pelm_unit);dataLayer.push({'event':"eventTracker",'eventCategory':window._config.ga_product,'eventAction':'clicks','eventLabel':"tempSettingC_F"});});};self.searchSetup=function(){require(['web/modules/search'],function(search){search.init();});require(['recent_locations'],function(recent_locations){$('#search').focus(function(){if(typeof session.fld('pelm_rec_loc')!=='undefined'&&$('#search').val()==''){var recent_location_list=recent_locations.get_recent_location('pelm_rec_loc');if(recent_location_list){$("#mylocations ul").html(recent_location_list);$('#mylocations').show();}}});});$('#search').keypress(function(e){if(e){var kCode=e.which||e.keyCode;if(kCode==13){dataLayer.push({'event':"eventTracker",'eventCategory':window._config.ga_product,'eventAction':'clicks','eventLabel':"searchEnter | "+$("#search").val()});}}
$('#mylocations').hide();});};self.countrySelection=function(){require(['web/modules/country_selection'],function(countrySelection){countrySelection.init();});};self.signin=function(){require(['web/modules/signin'],function(signin){signin.init();});};self.viafoura=function(){if(window._config.viafoura_flag&&(session.fld('pelm_a')||$('#viafoura_commenting').length>0)){require(['web/modules/viafoura'],function(viafoura){viafoura.init();});}};self.sticky=function(){if(window._config.sticky_header_flag){require(['web/modules/sticky'],function(sticky){sticky.init();});}};self.savedLocations=function(){require(['web/modules/favorite_locations_nitro'],function(favorites){favorites.run();});};self.alerts=function(){require(['web/modules/alerts'],function(alerts){if(alerts&&typeof alerts.fix_banner_link=='function'){alerts.fix_banner_link();}});require(['carousels_light'],function(carousels_light){var carousel_container='alert-carousel';var lightslider_options={displaySlideQty:1,moveSlideQty:1,totalSlideQty:$('#'+carousel_container).children().length,paginationContainer:'alert-pagination',automationOptions:{type:'infinite-cycle',slideDelay:6000}}
var initLightSlider=function(){if($('#'+carousel_container).children().length>0){carousels_light.bind(carousel_container,lightslider_options);}else{setTimeout(function(){initLightSlider();},1000);}};initLightSlider();});};self.alertFavicon=function(){var check_alert_interval;var favIcon=$('#favicon');var api_request;var rotate_icon;var placecode=window.placecode?window.placecode:"";check_alert_interval=window._config.check_alert_interval;if(check_alert_interval==undefined){check_alert_interval=15*60*1000;}
window.addEventListener("blur",function(){api_request=setTimeout(apiRequest,check_alert_interval);});function apiRequest(){__.a('/api/savedlocation/alerts/?placecodes%5B0%5D='+placecode,function(data){if(data){var alerts_response=(typeof data=='string')?JSON.parse(data):data;alerts_response=typeof alerts_response[placecode]!='undefined'?alerts_response[placecode]:false;if(alerts_response&&typeof alerts_response[0]!='undefined'){if(typeof alerts_response[0].alert_source!='undefined'){rotate_icon=setTimeout(rotateIcon,1000);window.addEventListener("focus",function(){clearTimeout(api_request);clearTimeout(rotate_icon);favIcon.attr('href','/favicon.ico');location.reload();});clearTimeout(api_request);}else{favIcon.attr('href','/favicon.ico');}}}
api_request=setTimeout(apiRequest,check_alert_interval);});}
function rotateIcon(){var favIcon=$('#favicon');if(favIcon.length<1){$('head').prepend('<link id="favicon" class="default" rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />');}
if(favIcon.hasClass('default')){setTimeout(function(){favIcon.attr('href','/twnmm_alert_favicon.ico');favIcon.attr('class','alert');},1000);}else{setTimeout(function(){favIcon.attr('href','/favicon.ico');favIcon.attr('class','default');},1000);}
rotate_icon=setTimeout(rotateIcon,1000);}}};return Module.factory("Header");});;