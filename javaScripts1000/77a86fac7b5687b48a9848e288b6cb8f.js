(this.dmpJsonp=this.dmpJsonp||[]).push([["live"],{"2h4F":function(e,t,n){"use strict";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){le()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pe.b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case de.c:return r({},e,{flickeringDelay:e.flickeringDelay?0:10});case de.b:return r({},e,{viewersCount:t.viewersCount});case de.e:return r({},e,{refreshRequested:!0,refreshRequestedReason:t.value});case de.d:return r({},e,{endOfStreamRequested:!0});default:return Object(pe.a)(e,t)}}n.r(t),n.d(t,"__EXPORTED_CSS__",function(){return ue}),n.d(t,"AudienceBroker",function(){return w}),n.d(t,"ButtonLive",function(){return J}),n.d(t,"CounterViewer",function(){return W}),n.d(t,"LiveRefresh",function(){return oe}),n.d(t,"liveReducer",function(){return o});var a=n("2mXy"),c=n("/MKj"),s=n("Zrx9"),l=n("G1FZ"),d=n("yaY2"),p=n("cEfz"),u=n("I23d"),v=n("VfPQ"),f=(e,t)=>{var n=t.onError,i=t.onEvent,r=t.onTimeout,o=t.allocatedMs,a=void 0===o?1e4:o,c=new EventSource(e,{withCredentials:!1}),s,l=()=>{c.close(),clearTimeout(s)};return c.onerror=e=>{l(),n&&n(e)},i&&(c.onmessage=e=>{i(e)}),r&&(s=setTimeout(()=>{l(),r(a)},a),c.onopen=()=>{clearTimeout(s)}),l},h=(e,t)=>{var n=t.onError,i=t.onEvent,r=t.onTimeout,o=t.allocatedMs,a=void 0===o?1e4:o,c,s=new XMLHttpRequest;s.open("GET",e,!0),s.setRequestHeader("Accept","text/event-stream");var l=()=>{clearTimeout(c),s.onprogress=null,s.abort()};n&&(s.onerror=n);var d=0;return s.onprogress=()=>{for(;;){var e=s.responseText.indexOf("\n\n",d);if(-1===e)break;var t=s.responseText.substring(d,e);d=e+2;for(var n=t.split("\n"),r=0,o=n.length;r<o;r++){var a=n[r].replace(/^data:\s+|[\s\n]+$/g,"");a&&i({type:"message",data:a})}}},r&&(c=setTimeout(()=>{l(),r(a)},a),s.onreadystatechange=()=>{s.readyState>1&&clearTimeout(c)}),s.send(),l},b="function"==typeof EventSource?f:h,m=n("sZNL"),g=s.default.get("AudienceBroker"),O="livead",_="live_status",L="live_viewers",x=e=>({isLive:Object(u.b)(e),displayViewers:Object(v.x)(e),metadataAudienceURL:Object(v.f)(e),metadataHasMetadata:Object(v.n)(e)}),j={requestLiveRefresh:d.e,requestAdLinear:p.j,updateLiveAudience:d.f};class R extends a.Component{constructor(e){super(e),this.onEventReceived=this.onEventReceived.bind(this),this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this),this.disconnectSSE=null}onEventReceived(e){var t=y(e);if(t){var n=t.name,i=t.value;switch(g.log("Notification received: ",{name:n,value:i}),n){case"live_status":this.props.requestLiveRefresh((i||"").toLowerCase());break;case"livead":g.log("Received live ad play event");var r=parseInt(i,10);r>0&&this.props.requestAdLinear(l.a.LIVEADBREAK);break;case"live_viewers":this.props.displayViewers&&this.props.updateLiveAudience(parseInt(i,10))}}}connect(){var e=this.props.metadataAudienceURL;e&&(g.log("Connecting to: ".concat(e)),this.disconnectSSE=b(e,{onEvent:this.onEventReceived,onTimeout:t=>{g.log("Failed to connect to ".concat(e,": timeout after ").concat(t,"ms"))}}))}disconnect(){this.disconnectSSE&&(g.log("disconnecting from event source"),this.disconnectSSE(),this.disconnectSSE=null)}componentDidMount(){this.props.metadataAudienceURL&&this.connect()}componentDidUpdate(e){var t=this.props;null===this.disconnectSSE&&!e.metadataAudienceURL&&t.metadataAudienceURL&&this.connect(),this.disconnectSSE&&t.metadataHasMetadata&&!t.metadataAudienceURL&&this.disconnect()}}var y=e=>{var t=e.type,n=e.data;if("message"!==t)return null;if(!n.includes("="))return Object(m.a)(n)?{name:"live_viewers",value:n}:null;var i=n.split("=");return 2===i.length?{name:i[0],value:i[1]}:null},w=Object(c.connect)(x,j)(R),S=n("peh1"),B=n("BNty"),k=n("iiVM"),E=n("+kBE"),A=n("ZJNx"),q=n("XgKk"),T=n("Zw0V"),C=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.maxSwitches,i=void 0===n?3:n,r=t.delay,o=void 0===r?3e3:r,a=[];return()=>(a.length===i&&(a=a.slice(1)),a.push(Date.now()),a.length===i&&a[i-1]-a[0]<o&&(a=[],!0))},V=Object(S.createSelector)([T.a,q.i,u.a],(e,t,n)=>t&&(!n||e)),D=e=>!1===Object(A.d)(e)?{isAttached:!1}:V(e)?!1===Object(A.c)(e)?{isAttached:!0,variant:"toosmallforbacktolive"}:{isAttached:!0,variant:"backtolive"}:{isAttached:!0,variant:"live"},N=e=>({backToLiveRequested:()=>e(Object(d.a)()),flickeringDetected:()=>e(Object(d.b)())});class P extends a.Component{constructor(e){super(e),this.detectFlickering=C({delay:e.flickeringGap})}componentWillReceiveProps(e){var t=this.props.variant,n=e.variant;("live"===t&&"backtolive"===n||"backtolive"===t&&"live"===n)&&this.detectFlickering()&&this.props.flickeringDetected()}render(e){var t=e.isAttached,n=e.variant,i=e.backToLiveRequested;return t?Object(a.h)(E.a,{"aria-controls":"dmp_Video","aria-live":"polite","aria-pressed":"backtolive"!==n,disabled:"backtolive"!==n,onClick:"backtolive"===n?i:null,className:"np_ButtonLive np_ButtonLive--".concat(n)},Object(a.h)("span",{className:"np_ButtonLive--text",style:{"max-width":"150px"}},"backtolive"===n?k.a.__("neon:::Back to live"):k.a.__("neon:::Live"))):null}}var I=Object(c.connect)(D,N)(P),M=e=>({isAttached:Object(A.d)(e)}),U=e=>{var t=e.isAttached;return t?Object(a.h)(E.a,{"aria-controls":"dmp_Video","aria-live":"polite",disabled:!0,className:"np_ButtonLive np_ButtonLive--onair"},Object(a.h)("span",{className:"np_ButtonLive--text",style:{"max-width":"150px"}},k.a.__("neon:::Live"))):null},F=Object(c.connect)(M)(U),z=Object(S.createSelector)([u.e,B.a,v.w],(e,t,n)=>e&&t&&n>0),Z=Object(S.createStructuredSelector)({isAttached:u.b,liveIsDVR:z}),H=e=>{var t=e.isAttached,n=e.liveIsDVR;return t?n?Object(a.h)(I,null):Object(a.h)(F,null):null},J=Object(c.connect)(Z)(H),X=n("6kjv"),G=n("o0Qf"),K=Object(S.createSelector)([u.b,u.j,v.x,A.b],(e,t,n,i)=>({isAttached:n&&e&&i,liveViewersCount:t})),Q=e=>{var t=e.isAttached,n=e.liveViewersCount;return t?Object(a.h)("div",{className:"np_ViewerCount","aria-label":k.a.__("accessibility:::Live video: %count% viewers",{count:n})},Object(a.h)(X.a,{Icon:G.a}),Object(a.h)("span",null,n)):null},W=Object(c.connect)(K)(Q),Y=n("g1jF"),$=s.default.get("LiveStatus"),ee=Object(S.createStructuredSelector)({liveRefreshRequested:u.h,liveRefreshRequestedByOnairNotification:u.g,liveRefreshRequestedByOffairNotification:u.f,liveStreamLoaded:u.i,metadataStartTime:v.M,metadataEndTime:v.k,liveEndOfStream:u.c}),te={refreshLiveStream:d.c,requestEndOfStreamDetection:d.d};class ne extends a.Component{componentDidUpdate(e){var t=this.props;e.liveRefreshRequestedByOffairNotification||!t.liveRefreshRequestedByOffairNotification?t.liveRefreshRequestedByOffairNotification&&t.liveStreamLoaded?!e.liveEndOfStream&&t.liveEndOfStream?($.log("end of live stream -> switch offair"),t.refreshLiveStream()):$.log("wait for last fragment before refreshing live"):ie(e,t)&&($.log("refresh live"),t.refreshLiveStream()):t.requestEndOfStreamDetection()}}var ie=(e,t)=>!(e.liveRefreshRequested||!t.liveRefreshRequested)&&re(t),re=e=>{var t=e.liveRefreshRequestedByOnairNotification,n=e.liveRefreshRequestedByOffairNotification,i=e.liveStreamLoaded,r=e.startTime,o=e.endTime;return t&&i?($.log("refresh requested after receiving ONAIR notification -> do nothing because live stream is loaded"),!1):!((t||n)&&!Object(Y.b)(Object(Y.a)(r||0),Object(Y.a)(o||0)))||($.log("refresh requested after receiving notification -> do nothing because live scheduled range is not now"),!1)},oe=Object(c.connect)(ee,te)(ne),ae=n("hAOF"),ce=n.n(ae),se=n("lSNA"),le=n.n(se),de=n("a3RI"),pe=n("/UcL"),ue=[{cssText:ce.a,styleId:"dmp-async-style-live"}]},hAOF:function(e,t,n){var i=n("JPst");t=i(!1),t.push([e.i,'.np_ButtonLive{border-radius:2px;font-size:12px;height:24px;line-height:22px;padding:0 8px}.dmp_h-min-m .np_ButtonLive{font-size:14px;height:32px;line-height:30px;padding:0 12px}.dmp_h-min-ll .np_ButtonLive{height:40px;line-height:38px;padding:0 16px}.np_ButtonLive{align-items:center;background-color:transparent;border-color:transparent;border-style:solid;border-width:1px;display:flex;opacity:0;overflow:hidden;pointer-events:auto;text-transform:uppercase;transition:all 0.3s;white-space:nowrap}.np_ButtonLive--text{line-height:1;overflow:hidden;text-overflow:ellipsis}.np_ButtonLive::before{align-self:center;border-radius:50%;content:"";display:block;height:4px;margin-right:0.5em;margin-top:2px;width:4px}.np_ButtonLive--live,.np_ButtonLive--onair{background-color:#ff0042;border-color:#ff0042;color:#fff;opacity:1}.np_ButtonLive--live::before,.np_ButtonLive--onair::before{background-color:#fff}.np_ButtonLive--toosmallforbacktolive,.np_ButtonLive--backtolive{background-color:#fff;border-color:#fff;color:#000;cursor:pointer;opacity:1}.np_ButtonLive--toosmallforbacktolive::before,.np_ButtonLive--backtolive::before{background-color:#ff0042}.np_ButtonLive--toosmallforbacktolive{cursor:default}.np_ButtonLive--offair{border-color:rgba(255,255,255,0.7);color:#fff;opacity:1}.np_ButtonLive--offair::before{display:none}.np_ButtonLive{margin:0 12px 0 7px}.dmp_h-min-m .np_ButtonLive{margin:0 12px 0 11px}.dmp_h-min-ll .np_ButtonLive{margin:0 16px 0 7px}.np_AlertdialogError .np_ButtonLive{left:5px;position:absolute;top:12px}.dmp_h-min-m .np_AlertdialogError .np_ButtonLive{top:16px}.dmp_h-min-ll .np_AlertdialogError .np_ButtonLive{top:12px}.np_ViewerCount{align-items:center;display:flex}.np_ViewerCount svg{margin-right:4px;height:16px;width:16px}.np_ViewerCount span{font-size:12px;letter-spacing:0.5px;line-height:22px}.dmp_h-min-m .np_ViewerCount svg{height:18px;width:18px}.dmp_h-min-m .np_ViewerCount span{font-size:14px}\n',""]),e.exports=t}}]);