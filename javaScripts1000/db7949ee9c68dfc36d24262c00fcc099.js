Cube("datav:/com/ml-table-bar/2.5.8",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/animejs/3.1.0"],function(a,b,c){function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}var e=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},f="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=c("datav:/npm/bcore/0.0.18/event"),h=c("datav:/npm/jquery/2.1.4"),j=c("datav:/npm/lodash/4.6.1"),k=c("datav:/npm/animejs/3.1.0"),l=function(a){a&&a.seek&&a.pause&&(a.complete=function(){},a.seek(a.duration),a.pause(),a=null)},m=j.template("<div class=\"table-line\" style=\"position: relative;\"><div class=\"rotate\" style=\"display: flex; align-items: center;\"><%= index %><%= content %><%= value %></div><%= bar %><div class=\"line-segment\"><%= light %></div></div>"),o=j.template("<span class=\"table-index\" style=\"<% _.forIn(innerStyle, function (val, key) { %><%- key %>:<%- val %>;<% })%>\"><%= value %></span>"),p=j.template("<div class=\"table-content\" style=\"position: relative;display: flex;vertical-align: bottom;<% _.forIn(innerStyle, function (val, key) { %><%- key %>:<%- val %>;<% })%>\"><div class=\"inner\"><%= value %></div></div>"),q=j.template("<div class=\"table-bar\"><div class=\"light\"></div></div>"),r={1:"<%= i %>",2:"NO.<%= i %>",3:"(<%= i %>)"},i=function(a){if(!a)return"#fff";if("string"===typeof a)return a;if("object"===("undefined"===typeof a?"undefined":f(a))&&a.type){var b=a.value,c=a.type;if("flat"===c)return b;if("linearGradient"===c){var d=b.stops,e=b.angle;d.sort(function(c,a){return c.offset-a.offset});var g=d.map(function(a){return a.color+" "+a.offset+"%"}).join(",");return"linear-gradient("+e+"deg, "+g+")"}}};return a.exports=g.extend(function(a,b){this.config={rotate:!0,global:{duration:2e3,padding:8,quantity:5,animation:!0,sort:{show:!0,sort:"desc"}},index:{show:!0,format:null,fontSize:16,fontWeight:"normal",color:"#fff",padding:10},content:{format:null,fontSize:16,fontWeight:"normal",color:"#fff",marquee:{show:!0,duration:8e3}},number:{show:!1,fontSize:16,fontWeight:"normal",color:"#fff",prefixSuffix:{prefixContent:"",suffixContent:"",marginLeft:0,marginRight:0},separatingChart:!0},bar:{show:!0,color:"#1371FB",height:4},light:{show:!0,color:"#28f8ff",width:70,height:1},segment:{show:!0,color:"#1371fb"}},this.container=h(a).css("transform","translate3d(0,0,0)"),this.apis=b.apis,this._data=[],this.__data=[],this.chart=null,this.isFirst=!0,this.max=0,this.duration=500,this.rotateAnimates=[],this.rotateAnimate,this.marqueeAnimate,this.lightAnimate,this.rotates=null,this.index=0,this.fresh=!0,this.init(b)},{init:function(a){this.mergeConfig(a)},clear:function(a,b){var c=this.config;this.clearAnimates(),this.data()&&a&&a.length!==this.data().length&&(this.isFirst=!0,this.index=0),b&&b.global&&((b.global.quantity!==c.global.quantity||b.global.loop!==c.global.loop)&&(this.isFirst=!0,this.index=0,this.fresh=!0),b.segment.show!==c.segment.show&&(this.isFirst=!0,this.index=0,this.fresh=0))},render:function(a,b){this.clear(a,b),this.fresh||!this.config.global.loop?this.rerender(a,b):((!j.isEqual(j.get(b,"global.sort"),this.config.global.sort)||j.get(b,"number.show")!==this.config.number.show)&&this.rerender(a,b),this.mergeConfig(b),this.data(a))},rerender:function(a,b){var c=this;a=this.data(a);var d=this.mergeConfig(b);if(this.container.css("font-family","\""+d.global.fontFamily+"\", Arial, sans-serif"),a){this.index+d.global.quantity>a.length&&(this.isFirst=!0);var e=this.container,f=d.index.textarea,g=d.content.textarea,k=d.content.marquee,l=Math.min(this.index+d.global.quantity,a.length);this.rotates&&l-this.index!==this.rotates.length&&(this.isFirst=!0);var s=j.template(r[d.index.format]),t=d.number.prefixSuffix,u=t.prefixContent,v=t.suffixContent,w=t.marginLeft,x=t.marginRight,y=d.number.separatingChart;if(a=y?this.switchThousandthsOrNum(a,1):this.switchThousandthsOrNum(a,2),this.isFirst){this.clearAnimates(),e.empty();for(var z,A,B,C,D,n="",E=this.index;E<l;E++)D=a[E],z=d.index.show?o({value:d.index.format&&s({i:E+1})||E+1,innerStyle:j.defaultsDeep(d.index.innerStyle||{},{color:f.color,"font-size":f.fontSize+"px","font-weight":f.fontWeight,"padding-right":d.index.padding+"px",width:d.index.width||"auto",flex:"none"})}):"",A=p({value:d.content.format&&d.content.format.call(this,D,E)||D.content||"",innerStyle:j.defaultsDeep(d.content.innerStyle||{},{color:g.color,"font-size":g.fontSize+"px","font-weight":g.fontWeight,overflow:k.show&&"hidden"||"auto","white-space":k.show&&"nowrap"||"normal",flex:"auto"})}),C=d.number&&d.number.show&&"\n          <div\n            class=\"number\"\n            style=\" color: "+d.number.color+"; font-size: "+d.number.fontSize+"px; font-weight: "+d.number.fontWeight+"; white-space: nowrap;\"\n            >"+u+"<span style=\"margin-left: "+w+"px; margin-right: "+x+"px;\">"+D.value+"</span>"+v+"</div>\n          "||"",B=d.bar.show&&q()||"",n+=m({index:z,content:A,value:C,bar:B,light:!d.bar.show&&"<div class=\"light\"></div>"||""});e.append(n),this.isFirst=!1,e.find(".light").css({position:"absolute",left:"0",top:"0",width:d.light.width+"px",height:d.light.height+"px",background:"radial-gradient("+d.light.color+" 5%, rgba(0,0,0,0) 80%)",transform:"translateX(-"+d.light.width+"px)",transition:"none"}),this.rotates=e.find(".rotate"),this.tableLines=e.find(".table-line"),this.updateStyle(),this.cacheHeight(),setTimeout(this.loopLight.bind(this),500)}else{for(var D,E=this.index;E<l;E++)D=a[E],z=d.index.show?o({value:d.index.format&&s({i:E+1})||E+1,innerStyle:j.defaultsDeep(d.index.innerStyle||{},{color:f.color,"font-size":f.fontSize+"px","font-weight":f.fontWeight,"padding-right":d.index.padding+"px",width:d.index.width||"auto",flex:"none"})}):"",A=p({value:d.content.format&&d.content.format.call(this,D,E)||D.content||"",innerStyle:j.defaultsDeep(d.content.innerStyle||{},{color:g.color,"font-size":g.fontSize+"px","font-weight":g.fontWeight,overflow:k.show&&"hidden"||"auto","white-space":k.show&&"nowrap"||"normal",flex:"auto"})}),C=d.number&&d.number.show&&"\n          <div\n            class=\"number\"\n            style=\" color: "+d.number.color+"; font-size: "+d.number.fontSize+"px; font-weight: "+d.number.fontWeight+"; padding-left: "+d.number.padding+"px; white-space: nowrap;\"\n          >"+u+"<span style=\"margin-left: "+w+"px; margin-right: "+x+"px;\">"+D.value+"</span>"+v+"</div>\n          "||"",h(c.rotates[E-this.index]).data("next",z+A+C);this.updateStyle(),Math.max(d.index.textarea.fontSize,d.content.textarea.fontSize)!==Math.max(parseInt(c.rotates.find(".table-index").css("font-size")),parseInt(c.rotates.find(".table-content").css("font-size")))&&this.cacheHeight()}e.find(".table-line:gt("+(this.index+l)+")").remove(),d.rotate?this.rotate(this.tableLines):e.find(".table-line").find(".rotate").each(function(){var a=h(this);a.html(a.data("next")||a.html())})}var c=this;this.fresh=!1,this.globalLoop&&clearTimeout(this.globalLoop),d.global.loop&&(this.globalLoop=setTimeout(function(){c.index=c.index+d.global.quantity>=(a&&a.length||0)?0:c.index+d.global.quantity,c.rerender()},d.global.looptime))},cacheHeight:function(){var a=this.config;this.rotates.each(function(){var b=h(this);b.css("height",Math.max(a.index.textarea.fontSize,a.content.textarea.fontSize)+a.global.padding+"px")})},switchThousandthsOrNum:function(a,b){var c=this;return j.map(a,function(a){return e({},a,{value:1===b?c.formatData(a.value):j.replace(a.value,/,/g,"")})})},formatData:function(a){return a+="",j.includes(a,".")||(a+="."),j.replace(j.replace(a,/(\d)(?=(\d{3})+\.)/g,"$1,"),/\.$/,"")},resize:function(){this.render()},data:function(a){var b=this.config,c=j.get(b,"global.sort"),d=c.show,e=c.sort,f=a||this.__data;return this.__data=this._data=d?j.orderBy(f,function(a){return j.toNumber(a.value)},[e]):this.__data,this._data},mergeConfig:function(a){return a?(a&&a.bar&&(a.bar.color=i(a.bar.color)),this.config=j.defaultsDeep(a||{},this.config),this.config):this.config},updateLayout:function(){},updateStyle:function(a){var b=this.config;a=a||this.container,this.tableLines.css({perspective:"250px",perspectiveOrigin:"50% 100%"}),this.rotates.css({marginBottom:b.global.padding+"px",position:"relative",transformStyle:"preserve-3d",transformOrigin:"50% 50%",transform:"rotateX(0deg) translateZ(0)",width:"100%",willChange:"transform"}),b.bar.show&&a.find(".table-bar").each(function(){var a=h(this);a.css({height:b.bar.height+"px",background:b.bar.color,display:"inline-block",overflow:"hidden",position:"absolute",bottom:"0",left:"0","z-index":1})});var c=a.find(".line-segment").css({height:b.segment.height+"px",background:b.segment.color,width:"100%",display:b.segment.show&&"block"||"none",overflow:"hidden",position:"relative",marginBottom:b.global.padding+"px"});b.light.show||b.bar.show||c.css({borderBottom:"1px solid "+b.segment.color,height:"0px"})},loopLight:function(){var a=this.config;this.lightAnimate&&l(this.lightAnimate),this.lightAnimate=k({targets:this.container.find(".light").get(),duration:a.global.duration+100,easing:"cubicBezier(0.42,0,0.58,1)",translateX:[-a.light.width,this.container.width()],delay:k.stagger(150)}),this.loopLightTimer&&clearTimeout(this.loopLightTimer),this.loopLightTimer=setTimeout(this.loopLight.bind(this),a.light.duration+a.global.duration)},rotate:function(a){var b=this,c=this.config,e=this.data();e=this.switchThousandthsOrNum(e),this.rotateAnimate&&l(this.rotateAnimate),this.rotateAnimate=c.global.animation&&k.timeline({duration:c.global.animation?this.duration:0,delay:0}),this.max=Math.max.apply(Math,d(e.map(function(a){return+a.value}))),a.get().forEach(function(a,d){var f=h(a),g=f.find(".rotate"),i=f.find(".table-bar"),j=function(){i.css("width",100*(e[b.index+d].value/b.max)+"%");var a=f.find(".table-content"),g=a.find(".inner");a.removeClass("has-marquee"),c.content.marquee.show?(a.css({overflow:"hidden",whiteSpace:"nowrap"}),g.width()>g.parent().width()&&b.marquee(f,d)):a.css({overflow:"auto",whiteSpace:"normal"})};c.global.animation?b.rotateAnimate.add({targets:g[0],rotateX:[0,-80],easing:"cubicBezier(0.55,0.18,0.92,0.46)",delay:function(){return 120*d},changeBegin:function(){g.show()},changeComplete:function(){g.html(g.data("next")||g.html()),b.rotateAnimates[d]&&l(b.rotateAnimates[d]),b.rotateAnimates[d]=k({targets:g[0],rotateX:[80,0],easing:"cubicBezier(0.15,0.52,0.5,0.9)",duration:c.global.animation?b.duration:0,complete:j})}},0):(g.html(g.data("next")||g.html()),j())})},updateBar:function(a){var b=this.config.bar;b.show!==a.show&&(this.isFirst=!0,this.index=0,this.fresh=!0),this.render(null,{bar:a})},marquee:function(a){var b=this.config,c=a.find(".table-content");c.addClass("has-marquee"),c.parent().css("display","flex");var d=c.find(".inner").html(),e=c.html("<div class=\"inner\" style=\"left: 0;position: relative;\">"+d+"<i style=\"display:inline-block;width:5em;\"></i>"+d+"</div>").find(".inner");this.marqueeAnimate=k({targets:e.get(),duration:b.content.marquee.duration,easing:"linear",translateX:[0,function(a){return-(h(a).outerWidth()/2+2.5*b.content.textarea.fontSize)}],loop:!0,delay:k.stagger(100)})},startAnimate:function(){this.rerender()},clearAnimates:function(){l(this.rotateAnimate),l(this.marqueeAnimate),l(this.lightAnimate),this.rotateAnimates&&this.rotateAnimates.forEach(function(b){l(b)});var a=this.container.find(".table-line");k.remove(a.find(".rotate").get()),k.remove(a.find(".inner").get()),k.remove(a.find(".light").get()),clearTimeout(this.globalLoop),clearTimeout(this.loopLightTimer)},destroy:function(){this.clearAnimates(),this.container.off("**"),this.container.empty(),this.isFirst=!0,this.max=0,this.rotates=null,this.index=0,this.fresh=!0,this._data=null}}),a.exports});