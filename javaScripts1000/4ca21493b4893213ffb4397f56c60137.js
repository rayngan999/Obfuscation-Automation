/*! For license information please see 298.65ada9e7.chunk.js.LICENSE.txt */
(this.webpackJsonpreact_customer=this.webpackJsonpreact_customer||[]).push([[298],{1488:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return h}));var r=n(1838),i=n(1839),a=n(1491),o=function(t){return!!Object(a.b)(r.a,(function(e){return t===e}))},s={showLevel:!0,displayAllErrors:!1},c=!1;"undefined"!==typeof t&&"undefined"!==typeof t.version&&t.version&&(c=!0);var u=String(c?Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_RUNNING_ENV:"prod",REACT_APP_VERSION:"v210722-1955"}).SPLITIO_DEBUG:Object(i.a)()?localStorage.getItem("splitio_debug"):""),l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new r.b(t,Object(a.k)(e,s))},f=l("splitio-utils:logger"),h={enable:function(){Object(r.c)(r.a.DEBUG)},setLogLevel:function(t){o(t)?Object(r.c)(t):f.error("Invalid Log Level - No changes to the logs will be applied.")},disable:function(){Object(r.c)(r.a.NONE)},LogLevel:r.a};/^(enabled?|on)/i.test(u)?h.enable(r.a.DEBUG):o(u)?h.setLogLevel(u):h.disable(),e.b=l}).call(this,n(379))},1491:function(t,e,n){"use strict";n.d(e,"o",(function(){return i})),n.d(e,"a",(function(){return a})),n.d(e,"e",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return c})),n.d(e,"j",(function(){return u})),n.d(e,"l",(function(){return l})),n.d(e,"m",(function(){return f})),n.d(e,"t",(function(){return p})),n.d(e,"i",(function(){return g})),n.d(e,"k",(function(){return d})),n.d(e,"s",(function(){return m})),n.d(e,"r",(function(){return v})),n.d(e,"q",(function(){return y})),n.d(e,"p",(function(){return S})),n.d(e,"d",(function(){return T})),n.d(e,"g",(function(){return b})),n.d(e,"f",(function(){return E})),n.d(e,"n",(function(){return O})),n.d(e,"h",(function(){return _}));var r=n(1670);function i(t,e){return!(!u(t)||!u(e))&&t.slice(0,e.length)===e}function a(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!u(t)||!u(e))&&(n&&(t=t.toLowerCase(),e=e.toLowerCase()),t.slice(t.length-e.length)===e)}function o(t,e,n){var r=n;try{var i=e.split("."),a=t;i.forEach((function(t){return a=a[t]})),"undefined"!==typeof a&&(r=a)}catch(o){}return r}function s(t,e){if(Array.isArray(t)&&"function"===typeof e)for(var n=0;n<t.length;n++)if(!0===e(t[n],n,t))return n;return-1}function c(t,e){var n;if(g(t))for(var r=Object.keys(t),i=0;i<r.length&&!n;i++){var a=r[i];e(t[a],a,t)&&(n=t[a])}else if(Array.isArray(t))for(var o=0;o<t.length&&!n;o++){e(t[o],o,t)&&(n=t[o])}return n}function u(t){return"string"===typeof t||t instanceof String}function l(t){return t instanceof Number&&(t=t.valueOf()),"number"===typeof t&&(Number.isFinite?Number.isFinite(t):isFinite(t))}function f(t){return t instanceof Number&&(t=t.valueOf()),t!==t}var h=-1;function p(){return h++}function g(t){return t&&"object"===Object(r.a)(t)&&t.constructor===Object}function d(t,e){var n=t;g(e)&&Object.keys(e).forEach((function(t){var r=e[t];g(r)&&(r=n[t]&&g(n[t])?d({},n[t],r):d({},r)),void 0!==r&&(n[t]=r)}));for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];if(i&&i.length){var o=i.splice(0,1)[0];n=d.apply(void 0,[n,o].concat(i))}return n}function m(t){var e={};return t.filter((function(t){return!Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=!0)}))}function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JSON.stringify,n={};return t.filter((function(t){var r=e(t);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)}))}function y(t){if(null==t)return"";if("string"===typeof t)return t;if(Array.isArray(t))return t.map((function(t){return u(t)?t:""}))+"";var e=t+"";return"0"===e&&1/t===Number.NEGATIVE_INFINITY?"-0":e}function S(t){if("number"===typeof t)return t;if(g(t)&&"function"===typeof t.valueOf){var e=t.valueOf();t=g(e)?e+"":e}return"string"!==typeof t?0===t?t:+t:+(t=t.replace(/^\s+|\s+$/g,""))}function T(t,e){return Object.keys(t).forEach((function(n){return e(t[n],n,t)})),t}function b(t,e){var n={};if(Array.isArray(t)&&u(e))for(var r=0;r<t.length;r++){var i=t[r][e];u(i)&&(n[i]||(n[i]=[]),n[i].push(t[r]))}return n}function E(t){return t.name?t.name:(t.toString().match(/function (.+?)\(/)||["",""])[1]}function O(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n}function _(t){return!0===t||!1===t}},1496:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return r}))},1497:function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}n.d(e,"a",(function(){return i}))},1670:function(t,e,n){"use strict";function r(t){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.d(e,"a",(function(){return r}))},1838:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"c",(function(){return u})),n.d(e,"b",(function(){return f}));var r=n(1496),i=n(1497),a=n(438),o=n.n(a),s={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",NONE:"NONE"},c=s.DEBUG,u=function(t){c=t},l={showLevel:!0,displayAllErrors:!1},f=function(){function t(e,n){Object(r.a)(this,t),this.category=e,this.options=o()({},l,n)}return Object(i.a)(t,[{key:"debug",value:function(t){this._shouldLog(s.DEBUG)&&this._log(s.DEBUG,t)}},{key:"info",value:function(t){this._shouldLog(s.INFO)&&this._log(s.INFO,t)}},{key:"warn",value:function(t){this._shouldLog(s.WARN)&&this._log(s.WARN,t)}},{key:"error",value:function(t){(this.options.displayAllErrors||this._shouldLog(s.ERROR))&&this._log(s.ERROR,t)}},{key:"_log",value:function(t,e){var n=this._generateLogMessage(t,e);console.log(n)}},{key:"_generateLogMessage",value:function(t,e){var n="";return this.options.showLevel&&(n+="["+t+"]"+(t===s.INFO||t===s.WARN?" ":"")+" "),this.category&&(n+=this.category+" => "),n+e}},{key:"_shouldLog",value:function(t){var e=c,n=Object.keys(s).map((function(t){return s[t]}));return n.indexOf(t)>=n.indexOf(e)}}]),t}()},1839:function(t,e,n){"use strict";function r(){var t="__SPLITSOFTWARE__";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(e){return!1}}n.d(e,"a",(function(){return r}))},2060:function(t,e,n){t.exports=n(2061)},2061:function(t,e,n){var r,i;void 0===(i="function"===typeof(r=function(){"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var t={MAX_CODEPOINT:1114111,encodeUTF8:function(t,e){var n=null;for("number"===typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<128?e(127&n):n<2048?(e(n>>6&31|192),e(63&n|128)):n<65536?(e(n>>12&15|224),e(n>>6&63|128),e(63&n|128)):(e(n>>18&7|240),e(n>>12&63|128),e(n>>6&63|128),e(63&n|128)),n=null},decodeUTF8:function(t,e){for(var n,r,i,a,o=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(n=t());)if(0===(128&n))e(n);else if(192===(224&n))null===(r=t())&&o([n,r]),e((31&n)<<6|63&r);else if(224===(240&n))(null===(r=t())||null===(i=t()))&&o([n,r,i]),e((15&n)<<12|(63&r)<<6|63&i);else{if(240!==(248&n))throw RangeError("Illegal starting byte: "+n);(null===(r=t())||null===(i=t())||null===(a=t()))&&o([n,r,i,a]),e((7&n)<<18|(63&r)<<12|(63&i)<<6|63&a)}},UTF16toUTF8:function(t,e){for(var n,r=null;null!==(n=null!==r?r:t());)n>=55296&&n<=57343&&null!==(r=t())&&r>=56320&&r<=57343?(e(1024*(n-55296)+r-56320+65536),r=null):e(n);null!==r&&e(r)},UTF8toUTF16:function(t,e){var n=null;for("number"===typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<=65535?e(n):(e(55296+((n-=65536)>>10)),e(n%1024+56320)),n=null},encodeUTF16toUTF8:function(e,n){t.UTF16toUTF8(e,(function(e){t.encodeUTF8(e,n)}))},decodeUTF8toUTF16:function(e,n){t.decodeUTF8(e,(function(e){t.UTF8toUTF16(e,n)}))},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(t){for(var e,n=0;null!==(e=t());)n+=e<128?1:e<2048?2:e<65536?3:4;return n},calculateUTF16asUTF8:function(e){var n=0,r=0;return t.UTF16toUTF8(e,(function(t){++n,r+=t<128?1:t<2048?2:t<65536?3:4})),[n,r]}},e=String.fromCharCode;return t.arraySource=function(t){if(!Array.isArray(t))throw TypeError("Illegal argument: "+typeof t);var e=0;return function(){return e>=t.length?null:t[e++]}},t.arrayDestination=function(t){if(!Array.isArray(t))throw TypeError("Illegal argument: "+typeof t);return Array.prototype.push.bind(t)},t.stringSource=function(t){if("string"!==typeof t)throw TypeError("Illegal argument: "+typeof t);var e=0;return function(){return e>=t.length?null:t.charCodeAt(e++)}},t.stringDestination=function(){var t=[],n=[];return function(){if(0===arguments.length)return n.join("")+e.apply(String,t);t.length+arguments.length>1024&&(n.push(e.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}},t.assertCharCode=function(t){if("number"!==typeof t||t!==t)throw TypeError("Illegal char code: "+typeof t);if(t<0||t>65535)throw RangeError("Illegal char code: "+t);return t},t.assertCodePoint=function(e){if("number"!==typeof e||e!==e)throw TypeError("Illegal code point: "+typeof e);if(e<0||e>t.MAX_CODEPOINT)throw RangeError("Illegal code point: "+e);return e},t.fromCodePoint=function(e){var n,r=0,i=arguments,a=i.length;return t.UTF8toUTF16((function(){return r<a?t.assertCodePoint(i[r++]):null}),n=t.stringDestination()),n()},t.codePointAt=function(e,n){if("string"!==typeof e&&!(e&&e instanceof String)||"number"!==typeof n)throw TypeError("Illegal arguments: "+typeof e+", "+typeof n);var r,i;if(!(n<0||n>=(r=e.length)))return t.UTF16toUTF8((function(){return"undefined"===typeof i&&n<r?e.charCodeAt(n++):null}),(function(t){i=t})),i},t.polyfill=function(e){return String.fromCodePoint&&!e||(String.fromCodePoint=t.fromCodePoint),String.prototype.codePointAt&&!e||(String.prototype.codePointAt=function(e){return t.codePointAt(this,e)}),t},t})?r.call(e,n,e,t):r)||(t.exports=i)},2440:function(t,e,n){"use strict";n.r(e);var r=n(438),i=n.n(r),a=function(t){return void 0!==t&&null!==t&&"function"===typeof t.then},o=n(1491),s=n(1488),c=Object(s.b)("",{displayAllErrors:!0}),u={};function l(t){u[t]&&u[t]--,0===u[t]&&delete u[t]}var f=Object(s.b)("");var h=Object(s.b)(""),p=/^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/;function g(t,e){if(void 0==t)h.error("".concat(e,": you passed a null or undefined event_type, event_type must be a non-empty string."));else if(Object(o.j)(t))if(0===t.length)h.error("".concat(e,": you passed an empty event_type, event_type must be a non-empty string."));else{if(p.test(t))return t;h.error("".concat(e,': you passed "').concat(t,'", event_type must adhere to the regular expression /^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/g. This means an event_type must be alphanumeric, cannot be more than 80 characters long, and can only include a dash, underscore, period, or colon as separators of alphanumeric characters.'))}else h.error("".concat(e,": you passed an invalid event_type, event_type must be a non-empty string."));return!1}var d=Object(s.b)("");function m(t,e){return Object(o.l)(t)||void 0==t?t:(d.error("".concat(e,": value must be a finite number.")),!1)}var v=Object(s.b)(""),y=0,S=2,T=4,b=8;function E(t,e){if(void 0==t)return{properties:null,size:1024};if(!Object(o.i)(t))return v.error("".concat(e,": properties must be a plain object.")),{properties:!1,size:1024};var n=Object.keys(t),r=Object(o.n)(t),i={properties:r,size:1024};n.length>300&&v.warn("".concat(e,": Event has more than 300 properties. Some of them will be trimmed when processed."));for(var a=0;a<n.length;a++){i.size+=n[a].length*S;var s=r[n[a]],c=Object(o.j)(s),u=Object(o.l)(s),l=Object(o.h)(s),f=null===s;if(c||u||l||f||(r[n[a]]=null,s=null,f=!0,v.warn("".concat(e,": Property ").concat(n[a]," is of invalid type. Setting value to null."))),f?i.size+=y:u?i.size+=b:l?i.size+=T:c&&(i.size+=s.length*S),i.size>32768){v.error("".concat(e,": The maximum size allowed for the properties is 32768 bytes, which was exceeded. Event not queued.")),i.properties=!1;break}}return i}var O=Object(s.b)("");function _(t,e,n){if(void 0==t)return O.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string.")),!1;if(Object(o.l)(t))return O.warn("".concat(e,": ").concat(n,' "').concat(t,'" is not of type string, converting.')),Object(o.q)(t);if(Object(o.j)(t)){if((t=t.trim()).length>0&&t.length<=250)return t;0===t.length?O.error("".concat(e,": you passed an empty string, ").concat(n," must be a non-empty string.")):t.length>250&&O.error("".concat(e,": ").concat(n," too long, ").concat(n," must be 250 characters or less."))}else O.error("".concat(e,": you passed an invalid ").concat(n," type, ").concat(n," must be a non-empty string."));return!1}function N(t,e){if(Object(o.i)(t)){var n=_(t.matchingKey,e,"matchingKey"),r=_(t.bucketingKey,e,"bucketingKey");return n&&r?{matchingKey:n,bucketingKey:r}:(O.error("".concat(e,": Key must be an object with bucketingKey and matchingKey with valid string properties.")),!1)}return _(t,e,"key")}var k=Object(s.b)(""),A=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/;function R(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"split name";if(void 0==t)k.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string."));else if(Object(o.j)(t)){if(A.test(t)&&(k.warn("".concat(e,": ").concat(n,' "').concat(t,'" has extra whitespace, trimming.')),t=t.trim()),t.length>0)return t;k.error("".concat(e,": you passed an empty ").concat(n,", ").concat(n," must be a non-empty string."))}else k.error("".concat(e,": you passed an invalid ").concat(n,", ").concat(n," must be a non-empty string."));return!1}function I(t,e,n,r){return!t.get(t.constants.READY,!0)||"definition not found"!==n&&null!=n||(k.warn("".concat(r,': you passed "').concat(e,'" that does not exist in this environment, please double check what Splits exist in the web console.')),!1)}var C=Object(s.b)("");function w(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"split_names",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"split name";if(Array.isArray(t)&&t.length>0){var i=[];if(t.forEach((function(t){var n=R(t,e,r);n&&i.push(n)})),i.length)return Object(o.s)(i)}return C.error("".concat(e,": ").concat(n," must be a non-empty array.")),!1}var D="standalone",j="producer",M="consumer",L="control",P={treatment:L,config:null},F=[{type:"byName",maxLength:400,queryParam:"names="},{type:"byPrefix",maxLength:50,queryParam:"prefixes="}],K="DEBUG",U="OPTIMIZED",G=Object(s.b)(""),x=/[A-Z]/;function H(t,e){if(void 0==t)G.error("".concat(e,": you passed a null or undefined traffic_type_name, traffic_type_name must be a non-empty string."));else if(Object(o.j)(t)){if(0!==t.length)return x.test(t)&&(G.warn("".concat(e,": traffic_type_name should be all lowercase - converting string to lowercase.")),t=t.toLowerCase()),t;G.error("".concat(e,": you passed an empty traffic_type_name, traffic_type_name must be a non-empty string."))}else G.error("".concat(e,": you passed an invalid traffic_type_name, traffic_type_name must be a non-empty string."));return!1}function W(t,e){G.warn("".concat(t,": Traffic Type ").concat(e," does not have any corresponding Splits in this environment, make sure you're tracking your events to a valid traffic type defined in the Split console."))}function B(t,e,n){var r=e.get(e.constants.READY,!0),i=e.get(e.constants.SETTINGS),o=e.get(e.constants.STORAGE).splits;if(!r||"localhost"===i.mode)return!0;var s=o.trafficTypeExists(t);return a(s)?s.then((function(e){return e||W(n,t),e})):s||W(n,t),s}var Y=Object(s.b)("",{displayAllErrors:!0});function q(t){return!t.get(t.constants.DESTROYED,!0)||(Y.error("Client has already been destroyed - no calls possible."),!1)}function z(t,e){return!(!t.get(t.constants.READY,!0)&&!t.get(t.constants.READY_FROM_CACHE,!0))||(Y.warn("".concat(e,": the SDK is not ready, results may be incorrect. Make sure to wait for SDK readiness before using this method.")),!1)}var V=function(t){var e=t.conditions,n=Object(o.b)(e,(function(t){return"ROLLOUT"===t.conditionType}));return n||(n=e[0]),n?n.partitions.map((function(t){return t.treatment})):[]},Q=function(t){var e;try{e=JSON.parse(t)}catch(n){return null}return null==e?null:{name:e.name,trafficType:e.trafficTypeName||null,killed:e.killed,changeNumber:e.changeNumber||0,treatments:V(e),configs:e.configurations||{}}},J=function(t){var e=[];return t.forEach((function(t){var n=Q(t);null!=n&&e.push(n)})),e};var $=function(t,e){var n=e.get(e.constants.STATUS_MANAGER);return i()(Object.create(n),{split:function(n){var r=R(n,"split");if(!q(e)||!z(e,"split")||!r)return null;var i=t.getSplit(r);return a(i)?i.then((function(t){return I(e,r,t,"split"),Q(t)})):(I(e,r,i,"split"),Q(i))},splits:function(){if(!q(e)||!z(e,"splits"))return[];var n=t.getAll();return a(n)?n.then(J):J(n)},names:function(){return q(e)&&z(e,"names")?t.getKeys():[]}})},Z=n(1496),X=n(1497);var tt=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=0;e<t.length;e++)for(var n=t[e].matcherGroup.matchers,r=0;r<n.length;r++)if("IN_SEGMENT"===n[r].matcherType)return!0;return!1};function et(t,e,n){var r=this,i=this.getSplit(t);return(a(i)?i:Promise.resolve(i)).then((function(i){if(i){var a=JSON.parse(i);if(!a.changeNumber||a.changeNumber<n){a.killed=!0,a.defaultTreatment=e,a.changeNumber=n;var o=JSON.stringify(a);return r.addSplit(t,o)}}return!1}))}var nt=function(){function t(){Object(Z.a)(this,t),this.flush()}return Object(X.a)(t,[{key:"addSplit",value:function(t,e){var n=this.getSplit(t);if(n){var r=JSON.parse(n);if(r.trafficTypeName){var i=r.trafficTypeName;this.ttCache[i]--,this.ttCache[i]||delete this.ttCache[i]}tt(r.conditions)&&this.splitsWithSegmentsCount--}var a=JSON.parse(e);if(a){this.splitCache[t]=e;var o=a.trafficTypeName;return o&&(this.ttCache[o]||(this.ttCache[o]=0),this.ttCache[o]++),tt(a.conditions)&&this.splitsWithSegmentsCount++,!0}return!1}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.addSplit(t[0],t[1]))})),n}},{key:"removeSplit",value:function(t){var e=this.getSplit(t);if(e){delete this.splitCache[t];var n=JSON.parse(e),r=n.trafficTypeName;return r&&(this.ttCache[r]--,this.ttCache[r]||delete this.ttCache[r]),tt(n.conditions)&&this.splitsWithSegmentsCount--,1}return 0}},{key:"removeSplits",value:function(t){var e=this;return t.forEach((function(t){return e.removeSplit(t)})),t.length}},{key:"getSplit",value:function(t){return this.splitCache[t]}},{key:"setChangeNumber",value:function(t){return this.changeNumber=t,!0}},{key:"getChangeNumber",value:function(){return this.changeNumber}},{key:"getAll",value:function(){var t=this;return this.getKeys().map((function(e){return t.splitCache[e]}))}},{key:"getKeys",value:function(){return Object.keys(this.splitCache)}},{key:"trafficTypeExists",value:function(t){return Object(o.l)(this.ttCache[t])&&this.ttCache[t]>0}},{key:"usesSegments",value:function(){return-1===this.getChangeNumber()||this.splitsWithSegmentsCount>0}},{key:"flush",value:function(){this.splitCache={},this.ttCache={},this.changeNumber=-1,this.splitsWithSegmentsCount=0}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach((function(t){n[t]=e.splitCache[t]||null})),n}},{key:"checkCache",value:function(){return!1}}]),t}();nt.prototype.killLocally=et;var rt=nt,it=Object(s.b)("splitio-storage:localstorage"),at=function(){function t(e,n,r){Object(Z.a)(this,t),this.keys=e,this.splitFiltersValidation=r,this.__checkExpiration(n),this.__checkFilterQuery()}return Object(X.a)(t,[{key:"decrementCount",value:function(t){var e=Object(o.p)(localStorage.getItem(t))-1;e>0?localStorage.setItem(t,e):localStorage.removeItem(t)}},{key:"decrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);this.decrementCount(e)}if(tt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();this.decrementCount(n)}}}catch(r){it.error(r)}}},{key:"incrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);localStorage.setItem(e,Object(o.p)(localStorage.getItem(e))+1)}if(tt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();localStorage.setItem(n,Object(o.p)(localStorage.getItem(n))+1)}}}catch(r){it.error(r)}}},{key:"addSplit",value:function(t,e){try{var n=this.keys.buildSplitKey(t),r=localStorage.getItem(n),i=r?JSON.parse(r):null;this.decrementCounts(i),localStorage.setItem(n,e);var a=e?JSON.parse(e):null;return this.incrementCounts(a),!0}catch(o){return it.error(o),!1}}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.addSplit(t[0],t[1]))})),n}},{key:"removeSplit",value:function(t){try{var e=this.getSplit(t);localStorage.removeItem(this.keys.buildSplitKey(t));var n=JSON.parse(e);return this.decrementCounts(n),1}catch(r){return it.error(r),0}}},{key:"removeSplits",value:function(t){for(var e=0,n=t.length,r=0;e<n;e++)r+=this.removeSplit(t[e]);return r}},{key:"getSplit",value:function(t){return localStorage.getItem(this.keys.buildSplitKey(t))}},{key:"setChangeNumber",value:function(t){if(this.cacheReadyButNeedsToFlush&&(this.flush(),this.cacheReadyButNeedsToFlush=!1),this.updateNewFilter){it.info("Split filter query was modified. Updating cache.");var e=this.keys.buildSplitsFilterQueryKey(),n=this.splitFiltersValidation.queryString;try{n?localStorage.setItem(e,n):localStorage.removeItem(e)}catch(r){it.error(r)}this.updateNewFilter=!1}try{return localStorage.setItem(this.keys.buildSplitsTillKey(),t+""),localStorage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+""),this.hasSync=!0,!0}catch(r){return it.error(r),!1}}},{key:"getChangeNumber",value:function(){var t=localStorage.getItem(this.keys.buildSplitsTillKey());return null!==t?(t=parseInt(t,10),Object(o.m)(t)?-1:t):-1}},{key:"getAll",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n),i=r&&localStorage.getItem(r);null!=r&&this.keys.isSplitKey(r)&&i&&e.push(i),n++}return e}},{key:"getKeys",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n);null!=r&&this.keys.isSplitKey(r)&&e.push(this.keys.extractKey(r)),n++}return e}},{key:"trafficTypeExists",value:function(t){var e=Object(o.p)(localStorage.getItem(this.keys.buildTrafficTypeKey(t)));return Object(o.l)(e)&&e>0}},{key:"usesSegments",value:function(){if(!this.hasSync)return!0;var t=localStorage.getItem(this.keys.buildSplitsWithSegmentCountKey()),e=null===t?0:Object(o.p)(t);return!Object(o.l)(e)||e>0}},{key:"flush",value:function(){it.info("Flushing Splits data from localStorage");for(var t=localStorage.length,e=[],n=0;n<t;n++){var r=localStorage.key(n);null!=r&&this.keys.isSplitCacheKey(r)&&e.push(r)}e.forEach((function(t){localStorage.removeItem(t)})),this.hasSync=!1}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach((function(t){n[t]=localStorage.getItem(e.keys.buildSplitKey(t))})),n}},{key:"checkCache",value:function(){return this.getChangeNumber()>-1||this.cacheReadyButNeedsToFlush}},{key:"__checkExpiration",value:function(t){var e=localStorage.getItem(this.keys.buildLastUpdatedKey());null!==e&&(e=parseInt(e,10),!Object(o.m)(e)&&e<t&&this.flush())}},{key:"__checkFilterQuery",value:function(){var t=this,e=this.splitFiltersValidation,n=e.queryString,r=e.groupedFilters,i=this.keys.buildSplitsFilterQueryKey();if(localStorage.getItem(i)!==n)try{this.updateNewFilter=!0,this.checkCache()&&(localStorage.setItem(this.keys.buildSplitsTillKey(),"-1"),this.getKeys().forEach((function(e){n&&(r.byName.indexOf(e)>-1||r.byPrefix.some((function(t){return e.startsWith(t+"__")})))?t.cacheReadyButNeedsToFlush=!0:t.removeSplit(e)})))}catch(a){it.error(a)}}}]),t}();at.prototype.killLocally=et;var ot=at,st=function(){function t(e){Object(Z.a)(this,t),this.keys=e,this.flush()}return Object(X.a)(t,[{key:"flush",value:function(){this.segmentCache={}}},{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return this.segmentCache[e]=!0,!0}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return delete this.segmentCache[e],!0}},{key:"resetSegments",value:function(t){var e,n=this,r=!1,i=Object.keys(this.segmentCache);if(0===t.length&&i.length===t.length)return r;if(i.length!==t.length)r=!0,this.segmentCache={},t.forEach((function(t){n.addToSegment(t)}));else{for(e=0;e<t.length&&this.isInSegment(t[e]);e++);e<t.length&&(r=!0,this.segmentCache={},t.forEach((function(t){n.addToSegment(t)})))}return r}},{key:"isInSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return!0===this.segmentCache[e]}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}}]),t}(),ct=Object(s.b)("splitio-storage:localstorage"),ut=function(){function t(e){Object(Z.a)(this,t),this.keys=e}return Object(X.a)(t,[{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.setItem(e,"1"),!0}catch(n){return ct.error(n),!1}}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.removeItem(e),!0}catch(n){return ct.error(n),!1}}},{key:"resetSegments",value:function(t){var e,n=this,r=!1,i=Object.keys(localStorage).reduce((function(t,e){var r=n.keys.extractSegmentName(e);return r&&t.push(r),t}),[]);if(0===t.length&&i.length===t.length)return r;if(i.length!==t.length)r=!0,i.forEach((function(t){return n.removeFromSegment(t)})),t.forEach((function(t){return n.addToSegment(t)}));else{for(e=0;e<t.length&&-1!==i.indexOf(t[e]);e++);e<t.length&&(r=!0,i.forEach((function(t){return n.removeFromSegment(t)})),t.forEach((function(t){return n.addToSegment(t)})))}return r}},{key:"isInSegment",value:function(t){return"1"===localStorage.getItem(this.keys.buildSegmentNameKey(t))}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}},{key:"flush",value:function(){ct.info("Flushing MySegments data from localStorage"),this.resetSegments([])}}]),t}();function lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ft(t){return function(t){if(Array.isArray(t))return lt(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"===typeof t)return lt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ht=function(){function t(){Object(Z.a)(this,t),this.queue=[]}return Object(X.a)(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t){var e;return(e=this.queue).push.apply(e,ft(t)),this}},{key:"clear",value:function(){return this.queue.length=0,this}},{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}}]),t}();var pt=function(t,e){for(var n=0,r=t.length-1,i=Math.floor((r+n)/2),a=n,o=r;t[i]!==e&&n<r;)e<t[i]?r=i-1:e>t[i]&&(n=i+1),i=Math.floor((r+n)/2);return i<a?i=a:i>o&&(i=o),e<t[i]&&i>a?i-1:i}.bind(null,[1,1.5,2.25,3.38,5.06,7.59,11.39,17.09,25.63,38.44,57.67,86.5,129.75,194.62,291.93,437.89,656.84,985.26,1477.89,2216.84,3325.26,4987.89,7481.83]),gt=function(){function t(){Object(Z.a)(this,t),this.clear()}return Object(X.a)(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:function(t,e){return void 0===this.counters[t]&&(this.counters[t]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.counters[t][pt(e)]++,this}},{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),dt=function(){function t(){Object(Z.a)(this,t),this.clear()}return Object(X.a)(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:function(t){return void 0===this.counters[t]?this.counters[t]=1:this.counters[t]++,this.counters[t]}},{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),mt=function(){function t(e){var n=this;Object(Z.a)(this,t);var r=e.get(e.constants.SETTINGS),i=e.get(e.constants.EVENTS);this.onFullQueue=!1,this.maxQueue=r.scheduler.eventsQueueSize,this.queue=[],this.queueByteSize=0,a(i)?i.then((function(t){n.onFullQueue=t.flushAndResetTimer,n._checkForFlush()})):"function"===typeof i.flushAndResetTimer&&(this.onFullQueue=i.flushAndResetTimer)}return Object(X.a)(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.queueByteSize+=e,this.queue.push(t),this._checkForFlush(),!0}},{key:"clear",value:function(){return this.queue=[],this.queueByteSize=0,this}},{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}},{key:"_checkForFlush",value:function(){(this.queueByteSize>5242880||this.maxQueue>0&&this.queue.length>=this.maxQueue)&&this.onFullQueue&&this.onFullQueue()}}]),t}(),vt=/[^.]+$/,yt=/count\.([^/]+)$/,St=/latency\.([^/]+)\.bucket\.([0-9]+)$/,Tt=function(){function t(e){Object(Z.a)(this,t),this.settings=e}return Object(X.a)(t,[{key:"buildSplitKey",value:function(t){return"".concat(this.settings.storage.prefix,".split.").concat(t)}},{key:"buildTrafficTypeKey",value:function(t){return"".concat(this.settings.storage.prefix,".trafficType.").concat(t)}},{key:"buildSplitsTillKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.till")}},{key:"buildSplitsReady",value:function(){return"".concat(this.settings.storage.prefix,".splits.ready")}},{key:"isSplitKey",value:function(t){return Object(o.o)(t,"".concat(this.settings.storage.prefix,".split."))}},{key:"buildSegmentNameKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"buildSegmentTillKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t,".till")}},{key:"buildRegisteredSegmentsKey",value:function(){return"".concat(this.settings.storage.prefix,".segments.registered")}},{key:"buildSegmentsReady",value:function(){return"".concat(this.settings.storage.prefix,".segments.ready")}},{key:"buildVersionablePrefix",value:function(){return"".concat(this.settings.storage.prefix,"/").concat(this.settings.version,"/").concat(this.settings.runtime.ip)}},{key:"buildImpressionsKey",value:function(){return"".concat(this.settings.storage.prefix,".impressions")}},{key:"buildEventsKey",value:function(){return"".concat(this.settings.storage.prefix,".events")}},{key:"buildLatencyKeyPrefix",value:function(){return"".concat(this.buildVersionablePrefix(),"/latency")}},{key:"buildLatencyKey",value:function(t,e){return"".concat(this.buildLatencyKeyPrefix(),".").concat(t,".bucket.").concat(e)}},{key:"buildCountKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/count.").concat(t)}},{key:"buildGaugeKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/gauge.").concat(t)}},{key:"searchPatternForCountKeys",value:function(){return"".concat(this.buildVersionablePrefix(),"/count.*")}},{key:"searchPatternForSplitKeys",value:function(){return"".concat(this.settings.storage.prefix,".split.*")}},{key:"searchPatternForLatency",value:function(){return"".concat(this.buildLatencyKeyPrefix(),".*")}},{key:"extractKey",value:function(t){var e=t.match(vt);if(e&&e.length)return e[0];throw"Invalid latency key provided"}},{key:"extractCounterName",value:function(t){var e=t.match(yt);if(e&&e.length)return e[1];throw"Invalid counter key provided"}},{key:"extractLatencyMetricNameAndBucket",value:function(t){var e=t.match(St);if(e&&e.length>2)return{metricName:e[1],bucketNumber:e[2]};throw"Invalid counter key provided"}}]),t}();function bt(t,e){return(bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Et(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bt(t,e)}var Ot=n(1670);function _t(t,e){return!e||"object"!==Object(Ot.a)(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Nt(t){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kt(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){return Object(o.i)(n)?n[t]:e?void 0:n}}var At=kt("matchingKey"),Rt=kt("bucketingKey",!0);function It(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Nt(t);if(e){var i=Nt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _t(this,n)}}var Ct=function(t){Et(n,t);var e=It(n);function n(t){var r;return Object(Z.a)(this,n),(r=e.call(this,t)).regexSplitCacheKey=new RegExp("^".concat(r.settings.storage.prefix,"\\.(splits?|trafficType)\\.")),r}return Object(X.a)(n,[{key:"buildSegmentNameKey",value:function(t){return"".concat(At(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"extractSegmentName",value:function(t){var e="".concat(At(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.");if(Object(o.o)(t,e))return t.substr(e.length)}},{key:"buildSplitsWithSegmentCountKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.usingSegments")}},{key:"buildLastUpdatedKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.lastUpdated")}},{key:"isSplitCacheKey",value:function(t){return this.regexSplitCacheKey.test(t)}},{key:"buildSplitsFilterQueryKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.filterQuery")}}]),n}(Tt),wt=function(t){var e=t.get(t.constants.SETTINGS);switch(e.storage.type){case"MEMORY":var n=new Tt(e);return{splits:new rt,segments:new st(n),impressions:new ht,metrics:new gt,count:new dt,events:new mt(t),shared:function(t){var e=new Tt(t);return{splits:this.splits,segments:new st(e),impressions:this.impressions,metrics:this.metrics,count:this.count,events:this.events,destroy:function(){this.splits=new rt,this.segments.flush()}}},destroy:function(){this.splits.flush(),this.segments.flush(),this.impressions.clear(),this.metrics.clear(),this.count.clear(),this.events.clear()}};case"LOCALSTORAGE":var r=new Ct(e),i=Date.now()-864e6;return{splits:new ot(r,i,e.sync.__splitFiltersValidation),segments:new ut(r),impressions:new ht,metrics:new gt,count:new dt,events:new mt(t),shared:function(t){var e=new Ct(t);return{splits:this.splits,segments:new ut(e),impressions:this.impressions,metrics:this.metrics,count:this.count,events:this.events,destroy:function(){this.splits=new rt,this.segments=new st(e)}}},destroy:function(){this.splits=new rt,this.segments=new st(new Tt(e)),this.impressions.clear(),this.metrics.clear(),this.count.clear(),this.events.clear()}};default:throw new Error("Unsupported storage type")}},Dt=n(691),jt=n.n(Dt),Mt="init::timeout",Lt="init::ready",Pt="init::cache-ready",Ft="state::splits-arrived",Kt="state::segments-arrived",Ut="state::splits-cache-loaded",Gt="state::update",xt="state::check";var Ht=function(){var t=0,e=new jt.a;e.SDK_SPLITS_CACHE_LOADED=Ut,e.SDK_SPLITS_ARRIVED=Ft;var n=0;function r(e,n){var r=new jt.a,i=0,a=0;return r.on(xt,(function(){14!==a&&t+i===6?(a=14,r.emit(Lt)):14===a&&r.emit(Gt)})),e.on(Ft,(function(e){e||(t=2),r.emit(xt)})),e.once(Ut,(function(){setTimeout((function(){return r.emit(Pt)}),0)})),n.on(Kt,(function(){i=4,r.emit(xt)})),r}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=0,a=new jt.a;a.SDK_SEGMENTS_ARRIVED=Kt;var o=r(e,a);return t>0&&(i=setTimeout((function(){o.emit(Mt,"Split SDK emitted SDK_READY_TIMED_OUT event.")}),t),o.once(Lt,(function(){return clearTimeout(i)}))),o.SDK_READY=Lt,o.SDK_READY_FROM_CACHE=Pt,o.SDK_UPDATE=Gt,o.SDK_READY_TIMED_OUT=Mt,n++,{splits:e,segments:a,gate:o,destroy:function(){a.removeAllListeners(),o.removeAllListeners(),clearTimeout(i),n>0&&n--,0===n&&e.removeAllListeners()}}}},Wt={startup:{requestTimeoutBeforeReady:5,retriesOnFailureBeforeReady:1,readyTimeout:10,eventsFirstPushWindow:10}},Bt=n(1839),Yt=Object(s.b)("splitio-settings"),qt=function(t){var e=t.mode,n=t.storage,r=n.type,i=void 0===r?"MEMORY":r,a=n.options,o=void 0===a?{}:a,s=n.prefix;return s?s+=".SPLITIO":s="SPLITIO","localhost"===e?{type:"MEMORY",prefix:s}:(("MEMORY"!==i&&"LOCALSTORAGE"!==i||"LOCALSTORAGE"===i&&!Object(Bt.a)())&&(i="MEMORY",Yt.warn("Invalid or unavailable storage. Fallbacking into MEMORY storage")),{type:i,options:o,prefix:s})},zt=Object(s.b)("splitio-settings"),Vt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=t.integrations;if(!Array.isArray(n)||0===n.length)return[];var r=n.filter((function(t){return t&&Object(o.j)(t.type)&&e.indexOf(t.type)>-1})),i=n.length-r.length;return i&&zt.warn("".concat(i," integration ").concat(1===i?"item":"items"," at settings ").concat(1===i?"is":"are"," invalid: integration items must have a valid 'type' value")),r},Qt=function(t){return Vt(t,["GOOGLE_ANALYTICS_TO_SPLIT","SPLIT_TO_GOOGLE_ANALYTICS"])};var Jt=function(t,e){if("localhost"===t)return"localhost";if(-1===[D,j,M].indexOf(e))throw Error("Invalid mode provided");return e},$t=Object(s.b)("");function Zt(t,e){var n={validFilters:[],queryString:null,groupedFilters:{}};return t?e!==D?($t.warn("Factory instantiation: split filters have been configured but will have no effect if mode is not '".concat(D,"', since synchronization is being deferred to an external tool.")),n):Array.isArray(t)&&0!==t.length?(F.forEach((function(t){n.groupedFilters[t.type]=[]})),n.validFilters=t.filter((function(t,e){return t&&(r=t.type,F.some((function(t){return t.type===r})))&&Array.isArray(t.values)?(n.groupedFilters[t.type]=n.groupedFilters[t.type].concat(t.values),!0):($t.warn("Factory instantiation: split filter at position '".concat(e,"' is invalid. It must be an object with a valid filter type ('byName' or 'byPrefix') and a list of 'values'.")),!1);var r})),F.forEach((function(t){var e=t.type,r=t.maxLength;n.groupedFilters[e].length>0&&(n.groupedFilters[e]=function(t,e,n){var r=w(e,"Factory instantiation","".concat(t," filter"),"".concat(t," filter value"));if(r){if(r.length>n)throw new Error("".concat(n," unique values can be specified at most for '").concat(t,"' filter. You passed ").concat(r.length,". Please consider reducing the amount or using other filter."));r.sort()}return r||[]}(e,n.groupedFilters[e],r))})),n.queryString=function(t){var e=[];return F.forEach((function(n){var r=n.type,i=n.queryParam,a=t[r];a.length>0&&e.push(i+a.map((function(t){return encodeURIComponent(t)})).join(","))})),e.length>0?"&"+e.join("&"):null}(n.groupedFilters),$t.debug("Factory instantiation: splits filtering criteria is '".concat(n.queryString,"'.")),n):($t.warn("Factory instantiation: splitFilters configuration must be a non-empty array of filter objects."),n):n}var Xt=Object(s.b)("splitio-settings");var te=function(t){return t=t.toUpperCase(),-1===[K,U].indexOf(t)&&(Xt.error("You passed an invalid impressionsMode, impressionsMode should be one of the following values: '".concat(K,"' or '").concat(U,"'. Defaulting to '").concat(U,"' mode.")),t=U),t},ee=/^\/(testImpressions|metrics|events)/,ne=/^\/auth/,re=/^\/(sse|event-stream)/,ie={mode:D,core:{authorizationKey:void 0,key:void 0,trafficType:void 0,labelsEnabled:!0,IPAddressesEnabled:void 0},scheduler:{featuresRefreshRate:30,segmentsRefreshRate:60,metricsRefreshRate:120,impressionsRefreshRate:60,offlineRefreshRate:15,eventsPushRate:60,eventsQueueSize:500,authRetryBackoffBase:1,streamingReconnectBackoffBase:1},urls:{sdk:"https://sdk.split.io/api",events:"https://events.split.io/api",auth:"https://auth.split.io/api",streaming:"https://streaming.split.io"},storage:{type:"MEMORY"},debug:void 0,impressionListener:void 0,version:"".concat("javascript","-").concat("10.15.3"),integrations:void 0,streamingEnabled:!0,sync:{splitFilters:void 0,impressionsMode:U}};function ae(t){return Math.round(1e3*t)}function oe(t){var e,n=Object(o.k)({},ie,Wt,t);n.scheduler.featuresRefreshRate=ae(n.scheduler.featuresRefreshRate),n.scheduler.segmentsRefreshRate=ae(n.scheduler.segmentsRefreshRate),n.scheduler.metricsRefreshRate=ae(n.scheduler.metricsRefreshRate),n.scheduler.impressionsRefreshRate=ae(n.scheduler.impressionsRefreshRate),n.scheduler.offlineRefreshRate=ae(n.scheduler.offlineRefreshRate),n.scheduler.eventsPushRate=ae(n.scheduler.eventsPushRate),n.startup.requestTimeoutBeforeReady=ae(n.startup.requestTimeoutBeforeReady),n.startup.readyTimeout=ae(n.startup.readyTimeout),n.startup.eventsFirstPushWindow=ae(n.startup.eventsFirstPushWindow),n.mode=Jt(n.core.authorizationKey,n.mode),n.storage=qt(n),"boolean"===typeof(e=n.debug)?e?s.a.enable():s.a.disable():"string"===typeof e&&s.a.setLogLevel(e),n.runtime=(n.core.IPAddressesEnabled,n.mode,{ip:!1,hostname:!1}),n.integrations=Qt(n),!1!==n.streamingEnabled&&(n.streamingEnabled=!0,n.scheduler.authRetryBackoffBase=ae(n.scheduler.authRetryBackoffBase),n.scheduler.streamingReconnectBackoffBase=ae(n.scheduler.streamingReconnectBackoffBase));var r=Zt(n.sync.splitFilters,n.mode);return n.sync.splitFilters=r.validFilters,n.sync.__splitFiltersValidation=r,n.sync.impressionsMode=te(n.sync.impressionsMode),n}var se={url:function(t){return ee.test(t)?"".concat(this.urls.events).concat(t):ne.test(t)?"".concat(this.urls.auth).concat(t):re.test(t)?"".concat(this.urls.streaming).concat(t):"".concat(this.urls.sdk).concat(t)},overrideKeyAndTT:function(t,e){return i()(Object.create(se),this,{core:i()({},this.core,{key:t,trafficType:e})})}},ce=function(t){return i()(Object.create(se),oe(t))},ue={COLLECTORS:"metrics_collectors",DESTROYED:"is_destroyed",EVENTS:"events_publisher",HAS_TIMEDOUT:"has_timedout",INTEGRATIONS_MANAGER:"integrations_manager",MY_SEGMENTS_CHANGE_WORKER:"my_segments_change_worker",PRODUCER:"producer",READINESS:"readiness_gate",READY:"is_ready",READY_FROM_CACHE:"is_ready_from_cache",SETTINGS:"settings",STATUS_MANAGER:"status_manager",STORAGE:"storage",IMPRESSIONS_COUNTER:"impressions_counter"},le=function(){function t(){Object(Z.a)(this,t),this._map={},this.constants=ue}return Object(X.a)(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"===typeof t&&("string"!==typeof t||t.length)){var n=this._map[t];if(void 0!==n)return n;if(!e){var r,i=new Promise((function(t){return r=t}));return i.manualResolve=r,this._map[t]=i,i}}}},{key:"getAll",value:function(){return i()({},this._map)}},{key:"put",value:function(t,e){var n=this;if("string"!==typeof t||"string"===typeof t&&!t.length||void 0===e)return!1;var r=this._map[t];return(void 0===r||"function"===typeof r.manualResolve)&&(a(r)&&r.manualResolve&&r.manualResolve(e),a(e)&&e.then((function(e){return n._map[t]=e,e})).catch((function(e){return n._map[t]=void 0,e})),this._map[t]=e,!0)}}]),t}(),fe=function(t){return Object(o.i)(t)?{matchingKey:t.matchingKey,bucketingKey:t.bucketingKey}:{matchingKey:t,bucketingKey:t}};function he(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pe=n(1838);var ge="object"===("undefined"===typeof performance?"undefined":Object(Ot.a)(performance))&&"function"===typeof performance.now?performance.now.bind(performance):Date.now;var de,me=function(){var t=ge();return function(){return Math.round(ge()-t)}},ve=new pe.b("[TIME TRACKER]",{showLevel:!1}),ye={},Se={SDK_READY:"Getting ready - Split SDK",SDK_GET_TREATMENT:"SDK - Get Treatment",SDK_GET_TREATMENTS:"SDK - Get Treatments",SDK_GET_TREATMENT_WITH_CONFIG:"SDK - Get Treatment with config",SDK_GET_TREATMENTS_WITH_CONFIG:"SDK - Get Treatments with config",SPLITS_READY:"Getting ready - Splits",SEGMENTS_READY:"Getting ready - Segments",METRICS_PUSH:"Pushing - Metrics",IMPRESSIONS_PUSH:"Pushing - Impressions",EVENTS_PUSH:"Pushing - Events",MY_SEGMENTS_FETCH:"Fetching - My Segments",SEGMENTS_FETCH:"Fetching - Segments",SPLITS_FETCH:"Fetching - Splits"},Te=(he(de={},Se.SDK_READY,{collector:"client",method:"ready"}),he(de,Se.SDK_GET_TREATMENT,{collector:"client",method:"getTreatment"}),he(de,Se.SDK_GET_TREATMENTS,{collector:"client",method:"getTreatments"}),he(de,Se.SDK_GET_TREATMENT_WITH_CONFIG,{collector:"client",method:"getTreatmentWithConfig"}),he(de,Se.SDK_GET_TREATMENTS_WITH_CONFIG,{collector:"client",method:"getTreatmentsWithConfig"}),he(de,Se.MY_SEGMENTS_FETCH,{collector:"mySegments",method:"latency"}),he(de,Se.SEGMENTS_FETCH,{collector:"segmentChanges",method:"latency"}),he(de,Se.SPLITS_FETCH,{collector:"splitChanges",method:"latency"}),de),be=function(t,e){return"string"===typeof e?t+e:t},Ee=function(t,e){var n=Te[t];return!(!n||!e)&&e[n.collector]},Oe=function(t,e){var n=Te[t];return!(!n||!e)&&e[n.method]},_e={__attachToPromise:function(t,e,n,r){var i=this;return t.then((function(t){return i.stop(e,r),n&&n.count&&n.count(t.status),t})).catch((function(t){throw i.stop(e,r),n&&n.countException&&n.countException(),t}))},start:function(t,e,n){var r,i=Object(o.t)(),s=Ee(t,e);a(n)?r=this.__attachToPromise(n,t,s,i):(r=this.stop.bind(this,t,i),Te[t]&&!s&&(r.setCollectorForTask=this.setCollectorForTask.bind(this,t,i)));var c=be(t,i),u=Oe(t,s);return ye[c]={cb:u,timer:me()},r},setCollectorForTask:function(t,e,n){var r=Ee(t,n);if(r){var i=be(t,e);ye[i].cb=Oe(t,r)}},stop:function(t,e){var n=be(t,e),r=ye[n];if(r){var i=r.timer();return ve.debug("[".concat(t,"] took ").concat(i,"ms to finish.")),r.cb&&r.cb(i),delete ye[n],i}},TaskNames:Se},Ne={ALL:1,SEGMENT:2,WHITELIST:3,EQUAL_TO:4,GREATER_THAN_OR_EQUAL_TO:5,LESS_THAN_OR_EQUAL_TO:6,BETWEEN:7,UNDEFINED:8,EQUAL_TO_SET:9,CONTAINS_ANY_OF_SET:10,CONTAINS_ALL_OF_SET:11,PART_OF_SET:12,ENDS_WITH:13,STARTS_WITH:14,CONTAINS_STRING:15,IN_SPLIT_TREATMENT:16,EQUAL_TO_BOOLEAN:17,MATCHES_STRING:18},ke={BOOLEAN:"BOOLEAN",STRING:"STRING",NUMBER:"NUMBER",SET:"SET",DATETIME:"DATETIME",NOT_SPECIFIED:"NOT_SPECIFIED"};var Ae=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.segmentName},Re=function(){function t(){var e=this;Object(Z.a)(this,t),this.__setData__=[];var n=arguments[0];Array.isArray(n)&&n.forEach((function(t){e.add(t)}))}return Object(X.a)(t,[{key:"clear",value:function(){this.__setData__.length&&(this.__setData__.length=0)}},{key:"add",value:function(t){return this.has(t)||this.__setData__.push(t),this}},{key:"delete",value:function(t){var e=this.__setData__.indexOf(t);return-1!==e&&(this.__setData__.splice(e,1),!0)}},{key:"has",value:function(t){return-1!==this.__setData__.indexOf(t)}},{key:"forEach",value:function(t){var e=arguments[1];if("function"!==typeof t)throw new TypeError(t+" is not a function");for(var n=0;n<this.__setData__.length;n++){var r=this.__setData__[n];t.call(e,r,r,this)}}},{key:"size",get:function(){return this.__setData__.length}}]),t}();function Ie(t){return t instanceof Re?t.__setData__.slice():Array.from(t)}var Ce=Array.from&&"function"===typeof Set&&Set.prototype&&Set.prototype.values?Set:Re;var we=function(t){return new Ce(t.whitelist)};var De=function(t){return t.whitelist};var je=function(t){return t.value};function Me(t){return new Date(t).setUTCHours(0,0,0,0)}function Le(t){return new Date(t).setUTCSeconds(0,0)}var Pe=function(t){var e=t.map((function(t){var e=t.matcherType,n=t.negate,r=t.keySelector,i=t.userDefinedSegmentMatcherData,a=t.whitelistMatcherData,o=t.unaryNumericMatcherData,s=t.betweenMatcherData,c=t.dependencyMatcherData,u=t.booleanMatcherData,l=t.stringMatcherData,f=r&&r.attribute,h=function(t){switch(t){case"ALL_KEYS":return Ne.ALL;case"IN_SEGMENT":return Ne.SEGMENT;case"WHITELIST":return Ne.WHITELIST;case"EQUAL_TO":return Ne.EQUAL_TO;case"GREATER_THAN_OR_EQUAL_TO":return Ne.GREATER_THAN_OR_EQUAL_TO;case"LESS_THAN_OR_EQUAL_TO":return Ne.LESS_THAN_OR_EQUAL_TO;case"BETWEEN":return Ne.BETWEEN;case"EQUAL_TO_SET":return Ne.EQUAL_TO_SET;case"CONTAINS_ANY_OF_SET":return Ne.CONTAINS_ANY_OF_SET;case"CONTAINS_ALL_OF_SET":return Ne.CONTAINS_ALL_OF_SET;case"PART_OF_SET":return Ne.PART_OF_SET;case"ENDS_WITH":return Ne.ENDS_WITH;case"STARTS_WITH":return Ne.STARTS_WITH;case"CONTAINS_STRING":return Ne.CONTAINS_STRING;case"IN_SPLIT_TREATMENT":return Ne.IN_SPLIT_TREATMENT;case"EQUAL_TO_BOOLEAN":return Ne.EQUAL_TO_BOOLEAN;case"MATCHES_STRING":return Ne.MATCHES_STRING;default:return Ne.UNDEFINED}}(e),p=ke.STRING,g=void 0;return h===Ne.SEGMENT?g=Ae(i):h===Ne.WHITELIST?g=we(a):h===Ne.EQUAL_TO?(g=je(o),p=ke.NUMBER,"DATETIME"===o.dataType&&(g=Me(g),p=ke.DATETIME)):h===Ne.GREATER_THAN_OR_EQUAL_TO||h===Ne.LESS_THAN_OR_EQUAL_TO?(g=je(o),p=ke.NUMBER,"DATETIME"===o.dataType&&(g=Le(g),p=ke.DATETIME)):h===Ne.BETWEEN?(g=s,p=ke.NUMBER,"DATETIME"===s.dataType&&(g.start=Le(g.start),g.end=Le(g.end),p=ke.DATETIME)):h===Ne.EQUAL_TO_SET||h===Ne.CONTAINS_ANY_OF_SET||h===Ne.CONTAINS_ALL_OF_SET||h===Ne.PART_OF_SET?(g=De(a),p=ke.SET):h===Ne.STARTS_WITH||h===Ne.ENDS_WITH||h===Ne.CONTAINS_STRING?g=De(a):h===Ne.IN_SPLIT_TREATMENT?(g=c,p=ke.NOT_SPECIFIED):h===Ne.EQUAL_TO_BOOLEAN?(p=ke.BOOLEAN,g=u):h===Ne.MATCHES_STRING&&(g=l),{attribute:f,negate:n,type:h,value:g,dataType:p}}));return-1===Object(o.c)(e,(function(t){return t.type===Ne.UNDEFINED}))?e:[]};function Fe(t,e){if(!(this instanceof Fe))return new Fe(t,e);if(100!==t[t.length-1])throw new RangeError("Provided invalid dataset as input");this._ranges=t,this._treatments=e}Fe.parse=function(t){var e=t.reduce((function(t,e){var n=e.size,r=e.treatment;return t.ranges.push(t.inc+=n),t.treatments.push(r),t}),{inc:0,ranges:[],treatments:[]});return new Fe(e.ranges,e.treatments)},Fe.prototype.getTreatmentFor=function(t){if(t<0||t>100)throw new RangeError("Please provide a value between 0 and 100");var e=Object(o.c)(this._ranges,(function(e){return t<=e}));return this._treatments[e]};var Ke=Fe,Ue=Object(s.b)("splitio-engine:matcher");function Ge(t){return Ue.debug("[allMatcher] is always true"),null!=t}var xe=function(){return Ge},He=Object(s.b)("splitio-engine:matcher");var We=function(t,e){return function(n){var r=e.segments.isInSegment(t,n);return a(r)?r.then((function(e){return He.debug("[asyncSegmentMatcher] evaluated ".concat(t," / ").concat(n," => ").concat(r)),e})):He.debug("[segmentMatcher] evaluated ".concat(t," / ").concat(n," => ").concat(r)),r}},Be=Object(s.b)("splitio-engine:matcher");var Ye=function(t){return function(e){var n=t.has(e);return Be.debug("[whitelistMatcher] evaluated ".concat(e," in [").concat(Ie(t).join(","),"] => ").concat(n)),n}},qe=Object(s.b)("splitio-engine:matcher");var ze=function(t){return function(e){var n=e===t;return qe.debug("[equalToMatcher] is ".concat(e," equal to ").concat(t,"? ").concat(n)),n}},Ve=Object(s.b)("splitio-engine:matcher");var Qe=function(t){return function(e){var n=e>=t;return Ve.debug("[greaterThanEqualMatcher] is ".concat(e," greater than ").concat(t,"? ").concat(n)),n}},Je=Object(s.b)("splitio-engine:matcher");var $e=function(t){return function(e){var n=e<=t;return Je.debug("[lessThanEqualMatcher] is ".concat(e," less than ").concat(t,"? ").concat(n)),n}},Ze=Object(s.b)("splitio-engine:matcher");var Xe=function(t){return function(e){var n=e>=t.start&&e<=t.end;return Ze.debug("[betweenMatcher] is ".concat(e," between ").concat(t.start," and ").concat(t.end,"? ").concat(n)),n}},tn=Object(s.b)("splitio-engine:matcher");var en=function(t){return function(e){for(var n=e.length===t.length,r=function(r){Object(o.c)(t,(function(t){return t===e[r]}))<0&&(n=!1)},i=0;i<e.length&&n;i++)r(i);return tn.debug("[equalToSetMatcher] is ".concat(e," equal to set ").concat(t,"? ").concat(n)),n}},nn=Object(s.b)("splitio-engine:matcher");var rn=function(t){return function(e){var n=!0;if(e.length<t.length)n=!1;else for(var r=function(r){Object(o.c)(e,(function(e){return e===t[r]}))<0&&(n=!1)},i=0;i<t.length&&n;i++)r(i);return nn.debug("[containsAllMatcher] ".concat(e," contains all elements of ").concat(t,"? ").concat(n)),n}},an=Object(s.b)("splitio-engine:matcher");var on=function(t){return function(e){for(var n=!1,r=function(r){Object(o.c)(e,(function(e){return e===t[r]}))>=0&&(n=!0)},i=0;i<t.length&&!n;i++)r(i);return an.debug("[containsAnyMatcher] ".concat(e," contains at least an element of ").concat(t,"? ").concat(n)),n}},sn=Object(s.b)("splitio-engine:matcher");var cn=function(t){return function(e){for(var n=e.length<=t.length,r=function(r){Object(o.c)(t,(function(t){return t===e[r]}))<0&&(n=!1)},i=0;i<e.length&&n;i++)r(i);return sn.debug("[partOfMatcher] ".concat(e," is part of ").concat(t,"? ").concat(n)),n}},un=Object(s.b)("splitio-engine:matcher");var ln=function(t){return function(e){var n=t.some((function(t){return Object(o.o)(e,t)}));return un.debug("[startsWithMatcher] ".concat(e," starts with ").concat(t,"? ").concat(n)),n}},fn=Object(s.b)("splitio-engine:matcher");var hn=function(t){return function(e){var n=t.some((function(t){return Object(o.a)(e,t)}));return fn.debug("[endsWithMatcher] ".concat(e," ends with ").concat(t,"? ").concat(n)),n}},pn=Object(s.b)("splitio-engine:matcher");var gn=function(t){return function(e){var n=t.some((function(t){return Object(o.j)(e)&&e.indexOf(t)>-1}));return pn.debug("[containsStringMatcher] ".concat(e," contains ").concat(t,"? ").concat(n)),n}},dn=Object(s.b)("splitio-engine:matcher");function mn(t,e,n){var r=!1;return Array.isArray(e)&&(r=-1!==e.indexOf(t.treatment)),dn.debug('[dependencyMatcher] Parent split "'.concat(n,'" evaluated to "').concat(t.treatment,'" with label "').concat(t.label,'". ').concat(n," evaluated treatment is part of [").concat(e,"] ? ").concat(r,".")),r}var vn=function(t,e){var n=t.split,r=t.treatments;return function(t,i){var o=t.key,s=t.attributes;dn.debug('[dependencyMatcher] will evaluate parent split: "'.concat(n,'" with key: ').concat(JSON.stringify(o)," ").concat(s?"\n attributes: ".concat(JSON.stringify(s)):""));var c=i(o,n,s,e);return a(c)?c.then((function(t){return mn(t,r,n)})):mn(c,r,n)}},yn=Object(s.b)("splitio-engine:matcher");var Sn=function(t){return function(e){var n=t===e;return yn.debug("[booleanMatcher] ".concat(t," === ").concat(e)),n}},Tn=Object(s.b)("splitio-engine:matcher");var bn=function(t){return function(e){var n;try{n=new RegExp(t)}catch(i){return Tn.debug("[stringMatcher] ".concat(t," is an invalid regex")),!1}var r=n.test(e);return Tn.debug("[stringMatcher] does ".concat(e," matches with ").concat(t,"? ").concat(r?"yes":"no")),r}};var En=function(t,e){var n,r=t.type,i=t.value;return r===Ne.ALL?n=xe(i):r===Ne.SEGMENT?n=We(i,e):r===Ne.WHITELIST?n=Ye(i):r===Ne.EQUAL_TO?n=ze(i):r===Ne.GREATER_THAN_OR_EQUAL_TO?n=Qe(i):r===Ne.LESS_THAN_OR_EQUAL_TO?n=$e(i):r===Ne.BETWEEN?n=Xe(i):r===Ne.EQUAL_TO_SET?n=en(i):r===Ne.CONTAINS_ANY_OF_SET?n=on(i):r===Ne.CONTAINS_ALL_OF_SET?n=rn(i):r===Ne.PART_OF_SET?n=cn(i):r===Ne.STARTS_WITH?n=ln(i):r===Ne.ENDS_WITH?n=hn(i):r===Ne.CONTAINS_STRING?n=gn(i):r===Ne.IN_SPLIT_TREATMENT?n=vn(i,e):r===Ne.EQUAL_TO_BOOLEAN?n=Sn(i):r===Ne.MATCHES_STRING&&(n=bn(i)),n},On=Object(s.b)("splitio-engine:sanitize"),_n=Ne,Nn=ke;function kn(t,e){return{key:t,attributes:e}}var An=function(t,e,n,r){var i,a=function(t,e){switch(t){case _n.EQUAL_TO:return"DATETIME"===e?Me:void 0;case _n.GREATER_THAN_OR_EQUAL_TO:case _n.LESS_THAN_OR_EQUAL_TO:case _n.BETWEEN:return"DATETIME"===e?Le:void 0;case _n.IN_SPLIT_TREATMENT:return kn;default:return}}(t,n);switch(n){case Nn.NUMBER:case Nn.DATETIME:i=function(t){var e=Object(o.p)(t);return isNaN(e)?void 0:e}(e);break;case Nn.STRING:i=function(t){var e=t;Object(o.i)(t)&&(e=t.matchingKey?t.matchingKey:void 0);var n=Object(o.q)(e);return n||void 0}(e);break;case Nn.SET:i=function(t){var e=Array.isArray(t)?Object(o.s)(t.map((function(t){return t+""}))):[];return e.length?e:void 0}(e);break;case Nn.BOOLEAN:i=function(t){if(!0===t||!1===t)return t;if("string"===typeof t){var e=t.toLocaleLowerCase();if("true"===e)return!0;if("false"===e)return!1}}(e);break;case Nn.NOT_SPECIFIED:i=e;break;default:i=void 0}return a&&(i=a(i,r)),On.debug("Attempted to sanitize [".concat(e,"] which should be of type [").concat(n,"]. \n Sanitized and processed value => [").concat(i instanceof Object?JSON.stringify(i):i,"]")),i},Rn=Object(s.b)("splitio-engine:value");var In=function(t,e,n){var r=e.attribute,i=function(t,e,n){var r=void 0;return e?n?(r=n[e],Rn.debug("Extracted attribute [".concat(e,"], [").concat(r,"] will be used for matching."))):Rn.warn("Defined attribute [".concat(e,"], no attributes received.")):r=t,r}(t,r,n),a=An(e.type,i,e.dataType,n);return void 0!==a?a:void Rn.warn("Value ".concat(i," ").concat(r?"for attribute ".concat(r," "):0,"doesn't match with expected type."))};function Cn(t){return e=function(t){return(t=Number(t))<0?Math.ceil(t):Math.floor(t)}(t),n=Math.pow(2,32),e-Math.floor(e/n)*n;var e,n}function wn(t){var e=Cn(t);return e>=Math.pow(2,31)?e-Math.pow(2,32):e}function Dn(t,e){for(var n=0,r=0;r<t.length;r++)n=wn(wn(31*n)+t.charCodeAt(r));return wn(n^e)}var jn=function(t,e){return Math.abs(Dn(t,e)%100)+1},Mn=n(2060),Ln=n.n(Mn),Pn=Ln.a.stringSource,Fn=Ln.a.stringDestination,Kn=Ln.a.encodeUTF16toUTF8;function Un(t,e){return(65535&t)*e+(((t>>>16)*e&65535)<<16)}function Gn(t,e){return t<<e|t>>>32-e}function xn(t,e){e=e||0;for(var n,r=(t=t||"").length%4,i=t.length-r,a=e,o=0,s=3432918353,c=461845907,u=0;u<i;u+=4)o=Un(o=255&t.charCodeAt(u)|(255&t.charCodeAt(u+1))<<8|(255&t.charCodeAt(u+2))<<16|(255&t.charCodeAt(u+3))<<24,s),o=Un(o=Gn(o,15),c),a=Un(a=Gn(a^=o,13),5)+3864292196;switch(o=0,r){case 3:o^=(255&t.charCodeAt(u+2))<<16;case 2:o^=(255&t.charCodeAt(u+1))<<8;case 1:o=Un(o^=255&t.charCodeAt(u),s),a^=o=Un(o=Gn(o,15),c)}return a^=t.length,n=a,n=Un(n^=n>>>16,2246822507),n=Un(n^=n>>>13,3266489909),(a=n^=n>>>16)>>>0}function Hn(t,e){return xn(function(t){var e;return Kn(Pn(t),e=Fn()),e()}(t),e>>>0)}var Wn={hash:Hn,bucket:function(t,e){return Math.abs(Hn(t,e)%100)+1}},Bn=Object(s.b)("splitio-engine");function Yn(t){return 2===t?Wn.bucket:jn}var qn={getTreatment:function(t,e,n,r){var i=Yn(r)(t,e),a=n.getTreatmentFor(i);return Bn.debug("[engine] using algo ".concat(2!==r?"legacy":"murmur"," bucket ").concat(i," for key ").concat(t," using seed ").concat(e," - treatment ").concat(a)),a},shouldApplyRollout:function(t,e,n,r){if(t<100&&Yn(r)(e,n)>t)return!1;return!0}};function zn(t,e,n,r,i,a){if(t)return{treatment:qn.getTreatment(e,n,r,a),label:i}}var Vn=function(t,e,n,r){return function(i,o,s,c,u,l,f){if("ROLLOUT"===r&&!qn.shouldApplyRollout(s,i.bucketingKey,c,f))return{treatment:void 0,label:"not in split"};var h=t(i,l,u);return a(h)?h.then((function(t){return zn(t,i.bucketingKey,o,e,n,f)})):zn(h,i.bucketingKey,o,e,n,f)}},Qn=Object(s.b)("splitio-engine:combiner");function Jn(){return Qn.error("Invalid Split provided, no valid conditions found"),{treatment:L,label:"exception"}}function $n(t){for(var e=t.length,n=0;n<e;n++){var r=t[n];if(void 0!==r)return Qn.debug("Treatment found: ".concat(r.treatment)),r}Qn.debug("All predicates evaluated, no treatment found.")}var Zn=function(t){return!Array.isArray(t)||Array.isArray(t)&&0===t.length?Jn:function(e,n,r,i,s,c,u){var l=t.map((function(t){return t(e,n,r,i,u,s,c)}));return-1!==Object(o.c)(l,a)?Promise.all(l).then((function(t){return $n(t)})):$n(l)}},Xn=Object(s.b)("splitio-engine:combiner");function tr(t){for(var e,n=0,r=t.length;n<r&&t[n];n++);return e=n===r,Xn.debug("[andCombiner] evaluates to ".concat(e)),e}var er=function(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=t.map((function(t){return t.apply(void 0,n)}));return-1!==Object(o.c)(i,a)?Promise.all(i).then(tr):tr(i)}};var nr=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=i.matcherGroup.matchers,s=i.partitions,c=i.label,u=i.conditionType,l=(o=Pe(o)).map((function(t){var n=En(t,e);return function(e,r,i){var o=In(e,t,r),s=void 0!==o&&n(o,i);return a(s)?s.then((function(e){return Boolean(e^t.negate)})):Boolean(s^t.negate)}}));if(0===l.length){n=[];break}n.push(Vn(er(l),Ke.parse(s),c,u))}return Zn(n)};function rr(t,e){return{treatment:Object(o.e)(t,"treatment",e),label:Object(o.e)(t,"label","default rule")}}function ir(t,e){if(!(this instanceof ir))return new ir(t,e);var n;this.baseInfo=t,this.evaluator=e,"string"!==typeof(n=this).baseInfo.defaultTreatment&&(n.baseInfo.defaultTreatment=L)}ir.parse=function(t,e){var n=t.conditions,r=nr(n,e);return new ir(i()({},t),r)},ir.prototype.getKey=function(){return this.baseInfo.name},ir.prototype.getTreatment=function(t,e,n){var r,i,o,s=this.baseInfo,c=s.killed,u=s.seed,l=s.defaultTreatment,f=s.trafficAllocation,h=s.trafficAllocationSeed,p=s.algo;try{r=fe(t)}catch(d){return{treatment:L,label:"exception"}}if(this.isGarbage())i=L,o="archived";else{if(!c){var g=this.evaluator(r,u,f,h,e,p,n);return a(g)?g.then((function(t){return rr(t,l)})):rr(g,l)}i=l,o="killed"}return{treatment:i,label:o}},ir.prototype.isGarbage=function(){return"ARCHIVED"===this.baseInfo.status},ir.prototype.getChangeNumber=function(){return this.baseInfo.changeNumber};var ar=ir,or={treatment:L,label:"exception",config:null};function sr(t,e,n,r){var i;try{i=r.splits.getSplit(e)}catch(o){return Promise.resolve(or)}return a(i)?i.then((function(e){return ur(e,t,n,r)})):ur(i,t,n,r)}function cr(t,e,n,r){var i,o={};try{i=r.splits.fetchMany(e)}catch(s){return e.forEach((function(t){o[t]=or})),Promise.resolve(o)}return a(i)?i.then((function(i){return lr(e,i,t,n,r)})):lr(e,i,t,n,r)}function ur(t,e,n,r){var i={treatment:L,label:"definition not found",config:null};if(t){var s=JSON.parse(t),c=ar.parse(s,r);if(i=c.getTreatment(e,n,sr),a(i))return i.then((function(t){return t.changeNumber=c.getChangeNumber(),t.config=Object(o.e)(s,"configurations.".concat(t.treatment),null),t}));i.changeNumber=c.getChangeNumber(),i.config=Object(o.e)(s,"configurations.".concat(i.treatment),null)}return i}function lr(t,e,n,r,i){var o={},s=[];return t.forEach((function(t){var c=ur(e[t],n,r,i);a(c)?s.push(c.then((function(e){o[t]=e}))):o[t]=c})),s.length>0?Promise.all(s).then((function(){return o})):o}var fr=function t(e,n,r,i){Object(Z.a)(this,t),this.list=i,this.value=e,n?(n.next=this,this.prev=n):this.prev=null,r?(r.prev=this,this.next=r):this.next=null},hr=function(){function t(){Object(Z.a)(this,t),this.tail=null,this.head=null,this.length=0}return Object(X.a)(t,[{key:"removeNode",value:function(t){if(t&&t instanceof fr){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e}}},{key:"unshiftNode",value:function(t){if(t&&t instanceof fr&&t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}}},{key:"unshift",value:function(){for(var t=0,e=arguments.length;t<e;t++)this.head=new fr(arguments[t],null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length}}]),t}(),pr="undefined"!==typeof Map?Map:function(){function t(){Object(Z.a)(this,t)}return Object(X.a)(t,[{key:"set",value:function(t,e){this[t]=e}},{key:"get",value:function(t){return this[t]}},{key:"delete",value:function(t){delete this[t]}},{key:"size",get:function(){return Object.keys(this).length}}]),t}(),gr=function(){function t(e){Object(Z.a)(this,t),this.maxLen=e||1,this.items=new pr,this.lru=new hr}return Object(X.a)(t,[{key:"get",value:function(t){var e=this.items.get(t);if(e&&e instanceof fr)return this.lru.unshiftNode(e),e.value.value}},{key:"set",value:function(t,e){var n=this.items.get(t);if(n){if(!(n instanceof fr))return!1;this.lru.unshiftNode(n),this.lru.head.value.value=e}else{if(this.lru.length===this.maxLen){var r=this.lru.tail;if(!r)return!1;this.items.delete(r.value.key),this.lru.removeNode(this.lru.tail)}this.lru.unshift({key:t,value:e}),this.items.set(t,this.lru.head)}return!0}}]),t}(),dr=function(){function t(e,n){Object(Z.a)(this,t),this.cache=new gr(e),this.hasher=n}return Object(X.a)(t,[{key:"testAndSet",value:function(t){if(!t)return null;var e=this.hasher(t),n=this.cache.get(e);return this.cache.set(e,t.time),n}}]),t}();function mr(t){return t||"UNKNOWN"}function vr(t){return t?Wn.hash(function(t){return"".concat(mr(t.keyName),"\n    :").concat(mr(t.feature),"\n    :").concat(mr(t.treatment),"\n    :").concat(mr(t.label),"\n    :").concat(t.changeNumber||0)}(t)).toString():null}var yr=function(){return new dr(500,vr)};function Sr(t){return t-t%36e5}var Tr=Object(s.b)("splitio-client:impressions-tracker");function br(t){return[j,D].indexOf(t.mode)>-1}var Er=function(t){var e=t.get(t.constants.STORAGE).impressions,n=t.get(t.constants.SETTINGS),r=n.impressionListener,o=t.get(t.constants.INTEGRATIONS_MANAGER,!0),s=n.runtime,c=s.ip,u=s.hostname,l=n.version,f=[],h=br(n),p=function(t){return!!br(t)&&t.sync.impressionsMode===U}(n),g=yr(),d=t.get(t.constants.IMPRESSIONS_COUNTER);return{queue:function(t,e){f.push({impression:t,attributes:e})},track:function(){var t=f.length,n=f.splice(0,t),s=[];n.forEach((function(t){var e=t.impression;h&&(e.pt=g.testAndSet(e));var n=Date.now();p&&d&&d.inc(e.feature,n,1),(!p||!e.pt||e.pt<Sr(n))&&s.push(e)}));var m=e.track(s);if(a(m)&&m.then((function(){Tr.debug("Successfully stored ".concat(t," impression").concat(1===t?"":"s","."))})).catch((function(e){Tr.error("Could not store impressions bulk with ".concat(t," impression").concat(1===t?"":"s",". Error: ").concat(e))})),r||o)for(var v=function(t){var e={impression:i()({},n[t].impression),attributes:n[t].attributes,ip:c,hostname:u,sdkLanguageVersion:l};setTimeout((function(){o&&o.handleImpression(e);try{r&&r.logImpression(e)}catch(t){Tr.error("Impression listener logImpression method threw: ".concat(t,"."))}}),0)},y=0;y<t;y++)v(y)}}},Or=Object(s.b)("splitio-client:event-tracker");var _r=function(t){var e=t.get(t.constants.STORAGE).events,n=t.get(t.constants.INTEGRATIONS_MANAGER,!0);function r(t,e){var r=t.eventTypeId,a=t.trafficTypeName,o=t.key,s=t.value,c=t.timestamp,u=t.properties,l='event of type "'.concat(r,'" for traffic type "').concat(a,'". Key: ').concat(o,". Value: ").concat(s,". Timestamp: ").concat(c,". ").concat(u?"With properties.":"With no properties.");return e?(Or.info("Successfully qeued ".concat(l)),n&&setTimeout((function(){var e=i()({},t);t.properties&&(e.properties=i()({},t.properties)),n.handleEvent(e)}),0)):Or.warn("Failed to queue ".concat(l)),e}return{track:function(t,n){var i=e.track(t,n);return a(i)?i.then(r.bind(null,t)):r(t,i)}}},Nr=Object(s.b)("splitio-client");var kr=function(t){var e=t.get(t.constants.STORAGE),n=t.get(t.constants.COLLECTORS),r=Er(t),i=_r(t);function o(t,i,o){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=_e.TaskNames[s?"SDK_GET_TREATMENT_WITH_CONFIG":"SDK_GET_TREATMENT"],l=_e.start(u,n),f=sr(t,i,o,e),h=function(e){var n=c(e,i,t,o,s,"getTreatment".concat(s?"withConfig":""));return r.track(),l(),n};return a(f)?f.then((function(t){return h(t)})):h(f)}function s(t,i,o){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=_e.TaskNames[s?"SDK_GET_TREATMENTS_WITH_CONFIG":"SDK_GET_TREATMENTS"],l=_e.start(u,n),f=function(e){var n={};return Object.keys(e).forEach((function(r){n[r]=c(e[r],r,t,o,s,"getTreatments".concat(s?"withConfig":""))})),r.track(),l(),n},h=cr(t,i,o,e);return a(h)?h.then((function(t){return f(t)})):f(h)}function c(e,n,i,a,o,s){var c=t.get(t.constants.READY,!0)||t.get(t.constants.READY_FROM_CACHE,!0),u=At(i),l=Rt(i);c||(e={treatment:L,label:"not ready"});var f=e,h=f.treatment,p=f.label,g=f.changeNumber,d=f.config,m=void 0===d?null:d;return Nr.info("Split: ".concat(n,". Key: ").concat(u,". Evaluation: ").concat(h,". Label: ").concat(p)),I(t,n,p,s)&&(Nr.info("Queueing corresponding impression."),r.queue({feature:n,keyName:u,treatment:h,time:Date.now(),bucketingKey:l,label:p,changeNumber:g},a)),o?{treatment:h,config:m}:h}return{getTreatment:o,getTreatmentWithConfig:function(t,e,n){return o(t,e,n,!0)},getTreatments:s,getTreatmentsWithConfig:function(t,e,n){return s(t,e,n,!0)},track:function(e,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1024,c=At(e),u=Date.now(),l={eventTypeId:r,trafficTypeName:n,value:a,timestamp:u,key:c,properties:o};return B(n,t,"track"),i.track(l,s)}}};var Ar=function(t,e,n){var r="REDIS"!==t.get(t.constants.SETTINGS).storage.type,a=kr(t),s=a.getTreatment,c=a.getTreatmentWithConfig,u=a.getTreatments,l=a.getTreatmentsWithConfig,h=a.track;function p(n,r,i,a){var s,c,u=Object(o.o)(a,"getTreatments"),l=e?n:N(n,a),h=u?w(r,a):R(r,a),p=(s=i,c=a,Object(o.i)(s)||void 0==s?s:(f.error("".concat(c,": attributes must be a plain object.")),!1)),g=q(t);return z(t,a),{valid:g&&l&&h&&!1!==p,key:l,splitOrSplits:h,attributes:p}}return a.getTreatment=function(t,e,n){var i=p(t,e,n,"getTreatment");return i.valid?s(i.key,i.splitOrSplits,i.attributes):r?L:Promise.resolve(L)},a.getTreatmentWithConfig=function(t,e,n){var a=p(t,e,n,"getTreatmentWithConfig");return a.valid?c(a.key,a.splitOrSplits,a.attributes):r?i()({},P):Promise.resolve(i()({},P))},a.getTreatments=function(t,e,n){var i=p(t,e,n,"getTreatments");if(i.valid)return u(i.key,i.splitOrSplits,i.attributes);var a={};return i.splitOrSplits&&i.splitOrSplits.forEach((function(t){return a[t]=L})),r?a:Promise.resolve(a)},a.getTreatmentsWithConfig=function(t,e,n){var a=p(t,e,n,"getTreatmentsWithConfig");if(a.valid)return l(a.key,a.splitOrSplits,a.attributes);var o={};return a.splitOrSplits&&a.splitOrSplits.forEach((function(t){return o[t]=i()({},P)})),r?o:Promise.resolve(o)},a.track=function(i,a,o,s,c){var u=e?i:N(i,"track"),l=n?a:H(a,"track"),f=g(o,"track"),p=m(s,"track"),d=E(c,"track"),v=d.properties,y=d.size;return q(t)&&u&&l&&f&&!1!==p&&!1!==v?h(u,l,f,p,v,y):!r&&Promise.resolve(!1)},a};var Rr=function(t){var e,n=t.get(t.constants.SETTINGS),r=Object(o.e)(n,"core.key",void 0),i=Object(o.e)(n,"core.trafficType",void 0);"localhost"===n.mode&&void 0===r?n.core.key="localhost_key":n.core.key=N(r,"Client instantiation");var a=[n.core.key];if(void 0!==i){var s=H(i,"Client instantiation");n.core.trafficType=s,a.push(s)}var c=Ar(t,!0,a.length>1);return c.isBrowserClient=!0,c.getTreatment=c.getTreatment.bind(c,n.core.key),c.getTreatmentWithConfig=c.getTreatmentWithConfig.bind(c,n.core.key),c.getTreatments=c.getTreatments.bind(c,n.core.key),c.getTreatmentsWithConfig=c.getTreatmentsWithConfig.bind(c,n.core.key),c.track=(e=c.track).bind.apply(e,[c].concat(a)),c};var Ir=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a,o=!1;function s(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,r=arguments.length,i=new Array(r>1?r-1:0),c=1;c<r;c++)i[c-1]=arguments[c];o||(a=setTimeout((function(){t.apply(void 0,i.concat([s]))}),n))}function c(){clearTimeout(a),a=void 0,o=!0}return c.reset=function(){clearTimeout(a),a=void 0,s.apply(void 0,[e].concat(r))},t.apply(void 0,r.concat([s])),c},Cr=function(t,e){return e=e||{},new Promise((function(n,r){var i=new XMLHttpRequest,a=[],o=[],s={};for(var c in i.open(e.method||"get",t,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,n){a.push(e=e.toLowerCase()),o.push([e,n]),s[e]=s[e]?s[e]+","+n:n})),n(function t(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:t,headers:{keys:function(){return a},entries:function(){return o},get:function(t){return s[t.toLowerCase()]},has:function(t){return t.toLowerCase()in s}}}}())},i.onerror=r,i.withCredentials="include"==e.credentials,e.headers)i.setRequestHeader(c,e.headers[c]);i.send(e.body||null)}))};function wr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Dr(t,e,n){return(Dr=wr()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&bt(i,n.prototype),i}).apply(null,arguments)}function jr(t){var e="function"===typeof Map?new Map:void 0;return(jr=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Dr(t,arguments,Nt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),bt(r,t)})(t)}function Mr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Nt(t);if(e){var i=Nt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _t(this,n)}}var Lr=function(t){Et(n,t);var e=Mr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Split Error";return Object(Z.a)(this,n),(t=e.call(this,r)).message=r,t}return n}(jr(Error)),Pr=function(t){Et(n,t);var e=Mr(n);function n(t){return Object(Z.a)(this,n),e.call(this,t||"Split Timeout Error")}return n}(Lr),Fr=function(t){Et(n,t);var e=Mr(n);function n(t,r){var i;return Object(Z.a)(this,n),(i=e.call(this,t||"Split Network Error")).statusCode=r,i}return n}(Lr),Kr=Object(s.b)("splitio-services:service");function Ur(t){var e=t.url;return("undefined"!==typeof window&&window.fetch||Cr)(e,t).then((function(t){if(!t.ok)throw{response:t};return t})).catch((function(n){var r=n.response,i="";if(r)switch(r.status){case 404:i="Invalid API key or resource not found.";break;default:i=r.statusText}else i=n.message;throw r&&403===r.status||Kr[t.logErrorsAsInfo?"info":"error"]("Response status is not OK. Status: ".concat(r?r.status:"NO_STATUS",". URL: ").concat(e,". Message: ").concat(i)),new Fr(i,r&&r.status)}))}var Gr=Ur;var xr=function(t,e,n,r){var a=t.core.authorizationKey,o=t.version,s=t.runtime,c=s.ip,u=s.hostname,l={},f={};return l.Accept="application/json",l["Content-Type"]="application/json",l.Authorization="Bearer ".concat(a),l.SplitSDKVersion=o,c&&(l.SplitSDKMachineIP=c),u&&(l.SplitSDKMachineName=u),r&&i()(l,r),i()({headers:l,url:t.url(e)},f,n)};function Hr(t){var e=[],n=t.toJSON();return Object(o.d)(n,(function(t,n){e.push({name:n,latencies:t})})),e}function Wr(t){var e=[],n=t.toJSON();return Object(o.d)(n,(function(t,n){e.push({name:n,delta:t})})),e}var Br=Ur;function Yr(t,e){return xr(t,"/testImpressions/bulk",i()({method:"POST"},e),{SplitSDKImpressionsMode:t.sync.impressionsMode===U?U:K})}function qr(t,e){return xr(t,"/testImpressions/count",i()({method:"POST"},e))}function zr(t,e){var n=e.core.labelsEnabled,r=Object(o.g)(t.state(),"feature"),i=[];return Object(o.d)(r,(function(t,e){i.push({f:e,i:t.map((function(t){var e={k:t.keyName,t:t.treatment,m:t.time,c:t.changeNumber};return n&&(e.r=t.label),t.bucketingKey&&(e.b=t.bucketingKey),t.pt&&(e.pt=t.pt),e}))})})),i}function Vr(t){var e=[];if(0===(t?t.size():0))return e;for(var n=t.popAll(),r=Object.keys(n),i=0;i<r.length;i++){var a=r[i].split("::");if(2===a.length){var o=a[0],s=a[1],c={f:o,m:Number(s),rc:n[r[i]]};e.push(c)}}return e}function Qr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Nt(t);if(e){var i=Nt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _t(this,n)}}var Jr=function(){function t(e){Object(Z.a)(this,t),this.storage=e,this.latency=this.latency.bind(this),this.count=this.count.bind(this),this.countException=this.countException.bind(this)}return Object(X.a)(t,[{key:"latency",value:function(t){this.storage.metrics.track("".concat(this.metricType,".time"),t)}},{key:"count",value:function(t){this.storage.count.track("".concat(this.metricType,".status.").concat(t))}},{key:"countException",value:function(){this.storage.count.track("".concat(this.metricType,".exception"))}}]),t}(),$r=function(t){Et(n,t);var e=Qr(n);function n(t){var r;return Object(Z.a)(this,n),(r=e.call(this,t)).metricType="segmentChangeFetcher",r}return n}(Jr),Zr=function(t){Et(n,t);var e=Qr(n);function n(t){var r;return Object(Z.a)(this,n),(r=e.call(this,t)).metricType="splitChangeFetcher",r}return n}(Jr),Xr=function(t){Et(n,t);var e=Qr(n);function n(t){var r;return Object(Z.a)(this,n),(r=e.call(this,t)).metricType="mySegmentsFetcher",r}return n}(Jr),ti=function(){function t(e){Object(Z.a)(this,t),this.storage=e,this.ready=this.ready.bind(this),this.getTreatment=this.getTreatment.bind(this),this.getTreatments=this.getTreatments.bind(this),this.getTreatmentWithConfig=this.getTreatmentWithConfig.bind(this),this.getTreatmentsWithConfig=this.getTreatmentsWithConfig.bind(this)}return Object(X.a)(t,[{key:"ready",value:function(t){this.storage.metrics.track("sdk.ready",t)}},{key:"getTreatment",value:function(t){this.storage.metrics.track("sdk.getTreatment",t)}},{key:"getTreatments",value:function(t){this.storage.metrics.track("sdk.getTreatments",t)}},{key:"getTreatmentWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentWithConfig",t)}},{key:"getTreatmentsWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentsWithConfig",t)}}]),t}(),ei=Object(s.b)("splitio-metrics"),ni=function(t){var e=0,n=t.get(t.constants.SETTINGS),r=t.get(t.constants.STORAGE),a=t.get(t.constants.IMPRESSIONS_COUNTER),o=n.sync.impressionsMode===U,s=function(){if(r.metrics.isEmpty()&&r.count.isEmpty())return Promise.resolve();ei.info("Pushing metrics");var t=_e.start(_e.TaskNames.METRICS_PUSH),e=r.metrics.isEmpty()?null:Gr(function(t,e){return xr(t,"/metrics/times",i()({method:"POST"},e,{logErrorsAsInfo:!0}))}(n,{body:JSON.stringify(Hr(r.metrics))})).then((function(){return r.metrics.clear()})).catch((function(){return r.metrics.clear()})),a=r.count.isEmpty()?null:Gr(function(t,e){return xr(t,"/metrics/counters",i()({method:"POST"},e,{logErrorsAsInfo:!0}))}(n,{body:JSON.stringify(Wr(r.count))})).then((function(){return r.count.clear()})).catch((function(){return r.count.clear()}));return Promise.all([e,a]).then((function(e){return t(),e}))},c=function(){if(r.impressions.isEmpty())return Promise.resolve();var t=r.impressions.queue.length;ei.info("Pushing ".concat(t," impressions"));var i=_e.start(_e.TaskNames.IMPRESSIONS_PUSH);return Br(Yr(n,{body:JSON.stringify(zr(r.impressions,n))})).then((function(){e=0,r.impressions.clear()})).catch((function(n){e?(ei.warn("Droping ".concat(t," impressions after retry. Reason ").concat(n,".")),e=0,r.impressions.clear()):(e++,ei.warn("Failed to push ".concat(t," impressions, keeping data to retry on next iteration. Reason ").concat(n,".")))})).then((function(){return i()}))},u=function(){var t=Vr(a),r=t.length;return 0===r?Promise.resolve():(ei.info("Pushing count of impressions for ".concat(r," features")),Br(qr(n,{body:JSON.stringify({pf:t})})).then((function(){e=0})).catch((function(t){e?(ei.warn("Droping count of impressions for ".concat(r," features after retry. Reason ").concat(t,".")),e=0):(e++,ei.warn("Failed to push impressions count for ".concat(r," features, keeping data to retry on next iteration. Reason ").concat(t,".")))})))},l=!1,f=!1,h=!1;return{start:function(){l=Ir((function(t){return c().then((function(){return t()}))}),n.scheduler.impressionsRefreshRate),f=Ir((function(t){return s().then((function(){return t()}))}),n.scheduler.metricsRefreshRate),o&&(h=Ir((function(t){return u().then((function(){return t()}))}),18e5))},flush:function(){return o&&u(),c()},stop:function(){l&&l(),f&&f(),h&&h()},collectors:{segmentChanges:new $r(r),splitChanges:new Zr(r),mySegments:new Xr(r),client:new ti(r)}}},ri=Ur;function ii(t,e){return xr(t,"/events/bulk",i()({method:"POST"},e))}var ai=Object(s.b)("splitio-events"),oi=function(t){var e=t.get(t.constants.SETTINGS),n=t.get(t.constants.STORAGE),r=function(){if(n.events.isEmpty())return Promise.resolve();ai.info("Pushing ".concat(n.events.state().length," queued events."));var t=_e.start(_e.TaskNames.EVENTS_PUSH),r=JSON.stringify(n.events.toJSON()),i=function(){return t()};return n.events.clear(),ri(ii(e,{body:r})).then(i).catch(i)},i=!1,a=!1,o=function(){return a=Ir((function(t){return r().then((function(){return t()}))}),e.scheduler.eventsPushRate)};return{start:function(){e.startup.eventsFirstPushWindow>0?i=setTimeout(o,e.startup.eventsFirstPushWindow):o()},flush:function(){return r()},stop:function(){i&&clearTimeout(i),a&&a()},flushAndResetTimer:function(){return ai.info("Flushing events and reseting timer."),a&&a.reset(),r()}}},si=Ur;function ci(t){return"users="+encodeURIComponent(t)}function ui(t){var e,n=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent((e=n,atob(e)).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(r)}function li(t,e){return si(function(t,e){var n="/auth";if(e){var r=e.map(ci).join("&");r&&(n+="?"+r)}return xr(t,n)}(t,e)).then((function(t){return t.json()})).then((function(t){if(t.token){var e=ui(t.token);if("number"!==typeof e.iat||"number"!==typeof e.exp)throw'token properties "issuedAt" (iat) or "expiration" (exp) are missing or invalid';var n=JSON.parse(e["x-ably-capability"]);return i()({decodedToken:e,channels:n},t)}return t}))}function fi(){return"undefined"!==typeof window&&"function"===typeof window.EventSource?window.EventSource:void 0}var hi=function(){function t(e,n,r){Object(Z.a)(this,t),this.baseMillis=n||t.DEFAULT_BASE_MILLIS,this.maxMillis=r||t.DEFAULT_MAX_MILLIS,this.attempts=0,this.cb=e}return Object(X.a)(t,[{key:"scheduleCall",value:function(){var t=this,e=Math.min(this.baseMillis*Math.pow(2,this.attempts),this.maxMillis);return this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout((function(){t.cb()}),e),this.attempts++,e}},{key:"reset",value:function(){this.attempts=0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=0)}}]),t}();hi.DEFAULT_BASE_MILLIS=1e3,hi.DEFAULT_MAX_MILLIS=18e5;var pi=hi,gi=function(){function t(e,n){Object(Z.a)(this,t),this.mySegmentsStorage=e,this.mySegmentsProducer=n,this.maxChangeNumber=0,this.segmentList=void 0,this.currentChangeNumber=-1,this.put=this.put.bind(this),this.__handleMySegmentUpdateCall=this.__handleMySegmentUpdateCall.bind(this),this.backoff=new pi(this.__handleMySegmentUpdateCall)}return Object(X.a)(t,[{key:"__handleMySegmentUpdateCall",value:function(){var t=this;if(this.maxChangeNumber>this.currentChangeNumber){this.handleNewEvent=!1;var e=this.maxChangeNumber;this.mySegmentsProducer.synchronizeMySegments(this.segmentList).then((function(n){!1!==n&&(t.currentChangeNumber=Math.max(t.currentChangeNumber,e)),t.handleNewEvent?t.__handleMySegmentUpdateCall():t.backoff.scheduleCall()}))}}},{key:"put",value:function(t,e){t<=this.currentChangeNumber||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.segmentList=e,this.mySegmentsProducer.isSynchronizingMySegments()||this.__handleMySegmentUpdateCall())}}]),t}(),di=function(){function t(e,n,r){Object(Z.a)(this,t),this.splitStorage=e,this.splitProducer=n,this.maxChangeNumber=0,this.splitsEventEmitter=r,this.put=this.put.bind(this),this.killSplit=this.killSplit.bind(this),this.__handleSplitUpdateCall=this.__handleSplitUpdateCall.bind(this),this.backoff=new pi(this.__handleSplitUpdateCall)}return Object(X.a)(t,[{key:"__handleSplitUpdateCall",value:function(){var t=this;this.maxChangeNumber>this.splitStorage.getChangeNumber()&&(this.handleNewEvent=!1,this.splitProducer.synchronizeSplits().then((function(){t.handleNewEvent?t.__handleSplitUpdateCall():t.backoff.scheduleCall()})))}},{key:"put",value:function(t){t<=this.splitStorage.getChangeNumber()||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.splitProducer.isSynchronizingSplits()||this.__handleSplitUpdateCall())}},{key:"killSplit",value:function(t,e,n){var r=this;this.splitStorage.killLocally(e,n,t).then((function(e){e&&r.splitsEventEmitter.emit(r.splitsEventEmitter.SDK_SPLITS_ARRIVED,!0),r.put(t)}))}}]),t}(),mi=/^control_/,vi=function(){function t(e,n){Object(Z.a)(this,t),this.EventSource=e,this.streamingUrl=n.url("/sse"),this.reopen=this.reopen.bind(this)}return Object(X.a)(t,null,[{key:"getInstance",value:function(e){var n=fi();if(n)return new t(n,e)}}]),Object(X.a)(t,[{key:"setEventHandler",value:function(t){this.handler=t}},{key:"open",value:function(t){this.close(),this.authToken=t;var e=Object.keys(t.channels).map((function(t){var e=mi.test(t)?"[?occupancy=metrics.publishers]":"";return encodeURIComponent(e+t)})).join(","),n="".concat(this.streamingUrl,"?channels=").concat(e,"&accessToken=").concat(t.token,"&v=").concat("1.1","&heartbeats=true");this.connection=new this.EventSource(n),this.handler&&(this.connection.onopen=this.handler.handleOpen,this.connection.onmessage=this.handler.handleMessage,this.connection.onerror=this.handler.handleError)}},{key:"close",value:function(){this.connection&&this.connection.close()}},{key:"reopen",value:function(){this.open(this.authToken)}}]),t}(),yi="STREAMING_DISABLED",Si="STREAMING_PAUSED",Ti="STREAMING_RESUMED";var bi=/control_pri$/;var Ei=Object(s.b)("splitio-sync:sse-handler");function Oi(t){var e=function(t){var e=-1,n=!0,r=-1,i=!0;return{handleOpen:function(){t.emit("PUSH_CONNECT")},isStreamingUp:function(){return i&&n},handleOccupancyEvent:function(r,a,o){bi.test(a)&&o>e&&(e=o,i&&(0===r&&n?t.emit("PUSH_DISCONNECT"):0===r||n||t.emit("PUSH_CONNECT")),n=0!==r)},handleControlEvent:function(e,a,o){bi.test(a)&&o>r&&(r=o,e===yi?t.emit("PUSH_DISABLED"):n&&(e===Si&&i?t.emit("PUSH_DISCONNECT"):e!==Ti||i||t.emit("PUSH_CONNECT")),i=e===Ti)}}}(t);return{handleOpen:function(){e.handleOpen()},handleError:function(e){var n=e;try{n=function(t){return Object(o.j)(t.data)&&(t.parsedData=JSON.parse(t.data)),t}(e)}catch(r){Ei.warn("Error parsing SSE error notification: ".concat(r))}t.emit("SSE_ERROR",n)},handleMessage:function(n){var r;try{r=function(t){var e=JSON.parse(t.data);return e.parsedData=JSON.parse(e.data),e.name&&"[meta]occupancy"===e.name&&(e.parsedData.type="OCCUPANCY"),e}(n)}catch(u){return void Ei.warn("Error parsing new SSE message notification: ".concat(u))}var i=r,a=i.parsedData,o=i.data,s=i.channel,c=i.timestamp;if(Ei.debug("New SSE message received, with data: ".concat(o,".")),e.isStreamingUp()||"OCCUPANCY"===a.type||"CONTROL"===a.type)switch(a.type){case"SPLIT_UPDATE":t.emit("SPLIT_UPDATE",a.changeNumber);break;case"SEGMENT_UPDATE":t.emit("SEGMENT_UPDATE",a.changeNumber,a.segmentName);break;case"MY_SEGMENTS_UPDATE":t.emit("MY_SEGMENTS_UPDATE",a,s);break;case"SPLIT_KILL":t.emit("SPLIT_KILL",a.changeNumber,a.splitName,a.defaultTreatment);break;case"OCCUPANCY":e.handleOccupancyEvent(a.metrics.publishers,s,c);break;case"CONTROL":e.handleControlEvent(a.controlType,s,c)}}}}function _i(t){return e=Wn.hash(t,0).toString(),btoa(e);var e}var Ni=Object(s.b)("splitio-sync:push-manager");function ki(t,e){if(n=Ni,fi()?"function"===typeof atob&&"function"===typeof btoa||(n.warn('"atob" and "btoa" functions for Base64 encoding are not available. Falling back to polling mode.'),0):(n.warn("EventSource API is not available. Falling back to polling mode."),0)){var n,r=new jt.a,a=t.get(t.constants.READINESS).splits,o=t.get(t.constants.SETTINGS),s=t.get(t.constants.STORAGE),c=vi.getInstance(o),u=Oi(r);c.setEventHandler(u);var l,f={},h=[],p=!1,g=new pi(T,o.scheduler.authRetryBackoffBase),d=new pi(c.reopen,o.scheduler.streamingReconnectBackoffBase),m=0;r.on("PUSH_DISCONNECT",E),r.on("PUSH_DISABLED",(function(){b(),r.emit("PUSH_DISCONNECT")})),r.on("SSE_ERROR",(function(t){var e;c.close(),e=!t.parsedData||400!==t.parsedData.statusCode&&401!==t.parsedData.statusCode?d.scheduleCall():g.scheduleCall();var n=t.parsedData&&t.parsedData.message;Ni.error("Fail to connect to streaming".concat(n?', with error message: "'.concat(n,'"'):"",". Attempting to reconnect in ").concat(e/1e3," seconds.")),r.emit("PUSH_DISCONNECT")}));var v=t.get(t.constants.PRODUCER),y=new di(s.splits,v,a);if(h.push(y),r.on("SPLIT_KILL",y.killSplit),r.on("SPLIT_UPDATE",y.put),e)r.on("MY_SEGMENTS_UPDATE",(function(n,r){var i=r.split("_")[2],a=f[i];if(a&&e[a]){var o=e[a].get(t.constants.MY_SEGMENTS_CHANGE_WORKER,!0);o&&o.put(n.changeNumber,n.includesPayload?n.segmentList?n.segmentList:[]:void 0)}}));else{var S=new gi(s.segments,v);h.push(S),r.on("SEGMENT_UPDATE",S.put)}return i()(Object.create(r),{stop:function(){b(),E()},start:T,startNewClient:function(t,e){var n=_i(t),r=e.get(e.constants.STORAGE),i=e.get(e.constants.PRODUCER);f[n]||(f[n]=t,p=!0);var a=new gi(r.segments,i);h.push(a),e.put(e.constants.MY_SEGMENTS_CHANGE_WORKER,a),setTimeout((function(){p&&(p=!1,T())}),0)},removeClient:function(t){var e=_i(t);delete f[e]}})}function T(){l=!1,Ni.info("Connecting to push streaming.");var t=e?Object.keys(e):void 0;li(o,t).then((function(n){if(!l){if(g.reset(),d.reset(),!n.pushEnabled)return Ni.info("Streaming is not available. Switching to polling mode."),void r.emit("PUSH_DISCONNECT");if(!(t&&t.length<Object.keys(e).length)){var i=n.decodedToken;c.open(n),function(t,e){m&&clearTimeout(m);var n=e-t-600;Ni.info("Refreshing streaming token in ".concat(n," seconds.")),m=setTimeout(T,1e3*n)}(i.iat,i.exp)}}})).catch((function(t){if(!l){c.close(),r.emit("PUSH_DISCONNECT");var e='Failed to authenticate for streaming. Error: "'.concat(t.message,'".');if(t.statusCode>=400&&t.statusCode<500)Ni.error(e);else{var n=g.scheduleCall();Ni.error("".concat(e,". Attempting to reauthenticate in ").concat(n/1e3," seconds."))}}}))}function b(){l=!0,Ni.info("Disconnecting from push streaming."),c.close(),m&&clearTimeout(m),g.reset(),d.reset()}function E(){h.forEach((function(t){return t.backoff.reset()}))}}var Ai=Object(s.b)("splitio-producer:task"),Ri=function(t,e){var n=Object(o.f)(t),r=!1;return{start:function(){r||(Ai.debug("Starting ".concat(n," refreshing each ").concat(e)),r=Ir((function(e){Ai.debug("Running ".concat(n)),t().then((function(){return e()}))}),e))},stop:function(){Ai.debug("Stopping ".concat(n)),r&&r(),r=!1},isRunning:function(){return!!r}}};var Ii=function(t,e){return t<1?e:new Promise((function(n,r){var i=setTimeout((function(){r(new Pr("Operation timed out because it exceeded the configured time limit of ".concat(t,"ms.")))}),t);e.then((function(t){clearTimeout(i),n(t)}),(function(t){clearTimeout(i),r(t)}))}))},Ci=Ur;function wi(t,e,n){return xr(t,"/splitChanges?since=".concat(e).concat(n||""))}var Di=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=t.sync.__splitFiltersValidation.queryString,o=Ci(wi(t,e,a)),s=n||i;return o=_e.start(_e.TaskNames.SPLITS_FETCH,!!s&&r,o),n&&(o=Ii(t.startup.requestTimeoutBeforeReady,o)),o.then((function(t){return t.json().catch((function(t){throw new Lr(t.message)}))}))},ji=function(t){var e=new Ce;return t.forEach((function(t){t.matcherGroup.matchers.forEach((function(t){var n=t.matcherType,r=t.userDefinedSegmentMatcherData;"IN_SEGMENT"===n&&e.add(r.segmentName)}))})),e},Mi=Object(s.b)("splitio-producer:split-changes");function Li(t){var e=t.reduce((function(t,e){return"ACTIVE"===e.status?(t.added.push([e.name,JSON.stringify(e)]),ji(e.conditions).forEach((function(e){t.segments.add(e)}))):t.removed.push(e.name),t}),{added:[],removed:[],segments:new Ce});return e.segments=Ie(e.segments),e}var Pi=Ur;function Fi(t){return xr(t,"/mySegments/".concat(encodeURIComponent(At(t.core.key))))}var Ki=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=Pi(Fi(t));return r=_e.start(_e.TaskNames.MY_SEGMENTS_FETCH,!!e&&n,r),e&&(r=Ii(t.startup.requestTimeoutBeforeReady,r)),r.then((function(t){return t.json().catch((function(t){throw new Lr(t.message)}))})).then((function(t){return t.mySegments.map((function(t){return t.name}))}))},Ui=Object(s.b)("splitio-producer:my-segments");var Gi=Object(s.b)("splitio-producer:mySegmentsHandler"),xi=function(t){var e=t.get(t.constants.SETTINGS),n=t.get(t.constants.STORAGE).splits,r=t.get(t.constants.READINESS),i=r.splits,a=r.segments,o=function(t){var e=t.getAll(),n=e[t.constants.SETTINGS],r=e[t.constants.READINESS],i=e[t.constants.STORAGE],a=e[t.constants.COLLECTORS],o=r.segments,s=!0,c=!0;function u(t){var e=i.segments.resetSegments(t);i.splits.usesSegments()&&(e||s)&&(s=!1,o.emit(o.SDK_SEGMENTS_ARRIVED))}return function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1?arguments[1]:void 0;return(r?new Promise((function(t){u(r),t()})):Ki(n,c,a).then((function(t){c=!1,u(t)}))).catch((function(r){return r instanceof Lr||setTimeout((function(){throw r}),0),c&&n.startup.retriesOnFailureBeforeReady>e?(e+=1,Ui.warn("Retrying download of segments #".concat(e,". Reason: ").concat(r)),t(e)):(c=!1,!1)}))}}(t),s=Ri(u,e.scheduler.segmentsRefreshRate);i.on(i.SDK_SPLITS_ARRIVED,(function(){if(!l)return;var t=n.usesSegments();t!==s.isRunning()&&(Gi.info("Turning segments data polling ".concat(t?"ON":"OFF",".")),t?s.start():s.stop())})),n.usesSegments()?i.once(i.SDK_SPLITS_ARRIVED,f):setTimeout(f,0);var c=!1;function u(t){return c=!0,o(0,t).then((function(t){return c=!1,t}))}var l=!1;function f(){t.get(t.constants.READY,!0)||n.usesSegments()||a.emit(a.SDK_SEGMENTS_ARRIVED)}return{start:function(){l=!0,n.usesSegments()&&s.start()},stop:function(){l=!1,s.stop()},isRunning:function(){return l},isSynchronizingMySegments:function(){return c},synchronizeMySegments:u}},Hi=Object(s.b)("splitio-producer:updater"),Wi=function(t){var e=t.get(t.constants.SETTINGS),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.getAll(),r=n[t.constants.SETTINGS],i=n[t.constants.READINESS],o=n[t.constants.STORAGE],s=n[t.constants.COLLECTORS],c=i.splits,u=!0,l=!0;return function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;function i(i){Mi.debug("Spin up split update using since = ".concat(i));var a=Di(r,i,u,s,e).then((function(t){u=!1;var e=Li(t.splits);return Mi.debug("New splits ".concat(e.added.length)),Mi.debug("Removed splits ".concat(e.removed.length)),Mi.debug("Segment names collected ".concat(e.segments)),Promise.all([o.splits.setChangeNumber(t.till),o.splits.addSplits(e.added),o.splits.removeSplits(e.removed),o.segments.registerSegments(e.segments)]).then((function(){(i!==t.till||l)&&(l=!1,c.emit(c.SDK_SPLITS_ARRIVED))}))})).catch((function(e){return e instanceof Lr||(setTimeout((function(){throw e}),0),u=!1),Mi.warn("Error while doing fetch of Splits. ".concat(e)),u&&r.startup.retriesOnFailureBeforeReady>n?(n+=1,Mi.info("Retrying download of splits #".concat(n,". Reason: ").concat(e)),t(n)):(u=!1,!1)}));return u&&o.splits.checkCache()&&c.emit(c.SDK_SPLITS_CACHE_LOADED),a}var f=o.splits.getChangeNumber(),h=a(f)?f:Promise.resolve(f);return h.then(i)}}(t),r=Ri(s,e.scheduler.featuresRefreshRate),i=xi(t),o=!1;function s(){return o=!0,n().then((function(t){return o=!1,t}))}return{start:function(){Hi.info("Starting BROWSER producer"),r.start(),i.start()},stop:function(){Hi.info("Stopping BROWSER producer"),r.stop(),i.stop()},isRunning:r.isRunning,isSynchronizingSplits:function(){return o},synchronizeSplits:s,isSynchronizingMySegments:i.isSynchronizingMySegments,synchronizeMySegments:i.synchronizeMySegments}},Bi=Object(s.b)("splitio-sync:sync-manager");var Yi=Object(s.b)("splitio-client:cleanup"),qi=function(){function t(e){Object(Z.a)(this,t),this.storage=e.get(e.constants.STORAGE),this.settings=e.get(e.constants.SETTINGS),this.flushData=this.flushData.bind(this),this.settings.sync.impressionsMode===U&&(this.impressionsCounter=e.get(e.constants.IMPRESSIONS_COUNTER))}return Object(X.a)(t,[{key:"start",value:function(){"undefined"!==typeof window&&window.addEventListener&&(Yi.debug("Registering flush handler when unload page event is triggered."),window.addEventListener("unload",this.flushData))}},{key:"stop",value:function(){"undefined"!==typeof window&&window.removeEventListener&&(Yi.debug("Deregistering flush handler when unload page event is triggered."),window.removeEventListener("unload",this.flushData))}},{key:"flushData",value:function(){this._flushImpressions(),this._flushEvents(),this.impressionsCounter&&this._flushImpressionsCount()}},{key:"_flushImpressions",value:function(){var t=this.storage.impressions;if(!t.isEmpty()){var e=this.settings.url("/testImpressions/beacon"),n=zr(t,this.settings),r={sim:this.settings.sync.impressionsMode===U?U:K};this._sendBeacon(e,n,r)||Br(Yr(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_flushImpressionsCount",value:function(){var t={pf:Vr(this.impressionsCounter)};if(0!==t.pf.length){var e=this.settings.url("/testImpressions/count/beacon");this._sendBeacon(e,t)||Br(qr(this.settings,{body:JSON.stringify(t)}))}}},{key:"_flushEvents",value:function(){var t=this.storage.events;if(!t.isEmpty()){var e=this.settings.url("/events/beacon"),n=t.toJSON();this._sendBeacon(e,n)||ri(ii(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_sendBeacon",value:function(t,e,n){if("undefined"!==typeof navigator&&navigator.sendBeacon){var r={entries:e,token:this.settings.core.authorizationKey,sdk:this.settings.version};n&&i()(r,n);var a=JSON.stringify(r);return navigator.sendBeacon(t,a)}return!1}}]),t}(),zi={};var Vi=function(t,e,n){var r,a=!!n,s=t.get(t.constants.SETTINGS),c=t.get(t.constants.READINESS),u=t.get(t.constants.STORAGE),f=t.get(t.constants.STATUS_MANAGER),h=c.gate,p=c.splits,g=c.segments,d=h.SDK_READY,m=a?void 0:ni(t),v=a?void 0:oi(t),y=a?void 0:new qi(t);switch(s.mode){case j:case D:t.put(t.constants.COLLECTORS,m&&m.collectors),a?r=zi[s.core.authorizationKey].shared(t):(r=function(t){var e={},n=t.get(t.constants.SETTINGS),r=l(!1,t),i=n.streamingEnabled?ki(t,e):void 0,a=t.get(t.constants.PRODUCER);function s(){a.isRunning()?Bi.info("Streaming couldn't connect. Continue periodic fetch of data."):(Bi.info("Streaming not available. Starting periodic fetch of data."),Object(o.d)(e,(function(t){t.get(t.constants.PRODUCER).start()})))}function c(){a.isRunning()&&(Bi.info("PUSH (re)connected. Syncing and stopping periodic fetch of data."),Object(o.d)(e,(function(t){t.get(t.constants.PRODUCER).stop()}))),u()}function u(){t.get(t.constants.PRODUCER).synchronizeSplits(),Object(o.d)(e,(function(t){t.get(t.constants.PRODUCER).synchronizeMySegments()}))}function l(t,n){var r=t?xi(n):Wi(n),l=n.get(n.constants.SETTINGS),f=Object(o.q)(At(l.core.key));return n.put(n.constants.PRODUCER,r),e[f]&&Bi.warn("A client with the same user key has already been created. Only the new instance will be properly synchronized."),e[f]=n,{start:function(){i?(t?a.isRunning()?r.start():r.synchronizeMySegments():(u(),i.on("PUSH_CONNECT",c),i.on("PUSH_DISCONNECT",s)),i.startNewClient(f,n)):r.start()},stop:function(){e[f]&&(delete e[f],i&&(i.removeClient(f),t||i.stop()),r.isRunning()&&r.stop())}}}return r.shared=l.bind(null,!0),r}(t),zi[s.core.authorizationKey]=r);break;case M:t.put(t.constants.READY_FROM_CACHE,!0)}if(e&&r&&!a){var S=e.sdkReadyTracker,T=e.splitsReadyTracker,b=e.segmentsReadyTracker;S.setCollectorForTask(m.collectors),h.once(d,S),p.once(p.SDK_SPLITS_ARRIVED,T),g.once(g.SDK_SEGMENTS_ARRIVED,b)}r&&r.start(),m&&m.start(),v&&t.put(t.constants.EVENTS,v)&&v.start(),t.put(t.constants.COLLECTORS,n);var E=i()(Object.create(f),Rr(t),{destroy:function(){return r&&r.stop(),m&&m.stop(),v&&v.stop(),Promise.all([m&&m.flush(),v&&v.flush()]).then((function(){c.destroy(),y&&y.stop(),u.destroy&&u.destroy(),t.put(t.constants.DESTROYED,!0),a||(l(s.core.authorizationKey),delete zi[s.core.authorizationKey])}))}});return!a&&y.start(E.destroy),{api:E,metricCollectors:m&&m.collectors}};function Qi(t){var e=t.treatment;return t.keys?{conditionType:"WHITELIST",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"WHITELIST",negate:!1,whitelistMatcherData:{whitelist:Object(o.j)(t.keys)?[t.keys]:t.keys}}]},partitions:[{treatment:e,size:100}],label:"whitelisted ".concat(e)}:{conditionType:"ROLLOUT",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"ALL_KEYS",negate:!1}]},partitions:[{treatment:e,size:100}],label:"default rule"}}var Ji={emptyMock:1};function $i(t){var e=Object.keys(t);return e.length!==Object.keys(Ji).length?(Ji=t,!0):e.some((function(e){var n,r,i=!Ji[e],a=(n=Ji[e],r=t[e],Object(Ot.a)(n)!==Object(Ot.a)(r)||("string"===typeof n?n!==r:n.treatment!==r.treatment||n.config!==r.config)),o=i||a;return o&&(Ji=t),o}))}var Zi=function(t){var e=t.features||{};if(!$i(e))return!1;var n={};return Object(o.d)(e,(function(t,e){var r=t,i=null;Object(o.i)(t)&&(r=t.treatment,i=t.config||i);var a={};null!==i&&(a[r]=i),n[e]={conditions:[Qi({treatment:r})],configurations:a}})),n},Xi=Object(s.b)("splitio-producer:offline");var ta=function(t,e){var n=e.getAll(),r=n[e.constants.SETTINGS],i=n[e.constants.READINESS],a=n[e.constants.STORAGE];return function(){var e=[],n=null,s={};try{s=t(r)}catch(c){n=c,Xi.error("There was an issue loading the mock Splits data, no changes will be applied to the current cache. ".concat(c))}return!n&&s?(Xi.debug("Splits data: "),Xi.debug(JSON.stringify(s)),Object(o.d)(s,(function(t,n){e.push([n,JSON.stringify({name:n,status:"ACTIVE",killed:!1,trafficAllocation:100,defaultTreatment:"control",conditions:t.conditions||[],configurations:t.configurations,trafficTypeName:t.trafficTypeName})])})),Promise.all([a.splits.flush(),a.splits.addSplits(e)]).then((function(){i.splits.emit(i.splits.SDK_SPLITS_ARRIVED),i.segments.emit(i.segments.SDK_SEGMENTS_ARRIVED)}))):Promise.resolve()}}.bind(null,Zi),ea=function(t){var e=t.get(t.constants.SETTINGS),n=ta(t);return Ri(n,e.scheduler.offlineRefreshRate)};var na=function(t,e){var n=!e,r=t.get(t.constants.READINESS),a=t.get(t.constants.STORAGE),o=t.get(t.constants.STATUS_MANAGER);n&&setTimeout((function(){r.gate.emit(r.gate.SDK_READY)}),0);var s=n?void 0:ea(t);return s&&s.start(),{api:i()(Object.create(o),Rr(t),{destroy:function(){return s&&s.stop(),r.destroy(),a.destroy&&a.destroy(),t.put(t.constants.DESTROYED,!0),!n&&l(),Promise.resolve()}}),metricCollectors:!1}};function ra(t,e){var n=!1,r=!1;var i=function t(i){var a=new Promise((function(t,n){return i.then(t,(function(t){r?n(t):e(t)}))})),o=a.then;return a.then=function(e,i){var s=o.call(a,e,i);return"function"===typeof e&&(n=!0),"function"===typeof i?(r=!0,s):t(s)},a}(t);return i.hasOnFulfilled=function(){return n},i}var ia=Object(s.b)("");function aa(t){ia.error(t)}function oa(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.get(t.constants.READINESS).gate,r=0,a=!1,o=!1,s=n.SDK_READY,c=n.SDK_READY_FROM_CACHE,u=n.SDK_UPDATE,l=n.SDK_READY_TIMED_OUT;n.on("removeListener",(function(t){t===s&&r--})),n.on("newListener",(function(t){t!==s&&t!==l||(a?ia.error("A listener was added for ".concat(t===s?"SDK_READY":"SDK_READY_TIMED_OUT"," on the SDK, which has already fired and won't be emitted again. The callback won't be executed.")):t===s&&r++)}));var f=h();function h(){var i=ra(new Promise((function(c,u){n.once(s,(function(){r!==e||i.hasOnFulfilled()||ia.warn("No listeners for SDK Readiness detected. Incorrect control treatments could have been logged if you called getTreatment/s while the SDK was not yet ready."),t.put(t.constants.READY,!0),a=!0,c()})),n.once(l,(function(e){t.put(t.constants.HAS_TIMEDOUT,!0),o=!0,u(e)}))})),aa);return i}return n.once(c,(function(){ia.info("Split SDK is ready from cache."),t.put(t.constants.READY_FROM_CACHE,!0)})),i()(Object.create(n),{Event:{SDK_READY:s,SDK_READY_FROM_CACHE:c,SDK_UPDATE:u,SDK_READY_TIMED_OUT:l},ready:function(){return o?a?Promise.resolve():ra(Promise.reject("Split SDK has emitted SDK_READY_TIMED_OUT event."),aa):f},__context:t})}var sa="splitio-ga-to-split:mapper",ca=Object(s.b)("splitio-ga-to-split");var ua,la=(ua={eventTypeId:{event:"eventAction",social:"socialAction"},eventValue:{event:"eventValue",timing:"timingValue"},eventProperties:{pageview:["page"],screenview:["screenName"],event:["eventCategory","eventLabel"],social:["socialNetwork","socialTarget"],timing:["timingCategory","timingVar","timingLabel"],exception:["exDescription","exFatal"]}},function(t){var e=t.get("hitType"),n=t.get(ua.eventTypeId[e]||"hitType"),r=t.get(ua.eventValue[e]),i={},a=ua.eventProperties[e];if(a)for(var o=0;o<a.length;o++)i[a[o]]=t.get(a[o]);return{eventTypeId:n,value:r,properties:i,timestamp:Date.now()}});var fa=/^[^a-zA-Z0-9]+/,ha=/[^-_.:a-zA-Z0-9]+/g;var pa=function(t,e,n){var r={prefix:"ga",identities:n.key&&n.trafficType?[{key:n.key,trafficType:n.trafficType}]:void 0};!function(t,e){var n=window.GoogleAnalyticsObject||"ga";window[n]=window[n]||function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];(window[n].q=window[n].q||[]).push(e)},window[n]("provide",t,e)}("splitTracker",(function n(a,s){Object(Z.a)(this,n);var c=i()({},r,t,s);this.tracker=a;var u,l=(u=c.identities,Array.isArray(u)?Object(o.r)(u).filter((function(t){if(!t)return!1;var e=t.key,n=t.trafficType;return!(!Object(o.j)(e)&&!Object(o.l)(e))&&!!Object(o.j)(n)})):[]);if(0!==l.length){var f=l.length-c.identities.length;f&&ca.warn("".concat(f," identities were discarded because they are invalid or duplicated. Identities must be an array of objects with key and trafficType.")),c.identities=l,Object(o.j)(c.prefix)||(ca.warn("The provided `prefix` was ignored since it is invalid. Please check that you are passing a string object as `prefix`."),c.prefix=void 0);var h=a.get("sendHitTask");a.set("sendHitTask",(function(t){if(h(t),!1!==c.hits&&!t.get("splitHit")){try{if(c.filter&&!c.filter(t))return}catch(r){return void ca.warn("GaToSplit custom filter threw: ".concat(r))}var n=la(t);if(c.mapper){try{n=c.mapper(t,n)}catch(r){return void ca.warn("GaToSplit custom mapper threw: ".concat(r))}if(!n)return}c.prefix&&(n.eventTypeId="".concat(c.prefix,".").concat(n.eventTypeId)),n.eventTypeId=function(t){if(!Object(o.j)(t)||0===t.length)return t;var e=t.replace(fa,"").replace(ha,"_"),n=e.slice(0,80);return n.length<e.length&&ca.warn("EventTypeId was truncated because it cannot be more than 80 characters long."),n}(n.eventTypeId),function(t){return!!g(t.eventTypeId,sa)&&(!1!==m(t.value,sa)&&(!1!==E(t.properties,sa).properties&&(!(t.timestamp&&!Object(o.l)(t.timestamp))&&((!t.key||!1!==N(t.key,sa))&&(!t.trafficTypeName||!1!==H(t.trafficTypeName,sa))))))}(n)&&(n.key&&n.trafficTypeName?e.events.track(n):c.identities.forEach((function(t){var r=i()({key:t.key,trafficTypeName:t.trafficType},n);e.events.track(r)})))}})),ca.info("Started GA-to-Split integration")}else ca.warn("No valid identities were provided. Please check that you are passing a valid list of identities or providing a traffic type at the SDK configuration.")}))},ga=Object(s.b)("splitio-split-to-ga"),da=function(){function t(e){if(Object(Z.a)(this,t),"function"!==typeof t.getGa())return ga.warn("`ga` command queue not found. No hits will be sent."),{};this.trackerNames=t.defaultTrackerNames,e&&("function"===typeof e.filter&&(this.filter=e.filter),"function"===typeof e.mapper&&(this.mapper=e.mapper),Array.isArray(e.trackerNames)&&(this.trackerNames=Object(o.s)(e.trackerNames)),this.impressions=e.impressions,this.events=e.events),ga.info("Started Split-to-GA integration")}return Object(X.a)(t,null,[{key:"defaultMapper",value:function(t){var e=t.type,n=t.payload;switch(e){case"IMPRESSION":return{hitType:"event",eventCategory:"split-impression",eventAction:"Evaluate "+n.impression.feature,eventLabel:"Treatment: "+n.impression.treatment+". Targeting rule: "+n.impression.label+".",nonInteraction:!0};case"EVENT":return{hitType:"event",eventCategory:"split-event",eventAction:n.eventTypeId,eventValue:n.value,nonInteraction:!0}}return null}},{key:"getGa",value:function(){return"undefined"!==typeof window?window[window.GoogleAnalyticsObject||"ga"]:void 0}},{key:"validateFieldsObject",value:function(t){return!(!t||!t.hitType)||(ga.warn("your custom mapper returned an invalid FieldsObject instance. It must be an object with at least a `hitType` field."),!1)}}]),Object(X.a)(t,[{key:"queue",value:function(e){var n=t.getGa();if(n){if(!1===this.impressions&&"IMPRESSION"===e.type)return;if(!1===this.events&&"EVENT"===e.type)return;var r;try{if(this.filter&&!this.filter(e))return;if(r=t.defaultMapper(e),this.mapper&&(!(r=this.mapper(e,r))||!t.validateFieldsObject(r)))return}catch(i){return void ga.warn("SplitToGa queue method threw: ".concat(i,". No hit was sent."))}this.trackerNames.forEach((function(t){var e=t?"".concat(t,".send"):"send";r.splitHit=!0,n(e,r)}))}}}]),t}();da.defaultTrackerNames=[""];var ma=da,va=function(t){var e=t.get(t.constants.SETTINGS),n=[];if(e.integrations.forEach((function(r){var i;switch(r.type){case"GOOGLE_ANALYTICS_TO_SPLIT":var a=t.get(t.constants.STORAGE),o=e.core;i=pa(r,a,o);break;case"SPLIT_TO_GOOGLE_ANALYTICS":i=new ma(r)}i&&i.queue&&n.push(i)})),0!==n.length)return{handleImpression:function(t){n.forEach((function(e){return e.queue({type:"IMPRESSION",payload:t})}))},handleEvent:function(t){n.forEach((function(e){return e.queue({type:"EVENT",payload:t})}))}}},ya=function(){function t(){Object(Z.a)(this,t),this.cache={}}return Object(X.a)(t,[{key:"_makeKey",value:function(t,e){return"".concat(t,"::").concat(Sr(e))}},{key:"inc",value:function(t,e,n){var r=this._makeKey(t,e),i=this.cache[r];this.cache[r]=i?i+n:n}},{key:"popAll",value:function(){var t={};return i()(t,this.cache),this.cache={},t}},{key:"size",value:function(){return Object.keys(this.cache).length}}]),t}();n.d(e,"SplitFactory",(function(){return ba}));var Sa=Object(s.b)("splitio"),Ta=function(t,e){return"".concat(t.matchingKey?t.matchingKey:t,"-").concat(t.bucketingKey?t.bucketingKey:t,"-").concat(void 0!==e?e:"")};function ba(t){var e={},n={splitsReadyTracker:_e.start(_e.TaskNames.SPLITS_READY),segmentsReadyTracker:_e.start(_e.TaskNames.SEGMENTS_READY),sdkReadyTracker:_e.start(_e.TaskNames.SDK_READY)},r=new le,i=ce(t);r.put(r.constants.SETTINGS,i),function(t){var e=!1;void 0==t?c.error("Factory instantiation: you passed a null or undefined api_key, api_key must be a non-empty string."):Object(o.j)(t)?t.length>0?e=t:c.error("Factory instantiation: you passed an empty api_key, api_key must be a non-empty string."):c.error("Factory instantiation: you passed an invalid api_key, api_key must be a non-empty string."),e&&(u[e]?(c.warn("Factory instantiation: You already have ".concat(u[e]," ").concat(1===u[e]?"factory":"factories"," with this API Key. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")),u[e]++):(u[e]=1,Object.keys(u).length>1&&c.warn("Factory instantiation: You already have an instance of the Split factory. Make sure you definitely want this additional instance. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")))}(i.core.authorizationKey);var a=Ht(),l=a(i.startup.readyTimeout);r.put(r.constants.READINESS,l);var f=oa(r);r.put(r.constants.STATUS_MANAGER,f);var h=wt(r);r.put(r.constants.STORAGE,h);var p=new ya;r.put(r.constants.IMPRESSIONS_COUNTER,p);var g=va(r);r.put(r.constants.INTEGRATIONS_MANAGER,g);var d="localhost"===i.mode?na:Vi,m=d(r,n),v=m.api,y=m.metricCollectors,S=$(h.splits,r),T=fe(i.core.key),b=Ta(T,i.core.trafficType);return e[b]=v,Sa.info("New Split SDK instance created."),{client:function(t,n){if(void 0===t)return Sa.debug("Retrieving default SDK client."),v;if("function"!=typeof h.shared)throw"Shared Client not supported by the storage mechanism. Create isolated instances instead.";var o,s=N(t,"Shared Client instantiation");if(!1===s)throw"Shared Client needs a valid key.";if(void 0!==n&&!1===(o=H(n,"Shared Client instantiation")))throw"Shared Client needs a valid traffic type or no traffic type at all.";var c=Ta(s,o);if(e[c])Sa.debug("Retrieving existing SDK client.");else{var u=i.overrideKeyAndTT(s,o),l=new le,f=a(u.startup.readyTimeout);l.put(r.constants.READY_FROM_CACHE,r.get(r.constants.READY_FROM_CACHE,!0)),l.put(r.constants.READINESS,f),l.put(r.constants.STATUS_MANAGER,oa(l,-1)),l.put(r.constants.SETTINGS,u),l.put(r.constants.STORAGE,h.shared(u)),l.put(r.constants.IMPRESSIONS_COUNTER,p),e[c]=d(l,!1,y).api,Sa.info("New shared client instance created.")}return e[c]},manager:function(){return Sa.info("Manager instance retrieved."),S},Logger:s.a,settings:i}}}}]);
//# sourceMappingURL=298.65ada9e7.chunk.js.map