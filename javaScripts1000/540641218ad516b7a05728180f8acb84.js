KCMS.registerNamespace("KCMS.Tracking"),KCMS.Tracking={TrackingData:{},isMobilePlus:!1,InitialTrackingData:function(a,e,t){KCMS.Tracking.isMobilePlus=void 0!==t&&t;var n=new Array;$.get(a+"?path="+encodeURIComponent(e),function(a){a&&(KCMS.Tracking.TrackingData=a,$.each(a,function(a,e){var t=KCMS.Tracking.GetSelector(e.TargetID,e.TargetClass,e.TargetHref);t&&!$(t).is(".no-manual-tracking")&&n.push(t)}),KCMS.Tracking.BindLinkTracking(n.join(",")))},"json"),this.BindConstantLinkTracking()},BindLinkTracking:function(a){a&&($(a).addClass("hasTracking"),$.each(KCMS.Tracking.TrackingData,function(a,n){var e=KCMS.Tracking.GetSelector(n.TargetID,n.TargetClass,n.TargetHref);$(e).not(".no-manual-tracking").each(function(a,e){var t=$(this);t.attr("data-track-category",n.Category).attr("data-track-action",n.TrackAction).attr("data-track-label",n.Label?n.Label:t.data("track-label")).attr("data-track-value",n.Value)})}),$(document).on("click",a,function(){var a=$(this);KCMS.Tracking.sendEventTrackingData(a)}))},BindConstantLinkTracking:function(){$(document).on("click","a.tracked",function(){var a=$(this);KCMS.Tracking.sendEventTrackingData(a)})},sendEventTrackingData:function(n){if(void 0!==n&&null!=n){var r=n.data("track-category"),i=n.data("track-action"),a=n.data("track-label"),c=n.data("track-value"),e=n.data("track-noninteraction");r&&i&&c||$.each(KCMS.Tracking.TrackingData,function(a,e){var t=KCMS.Tracking.GetSelector(e.TargetID,e.TargetClass,e.TargetHref);if(n.is(t)&&!n.is(".no-manual-tracking"))return r=e.Category,i=e.TrackAction,c=e.Value,!1}),KCMS.Tracking.sendData({category:r,action:i,label:a,value:c,nonInteraction:e})}},sendData:function(a){if(null!=a){var e=a.category,t=a.action,n=a.label,r=a.value,i=a.nonInteraction;e&&(t||(t="click"),n||(n=""),r&&r%1==0||(r=0),"undefined"!=typeof ga&&ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:n,eventValue:r,nonInteraction:i}))}},GetSelector:function(a,e,t){var n="";if(a)n="#"+$.trim(a);else if(e){var r="."+$.trim(e).replace(/\s+/g,".");r.lastIndexOf(".")==r.length-1&&(r=r.substring(0,r.length-1)),".arrow"===r&&(r="a"+r),n=r}else t&&(n="a[href='"+$.trim(t)+"']");return n},InitTrackingEdit:function(){$("#toggleTrackingBorder").click(KCMS.Tracking.ToggleTrackingTool),$("#btnInvalidTracking").click(function(){var n=new Array;$.each(KCMS.Tracking.TrackingData,function(a,e){var t=KCMS.Tracking.GetSelector(e.TargetID,e.TargetClass,e.TargetHref);0==$(t).length&&n.push(e.TrackingID)}),$.fancybox({type:"iframe",width:1e3,height:510,centerOnScroll:!0,hideOnOverlayClick:!1,href:"/Admin/AnalyticsTracking/Invalid?InvalidIds="+n.join(",")})}),$("#DesignTracking").fancybox({type:"iframe",width:650,height:660,centerOnScroll:!0,hideOnOverlayClick:!1,onClosed:function(a){if(a){var e=$(KCMS.Tracking.GetSelector(a.TargetID,a.TargetClass,a.TargetHref));a.Active?e.addClass("hasTracking"):e.removeClass("hasTracking")}}})},ToggleTrackingTool:function(){$(this).prop("checked")?$("a:not(.widget-edit,.dropdown-toggle,.widget-delete,#fancybox-close,.popover-close,.untrackable,.tracked),.Trackable").addClass("TrackingBorder").append($('<i class="icon-edit" title="Edit Tracking"></i>').click(KCMS.Tracking.EditTrackingClick)):$("a:not(.widget-edit,.dropdown-toggle,.widget-delete,#fancybox-close,.popover-close,.untrackable,.tracked),.Trackable").removeClass("TrackingBorder").children("i.icon-edit").remove()},EditTrackingClick:function(){KCMS.Tracking.ClearRedBackGound();var a=$("#DesignTracking"),e=$.trim($(this).parent().attr("id")),t=$.trim($("<a>").addClass($(this).parent().attr("class")).removeClass("TrackingBorder").removeClass("hasTracking").removeClass("Trackable").removeClass("hover").attr("class")),n=$.trim($(this).parent().attr("href")),r=!1;$.trim($(this).parent().data("track-label"))&&(r=!0);var i=a.data("href");i+="&hasDataLabel="+r,e?i+="&targetId="+encodeURIComponent(e):t?i+="&targetClass="+encodeURIComponent(t):n&&(i+="&targetHref="+encodeURIComponent(n));var c=KCMS.Tracking.GetSelector(e,t,n);if(c&&(i+="&selector="+encodeURIComponent(c)),!c)return alert("Can't find any selector,please add an unique id in the tag."),!1;var o=$(c).size();return!(1<o&&($(c).addClass("redBorder"),$(document).on("click",KCMS.Tracking.ClearRedBackGound),!confirm('Find more than one tag with the selector "'+c+'",are you sure to continue?'))||($(document).off("click",KCMS.Tracking.ClearRedBackGound),KCMS.Tracking.ClearRedBackGound(),0==o?alert("Can't find the tag with the selector '"+c+"' ."):(a.text(c),a.attr("href",i),a.click()),1))},ClearRedBackGound:function(){$(".redBorder").removeClass("redBorder")}};