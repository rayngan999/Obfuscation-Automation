!function(t){var e={};function __webpack_require__(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}__webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,n){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)__webpack_require__.d(n,i,function(e){return t[e]}.bind(null,i));return n},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(t,e,n){n(1)},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>(n(14),n(267)))}).call(this,n(2)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){t.exports=n(4)},function(t,e,n){(function(e){var i;n(6),i=function(t){var e,n,i,r,o,s;for(o={},e=0,r=t.length;e<r;e++)for(n in i=t[e])s=i[n],o[n]=s;return o},t.exports=null!=e.CaffeineScriptRuntime?e.CaffeineScriptRuntime:e.CaffeineScriptRuntime=i([n(7),n(9),n(10),n(11),n(12)])}).call(this,n(5))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(t){var e;(e="undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:t).global=e}).call(this,n(5))},function(t,e,n){var i,r,o,s;o=n(8).isPlainArray,r=function(t,e){var n,i,s;for(i=0,s=t.length;i<s;i++)n=t[i],o(n)?r(n,e):null!=n&&e.push(n);return e},s=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)if(null==(e=t[n])||o(e))return!0;return!1},i=function(t){return s(t)?r(t,[]):t},t.exports={compactFlatten:function(t){return i(t)}}},function(t,e){var n,i;i=function(t){return(0|t)===t&&t>=0},t.exports={isPlainArray:function(t){return null!=t&&t.constructor===Array},isFunction:n=function(t){return"function"==typeof t},isArrayIterable:function(t){return null!=t&&i(t.length)&&n(t.indexOf)&&t.constructor!==Object}}},function(t,e,n){var i,r,o;o=n(8).isArrayIterable,t.exports={each:i=function(t,e,n){var i,r,s;if(null==e&&(e=t),null!=t)if(o(t))for(r=i=0,s=t.length;i<s;r=++i)n(t[r],r,e);else for(r in t)n(t[r],r,e);return e},e:i,extendedEach:r=function(t,e,n){var i,r,s,a,l;if("undefined"===e&&(e=t),null!=t)if(l=!1,a=function(){l=!0},o(t))for(r=i=0,s=t.length;i<s&&(e=n(t[r],r,e,a),!l);r=++i);else for(r in t)if(e=n(t[r],r,e,a),l)break;return e},ee:r}},function(t,e,n){var i,r,o,s,a;r=n(8).isArrayIterable,i=function(t){return null!=t},a=function(){return!0},o=function(t){return t},s=function(t,e){return e},t.exports={isArrayIterable:r,find:function(t,e,n){var o,s,a,l,u,c,h,p,d;if(null!=t)if(n||e||(n=i),r(t))switch(!1){case!(n&&e):for(a=o=0,u=t.length;o<u;a=++o)if(n(d=t[a],a))return e(d,a);break;case!n:for(a=s=0,c=t.length;s<c;a=++s)if(n(d=t[a],a))return d;break;case!e:for(a=l=0,h=t.length;l<h;a=++l)if(p=e(d=t[a],a))return p}else switch(!1){case!(n&&e):for(a in t)if(n(d=t[a],a))return e(d,a);break;case!n:for(a in t)if(n(d=t[a],a))return d;break;case!e:for(a in t)if(p=e(d=t[a],a))return p}return null},object:function(t,e,n,i,l){var u,c,h,p;if(null==e&&(e=o),null==n&&(n=a),null==i&&(i={}),r(t))for(null==l&&(l=o),c=u=0,h=t.length;u<h;c=++u)n(p=t[c],c)&&(i[l(p,c)]=e(p,c));else for(c in null==l&&(l=s),t)n(p=t[c],c)&&(i[l(p,c)]=e(p,c));return i},reduce:function(t,e,n,i){var s,l,u,c;if(null==e&&(e=o),null==n&&(n=a),r(t))for(l=s=0,u=t.length;s<u;l=++s)void 0!==(c=t[l])&&n(i,c,l)&&(i=void 0===i?c:e(i,c,l));else for(l in t)void 0!==(c=t[l])&&n(i,c,l)&&(i=void 0===i?c:e(i,c,l));return i},array:function(t,e,n,i){var s,l,u,c;if(null==e&&(e=o),null==n&&(n=a),null==i&&(i=[]),r(t))for(l=s=0,u=t.length;s<u;l=++s)n(c=t[l],l)&&i.push(e(c,l));else for(l in t)n(c=t[l],l)&&i.push(e(c,l));return i},each2:function(t,e,n,i){var s,l,u,c;if(null==e&&(e=o),null==n&&(n=a),null==i&&(i=t),r(t))for(l=s=0,u=t.length;s<u;l=++s)n(c=t[l],l)&&e(c,l);else for(l in t)n(c=t[l],l)&&e(c,l);return i}}},function(t,e,n){(function(e){var i,r,o,s,a;n(6),a=n(8),s=a.isPlainArray,o=a.isFunction,e.__definingModule=null,r=function(t,e){return!o(t)&&e.constructor===t.constructor},t.exports={in:function(t,e){return null!=e&&0<=e.indexOf(t)},mod:function(t,e){return function(t,e){return(+t%(e=+e)+e)%e}(t,e)},div:function(t,e){return Math.floor(t/e)},pow:function(t,e){return Math.pow(t,e)},existsOr:function(t,e){return null!=t?t:e()},exists:function(t){return null!=t||void 0},is:function(t,e){return t===e||null!=t&&null!=e&&t.constructor===e},toString:function(t){return null==t?"":s(t)?t.join(""):o(null!=t?t.toString:void 0)?t.toString():void 0},getSuper:i=function(t){var e;if("object"!=typeof t&&"function"!=typeof t)throw new Error("getSuper expecting an object");return(e=Object.getPrototypeOf(t))===Function.prototype&&t.__super__?t.__super__.constructor:r(t,e)?Object.getPrototypeOf(e):e},defClass:function(t,e){var n;return null!=e&&e.call(t,t,i(t),i(t.prototype)),null!=(n="function"==typeof t.createWithPostCreate?t.createWithPostCreate(t):void 0)?n:t},getModuleBeingDefined:function(){return e.__definingModule},defMod:function(t,n){var i,r;return i=e.__definingModule,e.__definingModule=t,r=t.exports=n(),e.__definingModule=i,r},isFunction:o,isF:o}}).call(this,n(5))},function(t,e,n){(function(e){var i,r,o;i=n(7).compactFlatten,o=n(13),r=function(t,n,i){var r,s,a,l,u,c,h,p,d;for(a=function(){var t,n,r;for(r=[],t=0,n=i.length;t<n;t++)(u=i[t])===e?r.push("global"):null!=u?r.push(u.namespacePath||("function"==typeof u.getName?u.getName():void 0)||"{"+Object.keys(u).join(", ")+"}"):r.push("null");return r}().join("\n  "),s=null,r=0,l=(h=(d=(new Error).stack).split("\n")).length;r<l&&((c=h[r]).match(/caffeine-script-runtime/)||!(null!=s?s:s=null!=(p=c.match(/(\/[^\/]+)+\.(caf|js)\b/i))?p[0]:void 0));r++);if(console.warn("CaffieneScript imports not found:\n  "+t.join("\n  ")+"\n\nimporting from:\n  "+a+"\n\nsource:\n  "+(null!=s?s:d)+"\n"),o)throw new Error("CaffieneScript imports not found: "+t.join(", "))},t.exports={importInvoke:function(t,e,n){var o,s,a,l,u,c;return u=null,e=i(e),a=function(){var n,i,r,a;for(a=[],n=0,r=t.length;n<r;n++){for(o=t[n],s=null,i=e.length-1;i>=0;i+=-1)if(l=e[i],null!=(c=l[o])){s=c;break}null!=s?a.push(s):((u||(u=[])).push(o),a.push(new Error("CaffieneScript import not found: "+o)))}return a}(),null!=u&&r(u,0,e),n.apply(null,a)}}}).call(this,n(5))},function(t,e){t.exports=!1},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>(n(15).Config.PusherClient=n(266),n(15)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(16))}).call(this,n(2)(t))},function(t,e,n){t.exports=n(17),t.exports.addModules({Config:n(40),PusherFilter:n(263),PusherFluxModelMixin:n(264),PusherPipelineMixin:n(265),StandardImport:n(41)})},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(18).addNamespace("Art.EryExtensions.Pusher",function(t){function Pusher(){return Pusher.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Pusher,Neptune.PackageNamespace),Pusher.version=n(39).version,Pusher}())},function(t,e,n){t.exports=n(19)},function(t,e,n){t.exports=n(20)},function(t,e,n){(function(e){var i,r,o={}.hasOwnProperty;if(n(21),n(22),r=n(23).version,e.Neptune)throw new Error("Load NeptuneNamespaces("+r+") FAILED. Another version already loaded: "+e.Neptune.version);t.exports=e.Neptune=function(t){function Neptune(){return Neptune.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Neptune,i=n(25)),i.namespace=i.Neptune=Neptune,Neptune.Namespace=i,Neptune.PackageNamespace=n(24),Neptune.namespacePath="Neptune",Neptune.namespace=null,Neptune.version=r,Neptune.verbose=!1,Neptune.Base=i,Neptune.isNode=n(13),Neptune}()}).call(this,n(5))},function(t,e,n){(function(t){var e;(e="undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:t).self||(e.self=e),e.global||(e.global=e)}).call(this,n(5))},function(t,e,n){(function(t){null==function(){}.name&&Object.defineProperty(t.Function.prototype,"name",{get:function(){var t,e;return e=(t=this.toString().match(/^\s*function\s*([^\s(]+)/))?t[1]:"",Object.defineProperty(this,"name",{value:e}),e}}),t.Function.prototype.getName=function(){var t;return this._name&&this.hasOwnProperty("_name")?this._name:null!=(t=this.name)?t:void 0},t.Function.prototype.hasName=function(){return!!(this._name&&this.hasOwnProperty("_name")||this.name)}}).call(this,n(5))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC\\"","dependencies":{"art-standard-lib":"*","coffee-script":"*"},"description":"Neptune.Namespaces.Runtime","license":"ISC","name":"neptune-namespaces-runtime","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"3.1.1"}')},function(t,e,n){var i={}.hasOwnProperty;t.exports=function(t){function PackageNamespace(){return PackageNamespace.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PackageNamespace,n(25)),PackageNamespace._configureNamespace=function(t){return this.version=t.version,this},PackageNamespace}()},function(t,e,n){(function(e){var i,r,o,s,a,l,u={}.hasOwnProperty,c=[].slice,h=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};l=n(26),r=l.isClass,s=l.isFunction,a=l.isPlainArray,o=l.isExtendedClass,i=null,t.exports=function(){var t,l;function Namespace(){}return Namespace.isNamespace=function(t){return(null!=t?t.prototype:void 0)instanceof Namespace},Namespace.allNamespaces={},Namespace.getAllNamespacePaths=function(){return Object.keys(Namespace.allNamespaces).sort()},Namespace.toString=function(){return this.namespacePath},Namespace.inspect=function(){return this.namespacePath},Namespace.namespacePath="Neptune.Namespace",Namespace.namespace=null,Namespace.namespaces={},Namespace.modules={},Namespace.getNamespacePath=function(){return this.namespacePath},Namespace.getNamespaceNames=function(){return Object.keys(this.namespaces).sort()},Namespace.getModuleNames=function(){return Object.keys(this.modules).sort()},Namespace.getNeptuneLib=function(){return i||(i=n(28))},Namespace.getInspectedObjects=function(t){var e,n,i;return null==t&&(t=!0),(i={})[""+this.namespacePath]=this.getNeptuneLib().merge(this.version?{version:this.version}:void 0,function(){var i,r;for(e in r=[],i=this.namespaces)n=i[e],r.push(n.getInspectedObjects(t));return r}.call(this),t&&this.getModuleNames().length>0?{modules:this.getModuleNames().join(", ")}:void 0),i},Namespace.getVersions=function(){var t,e,n,i,r;for(t in e={},this===Neptune&&(e.NeptuneNamespacesRuntime=this.version),i=this.namespaces)r=i[t],0<Object.keys(n=r.getVersions()).length&&(e[t]=n),null!=r.version&&(e[t]||(e[t]=r.version));return e},Namespace.vivifySubnamespace=function(t){var e,n,i,r,o;if(l(t)&&(t=t.split(".")),a(o=t)){for(r=this,n=0,i=o.length;n<i;n++)t=o[n],r=r.vivifySubnamespace(t);return r}return(e=this.namespaces)[t]||(e[t]=this[t]=function(t){function PathedNamespace(){return PathedNamespace.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PathedNamespace,t),PathedNamespace}(Namespace._init(t,this)))},Namespace.isPathedNamespace=l=function(t){return/\./.test(t)},Namespace.addVersionedNamespace=function(t,e){var n,i;if(e){if((i=(this.versionedNamespaces||(this.versionedNamespaces={}))[t])||(i=this.versionedNamespaces[t]={},this.addVersionedNamespace(t,this.namespaces[t])),n=e.version){if(console.warn("NN: adding "+this.namespacePath+".versionedNamespaces."+t+"['"+n+"']"+(e===this.namespaces[t]?" (default)":"")),null==n)throw new Error("expecting namespace '"+t+"' in '"+this.namespacePath+"'' to have a version");i[n]?console.warn("NN: versionedNamespace "+t+" already added for version "+n+". Not added again."):i[n]=e}return e}},Namespace.addNamespace=function(t,e){var n,i,r,o;if(l(t))r=2<=(o=t.split(".")).length?c.call(o,0,i=o.length-1):(i=0,[]),t=o[i++],this.vivifySubnamespace(r).addNamespace(t,e);else if(n=this.namespaces[t]){if(e.prototype instanceof Neptune.PackageNamespace){if(!(n.prototype instanceof Neptune.PackageNamespace))throw new Error("Attempting to replace a PathNamespace with a PackageNamespace. Define your PackageNamespace first. Namespace: "+this.namespacePath+"."+t+"'");this.addVersionedNamespace(t,e)}}else this.allNamespaces[e.namespacePath]=this.namespaces[t]=this[t]=e._init(t,this);return e},Namespace.addModules=function(t){var e,n,i;for(i in t)n=t[i],this._setChildNamespaceProps(i,n),o(n)&&i!==(e=n.getName())&&console.warn("NN: module name ("+this.namespacePath+"."+i+") does not match module.exports.getName(): "+e),i.match(/^-/)||(this.modules[i]=this[i]=n);return this},Namespace.includeInNamespace=function(){var t,e,n,i,r,o,s,l,u,c,h,p;for(r=0,l=(e=1===arguments.length&&a(arguments[0])?arguments[0]:arguments).length;r<l;r++)if(null!=(t=e[r]))if(a(t))for(n=t[0],i=o=1,h=t.length;1<=h?o<h:o>h;i=1<=h?++o:--o)for(s=0,u=(p=t[i].match(/[0-9a-z_]+/gi)).length;s<u;s++)c=p[s],this._addToNamespace(c,n);else for(c in t)t[c],this._addToNamespace(c,t);return this},Namespace._setChildNamespaceProps=function(t,e){if(s(e)||r(e))return s(e.class)&&this._setChildNamespaceProps(t,e.class),e.namespace=this,e.namespacePath=this.namespacePath+"."+t},Namespace._init=function(t,e){var n;return this.namespace=e,this._name=t,this.modules={},this.namespaces={},this.versionedNamespaces=null,null!=(n=this.namespace)&&n._setChildNamespaceProps(t,this),this},t=["__super__","_name","version"].concat(Object.keys(Namespace)),Namespace._addToNamespace=function(n,i){var r,o,s;return s=i[n],"inspect"===n&&(null!=s?s.length:void 0)>0?this[n]=s:h.call(t,n)>=0||null==s?void 0:(this[n]?(this[n]!==s&&e.Neptune.verbose&&(r=i.namespacePath||i.propName||Object.keys(i).join(", "),console.log({namespacePath:this.namespacePath,addingFromString:r,propName:n,oldValue:this[n],newValue:s}),console.error("NeptuneNamespaces: "+this.namespacePath+" already has key '"+n+"' with a different value. Replacing with value from: "+r)),this[n]):this[n]=s,"version"===n&&null!=(o=this.namespace.versionedNamespaces)?o[this.getName()][s]=this:void 0)},Namespace}()}).call(this,n(5))},function(t,e,n){t.exports=n(27)},function(t,e,n){(function(e){var n;n=e.ArtStandardLibMultipleContextTypeSupport,t.exports=function(){var t,i,r,o,s,a,l,u,c,h,p,d,f;function Types(){}return Types.isPromise=function(t){return null!=t&&u(t.then)&&!u(t)},Types.isRegExp=n?function(t){return"RegExp"===t.constructor.name}:function(t){return t.constructor===RegExp},Types.isNumber=p=function(t){return"number"==typeof t},Types.prototype.isNonNegativeInt=function(t){return(0|t)===t&&t>=0},Types.isError=function(t){return null!=t&&t instanceof Error},Types.isDate=function(t){return(null!=t?t.constructor:void 0)===Date},Types.isString=f=function(t){return"string"==typeof t},Types.isFunction=u=function(t){return"function"==typeof t},Types.isEmptyObject=function(t){return 0===Object.keys(t).length},Types.isBoolean=function(t){return!0===t||!1===t},Types.isArrayBuffer=a=e.ArrayBuffer?function(t){return null!=t&&t.constructor===ArrayBuffer}:function(){return!1},Types.isTypedArray=function(t){return null!=t&&t.length>=0&&t.length===(0|t.length)&&a(t.buffer)},t=Object.getPrototypeOf(function(){}),Types.getSuperclass=i=function(e){var n,i;if(u(e))return null!=(i=Object.getPrototypeOf(e))&&i!==t?i:null!=(n=e.__super__)?n.constructor:void 0},Types.isClass=function(t){return!!i(t)||!(!u(t)||!r(t)&&!o(t.prototype))},function(t){return!("function"!=typeof t||!("object"==typeof t.__super__||i(t)||r(t)||null!=t.prototype&&o(t.prototype)))},Types.isExtendedClass=function(t){return!!i(t)},Types.isArrayUniversal=Array.isArray,Types.isArray=s=Types.isArrayUniversal,Types.isArguments=function(t){return null!=t&&"number"==typeof t.length&&"[object Arguments]"===t.toString()},Types.isPlainArray=s,Types.isNonNegativeInt=h=function(t){return null!=t&&t>=0},Types.isArrayIterable=function(t){return null!=t&&h(t.length)},Types.isJsonAtomicType=c=function(t){return f(t)||p(t)||!0===t||!1===t||null===t},Types.isJsonType=function(t){return c(t)||d(t)||s(t)},Types.isObject=function(t){return null!=t&&"object"==typeof t&&!s(t)},Types.isDirectPrototypeOf=l=function(t,e){return!u(t)&&e.constructor===t.constructor},Types.getSuper=function(t){var e;if("object"!=typeof t&&"function"!=typeof t)throw new Error("getSuper expecting an object");return e=Object.getPrototypeOf(t),l(t,e)&&(e=Object.getPrototypeOf(e)),e},Types.isPlainObjectUniversal=function(t){return null!=t&&null===Object.getPrototypeOf(Object.getPrototypeOf(t))},Types.isPlainObject=d=n?Types.isPlainObjectUniversal:function(t){return null!=t&&t.constructor===Object},Types.hasProperties=o=function(t){var e;if(null==t)return!1;for(e in t)return!0;return!1},Types.hasOwnProperties=r=function(t){var e;if(null==t)return!1;for(e in t)if(t.hasOwnProperty(e))return!0;return!1},Types}()}).call(this,n(5))},function(t,e,n){var i,r,o;t.exports=null!=(i="undefined"!=typeof Neptune&&null!==Neptune&&null!=(r=Neptune.Art)&&null!=(o=r.StandardLib)?o.Core:void 0)?i:n(29)},function(t,e,n){(t.exports=n(30)).includeInNamespace(n(35)).addModules({ArrayCompactFlatten:n(36),Merge:n(38),StringCase:n(37),Types:n(27)})},function(t,e,n){t.exports=n(31).addNamespace("Core",class Core extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(18).addNamespace("Art.StandardLib",class StandardLib extends Neptune.PackageNamespace{}._configureNamespace(n(32))),n(30),n(33)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","bugs":"https:/github.com/imikimi/art-standard-lib/issues","dependencies":{"art-build-configurator":"*","pluralize":"*"},"description":"The Standard Library for JavaScript that aught to be.","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","coffee-loader":"^0.7.3","css-loader":"^3.0.0","json-loader":"^0.5.7","mocha":"^6.2.0","mock-fs":"^4.10.0","script-loader":"^0.7.2","style-loader":"^1.0.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"homepage":"https://github.com/imikimi/art-standard-lib","license":"ISC","name":"art-standard-lib","repository":{"type":"git","url":"https://github.com/imikimi/art-standard-lib.git"},"scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"1.64.0"}')},function(t,e,n){t.exports=n(31).addNamespace("Inspect",class Inspect extends Neptune.PackageNamespace{}),n(34)},function(t,e,n){t.exports=n(33).addNamespace("Inspected",class Inspected extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=[n(36),n(37),n(38),n(27)]},function(t,e,n){"use strict";var i,r=[].slice;i=n(27).isArray,t.exports=function(){var t,e,n,o,s,a,l,u,c,h,p,d,f,m;function ArrayCompactFlatten(){}return ArrayCompactFlatten.isArrayOrArguments=c=function(t){return i(t)||"number"==typeof(null!=t?t.length:void 0)&&"[object Arguments]"===t.toString()&&(console.error("DEPRICATED compactFlatten* no longer supports Arguments objects"),!0)},ArrayCompactFlatten.needsFlatteningOrCompacting=function(t,e){return console.warn("DEPRICATED - needsFlatteningOrCompacting"),d(t,e)},ArrayCompactFlatten.keepUnlessNullOrUndefined=function(t){return console.warn("DEPRICATED: keepUnlessNullOrUndefined"),null!=t},d=function(t,e){var n,i,r;for(i=0,r=t.length;i<r;i++)if(n=t[i],c(n)||!e(n))return!0;return!1},h=function(){return!0},p=function(t){return null!=t},ArrayCompactFlatten.compact=function(t,e){var n,i,r,o,s;if(e){for(i=0,o=t.length;i<o;i++)if(n=t[i],!e(n))return function(){var i,r,o;for(o=[],i=0,r=t.length;i<r;i++)n=t[i],e(n)&&o.push(n);return o}()}else for(r=0,s=t.length;r<s;r++)if(null==(n=t[r]))return function(){var e,i,r;for(r=[],e=0,i=t.length;e<i;e++)null!=(n=t[e])&&r.push(n);return r}();return t},ArrayCompactFlatten.flatten=function(){var e;return e=1<=arguments.length?r.call(arguments,0):[],t(1===e.length?e[0]:e,h)},ArrayCompactFlatten.compactFlatten=function(e,n){if(n)throw new Error("DEPRICATED ArtStandardLib.ArrayCompactFlatten.compactFlatten: keepTester param; use customCompactFlatten");return t(e,p)},ArrayCompactFlatten.customCompactFlatten=function(e,n){return t(e,n)},ArrayCompactFlatten.compactFlattenAll=function(){var t;return t=1<=arguments.length?r.call(arguments,0):[],e(t)},ArrayCompactFlatten.compactFlattenFast=function(t){return e(t)},ArrayCompactFlatten.compactFlattenIntoFast=function(t,e){return l(e,t)},ArrayCompactFlatten.customCompactFlattenFast=function(t,e){return n(t,e)},ArrayCompactFlatten.customCompactFlattenIntoFast=function(t,e,n){return u(e,t,n)},ArrayCompactFlatten.compactFlattenAllFast=function(){var t;return t=1<=arguments.length?r.call(arguments,0):[],e(t)},ArrayCompactFlatten.deepArrayEachFast=s=function(t,e){var n,r,o;for(r=0,o=t.length;r<o;r++)n=t[r],i(n)?s(n,e):e(n);return t},ArrayCompactFlatten.deepArrayEach=o=function(t,e){var n,i,r;for(i=0,r=t.length;i<r;i++)n=t[i],c(n)?o(n,e):e(n);return t},a=function(t,e,n){var i,r,o;for(r=0,o=t.length;r<o;r++)i=t[r],c(i)?a(i,e,n):n(i)&&e.push(i);return e},t=function(t,e){switch(!1){case!(null==t):return t;case!!c(t):return[t];case!(d(t,e)||!i(t)):return a(t,[],e);default:return t}},l=function(t,e){var n,r,o;for(r=0,o=t.length;r<o;r++)n=t[r],i(n)?l(n,e):null!=n&&e.push(n);return e},f=function(t){var e,n,r;for(n=0,r=t.length;n<r;n++)if(null==(e=t[n])||i(e))return!0;return!1},e=function(t){return f(t)?l(t,[]):t},u=function(t,e,n){var r,o,s;for(o=0,s=t.length;o<s;o++)r=t[o],i(r)?u(r,e,n):n(r)&&e.push(r);return e},m=function(t,e){var n,r,o;for(r=0,o=t.length;r<o;r++)if(n=t[r],i(n)||!e(n))return!0;return!1},n=function(t,e){return m(t,e)?u(t,[],e):t},ArrayCompactFlatten}()},function(t,e,n){var i,r,o,s;i=n(36).compactFlatten,s=n(27),r=s.isArray,o=s.isString,t.exports=function(){var t,e,n;function StringCase(){}return e=/[a-zA-Z][a-zA-Z0-9]*|[0-9]+/g,t=/(?:[A-Z]{2,}(?![a-z]))|[A-Z][a-z0-9]*|[a-z0-9]+/g,StringCase.getCodeWords=n=function(n){var s;return i(function(){var i,a,l,u;if(r(n))return n;if(o(n)&&e.test(n)){for(u=[],i=0,a=(l=n.match(e)).length;i<a;i++)s=l[i],u.push(s.match(t));return u}return[]}())},StringCase.codeWords=n,StringCase.lowerCase=function(t){return null!=t?t.toLocaleLowerCase():void 0},StringCase.upperCase=function(t){return null!=t?t.toLocaleUpperCase():void 0},StringCase.capitalize=function(t){return StringCase.upperCase(t.charAt(0))+t.slice(1)},StringCase.decapitalize=function(t){return StringCase.lowerCase(t.charAt(0))+t.slice(1)},StringCase.getLowerCaseCodeWords=function(t){var e,n,i,r,o;for(r=[],e=0,n=(i=StringCase.getCodeWords(t)).length;e<n;e++)o=i[e],r.push(StringCase.lowerCase(o));return r},StringCase.getCapitalizedCodeWords=function(t){var e,n,i,r,o;for(r=[],e=0,n=(i=StringCase.getCodeWords(t)).length;e<n;e++)o=i[e],r.push(StringCase.capitalize(StringCase.lowerCase(o)));return r},StringCase.upperCamelCase=function(t,e){var n;return null==e&&(e=""),function(){var e,i,r,o;for(o=[],e=0,i=(r=this.getLowerCaseCodeWords(t)).length;e<i;e++)n=r[e],o.push(this.capitalize(n));return o}.call(StringCase).join(e)},StringCase.lowerCamelCase=function(t,e){return null==e&&(e=""),StringCase.decapitalize(StringCase.upperCamelCase(t,e))},StringCase.snakeCase=function(t){return StringCase.getLowerCaseCodeWords(t).join("_")},StringCase.dashCase=function(t){return StringCase.getLowerCaseCodeWords(t).join("-")},StringCase.capitalizedDashCase=function(t){return StringCase.getCapitalizedCodeWords(t).join("-")},StringCase}()},function(t,e,n){var i,r,o=[].slice;i=n(36).compactFlatten,r=n(27).isPlainObject,t.exports=function(){var t,e,n,s,a;function Merge(){}return Merge.merge=e=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],n({},t)},Merge.mergeWithoutNulls=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],s({},t)},Merge.mergeWithSelf=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],n({},this,t)},Merge.mergeInto=n=function(){var t,e,n,r,s,a,l,u;if(t=1<=arguments.length?o.call(arguments,0):[],0===(l=i(t)).length)return null;for(s=l[0]||{},e=0,r=l.length;e<r;e++)if((a=l[e])!==s)for(n in a)void 0!==(u=a[n])&&(s[n]=u);return s},Merge.mergeIntoWithNullDeletes=s=function(){var t,e,n,r,s,a,l,u;if(t=1<=arguments.length?o.call(arguments,0):[],0===(l=i(t)).length)return null;for(s=l[0]||{},e=0,r=l.length;e<r;e++)if((a=l[e])!==s)for(n in a)switch(u=a[n],!1){case null==u:s[n]=u;break;case null!==u:delete s[n]}return s},Merge.mergeIntoUnless=function(){var t,e,n,r,s,a,l,u,c;if(t=1<=arguments.length?o.call(arguments,0):[],0===(u=i(t)).length)return null;for(a=u[0]||{},e=n=1,s=u.length;n<s;e=n+=1)for(r in l=u[e])c=l[r],void 0===a[r]&&(a[r]=c);return a},Merge.deepMerge=function(){var n,s,a,l,u,c,h;for(a in n=1<=arguments.length?o.call(arguments,0):[],u=l=e(s=i(n)))c=u[a],r(c)&&(l[a]=t(function(){var t,e,n;for(n=[],t=0,e=s.length;t<e;t++)h=s[t],n.push(h[a]);return n}()));return l},t=function(n){var o,s,a,l,u;for(o in a=s=e(n=i(n)))l=a[o],r(l)&&(s[o]=t(function(){var t,e,i;for(i=[],t=0,e=n.length;t<e;t++)u=n[t],i.push(u[o]);return i}()));return s},Merge.hasAllProps=function(t,e){var n;for(n in t)if(t[n],!e.hasOwnProperty(n))return!1;return!0},Merge.pureMerge=a=function(){var t,e,n,r,s,a;if(t=1<=arguments.length?o.call(arguments,0):[],0===(a=i(t)).length)return null;if(1===a.length)return a[0];for(n=a[a.length-1],e=0,r=a.length;e<r;e++)if((s=a[e])!==n&&!Merge.hasAllProps(s,n))return Merge.merge(a);return n},Merge.m=a,Merge}()},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","pusher":"^1.5.1","pusher-js":"^4.2.2"},"description":"Art.Ery.Pusher","license":"ISC","name":"art-ery-pusher","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"webpack-dev-server  --progress","testInBrowser":"webpack-dev-server --progress","testServer":"caf ./TestServer.caf"},"version":"0.11.4"}')},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Configurable","isString","ArtEry","console","log","Promise"],[e,n(41),{ArtEry:n(134)}],(t,e,n,r,o,s)=>{return i.defClass(class Config extends t{},function(t,a,l){let u;this.defaults({appId:"...",key:"...",secret:"...",cluster:null,encrypted:!0,verbose:!1,verifyConnection:!1,pusherEventName:"changed"}),u=function(t){return t.replace(/[^-a-zA-Z0-9_=@,;]/g,";")},this.getPusherChannel=function(t,i){return e(i)||(i=t.toKeyString(i)),e(t)||(t=t.getName()),[n.config.tableNamePrefix,t,u(i)].join(".")},this.configured=function(){let t,e,n,o,s,l,u;return a.configured.apply(this,arguments),t=(u=this.config).verbose,e=u.verifyConnection,n=u.key,o=u.encrypted,s=u.cluster,this.PusherClient?(l=this.pusherClient=new this.PusherClient(n,{encrypted:o,cluster:s}),this.verboseLog("ArtEryPusher: PusherClient initialized"),e?(this.verboseLog("PusherClient - subscribing to connection state_change"),this.pusherClient.connection.bind("state_change",t=>this.verboseLog(`PusherClient state_change: ${i.toString(t)}`))):void 0):this.PusherServer?(this.pusherServer=new this.PusherServer(this.config),this.verboseLog("PusherServer initialized"),e&&this.pusherServer.trigger("ArtEryPusherConfig","server",{message:"ArtEryPusher: verifyConnection: pusher was initialized correctly"},(t,e,n)=>t?(this.verboseLog(`PusherServer not initialized correctly! trigger-attempt error: ${i.toString(t)}`),r.log(t)):this.verboseLog("PusherServer initialized correctly."))):this.verboseLog("disabled. Require: art-ery-pusher/Client or art-ery-pusher/Server")},this.verboseLog=function(t){return this.config.verbose&&o(`ArtEryPusher: ${i.toString(t)}`)},this.onConnected=function(){return new s((t,e)=>this.pusherClient?(o(`onConnected current state: ${i.toString(this.pusherClient.connection.state)}`),"connected"===this.pusherClient.connection.state?t():this.pusherClient.connection.bind("state_change",({current:e})=>(o(`onConnected updated state: ${i.toString(e)}`),"connected"===e?t():void 0))):e("no pusherClient"))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(42).mergeWithSelf(n(96),n(106),n(134)))}).call(this,n(2)(t))},function(t,e,n){var i,r;t.exports=null!=(i="undefined"!=typeof Neptune&&null!==Neptune&&null!=(r=Neptune.Art)?r.StandardLib:void 0)?i:n(43)},function(t,e,n){(t.exports=n(31)).includeInNamespace(n(44)).addModules({ArrayExtensions:n(72),AsyncExtensions:n(81),CallStack:n(92),Clone:n(90),CommonJs:n(51),DateExtensions:n(82),Environment:n(52),Eq:n(71),ErrorWithInfo:n(55),FunctionExtensions:n(83),Iteration:n(68),Log:n(91),Map:n(59),MapExtensions:n(85),MathExtensions:n(63),MinimalBaseObject:n(61),ObjectDiff:n(84),ObjectExtensions:n(67),ParseUrl:n(53),Promise:n(45),PromisedFileReader:n(86),PromiseWorkerPool:n(94),RegExpExtensions:n(54),RequestError:n(95),ReschedulableTimer:n(93),Ruby:n(87),ShallowClone:n(88),StringExtensions:n(62),Time:n(89),TypesExtended:n(50),Unique:n(60)}),n(29),n(56)},function(t,e,n){t.exports=[n(29),[n(45),"testPromise","containsPromises","deepAll","logPromise","logPromiseProblems","logPromiseErrors","logRejectedPromises"],n(72),n(81),n(67),n(62),n(71),n(83),n(84),n(85),n(63),n(52),n(53),n(86),n(54),n(87),n(88),n(89),n(50),n(51),n(68),n(56),n(90),n(91),n(92),n(82),{PushBackTimer:n(93)}]},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f=[].slice;r=e=n(46),d=n(50),s=d.deepMap,o=d.deepEach,u=d.isFunction,d.isPlainObject,a=n(51).defineModule,l=n(52).getEnv,h=n(31),(p=l().artPromiseDebug)&&console.log("Art.StandardLib.Promise: BlueBirdPromise debug ENABLED"),e.config({warnings:p,longStackTraces:p,cancellation:p,monitoring:p}),c=n(27).isPromise,i=n(55),a(t,function(){var t,n,a;for(n in t=function(){var t,n,a;function ArtPromise(){}return ArtPromise.isPromise=c,ArtPromise.testPromise=function(t){return t.then(function(t){return console.log("promise.resolve",t)}),t.catch(function(t){return console.log("promise.reject",t)})},ArtPromise.mapAll=function(t){var e,n;return n=Object.keys(t),r.all(function(){var i,r,o;for(o=[],i=0,r=n.length;i<r;i++)e=n[i],o.push(t[e]);return o}()).then(function(t){var e,i,r,o;for(o={},e=i=0,r=n.length;i<r;e=++i)o[n[e]]=t[e];return o})},ArtPromise.containsPromises=function(t){var e;return e=!1,o(t,function(t){return e||(e=c(t))}),e},ArtPromise.withCallback=function(t){return new e(function(e,n){return t(function(t,i){return t?n(new Error(t)):e(i)})})},ArtPromise.newExternallyResolvable=function(){var t,n;return t={},(n=new e(function(e,n){return t.resolve=e,t.reject=n})).resolve=t.resolve,n.reject=t.reject,n},a=function(t){return t},ArtPromise.deepAll=t=function(t,e){var n;return null==e&&(e=a),n=[],o(t,function(t){if(c(t))return n.push(t)}),r.all(n).then(function(n){var i;return i=0,s(t,function(t){return c(t)?e(n[i++]):t})})},ArtPromise.deepResolve=t,ArtPromise.Serializer=function(){function Serializer(){this._lastPromise=e.resolve()}return Serializer.prototype.serialize=function(t){return e=this,function(){var n;return n=1<=arguments.length?f.call(arguments,0):[],e.then(function(){return t.apply(null,n)})};var e},Serializer.prototype.then=function(t,e){return this._lastPromise=this._lastPromise.then(t,e)},Serializer.prototype.catch=function(t){return this._lastPromise=this._lastPromise.catch(t)},Serializer.prototype.always=function(t){return this._lastPromise=this._lastPromise.catch(function(){return null}).then(t)},Serializer.prototype.allDonePromise=function(){var t,e;return(t=this._lastPromise).then((e=this,function(n){return t===e._lastPromise?n:e.allDonePromise()})).catch(function(e){return function(n){if(t===e._lastPromise)throw n;return e.allDonePromise()}}(this))},Serializer}(),ArtPromise.serialize=function(t){return(new ArtPromise.Serializer).serialize(t)},ArtPromise.logPromise=function(t,e){var n,i,o;return null==e&&(e=t,t="(context not specified)"),i=h.log,n=h.currentSecond,i({logPromise_start:t}),o=n(),r.then(function(){return u(e)?e():e}).tap(function(e){return i({logPromise_success:{context:t,result:e,seconds:n()-o}})}).tapCatch(function(e){return i.error({logPromise_error:{context:t,error:e,seconds:n()-o}})})},ArtPromise.logPromiseProblems=n=function(t,e){var n,i,o;return i=h.log,n=h.currentSecond,o=n(),r.then(function(){return u(e)?e():e}).tapCatch(function(e){return i.error({logRejectedPromises:{context:t,error:e,seconds:n()-o}})})},ArtPromise.logPromiseErrors=n,ArtPromise.logRejectedPromises=n,ArtPromise.invert=function(t){return t.then(function(t){throw new i(""+t,t)},function(t){return t})},ArtPromise.finally=function(t,n){return e.resolve(t).finally(n)},ArtPromise.then=e.try,ArtPromise}())a=t[n],e[n]||(e[n]=a);return e})}).call(this,n(2)(t))},function(t,e,n){(function(e,P,I){t.exports=function r(t,e,n){function i(s,a){if(!e[s]){if(!t[s]){var l="function"==typeof _dereq_&&_dereq_;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=e[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n||e)},c,c.exports,r,t,e,n)}return e[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,n,l){"use strict";function r(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new p(16),this._normalQueue=new p(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=h}function i(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function o(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function a(t){this._normalQueue._pushOne(t),this._queueTick()}function s(t){for(;t.length()>0;)c(t)}function c(t){var e=t.shift();if("function"!=typeof e)e._settlePromises();else{var n=t.shift(),i=t.shift();e.call(n,i)}}var u;try{throw new Error}catch(t){u=t}var h=t("./schedule"),p=t("./queue"),d=t("./util");r.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},r.prototype.hasCustomScheduler=function(){return this._customScheduler},r.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},r.prototype.disableTrampolineIfNecessary=function(){d.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},r.prototype.fatalError=function(t,n){n?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},r.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},d.hasDevTools?(r.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?i.call(this,t,e,n):this._schedule(function(){setTimeout(function(){t.call(e,n)},100)})},r.prototype.invoke=function(t,e,n){this._trampolineEnabled?o.call(this,t,e,n):this._schedule(function(){t.call(e,n)})},r.prototype.settlePromises=function(t){this._trampolineEnabled?a.call(this,t):this._schedule(function(){t._settlePromises()})}):(r.prototype.invokeLater=i,r.prototype.invoke=o,r.prototype.settlePromises=a),r.prototype._drainQueues=function(){s(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,s(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},n.exports=r,n.exports.firstLineError=u},{"./queue":17,"./schedule":18,"./util":21}],2:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){var r=!1,o=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},a=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},l=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){r||(r=!0,t.prototype._propagateFrom=i.propagateFromFunction(),t.prototype._boundValue=i.boundValueFunction());var u=n(o),c=new t(e);c._propagateFrom(this,1);var h=this._target();if(c._setBoundTo(u),u instanceof t){var p={promiseRejectionQueued:!1,promise:c,target:h,bindingPromise:u};h._then(e,s,void 0,c,p),u._then(a,l,void 0,c,p),c._setOnCancel(u)}else c._resolveCallback(h);return c},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,n){return t.resolve(n).bind(e)}}},{}],3:[function(t,e,n){"use strict";var i;"undefined"!=typeof Promise&&(i=Promise);var o=t("./promise")();o.noConflict=function r(){try{Promise===o&&(Promise=i)}catch(t){}return o},e.exports=o},{"./promise":15}],4:[function(t,e,n){"use strict";e.exports=function(e,n,i,r){var o=t("./util"),s=o.tryCatch,a=o.errorObj,l=e._async;e.prototype.break=e.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var i=s(t).call(this._boundValue());i===a&&(this._attachExtraTrace(i.e),l.throwLater(i.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":21}],5:[function(t,e,i){"use strict";e.exports=function(e){var i=t("./util"),r=t("./es5").keys,o=i.tryCatch,s=i.errorObj;return function n(t,a,l){return function(n){var u=l._boundValue();t:for(var c=0;c<t.length;++c){var h=t[c];if(h===Error||null!=h&&h.prototype instanceof Error){if(n instanceof h)return o(a).call(u,n)}else if("function"==typeof h){var p=o(h).call(u,n);if(p===s)return p;if(p)return o(a).call(u,n)}else if(i.isObject(n)){for(var d=r(h),f=0;f<d.length;++f){var m=d[f];if(h[m]!=n[m])continue t}return o(a).call(u,n)}}return e}}}},{"./es5":10,"./util":21}],6:[function(t,e,n){"use strict";e.exports=function(t){function e(){this._trace=new e.CapturedTrace(r())}function r(){var t=o.length-1;return t>=0?o[t]:void 0}var i=!1,o=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=o.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=function n(){return i?new e:void 0},e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var n=t.prototype._pushContext,o=t.prototype._popContext,s=t._peekContext,a=t.prototype._peekContext,l=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=n,t.prototype._popContext=o,t._peekContext=s,t.prototype._peekContext=a,t.prototype._promiseCreated=l,i=!1},i=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=r,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e}},{}],7:[function(t,n,m){"use strict";n.exports=function(n,I){function r(t,e){return{promise:e}}function i(){return!1}function o(t,e,n){var i=this;try{t(e,n,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+N.toString(t));i._attachCancellationCallback(t)})}catch(t){return t}}function a(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?N.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function s(){return this._onCancelField}function c(t){this._onCancelField=t}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function u(t,e){if(0!=(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function f(){var t=this._boundTo;return void 0!==t&&t instanceof n?t.isFulfilled()?t.value():void 0:t}function h(){this._trace=new x(this._peekContext())}function d(t,e){if(W(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var i=k(t);N.notEnumerableProp(t,"stack",i.message+"\n"+i.stack.join("\n")),N.notEnumerableProp(t,"__stackCleaned__",!0)}}}function _(){this._trace=void 0}function g(t,e,i){if(lt.warnings){var r,o=new D(t);if(e)i._attachExtraTrace(o);else if(lt.longStackTraces&&(r=n._peekContext()))r.attachExtraTrace(o);else{var s=k(o);o.stack=s.message+"\n"+s.stack.join("\n")}it("warning",o)||j(o,"",!0)}}function w(t){for(var e=[],n=0;n<t.length;++n){var i=t[n],r="    (No stack trace)"===i||$.test(i),o=r&&ot(i);r&&!o&&(Y&&" "!==i.charAt(0)&&(i="    "+i),e.push(i))}return e}function k(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?function E(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var i=e[n];if("    (No stack trace)"===i||$.test(i))break}return n>0&&"SyntaxError"!=t.name&&(e=e.slice(n)),e}(t):["    (No stack trace)"],{message:n,stack:"SyntaxError"==t.name?e:w(e)}}function j(t,e,n){if("undefined"!=typeof console){var i;if(N.isObject(t)){var r=t.stack;i=e+G(r,t)}else i=e+String(t);"function"==typeof B?B(i,n):("function"==typeof console.log||"object"==typeof console.log)&&console.log(i)}}function F(t,e,n,i){var r=!1;try{"function"==typeof e&&(r=!0,"rejectionHandled"===t?e(i):e(n,i))}catch(t){L.throwLater(t)}"unhandledRejection"===t?it(t,n,i)||r||j(n,"Unhandled rejection "):it(t,i)}function T(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{if(e=t&&"function"==typeof t.toString?t.toString():N.toString(t),/\[object [a-zA-Z0-9$_]+\]/.test(e))try{var n=JSON.stringify(t);e=n}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function P(t){return t.length<41?t:t.substr(0,38)+"..."}(e)+">, no stack trace)"}function S(){return"function"==typeof at}function O(t){var e=t.match(st);return e?{fileName:e[1],line:parseInt(e[2],10)}:void 0}function x(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);at(this,x),e>32&&this.uncycle()}var M,A,B,z=n._getDomain,L=n._async,D=t("./errors").Warning,N=t("./util"),U=t("./es5"),W=N.canAttachTrace,q=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,H=/\((?:timers\.js):\d+:\d+\)/,V=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,$=null,G=null,Y=!1,K=!(0==N.env("BLUEBIRD_DEBUG")||!N.env("BLUEBIRD_DEBUG")&&"development"!==N.env("NODE_ENV")),X=!(0==N.env("BLUEBIRD_WARNINGS")||!K&&!N.env("BLUEBIRD_WARNINGS")),J=!(0==N.env("BLUEBIRD_LONG_STACK_TRACES")||!K&&!N.env("BLUEBIRD_LONG_STACK_TRACES")),Q=0!=N.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(X||!!N.env("BLUEBIRD_W_FORGOTTEN_RETURN"));n.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},n.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout(function(){t._notifyUnhandledRejection()},1)}},n.prototype._notifyUnhandledRejectionIsHandled=function(){F("rejectionHandled",M,void 0,this)},n.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},n.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),F("unhandledRejection",A,t,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},n.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},n.prototype._warn=function(t,e,n){return g(t,e,n||this)},n.onPossiblyUnhandledRejection=function(t){var e=z();A="function"==typeof t?null===e?t:N.domainBind(e,t):void 0},n.onUnhandledRejectionHandled=function(t){var e=z();M="function"==typeof t?null===e?t:N.domainBind(e,t):void 0};var Z=function(){};n.longStackTraces=function(){if(L.haveItemsQueued()&&!lt.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!lt.longStackTraces&&S()){var t=n.prototype._captureStackTrace,e=n.prototype._attachExtraTrace,i=n.prototype._dereferenceTrace;lt.longStackTraces=!0,Z=function(){if(L.haveItemsQueued()&&!lt.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");n.prototype._captureStackTrace=t,n.prototype._attachExtraTrace=e,n.prototype._dereferenceTrace=i,I.deactivateLongStackTraces(),L.enableTrampoline(),lt.longStackTraces=!1},n.prototype._captureStackTrace=h,n.prototype._attachExtraTrace=d,n.prototype._dereferenceTrace=_,I.activateLongStackTraces(),L.disableTrampolineIfNecessary()}},n.hasLongStackTraces=function(){return lt.longStackTraces&&S()};var tt=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return N.global.dispatchEvent(t),function(t,e){var n={detail:e,cancelable:!0};U.defineProperty(n,"promise",{value:e.promise}),U.defineProperty(n,"reason",{value:e.reason});var i=new CustomEvent(t.toLowerCase(),n);return!N.global.dispatchEvent(i)}}if("function"==typeof Event){var t=new Event("CustomEvent");return N.global.dispatchEvent(t),function(t,e){var n=new Event(t.toLowerCase(),{cancelable:!0});return n.detail=e,U.defineProperty(n,"promise",{value:e.promise}),U.defineProperty(n,"reason",{value:e.reason}),!N.global.dispatchEvent(n)}}var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),N.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!N.global.dispatchEvent(n)}}catch(t){}return function(){return!1}}(),et=N.isNode?function(){return e.emit.apply(e,arguments)}:N.global?function(t){var e="on"+t.toLowerCase(),n=N.global[e];return!!n&&(n.apply(N.global,[].slice.call(arguments,1)),!0)}:function(){return!1},nt={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:r},it=function(t){var e=!1;try{e=et.apply(null,arguments)}catch(t){L.throwLater(t),e=!0}var n=!1;try{n=tt(t,nt[t].apply(null,arguments))}catch(t){L.throwLater(t),n=!0}return n||e};n.config=function(t){if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?n.longStackTraces():!t.longStackTraces&&n.hasLongStackTraces()&&Z()),"warnings"in t){var e=t.warnings;lt.warnings=!!e,Q=lt.warnings,N.isObject(e)&&"wForgottenReturn"in e&&(Q=!!e.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!lt.cancellation){if(L.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");n.prototype._clearCancellationData=l,n.prototype._propagateFrom=u,n.prototype._onCancel=s,n.prototype._setOnCancel=c,n.prototype._attachCancellationCallback=a,n.prototype._execute=o,rt=u,lt.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!lt.monitoring?(lt.monitoring=!0,n.prototype._fireEvent=it):!t.monitoring&&lt.monitoring&&(lt.monitoring=!1,n.prototype._fireEvent=i)),n},n.prototype._fireEvent=i,n.prototype._execute=function(t,e,n){try{t(e,n)}catch(t){return t}},n.prototype._onCancel=function(){},n.prototype._setOnCancel=function(t){},n.prototype._attachCancellationCallback=function(t){},n.prototype._captureStackTrace=function(){},n.prototype._attachExtraTrace=function(){},n.prototype._dereferenceTrace=function(){},n.prototype._clearCancellationData=function(){},n.prototype._propagateFrom=function(t,e){};var rt=function p(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)},ot=function(){return!1},st=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;N.inherits(x,Error),I.CapturedTrace=x,x.prototype.uncycle=function(){var t=this._length;if(!(2>t)){for(var e=[],n={},i=0,r=this;void 0!==r;++i)e.push(r),r=r._parent;for(var i=(t=this._length=i)-1;i>=0;--i){var o=e[i].stack;void 0===n[o]&&(n[o]=i)}for(var i=0;t>i;++i){var s=e[i].stack,a=n[s];if(void 0!==a&&a!==i){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[i]._parent=void 0,e[i]._length=1;var l=i>0?e[i-1]:this;t-1>a?(l._parent=e[a+1],l._parent.uncycle(),l._length=l._parent._length+1):(l._parent=void 0,l._length=1);for(var u=l._length+1,c=i-2;c>=0;--c)e[c]._length=u,u++;return}}}},x.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=k(t),n=e.message,i=[e.stack],r=this;void 0!==r;)i.push(w(r.stack.split("\n"))),r=r._parent;(function C(t){for(var e=t[0],n=1;n<t.length;++n){for(var i=t[n],r=e.length-1,o=e[r],s=-1,a=i.length-1;a>=0;--a)if(i[a]===o){s=a;break}for(var a=s;a>=0;--a){var l=i[a];if(e[r]!==l)break;e.pop(),r--}e=i}})(i),function b(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(i),N.notEnumerableProp(t,"stack",function m(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}(n,i)),N.notEnumerableProp(t,"__stackCleaned__",!0)}};var at=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():T(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,$=t,G=e;var n=Error.captureStackTrace;return ot=function(t){return q.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var i,r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return $=/@/,G=e,Y=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){i="stack"in t}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(G=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?T(e):e.toString()},null):($=t,G=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(B=function(t){console.warn(t)},N.isNode&&e.stderr.isTTY?B=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:N.isNode||"string"!=typeof(new Error).stack||(B=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var lt={warnings:X,longStackTraces:!1,cancellation:!1,monitoring:!1};return J&&n.longStackTraces(),{longStackTraces:function(){return lt.longStackTraces},warnings:function(){return lt.warnings},cancellation:function(){return lt.cancellation},monitoring:function(){return lt.monitoring},propagateFromFunction:function(){return rt},boundValueFunction:function(){return f},checkForgottenReturns:function v(t,e,n,i,r){if(void 0===t&&null!==e&&Q){if(void 0!==r&&r._returnedNonUndefined())return;if(0==(65535&i._bitField))return;n&&(n+=" ");var o="",s="";if(e._trace){for(var a=e._trace.stack.split("\n"),l=w(a),u=l.length-1;u>=0;--u){var c=l[u];if(!H.test(c)){var h=c.match(V);h&&(o="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(l.length>0)for(var p=l[0],u=0;u<a.length;++u)if(a[u]===p){u>0&&(s="\n"+a[u-1]);break}}var d="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;i._warn(d,!0,e)}},setBounds:function R(t,e){if(S()){for(var n,i,r=(t.stack||"").split("\n"),o=(e.stack||"").split("\n"),s=-1,a=-1,l=0;l<r.length;++l){var u=O(r[l]);if(u){n=u.fileName,s=u.line;break}}for(var l=0;l<o.length;++l){var u=O(o[l]);if(u){i=u.fileName,a=u.line;break}}0>s||0>a||!n||!i||n!==i||s>=a||(ot=function(t){if(q.test(t))return!0;var e=O(t);return!!(e&&e.fileName===n&&s<=e.line&&e.line<=a)})}},warn:g,deprecated:function y(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),g(n)},CapturedTrace:x,fireDomEvent:tt,fireGlobalEvent:et}}},{"./errors":9,"./es5":10,"./util":21}],8:[function(t,e,n){"use strict";e.exports=function(t){function e(){return this.value}function n(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(n){return n instanceof t&&n.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:n},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},t.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof t&&n.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:n},void 0);var i=arguments[1];return i instanceof t&&i.suppressUnhandledRejections(),this.caught(n,function(){return i})}}},{}],9:[function(t,e,o){"use strict";function r(t,e){function n(i){return this instanceof n?(p(this,"message","string"==typeof i?i:e),p(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new n(i)}return h(n,Error),n}function i(t){return this instanceof i?(p(this,"name","OperationalError"),p(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(p(this,"message",t.message),p(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new i(t)}var s,a,l=t("./es5"),u=l.freeze,c=t("./util"),h=c.inherits,p=c.notEnumerableProp,d=r("Warning","warning"),f=r("CancellationError","cancellation error"),m=r("TimeoutError","timeout error"),g=r("AggregateError","aggregate error");try{s=TypeError,a=RangeError}catch(t){s=r("TypeError","type error"),a=r("RangeError","range error")}for(var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),v=0;v<y.length;++v)"function"==typeof Array.prototype[y[v]]&&(g.prototype[y[v]]=Array.prototype[y[v]]);l.defineProperty(g.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),g.prototype.isOperational=!0;var S=0;g.prototype.toString=function(){var t=Array(4*S+1).join(" "),e="\n"+t+"AggregateError of:\n";S++,t=Array(4*S+1).join(" ");for(var n=0;n<this.length;++n){for(var i=this[n]===this?"[Circular AggregateError]":this[n]+"",r=i.split("\n"),o=0;o<r.length;++o)r[o]=t+r[o];i=r.join("\n"),e+=i+"\n"}return S--,e},h(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=u({CancellationError:f,TimeoutError:m,OperationalError:i,RejectionError:i,AggregateError:g}),l.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:s,RangeError:a,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:d}},{"./es5":10,"./util":21}],10:[function(t,e,n){var i=function(){"use strict";return void 0===this}();if(i)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:i,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var r={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(t){var e=[];for(var n in t)r.call(t,n)&&e.push(n);return e};e.exports={isArray:function(t){try{return"[object Array]"===o.call(t)}catch(t){return!1}},keys:a,names:a,defineProperty:function(t,e,n){return t[e]=n.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return s}},isES5:i,propertyIsWritable:function(){return!0}}}},{}],11:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function o(t){this.finallyHandler=t}function a(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function s(){return l.call(this,this.promise._target()._settledValue())}function c(t){return a(this,t)?void 0:(p.e=t,p)}function l(t){var i=this.promise,l=this.handler;if(!this.called){this.called=!0;var u=this.isFinallyHandler()?l.call(i._boundValue()):l.call(i._boundValue(),t);if(u===r)return u;if(void 0!==u){i._setReturnedNonUndefined();var d=n(u,i);if(d instanceof e){if(null!=this.cancelPromise){if(d._isCancelled()){var f=new h("late cancellation observer");return i._attachExtraTrace(f),p.e=f,p}d.isPending()&&d._attachCancellationCallback(new o(this))}return d._then(s,c,void 0,this,void 0)}}}return i.isRejected()?(a(this),p.e=t,p):(a(this),t)}var u=t("./util"),h=e.CancellationError,p=u.errorObj,d=t("./catch_filter")(r);return i.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){a(this.finallyHandler)},e.prototype._passThrough=function(t,e,n,r){return"function"!=typeof t?this.then():this._then(n,r,void 0,new i(this,e,t),void 0)},e.prototype.lastly=e.prototype.finally=function(t){return this._passThrough(t,0,l,l)},e.prototype.tap=function(t){return this._passThrough(t,1,l)},e.prototype.tapCatch=function(t){var n=arguments.length;if(1===n)return this._passThrough(t,1,void 0,l);var i,r=new Array(n-1),o=0;for(i=0;n-1>i;++i){var s=arguments[i];if(!u.isObject(s))return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+u.classString(s)));r[o++]=s}r.length=o;var a=arguments[i];return this._passThrough(d(r,a,this),1,void 0,l)},i}},{"./catch_filter":5,"./util":21}],12:[function(t,e,n){"use strict";e.exports=function(e,n,i,r,o,s){var a=t("./util");a.canEvaluate,a.tryCatch,a.errorObj,e.join=function(){var t,e=arguments.length-1;e>0&&"function"==typeof arguments[e]&&(t=arguments[e]);var i=[].slice.call(arguments);t&&i.pop();var r=new n(i).promise();return void 0!==t?r.spread(t):r}}},{"./util":21}],13:[function(t,e,n){"use strict";e.exports=function(e,n,i,r,o){var s=t("./util"),a=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var i=new e(n);i._captureStackTrace(),i._pushContext();var r=a(t).apply(this,arguments),s=i._popContext();return o.checkForgottenReturns(r,s,"Promise.method",i),i._resolveFromSyncValue(r),i}},e.attempt=e.try=function(t){if("function"!=typeof t)return r("expecting a function but got "+s.classString(t));var i,l=new e(n);if(l._captureStackTrace(),l._pushContext(),arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],c=arguments[2];i=s.isArray(u)?a(t).apply(c,u):a(t).call(c,u)}else i=a(t)();var h=l._popContext();return o.checkForgottenReturns(i,h,"Promise.try",l),l._resolveFromSyncValue(i),l},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":21}],14:[function(t,e,n){"use strict";function i(t){var e;if(function r(t){return t instanceof Error&&c.getPrototypeOf(t)===Error.prototype}(t)){(e=new u(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var n=c.keys(t),i=0;i<n.length;++i){var o=n[i];h.test(o)||(e[o]=t[o])}return e}return s.markAsOriginatingFromRejection(t),t}var s=t("./util"),a=s.maybeWrapAsError,l=t("./errors"),u=l.OperationalError,c=t("./es5"),h=/^(?:name|message|stack|cause)$/;e.exports=function o(t,e){return function(n,r){if(null!==t){if(n){var o=i(a(n));t._attachExtraTrace(o),t._reject(o)}else if(e){var s=[].slice.call(arguments,1);t._fulfill(s)}else t._fulfill(r);t=null}}}},{"./errors":9,"./es5":10,"./util":21}],15:[function(t,r,l){"use strict";r.exports=function(){function n(){}function i(t){t!==b&&function r(t,e){if(null==t||t.constructor!==i)throw new v("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new v("expecting a function but got "+d.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(t){this.promise._resolveCallback(t)}function a(t){this.promise._rejectCallback(t,!1)}function s(t){var e=new i(b);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var l,u=function(){return new v("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},c=function(){return new i.PromiseInspection(this._target())},h=function(t){return i.reject(new v(t))},p={},d=t("./util");l=d.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},d.notEnumerableProp(i,"_getDomain",l);var f=t("./es5"),m=t("./async"),g=new m;f.defineProperty(i,"_async",{value:g});var y=t("./errors"),v=i.TypeError=y.TypeError;i.RangeError=y.RangeError;var S=i.CancellationError=y.CancellationError;i.TimeoutError=y.TimeoutError,i.OperationalError=y.OperationalError,i.RejectionError=y.OperationalError,i.AggregateError=y.AggregateError;var b=function(){},w={},x={},P=t("./thenables")(i,b),C=t("./promise_array")(i,b,P,h,n),_=t("./context")(i),E=(_.create,t("./debuggability")(i,_)),T=(E.CapturedTrace,t("./finally")(i,P,x)),k=t("./catch_filter")(x),I=t("./nodeback"),M=d.errorObj,A=d.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(t){var e=arguments.length;if(e>1){var n,i=new Array(e-1),r=0;for(n=0;e-1>n;++n){var o=arguments[n];if(!d.isObject(o))return h("Catch statement predicate: expecting an object but got "+d.classString(o));i[r++]=o}if(i.length=r,"function"!=typeof(t=arguments[n]))throw new v("The last argument to .catch() must be a function, got "+d.toString(t));return this.then(void 0,k(i,t,this))}return this.then(void 0,t)},i.prototype.reflect=function(){return this._then(c,c,void 0,this,void 0)},i.prototype.then=function(t,e){if(E.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+d.classString(t);arguments.length>1&&(n+=", "+d.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},i.prototype.done=function(t,e){var n=this._then(t,e,void 0,void 0,void 0);n._setIsFinal()},i.prototype.spread=function(t){return"function"!=typeof t?h("expecting a function but got "+d.classString(t)):this.all()._then(t,void 0,void 0,w,void 0)},i.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},i.prototype.error=function(t){return this.caught(d.originatesFromRejection,t)},i.getNewLibraryCopy=r.exports,i.is=function(t){return t instanceof i},i.fromNode=i.fromCallback=function(t){var e=new i(b);e._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=A(t)(I(e,n));return r===M&&e._rejectCallback(r.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},i.all=function(t){return new C(t).promise()},i.cast=function(t){var e=P(t);return e instanceof i||((e=new i(b))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(t){var e=new i(b);return e._captureStackTrace(),e._rejectCallback(t,!0),e},i.setScheduler=function(t){if("function"!=typeof t)throw new v("expecting a function but got "+d.classString(t));return g.setScheduler(t)},i.prototype._then=function(t,e,n,r,o){var s=void 0!==o,a=s?o:new i(b),u=this._target(),c=u._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&c)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var h=l();if(0!=(50397184&c)){var p,f,m=u._settlePromiseCtx;0!=(33554432&c)?(f=u._rejectionHandler0,p=t):0!=(16777216&c)?(f=u._fulfillmentHandler0,p=e,u._unsetRejectionIsUnhandled()):(m=u._settlePromiseLateCancellationObserver,f=new S("late cancellation observer"),u._attachExtraTrace(f),p=e),g.invoke(m,u,{handler:null===h?p:"function"==typeof p&&d.domainBind(h,p),promise:a,receiver:r,value:f})}else u._addCallbacks(t,e,a,r,h);return a},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},i.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},i.prototype._setAsyncGuaranteed=function(){g.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},i.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];return e===p?void 0:void 0===e&&this._isBound()?this._boundValue():e},i.prototype._promiseAt=function(t){return this[4*t-4+2]},i.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},i.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),n=t._rejectionHandler0,i=t._promise0,r=t._receiverAt(0);void 0===r&&(r=p),this._addCallbacks(e,n,i,r,null)},i.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),i=t._rejectionHandlerAt(e),r=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=p),this._addCallbacks(n,i,r,o,null)},i.prototype._addCallbacks=function(t,e,n,i,r){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=i,"function"==typeof t&&(this._fulfillmentHandler0=null===r?t:d.domainBind(r,t)),"function"==typeof e&&(this._rejectionHandler0=null===r?e:d.domainBind(r,e));else{var s=4*o-4;this[s+2]=n,this[s+3]=i,"function"==typeof t&&(this[s+0]=null===r?t:d.domainBind(r,t)),"function"==typeof e&&(this[s+1]=null===r?e:d.domainBind(r,e))}return this._setLength(o+1),o},i.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},i.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(u(),!1);var n=P(t,this);if(!(n instanceof i))return this._fulfill(t);e&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(u());var o=r._bitField;if(0==(50397184&o)){var s=this._length();s>0&&r._migrateCallback0(this);for(var a=1;s>a;++a)r._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&o))this._fulfill(r._value());else if(0!=(16777216&o))this._reject(r._reason());else{var l=new S("late cancellation observer");r._attachExtraTrace(l),this._reject(l)}}},i.prototype._rejectCallback=function(t,e,n){var i=d.ensureErrorObject(t),r=i===t;if(!r&&!n&&E.warnings()){var o="a promise was rejected with a non-error: "+d.classString(t);this._warn(o,!0)}this._attachExtraTrace(i,!!e&&r),this._reject(t)},i.prototype._resolveFromExecutor=function(t){if(t!==b){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,i=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,n)});n=!1,this._popContext(),void 0!==i&&e._rejectCallback(i,!0)}},i.prototype._settlePromiseFromHandler=function(t,e,n,i){var r=i._bitField;if(0==(65536&r)){var o;i._pushContext(),e===w?n&&"number"==typeof n.length?o=A(t).apply(this._boundValue(),n):(o=M).e=new v("cannot .spread() a non-array: "+d.classString(n)):o=A(t).call(e,n);var s=i._popContext();0==(65536&(r=i._bitField))&&(o===x?i._reject(n):o===M?i._rejectCallback(o.e,!1):(E.checkForgottenReturns(o,s,"",i,this),i._resolveCallback(o)))}},i.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(t){this._rejectionHandler0=t},i.prototype._settlePromise=function(t,e,r,o){var s=t instanceof i,a=this._bitField,l=0!=(134217728&a);0!=(65536&a)?(s&&t._invokeInternalOnCancel(),r instanceof T&&r.isFinallyHandler()?(r.cancelPromise=t,A(e).call(r,o)===M&&t._reject(M.e)):e===c?t._fulfill(c.call(r)):r instanceof n?r._promiseCancelled(t):s||t instanceof C?t._cancel():r.cancel()):"function"==typeof e?s?(l&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,r,o,t)):e.call(r,o,t):r instanceof n?r._isResolved()||(0!=(33554432&a)?r._promiseFulfilled(o,t):r._promiseRejected(o,t)):s&&(l&&t._setAsyncGuaranteed(),0!=(33554432&a)?t._fulfill(o):t._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,n=t.promise,r=t.receiver,o=t.value;"function"==typeof e?n instanceof i?this._settlePromiseFromHandler(e,r,o,n):e.call(r,o,n):n instanceof i&&n._reject(o)},i.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},i.prototype._settlePromise0=function(t,e,n){var i=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(i,t,r,e)},i.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},i.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var n=u();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():g.settlePromises(this),this._dereferenceTrace())}},i.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16))return this._setRejected(),this._fulfillmentHandler0=t,this._isFinal()?g.fatalError(t,d.isNode):void((65535&e)>0?g.settlePromises(this):this._ensurePossibleRejectionHandled())},i.prototype._fulfillPromises=function(t,e){for(var n=1;t>n;n++){var i=this._fulfillmentHandlerAt(n),r=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(r,i,o,e)}},i.prototype._rejectPromises=function(t,e){for(var n=1;t>n;n++){var i=this._rejectionHandlerAt(n),r=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(r,i,o,e)}},i.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var i=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,i,t),this._fulfillPromises(e,i)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&f.defineProperty(i.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),i.defer=i.pending=function(){E.deprecated("Promise.defer","new Promise");var t=new i(b);return{promise:t,resolve:o,reject:a}},d.notEnumerableProp(i,"_makeSelfResolutionError",u),t("./method")(i,b,P,h,E),t("./bind")(i,b,P,E),t("./cancel")(i,C,h,E),t("./direct_resolve")(i),t("./synchronous_inspection")(i),t("./join")(i,C,P,b,g,l),i.Promise=i,i.version="3.5.5",d.toFastProperties(i),d.toFastProperties(i.prototype),s({a:1}),s({b:2}),s({c:3}),s(1),s(function(){}),s(void 0),s(!1),s(new i(b)),E.setBounds(m.firstLineError,d.lastLineError),i}},{"./async":1,"./bind":2,"./cancel":4,"./catch_filter":5,"./context":6,"./debuggability":7,"./direct_resolve":8,"./errors":9,"./es5":10,"./finally":11,"./join":12,"./method":13,"./nodeback":14,"./promise_array":16,"./synchronous_inspection":19,"./thenables":20,"./util":21}],16:[function(t,e,n){"use strict";e.exports=function(e,n,i,r,o){function s(t){var i=this._promise=new e(n);t instanceof e&&i._propagateFrom(t,3),i._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=t("./util");return u.isArray,u.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function l(t,n){var o=i(this._values,this._promise);if(o instanceof e){var s=(o=o._target())._bitField;if(this._values=o,0==(50397184&s))return this._promise._setAsyncGuaranteed(),o._then(l,this._reject,void 0,this,n);if(0==(33554432&s))return 0!=(16777216&s)?this._reject(o._reason()):this._cancel();o=o._value()}if(null!==(o=u.asArray(o)))return 0===o.length?void(-5===n?this._resolveEmptyArray():this._resolve(function a(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(n))):void this._iterate(o);var c=r("expecting an array or an iterable object but got "+u.classString(o)).reason();this._promise._rejectCallback(c,!1)},s.prototype._iterate=function(t){var n=this.getActualLength(t.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var r=this._promise,o=!1,s=null,a=0;n>a;++a){var l=i(t[a],r);l instanceof e?(l=l._target(),s=l._bitField):s=null,o?null!==s&&l.suppressUnhandledRejections():null!==s?0==(50397184&s)?(l._proxy(this,a),this._values[a]=l):o=0!=(33554432&s)?this._promiseFulfilled(l._value(),a):0!=(16777216&s)?this._promiseRejected(l._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(l,a)}o||r._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},s.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var n=++this._totalResolved;return n>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(t){return t},s}},{"./util":21}],17:[function(t,e,n){"use strict";function i(t){this._capacity=t,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var n=this._front+e&this._capacity-1;this[n]=t,this._length=e+1},i.prototype.push=function(t,e,n){var i=this.length()+3;if(this._willBeOverCapacity(i))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var r=this._front+i-3;this._checkCapacity(i);var o=this._capacity-1;this[r+0&o]=t,this[r+1&o]=e,this[r+2&o]=n,this._length=i},i.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var n=this._front,i=this._length,o=n+i&e-1;!function r(t,e,n,i,o){for(var s=0;o>s;++s)n[s+i]=t[s+e],t[s+e]=void 0}(this,0,this,e,o)},e.exports=i},{}],18:[function(t,n,i){"use strict";var r,o=t("./util"),s=o.getNativePromise();if(o.isNode&&"undefined"==typeof MutationObserver){var a=P.setImmediate,l=e.nextTick;r=o.isRecentNode?function(t){a.call(P,t)}:function(t){l.call(e,t)}}else if("function"==typeof s&&"function"==typeof s.resolve){var u=s.resolve();r=function(t){u.then(t)}}else r="undefined"!=typeof MutationObserver&&("undefined"==typeof window||!window.navigator||!window.navigator.standalone&&!window.cordova)&&"classList"in document.documentElement?function(){var t=document.createElement("div"),e={attributes:!0},n=!1,i=document.createElement("div"),r=new MutationObserver(function(){t.classList.toggle("foo"),n=!1});r.observe(i,e);var o=function(){n||(n=!0,i.classList.toggle("foo"))};return function(n){var i=new MutationObserver(function(){i.disconnect(),n()});i.observe(t,e),o()}}():void 0!==I?function(t){I(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")};n.exports=r},{"./util":21}],19:[function(t,e,n){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return r.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),i.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],20:[function(t,e,n){"use strict";e.exports=function(e,n){function s(t,i,r){var s=new e(n),c=s;r&&r._pushContext(),s._captureStackTrace(),r&&r._popContext();var h=!0,p=l.tryCatch(i).call(t,function o(t){s&&(s._resolveCallback(t),s=null)},function a(t){s&&(s._rejectCallback(t,h,!0),s=null)});return h=!1,s&&p===u&&(s._rejectCallback(p.e,!0,!0),s=null),c}var l=t("./util"),u=l.errorObj,c=l.isObject,h={}.hasOwnProperty;return function r(t,i){if(c(t)){if(t instanceof e)return t;var r=function o(t){try{return function i(t){return t.then}(t)}catch(t){return u.e=t,u}}(t);if(r===u){i&&i._pushContext();var l=e.reject(r.e);return i&&i._popContext(),l}if("function"==typeof r){if(function a(t){try{return h.call(t,"_promise0")}catch(t){return!1}}(t)){var l=new e(n);return t._then(l._fulfill,l._reject,void 0,l,null),l}return s(t,r,i)}}return t}}},{"./util":21}],21:[function(t,n,S){"use strict";function r(){try{var t=x;return x=null,t.apply(this,arguments)}catch(t){return M.e=t,M}}function o(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function u(t,e,n){if(o(t))return t;var i={value:n,configurable:!0,enumerable:!1,writable:!0};return T.defineProperty(t,e,i),t}function v(t){try{return t+""}catch(t){return"[no string representation]"}}function y(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function b(t){return y(t)&&T.propertyIsWritable(t,"stack")}function C(t){return{}.toString.call(t)}var x,T=t("./es5"),I="undefined"==typeof navigator,M={e:{}},A="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==P?P:void 0!==this?this:null,F=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(T.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var i=[],r=Object.create(null);null!=t&&!e(t);){var o;try{o=n(t)}catch(t){return i}for(var s=0;s<o.length;++s){var a=o[s];if(!r[a]){r[a]=!0;var l=Object.getOwnPropertyDescriptor(t,a);null!=l&&null==l.get&&null==l.set&&i.push(a)}}t=T.getPrototypeOf(t)}return i}}var i={}.hasOwnProperty;return function(n){if(e(n))return[];var r=[];t:for(var o in n)if(i.call(n,o))r.push(o);else{for(var s=0;s<t.length;++s)if(i.call(t[s],o))continue t;r.push(o)}return r}}(),B=/this\s*\.\s*\S+\s*=/,R=/^[a-z$_][a-z$_0-9]*$/i,z="stack"in new Error?function(t){return b(t)?t:new Error(v(t))}:function(t){if(b(t))return t;try{throw new Error(v(t))}catch(t){return t}},O=function(t){return T.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var L="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],i=t[Symbol.iterator]();!(e=i.next()).done;)n.push(e.value);return n};O=function(t){return T.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?L(t):null}}var D=void 0!==e&&"[object process]"===C(e).toLowerCase(),N=void 0!==e&&void 0!==e.env,U={isClass:function f(t){try{if("function"==typeof t){var e=T.names(t.prototype),n=T.isES5&&e.length>1,i=e.length>0&&!(1===e.length&&"constructor"===e[0]),r=B.test(t+"")&&T.names(t).length>0;if(n||i||r)return!0}return!1}catch(t){return!1}},isIdentifier:function d(t){return R.test(t)},inheritedDataKeys:F,getDataPropertyOrDefault:function l(t,e,n){if(!T.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var i=Object.getOwnPropertyDescriptor(t,e);return null!=i?null==i.get&&null==i.set?i.value:n:void 0},thrower:function p(t){throw t},isArray:T.isArray,asArray:O,notEnumerableProp:u,isPrimitive:o,isObject:function a(t){return"function"==typeof t||"object"==typeof t&&null!==t},isError:y,canEvaluate:I,errorObj:M,tryCatch:function i(t){return x=t,r},inherits:function(t,e){function n(){for(var n in this.constructor=t,this.constructor$=e,e.prototype)i.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}var i={}.hasOwnProperty;return n.prototype=e.prototype,t.prototype=new n,t.prototype},withAppended:function c(t,e){var n,i=t.length,r=new Array(i+1);for(n=0;i>n;++n)r[n]=t[n];return r[n]=e,r},maybeWrapAsError:function s(t){return o(t)?new Error(v(t)):t},toFastProperties:function h(t){function e(){}function n(){return typeof i.foo}e.prototype=t;var i=new e;return n(),n(),t},filledRange:function _(t,e,n){for(var i=new Array(t),r=0;t>r;++r)i[r]=e+r+n;return i},toString:v,canAttachTrace:b,ensureErrorObject:z,originatesFromRejection:function m(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)},markAsOriginatingFromRejection:function g(t){try{u(t,"isOperational",!0)}catch(t){}},classString:C,copyDescriptors:function w(t,e,n){for(var i=T.names(t),r=0;r<i.length;++r){var o=i[r];if(n(o))try{T.defineProperty(e,o,T.getDescriptor(t,o))}catch(t){}}},hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:D,hasEnvVariables:N,env:function E(t){return N?e.env[t]:void 0},global:A,getNativePromise:function k(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}},domainBind:function j(t,e){return t.bind(e)}};U.isRecentNode=U.isNode&&function(){var t;return e.versions&&e.versions.node?t=e.versions.node.split(".").map(Number):e.version&&(t=e.version.split(".").map(Number)),0===t[0]&&t[1]>10||t[0]>0}(),U.isNode&&U.toFastProperties(e);try{throw new Error}catch(t){U.lastLineError=t}n.exports=U},{"./es5":10}]},{},[3])(3),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,n(47),n(5),n(48).setImmediate)},function(t,e){var n,i,r=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(n===setTimeout)return setTimeout(t,0);if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){n=defaultSetTimout}try{i="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){i=defaultClearTimeout}}();var o,s=[],a=!1,l=-1;function cleanUpNextTick(){a&&o&&(a=!1,o.length?s=o.concat(s):l=-1,s.length&&drainQueue())}function drainQueue(){if(!a){var t=runTimeout(cleanUpNextTick);a=!0;for(var e=s.length;e;){for(o=s,s=[];++l<e;)o&&o[l].run();l=-1,e=s.length}o=null,a=!1,function runClearTimeout(t){if(i===clearTimeout)return clearTimeout(t);if((i===defaultClearTimeout||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{return i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new Item(t,e)),1!==s.length||a||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=noop,r.addListener=noop,r.once=noop,r.off=noop,r.removeListener=noop,r.removeAllListeners=noop,r.emit=noop,r.prependListener=noop,r.prependOnceListener=noop,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){(function(t){var i=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function Timeout(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new Timeout(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new Timeout(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function onTimeout(){t._onTimeout&&t._onTimeout()},e))},n(49),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(5))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var i,r=1,o={},s=!1,a=t.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(t);l=l&&l.setTimeout?l:t,"[object process]"==={}.toString.call(t.process)?function installNextTickImplementation(){i=function(t){e.nextTick(function(){runIfPresent(t)})}}():!function canUsePostMessage(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?function installMessageChannelImplementation(){var t=new MessageChannel;t.port1.onmessage=function(t){runIfPresent(t.data)},i=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function installReadyStateChangeImplementation(){var t=a.documentElement;i=function(e){var n=a.createElement("script");n.onreadystatechange=function(){runIfPresent(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():function installSetTimeoutImplementation(){i=function(t){setTimeout(runIfPresent,0,t)}}():function installPostMessageImplementation(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&runIfPresent(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),i=function(n){t.postMessage(e+n,"*")}}(),l.setImmediate=function setImmediate(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var s={callback:t,args:e};return o[r]=s,i(r),r++},l.clearImmediate=clearImmediate}function clearImmediate(t){delete o[t]}function runIfPresent(t){if(s)setTimeout(runIfPresent,0,t);else{var e=o[t];if(e){s=!0;try{!function run(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}(e)}finally{clearImmediate(t),s=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(5),n(47))},function(t,e,n){var i,r,o,s,a,l,u,c,h;h=i=n(29),l=h.isPlainObject,c=h.mergeInto,u=h.isString,r=h.isFunction,s=h.isObject,a=h.isPlainArray,o=h.isJsonAtomicType,t.exports=function(){var t,e,n,h,p,d,f,m,g,y,v,S,b,w;function Types(){}return c(Types,i.Types),S=function(t,e){throw new Error("Value types are not compatible for inequality tests. a: "+(null!=t?t.constructor.name:void 0)+", b: "+(null!=e?e.constructor.name:void 0))},v=function(t,e){return typeof t==typeof e},Types.gt=function(t,e){var n;return null!=t&&null!=e?(n=v(t,e))&&t>e||!(n&&t<=e)&&t.gt(e):S(t,e)},Types.lt=function(t,e){var n;return null!=t&&null!=e?(n=v(t,e))&&t<e||!(n&&t>=e)&&t.lt(e):S(t,e)},Types.gte=function(t,e){var n;return null!=t&&null!=e?(n=v(t,e))&&t>=e||!(n&&t<e)&&t.gte(e):S(t,e)},Types.lte=function(t,e){var n;return null!=t&&null!=e?(n=v(t,e))&&t<=e||!(n&&t>e)&&t.lte(e):S(t,e)},Types.present=function(t,e){return null==e&&(e=!1),(r(null!=t?t.getPresent:void 0)?t.getPresent():r(null!=t?t.present:void 0)?t.present():u(t)?y(t):void 0!==t&&null!==t&&!1!==t)?t||!0:e},Types.stringIsPresent=y=function(t){return u(t)&&!/^(\s+|)$/.test(t)},Types.functionName=f=function(t){var e;return t.name||(e=(""+t).match(/function ([a-zA-Z]+)\(/))&&e[1]||"function"},Types.objectName=g=function(t){var e,n,i;return t?(e="function"==typeof t.getNamespacePath?t.getNamespacePath():void 0)?e:(e=t.classPathName)?e:t.constructor===Object?"Object":r(t)?f(t):u(n=null!=(i=t.constructor)?i.name:void 0)&&n.length>0?n:t instanceof Object?"(anonymous instanceof Object)":"(objectName unknown)":""+t},Types.isBrowserObject=function(t){var e;return!!Types.isObject(t)&&("HTML"===(e=Types.objectName(t)).slice(0,4)||"CanvasRenderingContext"===e.slice(0,22))},Types.deepEach=e=function(t,n,i){var r,o,s,u;if(a(t))for(r=0,s=t.length;r<s;r++)u=t[r],e(u,n);else if(l(t))for(o in t)u=t[o],e(u,n,o);else n(t,i);return t},Types.deepEachAll=n=function(t,e,i){var r,o,s,u;if(e(t,i),a(t))for(r=0,s=t.length;r<s;r++)u=t[r],n(u,e);else if(l(t))for(o in t)u=t[o],n(u,e,o);return t},p=function(t,e,n){var i,r,o,s,a,l,u;for(l=null,i=r=0,o=t.length;r<o;i=++r)u=t[i],(a=h(u,e,n))!==u&&(l||(l=t.slice()),l[i]=a);return l||(l=t),(s=null!=n?n.postprocessArray:void 0)?s(l):l},t=function(t,e){var n,i,r;for(n in i={},t){if(r=t[n],n===e)break;i[n]=r}return i},d=function(e,n,i){var r,o,s,a,l;for(r in a=null,e)l=e[r],((s=h(l,n,i))!==l||a)&&(a||(a=t(e,r)),a[r]=s);return a||(a=e),(o=null!=i?i.postprocessObject:void 0)?o(a):a},m=function(t){return t},Types.deepMap=h=function(t,e,n){var i,r;return i=(null!=n?n.arrays:void 0)||m,r=(null!=n?n.objects:void 0)||m,e||(e=m),a(t)?p(i(t),e,n):l(t)?d(r(t),e,n):e(t)},Types.toPlainStructure=function(t){return h(t,function(t){return s(t)?t.toPlainStructure?t.toPlainStructure():g(t):t})},Types.toJsonStructure=b=function(t){return h(t,function(t){return s(t)?t.toJsonStructure?t.toJsonStructure():b(t.toPlainStructure?t.toPlainStructure():""+t):o(t)?t:""+t})},Types.toPostMessageStructure=w=function(t){return h(t,function(t){switch(t.constructor){case ArrayBuffer:case Date:case RegExp:case Blob:case File:case FileList:case ImageData:case Boolean:case String:return t;default:return s(t)?t.toPostMessageStructure?t.toPostMessageStructure():t.toPlainStructure?w(t.toPlainStructure()):""+t:""+t}})},Types}()},function(t,e,n){var i,r,o;o=n(50),i=o.isClass,r=o.isFunction,t.exports=function(){var t;function CommonJs(){}return t=null,CommonJs.getModuleBeingDefined=function(){return t},CommonJs.defineModule=function(e,n){var o,s,a;return o=t,t=e,s=r(n)?i(n)?n:n():n,a=e.exports=(null!=s&&"function"==typeof s.createWithPostCreate?s.createWithPostCreate(s):void 0)||s,t=o,a},CommonJs}()},function(t,e,n){(function(t,e){var i,r,o,s;r=n(51).defineModule,i=n(53),s=n(29).isString,o=n(13),r(t,function(){function Environment(){}return Environment.getEnv=function(){var t,n,r;return null!=e.environment?e.environment:e.environment=function(){var o,a;if(null!=e.location){for(t in n=i.parseQuery(),o=e.location)r=o[t],"search"!==t&&s(r)&&r.length>0&&(n[t]=r);return n}return null!=(a=e.process)?a.env:void 0}()||{}},Environment.isBrowser=!!(e.window&&e.navigator&&e.document),Environment.isWebWorker=!(Environment.isBrowser||!e.importScripts),Environment.isNode=!!o,Environment}())}).call(this,n(2)(t),n(5))},function(t,e,n){(function(e){var i,r,o,s,a=[].slice;s=n(54),r=s.escapeRegExp,o=s.findUrlOrigin,i=n(29).compactFlatten,t.exports=function(){var t,n;function ParseUrl(){}return n=null,ParseUrl.sameOrigin=function(t,n){var i,s;return null==n&&(n=null!=(i=e.document)&&null!=(s=i.location)?s.origin:void 0),n=n.match(o)[0],RegExp("^(("+r(n)+")|(?![a-z]+\\:))","i").test(t)},ParseUrl.parseQuery=function(t){var i,r,o,s,a,l,u,c,h,p;if((r=null==t)&&n)return n;for(t||(t=(null!=(c=e.location)?c.search:void 0)||""),l={},o=0,a=(h=t.replace(/^\?/,"").split("&")).length;o<a;o++)(i=(u=h[o]).indexOf("="))>=0?(s=u.slice(0,i),p=u.slice(i+1),s.length>0&&(l[s]=decodeURIComponent(p))):l[u]=!0;return r&&(n=l),l},ParseUrl.generateQuery=t=function(t){var e,n;return function(){var i;for(e in i=[],t)null!=(n=t[e])&&i.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return i}().join("&")},ParseUrl.urlJoin=function(){var t,e,n;return n=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],n.replace(/\/$/,"")+"/"+function(){var n,r,o,s;for(s=[],n=0,r=(o=i(e)).length;n<r;n++)t=o[n],s.push(t.replace(/^\/|\/$/g,""));return s}().join("/")},ParseUrl.appendQuery=function(e,n){var i;return null!=n&&(i=t(n)).length>0?e+(e.match(/\?/)?"&":"?")+i:e},ParseUrl.parseUrl=function(t){var e,n,i,r,o,s,a,l,u,c,h,p,d;if(s=t.match(/(([A-Za-z]+):(\/\/)?)?(([\-;&=\+\$,\w]+)(:([\-;:&=\+\$,\w]+))?@)?([A-Za-z0-9\.\-]+)(:([0-9]+))?(\/[\+~%\/\.\w\-]*)?(\?([\-\+=&;%@\.\w,]*))?(\#([\.\!\/\\\w]*))?/))return s[0],s[1],h=s[2],s[3],s[4],d=s[5],s[6],a=s[7],r=s[8],s[9],c=s[10],u=s[11],s[12],p=s[13],s[14],n=s[15],u&&(i=(e=u.split("/"))[e.length-1],l=e.slice(0,e.length-1).join("/")),o=r=r.toLowerCase(),c&&(o+=":"+c),{protocol:h,username:d,password:a,hostWithPort:o,host:r,port:c,pathName:u,path:l,fileName:i,query:p&&ParseUrl.parseQuery(p),anchor:n}},ParseUrl}()}).call(this,n(5))},function(t,e){t.exports=function(){var t,e,n,i;function RegExpExtensions(){}for(t in RegExpExtensions.escapeRegExp=function(t){var e;return null!=(e=null!=t&&"function"==typeof t.replace?t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):void 0)?e:""},RegExpExtensions.findUrlProtocolRegExp=/([\w-]+)(:\/\/)/,RegExpExtensions.findDomainRegExp=/localhost|[\w]+(?:-[\w]+)*(?:\.[\w]+(?:-[\w]+)*)*(?:\.[a-z]{2,20})/,RegExpExtensions.urlQueryParamsRegExp=/(?:[-+=&*._\w]|%[a-f\d]{2})*(?!\.)(?:[-+=&*._\w]|%[a-f\d]{2})/i,RegExpExtensions.findLegalUrlCharacterRegExp=/[-._~!$&'()*+,;=:@\w]|%[a-f\d]{2}/,RegExpExtensions.findUrlPathRegExp=RegExp("(?:\\/(?:(?:"+RegExpExtensions.findLegalUrlCharacterRegExp.source+")*(?!\\.)(?:"+RegExpExtensions.findLegalUrlCharacterRegExp.source+"))?)*"),RegExpExtensions.findUrlPortRegExp=/(\:)(\d+)/,RegExpExtensions.findUrlFragmentRegExp=RegExp("(\\#)((?:(?:\\?|"+RegExpExtensions.findLegalUrlCharacterRegExp.source+")*(?!\\.)"+RegExpExtensions.findLegalUrlCharacterRegExp.source+"|))"),RegExpExtensions.findEmailLocalRegExp=/((?:[^:@<>\s\n"\\]|\\.)+|"(?:[^@"\\]|\\.)*")/,RegExpExtensions.findEmailRegExp=RegExp(RegExpExtensions.findEmailLocalRegExp.source+"@([^@:?\\s\\n<>.]+\\.[^@:?\\s\\n<>]*[^@:?\\s\\n<>.])","i"),RegExpExtensions.emailRegExp=RegExp("^"+RegExpExtensions.findEmailRegExp.source+"$","i"),RegExpExtensions.numberRegExp=/([-]?\.[0-9]+)|([-]?[0-9]+(\.[0-9]+)?)/,RegExpExtensions.urlProtocolRegExp=RegExp("^"+RegExpExtensions.findUrlProtocolRegExp.source+"$","i"),RegExpExtensions.domainRegExp=RegExp("^"+RegExpExtensions.findDomainRegExp.source+"$","i"),RegExpExtensions.urlPathRegExp=RegExp("^"+RegExpExtensions.findUrlPathRegExp.source+"$","i"),RegExpExtensions.urlQueryRegExp=RegExp("^"+RegExpExtensions.urlQueryParamsRegExp.source+"$","i"),RegExpExtensions.isoDateRegExp=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,RegExpExtensions.hex16GreyColorRegExp=/^#([a-f0-9])$/i,RegExpExtensions.hex256GreyColorRegExp=/^#([a-f0-9]{2})$/i,RegExpExtensions.hex16ColorRegExp=/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,RegExpExtensions.hex256ColorRegExp=/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,RegExpExtensions.rgbColorRegExp=/rgb *\( *(\d+%?) *, *(\d+%?) *, *(\d+%?) *\)/,RegExpExtensions.rgbaColorRegExp=/rgba *\( *(\d+%?) *, *(\d+%?) *, *(\d+%?) *, *(\d*\.?\d*)\)/,RegExpExtensions.findColorRegExp=RegExp("("+RegExpExtensions.hex16GreyColorRegExp.source+")|("+RegExpExtensions.hex256GreyColorRegExp.source+")|("+RegExpExtensions.hex16ColorRegExp.source+")|("+RegExpExtensions.hex256ColorRegExp.source+")|("+RegExpExtensions.rgbColorRegExp.source+")|("+RegExpExtensions.rgbaColorRegExp.source+")","i"),RegExpExtensions.colorRegExp=RegExp("^"+RegExpExtensions.findColorRegExp.source+"$"),RegExpExtensions.wordsRegExp=/[^\s]+/g,RegExpExtensions.exactlyOneWordRegExp=/^[^\s]+$/,RegExpExtensions.findUrlOrigin=RegExp("(?:"+RegExpExtensions.findUrlProtocolRegExp.source+")("+RegExpExtensions.findDomainRegExp.source+")?(?:"+RegExpExtensions.findUrlPortRegExp.source+")?","i"),RegExpExtensions.findUrlRegExp=RegExp(RegExpExtensions.findUrlOrigin.source+"("+RegExpExtensions.findUrlPathRegExp.source+")?(?:(\\?)("+RegExpExtensions.urlQueryParamsRegExp.source+")?)?(?:"+RegExpExtensions.findUrlFragmentRegExp.source+")?","i"),RegExpExtensions.findUrlWithOptionalProtocolRegExp=RegExp("(?:"+RegExpExtensions.findUrlProtocolRegExp.source+")?("+RegExpExtensions.findDomainRegExp.source+")(?:"+RegExpExtensions.findUrlPortRegExp.source+")?("+RegExpExtensions.findUrlPathRegExp.source+")?(?:(\\?)("+RegExpExtensions.urlQueryParamsRegExp.source+")?)?(?:"+RegExpExtensions.findUrlFragmentRegExp.source+")?","i"),RegExpExtensions.findAllUrlsRegExp=RegExp(""+RegExpExtensions.findUrlRegExp.source,"ig"),RegExpExtensions.findAllUrlsWithOptionalProtocolRegExp=RegExp(""+RegExpExtensions.findUrlWithOptionalProtocolRegExp.source,"ig"),RegExpExtensions.findSourceReferenceUrlRegExp=RegExp(RegExpExtensions.findUrlOrigin.source+"("+RegExpExtensions.findUrlPathRegExp.source+")?(?:(\\?)("+RegExpExtensions.urlQueryParamsRegExp.source+")?)?(?:\\:(\\d+))?(?:\\:(\\d+))?","i"),RegExpExtensions.urlRegExp=RegExp("^"+RegExpExtensions.findUrlRegExp.source+"$","i"),RegExpExtensions.urlWithOptionalProtocolRegExp=RegExp("^"+RegExpExtensions.findUrlWithOptionalProtocolRegExp.source+"$","i"),n=RegExpExtensions)i=n[t],/RegExp$/.test(t)&&(RegExpExtensions[t.replace(/RegExp/,"Regexp")]=i,RegExpExtensions[t.replace(/RegExp/,"Regex")]=i);return e=function(t){return t.toLocaleLowerCase()},RegExpExtensions.normalizeUrl=function(t){var n;return(t=0===(null!=(n=RegExpExtensions.findUrlProtocolRegExp.exec(t))?n.index:void 0)?t:"http://"+t).replace(RegExpExtensions.findDomainRegExp,e).replace(RegExpExtensions.findUrlProtocolRegExp,e)},RegExpExtensions}()},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;e=n(51).defineModule,i=n(56).formattedInspect,s=n(29),o=s.mergeInto,r=s.isFunction,e(t,function(t){function ErrorWithInfo(t,e,n){this.info=e,this.name=n,ErrorWithInfo.__super__.constructor.apply(this,arguments),this.name||(this.name="ErrorWithInfo"),o(this,this.info),this.message=t,r(Error.captureStackTrace)?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ErrorWithInfo,Error),ErrorWithInfo.prototype.toString=function(){return["ErrorWithInfo: "+this.message,i({info:this.info})].join("\n\n")},ErrorWithInfo}())}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(33)).includeInNamespace(n(57)).addModules({FormattedInspect:n(66),InspectedObjectLiteral:n(70),InspectedObjects:n(69),Inspector:n(58),Inspector2:n(75),PlainObjects:n(74)}),n(76)},function(t,e,n){t.exports=[[n(58),"shallowInspect inspectLean inspect"],n(66),n(69),n(74),n(70)]},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c,h,p,d,f,m=function(t,e){return function(){return t.apply(e,arguments)}};i=n(59),r=n(62).escapeJavascriptString,f=n(50),d=f.objectName,p=f.isString,o=f.isArray,l=f.isFunction,u=f.isObject,a=f.isClass,s=f.isBrowserObject,h=f.isPlainObject,c=f.isPlainArray,t.exports=function(){var t;function Inspector(t){null==t&&(t={}),this.inspect=m(this.inspect,this),this.inspectInternal=m(this.inspectInternal,this),this.inspectObject=m(this.inspectObject,this),this.inspectArray=m(this.inspectArray,this),this.maxLength=t.maxLength||1e4,this.allowCustomInspectors=!t.noCustomInspectors,this.maxDepth=null!=t.maxDepth?t.maxDepth:10,this.outArray=[],this.length=0,this.depth=0,this.inspectingMap=new i,this.done=!1}return Inspector.unquotablePropertyRegex=/^([0-9]+|[_a-zA-Z][_0-9a-zA-Z]*)$/,Inspector.customInspectable=function(t){return t.inspect&&!("function"==typeof t)},Inspector.parentString=function(t){switch(t){case 0:return"parent";case 1:return"grandparent";case 2:return"great grandparent";default:return"great^"+(t-1)+" grandparent"}},Inspector.inspect=t=function(t,n){var i;return null==n&&(n={}),this&&this!==e?Neptune.Base.inspect.call(this):((i=new Inspector(n)).inspect(t),i.getResult())},Inspector.shallowInspect=function(t){return null==t?""+t:Inspector.customInspectable(t)?Inspector.inspect(t):p(t)?r(t):o(t)?"<<Array length: "+t.length+">>":l(t)&&""===t.name?"<<function args: "+t.length+">>":"<<"+typeof t+": "+(t.name||t)+">>"},Inspector.inspectLean=function(e,n){var i,r;return i=t(e,n),!l(null!=e?e.inspect:void 0)&&(h(e)||c(e)&&(e.length>1||(null!=n?n.forArgs:void 0)))&&(r=i.match(/^\[(.+)\]$|^\{(.+)\}$/))?r[1]||r[2]||r[3]:i},Inspector.prototype.put=function(t){var e;if(!this.done)return this.length+t.length>this.maxLength&&(this.done=!0,e=this.maxLength-this.length,t=t.slice(0,e)+"<... first "+e+"/"+t.length+">"),this.length+=t.length,this.outArray.push(t),t},Inspector.prototype.getResult=function(){return this.outArray.join("")},Inspector.prototype.maxDepthOutput=function(t){var e,n;switch(typeof t){case"string":case"number":case"boolean":case"undefined":return this.inspectInternal(t);case"function":return this.put(d(t));case"object":return this.put(null===t?"null":o(t)?"["+t.length+" elements]":(e=Object.keys(t),"Object"===(n=d(t))?"{"+e.length+" keys}":e.length>0?"{"+n+" "+e.length+" keys}":n))}},Inspector.prototype.inspectArray=function(t){var e,n,i,r;for(this.put("["),e=!0,n=0,i=t.length;n<i;n++)r=t[n],e||this.put(", "),this.inspect(r),e=!1;return this.put("]")},Inspector.prototype.inspectObject=function(t){var e,n,i,r,o,a,u;if([],r=Object.keys(t),a=d(t),l(t)&&0===r.length)return this.put(a+"()");if(s(t))return this.put("{"+a+"}");for(this.put("{"),t.constructor!==Object&&this.put(a+" "),e=!0,n=0,o=r.length;n<o;n++)"__uniqueId"!==(i=r[n])&&(e||this.put(", "),u=t[i],Inspector.unquotablePropertyRegex.test(i)?this.put(i):this.inspect(i),this.put(": "),this.inspect(u),e=!1);return this.put("}")},Inspector.prototype.inspectInternal=function(t){return null==t?this.put(""+t):p(t)?this.put(r(t)):o(t)?this.inspectArray(t):a(t)?this.put(d(t)):this.allowCustomInspectors&&Inspector.customInspectable(t)?t.inspect.length>0?t.inspect(this):this.put(t.inspect()):t instanceof RegExp?this.put(""+t):u(t)||l(t)?this.inspectObject(t):l(null!=t?t.toString:void 0)?this.put(t.toString()):this.put(""+t)},Inspector.prototype.inspect=function(t){var e;if(!this.done)return(e=this.inspectingMap.get(t))?(this.put("<"+Inspector.parentString(this.depth-e)+">"),null):(this.depth>=this.maxDepth?this.maxDepthOutput(t):(this.depth++,this.inspectingMap.set(t,this.depth),this.inspectInternal(t),this.inspectingMap.delete(t),this.depth--),null)},Inspector}()}).call(this,n(5))},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c={}.hasOwnProperty;s=n(60),r=n(61),l=n(29).isFunction,o=function(){function Node(t,e,n,i){this.key=t,this.value=e,this.prev=n||null,this.next=i||null,n&&(n.next=this),i&&(i.prev=this)}return Node.prototype.remove=function(){var t,e;if(t=this.next,(e=this.prev)&&(e.next=t,this.prev=null),t)return t.prev=e,this.next=null},Node}(),i=function(){function KeysIterator(t){this.node=t,this.started=!1}return KeysIterator.prototype.next=function(){var t,e;return this.node=this.started?null!=(t=this.node)?t.next:void 0:(this.started=!0,this.node),{done:!this.node,value:null!=(e=this.node)?e.key:void 0}},KeysIterator}(),a=function(){function ValuesIterator(t){this.node=t,this.started=!1}return ValuesIterator.prototype.next=function(){var t,e;return this.node=this.started?null!=(t=this.node)?t.next:void 0:(this.started=!0,this.node),{done:!this.node,value:null!=(e=this.node)?e.value:void 0}},ValuesIterator}(),t.exports=l(e.Map)&&(u=new e.Map).set(1,2)===u?e.Map:function(t){function Map(){this._length=0,this._map={},this._first=this._last=null}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Map,r),Map.getter({size:function(){return this._length}}),Map.prototype._getNodes=function(){var t,e;for(e=[],t=this._first;t;)e.push(t),t=t.next;return e},Map.prototype.keys=function(){return new i(this._first)},Map.prototype.values=function(){return new a(this._first)},Map.prototype.get=function(t){var e;return(e=this._map[s.id(t)])&&e.value},Map.prototype.set=function(t,e){var n;return n=s.id(t),this._map[n]?this._map[n].value=e:(this._length++,this._last=this._map[n]=new o(t,e,this._last),this._first||(this._first=this._last)),this},Map.prototype._remove=function(t){var e,n;return e=s.id(t),(n=this._map[e])?(this._length--,delete this._map[e],this._first===n&&(this._first=n.next),this._last===n&&(this._last=n.prev),n.remove(),n):void 0},Map.prototype.delete=function(t){return!!this._remove(t)},Map.prototype.forEach=function(t){var e,n,i,r;for(e=0,n=(r=this._getNodes()).length;e<n;e++)t((i=r[e]).value,i.key,this)},Map.prototype.has=function(t){return!!this._map[s.id(t)]},Map}()}).call(this,n(5))},function(t,e){var n;n=1,t.exports=function(){var t,e;function Unique(){}return Unique.nextUniqueObjectId=t=function(){return"object_"+n++},Unique.objectId=e=function(e){return e.hasOwnProperty("__uniqueId")?e.__uniqueId||(e.__uniqueId=t()):(Object.defineProperty(e,"__uniqueId",{enumerable:!1,value:t()}),e.__uniqueId)},Unique.id=function(t){return"object"==typeof t||"function"==typeof t?t?"function"==typeof t.getUniqueId?t.getUniqueId():e(t):"null":"number"==typeof t?""+t:"symbol"==typeof t?t.toString():"string"==typeof t?"string_"+t:"boolean"==typeof t?t?"true":"false":void 0===t?"undefined":typeof t+"_"+t},Unique}()},function(t,e,n){var i,r,o,s,a;i=n(29).capitalize,a=n(50),r=a.isFunction,s=a.isString,o=a.isPlainObject,t.exports=function(){var t,e,n,a,l,u,c,h,p,d,f;function MinimalBaseObject(){}return MinimalBaseObject.propInternalName=p=function(t){return"_"+t},MinimalBaseObject.getter=function(){return u(this.prototype,arguments,!0,!1)},MinimalBaseObject.setter=function(){return u(this.prototype,arguments,!1,!0)},MinimalBaseObject.addGetter=function(t,e){return this._addGetter(this.prototype,t,e)},MinimalBaseObject.addSetter=function(t,e){return this._addSetter(this.prototype,t,e)},MinimalBaseObject.addClassGetter=function(t,e){return this._addGetter(this,t,e)},MinimalBaseObject.addClassSetter=function(t,e){return this._addSetter(this,t,e)},MinimalBaseObject.property=function(){return u(this.prototype,arguments,!0,!0)},MinimalBaseObject.classGetter=function(){return u(this,arguments,!0,!1)},MinimalBaseObject.classSetter=function(){return u(this,arguments,!1,!0)},MinimalBaseObject.classProperty=function(){return u(this,arguments,!0,!0)},MinimalBaseObject.getPropGetterName=h=function(t){return"get"+i(t)},MinimalBaseObject.getPropSetterName=f=function(t){return"set"+i(t)},MinimalBaseObject._propGetterName=function(t){return console.warn("DEPRICATED - use getPropGetterName"),h(t)},MinimalBaseObject._propSetterName=function(t){return console.warn("DEPRICATED - use getPropSetterName"),f(t)},MinimalBaseObject._addGetter=t=function(t,e,n){return t[h(e)]=n,r(n)||(n=function(){return n}),Object.defineProperty(t,e,{get:n,configurable:!0}),e},MinimalBaseObject._addSetter=a=function(t,e,n){return t[f(e)]=n,Object.defineProperty(t,e,{set:n,configurable:!0}),e},MinimalBaseObject._addGetters=e=function(e,n){var i,r;for(r in n)i=n[r],t(e,r,i);return n},MinimalBaseObject._addSetters=l=function(t,e){var n,i;for(n in e)i=e[n],a(t,n,i);return e},MinimalBaseObject._addProperties=n=function(t,e){var n,i;for(i in e)n=e[i],c(t,i,!0,!0,n);return e},MinimalBaseObject._defProperty=c=function(e,n,i,o,s){var l;if(l=p(n),i&&t(e,n,e[h(n)]=r(s)?function(){return null!=this[l]?this[l]:this[l]=s()}:null!=s?function(){return null!=this[l]?this[l]:this[l]=s}:function(){return this[l]}),o)return a(e,n,function(t){return this[l]=t})},MinimalBaseObject._defProperties=u=function(t,i,r,a){var u,h,p,f,m,g;for(g=[],u=0,h=i.length;u<h;u++)if(p=i[u],o(m=p))r&&a?g.push(n(t,m)):r?g.push(e(t,m)):g.push(l(t,m));else{if(!s(p))throw new Error("invalid value. Expected string or plain-object:",p);g.push(function(){var e,n,i,o;for(o=[],e=0,n=(i=d(p)).length;e<n;e++)f=i[e],o.push(c(t,f,r,a,null));return o}())}return g},MinimalBaseObject._propListStringToArray=d=function(t){return t.match(/[_a-z][_a-z0-9]*/gi)},MinimalBaseObject}()},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c,h,p,d,f;i=n(63),r=n(50),n(54).wordsRegex,l=i.intRand,d=r.isString,h=r.isNumber,p=r.isPlainObject,u=r.isArray,f=r.stringIsPresent,o=n(29).compactFlatten,c=n(52).isBrowser,s=/[\\]["]/g,a=Math.floor,t.exports=function(){var t,i,r,m,g,y,v,S,b,w,x;function StringExtensions(){}return StringExtensions.compactFlattenJoin=function(t,e){var n,i;return n=null,i=d(t)?(n=e,t):(n=t,e||""),o(n).join(i)},StringExtensions.base62Characters=t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",StringExtensions.fastHash=function(t){var e,n,i,r;if(e=2147483647,t.length>0)for(n=i=0,r=t.length;0<=r?i<r:i>r;n=0<=r?++i:--i)e=(e<<5)-e+t.charCodeAt(n)&(1<<31)-1;return e},StringExtensions.randomString=S=function(e,n,i){var r,o;return null==e&&(e=32),null==n&&(n=t),"",r=n.length,i?function(){var t,s,a;for(a=[],o=t=0,s=e;t<s;o=t+=1)a.push(n[i[o]%r]);return a}().join(""):function(){var t,i,s;for(s=[],o=t=0,i=e;t<i;o=t+=1)s.push(n[l(r)]);return s}().join("")},StringExtensions.cryptoRandomString=c?(r=e.crypto)?function(t,e){return null==t&&(t=16),S(t,e,r.getRandomValues(new Uint8Array(t)))}:(console.warn("window.crypto not available, using standard random for cryptoRandomString"),function(t,e){return null==t&&(t=16),S(t,e)}):(r=n(64),function(t,e){return S(t,e,r.randomBytes(t))}),StringExtensions.randomBase62Character=function(){return t[l(62)]},b=y=n(65),StringExtensions.plural=b.plural,StringExtensions.singular=b.singular,StringExtensions.isSingular=b.isSingular,StringExtensions.isPlural=b.isPlural,StringExtensions.addPluralizeRule=b.addIrregularRule,v=function(t,e,n){var i,r,o;return(r=/^(.*)(_|[^\w])+$/.exec(t))&&(r[0],t=r[1],i=r[2]),o=y(t,e,n),i?o+i:o},StringExtensions.pluralize=function(t,e,n){var i,r;if(i=null!=e&&h(e)?(r=t,e):h(t)?(r=e,t):(r=f(t)?t:f(e)?e:void 0,null),!d(r)||n&&!d(n))throw new Error("singleForm and pluralForm(optional) should be non-empty strings (inputs: "+Neptune.Art.StandardLib.formattedInspect({a:t,b:e,pluralForm:n})+")");return function(){switch(!1){case null==n:return i+" "+(1===i?r:n);case null==i:return v(r,i,!0);default:return v(r)}}()},StringExtensions.replaceLast=function(t,e,n){var i;return(i=t.lastIndexOf(e))>=0?t.substring(0,i)+n+t.substring(i+e.length):t.toString()},StringExtensions.getPadding=m=function(t,e){var n,i,r;for(null==e&&(e=" "),i="",n=0,r=t;0<=r?n<r:n>r;0<=r?++n:--n)i+=e;return i},StringExtensions.pad=function(t,e,n,i){var r;return(t=String(t)).length>=e?t:(r=m(Math.max(e-t.length,0),n),i?r+t:t+r)},StringExtensions.escapeDoubleQuoteJavascriptString=function(t){return console.warn("DEPRICATED: escapeDoubleQuoteJavascriptString. USE: escapeJavascriptString"),'"'+String(t).replace(/[\\"]/g,"\\$&").replace(/[\0\b\f\n\r\t\v\u2028\u2029]/g,function(t){switch(t){case"\0":return"\\0";case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t";case"\v":return"\\v";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029"}})+'"'},StringExtensions.escapeJavascriptString=function(t,e){var n;return n=JSON.stringify(t),e?n.slice(1,-1):n.match(s)?"'"+n.replace(s,'"').replace(/'/g,"\\'").slice(1,-1)+"'":n},StringExtensions.allIndexes=function(t,e){var n,i;if(n=[],!(e instanceof RegExp&&e.global))throw new Error("regex must be a global RegExp");for(e.lastIndex=0;i=e.exec(t);)n.push(i.index),i;return n},StringExtensions.repeat=w=" ".repeat?function(t,e){return t.repeat(e)}:function(t,e){var n;if(a(e),n="",e>0&&t.length>0)for(;1==(1&e)&&(n+=t),0!=(e>>>=1);)t+=t;return n},StringExtensions.rightAlign=function(t,e){return t.length>=e?t:w(" ",e-t.length)+t},StringExtensions.eachMatch=function(t,e,n){var i;for(e.lastIndex=0;i=e.exec(t);)n(i);return null},x={joiner:", ",openObject:"{",openArray:"[",closeObject:"}",closeArray:"]"},StringExtensions.jsStringify=function(t){return g(t,"")},g=function(t,e){var n,i,r,o,s,a;if(p(t)){for(o in e+="{",i=!0,t)a=t[o],i?i=!1:e+=",",/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(o)?e+=o:e+=JSON.stringify(o),e=g(a,e+=":");return e+"}"}if(u(t)){for(e+="[",i=!0,r=0,s=t.length;r<s;r++)n=t[r],i?i=!1:e+=",",e=g(n,e);return e+"]"}return e+JSON.stringify(t)},StringExtensions.consistentJsonStringify=i=function(t,e){var n,r,o,s,a,l,c,f,m,g,y;return function(){var v;if(!1===t||!0===t||null===t||h(t))return""+t;if(d(t))return JSON.stringify(t);if(s=e?"string"==typeof e?{joiner:",\n"+e,openObject:"{\n"+e,openArray:"[\n"+e,closeObject:"\n}",closeArray:"\n]",totalIndent:e,indent:e}:{totalIndent:g=e.indent+(c=e.totalIndent),joiner:",\n"+g,openObject:"{\n"+g,openArray:"[\n"+g,closeObject:"\n"+c+"}",closeArray:"\n"+c+"]",indent:e.indent}:void 0,a=(v=s||x).joiner,m=v.openObject,f=v.openArray,r=v.closeObject,n=v.closeArray,p(t))return m+function(){var e,n,r,o;for(o=[],e=0,n=(r=Object.keys(t).sort()).length;e<n;e++)l=r[e],void 0!==t[l]&&o.push(JSON.stringify(l)+": "+i(t[l],s));return o}().join(a)+r;if(u(t))return f+function(){var e,n,r;for(r=[],e=0,n=t.length;e<n;e++)y=t[e],r.push(i(y,s));return r}().join(a)+n;throw Neptune.Art.StandardLib.log.error(o="invalid object type for Json. Expecting: null, false, true, number, string, plain-object or array",t),new Error(o)}()},StringExtensions.splitRuns=function(t){var e,n,i,r,o,s,a;if(0===t.length)return[];for(o=t[0],n=1,a=[],i=r=1,s=t.length;r<s;i=r+=1)(e=t[i])===o?n++:(a.push([o,n]),n=1),o=e;return a.push([o,n]),a},StringExtensions.eachRunAsCharCodes=function(t,e){var n,i,r,o,s,a;for(s=t.charCodeAt(0),i=1,r=o=1,a=t.length;o<a;r=o+=1)(n=t.charCodeAt(r))===s?i++:(e(s,i),i=1),s=n;return e(s,i),null},StringExtensions.humanFriendlyShorten=function(t,e){var n,i,r,o,s,a;if(!(e>0))throw new error("maxLength must be > 0");if(!((t=t.trim()).length>e))return t;for(r=e/2,s="",n=0,i=(a=t.split(/\s+/)).length;n<i;n++)if(o=a[n],0===s.length)s=o;else{if(!(s.length<r||s.length+o.length+2<=e))break;s+=" "+o}return s.length>e&&(s=s.slice(0,e-1).trim()),s+""},StringExtensions.stripTrailingWhitespace=function(t){return t.split(/[ ]*\n/).join("\n").split(/[ ]*$/)[0].replace(/\n+$/,"")},StringExtensions}()}).call(this,n(5))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d;i=n(54),u=i.numberRegexp,p=self.Math,r=p.abs,l=p.min,a=p.max,o=p.ceil,s=p.floor,d=p.round,h=p.random,c=p.pow,null==Math.log2&&(Math.log2=function(t){return Math.log(t)/Math.LOG2E}),null!=Math.log10?Math.log10:Math.log10=function(t){return Math.log(t)/Math.log(10)},t.exports=function(){var t,e,n;function MathExtensions(){}return MathExtensions.nearInfinity=c(10,100),MathExtensions.nearInfinityResult=c(10,50),MathExtensions.float32Precision=4e-7,MathExtensions.float64Precision=4e-16,MathExtensions.modulo=function(t,e){var n;return(n=t%e)<0?n+e:n},MathExtensions.stringToNumberArray=function(t){var e,n,i,r,o;for(n=i=0,r=(e=t.split(",")).length;i<r;n=++i)o=e[n].match(u),e[n]=null!=o?o[0]-0:0;return e},MathExtensions.numberToTightString=function(t,e){var n;return null==e&&(e=16),n=t.toPrecision(e),/e/.test(n)?n.replace(/([0-9]+(\.[0-9]+[1-9])?)\.?0+e/,"$1e"):n.replace(/([0-9]+(\.[0-9]+[1-9])?)\.?0+$/,"$1")},MathExtensions.minMagnitude=function(t,e){return t<0?l(t,-e):a(t,e)},MathExtensions.maxMagnitude=function(e,n){return t(-n,e,n)},MathExtensions.maxChange=function(e,n,i){return t(n-i,e,n+i)},MathExtensions.bound=t=function(t,e,n){return isNaN(e)?t:e<t?t:e>n?n:e},MathExtensions.absGt=function(t,e){return r(t)>r(e)},MathExtensions.absLt=function(t,e){return r(t)<r(e)},MathExtensions.absGte=function(t,e){return r(t)>=r(e)},MathExtensions.absLte=function(t,e){return r(t)<=r(e)},MathExtensions.abs=r,MathExtensions.min=l,MathExtensions.max=a,MathExtensions.ceil=function(t,e){return null==e&&(e=1),o(t/e)*e},MathExtensions.floor=function(t,e){return null==e&&(e=1),s(t/e)*e},MathExtensions.round=function(t,e){return null==e&&(e=1),d(t/e)*e},MathExtensions.simplifyNum=function(t){return 4e-16*d(25e14*t)},MathExtensions.floatEq=n=function(t,e){return t===e||r(t-e)<4e-16||t*e>0&&((t=r(t))*(1+4e-16)>(e=r(e))&&e*(1+4e-16)>t)},MathExtensions.floatGte=function(t,e){return t>=e||n(t,e)},MathExtensions.floatLte=function(t,e){return t<=e||n(t,e)},MathExtensions.floatGt=function(t,e){return t>e&&!n(t,e)},MathExtensions.floatLt=function(t,e){return t<e&&!n(t,e)},MathExtensions.float32Eq=e=function(t,e){return t===e||r(t-e)<4e-7||(t=Math.abs(t))*(1+4e-7)>(e=Math.abs(e))&&e*(1+4e-7)>t},MathExtensions.float32Gte=function(t,n){return t>=n||e(t,n)},MathExtensions.float32Lte=function(t,n){return t<=n||e(t,n)},MathExtensions.float32Gt=function(t,n){return t>n&&!e(t,n)},MathExtensions.float32Lt=function(t,n){return t<n&&!e(t,n)},MathExtensions.floatEq0=function(t){return 0===t||4e-16>r(t)},MathExtensions.float32Eq0=function(t){return 0===t||4e-7>r(t)},MathExtensions.floatTrue0=function(t){return 0===t||4e-16>r(t)?0:t},MathExtensions.float32True0=function(t){return 0===t||4e-7>r(t)?0:t},MathExtensions.random=h,MathExtensions.intRand=function(t){return h()*t|0},MathExtensions.boolRand=function(){return h()<.5},MathExtensions.iPart=function(t){return t-t%1},MathExtensions.fPart=function(t){return t%1},MathExtensions.commaize=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},MathExtensions.cyclingSequenceFunction=function(t){var e;return e=t.length,function(){return++e>=t.length&&(e=0),t[e]}},MathExtensions.seededRandomNumberGenerator=function(t){var e;return null==t&&(t=Math.random()),e=Math.floor(2330089441*Math.abs(t)+1),function(){return(e=48271*e%2147483647)/2147483648}},MathExtensions}()},function(t,e){t.exports={}},function(t,e,n){t.exports=function(){var t=[],e=[],n={},i={},r={};function sanitizeRule(t){return"string"==typeof t?new RegExp("^"+t+"$","i"):t}function restoreCase(t,e){return t===e?e:t===t.toLowerCase()?e.toLowerCase():t===t.toUpperCase()?e.toUpperCase():t[0]===t[0].toUpperCase()?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():e.toLowerCase()}function replace(t,e){return t.replace(e[0],function(n,i){var r=function interpolate(t,e){return t.replace(/\$(\d{1,2})/g,function(t,n){return e[n]||""})}(e[1],arguments);return restoreCase(""===n?t[i-1]:n,r)})}function sanitizeWord(t,e,i){if(!t.length||n.hasOwnProperty(t))return e;for(var r=i.length;r--;){var o=i[r];if(o[0].test(e))return replace(e,o)}return e}function replaceWord(t,e,n){return function(i){var r=i.toLowerCase();return e.hasOwnProperty(r)?restoreCase(i,r):t.hasOwnProperty(r)?restoreCase(i,t[r]):sanitizeWord(r,i,n)}}function checkWord(t,e,n,i){return function(i){var r=i.toLowerCase();return!!e.hasOwnProperty(r)||!t.hasOwnProperty(r)&&sanitizeWord(r,r,n)===r}}function pluralize(t,e,n){var i=1===e?pluralize.singular(t):pluralize.plural(t);return(n?e+" ":"")+i}return pluralize.plural=replaceWord(r,i,t),pluralize.isPlural=checkWord(r,i,t),pluralize.singular=replaceWord(i,r,e),pluralize.isSingular=checkWord(i,r,e),pluralize.addPluralRule=function(e,n){t.push([sanitizeRule(e),n])},pluralize.addSingularRule=function(t,n){e.push([sanitizeRule(t),n])},pluralize.addUncountableRule=function(t){"string"!=typeof t?(pluralize.addPluralRule(t,"$0"),pluralize.addSingularRule(t,"$0")):n[t.toLowerCase()]=!0},pluralize.addIrregularRule=function(t,e){e=e.toLowerCase(),t=t.toLowerCase(),r[t]=e,i[e]=t},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach(function(t){return pluralize.addIrregularRule(t[0],t[1])}),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach(function(t){return pluralize.addPluralRule(t[0],t[1])}),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach(function(t){return pluralize.addSingularRule(t[0],t[1])}),["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","species","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[e]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(pluralize.addUncountableRule),pluralize}()},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z;A=n(50),x=A.isString,T=A.objectName,w=A.isPlainObject,b=A.isPlainArray,P=A.isTypedArray,A.isFunction,S=A.isNumber,C=Math.max,F=n(62),k=F.pad,F.stripTrailingWhitespace,c=F.escapeJavascriptString,y=n(58).inspect,E=n(67).objectKeyCount,R=n(69).toInspectedObjects,z=n(72).w,_=n(68).object,g="  ".length,p=function(t,e,n){var i,r,s,a,l,u,c,h,p,f,m,v;return i=n.colorize,a=0,r=!1,f=!1,h=0,l=function(){var i;for(c in i=[],t)v=t[c],h++,(s=d(v,e-g,n)).match(/\n/)?(s=s.match(/^\[\]/)?""+s:"\n  "+s.replace(/\n/g,"\n  "),/\n\s*$/.test(s)||(s+="\n")):o(s)>e-(c.length+2)&&(s="\n  "+s+"\n"),/^[-~!@\#$%^&*_+=|\\<>?\/.$\w\u007f-\uffff]+$/.test(c)||(c=y(c)),a+=o(s)+c.length+2,r||(r=f),f=s.length>100||!s.match(/^([^,:]|\(.*\)|\{.*\}|\".*\"|\'.*\'|\[.*\])*$/),i.push([c,s,v]);return i}(),p="{}",p=i.grey(p),0===h?p:(0,function(){var t,e,n,r;for(r=[],t=0,e=l.length;t<e;t++)n=l[t],u=n[0],m=n[1],v=n[2],c=u+":",c=i.blue(c),r.push(c+"\t"+m);return r}().join(!r&&e>=a+2*(l.length-1)?",\t":"\n"))},h=function(t,e,n){var i,r,s,a,l,u,c,h,p,f,m,y,S,b,x,C,_,k;for(r=n.colorize,y=0,p=!1,h=!1,S=n.maxArrayLength||100,x=!1,C=!0,!1,s=c=0,f=t.length;c<f;s=++c)k=t[s],w(k)?(s<t.length-1&&(C=!1),p&&(x=!0),p=!0):p=!1;return m=2*((u=function(){var i,s,u,c;for(c=[],i=0,s=(u=t.slice(0,S)).length;i<s;i++)k=u[i],h&&(C=!1),v(k)&&(h=!0),a=d(k,e-g,n),l=/\n/.test(a),x&&w(k)&&E(k)>0&&(b="{}",b=r.grey(b),a=l?b+"\n  "+a.replace(/\n/g,"\n  "):b+" "+a),l&&(C=!1,a=a.replace(/\n/g,"\n  "),/\n\s*$/.test(a)||(a+="\n")),y+=o(a),c.push(a);return c}()).length-1),3,i=P(t)?"{"+T(t)+"}":"[]",t.length>S&&(i+=" <length: "+t.length+">",_="..."),i=r.grey(i),C&&e>=3+m+y?0===u.length?i:i+" "+u.join(",\t")+(null!=_?_:""):i+"\n  "+u.join("\n  ")+(_?"\n  "+_:"")},u=function(t){return String(t).replace(/[\\\0\b\f\r\t\v\u001b\u2028\u2029]/g,function(t){switch(t){case"\\":return"\\\\";case"\0":return"\\0";case"\b":return"\\b";case"\f":return"\\f";case"\r":return"\\r";case"\t":return"\\t";case"\v":return"\\v";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";case"":return"\\u001b"}}).replace(/^[\n ]+|[\n ]+$|[ ]+(?=\n)/g,function(t){return c(t,!0).replace(/\ /g,"\\s")})},s=/^(?=[^'":])([^\#\s\0-\x20\x7f;,()[\]{}\\]|\#([^{]|$))+$/,f=function(t,e){var n;return n=function(){switch(!1){case!s.test(t):return":"+t;case!/[^\n\s].*\n(.|\n)*[^\n\s]/.test(t):return('"""\n  '+u(t).replace(/\n/g,"\n  ")).replace(/\ +\n/g,"\n");default:return c(t)}}(),e.colorize?e.colorize.green(n):n},v=function(t){return b(t)||P(t)},d=function(t,e,n){return w(t)?p(t,e,n):v(t)?h(t,e,n):x(t)?f(t,n):n.colorize.yellow(y(t))},i=function(t,e){var n,i,r,s,a,l,u,c,h,p,d,f,m,g,y;for(null==e&&(e=1e4),1,d=t.split("\n"),f=[],m=e/2,l=0,c=d.length;l<c;l++)if(p=d[l],(r=p.split("\t")).length>1)for(a=u=0,h=r.length;u<h;a=++u)n=r[a],a<r.length-1&&(0===a||o(n)<m)&&(f.length===a&&f.push(0),f[a]=C(f[a],o(n)+1));return function(){var t,l,u;for(u=[],l=0,t=d.length;l<t;l++)p=d[l],y=e-o(p),r=p.split("\t"),g=function(){var t,e,l;if(r.length>1){for(l=[],a=e=0,t=r.length;e<t;a=++e)n=r[a],i=o(n),a===r.length-1?l.push(n):null!=f[a]&&(s=f[a]-i-1)<=y?(y-=s,l.push(n+k("",f[a]-i))):(y=0,l.push(n+" "));return l}return r}(),u.push(g.join(""));return u}().join("\n")},r=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g,B=function(t){return r.test(t)?t.replace(r,""):t},o=function(t){if(!x(t))throw new Error("not string");return r.test(t)&&(t=t.replace(r,"")),t.length},M=function(t,e){var n,r,s,a,l,u,c,h,p;for(a=0,p=[],c=[],n=function(){var e;if(0<p.length)return e=p.join("\n"),p=[],c.push(i(e,t))},s=0,l=(h=e.split("\n")).length;s<l;s++)u=(u=h[s]).replace(/\s+$/g,""),a!==(r=o(u.match(/^ *-?/)[0]))&&n(),p.push(u),a=r;return n(),c.join("\n")},a=z("red yellow green blue grey"),l=_(a,function(t){return function(e){var n;return null!=(n=e[t])?n:e}}),m=function(t){return t},I=_(a,function(){return m}),t.exports=function(){var t;function FormattedInspect(){}return FormattedInspect.ansiRegex=r,FormattedInspect.stripAnsi=B,FormattedInspect.ansiSafeStringLength=o,FormattedInspect.alignTabs=i,FormattedInspect._escapeForBlockString=u,FormattedInspect.formattedInspectString=f,FormattedInspect.failsafeInspect=t=function(t){var e;return"typeof: "+typeof t+"\nconstructor: "+((null!=t?t.constructor:void 0)&&(null!=t&&null!=(e=t.constructor)?e.name:void 0))+"\n"+function(){switch(!1){case!v(t):return"length: "+t.length+"\njoined: ["+t.join(", ")+"]";case!(null!=t&&"object"==typeof t):return"keys: "+Object.keys(t).join(", ");default:return"toString: "+t}}()},FormattedInspect.formattedInspect=function(n,i){var r,o,s,a,u;null==i&&(i={});try{if(S(i))i={maxLineLength:i};else if(!w(i))throw console.error({invalid:{options:i}}),new Error("invalid options object type: "+typeof i);return null==i.maxLineLength&&(i.maxLineLength=(null!=(a=e.process)&&null!=(u=a.stdout)?u.columns:void 0)||80),o=i.maxLineLength,i.colorize=i.color?l:I,M(o,d(R(n),o,i)).replace(/\n\n$/,"\n")}catch(e){return s="Error in formattedInspect: "+(r=e)+"\n"+t(n),console.error(s,{error:r,toInspect:n,options:i}),s}},FormattedInspect}()}).call(this,n(5))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d=[].slice,f=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};h=n(29),i=h.compactFlatten,h.deepArrayEach,r=h.isArrayOrArguments,l=h.mergeInto,p=n(50),s=p.isPlainObject,a=p.isString,p.isObject,o=p.isFunction,p.isPlainArray,c=p.present,u=n(68).object,t.exports=function(){var t,e,n,h,p,m;function ObjectExtensions(){}return ObjectExtensions.countKeys=function(t){return Object.keys(t).length},ObjectExtensions.objectKeyCount=n=function(t){var e,n;for(n in e=0,t)t[n],e++;return e},ObjectExtensions.objectHasKeys=function(t){var e;for(e in t)return t[e],!0;return!1},ObjectExtensions.objectLength=n,t=function(t,e,n){var i,r,o,s;for(r=o=0,s=e.length;o<s;r=++o)null!=(i=e[r])&&(t=function(){switch(!1){case!(null!=n&&r===e.length-1):return t[i]=n;case!a(i):return null!=t[i]?t[i]:t[i]={};default:throw new Error("Expecting string or array or null/undefined")}}());return t},ObjectExtensions.vivifyObjectPath=function(){var e,n;if(e=arguments[0],n=2<=arguments.length?d.call(arguments,1):[],!s(e))throw new Error("obj must be an object");return t(e,n)},ObjectExtensions.vivifyObjectPathAndSet=function(){var e,n,i,r,o;if(n=arguments[0],i=2<=arguments.length?d.call(arguments,1):[],!s(n))throw new Error("obj must be an object");return i=2<=(r=i).length?d.call(r,0,e=r.length-1):(e=0,[]),o=r[e++],t(n,i,o),o},p=function(t,e){var n,i,o,a;for(o=null,i=0,a=t.length;i<a;i++)n=t[i],o?(e[o]=n,o=null):s(n)?l(e,n):r(n)?p(n,e):null!=n&&(o=n);if(o)return e[o]=void 0},ObjectExtensions.toObject=function(){var t,e;return t=1<=arguments.length?d.call(arguments,0):[],p(t,e={}),e},ObjectExtensions.arrayToMap=function(t,e){var n,i,r,o,s,a;for(null==e&&(e=function(t){return t}),o={},n=0,r=t.length;n<r;n++)i=(s=e(t[n]))[0],a=s[1],o[i]=a;return o},ObjectExtensions.select=function(){var t,e,n,r,s,a,l,u,c,h;if(a=arguments[0],e=2<=arguments.length?d.call(arguments,1):[],!a)return{};if(c={},o(t=e[0]))if(1===t.length)for(r in a)t(h=a[r])&&(c[r]=h);else for(r in a)t(r,h=a[r])&&(c[r]=h);else for(n=0,s=(u=i(e)).length;n<s;n++)(null!=(h=a[l=u[n]])||a.hasOwnProperty(l))&&(c[l]=h);return c},ObjectExtensions.selectAll=function(){var t,e,n,r,o,s,a;if(n=arguments[0],o=2<=arguments.length?d.call(arguments,1):[],!n)return{};for(a={},t=0,e=(s=i(o)).length;t<e;t++)a[r=s[t]]=n[r];return a},ObjectExtensions.objectWithDefinedValues=function(t){return u(t,{when:function(t){return void 0!==t}})},ObjectExtensions.objectWithExistingValues=function(t){return u(t,{when:function(t){return null!=t}})},ObjectExtensions.objectWithPresentValues=function(t){return u(t,{when:function(t){return c(t)}})},ObjectExtensions.objectWith=function(t,e,n){var i,r,o;for(i in o={},t)r=t[i],o[i]=r;return o[e]=n,o},ObjectExtensions.objectWithout=function(){var t,e,n,i,r,o,s,a;if(i=arguments[0],o=2<=arguments.length?d.call(arguments,1):[],!i)return{};for(1===o.length&&"string"!=typeof o[0]&&(o=o[0]),t=!1,e=0,n=o.length;e<n;e++)if(r=o[e],i.hasOwnProperty(r)){t=!0;break}if(t){for(r in s={},i)a=i[r],f.call(o,r)<0&&(s[r]=a);return s}return i},ObjectExtensions.propertyIsPathed=h=function(t){return!!t.match(/[\s\.\/]/)},ObjectExtensions.withPropertyPath=m=function(t,e,n){var i,r,o,s;for(i=r=0,s=(e=e.match(/[^\s\.\/]+/g)).length;r<s;i=++r)o=e[i],i===e.length-1?n(t,o):t=t[o]||(t[o]={});return t},ObjectExtensions.setPathedProperty=function(t,e,n){return m(t,e,function(t,e){return t[e]=n}),t},ObjectExtensions.expandPathedProperties=e=function(t,n,i){var r,o;for(r in null==n&&(n={}),null==i&&(i=!0),t)o=t[r],i&&h(r)?m(n,r,function(t,n){return s(o)?e(o,t[n]||(t[n]={}),!0):t[n]=o}):s(o)?e(o,n[r]||(n[r]={}),!1):n[r]=o;return n},ObjectExtensions}()},function(t,e,n){var i,r,o,s,a=[].slice;(o=n(29)).compactFlatten,o.deepArrayEach,o.isArrayOrArguments,o.mergeInto,s=n(50),r=s.isPlainObject,s.isObject,i=s.isFunction,s.isPlainArray,t.exports=function(){var t,e,n,o,s,a,l,u,c,h,p;function Iteration(){}return h=function(t){return t},p=function(t,e){return e},t=function(t){return(null!=t?t.length:void 0)>=0},e={},Iteration.each=function(t,e,i){return n(s,t,e,i)},s=function(e,n,i,r){var o,s,a,l,u,c,h,p;if(void 0===n&&(n=e),r&&(p=r.when),t(e))if(p)for(a=o=0,l=e.length;o<l;a=++o)(h=p(c=e[a],a))&&i(c,a,n,h);else for(a=s=0,u=e.length;s<u;a=++s)i(c=e[a],a,n);else if(null!=e)if(p)for(a in e)(h=p(c=e[a],a))&&i(c,a,n,h);else for(a in e)i(c=e[a],a,n);return n},Iteration.eachWhile=function(t,e,i){return n(a,t,e,i)},a=function(e,n,i,r){var o,s,a,l,u,c,h,p;if(void 0===n&&(n=e),r&&(p=r.when),t(e))if(p)for(a=o=0,l=e.length;o<l&&(!(h=p(c=e[a],a))||i(c,a,n,h));a=++o);else for(a=s=0,u=e.length;s<u&&i(c=e[a],a,n);a=++s);else if(null!=e)if(p){for(a in e)if((h=p(c=e[a],a))&&!i(c,a,n,h))break}else for(a in e)if(!i(c=e[a],a,n))break;return n},Iteration.reduce=function(t,e,i){return n(u,t,e,i)},u=function(t,e,n,i){var r;return null==t?e:(s(t,void 0,(r=void 0!==e)?function(t,i,r,o){return e=n(e,t,i,o)}:function(t,i,o,s){return e=r?n(e,t,i,s):(r=!0,t)},i),e)},Iteration.object=function(t,e,i){return n(c,t,e,i)},c=function(e,n,i,r){var o;return o=r.key||r.withKey||(t(e)?h:p),s(e,null!=n?n:{},function(t,e,n,r){return n[o(t,e,n,r)]=i(t,e,n,r)},r)},Iteration.array=function(t,e,i){return n(o,t,e,i)},o=function(t,e,n,i){return s(t,null!=e?e:[],function(t,e,i,r){return i.push(n(t,e,i,r))},i)},Iteration.find=function(t,e,i){return n(l,t,e,i)},l=function(t,e,n,i){var r;return a(t,r=void 0,i.whenBlock?function(t,e,i,o){return r=n(t,e,null,o),!1}:function(t,e,i,o){return!(r=n(t,e,null,o))},i),r},n=function(t,n,o,s){var a,l,u;return l=s?(a=o,s):o,r(l)?(null==a&&(a=l.into),u=l.with):(i(l)&&(u=l),l=e),t(n,a,u||h,l)},Iteration}()},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g;g=n(50),m=g.isTypedArray,a=g.isDate,r=g.deepMap,u=g.isNonNegativeInt,s=g.isClass,c=g.isPlainArray,h=g.isPlainObject,f=g.isString,l=g.isFunction,p=g.isPromise,d=g.isRegExp,n(62).escapeJavascriptString,o=n(70).inspectedObjectLiteral,i=n(73),t.exports=function(){var t;function InspectedObjects(){}return InspectedObjects.toInspectedObjects=t=function(n){var g,y,v,S;return null==n?n:(n,n===e?o("global"):(v="function"==typeof n.getInspectedObjects?n.getInspectedObjects():void 0)?v:p(n)?o("Promise"):h(n)||c(n)?r(n,function(e){return t(e)}):m(n)?n:n instanceof Error?(y=o(n.stack||n.toString(),!0),n.info?t({Error:{info:n.info,stack:y}}):{Error:{class:t(n.constructor),stack:y}}):d(n)?o(""+n):a(n)?o(i(n,"UTC:yyyy-mm-dd HH:MM:ss Z")):s(n)?o("class "+(("function"==typeof n.getName?n.getName():void 0)||n.name)):l(n)?(S=(g=""+n).replace(/\s+/g," ").replace(/^function (\([^)]*\))/,"$1 ->").replace(/^\(\)\s*/,""),o(S.length<80?S:g.slice(0,400))):n&&!f(n)?u(n.length)?o("{"+n.constructor.name+" length: "+n.length+"}"):u(n.byteLength)?o("{"+n.constructor.name+" byteLength: "+n.byteLength+"}"):n:n)},InspectedObjects}()}).call(this,n(5))},function(t,e,n){var i;i=n(71).compare,t.exports=function(){function InspectedObjectLiteral(t,e){this.literal=t,this.isError=e}return InspectedObjectLiteral.inspectedObjectLiteral=function(t,e){return new InspectedObjectLiteral(t,e)},InspectedObjectLiteral.prototype.getInspectedObjects=function(){return this},InspectedObjectLiteral.prototype.inspect=function(){return this.literal},InspectedObjectLiteral.prototype.compare=function(t){return i(this.literal,t.literal)},InspectedObjectLiteral}()},function(t,e,n){var i,r,o,s,a,l,u,c=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};u=n(72).remove,a=n(67).objectKeyCount,i=n(63).floatTrue0,l=n(50),o=l.isString,r=l.isNumber,s=Math.min,t.exports=function(){var t,e,n;function Eq(){}return Eq.eq=function(t,e,n){return t===e||0===Eq.compare(t,e,!0,n)},Eq.neq=function(t,e,n){return t!==e&&0!==Eq.compare(t,e,!0,n)},Eq.fastEq=function(t,e){return t===e||0===Eq.compare(t,e,!1)},Eq.fastNeq=function(t,e){return t!==e&&0!==Eq.compare(t,e,!1)},Eq._compareArray=function(t,e,n,i){var r,o,s,a,l,u,c,h;for(r=t.length,s=e.length,l=u=0,c=Math.min(r,s);u<c;l=u+=1)if(o=t[l],a=e[l],0!==(h=Eq._compare(o,a,n,i)))return h;return r-s},Eq._compareObject=function(t,e,n,i){var r,o,s,l,u,c;for(u in r=0,l=0,t)if(o=t[u],r++,o=t[u],(void 0!==(s=e[u])||e.hasOwnProperty(u))&&(l++,0!==(c=Eq._compare(o,s,n,i))))return c;return r===l&&l===a(e)?0:NaN},Eq.compare=function(t,e,n,i){return Eq._compare(t,e,n&&[],i)},Eq._compare=function(t,e,n,s){var a;if(t===e)return 0;if(null!=t&&null!=e&&t.constructor===(a=e.constructor)){if(o(t))return t.localeCompare(e);if(r(t))return i(t-e);if(n){if(c.call(n,t)>=0||c.call(n,e)>=0)return 0;n.push(t),n.push(e)}if(t.compare)return t.compare(e,n);if(a===Array)return Eq._compareArray(t,e,n,s);if(a===Object)return Eq._compareObject(t,e,n,s);if(s&&a===Function)return(""+t).localeCompare(""+e);if(t.eq&&t.eq(e,n))return 0;n&&u(n,n.length-2,2)}return NaN},Eq.plainObjectsDeepEqArray=function(e,n){var i,r,o,s;if(e.length!==n.length)return!1;for(r=o=0,s=e.length;o<s;r=++o)if(i=e[r],!t(i,n[r]))return!1;return!0},Eq.plainObjectsDeepEqObject=function(e,n){var i,r,o,s;for(s in i=0,e)if(r=e[s],i++,void 0===(o=n[s])&&!n.hasOwnProperty(s)||!t(r,o))return!1;return i===a(n)},e=[],Eq.plainObjectsDeepEq=function(n,i){try{return t(n,i)}finally{e=[]}},t=function(t,n){var i,r,o;if(t===n)return!0;if(c.call(e,t)>=0||c.call(e,n)>=0)return!1;if(!t||!n||t.constructor!==(i=n.constructor))return!1;if(!(t.eq||(r=i===Array)||(o=i===Object)))return!1;try{switch(e.push(t),e.push(n),!1){case!r:return Eq.plainObjectsDeepEqArray(t,n);case!o:return Eq.plainObjectsDeepEqObject(t,n);default:return t.eq(n)}}finally{e.pop(),e.pop()}},Eq.propsEq=Eq.plainObjectsDeepEq,Eq.plainObjectsDeepDiffArray=function(t,e){var i,r,o,a,l,u,c,h,p,d,f,m;for(m=null,r=o=0,c=l=s(t.length,e.length);0<=c?o<c:o>c;r=0<=c?++o:--o)(i=n(t[r],e[r]))&&(m||(m={}),m[r]=i);if(l<t.length)for(r=a=h=l,p=t.length;h<=p?a<p:a>p;r=h<=p?++a:--a)m||(m={}),m[r]={removed:t[r]};if(l<e.length)for(r=u=d=l,f=e.length;d<=f?u<f:u>f;r=d<=f?++u:--u)m||(m={}),m[r]={added:e[r]};return m},Eq.plainObjectsDeepDiffObject=function(t,e){var i,r,o,s,a;for(s in a=null,t)r=t[s],e.hasOwnProperty(s)?(o=n(r,e[s]))&&(a||(a={}),a[s]=o):(a||(a={}),a[s]={removed:r});for(s in e)i=e[s],t.hasOwnProperty(s)||(a||(a={}),a[s]={added:i});return a},Eq.plainObjectsDeepDiff=n=function(t,e){var n;return t===e?null:t&&e&&t.constructor===(n=e.constructor)?t.eq?t.eq(e)?null:{before:t,after:e}:n===Array?Eq.plainObjectsDeepDiffArray(t,e):n===Object?Eq.plainObjectsDeepDiffObject(t,e):{before:t,after:e}:{before:t,after:e}},Eq.diff=n,Eq.shallowEq=function(t,e){return t===e||t&&e&&t.eq&&t.eq(e)},Eq}()},function(t,e,n){var i,r,o,s,a,l,u,c,h,p=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},d=[].slice;(l=n(63)).bound,l.max,r=l.intRand,a=l.modulo,u=n(50),o=u.isFunction,u.isNumber,s=u.isString,c=n(54),h=c.wordsRegex,i=c.exactlyOneWordRegex,t.exports=function(){var t,e,n,l,u,c,f,m,g,y,v;function ArrayExtensions(){}return ArrayExtensions.keepAll=function(){return!0},ArrayExtensions.keepIfRubyTrue=function(t){return void 0!==t&&null!==t&&!1!==t},ArrayExtensions.reverseForEach=function(t,e){var n;for(n=t.length-1;n>=0;n+=-1)e(t[n]);return t},ArrayExtensions.arrayToTruthMap=function(t){var e,n,i;for(i={},n=0,e=t.length;n<e;n++)i[t[n]]=!0;return i},ArrayExtensions.arrayToFalseMap=function(t){var e,n,i;for(i={},n=0,e=t.length;n<e;n++)i[t[n]]=!1;return i},ArrayExtensions.arrayAfterEach=function(t,e){var n,i,r,o;for(i=[],r=0,n=t.length;r<n;r++)o=t[r],i.push(o),i.push(e);return i},ArrayExtensions.arrayBeforeEach=function(t,e){var n,i,r,o;for(i=[],r=0,n=t.length;r<n;r++)o=t[r],i.push(e),i.push(o);return i},ArrayExtensions.arrayBetweenEach=function(t,e){var n,i,r,o,s;for(r=[],n=o=0,i=t.length;o<i;n=++o)s=t[n],n>0&&r.push(e),r.push(s);return r},ArrayExtensions.concatInto=function(t,e){return t.push.apply(t,e)},ArrayExtensions.uniqueValues=function(t,e){var n,i,r,o,s;for(null==e&&(e=function(t,e){return t===e}),o=[],n=r=0,i=t.length;r<i;n=++r)s=t[n],0!==n&&e(s,t[n-1])||o.push(s);return o},ArrayExtensions.push=function(t,e){return t?(t.push(e),t):[e]},ArrayExtensions.peek=function(t,e){return null==e&&(e=-1),null!=t?t[t.length+e]:void 0},u=function(t,e){return t-e},ArrayExtensions.leftOfIndex=f=function(t,e){return t?t.slice(0,e):t},ArrayExtensions.rightOfIndex=v=function(t,e){return t?(e<0&&(e+=t.length),t.slice(e+1)):t},c=function(t,e){var n;return 0>(n=t.indexOf(e))?t.length:n},ArrayExtensions.leftOf=function(t,e){return f(t,c(t,e))},ArrayExtensions.rightOf=function(t,e){return v(t,c(t,e))},ArrayExtensions.splitArray=function(t,e){var n;return n=c(t,e),[f(t,n),v(t,n)]},ArrayExtensions.findSortedFirst=function(t,e){var n,i,r,o,s;if(null==e&&(e=u),(null!=t?t.length:void 0)>0){for(s=t[0],i=r=1,o=t.length;r<o;i=r+=1)0<e(s,n=t[i])&&(s=n);return s}},ArrayExtensions.first=function(t){return t[0]},ArrayExtensions.second=function(t){return t[1]},ArrayExtensions.third=function(t){return t[2]},ArrayExtensions.forth=function(t){return t[3]},ArrayExtensions.fifth=function(t){return t[4]},ArrayExtensions.last=function(t){return t?t[t.length-1]:void 0},ArrayExtensions.pushIfNotPresent=function(t,e){return!(p.call(t,e)>=0)&&(t.push(e),!0)},ArrayExtensions.pushUnique=ArrayExtensions.pushIfNotPresent,ArrayExtensions.randomElement=function(t,e,n){var i,r;return t[(o(r=e)?(i=n,r()):(i=e,Math.random()))*(null!=i?i:t.length)|0]},ArrayExtensions.randomSortInPlace=y=function(t){var e,n,i,o;for(n=o=t.length-1;o>=0;n=o+=-1)i=r(n),e=t[n],t[n]=t[i],t[i]=e;return t},ArrayExtensions.arrayWithRandomSort=function(t){return t?y(t.slice()):[]},ArrayExtensions.randomSort=ArrayExtensions.arrayWithRandomSort,ArrayExtensions.insert=function(t,e,n){return e<0&&(e=t.length+e+1),t.splice(e,0,n),t},ArrayExtensions.arrayWithInsertedValue=l=function(t,e,n){return ArrayExtensions.insert(t.slice(),e,n)},ArrayExtensions.withInserted=l,ArrayExtensions.withSort=function(t,e){return null==t&&(t=[]),(t=t.slice()).sort(e)},ArrayExtensions.remove=function(t,e,n){return null==n&&(n=1),e<0&&(e=t.length+e+1),t.splice(e,n),t},ArrayExtensions.removeFirstMatch=function(t,e){var n;return(n=t.indexOf(e))>=0?ArrayExtensions.remove(t,n):t},ArrayExtensions.arrayWithout=function(t,e,n){return null==n&&(n=1),null!=t?(null==e&&(e=t.length-1),ArrayExtensions.remove(t.slice(),e,n)):[]},ArrayExtensions.arrayWithoutValue=function(t,e){var n;return null!=t?0<=(n=t.indexOf(e))?ArrayExtensions.remove(t.slice(),n,1):t:[]},ArrayExtensions.arrayWithoutLast=function(t,e){return null==e&&(e=1),null!=t&&e<t.length?t.slice(0,t.length-e):[]},ArrayExtensions.arrayWith=function(t,e){return t?((t=t.slice()).push(e),t):[e]},ArrayExtensions.truncatedArrayWith=function(t,e,n){return t?((t=t.slice(0,e)).push(n),t):[n]},ArrayExtensions.poppedArray=function(t){return t.slice(0,t.length-1)},ArrayExtensions.arrayWithOne=function(t,e){return t?(t=t.slice(),p.call(t,e)<0&&t.push(e),t):[e]},ArrayExtensions.arrayWithUnique=ArrayExtensions.arrayWithOne,ArrayExtensions.slice=function(t,e,n){return arraySlice.call(t,e,n)},ArrayExtensions.shuffleArray=function(t){var e,n,i;for(e=t.length;--e>0;)i=t[n=~~(Math.random()*(e+1))],t[n]=t[e],t[e]=i;return t},ArrayExtensions._moveArrayElementLargeArray=t=function(t,e,n){return t.splice(n,0,t.splice(e,1)[0]),t},ArrayExtensions._moveArrayElementSmallArray=e=function(t,e,n){var i,r,o,s,a,l;if(n|=0,l=t[e|=0],e<n)for(i=r=e,s=n-1;r<=s;i=r+=1)t[i]=t[i+1];else for(i=o=e,a=n+1;o>=a;i=o+=-1)t[i]=t[i-1];return t[n]=l,t},ArrayExtensions.moveArrayElement=g=function(n,i,r){return i=a(0|i,n.length),r=a(0|r,n.length),Math.abs(i-r)>300?t(n,i,r):e(n,i,r),n},ArrayExtensions.arrayWithElementMoved=n=function(t,e,n){return(e=a(0|e,t.length))===(n=a(0|n,t.length))?t:(t=t.slice(),g(t,e,n))},ArrayExtensions.arrayWithElementValueMoved=function(t,e,i){var r;return(r=t.indexOf(e))<0?t:n(t,r,i)},ArrayExtensions.arrayWithElementReplaced=function(t,e,n){return(t=t.slice())[n]=e,t},ArrayExtensions.arrayWithAllButLast=function(t,e){return null==e&&(e=1),t?t.slice(0,t.length-e):[]},ArrayExtensions.stableSort=function(t,e){var n,i,r,o,s,a,l;for(e||(e=function(t,e){return t-e}),s=!0,o=t.length;s;)for(s=!1,r=a=1,l=o;a<l;r=a+=1)e(n=t[r-1],i=t[r])>0&&(t[r-1]=i,t[r]=n,s=!0);return t},ArrayExtensions.longestCommonSubsequence=m=function(t,e){var n,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v;for(a=[],y=[],n=[],u<c&&(v=t,t=e,e=v),u=t.length,o=h=0,f=c=e.length;h<f;o=h+=1)y[o]=0;for(r=p=0,m=u;p<m;r=p+=1)for(n[r]=y=y.slice(),i=0,o=d=0,g=c-1;d<=g;o=d+=1)s=y[o],t[r]===e[o]?y[o]=i+1:(l=y[o-1]||0)>y[o]&&(y[o]=l),i=s;for(r--,o--;r>-1&&o>-1;)switch(n[r][o]){case r&&n[r-1][o]:r--;continue;case o&&n[r][o-1]:o--;break;default:o--,a.unshift(t[r]),r--;continue}return a},ArrayExtensions.minimumOrderedOverlappingMerge=function(t,e){var n,i,r,o,s,a,l,u,c,h,d,f;for(r=m(t,e),c=t.length,h=e.length,d=r.length,f=new Array(h),s=0,a=0,l=0,u=0;s<c&&a<h&&l<d;)n=t[s],i=e[a],n===(o=r[l])&&i===o?(s++,a++,l++,f[u++]=n):n!==o?(s++,p.call(e,n)<0&&(f[u++]=n)):(a++,f[u++]=i);for(;s<c;)n=t[s++],p.call(e,n)<0&&(f[u++]=n);for(;a<h;)f[u++]=e[a++];return f},ArrayExtensions.wordsArray=function(){var t,e,n,r,o;for(r=[],o=0,n=(e=1<=arguments.length?d.call(arguments,0):[]).length;o<n;o++)t=e[o],s(t)&&!t.match(i)?r=r.concat(t.match(h)):r.push(t);return r},ArrayExtensions.wordArray=ArrayExtensions.wordsArray,ArrayExtensions.w=ArrayExtensions.wordsArray,ArrayExtensions.a=function(){return 1<=arguments.length?d.call(arguments,0):[]},ArrayExtensions}()},function(t,e,n){var i;!function(r){"use strict";var o,s,a,l=(o=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,s=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,function(t,e,n,i){if(1!==arguments.length||"string"!==function kindOf(t){return null===t?"null":void 0===t?"undefined":"object"!=typeof t?typeof t:Array.isArray(t)?"array":{}.toString.call(t).slice(8,-1).toLowerCase()}(t)||/\d/.test(t)||(e=t,t=void 0),(t=t||new Date)instanceof Date||(t=new Date(t)),isNaN(t))throw TypeError("Invalid date");var r=(e=String(l.masks[e]||e||l.masks.default)).slice(0,4);"UTC:"!==r&&"GMT:"!==r||(e=e.slice(4),n=!0,"GMT:"===r&&(i=!0));var u=n?"getUTC":"get",c=t[u+"Date"](),h=t[u+"Day"](),p=t[u+"Month"](),d=t[u+"FullYear"](),f=t[u+"Hours"](),m=t[u+"Minutes"](),g=t[u+"Seconds"](),y=t[u+"Milliseconds"](),v=n?0:t.getTimezoneOffset(),S=function getWeek(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var n=new Date(e.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var i=e.getTimezoneOffset()-n.getTimezoneOffset();e.setHours(e.getHours()-i);var r=(e-n)/6048e5;return 1+Math.floor(r)}(t),b=function getDayOfWeek(t){var e=t.getDay();return 0===e&&(e=7),e}(t),w={d:c,dd:pad(c),ddd:l.i18n.dayNames[h],dddd:l.i18n.dayNames[h+7],m:p+1,mm:pad(p+1),mmm:l.i18n.monthNames[p],mmmm:l.i18n.monthNames[p+12],yy:String(d).slice(2),yyyy:d,h:f%12||12,hh:pad(f%12||12),H:f,HH:pad(f),M:m,MM:pad(m),s:g,ss:pad(g),l:pad(y,3),L:pad(Math.round(y/10)),t:f<12?l.i18n.timeNames[0]:l.i18n.timeNames[1],tt:f<12?l.i18n.timeNames[2]:l.i18n.timeNames[3],T:f<12?l.i18n.timeNames[4]:l.i18n.timeNames[5],TT:f<12?l.i18n.timeNames[6]:l.i18n.timeNames[7],Z:i?"GMT":n?"UTC":(String(t).match(s)||[""]).pop().replace(a,""),o:(v>0?"-":"+")+pad(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10],W:S,N:b};return e.replace(o,function(t){return t in w?w[t]:t.slice(1,t.length-1)})});function pad(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t}l.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},l.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},void 0===(i=function(){return l}.call(e,n,e,t))||(t.exports=i)}()},function(t,e,n){var i,r,o,s,a,l,u;u=n(50),i=u.deepMap,u.hasKeys,a=u.isPlainArray,l=u.isPlainObject,s=u.isFunction,o=u.isClass,r=n(70).inspectedObjectLiteral,t.exports=function(){var t;function PlainObjects(){}return PlainObjects.toPlainObjects=t=function(e){var n,u,c;return null==e?e:(e,(u="function"==typeof e.getPlainObjects?e.getPlainObjects():void 0)?u:l(e)||a(e)?i(e,function(e){return t(e)}):o(e)?r("<"+e.getName()+">"):s(e)?(c=(n=""+e).replace(/\s+/g," ").replace(/^function (\([^)]*\))/,"$1 ->").replace(/^\(\)\s*/,""),r(c.length<80?c:n.slice(0,400))):e)},PlainObjects}()},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S=function(t,e){return function(){return t.apply(e,arguments)}},b={}.hasOwnProperty;o=n(61),r=n(59),i=n(76),n(62).escapeJavascriptString,v=n(50),m=v.isString,s=v.isArray,c=v.isFunction,p=v.isObject,d=v.isPlainObject,l=v.isClass,u=v.isDate,f=v.isRegExp,g=v.objectName,a=v.isBrowserObject,h=self.HTMLImageElement?function(t){return t instanceof HTMLImageElement}:function(){return!1},y=function(t){switch(t){case 0:return"parent";case 1:return"grandparent";case 2:return"great grandparent";default:return"great^"+(t-1)+" grandparent"}},t.exports=function(t){function Inspector2(t){null==t&&(t={}),this.inspectObject=S(this.inspectObject,this),this.inspectWithToImage=S(this.inspectWithToImage,this),this.inspectHTMLImageElement=S(this.inspectHTMLImageElement,this),this.inspectArray=S(this.inspectArray,this),this.withImages=t.withImages,this.maxLength=t.maxLength||1e3,this.allowCustomInspectors=!t.noCustomInspectors,this.maxDepth=null!=t.maxDepth?t.maxDepth:10,this.outArray=[],this.length=0,this.depth=0,this.inspectingMap=new r}return function(t,e){for(var n in e)b.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Inspector2,o),Inspector2.prototype.inspectArray=function(t){var e;return new i.Array(function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(this.inspectInternal(e));return r}.call(this))},Inspector2.prototype.inspectHTMLImageElement=function(t){var e,n;return((e=new i.Object({},"HTMLImageElement",t)).image=t).complete||(this.addPendingTask(),t.onload=(n=this,function(){return n.completePendingTask()})),e},Inspector2.prototype.inspectWithToImage=function(t){var e,n,r;return e=g(t),"string"==typeof t.classPathName&&(e=t.classPathName),"Object"===e&&(e=null),n=new i.Object({},e,t),this.addPendingTask(),t.toImage().then((r=this,function(t){return n.image=t,r.completePendingTask()})),n},Inspector2.prototype.inspectObject=function(t,e){var n,r,o,s,a,l,u;if(null==e&&(e=!0),[],o=Object.keys(t),a=g(t),c(t)&&0===o.length)return new i.Core(a+"()");if("string"==typeof t.classPathName&&(a=t.classPathName),"Object"===a&&(a=null),u={},e)for(n=0,s=o.length;n<s;n++)u[r=o[n]]=this.inspectInternal(t[r]);return l=new i.Object(u,a,t),c(t.inspect)&&(l.inspected=t.inspect()),l},Inspector2.prototype.addPendingTask=function(){return this.pendingTasks++},Inspector2.prototype.completePendingTask=function(){if(this.pendingTasks--,0===this.pendingTasks)return this.completionCallBack()},Inspector2.prototype.inspectByType=function(t){return c(null!=t?t.getInspectedObjects:void 0)&&(t=t.getInspectedObjects()),null===t||void 0===t||!0===t||!1===t||"number"==typeof t?new i.Core(t):t===self?new i.Core("self"):f(t)?new i.Core(t.toString()):m(t)?new i.String(t):s(t)?this.inspectArray(t):l(t)?new i.Core(g(t)):h(t)?this.inspectHTMLImageElement(t):u(t)?new i.Core(t.toString()):a(t)?new i.Core(g(t)):this.withImages&&"function"==typeof t.toImage&&!c(t)?this.inspectWithToImage(t):d(t)||c(t)?this.inspectObject(t):p(t)?this.inspectObject(t,!1):new i.Core(g(t))},Inspector2.prototype.inspectInternal=function(t){var e,n;return(e=this.inspectingMap.get(t))?new i.Core("<"+y(this.depth-e)+">"):this.depth>=this.maxDepth?new i.Core("<maxDepth reached: "+this.maxDepth+">"):(this.depth++,this.inspectingMap.set(t,this.depth),n=this.inspectByType(t),this.inspectingMap.delete(t),this.depth--,n)},Inspector2.prototype.inspect=function(t,e){var n;if(this.pendingTasks=0,this.withImages&&"function"!=typeof e)throw new Error("callBack required if withImages requested");return this.completionCallBack=function(){return e&&e(n)},n=this.inspectInternal(t),0===this.pendingTasks&&this.completionCallBack(),n},Inspector2}()},function(t,e,n){(t.exports=n(34)).addModules({Array:n(77),Core:n(78),Object:n(79),String:n(80)})},function(t,e,n){var i,r={}.hasOwnProperty;i=n(61),t.exports=function(t){function Array(t){Array.__super__.constructor.apply(this,arguments),this.array=t}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Array,i),Array.getter({arrayOfStrings:function(){var t,e,n,i,r;for(i=[],t=0,e=(n=this.array).length;t<e;t++)r=n[t],i.push(r.toString());return i},children:function(){return this.array.slice()}}),Array.prototype.delimitedString=function(t){return null==t&&(t=", "),this.arrayOfStrings.join(", ")},Array.prototype.toString=function(){return"["+this.delimitedString()+"]"},Array}()},function(t,e,n){var i,r={}.hasOwnProperty;i=n(61),t.exports=function(t){function Core(t){Core.__super__.constructor.apply(this,arguments),this.value=t,t&&"HTMLImageElement"===t.constructor.name&&(this.image=t)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Core,i),Core.getter({children:function(){return null}}),Core.prototype.toString=function(){return""+this.value},Core}()},function(t,e,n){var i,r={}.hasOwnProperty;i=n(61),t.exports=function(t){function Object(t,e,n){this.properties=t,this.instanceOf=e,this.originalObject=n,Object.__super__.constructor.apply(this,arguments),this.length=this.properties?self.Object.keys(this.properties).length:0}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Object,i),Object.getter({arrayOfStrings:function(){var t,e,n,i;for(t in n=[],e=this.properties)i=e[t],n.push(t+": "+i);return n},children:function(){var t,e,n,i;for(t in n={},e=this.properties)i=e[t],n[t]=i;return n}}),Object.prototype.delimitedString=function(t){return null==t&&(t=", "),this.arrayOfStrings.join(", ")},Object.prototype.toString=function(){return this.inspected?this.inspected:this.instanceOf?"{"+this.instanceOf+" "+this.delimitedString()+"}":"{"+this.delimitedString()+"}"},Object}()},function(t,e,n){var i,r,o={}.hasOwnProperty;i=n(61),r=n(62).escapeJavascriptString,t.exports=function(t){function String(t){String.__super__.constructor.apply(this,arguments),this.string=t}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(String,i),String.prototype.toString=function(){return r(this.string)},String}()},function(t,e,n){var i,r;i=n(45),r=n(82).toSeconds,t.exports=function(){var t;function AsyncExtensions(){}return AsyncExtensions.timeout=t=function(t,e){var n;return n=new i(function(e){return setTimeout(e,t)}),null!=e?n.then(e):n},AsyncExtensions.timeoutAt=function(e,n){return t(1e3*(e-r()),n)},AsyncExtensions.interval=function(t,e){var n,r;return null==e&&(e=function(){}),n=null,(r=new i(function(r){return n=setInterval(function(){return i.then(e).then(function(){return r()})},t)})).stop=function(){if(null!=n)return clearInterval(n)},r},AsyncExtensions.requestAnimationFrame=self.requestAnimationFrame||self.webkitRequestAnimationFrame||self.mozRequestAnimationFrame||self.oRequestAnimationFrame||self.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},AsyncExtensions.nextTick=function(t){return i.resolve().then(function(){return"function"==typeof t?t():void 0})},AsyncExtensions.throwErrorOutOfStack=function(e){return console.log(e),t(0,function(){throw e})},AsyncExtensions.evalAndThrowErrorsOutOfStack=function(t){var e;try{return t()}catch(t){return e=t,Neptune.Art.StandardLib.log.error("evalAndThrowErrorsOutOfStack",e),AsyncExtensions.throwErrorOutOfStack(e)}},AsyncExtensions}()},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m=function(t,e){return(+t%(e=+e)+e)%e};h=n(27),c=h.isString,u=h.isNumber,l=h.isDate,a=n(56).formattedInspect,t.exports={dateFormat:i=n(73),formatDate:function(t,e,n){return c(t)&&!c(e)&&(e=t,t=null),i(p(t),e,n)},toMilliseconds:d=function(t){var e,n,i,r;if(null==t||!1===t)return Date.now();if(c(t)&&(t=function(){var o;switch(!1){case!(n=t.match(/^(\d\d\d\d)-(\d\d)(?:-(\d\d))?$/)):return n[0],r=n[1],i=n[2],e=null!=(o=n[3])?o:1,new Date(r-0,i-1,e-0);case!/^\d+(\.\d+)?$/.test(t):return t-0;default:return Date.parse(t)}}()),u(t)){if(!isFinite(t))throw new Error("toMilliseconds("+t+") - number is not finite");return t<1e11?1e3*t:t}if(l(t))return t-0;throw new Error("invalid timestamp value: "+a(t))},toSeconds:f=function(t){return null==t||!1===t?Date.now()/1e3:d(t)/1e3},toDate:p=function(t){return null==t||!1===t?new Date:l(t)?t:new Date(d(t))},secondsPerHour:3600,secondsPerDay:86400,firstOfHour:s=function(t){return 3600*(f(t)/3600|0)},firstOfDay:r=function(t){return 86400*(f(t)/86400|0)},firstOfWeek:function(t){return r(t)-86400*m(p(t).getUTCDay()-1,7)},firstOfMonth:function(t){return r(t)-86400*(p(t).getUTCDate()-1)},firstOfDayLocale:o=function(t){return s(t)-3600*p(t).getHours()},firstOfWeekLocale:function(t,e){var n;return n=p(t).getDay(),e||n--,o(t)-86400*m(n,7)},firstOfMonthLocale:function(t){return o(t)-86400*(p(t).getDate()-1)}}},function(t,e){var n=[].slice;t.exports=function(){function FunctionExtensions(){}return FunctionExtensions.fastBind=function(t,e){switch(t.length){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)};case 5:return function(n,i,r,o,s){return t.call(e,n,i,r,o,s)};case 6:return function(n,i,r,o,s,a){return t.call(e,n,i,r,o,s,a)};case 7:return function(n,i,r,o,s,a,l){return t.call(e,n,i,r,o,s,a,l)};case 8:return function(n,i,r,o,s,a,l,u){return t.call(e,n,i,r,o,s,a,l,u)};case 9:return function(n,i,r,o,s,a,l,u,c){return t.call(e,n,i,r,o,s,a,l,u,c)};case 10:return function(n,i,r,o,s,a,l,u,c,h){return t.call(e,n,i,r,o,s,a,l,u,c,h)};default:return function(){var i;return i=1<=arguments.length?n.call(arguments,0):[],t.apply(e,i)}}},FunctionExtensions}()},function(t,e){t.exports=function(){var t;function ObjectDiff(){}return t=function(t,e){return t===e},ObjectDiff.objectDiff=function(e,n,i,r,o,s,a,l){var u,c,h,p,d;if(null==a&&(a=t),c=0,!n){for(u in e)c++,i(u,h=e[u]);return c}for(u in p=0,e)h=e[u],c++,void 0!==(d=n[u])||n.hasOwnProperty(u)?(p++,a(h,d)?"function"==typeof s&&s(u,h):o(u,h,d)):i(u,h);if(null==l||p!==l)for(u in n)void 0!==e[u]||e.hasOwnProperty(u)||r(u,n[u]);return c},ObjectDiff.objectDiffReport=function(t,e,n){var i,r,o,s;return i={},s={},r={},o=null,ObjectDiff.objectDiff(t,e,function(t,e){return o=!0,i[t]=e},function(t,e){return o=!0,s[t]=e},function(t,e,n){return o=!0,r[t]={oldItem:n,newItem:e}},null,n),o&&{added:i,removed:s,changed:r}},ObjectDiff}()},function(t,e){t.exports=function(){function MapExtensions(){}return MapExtensions.iteratorToArray=function(t){var e,n;for(n=[];!(e=t.next()).done;)n.push(e.value);return n},MapExtensions.mapToKeysArray=function(t){return MapExtensions.iteratorToArray(t.keys())},MapExtensions.mapToValuesArray=function(t){return MapExtensions.iteratorToArray(t.values())},MapExtensions}()},function(t,e,n){var i;i=n(45),t.exports=function(){function PromisedFileReader(){}return PromisedFileReader.readFileAsDataUrl=function(t){return new i(function(e,n){var i;return(i=new FileReader).readAsDataURL(t),i.onload=function(t){return e(t.target.result)},i.onerror=function(t){return n(error)}})},PromisedFileReader.readFileAsArrayBuffer=function(t){return new i(function(e,n){var i;return(i=new FileReader).readAsArrayBuffer(t),i.onload=function(t){return e(t.target.result)},i.onerror=function(t){return n(error)}})},PromisedFileReader}()},function(t,e){var n={}.hasOwnProperty;t.exports=function(){var t;function Ruby(){}return Ruby.rubyTrue=t=function(t){return void 0!==t&&null!==t&&!1!==t},Ruby.rubyFalse=function(t){return void 0===t||null===t||!1===t},Ruby.rubyOr=function(e,n){var i,r;if(2===arguments.length)return t(e)?e:n;for(i=0,r=arguments.length;i<r&&(e=arguments[i],!t(e));i++);return e},Ruby.rubyAnd=function(e,n){var i,r;if(2===arguments.length)return t(e)?n:e;for(i=0,r=arguments.length;i<r&&(e=arguments[i],t(e));i++);return e},Ruby.reopenInstanceProps=function(t,e){var i,r,o;for(i in r=[],e)n.call(e,i)&&(o=e[i],r.push(t.prototype[i]=o));return r},Ruby.reopenClassProps=function(t,e){var i,r,o;for(i in r=[],e)n.call(e,i)&&(o=e[i],r.push(t[i]=o));return r},Ruby}()},function(t,e){t.exports=function(){function ShallowClone(){}return ShallowClone.extendClone=function(t){return t.constructor===Array?t.slice():Object.create(t)},ShallowClone.shallowClone=function(t){var e,n,i;if(!t)return t;if(t.constructor===Array)return t.slice();for(e in n={},t)i=t[e],n[e]=i;return n},ShallowClone}()},function(t,e,n){var i,r,o,s,a;r=n(63).commaize,self.performance||(self.performance={}),(i=self.performance).now||(i.now=self.performance.mozNow||self.performance.msNow||self.performance.oNow||self.performance.webkitNow||function(){return(new Date).getTime()}),a=self.performance.now()/1e3,s=(new Date).getTime()/1e3,o=s-a,t.exports=function(){var t,e,n;function Time(){}return e=[["mo",2592e3],["d",86400],["h",3600],["m",60],["s",1],["ms",.001],["s",1e-6],["ns",1e-9]],Time.dateSecondToPerformanceSecond=function(t){return t-o},Time.performanceSecondToDateSecond=function(t){return t+o},Time.timeStampToPerformanceSecond=function(t){return t/1e3-o},Time.durationString=function(t){var n,i,r,o,s;for(n=0,i=e.length;n<i;n++)if(o=(s=e[n])[0],t>=(r=s[1]))return""+(t/r|0)+o;return"0"},Time.dateAgeInSeconds=function(t){return.001*(new Date-t)},Time.dateToSeconds=function(t){return.001*post.getTime()},Time.perTimeString=function(t){var e;return(e=1/t)>100?r(0|e)+"/s":60*e>100?r(60*e|0)+"/m":r(3600*e|0)+"/h"},Time.currentMillisecond=function(){return self.performance.now()},Time.currentSecond=t=function(){return self.performance.now()/1e3},Time.currentDateSecond=function(){return(new Date).getTime()/1e3},Time.time=function(e,n){var i,r,o,s;return i=n||e,o=t(),r=i(),s=t()-o,n?(Neptune.Art.StandardLib.log("time: "+e+" took "+Time.durationString(s)),r):s},n=[],Time.stackTime=function(e){var i,r,o,s;return i=t(),n.push(0),e(),r=n.pop(),o=t()-i,(s=n.length)>0&&(n[s-1]+=o),{count:1,total:o,subTimeTotal:r,remainder:o-r}},Time.logTimeSinceLast=function(t){var e;return e=Time.currentSecond(),console.log(t+" ("+(Time.lastTime?Time.durationString(e-Time.lastTime):void 0)+")"),Time.lastTime=e},Time}()},function(t,e,n){"use strict";var i,r,o,s,a,l,u,c,h,p;i=n(59),r=n(60),n(56).inspect,h=n(27),c=h.isPlainObject,l=h.isArray,u=h.isFunction,r.PropertyName,a=null,s=!1,o=!1,p=null,t.exports=function(){var t,e,n,r,h,d,f,m,g;function Clone(){}return n=function(e){var n,i,r,o,s;for(a.set(e,n=e.slice()),i=r=0,o=n.length;r<o;i=++r)s=n[i],n[i]=t(s);return n},r=function(e){var n,i,r;if(a.set(e,n=g(e)),e===p&&o||!e.populateClone)for(i in e)r=e[i],n[i]=t(r);else e.populateClone(n);return n},Clone.emptyClone=g=function(t){return l(t)?[]:Object.create(Object.getPrototypeOf(t))},Clone._clone=t=function(t,e){var h,d;switch(e){case"byStructure":s=!0;break;case"byProperties":o=!0}if(null===t||void 0===t||"object"!=typeof t)return t;if(s&&!l(t||c(t)))return t;if(a){if(d=a.get(t))return d}else p=t,a=new i;return h=function(){switch(!1){case!u(t.clone):return t.clone();case!l(t):return n(t);case!c(t):return r(t)}}(),p===t&&(s=!1,o=!1,p=null,a=null),h},Clone.clone=function(e,n){return null!=n&&console.error("2018-07-27: clone mode-param is DEPRICATED. Partial solution, see: cloneStructure"),t(e,n)},Clone.cloneByProperties=function(e){return console.error("2018-07-27: cloneByProperties is DEPRICATED. Partial solution, see: cloneStructure"),t(e,"byProperties")},Clone.cloneByStructure=function(e){return console.error("2018-07-27: cloneByStructure is DEPRICATED. Use: cloneStructure"),t(e,"byStructure")},Clone.prototype.isStructural=function(t){return c(t)||l(t)},Clone.cloneStructure=function(t){var n;return!1,c(t)||(n=l(t))?e(t,n):t},h=[],f=[],d=function(t,e){return h.push(t),f.push(e),!0},m=function(){return h.pop(),f.pop()},e=function(t,n){var i,r,o,s,a,u,p,g;if(0<=(i=null!=h?h.indexOf(t):void 0))return f[i];if(u=!1,a=null,n)for(a=[],r=0,s=t.length;r<s;r++)p=t[r],a.push(c(p)||(g=l(p))?(u||(u=d(t,a)),e(p,g)):p);else for(o in a={},t)p=t[o],a[o]=c(p)||(g=l(p))?(u||(u=d(t,a)),e(p,g)):p;return u&&m(),a},Clone}()},function(module,exports,__webpack_require__){(function(process){var Inspect,Log,callStack,containsPromises,deepResolve,disableLog,getEnv,isNode,isString,merge,peek,ref,ref1,slice=[].slice;Inspect=__webpack_require__(33),callStack=__webpack_require__(92).callStack,isString=__webpack_require__(50).isString,peek=__webpack_require__(72).peek,merge=__webpack_require__(29).merge,ref=__webpack_require__(45),deepResolve=ref.deepResolve,containsPromises=ref.containsPromises,ref1=__webpack_require__(52),isNode=ref1.isNode,getEnv=ref1.getEnv,disableLog=getEnv().disableLog,module.exports=Log=function(){var getLogger,noOptions,promiseLogId,standardOptions;function Log(){}return Log.contextString=function(t,e){var n,i;return t&&(n=t[1])?n.original?n.original:(i=n.function?n.class?n.class+"::"+n.function+"()":n.function+"()":e?e+":":"",n.sourceFileName?"at "+n.sourceFileName+"-"+n.sourceLine+": "+i:void 0):"at "+(e||"(unknown context)")},Log.autoSizedIndepect=function(t,e,n){var i,r;for(null==e&&(e=512),null==n&&(n=10),r=null,i=n;(r=Inspect.inspectLean(t,{maxDepth:i,maxLength:e})).match(/\.\.\.$/);)i--;return r},Log.loggedParamsString=function(t){return"string"==typeof t?t:Log.autoSizedIndepect(t)},Log.hideLogging=function(){return Log.loggingHidden=!0},Log.showLogging=function(){return Log.loggingHidden=!1},Log.rawLog=function(){var t;if(t=1<=arguments.length?slice.call(arguments,0):[],!Log.loggingHidden)return console.log.apply(console,t)},Log.rawErrorLog=function(){var t,e;if(t=1<=arguments.length?slice.call(arguments,0):[],!Log.loggingHidden)return isNode&&"".red?(e=t.join(" "),console.error(e.red)):console.error.apply(console,t)},Log.rawWarningLog=function(){var t,e;if(t=1<=arguments.length?slice.call(arguments,0):[],!Log.loggingHidden)return isNode&&"".red?(e=t.join(" "),console.warn(e.yellow)):console.warn.apply(console,t)},noOptions={},getLogger=function(t){var e,n;return e=t.isError,n=t.isWarning,e?Log.rawErrorLog:n?Log.rawWarningLog:Log.rawLog},promiseLogId=1,Log.logCore=function(t,e,n){return null==n&&(n=noOptions),Log.alternativeLogger&&Log.alternativeLogger.logCore(t,e,n),n.resolvePromises?Log.log.resolvePromiseWrapper(t,function(t,i){var r;return Log._logNow(((r={})[""+i]=t,r),e,n)}):Log._logNow(t,e,n)},Log._logNow=function(t,e,n){return n.className,getLogger(n)(isNode?isString(t)?t:Inspect.formattedInspect(t,merge({maxLineLength:process.stdout.columns},n)):t)},standardOptions=function(){if(isNode){try{eval("require")("colors")}catch(t){}return{color:!0}}return{}}(),Log.log=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],disableLog?peek(t):(e=Log.log).withOptions.apply(e,[standardOptions].concat(slice.call(t)))},Log.log.full=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],(e=Log.log).withOptions.apply(e,[{maxArrayLength:1e5}].concat(slice.call(t)))},Log.log.resolvePromiseWrapper=function(t,e){var n,i;return containsPromises(t)?(i=t,n=promiseLogId++,e(t,"RESOLVING_"+n,!1),deepResolve(i).then(function(t){return e(t,"RESOLVED_"+n,!0)}).catch(function(t){return e(t,"REJECTED_"+n,!0,!0)})):e(t,!1)},Log.log.withOptions=function(){var t,e,n;return n=arguments[0],e=1===(t=2<=arguments.length?slice.call(arguments,1):[]).length?t[0]:t,Log.logCore(e,callStack(),n),peek(t)},Log.log.withLabel=function(t,e){var n,i,r;if(isString(t))return(i={})[t]=e,Log.log(i),e;for(n in r=null,t)r=t[n];return Log.log(i),r},Log.log.labeled=Log.log.withLabel,Log.log.error=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],(e=Log.log).withOptions.apply(e,[{isError:!0}].concat(slice.call(t)))},Log.log.warn=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],(e=Log.log).withOptions.apply(e,[{isWarning:!0}].concat(slice.call(t)))},Log.logL=function(t){var e,n;for(e in console.warn("DEPRICATED: logL. USE log.labeled"),n=null,t)n=t[e];return Log.log(t),n},Log}()}).call(this,__webpack_require__(47))},function(t,e,n){var i,r;i=n(50).isString,r=n(53).parseUrl,n(56).inspect,t.exports=function(){var t;function CallStack(){}return CallStack.errorToString=function(t){return(null!=t?t.error:void 0)||(null!=t?t.message:void 0)||i(t)&&t||Neptune.Art.StandardLib.formattedInspect(t)},CallStack.CallStackLine=t=function(){function CallStackLine(t){this.original=t,this.function=null,this.source=null,this.class=null,this.classPath=null,this.sourceFileName=null,this.sourcePath=null,this.sourceHostWithPort=null,this.sourceLine=0,this.sourceColumn=0,this.parseLineWithFunction(t)||this.parseLineWithoutFunction(t),this.subParseFunction(),this.subParseSource()}return CallStackLine.getter=function(t){var e,n,i;for(n in i=[],t)e=t[n],i.push(Object.defineProperty(this.prototype,n,{get:e,configurable:!0}));return i},CallStackLine.setter=function(t){var e,n,i;for(e in n=[],t)i=t[e],n.push(Object.defineProperty(this.prototype,e,{set:i,configurable:!0}));return n},CallStackLine.prototype.toString=function(){return this.original},CallStackLine.getter({fileWithLocation:function(){return this._fileWithLocation||(this._fileWithLocation=this.sourceFileName?this.sourcePath+"/"+this.sourceFileName+":"+this.sourceLine+":"+this.sourceColumn:this.original)}}),CallStackLine.prototype.parseLineWithFunction=function(t){var e;if(e=t.match(/\s*at\s((new\s)?[a-zA-Z0-9_.<>]+)\s\(([^)]*):([0-9]+):([0-9]+)\)/))return this.function=e[1],this.source=e[3],this.sourceLine=0|e[4],this.sourceColumn=0|e[5]},CallStackLine.prototype.parseLineWithoutFunction=function(t){var e;if(e=t.match(/\s*at\s([^)]*):([0-9]+):([0-9]+)/))return this.source=e[1],this.sourceLine=0|e[2],this.sourceColumn=0|e[3]},CallStackLine.prototype.subParseSource=function(){var t;if(this.source)return t=r(this.source),this.sourceFileName=t.fileName,this.sourcePath=t.path,this.sourceHostWithPort=t.hostWithPort},CallStackLine.prototype.subParseFunction=function(){var t;if(this.function)return t=this.function.split("."),this.function=t[t.length-1],"<anonymous>"===this.function&&(this.function=void 0),this.class=t[t.length-2],this.classPath=t.slice(0,t.length-2)},CallStackLine}(),CallStack.rawCallStack=(new Error).stack?function(t){return null==t&&(t=0),(new Error).stack.split(/\n  */).slice(t+2)}:function(t){null==t&&(t=0);try{throw new Error}catch(e){return e.stack.split(/\n  */).slice(t+2)}},CallStack.callStack=function(e){var n,i,r,o,s;for(null==e&&(e=0),s=[],n=0,i=(o=CallStack.rawCallStack(e+1)).length;n<i;n++)r=o[n],s.push(new t(r));return s},CallStack}()},function(t,e,n){var i,r;i=n(45).Promise,n(89).currentSecond,r=n(81).timeout,t.exports=function(){function ReschedulableTimer(){this._actionCount=0,this.cancel()}return ReschedulableTimer.prototype.timeout=function(t,e){var n,o;return n=this._actionCount+=1,r(t,(o=this,function(){var t,r,s;if(o._actionCount===n)return r=(t=o).reject,s=t.resolve,o.cancel(),i.then(function(){return e()}).catch(r).then(s)})),this._getPendingPromise()},ReschedulableTimer.prototype.cancel=function(){return this.resolve=this.reject=this._pendingTimeoutPromise=null,this._actionCount++},ReschedulableTimer.prototype._getPendingPromise=function(){return null!=this._pendingTimeoutPromise?this._pendingTimeoutPromise:this._pendingTimeoutPromise=new i((t=this,function(e,n){t.resolve=e,t.reject=n}));var t},ReschedulableTimer}()},function(t,e,n){var i;i=n(45),n(91).log,t.exports=function(){function PromiseWorkerPool(t){this.numWorkers=null!=t?t:10,this._queue=[]}return PromiseWorkerPool.prototype.queue=function(t){if(this._startPromise)throw new Error("already started");return this._queue.push(t),this},PromiseWorkerPool.prototype.start=function(){return this._startPromise||(this._startPromise=i.then((t=this,function(){var e,n,r,o,s,a;for(n=0,e=function(){var o,a;return t._queue.length>(o=n)?(n++,(a=t._queue[o])?(t._queue[o]=null,i.then(function(){return a(o,r)}).then(function(t){return s[o]=t}).then(e)):i.then(e)):i.resolve("queue done")},s=new Array(r=t._queue.length),a=[],o=t.numWorkers;a.length<o;)a.push(e());return i.all(a).then(function(){return s})})));var t},PromiseWorkerPool.prototype.then=function(t,e){return this.start().then(t,e)},PromiseWorkerPool.prototype.catch=function(t){return this.start().catch(t)},PromiseWorkerPool}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;i=n(51).defineModule,r=n(56).formattedInspect,(l=n(29)).mergeInto,o=l.isFunction,l.upperCamelCase,e=l.compactFlatten,s=l.merge,a=n(67).objectWithout,i(t,function(t){function RequestError(t){var n,i,l,u,c;RequestError.__super__.constructor.apply(this,arguments),c=(i=this.props=s(t)).sourceLib,n=i.message,this.requestData=i.requestData,this.type=i.type,this.key=i.key,this.status=i.status,this.data=i.data,l=i.responseData,this.responseData=this.data||(this.data=l),this.name=(c||"")+" RequestError "+this.status,this.props.data&&(delete this.props.data,this.props.data=this.responseData),u=this.data&&r({data:this.data}),this.message=n||e([(this.status||"failure")+":",(null!=u?u.length:void 0)<80&&!this.requestData?[this.type,this.key,u]:"\n\n"+r(s({type:this.type,key:this.key,requestData:this.requestData,responseData:this.responseData}))]).join(" "),this.props.stack?(this.stack=this.props.stack,this.props=a(this.props,"stack")):o(Error.captureStackTrace)?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.info=this.props}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(RequestError,Error),RequestError.prototype.toString=function(){return[this.name+": "+this.message,r({props:this.props})].join("\n\n")},RequestError}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(97)},function(t,e,n){(t.exports=n(98)).includeInNamespace(n(100)).addModules({BaseClass:n(101),BaseObject:n(104),DeclarableMixin:n(105),ExtendablePropertyMixin:n(103),WebpackHotLoader:n(102)})},function(t,e,n){t.exports=n(18).addNamespace("Art.ClassSystem",class ClassSystem extends Neptune.PackageNamespace{}._configureNamespace(n(99)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*"},"description":"Enhances javascript/coffeescript classes with features of more evolved class-based languages primarily through a new BaseClass.","license":"ISC","name":"art-class-system","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"1.11.2"}')},function(t,e,n){t.exports={createWithPostCreate:n(101).createWithPostCreate}},function(t,e,n){"use strict";(function(e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S={}.hasOwnProperty,b=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};o=n(42),a=n(102),o.capitalize,l=o.decapitalize,f=o.log,d=o.isFunction,o.objectName,o.isPlainObject,u=o.functionName,o.isString,o.isPlainArray,s=o.Unique,o.callStack,o.Log,f=o.log,p=o.inspectedObjectLiteral,r=o.MinimalBaseObject,c=o.getModuleBeingDefined,o.concatInto,o.mergeInto,m=o.merge,g=o.neq,o.isString,v=o.object,h=o.getSuperclass,y=s.nextUniqueObjectId,i=n(103),t.exports=function(t){var n,o,s,w,x,P;function BaseClass(){this.__uniqueId=null}return function(t,e){for(var n in e)S.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(BaseClass,i(r)),BaseClass.resetStats=function(){return BaseClass.objectsCreated=0,BaseClass.objectsCreatedByType={}},BaseClass.resetStats(),BaseClass._name=null,x=function(t,e){return Object.defineProperty(t,e,{configurable:!0,writable:!1,value:1}),delete t[e]},w=["__proto__","prototype"],BaseClass.imprintObject=s=function(t,e,n,i){var r,o,s,a,l,u,c,h,p,f,y,v,S,P,C,_,E;if(null==n&&(n=!1),C=Object.getOwnPropertyNames(t),f=Object.getOwnPropertyNames(e),i&&(r=c=o=void 0),!n)for(s=0,l=C.length;s<l;s++)P=C[s],b.call(f,P)>=0||(i&&(null!=c?c:c=[]).push(P),x(t,P));for(a=0,u=f.length;a<u;a++)p=f[a],b.call(w,p)>=0||(S=Object.getOwnPropertyDescriptor(t,p),h=Object.getOwnPropertyDescriptor(e,p),v=d(y=h.value),E=d(_=null!=S?S.value:void 0),n&&S&&!v&&!E&&p.match(/^_/)||(i&&(S?g(y,_,!0)&&(null!=o?o:o=[]).push(p):"_name"!==p&&(null!=r?r:r=[]).push(p)),Object.defineProperty(t,p,h)));return i?(c||o||r)&&m({removedProps:c,changedProps:o,addedProps:r}):e},BaseClass.imprintFromClass=function(t,e){var n,i,r,o,a,l,u;return t!==this&&(r=(u=this).namespace,o=u.namespacePath,n=u._name,a=this.prototype.constructor,i=s(this,t,!0,e),l=s(this.prototype,t.prototype,!1,e),this.prototype.constructor=a,this.namespace=r,this.namespacePath=o,this._name=n),e?m({class:i,prototype:l}):this},BaseClass.getHotReloadKey=function(){return this.getName()},BaseClass.createWithPostCreate=n=function(t,n){var i,r;return r=n?(i=t,n):t,i||(i=c()||e.__definingModule),(null!=r?r.postCreate:void 0)?(null!=i?i.hot:void 0)?a.runHot(i,function(t){var e,n,o,s,a,l;return(e=t[n=r.getHotReloadKey()])?(s=e.liveClass,o=!0,e.hotReloadVersion++,e.hotUpdatedFromClass=r,s.namespace._setChildNamespaceProps(s.getName(),r),r._name=s._name,s.classModuleState=e,l=s.imprintFromClass(r,!0),f(((a={})["Art.ClassSystem.BaseClass "+("function"==typeof s.getName?s.getName():void 0)+" HotReload"]={version:e.hotReloadVersion,updates:l},a))):(o=!1,r._hotClassModuleState=t[n]=r.classModuleState=e={liveClass:s=r,hotUpdatedFromClass:null,hotReloadVersion:0}),s.postCreate({hotReloadEnabled:!0,hotReloaded:o,classModuleState:e,module:i})}):r.postCreate({hotReloadEnabled:!1,hotReloaded:!1,classModuleState:{},module:i})||r:r},BaseClass.createHotWithPostCreate=function(t,e){return f.error("createHotWithPostCreate is DEPRICATED"),n(t,e)},BaseClass.postCreate=function(t){return this.getIsAbstractClass()?this.postCreateAbstractClass(t):this.postCreateConcreteClass(t)},BaseClass.setNamespace=function(t){return this._namespace=t},BaseClass.postCreateAbstractClass=function(t){return this},BaseClass.postCreateConcreteClass=function(t){return this},BaseClass.implementsInterface=function(t,e){var n,i;for(n=0,i=e.length;n<i;n++)if("function"!=typeof t[e[n]])return!1;return!0},P=!1,BaseClass.include=function(t){var e,n,i;for(e in f.error("DEPRICATED: BaseClass.include. Use pattern."),P||(P=!0,console.warn("Mixin pattern:\n\n  To define a mixin:\n\n    MyMixin = (superClass) ->\n      class MyMixin extends superClass\n        ... write your mixin as-if it were part of the normal inheritance hierachy\n\n  To use a mixin:\n\n    class MyClass extends MyMixin MySuperClass\n\n  To use two mixins:\n\n    class MyClass extends MyMixin1 MyMixin2 MySuperClass")),t)i=t[e],"included"!==e&&(this[e]||(this[e]=i));for(e in n=t.prototype)i=n[e],e&&(this.prototype[e]||(this.prototype[e]=i));return"function"==typeof t.included&&t.included(this),this},BaseClass.getNamespacePath=function(){var t;return(null!=(t=this.namespacePath)?t.match(this.getName()):void 0)?this.namespacePath:this.namespacePath="(no parent namespace)."+this.getName()},BaseClass.getNamespacePathWithExtendsInfo=function(){return this.getNamespacePath()+" extends "+h(this).getNamespacePath()},BaseClass.getClassName=function(t){return null==t&&(t=this),("function"==typeof t.getName?t.getName():void 0)||t.name},BaseClass.inspect=function(){return this.getNamespacePath()},BaseClass.prototype.inspect=function(){return"<"+this.class.namespacePath+">"},BaseClass.getter({inspectObjects:function(){return console.warn("inspectObjects/getInspectObjects is DEPRICATED. Use: inspectedObjects/getInspectedObjects"),this.getInspectedObjects()},inspectedObjects:function(){var t;return p("<"+(null!=(t=this.class)?t.getNamespacePath():void 0)+">")}}),BaseClass.classGetter({inspectedObjects:function(){return p("class "+this.getNamespacePath())}}),BaseClass.abstractClass=function(){if(this.getIsSingletonClass())throw new Error("abstract classes cannot also be singleton");return this._firstAbstractAncestor=this},BaseClass.classGetter({superclass:function(){return h(this)},isAbstractClass:function(){return!(this.prototype instanceof this._firstAbstractAncestor)},isConcreteClass:function(){return!this.getIsAbstractClass()},abstractPrototype:function(){return this._firstAbstractAncestor.prototype},firstAbstractAncestor:function(){return this._firstAbstractAncestor},isSingletonClass:function(){var t;return(null!=(t=this._singleton)?t.class:void 0)===this},concretePrototypeProperties:function(){var t;return t=this.getAbstractClass().prototype,v(this.prototype,{when:function(e,n){return"constructor"!==n&&t[n]!==e}})}}),BaseClass.getAbstractClass=function(){return this._firstAbstractAncestor},BaseClass.abstractClass(),BaseClass.propertyIsAbstract=function(t){return this.getAbstractClass().prototype[t]===this.prototype[t]},BaseClass.propertyIsConcrete=function(t){return this.getAbstractClass().prototype[t]!==this.prototype[t]},BaseClass.getSingleton=o=function(){var t;if((null!=(t=this._singleton)?t.class:void 0)===this)return this._singleton;if(this.getIsAbstractClass())throw new Error("singleton classes cannot be abstract");return this._singleton=new this},BaseClass.singletonClass=function(){var t;if(this.getIsAbstractClass())throw new Error("singleton classes cannot be abstract");return this.classGetter(((t={singleton:o})[""+l(u(this))]=function(){return this.getSingleton()},t)),null},BaseClass.getter({className:function(){return this.class.getClassName()},class:function(){return this.constructor},keys:function(){return Object.keys(this)},namespacePath:function(){return this.class.getNamespacePath()},classPathName:function(){return this.namespacePath},classPathNameAndId:function(){return this.classPathName+":"+this.objectId},uniqueId:function(){return this.__uniqueId||(this.__uniqueId=y())},objectId:function(){return this.__uniqueId||(this.__uniqueId=y())}}),BaseClass.prototype.freeze=function(){return this.getUniqueId(),Object.freeze(this),this},BaseClass.prototype.implementsInterface=function(t){return Function.BaseClass.implementsInterface(this,t)},BaseClass.prototype.tap=function(t){return t(this),this},BaseClass}()}).call(this,n(5))},function(t,e){t.exports=function(){function WebpackHotLoader(){}return WebpackHotLoader.runHot=function(t,e){var n,i;return(null!=t?t.hot:void 0)?(i=((n=t.hot).data||(n.data={moduleState:{}})).moduleState,t.hot.accept(),t.hot.dispose(function(t){return t.moduleState=i}),e(i)):e({})},WebpackHotLoader}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S={}.hasOwnProperty,b=[].slice;r=(y=n(42)).defineModule,d=y.log,y.object,v=y.upperCamelCase,f=y.lowerCamelCase,o=y.each,h=y.isPlainObject,c=y.isPlainArray,l=y.isFunction,u=y.isNumber,a=y.isBoolean,e=y.cloneStructure,p=y.isString,g=y.mergeInto,i=y.concatInto,s=y.formattedInspect,m=y.merge,r(t,function(){return function(t){return function(n){var r,y,w,x,P,C;function ExtendablePropertyMixin(){return ExtendablePropertyMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)S.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ExtendablePropertyMixin,t),ExtendablePropertyMixin.getOwnProperty=w=function(t,e,n){return t.hasOwnProperty(e)?t[e]:t[e]=n(t,e)},C=function(t,n){switch(!1){case!l(n):return n;case!(p(n)||u(n)||a(n)):return function(e){var i;return null!=(i=e[t])?i:n};default:return function(i){var r;return e(null!=(r=i[t])?r:n)}}},ExtendablePropertyMixin.objectPropertyExtender=P=function(t,e,n){if(void 0===e||null===e)return t;if(p(e))t[e]=n;else{if(!h(e))throw d({mapOrKey:e,value:n,type:null!=e?e.constructor:void 0}),new Error("first value argument must be a plain object or string: "+s({key:e,value:n}));g(t,e)}return t},ExtendablePropertyMixin.arrayPropertyExtender=r=function(t,e){return c(e)?i(t,e):t.push(e),t},y=function(t,e){if(void 0===e)throw new Error("not expecting undefined");return e},x={},ExtendablePropertyMixin.extendableProperty=function(t,e){var n,i,s,a,u;return null==e&&(e=x),l(a=e)&&(d.error("DEPRICATED customPropertyExtender not supported, use extend: option "),e={extend:function(){var t,e;return e=arguments[0],t=2<=arguments.length?b.call(arguments,1):[],a.apply(e,t)}}),i=e.extend,n=e.declarable,s=e.noSetter,o(t,(u=this,function(t,e){var o,a,l,p,d,m,g;return e=f(e),g=v(e),d=u.propInternalName(e),a="get"+g,o="extend"+g,m=function(){if(null!=i)return i;if(h(t))return P;if(c(t))return r;if(void 0===t)throw new Error("defaultValue must not be undefined");return y}(),u[a]=function(){var e;return null!=(e=this.prototype[d])?e:t},u[e]=u[o]=function(e){var n;return n=w(this.prototype,d,C(d,t)),arguments.length>0&&void 0!==e&&(this.prototype[d]=m.apply(null,[n].concat(b.call(arguments)))),n},p=function(){var e;return null!=(e=this[d])?e:t},l=u.prototype[o]=function(e){var n;return n=w(this,d,C(d,t)),arguments.length>0&&void 0!==e&&(this[d]=m.apply(null,[n].concat(b.call(arguments)))),n},n?(u.prototype[a]=p,u.prototype[e]=l):(s||u.addSetter(e,l),u.addGetter(e,p))}))},ExtendablePropertyMixin.declarable=function(t,e){return this.extendableProperty(t,m(e,{declarable:!0}))},ExtendablePropertyMixin}()}})}).call(this,n(2)(t))},function(t,e,n){var i={}.hasOwnProperty;t.exports=function(t){function BaseObject(){return BaseObject.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(BaseObject,n(101)),BaseObject}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l={}.hasOwnProperty;e=(s=n(42)).defineModule,s.log,s.object,a=s.upperCamelCase,o=s.lowerCamelCase,i=s.each,r=s.isPlainObject,e(t,function(){return function(t){return function(e){function DeclarableMixin(){return DeclarableMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(DeclarableMixin,t),DeclarableMixin.declarable=function(t){return i(t,(e=this,function(t,n){var i,s,l,u,c,h,p,d;return r(t)&&(h=t.preprocess,d=t.validate,i=t.extendable,s=t.getter),h||(h=function(t){return t}),d||(d=function(){return!0}),n=o(n),p=a(n),u=e.propInternalName(n),l="get"+p,i?e.extendableProperty(((c={})[""+n]=i,c)):(e[n]=function(t){if(!d(t))throw new Error("invalid value: "+formattedInspect({value:t,name:n}));return this[u]=h(t)},e[l]=s||function(){return this[u]},e.addGetter(n,function(){return this.class[u]}))}));var e},DeclarableMixin}()}})}).call(this,n(2)(t))},function(t,e,n){t.exports=n(107)},function(t,e,n){(t.exports=n(108)).includeInNamespace(n(110)).addModules({ConfigRegistry:n(112),Configurable:n(115),Configuration:n(111),Lib:n(114),Main:n(113)})},function(t,e,n){t.exports=n(18).addNamespace("Art.Config",class Config extends Neptune.PackageNamespace{}._configureNamespace(n(109)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-events":"*"},"description":"A powerful yet simple tool for configuring all your libraries consistently.","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","mocha":"^6.2.0","mock-fs":"^4.10.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"license":"ISC","name":"art-config","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"1.13.0"}')},function(t,e,n){t.exports=[{Config:n(111),config:{yesArtConfig:!0},configName:"Development",defaultArtConfigName:"Development"},n(113)]},function(t,e,n){(function(t){var e,i,r,o,s,a,l={}.hasOwnProperty;o=(a=n(42)).defineModule,a.log,a.merge,s=a.mergeInto,r=a.deepMerge,e=n(96).BaseObject,i=n(112),o(t,function(t){function Configuration(){return Configuration.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Configuration,e),Configuration.abstractClass(),Configuration.register=function(){return i.registerConfig(this.getName(),this.getProps())},Configuration.postCreateConcreteClass=function(t){var e,n;return e=t.hotReloaded,(n=this.getSuperclass())&&this.deepMergeInDefaults(n.getConcretePrototypeProperties()),this.register(),e&&i.reload(),Configuration.__super__.constructor.postCreateConcreteClass.apply(this,arguments)},Configuration.getProps=function(){return this.getConcretePrototypeProperties()},Configuration.deepMergeInDefaults=function(t){return s(this.prototype,r(t,this.getProps()))},Configuration.deepMergeInConfig=function(t){return s(this.prototype,r(this.getProps(),t))},Configuration}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty,l=[].slice;i=(s=n(42)).defineModule,s.log,s.Promise,s.inspect,s.formattedInspect,s.merge,s.deepMerge,s.mergeInto,s.parseQuery,o=s.pushIfNotPresent,r=s.isPlainObject,s.isString,s.upperCamelCase,s.expandPathedProperties,s.clone,s.compactFlatten,e=n(96).BaseObject,i(t,function(t){function ConfigRegistry(){return ConfigRegistry.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ConfigRegistry,e),ConfigRegistry.configurables=[],ConfigRegistry.configs={},ConfigRegistry.registerConfig=function(t,e){if(!r(e))throw new Error("config must be a plain object");return ConfigRegistry.configs[t]=e},ConfigRegistry.registerConfigurable=function(t){return o(ConfigRegistry.configurables,t)},ConfigRegistry.configure=function(){var t,e;return t=1<=arguments.length?l.call(arguments,0):[],console.error("DEPRICATED: use Art.Config.configure"),(e=Neptune.Art.Config).configure.apply(e,t)},ConfigRegistry}())}).call(this,n(2)(t))},function(t,e,n){(function(t,e){var i,r,o,s,a,l,u,c,h,p,d,f=[].slice;s=(p=n(42)).defineModule,u=p.log,p.Promise,p.inspect,p.formattedInspect,p.merge,o=p.deepMerge,c=p.mergeInto,p.parseQuery,p.pushIfNotPresent,p.isPlainObject,p.isString,p.upperCamelCase,a=p.expandPathedProperties,p.clone,r=p.compactFlatten,i=n(112),d=n(114),h=d.normalizeArtConfigName,l=d.getExternalEnvironment,s(t,function(){var t,n,s;function Main(){}return Main.getArtConfigName=function(){return Neptune.Art.Config.configName},Main.getArtConfig=t=function(){return Neptune.Art.Config.config},Main.getDefaultArtConfigName=n=function(){return Neptune.Art.Config.defaultArtConfigName},Main.getArtConfigSave=function(){var t,e,n,r,o;for(n={},t=0,e=(r=i.configurables).length;t<e;t++)(o=r[t].getConfigSave())&&c(n,o);return n},s=function(t){return Neptune.Art.Config.configName=t},Main.configure=function(){var c,p,d,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M;for(b=1<=arguments.length?f.call(arguments,0):[],d=(T=Main.configureOptions=o.apply(null,b)).artConfigName,p=T.artConfig,c=T.__testEnv,E=T.onConfig,x=l(c),y=t(),w=n(),v=h(x.artConfigName||d||e.artConfigName)?((v=h(x.artConfigName||d||e.artConfigName))&&!i.configs[v]&&u.warn("ArtConfig.configure: no config registered with name: '"+v+"'"),v):w,s(v),Main.resetCurrentConfig(),k=r([function(){var t,e,n,r;for(r=[],t=0,e=(n=i.configurables).length;t<e;t++)S=n[t],r.push(S.getPathedDefaultConfig());return r}(),i.configs[v],e.artConfig,p,x.artConfig]),P=0,C=k.length;P<C;P++)g=k[P],a(g,y);return(M=y.verbose)||(M=null!=(I=Main.configureOptions)?I.verbose:void 0),M&&(u("------------- ConfigRegistry: inputs"),u({ConfigRegistry:{configNames:Object.keys(i.configs),configurables:function(){var t,e,n,r;for(r=[],t=0,e=(n=i.configurables).length;t<e;t++)m=n[t],r.push(m.namespacePath);return r}(),setConfigName:{algorithm:"select LAST non-null",inputs:{defaultArtConfigName:w,"global.artConfigName":e.artConfigName,"arguments.artConfigName":d,"environment.artConfigName":x.artConfigName}},setConfig:{algorithm:"deep, pathed merge-all, LAST has priority",inputs:(_={defaultConfigs:function(){var t,e,n,r;for(r=[],t=0,e=(n=i.configurables).length;t<e;t++)S=n[t],r.push(S.getPathedDefaultConfig());return r}()},_["configs."+v]=i.configs[v],_["global.artConfig"]=e.artConfig,_["arguments.artConfig"]=p,_["environment.artConfig"]=x.artConfig,_)}}}),u("------------- ConfigRegistry: configuring Configurables...")),Main._configureAllConfigurables(),M&&(u("------------- ConfigRegistry: configured"),u({Art:{configName:v,config:y}}),u("------------- ConfigRegistry: done")),"function"==typeof E&&E(y),e.artConfig=y,e.artConfigName=v,y},Main.resetCurrentConfig=function(){var e,n,i;for(n in i=[],e=t())e[n],i.push(delete e[n]);return i},Main.reload=function(){return Main.configure(Main.configureOptions)},Main._configureAllConfigurables=function(){var e,n,r;for(e=0,n=(r=i.configurables).length;e<n;e++)r[e].configure(t());return this._notifyConfigurablesConfigured()},Main._notifyConfigurablesConfigured=function(){var t,e,n,r,o;for(o=[],e=0,n=(r=i.configurables).length;e<n;e++)t=r[e],o.push(t.configured());return o},Main}())}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c;e=(u=n(42)).defineModule,l=u.log,u.Promise,u.inspect,i=u.formattedInspect,u.merge,u.deepMerge,u.mergeInto,u.parseQuery,u.pushIfNotPresent,o=u.isPlainObject,s=u.isString,c=u.upperCamelCase,u.expandPathedProperties,u.clone,u.compactFlatten,r=u.getEnv,a=/^(\[.*\]|\{.*\}|\".*\"|((-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|true|false|null))$/,e(t,function(){var t;function Lib(){}return Lib.smartJsonDecode=t=function(t){return s(t)&&a.test(t)?JSON.parse(t):null!=t?t:null},Lib.getExternalEnvironment=function(e){var n,a,u,c,h,p;for(c in null==e&&(e=r()),n=e.artConfig,a=e.artConfigName,n=function(){if(o(n))return n;if(!s(n))return{};try{return JSON.parse(n)}catch(t){return u=t,l.error("\nInvalid 'artConfig' from externalEnvironment. Must be valid JSON.\n\n"+i({externalEnvironment:e})+"\n\nartConfig: "+i(n)+"\n\nerror: "+u+"\n"),null}}(),e)p=e[c],(h=c.match(/^artConfig([\._])(.+)$/))&&("_"===h[1]?n[h[2].replace(/_/g,".")]=t(p):n[h[2]]=t(p));return{artConfig:n,artConfigName:a}},Lib.normalizeArtConfigName=function(t){switch(t){case"dev":return"Development";case"prod":return"Production";default:return t&&c(t)}},Lib}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h={}.hasOwnProperty,p=[].slice;o=(c=n(42)).defineModule,s=c.log,c.merge,c.isPlainObject,a=c.mergeInto,c.deepMerge,c.isPlainObject,c.ErrorWithInfo,u=c.neq,e=n(96).BaseClass,l=n(108),i=n(112),r=n(116).EventedMixin,o(t,function(t){function Configurable(){return Configurable.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Configurable,r(e)),Configurable.abstractClass(),Configurable.declarable({defaults:{}}),Configurable.getDefaultConfig=function(){return this.getDefaults()},Configurable.extendConfig=function(){return this.hasOwnProperty("config")?this.config:this.config={}},Configurable.reset=function(){var t,e,n,i;for(n in e=this.getDefaults(),t=this.extendConfig())t[n],null==e[n]&&delete t[n];return a(t,e),this.namespace!==l&&null!=(i=this.namespace)&&(i.config||(i.config=t)),t},Configurable.getInspectedObjects=function(){var t;return(t={})[""+this.getConfigurationPathString()]=this.config,t},Configurable.getPathedDefaultConfig=function(){var t;return(t={})[""+this.getConfigurationPathString()]=this.getDefaults(),t},Configurable.configure=function(t){var e;return t.verbose&&s({Configurable:(e={},e[""+this.getConfigurationPathString()]=this.getConfigurationFromPath(t),e)}),a(this.reset(),this.getConfigurationFromPath(t))},Configurable.getConfigSave=function(){var t,e,n,i,r,o,s,a;for(n in r={},e=this.getDefaults(),t=0,s=null!=(o=this.config)?o:{})a=s[n],u(a,e[n])&&(t++,r[n]=a);if(t>0)return(i={})[""+this.getConfigurationPathString()]=r,i},Configurable.on=function(){var t,e;return t=1<=arguments.length?p.call(arguments,0):[],(e=this.getSingleton()).on.apply(e,t)},Configurable.configured=function(){return this.getSingleton().handleEvent("configured",{config:this.config})},Configurable.getConfigurationPath=function(){var t,e,n;return(n=this.getNamespacePath().split("."))[0],e=3<=n.length?p.call(n,1,t=n.length-1):(t=1,[]),n[t++],e},Configurable.getConfigurationPathString=function(){return this.getConfigurationPath().join(".")},Configurable.getConfigurationFromPath=function(t,e){var n,i,r;for(null==e&&(e=this.getConfigurationPath()),i=0,r=e.length;i<r;i++)n=e[i],t=null!=t?t[n]:void 0;return t},Configurable._register=function(){return this.reset(),i.registerConfigurable(this)},Configurable.postCreateConcreteClass=function(t){return t.hotReloaded?i.reload():this._register(),Configurable.__super__.constructor.postCreateConcreteClass.apply(this,arguments)},Configurable}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(117)},function(t,e,n){t.exports=n(118),t.exports.addModules({Event:n(121),EventedBaseMixin:n(122),EventedMixin:n(131),EventedObject:n(133),EventEpoch:n(123),EventManager:n(132)})},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(119).addNamespace("Events",function(t){function Events(){return Events.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Events,Neptune.PackageNamespace),Events.version=n(120).version,Events}())},function(t,e,n){t.exports=n(18).vivifySubnamespace("Art"),n(118)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-epoched-state":"*"},"description":"Epoched event system","license":"ISC","name":"art-events","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"1.3.0"}')},function(t,e,n){var i,r,o,s,a,l={}.hasOwnProperty;a=n(42),r=a.currentSecond,s=a.merge,i=n(96).BaseClass,o={},t.exports=function(t){function Event(t,e,n){this.type=t,this.props=null!=e?e:o,this.timeStamp=null!=n?n:r()}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Event,i),Event.prototype.clone=function(){return new this.class(this.type,this.props,this.timeStamp)},Event.prototype.mergeInProps=function(t){return this.props=s(this.props,t),this},Event}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h={}.hasOwnProperty;i=(u=n(42)).defineModule,l=u.isString,s=u.isFunction,u.log,a=u.isPlainObject,o=u.inspect,c=u.throwErrorOutOfStack,e=n(121),r=n(123).eventEpoch,i(t,function(){return function(t){return function(n){var i;function EventedBaseMixin(){return EventedBaseMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EventedBaseMixin,t),EventedBaseMixin.typeFromEventOrType=i=function(t){return t&&(t.type||t)},EventedBaseMixin.prototype.queueEvent=function(t,e){var n,o;return!(!(n=i(t))||!this._hasEventHandler(n))&&(r.queue((o=this,function(){return o.handleEvent(t,e)})),!0)},EventedBaseMixin.prototype.handleEvent=function(t,e){var n,r,o;if(!((o=i(t))&&this._hasEventHandler(o)&&(r=this.normalizeEvent(t,e))))return!1;r.target=this;try{this._sendToEventHandler(r)}catch(t){n=t,this._handleErrorInHandler(r,"unknown",n)}return r.target=null,!0},EventedBaseMixin.prototype.normalizeEvent=function(t,n){var i,r,o;if(t instanceof e)return t;if(!l(o=t))throw new Error("expected event or event-type-string");if(!s(r=n))return new e(o,n);switch(i=r(),!1){case!(i instanceof e):return i;case!a(i):return new e(o,i);case null==i:throw new Error("expecting event or plain-object");default:return null}},EventedBaseMixin.prototype._hasEventHandler=function(t){throw new Error("must implement")},EventedBaseMixin.prototype._sendToEventHandler=function(t){throw new Error("must implement")},EventedBaseMixin.prototype._handleErrorInHandler=function(t,e,n){return console.log("EventedObjectBase: exception in handler. Error:",n),console.log("Event: "+o(t,1)),console.log("Handler:",e),console.log("Stack:",n.stack),c(n)},EventedBaseMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;i=(r=n(42)).defineModule,r.log,e=n(124).EpochClass,i(t,function(t){function EventEpoch(){return EventEpoch.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EventEpoch,e),EventEpoch.singletonClass(),EventEpoch.prototype.queue=function(t){return this.queueItem(t)},EventEpoch.prototype.logEvent=function(t,e){},EventEpoch}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(125)},function(t,e,n){(t.exports=n(126)).includeInNamespace(n(129)).addModules({EpochClass:n(130)})},function(t,e,n){t.exports=n(127).addNamespace("EpochedState",class EpochedState extends Neptune.PackageNamespace{}._configureNamespace(n(128)))},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Art"),n(126)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*"},"description":"Art.Epoch","license":"ISC","name":"art-epoched-state","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"1.2.1"}')},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>({Epoch:n(130)}))}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty,c=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};r=(a=n(42)).defineModule,s=a.isFunction,a.inspect,i=a.Promise,l=a.requestAnimationFrame,o=a.evalAndThrowErrorsOutOfStack,e=n(96).BaseClass,r(t,function(t){function EpochClass(t){null==t&&(t={}),EpochClass.__super__.constructor.apply(this,arguments),this._emptyQueueAfterProcessing=!!t.emptyQueueAfterProcessing,this._queuedItems=[],this._nextReadyQueue=[],this._epochQueued=!1,this._processingEpoch=!1,this._epochCount=0,this._frameSecond=0}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EpochClass,e),EpochClass.getter("processingEpoch epochQueued epochCount emptyQueueAfterProcessing frameSecond",{epochLength:function(){return this._queuedItems.length}}),EpochClass.prototype.updateGlobalCounts=function(){},EpochClass.prototype.onNextReady=function(t,e,n){return null==e&&(e=!0),e&&!this._processingEpoch&&this.queueNextEpoch(),new i((r=this,function(e,o){return r._nextReadyQueue.push(function(){return i.then(function(){return t?t(n):n}).then(e).catch(o)})}));var r},EpochClass.prototype._ready=function(){var t,e,n,i,r;if((i=this._nextReadyQueue).length>0){for(this._nextReadyQueue=[],r=[],e=0,n=i.length;e<n;e++)t=i[e],r.push(o(function(){return t()}));return r}},EpochClass.prototype.queueItem=function(t){return t&&(this._queuedItems.push(t),this.queueNextEpoch()),t},EpochClass.prototype.isItemQueued=function(t){return c.call(this._queuedItems,t)>=0},EpochClass.prototype.queueNextEpoch=function(){if(!this._epochQueued)return this._epochQueued=!0,l((t=this,function(e){return t._frameSecond=e/1e3,t._epochQueued=!1,t.processEpoch()}));var t},EpochClass.prototype.flushEpochNow=function(){return this.processEpoch()},EpochClass.prototype.processEpoch=function(){var t;return this._processingEpoch=!0,t=this._queuedItems,this._emptyQueueAfterProcessing?(this.processEpochItemsWithErrorHandling(t),this._queuedItems=[]):(this._queuedItems=[],this.processEpochItemsWithErrorHandling(t)),this._processingEpoch=!1,this._epochCount++,this._ready()},EpochClass.prototype.processEpochItemsWithErrorHandling=function(t){return o((e=this,function(){return e.processEpochItems(t)}));var e},EpochClass.prototype.processEpochItems=function(t){var e,n,i,r;for(r=[],e=0,i=t.length;e<i;e++)n=t[e],s(n)?r.push(n()):r.push(n.processEpoch());return r},EpochClass}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s={}.hasOwnProperty;r=(o=n(42)).defineModule,o.isFunction,o.log,o.isPlainObject,e=n(132),i=n(122),r(t,function(){return function(t){return function(n){function EventedMixin(){EventedMixin.__super__.constructor.apply(this,arguments),this._eventManager=null}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EventedMixin,i(t)),EventedMixin.getter({eventManager:function(){return this._eventManager||(this._eventManager=new e(this))}}),EventedMixin.prototype.on=function(t){return this.eventManager.on(this.preprocessEventHandlers(t))},EventedMixin.prototype.onNext=function(t){return this.eventManager.onNext(t)},EventedMixin.prototype.clearEventHandlers=function(){return this._eventManager=null},EventedMixin.prototype.removeListeners=function(t){var e;return null!=(e=this._eventManager)?e.removeListeners(t):void 0},EventedMixin.prototype.preprocessEventHandlers=function(t){return t},EventedMixin.prototype._sendToEventHandler=function(t){var e;return null!=(e=this._eventManager)?e.handleEvent(t):void 0},EventedMixin.prototype._hasEventHandler=function(t){var e;return null!=(e=this._eventManager)?e.hasHandler(t):void 0},EventedMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d={}.hasOwnProperty;a=(h=n(42)).defineModule,r=h.Log,h.nextTick,u=h.isFunction,l=h.inspect,s=h.clone,o=h.arrayWith,p=h.throwErrorOutOfStack,e=n(96).BaseClass,i=n(121),c=r.rawErrorLog,a(t,function(t){function EventManager(t){this.parent=t,this.eventHandlers={}}return function(t,e){for(var n in e)d.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EventManager,e),EventManager.prototype.hasHandler=function(t){var e;return!!((e=this.eventHandlers[t])&&e.length>0)},EventManager.prototype.on=function(t){var e,n,i;for(i in n=[],t)if(e=t[i]){if(!u(e))throw new Error("EventManager: action is not a function for "+l(i)+" event handler. (action: "+l(e)+", parent: "+l(this.parent)+")");n.push(this.eventHandlers[i]=o(this.eventHandlers[i],{action:e,oneTime:!1}))}return n},EventManager.prototype.removeListeners=function(t){var e,n,i,r,o,s;for(s in i=0,t)e=t[s],(o=this.eventHandlers[s])&&(n=o.length,this.eventHandlers[s]=function(){var t,n,i;for(i=[],t=0,n=o.length;t<n;t++)(r=o[t]).action!==e&&i.push(r);return i}(),i=n-this.eventHandlers[s].length);return i},EventManager.prototype.onNext=function(t){var e,n,i,r;for(r in i=[],t)e=t[r],null==(n=this.eventHandlers)[r]&&(n[r]=[]),i.push(this.eventHandlers[r].push({action:e,oneTime:!0}));return i},EventManager.prototype.countOneTimeHandlersFor=function(t){var e,n,i,r;if(e=0,n=this.eventHandlers[t])for(i=0,r=n.length;i<r;i++)n[i].oneTime&&e++;return e},EventManager.prototype.handleEvent=function(t){return"string"==typeof t&&(t=new i(t)),this.sendToHandlers(t.type,t)},EventManager.prototype.handleEvents=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(this.handleEvent(e));return r},EventManager.prototype.sendToHandlers=function(t,e){var n,i,r,o,s,a;if((o=this.eventHandlers[t])&&o.length>0){for(i=!1,s=0,a=o.length;s<a;s++){r=o[s];try{r.oneTime&&(r.remove=i=!0),(0,r.action)(e)}catch(t){n=t,this.handleErrorInHandler(r,e,n)}}return i?this.eventHandlers[e.type]=function(){var e,n,i,o;for(o=[],e=0,n=(i=this.eventHandlers[t]).length;e<n;e++)(r=i[e]).remove||o.push(r);return o}.call(this):void 0}},EventManager.prototype.handleErrorInHandler=function(t,e,n){return"eventException"===e.type?(c("exception in eventException handler.\nEvent:"+l(e,1)+".\n\nError:\n"+n.stack),p(n)):this.eventHandlers.eventException?this.handleEvent(new i("eventException",{event:s(e),exception:n,handler:t})):(c("exception in handler AND no eventException handler. Error:"),c(n),c("Event: "+l(e,1)),c("Stack:\n"+n.stack),p(n))},EventManager}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;r=(s=n(42)).defineModule,o=s.log,i=n(131),e=n(96).BaseClass,r(t,function(t){function EventedObject(){o.error("EventedObject is DEPRICATED - use EventedMixin"),EventedObject.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EventedObject,i(e)),EventedObject}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(135)},function(t,e,n){(t.exports=n(136)).includeInNamespace(n(139)).addModules({ArtEryBaseObject:n(236),Config:n(159),Filter:n(233),FilterTools:n(257),KeyFieldsMixin:n(259),Pipeline:n(260),PipelineQuery:n(261),PipelineRegistry:n(156),PrefetchedRecordsCache:n(247),Request:n(234),RequestHandler:n(238),RequestResponseBase:n(235),Response:n(237),Session:n(258),StandardImport:n(140),UpdateAfterMixin:n(262)}),n(230)},function(t,e,n){t.exports=n(18).addNamespace("Art.Ery",class Ery extends Neptune.PackageNamespace{}._configureNamespace(n(137))),n(138)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-events":"*","art-express-server":"*","art-flux":"*","compress":"^0.99.0","express":"^4.17.1","jsonwebtoken":"^8.5.1","throng":"^4.0.0","uuid":"^3.3.2"},"description":"A pipelined business-logic framework for cloud-backed data. ArtEry conceptially allows you to write apps 100% as client-code, but with the security and performance of cloud-code.","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","mocha":"^6.2.0","mock-fs":"^4.10.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"license":"ISC","name":"art-ery","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer","testServer":"caf ./TestServer.caf"},"version":"1.108.3"}')},function(t,e,n){t.exports=n(136).addNamespace("Filters",class Filters extends Neptune.PackageNamespace{})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["config","pipelines","Promise"],[e,n(140),n(156),n(159)],(t,e,r)=>[n(230),n(257),{config:t,pipelines:e,session:n(258).session,package:n(137),version:n(137).version,prefetchedRecordsCache:n(247).prefetchedRecordsCache,sendInitializeRequestToAllPipelines:function(){return r.all(i.array(e,t=>t.initialize({originatedOnServer:!0}),t=>t.class.getHandlers().initialize))},initForTesting:function(){return n(135),r.then(()=>n(135).config.remoteServer?void 0:n(135).sendInitializeRequestToAllPipelines())},getArtEryRemoteServer:function(){return t.remoteServer},_reset:function(t){return n(156)._reset(t),n(230)._resetFilters()}}]))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(42).mergeWithSelf(n(96),n(141),n(147)))}).call(this,n(2)(t))},function(t,e,n){var i,r;t.exports=null!=(i="undefined"!=typeof Neptune&&null!==Neptune&&null!=(r=Neptune.Art)?r.CommunicationStatus:void 0)?i:n(142)},function(t,e,n){(t.exports=n(143)).includeInNamespace(n(146))},function(t,e,n){t.exports=n(144).addNamespace("CommunicationStatus",class CommunicationStatus extends Neptune.PackageNamespace{}._configureNamespace(n(145)))},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Art"),n(143)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","bugs":"https:/github.com/art-suite/art-communication-status/issues","dependencies":{"art-build-configurator":"*"},"description":"Simplified system of statuses for HTTP and any other network protocol","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","coffee-loader":"^0.7.3","css-loader":"^3.0.0","json-loader":"^0.5.7","mocha":"^6.2.0","mock-fs":"^4.10.0","script-loader":"^0.7.2","style-loader":"^1.0.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"homepage":"https://github.com/art-suite/art-communication-status","license":"ISC","name":"art-communication-status","repository":{"type":"git","url":"https://github.com/art-suite/art-communication-status.git"},"scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"1.5.3"}')},function(t,e){t.exports=function(){var t,e,n;function CommunicationStatus(){}for(e in CommunicationStatus.communicationStatuses=t={success:{httpStatus:200},missing:{httpStatus:404,failure:!0},clientFailure:{httpStatus:400,clientFailure:!0,failure:!0},clientFailureNotAuthorized:{httpStatus:403,clientFailure:!0,failure:!0},serverFailure:{httpStatus:500,failure:!0,serverFailure:!0},networkFailure:{failure:!0},aborted:{failure:!0},pending:{},failure:{httpStatus:500,failure:!0}},n=CommunicationStatus.communicationStatuses)n[e],CommunicationStatus[e]=e;return CommunicationStatus.isClientFailure=function(e){var n;return!!(null!=(n=t[e])?n.clientFailure:void 0)},CommunicationStatus.isServerFailure=function(e){var n;return!!(null!=(n=t[e])?n.serverFailure:void 0)},CommunicationStatus.isFailure=function(e){var n;return!!(null!=(n=t[e])?n.failure:void 0)},CommunicationStatus.isSuccess=function(t){return"success"===t},CommunicationStatus.validStatus=function(t){return CommunicationStatus[t]===t},CommunicationStatus.decodeHttpStatus=function(t){var e;if(null==t)return{status:CommunicationStatus.networkFailure,message:"network failure"};if(null==(e=function(){switch(t/100|0){case 2:return this.success;case 3:return this.missing;case 4:switch(t){case 403:return this.clientFailureNotAuthorized;case 404:return this.missing;default:return this.clientFailure}break;case 5:switch(t){case 502:case 503:case 504:return this.networkFailure;case 501:case 505:case 530:return this.clientFailure;case 500:return this.serverFailure}}}.call(CommunicationStatus)))throw new Error("unhandled httpStatus: "+t);return{status:e,httpStatus:t,message:e+" ("+t+")"}},CommunicationStatus.encodeHttpStatus=function(t){var e,n;if(!(e=null!=(n=CommunicationStatus.communicationStatuses[t])?n.httpStatus:void 0))throw new Error("There is no valid HttpStatus for "+t+".");return e},CommunicationStatus}()},function(t,e,n){t.exports=n(148)},function(t,e,n){t.exports=n(149)},function(t,e,n){t.exports=n(150),t.exports.includeInNamespace(n(152)).addModules({DataTypes:n(154),FieldTypes:n(155),Validator:n(153)})},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(18).addNamespace("Art.Validation",function(t){function Validation(){return Validation.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Validation,Neptune.PackageNamespace),Validation.version=n(151).version,Validation}())},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-communication-status":"*"},"description":"Validate object props.","license":"ISC","name":"art-validation","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"1.9.1"}')},function(t,e,n){var i,r,o;i=(o=n(153)).normalizeFieldProps,r=o.normalizeFields,t.exports={normalizeFieldProps:i,normalizeFields:r}},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x={}.hasOwnProperty;v=n(42),d=v.merge,p=v.log,v.BaseClass,b=v.shallowClone,h=v.isString,c=v.isPlainObject,u=v.isPlainArray,s=v.Promise,l=v.formattedInspect,g=v.present,v.select,v.emailRegexp,f=v.mergeIntoUnless,w=v.w,v.clone,r=v.ErrorWithInfo,a=v.array,m=v.object,v.isDate,y=v.pushIfNotPresent,v.toDate,v.toMilliseconds,v.toSeconds,(S=n(154)).booleanDataType,S.numberDataType,S.stringDataType,S.objectDataType,S.arrayDataType,S.functionDataType,S.dateDataType,o=n(155),i=n(96).BaseClass,n(154),t.exports=function(t){var e,n,v,S,P,C,_,E;function Validator(t,e){this._fieldProps={},this._requiredFields=[],this.addFields(t),e&&(this.exclusive=e.exclusive,this.context=e.context)}return function(t,e){for(var n in e)x.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Validator,i),P=function(t){var e,n;return(e=t.instanceof)?(n=t.validate,d(t,{validate:function(t){return t instanceof e&&(!n||n(t))}})):t},C=function(t){var e,n,i,r;for(e in n=null,t)r=t[e],"fields"!==e&&c(i=r)&&(n||(n=b(t)),n[e]=!0,f(n,C(i)));return n||t},n=function(t){if(t.requiredPresent)throw new Error("DEPRICATED: requiredPresent. Use: present: true");if(h(t.required))throw new Error("DEPRICATED: required can no longer specifiy the field-type. Use: required: fieldType: myFieldTypeString OR 'required myFieldTypeString'");if(h(t.present))throw new Error("DEPRICATED: present can no longer specifiy the field-type. Use: present: fieldType: myFieldTypeString OR 'present myFieldTypeString'");return t},S=function(t){var e;return e=t.fieldType,t.fields&&(e||(e="object")),h(e)?d(o[e],t):t},Validator.normalizeFields=function(t){return m(t,v)},Validator.normalizeFieldProps=v=function(t){var i,r,s,a,p,m;return i=function(){var e,i,g;if(c(t))return S(P(n(C(t))));if(u(r=t))return s=function(){var e,n,i;for(i=[],e=0,n=r.length;e<n;e++)t=r[e],i.push(v(t));return i}(),d.apply(null,s);if(h(p=t)){for(t={},e=0,i=(g=w(p)).length;e<i;e++)a=g[e],(m=o[a])?(t.fieldType=a,f(t,m)):t[a]=!0;return t}if(!0===t)return o.any;throw new Error("fieldType must be a string or plainObject. Was: "+l(t))}(),e(d(o[i.fieldType],i))},e=function(t){var e,n,i,r,o;return r=t.postValidate,n=t.maxLength,i=t.minLength,e=t.fields,null==n&&null==i&&null==e||(e&&(o=new Validator(e,{exclusive:!0}),t.preprocess=function(t,e){return o.preprocessFields(t,e)}),t.postValidate=function(t,e,s){if(r&&!r(t,e,s))return!1;if(null==t)return!0;if(null!=n&&t.length>n)return!1;if(null!=i&&t.length<i)return!1;try{return null!=o&&o.validate(t),!0}catch(t){return!1}}),t},Validator.property("exclusive"),Validator.prototype.addFields=function(t){var e,n;for(e in t)n=t[e],((n=this._addField(e,n)).required||n.present)&&y(this._requiredFields,e);return null},Validator.getter({inspectedObjects:function(){return{Validator:this._fieldProps}}}),Validator.prototype.preCreate=function(t,e){return p.error("Validator.preCreate is DEPRICATED. Use .validate or .validateCreate"),s.resolve(t).then((n=this,function(t){return n.preCreateSync(t,e)}));var n},Validator.prototype.preUpdate=function(t,e){return p.error("Validator.preUpdate is DEPRICATED. Use .validateUpdate"),s.resolve(t).then((n=this,function(t){return n.preUpdateSync(t,e)}));var n},Validator.prototype.validateSync=function(){throw new Error("DEPRICATED: use validate")},Validator.prototype.preCreateSync=function(t,e){return null==t&&(t={}),p.error("preCreateSync is DEPRICATED. use .validateCreate or just .validate"),this.validateCreate(t,e)},Validator.prototype.preUpdateSync=function(t,e){return null==t&&(t={}),p.error("preUpdateSync is DEPRICATED. use validateUpdate"),this.validateUpdate(t,e)},Validator.prototype.validateCreate=E=function(t,e){var n,i;return null==t&&(t={}),i=null,function(){try{return this.requiredFieldsPresent(t)&&this.presentFieldsValid(t)&&this.postValidateFields(i=this.preprocessFields(t,!0))}catch(i){return n=i,p.error({Validator:{error_in:{validateCreate:{fields:t,options:e,this:this,error:n}}}})}}.call(this)||this._throwError(t,i,e,!0)},Validator.prototype.validate=E,Validator.prototype.validateUpdate=function(t,e){var n,i;return null==t&&(t={}),function(){try{return this.presentFieldsValid(t)&&this.postValidateFields(i=this.preprocessFields(t))}catch(i){return n=i,p.error({Validator:{error_in:{validateUpdate:{fields:t,options:e,this:this,error:n}}}})}}.call(this)||this._throwError(t,i,e)},Validator.prototype._throwError=function(t,e,n,i){var o,s,l,u,c,h;throw s={errors:o={}},u=[],a(this.invalidFields(t),u,(h=this,function(t){return o[t]="invalid",h.exclusive&&!h._fieldProps[t]?"unexpected '"+t+"' field":"invalid "+t})),a(this.postInvalidFields(e),u,function(t){return o[t]="invalid","invalid processed "+t}),i&&a(this.missingFields(t),u,function(t){return o[t]="missing","missing "+t}),l=(null!=(c=null!=n?n.context:void 0)?c:this.context)+" "+(i?"Create":"Update")+"-Validation failed. Invalid fields: "+u.join(", "),s.fields=t,new r(l.trim(),s)},Validator.prototype.presentFieldPostValid=function(t,e,n){var i,r;return!(i=this._fieldProps[e])||(!(r=i.postValidate)||null==n||null===n||void 0===n||r(n,e,t))},Validator.prototype.presentFieldValid=function(t,e,n){var i,r;return(i=this._fieldProps[e])?(r=i.validate,!(i.present&&!g(n))&&(!r||null==n||null===n||void 0===n||r(n,e,t))):!this.exclusive},Validator.prototype.requiredFieldPresent=function(t,e){var n;return!(n=this._fieldProps[e])||(!n.required||null!=t[e])&&!(n.present&&!g(t[e]))},Validator.prototype.presentFieldsValid=function(t){var e,n;for(e in t)if(n=t[e],!this.presentFieldValid(t,e,n))return!1;return!0},Validator.prototype.requiredFieldsPresent=function(t){var e,n;for(e in n=this._fieldProps)if(n[e],!this.requiredFieldPresent(t,e))return!1;return!0},Validator.prototype.postValidateFields=function(t){var e,n;for(e in t)if(n=t[e],!this.presentFieldPostValid(t,e,n))return!1;return t},Validator.prototype.preprocessFields=_=function(t,e){var n,i,r,o,s,a;return o=null,e&&(t||(t={})),t&&function(){var l,u;for(n in u=[],l=this._fieldProps)s=l[n],r=s.preprocess,a=void 0!==(i=t[n])?i:e&&s.default,r&&null!=a&&(a=r(a,e)),a!==i?(o||(o=b(t)),u.push(o[n]=a)):u.push(void 0);return u}.call(this),o||t||{}},Validator.prototype.preprocess=_,Validator.prototype.invalidFields=function(t){var e,n,i;for(e in n=[],t)i=t[e],this.presentFieldValid(t,e,i)||n.push(e);return n},Validator.prototype.postInvalidFields=function(t){var e,n,i;for(e in n=[],t)i=t[e],this.presentFieldPostValid(t,e,i)||n.push(e);return n},Validator.prototype.missingFields=function(t){var e,n,i,r,o;for(o=[],e=0,i=(r=this._requiredFields).length;e<i;e++)n=r[e],this.requiredFieldPresent(t,n)||o.push(n);return o},Validator.prototype._addField=function(t,e){return this._fieldProps[t]=v(e)},Validator}()},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f;r=(f=n(42)).isBoolean,l=f.isNumber,h=f.isString,c=f.isPlainObject,u=f.isPlainArray,s=f.isFunction,o=f.isDate,a=f.isJsonType,p=f.merge,d=f.object,i={boolean:{validate:r},number:{validate:l},string:{validate:h},object:{validate:c},array:{validate:u},function:{validate:s},date:{validate:o},json:{validate:a},any:{}},t.exports=p(i,d(i,{key:function(t,e){return e+"DataType"},with:function(t,e){return e}}))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M;for(y in x=n(42),m=x.isString,f=x.isNumber,h=x.isDate,x.isHexColor,E=x.toMilliseconds,_=x.toDate,T=x.toSeconds,v=x.lowerCase,u=x.emailRegexp,k=x.urlRegexp,x.log,a=(P=i=n(154)).booleanDataType,S=P.numberDataType,C=P.stringDataType,w=P.objectDataType,s=P.arrayDataType,c=P.functionDataType,l=P.dateDataType,o=P.anyDataType,g=P.jsonDataType,M=n(141).validStatus,d=function(t){return m(t)&&t.match(/^[-_a-z0-9]{1,100}$/i)},p=function(t){return/^#([a-f0-9]{3})|([a-f0-9]{6})/i.test(""+t)},t.exports=r={count:{fromString:b=function(t){return t-0},dataType:S,default:0},boolean:{dataType:a,fromString:function(t){return!!/^ *t *$|true/i.test(t)}},number:{dataType:S,fromString:b},string:{dataType:C},object:{dataType:w},array:{dataType:s},any:{dataType:o},json:{dataType:g,fromString:function(t){return JSON.parse(t)}},id:{required:!0,validate:function(t){return d(t)}},date:{fromString:function(t){return Date.parse(t)},validate:function(t){return m(t)||t instanceof Date},preprocess:function(t){return m(t)?new Date(t):t},dataType:l},timestamp:{fromString:function(t){return E(t)},dataType:S,validate:function(t){return f(t)||h(t)},preprocess:E,decode:_},secondsTimestamp:{dataType:S,fromString:function(t){return T(t)},validate:function(t){return f(t)||h(t)},preprocess:function(t){return T(t)+.5|0},decode:_},fractionalSecondsTimestamp:{dataType:S,fromString:function(t){return T(t)},validate:function(t){return f(t)||h(t)},preprocess:function(t){return T(t)},decode:_},color:{validate:function(t){return p(t)},preprocess:function(t){return""+t}},email:{validate:function(t){return m(t)&&t.trim().match(u)},preprocess:function(t){return v(t.trim())}},url:{validate:function(t){return m(t)&&t.match(k)},preprocess:function(t){return normalizeUrl(t)}},communicationStatus:{validate:function(t){return M(t)}},trimmedString:{validate:function(t){return m(t)},preprocess:function(t){return(t=t.trim()).length>0&&t},maxLength:1024},username:{minLength:3,maxLength:30,present:!0,validate:function(t){return m(t)&&/^\s*\w+\s*$/i.test(t)},preprocess:function(t){return v(t.trim())}},function:{dataType:c}},r)(I=r[y]).fieldType=y,I.dataType||(I.dataType=C),I.validate||(I.validate=i[I.dataType].validate)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseObject","Object"],[e,n(140)],(t,r)=>{return i.defClass(class PipelineRegistry extends(n(157)(t)){},function(t,n,o){let s;this.pipelines=e.artEryPipelines=s={},this.register=function(t){let e,n,r,o;return({singleton:e,_aliases:n}=t),n&&i.each2(n,t=>s[t]=e),r=s[o=e.name]=e,this.handleEvent("register",{name:o,pipeline:r}),e},this._reset=function(t=(()=>!0)){return i.each2(r.keys(s),e=>t(s[e])?delete s[e]:void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(158))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){let e=n(3);e.defMod(t,()=>(function(t){return e.defClass(class ExtendableEventedMixin extends t{},function(t,n,i){this.declarable({eventHandlers:{}},{extend:function(t,n){return e.each2(n,(e,n)=>{let i;return(null!=(i=t[n])?i:t[n]=[]).push(e)}),t}}),this.on=this.eventHandlers,this.handleEvent=function(t,n){return e.each2(this.getEventHandlers()[t],t=>t(n))}})}))}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;(r=n(160)).w,r.Validator,i=r.defineModule,r.mergeInto,r.BaseObject,e=r.Configurable,i(t,function(t){function Config(){return Config.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Config,e),Config.defaults({tableNamePrefix:"",location:"both",apiRoot:"api",remoteServer:null,verbose:!1,returnProcessingInfoToClient:!1,server:{privateSessionKey:"todo+generate+your+one+unique+key"}}),Config.getPrefixedTableName=function(t){return""+Config.config.tableNamePrefix+t},Config}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(161)},function(t,e,n){(t.exports=n(162)).includeInNamespace(n(166)).addModules({ArtFoundationConfig:n(228),Binary:n(229)}),n(184),n(187)},function(t,e,n){t.exports=n(18).addNamespace("Art.Foundation",class Foundation extends Neptune.PackageNamespace{}._configureNamespace(n(163))),n(164),n(165)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC\\"","dependencies":{"art-build-configurator":"*","art-communication-status":"*","art-epoched-state":"*","art-object-tree-factory":"*","art-rest-client":"*","art-validation":"*","atob":"^2.0.3"},"description":"Foundation classes for the Art framework. Javascript extensions.","license":"ISC","name":"art-foundation","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"1.89.2"}')},function(t,e,n){t.exports=n(162).addNamespace("ForHumans",class ForHumans extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(162).addNamespace("Tools",class Tools extends Neptune.PackageNamespace{})},function(t,e,n){var i;t.exports=[n(42),n(96),n(106),n(167),n(184),n(187),{Epoch:n(124).EpochClass,Browser:n(212),Binary:n(167),package:i=n(163),version:i.version}]},function(t,e,n){t.exports=n(168)},function(t,e,n){(t.exports=n(169)).includeInNamespace(n(171)).addModules({BinaryString:n(174),DataUri:n(181),EncodedImage:n(182),File:n(173),Stream:n(180),TypedarraySlicePolyfill:n(172),Utf8:n(179),WriteStream:n(183)})},function(t,e,n){t.exports=n(18).addNamespace("Art.Binary",class Binary extends Neptune.PackageNamespace{}._configureNamespace(n(170)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-communication-status":"*","art-rest-client":"*"},"description":"Art.Binary","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","mocha":"^6.2.0","mock-fs":"^4.10.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"license":"ISC","name":"art-binary","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"1.1.3"}')},function(t,e,n){n(172),t.exports=[n(173),{stream:n(180).stream},[n(174),"binary binaryFromBlob downloadBinaryData isBinary fromBase64"]]},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v;m=n(42).bound,(i=Uint8Array.prototype).slice||(i.slice=g=function(t,e){var n,i,r,o,s,a;for(null==e&&(e=this.length),t<0&&(t+=this.length),e<0&&(e+=this.length),t=m(0,t,this.length),e=m(0,e,this.length),r=new Uint8Array(e-t),o=0,n=i=s=t,a=e;s<=a?i<a:i>a;n=s<=a?++i:--i)r[o++]=this[n];return r}),(r=Int8Array.prototype).slice||(r.slice=g),(a=Uint8Array.prototype).slice||(a.slice=g),(l=Int16Array.prototype).slice||(l.slice=g),(u=Uint16Array.prototype).slice||(u.slice=g),(c=Int32Array.prototype).slice||(c.slice=g),(h=Uint32Array.prototype).slice||(h.slice=g),(p=Float32Array.prototype).slice||(p.slice=g),(d=Float64Array.prototype).slice||(d.slice=g),null!=(y=self.Uint8ClampedArray)&&((f=y.prototype).slice||(f.slice=g)),null!=(v=self.CanvasPixelArray)&&((o=v.prototype).slice||(o.slice=g)),(s=ArrayBuffer.prototype).slice||(s.slice=function(t,e){return new Uint8Array(this).slice(t,e).buffer})},function(t,e,n){var i,r,o;o=n(42),r=o.Promise,i=n(174),t.exports=function(){var t;function File(){}return File._readWithPromise=function(t){return function(e){return new r(function(n,i){var r;return(r=new FileReader)[t](e),r.onerror=i,r.onload=function(t){return n(t.target.result)}})}},File.readAsArrayBuffer=t=File._readWithPromise("readAsArrayBuffer"),File.readAsDataURL=File._readWithPromise("readAsDataURL"),File.readAsBinaryString=function(e){return t(e).then(function(t){return new i(t)})},File}()},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w={}.hasOwnProperty;n(169),l=n(179),a=n(42),r=n(96),g=a.merge,m=a.isString,p=a.isFunction,f=a.isPlainArray,a.log,y=a.min,h=a.inspect,b=a.readFileAsDataUrl,S=a.readFileAsArrayBuffer,u=a.compactFlatten,v=a.pad,o=a.InspectedObjectLiteral,s=a.Promise,d=a.isNode,i=r.BaseObject,h=r.inspect,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t.exports=function(t){var n;function BinaryString(t){this.bytes=function(){if(null==t)return new Uint8Array;if(t instanceof BinaryString)return BinaryString.cloneUint8Array(t.bytes);if(p(null!=t?t.uint8Array:void 0))return t.uint8Array();if(f(t))return new Uint8Array(t);if(t instanceof ArrayBuffer)return new Uint8Array(t);if(t instanceof Uint8Array)return t;if(t.buffer instanceof ArrayBuffer)return new Uint8Array(t.buffer);if(m(t))return l.toBuffer(t);if(p(t.toString))return l.toBuffer(t.toString());throw new Error("invalid Binary string constructor argument: "+h(t))}(),this.length=this.bytes.length}return function(t,e){for(var n in e)w.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(BinaryString,i),BinaryString.isBinary=function(t){var e;return t&&(t instanceof BinaryString||t.constructor===ArrayBuffer||(null!=(e=t.buffer)?e.constructor:void 0)===ArrayBuffer)},BinaryString.binary=n=function(t){return t instanceof BinaryString?t:new BinaryString(t)},BinaryString.binaryFromBlob=function(t){return S(t).then(function(t){return n(t)})},BinaryString.cloneUint8Array=function(t){var e;return(e=new Uint8Array(new ArrayBuffer(src.length))).set(t),e},BinaryString.prototype.slice=function(t,e){return new BinaryString(this.bytes.slice(t,e))},BinaryString.fromBase64=function(t){var n,i,r,o,s,a;if(d)return new BinaryString(e.from(t,"base64"));for(o=(n=atob(t)).length,a=new Uint8Array(new ArrayBuffer(o)),i=r=0,s=o;r<s;i=r+=1)a[i]=n.charCodeAt(i);return new BinaryString(a)},BinaryString.prototype.toDataUri=function(t,e){var n;return d?(n="data:"+(null!=t?t:"")+";base64,"+this.toBase64(!0),e?n:s.resolve(n)):b(this.toBlob(t))},BinaryString.fromDataUri=function(t){var e;return e=t.split(",")[1],this.fromBase64(e)},BinaryString.prototype.toString=function(){return l.toString(this.bytes)},BinaryString.prototype.getString=function(){return this.toString()},BinaryString.prototype.toArrayBuffer=function(){return this.bytes.buffer},BinaryString.prototype.toBlob=function(t){return new Blob([this.bytes],g({type:t}))},BinaryString.prototype.eq=function(t){return 0===this.compare(t)},BinaryString.prototype.compare=function(t){var e,n,i,r,o,s;for(e=this.bytes,n=t.bytes,r=o=0,s=y(this.length,t.length);0<=s?o<s:o>s;r=0<=s?++o:--o)if(0!=(i=e[r]-n[r]))return i;return this.length-t.length},BinaryString.prototype.inspect=function(){return this.getInspectedString()},BinaryString.getter({uint8Array:function(){return this.bytes},buffer:function(){var t;return this.bytes.buffer.byteLength!==this.bytes.byteLength&&(t=this.bytes,this.bytes=new Uint8Array(new ArrayBuffer(t.byteLength)),this.bytes.set(t)),this.bytes.buffer},arrayBuffer:function(){return this.buffer},nodeBuffer:function(){return e.from(this.bytes)},blob:function(){return new Blob([this.bytes])},plainArray:function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.bytes).length;e<n;e++)t=i[e],r.push(t);return r},byteLength:function(){return this.length},inspectedObjects:function(){var t;return t=this.length>=10485760?Math.floor(this.length/1024*1024)+"m":this.length>=10240?Math.floor(this.length/1024)+"k":this.length+"b",new o("<BinaryString length: "+t+">")},inspectedString:function(t,e){var n;return null==t&&(t=8),null==e&&(e=64),0,[],this.length<e&&(e=this.length),new Array(t),u(["BinaryString length: "+this.length+" bytes",e<this.length?"First "+e+" bytes:":void 0,function(){var i,r,o,s;for(s=[],n=i=0,r=e,o=t;o>0?i<r:i>r;n=i+=o)s.push(this._inspectLine(n,t,e));return s}.call(this)]).join("\n")}}),BinaryString.prototype._inspectLine=function(t,e,n){var i,r,o,s,a,l;return o=y(this.length,t+e),n>=0&&(o=y(o,n)),r=function(){var e,n,r,s;for(s=[],a=e=n=t,r=o;n<=r?e<r:e>r;a=n<=r?++e:--e)(i=this.bytes[a])>=31&&i<=127?s.push(String.fromCharCode(i)):s.push("");return s}.call(this),s=function(){var e,n,r,s;for(s=[],a=e=n=t,r=o;n<=r?e<r:e>r;a=n<=r?++e:--e)i=this.bytes[a],(l=i.toString(16)).length<2&&(l="0"+l),s.push(l);return s}.call(this),v(s.join(" "),3*e)+" '"+r.join("")+"'"},BinaryString.prototype.toBase64=function(t){var n;return null==t&&(t=!1),d?(n=e.from(this.bytes).toString("base64"),t?n:s.resolve(n)):this.length>16384?this.toBase64ToDataUri():this.toBase64Custom()},BinaryString.prototype.toBase64ToDataUri=function(){return this.toDataUri().then(function(t){return t.split(",")[1]})},BinaryString.prototype.toBase64Custom=function(){var t,e,n,i,r,o,a,l,u;for(i=this.bytes,t="",e=i.byteLength,o=a=0,u=(l=e-(n=e%3))-1;a<=u;o=a+=3)r=i[o]<<16|i[o+1]<<8|i[o+2],t+=c[(16515072&r)>>18]+c[(258048&r)>>12]+c[(4032&r)>>6]+c[63&r];return s.resolve(function(){switch(n){case 0:return t;case 1:return r=i[l],t+c[(252&r)>>2]+c[(3&r)<<4]+"==";case 2:return r=i[l]<<8|i[l+1],t+c[(64512&r)>>10]+c[(1008&r)>>4]+c[(15&r)<<2]+"="}}())},BinaryString}()}).call(this,n(175).Buffer)},function(t,e,n){"use strict";(function(t){var i=n(176),r=n(177),o=n(178);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,n){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,e,n)}function from(t,e,n,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function fromArrayBuffer(t,e,n,i){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,n):new Uint8Array(e,n,i);Buffer.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Buffer.prototype:t=fromArrayLike(t,e);return t}(t,e,n,i):"string"==typeof e?function fromString(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!Buffer.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|byteLength(e,n),r=(t=createBuffer(t,i)).write(e,n);r!==i&&(t=t.slice(0,r));return t}(t,e,n):function fromObject(t,e){if(Buffer.isBuffer(e)){var n=0|checked(e.length);return 0===(t=createBuffer(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function isnan(t){return t!=t}(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&o(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function fromArrayLike(t,e){var n=e.length<0?0:0|checked(e.length);t=createBuffer(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function byteLength(t,e){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return base64ToBytes(t).length;default:if(i)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),i=!0}}function swap(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function bidirectionalIndexOf(t,e,n,i,r){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(r)return-1;n=t.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof e&&(e=Buffer.from(e,i)),Buffer.isBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,n,i,r);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):arrayIndexOf(t,[e],n,i,r);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,n,i,r){var o,s=1,a=t.length,l=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;s=2,a/=2,l/=2,n/=2}function read(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(r){var u=-1;for(o=n;o<a;o++)if(read(t,o)===read(e,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){for(var c=!0,h=0;h<l;h++)if(read(t,o+h)!==read(e,h)){c=!1;break}if(c)return o}return-1}function hexWrite(t,e,n,i){n=Number(n)||0;var r=t.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function utf8Write(t,e,n,i){return blitBuffer(utf8ToBytes(e,t.length-n),t,n,i)}function asciiWrite(t,e,n,i){return blitBuffer(function asciiToBytes(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,i)}function latin1Write(t,e,n,i){return asciiWrite(t,e,n,i)}function base64Write(t,e,n,i){return blitBuffer(base64ToBytes(e),t,n,i)}function ucs2Write(t,e,n,i){return blitBuffer(function utf16leToBytes(t,e){for(var n,i,r,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(e,t.length-n),t,n,i)}function base64Slice(t,e,n){return 0===e&&n===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,n))}function utf8Slice(t,e,n){n=Math.min(t.length,n);for(var i=[],r=e;r<n;){var o,a,l,u,c=t[r],h=null,p=c>239?4:c>223?3:c>191?2:1;if(r+p<=n)switch(p){case 1:c<128&&(h=c);break;case 2:128==(192&(o=t[r+1]))&&(u=(31&c)<<6|63&o)>127&&(h=u);break;case 3:o=t[r+1],a=t[r+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:o=t[r+1],a=t[r+2],l=t[r+3],128==(192&o)&&128==(192&a)&&128==(192&l)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&l)>65535&&u<1114112&&(h=u)}null===h?(h=65533,p=1):h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|1023&h),i.push(h),r+=p}return function decodeCodePointsArray(t){var e=t.length;if(e<=s)return String.fromCharCode.apply(String,t);var n="",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=s));return n}(i)}e.Buffer=Buffer,e.SlowBuffer=function SlowBuffer(t){+t!=t&&(t=0);return Buffer.alloc(+t)},e.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function typedArraySupport(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,n){return from(null,t,e,n)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,e,n){return function alloc(t,e,n,i){return assertSize(e),e<=0?createBuffer(t,e):void 0!==n?"string"==typeof i?createBuffer(t,e).fill(n,i):createBuffer(t,e).fill(n):createBuffer(t,e)}(null,t,e,n)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=function isBuffer(t){return!(null==t||!t._isBuffer)},Buffer.compare=function compare(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,i=e.length,r=0,o=Math.min(n,i);r<o;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0},Buffer.isEncoding=function isEncoding(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var i=Buffer.allocUnsafe(e),r=0;for(n=0;n<t.length;++n){var s=t[n];if(!Buffer.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function swap32(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function swap64(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function toString(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):function slowToString(t,e,n){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,e,n);case"utf8":case"utf-8":return utf8Slice(this,e,n);case"ascii":return asciiSlice(this,e,n);case"latin1":case"binary":return latin1Slice(this,e,n);case"base64":return base64Slice(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,n);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},Buffer.prototype.equals=function equals(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function inspect(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function compare(t,e,n,i,r){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||n>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&e>=n)return 0;if(i>=r)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,i>>>=0,r>>>=0,this===t)return 0;for(var o=r-i,s=n-e,a=Math.min(o,s),l=this.slice(i,r),u=t.slice(e,n),c=0;c<a;++c)if(l[c]!==u[c]){o=l[c],s=u[c];break}return o<s?-1:s<o?1:0},Buffer.prototype.includes=function includes(t,e,n){return-1!==this.indexOf(t,e,n)},Buffer.prototype.indexOf=function indexOf(t,e,n){return bidirectionalIndexOf(this,t,e,n,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(t,e,n){return bidirectionalIndexOf(this,t,e,n,!1)},Buffer.prototype.write=function write(t,e,n,i){if(void 0===e)i="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)i=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-e;if((void 0===n||n>r)&&(n=r),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return hexWrite(this,t,e,n);case"utf8":case"utf-8":return utf8Write(this,t,e,n);case"ascii":return asciiWrite(this,t,e,n);case"latin1":case"binary":return latin1Write(this,t,e,n);case"base64":return base64Write(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var s=4096;function asciiSlice(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(127&t[r]);return i}function latin1Slice(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i}function hexSlice(t,e,n){var i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=e;o<n;++o)r+=toHex(t[o]);return r}function utf16leSlice(t,e,n){for(var i=t.slice(e,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function checkOffset(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,n,i,r,o){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,n,i){e<0&&(e=65535+e+1);for(var r=0,o=Math.min(t.length-n,2);r<o;++r)t[n+r]=(e&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function objectWriteUInt32(t,e,n,i){e<0&&(e=4294967295+e+1);for(var r=0,o=Math.min(t.length-n,4);r<o;++r)t[n+r]=e>>>8*(i?r:3-r)&255}function checkIEEE754(t,e,n,i,r,o){if(n+i>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function writeFloat(t,e,n,i,o){return o||checkIEEE754(t,0,n,4),r.write(t,e,n,i,23,4),n+4}function writeDouble(t,e,n,i,o){return o||checkIEEE754(t,0,n,8),r.write(t,e,n,i,52,8),n+8}Buffer.prototype.slice=function slice(t,e){var n,i=this.length;if(t=~~t,e=void 0===e?i:~~e,t<0?(t+=i)<0&&(t=0):t>i&&(t=i),e<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),Buffer.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=Buffer.prototype;else{var r=e-t;n=new Buffer(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+t]}return n},Buffer.prototype.readUIntLE=function readUIntLE(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i},Buffer.prototype.readUIntBE=function readUIntBE(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var i=this[t+--e],r=1;e>0&&(r*=256);)i+=this[t+--e]*r;return i},Buffer.prototype.readUInt8=function readUInt8(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function readUInt16LE(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function readIntLE(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*e)),i},Buffer.prototype.readIntBE=function readIntBE(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var i=e,r=1,o=this[t+--i];i>0&&(r*=256);)o+=this[t+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*e)),o},Buffer.prototype.readInt8=function readInt8(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function readInt16LE(t,e){e||checkOffset(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt16BE=function readInt16BE(t,e){e||checkOffset(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt32LE=function readInt32LE(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function readFloatLE(t,e){return e||checkOffset(t,4,this.length),r.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(t,e){return e||checkOffset(t,4,this.length),r.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(t,e){return e||checkOffset(t,8,this.length),r.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(t,e){return e||checkOffset(t,8,this.length),r.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(t,e,n,i){(t=+t,e|=0,n|=0,i)||checkInt(this,t,e,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[e]=255&t;++o<n&&(r*=256);)this[e+o]=t/r&255;return e+n},Buffer.prototype.writeUIntBE=function writeUIntBE(t,e,n,i){(t=+t,e|=0,n|=0,i)||checkInt(this,t,e,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[e+r]=255&t;--r>=0&&(o*=256);)this[e+r]=t/o&255;return e+n},Buffer.prototype.writeUInt8=function writeUInt8(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function writeIntLE(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);checkInt(this,t,e,n,r-1,-r)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},Buffer.prototype.writeIntBE=function writeIntBE(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);checkInt(this,t,e,n,r-1,-r)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},Buffer.prototype.writeInt8=function writeInt8(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function writeInt16LE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function writeInt16BE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function writeInt32LE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function writeInt32BE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function writeFloatLE(t,e,n){return writeFloat(this,t,e,!0,n)},Buffer.prototype.writeFloatBE=function writeFloatBE(t,e,n){return writeFloat(this,t,e,!1,n)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(t,e,n){return writeDouble(this,t,e,!0,n)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(t,e,n){return writeDouble(this,t,e,!1,n)},Buffer.prototype.copy=function copy(t,e,n,i){if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var r,o=i-n;if(this===t&&n<e&&e<i)for(r=o-1;r>=0;--r)t[r+e]=this[r+n];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)t[r+e]=this[r+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},Buffer.prototype.fill=function fill(t,e,n,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!Buffer.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=Buffer.isBuffer(t)?t:utf8ToBytes(new Buffer(t,i).toString()),a=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%a]}return this};var a=/[^+\/0-9A-Za-z-_]/g;function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){var n;e=e||1/0;for(var i=t.length,r=null,o=[],s=0;s<i;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(e-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(e-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function base64ToBytes(t){return i.toByteArray(function base64clean(t){if((t=function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(a,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function blitBuffer(t,e,n,i){for(var r=0;r<i&&!(r+n>=e.length||r>=t.length);++r)e[r+n]=t[r];return r}}).call(this,n(5))},function(t,e,n){"use strict";e.byteLength=function byteLength(t){return 3*t.length/4-placeHoldersCount(t)},e.toByteArray=function toByteArray(t){var e,n,i,s,a,l=t.length;s=placeHoldersCount(t),a=new o(3*l/4-s),n=s>0?l-4:l;var u=0;for(e=0;e<n;e+=4)i=r[t.charCodeAt(e)]<<18|r[t.charCodeAt(e+1)]<<12|r[t.charCodeAt(e+2)]<<6|r[t.charCodeAt(e+3)],a[u++]=i>>16&255,a[u++]=i>>8&255,a[u++]=255&i;2===s?(i=r[t.charCodeAt(e)]<<2|r[t.charCodeAt(e+1)]>>4,a[u++]=255&i):1===s&&(i=r[t.charCodeAt(e)]<<10|r[t.charCodeAt(e+1)]<<4|r[t.charCodeAt(e+2)]>>2,a[u++]=i>>8&255,a[u++]=255&i);return a},e.fromByteArray=function fromByteArray(t){for(var e,n=t.length,r=n%3,o="",s=[],a=0,l=n-r;a<l;a+=16383)s.push(encodeChunk(t,a,a+16383>l?l:a+16383));1===r?(e=t[n-1],o+=i[e>>2],o+=i[e<<4&63],o+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],o+=i[e>>10],o+=i[e>>4&63],o+=i[e<<2&63],o+="=");return s.push(o),s.join("")};for(var i=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)i[a]=s[a],r[s.charCodeAt(a)]=a;function placeHoldersCount(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function encodeChunk(t,e,n){for(var r,o,s=[],a=e;a<n;a+=3)r=(t[a]<<16)+(t[a+1]<<8)+t[a+2],s.push(i[(o=r)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,u=l>>1,c=-7,h=n?r-1:0,p=n?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-c)-1,d>>=-c,c+=a;c>0;o=256*o+t[e+h],h+=p,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=i;c>0;s=256*s+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,i),o-=u}return(d?-1:1)*s*Math.pow(2,o-i)},e.write=function(t,e,n,i,r,o){var s,a,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,f=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[n+d]=255&a,d+=f,a/=256,r-=8);for(s=s<<r|a,u+=r;u>0;t[n+d]=255&s,d+=f,s/=256,u-=8);t[n+d-f]|=128*m}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){t.exports=function(){function Utf8(){}return Utf8.toBuffer=function(t){return new Uint8Array(this.toArray(t))},Utf8.toArray=function(t){var e,n,i;return i=encodeURIComponent(t),n=0,function(){var t;for(t=[];n<i.length;)37===(e=i.charCodeAt(n++))?(n+=2,t.push(parseInt(i.substr(n-2,2),16))):t.push(e);return t}()},Utf8.toString=function(t){var e,n;if(void 0===t)return"<undefined>";if(null===t)return"<null>";try{return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),decodeURIComponent(function(){var i,r,o;for(o=[],i=0,r=t.length;i<r;i++)e=t[i],(n=e.toString(16)).length<2&&(n="0"+n),n="%"+n,o.push(n);return o}().join(""))}catch(e){return e,"<"+t.length+" binary bytes>"}},Utf8}()},function(t,e,n){var i,r,o,s={}.hasOwnProperty;r=n(96),n(169),i=r.BaseObject,o=n(174).binary,t.exports=function(t){function Stream(t){this.byteView=t,this.pos=0}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Stream,i),Stream.stream=function(t){return t instanceof Stream?t:t instanceof ArrayBuffer?Stream.fromArrayBuffer(t):t instanceof Uint8Array?new Stream(t):new Stream(o(t).bytes)},Stream.fromArrayBuffer=function(t){return new Stream(new Uint8Array(t,0,t.byteLength))},Stream.prototype.readByte=function(){return this.byteView[this.pos++]},Stream.prototype.readAsi=function(){var t,e,n;for(t=0,e=0,n=128;n>=128;)t+=(n=this.readByte())%128<<e,e+=7;return t},Stream.prototype.uint8Array=function(){return this.byteView},Stream.prototype.read=function(t){var e,n;return e=this.pos,this.pos+=t,n=this.pos,new Stream(this.byteView.subarray(e,n))},Stream.prototype.inspect=function(){return"{Stream pos="+this.pos+" byteOffset="+this.byteView.byteOffset+" length="+this.byteView.length+"}"},Stream.prototype.readAsiString=function(){return this.read(this.readAsi())},Stream.prototype.done=function(){return this.pos>=this.byteView.length},Stream.getter({buffer:function(){return this.binaryString.buffer},isDone:function(){return this.pos>=this.byteView.length},binaryString:function(){return null!=this._binaryString?this._binaryString:this._binaryString=o(this.byteView)},inspectedString:function(){return this.binaryString.inspectedString},inspectedObjects:function(){return this.binaryString.inspectedObjects}}),Stream.prototype.toString=function(){return this.binaryString.toString()},Stream}()},function(t,e,n){(function(e){var i,r,o,s,a;r=n(42),o=n(174).binary,a=n(173).readAsDataURL,i=r.Promise,s=r.isString,t.exports=function(){var t;function DataUri(){}return DataUri.isDataUri=t=function(t){return s(t)&&"data:"===t.slice(0,5)},DataUri.toDataUri=function(n,r){if(null==r&&(r="image/png"),!n)throw new Error("data not set");return e.File&&n instanceof e.File?a(n):t(n)?i.resolve(n):o(n).toBase64().then(function(t){return"data:"+r+";base64,"+t})},DataUri}()}).call(this,n(5))},function(module,exports,__webpack_require__){(function(global){var EncodedImage,ErrorWithInfo,HTMLImageElement,Image,Promise,StandardLib,binary,escapeRegExp,isBinary,isNode,isObject,isString,log,readFileAsDataUrl,ref,sameOrigin,toDataUri;if(StandardLib=__webpack_require__(42),toDataUri=__webpack_require__(181).toDataUri,isNode=StandardLib.isNode,log=StandardLib.log,Promise=StandardLib.Promise,readFileAsDataUrl=StandardLib.readFileAsDataUrl,ErrorWithInfo=StandardLib.ErrorWithInfo,isString=StandardLib.isString,escapeRegExp=StandardLib.escapeRegExp,isObject=StandardLib.isObject,sameOrigin=StandardLib.sameOrigin,ref=__webpack_require__(174),isBinary=ref.isBinary,binary=ref.binary,!global.Image)try{global.HTMLImageElement=global.Image=(global.HTMLCanvasElement=eval("require")("canvas")).Image}catch(t){}Image=global.Image,HTMLImageElement=global.HTMLImageElement,module.exports=EncodedImage=function(){var t;function EncodedImage(){}return EncodedImage.get=t=function(e,n){var i,r,o,s,a;return isObject(n)?a=n:r=null!=n?!!n:void 0,null==e?Promise.reject():e.constructor===HTMLImageElement||e.constructor===Image?(o=e,i=e.complete,s=e.naturalWidth,new Promise(function(t,n){return i&&(s>0||isNode)?t(e):(o.onload=function(){return t(o)},o.onerror=function(t){return n(new ErrorWithInfo("image load error",t))})})):Promise.then(function(){if(isBinary(e))return Neptune.isNode?binary(e).nodeBuffer:toDataUri(e);if(isString(e))return isObject(a)?Neptune.Art.RestClient.getArrayBuffer(e,a).then(function(t){return readFileAsDataUrl(new Blob([t]))}):e;throw new Error("expected arg #1 to be string or binary")}).then(function(e){return o=new Image,isNode||(null!=r?r:!sameOrigin(e)&&/^https?:/i.test(e))&&(o.crossOrigin="anonymous"),o.src=e,t(o)})},EncodedImage.toImage=function(e){return toDataUri(e).then(function(e){return t(e)})},EncodedImage}()}).call(this,__webpack_require__(5))},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c={}.hasOwnProperty;s=n(42),r=n(96),a=n(174).binary,o=s.Promise,u=s.readFileAsArrayBuffer,s.bound,i=r.BaseObject,r.log,l=1024,t.exports=function(t){function WriteStream(){this._written=[],this._writeBuffer=new Uint8Array(l),this._pos=0,this._writtenLength=0}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(WriteStream,i),WriteStream.prototype.writeByte=function(t){return this._pos===l&&this._commitHead(),this._writeBuffer[this._pos++]=t},WriteStream.prototype.writeAsi=function(t){var e,n;if(!(t>=0))throw new Error("expected number >= 0");for(n=[];;){if(e=127&t,!((t>>=7)>0)){this.writeByte(e);break}n.push(this.writeByte(128|e))}return n},WriteStream.prototype.write=function(t){var e;return e=a(t),this._pos+e.length<=l?(this._writeBuffer.set(e.uint8Array,this._pos),this._pos+=e.length):(this._commitHead(),this._writtenLength+=e.length,this._written.push(e.uint8Array))},WriteStream.prototype.writeAsiString=function(t){var e;return e=a(t),this.writeAsi(e.length),this.write(e)},WriteStream.getter({arrayBufferPromise:function(){return this._compact().then(function(t){return t.buffer})},binaryStringPromise:function(){return this.arrayBufferPromise.then(function(t){return a(t)})},length:function(){return this._pos+this._writtenLength}}),WriteStream.prototype._compact=function(){var t,n,i,r,s,a,l,c,h,p,d,f,m,g;switch(this._commitHead(),this._written.length){case 0:return o.resolve(new Uint8Array(0));case 1:return o.resolve(this._written[0]);case e.Blob:return u(new Blob(this._written)).then((g=this,function(t){return g._written=[new Uint8Array(t)],g._written[0]}));default:for(d=0,t=0,r=(h=this._written).length;t<r;t++)d+=(f=h[t]).length;for(l=new Uint8Array(d),c=0,n=0,s=(p=this._written).length;n<s;n++)for(i=0,a=(f=p[n]).length;i<a;i++)m=f[i],l[c++]=m;return o.resolve(l)}},WriteStream.prototype._commitHead=function(){if(this._pos>0)return this._writtenLength+=this._pos,this._written.push(this._writeBuffer.slice(0,this._pos)),this._pos=0},WriteStream}()}).call(this,n(5))},function(t,e,n){(t.exports=n(164)).includeInNamespace(n(185)).addModules({HumanStringFormatting:n(186)})},function(t,e,n){t.exports=[n(186)]},function(t,e,n){(function(t){(0,n(42).defineModule)(t,function(){function HumanStringFormatting(){}return HumanStringFormatting.humanByteSize=function(t){return t<2048?t+"bytes":(t/=1024)<2048?(0|t)+"KB":(0|(t/=1024))+"MB"},HumanStringFormatting}())}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(165)).includeInNamespace(n(188)).addModules({Analytics:n(203),AsyncLocalStorage:n(204),BatchLoader:n(206),GlobalCounts:n(191),InstanceFunctionBindingMixin:n(207),JsonStore:n(208),ProgressAdapter:n(189),SingleObjectTransaction:n(209),Stat:n(210),Transaction:n(211),WebWorker:n(190),WorkerRpc:n(205)})},function(t,e,n){t.exports=[[n(189),"executePromiseSequence"],n(190),n(191),n(192),{CommunicationStatus:n(141),RestClient:n(197),Validator:n(147).Validator}]},function(t,e,n){var i,r,o,s,a,l,u,c,h={}.hasOwnProperty;o=n(42),i=n(96).BaseObject,l=o.isNumber,a=o.isFunction,s=o.isArray,o.log,u=o.max,c=o.min,r=o.Promise,t.exports=function(t){function ProgressAdapter(t,e){if(this.stepWeights=t,this.progressCallback=e,!a(this.progressCallback)||!s(this.stepWeights)&&!l(this.stepWeights))throw new Error("invalid params");this._currentStep=0,this._generateSteps(),this._currentProgress=0,this._warningCount=0,this.setCurrentProgress(0)}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ProgressAdapter,i),ProgressAdapter.getter("steps currentStep currentProgress warningCount",{currentProgressPercent:function(){return(100*this._currentProgress|0)+"%"},currentProgressBase:function(){return this._currentStep<=0?0:this._currentStep>=this._steps.length?1:this._steps[this._currentStep]}}),ProgressAdapter.setter({currentProgress:function(t){return"function"==typeof this.progressCallback?this.progressCallback(c(1,this._currentProgress=u(t,this._currentProgress))):void 0}}),ProgressAdapter.prototype.makeProgress=function(){return this._currentStep++,this._currentStep>this._steps.length&&(this._warningCount++,console.warn("ProgressAdapter: makeProgress/Callback called too many times!",{currentStep:this._currentStep,steps:this._steps,stepWeights:this.stepWeights})),this.setCurrentProgress(this.currentProgressBase)},ProgressAdapter.prototype.makeProgressCallback=function(){var t,e,n;return this._finishLastProgress(),e=this.currentProgressBase,this._currentStep++,t=this.currentProgressBase,n=this,function(i){return n.setCurrentProgress(e+(t-e)*i)}},ProgressAdapter.prototype._finishLastProgress=function(){var t;if(this._currentProgress<(t=this.currentProgressBase))return this.setCurrentProgress(t)},ProgressAdapter.prototype._executePromiseSequence=function(t,e,n,i){return n>=t.length?(this._finishLastProgress(),i(e)):r.resolve(t[n](e,this.makeProgressCallback())).then((o=this,function(e){return o._executePromiseSequence(t,e,n+1,i)}));var o},ProgressAdapter.prototype.executePromiseSequence=function(t){return new r((e=this,function(n){return e._executePromiseSequence(t,null,0,n)}));var e},ProgressAdapter.executePromiseSequence=function(t,e,n){var i,r;return n?(r=e,i=n):r=(i=e).length,new ProgressAdapter(r,t).executePromiseSequence(i)},ProgressAdapter.prototype._generateSteps=function(){var t,e,n,i,r,o,s,a,u;if(l(i=this.stepWeights))return this._steps=function(){var e,n,r;for(r=[],t=e=0,n=i;e<n;t=e+=1)r.push(t/i);return r}();for(a=0,e=0,n=(r=this.stepWeights).length;e<n;e++)u=r[e],a+=u;return s=0,this._steps=function(){var t,e,n,i;for(i=[],t=0,e=(n=this.stepWeights).length;t<e;t++)u=n[t],o=s,s+=u/a,i.push(o);return i}.call(this)},ProgressAdapter}()},function(t,e,n){n(42).log,t.exports=function(){var t;function WebWorker(){}return WebWorker.echoWebWorker="self.onmessage=function(e){postMessage('Worker: '+e.data);}",WebWorker.isBrowser=!!(self.window&&self.navigator&&self.document),WebWorker.isWebWorker=!WebWorker.isBrowser&&self.importScripts,WebWorker.startWorkerFromJsString=t=function(t){return new Worker(URL.createObjectURL(new Blob([t],{type:"application/javascript"})))},WebWorker.startWorkerFromFunction=function(e){return t("("+e+")();")},WebWorker}()},function(t,e,n){var i,r,o,s;i=n(42),o=i.isPlainObject,r=i.currentSecond,s=i.log,t.exports=function(){var t;function GlobalCounts(){}return GlobalCounts.globalCounts={},t=null,GlobalCounts.resetGlobalCounts=function(){return t=r(),GlobalCounts.globalCounts={}},GlobalCounts.globalCount=function(t,e){var n,i,r,s;if(null==e&&(e=1),o(e)){if(i=GlobalCounts.globalCounts[t]){for(n in r=[],e)s=e[n],r.push(i[n]+=s);return r}return GlobalCounts.globalCounts[t]=e}return GlobalCounts.globalCounts[t]=(GlobalCounts.globalCounts[t]||0)+e},GlobalCounts.countStep=function(){var e;return(e=r())-t>.002&&s.error("GlobalCounts gap"),t=e,GlobalCounts.globalCount("step")},GlobalCounts}()},function(t,e,n){t.exports=n(193)},function(t,e,n){t.exports=n(194),t.exports.includeInNamespace(n(196))},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(18).addNamespace("Art.ObjectTreeFactory",function(t){function ObjectTreeFactory(){return ObjectTreeFactory.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ObjectTreeFactory,Neptune.PackageNamespace),ObjectTreeFactory.version=n(195).version,ObjectTreeFactory}())},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC\\"","dependencies":{"art-build-configurator":"*"},"description":"Create Declarative frameworks that output tree structures with properties (e.g. ArtReact)","license":"ISC","name":"art-object-tree-factory","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"2.1.7"}')},function(module,exports,__webpack_require__){"use strict";(function(module,global){let Caf=__webpack_require__(3);Caf.defMod(module,()=>Caf.importInvoke(["log","isClass","isFunction","isPlainObject","Object","compactFlattenFast","fastBind","compactFlattenAllFast","isString","w","upperCamelCase"],[global,__webpack_require__(42)],(log,isClass,isFunction,isPlainObject,Object,compactFlattenFast,fastBind,compactFlattenAllFast,isString,w,upperCamelCase)=>{let mergeIntoBasic,preprocessElementBasic,ObjectTreeFactory;return mergeIntoBasic=function(t,e){let n,i,r;return i=t,null!=(n=e)&&(()=>{for(let t in n){let e;e=n[t],r=i[t]=e}})(),i},preprocessElementBasic=function(t){return t},Caf.defClass(class ObjectTreeFactory extends Object{},function(ObjectTreeFactory,classSuper,instanceSuper){let _makeCreateFactory;this.createObjectTreeFactory=((...t)=>{let e,n,i,r,o,s,a,l,u,c,h;return e=n=i=null,Caf.each2(t,t=>(()=>{switch(!1){case!isClass(t):return n=t;case!isFunction(t):return i=t;case!isPlainObject(t):return e=t}})(),t=>null!=t),Caf.exists(e)&&(r=e.mergePropsInto,o=e.preprocessElement,s=e.name,a=void 0!==(h=e.inspectedName)?h:s,l=e.bind),null!=n||(n=Caf.exists(e)&&e.class),null!=i||(null==n&&log.warn("DEPRICATED: either 'nodeFactory' or 'class' is now required"),null!=n||(n=u=Caf.defClass(class TreeFactoryNode extends __webpack_require__(96).BaseClass{constructor(t,e){super(...arguments),this.props=t,this.children=e}})),i=((t,e)=>new n(t,e))),c=_makeCreateFactory(),this._bindFactoryInfo(c(i,null!=o?o:preprocessElementBasic,null!=r?r:mergeIntoBasic),a,n,l)}),this.createObjectTreeFactories=null,_makeCreateFactory=function(){return eval("(function(e,l,n){let f,u,r,t,i=(e=>{let a,c,s,h;e=l(e,f);if(e!=null&&e!==false){switch(e.constructor){case Object:if(r==null){r=e}else{if(u==null){n(u={},r)}n(u,e)}break;case Array:a=e;c=a;if(a!=null){s=a.length;h=0;while(h<s){let e;e=a[h];i(e);h++}}c;break;default:(t!=null?t:t=[]).push(e)}}return null});return f=((...l)=>{let n,f,a,c;t=u=r=undefined;n=l;f=n;if(n!=null){a=n.length;c=0;while(c<a){let e;e=n[c];i(e);c++}}f;return e(u||r,t)})});")},this._bindFactoryInfo=function(t,e,n,i){let r,o,s,a;return n&&(null!=e||(e=Caf.isF(n.getName)&&n.getName()),t.class=n,n.Factory=t,r=Caf.isF(n.getAbstractClass)&&n.getAbstractClass()||Object,i=compactFlattenFast([(o=n,s=[],null!=o&&(()=>{for(let t in o){let e,n;e=o[t],a=!r[n=t]&&isFunction(e)?s.push(n):void 0}})(),s),i]),null!=e||(e=n.getName()+"Factory"),Caf.each2(i,e=>t[e]=fastBind(n[e],n))),t._name=null!=e?e:e="ObjectTreeFactory",t.inspect=(()=>`<${Caf.toString(e)}>`),t},this.createObjectTreeFactories=this.createObjectTreeFactory({mergePropsInto:function(t,e){return t.names=compactFlattenAllFast(t.names,e.names),Caf.object(e,null,(t,e)=>"names"!==e,t)},preprocessElement:function(t){return isString(t)?{names:w(t)}:t}},(t,e)=>{let n;return e&&([n]=e),1===n.length?this._createObjectTreeFactoriesFromFactoryFactories(t,t.names,n):this._createObjectTreeFactoriesFromFactories(t,t.names,n)}),this._createObjectTreeFactoriesFromFactories=((t,e,n)=>{let i,r;return i=t.suffix||"",r={},Caf.each2(e,e=>(e=>(t.inspectedName=e,r[upperCamelCase(e)+i]=this.createObjectTreeFactory(t,(t,i)=>n(e,t,i))))(e)),r}),this._createObjectTreeFactoriesFromFactoryFactories=((t,e,n)=>{let i,r;return i=t.suffix||"",r={},Caf.each2(e,e=>{let o,s;return o=n(e),s=upperCamelCase(e)+i,t.inspectedName=s,r[s]=this.createObjectTreeFactory(t,o)}),r})})}))}).call(this,__webpack_require__(2)(module),__webpack_require__(5))},function(t,e,n){t.exports=n(198)},function(t,e,n){(t.exports=n(199)).includeInNamespace(n(201))},function(t,e,n){t.exports=n(18).addNamespace("Art.RestClient",class RestClient extends Neptune.PackageNamespace{}._configureNamespace(n(200)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC\\"","dependencies":{"art-build-configurator":"*","art-communication-status":"^1.0.0","xhr2":"^0.1.4"},"description":"Promise-based rest-client library. Makes HTTP/HTTPS easy in both NODE and BROWSER.","license":"ISC","name":"art-rest-client","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"1.6.8"}')},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C={}.hasOwnProperty;n(42),(v=n(42)).objectWithout,v.formattedInspect,y=v.present,r=v.Promise,d=v.merge,h=v.isNumber,x=v.timeout,p=v.log,g=v.objectKeyCount,a=v.appendQuery,m=v.object,o=v.RequestError,m=v.object,P=v.w,l=v.capitalizedDashCase,c=v.each,S=n(141),f=S.networkFailure,w=S.success,b=S.serverFailure,s=S.aborted,S.failureTypes,u=S.decodeHttpStatus,i=n(96).BaseClass,n(202),t.exports=function(t){var e,n;function RestClient(){return RestClient.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)C.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(RestClient,i),RestClient.singletonClass(),RestClient.RestClientClass=RestClient,RestClient.legalVerbs=e={},c(P("get put post delete head"),function(t){var n;return n=t.toUpperCase(),e[t.toLowerCase()]=e[n]=n}),RestClient.get=function(t,e){return RestClient.singleton.get(t,e)},RestClient.put=function(t,e,n){return RestClient.singleton.put(t,e,n)},RestClient.post=function(t,e,n){return RestClient.singleton.post(t,e,n)},RestClient.delete=function(t,e){return RestClient.singleton.delete(t,e)},RestClient.getArrayBuffer=function(t,e){return RestClient.singleton.getArrayBuffer(t,e)},RestClient.getJson=function(t,e){return RestClient.singleton.getJson(t,e)},RestClient.deleteJson=function(t,e){return RestClient.singleton.deleteJson(t,e)},RestClient.putJson=function(t,e,n){return RestClient.singleton.putJson(t,e,n)},RestClient.postJson=function(t,e,n){return RestClient.singleton.postJson(t,e,n)},RestClient.restRequest=function(t){return RestClient.singleton.restRequest(t)},RestClient.restJsonRequest=function(t){return RestClient.singleton.restJsonRequest(t)},RestClient.prototype.get=function(t,e){return this.restRequest(d(e,{verb:"GET",url:t}))},RestClient.prototype.put=function(t,e,n){return this.restRequest(d(n,{verb:"PUT",url:t,data:e}))},RestClient.prototype.post=function(t,e,n){return this.restRequest(d(n,{verb:"POST",url:t,data:e}))},RestClient.prototype.delete=function(t,e){return this.restRequest(d(e,{verb:"DELETE",url:t}))},RestClient.prototype.getArrayBuffer=function(t,e){return this.restRequest(d(e,{verb:"GET",url:t,responseType:"arraybuffer"}))},RestClient.prototype.getJson=function(t,e){return this.restJsonRequest(d(e,{verb:"get",url:t}))},RestClient.prototype.deleteJson=function(t,e){return this.restJsonRequest(d(e,{verb:"delete",url:t}))},RestClient.prototype.putJson=function(t,e,n){return this.restJsonRequest(d(n,{verb:"put",url:t,data:e}))},RestClient.prototype.postJson=function(t,e,n){return this.restJsonRequest(d(n,{verb:"post",url:t,data:e}))},RestClient.prototype.restRequest=function(t){var e,i,r,o,s,l,u,c,d,f,m,g,y,v,S;if(v=t.verb,S=t.verbose,l=t.method,g=t.url,i=t.data,e=t.body,c=t.query,o=t.headers,u=t.onProgress,d=t.responseType,r=t.formData,f=t.showProgressAfter,h(f)||(f=100),l||(l=v),e||(e=i),!(l=RestClient.legalVerbs[m=l]))throw new Error("invalid method: "+m);if(r){if(e)throw new Error("can't specify both 'body' and 'formData'");for(s in e=new FormData,r)y=r[s],e.append(s,y)}else e=(null!=e&&"function"==typeof e.toArrayBuffer?e.toArrayBuffer():void 0)||e;if("GET"===l&&e)throw p.error({RestClient_restRequest:{info:"can't GET with body",options:t}}),new Error("With their ultimate wisdom, the gods decree: NO DATA WITH GET");return c&&(g=a(g,c)),this._normalizedRestRequest({verbose:S,method:l,url:g,body:e,onProgress:u,responseType:d,showProgressAfter:f,headers:n(o)})},RestClient.normalizeHeaders=n=function(t){return m(t,{key:function(t,e){return l(e)}})},RestClient.prototype.restJsonRequest=function(t){return r.then((e=this,function(){var n,i,r,o;return o=t.verb,r=t.method,n=t.data,i=t.headers,o=RestClient.legalVerbs[o||r],n&&0===g(n)&&(n=null),"GET"===o&&t.data?(t=d(t,{url:a(t.url,m(n,function(t){return JSON.stringify(t)}))}),n=null):n&&(n=JSON.stringify(n)),e.restRequest(d(t,{responseType:"json",headers:d({Accept:"application/json","Content-Type":"application/json"},i),data:n}))}));var e},RestClient.prototype._normalizedRestRequest=function(t){var e,n,i,a,l,c,h,m;return i=t.method,h=t.url,e=t.body,n=t.headers,a=t.onProgress,l=t.responseType,c=t.showProgressAfter,m=t.verbose,new r(function(r,g){var v,S,P,C,_,E,T,k,I,M,A;if(v=function(t){return g(new o(d(t,{sourceLib:"ArtRestClient",body:e,headers:n,responseType:l,key:h,type:i,responseUrl:k.responseURL,progress:M.progress})))},M={request:k=new XMLHttpRequest,progress:0,options:t,abort:function(){return k.abort(),v({status:s,message:"XMLHttpRequest aborted"})}},S=function(){var t;try{return P()}catch(e){return t=e,{status:b,rawResponse:k.response,message:"ArtRestClient: Error parsing server's response: "+t+"\nrawResponse: "+k.response}}},P=function(){var t;return(t=k.response)&&"json"===l?JSON.parse(t):t},k.open(i,h,!0),y(l)&&"json"!==l&&(k.responseType=l),n)for(_ in n)A=n[_],k.setRequestHeader(_,A);return I=!1,k.addEventListener("error",function(t){return I=!0,v({status:f,message:"XMLHttpRequest error event triggered",data:{event:t}})}),k.addEventListener("load",function(t){var e,n;if(I=!0,(e=u(k.status)).status!==w||!function(){try{return r(P()),!0}catch(t){}}())return n=e.status===w?(e.status=b,"error processing successful response"):void 0,v(d(e,{message:n,event:t,data:S()}))}),a&&(C=c<=0,E=null,x(c,function(){return C=!0,T(E||{})}),T=function(t){var e,n,i;if(i=(n=E=t).total,e=n.loaded,C&&!I)return"function"==typeof a?a(M=d(M,{event:t,progress:i>0?e/i:0})):void 0},"GET"===i?k.addEventListener("progress",T):k.upload.addEventListener("progress",T)),m&&p("ArtRestClient: "+i+" "+h),k.send(e)})},RestClient}()},function(t,e){},function(t,e,n){var i,r,o,s={}.hasOwnProperty;r=n(42),i=n(96).BaseObject,o=r.inspectLean,function(t){function Analytics(){return Analytics.__super__.constructor.apply(this,arguments)}(function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype})(Analytics,i),Analytics.defaultCategory="Foundation.Analytics",Analytics.event=function(t){var e,n,i,r,s;return null==t&&(t={}),n=t.category||this.defaultCategory,e=t.action,i=t.label,s=t.value,r=!!t.noninteraction,self._gaq?(self._gaq.push(["_trackEvent",n,e,i,s,r]),this.rawLog("ANALYTICS-EVENT: "+o(t))):this.rawLog("(no)ANALYTICS-EVENT: "+o(t))}}()},function(t,e,n){(function(t,e){var i,r,o,s,a,l;r=(a=n(42)).defineModule,i=a.Promise,a.log,s=a.objectKeyCount,o=n(190).isWebWorker,l=n(205).workerRpc,r(t,function(){var t;return(t=e.localStorage)||(t=function(){function LocalStorageShimForNode(){}return LocalStorageShimForNode.store={},LocalStorageShimForNode.getItem=function(t){return LocalStorageShimForNode.store[t]},LocalStorageShimForNode.setItem=function(t,e){return LocalStorageShimForNode.store[t]=e},LocalStorageShimForNode.removeItem=function(t){return delete LocalStorageShimForNode.store[t]},LocalStorageShimForNode.clear=function(){return LocalStorageShimForNode.store={}},LocalStorageShimForNode.key=function(t){return Object.keys(LocalStorageShimForNode.store)[t]},LocalStorageShimForNode.getLength=function(){return s(LocalStorageShimForNode.store)},LocalStorageShimForNode}()),o?l.bindWithPromises({localStorage:["getItem","setItem","removeItem","clear","key"]}):(l.register({localStorage:t}),function(){function AsyncLocalStorage(){}return AsyncLocalStorage.getItem=function(e){return i.then(function(){return t.getItem(e)})},AsyncLocalStorage.setItem=function(e,n){return i.then(function(){return t.setItem(e,n)})},AsyncLocalStorage.removeItem=function(e){return i.then(function(){return t.removeItem(e)})},AsyncLocalStorage.clear=function(){return i.then(function(){return t.clear()})},AsyncLocalStorage.key=function(e){return i.then(function(){return t.key(e)})},AsyncLocalStorage.getLength=function(){return i.then(function(){return t.length})},AsyncLocalStorage}())})}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty,g=[].slice;s=n(42),r=n(96),a=n(190),o=s.Promise,d=s.log,c=s.isPlainArray,u=s.isFunction,h=s.isString,f=s.mergeInto,i=r.BaseObject,p=a.isWebWorker,l=p?"WorkerRpc(worker)":"WorkerRpc(browser)",t.exports=function(t){function WorkerRpc(t,e){h(t)&&(d("WorkerRpc starting worker: "+t),t=new Worker(t),d("WorkerRpc starting worker: "+t+", started?:",t)),t||self===self.window||(t=self),this._reset(),this._bindOnmessage(this._thread=t),e&&this._applyOptions(e)}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(WorkerRpc,i),WorkerRpc.singletonClass(),WorkerRpc.workerRpcChannelIdString="Art.Foundation.WorkerRpcChannel",WorkerRpc.register=function(t){return WorkerRpc.singleton.register(t)},WorkerRpc.bind=function(t){return WorkerRpc.singleton._bind(t,!1)},WorkerRpc.bindWithPromises=function(t){return WorkerRpc.singleton._bind(t,!0)},WorkerRpc.prototype.register=function(t){var e,n;if(t){for(n in t)e=t[n],this._registry.hasOwnProperty(n)?f(this._registry[n],e):this._registry[n]=e;return this._registry}},WorkerRpc.prototype.bind=function(t){return this._bind(t,!1)},WorkerRpc.prototype.bindWithPromises=function(t){return this._bind(t,!0)},WorkerRpc.prototype._bind=function(t,e){var n,i,r,o,s,a,l;if(!u(null!=(l=this._thread)?l.postMessage:void 0))throw new Error("@_thread.postMessage required for remote requests");if(t){for(a in s=null,t)for(i=t[a],this.hasOwnProperty(a)||(this[a]={}),s=this[a],r=0,o=i.length;r<o;r++)s[n=i[r]]=e?this._newRemoteRequestFunctionWithPromise(a,n):this._newRemoteRequestFunction(a,n);return s}},WorkerRpc.prototype._reset=function(){return this._registry={promiseCallback:{success:function(t,e){return WorkerRpc._resolvePromise(t,e)},error:function(t,e){return WorkerRpc._rejectPromise(t,e)}}}},WorkerRpc.prototype._applyOptions=function(t){var e,n,i;return i=t.register,e=t.bind,n=t.bindWithPromises,this.register(i),this.bind(e),this.bindWithPromises(n),this},WorkerRpc.prototype._send=function(t,e,n,i){return this._thread.postMessage(["Art.Foundation.WorkerRpcChannel",t,e,n,i])},WorkerRpc.prototype._newRemoteRequestFunctionWithPromise=function(t,e){return n=this,function(){var i;return i=1<=arguments.length?g.call(arguments,0):[],WorkerRpc._bindPromise(function(r){return n._send(t,e,r,i)})};var n},WorkerRpc.prototype._newRemoteRequestFunction=function(t,e){return n=this,function(){var i;return i=1<=arguments.length?g.call(arguments,0):[],n._send(t,e,null,i)};var n},WorkerRpc.prototype._bindOnmessage=function(t){var e,n;if(t)return n=this,e=function(t){var e,i,r,o,s,a;if(i=t.data,c(i)&&(a=i[0],o=i[1],r=i[2],s=i[3],e=i[4],"Art.Foundation.WorkerRpcChannel"===a))return n._invokeLocalFunction(o,r,s,e)},t.addEventListener?t.addEventListener("message",e):t.onmessage=e},WorkerRpc.prototype._invokeLocalFunction=function(t,e,n,i){var r,o,s;if((o=this._registry[t])&&(r=o[e])||this!==(s=WorkerRpc.singleton)&&(o=s._registry[t])&&(r=o[e]),r||console.warn(l+"_onmessage: could not find: '"+t+"."+e+"'\n\nnamespaces: "+Object.keys(this._registry).join(", ")+"\nglobal namespaces: "+(s===this?"(same)":Object.keys(s._registry).join(", "))),r)return WorkerRpc.lastMessageReceivedFrom=this,this._resolveOrRejectRemotePromise(n,r.apply(o,i))},WorkerRpc.prototype._resolveOrRejectRemotePromise=function(t,e){var n;if(null!=t)return o.resolve(e).then((n=this,function(e){return n._send("promiseCallback","success",null,[t,e],function(e){return n._send("promiseCallback","error",null,[t,e])})}))},WorkerRpc._promises={},WorkerRpc._nextPromiseId=0,WorkerRpc._bindPromise=function(t){var e,n;return this._promises[n=this._nextPromiseId++]=e=o.newExternallyResolvable(),t(n),e},WorkerRpc._resolvePromise=function(t,e){var n;return null!=(n=this._promises[t])&&n.resolve(e),delete this._promises[t]},WorkerRpc._rejectPromise=function(t,e){var n;return null!=(n=this._promises[t])&&n.reject(e),delete this._promises[t]},WorkerRpc}()},function(t,e,n){var i,r,o,s,a={}.hasOwnProperty;r=n(42),i=n(96).BaseObject,r.log,o=r.inspect,s=r.nextTick,r.timeout,t.exports=function(t){function BatchLoader(t){this.assets={},this.loadingAssets={},this.loadFunction=t}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(BatchLoader,i),BatchLoader.prototype.load=function(t,e){return"string"==typeof t&&(t=[t]),this.loadAssets(t,e)},BatchLoader.prototype.addAsset=function(t,e){var n;if(null==e)throw new Error("not a valid asset: "+o(e));return delete this.loadingAssets[t],(n=this.assets)[t]||(n[t]=e),this.notifyListeners()},BatchLoader.getter({blankInfo:function(){return{loadedFromCache:0,loadedAsynchronously:0,alreadyLoadingAsynchronously:0}}}),BatchLoader.prototype.loadAssets=function(t,e){var n,i;return n=this.blankInfo,t.forEach((i=this,function(t){return null!=i.assets[t]?n.loadedFromCache++:i.loadingAssets[t]?(n.loadedAsynchronously++,n.alreadyLoadingAsynchronously++):(n.loadedAsynchronously++,i.loadingAssets[t]=!0,i.loadFunction(t,function(t,e){return i.addAsset(t,e)}))})),this.addLoaderListener(t,e,n),s(function(t){return function(){return t.notifyListeners()}}(this))},BatchLoader.prototype.addLoaderListener=function(t,e,n){return this.loadingListeners||(this.loadingListeners=[]),this.loadingListeners.push({sources:t,onLoad:e,info:n})},BatchLoader.prototype.notifyListeners=function(){var t,e,n,i,r,o,s,a,l;if(this.loadingListeners){for(s=this.loadingListeners,this.loadingListeners=[],e=0,i=s.length;e<i;e++){for(t=!0,n=0,r=(a=(o=s[e]).sources).length;n<r;n++)l=a[n],this.assets[l]||(t=!1);t?o.onLoad(this.assets,o.sources,o.info):this.loadingListeners.push(o)}return this.loadingListeners}},BatchLoader}()},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty,l=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};e=(s=n(42)).defineModule,r=s.isFunction,i=s.fastBind,o=s.log,e(t,function(){return function(t){return function(e){function InstanceFunctionBindingMixin(){return InstanceFunctionBindingMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(InstanceFunctionBindingMixin,t),InstanceFunctionBindingMixin.getFunctionsToBindList=function(t){return!t&&this.hasOwnProperty("_functionsToBindList")?this._functionsToBindList:this._functionsToBindList=this._getFunctionsToBindList().sort()},InstanceFunctionBindingMixin._getFunctionsToBindList=function(){var t,e,n,i;for(t in n=[],e=this.prototype)i=e[t],"constructor"!==t&&r(i)&&this.propertyIsConcrete(t)&&(!this.nonBindingFunctions||l.call(this.nonBindingFunctions,t)<0)&&n.push(t);return n},InstanceFunctionBindingMixin.prototype.getBoundFunctionList=function(){return this._boundFunctionList},InstanceFunctionBindingMixin.prototype.hotReloadDebug=function(t){var e,n,i,r,s,a;for(s=[],e=[],a=function(){var e,n,r,o;for(o=[],e=0,n=(r=this._boundFunctionList).length;e<n;e++)i=r[e],l.call(t,i)<0&&o.push(i);return o}.call(this),n=0,r=t.length;n<r;n++)i=t[n],l.call(this._boundFunctionList,i)>=0?e.push(i):s.push(i);return o({HotReloadBind:{existingMethods:e,newMethods:s,removedMethods:a}})},InstanceFunctionBindingMixin.prototype.bindFunctionsToInstance=function(t){var e,n,r,o,s,a,u,c,h;if(e=this.class.getFunctionsToBindList(t),this._boundFunctionList)for(n=0,s=(h=this._boundFunctionList).length;n<s;n++)o=h[n],l.call(e,o)<0&&delete this[o];for(u=this.class.prototype,r=0,a=e.length;r<a;r++)this[o=e[r]]=(c=u[o])?i(c,this):void 0;return this._boundFunctionList=e},InstanceFunctionBindingMixin}()}})}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c={}.hasOwnProperty;u=n(42),l=u.log,s=u.Promise,a=u.isNumber,o=n(96),i=n(204),r=o.BaseObject,t.exports=function(t){function JsonStore(t){null==t&&(t=i),this.store=t}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(JsonStore,r),JsonStore.singletonClass(),JsonStore.prototype.setItem=function(t,e){var n,i;return n=null,this.store.getItem(t).then((i=this,function(r){return r!==(n=JSON.stringify(e))?i.store.setItem(t,n).then(function(){return n}):null})).catch(function(i){throw l.error({JsonStore_setItem:{key:t,value:e,json:n,error:i}}),i})},JsonStore.prototype.getItem=function(t){return s.then((e=this,function(){return e.store.getItem(t)})).then(function(t){return t&&JSON.parse(t)}).catch(function(e){throw l.error({JsonStore_getItem:{key:t,json:json,error:e}}),e});var e},JsonStore.prototype.removeItem=function(t){return s.then((e=this,function(){return e.store.removeItem(t)}));var e},JsonStore.prototype.clear=function(){return s.then((t=this,function(){return t.store.clear()}));var t},JsonStore.prototype.key=function(t){return s.then((e=this,function(){return e.store.key(t)}));var e},JsonStore.prototype.getLength=function(){return s.then((t=this,function(){return a(t.store.length)?t.store.length:t.store.getLength()}));var t},JsonStore}()},function(t,e,n){var i,r,o,s,a,l,u,c,h={}.hasOwnProperty,p=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};o=n(42),r=n(96),s=o.cloneByStructure,u=o.removeFirstMatch,a=o.eq,l=o.inspect,c=o.rubyTrue,i=r.BaseObject,t.exports=function(t){var e;function SingleObjectTransaction(t){var e;if(SingleObjectTransaction.__super__.constructor.apply(this,arguments),this.object=function(){if(t.constructor===Array){if(2!==t.length)throw new Error("new SingleObjectTransaction: expected length-2 array like: [obj, optionsMap]");return this.options=t[1],t[0]}return this.options={},t}.call(this),null==this.object)throw new Error("object must not be null or undefined");this.props=[],this.from={},(e=this.options).properties&&this.addProperties(e.properties),e.property&&this.addProp(e.property),e.from&&this.addFromValues(e.from),e.to&&this.addToValues(e.to)}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(SingleObjectTransaction,i),SingleObjectTransaction.prototype.toString=function(){return l(this.object,0)+" from:"+l(this.from,1)+" to:"+l(this.to,1)},SingleObjectTransaction.prototype.inspect=function(t){var e,n,i,o,s;if(!t)return r.Inspect.inspect(this);for(t.put(this.object.classPathName+":"),s=[],e=0,i=(o=this.props).length;e<i;e++)n=o[e],t.put("\n    "+n+": "),c(this.from&&this.from[n])&&t.inspect(this.from[n],1),t.put(" ... "),c(this.to&&this.to[n])?s.push(t.inspect(this.to[n],1)):s.push(void 0);return s},SingleObjectTransaction.getter({properties:function(){return this.props},hasToValues:function(){return!!this.to},valuesChanged:function(){var t,e,n,i;for(e in n=this.from)if(t=n[e],i=this.to[e],!a(t,i))return!0;return!1}}),SingleObjectTransaction.prototype.addFromValues=function(t){var e,n,i;for(n in t)i=t[n],this.addProp(n),this.from[n]=i;return"function"==typeof(e=this.object).preprocessProperties?e.preprocessProperties(this.from):void 0},SingleObjectTransaction.prototype.addToValues=function(t){var e,n,i;for(n in this.to||(this.to={}),t)i=t[n],this.addProp(n),this.to[n]=i;return"function"==typeof(e=this.object).preprocessProperties?e.preprocessProperties(this.to):void 0},SingleObjectTransaction.prototype.addProperties=function(t){var e,n,i,r,o;if(t.constructor===Array){for(r=[],e=0,n=t.length;e<n;e++)i=t[e],r.push(this.addProp(i));return r}for(i in o=[],t)t[i],o.push(this.addProp(i));return o},SingleObjectTransaction.prototype.addProp=function(t){if(p.call(this.props,t)<0)return this.props.push(t)},SingleObjectTransaction.prototype.deleteProp=function(t){return u(this.props,t),delete this.from[t],delete this.to[t]},SingleObjectTransaction.prototype.saveValues=function(t){var e,n,i,r,o,a,l;for(this.clearOptimizations(),r=this.object.metaProperties,n=0,i=(a=this.props).length;n<i;n++)o=a[n],t.hasOwnProperty(o)||(t[o]=s((e=null!=r&&null!=(l=r[o])?l.getterName:void 0)?this.object[e]():this.object[o]));return null},SingleObjectTransaction.prototype.saveFromValues=function(){return this.saveValues(this.from||(this.from={}))},SingleObjectTransaction.prototype.saveToValues=function(){return this.saveValues(this.to||(this.to={}))},SingleObjectTransaction._setValues=e=function(t,e,n){var i,r,o,s,a;for(r in i=t.metaProperties,e)a=e[r],n&&(a=n(r,a)),(s=null!=i&&null!=(o=i[r])?o.setterName:void 0)?t[s](a):t[r]=a;return null},SingleObjectTransaction.prototype.rollBack=function(){return e(this.object,this.from)},SingleObjectTransaction.prototype.rollForward=function(){return e(this.object,this.to)},SingleObjectTransaction.prototype.clearOptimizations=function(){return this.numberDeltas=this.interpolateToObjects=null},SingleObjectTransaction.prototype.optimizeInterpolation=function(){var t,e,n,i,r;for(t in this.numberDeltas={},this.interpolateToObjects={},this.nonInterpolatingFields={to:{},from:{}},i=[],n=this.from)e=n[t],r=this.to[t],"number"==typeof e?i.push(this.numberDeltas[t]=r-e):"function"==typeof(null!=e?e.interpolate:void 0)?i.push(this.interpolateToObjects[t]=r):(this.nonInterpolatingFields.from[t]=e,i.push(this.nonInterpolatingFields.to[t]=r));return i},SingleObjectTransaction.prototype.interpolateNumberFields=function(t){return e(this.object,this.numberDeltas,(n=this,function(e,i){return n.from[e]+i*t}));var n},SingleObjectTransaction.prototype.interpolateObjectFields=function(t){var n,i;try{return e(this.object,this.interpolateToObjects,(i=this,function(e,n){return i.from[e].interpolate(n,t)}))}catch(e){throw n=e,this.log("Art.Foundation.Transaction#interpolateObjectFields(p="+t+"): error "+n+" deltas: "+l(this.interpolateToObjects)+" from:   "+l(this.from)+" to:     "+l(this.to)),n}},SingleObjectTransaction.prototype.setNonInterpolatingFields=function(t){return e(this.object,this.nonInterpolatingFields[t>=1?"to":"from"])},SingleObjectTransaction.prototype.interpolate=function(t){return this.numberDeltas||this.optimizeInterpolation(),this.interpolateNumberFields(t),this.interpolateObjectFields(t),this.setNonInterpolatingFields(t)},SingleObjectTransaction.getter({noChanges:function(){return 0===this.props.length}}),SingleObjectTransaction.prototype.optimizeProperties=function(){var t,e,n,i,r;for(this.clearOptimizations(),r=[],t=0,e=(i=this.props).length;t<e;t++)n=i[t],this.from.hasOwnProperty(n)&&this.to.hasOwnProperty(n)&&!a(this.from[n],this.to[n])?r.push(void 0):r.push(this.deleteProp(n));return r},SingleObjectTransaction}()},function(t,e,n){var i,r,o,s,a,l,u={}.hasOwnProperty;r=n(42),i=n(96).BaseObject,a=r.min,s=r.max,l=r.round,o=r.inspect,t.exports=function(t){function Stat(){this.reset()}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Stat,i),Stat.prototype.reset=function(){return this.values=[],this.sum=0,this.max=this.min=null},Stat.getter({length:function(){return this.values.length},average:function(){return this.sum/this.values.length},median:function(){return this.values.slice().sort()[this.length/2|0]}}),Stat.prototype.percential=function(t){var e;return e=(this.length-1)*t/100|0,this.values.slice().sort(function(t,e){return e-t})[e]},Stat.prototype.histogram=function(t,e,n){var i,r,o,s,a,l,u,c,h;for(null==e&&(e=this.min),null==n&&(n=this.max),l=t/(n-e),r={},h=o=0,u=t;o<u;h=o+=1)r[e+h/l]=0;for(s=0,a=(c=this.values).length;s<a;s++)(i=((h=c[s])-e)*l|0)<0&&(i=0),i>=t&&(i=t-1),r[e+i/l]++;return r},Stat.prototype.toString=function(){return o({length:this.length,average:this.average,median:this.median,min:this.min,max:this.max})},Stat.prototype.toInfoMap=function(){return{length:this.length,average:this.average,median:this.median,min:this.min,max:this.max,p90:this.percential(90),p95:this.percential(95),p99:this.percential(99)}},Stat.prototype.toIntInfoMap=function(){return{length:this.length,average:l(this.average),median:l(this.median),min:l(this.min),max:l(this.max),p90:l(this.percential(90)),p95:l(this.percential(95)),p99:l(this.percential(99))}},Stat.prototype.toIntString=function(){return o(this.toIntInfoMap())},Stat.prototype.add=function(t){return this.values.push(t),this.sum+=t,1===this.values.length?this.max=this.min=t:(this.max=s(this.max,t),this.min=a(this.min,t))},Stat}()},function(t,e,n){var i,r,o,s,a,l={}.hasOwnProperty;(a=n(42)).rubyTrue,a.eq,a.inspect,r=a.Map,a.cloneByStructure,s=a.mapToKeysArray,a.mapToValuesArray,i=n(96).BaseClass,o=n(209),t.exports=function(t){function Transaction(t,e){null==e&&(e={}),Transaction.__super__.constructor.apply(this,arguments),this._objects=new r,t.constructor===Array?this.addObjects(t):this.addObject(t),e.properties&&this.addProperties(e.properties),e.property&&this.addProperties([e.property]),e.from&&this.addFromValues(e.from),e.to&&this.addToValues(e.to),this.saveFromValues()}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Transaction,i),Transaction.SingleObjectTransaction=o,Transaction.prototype.inspect=function(t){return t?(t.put(this.classPathName+":"),this.inspectParts(t)):ClassSystem.Inspect.inspect(this)},Transaction.prototype.inspectParts=function(t){return this._objects.each(function(e,n){return t.put("\n  "),t.inspect(n)})},Transaction.getter({objects:function(){return s(this._objects)}}),Transaction.prototype.properties=function(t){return this._objects.get(t).properties},Transaction.prototype.from=function(t){return this._objects.get(t).from},Transaction.prototype.to=function(t){return this._objects.get(t).to},Transaction.prototype.rollBack=function(){return this._objects.forEach(function(t){return t.rollBack()})},Transaction.prototype.rollForward=function(){return this._objects.forEach(function(t){return t.rollForward()})},Transaction.prototype.interpolate=function(t){return this._objects.forEach(function(e){return e.interpolate(t)})},Transaction.prototype.optimize=function(){return this.optimizeProperties(),this.optimizeObjects()},Transaction.getter({hasToValues:function(){var t;return t=!1,this._objects.forEach(function(e){if(e.hasToValues)return t=!0}),t},valuesChanged:function(){var t;return t=!1,this._objects.forEach(function(e){if(e.valuesChanged)return t=!0}),t}}),Transaction.prototype.toString=function(){return this.className+"\n  "+this._objects.map(function(t,e){return e.toString()}).join("  \n")},Transaction.prototype.addFromValues=function(t){return this._objects.forEach(function(e){return e.addFromValues(t)})},Transaction.prototype.addToValues=function(t){return this._objects.forEach(function(e){return e.addToValues(t)})},Transaction.prototype.addProperties=function(t){return this._objects.forEach(function(e){return e.addProperties(t)})},Transaction.prototype.addObject=function(t){var e;return e=new o(t),this._objects.set(e.object,e)},Transaction.prototype.addObjects=function(t){var e,n,i,r;for(r=[],e=0,n=t.length;e<n;e++)i=t[e],r.push(this.addObject(i));return r},Transaction.prototype.saveFromValues=function(){return this._objects.forEach(function(t){return t.saveFromValues()})},Transaction.prototype.saveToValues=function(){return this._objects.forEach(function(t){return t.saveToValues()})},Transaction.prototype.optimizeProperties=function(){return this._objects.forEach(function(t){return t.optimizeProperties()})},Transaction.prototype.optimizeObjects=function(){var t,e;return t=this._objects,this._objects=new r,t.forEach((e=this,function(t){if(!t.noChanges)return e._objects.set(t.object,t)}))},Transaction}()},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(213))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(214)).includeInNamespace(n(216)).addModules({BrowserDetection:n(222),Cookie:n(225),Dom:n(219),DomElementFactories:n(226),Download:n(217),EmailBrowserTools:n(220),File:n(227),IPhoneDeviceInformation:n(223),StandardImport:n(218),UriBrowserTools:n(221),UseragentRegExp:n(224)})},function(t,e,n){t.exports=n(18).addNamespace("Art.BrowserTools",class BrowserTools extends Neptune.PackageNamespace{}._configureNamespace(n(215)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*"},"description":"Art.Browser.Tools","license":"ISC","name":"art-browser-tools","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"1.2.1"}')},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>(()=>[n(217),n(219),n(220),n(221),n(222),n(224),{iPhoneDeviceInformation:n(223)}])())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["binary","console"],[e,n(218)],(t,n)=>{let r,o,s;return r=(s=e).window,o=s.document,i.defClass(class Download extends Object{},function(i,s,a){this.downloadBinaryData=function(n,o,s){let a;return o=t(o),null!=e.navigator.msSaveOrOpenBlob?(a=o.toBlob(s),r.navigator.msSaveOrOpenBlob(a,n)):o.toDataUri(s).then(t=>i.downloadFromUrl(t,n))},this.downloadFromUrl=function(t,e){let n;return(n=o.createElement("a")).setAttribute("href",t),n.setAttribute("download",e),n.setAttribute("target","_blank"),o.body.appendChild(n),n.click(),o.body.removeChild(n)},this.startHtmlFileDownload=function(t,e){let i;return(i=o.createElement("a")).setAttribute("target","_blank"),i.setAttribute("href",e),i.setAttribute("download",t),i.style.display="none",o.body.appendChild(i),i.click(),o.body.removeChild(i),n.log({element:i})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(42).mergeWithSelf(n(96),n(167),n(192)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["self","isPlainObject","Error","objectDiff","String","parseInt","Math","Promise"],[e,n(218)],(t,n,r,o,s,a,l,u)=>{let c,h,p,d;return c=(d=e).document,h=d.HTMLElement,p=d.window,i.defClass(class Dom extends Object{},function(d,f,m){let g;this.createElementFromHtml=function(t){let e;return(e=c.createElement("div")).innerHTML=t,e.firstChild},this.getDevicePixelRatio=function(){return null!=t.devicePixelRatio&&t.devicePixelRatio||1},this.setDomElementProp=((t,e,i,s)=>{let a,l,u;return(()=>{switch(e){case"class":return t.className=i||"";case"id":return t.id=i||"";case"innerHTML":return t.innerHTML=i||"";case"on":if(!n(i))throw new r("object expected for 'on' property");return o(i,s,a=((e,n)=>t.addEventListener(e,n)),l=((e,n)=>t.removeEventListner(e,n)),a);case"style":if(!n(i))throw new r("object expected for 'style' property");return({style:u}=t),o(i,s,a=((t,e)=>u[t]=e),l=(t=>u[t]=""),a);default:return t.setAttribute(e,i)}})()}),this.setDomElementProps=((t,e)=>i.each2(e,(e,n)=>this.setDomElementProp(t,n,e))),this.setDomElementChildren=function(t,e){let n,r,o,a,l,u,h;if(a=o=t.childNodes,null!=o)for(l=o.length,u=0;u<l;){let n,r,l;if(n=o[u],(r=u)>=e.length){a=void 0;break}i.is(l,s)&&l!==n.textContent?t.replaceChild(c.createTextNode(l),n):n!==(l=e[r])&&t.replaceChild(l,n),u++}for(n=t.childNodes.length,r=e.length;n>r;)n--,t.removeChild(t.lastChild);return(()=>{for(;r>n;){let r;h=t.appendChild(i.is(r=e[n++],s)?c.createTextNode(r):r)}return h})()},this.zIndex=function(t,e){let n;if(t instanceof h||(t=c.getElementById(t)),void 0!==e)return t.style.zIndex=e;for(n=t;n&&n!==c;){let t;switch(n.style.position){case"absolute":case"relative":case"fixed":if((t=a(n.style.zIndex))<0||t>0)return t}n=n.parentElement}return 0},this.domElementOffset=function(t){let e,n,i,r,o,s,a,u,h,d;return(()=>{try{return e=t.getBoundingClientRect(),n=c.body,i=c.documentElement,r=p.pageYOffset||i.scrollTop||n.scrollTop,o=p.pageXOffset||i.scrollLeft||n.scrollLeft,s=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,u=e.top+r-s,h=e.left+o-a,{top:l.round(u),left:l.round(h)}}catch(t){return d=t,{top:0,left:0}}})()},this.getDomReadyPromise=function(){return new u(t=>c&&"loading"===c.readyState?c.addEventListener("readystatechange",()=>"interactive"===c.readyState?t():void 0):t())},this.openLink=g=function(t){return e.open(t,"_blank")}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["encodeUri","openLink"],[e,n(218),n(221),n(219)],(t,e)=>{return i.defClass(class EmailBrowserTools extends Object{},function(n,i,r){let o;this.encodeMailto=o=function(e){let n,i,r,o,s,a;return n=e.cc,i=e.bcc,r=e.subject,o=e.body,s=void 0!==(a=e.to)?a:"",t({protocol:"mailto",path:s,query:{cc:n,bcc:i,subject:r,body:o}})},this.sendEmail=function(t){return e(o(t))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["hasProperties","encodeURIComponent","present","Error"],[e,n(218)],(t,e,n,r)=>{return i.defClass(class UriBrowserTools extends Object{},function(o,s,a){let l,u,c,h,p;this.encodeUriQuery=l=function(r){return t(r)?i.array(r,(t,n)=>`${i.toString(n)}=${i.toString(e(t))}`,(t,e)=>null!=t&&n(t)).join("&"):""},this.stripLeadingSlash=u=function(t){return t.match(/^\/?(.*)/)[1]},this.stripTrailingSlash=c=function(t){return t.match(/(^.*[^\/])\/?$/)[1]},this.uriPathJoin=h=function(t,e){return n(t)||(t=null),n(e)||(e=null),t&&e?/\:$/.test(t)?`${i.toString(t)}${i.toString(u(e))}`:`${i.toString(c(t))}/${i.toString(u(e))}`:t||e||""},this.encodeUri=p=function(t){let e,o,s,a,u,c,p;return e=t.host,o=t.path,s=t.port,a=t.uri,u=t.protocol,c=t.query,n(a)||(u=n(u)?u:"",e=n(e)?e:"",p=(()=>{switch(!1){case!e:return`${i.toString(u)}://${i.toString(e)}`;case!u:return`${i.toString(u)}:`;default:return""}})(),s=n(s)?(e||(()=>{throw new r("host required when specifying port")})(),`:${i.toString(s)}`):"",a=`${i.toString(p)}${i.toString(s)}`),c=l(c),c=n(c)?`?${i.toString(c)}`:"",`${i.toString(h(a,o))}${i.toString(c)}`}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","iPhoneNotchSizes","min","isMobileBrowserRegExp1","isNumber","iPhoneNotchSafePadding","parseInt","merge","isWebSpiderRegExp","max","log"],[e,n(218),n(223),n(224)],(t,r,o,s,a,l,u,c,h,p,d)=>{let f,m,g,y,v,S,b,w,x,P,C,_;return f=(C=e).window,m=C.document,g=C.screen,y=C.CSS,v=C.navigator,S=C.opera,b=void 0!==(_=C.devicePixelRatio)?_:1,w=x=!!(t().fakeNative||t().fakeNativeApp||t().nativePreview),P=600,i.defClass(class BrowserDetection extends Object{},function(t,P,C){let _,E,T,k,I,M;this.isBrowser=!!v,this.getAgent=_=function(){return i.exists(v)&&v.userAgent||i.exists(v)&&v.vendor||S||""},this.getMaxCanvasPixels=(()=>"iOS"===this.simpleBrowserInfo.os?16777216:64*i.pow(1024,2)),this.getHasIPhoneXNotch=function(t=I.subDevice){return r[t]>0},this.getNotchInfo=((t=I.subDevice)=>{let e,n;return this.getHasIPhoneXNotch(t)?{notchHeight:null!=(n=r[t])?n:30,notchWidth:e=209,roundedCornerRadius:40,antiNotchWidth:(o(g.availWidth,g.availHeight)-e)/2,notchLocation:this.getOrientationIsPortrait()?"top":90===this.getOrientationAngle()?"left":"right"}:void 0}),E=_(),T=function(){return s.test(E)},this.getClientWidth=function(){let t;return(null!=(t=m.documentElement)?t:m.body).clientWidth},this.getClientHeight=function(){let t;return(null!=(t=m.documentElement)?t:m.body).clientWidth},this.getOrientationAngle=function(){let t,n;return null!=(t=i.exists(g)&&i.exists(n=g.orientation)&&n.angle)?t:e.orientation},this.getOrientationIsPortrait=(t=>{let e;return(()=>{switch(!1){case!a(e=this.getOrientationAngle()):return e%180==0;case!(null!=t):return t.x<=t.y;default:return!0}})()}),this.getScreenSize=(t=>{let n,i,r,o;return n=!this.getOrientationIsPortrait(t),i=(o=e.screen).availWidth,r=o.availHeight,n&&r>i||!n&&r<i?{x:r,y:i}:{x:i,y:r}}),k=null,this.getSafeAreaInsetCssKey=function(){return null!=k?k:k=null!=y&&(()=>{switch(!1){case!y.supports("padding-bottom: env(safe-area-inset-bottom)"):return"env";case!y.supports("padding-bottom: constant(safe-area-inset-bottom)"):return"constant"}})()},this.getCssSafeAreaInset=(()=>{let t,e,n,r,o,s;return x&&this.getHasIPhoneXNotch()?(t=l.top,e=l.bottom,this.getOrientationIsPortrait()?{left:0,right:0,top:t,bottom:e}:{left:t,right:e,top:0,bottom:e}):((n=this.getSafeAreaInsetCssKey())?((r=m.createElement("div")).style.paddingTop=`${i.toString(n)}(safe-area-inset-top)`,r.style.paddingLeft=`${i.toString(n)}(safe-area-inset-left)`,r.style.paddingRight=`${i.toString(n)}(safe-area-inset-right)`,r.style.paddingBottom=`${i.toString(n)}(safe-area-inset-bottom)`,m.body.appendChild(r),o=f.getComputedStyle(r),s={top:0|u(o.paddingTop),left:0|u(o.paddingLeft),right:0|u(o.paddingRight),bottom:0|u(o.paddingBottom)},m.body.removeChild(r)):s={top:0,left:0,right:0,bottom:0},0===s.top&&"iOS"===I.os&&I.nativeApp&&("iPad"===I.device||this.getOrientationIsPortrait())?c(s,{top:20}):s)}),I=null,this.getCachedSimpleBrowserInfo=(()=>this.simpleBrowserInfo=null!=I?I:I=this.getSimpleBrowserInfo()),this.getSimpleBrowserInfo=this.isBrowser?()=>{let t,r,s,a,l,u,c,d,y,v,P,C,k,M,A,F,B,R,z;return E=_(),this.simpleBrowserInfo=I={devicePixelRatio:b,pixelsPerPoint:b,os:t=(()=>{switch(!1){case!(r=/ipad|ipod|iphone/i.test(E)):return"iOS";case!(s=/Windows Phone/i.test(E)):return"windowsPhone";case!(a=/windows/i.test(E)):return"windows";case!(l=/mac os x/i.test(E)):return"osx";case!(u=/android/i.test(E)):return"android";case!(c=/linux/.test(E)):return"linux";default:return"other"}})(),browser:(()=>{switch(!1){case!(d=h.test(E)):return"webSpider";case!(y=!!f.MSInputMethodContext&&!!m.documentMode):return"ie11";case!(v=!!f.InstallTrigger):return"firefox";case!(P=r||/^((?!chrome|android).)*safari/i.test(E)):return"safari";case!(C=/Edge/.test(E)):return"edge";case!(S=null!=f.opera||/\ OPR\//.test(E)):return"opera";case!(k=/Chrome\/\d/i.test(E)):return"chrome";default:return"other"}})(),fakeNativeApp:x=w&&("android"===t||"iOS"===t),nativeApp:M=!(!x&&!e.cordova),device:A=(()=>{switch(!1){case!/iphone|ipod/i.test(E):return"iPhone";case!/ipad/i.test(E):return"iPad";default:return"other"}})(),touch:F=null!=m.documentElement.ontouchstart||T(),deviceMajorScreenSize:B=p(g.availWidth,g.availHeight),deviceMinorScreenSize:R=o(g.availWidth,g.availHeight),subDevice:null!=(z=(()=>{switch(A){case"iPhone":return i.find(n(223).iPhonePointSizes,([t,e],n)=>n,([t,e],n)=>t===R&&e===B)}})())?z:"other",deviceType:F?R<600?"phone":"tablet":"desktop"}}:function(){return{}},this.simpleBrowserInfo=this.getSimpleBrowserInfo(),this.getIsMobileBrowser=T,M=function(){return d.warn("DEPRICATED - use simpleBrowserInfo directly")},this.isSafari=function(){return M(),!!I.safari},this.isMobileBrowser=(()=>(d.warn("isMobileBrowser DEPRICATED - use getIsMobileBrowser"),this.getIsMobileBrowser())),this.nativeAppDetect=function(){return M(),!!I.nativeApp},this.isTouchDevice=function(){return M(),!!I.touch},this.iOSDetect=function(){return M(),"iOS"===I.os},this.androidDetect=function(){return M(),"android"===I.os},this.iPhoneDetect=function(){return M(),"iPhone"===I.device},this.iPadDetect=function(){return M(),"iPad"===I.device},this.isIe11=function(){return M(),"ie11"===I.browser}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{let t,n,r,o,s,a,l,u=e.Math;return{iPhonePointSizes:t={iPhone4:[320,480],iPhone5:[320,568],iPhone6:[375,667],iPhoneX:[375,812],iPhone6Plus:[414,736],iPhoneXSMax:[414,896],iPhoneXR:[414,896]},iPhoneNotchSafePadding:n={top:44,bottom:21},iPhoneNotchSizes:r={iPhoneX:30,iPhoneXSMax:30,iPhoneXR:30},iPhoneDisplayScales:o={iPhone4:2,iPhone5:2,iPhone6:2,iPhone6Plus:3,iPhoneX:3,iPhoneXSMax:3,iPhoneXR:2},iPhoneDiagonalSizeInches:s={iPhone4:3.5,iPhone5:4,iPhone6:4.7,iPhone6Plus:5.5,iPhoneX:5.8,iPhoneXSMax:6.5,iPhoneXR:6.1},iPhonePixelsPerInch:a={iPhone4:326,iPhone5:326,iPhone6:326,iPhone6Plus:401,iPhoneX:458,iPhoneXSMax:458,iPhoneXR:326},iPhonePixelSizes:l=i.object(o,(e,n)=>{let i,r;return[i,r]=t[n],[i*e,r*e]}),iPhonePointsPerInch:i.object(t,([t,e],n)=>u.sqrt(t*t+e*e)/s[n])}})}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){let e=n(3);e.defMod(t,()=>{return e.defClass(class UseragentRegExp extends Object{},function(t,e,n){this.isMobileBrowserRegExp1=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge|maemo|midp|mmp|mobile.+firefox|netfront|operam(ob|in)i|palm(os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windowsce|xda|xiino|android|ipad|playbook|silk/i,this.isWebSpiderRegExp=/Googlebot|GoogleWebPreview|GooglePageSpeedInsights|Bingbot|Yahoo.*Slurp|DuckDuckBot|Baiduspider|YandexBot|Exabot|facebot|facebookexternalhit|alexa.com/i})})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["isString","isPlainArray","isPlainObject","Error","JSON","Date"],[e,n(218)],(t,n,r,o,s,a)=>{let l,u;return l=e.document,u=function(e,u,{expires:c,path:h}){let p,d;if(!t(u)){if(!n(u)&&!r(u))throw new o("cookieValue must be a string, array or object");u=s.stringify(u)}return p=`${i.toString(e)}=${i.toString(u)}`,c&&((d=new a).setTime(d.getTime()+24*c*60*60*1e3),p+=`; expires=${i.toString(d.toUTCString())}`),h&&(p+=`; path=${i.toString(h)}`),l.cookie=p},i.defClass(class Cookie extends Object{},function(t,e,n){this.set=function(t,e,n){return u(t,e,n)},this.remove=function(t,e){return u(t,{path:e.path,expires:-1})},this.get=function(t){let e,n,r;return e=t+"=",n=l.cookie.split(";"),r=null,i.each2(n,t=>{for(;" "===t.charAt(0);)t=t.substring(1);return 0===t.indexOf(e)?(r=t.substring(e.length,t.length)).match(/^[{[]/)?r=s.parse(r):void 0:void 0},t=>!r),r}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["createObjectTreeFactories","mergeInto","setDomElementProps","setDomElementChildren"],[e,n(218),n(219)],(t,n,r,o)=>{let s,a,l;return s=(l=e).Node,a=l.document,i.defClass(class DomElementFactories extends Object{},function(e,s,l){this.createDomElementFactories=((...e)=>t({mergePropsInto:(t,e)=>i.each2(e,(e,i)=>t[i]="style"===i?n(t[i],e):e)},e,(t,e,n)=>{let i;return i=a.createElement(t),null!=e&&r(i,e),null!=n&&o(i,n),i})),this.allDomElementNames="A Abbr Acronym Address Applet Area Article Aside Audio B Base BaseFont Bdi Bdo Big BlockQuote Body Br Button Canvas Caption Center Cite Code Col ColGroup DataList Dd Del Details Dfn Dialog Dir Div Dl Dt Em Embed FieldSet FigCaption Figure Font Footer Form Frame FrameSet H1 H2 H3 H4 H5 H6 Head Header Hr Html I IFrame Img Input Ins Kbd KeyGen Label Legend Li Link Main Map Mark Menu MenuItem Meta Meter Nav NoFrames NoScript Object Ol OptGroup Option Output P Param Pre Progress Q Rp Rt Ruby S Samp Script Section Select Small Source Span Strike Strong Style Sub Summary Sup Table TBody Td TextArea TFoot Th THead Time Title Tr Track Tt U Ul Var Video Wbr",i.object(this.createDomElementFactories(this.allDomElementNames),null,null,this)})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Promise","createElementFromHtml"],[e,n(218),n(219)],(t,n)=>{return i.defClass(class File extends Object{},function(r,o,s){this.request=((r={})=>new t((t,o)=>{let s,a,l,u,c,h;return s=r.accept,a=r.multiple,l=r.onChange,i.exists(h=this.hiddenDivForFileInput)&&h.parentNode.removeChild(this.hiddenDivForFileInput),this.hiddenDivForFileInput=n("<div style='height: 0px;width: 0px; overflow:hidden; position:absolute;'/>"),u=e.document.body,c=n(`<input type='file' ${i.toString(s?"accept="+s:void 0)} ${i.toString(a?"multiple=true":void 0)} />`),this.hiddenDivForFileInput.appendChild(c),u.appendChild(this.hiddenDivForFileInput),c.onchange=(e=>{let n,i,r,s,a,u;return i=c.files,r=[],null!=i&&(s=i.length,a=0,(()=>{for(;a<s;){let t;t=i[a],r.push(t),u=a++}})()),(n=r).length>0&&n[0]?(l&&l(n),t(n)):o("no files returned")}),c.click()}))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;(r=n(42)).w,r.Validator,i=r.defineModule,r.mergeInto,r.Promise,e=n(106).Configurable,i(t,function(t){function ArtFoundationConfig(){return ArtFoundationConfig.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ArtFoundationConfig,e),ArtFoundationConfig}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(167)},function(t,e,n){(t.exports=n(138)).includeInNamespace(n(231)).addModules({AfterEventsFilter:n(232),DataUpdatesFilter:n(239),LinkFieldsFilter:n(240),LinkFieldsFilter2:n(242),LinkFieldsFilter2LegacyApiDecode:n(243),LinkFieldsFilter2LegacyApiEncode:n(244),LinkFieldsFilter2Transition2BFilter:n(245),PrefetchedRecordsFilter:n(246),TimestampFilter:n(248),UniqueIdFilter:n(249),UserOwnedFilter:n(255),UuidFilter:n(256),ValidationFilter:n(241)})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>({_resetFilters:function(){return n(232)._reset()}}))}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;r=(l=n(160)).defineModule,l.log,i=l.Promise,o=l.isFunction,s=l.isString,a=l.pushIfNotPresent,l.formattedInspect,e=n(233),r(t,function(t){function AfterEventsFilter(){return AfterEventsFilter.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(AfterEventsFilter,e),AfterEventsFilter.handlers={},AfterEventsFilter._registeredPipelineHandlers={},AfterEventsFilter._reset=function(){return AfterEventsFilter.handlers={},AfterEventsFilter._registeredPipelineHandlers={}},AfterEventsFilter.on=function(t,e,n){var i,r;return a((i=(r=this.handlers)[t]||(r[t]={}))[e]||(i[e]=[]),n)},AfterEventsFilter.registerPipelineListener=function(t,e,n){if(!o(t.handleRequestAfterEvent))throw new Error("listeningPipeline must implement handleRequestAfterEvent");if(!s(e))throw new Error("listeningToPipelineName must be a string");return this.on(e,n,t)},AfterEventsFilter.sendEvents=function(t){return i.resolve(t).then(function(t){var e,n,r,s;return r=t.pipelineName,s=t.requestType,n=function(){var n,i,a,l,u;for(u=[],n=0,i=(l=(null!=(a=AfterEventsFilter.handlers[r])?a[s]:void 0)||[]).length;n<i;n++)e=l[n],o(e.handleRequestAfterEvent)?u.push(e.handleRequestAfterEvent(t)):u.push(e(t));return u}(),i.all(n)}).then(function(){return t})},AfterEventsFilter.after({all:function(t){return AfterEventsFilter.sendEvents(t)}}),AfterEventsFilter}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;(s=n(140)).toPlainObjects,e=s.Validator,s.toInspectedObjects,s.getInspectedObjects,i=s.defineModule,s.BaseObject,s.Promise,s.log,s.isPlainObject,s.mergeInto,r=s.merge,s.shallowClone,s.CommunicationStatus,s.success,s.isFailure,o=e.normalizeFields,n(234),n(237),n(159).config,i(t,function(t){var e,i;function Filter(t){var e;null==t&&(t={}),Filter.__super__.constructor.apply(this,arguments),this.serverSideOnly=t.serverSideOnly,this.clientSideOnly=t.clientSideOnly,this.name=null!=(e=t.name)?e:this.class.getName(),this.location=t.location,this.fields=t.fields,this.group=t.group,this.filterFailures=t.filterFailures,this.after=t.after,this.before=t.before}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Filter,n(238)),Filter.extendableProperty({before:{},after:{}}),Filter.extendableProperty({fields:{}},{extend:function(t,e){return r(t,o(e))}}),Filter.extendableProperty({filterFailures:!1}),Filter.locationNames=e={server:!0,client:!0,both:!0},Filter.extendableProperty({location:"server"},{extend:function(t,n){if(!e[n])throw new Error("invalid location: "+n);return n}}),Filter.groupNames={loggers:3,authorization:2,outer:1,outter:1,middle:0,inner:-1},Filter.extendableProperty({group:Filter.groupNames.middle},{extend:function(t,e){var n;if(null!=e){if(null==(n=Filter.groupNames[e]))throw new Error("invalid Filter group: "+e);return n}return 0}}),i={client:2e3,both:0,server:0},Filter.getter({priority:function(){return this.group+i[this.location]}}),Filter.property("name"),Filter.setter({nextHandler:function(t){throw new Error("depricated")}}),Filter.prototype.shouldFilter=function(t){switch(this.location){case"server":return"client"!==t;case"client":return"server"!==t;case"both":return!0;default:throw new Error("Filter "+this.getName()+": invalid filter location: "+location)}},Filter.prototype.toString=function(){return this.getName()},Filter.prototype.getBeforeFilter=function(t){var e,n;return n=t.requestType,e=t.location,this.shouldFilter(e)&&(this.before[n]||this.before.all)},Filter.prototype.getAfterFilter=function(t){var e,n;return n=t.requestType,e=t.location,this.shouldFilter(e)&&(this.after[n]||this.after.all)},Filter.prototype.processBefore=function(t){return this.applyHandler(t,this.getBeforeFilter(t),"beforeFilter")},Filter.prototype.processAfter=function(t){return this.applyHandler(t,this.getAfterFilter(t),"afterFilter")},Filter.prototype.handleRequest=function(t,e,n){return this.processBefore(t).then((i=this,function(t){var r,o;return t.isResponse?t:((r=e[o=n+1])?r.handleRequest(t,e,o):t.missing("no Handler for request type: "+t.type)).then(function(t){return t.isSuccessful||i.filterFailures?i.processAfter(t):t})}));var i},Filter.getter({logName:function(){return this.getName()},inspectedObjects:function(){var t,e;return e=this.getNamespacePath(),t=this.name,e.match(t)?e:t},props:function(){return{location:this.location}}}),Filter}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g={}.hasOwnProperty;(f=n(160)).currentSecond,f.each,d=f.present,f.Promise,f.BaseObject,o=f.RestClient,c=f.merge,f.inspect,f.isString,f.isObject,u=f.log,s=f.Validator,r=f.CommunicationStatus,f.arrayWith,f.w,f.objectKeyCount,f.isString,f.isPlainObject,f.objectWithout,f.isFunction,h=f.object,p=f.objectHasKeys,i=n(136),r.success,r.missing,r.validStatus,r.clientFailure,l=r.failure,a=null,m=function(){return a||(a=new s({pipeline:{required:{instanceof:i.Pipeline}},type:{required:{fieldType:"string"}},session:{required:{fieldType:"object"}},parentRequest:{instanceof:i.Request},originatedOnServer:"boolean",props:"object",key:"string"}))},t.exports=function(t){var e,i;function Request(t){var e,n,i,r;if(Request.__super__.constructor.apply(this,arguments),this.verbose=t.verbose,this.type=t.type,this.pipeline=t.pipeline,this.session=t.session,this.originalRequest=t.originalRequest,this.parentRequest=t.parentRequest,this.originatedOnServer=t.originatedOnServer,this.props=null!=(i=t.props)?i:{},e=t.context,this._context=e,this._startTime=null,null!=(n=null!=(r=t.key)?r:this._props.key)&&(t.key=this._props.key=this.pipeline.toKeyString(n)),null!=t.data&&(this._props.data=t.data),null==this._originalRequest&&(this._originalRequest=this),m().validate(t,{context:"Art.Ery.Request options",logErrors:!0}),t.requestOptions)throw new Error("options.requestOptions is DEPRICATED - use options.props")}return function(t,e){for(var n in e)g.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Request,n(235)),Request.property("verbose originalRequest type pipeline session originatedOnServer parentRequest props data key context"),Request.getter({context:function(){return null!=this._context?this._context:this._context={}},key:function(){return this._props.key},data:function(){return this._props.data},requestData:function(){return this._props.data},requestProps:function(){return this._props},requestOptions:function(){throw new Error("DEPRICATED: use props")},description:function(){return this.requestString+" request"},summary:function(){return{request:{props:this.props}}}}),Request.getter({request:function(){return this},shortInspect:function(){return(this.parentRequest?this.parentRequest.shortInspect+" > ":"")+this.pipeline.getName()+"-"+this.type+"("+(this.key||"")+")"},beforeFilterLog:function(){return this.filterLog||[]},afterFilterLog:function(){return[]},isRequest:function(){return!0},isRootRequest:function(){return!this.parentRequest},requestPipelineAndType:function(){return u.warn("DEPRICATED - use pipelineAndType"),this.pipeline.name+"-"+this.type},propsForClone:function(){return{originalRequest:this.originalRequest,pipeline:this.pipeline,type:this.type,props:this.props,session:this.session,parentRequest:this.parentRequest,filterLog:this.filterLog,originatedOnServer:this.originatedOnServer,context:this._context,verbose:this.verbose}},urlKeyClause:function(){return d(this.key)?"/"+this.key:""}}),Request.prototype.handled=function(t){return this.success().then(function(e){return e.handled(t)})},Request.prototype.getRestRequestUrl=function(t){return t+"/"+this.pipeline.name+this.urlKeyClause},Request.prototype.getNonRestRequestUrl=function(t){return t+"/"+this.pipeline.name+"-"+this.type+this.urlKeyClause},Request.prototype.toPromise=function(){throw new Error("ArtEry.Request: toPromise can only be called on Response objects.")},i={get:"get",create:"post",update:"put",delete:"delete"},Request.getRestClientParamsForArtEryRequest=e=function(t){var e,n,r,o,s,a,l,u,c,h;return l=t.session,a=t.server,s=t.restPath,u=t.type,r=t.key,e=t.data,h=d(r)?"/"+r:"",a||(a=""),n=p(l),c=!(o=i[u])||"get"===o&&n?(o="post",""+a+s+"-"+u+h):""+a+s+h,{method:o,url:c,data:e}},Request.getter({remoteRequestProps:function(){var t,n,i,r,o,s,a;return this,s=this.session,t=this.data,r=this.props,i=this.pipeline,a=this.type,n=this.key,0,r=h(r,{when:function(t,e){return void 0!==t&&"key"!==e&&"data"!==e}}),t=h(t,{when:function(t){return void 0!==t}}),o=null,s.signature&&((o||(o={})).session=s.signature),0<p(r)&&((o||(o={})).props=r),0<p(t)&&((o||(o={})).data=t),e({restPath:i.restPath,server:function(){switch(i.remoteServer){case!0:case".":case"/":return"";default:return i.remoteServer}}(),type:a,key:n,session:s,data:o})}}),Request.createFromRemoteRequestProps=function(t){var e,n;return n=t.session,new Request({pipeline:t.pipeline,type:t.type,session:n,key:t.key,data:(e=t.requestData).data,props:e.props,originatedOnClient:!0})},Request.prototype.sendRemoteRequest=function(){var t,e;return o.restJsonRequest(t=this.remoteRequestProps).catch(function(t){var e,n,i,r;return t.info?(r=(n=t.info).status,i=n.response):(r=t.status,e=t.message),null==r&&(r=l),c(i,{status:r,message:e})}).then((e=this,function(n){return e.addFilterLog(t.method.toLocaleUpperCase()+" "+t.url).toResponse(n.status,c(n,{remoteRequest:t,remoteResponse:n}))}))},Request}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z={}.hasOwnProperty;M=n(42),B=M.timeout,h=M.currentSecond,w=M.log,s=M.arrayWith,P=M.mergeWithoutNulls,p=M.defineModule,x=M.merge,v=M.isJsonType,b=M.isString,S=M.isPlainObject,m=M.isArray,M.inspect,M.inspectedObjectLiteral,R=M.toInspectedObjects,f=M.formattedInspect,r=M.Promise,E=M.object,y=M.isFunction,M.objectWithDefinedValues,k=M.objectWithout,o=M.array,M.isPromise,u=M.compactFlatten,T=M.objectKeyCount,I=M.present,e=n(136),i=n(236),A=n(141),_=A.networkFailure,d=A.failure,g=A.isClientFailure,F=A.success,C=A.missing,A.serverFailure,a=A.clientFailure,l=A.clientFailureNotAuthorized,c=n(159).config,p(t,function(t){var n,p,M;function RequestResponseBase(t){RequestResponseBase.__super__.constructor.apply(this,arguments),this._creationTime=h(),this.filterLog=t.filterLog,this.errorProps=t.errorProps}return function(t,e){for(var n in e)z.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(RequestResponseBase,i),RequestResponseBase.property("filterLog errorProps creationTime"),RequestResponseBase.prototype.addFilterLog=function(t){return this._filterLog=s(this._filterLog,{name:b(t)?t:t.getLogName(this.type),time:h()}),this},RequestResponseBase.getter({location:function(){return this.pipeline.location},requestType:function(){return this.type},pipelineName:function(){return this.pipeline.getName()},requestDataWithKey:function(){return x(this.requestData,this.keyObject)},keyObject:function(){return this.request.pipeline.toKeyObject(this.key)},rootRequest:function(){var t;return(null!=(t=this.parentRequest)?t.rootRequest:void 0)||this.request},originalRequest:function(){var t;return null!=(t=this._originalRequest)?t:this.request.originalRequest},startTime:function(){return this.rootRequest.creationTime},endTime:function(){return this.creationTime},wallTime:function(){return this.startTime-this.endTime},requestChain:function(){var t;return u([this.isResponse?this.request.requestChain:null!=(t=this.parentRequest)?t.requestChain:void 0,this])},simpleInspectedObjects:function(){var t,e;return e=k(this.props,"key","data"),0<T(e)||(e=null),R(E(((t={})[""+this.class.name]=this.requestString,t.originatedOnServer=this.originatedOnServer,t.data=this.data,t.status=this.status,t.props=e,t.errorProps=this.errorProps,t),{when:function(t){return null!=t}}))},inspectedObjects:function(){var t,e;return(t={})["Art.Ery."+this.class.name]=function(){var t,n,i,r;for(r=[],t=0,n=(i=this.requestChain).length;t<n;t++)e=i[t],r.push(e.simpleInspectedObjects);return r}.call(this),t}}),RequestResponseBase.getter({isSuccessful:function(){return!0},isFailure:function(){return this.notSuccessful},notSuccessful:function(){return!1},requestSession:function(){return this.request.session},requestProps:function(){return this.request.requestProps},requestData:function(){return this.request.requestData},isRootRequest:function(){return this.request.isRootRequest},key:function(){var t;return this.request.key||(null!=(t=this.responseData)?t.id:void 0)},pipeline:function(){return this.request.pipeline},parentRequest:function(){return this.request.parentRequest},isSubrequest:function(){return!!this.request.parentRequest},type:function(){return this.request.type},originatedOnServer:function(){return this.request.originatedOnServer},context:function(){return this.request.context},pipelineAndType:function(){return this.pipelineName+"."+this.type},requestString:function(){return this.key?this.pipelineAndType+" "+f(this.key):this.pipelineAndType},description:function(){return this.requestString},requestPathArray:function(t){var e,n;return e=t||[],(n=this.parentRequest)&&n.getRequestPathArray(e),e.push(this),e},requestPath:function(){var t;return function(){var e,n,i,r;for(r=[],e=0,n=(i=this.requestPathArray).length;e<n;e++)t=i[e],r.push(t.requestString);return r}.call(this).join(" >> ")}}),RequestResponseBase.prototype.toStringCore=function(){return"ArtEry."+(this.isResponse?"Response":"Request")+" "+this.pipelineName+"."+this.type+(this.key?" key: "+this.key:"")},RequestResponseBase.prototype.toString=function(){return"<"+this.toStringCore()+">"},RequestResponseBase.getter({requestCache:function(){var t;return(t=this.context).requestCache||(t.requestCache={})},subrequestCount:function(){var t;return(t=this.context).subrequestCount||(t.subrequestCount=0)}}),RequestResponseBase.setter({responseProps:function(){throw new Error("cannot set responseProps")}}),RequestResponseBase.prototype.incrementSubrequestCount=function(){return this.context.subrequestCount=1+(0|this.context.subrequestCount)},RequestResponseBase.prototype.createSubRequest=function(t,n,i){var r,o;if(i&&!S(i))throw new Error("requestOptions must be an object");if(!(r=e.pipelines[t]))throw new Error("Pipeline not registered: "+f(t));return new e.Request(x({originatedOnServer:null==(o=null!=i?i.originatedOnServer:void 0)||o},i,{type:n,pipeline:r,verbose:this.verbose,session:(null!=i?i.session:void 0)||this.session,parentRequest:this.request,context:this.context}))},RequestResponseBase.prototype.subrequest=function(t,e,n,i){var r,o,s;return b(n)&&(n=x(i,{key:n})),t=t.pipelineName||t,s=this.createSubRequest(t,e,n),this.incrementSubrequestCount(),r=s.pipeline._processRequest(s).then(function(t){return t.toPromise(n)}),"update"===e&&!(null!=n&&null!=(o=n.props)?o.returnValues:void 0)&&b(s.key)&&(this._getPipelineTypeCache(t,e)[s.key]=r),r},RequestResponseBase.prototype.nonblockingSubrequest=function(t,e,n){var i;return this.subrequest(t,e,n).then((i=this,function(r){if(c.verbose)return w({ArtEry:{RequestResponseBase:{nonblockingSubrequest:{status:"success",pipelineName:t,type:e,requestOptions:n,parentRequest:{pipelineName:i.pipelineName,type:i.type,key:i.key},result:r}}}})})).catch(function(i){return function(r){return w({ArtEry:{RequestResponseBase:{nonblockingSubrequest:{status:"failure",pipelineName:t,type:e,requestOptions:n,parentRequest:{pipelineName:i.pipelineName,type:i.type,key:i.key},error:r}}}})}}(this)),r.resolve()},RequestResponseBase.prototype._getPipelineTypeCache=function(t,e){var n,i;return(n=(i=this.requestCache)[t]||(i[t]={}))[e]||(n[e]={})},RequestResponseBase.prototype.cachedSubrequest=function(t,e,n,i){if(void 0!==i)throw new Error("DEPRICATED: 4-param cachedSubrequest");return this._cachedSubrequest(t,e,e,n)},RequestResponseBase.prototype._cachedSubrequest=function(t,e,n,i){var r,o,s;if(o=b(i)?i:i.key,!b(o))throw new Error("_cachedSubrequest: key must be a string ("+f({key:o})+")");return(r=this._getPipelineTypeCache(t,e))[o]||(r[o]=this.subrequest(t,n,i).catch((s=this,function(e){if(e.status===_&&"get"===n)return B(20+10*Math.random()).then(function(){return s.subrequest(t,n,i)});throw e})))},RequestResponseBase.prototype.setGetCache=function(){if(this.status===F&&I(this.key)&&null!=this.responseData)return this._getPipelineTypeCache(this.pipelineName,"get")[this.key]=r.then((t=this,function(){return t.responseData}));var t},RequestResponseBase.prototype.cachedGet=n=function(t,n){if(S(n)&&(n=e.pipelines[t].dataToKeyString(n)),!b(n))throw new Error("cachedGet: key must be a string OR object when pipeline supports dataToKeyString ("+f({key:n})+")");return this.cachedSubrequest(t,"get",n)},RequestResponseBase.prototype.cachedGetWithoutInclude=function(t,e){if(!b(e))throw new Error("cachedGetWithoutInclude: key must be a string ("+f({key:e})+")");return this._getPipelineTypeCache(t,"get")[e]||this._cachedSubrequest(t,"get-no-include","get",{key:e,props:{include:!1}})},RequestResponseBase.prototype.cachedPipelineGet=n,RequestResponseBase.prototype.cachedGetIfExists=function(t,e){return null==e?r.resolve(null):this.cachedGet(t,e).catch(function(t){if(t.status===C)return r.resolve(null);throw t})},RequestResponseBase.prototype.rejectIfErrors=function(t){return t?this.clientFailure(u([this.pipelineAndType,"requirement not met",t]).join(" - ")).then(function(t){return t.toPromise()}):r.resolve(this)},RequestResponseBase.prototype.rejectNotAuthorizedIfErrors=function(t){return t?this.clientFailureNotAuthorized(u([this.pipelineAndType,"requirement not met",t]).join(" - ")).then(function(t){return t.toPromise()}):r.resolve(this)},RequestResponseBase._resolveRequireTestValue=M=function(t){return y(t)&&(t=t()),r.resolve(t)},RequestResponseBase.prototype.require=function(t,e){return M(t).then((n=this,function(t){return n.rejectIfErrors(t?void 0:null!=e?e:[])}));var n},RequestResponseBase.prototype.requiredFields=function(t,e){var n,i;for(n in i=null,t)null==t[n]&&(null!=i?i:i=[]).push(n);return this.rejectIfErrors(i?["missing fields: "+i.join(", "),e]:void 0).then(function(){return t})},RequestResponseBase.prototype.rejectIf=function(t,e){return M(t).then((n=this,function(t){return n.require(!t,e)}));var n},RequestResponseBase.prototype.requireServerOrigin=function(t){return this.requireServerOriginOr(!1,t)},RequestResponseBase.prototype.requireServerOriginOr=function(t,e){return this.originatedOnServer?r.resolve(this):M(t).then((n=this,function(t){return n.rejectNotAuthorizedIfErrors(t?void 0:"originatedOnServer required "+((null!=e?e.match(/\s*to\s/):void 0)?e:e?"to "+e:""))}));var n},RequestResponseBase.prototype.requireServerOriginIf=function(t,e){return this.originatedOnServer?r.resolve(this):M(t).then((n=this,function(t){return n.requireServerOriginOr(!t,e)}));var n},RequestResponseBase.prototype.with=function(t){return r.resolve(t).then((e=this,function(t){return e._with(t)}));var e},RequestResponseBase.prototype._with=function(t){return new this.class(x(this.propsForClone,t))},RequestResponseBase.prototype.withData=function(t){return r.resolve(t).then((e=this,function(t){return e._with({data:t})}));var e},RequestResponseBase.prototype.withMergedData=function(t){return r.resolve(t).then((e=this,function(t){return e._with({data:x(e.data,t)})}));var e},RequestResponseBase.prototype.withKey=function(t){return r.resolve(t).then((e=this,function(t){return e._with({key:t})}));var e},RequestResponseBase.prototype.withProps=function(t){return r.resolve(t).then((e=this,function(t){return e._with({props:t,key:t.key,data:t.data})}));var e},RequestResponseBase.prototype.withMergedProps=function(t){return r.resolve(t).then((e=this,function(t){return e._with({key:t.key,data:t.data,props:x(e.props,t)})}));var e},RequestResponseBase.prototype.withMergedPropsWithoutNulls=function(t){return r.resolve(t).then((e=this,function(t){return e._with({key:t.key,data:t.data,props:P(e.props,t)})}));var e},RequestResponseBase.prototype.withMergedErrorProps=function(t){return r.resolve(t).then((e=this,function(t){return e._with({errorProps:x(e.errorProps,t)})}));var e},RequestResponseBase.prototype.withSession=function(t){return r.resolve(t).then((e=this,function(t){return e._with({session:t})}));var e},RequestResponseBase.prototype.withMergedSession=function(t){return r.resolve(t).then((e=this,function(t){return e._with({session:x(e.session,t)})}));var e},RequestResponseBase.prototype.respondWithSession=function(t){return this.success({session:t})},RequestResponseBase.prototype.respondWithMergedSession=function(t){return this.success({session:x(this.session,t)})},p=function(t,e){return e.pipeline.isRecord(t)},RequestResponseBase.prototype.withTransformedRecords=function(t,e){var n,i,s,a;return null==e&&(e=p),S(i=t)&&(t=i.with,e=i.when||p),S(this.data)?r.resolve(e(this.data,this)?this.next(t(this.data,this)):this):m(this.data)?(n=null,s=o(this.data,(a=this,function(i){return r.then(function(){return e(i,a)?t(i,a):i}).catch(function(t){var e,n;if("missing"===t.status)return null;if(n=null!=t&&null!=(e=t.props)?e.response:void 0)return n;throw t}).then(function(t){return(null!=t?t.status:void 0)&&t instanceof RequestResponseBase?g(t.status)?("function"==typeof t._clearErrorStack&&t._clearErrorStack(),null):n||(n=t):t})})),r.all(s).then(function(t){return function(e){return n||t.withData(u(e))}}(this))):r.resolve(this)},RequestResponseBase.prototype.next=function(t){return r.resolve(t).then((e=this,function(t){if(t instanceof RequestResponseBase)return t;if(null==t)return e.missing();if(v(t))return e.success({data:t});throw w.error({invalidXYZ:t}),new Error("invalid response data passed to RequestResponseBaseNext")}),function(t){return function(e){var n,i;return(null!=(n=e.props)&&null!=(i=n.response)?i.isResponse:void 0)?e.props.response:t.failure({error:e})}}(this));var e},RequestResponseBase.prototype.success=function(t){return this.toResponse(F,t)},RequestResponseBase.prototype.missing=function(t){return this.toResponse(C,t)},RequestResponseBase.prototype.clientFailure=function(t){return this.toResponse(a,t)},RequestResponseBase.prototype.clientFailureNotAuthorized=function(t){return this.toResponse(l,t)},RequestResponseBase.prototype.failure=function(t){return this.toResponse(d,t)},RequestResponseBase.prototype.rejectWithMissing=function(t){return this.toResponse(C,t,!0)},RequestResponseBase.prototype.rejectWithClientFailure=function(t){return this.toResponse(a,t,!0)},RequestResponseBase.prototype.rejectWithClientFailureNotAuthorized=function(t){return this.toResponse(l,t,!0)},RequestResponseBase.prototype.rejectWithFailure=function(t){return this.toResponse(d,t,!0)},RequestResponseBase.prototype.toResponse=function(t,n,i){if(null==i&&(i=!1),!b(t))throw new Error("missing status");return r.resolve(n).then((o=this,function(n){switch(null==n&&(n={}),!1){case!(n instanceof RequestResponseBase):return w.warn("toResponse is instanceof RequestResponseBase - is this EVER used???"),n;case!S(n):return new e.Response(x(o.propsForResponse,n,{status:t,request:o.request}));case!b(n):return o.toResponse(t,{data:{message:n}});default:return o.toResponse(d,o._toErrorResponseProps(n))}})).then(function(t){return i?t.toPromise():t});var o},RequestResponseBase.prototype._toErrorResponseProps=function(t){return w(this,{responseProps:responseProps},{data:{message:responseProps instanceof Error?"Internal Error: ArtEry.RequestResponseBase#toResponse received Error instance: "+f(responseProps):"Internal Error: ArtEry.RequestResponseBase#toResponse received unsupported type"}})},RequestResponseBase}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;r=n(42).defineModule,i=n(96).BaseClass,e=n(136),n(159).config,r(t,function(t){function ArtEryBaseObject(){return ArtEryBaseObject.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ArtEryBaseObject,i),ArtEryBaseObject.abstractClass(),ArtEryBaseObject.getter({pipelines:function(){return e.pipelines}}),ArtEryBaseObject}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T={}.hasOwnProperty;(x=n(140)).objectHasKeys,x.clone,x.currentSecond,x.objectWithout,x.arrayWithoutLast,x.pureMerge,i=x.Promise,l=x.compactFlatten,S=x.object,w=x.peek,d=x.isPlainArray,b=x.objectKeyCount,x.arrayWith,x.inspect,o=x.RequestError,f=x.isPlainObject,m=x.log,x.CommunicationStatus,g=x.merge,x.isJsonType,h=x.formattedInspect,E=x.w,v=x.neq,p=x.getEnv,_=x.success,y=x.missing,c=x.failure,C=x.serverFailure,a=x.clientFailure,s=x.Validator,r=n(234),u=n(159).config,p().dev,n(136),P=new s({request:E("required",{instanceof:r}),status:E("required communicationStatus"),session:"object",props:"object"}),t.exports=function(t){function Response(t){var e;if(Response.__super__.constructor.apply(this,arguments),P.validate(t,{context:"Art.Ery.Response options",logErrors:!0}),this.request=t.request,this.status=t.status,this.props=null!=(e=t.props)?e:{},this.session=t.session,this.remoteRequest=t.remoteRequest,this.remoteResponse=t.remoteResponse,t.requestOptions)throw new Error("options.requestOptions is DEPRICATED - use options.props");null!=t.data&&(this._props.data=t.data),null==this._session&&(this._session=v(this.request.session,this.request.originalRequest.session)?this.request.session:void 0),this._endTime=null,this.status!==_&&this._captureErrorStack(),"create"!==this.type&&"get"!==this.type||this.setGetCache()}return function(t,e){for(var n in e)T.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Response,n(235)),Response.prototype.isResponse=!0,Response.property("request props session remoteResponse remoteRequest"),Response.setter("status"),Response.getter({verbose:function(){return this.request.verbose},status:function(){if(this.failed)switch(this.location){case"server":return C;case"client":return a}return this._status},failed:function(){return this._status===c||this._status===C},data:function(){return this._props.data},session:function(){var t;return null!=(t=this._session)?t:this.request.session},responseData:function(){return this._props.data},responseProps:function(){return this._props},responseSession:function(){return this._session},beforeFilterLog:function(){return this.request.filterLog||[]},handledBy:function(){return!this.failed&&w(this.request.filterLog)},rawRequestLog:function(){return l([this.beforeFilterLog,this.afterFilterLog])},requestLog:function(){var t,e,n,i,r,o,s,a;return this,s=this.startTime,t=this.endTime,e=i=s,n=null,o=function(){var t,o,s,l,u;for(u=[],t=0,o=(s=this.rawRequestLog).length;t<o;t++)l=s[t],r=l.name,a=l.time,null==e&&(e=i=a),null!=n&&(n.deltaMs=1e3*(a-i)|0),n={name:r,timeMs:0,wallMs:1e3*(a-e)|0},i=a,u.push(n);return u}.call(this),m({startTime:s,lastTime:i,_endTime:this._endTime}),null!=n&&(n.deltaMs=1e3*(t-i)|0),o},afterFilterLog:function(){return this._filterLog||[]},isSuccessful:function(){return this._status===_},isMissing:function(){return this._status===y},notSuccessful:function(){return this._status!==_},description:function(){return this.requestString+": "+this.status},propsForClone:function(){return{request:this.request,status:this.status,props:this.props,session:this._session,filterLog:this._filterLog,remoteRequest:this.remoteRequest,remoteResponse:this.remoteResponse,errorProps:this.errorProps}},propsForResponse:function(){return this.propsForClone},summary:function(){return{response:g({status:this.status,props:this.props,errorProps:this.errorProps})}},plainObjectsResponse:function(t){return S(t||{status:this.status,props:this.props,beforeFilterLog:this.beforeFilterLog,afterFilterLog:this.afterFilterLog,session:this._session},{when:function(t){switch(!1){case!f(t):return b(t)>0;case!d(t):return t.length>0;default:return void 0!==t}}})},responseForRemoteRequest:function(){return this.getPlainObjectsResponse(u.returnProcessingInfoToClient?void 0:{status:this.status,props:this.props,session:this._session})}}),Response.prototype.withMergedSession=function(t){return i.resolve(t).then((e=this,function(t){return new e.class(g(e.propsForClone,{session:g(e.session,t)}))}));var e},Response.prototype.toPromise=function(t){var e,n,r,o,s,a;return t&&(o=t.returnNullIfMissing,s=t.returnResponse,a=t.returnResponseObject),this,e=this.data,r=this.isSuccessful,n=this.isMissing,s||(s=a),n&&o&&(e=null,r=!0),r?i.resolve(s?this:e):i.reject(this._getRejectionError())},Response.prototype._getRejectionError=function(){var t,e,n,i,r,s,a,l,u,c,p,d,f;return this._preparedRejectionError||(this._preparedRejectionError=(n=null!=(r=null!=(s=null!=(a=this.responseData)?a.message:void 0)?s:null!=(l=this.responseProps)?l.message:void 0)?r:null!=(u=this.errorProps)&&null!=(c=u.exception)?c.message:void 0,i=(t=null!=(p=this.errorProps)?p.failedIn:void 0)?t.response.requestString+"\n\nfailedIn:\n  "+t.context+": "+t.handler.name+"\n  request: "+t.response.pipelineName+"."+t.response.type+((e=t.response.requestProps.key)?" "+h(e):"")+"\n  location: "+t.response.location:this.requestString,new o({message:n?n+"\n"+i:i,type:this.type,status:this.status,requestData:this.requestData,responseData:this.responseData,sourceLib:"ArtEry",response:this,stack:null!=(d=this.errorProps)&&null!=(f=d.exception)?f.stack:void 0})))},Response.prototype._captureErrorStack=function(){return this._getRejectionError()},Response}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h={}.hasOwnProperty;c=n(140),s=c.isFailure,c.missing,e=c.ErrorWithInfo,o=c.defineModule,i=c.Promise,a=c.isJsonType,l=c.log,u=c.neq,r=n(235),o(t,function(t){function RequestHandler(){return RequestHandler.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(RequestHandler,n(236)),RequestHandler.abstractClass(),RequestHandler.prototype.applyHandler=function(t,e,n){var r,o;return e?(r=this._applyHandler(t,e).then((o=this,function(t){var e;return(null!=t?t.isFailure:void 0)&&!(null!=(e=t.errorProps)?e.failedIn:void 0)?t.withMergedErrorProps({failedIn:{context:n,handler:o,response:t}}):t})),t.verbose&&(r=r.tap(function(e){var i,r;return e!==t&&u(t.summary,e.summary)?(e.failed&&!t.failed?l.error:l)(((i={})["ArtEryApplyHandlerVerbose "+t.pipelineName+"-"+t.type+" "+n]={before:t.summary,after:e.summary},i)):l(((r={})["ArtEryApplyHandlerVerbose "+t.pipelineName+"-"+t.type+" "+n]="no-change",r))})),r):i.resolve(t)},RequestHandler.prototype._applyHandler=function(t,n){return i.then((o=this,function(){return t.addFilterLog(o),n.call(o,t)})).then(function(n){if(null==n)return t.missing();if(n instanceof r)return n;if(a(n))return t.success({data:n});throw new e("invalid response data passed to RequestResponseBaseNext",{data:n})},function(e){return function(i){var r,o,a,l;return(null!=(r=i.props)&&null!=(o=r.response)?o.isResponse:void 0)?i.props.response:s(l=null!=(a=i.info)?a.status:void 0)?t.toResponse(l,{error:i.info}):t.failure({errorProps:{exception:i,source:{this:e,function:n}}})}}(this));var o},RequestHandler}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Array","vivifyObjectPathAndSet","Neptune","Function"],[e,n(140)],(t,e,r,o)=>{return i.defClass(class DataUpdatesFilter extends(n(233)){},function(n,s,a){let l,u,c;l=/^(create|update)/,u=/^delete/,this.location("both"),this.group("outer"),c=function(n,r){let o,s,a,c,h,p;if(o=n.key,s=n.type,a=n.responseData,c=n.pipelineName,null!=r||(r=n.context),h=(()=>{switch(!1){case!l.test(s):return"dataUpdates";case!u.test(s):return"dataDeletes"}})())switch(!1){case!i.is(a,t):i.each2(a,t=>(o=n.pipeline.toKeyString(t),e(r,h,c,o,t)));break;case!o:case!n.pipeline.isRecord(a):null!=a||(a=i.isF((p=n.pipeline).toKeyObject)&&p.toKeyObject(o||a)||{}),null!=o||(o=n.pipeline.toKeyString(a)),e(r,h,c,o,a)}return r},this.after({all:function(t){let e,n;return t.isRootRequest?("client"!==t.location?t.withMergedPropsWithoutNulls((({dataUpdates:e,dataDeletes:n}=t.context),{dataUpdates:e,dataDeletes:n})):t).tap(t=>"server"!==t.location&&this.models?this.applyFluxUpdates(t):void 0):(c(t),t)}}),this.prototype.applyFluxUpdates=function(t){let e,n,i;return e=(i=t.responseProps).dataUpdates,n=i.dataDeletes,this.applyFluxDataUpdates(e),this.applyFluxDataDeletes(n),l.test(t.type)&&this.applyFluxDataUpdates(c(t,{}).dataUpdates),u.test(t.type)?this.applyFluxDataDeletes(c(t,{}).dataDeletes):void 0},this.getter({models:function(){let t;return i.exists(t=r.Art.Flux)&&t.models}}),this.prototype.applyFluxDataUpdates=function(t){return i.each2(t,(t,e)=>i.each2(t,(t,n)=>this.models[e].dataUpdated(n,t)),(t,e)=>{let n;return i.is(i.exists(n=this.models[e])&&n.dataUpdated,o)})},this.prototype.applyFluxDataDeletes=function(t){return i.each2(t,(t,e)=>i.each2(t,(t,n)=>this.models[e].dataDeleted(n,t)),(t,e)=>{let n;return i.is(i.exists(n=this.models[e])&&n.dataDeleted,o)})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g={}.hasOwnProperty;(p=n(42)).objectWithout,p.timeout,i=p.array,p.timeout,p.isPlainObject,s=p.formattedInspect,o=p.each,m=p.wordsArray,l=p.log,r=p.defineModule,u=p.merge,a=p.isString,f=p.shallowClone,p.isPlainArray,e=p.Promise,n(233),h=n(147).normalizeFieldProps,d=n(141),c=d.missing,d.networkFailure,r(t,function(t){function LinkFieldsFilter(t){var e,n,i,r,o;for(e in i={},this._linkFields=LinkFieldsFilter.normalizeLinkFields(t.fields),o=this._linkFields)n=o[e],delete(r=u(n,{fieldType:"trimmedString"})).idFieldName,i[n.idFieldName]=h(r);LinkFieldsFilter.__super__.constructor.call(this,u(t,{fields:i}))}return function(t,e){for(var n in e)g.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(LinkFieldsFilter,n(241)),LinkFieldsFilter.location("server"),LinkFieldsFilter.getter("linkFields"),LinkFieldsFilter.prototype.preprocessRequest=function(t){var n,r,o,a;return t.type,t.pipeline,n=null!=(a=t.data)?a:{},t.session,r=null,o=u(n),e.all(i(this._linkFields,{when:function(t,e){var i;return i=t.idFieldName,!n[i]&&n[e]},with:function(n,i,a,l){var u,c,h;return c=n.idFieldName,u=n.autoCreate,h=n.pipelineName,e.then(function(){if(l.id)return l;if(u)return t.subrequest(h,"create",{props:{include:!1,data:l}});throw new Error("New record-data provided for "+i+", but autoCreate is not enabled for this field. "+i+": "+s(l))}).then(function(t){return(r||(r={}))[i]=t,o[c]=t.id,delete o[i]})}})).then(function(){return t.with({data:o,props:u(t.props,r&&{postIncludeLinkedFieldData:r})})})},m("link required include autoCreate"),LinkFieldsFilter.normalizeLinkFields=function(t){var e;return o(t,e={},function(t,n){var i,r,o,s,l,u;if(o=(l=h(t)).link,r=l.include,u=l.required,i=l.autoCreate,o&&(e[n]=s={pipelineName:a(o)?o:n,idFieldName:n+"Id"},i&&(s.autoCreate=!0),r&&(s.include=!0),u))return s.required=!0})},LinkFieldsFilter.prototype.includeLinkedFields=function(t,n){var i,r,o,s,a,h,p,d,m,g;return m=t.requestData,d=t.requestProps,h=d.postIncludeLinkedFieldData,g=!1!==t.rootRequest.props.include&&!1!==t.requestProps.include,s=f(n),p=function(){var n,p,d;for(i in d=[],n=this._linkFields)p=n[i],o=p.idFieldName,a=p.pipelineName,p.include&&(r=s[o])&&d.push(function(n,i,r,o,a){return e.then(function(){var e;return(e=(null!=m?m[i]:void 0)||(null!=h?h[i]:void 0))?u({id:n},e):g?t.cachedGet(o,n):void 0}).then(function(t){if(null!=t)return s[i]=t}).catch(function(t){return t.status!==c&&l.error("LinkFieldsFilter: error including "+i+". "+r+": "+n+". pipelineName: "+o+". Error: "+t,t.error),null})}(r,i,o,a));return d}.call(this),e.all(p).then(function(){return s})},LinkFieldsFilter.before({create:function(t){return this.preprocessRequest(t).then((e=this,function(t){return e._validate("validateCreate",t)}));var e},update:function(t){return this.preprocessRequest(t).then((e=this,function(t){return e._validate("validateUpdate",t)}));var e}}),LinkFieldsFilter.after({all:function(t){return"delete"===t.type?t:t.withTransformedRecords((e=this,function(n){return e.includeLinkedFields(t,n)}));var e}}),LinkFieldsFilter}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;o=(l=n(160)).defineModule,a=l.pluralize,l.log,r=l.Validator,s=l.merge,i=l.Promise,e=n(233),o(t,function(t){function ValidationFilter(t){ValidationFilter.__super__.constructor.apply(this,arguments),this._exclusive=null!=t?t.exclusive:void 0,this._validator=new r(this.fields)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ValidationFilter,e),ValidationFilter.location("both"),ValidationFilter.before({create:function(t){return this._validate("validateCreate",t)},update:function(t){return this._validate("validateUpdate",t)}}),ValidationFilter.prototype._validate=function(t,e){return i.then((n=this,function(){var r,o,s,l,u,c;return r=e.requestString,c=n._validator[t](e.data,{context:r}),"client"!==e.location&&(o=c),function(){if(this._exclusive){for(l in s=e.pipeline.fields,u=null,o)o[l],s[l]||(u||(u=[])).push(l);if(u)return i.reject({message:r+" failed. "+a(u.length,"unexpected field")+": "+u.join(", "),info:{unexpected:u}})}}.call(n)||e.withData(o)})).catch(function(t){var n,i;return i=t.message,n=t.info,e.clientFailure({data:s({message:i},n)})});var n},ValidationFilter}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["pipelines","merge","normalizeFieldProps","log","isString","vivifyObjectPathAndSet","Promise","formattedInspect","Array","Object","Error"],[e,n(140),n(156)],(t,e,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class LinkFieldsFilter2 extends(n(241)){constructor(t){let n;super(e(t,{fields:LinkFieldsFilter2._getIdFieldsFromLinkFields(n=LinkFieldsFilter2._normalizeLinkFields(t.fields))})),this._linkFields=n}},function(n,d,f){let m,g;this.location("server"),this.getter("linkFields"),this.before({create:function(t){return this._preprocessRequest(t).then(t=>this._validate("validateCreate",t))},update:function(t){return this._preprocessRequest(t).then(t=>this._validate("validateUpdate",t))}}),this.after({all:function(t){return t.isRootRequest&&!1!==t.requestProps.prefetch&&!1!==t.requestProps.include&&"delete"!==t.type?this._prefetchRecords(t,t.pipelineName,t.responseData).then(e=>t.withMergedProps({dataUpdates:e})):t}}),m={},this.getLinkedFieldFilterForPipeline=g=function(e){let n;return null!=(n=m[e])?n:m[e]=i.find(t[e].filters,null,t=>t.linkFields)||!1},this._getIdFieldsFromLinkFields=function(t){return i.object(t,(t,n)=>{let i;return delete(i=e(t,{fieldType:"trimmedString"})).idFieldName,r(i)},null,null,(t,e)=>t.idFieldName)},this._normalizeLinkFields=function(t){let e;return i.each2(t,(t,n)=>{let i,a,l,u,c,h,p;return i=(p=r(t)).include,a=p.prefetch,l=p.required,u=p.autoCreate,(c=p.link)?(i&&o.warn("DEPRICATED: 'include'. Use 'prefetch' instead."),e[n]=h={pipelineName:s(c)?c:n,idFieldName:n+"Id"},u&&(h.autoCreate=!0),(a||i)&&(h.prefetch=!0),l?h.required=!0:void 0):void 0},null,e={})},this.prototype._setPrefetch=function(t,e,n,i){return a(t.context,"dataUpdates",e,n,i)},this.prototype._preprocessRequest=function(n){let r,o;return r=e(n.data),o=null,l.all(i.array(this.linkFields,({idFieldName:e,autoCreate:s,pipelineName:a},c)=>{let h;return(h=r[c])?l.then(()=>h.id?h:(s||(o=n.rejectWithClientFailure(`New record-data provided for ${i.toString(c)}, but autoCreate is not enabled for this field. ${i.toString(c)}: ${i.toString(u(h))}`)),t[a]||(o=n.rejectWithClientFailure(`Linked pipeline not found: ${i.toString(u({pipelineName:a}))}`)),t[a].create(n,{props:{include:!1,data:h}}).tap(t=>this._setPrefetch(n,a,t.id,t)))).tap(({id:t})=>(r[e]=t,delete r[c])):void 0})).then(()=>null!=o?o:n.withData(r))},this.prototype._prefetchRecord=function(t,e,n){let r,o;return l.resolve(null!=n?i.exists(r=t.context.dataUpdates)&&i.exists(o=r[e])&&o[n]||t.cachedGetWithoutInclude(e,n).then(i=>this._setPrefetch(t,e,n,i)):void 0)},this.prototype._prefetchRecords=function(t,e,n){let r;return(()=>{switch(!1){case!i.is(n,c):return l.all(i.array(n,n=>this._prefetchRecords(t,e,n)));case!i.is(n,h):return(r=g(e).linkFields)?l.all(i.array(r,({include:e,prefetch:i,idFieldName:r,pipelineName:o},s)=>this._prefetchRecord(t,o,n[r]),({include:t,prefetch:e,idFieldName:n,pipelineName:i},r)=>t||e)):l.resolve();default:return o.error({request:t,pipelineName:e,data:n}),(()=>{throw new p("expecting object or array")})()}})().then(()=>t.context.dataUpdates)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getLinkedFieldFilterForPipeline","Array","Object","mergeWithoutNulls","vivifyObjectPathAndSet"],[e,n(140),n(242)],(t,e,r,o,s)=>{return i.defClass(class LinkFieldsFilter2LegacyApiDecode extends(n(233)){},function(n,a,l){let u,c;this.location("client"),this.after({all:function(t){let e;return t.withMergedProps({data:u(t.pipelineName,e={},t.data),dataUpdates:e})}}),u=function(n,o,s){let a;return(a=t(n).linkFields)?(()=>{switch(!1){case!i.is(s,e):return i.array(s,t=>c(a,o,t));case!i.is(s,r):return c(a,o,s);default:return s}})():s},c=function(t,e,n){return o(n,i.object(t,({idFieldName:t,pipelineName:i},r)=>{let o;return o=n[r],s(e,i,o.id,o),u(i,e,o),null},({idFieldName:t,pipelineName:e},i)=>n[i]))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getLinkedFieldFilterForPipeline","Array","Object","merge","hasProperties","objectKeyCount"],[e,n(140),n(242)],(t,e,r,o,s,a)=>{return i.defClass(class LinkFieldsFilter2LegacyApiEncode extends(n(233)){},function(n,l,u){let c,h,p;this.after({all:function(t){let e,n,i;return(n=(e=t.responseProps).dataUpdates)&&!t.requestProps.acceptLinkFieldsFilter2Encoding?(i={},t.withMergedPropsWithoutNulls({data:c(t.pipelineName,n,t.data,i),dataUpdates:t.context.dataUpdates=p(n,i)})):t}}),c=function(n,o,s,a){let l;return(l=t(n).linkFields)?(()=>{switch(!1){case!i.is(s,e):return i.array(s,t=>h(l,o,t,a));case!i.is(s,r):return h(l,o,s,a);default:return s}})():s},h=function(t,e,n,r){return i.object(t,({idFieldName:t,pipelineName:o})=>{let s,a,l,u;return(s=i.exists(l=e[o])&&l[a=n[t]])&&((null!=(u=r[o])?u:r[o]={})[a]=!0),c(o,e,s,r)},null,o(n))},p=function(t,e){let n;return s(e)?(n={},i.each2(t,(t,r)=>{let o;return(o=e[r])?a(t)!==a(o)?n[r]=i.object(t,null,(t,e)=>!o[e]):void 0:n[r]=t}),s(n)&&n||null):t}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){let e=n(3);e.defMod(t,()=>e.defClass(class LinkFieldsFilter2Transition2BFilter extends(n(233)){},function(t,e,n){this.location("client"),this.before({all:function(t){return t.withMergedProps({acceptLinkFieldsFilter2Encoding:!0})}})}))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["prefetchedRecordsCache"],[e,n(140),n(247)],t=>{return i.defClass(class PrefetchedRecordsFilter extends(n(233)){constructor(t){let e;super(...arguments),this.expirationSeconds=null!=(e=i.exists(t)&&t.expirationSeconds)?e:1}},function(e,n,i){this.location("client"),this.before({get:function(e){return t.get(e.pipelineName,e.key)||e}}),this.after({all:function(e){let n;return(n=e.props.dataUpdates)&&t.addPrefetchedRecords(n,this.expirationSeconds),e}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","Object","Error","timeout"],[e,n(140)],(t,e,n,r)=>{return i.defClass(class PrefetchedRecordsCache extends t{constructor(){super(...arguments),this._repository=[]}},function(t,o,s){this.singletonClass(),this.prototype.get=function(t,e){return i.find(this._repository,n=>{let r;return i.exists(r=n[t])&&r[e]})},this.prototype.addPrefetchedRecords=function(t,o=5){if(!i.is(t,e))throw new n("expecting Object");return this._repository.push(t),r(1e3*o,()=>this._repository=i.array(this._repository,null,e=>e!==t))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;i=(o=n(42)).defineModule,o.log,o.Validator,r=o.merge,s=o.toSeconds,e=n(233),i(t,function(t){var n,i;function TimestampFilter(){return TimestampFilter.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TimestampFilter,e),TimestampFilter.group("outer"),n=function(t,e,n,i){var r;if(r=n[e])return t.require(r<=i+1,e+" cannot be set more than 1 second in the future (now: "+i+")")},i=function(t,e,i){return Promise.all([n(t,"createdAt",e,i),n(t,"updatedAt",e,i)])},TimestampFilter.before({create:function(t){var e,n;return e=r({createdAt:n=s()+.5|0,updatedAt:n},t.originatedOnServer?t.data:void 0),i(t,e,n).then(function(){return t.withMergedData(e)})},update:function(t){var e,n;return e=r({updatedAt:n=s()+.5|0},t.originatedOnServer?t.data:void 0),i(t,e,n).then(function(){return t.withMergedData(e)})}}),TimestampFilter.fields({createdAt:"secondsTimestamp",updatedAt:"secondsTimestamp"}),TimestampFilter}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["randomString","Math","FieldTypes","Uuid","Crypto","randomBase62Character","Error","ceil"],[e,n(140),{Uuid:n(250),Crypto:n(64)}],(t,e,r,o,s,a,l,u)=>{let c,h;return c=t(),h=e.log(62)/e.log(2),i.defClass(class UniqueIdFilter extends(n(233)){constructor(t){if(super(...arguments),this.bits=i.exists(t)&&t.bits||70,!(this.bits<=256))throw new l(`too many bits: ${i.toString(this.bits)}. max = 256`);this.numChars=u(this.bits/h)}},function(t,e,n){let l;this.group("outer"),this.uuid=l=function(){return o.v4()},this.getter({compactUniqueId:function(){return s.createHmac("sha256",c).update(l()).digest("base64").slice(0,this.numChars).replace(/[\/+=]/g,a)}}),this.before({create:function(t){return t.require(!(null!=t.key),"request.key not expected for create").then(()=>{let e;return t.requireServerOriginIf(null!=(i.exists(e=t.data)&&e.id))}).then(()=>{let e;return i.exists(e=t.data)&&e.id?t:t.withMergedData({id:this.compactUniqueId})})}}),this.fields({id:r.id})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){var i=n(251),r=n(254),o=r;o.v1=i,o.v4=r,t.exports=o},function(t,e,n){var i,r,o=n(252),s=n(253),a=0,l=0;t.exports=function v1(t,e,n){var u=e&&n||0,c=e||[],h=(t=t||{}).node||i,p=void 0!==t.clockseq?t.clockseq:r;if(null==h||null==p){var d=o();null==h&&(h=i=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==p&&(p=r=16383&(d[6]<<8|d[7]))}var f=void 0!==t.msecs?t.msecs:(new Date).getTime(),m=void 0!==t.nsecs?t.nsecs:l+1,g=f-a+(m-l)/1e4;if(g<0&&void 0===t.clockseq&&(p=p+1&16383),(g<0||f>a)&&void 0===t.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,l=m,r=p;var y=(1e4*(268435455&(f+=122192928e5))+m)%4294967296;c[u++]=y>>>24&255,c[u++]=y>>>16&255,c[u++]=y>>>8&255,c[u++]=255&y;var v=f/4294967296*1e4&268435455;c[u++]=v>>>8&255,c[u++]=255&v,c[u++]=v>>>24&15|16,c[u++]=v>>>16&255,c[u++]=p>>>8|128,c[u++]=255&p;for(var S=0;S<6;++S)c[u+S]=h[S];return e||s(c)}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function whatwgRNG(){return n(i),i}}else{var r=new Array(16);t.exports=function mathRNG(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}},function(t,e){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function bytesToUuid(t,e){var i=e||0,r=n;return[r[t[i++]],r[t[i++]],r[t[i++]],r[t[i++]],"-",r[t[i++]],r[t[i++]],"-",r[t[i++]],r[t[i++]],"-",r[t[i++]],r[t[i++]],"-",r[t[i++]],r[t[i++]],r[t[i++]],r[t[i++]],r[t[i++]],r[t[i++]]].join("")}},function(t,e,n){var i=n(252),r=n(253);t.exports=function v4(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var a=0;a<16;++a)e[o+a]=s[a];return e||r(s)}},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["defineModule","merge","formattedInspect","Object","String","w","Array","Error","Promise"],[e,n(140)],(e,r,o,s,a,l,u,c,h)=>{let p;return e(t,p=i.defClass(class UserOwnedFilter extends(n(233)){constructor(t){let e,n,r;super(...arguments),this.userUpdatableFields=null==(n=i.exists(t)&&t.userUpdatableFields)||n,this.userCreatableFields=null==(r=i.exists(t)&&t.userCreatableFields)||r,this.publicFields=i.exists(t)&&t.publicFields,(e=i.exists(t)&&t.requireUserCanUpdate)&&(this.requireUserCanUpdate=e),(e=i.exists(t)&&t.requireUserCanDelete)&&(this.requireUserCanDelete=e)}},function(t,e,n){let p,d,f,m,g,y,v;this.group("outer"),this.getter("userUpdatableFields","userCreatableFields","publicFields"),p=["id","userId","createdAt","updatedAt"],this.setter({publicFields:function(t){return this._publicFields=f(g(t,r(y)))},userUpdatableFields:function(t){return this._userUpdatableFields=f(g(t))},userCreatableFields:function(t){return this._userCreatableFields=f(g(t,{userId:!0}))}}),this.prototype.requireUserCanUpdate=function(t,e,n){return this._requireIsOwner(t,e)},this.prototype.requireUserCanDelete=function(t,e){return this._requireIsOwner(t,e)},this.before({all:function(t){let e;return t.originatedOnServer?v(t):(()=>{switch(t.type){case"create":return t.requireServerOriginOr(null!=t.session.userId,"create without authenticated user").then(()=>this._requireAllDataFieldsAllowed(t,this.userCreatableFields)).then(()=>t.require(!(null!=t.key),"request.key not expected for create")).then(()=>v(t)).then(t=>this._requireIsOwner(t,t.data));case"update":return this._requireAllDataFieldsAllowed(t,this.userUpdatableFields,e=t.pipeline.getFieldsRequestWillModify(t)).then(()=>t.requireServerOriginOr(null!=t.session.userId)).then(()=>t.cachedGet(t.pipelineName,t.key)).then(n=>this._requireUserIdDidntChange(t,n).then(()=>this.requireUserCanUpdate(t,n,e)));case"delete":return t.requireServerOriginOr(null!=t.session.userId).then(()=>t.cachedGet(t.pipelineName,t.key)).then(e=>this.requireUserCanDelete(t,e));default:return t}})()}}),this.after({all:function(t){let e,n;return(()=>{switch(!1){case!(t.originatedOnServer||!0===this.publicFields):return t;case!(null!=t.data):return e=t.session.userId,n=this.publicFields,t.withTransformedRecords({when:n=>t.pipeline.isRecord(n)&&n.userId!==e,with:t=>null!=i.find(t,null,(t,e)=>null!=t&&n[e])?i.object(t,null,(t,e)=>n[e]):void 0});default:return t}})()}}),d=/Id$/,f=function(t){return!0===t||(i.each2(t,(e,n)=>{let i,r;return[i]=n.split(d),null!=(r=t[i])?r:t[i]=e},(t,e)=>d.test(e)),t)},m=function(t,e){let n;return({userId:n}=t.session),e||(e=t.data),o({key:t.key,you:n,recordOwner:i.exists(e)&&e.userId})},y=(g=function(t,e={}){return(()=>{switch(!1){case!(!0===t):return!0;case!(null==t):return e;case!i.is(t,s):return i.object(t,null,null,e);case!i.is(t,a):return i.object(l(t),()=>!0,null,e);case!i.is(t,u):return i.each2(t,t=>g(t,e),null,e);default:return(()=>{throw new c(`invalid field input: ${i.toString(o(t))}`)})()}})()})(p),v=function(t){let e;return/^create/i.test(t.type)?t.withMergedData({userId:i.exists(e=t.data)&&e.userId||t.session.userId}):t},this.prototype._requireAllDataFieldsAllowed=function(t,e,n=t.data){let r;return null!=(r=(()=>{switch(!1){case!(!0===e):return null;case!i.is(e,s):return i.find(n,(n,r)=>t.requireServerOrigin(`to ${i.toString(t.type)} field: ${i.toString(r)}. Allowed fields: ${i.toString(s.keys(e).join(", "))}`),(t,n)=>!e[n]);default:return t.requireServerOrigin(`to ${i.toString(t.type)} when no allowed fields have been configured: ${i.toString(o({allowedFields:e}))}`)}})())?r:h.resolve(t)},this.prototype._requireUserIdDidntChange=function(t,e){let n,r;return t.requireServerOriginIf((i.exists(r=t.data)?n=r.userId:void 0)&&n!==e.userId,`to change a record's owner ${i.toString(m(t))}`)},this.prototype._requireIsOwner=function(t,e,n){return t.requireServerOriginOr((i.exists(e)&&e.userId)===t.session.userId,`to ${i.toString(t.type)}. You do not own the record: ${i.toString(m(t,e))}`)}}))}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;o=(s=n(42)).defineModule,s.log,i=n(233),r=n(250),e=n(147).FieldTypes,o(t,function(t){function UuidFilter(){return UuidFilter.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(UuidFilter,i),UuidFilter.alwaysForceNewIds=!0,UuidFilter.before({create:function(t){return t.withMergedData({id:UuidFilter.alwaysForceNewIds?r.v4():t.data.id||r.v4()})}}),UuidFilter.fields({id:e.id}),UuidFilter}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Validator","log","Object","Boolean","Error","objectWithout","compactFlatten","hasProperties","LinkFieldsFilter2","LinkFieldsFilter2LegacyApiEncode","LinkFieldsFilter2Transition2BFilter","PrefetchedRecordsFilter","LinkFieldsFilter","formattedInspect","ValidationFilter","AfterEventsFilter","DataUpdatesFilter","present","UniqueIdFilter","TimestampFilter","UserOwnedFilter"],[e,n(140),n(230)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w)=>{let x;return x=t.normalizeFieldProps,i.defClass(class FilterTools extends n{},function(t,P,C){this.createDatabaseFilters=function(t={},P){let C,_,E,T,k,I,M,A,F;if(i.exists(t)&&t.fields?(_=(C=t.fields).id,E=t.userOwned,T=t.linkFilterVersion):(e.warn(`ArtEry.Filters.Tools.createDatabaseFilters DEPRICATED: (Pipeline: ${i.toString(i.exists(P)&&P.name)}) you should now specify fields as: createDatabaseFilters fields: {}`),i.exists(F=C=t)&&(_=F.id,E=F.userOwned)),E){if(!i.is(E,n)&&!i.is(E,r))throw new o("expecting object or boolean");C.user="required link",C=s(C,"userOwned")}return _&&(k=_,C=s(C,"id")),I={},M={},A=!1,M=i.object(C,(t,e)=>{let n;return(n=(t=x(t)).link)?(I[e]=t,"object"):(A=!0,t)}),a([l(I)?(()=>{switch(T){case"transition2A":return[new u({fields:I}),new c];case"transition2B":return[new u({fields:I}),new c,new h,new p];case 2:return[new u({fields:I}),new p];case null:case void 0:return new d({fields:I});default:return(()=>{throw new o(`invalid linkFilterVersion: ${i.toString(f(T))}`)})()}})():void 0,A?new m({fields:M,exclusive:!0}):void 0,new g,new y,v(i.exists(P)&&P._keyFieldsString)&&"id"!==P._keyFieldsString?void 0:new S(k),new b,E?new w(E):void 0])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty;i=n(116).EventedMixin,s=n(159).config,d=n(42),c=d.isPlainObject,o=d.Promise,d.BaseObject,d.merge,d.inspect,d.isString,d.isObject,d.log,p=d.plainObjectsDeepEq,u=d.isBrowser,l=d.interval,a=d.eq,d.formattedInspect,f=d.toMilliseconds,n(147).Validator,r=n(160).JsonStore,h=r.jsonStore,t.exports=function(t){function Session(t,e){this._data=null!=t?t:{},this._jsonStoreKey=e,u&&this._startPollingSession()}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Session,i(n(236))),Session.singletonClass(),Session.prototype._startPollingSession=function(){return l(5e3,(t=this,function(){return t.reloadSession()}));var t},Session.prototype.reloadSession=function(){return this._sessionLoadPromise=null,this.loadSession()},Session.prototype.loadSession=function(){return null!=this._sessionLoadPromise?this._sessionLoadPromise:this._sessionLoadPromise=o.then((t=this,function(){return h.getItem(t.jsonStoreKey)})).then(function(t){return function(e){if(!a(e,t.data))return t.data=e}}(this));var t},Session.getter("sessionLoadPromise data updatedAt",{jsonStoreKey:function(){var t;return null!=(t=this._jsonStoreKey)?t:"Art.Ery.Session"},loadedDataPromise:function(){if("server"===s.location)throw new Error("INTERNAL ERROR: Attempted to access the global session serverside. HINT: Use 'session: {}' for no-session requests.");return this.loadSession().then((t=this,function(){return t.data}));var t},sessionSignature:function(){var t;return null!=(t=this._data)?t.signature:void 0},inspectedObjects:function(){return this._data}}),Session.setter({data:function(t){if(this._updatedAt=f(),c(t)&&!p(t,this._data))return this.queueEvent("change",{data:t}),h.setItem(this.jsonStoreKey,this._data=t)}}),Session.prototype.reset=function(){return this.data={}},u&&Session.singleton.loadSession(),Session}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f={}.hasOwnProperty,m=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};r=(d=n(160)).defineModule,c=d.log,p=d.present,a=d.isPlainArray,u=d.isString,l=d.isPlainObject,s=d.formattedInspect,i=d.array,h=d.object,o=d.each,e=n(147).Validator,r(t,function(){return function(t){return function(n){var r;function KeyFieldsMixin(){return KeyFieldsMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)f.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(KeyFieldsMixin,t),KeyFieldsMixin.getKeyFields=function(){return this._keyFields},KeyFieldsMixin.getKeyFieldsString=function(){return this._keyFieldsString},KeyFieldsMixin.primaryKey=r=function(t){if(u(t))return this._keyFields=(this._keyFieldsString=t).split("/");if(a(t))return this._keyFieldsString=(this._keyFields=t).join("/");throw new Error("invalid value: "+s(t))},KeyFieldsMixin.keyFields=r,KeyFieldsMixin.getter({keyFieldsString:function(){return null!=this._keyFieldsString?this._keyFieldsString:this._keyFieldsString=this.class._keyFieldsString},keyFields:function(){return null!=this._keyFields?this._keyFields:this._keyFields=this.class._keyFields},keyValidator:function(){return null!=this._keyValidator?this._keyValidator:this._keyValidator=this.class._keyValidator}}),KeyFieldsMixin.prototype.isRecord=function(t){var e,n,i;if(l(t)){for(e=0,n=(i=this.keyFields).length;e<n;e++)if(null==t[i[e]])return!1;return!0}},KeyFieldsMixin.prototype.dataToKeyString=function(t){return this.validateKey(t),i(this.keyFields,function(e){return t[e]}).join("/")},KeyFieldsMixin.prototype.toKeyObject=function(t){var e,n,i,o;return this,n=this.keyValidator,r=this.keyFields,e=this.validateKey(l(t)?h(this.keyFields,function(e){return t[e]}):u(t)?r.length>1?(o=t.split("/"),e=h(r,function(t,e){return o[e]}),o.length!==r.length&&c.warn({KeyFieldsMixin_toKeyObject:{message:"wrong number of /-delimited fields in key-string",pipelineName:this.pipelineName,input:t,splitInput:o,keyFields:r,usingKeyObject:e}}),e):((i={})[""+r[0]]=t,i):{}),n&&(e=n.preprocess(e)),e},KeyFieldsMixin.prototype.dataWithoutKeyFields=function(t){return t&&h(t,{when:(e=this,function(t,n){return!(m.call(e.keyFields,n)>=0)})});var e},KeyFieldsMixin.prototype.validateKey=function(t){var e;return r=this.keyFields,o(r,(e=this,function(n){if(!p(t[n]))throw new Error(e.class.getName()+" missing key field(s): "+s({missing:n,keyFields:r,key:t}))})),t},KeyFieldsMixin._keyFieldsString="id",KeyFieldsMixin._keyFields=["id"],KeyFieldsMixin._initFields=function(){var t;return KeyFieldsMixin.__super__.constructor._initFields.apply(this,arguments),t=this.getFields(),this._keyValidator=new e(r=h(this.getKeyFields(),{when:function(e){return t[e]},with:function(e){return t[e]}}))},KeyFieldsMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D=function(t,e){return function(){return t.apply(e,arguments)}},N={}.hasOwnProperty,U=[].slice,W=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};z=n(42),m=z.each,A=z.object,c=z.compactFlatten,z.BaseObject,z.reverseForEach,s=z.Promise,E=z.log,C=z.isPlainObject,S=z.inspect,_=z.isString,w=z.isClass,x=z.isFunction,S=z.inspect,z.CommunicationStatus,k=z.merge,P=z.isPlainArray,d=z.decapitalize,f=z.defineModule,I=z.mergeInto,z.arrayToTruthMap,T=z.lowerCamelCase,z.peek,b=z.inspectedObjectLiteral,g=z.escapeRegExp,y=z.formattedInspect,R=z.pushIfNotPresent,L=z.w,p=z.currentSecond,z.toDate,z.plainObjectsDeepEq,v=z.getCodeWords,F=z.pluralize,M=n(147).normalizeFieldProps,(O=n(141)).success,O.missing,B=n(247).prefetchedRecordsCache,n(237),a=n(234),e=n(233),i=n(257),u=n(258),h=n(159).config,n(230),r=n(261),o=n(156),l=n(235),f(t,function(t){var f,z,O,j;function Pipeline(t){this._options=null!=t?t:{},this.getPrefixedTableName=D(this.getPrefixedTableName,this),Pipeline.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)N.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Pipeline,n(238)),Pipeline.register=function(){return this.singletonClass(),o.register(this)},Pipeline.abstractClass(),Pipeline.postCreateConcreteClass=function(t){var e;return e=t.hotReloaded,this._defineQueryHandlers(),this._defineClientHandlerMethods(),this._initFields(),e||this.register(),Pipeline.__super__.constructor.postCreateConcreteClass.apply(this,arguments)},Pipeline.instantiateFilter=f=function(t){if(w(t))return new t;if(x(t))return t(this);if(t instanceof e)return t;if(C(t))return new e(t);throw"invalid filter: "+S(t)+" "+(t instanceof e)},Pipeline.getAliases=function(){return this._aliases||{}},Pipeline.addDatabaseFilters=function(t){return this.filter(i.createDatabaseFilters(t,this))},Pipeline.prototype.getPrefetchedRecord=function(t){return B.get(this.pipelineName,t)},Pipeline.prototype.toKeyString=function(t){if(null==t)return t;if(_(t))return t;if(this.dataToKeyString&&C(t))return this.dataToKeyString(t);throw new Error("override toKeyString or dataToKeyString for non-string-keys like: "+y(t))},Pipeline.prototype.isRecord=function(t){return null!=t?t.id:void 0},Pipeline.prototype.getFieldsRequestWillModify=function(t){var e;return null!=(e=t.data)?e:{}},Pipeline.extendableProperty({queries:{},filters:[],handlers:{},clientApiMethodList:[],fields:{},fluxModelMixins:[],publicRequestTypes:{}}),Pipeline.publicRequestTypes=function(){var t,e,n,i,r,o,s,a,l;for(l=1<=arguments.length?U.call(arguments,0):[],r={},t=0,n=(o=c(l)).length;t<n;t++)for(a=o[t],e=0,i=(s=L(a)).length;e<i;e++)r[s[e]]=!0;return this.extendPublicRequestTypes(r)},Pipeline.publicHandlers=function(){var t,e,n,i,r;for(r=[],t=0,e=(i=1<=arguments.length?U.call(arguments,0):[]).length;t<e;t++)n=i[t],this.handlers(n),r.push(this.publicRequestTypes(Object.keys(n)));return r},Pipeline.fluxModelMixin=function(t){return this.extendFluxModelMixins(t)},Pipeline.filter=function(t){return this.extendFilters(j(t))},Pipeline.handler=Pipeline.extendHandlers,Pipeline.handlers=Pipeline.extendHandlers,Pipeline.remoteServer=function(t){this._remoteServer=t},Pipeline.apiRoot=function(t){this._apiRoot=t},Pipeline.tableNamePrefix=function(t){this._tableNamePrefix=t},Pipeline.query=function(t){return this.extendQueries(A(t,function(t,e){return new r(e,t)}))},Pipeline.aliases=function(){var t;return this._aliases=m(arguments,t={},function(e,n){return t[T(e)]=!0}),this},Pipeline.prototype.getPrefixedTableName=function(t){return""+this.tableNamePrefix+t},Pipeline.prototype.cachedGet=function(t,e){return t.cachedGet(this.pipelineName,null!=e?e:t.key)},Pipeline.classGetter({pipelineName:function(){return this._pipelineName||d(this.getName())},pluralPipelineName:function(){var t;return this._pluralPipelineName?this._pluralPipelineName:((t=v(this.getPipelineName())).push(F(t.pop())),this._pluralPipelineName=T(t))}}),Pipeline.prototype.getLogName=function(t){return t+"-handler"},Pipeline.getter("options",{pipelineName:function(){return this.class.getPipelineName()},tableNamePrefix:function(){return this.class._tableNamePrefix||h.tableNamePrefix},tableName:function(){return this.getPrefixedTableName(this.name)},normalizedFields:function(){var t,e,n,i;for(t in e={},n=this.fields)i=n[t],e[t]=M(i);return e},name:function(){return this._name||(this._name=this._options.name||d(this.class.getName()))},session:function(){return this._session||(this._session=this._options.session||u.singleton)},handlerRequestTypesMap:function(t){return null==t&&(t={}),I(t,this.handlers),t},filterRequestTypesMap:function(t){var e,n,i,r;for(null==t&&(t={}),n=0,i=(r=this.filters).length;n<i;n++)e=r[n],I(t,e.beforeFilters);return t},requestTypesMap:function(t){return null==t&&(t={}),this.getHandlerRequestTypesMap(this.getFilterRequestTypesMap(t))},requestTypes:function(){return Object.keys(this.requestTypesMap)},aliases:function(){return Object.keys(this.class.getAliases())},inspectedObjects:function(){return b(this.name)},isRemoteClient:function(){return!!this.remoteServer},apiRoot:function(){return this.class._apiRoot||h._apiRoot},remoteServer:function(){return this.class._remoteServer||h.remoteServer},location:function(){return this.remoteServer&&"server"!==h.location?"client":h.location},restPath:function(){return this._restPath||(this._restPath="/"+h.apiRoot+"/"+this.name)},restPathRegex:function(){return this._restPathRegex||(this._restPathRegex=RegExp("^"+g(this.restPath)+"(?:-([a-z0-9_]+))?(?:\\/([^?]+))?(?=\\?|$)","i"))},groupedFilters:function(){return this._groupedFilters||(this._groupedFilters=Pipeline.groupFilters(this.filters))},beforeFilters:function(){return this._beforeFilters||(this._beforeFilters=this.groupedFilters.slice().reverse())},afterFilters:function(){return this.groupedFilters},status:function(){return"OK"},filterChain:function(){return this._filterChain||(this._filterChain=c([this,this.groupedFilters]).reverse())}}),Pipeline.groupFilters=function(t){var e,n,i,r,o,s,a,l,u,c,h;for(u=[],n=0,o=t.length;n<o;n++)l=t[n].priority,R(u,l);for(h=[],i=0,s=(c=u.sort(function(t,e){return t-e})).length;i<s;i++)for(u=c[i],r=0,a=t.length;r<a;r++)u===(e=t[r]).priority&&h.push(e);return h},Pipeline.prototype.getBeforeFilters=function(t){var e,n,i,r,o;for(o=[],n=0,i=(r=this.beforeFilters).length;n<i;n++)(e=r[n]).getBeforeFilter(t)&&o.push(e);return o},Pipeline.prototype.getAfterFilters=function(t){var e,n,i,r,o;for(o=[],n=0,i=(r=this.afterFilters).length;n<i;n++)(e=r[n]).getAfterFilter(t)&&o.push(e);return o},Pipeline.prototype.createRequest=function(t,e){return C(e)||E.warn("DEPRICATED - options must be an object now"),_(e)&&(e={key:e}),s.then((n=this,function(){return e.session||n.session.loadedDataPromise})).tapCatch(function(n){return function(i){return E.error({Pipeline_createRequest:{message:"Error getting session",info:{pipelineName:n.pipelineName,type:t,options:e},error:i}})}}(this)).then(function(n){return function(i){return new a(k(e,{type:t,pipeline:n,session:i}))}}(this));var n},Pipeline.prototype.getRequestProcessingReport=function(t){return null==t&&(t=this.location),A(this.requestTypes,(e=this,function(n){var i;return c([function(){var e,r,o,s;for(s=[],e=0,r=(o=this.getBeforeFilters({requestType:n,location:t})).length;e<r;e++)i=o[e],s.push(b(i.getName()));return s}.call(e),b("client"===t?"[remote request]":"[local handler]"),function(){var e,r,o,s;for(s=[],e=0,r=(o=this.getAfterFilters({requestType:n,location:t})).length;e<r;e++)i=o[e],s.push(b(i.getName()));return s}.call(e)])}));var e},Pipeline.getter({pipelineReport:function(t){var e;return e={tableName:this.tableName,fields:A(this.fields,function(t){return m(Object.keys(t).sort(),e={},function(n){var i;if(i=t[n],!x(i))return e[n]=i})})},t?e[t+"Processing"]=this.getRequestProcessingReport("client"):(e.clientSideRequestProcessing=this.getRequestProcessingReport("client"),e.serverSideRequestProcessing=this.getRequestProcessingReport("server"),e.serverlessDevelopmentRequestProcessing=this.getRequestProcessingReport("both")),e},apiReport:function(t){var e,n,i;return null==t&&(t={}),n=t.server,e=t.publicOnly,A(this.requestTypes,{when:e&&(i=this,function(t){return i.getPublicRequestTypes()[t]}),with:function(t){return function(e){var i,r,o,s;return i=(o=a.getRestClientParamsForArtEryRequest({server:t.remoteServer||n,type:e,restPath:t.restPath})).method,s=o.url,(r={})[""+i.toLocaleUpperCase()]=s,r}}(this)})}}),Pipeline.prototype.handleRequest=function(t){var e,n;if(t.isResponse)throw new Error("HARD DEPRICATED");return"client"===this.location&&this.remoteServer?t.sendRemoteRequest(this.remoteServer):(e=this.handlers[t.type])?this.applyHandler(t,e,"handler").then((n=this,function(e){return e.isResponse?e:t.failure(n.pipelineName+"."+t.type+" request was not handled")})):t.failure(this.pipelineName+": No handler for request type: "+y(t.type))},j=function(t){var e,n,i,r;if(P(t)){for(r=[],n=0,i=t.length;n<i;n++)(e=t[n])&&r.push(f(e));return r}return f(t)},Pipeline._defineQueryHandlers=function(){var t,e,n,i,o;for(e in t=this.getHandlers(),o=[],i=this.getQueries())if(n=i[e],!t[e]){if(!(n instanceof r))throw new Error("pipelineQuery not a PipelineQuery");if(!x(n.query))throw new Error("pipelineQuery has no query");o.push(t=this.extendHandlers(e,n.query))}return o},Pipeline.prototype._normalizeRequest=function(t){return C(t)?new a(k(t,{pipeline:this})):t},Pipeline.prototype._processRequest=function(t){var e,n,i;return e=!!this.handlers[t.type],n=!!this.getPublicRequestTypes()[t.type],e||n?t.requireServerOriginOr(n,"to issue non-public requests").then(function(e){return function(){return e.filterChain[0].handleRequest(t,e.filterChain,0)}}(this)).then(function(t){return t.isResponse||E.error({"not response!":t}),t}):s.then((i=this,function(){return t.clientFailure({data:{message:"'"+t.type+"' is an invalid request type",validRequestTypes:Object.keys(i.handlers)}})}))},O={},Pipeline.prototype._processClientRequest=function(t,e,n,i){var r,o,s,a;return null==e&&(e=n,n=i),null!=e&&e instanceof l&&(o=e,e=n,n=i),r=_(e)?k({key:e},n):null!=e?e:O,o?o.subrequest(this,t,r!==O?r:{props:o.props}):(s=p(),this.createRequest(t,r).then((a=this,function(t){return a._processRequest(t)})).then(function(t){return function(e){return t._processResponseSession(e,s)}}(this)).then(function(t){return t.toPromise(r)}))},z=0,Pipeline.prototype._processResponseSession=function(t,e){var n;return(n=t.responseSession)&&(this.session.data,e>z?(z=e,this.session.data=n,"updated"):"out-of-order update blocked"),t},Pipeline._defineClientRequestMethod=function(t){var e;return W.call(this.getClientApiMethodList(),t)<0&&this.extendClientApiMethodList(t),(e=this.prototype)[t]||(e[t]=function(e,n,i){return this._processClientRequest(t,e,n,i)})},Pipeline._defineClientHandlerMethods=function(){var t,e,n;for(t in e=this.getHandlers())e[t],this._defineClientRequestMethod(t);for(t in n=this.getPublicRequestTypes())n[t],this._defineClientRequestMethod(t);return null},Pipeline._initFields=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.getFilters()).length;e<n;e++)t=i[e],r.push(this.extendFields(t.fields));return r},Pipeline}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;i=(l=n(160)).defineModule,s=l.isPlainObject,l.log,e=l.BaseObject,r=l.formattedInspect,a=l.isString,o=l.isFunction,i(t,function(t){function PipelineQuery(t,e){var n,i,s,a;for(n in this.queryName=t,this.options=e,o(this.options)&&(this.options={query:this.options}),i=this.options)a=i[n],this[n]=a;if(!(o(this.query)&&this.query.length>0))throw new Error("PipelineQuery: query handler-function must have at least one argument:\n\nhandler:        "+(o(this.query)&&this.query.getName())+"\nhandler.length: "+(null!=(s=this.query)?s.length:void 0)+"\n\n"+r({queryName:this.queryName,options:this.options})+'"')}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PipelineQuery,e),PipelineQuery.getter({name:function(){return this.queryName}}),PipelineQuery.prototype.toKeyString=function(t){if(null==t)return null;if(s(t)&&this.dataToKeyString)return this.dataToKeyString(t);if(a(t))return t;throw new Error("PipelineQuery: invalid key: "+r(t))},PipelineQuery}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d={}.hasOwnProperty;l=(p=n(42)).defineModule,u=p.log,p.merge,r=p.Promise,h=p.object,a=p.deepMerge,s=p.compactFlatten,p.formattedInspect,o=p.array,i=n(136),n(260),n(259),e=n(230).AfterEventsFilter,c=n(141).missing,l(t,function(){return function(t){return function(n){function UpdateAfterMixin(){return UpdateAfterMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)d.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(UpdateAfterMixin,t),UpdateAfterMixin.updateAfter=function(t){var n,i,r,o,s;for(i in o=[],t)r=t[i],o.push(function(){var t;for(n in t=[],r)s=r[n],e.registerPipelineListener(this,n,i),t.push(this._addUpdateAfterFunction(n,i,s));return t}.call(this));return o},UpdateAfterMixin.afterEvent=function(t){var n,i,r,o,s;for(r in s=[],t)o=t[r],s.push(function(){var t;for(i in t=[],o)n=o[i],e.registerPipelineListener(this,i,r),t.push(this._addAfterEventFunction(i,r,n));return t}.call(this));return s},UpdateAfterMixin.deleteAfter=function(t){var e;return e=this.getPipelineName(),this.afterEvent(h(t,function(t){return h(t,function(t,n){return function(n){return r.resolve(t(n)).then(function(t){if(t)return n.subrequest(e,"delete",t).catch(function(t){if(t.status===c)return n.success();throw t})})}})}))},UpdateAfterMixin.extendableProperty({updatePropsFunctions:{},afterEventFunctions:{}}),UpdateAfterMixin._addUpdateAfterFunction=function(t,e,n){var i,r;return((i=(r=this.extendUpdatePropsFunctions())[t]||(r[t]={}))[e]||(i[e]=[])).push(n)},UpdateAfterMixin._addAfterEventFunction=function(t,e,n){var i,r;return((i=(r=this.extendAfterEventFunctions())[t]||(r[t]={}))[e]||(i[e]=[])).push(n)},UpdateAfterMixin._mergeUpdateProps=function(t,e){var n,r;return n=i.pipelines[e],h(s(t),{key:function(t){var e;return e=t.key,n.toKeyString(e)},when:function(t){return t},with:(r=this,function(e,i,o){var s;if(!e.key)throw u.error({"key not found for one or more updateItem entries":{manyUpdateItemProps:t}}),new Error(r.getName()+".updateAfter: key required for each updateItem param set (see log for details)");return o[s=n.toKeyString(e.key)]?a(o[s],e):e})})},UpdateAfterMixin._applyAllUpdates=function(t){var e,n;return e=t.context.updateRequestsByToUpdatePipeline,t.context.updateRequestsByToUpdatePipeline=null,e?r.deepAll(e).then((n=this,function(e){return r.all(o(e,function(e,i){return r.all(o(n._mergeUpdateProps(e,i),function(e){var n;return n=(null!=e?e.createOrUpdate:void 0)?"createOrUpdate":"update",t.subrequest(i,n,{props:e})}))}))})).then(function(e){return function(){return e._applyAllUpdates(t)}}(this)):r.resolve()},UpdateAfterMixin.filter({name:"UpdateAfterMixinFilter",group:"outer",filterFailures:!0,before:{all:function(t){return t.context.updateAfterMixinDepth=(t.context.updateAfterMixinDepth||0)+1,t}},after:{all:function(t){return(1===t.context.updateAfterMixinDepth?UpdateAfterMixin._applyAllUpdates(t):r.resolve()).then(function(){return t.context.updateAfterMixinDepth--,t})}}}),UpdateAfterMixin.handleRequestAfterEvent=function(t){var e,n,i,s,a,l,u,c;return c=t.pipelineName,a=t.requestType,u=(l=this.singleton).pipelineName,((e=(n=t.context).updateRequestsByToUpdatePipeline||(n.updateRequestsByToUpdatePipeline={}))[u]||(e[u]=[])).push(o(null!=(i=this.getUpdatePropsFunctions()[c])?i[a]:void 0,function(e){return e.call(l,t)})),r.deepAll(o(null!=(s=this.getAfterEventFunctions()[c])?s[a]:void 0,function(e){return e.call(l,t)}))},UpdateAfterMixin}()}})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Filter","Config","log","isString","Promise","cryptoRandomString","merge"],[e,n(41),{Config:n(40)}],(t,e,n,r,o,s,a)=>{let l;return l=function(t,r,o){let s,a,l,u;return a=(s=e.config).pusherEventName,l=e.getPusherChannel(t,r),s.verbose&&n({sendChanged:{channel:l,pusherEventName:a,payload:o}}),i.exists(u=e.pusherServer)&&u.trigger(l,a,o||{})},i.defClass(class PusherFilter extends t{},function(t,e,n){let u;this.prototype.initArtEryPusherSession=function(t){return r(t.session.artEryPusherSession)?o.resolve(t):t.withMergedSession({artEryPusherSession:s(12)})},this.prototype.notifyAllQueriesWhichMayNeedUpdating=function(t,e,n){return i.each2(t.getChannelsAndKeysToUpdateOnRecordChange(n),(t,n)=>null!=t?l(n,t,e):void 0)},this.prototype.notifySingleRecordWhichNeedsUpdating=function(t,e,n){return l(t,n,e)},this.after({create:u=function(t){return this.initArtEryPusherSession(t).tap(t=>o.then(()=>{let e,n,i,r,o,s,l;return e=t.type,n=t.key,i=t.data,r=t.request,o=t.pipeline,s=t.session.artEryPusherSession,i=a(r.data,i,n&&o.toKeyObject(n)),l={type:e,sender:s,key:n||o.toKeyString(i)},i.updatedAt&&(l.updatedAt=i.updatedAt),this.notifyAllQueriesWhichMayNeedUpdating(o,l,i),"create"!==e?this.notifySingleRecordWhichNeedsUpdating(o,l,i):void 0}))},update:u,delete:u})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c=function(t,e){return function(){return t.apply(e,arguments)}},h={}.hasOwnProperty;s=(l=n(41)).defineModule,a=l.log,l.merge,o=(e=n(40)).config,u=n(134).session,i=n(17),r=i.activeSubscriptions={},i.logActiveSubscriptions=function(){return a({activeSubscriptions:Object.keys(r).sort()})},s(t,function(){return function(t){return function(n){function PusherFluxModelMixin(){this._processPusherChangedEvent=c(this._processPusherChangedEvent,this),PusherFluxModelMixin.__super__.constructor.apply(this,arguments),this._channels={},this._listeners={}}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PusherFluxModelMixin,t),PusherFluxModelMixin.prototype.fluxStoreEntryUpdated=function(t){var e;return e=t.key,t.subscribers.length>0&&this._subscribe(e),PusherFluxModelMixin.__super__.fluxStoreEntryUpdated.apply(this,arguments)},PusherFluxModelMixin.prototype.fluxStoreEntryRemoved=function(t){var e;return e=t.key,this._unsubscribe(e),PusherFluxModelMixin.__super__.fluxStoreEntryRemoved.apply(this,arguments)},PusherFluxModelMixin.prototype._getPusherChannel=function(t){return e.getPusherChannel(this.name,t)},PusherFluxModelMixin.prototype._subscribe=function(t){var n,i,s,a;if(s=o.pusherEventName,i=e.pusherClient)return(n=this._channels)[t]||(n[t]=i.subscribe(this._getPusherChannel(t))),this._listeners[t]?void 0:(r[this.name+" "+t]=!0,this._channels[t].bind(s,this._listeners[t]=(a=this,function(e){return a._processPusherChangedEvent(e,t)})))},PusherFluxModelMixin.prototype._unsubscribe=function(t){var n,i,s;if(i=o.pusherEventName,(n=e.pusherClient)&&this._channels[t])return this._listeners[t]&&(null!=(s=this._channels[t])&&s.unbind(i,this._listeners[t]),delete this._listeners[t]),delete r[this.name+" "+t],n.unsubscribe(this._getPusherChannel(t)),delete this._channels[t]},PusherFluxModelMixin.prototype._processPusherChangedEvent=function(t,e){var n,i,r,o,s,l;switch(i=t.key,o=t.sender,l=t.updatedAt,s=t.type,r=this.recordsModel||this,s){case"create":case"update":return o===u.data.artEryPusherSession?void a("saved 1 reload due to sender check! (model: "+this.name+", key: "+i+")"):(n=r.fluxStoreGet(i))&&n.updatedAt>=l?void a("saved 1 reload due to updatedAt check! (model: "+this.name+", key: "+i+")"):r.loadPromise(i);case"delete":return r.dataDeleted(i),this.dataDeleted(e,i);default:return a.error("PusherFluxModelMixin: _processPusherChangedEvent: unsupported type: "+s,{event:t})}},PusherFluxModelMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;e=(r=n(41)).defineModule,i=r.object,e(t,function(){return function(t){return function(e){function PusherPipelineMixin(){return PusherPipelineMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PusherPipelineMixin,t),"function"==typeof PusherPipelineMixin.abstractClass&&PusherPipelineMixin.abstractClass(),PusherPipelineMixin.fluxModelMixin(n(264)),PusherPipelineMixin.prototype.getChannelsAndKeysToUpdateOnRecordChange=function(t){return i(this.queries,function(e){return e.toKeyString(t)})},PusherPipelineMixin.prototype.getPusherChannel=function(t,e){},PusherPipelineMixin.filter(n(263)),PusherPipelineMixin}()}})}).call(this,n(2)(t))},function(t,e,n){t.exports=function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var i=n(1);t.exports=i.default},function(e,n,i){"use strict";var o=i(2),s=i(9),a=i(24),l=i(39),u=i(40),c=i(41),h=i(12),p=i(5),d=i(71),f=i(8),m=i(43),g=i(14),y=function(){function t(e,n){var i=this;if(function r(t){if(null===t||void 0===t)throw"You must pass your app key when you instantiate Pusher."}(e),!(n=n||{}).cluster&&!n.wsHost&&!n.httpHost){var h=g.default.buildLogSuffix("javascriptQuickStart");f.default.warn("You should always specify a cluster when connecting. "+h)}this.key=e,this.config=s.extend(d.getGlobalConfig(),n.cluster?d.getClusterConfig(n.cluster):{},n),this.channels=m.default.createChannels(),this.global_emitter=new a.default,this.sessionID=Math.floor(1e9*Math.random()),this.timeline=new l.default(this.key,this.sessionID,{cluster:this.config.cluster,features:t.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:u.default.INFO,version:p.default.VERSION}),this.config.disableStats||(this.timelineSender=m.default.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+o.default.TimelineTransport.name})),this.connection=m.default.createConnectionManager(this.key,s.extend({getStrategy:function(t){var e=s.extend({},i.config,t);return c.build(o.default.getDefaultStrategy(e),e)},timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{useTLS:this.shouldUseTLS()})),this.connection.bind("connected",function(){i.subscribeAll(),i.timelineSender&&i.timelineSender.send(i.connection.isUsingTLS())}),this.connection.bind("message",function(t){var e=t.event,n=0===e.indexOf("pusher_internal:");if(t.channel){var r=i.channel(t.channel);r&&r.handleEvent(t)}n||i.global_emitter.emit(t.event,t.data)}),this.connection.bind("connecting",function(){i.channels.disconnect()}),this.connection.bind("disconnected",function(){i.channels.disconnect()}),this.connection.bind("error",function(t){f.default.warn("Error",t)}),t.instances.push(this),this.timeline.info({instances:t.instances.length}),t.isReady&&this.connect()}return t.ready=function(){t.isReady=!0;for(var e=0,n=t.instances.length;e<n;e++)t.instances[e].connect()},t.log=function(e){t.logToConsole&&window.console&&window.console.log&&window.console.log(e)},t.getClientFeatures=function(){return s.keys(s.filterObject({ws:o.default.Transports.ws},function(t){return t.isSupported({})}))},t.prototype.channel=function(t){return this.channels.find(t)},t.prototype.allChannels=function(){return this.channels.all()},t.prototype.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var t=this.connection.isUsingTLS(),e=this.timelineSender;this.timelineSenderTimer=new h.PeriodicTimer(6e4,function(){e.send(t)})}},t.prototype.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},t.prototype.bind=function(t,e,n){return this.global_emitter.bind(t,e,n),this},t.prototype.unbind=function(t,e,n){return this.global_emitter.unbind(t,e,n),this},t.prototype.bind_global=function(t){return this.global_emitter.bind_global(t),this},t.prototype.unbind_global=function(t){return this.global_emitter.unbind_global(t),this},t.prototype.unbind_all=function(t){return this.global_emitter.unbind_all(),this},t.prototype.subscribeAll=function(){var t;for(t in this.channels.channels)this.channels.channels.hasOwnProperty(t)&&this.subscribe(t)},t.prototype.subscribe=function(t){var e=this.channels.add(t,this);return e.subscriptionPending&&e.subscriptionCancelled?e.reinstateSubscription():e.subscriptionPending||"connected"!==this.connection.state||e.subscribe(),e},t.prototype.unsubscribe=function(t){var e=this.channels.find(t);e&&e.subscriptionPending?e.cancelSubscription():(e=this.channels.remove(t))&&"connected"===this.connection.state&&e.unsubscribe()},t.prototype.send_event=function(t,e,n){return this.connection.send_event(t,e,n)},t.prototype.shouldUseTLS=function(){return"https:"===o.default.getProtocol()||!0===this.config.forceTLS||Boolean(this.config.encrypted)},t.instances=[],t.isReady=!1,t.logToConsole=!1,t.Runtime=o.default,t.ScriptReceivers=o.default.ScriptReceivers,t.DependenciesReceivers=o.default.DependenciesReceivers,t.auth_callbacks=o.default.auth_callbacks,t}();n.__esModule=!0,n.default=y,o.default.setup(y)},function(t,e,n){"use strict";var i=n(3),r=n(7),o=n(15),s=n(16),a=n(17),l=n(4),u=n(18),c=n(19),h=n(26),p=n(27),d=n(28),f=n(29),m={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:l.ScriptReceivers,DependenciesReceivers:i.DependenciesReceivers,getDefaultStrategy:p.default,Transports:c.default,transportConnectionInitializer:d.default,HTTPFactory:f.default,TimelineTransport:u.default,getXHRAPI:function(){return window.XMLHttpRequest},getWebSocketAPI:function(){return window.WebSocket||window.MozWebSocket},setup:function(t){var e=this;window.Pusher=t;var n=function(){e.onDocumentBody(t.ready)};window.JSON?n():i.Dependencies.load("json2",{},n)},getDocument:function(){return document},getProtocol:function(){return this.getDocument().location.protocol},getAuthorizers:function(){return{ajax:r.default,jsonp:o.default}},onDocumentBody:function(t){var e=this;document.body?t():setTimeout(function(){e.onDocumentBody(t)},0)},createJSONPRequest:function(t,e){return new a.default(t,e)},createScriptRequest:function(t){return new s.default(t)},getLocalStorage:function(){try{return window.localStorage}catch(t){return}},createXHR:function(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest:function(){var t=this.getXHRAPI();return new t},createMicrosoftXHR:function(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork:function(){return h.Network},createWebSocket:function(t){var e=this.getWebSocketAPI();return new e(t)},createSocketRequest:function(t,e){if(this.isXHRSupported())return this.HTTPFactory.createXHR(t,e);if(this.isXDRSupported(0===e.indexOf("https:")))return this.HTTPFactory.createXDR(t,e);throw"Cross-origin HTTP requests are not supported"},isXHRSupported:function(){var t=this.getXHRAPI();return Boolean(t)&&void 0!==(new t).withCredentials},isXDRSupported:function(t){var e=t?"https:":"http:",n=this.getProtocol();return Boolean(window.XDomainRequest)&&n===e},addUnloadListener:function(t){void 0!==window.addEventListener?window.addEventListener("unload",t,!1):void 0!==window.attachEvent&&window.attachEvent("onunload",t)},removeUnloadListener:function(t){void 0!==window.addEventListener?window.removeEventListener("unload",t,!1):void 0!==window.detachEvent&&window.detachEvent("onunload",t)}};e.__esModule=!0,e.default=m},function(t,e,n){"use strict";var i=n(4),r=n(5),o=n(6);e.DependenciesReceivers=new i.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers"),e.Dependencies=new o.default({cdn_http:r.default.cdn_http,cdn_https:r.default.cdn_https,version:r.default.VERSION,suffix:r.default.dependency_suffix,receivers:e.DependenciesReceivers})},function(t,e){"use strict";var n=function(){function t(t,e){this.lastId=0,this.prefix=t,this.name=e}return t.prototype.create=function(t){this.lastId++;var e=this.lastId,n=this.prefix+e,i=this.name+"["+e+"]",r=!1,o=function(){r||(t.apply(null,arguments),r=!0)};return this[e]=o,{number:e,id:n,name:i,callback:o}},t.prototype.remove=function(t){delete this[t.number]},t}();e.ScriptReceiverFactory=n,e.ScriptReceivers=new n("_pusher_script_","Pusher.ScriptReceivers")},function(t,e){"use strict";e.__esModule=!0,e.default={VERSION:"4.4.0",PROTOCOL:7,host:"ws.pusherapp.com",ws_port:80,wss_port:443,ws_path:"",sockjs_host:"sockjs.pusher.com",sockjs_http_port:80,sockjs_https_port:443,sockjs_path:"/pusher",stats_host:"stats.pusher.com",channel_auth_endpoint:"/pusher/auth",channel_auth_transport:"ajax",activity_timeout:12e4,pong_timeout:3e4,unavailable_timeout:1e4,cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:".min"}},function(e,n,i){"use strict";var r=i(4),o=i(2),s=function(){function t(t){this.options=t,this.receivers=t.receivers||r.ScriptReceivers,this.loading={}}return t.prototype.load=function(t,e,n){var i=this;if(i.loading[t]&&i.loading[t].length>0)i.loading[t].push(n);else{i.loading[t]=[n];var r=o.default.createScriptRequest(i.getPath(t,e)),s=i.receivers.create(function(e){if(i.receivers.remove(s),i.loading[t]){var n=i.loading[t];delete i.loading[t];for(var o=function(t){t||r.cleanup()},a=0;a<n.length;a++)n[a](e,o)}});r.send(s)}},t.prototype.getRoot=function(t){var e=o.default.getDocument().location.protocol;return(t&&t.useTLS||"https:"===e?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version},t.prototype.getPath=function(t,e){return this.getRoot(e)+"/"+t+this.options.suffix+".js"},t}();n.__esModule=!0,n.default=s},function(t,e,n){"use strict";var i=n(8),r=n(2),o=n(14);e.__esModule=!0,e.default=function(t,e,n){var s;for(var a in(s=r.default.createXHR()).open("POST",this.options.authEndpoint,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.authOptions.headers)s.setRequestHeader(a,this.authOptions.headers[a]);return s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var t,e=!1;try{t=JSON.parse(s.responseText),e=!0}catch(t){n(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+s.responseText)}e&&n(!1,t)}else{var r=o.default.buildLogSuffix("authenticationEndpoint");i.default.warn("Couldn't retrieve authentication info. "+s.status+"Clients must be authenticated to join private or presence channels. "+r),n(!0,s.status)}},s.send(this.composeQuery(e)),s}},function(t,e,n){"use strict";var i=n(9),r=n(1),o={debug:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];r.default.log&&r.default.log(i.stringify.apply(this,arguments))},warn:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=i.stringify.apply(this,arguments);r.default.log?r.default.log(n):window.console&&(window.console.warn?window.console.warn(n):window.console.log&&window.console.log(n))}};e.__esModule=!0,e.default=o},function(t,e,n){"use strict";function s(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(t[n],n,t)}function h(t,e){for(var n=[],i=0;i<t.length;i++)n.push(e(t[i],i,t,n));return n}function f(t,e){var n={};return s(t,function(t,i){n[i]=e(t)}),n}function p(t,e){var n={};return s(t,function(i,r){(e&&e(i,r,t,n)||Boolean(i))&&(n[r]=i)}),n}function d(t){var e=[];return s(t,function(t,n){e.push([n,t])}),e}function v(t){return f(t,function(t){return"object"==typeof t&&(t=w(t)),encodeURIComponent(r.default(t.toString()))})}function m(e){var n=[],i=[];return function t(e,r){var o,s,a;switch(typeof e){case"object":if(!e)return null;for(o=0;o<n.length;o+=1)if(n[o]===e)return{$ref:i[o]};if(n.push(e),i.push(r),"[object Array]"===Object.prototype.toString.apply(e))for(a=[],o=0;o<e.length;o+=1)a[o]=t(e[o],r+"["+o+"]");else for(s in a={},e)Object.prototype.hasOwnProperty.call(e,s)&&(a[s]=t(e[s],r+"["+JSON.stringify(s)+"]"));return a;case"number":case"string":case"boolean":return e}}(e,"$")}function w(t){try{return JSON.stringify(t)}catch(e){return JSON.stringify(m(t))}}var r=n(10),S=n(11);e.extend=function r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i++){var o=e[i];for(var s in o)o[s]&&o[s].constructor&&o[s].constructor===Object?t[s]=r(t[s]||{},o[s]):t[s]=o[s]}return t},e.stringify=function i(){for(var t=["Pusher"],e=0;e<arguments.length;e++)"string"==typeof arguments[e]?t.push(arguments[e]):t.push(w(arguments[e]));return t.join(" : ")},e.arrayIndexOf=function o(t,e){var n=Array.prototype.indexOf;if(null===t)return-1;if(n&&t.indexOf===n)return t.indexOf(e);for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},e.objectApply=s,e.keys=function a(t){var e=[];return s(t,function(t,n){e.push(n)}),e},e.values=function u(t){var e=[];return s(t,function(t){e.push(t)}),e},e.apply=function c(t,e,n){for(var i=0;i<t.length;i++)e.call(n||window,t[i],i,t)},e.map=h,e.mapObject=f,e.filter=function l(t,e){e=e||function(t){return!!t};for(var n=[],i=0;i<t.length;i++)e(t[i],i,t,n)&&n.push(t[i]);return n},e.filterObject=p,e.flatten=d,e.any=function y(t,e){for(var n=0;n<t.length;n++)if(e(t[n],n,t))return!0;return!1},e.all=function g(t,e){for(var n=0;n<t.length;n++)if(!e(t[n],n,t))return!1;return!0},e.encodeParamsObject=v,e.buildQueryString=function b(t){return h(d(v(p(t,function(t){return void 0!==t}))),S.default.method("join","=")).join("&")},e.decycleObject=m,e.safeJSONStringify=w},function(t,e,n){"use strict";e.__esModule=!0,e.default=function r(t){return p(c(t))};for(var i=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s={},a=0,l=o.length;a<l;a++)s[o.charAt(a)]=a;var u=function(t){var e=t.charCodeAt(0);return e<128?t:e<2048?i(192|e>>>6)+i(128|63&e):i(224|e>>>12&15)+i(128|e>>>6&63)+i(128|63&e)},c=function(t){return t.replace(/[^\x00-\x7F]/g,u)},h=function(t){var e=[0,2,1][t.length%3],n=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0),i=[o.charAt(n>>>18),o.charAt(n>>>12&63),e>=2?"=":o.charAt(n>>>6&63),e>=1?"=":o.charAt(63&n)];return i.join("")},p=window.btoa||function(t){return t.replace(/[\s\S]{1,3}/g,h)}},function(t,e,n){"use strict";var i=n(12),r={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(t){return new i.OneOffTimer(0,t)},method:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=Array.prototype.slice.call(arguments,1);return function(e){return e[t].apply(e,i.concat(arguments))}}};e.__esModule=!0,e.default=r},function(t,n,o){"use strict";function r(t){window.clearTimeout(t)}function i(t){window.clearInterval(t)}var s=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=o(13),l=function(t){function e(e,n){t.call(this,setTimeout,r,e,function(t){return n(),null})}return s(e,t),e}(a.default);n.OneOffTimer=l;var u=function(t){function e(e,n){t.call(this,setInterval,i,e,function(t){return n(),t})}return s(e,t),e}(a.default);n.PeriodicTimer=u},function(t,e){"use strict";var n=function(){function t(t,e,n,i){var r=this;this.clear=e,this.timer=t(function(){r.timer&&(r.timer=i(r.timer))},n)}return t.prototype.isRunning=function(){return null!==this.timer},t.prototype.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},t}();e.__esModule=!0,e.default=n},function(t,e){"use strict";var n={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/authenticating_users"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"}}};e.__esModule=!0,e.default={buildLogSuffix:function(t){var e,i=n.urls[t];return i?(i.fullUrl?e=i.fullUrl:i.path&&(e=n.baseUrl+i.path),e?"See: "+e:""):""}}},function(t,e,n){"use strict";var i=n(8);e.__esModule=!0,e.default=function(t,e,n){void 0!==this.authOptions.headers&&i.default.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var r=t.nextAuthCallbackID.toString();t.nextAuthCallbackID++;var o=t.getDocument(),s=o.createElement("script");t.auth_callbacks[r]=function(t){n(!1,t)};var a="Pusher.auth_callbacks['"+r+"']";s.src=this.options.authEndpoint+"?callback="+encodeURIComponent(a)+"&"+this.composeQuery(e);var l=o.getElementsByTagName("head")[0]||o.documentElement;l.insertBefore(s,l.firstChild)}},function(t,e){"use strict";var n=function(){function t(t){this.src=t}return t.prototype.send=function(t){var e=this,n="Error loading "+e.src;e.script=document.createElement("script"),e.script.id=t.id,e.script.src=e.src,e.script.type="text/javascript",e.script.charset="UTF-8",e.script.addEventListener?(e.script.onerror=function(){t.callback(n)},e.script.onload=function(){t.callback(null)}):e.script.onreadystatechange=function(){"loaded"!==e.script.readyState&&"complete"!==e.script.readyState||t.callback(null)},void 0===e.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(e.errorScript=document.createElement("script"),e.errorScript.id=t.id+"_error",e.errorScript.text=t.name+"('"+n+"');",e.script.async=e.errorScript.async=!1):e.script.async=!0;var i=document.getElementsByTagName("head")[0];i.insertBefore(e.script,i.firstChild),e.errorScript&&i.insertBefore(e.errorScript,e.script.nextSibling)},t.prototype.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},t}();e.__esModule=!0,e.default=n},function(e,n,i){"use strict";var r=i(9),o=i(2),s=function(){function t(t,e){this.url=t,this.data=e}return t.prototype.send=function(t){if(!this.request){var e=r.buildQueryString(this.data),n=this.url+"/"+t.number+"?"+e;this.request=o.default.createScriptRequest(n),this.request.send(t)}},t.prototype.cleanup=function(){this.request&&this.request.cleanup()},t}();n.__esModule=!0,n.default=s},function(t,e,n){"use strict";var i=n(2),r=n(4),o={name:"jsonp",getAgent:function(t,e){return function(n,o){var s="http"+(e?"s":"")+"://",a=s+(t.host||t.options.host)+t.options.path,l=i.default.createJSONPRequest(a,n),u=i.default.ScriptReceivers.create(function(e,n){r.ScriptReceivers.remove(u),l.cleanup(),n&&n.host&&(t.host=n.host),o&&o(e,n)});l.send(u)}}};e.__esModule=!0,e.default=o},function(t,e,n){"use strict";var i=n(20),r=n(22),o=n(21),s=n(2),a=n(3),l=n(9),u=new r.default({file:"sockjs",urls:o.sockjs,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(t,e){return new window.SockJS(t,null,{js_path:a.Dependencies.getPath("sockjs",{useTLS:e.useTLS}),ignore_null_origin:e.ignoreNullOrigin})},beforeOpen:function(t,e){t.send(JSON.stringify({path:e}))}}),c={isSupported:function(t){var e=s.default.isXDRSupported(t.useTLS);return e}},h=new r.default(l.extend({},i.streamingConfiguration,c)),p=new r.default(l.extend({},i.pollingConfiguration,c));i.default.xdr_streaming=h,i.default.xdr_polling=p,i.default.sockjs=u,e.__esModule=!0,e.default=i.default},function(t,e,n){"use strict";var i=n(21),r=n(22),o=n(9),s=n(2),a=new r.default({urls:i.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(s.default.getWebSocketAPI())},isSupported:function(){return Boolean(s.default.getWebSocketAPI())},getSocket:function(t){return s.default.createWebSocket(t)}}),l={urls:i.http,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}};e.streamingConfiguration=o.extend({getSocket:function(t){return s.default.HTTPFactory.createStreamingSocket(t)}},l),e.pollingConfiguration=o.extend({getSocket:function(t){return s.default.HTTPFactory.createPollingSocket(t)}},l);var u={isSupported:function(){return s.default.isXHRSupported()}},c=new r.default(o.extend({},e.streamingConfiguration,u)),h=new r.default(o.extend({},e.pollingConfiguration,u)),p={ws:a,xhr_streaming:c,xhr_polling:h};e.__esModule=!0,e.default=p},function(t,e,n){"use strict";function r(t,e,n){var i=t+(e.useTLS?"s":""),r=e.useTLS?e.hostTLS:e.hostNonTLS;return i+"://"+r+n}function i(t,e){var n="/app/"+t,i="?protocol="+o.default.PROTOCOL+"&client=js&version="+o.default.VERSION+(e?"&"+e:"");return n+i}var o=n(5);e.ws={getInitial:function(t,e){var n=(e.httpPath||"")+i(t,"flash=false");return r("ws",e,n)}},e.http={getInitial:function(t,e){var n=(e.httpPath||"/pusher")+i(t);return r("http",e,n)}},e.sockjs={getInitial:function(t,e){return r("http",e,e.httpPath||"/pusher")},getPath:function(t,e){return i(t)}}},function(e,n,i){"use strict";var r=i(23),o=function(){function t(t){this.hooks=t}return t.prototype.isSupported=function(t){return this.hooks.isSupported(t)},t.prototype.createConnection=function(t,e,n,i){return new r.default(this.hooks,t,e,n,i)},t}();n.__esModule=!0,n.default=o},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(11),s=i(9),a=i(24),l=i(8),u=i(2),c=function(t){function e(e,n,i,r,o){t.call(this),this.initialize=u.default.transportConnectionInitializer,this.hooks=e,this.name=n,this.priority=i,this.key=r,this.options=o,this.state="new",this.timeline=o.timeline,this.activityTimeout=o.activityTimeout,this.id=this.timeline.generateUniqueID()}return r(e,t),e.prototype.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)},e.prototype.supportsPing=function(){return Boolean(this.hooks.supportsPing)},e.prototype.connect=function(){var t=this;if(this.socket||"initialized"!==this.state)return!1;var e=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(e,this.options)}catch(e){return o.default.defer(function(){t.onError(e),t.changeState("closed")}),!1}return this.bindListeners(),l.default.debug("Connecting",{transport:this.name,url:e}),this.changeState("connecting"),!0},e.prototype.close=function(){return!!this.socket&&(this.socket.close(),!0)},e.prototype.send=function(t){var e=this;return"open"===this.state&&(o.default.defer(function(){e.socket&&e.socket.send(t)}),!0)},e.prototype.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()},e.prototype.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},e.prototype.onError=function(t){this.emit("error",{type:"WebSocketError",error:t}),this.timeline.error(this.buildTimelineMessage({error:t.toString()}))},e.prototype.onClose=function(t){t?this.changeState("closed",{code:t.code,reason:t.reason,wasClean:t.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},e.prototype.onMessage=function(t){this.emit("message",t)},e.prototype.onActivity=function(){this.emit("activity")},e.prototype.bindListeners=function(){var t=this;this.socket.onopen=function(){t.onOpen()},this.socket.onerror=function(e){t.onError(e)},this.socket.onclose=function(e){t.onClose(e)},this.socket.onmessage=function(e){t.onMessage(e)},this.supportsPing()&&(this.socket.onactivity=function(){t.onActivity()})},e.prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},e.prototype.changeState=function(t,e){this.state=t,this.timeline.info(this.buildTimelineMessage({state:t,params:e})),this.emit(t,e)},e.prototype.buildTimelineMessage=function(t){return s.extend({cid:this.id},t)},e}(a.default);n.__esModule=!0,n.default=c},function(e,n,i){"use strict";var r=i(9),o=i(25),s=function(){function t(t){this.callbacks=new o.default,this.global_callbacks=[],this.failThrough=t}return t.prototype.bind=function(t,e,n){return this.callbacks.add(t,e,n),this},t.prototype.bind_global=function(t){return this.global_callbacks.push(t),this},t.prototype.unbind=function(t,e,n){return this.callbacks.remove(t,e,n),this},t.prototype.unbind_global=function(t){return t?(this.global_callbacks=r.filter(this.global_callbacks||[],function(e){return e!==t}),this):(this.global_callbacks=[],this)},t.prototype.unbind_all=function(){return this.unbind(),this.unbind_global(),this},t.prototype.emit=function(t,e,n){for(var i=0;i<this.global_callbacks.length;i++)this.global_callbacks[i](t,e);var r=this.callbacks.get(t),o=[];if(n?o.push(e,n):e&&o.push(e),r&&r.length>0)for(var i=0;i<r.length;i++)r[i].fn.apply(r[i].context||window,o);else this.failThrough&&this.failThrough(t,e);return this},t}();n.__esModule=!0,n.default=s},function(e,n,i){"use strict";function r(t){return"_"+t}var o=i(9),s=function(){function t(){this._callbacks={}}return t.prototype.get=function(t){return this._callbacks[r(t)]},t.prototype.add=function(t,e,n){var i=r(t);this._callbacks[i]=this._callbacks[i]||[],this._callbacks[i].push({fn:e,context:n})},t.prototype.remove=function(t,e,n){if(t||e||n){var i=t?[r(t)]:o.keys(this._callbacks);e||n?this.removeCallback(i,e,n):this.removeAllCallbacks(i)}else this._callbacks={}},t.prototype.removeCallback=function(t,e,n){o.apply(t,function(t){this._callbacks[t]=o.filter(this._callbacks[t]||[],function(t){return e&&e!==t.fn||n&&n!==t.context}),0===this._callbacks[t].length&&delete this._callbacks[t]},this)},t.prototype.removeAllCallbacks=function(t){o.apply(t,function(t){delete this._callbacks[t]},this)},t}();n.__esModule=!0,n.default=s},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(24),s=function(t){function e(){t.call(this);var e=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){e.emit("online")},!1),window.addEventListener("offline",function(){e.emit("offline")},!1))}return r(e,t),e.prototype.isOnline=function(){return void 0===window.navigator.onLine||window.navigator.onLine},e}(o.default);n.NetInfo=s,n.Network=new s},function(t,e){"use strict";e.__esModule=!0,e.default=function(t){var e;return e=t.useTLS?[":best_connected_ever",":ws_loop",[":delayed",2e3,[":http_fallback_loop"]]]:[":best_connected_ever",":ws_loop",[":delayed",2e3,[":wss_loop"]],[":delayed",5e3,[":http_fallback_loop"]]],[[":def","ws_options",{hostNonTLS:t.wsHost+":"+t.wsPort,hostTLS:t.wsHost+":"+t.wssPort,httpPath:t.wsPath}],[":def","wss_options",[":extend",":ws_options",{useTLS:!0}]],[":def","sockjs_options",{hostNonTLS:t.httpHost+":"+t.httpPort,hostTLS:t.httpHost+":"+t.httpsPort,httpPath:t.httpPath}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:t.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:t.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4e3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],e,":http_fallback_loop"]]]]]}},function(t,e,n){"use strict";var i=n(3);e.__esModule=!0,e.default=function r(){var t=this;t.timeline.info(t.buildTimelineMessage({transport:t.name+(t.options.useTLS?"s":"")})),t.hooks.isInitialized()?t.changeState("initialized"):t.hooks.file?(t.changeState("initializing"),i.Dependencies.load(t.hooks.file,{useTLS:t.options.useTLS},function(e,n){t.hooks.isInitialized()?(t.changeState("initialized"),n(!0)):(e&&t.onError(e),t.onClose(),n(!1))})):t.onClose()}},function(t,e,n){"use strict";var i=n(30),r=n(32);r.default.createXDR=function(t,e){return this.createRequest(i.default,t,e)},e.__esModule=!0,e.default=r.default},function(t,e,n){"use strict";var i=n(31),r={getRequest:function(t){var e=new window.XDomainRequest;return e.ontimeout=function(){t.emit("error",new i.RequestTimedOut),t.close()},e.onerror=function(e){t.emit("error",e),t.close()},e.onprogress=function(){e.responseText&&e.responseText.length>0&&t.onChunk(200,e.responseText)},e.onload=function(){e.responseText&&e.responseText.length>0&&t.onChunk(200,e.responseText),t.emit("finished",200),t.close()},e},abortRequest:function(t){t.ontimeout=t.onerror=t.onprogress=t.onload=null,t.abort()}};e.__esModule=!0,e.default=r},function(t,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},r=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(Error);n.BadEventName=r;var o=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(Error);n.RequestTimedOut=o;var s=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(Error);n.TransportPriorityTooLow=s;var a=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(Error);n.TransportClosed=a;var l=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(Error);n.UnsupportedFeature=l;var u=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(Error);n.UnsupportedTransport=u;var c=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(Error);n.UnsupportedStrategy=c},function(t,e,n){"use strict";var i=n(33),r=n(34),o=n(36),s=n(37),a=n(38),l={createStreamingSocket:function(t){return this.createSocket(o.default,t)},createPollingSocket:function(t){return this.createSocket(s.default,t)},createSocket:function(t,e){return new r.default(t,e)},createXHR:function(t,e){return this.createRequest(a.default,t,e)},createRequest:function(t,e,n){return new i.default(t,e,n)}};e.__esModule=!0,e.default=l},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(2),s=i(24),a=function(t){function e(e,n,i){t.call(this),this.hooks=e,this.method=n,this.url=i}return r(e,t),e.prototype.start=function(t){var e=this;this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=function(){e.close()},o.default.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(t)},e.prototype.close=function(){this.unloader&&(o.default.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)},e.prototype.onChunk=function(t,e){for(;;){var n=this.advanceBuffer(e);if(!n)break;this.emit("chunk",{status:t,data:n})}this.isBufferTooLong(e)&&this.emit("buffer_too_long")},e.prototype.advanceBuffer=function(t){var e=t.slice(this.position),n=e.indexOf("\n");return-1!==n?(this.position+=n+1,e.slice(0,n)):null},e.prototype.isBufferTooLong=function(t){return this.position===t.length&&t.length>262144},e}(s.default);n.__esModule=!0,n.default=a},function(e,n,l){"use strict";function o(t){var e=-1===t.indexOf("?")?"?":"&";return t+e+"t="+ +new Date+"&n="+d++}function a(t){return Math.floor(Math.random()*t)}var c=l(35),h=l(11),p=l(2),d=1,f=function(){function t(t,e){this.hooks=t,this.session=a(1e3)+"/"+function u(t){for(var e=[],n=0;n<t;n++)e.push(a(32).toString(32));return e.join("")}(8),this.location=function r(t){var e=/([^\?]*)\/*(\??.*)/.exec(t);return{base:e[1],queryString:e[2]}}(e),this.readyState=c.default.CONNECTING,this.openStream()}return t.prototype.send=function(t){return this.sendRaw(JSON.stringify([t]))},t.prototype.ping=function(){this.hooks.sendHeartbeat(this)},t.prototype.close=function(t,e){this.onClose(t,e,!0)},t.prototype.sendRaw=function(t){if(this.readyState!==c.default.OPEN)return!1;try{return p.default.createSocketRequest("POST",o(function i(t,e){return t.base+"/"+e+"/xhr_send"}(this.location,this.session))).start(t),!0}catch(t){return!1}},t.prototype.reconnect=function(){this.closeStream(),this.openStream()},t.prototype.onClose=function(t,e,n){this.closeStream(),this.readyState=c.default.CLOSED,this.onclose&&this.onclose({code:t,reason:e,wasClean:n})},t.prototype.onChunk=function(t){if(200===t.status){this.readyState===c.default.OPEN&&this.onActivity();var e,n=t.data.slice(0,1);switch(n){case"o":e=JSON.parse(t.data.slice(1)||"{}"),this.onOpen(e);break;case"a":e=JSON.parse(t.data.slice(1)||"[]");for(var i=0;i<e.length;i++)this.onEvent(e[i]);break;case"m":e=JSON.parse(t.data.slice(1)||"null"),this.onEvent(e);break;case"h":this.hooks.onHeartbeat(this);break;case"c":e=JSON.parse(t.data.slice(1)||"[]"),this.onClose(e[0],e[1],!0)}}},t.prototype.onOpen=function(t){this.readyState===c.default.CONNECTING?(t&&t.hostname&&(this.location.base=function s(t,e){var n=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(t);return n[1]+e+n[3]}(this.location.base,t.hostname)),this.readyState=c.default.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)},t.prototype.onEvent=function(t){this.readyState===c.default.OPEN&&this.onmessage&&this.onmessage({data:t})},t.prototype.onActivity=function(){this.onactivity&&this.onactivity()},t.prototype.onError=function(t){this.onerror&&this.onerror(t)},t.prototype.openStream=function(){var t=this;this.stream=p.default.createSocketRequest("POST",o(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",function(e){t.onChunk(e)}),this.stream.bind("finished",function(e){t.hooks.onFinished(t,e)}),this.stream.bind("buffer_too_long",function(){t.reconnect()});try{this.stream.start()}catch(e){h.default.defer(function(){t.onError(e),t.onClose(1006,"Could not start streaming",!1)})}},t.prototype.closeStream=function(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)},t}();n.__esModule=!0,n.default=f},function(t,e){"use strict";var n;!function(t){t[t.CONNECTING=0]="CONNECTING",t[t.OPEN=1]="OPEN",t[t.CLOSED=3]="CLOSED"}(n||(n={})),e.__esModule=!0,e.default=n},function(t,e){"use strict";e.__esModule=!0,e.default={getReceiveURL:function(t,e){return t.base+"/"+e+"/xhr_streaming"+t.queryString},onHeartbeat:function(t){t.sendRaw("[]")},sendHeartbeat:function(t){t.sendRaw("[]")},onFinished:function(t,e){t.onClose(1006,"Connection interrupted ("+e+")",!1)}}},function(t,e){"use strict";e.__esModule=!0,e.default={getReceiveURL:function(t,e){return t.base+"/"+e+"/xhr"+t.queryString},onHeartbeat:function(){},sendHeartbeat:function(t){t.sendRaw("[]")},onFinished:function(t,e){200===e?t.reconnect():t.onClose(1006,"Connection interrupted ("+e+")",!1)}}},function(t,e,n){"use strict";var i=n(2),r={getRequest:function(t){var e=i.default.getXHRAPI(),n=new e;return n.onreadystatechange=n.onprogress=function(){switch(n.readyState){case 3:n.responseText&&n.responseText.length>0&&t.onChunk(n.status,n.responseText);break;case 4:n.responseText&&n.responseText.length>0&&t.onChunk(n.status,n.responseText),t.emit("finished",n.status),t.close()}},n},abortRequest:function(t){t.onreadystatechange=null,t.abort()}};e.__esModule=!0,e.default=r},function(e,n,i){"use strict";var r=i(9),o=i(11),s=i(40),a=function(){function t(t,e,n){this.key=t,this.session=e,this.events=[],this.options=n||{},this.sent=0,this.uniqueID=0}return t.prototype.log=function(t,e){t<=this.options.level&&(this.events.push(r.extend({},e,{timestamp:o.default.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},t.prototype.error=function(t){this.log(s.default.ERROR,t)},t.prototype.info=function(t){this.log(s.default.INFO,t)},t.prototype.debug=function(t){this.log(s.default.DEBUG,t)},t.prototype.isEmpty=function(){return 0===this.events.length},t.prototype.send=function(t,e){var n=this,i=r.extend({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],t(i,function(t,i){t||n.sent++,e&&e(t,i)}),!0},t.prototype.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},t}();n.__esModule=!0,n.default=a},function(t,e){"use strict";var n;!function(t){t[t.ERROR=3]="ERROR",t[t.INFO=6]="INFO",t[t.DEBUG=7]="DEBUG"}(n||(n={})),e.__esModule=!0,e.default=n},function(t,e,n){"use strict";function r(t){return function(e){return[t.apply(this,arguments),e]}}function i(t){return"string"==typeof t&&":"===t.charAt(0)}function o(t,e){return e[t.slice(1)]}function u(t,e){if(i(t[0])){var n=o(t[0],e);if(t.length>1){if("function"!=typeof n)throw"Calling non-function "+t[0];var r=[l.extend({},e)].concat(l.map(t.slice(1),function(t){return c(t,l.extend({},e))[0]}));return n.apply(this,r)}return[n,e]}return function s(t,e){if(0===t.length)return[[],e];var n=c(t[0],e),i=s(t.slice(1),n[1]);return[[n[0]].concat(i[0]),i[1]]}(t,e)}function c(t,e){return"string"==typeof t?function a(t,e){if(!i(t))return[t,e];var n=o(t,e);if(void 0===n)throw"Undefined symbol "+t;return[n,e]}(t,e):"object"==typeof t&&t instanceof Array&&t.length>0?u(t,e):[t,e]}var l=n(9),h=n(11),p=n(42),d=n(31),f=n(64),m=n(65),g=n(66),y=n(67),v=n(68),S=n(69),b=n(70),w=n(2),x=w.default.Transports;e.build=function(t,e){var n=l.extend({},C,e);return c(t,n)[1].strategy};var P={isSupported:function(){return!1},connect:function(t,e){var n=h.default.defer(function(){e(new d.UnsupportedStrategy)});return{abort:function(){n.ensureAborted()},forceMinPriority:function(){}}}},C={extend:function(t,e,n){return[l.extend({},e,n),t]},def:function(t,e,n){if(void 0!==t[e])throw"Redefining symbol "+e;return t[e]=n,[void 0,t]},def_transport:function(t,e,n,i,r,o){var s=x[n];if(!s)throw new d.UnsupportedTransport(n);var a,u=!(t.enabledTransports&&-1===l.arrayIndexOf(t.enabledTransports,e)||t.disabledTransports&&-1!==l.arrayIndexOf(t.disabledTransports,e));a=u?new f.default(e,i,o?o.getAssistant(s):s,l.extend({key:t.key,useTLS:t.useTLS,timeline:t.timeline,ignoreNullOrigin:t.ignoreNullOrigin},r)):P;var c=t.def(t,e,a)[1];return c.Transports=t.Transports||{},c.Transports[e]=a,[void 0,c]},transport_manager:r(function(t,e){return new p.default(e)}),sequential:r(function(t,e){var n=Array.prototype.slice.call(arguments,2);return new m.default(n,e)}),cached:r(function(t,e,n){return new y.default(n,t.Transports,{ttl:e,timeline:t.timeline,useTLS:t.useTLS})}),first_connected:r(function(t,e){return new b.default(e)}),best_connected_ever:r(function(){var t=Array.prototype.slice.call(arguments,1);return new g.default(t)}),delayed:r(function(t,e,n){return new v.default(n,{delay:e})}),if:r(function(t,e,n,i){return new S.default(e,n,i)}),is_supported:r(function(t,e){return function(){return e.isSupported()}})}},function(e,n,i){"use strict";var r=i(43),o=function(){function t(t){this.options=t||{},this.livesLeft=this.options.lives||1/0}return t.prototype.getAssistant=function(t){return r.default.createAssistantToTheTransportManager(this,t,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},t.prototype.isAlive=function(){return this.livesLeft>0},t.prototype.reportDeath=function(){this.livesLeft-=1},t}();n.__esModule=!0,n.default=o},function(t,e,n){"use strict";var i=n(44),r=n(45),o=n(48),s=n(49),a=n(50),l=n(51),u=n(54),c=n(52),h=n(62),p=n(63),d={createChannels:function(){return new p.default},createConnectionManager:function(t,e){return new h.default(t,e)},createChannel:function(t,e){return new c.default(t,e)},createPrivateChannel:function(t,e){return new l.default(t,e)},createPresenceChannel:function(t,e){return new a.default(t,e)},createEncryptedChannel:function(t,e){return new u.default(t,e)},createTimelineSender:function(t,e){return new s.default(t,e)},createAuthorizer:function(t,e){return e.authorizer?e.authorizer(t,e):new o.default(t,e)},createHandshake:function(t,e){return new r.default(t,e)},createAssistantToTheTransportManager:function(t,e,n){return new i.default(t,e,n)}};e.__esModule=!0,e.default=d},function(e,n,i){"use strict";var r=i(11),o=i(9),s=function(){function t(t,e,n){this.manager=t,this.transport=e,this.minPingDelay=n.minPingDelay,this.maxPingDelay=n.maxPingDelay,this.pingDelay=void 0}return t.prototype.createConnection=function(t,e,n,i){var s=this;i=o.extend({},i,{activityTimeout:this.pingDelay});var a=this.transport.createConnection(t,e,n,i),l=null,u=function(){a.unbind("open",u),a.bind("closed",c),l=r.default.now()},c=function(t){if(a.unbind("closed",c),1002===t.code||1003===t.code)s.manager.reportDeath();else if(!t.wasClean&&l){var e=r.default.now()-l;e<2*s.maxPingDelay&&(s.manager.reportDeath(),s.pingDelay=Math.max(e/2,s.minPingDelay))}};return a.bind("open",u),a},t.prototype.isSupported=function(t){return this.manager.isAlive()&&this.transport.isSupported(t)},t}();n.__esModule=!0,n.default=s},function(e,n,i){"use strict";var r=i(9),o=i(46),s=i(47),a=function(){function t(t,e){this.transport=t,this.callback=e,this.bindListeners()}return t.prototype.close=function(){this.unbindListeners(),this.transport.close()},t.prototype.bindListeners=function(){var t=this;this.onMessage=function(e){var n;t.unbindListeners();try{n=o.processHandshake(e)}catch(e){return t.finish("error",{error:e}),void t.transport.close()}"connected"===n.action?t.finish("connected",{connection:new s.default(n.id,t.transport),activityTimeout:n.activityTimeout}):(t.finish(n.action,{error:n.error}),t.transport.close())},this.onClosed=function(e){t.unbindListeners();var n=o.getCloseAction(e)||"backoff",i=o.getCloseError(e);t.finish(n,{error:i})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)},t.prototype.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},t.prototype.finish=function(t,e){this.callback(r.extend({transport:this.transport,action:t},e))},t}();n.__esModule=!0,n.default=a},function(t,e){"use strict";e.decodeMessage=function(t){try{var e=JSON.parse(t.data),n=e.data;if("string"==typeof n)try{n=JSON.parse(e.data)}catch(t){}var i={event:e.event,channel:e.channel,data:n};return e.user_id&&(i.user_id=e.user_id),i}catch(e){throw{type:"MessageParseError",error:e,data:t.data}}},e.encodeMessage=function(t){return JSON.stringify(t)},e.processHandshake=function(t){var n=e.decodeMessage(t);if("pusher:connection_established"===n.event){if(!n.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:n.data.socket_id,activityTimeout:1e3*n.data.activity_timeout}}if("pusher:error"===n.event)return{action:this.getCloseAction(n.data),error:this.getCloseError(n.data)};throw"Invalid handshake"},e.getCloseAction=function(t){return t.code<4e3?t.code>=1002&&t.code<=1004?"backoff":null:4e3===t.code?"tls_only":t.code<4100?"refused":t.code<4200?"backoff":t.code<4300?"retry":"refused"},e.getCloseError=function(t){return 1e3!==t.code&&1001!==t.code?{type:"PusherError",data:{code:t.code,message:t.reason||t.message}}:null}},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(9),s=i(24),a=i(46),l=i(8),u=function(t){function e(e,n){t.call(this),this.id=e,this.transport=n,this.activityTimeout=n.activityTimeout,this.bindListeners()}return r(e,t),e.prototype.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},e.prototype.send=function(t){return this.transport.send(t)},e.prototype.send_event=function(t,e,n){var i={event:t,data:e};return n&&(i.channel=n),l.default.debug("Event sent",i),this.send(a.encodeMessage(i))},e.prototype.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},e.prototype.close=function(){this.transport.close()},e.prototype.bindListeners=function(){var t=this,e={message:function(e){var n;try{n=a.decodeMessage(e)}catch(n){t.emit("error",{type:"MessageParseError",error:n,data:e.data})}if(void 0!==n){switch(l.default.debug("Event recd",n),n.event){case"pusher:error":t.emit("error",{type:"PusherError",data:n.data});break;case"pusher:ping":t.emit("ping");break;case"pusher:pong":t.emit("pong")}t.emit("message",n)}},activity:function(){t.emit("activity")},error:function(e){t.emit("error",{type:"WebSocketError",error:e})},closed:function(e){n(),e&&e.code&&t.handleCloseEvent(e),t.transport=null,t.emit("closed")}},n=function(){o.objectApply(e,function(e,n){t.transport.unbind(n,e)})};o.objectApply(e,function(e,n){t.transport.bind(n,e)})},e.prototype.handleCloseEvent=function(t){var e=a.getCloseAction(t),n=a.getCloseError(t);n&&this.emit("error",n),e&&this.emit(e,{action:e,error:n})},e}(s.default);n.__esModule=!0,n.default=u},function(e,n,i){"use strict";var r=i(2),o=function(){function t(t,e){this.channel=t;var n=e.authTransport;if(void 0===r.default.getAuthorizers()[n])throw"'"+n+"' is not a recognized auth transport";this.type=n,this.options=e,this.authOptions=(e||{}).auth||{}}return t.prototype.composeQuery=function(t){var e="socket_id="+encodeURIComponent(t)+"&channel_name="+encodeURIComponent(this.channel.name);for(var n in this.authOptions.params)e+="&"+encodeURIComponent(n)+"="+encodeURIComponent(this.authOptions.params[n]);return e},t.prototype.authorize=function(e,n){return t.authorizers=t.authorizers||r.default.getAuthorizers(),t.authorizers[this.type].call(this,r.default,e,n)},t}();n.__esModule=!0,n.default=o},function(e,n,i){"use strict";var r=i(2),o=function(){function t(t,e){this.timeline=t,this.options=e||{}}return t.prototype.send=function(t,e){this.timeline.isEmpty()||this.timeline.send(r.default.TimelineTransport.getAgent(this,t),e)},t}();n.__esModule=!0,n.default=o},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(51),s=i(8),a=i(53),l=i(14),u=function(t){function e(e,n){t.call(this,e,n),this.members=new a.default}return r(e,t),e.prototype.authorize=function(e,n){var i=this;t.prototype.authorize.call(this,e,function(t,e){if(!t){if(void 0===e.channel_data){var r=l.default.buildLogSuffix("authenticationEndpoint");return s.default.warn("Invalid auth response for channel '"+i.name+"',expected 'channel_data' field. "+r),void n("Invalid auth response")}var o=JSON.parse(e.channel_data);i.members.setMyID(o.user_id)}n(t,e)})},e.prototype.handleEvent=function(t){var e=t.event;if(0===e.indexOf("pusher_internal:"))this.handleInternalEvent(t);else{var n=t.data,i={};t.user_id&&(i.user_id=t.user_id),this.emit(e,n,i)}},e.prototype.handleInternalEvent=function(t){var e=t.event,n=t.data;switch(e){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(t);break;case"pusher_internal:member_added":var i=this.members.addMember(n);this.emit("pusher:member_added",i);break;case"pusher_internal:member_removed":var r=this.members.removeMember(n);r&&this.emit("pusher:member_removed",r)}},e.prototype.handleSubscriptionSucceededEvent=function(t){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(t.data),this.emit("pusher:subscription_succeeded",this.members))},e.prototype.disconnect=function(){this.members.reset(),t.prototype.disconnect.call(this)},e}(o.default);n.__esModule=!0,n.default=u},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(43),s=i(52),a=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype.authorize=function(t,e){var n=o.default.createAuthorizer(this,this.pusher.config);return n.authorize(t,e)},e}(s.default);n.__esModule=!0,n.default=a},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(24),s=i(31),a=i(8),l=i(14),u=function(t){function e(e,n){t.call(this,function(t,n){a.default.debug("No callbacks on "+e+" for "+t)}),this.name=e,this.pusher=n,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}return r(e,t),e.prototype.authorize=function(t,e){return e(!1,{})},e.prototype.trigger=function(t,e){if(0!==t.indexOf("client-"))throw new s.BadEventName("Event '"+t+"' does not start with 'client-'");if(!this.subscribed){var n=l.default.buildLogSuffix("triggeringClientEvents");a.default.warn("Client event triggered before channel 'subscription_succeeded' event . "+n)}return this.pusher.send_event(t,e,this.name)},e.prototype.disconnect=function(){this.subscribed=!1,this.subscriptionPending=!1},e.prototype.handleEvent=function(t){var e=t.event,n=t.data;"pusher_internal:subscription_succeeded"===e?this.handleSubscriptionSucceededEvent(t):0!==e.indexOf("pusher_internal:")&&this.emit(e,n,{})},e.prototype.handleSubscriptionSucceededEvent=function(t){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",t.data)},e.prototype.subscribe=function(){var t=this;this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,function(e,n){e?t.emit("pusher:subscription_error",n):t.pusher.send_event("pusher:subscribe",{auth:n.auth,channel_data:n.channel_data,channel:t.name})}))},e.prototype.unsubscribe=function(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},e.prototype.cancelSubscription=function(){this.subscriptionCancelled=!0},e.prototype.reinstateSubscription=function(){this.subscriptionCancelled=!1},e}(o.default);n.__esModule=!0,n.default=u},function(e,n,i){"use strict";var r=i(9),o=function(){function t(){this.reset()}return t.prototype.get=function(t){return Object.prototype.hasOwnProperty.call(this.members,t)?{id:t,info:this.members[t]}:null},t.prototype.each=function(t){var e=this;r.objectApply(this.members,function(n,i){t(e.get(i))})},t.prototype.setMyID=function(t){this.myID=t},t.prototype.onSubscription=function(t){this.members=t.presence.hash,this.count=t.presence.count,this.me=this.get(this.myID)},t.prototype.addMember=function(t){return null===this.get(t.user_id)&&this.count++,this.members[t.user_id]=t.user_info,this.get(t.user_id)},t.prototype.removeMember=function(t){var e=this.get(t.user_id);return e&&(delete this.members[t.user_id],this.count--),e},t.prototype.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},t}();n.__esModule=!0,n.default=o},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(51),s=i(31),a=i(8),l=i(55),u=i(57),c=function(t){function e(){t.apply(this,arguments),this.key=null}return r(e,t),e.prototype.authorize=function(e,n){var i=this;t.prototype.authorize.call(this,e,function(t,e){if(t)n(!0,e);else{var r=e.shared_secret;if(!r){var o="No shared_secret key in auth payload for encrypted channel: "+i.name;return n(!0,o),void a.default.warn("Error: "+o)}i.key=u.decodeBase64(r),delete e.shared_secret,n(!1,e)}})},e.prototype.trigger=function(t,e){throw new s.UnsupportedFeature("Client events are not currently supported for encrypted channels")},e.prototype.handleEvent=function(e){var n=e.event,i=e.data;return 0===n.indexOf("pusher_internal:")||0===n.indexOf("pusher:")?void t.prototype.handleEvent.call(this,e):void this.handleEncryptedEvent(n,i)},e.prototype.handleEncryptedEvent=function(t,e){var n=this;if(this.key)if(e.ciphertext&&e.nonce){var i=u.decodeBase64(e.ciphertext);if(i.length<l.secretbox.overheadLength)a.default.warn("Expected encrypted event ciphertext length to be "+l.secretbox.overheadLength+", got: "+i.length);else{var r=u.decodeBase64(e.nonce);if(!(r.length<l.secretbox.nonceLength)){var o=l.secretbox.open(i,r,this.key);return null===o?(a.default.debug("Failed to decrypted an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),void this.authorize(this.pusher.connection.socket_id,function(e,s){return e?void a.default.warn("Failed to make a request to the authEndpoint: "+s+". Unable to fetch new key, so dropping encrypted event"):null===(o=l.secretbox.open(i,r,n.key))?void a.default.warn("Failed to decrypt event with new key. Dropping encrypted event"):void n.emitJSON(t,u.encodeUTF8(o))})):void this.emitJSON(t,u.encodeUTF8(o))}a.default.warn("Expected encrypted event nonce length to be "+l.secretbox.nonceLength+", got: "+r.length)}}else a.default.warn("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+e);else a.default.debug("Received encrypted event before key has been retrieved from the authEndpoint")},e.prototype.emitJSON=function(t,e){try{this.emit(t,JSON.parse(e))}catch(n){this.emit(t,e)}return this},e}(o.default);n.__esModule=!0,n.default=c},function(t,n,s){!function(t){"use strict";function e(t,e,n,i){t[e]=n>>24&255,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n,t[e+4]=i>>24&255,t[e+5]=i>>16&255,t[e+6]=i>>8&255,t[e+7]=255&i}function r(t,e,n,i,r){var o,s=0;for(o=0;o<r;o++)s|=t[e+o]^n[i+o];return(1&s-1>>>8)-1}function i(t,e,n,i){return r(t,e,n,i,16)}function o(t,e,n,i){return r(t,e,n,i,32)}function u(t,e,n,i){!function s(t,e,n,i){for(var r,o=255&i[0]|(255&i[1])<<8|(255&i[2])<<16|(255&i[3])<<24,s=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,a=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,l=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,u=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,c=255&i[4]|(255&i[5])<<8|(255&i[6])<<16|(255&i[7])<<24,h=255&e[0]|(255&e[1])<<8|(255&e[2])<<16|(255&e[3])<<24,p=255&e[4]|(255&e[5])<<8|(255&e[6])<<16|(255&e[7])<<24,d=255&e[8]|(255&e[9])<<8|(255&e[10])<<16|(255&e[11])<<24,f=255&e[12]|(255&e[13])<<8|(255&e[14])<<16|(255&e[15])<<24,m=255&i[8]|(255&i[9])<<8|(255&i[10])<<16|(255&i[11])<<24,g=255&n[16]|(255&n[17])<<8|(255&n[18])<<16|(255&n[19])<<24,y=255&n[20]|(255&n[21])<<8|(255&n[22])<<16|(255&n[23])<<24,v=255&n[24]|(255&n[25])<<8|(255&n[26])<<16|(255&n[27])<<24,S=255&n[28]|(255&n[29])<<8|(255&n[30])<<16|(255&n[31])<<24,b=255&i[12]|(255&i[13])<<8|(255&i[14])<<16|(255&i[15])<<24,w=o,x=s,P=a,C=l,_=u,E=c,T=h,k=p,I=d,M=f,A=m,F=g,B=y,R=v,z=S,O=b,L=0;L<20;L+=2)w^=(r=(B^=(r=(I^=(r=(_^=(r=w+B|0)<<7|r>>>25)+w|0)<<9|r>>>23)+_|0)<<13|r>>>19)+I|0)<<18|r>>>14,E^=(r=(x^=(r=(R^=(r=(M^=(r=E+x|0)<<7|r>>>25)+E|0)<<9|r>>>23)+M|0)<<13|r>>>19)+R|0)<<18|r>>>14,A^=(r=(T^=(r=(P^=(r=(z^=(r=A+T|0)<<7|r>>>25)+A|0)<<9|r>>>23)+z|0)<<13|r>>>19)+P|0)<<18|r>>>14,O^=(r=(F^=(r=(k^=(r=(C^=(r=O+F|0)<<7|r>>>25)+O|0)<<9|r>>>23)+C|0)<<13|r>>>19)+k|0)<<18|r>>>14,w^=(r=(C^=(r=(P^=(r=(x^=(r=w+C|0)<<7|r>>>25)+w|0)<<9|r>>>23)+x|0)<<13|r>>>19)+P|0)<<18|r>>>14,E^=(r=(_^=(r=(k^=(r=(T^=(r=E+_|0)<<7|r>>>25)+E|0)<<9|r>>>23)+T|0)<<13|r>>>19)+k|0)<<18|r>>>14,A^=(r=(M^=(r=(I^=(r=(F^=(r=A+M|0)<<7|r>>>25)+A|0)<<9|r>>>23)+F|0)<<13|r>>>19)+I|0)<<18|r>>>14,O^=(r=(z^=(r=(R^=(r=(B^=(r=O+z|0)<<7|r>>>25)+O|0)<<9|r>>>23)+B|0)<<13|r>>>19)+R|0)<<18|r>>>14;w=w+o|0,x=x+s|0,P=P+a|0,C=C+l|0,_=_+u|0,E=E+c|0,T=T+h|0,k=k+p|0,I=I+d|0,M=M+f|0,A=A+m|0,F=F+g|0,B=B+y|0,R=R+v|0,z=z+S|0,O=O+b|0,t[0]=w>>>0&255,t[1]=w>>>8&255,t[2]=w>>>16&255,t[3]=w>>>24&255,t[4]=x>>>0&255,t[5]=x>>>8&255,t[6]=x>>>16&255,t[7]=x>>>24&255,t[8]=P>>>0&255,t[9]=P>>>8&255,t[10]=P>>>16&255,t[11]=P>>>24&255,t[12]=C>>>0&255,t[13]=C>>>8&255,t[14]=C>>>16&255,t[15]=C>>>24&255,t[16]=_>>>0&255,t[17]=_>>>8&255,t[18]=_>>>16&255,t[19]=_>>>24&255,t[20]=E>>>0&255,t[21]=E>>>8&255,t[22]=E>>>16&255,t[23]=E>>>24&255,t[24]=T>>>0&255,t[25]=T>>>8&255,t[26]=T>>>16&255,t[27]=T>>>24&255,t[28]=k>>>0&255,t[29]=k>>>8&255,t[30]=k>>>16&255,t[31]=k>>>24&255,t[32]=I>>>0&255,t[33]=I>>>8&255,t[34]=I>>>16&255,t[35]=I>>>24&255,t[36]=M>>>0&255,t[37]=M>>>8&255,t[38]=M>>>16&255,t[39]=M>>>24&255,t[40]=A>>>0&255,t[41]=A>>>8&255,t[42]=A>>>16&255,t[43]=A>>>24&255,t[44]=F>>>0&255,t[45]=F>>>8&255,t[46]=F>>>16&255,t[47]=F>>>24&255,t[48]=B>>>0&255,t[49]=B>>>8&255,t[50]=B>>>16&255,t[51]=B>>>24&255,t[52]=R>>>0&255,t[53]=R>>>8&255,t[54]=R>>>16&255,t[55]=R>>>24&255,t[56]=z>>>0&255,t[57]=z>>>8&255,t[58]=z>>>16&255,t[59]=z>>>24&255,t[60]=O>>>0&255,t[61]=O>>>8&255,t[62]=O>>>16&255,t[63]=O>>>24&255}(t,e,n,i)}function c(t,e,n,i){!function a(t,e,n,i){for(var r,o=255&i[0]|(255&i[1])<<8|(255&i[2])<<16|(255&i[3])<<24,s=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,a=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,l=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,u=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,c=255&i[4]|(255&i[5])<<8|(255&i[6])<<16|(255&i[7])<<24,h=255&e[0]|(255&e[1])<<8|(255&e[2])<<16|(255&e[3])<<24,p=255&e[4]|(255&e[5])<<8|(255&e[6])<<16|(255&e[7])<<24,d=255&e[8]|(255&e[9])<<8|(255&e[10])<<16|(255&e[11])<<24,f=255&e[12]|(255&e[13])<<8|(255&e[14])<<16|(255&e[15])<<24,m=255&i[8]|(255&i[9])<<8|(255&i[10])<<16|(255&i[11])<<24,g=255&n[16]|(255&n[17])<<8|(255&n[18])<<16|(255&n[19])<<24,y=255&n[20]|(255&n[21])<<8|(255&n[22])<<16|(255&n[23])<<24,v=255&n[24]|(255&n[25])<<8|(255&n[26])<<16|(255&n[27])<<24,S=255&n[28]|(255&n[29])<<8|(255&n[30])<<16|(255&n[31])<<24,b=255&i[12]|(255&i[13])<<8|(255&i[14])<<16|(255&i[15])<<24,w=o,x=s,P=a,C=l,_=u,E=c,T=h,k=p,I=d,M=f,A=m,F=g,B=y,R=v,z=S,O=b,L=0;L<20;L+=2)w^=(r=(B^=(r=(I^=(r=(_^=(r=w+B|0)<<7|r>>>25)+w|0)<<9|r>>>23)+_|0)<<13|r>>>19)+I|0)<<18|r>>>14,E^=(r=(x^=(r=(R^=(r=(M^=(r=E+x|0)<<7|r>>>25)+E|0)<<9|r>>>23)+M|0)<<13|r>>>19)+R|0)<<18|r>>>14,A^=(r=(T^=(r=(P^=(r=(z^=(r=A+T|0)<<7|r>>>25)+A|0)<<9|r>>>23)+z|0)<<13|r>>>19)+P|0)<<18|r>>>14,O^=(r=(F^=(r=(k^=(r=(C^=(r=O+F|0)<<7|r>>>25)+O|0)<<9|r>>>23)+C|0)<<13|r>>>19)+k|0)<<18|r>>>14,w^=(r=(C^=(r=(P^=(r=(x^=(r=w+C|0)<<7|r>>>25)+w|0)<<9|r>>>23)+x|0)<<13|r>>>19)+P|0)<<18|r>>>14,E^=(r=(_^=(r=(k^=(r=(T^=(r=E+_|0)<<7|r>>>25)+E|0)<<9|r>>>23)+T|0)<<13|r>>>19)+k|0)<<18|r>>>14,A^=(r=(M^=(r=(I^=(r=(F^=(r=A+M|0)<<7|r>>>25)+A|0)<<9|r>>>23)+F|0)<<13|r>>>19)+I|0)<<18|r>>>14,O^=(r=(z^=(r=(R^=(r=(B^=(r=O+z|0)<<7|r>>>25)+O|0)<<9|r>>>23)+B|0)<<13|r>>>19)+R|0)<<18|r>>>14;t[0]=w>>>0&255,t[1]=w>>>8&255,t[2]=w>>>16&255,t[3]=w>>>24&255,t[4]=E>>>0&255,t[5]=E>>>8&255,t[6]=E>>>16&255,t[7]=E>>>24&255,t[8]=A>>>0&255,t[9]=A>>>8&255,t[10]=A>>>16&255,t[11]=A>>>24&255,t[12]=O>>>0&255,t[13]=O>>>8&255,t[14]=O>>>16&255,t[15]=O>>>24&255,t[16]=T>>>0&255,t[17]=T>>>8&255,t[18]=T>>>16&255,t[19]=T>>>24&255,t[20]=k>>>0&255,t[21]=k>>>8&255,t[22]=k>>>16&255,t[23]=k>>>24&255,t[24]=I>>>0&255,t[25]=I>>>8&255,t[26]=I>>>16&255,t[27]=I>>>24&255,t[28]=M>>>0&255,t[29]=M>>>8&255,t[30]=M>>>16&255,t[31]=M>>>24&255}(t,e,n,i)}function h(t,e,n,i,r,o,s){var a,l,c=new Uint8Array(16),h=new Uint8Array(64);for(l=0;l<16;l++)c[l]=0;for(l=0;l<8;l++)c[l]=o[l];for(;r>=64;){for(u(h,c,s,ct),l=0;l<64;l++)t[e+l]=n[i+l]^h[l];for(a=1,l=8;l<16;l++)a=a+(255&c[l])|0,c[l]=255&a,a>>>=8;r-=64,e+=64,i+=64}if(r>0)for(u(h,c,s,ct),l=0;l<r;l++)t[e+l]=n[i+l]^h[l];return 0}function f(t,e,n,i,r){var o,s,a=new Uint8Array(16),l=new Uint8Array(64);for(s=0;s<16;s++)a[s]=0;for(s=0;s<8;s++)a[s]=i[s];for(;n>=64;){for(u(l,a,r,ct),s=0;s<64;s++)t[e+s]=l[s];for(o=1,s=8;s<16;s++)o=o+(255&a[s])|0,a[s]=255&o,o>>>=8;n-=64,e+=64}if(n>0)for(u(l,a,r,ct),s=0;s<n;s++)t[e+s]=l[s];return 0}function l(t,e,n,i,r){var o=new Uint8Array(32);c(o,i,r,ct);for(var s=new Uint8Array(8),a=0;a<8;a++)s[a]=i[a+16];return f(t,e,n,s,o)}function p(t,e,n,i,r,o,s){var a=new Uint8Array(32);c(a,o,s,ct);for(var l=new Uint8Array(8),u=0;u<8;u++)l[u]=o[u+16];return h(t,e,n,i,r,l,a)}function d(t,e,n,i,r,o){var s=new ht(o);return s.update(n,i,r),s.finish(t,e),0}function y(t,e,n,r,o,s){var a=new Uint8Array(16);return d(a,0,n,r,o,s),i(t,e,a,0)}function g(t,e,n,i,r){var o;if(n<32)return-1;for(p(t,0,e,0,n,i,r),d(t,16,t,32,n-32,t),o=0;o<16;o++)t[o]=0;return 0}function v(t,e,n,i,r){var o,s=new Uint8Array(32);if(n<32)return-1;if(l(s,0,32,i,r),0!==y(e,16,e,32,n-32,s))return-1;for(p(t,0,e,0,n,i,r),o=0;o<32;o++)t[o]=0;return 0}function b(t,e){var n;for(n=0;n<16;n++)t[n]=0|e[n]}function m(t){var e,n,i=1;for(e=0;e<16;e++)n=t[e]+i+65535,i=Math.floor(n/65536),t[e]=n-65536*i;t[0]+=i-1+37*(i-1)}function w(t,e,n){for(var i,r=~(n-1),o=0;o<16;o++)i=r&(t[o]^e[o]),t[o]^=i,e[o]^=i}function _(t,e){var i,r,o,s=n(),a=n();for(i=0;i<16;i++)a[i]=e[i];for(m(a),m(a),m(a),r=0;r<2;r++){for(s[0]=a[0]-65517,i=1;i<15;i++)s[i]=a[i]-65535-(s[i-1]>>16&1),s[i-1]&=65535;s[15]=a[15]-32767-(s[14]>>16&1),o=s[15]>>16&1,s[14]&=65535,w(a,s,1-o)}for(i=0;i<16;i++)t[2*i]=255&a[i],t[2*i+1]=a[i]>>8}function S(t,e){var n=new Uint8Array(32),i=new Uint8Array(32);return _(n,t),_(i,e),o(n,0,i,0)}function k(t){var e=new Uint8Array(32);return _(e,t),1&e[0]}function T(t,e){var n;for(n=0;n<16;n++)t[n]=e[2*n]+(e[2*n+1]<<8);t[15]&=32767}function A(t,e,n){for(var i=0;i<16;i++)t[i]=e[i]+n[i]}function E(t,e,n){for(var i=0;i<16;i++)t[i]=e[i]-n[i]}function x(t,e,n){var i,r,o=0,s=0,a=0,l=0,u=0,c=0,h=0,p=0,d=0,f=0,m=0,g=0,y=0,v=0,S=0,b=0,w=0,x=0,P=0,C=0,_=0,E=0,T=0,k=0,I=0,M=0,A=0,F=0,B=0,R=0,z=0,O=n[0],L=n[1],D=n[2],N=n[3],U=n[4],W=n[5],j=n[6],q=n[7],H=n[8],V=n[9],$=n[10],G=n[11],Y=n[12],K=n[13],X=n[14],J=n[15];i=e[0],o+=i*O,s+=i*L,a+=i*D,l+=i*N,u+=i*U,c+=i*W,h+=i*j,p+=i*q,d+=i*H,f+=i*V,m+=i*$,g+=i*G,y+=i*Y,v+=i*K,S+=i*X,b+=i*J,i=e[1],s+=i*O,a+=i*L,l+=i*D,u+=i*N,c+=i*U,h+=i*W,p+=i*j,d+=i*q,f+=i*H,m+=i*V,g+=i*$,y+=i*G,v+=i*Y,S+=i*K,b+=i*X,w+=i*J,i=e[2],a+=i*O,l+=i*L,u+=i*D,c+=i*N,h+=i*U,p+=i*W,d+=i*j,f+=i*q,m+=i*H,g+=i*V,y+=i*$,v+=i*G,S+=i*Y,b+=i*K,w+=i*X,x+=i*J,i=e[3],l+=i*O,u+=i*L,c+=i*D,h+=i*N,p+=i*U,d+=i*W,f+=i*j,m+=i*q,g+=i*H,y+=i*V,v+=i*$,S+=i*G,b+=i*Y,w+=i*K,x+=i*X,P+=i*J,i=e[4],u+=i*O,c+=i*L,h+=i*D,p+=i*N,d+=i*U,f+=i*W,m+=i*j,g+=i*q,y+=i*H,v+=i*V,S+=i*$,b+=i*G,w+=i*Y,x+=i*K,P+=i*X,C+=i*J,i=e[5],c+=i*O,h+=i*L,p+=i*D,d+=i*N,f+=i*U,m+=i*W,g+=i*j,y+=i*q,v+=i*H,S+=i*V,b+=i*$,w+=i*G,x+=i*Y,P+=i*K,C+=i*X,_+=i*J,i=e[6],h+=i*O,p+=i*L,d+=i*D,f+=i*N,m+=i*U,g+=i*W,y+=i*j,v+=i*q,S+=i*H,b+=i*V,w+=i*$,x+=i*G,P+=i*Y,C+=i*K,_+=i*X,E+=i*J,i=e[7],p+=i*O,d+=i*L,f+=i*D,m+=i*N,g+=i*U,y+=i*W,v+=i*j,S+=i*q,b+=i*H,w+=i*V,x+=i*$,P+=i*G,C+=i*Y,_+=i*K,E+=i*X,T+=i*J,i=e[8],d+=i*O,f+=i*L,m+=i*D,g+=i*N,y+=i*U,v+=i*W,S+=i*j,b+=i*q,w+=i*H,x+=i*V,P+=i*$,C+=i*G,_+=i*Y,E+=i*K,T+=i*X,k+=i*J,i=e[9],f+=i*O,m+=i*L,g+=i*D,y+=i*N,v+=i*U,S+=i*W,b+=i*j,w+=i*q,x+=i*H,P+=i*V,C+=i*$,_+=i*G,E+=i*Y,T+=i*K,k+=i*X,I+=i*J,i=e[10],m+=i*O,g+=i*L,y+=i*D,v+=i*N,S+=i*U,b+=i*W,w+=i*j,x+=i*q,P+=i*H,C+=i*V,_+=i*$,E+=i*G,T+=i*Y,k+=i*K,I+=i*X,M+=i*J,i=e[11],g+=i*O,y+=i*L,v+=i*D,S+=i*N,b+=i*U,w+=i*W,x+=i*j,P+=i*q,C+=i*H,_+=i*V,E+=i*$,T+=i*G,k+=i*Y,I+=i*K,M+=i*X,A+=i*J,i=e[12],y+=i*O,v+=i*L,S+=i*D,b+=i*N,w+=i*U,x+=i*W,P+=i*j,C+=i*q,_+=i*H,E+=i*V,T+=i*$,k+=i*G,I+=i*Y,M+=i*K,A+=i*X,F+=i*J,i=e[13],v+=i*O,S+=i*L,b+=i*D,w+=i*N,x+=i*U,P+=i*W,C+=i*j,_+=i*q,E+=i*H,T+=i*V,k+=i*$,I+=i*G,M+=i*Y,A+=i*K,F+=i*X,B+=i*J,i=e[14],S+=i*O,b+=i*L,w+=i*D,x+=i*N,P+=i*U,C+=i*W,_+=i*j,E+=i*q,T+=i*H,k+=i*V,I+=i*$,M+=i*G,A+=i*Y,F+=i*K,B+=i*X,R+=i*J,i=e[15],b+=i*O,s+=38*(x+=i*D),a+=38*(P+=i*N),l+=38*(C+=i*U),u+=38*(_+=i*W),c+=38*(E+=i*j),h+=38*(T+=i*q),p+=38*(k+=i*H),d+=38*(I+=i*V),f+=38*(M+=i*$),m+=38*(A+=i*G),g+=38*(F+=i*Y),y+=38*(B+=i*K),v+=38*(R+=i*X),S+=38*(z+=i*J),i=(o+=38*(w+=i*L))+(r=1)+65535,r=Math.floor(i/65536),o=i-65536*r,i=s+r+65535,r=Math.floor(i/65536),s=i-65536*r,i=a+r+65535,r=Math.floor(i/65536),a=i-65536*r,i=l+r+65535,r=Math.floor(i/65536),l=i-65536*r,i=u+r+65535,r=Math.floor(i/65536),u=i-65536*r,i=c+r+65535,r=Math.floor(i/65536),c=i-65536*r,i=h+r+65535,r=Math.floor(i/65536),h=i-65536*r,i=p+r+65535,r=Math.floor(i/65536),p=i-65536*r,i=d+r+65535,r=Math.floor(i/65536),d=i-65536*r,i=f+r+65535,r=Math.floor(i/65536),f=i-65536*r,i=m+r+65535,r=Math.floor(i/65536),m=i-65536*r,i=g+r+65535,r=Math.floor(i/65536),g=i-65536*r,i=y+r+65535,r=Math.floor(i/65536),y=i-65536*r,i=v+r+65535,r=Math.floor(i/65536),v=i-65536*r,i=S+r+65535,r=Math.floor(i/65536),S=i-65536*r,i=b+r+65535,r=Math.floor(i/65536),b=i-65536*r,i=(o+=r-1+37*(r-1))+(r=1)+65535,r=Math.floor(i/65536),o=i-65536*r,i=s+r+65535,r=Math.floor(i/65536),s=i-65536*r,i=a+r+65535,r=Math.floor(i/65536),a=i-65536*r,i=l+r+65535,r=Math.floor(i/65536),l=i-65536*r,i=u+r+65535,r=Math.floor(i/65536),u=i-65536*r,i=c+r+65535,r=Math.floor(i/65536),c=i-65536*r,i=h+r+65535,r=Math.floor(i/65536),h=i-65536*r,i=p+r+65535,r=Math.floor(i/65536),p=i-65536*r,i=d+r+65535,r=Math.floor(i/65536),d=i-65536*r,i=f+r+65535,r=Math.floor(i/65536),f=i-65536*r,i=m+r+65535,r=Math.floor(i/65536),m=i-65536*r,i=g+r+65535,r=Math.floor(i/65536),g=i-65536*r,i=y+r+65535,r=Math.floor(i/65536),y=i-65536*r,i=v+r+65535,r=Math.floor(i/65536),v=i-65536*r,i=S+r+65535,r=Math.floor(i/65536),S=i-65536*r,i=b+r+65535,r=Math.floor(i/65536),b=i-65536*r,o+=r-1+37*(r-1),t[0]=o,t[1]=s,t[2]=a,t[3]=l,t[4]=u,t[5]=c,t[6]=h,t[7]=p,t[8]=d,t[9]=f,t[10]=m,t[11]=g,t[12]=y,t[13]=v,t[14]=S,t[15]=b}function C(t,e){x(t,e,e)}function P(t,e){var i,r=n();for(i=0;i<16;i++)r[i]=e[i];for(i=253;i>=0;i--)C(r,r),2!==i&&4!==i&&x(r,r,e);for(i=0;i<16;i++)t[i]=r[i]}function O(t,e,i){var r,o,s=new Uint8Array(32),a=new Float64Array(80),l=n(),u=n(),c=n(),h=n(),p=n(),d=n();for(o=0;o<31;o++)s[o]=e[o];for(s[31]=127&e[31]|64,s[0]&=248,T(a,i),o=0;o<16;o++)u[o]=a[o],h[o]=l[o]=c[o]=0;for(l[0]=h[0]=1,o=254;o>=0;--o)r=s[o>>>3]>>>(7&o)&1,w(l,u,r),w(c,h,r),A(p,l,c),E(l,l,c),A(c,u,h),E(u,u,h),C(h,p),C(d,l),x(l,c,l),x(c,u,p),A(p,l,c),E(l,l,c),C(u,l),E(c,h,d),x(l,c,rt),A(l,l,h),x(c,c,l),x(l,h,d),x(h,u,a),C(u,p),w(l,u,r),w(c,h,r);for(o=0;o<16;o++)a[o+16]=l[o],a[o+32]=c[o],a[o+48]=u[o],a[o+64]=h[o];var f=a.subarray(32),m=a.subarray(16);return P(f,f),x(m,m,f),_(t,m),0}function M(t,e){return O(t,e,et)}function U(t,e){return a(e,32),M(t,e)}function L(t,e,n){var i=new Uint8Array(32);return O(i,n,e),c(t,tt,i,ct)}function N(t,e,n,i){for(var r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M=new Int32Array(16),A=new Int32Array(16),F=t[0],B=t[1],R=t[2],z=t[3],O=t[4],L=t[5],D=t[6],N=t[7],U=e[0],W=e[1],j=e[2],q=e[3],H=e[4],V=e[5],$=e[6],G=e[7],Y=0;i>=128;){for(x=0;x<16;x++)P=8*x+Y,M[x]=n[P+0]<<24|n[P+1]<<16|n[P+2]<<8|n[P+3],A[x]=n[P+4]<<24|n[P+5]<<16|n[P+6]<<8|n[P+7];for(x=0;x<80;x++)if(r=F,o=B,s=R,a=z,l=O,u=L,c=D,h=N,p=U,d=W,f=j,m=q,g=H,y=V,v=$,S=G,E=65535&(_=G),T=_>>>16,k=65535&(C=N),I=C>>>16,E+=65535&(_=(H>>>14|O<<18)^(H>>>18|O<<14)^(O>>>9|H<<23)),T+=_>>>16,k+=65535&(C=(O>>>14|H<<18)^(O>>>18|H<<14)^(H>>>9|O<<23)),I+=C>>>16,E+=65535&(_=H&V^~H&$),T+=_>>>16,k+=65535&(C=O&L^~O&D),I+=C>>>16,C=ft[2*x],_=ft[2*x+1],E+=65535&_,T+=_>>>16,k+=65535&C,I+=C>>>16,C=M[x%16],_=A[x%16],T+=_>>>16,k+=65535&C,I+=C>>>16,k+=(T+=(E+=65535&_)>>>16)>>>16,E=65535&(_=w=65535&E|T<<16),T=_>>>16,k=65535&(C=b=65535&k|(I+=k>>>16)<<16),I=C>>>16,E+=65535&(_=(U>>>28|F<<4)^(F>>>2|U<<30)^(F>>>7|U<<25)),T+=_>>>16,k+=65535&(C=(F>>>28|U<<4)^(U>>>2|F<<30)^(U>>>7|F<<25)),I+=C>>>16,T+=(_=U&W^U&j^W&j)>>>16,k+=65535&(C=F&B^F&R^B&R),I+=C>>>16,h=65535&(k+=(T+=(E+=65535&_)>>>16)>>>16)|(I+=k>>>16)<<16,S=65535&E|T<<16,E=65535&(_=m),T=_>>>16,k=65535&(C=a),I=C>>>16,T+=(_=w)>>>16,k+=65535&(C=b),I+=C>>>16,B=r,R=o,z=s,O=a=65535&(k+=(T+=(E+=65535&_)>>>16)>>>16)|(I+=k>>>16)<<16,L=l,D=u,N=c,F=h,W=p,j=d,q=f,H=m=65535&E|T<<16,V=g,$=y,G=v,U=S,x%16==15)for(P=0;P<16;P++)C=M[P],_=A[P],E=65535&_,T=_>>>16,k=65535&C,I=C>>>16,C=M[(P+9)%16],_=A[(P+9)%16],E+=65535&_,T+=_>>>16,k+=65535&C,I+=C>>>16,b=M[(P+1)%16],w=A[(P+1)%16],E+=65535&(_=(w>>>1|b<<31)^(w>>>8|b<<24)^(w>>>7|b<<25)),T+=_>>>16,k+=65535&(C=(b>>>1|w<<31)^(b>>>8|w<<24)^b>>>7),I+=C>>>16,b=M[(P+14)%16],w=A[(P+14)%16],T+=(_=(w>>>19|b<<13)^(b>>>29|w<<3)^(w>>>6|b<<26))>>>16,k+=65535&(C=(b>>>19|w<<13)^(w>>>29|b<<3)^b>>>6),I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,M[P]=65535&k|I<<16,A[P]=65535&E|T<<16;E=65535&(_=U),T=_>>>16,k=65535&(C=F),I=C>>>16,C=t[0],_=e[0],T+=_>>>16,k+=65535&C,I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,t[0]=F=65535&k|I<<16,e[0]=U=65535&E|T<<16,E=65535&(_=W),T=_>>>16,k=65535&(C=B),I=C>>>16,C=t[1],_=e[1],T+=_>>>16,k+=65535&C,I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,t[1]=B=65535&k|I<<16,e[1]=W=65535&E|T<<16,E=65535&(_=j),T=_>>>16,k=65535&(C=R),I=C>>>16,C=t[2],_=e[2],T+=_>>>16,k+=65535&C,I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,t[2]=R=65535&k|I<<16,e[2]=j=65535&E|T<<16,E=65535&(_=q),T=_>>>16,k=65535&(C=z),I=C>>>16,C=t[3],_=e[3],T+=_>>>16,k+=65535&C,I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,t[3]=z=65535&k|I<<16,e[3]=q=65535&E|T<<16,E=65535&(_=H),T=_>>>16,k=65535&(C=O),I=C>>>16,C=t[4],_=e[4],T+=_>>>16,k+=65535&C,I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,t[4]=O=65535&k|I<<16,e[4]=H=65535&E|T<<16,E=65535&(_=V),T=_>>>16,k=65535&(C=L),I=C>>>16,C=t[5],_=e[5],T+=_>>>16,k+=65535&C,I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,t[5]=L=65535&k|I<<16,e[5]=V=65535&E|T<<16,E=65535&(_=$),T=_>>>16,k=65535&(C=D),I=C>>>16,C=t[6],_=e[6],T+=_>>>16,k+=65535&C,I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,t[6]=D=65535&k|I<<16,e[6]=$=65535&E|T<<16,E=65535&(_=G),T=_>>>16,k=65535&(C=N),I=C>>>16,C=t[7],_=e[7],T+=_>>>16,k+=65535&C,I+=C>>>16,I+=(k+=(T+=(E+=65535&_)>>>16)>>>16)>>>16,t[7]=N=65535&k|I<<16,e[7]=G=65535&E|T<<16,Y+=128,i-=128}return i}function D(t,n,i){var r,o=new Int32Array(8),s=new Int32Array(8),a=new Uint8Array(256),l=i;for(o[0]=1779033703,o[1]=3144134277,o[2]=1013904242,o[3]=2773480762,o[4]=1359893119,o[5]=2600822924,o[6]=528734635,o[7]=1541459225,s[0]=4089235720,s[1]=2227873595,s[2]=4271175723,s[3]=1595750129,s[4]=2917565137,s[5]=725511199,s[6]=4215389547,s[7]=327033209,N(o,s,n,i),i%=128,r=0;r<i;r++)a[r]=n[l-i+r];for(a[i]=128,a[(i=256-128*(i<112?1:0))-9]=0,e(a,i-8,l/536870912|0,l<<3),N(o,s,a,i),r=0;r<8;r++)e(t,8*r,o[r],s[r]);return 0}function j(t,e){var i=n(),r=n(),o=n(),s=n(),a=n(),l=n(),u=n(),c=n(),h=n();E(i,t[1],t[0]),E(h,e[1],e[0]),x(i,i,h),A(r,t[0],t[1]),A(h,e[0],e[1]),x(r,r,h),x(o,t[3],e[3]),x(o,o,st),x(s,t[2],e[2]),A(s,s,s),E(a,r,i),E(l,s,o),A(u,s,o),A(c,r,i),x(t[0],a,l),x(t[1],c,u),x(t[2],u,l),x(t[3],a,c)}function Y(t,e,n){var i;for(i=0;i<4;i++)w(t[i],e[i],n)}function z(t,e){var i=n(),r=n(),o=n();P(o,e[2]),x(i,e[0],o),x(r,e[1],o),_(t,r),t[31]^=k(i)<<7}function H(t,e,n){var i,r;for(b(t[0],nt),b(t[1],it),b(t[2],it),b(t[3],nt),r=255;r>=0;--r)i=n[r/8|0]>>(7&r)&1,Y(t,e,i),j(e,t),j(t,t),Y(t,e,i)}function q(t,e){var i=[n(),n(),n(),n()];b(i[0],at),b(i[1],lt),b(i[2],it),x(i[3],at,lt),H(t,i,e)}function F(t,e,i){var r,o=new Uint8Array(64),s=[n(),n(),n(),n()];for(i||a(e,32),D(o,e,32),o[0]&=248,o[31]&=127,o[31]|=64,q(s,o),z(t,s),r=0;r<32;r++)e[r+32]=t[r];return 0}function J(t,e){var n,i,r,o;for(i=63;i>=32;--i){for(n=0,r=i-32,o=i-12;r<o;++r)e[r]+=n-16*e[i]*mt[r-(i-32)],n=e[r]+128>>8,e[r]-=256*n;e[r]+=n,e[i]=0}for(n=0,r=0;r<32;r++)e[r]+=n-(e[31]>>4)*mt[r],n=e[r]>>8,e[r]&=255;for(r=0;r<32;r++)e[r]-=n*mt[r];for(i=0;i<32;i++)e[i+1]+=e[i]>>8,t[i]=255&e[i]}function X(t){var e,n=new Float64Array(64);for(e=0;e<64;e++)n[e]=t[e];for(e=0;e<64;e++)t[e]=0;J(t,n)}function K(t,e,i,r){var o,s,a=new Uint8Array(64),l=new Uint8Array(64),u=new Uint8Array(64),c=new Float64Array(64),h=[n(),n(),n(),n()];D(a,r,32),a[0]&=248,a[31]&=127,a[31]|=64;var p=i+64;for(o=0;o<i;o++)t[64+o]=e[o];for(o=0;o<32;o++)t[32+o]=a[32+o];for(D(u,t.subarray(32),i+32),X(u),q(h,u),z(t,h),o=32;o<64;o++)t[o]=r[o];for(D(l,t,i+64),X(l),o=0;o<64;o++)c[o]=0;for(o=0;o<32;o++)c[o]=u[o];for(o=0;o<32;o++)for(s=0;s<32;s++)c[o+s]+=l[o]*a[s];return J(t.subarray(32),c),p}function G(t,e){var i=n(),r=n(),o=n(),s=n(),a=n(),l=n(),u=n();return b(t[2],it),T(t[1],e),C(o,t[1]),x(s,o,ot),E(o,o,t[2]),A(s,t[2],s),C(a,s),C(l,a),x(u,l,a),x(i,u,o),x(i,i,s),function R(t,e){var i,r=n();for(i=0;i<16;i++)r[i]=e[i];for(i=250;i>=0;i--)C(r,r),1!==i&&x(r,r,e);for(i=0;i<16;i++)t[i]=r[i]}(i,i),x(i,i,o),x(i,i,s),x(i,i,s),x(t[0],i,s),C(r,t[0]),x(r,r,s),S(r,o)&&x(t[0],t[0],ut),C(r,t[0]),x(r,r,s),S(r,o)?-1:(k(t[0])===e[31]>>7&&E(t[0],nt,t[0]),x(t[3],t[0],t[1]),0)}function W(t,e,i,r){var s,a=new Uint8Array(32),l=new Uint8Array(64),u=[n(),n(),n(),n()],c=[n(),n(),n(),n()];if(i<64)return-1;if(G(c,r))return-1;for(s=0;s<i;s++)t[s]=e[s];for(s=0;s<32;s++)t[s+32]=r[s];if(D(l,t,i),X(l),H(u,c,l),q(c,e.subarray(32)),j(u,c),z(a,u),i-=64,o(e,0,a,0)){for(s=0;s<i;s++)t[s]=0;return-1}for(s=0;s<i;s++)t[s]=e[s+64];return i}function V(t,e){if(t.length!==gt)throw new Error("bad key size");if(e.length!==yt)throw new Error("bad nonce size")}function Q(){for(var t=0;t<arguments.length;t++)if(!(arguments[t]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function $(t){for(var e=0;e<t.length;e++)t[e]=0}var n=function(t){var e,n=new Float64Array(16);if(t)for(e=0;e<t.length;e++)n[e]=t[e];return n},a=function(){throw new Error("no PRNG")},tt=new Uint8Array(16),et=new Uint8Array(32);et[0]=9;var nt=n(),it=n([1]),rt=n([56129,1]),ot=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),st=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),at=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),lt=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),ut=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]),ct=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]),ht=function(t){var e,n,i,r,o,s,a,l;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,e=255&t[0]|(255&t[1])<<8,this.r[0]=8191&e,n=255&t[2]|(255&t[3])<<8,this.r[1]=8191&(e>>>13|n<<3),i=255&t[4]|(255&t[5])<<8,this.r[2]=7939&(n>>>10|i<<6),r=255&t[6]|(255&t[7])<<8,this.r[3]=8191&(i>>>7|r<<9),o=255&t[8]|(255&t[9])<<8,this.r[4]=255&(r>>>4|o<<12),this.r[5]=o>>>1&8190,s=255&t[10]|(255&t[11])<<8,this.r[6]=8191&(o>>>14|s<<2),a=255&t[12]|(255&t[13])<<8,this.r[7]=8065&(s>>>11|a<<5),l=255&t[14]|(255&t[15])<<8,this.r[8]=8191&(a>>>8|l<<8),this.r[9]=l>>>5&127,this.pad[0]=255&t[16]|(255&t[17])<<8,this.pad[1]=255&t[18]|(255&t[19])<<8,this.pad[2]=255&t[20]|(255&t[21])<<8,this.pad[3]=255&t[22]|(255&t[23])<<8,this.pad[4]=255&t[24]|(255&t[25])<<8,this.pad[5]=255&t[26]|(255&t[27])<<8,this.pad[6]=255&t[28]|(255&t[29])<<8,this.pad[7]=255&t[30]|(255&t[31])<<8};ht.prototype.blocks=function(t,e,n){for(var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x=this.fin?0:2048,P=this.h[0],C=this.h[1],_=this.h[2],E=this.h[3],T=this.h[4],k=this.h[5],I=this.h[6],M=this.h[7],A=this.h[8],F=this.h[9],B=this.r[0],R=this.r[1],z=this.r[2],O=this.r[3],L=this.r[4],D=this.r[5],N=this.r[6],U=this.r[7],W=this.r[8],j=this.r[9];n>=16;)i=255&t[e+0]|(255&t[e+1])<<8,P+=8191&i,r=255&t[e+2]|(255&t[e+3])<<8,C+=8191&(i>>>13|r<<3),o=255&t[e+4]|(255&t[e+5])<<8,_+=8191&(r>>>10|o<<6),s=255&t[e+6]|(255&t[e+7])<<8,E+=8191&(o>>>7|s<<9),a=255&t[e+8]|(255&t[e+9])<<8,T+=8191&(s>>>4|a<<12),k+=a>>>1&8191,l=255&t[e+10]|(255&t[e+11])<<8,I+=8191&(a>>>14|l<<2),u=255&t[e+12]|(255&t[e+13])<<8,M+=8191&(l>>>11|u<<5),c=255&t[e+14]|(255&t[e+15])<<8,p=h=0,p+=P*B,p+=C*(5*j),p+=_*(5*W),p+=E*(5*U),h=(p+=T*(5*N))>>>13,p&=8191,p+=k*(5*D),p+=I*(5*L),p+=M*(5*O),p+=(A+=8191&(u>>>8|c<<8))*(5*z),d=h+=(p+=(F+=c>>>5|x)*(5*R))>>>13,d+=P*R,d+=C*B,d+=_*(5*j),d+=E*(5*W),h=(d+=T*(5*U))>>>13,d&=8191,d+=k*(5*N),d+=I*(5*D),d+=M*(5*L),d+=A*(5*O),h+=(d+=F*(5*z))>>>13,d&=8191,f=h,f+=P*z,f+=C*R,f+=_*B,f+=E*(5*j),h=(f+=T*(5*W))>>>13,f&=8191,f+=k*(5*U),f+=I*(5*N),f+=M*(5*D),f+=A*(5*L),m=h+=(f+=F*(5*O))>>>13,m+=P*O,m+=C*z,m+=_*R,m+=E*B,h=(m+=T*(5*j))>>>13,m&=8191,m+=k*(5*W),m+=I*(5*U),m+=M*(5*N),m+=A*(5*D),g=h+=(m+=F*(5*L))>>>13,g+=P*L,g+=C*O,g+=_*z,g+=E*R,h=(g+=T*B)>>>13,g&=8191,g+=k*(5*j),g+=I*(5*W),g+=M*(5*U),g+=A*(5*N),y=h+=(g+=F*(5*D))>>>13,y+=P*D,y+=C*L,y+=_*O,y+=E*z,h=(y+=T*R)>>>13,y&=8191,y+=k*B,y+=I*(5*j),y+=M*(5*W),y+=A*(5*U),v=h+=(y+=F*(5*N))>>>13,v+=P*N,v+=C*D,v+=_*L,v+=E*O,h=(v+=T*z)>>>13,v&=8191,v+=k*R,v+=I*B,v+=M*(5*j),v+=A*(5*W),S=h+=(v+=F*(5*U))>>>13,S+=P*U,S+=C*N,S+=_*D,S+=E*L,h=(S+=T*O)>>>13,S&=8191,S+=k*z,S+=I*R,S+=M*B,S+=A*(5*j),b=h+=(S+=F*(5*W))>>>13,b+=P*W,b+=C*U,b+=_*N,b+=E*D,h=(b+=T*L)>>>13,b&=8191,b+=k*O,b+=I*z,b+=M*R,b+=A*B,w=h+=(b+=F*(5*j))>>>13,w+=P*j,w+=C*W,w+=_*U,w+=E*N,h=(w+=T*D)>>>13,w&=8191,w+=k*L,w+=I*O,w+=M*z,w+=A*R,P=p=8191&(h=(h=((h+=(w+=F*B)>>>13)<<2)+h|0)+(p&=8191)|0),C=d+=h>>>=13,_=f&=8191,E=m&=8191,T=g&=8191,k=y&=8191,I=v&=8191,M=S&=8191,A=b&=8191,F=w&=8191,e+=16,n-=16;this.h[0]=P,this.h[1]=C,this.h[2]=_,this.h[3]=E,this.h[4]=T,this.h[5]=k,this.h[6]=I,this.h[7]=M,this.h[8]=A,this.h[9]=F},ht.prototype.finish=function(t,e){var n,i,r,o,s=new Uint16Array(10);if(this.leftover){for(o=this.leftover,this.buffer[o++]=1;o<16;o++)this.buffer[o]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(n=this.h[1]>>>13,this.h[1]&=8191,o=2;o<10;o++)this.h[o]+=n,n=this.h[o]>>>13,this.h[o]&=8191;for(this.h[0]+=5*n,n=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=n,n=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=n,s[0]=this.h[0]+5,n=s[0]>>>13,s[0]&=8191,o=1;o<10;o++)s[o]=this.h[o]+n,n=s[o]>>>13,s[o]&=8191;for(s[9]-=8192,i=(1^n)-1,o=0;o<10;o++)s[o]&=i;for(i=~i,o=0;o<10;o++)this.h[o]=this.h[o]&i|s[o];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),r=this.h[0]+this.pad[0],this.h[0]=65535&r,o=1;o<8;o++)r=(this.h[o]+this.pad[o]|0)+(r>>>16)|0,this.h[o]=65535&r;t[e+0]=this.h[0]>>>0&255,t[e+1]=this.h[0]>>>8&255,t[e+2]=this.h[1]>>>0&255,t[e+3]=this.h[1]>>>8&255,t[e+4]=this.h[2]>>>0&255,t[e+5]=this.h[2]>>>8&255,t[e+6]=this.h[3]>>>0&255,t[e+7]=this.h[3]>>>8&255,t[e+8]=this.h[4]>>>0&255,t[e+9]=this.h[4]>>>8&255,t[e+10]=this.h[5]>>>0&255,t[e+11]=this.h[5]>>>8&255,t[e+12]=this.h[6]>>>0&255,t[e+13]=this.h[6]>>>8&255,t[e+14]=this.h[7]>>>0&255,t[e+15]=this.h[7]>>>8&255},ht.prototype.update=function(t,e,n){var i,r;if(this.leftover){for((r=16-this.leftover)>n&&(r=n),i=0;i<r;i++)this.buffer[this.leftover+i]=t[e+i];if(n-=r,e+=r,this.leftover+=r,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(n>=16&&(r=n-n%16,this.blocks(t,e,r),e+=r,n-=r),n){for(i=0;i<n;i++)this.buffer[this.leftover+i]=t[e+i];this.leftover+=n}};var pt=g,dt=v,ft=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],mt=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),gt=32,yt=24,vt=32,St=32,bt=yt;t.lowlevel={crypto_core_hsalsa20:c,crypto_stream_xor:p,crypto_stream:l,crypto_stream_salsa20_xor:h,crypto_stream_salsa20:f,crypto_onetimeauth:d,crypto_onetimeauth_verify:y,crypto_verify_16:i,crypto_verify_32:o,crypto_secretbox:g,crypto_secretbox_open:v,crypto_scalarmult:O,crypto_scalarmult_base:M,crypto_box_beforenm:L,crypto_box_afternm:pt,crypto_box:function B(t,e,n,i,r,o){var s=new Uint8Array(32);return L(s,r,o),pt(t,e,n,i,s)},crypto_box_open:function I(t,e,n,i,r,o){var s=new Uint8Array(32);return L(s,r,o),dt(t,e,n,i,s)},crypto_box_keypair:U,crypto_hash:D,crypto_sign:K,crypto_sign_keypair:F,crypto_sign_open:W,crypto_secretbox_KEYBYTES:gt,crypto_secretbox_NONCEBYTES:yt,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:vt,crypto_box_SECRETKEYBYTES:St,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:bt,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64},t.randomBytes=function(t){var e=new Uint8Array(t);return a(e,t),e},t.secretbox=function(t,e,n){Q(t,e,n),V(n,e);for(var i=new Uint8Array(32+t.length),r=new Uint8Array(i.length),o=0;o<t.length;o++)i[o+32]=t[o];return g(r,i,i.length,e,n),r.subarray(16)},t.secretbox.open=function(t,e,n){Q(t,e,n),V(n,e);for(var i=new Uint8Array(16+t.length),r=new Uint8Array(i.length),o=0;o<t.length;o++)i[o+16]=t[o];return i.length<32?null:0!==v(r,i,i.length,e,n)?null:r.subarray(32)},t.secretbox.keyLength=gt,t.secretbox.nonceLength=yt,t.secretbox.overheadLength=16,t.scalarMult=function(t,e){if(Q(t,e),32!==t.length)throw new Error("bad n size");if(32!==e.length)throw new Error("bad p size");var n=new Uint8Array(32);return O(n,t,e),n},t.scalarMult.base=function(t){if(Q(t),32!==t.length)throw new Error("bad n size");var e=new Uint8Array(32);return M(e,t),e},t.scalarMult.scalarLength=32,t.scalarMult.groupElementLength=32,t.box=function(e,n,i,r){var o=t.box.before(i,r);return t.secretbox(e,n,o)},t.box.before=function(t,e){Q(t,e),function Z(t,e){if(t.length!==vt)throw new Error("bad public key size");if(e.length!==St)throw new Error("bad secret key size")}(t,e);var n=new Uint8Array(32);return L(n,t,e),n},t.box.after=t.secretbox,t.box.open=function(e,n,i,r){var o=t.box.before(i,r);return t.secretbox.open(e,n,o)},t.box.open.after=t.secretbox.open,t.box.keyPair=function(){var t=new Uint8Array(vt),e=new Uint8Array(St);return U(t,e),{publicKey:t,secretKey:e}},t.box.keyPair.fromSecretKey=function(t){if(Q(t),t.length!==St)throw new Error("bad secret key size");var e=new Uint8Array(vt);return M(e,t),{publicKey:e,secretKey:new Uint8Array(t)}},t.box.publicKeyLength=vt,t.box.secretKeyLength=St,t.box.sharedKeyLength=32,t.box.nonceLength=bt,t.box.overheadLength=t.secretbox.overheadLength,t.sign=function(t,e){if(Q(t,e),64!==e.length)throw new Error("bad secret key size");var n=new Uint8Array(64+t.length);return K(n,t,t.length,e),n},t.sign.open=function(t,e){if(Q(t,e),32!==e.length)throw new Error("bad public key size");var n=new Uint8Array(t.length),i=W(n,t,t.length,e);if(i<0)return null;for(var r=new Uint8Array(i),o=0;o<r.length;o++)r[o]=n[o];return r},t.sign.detached=function(e,n){for(var i=t.sign(e,n),r=new Uint8Array(64),o=0;o<r.length;o++)r[o]=i[o];return r},t.sign.detached.verify=function(t,e,n){if(Q(t,e,n),64!==e.length)throw new Error("bad signature size");if(32!==n.length)throw new Error("bad public key size");var i,r=new Uint8Array(64+t.length),o=new Uint8Array(64+t.length);for(i=0;i<64;i++)r[i]=e[i];for(i=0;i<t.length;i++)r[i+64]=t[i];return W(o,r,r.length,n)>=0},t.sign.keyPair=function(){var t=new Uint8Array(32),e=new Uint8Array(64);return F(t,e),{publicKey:t,secretKey:e}},t.sign.keyPair.fromSecretKey=function(t){if(Q(t),64!==t.length)throw new Error("bad secret key size");for(var e=new Uint8Array(32),n=0;n<e.length;n++)e[n]=t[32+n];return{publicKey:e,secretKey:new Uint8Array(t)}},t.sign.keyPair.fromSeed=function(t){if(Q(t),32!==t.length)throw new Error("bad seed size");for(var e=new Uint8Array(32),n=new Uint8Array(64),i=0;i<32;i++)n[i]=t[i];return F(e,n,!0),{publicKey:e,secretKey:n}},t.sign.publicKeyLength=32,t.sign.secretKeyLength=64,t.sign.seedLength=32,t.sign.signatureLength=64,t.hash=function(t){Q(t);var e=new Uint8Array(64);return D(e,t,t.length),e},t.hash.hashLength=64,t.verify=function(t,e){return Q(t,e),0!==t.length&&0!==e.length&&t.length===e.length&&0===r(t,0,e,0,t.length)},t.setPRNG=function(t){a=t},function(){var e="undefined"!=typeof self?self.crypto||self.msCrypto:null;e&&e.getRandomValues?t.setPRNG(function(t,n){var i,r=new Uint8Array(n);for(i=0;i<n;i+=65536)e.getRandomValues(r.subarray(i,i+Math.min(n-i,65536)));for(i=0;i<n;i++)t[i]=r[i];$(r)}):(e=s(56))&&e.randomBytes&&t.setPRNG(function(t,n){var i,r=e.randomBytes(n);for(i=0;i<n;i++)t[i]=r[i];$(r)})}()}(void 0!==t&&t.exports?t.exports:self.nacl=self.nacl||{})},function(t,e){},function(t,e,n){(function(e){!function(e,n){"use strict";void 0!==t&&t.exports?t.exports=n():e.nacl?e.nacl.util=n():(e.nacl={},e.nacl.util=n())}(this,function(){"use strict";function t(t){if(!/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(t))throw new TypeError("invalid encoding")}var n={decodeUTF8:function(t){if("string"!=typeof t)throw new TypeError("expected string");var e,n=unescape(encodeURIComponent(t)),i=new Uint8Array(n.length);for(e=0;e<n.length;e++)i[e]=n.charCodeAt(e);return i},encodeUTF8:function(t){var e,n=[];for(e=0;e<t.length;e++)n.push(String.fromCharCode(t[e]));return decodeURIComponent(escape(n.join("")))}};return"undefined"==typeof atob?void 0!==e.from?(n.encodeBase64=function(t){return e.from(t).toString("base64")},n.decodeBase64=function(n){return t(n),new Uint8Array(Array.prototype.slice.call(e.from(n,"base64"),0))}):(n.encodeBase64=function(t){return new e(t).toString("base64")},n.decodeBase64=function(n){return t(n),new Uint8Array(Array.prototype.slice.call(new e(n,"base64"),0))}):(n.encodeBase64=function(t){var e,n=[],i=t.length;for(e=0;e<i;e++)n.push(String.fromCharCode(t[e]));return btoa(n.join(""))},n.decodeBase64=function(e){t(e);var n,i=atob(e),r=new Uint8Array(i.length);for(n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return r}),n})}).call(e,n(58).Buffer)},function(t,e,n){"use strict";function i(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(i()<e)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=s.prototype:(null===t&&(t=new s(e)),t.length=e),t}function s(t,e,n){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return a(this,t,e,n)}function a(t,e,n,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function p(t,e,n,i){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,n):new Uint8Array(e,n,i),s.TYPED_ARRAY_SUPPORT?(t=e).__proto__=s.prototype:t=l(t,e),t}(t,e,n,i):"string"==typeof e?function f(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!s.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|v(e,n),r=(t=o(t,i)).write(e,n);return r!==i&&(t=t.slice(0,r)),t}(t,e,n):function d(t,e){if(s.isBuffer(e)){var n=0|y(e.length);return 0===(t=o(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function V(t){return t!=t}(e.length)?o(t,0):l(t,e);if("Buffer"===e.type&&Z(e.data))return l(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(u(e),t=o(t,e<0?0:0|y(e)),!s.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function l(t,e){var n=e.length<0?0:0|y(e.length);t=o(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function y(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function v(t,e){if(s.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return J(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(t).length;default:if(i)return J(t).length;e=(""+e).toLowerCase(),i=!0}}function m(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function w(t,e,n,i,r){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(r)return-1;n=t.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof e&&(e=s.from(e,i)),s.isBuffer(e))return 0===e.length?-1:_(t,e,n,i,r);if("number"==typeof e)return e&=255,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):_(t,[e],n,i,r);throw new TypeError("val must be string, number or Buffer")}function _(t,e,n,i,r){function o(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}var s,a=1,l=t.length,u=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;a=2,l/=2,u/=2,n/=2}if(r){var c=-1;for(s=n;s<l;s++)if(o(t,s)===o(e,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===u)return c*a}else-1!==c&&(s-=s-c),c=-1}else for(n+u>l&&(n=l-u),s=n;s>=0;s--){for(var h=!0,p=0;p<u;p++)if(o(t,s+p)!==o(e,p)){h=!1;break}if(h)return s}return-1}function S(t,e,n,i){n=Number(n)||0;var r=t.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function k(t,e,n,i){return W(J(e,t.length-n),t,n,i)}function T(t,e,n,i){return W(function X(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,i)}function A(t,e,n,i){return T(t,e,n,i)}function E(t,e,n,i){return W(G(e),t,n,i)}function x(t,e,n,i){return W(function K(t,e){for(var n,i,r,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(e,t.length-n),t,n,i)}function C(t,e,n){return 0===e&&n===t.length?$.fromByteArray(t):$.fromByteArray(t.slice(e,n))}function P(t,e,n){n=Math.min(t.length,n);for(var i=[],r=e;r<n;){var o,s,a,l,u=t[r],c=null,h=u>239?4:u>223?3:u>191?2:1;if(r+h<=n)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=t[r+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:o=t[r+1],s=t[r+2],128==(192&o)&&128==(192&s)&&(l=(15&u)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=t[r+1],s=t[r+2],a=t[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=h}return function R(t){var e=t.length;if(e<=tt)return String.fromCharCode.apply(String,t);for(var n="",i=0;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=tt));return n}(i)}function O(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(127&t[r]);return i}function M(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i}function U(t,e,n){var i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=e;o<n;++o)r+=F(t[o]);return r}function L(t,e,n){for(var i=t.slice(e,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function B(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function I(t,e,n,i,r,o){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function N(t,e,n,i){e<0&&(e=65535+e+1);for(var r=0,o=Math.min(t.length-n,2);r<o;++r)t[n+r]=(e&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function D(t,e,n,i){e<0&&(e=4294967295+e+1);for(var r=0,o=Math.min(t.length-n,4);r<o;++r)t[n+r]=e>>>8*(i?r:3-r)&255}function j(t,e,n,i,r,o){if(n+i>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Y(t,e,n,i,r){return r||j(t,0,n,4),Q.write(t,e,n,i,23,4),n+4}function z(t,e,n,i,r){return r||j(t,0,n,8),Q.write(t,e,n,i,52,8),n+8}function F(t){return t<16?"0"+t.toString(16):t.toString(16)}function J(t,e){e=e||1/0;for(var n,i=t.length,r=null,o=[],s=0;s<i;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(e-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(e-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(t){return $.toByteArray(function H(t){if((t=function q(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(et,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function W(t,e,n,i){for(var r=0;r<i&&!(r+n>=e.length||r>=t.length);++r)e[r+n]=t[r];return r}var $=n(59),Q=n(60),Z=n(61);e.Buffer=s,e.SlowBuffer=function g(t){return+t!=t&&(t=0),s.alloc(+t)},e.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==window.TYPED_ARRAY_SUPPORT?window.TYPED_ARRAY_SUPPORT:function r(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=i(),s.poolSize=8192,s._augment=function(t){return t.__proto__=s.prototype,t},s.from=function(t,e,n){return a(null,t,e,n)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(t,e,n){return function c(t,e,n,i){return u(e),e<=0?o(t,e):void 0!==n?"string"==typeof i?o(t,e).fill(n,i):o(t,e).fill(n):o(t,e)}(null,t,e,n)},s.allocUnsafe=function(t){return h(null,t)},s.allocUnsafeSlow=function(t){return h(null,t)},s.isBuffer=function(t){return!(null==t||!t._isBuffer)},s.compare=function(t,e){if(!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,i=e.length,r=0,o=Math.min(n,i);r<o;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Z(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var i=s.allocUnsafe(e),r=0;for(n=0;n<t.length;++n){var o=t[n];if(!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},s.byteLength=v,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)m(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},s.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?P(this,0,t):function b(t,e,n){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return U(this,e,n);case"utf8":case"utf-8":return P(this,e,n);case"ascii":return O(this,e,n);case"latin1":case"binary":return M(this,e,n);case"base64":return C(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,e,n);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},s.prototype.compare=function(t,e,n,i,r){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||n>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&e>=n)return 0;if(i>=r)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,i>>>=0,r>>>=0,this===t)return 0;for(var o=r-i,a=n-e,l=Math.min(o,a),u=this.slice(i,r),c=t.slice(e,n),h=0;h<l;++h)if(u[h]!==c[h]){o=u[h],a=c[h];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},s.prototype.indexOf=function(t,e,n){return w(this,t,e,n,!0)},s.prototype.lastIndexOf=function(t,e,n){return w(this,t,e,n,!1)},s.prototype.write=function(t,e,n,i){if(void 0===e)i="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)i=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-e;if((void 0===n||n>r)&&(n=r),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return S(this,t,e,n);case"utf8":case"utf-8":return k(this,t,e,n);case"ascii":return T(this,t,e,n);case"latin1":case"binary":return A(this,t,e,n);case"base64":return E(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tt=4096;s.prototype.slice=function(t,e){var n,i=this.length;if(t=~~t,e=void 0===e?i:~~e,t<0?(t+=i)<0&&(t=0):t>i&&(t=i),e<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),s.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=s.prototype;else{var r=e-t;n=new s(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+t]}return n},s.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i},s.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var i=this[t+--e],r=1;e>0&&(r*=256);)i+=this[t+--e]*r;return i},s.prototype.readUInt8=function(t,e){return e||B(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return e||B(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return e||B(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*e)),i},s.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var i=e,r=1,o=this[t+--i];i>0&&(r*=256);)o+=this[t+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*e)),o},s.prototype.readInt8=function(t,e){return e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){e||B(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(t,e){e||B(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(t,e){return e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return e||B(t,4,this.length),Q.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return e||B(t,4,this.length),Q.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return e||B(t,8,this.length),Q.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return e||B(t,8,this.length),Q.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,n,i){if(t=+t,e|=0,n|=0,!i){var r=Math.pow(2,8*n)-1;I(this,t,e,n,r,0)}var o=1,s=0;for(this[e]=255&t;++s<n&&(o*=256);)this[e+s]=t/o&255;return e+n},s.prototype.writeUIntBE=function(t,e,n,i){if(t=+t,e|=0,n|=0,!i){var r=Math.pow(2,8*n)-1;I(this,t,e,n,r,0)}var o=n-1,s=1;for(this[e+o]=255&t;--o>=0&&(s*=256);)this[e+o]=t/s&255;return e+n},s.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,255,0),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},s.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},s.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):D(this,t,e,!0),e+4},s.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},s.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);I(this,t,e,n,r-1,-r)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},s.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);I(this,t,e,n,r-1,-r)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},s.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,127,-128),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},s.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},s.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):D(this,t,e,!0),e+4},s.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},s.prototype.writeFloatLE=function(t,e,n){return Y(this,t,e,!0,n)},s.prototype.writeFloatBE=function(t,e,n){return Y(this,t,e,!1,n)},s.prototype.writeDoubleLE=function(t,e,n){return z(this,t,e,!0,n)},s.prototype.writeDoubleBE=function(t,e,n){return z(this,t,e,!1,n)},s.prototype.copy=function(t,e,n,i){if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var r,o=i-n;if(this===t&&n<e&&e<i)for(r=o-1;r>=0;--r)t[r+e]=this[r+n];else if(o<1e3||!s.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)t[r+e]=this[r+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},s.prototype.fill=function(t,e,n,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!s.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var a=s.isBuffer(t)?t:J(new s(t,i).toString()),l=a.length;for(o=0;o<n-e;++o)this[o+e]=a[o%l]}return this};var et=/[^+\/0-9A-Za-z-_]/g},function(t,e){"use strict";function n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");-1===n&&(n=e);var i=n===e?0:4-n%4;return[n,i]}function s(t){return l[t>>18&63]+l[t>>12&63]+l[t>>6&63]+l[63&t]}function a(t,e,n){for(var i,r=[],o=e;o<n;o+=3)i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),r.push(s(i));return r.join("")}e.byteLength=function r(t){var e=n(t),i=e[0],r=e[1];return 3*(i+r)/4-r},e.toByteArray=function o(t){for(var e,r=n(t),o=r[0],s=r[1],a=new h(function i(t,e,n){return 3*(e+n)/4-n}(0,o,s)),l=0,u=s>0?o-4:o,p=0;p<u;p+=4)e=c[t.charCodeAt(p)]<<18|c[t.charCodeAt(p+1)]<<12|c[t.charCodeAt(p+2)]<<6|c[t.charCodeAt(p+3)],a[l++]=e>>16&255,a[l++]=e>>8&255,a[l++]=255&e;return 2===s&&(e=c[t.charCodeAt(p)]<<2|c[t.charCodeAt(p+1)]>>4,a[l++]=255&e),1===s&&(e=c[t.charCodeAt(p)]<<10|c[t.charCodeAt(p+1)]<<4|c[t.charCodeAt(p+2)]>>2,a[l++]=e>>8&255,a[l++]=255&e),a},e.fromByteArray=function u(t){for(var e,n=t.length,i=n%3,r=[],o=16383,s=0,u=n-i;s<u;s+=o)r.push(a(t,s,s+o>u?u:s+o));return 1===i?(e=t[n-1],r.push(l[e>>2]+l[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],r.push(l[e>>10]+l[e>>4&63]+l[e<<2&63]+"=")),r.join("")};for(var l=[],c=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,f=p.length;d<f;++d)l[d]=p[d],c[p.charCodeAt(d)]=d;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,u=l>>1,c=-7,h=n?r-1:0,p=n?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-c)-1,d>>=-c,c+=a;c>0;o=256*o+t[e+h],h+=p,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=i;c>0;s=256*s+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,i),o-=u}return(d?-1:1)*s*Math.pow(2,o-i)},e.write=function(t,e,n,i,r,o){var s,a,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,f=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[n+d]=255&a,d+=f,a/=256,r-=8);for(s=s<<r|a,u+=r;u>0;t[n+d]=255&s,d+=f,s/=256,u-=8);t[n+d-f]|=128*m}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,n,i){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=i(24),s=i(12),a=i(8),l=i(9),u=i(2),c=function(t){function e(e,n){var i=this;t.call(this),this.key=e,this.options=n||{},this.state="initialized",this.connection=null,this.usingTLS=!!n.useTLS,this.timeline=this.options.timeline,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var r=u.default.getNetwork();r.bind("online",function(){i.timeline.info({netinfo:"online"}),"connecting"!==i.state&&"unavailable"!==i.state||i.retryIn(0)}),r.bind("offline",function(){i.timeline.info({netinfo:"offline"}),i.connection&&i.sendActivityCheck()}),this.updateStrategy()}return r(e,t),e.prototype.connect=function(){if(!this.connection&&!this.runner){if(!this.strategy.isSupported())return void this.updateState("failed");this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}},e.prototype.send=function(t){return!!this.connection&&this.connection.send(t)},e.prototype.send_event=function(t,e,n){return!!this.connection&&this.connection.send_event(t,e,n)},e.prototype.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},e.prototype.isUsingTLS=function(){return this.usingTLS},e.prototype.startConnecting=function(){var t=this,e=function(n,i){n?t.runner=t.strategy.connect(0,e):"error"===i.action?(t.emit("error",{type:"HandshakeError",error:i.error}),t.timeline.error({handshakeError:i.error})):(t.abortConnecting(),t.handshakeCallbacks[i.action](i))};this.runner=this.strategy.connect(0,e)},e.prototype.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},e.prototype.disconnectInternally=function(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var t=this.abandonConnection();t.close()}},e.prototype.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})},e.prototype.retryIn=function(t){var e=this;this.timeline.info({action:"retry",delay:t}),t>0&&this.emit("connecting_in",Math.round(t/1e3)),this.retryTimer=new s.OneOffTimer(t||0,function(){e.disconnectInternally(),e.connect()})},e.prototype.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},e.prototype.setUnavailableTimer=function(){var t=this;this.unavailableTimer=new s.OneOffTimer(this.options.unavailableTimeout,function(){t.updateState("unavailable")})},e.prototype.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},e.prototype.sendActivityCheck=function(){var t=this;this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new s.OneOffTimer(this.options.pongTimeout,function(){t.timeline.error({pong_timed_out:t.options.pongTimeout}),t.retryIn(0)})},e.prototype.resetActivityCheck=function(){var t=this;this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new s.OneOffTimer(this.activityTimeout,function(){t.sendActivityCheck()}))},e.prototype.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},e.prototype.buildConnectionCallbacks=function(t){var e=this;return l.extend({},t,{message:function(t){e.resetActivityCheck(),e.emit("message",t)},ping:function(){e.send_event("pusher:pong",{})},activity:function(){e.resetActivityCheck()},error:function(t){e.emit("error",{type:"WebSocketError",error:t})},closed:function(){e.abandonConnection(),e.shouldRetry()&&e.retryIn(1e3)}})},e.prototype.buildHandshakeCallbacks=function(t){var e=this;return l.extend({},t,{connected:function(t){e.activityTimeout=Math.min(e.options.activityTimeout,t.activityTimeout,t.connection.activityTimeout||1/0),e.clearUnavailableTimer(),e.setConnection(t.connection),e.socket_id=e.connection.id,e.updateState("connected",{socket_id:e.socket_id})}})},e.prototype.buildErrorCallbacks=function(){var t=this,e=function(e){return function(n){n.error&&t.emit("error",{type:"WebSocketError",error:n.error}),e(n)}};return{tls_only:e(function(){t.usingTLS=!0,t.updateStrategy(),t.retryIn(0)}),refused:e(function(){t.disconnect()}),backoff:e(function(){t.retryIn(1e3)}),retry:e(function(){t.retryIn(0)})}},e.prototype.setConnection=function(t){for(var e in this.connection=t,this.connectionCallbacks)this.connection.bind(e,this.connectionCallbacks[e]);this.resetActivityCheck()},e.prototype.abandonConnection=function(){if(this.connection){for(var t in this.stopActivityCheck(),this.connectionCallbacks)this.connection.unbind(t,this.connectionCallbacks[t]);var e=this.connection;return this.connection=null,e}},e.prototype.updateState=function(t,e){var n=this.state;if(this.state=t,n!==t){var i=t;"connected"===i&&(i+=" with new socket ID "+e.socket_id),a.default.debug("State changed",n+" -> "+i),this.timeline.info({state:t,params:e}),this.emit("state_change",{previous:n,current:t}),this.emit(t,e)}},e.prototype.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},e}(o.default);n.__esModule=!0,n.default=c},function(e,n,i){"use strict";var o=i(9),s=i(43),a=i(31),l=function(){function t(){this.channels={}}return t.prototype.add=function(t,e){return this.channels[t]||(this.channels[t]=function r(t,e){if(0===t.indexOf("private-encrypted-")){if("ReactNative"==navigator.product)throw new a.UnsupportedFeature("Encrypted channels are not yet supported when using React Native builds.");return s.default.createEncryptedChannel(t,e)}return 0===t.indexOf("private-")?s.default.createPrivateChannel(t,e):0===t.indexOf("presence-")?s.default.createPresenceChannel(t,e):s.default.createChannel(t,e)}(t,e)),this.channels[t]},t.prototype.all=function(){return o.values(this.channels)},t.prototype.find=function(t){return this.channels[t]},t.prototype.remove=function(t){var e=this.channels[t];return delete this.channels[t],e},t.prototype.disconnect=function(){o.objectApply(this.channels,function(t){t.disconnect()})},t}();n.__esModule=!0,n.default=l},function(e,n,i){"use strict";function r(t,e){return s.default.defer(function(){e(t)}),{abort:function(){},forceMinPriority:function(){}}}var o=i(43),s=i(11),a=i(31),l=i(9),u=function(){function t(t,e,n,i){this.name=t,this.priority=e,this.transport=n,this.options=i||{}}return t.prototype.isSupported=function(){return this.transport.isSupported({useTLS:this.options.useTLS})},t.prototype.connect=function(t,e){var n=this;if(!this.isSupported())return r(new a.UnsupportedStrategy,e);if(this.priority<t)return r(new a.TransportPriorityTooLow,e);var i=!1,s=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),u=null,c=function(){s.unbind("initialized",c),s.connect()},h=function(){u=o.default.createHandshake(s,function(t){i=!0,f(),e(null,t)})},p=function(t){f(),e(t)},d=function(){var t;f(),t=l.safeJSONStringify(s),e(new a.TransportClosed(t))},f=function(){s.unbind("initialized",c),s.unbind("open",h),s.unbind("error",p),s.unbind("closed",d)};return s.bind("initialized",c),s.bind("open",h),s.bind("error",p),s.bind("closed",d),s.initialize(),{abort:function(){i||(f(),u?u.close():s.close())},forceMinPriority:function(t){i||n.priority<t&&(u?u.close():s.close())}}},t}();n.__esModule=!0,n.default=u},function(e,n,i){"use strict";var r=i(9),o=i(11),s=i(12),a=function(){function t(t,e){this.strategies=t,this.loop=Boolean(e.loop),this.failFast=Boolean(e.failFast),this.timeout=e.timeout,this.timeoutLimit=e.timeoutLimit}return t.prototype.isSupported=function(){return r.any(this.strategies,o.default.method("isSupported"))},t.prototype.connect=function(t,e){var n=this,i=this.strategies,r=0,o=this.timeout,s=null,a=function(l,u){u?e(null,u):(r+=1,n.loop&&(r%=i.length),r<i.length?(o&&(o*=2,n.timeoutLimit&&(o=Math.min(o,n.timeoutLimit))),s=n.tryStrategy(i[r],t,{timeout:o,failFast:n.failFast},a)):e(!0))};return s=this.tryStrategy(i[r],t,{timeout:o,failFast:this.failFast},a),{abort:function(){s.abort()},forceMinPriority:function(e){t=e,s&&s.forceMinPriority(e)}}},t.prototype.tryStrategy=function(t,e,n,i){var r=null,o=null;return n.timeout>0&&(r=new s.OneOffTimer(n.timeout,function(){o.abort(),i(!0)})),o=t.connect(e,function(t,e){t&&r&&r.isRunning()&&!n.failFast||(r&&r.ensureAborted(),i(t,e))}),{abort:function(){r&&r.ensureAborted(),o.abort()},forceMinPriority:function(t){o.forceMinPriority(t)}}},t}();n.__esModule=!0,n.default=a},function(e,n,s){"use strict";function o(t){t.error||t.aborted||(t.abort(),t.aborted=!0)}var a=s(9),l=s(11),u=function(){function t(t){this.strategies=t}return t.prototype.isSupported=function(){return a.any(this.strategies,l.default.method("isSupported"))},t.prototype.connect=function(t,e){return function r(t,e,n){var i=a.map(t,function(t,i,r,o){return t.connect(e,n(i,o))});return{abort:function(){a.apply(i,o)},forceMinPriority:function(t){a.apply(i,function(e){e.forceMinPriority(t)})}}}(this.strategies,t,function(t,n){return function(r,o){return n[t].error=r,r?void(function i(t){return a.all(t,function(t){return Boolean(t.error)})}(n)&&e(!0)):(a.apply(n,function(t){t.forceMinPriority(o.transport.priority)}),void e(null,o))}})},t}();n.__esModule=!0,n.default=u},function(e,n,a){"use strict";function r(t){return"pusherTransport"+(t?"TLS":"NonTLS")}function i(t){var e=u.default.getLocalStorage();if(e)try{var n=e[r(t)];if(n)return JSON.parse(n)}catch(e){s(t)}return null}function o(t,e,n){var i=u.default.getLocalStorage();if(i)try{i[r(t)]=h.safeJSONStringify({timestamp:l.default.now(),transport:e,latency:n})}catch(t){}}function s(t){var e=u.default.getLocalStorage();if(e)try{delete e[r(t)]}catch(t){}}var l=a(11),u=a(2),c=a(65),h=a(9),p=function(){function t(t,e,n){this.strategy=t,this.transports=e,this.ttl=n.ttl||18e5,this.usingTLS=n.useTLS,this.timeline=n.timeline}return t.prototype.isSupported=function(){return this.strategy.isSupported()},t.prototype.connect=function(t,e){var n=this.usingTLS,a=i(n),u=[this.strategy];if(a&&a.timestamp+this.ttl>=l.default.now()){var h=this.transports[a.transport];h&&(this.timeline.info({cached:!0,transport:a.transport,latency:a.latency}),u.push(new c.default([h],{timeout:2*a.latency+1e3,failFast:!0})))}var p=l.default.now(),d=u.pop().connect(t,function r(i,a){i?(s(n),u.length>0?(p=l.default.now(),d=u.pop().connect(t,r)):e(i)):(o(n,a.transport.name,l.default.now()-p),e(null,a))});return{abort:function(){d.abort()},forceMinPriority:function(e){t=e,d&&d.forceMinPriority(e)}}},t}();n.__esModule=!0,n.default=p},function(e,n,i){"use strict";var r=i(12),o=function(){function t(t,e){var n=e.delay;this.strategy=t,this.options={delay:n}}return t.prototype.isSupported=function(){return this.strategy.isSupported()},t.prototype.connect=function(t,e){var n,i=this.strategy,o=new r.OneOffTimer(this.options.delay,function(){n=i.connect(t,e)});return{abort:function(){o.ensureAborted(),n&&n.abort()},forceMinPriority:function(e){t=e,n&&n.forceMinPriority(e)}}},t}();n.__esModule=!0,n.default=o},function(t,e){"use strict";var n=function(){function t(t,e,n){this.test=t,this.trueBranch=e,this.falseBranch=n}return t.prototype.isSupported=function(){var t=this.test()?this.trueBranch:this.falseBranch;return t.isSupported()},t.prototype.connect=function(t,e){var n=this.test()?this.trueBranch:this.falseBranch;return n.connect(t,e)},t}();e.__esModule=!0,e.default=n},function(t,e){"use strict";var n=function(){function t(t){this.strategy=t}return t.prototype.isSupported=function(){return this.strategy.isSupported()},t.prototype.connect=function(t,e){var n=this.strategy.connect(t,function(t,i){i&&n.abort(),e(t,i)});return n},t}();e.__esModule=!0,e.default=n},function(t,e,n){"use strict";var i=n(5);e.getGlobalConfig=function(){return{wsHost:i.default.host,wsPort:i.default.ws_port,wssPort:i.default.wss_port,wsPath:i.default.ws_path,httpHost:i.default.sockjs_host,httpPort:i.default.sockjs_http_port,httpsPort:i.default.sockjs_https_port,httpPath:i.default.sockjs_path,statsHost:i.default.stats_host,authEndpoint:i.default.channel_auth_endpoint,authTransport:i.default.channel_auth_transport,activity_timeout:i.default.activity_timeout,pong_timeout:i.default.pong_timeout,unavailable_timeout:i.default.unavailable_timeout}},e.getClusterConfig=function(t){return{wsHost:"ws-"+t+".pusher.com",httpHost:"sockjs-"+t+".pusher.com"}}}])},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{return e.console.log("Imikimi Zo, Copyright 2019 Imikimi LLC"),i.importInvoke(["Promise","isWebSpiderRegExp","getAgent","console","models","document","simpleBrowserInfo","assetUrl","timeout","interval","secondsPer","log","Icons","merge"],[e,n(268)],(t,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{let y,v,S,b,w;return n(646),n(1238),(v=(y=function(){let t;return i.exists(t=r.exec(o()))&&t[0]})())?t.then(function(){return n(106).configure()}).then(function(){return s.warn(`Webcrawler ${i.toString(v)} detected; not starting the full app.`),a.event.create(`client:webbot:${i.toString(v)}`,{data:{agent:o(),location:l.location.href}})}).then(function(){return a.event.disableEvents()}).catch(function(t){return s.error(t)}):(n(1239),S=0,b={version:n(272).version,userAgent:e.navigator.userAgent},w=function(){let t,e;return({os:t,nativeApp:e}=u),a.event.create("client:active:",{data:b}),a.event.create(`client:active:${i.toString(t)}:${i.toString(e?"app":"browser")}`,{data:b})},n(776).init().then(function(){return n(1243).initArtSuiteClient({onConfig:t=>(a.event.create("client:preloaded",{data:b}),h(0,w),p(1e3*d.hour,w)),noDocumentWrite:!0,title:"Zo - Adventures, Stories, Passions and Creations",backgroundColor:"white",fonts:{icomoon:{loadedTestText:"|",css:"loading"===l.readyState&&c("icomoon/style.css"),timeout:1e4,onTimeout:()=>(f.warn("Icons.setFontFailedToLoad"),m.setFontFailedToLoad())}},link:{"apple-touch-icon":{href:"assets/zo_icon_512.png"}},MainComponent:n(1021).App})}).then(function(){return e.zoClientLoaded=!0,n(776).postInit(),h(1e3,()=>1===++S?a.event.create("client:loaded",{data:b}):a.event.create("client:loadedMultipleTimes",{data:g(b,{clientLoadedCount:S})}))}))})})}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>{let t,e;return n(269).namespace.StandardImport=n(307).mergeWithSelf(n(538),n(160).Browser,n(160).Browser.Dom,n(596),n(606),n(633),(({zoPickImage:t}=n(634)),{zoPickImage:t}),(({zoUploadImage:e}=n(645)),{zoUploadImage:e}),n(590).membership,{membership:n(590).membership,ClientLib:n(633)})})}).call(this,n(2)(t))},function(t,e,n){t.exports=n(270).addNamespace("Client",class Client extends Neptune.PackageNamespace{}),n(283),n(301),n(302),n(303)},function(t,e,n){t.exports=n(271).addNamespace("Oz",class Oz extends Neptune.PackageNamespace{}._configureNamespace(n(272))),n(273),n(274),n(275),n(276),n(277)},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Imikimi"),n(270)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","bugs":"https:/github.com/imikimi/imikimi-zo/issues","dependencies":{"art-build-configurator":"*","art-ery-aws":"git://github.com/imikimi/art-aws.git","art-suite":"git://github.com/imikimi/art-suite","art-suite-app":"git://github.com/imikimi/art-suite-app","copy-to-clipboard":"^3.2.0","exif-parser":"^0.1.9","imikimi-auth":"git://github.com/imikimi/imikimi-auth","imikimi-style":"git://github.com/imikimi/imikimi-style","stripe":"^4.22.0"},"devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","coffee-loader":"^0.7.3","css-loader":"^3.0.0","json-loader":"^0.5.7","mocha":"^6.2.0","mock-fs":"^4.10.0","script-loader":"^0.7.2","style-loader":"^1.0.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"homepage":"https://github.com/imikimi/imikimi-zo","license":"none","name":"imikimi-zo","repository":{"type":"git","url":"https://github.com/imikimi/imikimi-zo.git"},"scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server --progress --history-api-fallback","testServer":"artConfigName=Test caf ./Server"},"version":"2.29.3"}')},function(t,e,n){t.exports=n(270).addNamespace("Configs",class Configs extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(270).addNamespace("Data",class Data extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(270).addNamespace("Lib",class Lib extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(270).addNamespace("LibBasics",class LibBasics extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(270).addNamespace("Pipelines",class Pipelines extends Neptune.PackageNamespace{}),n(278),n(279),n(280),n(281),n(282)},function(t,e,n){t.exports=n(277).addNamespace("Analytics",class Analytics extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(277).addNamespace("Auth",class Auth extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(277).addNamespace("DynamoDb",class DynamoDb extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(277).addNamespace("Filters",class Filters extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(277).addNamespace("Stripe",class Stripe extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(269).addNamespace("Components",class Components extends Neptune.PackageNamespace{}),n(284),n(285),n(290),n(295),n(298)},function(t,e,n){t.exports=n(283).addNamespace("Auth",class Auth extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(283).addNamespace("Overlays",class Overlays extends Neptune.PackageNamespace{}),n(286),n(287),n(288),n(289)},function(t,e,n){t.exports=n(285).addNamespace("ProfileSettingsPartials",class ProfileSettingsPartials extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(285).addNamespace("SocialActivityPartials",class SocialActivityPartials extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(285).addNamespace("StreamSettingsPartials",class StreamSettingsPartials extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(285).addNamespace("SubscriptionPartials",class SubscriptionPartials extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(283).addNamespace("Pages",class Pages extends Neptune.PackageNamespace{}),n(291),n(292),n(294)},function(t,e,n){t.exports=n(290).addNamespace("FullscreenPostPartials",class FullscreenPostPartials extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(290).addNamespace("PosterTextPartials",class PosterTextPartials extends Neptune.PackageNamespace{}),n(293)},function(t,e,n){t.exports=n(292).addNamespace("PosterTextToolbars",class PosterTextToolbars extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(290).addNamespace("SearchPartials",class SearchPartials extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(283).addNamespace("Partials",class Partials extends Neptune.PackageNamespace{}),n(296),n(297)},function(t,e,n){t.exports=n(295).addNamespace("PostPartials",class PostPartials extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(295).addNamespace("SearchPartials",class SearchPartials extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(283).addNamespace("Widgets",class Widgets extends Neptune.PackageNamespace{}),n(299),n(300)},function(t,e,n){t.exports=n(298).addNamespace("BasicMenuWidgets",class BasicMenuWidgets extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(298).addNamespace("ZoSpecificMenuWidgets",class ZoSpecificMenuWidgets extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(269).addNamespace("CustomElements",class CustomElements extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(269).addNamespace("MainThreadLib",class MainThreadLib extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(269).addNamespace("Models",class Models extends Neptune.PackageNamespace{}),n(304),n(305),n(306)},function(t,e,n){t.exports=n(303).addNamespace("AppState",class AppState extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(303).addNamespace("Auth",class Auth extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(303).addNamespace("Cordova",class Cordova extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(308)},function(t,e,n){(t.exports=n(309)).includeInNamespace(n(311)).addModules({Core:n(312)})},function(t,e,n){t.exports=n(18).addNamespace("Art.Suite",class Suite extends Neptune.PackageNamespace{}._configureNamespace(n(310)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","bugs":"https:/github.com/art-suite/art-suite/issues","dependencies":{"art-atomic":"*","art-browser-tools":"*","art-build-configurator":"*","art-canvas":"git://github.com/imikimi/art-canvas.git","art-engine":"*","art-ery":"*","art-events":"*","art-flux":"*","art-react":"*","art-text":"git://github.com/imikimi/art-text.git","art-validation":"*","art-xbd":"git://github.com/imikimi/art-xbd.git"},"description":"All the Art.* Packages you need for writing Apps in one require.","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","coffee-loader":"^0.7.3","css-loader":"^3.0.0","json-loader":"^0.5.7","mocha":"^6.2.0","mock-fs":"^4.10.0","script-loader":"^0.7.2","style-loader":"^1.0.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"homepage":"https://github.com/art-suite/art-suite","license":"ISC","name":"art-suite","repository":{"type":"git","url":"https://github.com/art-suite/art-suite.git"},"script":{"testInBrowser":"webpack-dev-server --progress"},"scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"1.9.4"}')},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c;if(l=(u=n(42)).merge,u.isNode)throw new Error("For Node, use: art-suite/Node");t.exports=c=l(n(312),i=n(325),r=n(341),a=n(484),s=n(506),o=n(527),n(533),{Canvas:i,Engine:r,React:a,Flux:s,EryFlux:o},{initArtSuiteApp:a.initArtReactApp},n(106)),e.artSuite=c,c.getEnv().dev&&(e.log=c.log,e.formattedInspect=c.formattedInspect)}).call(this,n(5))},function(t,e,n){var i,r,o,s,a,l,u,c;c=n(42).merge,t.exports=c(null,a=n(160),n(96),i=n(313),s=n(134),o=n(141),l=n(197),u=n(42),r=n(167),{Foundation:a,StandardLib:u,Atomic:i,Ery:s,CommunicationStatus:o,RestClient:l,Binary:r},n(106))},function(t,e,n){t.exports=n(314)},function(t,e,n){t.exports=n(315)},function(t,e,n){(t.exports=n(316)).includeInNamespace(n(318)).addModules({Base:n(320),Color:n(319),Matrix:n(323),Perimeter:n(324),Point:n(321),Rectangle:n(322)})},function(t,e,n){t.exports=n(18).addNamespace("Art.Atomic",class Atomic extends Neptune.PackageNamespace{}._configureNamespace(n(317)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","bugs":"https:/github.com/art-suite/art-atomic/issues","dependencies":{"art-build-configurator":"*"},"description":"atomic data-types such as Color, Point, Rectangle and Matrix","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","coffee-loader":"^0.7.3","css-loader":"^3.0.0","json-loader":"^0.5.7","mocha":"^6.2.0","mock-fs":"^4.10.0","script-loader":"^0.7.2","style-loader":"^1.0.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"homepage":"https://github.com/art-suite/art-atomic","license":"ISC","name":"art-atomic","repository":{"type":"git","url":"https://github.com/art-suite/art-atomic.git"},"scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"1.27.6"}')},function(t,e,n){var i,r,o,s,a,l,u;i=n(319),s=n(321),a=n(322),r=n(323),o=n(324),u=n(42).compactFlatten,t.exports=[u([i,"isColor","rgbColor","newColor","color","hslColor","rgb256Color","colorNames","colorNamesMap","hsl2Rgb","isColorOrColorString"]),u([a,"isRect","rect","nothing","everything"]),u([r,"isMatrix","matrix","identityMatrix"]),u([o,"isPerimeter","perimeter","perimeter0"]),u([s,"isPoint","point","pointWithAspectRatioAndArea",Object.keys(s.namedPoints)]),{package:l=n(317),version:l.version}]},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_={}.hasOwnProperty;i=n(320),x=n(42),d=x.inspect,r=x.bound,S=x.modulo,b=x.pad,v=x.min,y=x.max,x.abs,a=x.float32Eq,m=x.isString,g=x.log,u=x.hex16ColorRegExp,h=x.hex256ColorRegExp,c=x.hex16GreyColorRegExp,p=x.hex256GreyColorRegExp,P=x.rgbColorRegExp,C=x.rgbaColorRegExp,s=x.colorRegExp,l=x.float32Eq0,x.object,f=x.isNumber,o=a,w=function(t){var e;return-1!==(e=t.indexOf("%"))?.01*(0|t.slice(0,e)):1*(0|t)/255},t.exports=function(t){var e,n,i,a,x,E,T,k,I,M;function Color(){return Color.__super__.constructor.apply(this,arguments)}for(E in function(t,e){for(var n in e)_.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Color,t),Color.defineAtomicClass({fieldNames:"r g b a",constructorFunctionName:"rgbColor"}),Color.isColor=x=function(t){return!((null!=t?t.constructor:void 0)!==Color)},Color.isColorOrColorString=function(t){return x(t)||m(t)&&s.test(t)},Color.colorNames=["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenRod","DarkGray","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","GoldenRod","Gray","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquaMarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"],Color.colorNamesMap=e={transparent:"rgba(0,0,0,0)",aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgrey:"#a9a9a9",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategrey:"#2f4f4f",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgrey:"#696969",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",grey:"#808080",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategrey:"#778899",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategrey:"#708090",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Color.parseCache=T={},n=1,Color.rgbColor=k=function(t,n,i,r){var o;return null==n&&x(t)?t:m(t)&&(o=e[t]||T[t])?o:new Color(t,n,i,r)},Color.rgb256Color=function(t,i,r,o){var s,a;return null==i&&x(t)?t:m(t)&&(s=e[t]||T[t])?s:(n=255,a=new Color(t,i,r,o),n=1,a.r/=255,a.g/=255,a.b/=255,a.a/=255,a)},Color.newColor=k,Color.color=function(t,e,n,i){return g.error("Atomic.color DEPRICATED. Use rgbColor."),k(t,e,n,i)},Color.hslColor=a=function(t,e,n,i){var r,s,a,l,u;if(null==i&&(i=1),x(t))return t;switch(s=n*(1-e),l=n*(1-(r=6*(t=S(t,1))-(a=6*t|0))*e),u=n*(1-(1-r)*e),t=o(t,1)?1:t%1,a%6){case 0:return new Color(n,u,s,i,t,e,n);case 1:return new Color(l,n,s,i,t,e,n);case 2:return new Color(s,n,u,i,t,e,n);case 3:return new Color(s,l,n,i,t,e,n);case 4:return new Color(u,s,n,i,t,e,n);case 5:return new Color(n,s,l,i,t,e,n)}},Color.hsl2Rgb=function(t,e,n){var i,r,s,a,l;switch(r=n*(1-e),a=n*(1-(i=6*(t=S(t,1))-(s=6*t|0))*e),l=n*(1-(1-i)*e),t=o(t,1)?1:t%1,s%6){case 0:return[n,l,r];case 1:return[a,n,r];case 2:return[r,n,l];case 3:return[r,a,n];case 4:return[l,r,n];case 5:return[n,r,a]}},Color.parse=function(t,e){if(null==e&&(e=null),e)throw new Error("existing feature is no longer supported");return new Artomic.Color(t)},Color.prototype._initFromString=function(t){var n,i,r,o,s,a,l,f;return this.initProperties(),T[t]=this,(l=u.exec(t))?(l[0],f=l[1],s=l[2],i=l[3],(n=l[4])||(this._htmlColorString=t),n||(n="f"),this.r=parseInt(f,16)/15,this.g=parseInt(s,16)/15,this.b=parseInt(i,16)/15,this.a=parseInt(n,16)/15):(l=c.exec(t))?(this.r=this.g=this.b=parseInt(l[1],16)/15,this.a=1):(l=p.exec(t))?(this.r=this.g=this.b=parseInt(l[1],16)/255,this.a=1):(l=h.exec(t))?(l[0],f=l[1],s=l[2],i=l[3],(n=l[4])||(this._htmlColorString=t),n||(n="ff"),this.r=parseInt(f,16)/255,this.g=parseInt(s,16)/255,this.b=parseInt(i,16)/255,this.a=parseInt(n,16)/255):(o=P.exec(t))?(this._htmlColorString=t,this.a=1,this.r=w(o[1]),this.g=w(o[2]),this.b=w(o[3])):(o=C.exec(t))?(this._htmlColorString=t,this.r=w(o[1]),this.g=w(o[2]),this.b=w(o[3]),this.a=o[4]-0):/^[a-z]+$/i.test(a=t.toLowerCase())?(r=e[a])?(this._htmlColorString=r._htmlColorString,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a):g.warn(this.parseError="WARNING: Color.parse failure. Unknown rgbColor name: "+d(t)):/^([a-f0-9]{3,4}|[a-f0-9]{6}|[a-f0-9]{8})$/i.test(t)?this._initFromString("#"+t):g.warn(this.parseError="WARNING: Color.parse failure for "+d(t))},Color.prototype.initProperties=function(){return this.r=this.g=this.b=0,this.a=n,this._hue=this._saturation=this._lightness=null,this.parseError=null,this._htmlColorString=null},Color.prototype._init=function(t,e,n,i,r,o,s){return this.initProperties(),null!=r&&(this._hue=r-0),null!=o&&(this._saturation=o-0),null!=s&&(this._lightness=s-0),null==t?this.r=this.g=this.b=0:null==e?this.r=this.g=this.b=t-0:null!=n&&(this.r=t-0,this.g=e-0,this.b=n-0,null!=i)?this.a=i-0:void 0},Color.prototype.eq=function(t,e,n,i){var r,o,s,a,l,u,c,h,p,d;switch(!1){case t!==this:return!0;case!(null==t):return!1;case!f(t):return t===this.r&&e===this.g&&n===this.b&&(null!=i?i:1)===this.a;case t.constructor!==Color:return h=t.r,s=t.g,o=t.b,r=t.a,a=t._hue,p=t._saturation,u=t._lightness,l=this._hue,d=this._saturation,c=this._lightness,!(h!==this.r||s!==this.g||o!==this.b||r!==this.a||null!=a&&null!=l&&a!==l||null!=p&&null!=d&&p!==d||null!=u&&null!=c&&u!==c);default:return!1}},Color.prototype.interpolate=function(t,e){var n,i,r,o,s;return this,s=this.r,r=this.g,i=this.b,n=this.a,t=k(t),l(n)&&(s=t.r,r=t.g,i=t.b),l(t.a)&&(t=this.withAlpha(0)),o=1-e,new Color(t.r*e+s*o,t.g*e+r*o,t.b*e+i*o,t.a*e+n*o)},Color.prototype.blend=function(t,e){var n,i,r,s;switch(t=k(t),this,s=this.r,r=this.g,i=this.b,n=this.a,!1){case null==e:return new Color((t.r-s)*e+s,(t.g-r)*e+r,(t.b-i)*e+i,(t.a-n)*e+n);case!o(t.a,1):return t;case!o(t.a,0):return this;default:return e=t.a,new Color((t.r-s)*e+s,(t.g-r)*e+r,(t.b-i)*e+i,(1-n)*e+n)}},Color.prototype.withAlpha=function(t){return new Color(this.r,this.g,this.b,t)},Color.prototype.withLightness=function(t){return a(this.h,this.s,t,this.a)},Color.prototype.withHue=function(t){return a(t,this.s,this.l,this.a)},Color.prototype.withHueShift=function(t){return a(this.h+t,this.s,this.l,this.a)},Color.prototype.withSat=M=function(t){return a(this.h,t,this.l,this.a)},Color.prototype.withSaturation=M,Color.prototype.withScaledAlpha=function(t){return k(this.r,this.g,this.b,this.a*t)},Color.prototype.withScaledLightness=function(t){return a(this.h,this.s,t*this.l,this.a)},Color.prototype.withScaledSaturation=function(t){return a(this.h,t*this.s,this.l,this.a)},Color.prototype.withScaledLAndS=function(t,e){return a(this.h,e*this.s,t*this.l,this.a)},Color.prototype.withChannel=function(t,e){switch(t){case"r":case"red":return new Color(e,this.g,this.b,this.a);case"g":case"green":return new Color(this.r,e,this.b,this.a);case"b":case"blue":return new Color(this.r,this.g,e,this.a);case"h":case"hue":return a(e,this.s,this.l,this.a);case"s":case"sat":case"saturation":return a(this.h,e,this.l,this.a);case"l":case"lightness":return this.withLightness(e);case"a":case"alpha":return this.withAlpha(e);default:throw new Error("invalid channel: "+d(t))}},Color.prototype.withChannels=function(t){var e,n,i,r;return t.h||t.s||t.l?(n=null!=t.h?t.h:this.h,r=null!=t.s?t.s:this.s,i=null!=t.l?t.l:this.l,e=null!=t.a?t.a:this.a,a(n,r,i,e)):new Color(null!=t.r?t.r:this.r,null!=t.g?t.g:this.g,null!=t.b?t.b:this.b,e=null!=t.a?t.a:this.a)},"0",i=function(t,e){return null==e&&(e=2),b(t.toString(16),e,"0",!0)},Color.getter({inspectedObjects:function(){return this},arrayRGB:function(){return[this.r,this.g,this.b]},arrayRgb:function(){return[this.r,this.g,this.b]},arrayHsl:function(){return this._computeHsl()&&[this._hue,this._saturation,this._lightness]},rgbSum:function(){return this.r+this.g+this.b},rgbSquaredSum:function(){return this.r*this.r+this.g*this.g+this.b*this.b},clamped:function(){return new Color(r(0,this.r,1),r(0,this.g,1),r(0,this.b,1),r(0,this.a,1))},r256:function(){return r(0,Math.round(255*this.r),255)},g256:function(){return r(0,Math.round(255*this.g),255)},b256:function(){return r(0,Math.round(255*this.b),255)},a256:function(){return r(0,Math.round(255*this.a),255)},r16:function(){return r(0,Math.round(15*this.r),15)},g16:function(){return r(0,Math.round(15*this.g),15)},b16:function(){return r(0,Math.round(15*this.b),15)},a16:function(){return r(0,Math.round(15*this.a),15)},h256:function(){return r(0,Math.round(255*this.h),255)},s256:function(){return r(0,Math.round(255*this.s),255)},b256:function(){return r(0,Math.round(255*this.b),255)},rClamped:function(){return r(0,this.r,1)},gClamped:function(){return r(0,this.g,1)},bClamped:function(){return r(0,this.b,1)},aClamped:function(){return r(0,this.a,1)},premultiplied:function(){return new Color(this.r*this.a,this.g*this.a,this.b*this.a,this.a)},demultiplied:function(){return new Color(this.r/this.a,this.g/this.a,this.b/this.a,this.a)},cssString:function(){var t;return t=this.aClamped,"rgba("+[this.r256,this.g256,this.b256,t.toFixed(3).replace(/\.?0+$/,"")].join(", ")+")"},rgbaString:function(){return"rgbColor("+[this.r256,this.g256,this.b256,this.a256].join("/255, ")+"/255)"},hexString:function(){return"#"+this.rawHexString},rgbaHexString:function(){return"#"+this.getRawRgbaHexString()},hex16String:function(){return"#"+i(this.r16,1)+i(this.g16,1)+i(this.b16,1)},rgbaHex16String:function(){return this.hex16String+i(this.a16,1)},hslHexString:function(){return"#"+i(this.h256)+i(this.s256)+i(this.b256)},autoRgbaHexString:function(){return o(1,this.a)?this.getHexString():this.rgbaHexString},rawHexString:function(){return i(this.r256)+i(this.g256)+i(this.b256)},rawRgbaHexString:function(){return this.rawHexString+i(this.a256)}}),Color.prototype.inspect=function(){return"rgbColor('"+(o(1,this.a)?this.hexString:this.rgbaHexString)+"')"},Color.prototype.toString=function(){return this._htmlColorString||(this._htmlColorString=o(1,this.a)?this.getHexString():this.getCssString())},Color.prototype.getHueDelta=function(t){var e;return(e=this.hue-t.hue)<-.5?e+1:e>.5?e-1:e},Color.prototype.getHueDifference=function(t){return Math.abs(this.getHueDelta(t))},Color.getter({plainObjects:function(){return this.a<1?this.rgbaHexString:this.hexString},inspectedObjectInitializer:function(){return"'"+this.autoRgbaHexString+"'"}}),Color.getter({h:function(){return null!=this._hue?this._hue:this._hue=this._computeHsl()&&this._hue},s:function(){return null!=this._saturation?this._saturation:this._saturation=this._computeHsl()&&this._saturation},l:function(){return null!=this._lightness?this._lightness:this._lightness=this._computeHsl()&&this._lightness},inverseL:function(){return 1-this.l},inverseS:function(){return 1-this.s},inverseH:function(){return 1-this.h},hue:function(){return null!=this._hue?this._hue:this._hue=this._computeHsl()&&this._hue},sat:function(){return null!=this._saturation?this._saturation:this._saturation=this._computeHsl()&&this._saturation},lit:function(){return null!=this._lightness?this._lightness:this._lightness=this._computeHsl()&&this._lightness},saturation:function(){return null!=this._saturation?this._saturation:this._saturation=this._computeHsl()&&this._saturation},lightness:function(){return null!=this._lightness?this._lightness:this._lightness=this._computeHsl()&&this._lightness},perceptualLightness:function(){var t,e,n,i,r,o;return this,r=this.r,n=this.g,e=(t=this.b)*.3,(i=n*.8)>=(o=r*.7)&&i>=e?i+.5*(r+t)*(1-.8):e>=o&&e>=i?e+.5*(r+n)*.7:o+.5*(n+t)*(1-.7)},perceptualSaturation:function(){return Math.pow(this.perceptualLightness,1/3)*this.saturation},satLightness:function(){return(2-this._saturation)*this._lightness*.5}}),Color.prototype._computeHsl=function(){var t,e,n,i,r,o;return null!=this._hue||(this,o=this.r,n=this.g,t=this.b,i=this._lightness=y(o,n,t),r=v(o,n,t),this._hue=function(){if(i===r)return this._saturation=0;switch(this._saturation=1-r/i,e=i-r,i){case o:return(n-t)/e+(n>=t?0:6);case n:return(t-o)/e+2;case t:return(o-n)/e+4}}.call(this),this._hue/=6,!0)},e)I=e[E],e[E]=k(I);return Color.namedValues=e,Color}(i)},function(module,exports,__webpack_require__){var Base,floatEq,inspect,inspectedObjectLiteral,isFunction,isNumber,isPlainArray,isPlainObject,isString,log,lowerCamelCase,numberToTightString,object,ref,stringToNumberArray,upperCamelCase,wordsArray,extend=function(t,e){for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;ref=__webpack_require__(42),inspect=ref.inspect,log=ref.log,isNumber=ref.isNumber,isPlainObject=ref.isPlainObject,isPlainArray=ref.isPlainArray,isString=ref.isString,isFunction=ref.isFunction,stringToNumberArray=ref.stringToNumberArray,lowerCamelCase=ref.lowerCamelCase,upperCamelCase=ref.upperCamelCase,inspectedObjectLiteral=ref.inspectedObjectLiteral,floatEq=ref.floatEq,wordsArray=ref.wordsArray,inspect=ref.inspect,object=ref.object,numberToTightString=ref.numberToTightString,module.exports=Base=function(superClass){var letterFieldNames,reservedWords;function Base(t,e,n,i,r,o,s){Base.__super__.constructor.apply(this,arguments),isPlainArray(t)?this._init.apply(this,t):isString(t)?this._initFromString(t):isPlainObject(t)?this._initFromObject(t):null==t||isNumber(t)||t instanceof Base||!isFunction(t.toString)?this._init(t,e,n,i,r,o,s):this._initFromString(t.toString()),this.validate()}return extend(Base,superClass),Base.prototype._initFromString=function(t){return this._init.apply(this,stringToNumberArray(t))},Base.prototype.compare=function(t){return this.eq(t)?0:this.lte(t)?-1:this.gte(t)?1:NaN},Base.getConstructorFunctionName=function(){return this.constructorFunctionName||(this.constructorFunctionName=lowerCamelCase(this.getName()))},Base.getter({plainObjects:function(){return this.toObject()},inspectedObjects:function(){return inspectedObjectLiteral(this.inspectedObjectString)},inspectedObjectString:function(){var t,e,n;return n=this.inspectedObjectInitializer,t=this.class.getConstructorFunctionName(),t+="("+n+")",(e=this.class.getNamedValuesByValue()[n])&&(t+=" '"+e+"'"),t},inspectedObjectInitializer:function(){var t;return function(){var e,n,i,r;for(r=[],e=0,n=(i=this.toArray()).length;e<n;e++)t=i[e],r.push(numberToTightString(t,10));return r}.call(this).join(", ")},array:function(){return this.toArray()}}),Base.namedValues={},Base.getNamedValuesByValue=function(){var t,e,n,i;if(null!=this._namedValuesByValue)return this._namedValuesByValue;for(e in this._namedValuesByValue={},i=this.namedValues)n=i[e].inspectedObjectInitializer,null==(t=this._namedValuesByValue)[n]&&(t[n]=e);return this._namedValuesByValue},Base.prototype.toPlainStructure=function(){return this.getPlainObjects()},Base.prototype.toPlainEvalString=function(){return inspect(this.getPlainObjects())},Base.prototype.inspect=function(){return this.class.getConstructorFunctionName()+"("+this.toArray().join(", ")+")"},Base.prototype.toJson=function(){return this.toString()},Base.prototype.toString=function(t){var e;return t?"["+function(){var n,i,r,o;for(o=[],n=0,i=(r=this.toArray()).length;n<i;n++)e=r[n],o.push(e.toPrecision(t));return o}.call(this).join(", ")+"]":"["+this.toArray().join(", ")+"]"},Base.prototype.neq=function(t){return!this.eq(t)},Base.prototype.between=function(t,e){return this.gte(t)&&this.lte(e)},Base.prototype.floatEq=floatEq,Base.prototype.isNumber=isNumber,Base.defineAtomicClass=function(t){return this.fieldNames=t.fieldNames,this.constructorFunctionName=t.constructorFunctionName,isString(this.fieldNames)&&(this.fieldNames=wordsArray(this.fieldNames)),this.getConstructorFunctionName(),this._defineCore(this.fieldNames),this._defineComparisonOperators(this.fieldNames),this._defineMathOperators(this.fieldNames)},reservedWords={with:!0},Base._definePrototypeMethodViaEval=function(name,paramsList,body){var nameInEval;return nameInEval=reservedWords[name]?"":name,this.prototype[name]=eval(body="(function "+nameInEval+"("+paramsList+") {"+body+"})")},letterFieldNames=wordsArray("a b c d e f"),Base._defineComparisonOperators=function(t){var e,n,i,r,o,s,a,l;for(i in a=(s=letterFieldNames.slice(0,t.length)).join(", "),this._definePrototypeMethodViaEval("eq",a,"if (this === a) return true;\nif (this.isNumber(a)) {\n  return "+function(){var e,i,o;for(o=[],r=e=0,i=t.length;e<i;r=++e)n=t[r],o.push("this.floatEq(this."+n+", "+s[r]+")");return o}().join(" &&\n  ")+";\n} else {\n  return a &&\n  "+function(){var e,i,r;for(r=[],e=0,i=t.length;e<i;e++)n=t[e],r.push("this.floatEq(this."+n+", a."+n+")");return r}().join(" &&\n  ")+";\n}"),l=[],e={lt:"<",gt:">",lte:"<=",gte:">="})o=e[i],l.push(this._definePrototypeMethodViaEval(i,a,"if (this.isNumber(a)) {\n  return "+function(){var e,i,a;for(a=[],r=e=0,i=t.length;e<i;r=++e)n=t[r],a.push("this."+n+" "+o+" "+s[r]);return a}().join(" &&\n  ")+";\n} else {\n  return a &&\n  "+function(){var e,i,r;for(r=[],e=0,i=t.length;e<i;e++)n=t[e],r.push("this."+n+" "+o+" a."+n);return r}().join(" &&\n  ")+";\n}"));return l},Base._defineMathOperators=function(t){var e,n,i,r,o,s,a;for(n in r={add:"+",sub:"-",mul:"*",div:"/"},s=letterFieldNames.slice(0,t.length),a=[],r)o=r[n],a.push(this._definePrototypeMethodViaEval(n,s.join(", "),"if (this.isNumber(b)) {\n  return this._into(\n  null,\n  "+function(){var n,r,a;for(a=[],i=n=0,r=t.length;n<r;i=++n)e=t[i],a.push("this."+e+" "+o+" "+s[i]);return a}().join(",\n  ")+"\n  );\n} else if (this.isNumber(a)) {\n  return this._into(\n  b,\n  "+function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push("this."+e+" "+o+" a");return r}().join(",\n  ")+"\n  );\n} else {\n  return this._into(\n  b,\n  "+function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push("this."+e+" "+o+" a."+e);return r}().join(",\n  ")+"\n  );\n}"));return a},Base._defineCore=function(t){var e,n,i,r,o;for(i=t.join(", "),this._definePrototypeMethodViaEval("_into","into, "+i,"if (into === true)\n  into = this;\nelse\n  into = into || new this.class;\nreturn into._setAll("+i+");"),this._definePrototypeMethodViaEval("validate","",function(){var e,i,r;for(r=[],e=0,i=t.length;e<i;e++)n=t[e],r.push("if ((typeof this."+n+" != 'number') || isNaN(this."+n+")) { throw new Error('"+n+" is not a number: ' + this."+n+"); }");return r}().join(";\n")),this._definePrototypeMethodViaEval("_setAll",i,function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push("this."+e+" = "+e);return r}().join(";\n")+";\nreturn this;"),this._definePrototypeMethodViaEval("_initFromObject","o","return this._init("+function(){var e,i,r;for(r=[],e=0,i=t.length;e<i;e++)n=t[e],r.push("o."+n+" || 0");return r}().join(", ")+");"),this._definePrototypeMethodViaEval("with",i,"if (this.eq("+i+"))\n  return this;\nelse\n  return new this.class("+i+");"),this._definePrototypeMethodViaEval("clone","","return new this.class("+function(){var e,i,r;for(r=[],e=0,i=t.length;e<i;e++)n=t[e],r.push("this."+n);return r}().join(",")+");"),r=0,o=t.length;r<o;r++)n=t[r],this._definePrototypeMethodViaEval("with"+upperCamelCase(n),n,"return this.with(\n  "+function(){var i,r,o;for(o=[],i=0,r=t.length;i<r;i++)e=t[i],o.push(e===n?e:"this."+e);return o}().join(",\n  ")+"\n);");return this._definePrototypeMethodViaEval("interpolate","b, p, into","var oneMinusP = 1 - p;\nreturn this._into(\ninto,\n"+function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push("b."+e+" * p + this."+e+" * oneMinusP");return r}().join(",\n")+"\n);"),this._definePrototypeMethodViaEval("toArray","","return ["+function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push("this."+e);return r}().join(", ")+"];"),this._definePrototypeMethodViaEval("toObject","","return {"+function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(e+": this."+e);return r}().join(", ")+"};")},Base}(__webpack_require__(96).BaseClass)},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C={}.hasOwnProperty;i=n(320),r=n(316),b=n(42),y=b.merge,b.inspect,l=b.bound,h=b.floatEq,m=b.log,d=b.isNumber,b.isArray,f=b.isString,b.isFunction,b.stringToNumberArray,S=b.nearInfinity,b.inspectedObjectLiteral,s=Math.abs,P=Math.sqrt,a=Math.atan,o=Math.PI,p=Math.floor,u=Math.ceil,w=Math.round,v=Math.min,g=Math.max,c=Math.cos,x=Math.sin,t.exports=function(t){var e,n,i,b,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q;function Point(){return Point.__super__.constructor.apply(this,arguments)}for(k in function(t,e){for(var n in e)C.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Point,t),Point.defineAtomicClass({fieldNames:"x y"}),Point.isPoint=T=function(t){return(null!=t?t.constructor:void 0)===Point},Point.prototype._initFromObject=function(t){var e,n,i,r,o;return this.x=this.y=0,null!=(e=t.angle)?(n=null!=(i=t.magnitude)?i:1,this.x=c(e)*n,this.y=x(e)*n):(r=t.x,o=t.y,null!=r&&(this.x=r),null!=o?this.y=o:void 0)},N=function(t){var e,n,i,r,o,s,a,l;return n=t.aspectRatio,e=null!=(r=t.area)?r:1,i=t.fitInto,l=t.zoomInto,i?(s=i.x,a=i.y,n<i.aspectRatio?M(a*n,a):M(s,s/n)):l?(s=l.x,a=l.y,n>l.aspectRatio?M(a*n,a):M(s,s/n)):(o=Math.sqrt(e/n),M(o*n,o))},Point.point=M=function(t,e){var n,i,r;return T(t)?t:f(t)&&(n=I[t])?n:(null!=t?t.aspectRatio:void 0)?N(t):(i=t||0,r=null!=e?e:t,A.eq(i,r)?A:F.eq(i,r)?F:new Point(t,e))},Point.parse=function(t,e){if(e)throw new Error("existing feature is no longer supported");return new Point(t)},Point.prototype._init=function(t,e){return t||(t=0),null==e&&(e=t),this.x=t-0,this.y=e-0},Point.getter({exportedValue:function(){var t,e,n;return this,(e=this.x)===(n=this.y)?e:(t={},0!==e&&(t.x=e),0!==n&&(t.y=n),t)},top:function(){return 0},left:function(){return 0},right:function(){return this.x},bottom:function(){return this.y},centerX:function(){return.5*this.x},centerY:function(){return.5*this.y},hCenter:function(){return this.getCenterX()},vCenter:function(){return this.getCenterY()},tl:function(){return A},tc:function(){return this.mul(.5,0)},tr:function(){return this.mul(1,0)},lc:function(){return this.mul(0,.5)},cc:function(){return this.mul(.5,.5)},rc:function(){return this.mul(1,.5)},bl:function(){return this.mul(0,1)},bc:function(){return this.mul(.5,1)},br:function(){return this},ccNeg:function(){return this.mul(-.5)},topLeft:function(){return A},topCenter:function(){return this.mul(.5,0)},topRight:function(){return this.mul(1,0)},centerLeft:function(){return this.mul(0,.5)},centerCenter:function(){return this.mul(.5,.5)},centerRight:function(){return this.mul(1,.5)},bottomLeft:function(){return this.mul(0,1)},bottomCenter:function(){return this.mul(.5,1)},bottomRight:function(){return this},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)},isInfinite:function(){return!this.isFinite},w:function(){return this.x},width:function(){return this.x},h:function(){return this.y},height:function(){return this.y},neg:function(){return new Point(-this.x,-this.y)},inv:function(){return new Point(1/this.x,1/this.y)},vector:function(){return[this.x,this.y]},magnitudeSquared:function(){return this.x*this.x+this.y*this.y},magnitude:function(){return P(this.x*this.x+this.y*this.y)},aspectRatio:function(){return this.x/this.y},absoluteAspectRatio:function(){return s(this.x/this.y)},swapped:function(){return M(this.y,this.x)},rounded:function(){return this.round()},floored:function(){return this.floor()},ceiled:function(){return this.ceil()},area:function(){return this.x*this.y},sum:function(){return this.x+this.y},size:function(){return this},location:function(){return A},abs:function(){return this.with(s(this.x),s(this.y))},unitVector:function(){var t;return t=1/this.magnitude,new Point(this.x*t,this.y*t)},perpendicularVector:function(){return new Point(this.y,-this.x)},unitPerpendicularVector:function(){var t;return t=1/this.magnitude,new Point(this.y*t,-this.x*t)},angle:function(){return 0===this.x?o*(this.y>0?.5:1.5):this.x>0?a(this.y/this.x):a(this.y/this.x)+o},angle2:function(){return Math.atan2(this.y,this.x)},isInteger:function(){return h(this.x,0|this.x)&&h(this.y,0|this.y)}}),Point.prototype.distance=function(t){return P(this.distanceSquared(t))},Point.prototype.distanceSquared=function(t){var e,n;return(e=this.x-t.x)*e+(n=this.y-t.y)*n},Point.prototype.withArea=function(t){var e;if(!((e=this.area)>0&&t>=0))throw new Error("area must be > 0");return this.mul(Math.sqrt(t/e))},Point.prototype.vectorLength=2,Point.prototype.toIndex=function(t){return~~this.y*t+~~this.x},Point.prototype.contains=function(t){return t.x>=0&&t.y>=0&&t.x<this.x&t.y<this.y},Point.prototype.nearestInsidePoint=function(t){return this.with(l(0,t.x,this.x),l(0,t.y,this.y))},Point.prototype.appendToVector=function(t){var e;return t[(e=t.length)+1]=this.y,t[e]=this.x},Point.prototype.dot=function(t){return this.x*t.x+this.y*t.y},Point.prototype.cross=function(t){return this.x*t.y-this.y*t.x},Point.prototype.floor=function(){return this.with(p(this.x),p(this.y))},Point.prototype.ceil=function(){return this.with(u(this.x),u(this.y))},Point.prototype.scalerProjection=function(t){return this.dot(t)/t.magnitude},Point.prototype.scalerProjectionSquared=function(t){return Math.pow(this.dot(t),2)/t.magnitudeSquared},Point.prototype.scalerPerpendicularProjectionSquared=function(t){return this.magnitudeSquared-this.scalerProjectionSquared(t)},Point.prototype.scalerPerpendicularProjection=function(t){return Math.sqrt(this.scalerPerpendicularProjectionSquared(t))},Point.prototype.union=function(t){return T(t)?this.max(t):t.union(this)},Point.prototype.intersection=function(t){return T(t)?this.min(t):t.intersection(this)},Point.prototype.min=function(t){return null==t&&(t=null),t?this.with(v(this.x,t.x),v(this.y,t.y)):v(this.x,this.y)},Point.prototype.max=function(t){return null==t&&(t=null),t?this.with(g(this.x,t.x),g(this.y,t.y)):g(this.x,this.y)},Point.prototype.average=function(t){return null==t&&(t=null),t?this.with((this.x+t.x)/2,(this.y+t.y)/2):(this.x+this.y)/2},Point.prototype.bound=function(t,e){return this.with(l(t.x,this.x,e.x),l(t.y,this.y,e.y))},Point.prototype.round=function(t){return null==t&&(t=1),this.with(w(this.x/t)*t,w(this.y/t)*t)},Point.prototype.roundOut=function(){return this.ceil()},Point.prototype.fitInto=function(t){var e,n,i,r;return null==t?this:(d(t)?e=i=t:(e=t.x,i=t.y),n=e/this.x,r=i/this.y,this.mul(v(n,r)))},Point.prototype.fill=function(t){var e,n,i,r;return d(t)?e=i=t:(e=t.x,i=t.y),n=e/this.x,r=i/this.y,this.mul(g(n,r))},Point.prototype.withSameAreaAs=function(t){return this.mul(Math.sqrt(t.area/this.area))},Point.prototype.withAspectRatio=function(t){return h(t,this.aspectRatio)?this:M({aspectRatio:t,area:this.area})},Point.prototype.withRect=function(t,e,n,i){return null!=i&&0===t&&0===e?this.with(n,i):r.rect(t,e,n,i)},Point.prototype.minRatio=function(t){return v(this.x/t.x,this.y/t.y)},Point.prototype.maxRatio=function(t){return g(this.x/t.x,this.y/t.y)},Point.prototype.intersect=function(t,e){return m.warn("DEPRICATED: use: intersection"),this.intersection(t,e)},Point.prototype.intersection=function(t,e){return t.constructor===r.Rectangle?t.intersection(this,e):(null==e&&(e=new r.Rectangle),e._setAll(0,0,this.w,this.h),e.intersection(t,e))},A=W=new Point(0).freeze(),F=i=new Point(1).freeze(),B=new Point(2).freeze(),R=new Point(.5).freeze(),D=new Point(-.5).freeze(),O=new Point(-1).freeze(),L=new Point(-2).freeze(),j=new Point(1,0).freeze(),U=new Point(.5,0).freeze(),_=new Point(0,.5).freeze(),b=new Point(.5).freeze(),E=new Point(1,.5).freeze(),e=new Point(.5,1).freeze(),n=new Point(0,1).freeze(),z=new Point(S).freeze(),Point.namedAlignmentPoints={topLeft:W,topCenter:U,topRight:j,centerLeft:_,centerCenter:b,centerRight:E,bottomLeft:n,bottomCenter:e,bottomRight:i},Point.namedPoints=I=y(Point.namedAlignmentPoints,{point0:A,point1:F,pointNearInfinity:z,point2:B,pointNeg2:L,pointNeg1:O,pointHalf:R,pointNegHalf:D,center:U,left:W,right:j,bottom:n,top:W}),I)q=I[k],Point[k]=q;return Point.namedValues=I,Point}(i)},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P={}.hasOwnProperty;i=n(316),r=n(320),o=n(321),w=n(42),S=w.max,b=w.min,s=w.bound,x=w.round,u=w.floatEq,m=w.floor,a=w.ceil,x=w.round,v=w.log,g=w.isNumber,w.isArray,w.isString,w.isFunction,w.stringToNumberArray,c=w.floatEq0,l=w.float32Precision,d=w.floatLt,h=w.floatGt,p=w.floatGte,f=w.floatLte,o.point,y=o.isPoint,t.exports=function(t){var e,n;function Rectangle(){return Rectangle.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)P.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Rectangle,r),Rectangle.defineAtomicClass({fieldNames:"x y w h",constructorFunctionName:"rect"}),Rectangle.isRect=n=function(t){return(null!=t?t.constructor:void 0)===Rectangle},Rectangle.rect=function(t,e,i,r){return n(t)?t:new Rectangle(t,e,i,r)},Rectangle.prototype._initFromObject=function(t){var e,n,i,r,o,s;if(this.x=this.y=this.w=this.h=0,i=t.size,e=t.center,i?(g(i)?o=s=i:(o=i.x,s=i.y),this.w=o,this.h=s):this.w=this.h=1,e&&(g(e)?o=s=e:(o=e.x,s=e.y),this.x=o-this.w/2,this.y=s-this.h/2),o=t.x,s=t.y,r=t.w,n=t.h,null!=o&&(this.x=o),null!=s&&(this.y=s),null!=r&&(this.w=r),null!=n)return this.h=n},Rectangle.prototype._init=function(t,e,n,i){return this.x=this.y=this.w=this.h=0,null!=i?(this.x=t-0,this.y=e-0,this.w=n-0,this.h=i-0):null!=e?y(e)?(this.x=t.x,this.y=t.y,this.w=e.w,this.h=e.h):(this.w=t-0,this.h=e-0):y(t)?(this.w=t.w,this.h=t.h):null!=t?this.w=this.h=t-0:void 0},Rectangle.getter({aspectRatio:function(){return this.w/this.h},location:function(){return new o(this.x,this.y)},locationMatrix:function(){return i.Matrix.translateXY(this.x,this.y)},size:function(){return new o(this.w,this.h)},width:function(){return this.w},height:function(){return this.h},rounded:function(){return this.with(x(this.x),x(this.y),x(this.w),x(this.h))},tl:function(){return new o(this.x,this.y)},tc:function(){return new o(this.hCenter,this.y)},tr:function(){return new o(this.right,this.y)},lc:function(){return new o(this.x,this.vCenter)},cc:function(){return new o(this.hCenter,this.vCenter)},rc:function(){return new o(this.right,this.vCenter)},bl:function(){return new o(this.x,this.bottom)},bc:function(){return new o(this.hCenter,this.bottom)},br:function(){return new o(this.right,this.bottom)},topLeft:function(){return new o(this.x,this.y)},topCenter:function(){return new o(this.hCenter,this.y)},topRight:function(){return new o(this.right,this.y)},centerLeft:function(){return new o(this.x,this.vCenter)},centerCenter:function(){return new o(this.hCenter,this.vCenter)},centerRight:function(){return new o(this.right,this.vCenter)},bottomLeft:function(){return new o(this.x,this.bottom)},bottomCenter:function(){return new o(this.hCenter,this.bottom)},bottomRight:function(){return new o(this.right,this.bottom)},locationIsZero:function(){return u(this.x,0)&&u(this.y,0)},top:function(){return this.y},left:function(){return this.x},right:function(){return this.x+this.w},bottom:function(){return this.y+this.h},hCenter:function(){return this.x+.5*this.w},vCenter:function(){return this.y+.5*this.h},infinite:function(){return Infinity===this.w||Infinity===this.h},normalized:function(){var t,e,n,i;return e=this.w,t=this.h,e>=0&&t>=0?this:(n=this.x,i=this.y,e<0&&(n+=e,e=-e),t<0&&(i+=t,t=-t),this.with(n,i,e,t))},area:function(){return this.w*this.h},corners:function(){var t,e,n,i;return e=this.left,i=this.top,n=this.right,t=this.bottom,[new o(e,i),new o(n,i),new o(n,t),new o(e,t)]}}),Rectangle.prototype.withXY=function(t,e){return u(t,this.x)&&u(e,this.y)?this:new Rectangle(t,e,this.w,this.h)},Rectangle.prototype.withWH=function(t,e){return u(t,this.w)&&u(e,this.h)?this:new Rectangle(this.x,this.y,t,e)},Rectangle.prototype.withLocation=function(t){return this.withXY(t.x,t.y)},Rectangle.prototype.withSize=function(t){return this.withWH(t.x,t.y)},Rectangle.prototype.movedBy=function(t){return this.withXY(this.x+t.x,this.y+t.y)},Rectangle.prototype.nearestInsidePoint=function(t){return new o(s(this.left,t.x,this.right),s(this.top,t.y,this.bottom))},Rectangle.prototype.largestInsideRect=function(t){var e,n;return b(this.w/t.w,this.h/t.h),n=t.w*scale,e=t.h*scale,new Rectangle((this.w-n)/2,(this.h-e)/2,n,e)},e=function(t){var e,i;if(y(t))return{left:e=t.x,right:e,top:i=t.y,bottom:i};if(n(t))return t;throw new Error("Invalid arguments. Expecting Point or Rectangle. Got: "+t+".")},Rectangle.prototype.overlaps=function(t){var n,i,r,o,s;return null!=t&&(i=(r=e(t)).left,o=r.right,s=r.top,n=r.bottom,u(i,o)||u(s,n)?p(i,this.left)&&p(s,this.top)&&d(i,this.right)&&d(s,this.bottom):h(o,this.left)&&h(n,this.top)&&d(i,this.right)&&d(s,this.bottom))},Rectangle.prototype.contains=function(t){var n,i,r,o,s;return null!=t&&(i=(r=e(t)).left,o=r.right,s=r.top,n=r.bottom,u(i,o)||u(s,n)?p(i,this.left)&&p(s,this.top)&&d(i,this.right)&&d(s,this.bottom):p(i,this.left)&&p(s,this.top)&&f(o,this.right)&&f(n,this.bottom))},Rectangle.prototype.round=function(t){var e,n,i,r;return null==t&&(t=1),i=x(this.x,t),r=x(this.y,t),n=x(this.x+this.w,t)-i,e=x(this.y+this.h,t)-r,this.with(i,r,n,e)},Rectangle.prototype.roundOut=function(t,e,n){var i,r,o,s;return null==t&&(t=1),null==e&&(e=l),null==n&&(n=0),o=m(this.x+e,t)-n,s=m(this.y+e,t)-n,r=a(this.x+this.w-e,t)-o+2*n,i=a(this.y+this.h-e,t)-s+2*n,this.with(o,s,r,i)},Rectangle.prototype.roundIn=function(t,e){var n,i,r,o;return null==t&&(t=1),null==e&&(e=l),r=a(this.x-e,t),o=a(this.y-e,t),i=m(this.x+this.w+e,t)-r,n=m(this.y+this.h+e,t)-o,this.with(r,o,i,n)},Rectangle.prototype.union=function(t){var e,n,i,r;return null==t?this:this.getArea()<=0?t:(i=b(this.x,t.left),r=b(this.y,t.top),n=S(this.getRight(),t.getRight())-i,e=S(this.getBottom(),t.getBottom())-r,this.with(i,r,n,e))},Rectangle.prototype.unionInto=function(t){var e,n,i,r,o,s,a,l;return null==t?new Rectangle(this.x,this.y,this.w,this.h):(i=this.getArea(),o=t.getArea(),i<=0||Infinity===o?t:(o<=0||Infinity===i?t._setAll(this.x,this.y,this.w,this.h):(a=t.x,l=t.y,s=t.w,r=t.h,t._setAll(e=b(a,this.x),n=b(l,this.y),S(a+s,this.x+this.w)-e,S(l+r,this.y+this.h)-n)),t))},Rectangle.prototype._intoOrWith=function(t,e,n,i,r){return t?t._setAll(e,n,i,r):this.with(e,n,i,r)},Rectangle.prototype._returnOrSaveInto=function(t,e){var n,i,r,o;return t?(r=e.x,o=e.y,i=e.w,n=e.h,this._intoOrWith(t,r,o,i,n)):e},Rectangle.prototype.intersectInto=function(t){return v.warn("DEPRICATED: use: intersection"),this.intersection(t,t)},Rectangle.prototype.intersect=function(t,e){return v.warn("DEPRICATED: use: intersection"),this.intersection(t,e)},Rectangle.prototype.intersection=function(t,e){var n,i,r,o,s,a,l,u,c,h,p;return c=this.x,h=this.y,s=(u=this.w)*(l=this.h),(a=null!=(p=null!=t?t.getArea():void 0)?p:Infinity)<=0||Infinity===s?this._returnOrSaveInto(e,t):s<=0||Infinity===a?this._intoOrWith(e,c,h,u,l):(r=S(t.left,c),o=S(t.top,h),i=b(t.right,c+u)-r,(n=b(t.bottom,h+l)-o)<=0||i<=0?this._intoOrWith(e,0,0,0,0):this._intoOrWith(e,r,o,i,n))},Rectangle.prototype.grow=function(t,e){var n,i;return y(t)?(n=t.x,i=t.y):(n=t,i=null!=e?e:t),c(n)&&c(i)?this:this.with(this.x-n,this.y-i,this.w+2*n,this.h+2*i)},Rectangle.prototype.pad=function(t){return this.grow(-t)},Rectangle.prototype.expand=function(t){return this.grow(t)},Rectangle.nothing=new Rectangle(0,0,0,0).freeze(),Rectangle.everything=new Rectangle(0,0,Infinity,Infinity).freeze(),Rectangle.prototype.withRect=function(t,e,n,i){return this.with(t,e,n,i)},Rectangle.prototype.cutout=function(t){var e,n,i,r,o,s,a,l,u;return this.overlaps(t)?(this,l=this.x,u=this.y,this.w,n=this.h,a=this.right,e=this.bottom,i=[],t.x>l&&i.push(new Rectangle(l,u,t.x-l,n)),(s=t.right)<a&&i.push(new Rectangle(s,u,a-s,n)),t.y>u&&i.push(new Rectangle(r=S(t.x,l),u,b(s,a)-r,t.y-u)),(o=t.bottom)<e&&i.push(new Rectangle(r=S(t.x,l),o,b(s,a)-r,e-o)),i):[this]},Rectangle}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b={}.hasOwnProperty;e=n(320),i=n(321),r=n(322),m=i.point,h=i.isPoint,g=r.rect,o=Math.ceil,u=Math.floor,S=Math.sqrt,f=Math.min,d=Math.max,y=n(42),l=y.float32Eq0,y.formattedInspect,y.inspect,v=y.simplifyNum,a=y.float32Eq,s=y.compact,p=y.log,c=y.isNumber,(0,y.defineModule)(t,function(t){var n,y,w,x,P;function Matrix(){return Matrix.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)b.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Matrix,e),Matrix.defineAtomicClass({fieldNames:"sx sy shx shy tx ty"}),Matrix.isMatrix=x=function(t){return(null!=t?t.constructor:void 0)===Matrix},Matrix.matrix=function(t,e,n,i,r,o){return x(t)?t:null===t||void 0===t?y:new Matrix(t,e,n,i,r,o)},Matrix._cleanInspect=n=function(t,e){var n;return t?(n=new RegExp("([0-9])"+t,"g"),e.replace(n,"$1 * "+t).replace(/-1 \* /g,"-").replace(/\ \+ -/g," - ").replace(/0\./g,".")):e.replace(/-1([A-Za-z]+)/g,"-$1").replace(/\ \+ -/g," - ").replace(/0\./g,".")},Matrix.translate=function(t,e){var n,i;if(c(e))throw new Error("Matrix.translate no longer accepts two numbers. Use translateXY");return c(t)?n=i=t:(n=t.x,i=t.y),Matrix.translateXY(n,i)},Matrix.translateXY=function(t,e){return 0===t&&0===e?y:new Matrix(1,1,0,0,t,e)},Matrix.scale=function(t,e){var n,i;if(c(e))throw new Error("Matrix.scale no longer accepts two numbers. Use translateXY");return c(t)?n=i=t:(n=t.x,i=t.y),Matrix.scaleXY(n,i)},Matrix.scaleXY=function(t,e){return 1===t&&1===e?y:new Matrix(t,e,0,0,0,0)},Matrix.rotate=function(t){var e,n;return e=Math.cos(t),n=Math.sin(t),1===e&&0===n?y:new Matrix(e,e,-n,n,0,0)},Matrix.multitouch=function(t,e,n,i){var r,o,s,u,c,h,p,d,f,m,g;return o=(n.x+t.x)/2,s=(n.y+t.y)/2,u=(i.x+e.x)/2,c=(i.y+e.y)/2,d=n.sub(t),m=i.sub(e),f=d.magnitude,g=m.magnitude,h=Matrix.translateXY(-o,-s),l(f)||l(g)||(r=m.angle-d.angle,p=g/f,l(r)||(h=h.rotate(r)),a(p,1)||(h=h.scale(p))),h.translateXY(u,c)},Matrix.multitouchParts=function(t,e,n,i){var r,o;return r=n.sub(t),{rotate:(o=i.sub(e)).angle-r.angle,scale:o.magnitude/r.magnitude,translate:m((i.x+e.x)/2-(n.x+t.x)/2,(i.y+e.y)/2-(n.y+t.y)/2)}},Matrix.prototype.initDefaults=function(){return this.sx=this.sy=1,this.shy=this.shx=0,this.tx=this.ty=0,this._exactScale=this._exactScaler=null,this},Matrix.prototype._init=function(t,e,n,i,r,o){if(this.initDefaults(),null!=t)return h(t)?this._initFromPoint(t):x(t)?this._initFromMatrix(t):(this.sx=t-0,null!=e&&(this.sy=e-0),null!=n&&(this.shx=n-0),null!=i&&(this.shy=i-0),null!=r&&(this.tx=r-0),null!=o?this.ty=o-0:void 0)},Matrix.prototype.getScale=function(){return this.getS()},Matrix.getter({t:function(){return m(this.tx,this.ty)},s:function(){return m(this.sx,this.sy)},sh:function(){return m(this.shx,this.shy)},xsv:function(){return m(this.sx,this.shx)},ysv:function(){return m(this.sy,this.shy)},xsvMagnitude:function(){return S(this.sx*this.sx+this.shx*this.shx)},ysvMagnitude:function(){return S(this.sy*this.sy+this.shy*this.shy)},exactScale:function(){return this._exactScale||(this._exactScale=m(this.xsv.magnitude,this.ysv.magnitude))},exactScaler:function(){return this._exactScaler||(this._exactScaler=(this.getXsvMagnitude()+this.getYsvMagnitude())/2)},inv:function(){return this.invert()},inverted:function(){return this.invert()},locationX:function(){return this.tx},locationY:function(){return this.ty},scaleX:function(){return this.sx},scaleY:function(){return this.sy},location:function(){return m(this.tx,this.ty)},rounded:function(){return this.getWithRoundedTranslation()},withRoundedTranslation:function(){return this.translationIsIntegral?this:new Matrix(this.sx,this.sy,this.shx,this.shy,Math.round(this.tx),Math.round(this.ty))},angle:function(){var t;return t=this.transform(i.point0),this.transform(new i(0,1)).sub(t).angle-.5*Math.PI},float32Array:function(){return this.fillFloat32Array(new Float32Array(9))},isIdentity:function(){return a(this.sx,1)&&a(this.sy,1)&&l(this.shx)&&l(this.shy)&&l(this.tx)&&l(this.ty)},isTranslateOnly:function(){return a(this.sx,1)&&a(this.sy,1)&&l(this.shx)&&l(this.shy)},translationIsIntegral:function(){return a(this.tx,Math.round(this.tx))&&a(this.ty,Math.round(this.ty))},isIntegerTranslateOnly:function(){return this.isTranslateOnly&&a(this.tx,0|this.tx)&&a(this.ty,0|this.ty)},isTranslateAndScaleOnly:function(){return l(this.shx)&&l(this.shy)},hasSkew:function(){return!this.getIsTranslateAndScaleOnly()},isTranslateAndPositiveScaleOnly:function(){return this.sx>0&&this.sy>0&&a(this.shx,0)&&a(this.shy,0)}}),Matrix.prototype.fillFloat32Array=function(t){return t[0]=this.sx,t[1]=this.shx,t[2]=this.tx,t[3]=this.shy,t[4]=this.sy,t[5]=this.ty,t},Matrix.prototype.simplify=function(){return new Matrix(v(this.sx),v(this.sy),v(this.shx),v(this.shy),v(this.tx),v(this.ty))},Matrix.prototype.withAngle=function(t){return this.rotate(t-this.angle)},Matrix.prototype.withScale=function(t,e){var n,i;return c(t)?(n=t,i=null!=e?e:n):(n=t.x,i=t.y),this.scale(n/this.sx,i/this.sy)},Matrix.prototype.withLocation=function(t,e){var n,i;return c(t)?(n=t,i=null!=e?e:n):(n=t.x,i=t.y),n===this.tx&&i===this.ty?this:new Matrix(this.sx,this.sy,this.shx,this.shy,n,i)},Matrix.prototype.withLocationXY=function(t,e){return t===this.tx&&e===this.ty?this:new Matrix(this.sx,this.sy,this.shx,this.shy,t,e)},Matrix.prototype.translate=function(t,e){var n,i;if(c(t)?n=i=t:(n=t.x,i=t.y),c(e))throw new Error("Illegal second input: number ("+e+"). Use translateXY.");return this.translateXY(n,i,e)},Matrix.prototype.translateXY=function(t,e,n){return this._into(n,this.sx,this.sy,this.shx,this.shy,this.tx+t,this.ty+e)},Matrix.prototype.rotate=function(t,e){var n,i;return n=Math.cos(t),i=Math.sin(t),this._into(e,this.sx*n-this.shy*i,this.shx*i+this.sy*n,this.shx*n-this.sy*i,this.sx*i+this.shy*n,this.tx*n-this.ty*i,this.tx*i+this.ty*n)},Matrix.prototype.scale=function(t,e){var n,i;if(c(e))throw new Error("Matrix.scale no longer accepts two numbers. Use translateXY");return c(t)?n=i=t:(n=t.x,i=t.y),this.scaleXY(n,i,e)},Matrix.prototype.scaleXY=function(t,e,n){return this._into(n,this.sx*t,this.sy*e,this.shx*t,this.shy*e,this.tx*t,this.ty*e)},Matrix.getter({determinantReciprocal:function(){return 1/(this.sx*this.sy-this.shy*this.shx)}}),Matrix.prototype.invert=function(t){var e;return e=this.getDeterminantReciprocal(),this._into(t,e*this.sy,e*this.sx,e*-this.shx,e*-this.shy,e*(-this.tx*this.sy+this.ty*this.shx),e*(this.tx*this.shy-this.ty*this.sx))},Matrix.prototype.invertAndMul=function(t,e){var n,i,r,o,s,a,l;return o=(n=this.getDeterminantReciprocal())*this.sy,s=n*this.sx,i=n*-this.shx,r=n*-this.shy,a=n*(-this.tx*this.sy+this.ty*this.shx),l=n*(this.tx*this.shy-this.ty*this.sx),this._into(e,o*t.sx+r*t.shx,i*t.shy+s*t.sy,i*t.sx+s*t.shx,o*t.shy+r*t.sy,a*t.sx+l*t.shx+t.tx,a*t.shy+l*t.sy+t.ty)},Matrix.prototype.mul=function(t,e){return c(t)?this._into(e,this.sx*t,this.sy*t,this.shx*t,this.shy*t,this.tx*t,this.ty*t):this._into(e,this.sx*t.sx+this.shy*t.shx,this.shx*t.shy+this.sy*t.sy,this.shx*t.sx+this.sy*t.shx,this.sx*t.shy+this.shy*t.sy,this.tx*t.sx+this.ty*t.shx+t.tx,this.tx*t.shy+this.ty*t.sy+t.ty)},Matrix.prototype.div=function(t,e){var n;return n=c(t)?1/t:t.invert(w),this.mul(n,e)},Matrix.prototype.inspectX=function(t,e){var i;return i=t,t=t?t+".":"",this.sx||this.shx||this.tx?n(i,s([1===this.sx?t+"x":this.sx?""+this.sx+t+"x":void 0,1===this.shx?t+"y":this.shx?""+this.shx+t+"y":void 0,this.tx?""+this.tx:void 0]).join(" + ")):e?void 0:"0"},Matrix.prototype.inspectY=function(t,e){var i;return i=t,t=t?t+".":"",this.sy||this.shy||this.ty?n(i,s([1===this.sy?t+"y":this.sy?""+this.sy+t+"y":void 0,1===this.shy?t+"x":this.shy?""+this.shy+t+"x":void 0,this.ty?""+this.ty:void 0]).join(" + ")):e?void 0:"0"},Matrix.prototype.inspectBoth=function(t){return"("+this.inspectX(t)+", "+this.inspectY(t)+")"},Matrix.transform1D=P=function(t,e,n,i,r){return t*n+e*i+r},Matrix.prototype.transform=function(t,e){var n,i;return c(t)?(p.error("DEPRICATED: matrix.transform(x, y) - use matrix.transformXY"),n=t,i=null!=e?e:n):(n=t.x,i=t.y),this.transformXY(n,i)},Matrix.prototype.transformX=function(t,e){return P(t,e,this.sx,this.shx,this.tx)},Matrix.prototype.transformY=function(t,e){return P(e,t,this.sy,this.shy,this.ty)},Matrix.prototype.transformXY=function(t,e){return new i(this.transformX(t,e),this.transformY(t,e))},Matrix.prototype.inverseTransform=function(t,e){var n,r,o,s,a,l,u,h,p;return c(t)?(h=t,p=null!=e?e:h):(h=t.x,p=t.y),s=(n=this.getDeterminantReciprocal())*this.sy,a=n*this.sx,r=n*-this.shx,o=n*-this.shy,l=n*(-this.tx*this.sy+this.ty*this.shx),u=n*(this.tx*this.shy-this.ty*this.sx),new i(P(h,p,s,r,l),P(p,h,a,o,u))},Matrix.prototype.transformVector=function(t,e){var n,r;switch(null!=t&&t.constructor){case!1:n=r=0;break;case i:n=t.x,r=t.y;break;default:n=t,r=e}return new i(n*this.sx+r*this.shx,r*this.sy+n*this.shy)},Matrix.prototype.transformDifference=function(t,e){var n,r;return n=t.x-e.x,r=t.y-e.y,new i(n*this.sx+r*this.shx,r*this.sy+n*this.shy)},Matrix.prototype.transformBoundingRect=function(t,e,n){var i,s,a,l,c,h,p,m,y,v,S,b,w,x,C,_;return(t=g(t)).infinite?(p=t.x,b=t.y,h=t.w,s=t.h):this.isTranslateAndScaleOnly?(p=t.x*this.sx+this.tx,b=t.y*this.sy+this.ty,h=t.w*this.sx,s=t.h*this.sy,h<0&&(p+=h,h=-h),s<0&&(b+=s,s=-s)):(c=t.top,a=t.left,l=t.right,i=t.bottom,m=P(a,c,this.sx,this.shx,this.tx),w=P(c,a,this.sy,this.shy,this.ty),y=P(l,c,this.sx,this.shx,this.tx),x=P(c,l,this.sy,this.shy,this.ty),v=P(l,i,this.sx,this.shx,this.tx),C=P(i,l,this.sy,this.shy,this.ty),S=P(a,i,this.sx,this.shx,this.tx),_=P(i,a,this.sy,this.shy,this.ty),p=f(m,y,v,S),h=d(m,y,v,S)-p,b=f(w,x,C,_),s=d(w,x,C,_)-b),e&&(l=o(p+h),i=o(b+s),h=l-(p=u(p)),s=i-(b=u(b))),n?n._setAll(p,b,h,s):new r(p,b,h,s)},Matrix.identityMatrix=y=new Matrix,Matrix.matrix0=new Matrix(0,0,0,0,0,0),w=new Matrix,Matrix.prototype._initFromMatrix=function(t){return this.sx=t.sx,this.sy=t.sy,this.shx=t.shx,this.shy=t.shy,this.tx=t.tx,this.ty=t.ty,this},Matrix.prototype._initFromPoint=function(t){return this.tx=t.x,this.ty=t.y,this},Matrix}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h={}.hasOwnProperty;i=n(320),r=n(321),(c=n(42)).log,s=c.inspect,o=c.floatEq,c.isPlainObject,a=c.isString,l=c.min,u=r.point,n(322).rect,t.exports=function(t){var e,n,i,r,c,p;function Perimeter(){return Perimeter.__super__.constructor.apply(this,arguments)}for(n in function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Perimeter,t),Perimeter.defineAtomicClass({fieldNames:"left right top bottom"}),Perimeter.isPerimeter=e=function(t){return(null!=t?t.constructor:void 0)===Perimeter},Perimeter.perimeter=function(t,n,s,l){var u;return e(t)?t:a(t)&&(u=i[t])?u:null==n&&o(t,0)||!t?r:new Perimeter(t,n,s,l)},Perimeter.prototype._initFields=function(){return this.left=this.right=this.top=this.bottom=0},Perimeter.prototype._initFromObject=function(t){return this._init((t.left||0)+(t.l||0)+(t.h||0)+(t.horizontal||0),(t.right||0)+(t.r||0)+(t.h||0)+(t.horizontal||0),(t.top||0)+(t.t||0)+(t.v||0)+(t.vertical||0),(t.bottom||0)+(t.b||0)+(t.v||0)+(t.vertical||0))},Perimeter.prototype._init=function(t,e,n,i){switch(this._initFields(),null!=t?null!=e?null!=n?null!=i?4:3:2:1:0){case 0:return this.left=this.right=this.top=this.bottom=0;case 1:return this.left=this.right=this.top=this.bottom=t;case 2:return this.left=this.right=t,this.top=this.bottom=e;case 4:return this.left=t,this.right=e,this.top=n,this.bottom=i;default:throw new Error("invalid number of arguments: "+s(arguments))}},Perimeter.getter({exportedValue:function(){var t,e,n,i,r;if(this,e=this.left,i=this.right,r=this.top,t=this.bottom,e===i&&e===r&&e===t)return e;if(n={},e===i?0!==e&&(n.h=e):(0!==e&&(n.left=e),0!==i&&(n.right=i)),r===t){if(0!==r)return n.v=r}else if(0!==r&&(n.top=r),0!==t)return n.bottom=t},width:function(){return this.left+this.right},height:function(){return this.top+this.bottom},w:function(){return this.left+this.right},h:function(){return this.top+this.bottom},needsTranslation:function(){return 0!==this.left||0!==this.top}}),Perimeter.prototype.subtractedFromSize=function(t){var e,n;return n=this.getWidth(),e=this.getHeight(),o(n,0)&&o(e,0)?t:u(t.x-n,t.y-e)},Perimeter.prototype.addedToSize=function(t){var e,n;return n=this.getWidth(),e=this.getHeight(),o(n,0)&&o(e,0)?t:u(t.x+n,t.y+e)},Perimeter.prototype.minWH=function(t,e){return this.with(l(this.left,t),l(this.right,t),l(this.top,e),l(this.bottom,e))},Perimeter.namedPerimeters=i={perimeter0:r=new Perimeter(0).freeze()},c=Perimeter.namedPerimeters)p=c[n],Perimeter[n]=p;return Perimeter.prototype.pad=function(t){var e,n,i,r,o,s,a,l;return a=t.left,l=t.top,s=t.w,n=t.h,this,i=this.left,r=this.right,o=this.top,e=this.bottom,t.withRect(a+i,l+o,s-i-r,n-o-e)},Perimeter}(i)},function(t,e,n){t.exports=n(326)},function(t,e,n){(t.exports=n(327)).includeInNamespace(n(329)).addModules({Bitmap:n(334),BitmapBase:n(330),CompositeModes:n(333),FontLoader:n(338),GoogleFontLoader:n(339),GradientFillStyle:n(335),MipmapCache:n(331),Paths:n(337),StackBlur:n(336),Tools:n(332)})},function(t,e,n){t.exports=n(18).addNamespace("Art.Canvas",class Canvas extends Neptune.PackageNamespace{}._configureNamespace(n(328)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC\\"","dependencies":{"art-build-configurator":"*","webfontloader":"1.*"},"license":"ISC","name":"art-canvas","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"1.28.1"}')},function(t,e,n){var i,r,o,s;r=(s=n(330)).isCanvas,o=s.isImage,i=s.getImageSize,t.exports=[{isCanvas:r,isImage:o,getImageSize:i,mipmapCache:n(331).mipmapCache},n(332),n(333)]},function(t,e,n){(function(t,e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D={}.hasOwnProperty;F=n(313),T=F.point,k=F.point0,I=F.point1,F.Point,A=F.rect,F.Rectangle,w=F.matrix,l=F.Matrix,z=F.rgbColor,F.Color,S=F.isPoint,(B=n(42)).peek,B.inspect,B.Promise,f=B.getEnv,E=B.nextTick,B.pureMerge,B.isString,v=B.isNumber,b=B.log,u=B.bound,P=B.merge,y=B.isFunction,p=B.defineModule,O=Math.round,d=Math.floor,c=Math.ceil,x=Math.max,C=Math.min,R=n(160).Binary,r=R.BinaryString,o=R.EncodedImage,i=n(96).BaseClass,m=n(212).getMaxCanvasPixels,L={0:0,1:1,2:2,3:3,r:0,g:1,b:2,a:3,red:0,green:1,blue:2,alpha:3},_=n(331).mipmapCache,a=t.HTMLImageElement,s=t.HTMLCanvasElement,M=T(.25),g=T(.5),h=f().debugBitmapSize,p(e,function(e){var n,p,f,F,B,R,N,U,W,j,q,H,V;function BitmapBase(t,e){BitmapBase.__super__.constructor.apply(this,arguments),this._htmlImageElement=null,this._canvas=null,this._clippingArea=null,this._context=null,this._size=null,this._lastTransform=null,this._imageSmoothing=!1,this.pixelSnap=BitmapBase.pixelSnapDefault,this._pixelsPerPoint=1,BitmapBase.bitmapsCreated++,v(e)&&(t=T(t,e)),y(null!=t?t.toMemoryBitmap:void 0)?this.populateClone(this):H(t)?this.initFromCanvas(t,e):V(t)?this.initFromImage(t):this.initNewCanvas(T(t,e))}return function(t,e){for(var n in e)D.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(BitmapBase,i),BitmapBase.bitmapsCreated=0,BitmapBase.prototype.compositeModeSupported=function(t){return this.supportedCompositeModes.indexOf(t)>=0},BitmapBase.pixelSnapDefault=!0,BitmapBase.prototype.defaultColor=z("black"),BitmapBase.prototype.defaultColorString="black",BitmapBase.isImage=V=function(t){return(null!=t?t.constructor:void 0)===a||t instanceof a},BitmapBase.isCanvas=H=function(t){return(null!=t?t.constructor:void 0)===s||t instanceof s},BitmapBase.getImageSize=function(t){return T(t.naturalWidth||t.width,t.naturalHeight||t.height)},BitmapBase.getter({tainted:function(){if(!this._context)return this.newBitmap(1).drawBitmap(null,this).tainted;try{return this._context.getImageData(0,0,1,1),!1}catch(t){return!0}},isTainted:function(){return this.tainted},taintedInfo:function(){var t,e;return{size:this.size,tainted:this.tainted,class:this.class.getName(),src:null!=(t=this._htmlImageElement)&&null!=(e=t.src)?e.slice(0,100):void 0,haveCanvas:!!this._canvas}},hasAlpha:function(){var t,e,n,i,r;if((r=this.size).x<=128&&r.y<=128){for(e=n=0,i=(t=this.imageData.data).length;n<i;e=n+=4)if(t[e],t[e+3]<255)return!0;return!1}return this.resize(128).hasAlpha},inspectedObjects:function(){return this},canvas:function(){if(!this._canvas){if(!this._htmlImageElement)throw new Error("can't get @canvas");this.initNewCanvas(this.size),this.drawBitmap(null,this._htmlImageElement)}return this._canvas},bitmapClass:function(){return this.class},clippingArea:function(){return this._clippingArea||(this._clippingArea=A(this.getSize()))},aspectRatio:function(){return this.getSize().getAspectRatio()}}),BitmapBase.prototype.shouldPixelSnap=function(t){return this.pixelSnap&&(!t||S(t)||t.isTranslateAndPositiveScaleOnly)},BitmapBase.prototype.drawDrawable=function(t,e){return t.drawOnBitmap(this,e)},BitmapBase.prototype.pixelSnapRectangle=function(t,e){var n,i,r,o,s,a,l,u,c,h,p,d,f,m;return s=e.left,a=e.right,n=e.bottom,c=e.top,r=o=l=u=1,h=p=0,S(t)?(h=t.x,p=t.y):t&&(h=t.tx,p=t.ty,r=1/(l=t.sx),o=1/(u=t.sy)),f=(Math.round(s*l+h)-h)*r,m=(Math.round(c*u+p)-p)*o,d=(Math.round(a*l+h)-h)*r-f,i=(Math.round(n*u+p)-p)*o-m,A(f,m,d,i)},BitmapBase.prototype.pixelSnapMatrix=function(t){var e,n;return e=t.transformX(0,0),n=t.transformY(0,0),e-=Math.round(e),n-=Math.round(n),t.translateXY(-e,-n)},BitmapBase.prototype.pixelSnapAndTransformRectangle=function(t,e){var n,i,r,o;return e||console.error("no r"),i=e.left,r=e.right,o=e.top,n=e.bottom,S(t)?(i+=t.x,r+=t.x,o+=t.y,n+=t.y):t&&(i=t.transformX(i,o),o=t.transformY(i,o),r=t.transformX(r,n),n=t.transformY(r,n)),i=Math.round(i),o=Math.round(o),r=Math.round(r),n=Math.round(n),A(i,o,r-i,n-o)},BitmapBase.prototype.clone=function(){var t;return(t=this.newBitmap(this.size)).drawBitmap(null,this),t},BitmapBase.prototype.crop=function(t){return t||(t=this.getAutoCropRectangle()),t=A(t).intersection(A(this.size)),this.newBitmap(t.size.gt(k)?t.size:I).drawBitmap(l.translateXY(-t.x,-t.y),this)},BitmapBase.prototype.initFromCanvas=function(t,e){return this._canvas=t,this._size=T(this._canvas.width,this._canvas.height),this.logBitmapSize("initFromCanvas"),this.initContext(e)},BitmapBase.prototype.logBitmapSize=function(t){if(h)return b(this.class.getName()+"#"+t+" "+this._size)},BitmapBase.prototype.initFromImage=function(t){return this._size=T(t.naturalWidth||t.width,t.naturalHeight||t.height),this.logBitmapSize("initFromImage"),this.initNewCanvas(this.size),this.drawBitmap(T(),t)},BitmapBase.prototype.initNewCanvas=function(e){if(!this._context){if(!e.gt(T()))throw new Error("invalid size="+e+" for Art.Canvas.Bitmap");if(this._size=e.floor(),this.logBitmapSize("initNewCanvas"),this._size.area>m())throw new Error(b.error("size ("+this._size+" == "+this._size.area+") exceeds max pixels ("+m()+")"));return t.document?(this._canvas=document.createElement("canvas"),this._canvas.width=this.size.x,this._canvas.height=this.size.y):this._canvas=new s(this.size.x,this.size.y),this.initContext()}},BitmapBase.prototype.populateClone=function(t){return t.initNewCanvas(this.size),t.drawBitmap(null,this),t._pixelsPerPoint=this._pixelsPerPoint},BitmapBase.getter({pixelsPerPoint:function(){return this._pixelsPerPoint},pointsPerPixel:function(){return 1/this._pixelsPerPoint},pointSize:function(){return this.size.div(this.pixelsPerPoint)},byteSize:function(){return this.size.area*this.getBytesPerPixel()},bytesPerPixel:function(){return 4}}),BitmapBase.setter({pixelsPerPoint:function(t){return this._pixelsPerPoint=t},pointsPerPixel:function(t){return this._pixelsPerPoint=1/t}}),BitmapBase.property({size:T(100,100)}),BitmapBase.property({imageSmoothing:!1}),BitmapBase.prototype.toMemoryBitmap=function(){return this},BitmapBase.prototype.toMemoryDrawableBitmap=function(){return this},BitmapBase.getter({memoryContext:function(){var t;try{return this.toMemoryBitmap().context}catch(e){throw t=e,b.error({message:"ArtCanvas.BitmapBase.memoryContext failure",taintedInfo:this.taintedInfo,error:t}),t}},imageData:function(t,e,n,i){var r,o,s,a,l,u;r=null===t||void 0===t?A(this.size):A(t,e,n,i);try{return this.memoryContext.getImageData(r.x,r.y,r.w,r.h)}catch(t){throw o=t,l=r.x,u=r.y,a=r.w,s=r.h,b.error({message:"ArtCanvas.BitmapBase.imageData failure",taintedInfo:this.taintedInfo,area:{x:l,y:u,w:a,h:s},error:o,stack:o.stack}),o}},imageDataBuffer:function(t,e,n,i){return this.getImageData(t,e,n,i).data.buffer}}),BitmapBase.prototype.putImageData=function(t,e,n){return null==e&&(e=T()),null==n&&(n=A(this.size)),e=e.sub(n.location),this._context.putImageData(t,e.x,e.y,n.x,n.y,n.w,n.h),this},BitmapBase.prototype.drawBitmapWithSubtract=function(t){var e,n,i,r,o,s,a,l,u,c;for(n=(e=this.toMemoryBitmap()).imageData,s=t.imageData,i=n.data,a=s.data,l=u=0,c=i.length;u<c;l=u+=4)o=i[l],r=65536*a[l+3]/255|0,i[l]=o-a[l]*r/65536,i[l+1]=i[l+1]-a[l+1]*r/65536,i[l+2]=i[l+2]-a[l+2]*r/65536;return e.context.putImageData(n),e},BitmapBase.prototype.getImageDataArray=function(t){var e,n,i,r,o,s,a,l,u,c,h,p;if(null==t&&(t=null),e=this.getImageData().data,"rgb"===t){for(l=[],i=r=0,s=e.length;r<s;i=r+=4)u=e[i],l.push(u),l.push(e[i+1]),l.push(e[i+2]);return l}if(null!=(t=L[t])){for(i=t,n=e.length,c=[];i<n;)i+=4,c.push(e[i-4]);return c}for(h=[],o=0,a=e.length;o<a;o++)p=e[o],h.push(p);return h},BitmapBase.prototype.toPngUri=function(){return E().then((t=this,function(){return t.toMemoryBitmap().canvas.toDataURL()}));var t},BitmapBase.prototype.toJpgUri=function(t){return null==t&&(t=.95),E().then((e=this,function(){return e.toMemoryBitmap().canvas.toDataURL("image/jpeg",t)}));var e},BitmapBase.prototype.toPng=function(){return this.toPngUri().then(function(t){return r.fromDataUri(t)})},BitmapBase.prototype.toJpg=function(t){return this.toJpgUri(t).then(function(t){return r.fromDataUri(t)})},BitmapBase.prototype.autoEncode=function(t){var e;return(this.hasAlpha?(e="png",this.toPng()):(e="jpeg",this.toJpg(t))).then(function(t){return{extension:e,data:t,mimeType:"image/"+e}})},BitmapBase.prototype.toImage=function(){return E().then((t=this,function(){var e;return t._htmlImageElement?t._htmlImageElement:(e=t.toMemoryBitmap().canvas.toDataURL(),o.toImage(e).then(function(e){var n,i,r;return r=(i=t.pointSize).w,n=i.h,e.width=r,e.height=n,e}))}));var t},BitmapBase.prototype.hFlipped=function(){var t;return(t=this.newBitmap(this.size)).drawBitmap(l.translateXY(-this.size.x/2,0).scaleXY(-1,1).translateXY(this.size.x/2,0),this),t},BitmapBase.prototype.vFlipped=function(){var t;return(t=this.newBitmap(this.size)).drawBitmap(l.translateXY(0,-this.size.y/2).scaleXY(1,-1).translateXY(0,this.size.y/2),this),t},BitmapBase.getter({flipped:function(){return this.newBitmap(this.size).drawBitmap(l.scaleXY(-1,1).translateXY(this.size.x,0),this)},rotated180:function(){return this.newBitmap(this.size).drawBitmap(l.rotate(Math.PI).translate(this.size),this)},flippedAndRotated180:function(){return this.newBitmap(this.size).drawBitmap(l.scaleXY(-1,1).rotate(Math.PI).translateXY(0,this.size.y),this)},rotated90Clockwise:function(){return this.newBitmap(this.size.swapped).drawBitmap(l.rotate(Math.PI/2).translateXY(this.size.y,0),this)},flippedAndRotated90Clockwise:function(){return this.newBitmap(this.size.swapped).drawBitmap(l.scaleXY(-1,1).rotate(Math.PI/2).translateXY(this.size.y,this.size.x),this)},rotated90CounterClockwise:function(){return this.newBitmap(this.size.swapped).drawBitmap(l.rotate(-Math.PI/2).translateXY(0,this.size.x),this)},flippedAndRotated90CounterClockwise:function(){return this.newBitmap(this.size.swapped).drawBitmap(l.scaleXY(-1,1).rotate(-Math.PI/2),this)},rotated180AndFlipped:function(){return this.flippedAndRotated180},rotated90ClockwiseAndFlipped:function(){return this.flippedAndRotated90CounterClockwise},rotated90CounterClockwiseAndFlipped:function(){return this.flippedAndRotated90Clockwise},mipmap:function(t){var e;return t&&!this.size.mul(g).ceil().gte(t=T(t))?this:(e=this.scale(g),t?e.getMipmap(t):e)}}),BitmapBase.prototype.resize=function(t){return this.scale(T(t).div(this.size))},BitmapBase.prototype.scale=function(t,e){var n,i,r;if(null==e&&(e=!0),i=this.size.mul(t=T(t)).ceil(),r=this,e)for(;t.lte(M);)t=t.mul(2),r=r.mipmap;return i.eq(r.size)?r:(n=this.newBitmap(i)).drawBitmap(l.scale(n.size.div(r.size)),r)},BitmapBase.prototype.drawBorder=function(t,e,n){var i,r,o,s;return r=w(t),e=A(e),i=n.color||"#777",s=n.width||1,o=n.padding||0,e=e.grow(o),this.drawRectangle(r,A(e.x,e.y,e.w,s),i),this.drawRectangle(r,A(e.x,e.bottom-s,e.w,s),i),this.drawRectangle(r,A(e.x,e.y+s,s,e.h-2*s),i),this.drawRectangle(r,A(e.right-s,e.y+s,s,e.h-2*s),i)},BitmapBase.prototype.drawStretchedBorderBitmap=function(t,e,n,i,r){var o,s,a,u,c,h,p,d,f,m,g,y,S,b,w,x,P,C,_,E,T,k,I,M,F,B,R,z,L,D,N,U,W,j,q,H,V,$,G,Y,K,X,J,Q;if(null==r&&(r={}),g=r.hide,S=r.show,o=n.size,u=r.borderScale,v(u)||(u=1),C=i.left,E=i.top,T=(_=i.right)-C,P=(x=i.bottom)-E,U=O(t.transformX(e.left,0)),j=O(t.transformY(0,e.top)),q=(W=O(t.transformX(e.right,0)))-U,N=(D=O(t.transformY(0,e.bottom)))-j,F=C,z=E,R=o.w-_,b=o.h-x,$=O(t.transformX(e.left+F*u,0)),Y=O(t.transformY(0,e.top+z*u)),G=O(t.transformX(e.right-R*u,0)),V=(H=O(t.transformY(0,e.bottom-b*u)))-Y,(K=G-$)<0&&(s=F/(F+R),F=O(F*(a=q/(q-K))),R=O(R*a),_=n.size.x-R,$=G=U+O(q*s),K=0),V<0&&(s=z/(z+b),z=O(z*(a=N/(N-V))),b=O(b*a),x=n.size.x-b,Y=H=j+O(N*s),V=0),M=($-U)/F,L=(Y-j)/z,B=(W-G)/R,w=(D-H)/b,I=K/T,k=V/P,S&&(J=!S.topLeft,Q=!S.topRight,X=!S.topCenter,f=!S.centerLeft,m=!S.centerRight,d=!S.centerCenter,h=!S.bottomLeft,p=!S.bottomRight,c=!S.bottomCenter),g&&(J=g.topLeft,X=g.topCenter,Q=g.topRight,f=g.centerLeft,d=g.centerCenter,m=g.centerRight,h=g.bottomLeft,g.botomCenter,p=g.bottomRight,g.top&&(J=X=Q=!0),g.bottom&&(h=c=p=!0),g.left&&(J=f=h=!0),g.left&&(Q=m=p=!0),g.centerRow&&(f=d=m=!0),g.centerColumn&&(X=p=!0)),J||(y=l.scaleXY(M,L).translateXY(U,j),r.sourceArea=A(0,0,F,z),this.drawBitmap(y,n,r)),Q||(y=l.scaleXY(B,L).translateXY(G,j),r.sourceArea=A(_,0,R,z),this.drawBitmap(y,n,r)),h||(y=l.scaleXY(M,w).translateXY(U,H),r.sourceArea=A(0,x,F,b),this.drawBitmap(y,n,r)),p||(y=l.scaleXY(B,w).translateXY(G,H),r.sourceArea=A(_,x,R,b),this.drawBitmap(y,n,r)),V>0&&(f||(y=l.scaleXY(M,k).translateXY(U,Y),r.sourceArea=A(0,z,F,P),this.drawBitmap(y,n,r)),d||K<=0||(y=l.scaleXY(I,k).translateXY($,Y),r.sourceArea=A(C,E,T,P),this.drawBitmap(y,n,r)),m||(y=l.scaleXY(B,k).translateXY(G,Y),r.sourceArea=A(_,z,R,P),this.drawBitmap(y,n,r))),T>0&&(c||(y=l.scaleXY(I,w).translateXY($,H),r.sourceArea=A(F,x,T,b),this.drawBitmap(y,n,r)),!X))return y=l.scaleXY(I,L).translateXY($,j),r.sourceArea=A(C,0,T,z),this.drawBitmap(y,n,r)},U=function(t,e,n){var i,r;for(i=4*e.x,r=3;r<t.length&&t[r]<=n;)r+=4;return d(r/i)},n=function(t,e,n,i){var r,o,s;for(r=4*e.x,o=t.length+3-4,s=i*r;o>s&&t[o]<=n;)o-=4;return d(o/r)},p=function(t,e,n,i,r){var o,s,a,l,u,c;for(s=4*e.x,t.length,c=i*s,o=r*s,l=3;l<s;){for(a=l+c,u=l+o;a<u;){if(t[a]>n)return d(l/4);a+=s}l+=4}},N=function(t,e,n,i,r,o){var s,a,l,u,c,h,p;for(a=4*e.x,t.length,p=i*a,s=r*a,c=a-4+3,l=4*o;c>l;){for(u=c+p,h=c+s;u<h;){if(t[u]>n)return d(c/4);u+=a}c-=4}},q=function(t,e,n,i){var r,o,s,a;for(a=e,o=e+i,s=0;a<o;)(r=t[a])>s&&(s=r),a+=n;return s},j=function(t,e,n,i,r,o){var s,a,l;if(a=e,s=0,i<0){for(;a>n&&!(0<(l=q(t,a,r,o)));)a+=i,s++;return s+1-l/255}for(;a<n&&!(0<(l=q(t,a,r,o)));)a+=i,s++;return s+1-l/255},R=function(t,e){var n;return n=4*e.x,j(t,3,t.length,n,4,n)},f=function(t,e,n){var i;return i=4*e.x,e.y-j(t,t.length+3-i,n*i-1,-i,4,i)},F=function(t,e,n,i){var r;return r=4*e.x,j(t,r*n+3,r*n+r,4,r,r*(i-n))},B=function(t,e,n,i,r){var o;return o=4*e.x,e.x-j(t,o*n+o+3-4,o*n+4*r,-4,o,o*(i-n))},BitmapBase.getter({autoCropRectangle:function(t){var e,i,r,o,s,a;return null==t&&(t=0),this,s=this.size,i=this.context.getImageData(0,0,s.x,s.y).data,(a=U(i,s,t))===s.y?A():(e=n(i,s,t,a),r=p(i,s,t,a,e),o=N(i,s,t,a,e,r),A(r,a,o-r+1,e-a+1))},contentArea:function(){return this.autoCropRectangle},preciseContentArea:function(){var t,e,n,i,r,o,s,a,l;return this,a=this.size,e=this.context.getImageData(0,0,a.x,a.y).data,(l=d(s=R(e,a)))>=a.y?A():(t=c(i=f(e,a,l)),n=d(r=F(e,a,l,t)),c(o=B(e,a,l,t,n)),A(r,s,o-r,i-s))}}),W={},BitmapBase.prototype.drawBitmapWithLayout=function(t,e,n){var i,r,o,s,a,h,p,d,f,m,g,y,v,S,E,k,I,M,F,B,R,z,L,D,N,U,j;if(null==n&&(n=W),e&&(N=null!=(E=n.targetSize)?E:this.size,B=n.sourceArea,f=n.focus,r=n.aspectRatio,m=n.layout,S=n.opacity,g=n.mipmap,!(S<1/256||N.area<=1/256))){if(B?1!==e.pixelsPerPoint&&(B=B.mul(e.pixelsPerPoint)):B=A(e.size),o=e.size,z=B.size,R=B.location,r||(r=z.aspectRatio),s=function(){switch(m){case"stretch":return l.scaleXY(N.x/z.x,N.y/z.y);case"zoom":return i=r!==z.aspectRatio?T(N.x*z.aspectRatio/r,N.y):N,M=x(i.x/z.x,i.y/z.y),p=C(o.x,c(i.x/M)),d=C(o.y,c(i.y/M)),f?(a=z.x*f.x-.5*p,h=z.y*f.y-.5*d):(a=R.x+.5*z.x-O(.5*p),h=R.y+.5*z.y-O(.5*d)),L=u(0,a,o.x-p),D=u(0,h,o.y-d),n=P(n,{sourceArea:A(L,D,p,d)}),l.scaleXY(N.x/p,N.y/d);case"fit":return s=w(),r!==o.aspectRatio&&(o=(I=o).withAspectRatio(r),s=s.scale(F=o.div(I)),z=z.mul(F),R=R.mul(F)),l.translateXY(-B.w/2,-B.h/2).mul(s).scale(C(N.x/z.x,N.y/z.y)).translateXY(N.x/2,N.y/2);default:throw new Error("unknown mode: "+this._mode)}}.call(this),t&&(s=s.mul(w(t))),e&&g&&((k=e.size).x,k.y,U=s.xsvMagnitude,j=s.ysvMagnitude,U<.5&&j<.5)){y=x(Math.floor(-Math.log2(U)),Math.floor(-Math.log2(j)));try{g=_.get(e,y),v=Math.pow(2,y),s=l.scale(v).mul(s),n.sourceArea&&(n=P(n,{sourceArea:n.sourceArea.div(v).round()})),e=g}catch(t){b({mipmapError:t})}}return this.drawBitmap(s,e,n)}},BitmapBase}())}).call(this,n(5),n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;i=(l=n(42)).defineModule,r=l.insert,s=l.moveArrayElement,a=l.objectKeyCount,e=n(96).BaseClass,o=16*Math.pow(2,20),i(t,function(t){var n;function MipmapCache(){this._hitCount=0,this._missCount=0,this.releaseAll()}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(MipmapCache,e),MipmapCache.singletonClass(),MipmapCache.getter("byteSize hitCount missCount",{count:function(){return this._mostRecentlyUsed.length},memoryInfo:function(){return{byteSize:this.byteSize,hitCount:this.hitCount,missCount:this.missCount,activeCount:this.count}}}),n=function(t,e){return t.objectId+"_"+e},MipmapCache.prototype.get=function(t,e,i){var r,o,a;return null==i&&(i=!0),0===e?t:(r=this._cache[o=n(t,e)])?(this._hitCount++,i&&(this._mostRecentlyUsed=s(this._mostRecentlyUsed,this._mostRecentlyUsed.indexOf(o),0)),r):(this._missCount++,a=this.get(t,e-1,!1).mipmap,this._add(o,a))},MipmapCache.prototype.releaseAll=function(){return this._cache={},this._byteSize=0,this._mostRecentlyUsed=[]},MipmapCache.prototype._add=function(t,e){var n;if(this._validate("pre _add"),this._cache[t])throw new Error("already in!");if(this._reserveSpace(e.byteSize),this._validate("mid _add"),this._byteSize+=e.byteSize,this._cache[t]=e,function(){var t,e,i,r;for(r=[],t=0,e=(i=this._mostRecentlyUsed).length;t<e;t++)n=i[t],r.push(n);return r}.call(this),this._mostRecentlyUsed.length,this._mostRecentlyUsed=r(this._mostRecentlyUsed,0,t),0!==this._mostRecentlyUsed.indexOf(t))throw new Error("no first");return this._validate("post _add"),e},MipmapCache.prototype._reserveSpace=function(t){for(this._validate("pre _reserveSpace");this._mostRecentlyUsed.length>0&&this._byteSize+t>o;)this._popLru();return this._validate("post _reserveSpace"),t},MipmapCache.prototype._validate=function(t){var e,n,i,r,o,s;for(s=0,this._mostRecentlyUsed.length!==a(this._cache)&&log.error({_validate:{context:t,lengthMismatch:{_mostRecentlyUsed:this._mostRecentlyUsed,_cache:this._cache}}}),n=0,r=(o=this._mostRecentlyUsed).length;n<r;n++)i=o[n],(e=this._cache[i])?s+=e.byteSize:log.error({_validate:{context:t,keyNotFound:i}});if(s!==this._byteSize)return log.error({_validate:{context:t,wrongByteSize:{validateByteSize:s,_byteSize:this._byteSize}}})},MipmapCache.prototype._popLru=function(){var t;if(this._validate("pre _popLru"),t=this._mostRecentlyUsed.pop(),!this._cache[t])throw new Error("no in?!?!");if(this._byteSize-=this._cache[t].byteSize,!this._cache[t])throw new Error("already deketed!");return delete this._cache[t],this._validate("post _popLru")},MipmapCache}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s;e=(o=n(42)).defineModule,o.log,s=n(313),i=s.isPoint,r=s.rect,s.Matrix.transform1D,e(t,function(){function Tools(){}return Tools.transformAndRoundOutRectangle=function(t,e){var n,o,s,a,l,u;return i(t)?(o=e.left,s=e.right,n=e.bottom,a=e.top,l=t.x,u=t.y,o=Math.floor(o+l),s=Math.ceil(s+l),a=Math.floor(a+u),n=Math.ceil(n+u),r(o,a,s-o,n-a)):t?t.transformBoundingRect(e,!0):e.roundOut()},Tools}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a;(s=n(42)).object,s.clone,a=s.w,i=s.dashCase,r=s.lowerCamelCase,o=s.merge,s.log,t.exports=function(){var t,e,n,s,l,u,c,h,p;function CompositeModes(){}for(CompositeModes.artCanvasCoreCompositeModeMap={sourceTopUnion:"source-over",sourceTopInTarget:"source-atop",sourceTopIntersection:"source-in",sourceWithoutTarget:"source-out",targetTopUnion:"destination-over",targetTopInSource:"destination-atop",targetTopIntersection:"destination-in",targetWithoutSource:"destination-out",add:"lighter",max:"lighten",min:"darken",replace:"copy",normal:"source-over",sourceTop:"source-over",targetTop:"destination-over"},CompositeModes.artCanvasCoreCompositeModes=Object.keys(CompositeModes.artCanvasCoreCompositeModeMap),CompositeModes.compositeModeMap=o(CompositeModes.artCanvasCoreCompositeModeMap,{alphaMask:"destination-in",targetAlphaMask:"source-in",inverseAlphaMask:"destination-out",destOver:"destination-over"}),CompositeModes.htmlCanvasCompositeModes=a("source-in source-out source-over source-atop destination-over destination-in destination-out destination-atop copy lighter xor screen darken multiply overlay lighten color-burn color-dodge hard-light soft-light difference exclusion hue saturation color luminosity"),CompositeModes.normalizedCompositeModeMap={"source-atop":"sourceTopInTarget","source-in":"sourceTopIntersection","source-out":"sourceWithoutTarget","destination-atop":"targetTopInSource","destination-in":"targetTopIntersection","destination-out":"targetWithoutSource",lighter:"add",copy:"replace","source-over":"normal","destination-over":"targetTop"},n=0,l=(c=CompositeModes.htmlCanvasCompositeModes).length;n<l;n++)u=c[n],CompositeModes.compositeModeMap[r(u)]=e=i(u),CompositeModes.compositeModeMap[e]=e,null==(t=CompositeModes.normalizedCompositeModeMap)[e]&&(t[e]=e);for(s in h=CompositeModes.compositeModeMap)p=h[s],CompositeModes.normalizedCompositeModeMap[s]=CompositeModes.normalizedCompositeModeMap[p];return CompositeModes.artToCanvasCompositeModeMap=CompositeModes.compositeModeMap,CompositeModes}()},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W={}.hasOwnProperty;i=n(313),l=n(335),o=n(330),p=n(336),R=n(337),N=R.roundedRectanglePath,B=R.rectanglePath,T=R.linePath,U=n(332).transformAndRoundOutRectangle,_=function(t,e){var n;return!(t!==B&&t!==N||null!=(n=null!=e?e.radius:void 0)&&0!==n)},(z=n(42)).inspect,k=z.log,I=z.min,z.max,z.Binary,b=z.isFunction,P=z.isPlainObject,z.eq,g=z.currentSecond,D=z.round,x=z.isNumber,v=z.floatEq0,h=z.Promise,P=z.isPlainObject,E=z.isString,S=z.getEnv,d=z.array,z.dashCase,z.lowerCamelCase,f=Math.ceil,r=(O=n(160)).Binary,s=O.Browser,a=r.EncodedImage,C=i.isPoint,w=i.isMatrix,M=i.point,i.Point,F=i.rect,i.Rectangle,i.matrix,c=i.Matrix,L=i.rgbColor,i.Color,u=i.IdentityMatrix,A=i.point0,y={},m=n(333).compositeModeMap,t.exports=function(t){var n;function Bitmap(){return Bitmap.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)W.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Bitmap,o),Bitmap.supportedCompositeModes=Object.keys(m),Bitmap.getter({supportedCompositeModes:function(){return Bitmap.supportedCompositeModes}}),Bitmap.prototype.initContext=function(t){var e;return this._context=null!=(e=this._canvas)?e.getContext("2d",t):void 0},Bitmap.getter({context:function(){return!this._context&&this._htmlImageElement&&(this.logBitmapSize("'context' getter needs to make a new canvas"),this.initNewCanvas(this.size),this.drawBitmap(M(),this._htmlImageElement),this._htmlImageElement=null),this._context},context2D:function(){return this.getContext()},htmlImageElement:function(){return this._htmlImageElement},htmlElement:function(){return this._htmlImageElement||this._canvas}}),Bitmap.get=function(t,e){return a.get(t,e).then(function(e){var n,i,r;return n=new Bitmap(e),E(t)&&(i=t.match(/@([2-9])x\.[a-zA-Z]+$/))&&(i[0],r=i[1],n.pixelsPerPoint=0|r),n})},Bitmap.requestImage=function(t){var e;return t&&(e=t.multiple),s.File.request({accept:"image/*",multiple:!!e}).then(function(t){return h.all(d(t,function(t){return a.toImage(t).then(function(e){return{bitmap:new Bitmap(e),file:t,image:e,mimeType:t.type}})})).then(function(t){return e?t:t[0]})})},Bitmap.prototype.initFromImage=function(t){var e,n,i;if(this._size=o.getImageSize(t),this.logBitmapSize("initFromImage"),this._htmlImageElement=t,S().debugTaint)return i=this.tainted,e="Canvas.Bitmap.initFromImage "+this._size+", tainted: "+i+", "+(null!=(n=t.src)?n.slice(0,100):void 0),i?k.error(e):k(e)},Bitmap.setter({imageSmoothing:function(t){return this._context.imageSmoothingEnabled=this._context.mozImageSmoothingEnabled=this._context.webkitImageSmoothingEnabled=this._context.msImageSmoothingEnabled=this._imageSmoothing=!!t}}),Bitmap.bitmapClass=Bitmap,Bitmap.newBitmap=function(t){return new Bitmap.bitmapClass(t)},Bitmap.prototype.newBitmap=function(t){return new this.bitmapClass(t||this.size).tap((e=this,function(t){return t.pixelsPerPoint=e.pixelsPerPoint}));var e},Bitmap.prototype.setClippingArea=function(t,e,n,i,r){var o,s,a;return null==r&&(r="evenodd"),o=this._context,b(t)&&(_(t,i)||(s=t),t=n),t?(this._setTransform(e),this.shouldPixelSnap(e,t)?t=this.pixelSnapRectangle(e,t):null==s&&(s=B),a=U(e,t),this._clippingArea=a.intersection(this._clippingArea)):this._setTransform(e),o.beginPath(),s?s(o,t,i):o.rect(t.x,t.y,t.w,t.h),o.clip(r)},Bitmap.prototype.clippedTo=function(t,e,n,i,r){var o;this._context.save(),o=this._clippingArea;try{return this.setClippingArea(t,n,i,r),e()}finally{this._context.restore(),this._clippingArea=o}},Bitmap.prototype.openClipping=function(t,e,n,i){var r;return this._context.save(),r=this._clippingArea,this.setClippingArea(t,e,n,i),r||F(this.size)},Bitmap.prototype.closeClipping=function(t){return this._context.restore(),this._clippingArea=t},n=L("transparent"),Bitmap.prototype.clear=function(t,e,i,r){return this.clearArea(null,null!=t?L(t,e,i,r):n),this},Bitmap.prototype.clearOutsideArea=function(t,e){var n,i,r,o,s,a,l;if(t){if(a=t.left,l=t.top,s=t.w,r=t.h,0!==a||0!==l)throw new Error("area("+t+") must start in the top-right corner");if(i=(o=this.size).w,n=o.h,s=I(s,i),r=I(r,n),s!==i||r!==n)return r===n?this.clearArea(F(s,0,i-s,n)):s===i?this.clearArea(F(0,r,i,n-r)):(this.clearArea(F(s,0,i-s,n)),this.clearArea(F(0,r,s,n-r)))}},Bitmap.prototype.clearArea=function(t,e){var i,r,o,s,a;if(null==e&&(e=n),t?(s=t.left,a=t.top,o=t.w,i=t.h):(s=a=0,o=(r=this.size).w,i=r.h),this._clearTransform(),1!==e.a&&this._context.clearRect(s,a,o,i),!e.eq(n))return this._context.globalCompositeOperation="source-over",this._setFillStyle(e),this._context.fillRect(s,a,o,i)},Bitmap.prototype.strokeRectangle=function(t,e,n){var i,r,o,s,a,l;return null==n&&(n=y),a=F(e),l=n.radius,i=this._context,this.shouldPixelSnap(t)&&(o=n.lineWidth||1,a=this.pixelSnapRectangle(t,a),v(r=(s=o%2)<1?-s/2:s/2-1)||(a=a.grow(r))),this._setupDraw(t,n,!0)&&(l>0||P(l)?(i.beginPath(),N(i,a,l),i.stroke()):i.strokeRect(a.x,a.y,a.w,a.h),this._cleanupDraw(n)),this},Bitmap.prototype.strokeShape=function(t,e,n,i,r){var o,s,a,l,u;return o=this._context,this._setupDraw(t,e,!0)&&(_(n,r)?(this.shouldPixelSnap(t)&&(i=this.pixelSnapRectangle(t,i)),l=i.top,a=i.left,u=i.w,s=i.h,o.strokeRect(a,l,u,s)):(o.beginPath(),n(o,i,r),o.stroke()),this._cleanupDraw(e)),this},Bitmap.prototype.drawBorder=function(t,e,n){var i,r;return this._setupDraw(t,n,!0)&&(r=(n.padding||0)-(n.width||1)/2,i=F(e).grow(r),this._context.beginPath(),B(this._context,i),this._context.stroke(),this._cleanupDraw(n)),this},Bitmap.prototype.drawLine=function(t,e,n,i){var r;return null==i&&(i=y),r=this._context,this._setupDraw(t,i,!0)&&(r.beginPath(),T(r,e,n),r.stroke(),this._cleanupDraw(i)),this},Bitmap.prototype.drawRectangle=function(t,e,n){var i,r,o,s;return null==n&&(n=y),o=F(e),s=n.radius,r=n.fillRule,this.shouldPixelSnap(t)&&(o=this.pixelSnapRectangle(t,o)),i=this._context,this._setupDraw(t,n)&&(s>0||P(s)?(i.beginPath(),N(i,o,s),i.fill(r||"evenodd")):i.fillRect(o.x,o.y,o.w,o.h),this._cleanupDraw(n)),this},Bitmap.prototype.fillShape=function(t,e,n,i,r){var o,s,a,l,u;return o=this._context,this._setupDraw(t,e)&&(_(n,r)?(this.shouldPixelSnap(t)&&(i=this.pixelSnapRectangle(t,i)),l=i.top,a=i.left,u=i.w,s=i.h,o.fillRect(a,l,u,s)):(o.beginPath(),n(o,i,r),o.fill(e.fillRule||"evenodd")),this._cleanupDraw(e)),this},Bitmap.prototype.drawBitmap=function(t,n,i){var r,o,s,a,l,u,c,h,p,d,f,m,v,S,b,w;return null==i&&(i=y),d=g(),p=i.sourceArea,a=n,n.toMemoryDrawableBitmap&&(n=n.toMemoryDrawableBitmap()),n=n._canvas||n._htmlImageElement||n,l=a.size||M(a.width,a.height),this.shouldPixelSnap(t)?(b=(u=this.pixelSnapAndTransformRectangle(t,(null!=p?p.size:void 0)||l)).x,w=u.y,S=u.w,s=u.h,p?(m=D(p.x),v=D(p.y),f=D(p.w),h=D(p.h)):(m=v=0,f=l.x,h=l.y),this._setupDraw(null,i)&&(r=g(),this._context.drawImage(n,m,v,f,h,b,w,S,s),this._cleanupDraw(i))):this._setupDraw(t,i)&&(r=g(),p?(b=(c=p.intersection(F(a.size))).x,w=c.y,S=c.w,s=c.h,this._context.drawImage(n,b,w,S,s,0,0,S,s)):this._context.drawImage(n,0,0),this._cleanupDraw(i)),(o=g())-d>.1&&(e.slowDraw={target:this,source:n,where:t,options:i},k({Canvas_Bitmap_drawBitmap:{message:"details: global.slowDraw",slowDraw:(1e3*(o-d)|0)+"ms",time2:(1e3*(o-r)|0)+"ms",where:t,options:i,bitmapSize:[n._size,n.width,n.height]}})),this},Bitmap.prototype.drawText=function(t,e,n){return null==n&&(n=y),this._setupDraw(t,n)&&(this._context.font=(n.fontSize||n.size||16)+"px "+(n.fontFamily||n.family||"Arial")+", Arial",this._context.textAlign=n.align||"start",this._context.textBaseline=n.baseline||"alphabetic",this._context.fillText(e,0,0),this._cleanupDraw(n)),this},Bitmap.prototype.blur=function(t,e){var n;return n=e?this.clone():this,p.blur(this,t,n),n},8,Bitmap.prototype.fastBlur=function(t,e){return this._fastBlur("blur",t,e)},Bitmap.prototype.fastBlurRGB=function(t,e){return this._fastBlur("blurRGB",t,e)},Bitmap.prototype._fastBlur=function(t,e,n){var i,r,o,s,a,l,u,h,d;return e<=8?this[t](e,n):(s=e/8,u=8,h=(o=this.size).x,d=o.y,l=M(f(h/s),f(d/s)),a=this.newBitmap(l),i=c.scaleXY(l.x/this.size.x,l.y/this.size.y),r=c.scaleXY(this.size.x/l.x,this.size.y/l.y),a.drawBitmap(i,this),p[t](a,u,a),n?a:this.drawBitmap(r,a))},Bitmap.prototype.blurRGB=function(t,e){var n;return n=e?this.clone():this,p.blurRGB(this,t,n),n},Bitmap.prototype.blurAlpha=function(t,e){var n;return null==e&&(e=y),n=e.clone?this.clone():this,e.inverted?p.blurInvertedAlpha(this,t,n):p.blurAlpha(this,t,n),n},Bitmap.prototype._clearTransform=function(){return this._lastTransform=u,this._context.setTransform(1,0,0,1,0,0)},Bitmap.prototype._setTransform=function(t){return t?(this._lastTransform=t,C(t)?this._context.setTransform(1,0,0,1,t.x,t.y):this._context.setTransform(t.sx,t.shy,t.shx,t.sy,t.tx,t.ty)):this._clearTransform()},Bitmap.prototype._setStrokeStyle=function(t){return this._context.strokeStyle=t.toCanvasStyle?t.toCanvasStyle(this._context):t.toString()},Bitmap.prototype._setFillStyle=function(t){return this._context.fillStyle=t.toCanvasStyle?t.toCanvasStyle(this._context):t.toString()},Bitmap.prototype._getFillStyleFromOptions=function(t){var e,n,i,r,o,s,a,u,c;return(e=t.colors)?e.constructor===l?e:(n=null!=(a=t.from)?a:A,c=null!=(u=t.to)?u:this.size,s=t.radial,i=t.gradientRadius,r=t.gradientRadius1,o=t.gradientRadius2,s?new l(n,c,t.colors,!0):(null==r&&(r=i),null!=r&&null==o&&(o=r,r=0),new l(n,c,t.colors,r,o))):t.fillStyle||t.color||this.defaultColorString},Bitmap.prototype._setStrokeStyleFromOptions=function(t){var e,n,i,r,o;return this._setStrokeStyle(this._getFillStyleFromOptions(t)),r=t.lineWidth,e=t.lineCap,i=t.lineJoin,o=t.miterLimit,n=t.lineDash,this._context.setLineDash(n||[]),this._context.lineWidth=null!=r?r:r=1,this._context.lineCap=e||"butt",this._context.lineJoin=i||"miter",this._context.miterLimit=o||10,!v(r)},Bitmap.prototype._setFillStyleFromOptions=function(t){return this._setFillStyle(this._getFillStyleFromOptions(t))},Bitmap.prototype._setupDraw=function(t,e,n){var i,r,o,s,a,l,u,h;return o=e.compositeMode,u=e.shadow,l=e.opacity,n||(n=e.stroke),x(l)||(l=1),!(l<1/256)&&(i=this._context,!!(n?this._setStrokeStyleFromOptions(e):(this._setFillStyleFromOptions(e),!0))&&(o&&"normal"!==o&&(i.globalCompositeOperation=m[o]||m.normal),l<1&&(i.globalAlpha=l),u&&(r=u.blur,s=u.offsetX,a=u.offsetY,u.offset,h=u.color,i.shadowColor=L(h||"black"),s||(s=0),a||(a=0),w(t)?(r&&(r*=t.exactScaler),i.shadowOffsetX=c.transform1D(s,a,t.sx,t.shx,0),i.shadowOffsetY=c.transform1D(a,s,t.sy,t.shy,0)):(i.shadowOffsetX=s,i.shadowOffsetY=a),r&&(i.shadowBlur=r)),this._setTransform(t),!0))},Bitmap.prototype._cleanupDraw=function(t){var e,n,i,r;if(n=t.compositeMode,r=t.shadow,i=t.opacity,x(i)||(i=1),e=this._context,n&&"normal"!==n&&(e.globalCompositeOperation=m.normal),i<1&&(e.globalAlpha=1),r)return e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0},Bitmap}()}).call(this,n(5))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f={}.hasOwnProperty;i=n(313),r=n(160),i.point,p=i.rgbColor,i.point1,s=r.inspect,d=r.shallowClone,r.flatten,u=r.isPlainObject,r.log,a=r.isNumber,c=r.isString,l=r.isPlainArray,r.clone,r.min,r.floatEq,h=r.peek,r.arrayWith,o=r.bound,t.exports=function(t){var e;function GradientFillStyle(t,n,i,r,o){var s,a;this.from=t,this.to=n,this.radius1=r,this.radius2=o,(a=null!=i?i.stripes:void 0)&&(i=e(a,null!=(s=i.repetitions)?s:1)),this.setColors(this.inputColors=i)}return function(t,e){for(var n in e)f.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(GradientFillStyle,r.BaseObject),GradientFillStyle.colorsToObjectsAndColorObjects=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],u(e)?r.push({n:e.n,c:p(e.c)}):r.push({c:p(e)});return r},GradientFillStyle.colorsFromObjects=function(t){var e,n,i,r,o,s,l;for(l=[],i=0,o=t.length;i<o;i++)if(n=t[i],u(n))if(a(n.r))l.push(p(n));else if(a(n.n))l.push(n);else for(r in n)e=n[r],s=r-0,l.push({n:s,c:e});else l.push(n);return l},GradientFillStyle.interpolateColorPositionRange=function(t,e,n,i,r,o){var s,a,l,u,c,h;for(l=(o-r)/(i-n+1),h=[],s=a=u=n,c=i;u<=c?a<c:a>c;s=u<=c?++a:--a)h.push(t.push({c:e[s].c,n:(s-n+1)*l}));return h},GradientFillStyle.needToInterpolateColors=function(t){var e,n,i;for(i=!1,e=0,n=t.length;e<n;e++)if(null==t[e].n){i=!0;break}return i},GradientFillStyle.interpolateColorPositions=function(t){var e,n,i,r,o,s,a,l,u,c;if(!GradientFillStyle.needToInterpolateColors(t))return t;for(n=t[0],s=t[t.length-1],null==n.n&&(n={c:n.c,n:0}),null==s.n&&(s={c:s.c,n:1}),u=[n],c=n.n,r=0,i=o=0,a=t.length;o<a;i=++o)e=t[i],i>0&&(i===t.length-1&&(e=s),null!=(l=e.n)?(r>0&&(GradientFillStyle.interpolateColorPositionRange(u,t,i-r,i,c,l),r=0),c=l):r++);return u.push(s),u},GradientFillStyle.sortColorsByN=function(t){return t.sort(function(t,e){return t.n-e.n})},GradientFillStyle.normalizeColors=function(t){var e,n;return l(t)?this.sortColorsByN(this.interpolateColorPositions(this.colorsToObjectsAndColorObjects(this.colorsFromObjects(t)))):u(t)?(t=function(){var i;for(e in i=[],t)n=t[e],i.push({n:1*e,c:c(n)?n:String(p(n))});return i}(),this.interpolateColorPositions(this.sortColorsByN(t))):[{n:0,c:p("black"),n:1,c:p("white")}]},e=function(t,e){var n,i,r,o,s,a,l,u,c;if(o=(c={})[0]=t[0],c[1]=h(t),e>1)for(u=t,t=[];e>0;)t=t.concat(u),e--;for(i=r=0,s=(l=t=t.slice(1,t.length)).length;r<s;i=++r)n=l[i],c[a=(i+1)/(t.length+1)]=o,c[a+1e-4]=o=n;return c},GradientFillStyle.prototype.inspect2=function(){return"gradient(from:"+this.from+", to:"+this.to+", colors:"+s(this.inputColors)+")"},GradientFillStyle.clone=function(){return new GradientFillStyle(this.from,this.to,d(this.colors),this.radius1,this.radius2)},GradientFillStyle.getter({colors:function(){return this._colors},premultipliedColorPositions:function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this._colors).length;e<n;e++)t=i[e],r.push({n:t.n,c:p(t.c).premultiplied});return r}}),GradientFillStyle.setter({colors:function(t){var e,n;return this._colors=l(t)?GradientFillStyle.normalizeColors(t):u(t)?(t=function(){var i;for(e in i=[],t)n=t[e],i.push({n:1*e,c:c(n)?n:String(p(n))});return i}(),t=GradientFillStyle.sortColorsByN(t),GradientFillStyle.interpolateColorPositions(t)):[{n:0,c:p("black"),n:1,c:p("white")}]}}),GradientFillStyle.getter({inspectedObjects:function(){return{GradientFillStyle:{from:this.from,to:this.to,colors:this.colors,radius1:this.radius1,radius2:this.radius2}}}}),GradientFillStyle.prototype.getColorAt=function(t){var e,n,i,r,o,s,a,l,u,c;for(o=null,r=null,n=i=0,s=(u=this.colors).length;i<s;n=++i){if(e=(c=u[n]).c,t<=(a=c.n))return r?(l=a-o,p(r).interpolate(e,(t-o)/l)):e;r=e,o=a}return null},GradientFillStyle.prototype.toCanvasStyle=function(t){var e,n,i,r,s,a,l,u,c,h;for(t.context&&(t=t.context),i=this.from,r=this.to,n=function(){var e;return null!=this.radius1?(!0===this.radius1?(r=i,u=0,c=this.to.sub(this.from).magnitude):null!=this.radius2?(u=(e=this).radius1,c=e.radius2):(u=0,c=this.radius1),t.createRadialGradient(i.x,i.y,u,r.x,r.y,c)):t.createLinearGradient(i.x,i.y,r.x,r.y)}.call(this),s=0,a=(h=this._colors).length;s<a;s++){e=h[s],l=o(0,e.n,1);try{n.addColorStop(l,e.c.toString())}catch(t){t,n.addColorStop(l,"black")}}return n},GradientFillStyle}()},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;i=n(327),(o=n(313)).point,o.matrix,o.rect,o.color,r=(s=n(42)).defineModule,s.inspect,s.nextTick,e=n(96).BaseClass,n(330),r(t,function(){var t;return t=function(){return function BlurStack(){this.r=this.g=this.b=this.a=0,this.next=null}}(),i.StackBlur=function(n){function StackBlur(){return StackBlur.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(StackBlur,e),StackBlur.blur=function(t,e){return(new i.StackBlur).blur(t,e)},StackBlur.blurRGB=function(t,e){return(new i.StackBlur).blurRGB(t,e)},StackBlur.blurAlpha=function(t,e){return(new i.StackBlur).blurAlpha(t,e)},StackBlur.blurInvertedAlpha=function(t,e){return(new i.StackBlur).blurInvertedAlpha(t,e)},StackBlur.prototype.blur=function(t,e,n){var i,r;return n||(n=t),r=(i=t.getImageData()).data,(e=e+.5|0)>0&&this.stackBlurCanvasRGBA(r,t.size.w,t.size.h,e),n.putImageData(i)},StackBlur.prototype.blurRGB=function(t,e,n){var i,r;return n||(n=t),r=(i=t.getImageData()).data,(e=e+.5|0)>0&&this.stackBlurCanvasRGB(r,t.size.w,t.size.h,e),n.putImageData(i)},StackBlur.prototype.blurAlpha=function(t,e,n){var i,r;return n||(n=t),r=(i=t.getImageData()).data,(e=e+.5|0)>0&&this.stackBlurCanvasAlpha(r,t.size.w,t.size.h,e),n.putImageData(i)},StackBlur.prototype.blurInvertedAlpha=function(t,e,n){var i,r;return n||(n=t),r=(i=t.getImageData()).data,e=e+.5|0,this.invertAlpha(r,t.size.area),e>0&&this.stackBlurCanvasAlpha(r,t.size.w,t.size.h,e),n.putImageData(i)},StackBlur.prototype.invertAlpha=function(t,e){var n,i,r;for(i=0,(n=4*e-4)-n%8;i<=n;)t[i+3]=255-t[i+3],t[(i+=4)+3]=255-t[i+3],t[(i+=4)+3]=255-t[i+3],t[(i+=4)+3]=255-t[i+3],t[(i+=4)+3]=255-t[i+3],t[(i+=4)+3]=255-t[i+3],t[(i+=4)+3]=255-t[i+3],t[(i+=4)+3]=255-t[i+3],i+=4;for(r=[];i<=n;)t[i+3]=255-t[i+3],r.push(i+=4);return r},StackBlur.prototype.createStack=function(e){var n,i,r,o;for(this.stackStart=new t,o=this.stackStart,n=i=1,r=2*e;i<=r;n=i+=1)o=o.next=new t,n===e+1&&(this.stackEnd=o);return o.next=this.stackStart},StackBlur.prototype.rgbaPass=function(t,e,n,i,r,o){var s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U;for(b=1/(N=(I=t+1)*I),p=(N+I)/2,D=this.stackStart,z=this.stackEnd,w=0,R=[];w<=i;){for(E=d=u=s=0,_=e[w],C=e[w+1],P=e[w+2],(x=e[w+3])<255&&(_*=U=x/255,C*=U,P*=U),T=I*_,f=I*C,c=I*P,a=I*x,k=p*_,m=p*C,h=p*P,l=p*x,O=D,S=0,B=t;S<=B;S+=1)O.r=_,O.g=C,O.b=P,O.a=x,O=O.next;for(g=w+o,M=t,v=w+t*r,y=w+r;y<=v;)A=y,y>g&&(A=g),_=e[A],C=e[A+1],P=e[A+2],(x=e[A+3])<255&&(_*=U=x/255,C*=U,P*=U),E+=O.r=_,d+=O.g=C,u+=O.b=P,s+=O.a=x,k+=_*M,m+=C*M,h+=P*M,l+=x*M,M--,O=O.next,y+=r;for(L=z,F=I*r,y=w;y<=g;)e[y+3]=x=l*b,0!==x?(x=255*b/x,e[y]=k*x,e[y+1]=m*x,e[y+2]=h*x):e[y]=e[y+1]=e[y+2]=0,k-=T,m-=f,h-=c,l-=a,T-=O.r,f-=O.g,c-=O.b,a-=O.a,(A=y+F)>g&&(A=g),_=e[A],C=e[A+1],P=e[A+2],(x=e[A+3])<255&&(_*=U=x/255,C*=U,P*=U),k+=E+=O.r=_,m+=d+=O.g=C,h+=u+=O.b=P,l+=s+=O.a=x,T+=_=L.r,f+=C=L.g,c+=P=L.b,a+=x=L.a,E-=_,d-=C,u-=P,s-=x,O=O.next,L=L.next,y+=r;R.push(w+=n)}return R},StackBlur.prototype.rgbPass=function(t,e,n,i,r,o){var s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z;for(y=1/(z=(_=t+1)*_),u=(z+_)/2,R=this.stackStart,A=this.stackEnd,v=0,M=[];v<=i;){for(x=c=s=0,P=_*(w=e[v]),h=_*(b=e[v+1]),a=_*(S=e[v+2]),C=u*w,p=u*b,l=u*S,F=R,g=0,I=t;g<=I;g+=1)F.r=w,F.g=b,F.b=S,F=F.next;for(d=v+o,E=t,m=v+t*r,f=v+r;f<=m;)T=f,f>d&&(T=d),w=e[T],b=e[T+1],S=e[T+2],x+=F.r=w,c+=F.g=b,s+=F.b=S,C+=w*E,p+=b*E,l+=S*E,E--,F=F.next,f+=r;for(B=A,k=_*r,f=v;f<=d;)e[f]=C*y,e[f+1]=p*y,e[f+2]=l*y,C-=P,p-=h,l-=a,P-=F.r,h-=F.g,a-=F.b,(T=f+k)>d&&(T=d),w=e[T],b=e[T+1],S=e[T+2],C+=x+=F.r=w,p+=c+=F.g=b,l+=s+=F.b=S,P+=w=B.r,h+=b=B.g,a+=S=B.b,x-=w,c-=b,s-=S,F=F.next,B=B.next,f+=r;M.push(v+=n)}return M},StackBlur.prototype.alphaPass=function(t,e,n,i,r,o){var s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T;for(f=1/(T=(y=t+1)*y),u=(T+y)/2,E=this.stackStart,P=this.stackEnd,m=3,i+=3,x=[];m<=i;){for(s=0,a=y*(g=e[m]),l=u*g,C=E,d=0,w=t;d<=w;d+=1)C.a=g,C=C.next;for(c=m+o,v=t,p=m+t*r,h=m+r;h<=p;)S=h,h>c&&(S=c),g=e[S],s+=C.a=g,l+=g*v,v--,C=C.next,h+=r;for(_=P,b=y*r,h=m;h<=c;)e[h]=l*f,l-=a,a-=C.a,(S=h+b)>c&&(S=c),l+=s+=C.a=e[S],a+=g=_.a,s-=g,C=C.next,_=_.next,h+=r;x.push(m+=n)}return x},StackBlur.prototype.stackBlurCanvasRGBA=function(t,e,n,i){if(!(i<=0))return this.createStack(i),this.rgbaPass(i,t,4,4*(e-1),4*e,(n-1)*e*4),this.rgbaPass(i,t,4*e,(n-1)*e*4,4,4*(e-1))},StackBlur.prototype.stackBlurCanvasAlpha=function(t,e,n,i){if(!(i<=0))return this.createStack(i),this.alphaPass(i,t,4,4*(e-1),4*e,(n-1)*e*4),this.alphaPass(i,t,4*e,(n-1)*e*4,4,4*(e-1))},StackBlur.prototype.stackBlurCanvasRGB=function(t,e,n,i){if(!(i<=0))return this.createStack(i),this.rgbPass(i,t,4,4*(e-1),4*e,(n-1)*e*4),this.rgbPass(i,t,4*e,(n-1)*e*4,4,4*(e-1))},StackBlur}()})}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h;n(313).isRect,h=n(42),l=h.log,o=h.floatEq,c=h.min,u=h.max,s=h.isNumber,a=h.isPlainObject,h.isFunction,r=h.float32Eq0,i=h.bound,t.exports=function(){var t;function Paths(){}return Paths.linePath=function(t,e,n){return t.moveTo(e.x,e.y),t.lineTo(n.x,n.y)},Paths.circlePath=function(t,e,n){var i,r,o,s,a;return r=e.hCenter,s=e.vCenter,a=e.w,i=e.h,o=c(a,i)/2,t.arc(r,s,o,0,2*Math.PI,!0),t.closePath()},Paths.circlePath.obtuse=!0,Paths.rectanglePath=function(e,n,i){return t(e,n,null!=i?i.radius:void 0)},Paths.rectanglePath.obtuse=!0,Paths._rectanglePath=function(t,e){var n,i,r,o;return i=e.left,r=e.right,o=e.top,n=e.bottom,t.moveTo(i,o),t.lineTo(r,o),t.lineTo(r,n),t.lineTo(i,n),t.closePath()},Paths.roundedRectanglePath=t=function(t,e,n){var l,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A;return null==n||r(n)?Paths._rectanglePath(t,e):(a(n)?(_=n.tl,I=n.tr,l=n.bl,f=n.br,p=n.bottomLeft,d=n.bottomRight,T=n.topLeft,k=n.topRight,E=n.top,h=n.bottom,v=n.left,C=n.right,null==I&&(I=null!=(b=null!=k?k:E)?b:C),null==_&&(_=null!=(w=null!=T?T:E)?w:v),null==f&&(f=null!=(x=null!=d?d:h)?x:C),null==l&&(l=null!=(P=null!=p?p:h)?P:v)):_=I=l=f=n,r(_)&&r(I)&&r(l)&&r(f)?Paths._rectanglePath(t,e):(A=e.w,m=e.h,A=u(0,A),m=u(0,m),o(A,m)&&s(n)&&n>=(y=A/2)?(g=e.hCenter,M=e.vCenter,void t.arc(g,M,y,0,2*Math.PI,!0)):(S=c(A/2,m/2),l=i(0,l,S),f=i(0,f,S),_=i(0,_,S),I=i(0,I,S),v=e.left,C=e.right,E=e.top,h=e.bottom,t.moveTo(v,E+_),t.arcTo(v,E,v+_,E,_),t.lineTo(C-I,E),t.arcTo(C,E,C,E+I,I),t.lineTo(C,h-f),t.arcTo(C,h,C-f,h,f),t.lineTo(v+l,h),t.arcTo(v,h,v,h-l,l),t.closePath())))},Paths.roundedRectanglePath.obtuse=!0,Paths.roundedRectangle=function(e,n,i){return l.error("DEPRIACTED - use roundedRectanglePath"),t(e,n,i)},Paths.rectangle=function(t,e){var n,i,r,o;return l.error("DEPRIACTED - use rectanglePath"),i=e.left,r=e.right,o=e.top,n=e.bottom,t.moveTo(i,o),t.lineTo(r,o),t.lineTo(r,n),t.lineTo(i,n),t.closePath()},Paths.curriedRoundedRectangle=function(e,n){return l.error("DEPRICATED - use roundedRectanglePath && pathOptions"),function(i){return t(i,e,n)}},Paths}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v;(g=n(42)).present,h=g.isPlainObject,f=g.object,d=g.merge,a=g.defineModule,c=g.formattedInspect,p=g.log,v=g.timeout,o=g.Promise,l=g.each,u=g.find,g.objectWithout,m=n(313).point,e=n(334),y=n(160).Browser.DomElementFactories,i=y.Div,r=y.Link,s=y.Style,a(t,function(){var t,n,a;function FontLoader(){}return FontLoader.allFontsLoaded=function(t,e){var n,i;return n=0,new o((i=this,function(r,o){var s;return(s=function(){var o,l;try{return l=n>=1e3&&n%1e3==0,o=FontLoader.fontsLoadedSync(t,l,e),u(o,function(t){return!t})?(l&&a({waiting:{milliseconds:n,fonts:Object.keys(t)}}),i.allFontLoadsExpired(o,t,l,n)?r(o):(n+=25,v(25,s))):((n>=100||e)&&a({success:{milliseconds:n,fonts:Object.keys(t)}}),r(o))}catch(t){return a({allFontsLoaded:{error:t}})}})()})).then(function(t){return function(){return t._cleanup()}}(this))},FontLoader.allFontLoadsExpired=function(t,e,n,i){var r;return r=!0,l(e,{when:function(e,n){return!t[n]},with:function(t,e){var n,o,s,a;return a=null!=(s=t.timeout)?s:3e4,n=t.onTimeout,o=t.previouslyExpired,i>a?o?void 0:("function"==typeof n&&n({fontFamily:e,fontOptions:t,timeExpired:i,timeoutMs:a}),t.previouslyExpired=!0):r=!1}}),r},FontLoader.allFontsLoadedSync=function(t,e){var n,i;for(n in i=FontLoader.fontsLoadedSync(t,e))if(!i[n])return!1;return!0},FontLoader.fontsLoadedSync=function(t,e,n){return f(t,function(t,i){return FontLoader.fontLoaded(t,i,e,n)})},FontLoader.loadFonts=function(t){var e,n,o,l,u,c,p,f;if(!h(t))throw new Error("ArtCanvas.FontLoader.loadFonts: fonts should be an object");for(u in o=this.fontsLoadedSync(t,f),t)n=(c=t[u]).fontFamily,l=c.loadedTestText,e=c.css,p=c.url,f=c.verbose,o[n]||(l||(l="aA"),n||(n=u),f&&a({loading:d({fontFamily:n,css:e,url:p})}),e?document.head.appendChild(r({rel:"stylesheet",href:e})):p&&document.head.appendChild(s("@font-face { font-family: "+n+"; src: url('"+p+"'); } ")),document.body.appendChild(i({style:{fontFamily:n,position:"absolute",fontSize:"0"}},l)));return this.allFontsLoaded(t,f)},a=function(t){return p(c({ArtCanvasFontLoader:t}))},t=function(t,e,n,i,r,o){var s,l,u,c,h,p,d;return(s=t.context).font="12px sans serif",h=s.measureText(n).width,s.font="12px "+e+", sans serif",p=s.measureText(n).width,null!=i?(d=Math.abs(i-p)<.9,u=Math.abs(i-h)>.1,c=p!==h,l=d&&u&&c,(r||l&&o)&&a({loadedWidthBasedTest_with_expectedTestWidth:{fontFamily:e,loadedTestText:n,expectedTestWidth:i,testWidth:p,referenceWidth:h,upperBoundTest:d,lowerBoundTest:u,notEqual:c,loaded:l}}),l):(l=p>0&&p!==h,(r||l&&o)&&a({loadedWidthBasedTest:{fontFamily:e,loadedTestText:n,testWidth:p,referenceWidth:h,loaded:l}}),l)},n=null,FontLoader.fontLoaded=function(i,r,o,s){var a,l;if(l=i.loadedTestText,a=i.expectedTestWidth,null==l)throw new Error("loadedTestText required");return n||(n=new e(m(1))),t(n,r,l,a,o,s)},FontLoader._cleanup=function(){return n=null},FontLoader}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l={}.hasOwnProperty;r=n(160),Neptune.isNode||(o=n(340)),s=r.array,a=r.isArray,r.inspect,r.log,i=r.BatchLoader,t.exports=function(t){function GoogleFontLoader(t){var e;null==t&&(t={}),GoogleFontLoader.__super__.constructor.call(this,(e=this,function(t){return e._webFontLoadWithWaiting([t])}))}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(GoogleFontLoader,i),GoogleFontLoader.singletonClass(),GoogleFontLoader.load=function(t){return a(t)||(t=[t]),Promise.resolve(GoogleFontLoader._serializeLoadsPromise).then(function(){return GoogleFontLoader._serializeLoadsPromise=new Promise(function(e,n){return o.load({google:{families:GoogleFontLoader._googleFamilies(t)},fontactive:function(n){if(1===t.length)return e()},fontinactive:function(e){if(1===t.length)return n()},inactive:function(t){return n()},active:function(t){return e()}})})})},GoogleFontLoader._googleFamilies=function(t){return s(t,function(t){var e,n;return/:/.test(t)&&(t=(e=t.split(":"))[0],n=e[1]),t.split(" ").join("+")+":"+(null!=n?n:"")+":latin,latin-ext"})},GoogleFontLoader.prototype._webFontLoad=function(t,e){return o.load({google:{families:GoogleFontLoader._googleFamilies(t)},fontactive:(n=this,function(t){return n.addAsset(t,t)}),fontinactive:function(t){return function(e){return t.addAsset(e,"FAILED TO LOAD")}}(this),inactive:e,active:e});var n},GoogleFontLoader.prototype._webFontLoadWithWaiting=function(t){var e,n,i,r;{if(!window.WebFontConfig)return this._webFontLoad(t,(r=this,function(){var t;if(t=window.WebFontWaiting&&Object.keys(window.WebFontWaiting),window.WebFontWaiting=null,window.WebFontConfig=null,t)return r._webFontLoad(t)}));for(i=window.WebFontWaiting||(window.WebFontWaiting={}),e=0,n=t.length;e<n;e++)i[t[e]]=!0}},GoogleFontLoader}()},function(e,n,i){var r;!function(){function aa(t,e,n){return t.call.apply(t.bind,arguments)}function ba(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function p(t,e,n){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba).apply(null,arguments)}var o=Date.now||function(){return+new Date};var s=!!window.FontFace;function t(t,e,n,i){if(e=t.c.createElement(e),n)for(var r in n)n.hasOwnProperty(r)&&("style"==r?e.style.cssText=n[r]:e.setAttribute(r,n[r]));return i&&e.appendChild(t.c.createTextNode(i)),e}function u(t,e,n){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(n,t.lastChild)}function v(t){t.parentNode&&t.parentNode.removeChild(t)}function w(t,e,n){e=e||[],n=n||[];for(var i=t.className.split(/\s+/),r=0;r<e.length;r+=1){for(var o=!1,s=0;s<i.length;s+=1)if(e[r]===i[s]){o=!0;break}o||i.push(e[r])}for(e=[],r=0;r<i.length;r+=1){for(o=!1,s=0;s<n.length;s+=1)if(i[r]===n[s]){o=!0;break}o||e.push(i[r])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function y(t,e){for(var n=t.className.split(/\s+/),i=0,r=n.length;i<r;i++)if(n[i]==e)return!0;return!1}function z(e,n,i){function d(){l&&r&&o&&(l(a),l=null)}n=t(e,"link",{rel:"stylesheet",href:n,media:"all"});var r=!1,o=!0,a=null,l=i||null;s?(n.onload=function(){r=!0,d()},n.onerror=function(){r=!0,a=Error("Stylesheet failed to load"),d()}):setTimeout(function(){r=!0,d()},0),u(e,"head",n)}function A(e,n,i,r){var o=e.c.getElementsByTagName("head")[0];if(o){var s=t(e,"script",{src:n}),a=!1;return s.onload=s.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,i&&i(null),s.onload=s.onreadystatechange=null,"HEAD"==s.parentNode.tagName&&o.removeChild(s))},o.appendChild(s),setTimeout(function(){a||(a=!0,i&&i(Error("Script load timeout")))},r||5e3),s}return null}function B(){this.a=0,this.c=null}function C(t){return t.a++,function(){t.a--,D(t)}}function E(t,e){t.c=e,D(t)}function D(t){0==t.a&&t.c&&(t.c(),t.c=null)}function F(t){this.a=t||"-"}function G(t,e){this.c=t,this.f=4,this.a="n";var n=(e||"n4").match(/^([nio])([1-9])$/i);n&&(this.a=n[1],this.f=parseInt(n[2],10))}function I(t){var e=[];t=t.split(/,\s*/);for(var n=0;n<t.length;n++){var i=t[n].replace(/['"]/g,"");-1!=i.indexOf(" ")||/^\d/.test(i)?e.push("'"+i+"'"):e.push(i)}return e.join(",")}function J(t){return t.a+t.f}function H(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function ga(t){var e=4,n="n",i=null;return t&&((i=t.match(/(normal|oblique|italic)/i))&&i[1]&&(n=i[1].substr(0,1).toLowerCase()),(i=t.match(/([1-9]00|normal|bold)/i))&&i[1]&&(/bold/i.test(i[1])?e=7:/[1-9]00/.test(i[1])&&(e=parseInt(i[1].substr(0,1),10)))),n+e}function L(t){if(t.g){var e=y(t.f,t.a.c("wf","active")),n=[],i=[t.a.c("wf","loading")];e||n.push(t.a.c("wf","inactive")),w(t.f,n,i)}K(t,"inactive")}function K(t,e,n){t.j&&t.h[e]&&(n?t.h[e](n.c,J(n)):t.h[e]())}function M(e,n){this.c=e,this.f=n,this.a=t(this.c,"span",{"aria-hidden":"true"},this.f)}function N(t){u(t.c,"body",t.a)}function O(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+I(t.c)+";font-style:"+H(t)+";font-weight:"+t.f+"00;"}function P(t,e,n,i,r,o){this.g=t,this.j=e,this.a=i,this.c=n,this.f=r||3e3,this.h=o||void 0}function Q(t,e,n,i,r,o,s){this.v=t,this.B=e,this.c=n,this.a=i,this.s=s||"BESbswy",this.f={},this.w=r||3e3,this.u=o||null,this.m=this.j=this.h=this.g=null,this.g=new M(this.c,this.s),this.h=new M(this.c,this.s),this.j=new M(this.c,this.s),this.m=new M(this.c,this.s),t=O(t=new G(this.a.c+",serif",J(this.a))),this.g.a.style.cssText=t,t=O(t=new G(this.a.c+",sans-serif",J(this.a))),this.h.a.style.cssText=t,t=O(t=new G("serif",J(this.a))),this.j.a.style.cssText=t,t=O(t=new G("sans-serif",J(this.a))),this.m.a.style.cssText=t,N(this.g),N(this.h),N(this.j),N(this.m)}F.prototype.c=function(t){for(var e=[],n=0;n<arguments.length;n++)e.push(arguments[n].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},P.prototype.start=function(){var t=this.c.o.document,e=this,n=o(),i=new Promise(function(i,r){!function f(){o()-n>=e.f?r():t.fonts.load(function fa(t){return H(t)+" "+t.f+"00 300px "+I(t.c)}(e.a),e.h).then(function(t){1<=t.length?i():setTimeout(f,25)},function(){r()})}()}),r=null,s=new Promise(function(t,n){r=setTimeout(n,e.f)});Promise.race([s,i]).then(function(){r&&(clearTimeout(r),r=null),e.g(e.a)},function(){e.j(e.a)})};var a={D:"serif",C:"sans-serif"},l=null;function T(){if(null===l){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);l=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return l}function la(t,e,n){for(var i in a)if(a.hasOwnProperty(i)&&e===t.f[a[i]]&&n===t.f[a[i]])return!0;return!1}function U(t){var e,n=t.g.a.offsetWidth,i=t.h.a.offsetWidth;(e=n===t.f.serif&&i===t.f["sans-serif"])||(e=T()&&la(t,n,i)),e?o()-t.A>=t.w?T()&&la(t,n,i)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?V(t,t.v):V(t,t.B):function ma(t){setTimeout(p(function(){U(this)},t),50)}(t):V(t,t.v)}function V(t,e){setTimeout(p(function(){v(this.g.a),v(this.h.a),v(this.j.a),v(this.m.a),e(this.a)},t),0)}function W(t,e,n){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=n}Q.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=o(),U(this)};var c=null;function na(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&w(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),K(t,"active")):L(t.a))}function oa(t){this.j=t,this.a=new function ja(){this.c={}},this.h=0,this.f=this.g=!0}function qa(t,e,n,i,r){var o=0==--t.h;(t.f||t.g)&&setTimeout(function(){var t=r||null,s=i||{};if(0===n.length&&o)L(e.a);else{e.f+=n.length,o&&(e.j=o);var a,l=[];for(a=0;a<n.length;a++){var u=n[a],h=s[u.c],d=e.a,f=u;if(d.g&&w(d.f,[d.a.c("wf",f.c,J(f).toString(),"loading")]),K(d,"fontloading",f),d=null,null===c)if(window.FontFace){f=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var m=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);c=f?42<parseInt(f[1],10):!m}else c=!1;d=c?new P(p(e.g,e),p(e.h,e),e.c,u,e.s,h):new Q(p(e.g,e),p(e.h,e),e.c,u,e.s,t,h),l.push(d)}for(a=0;a<l.length;a++)l[a].start()}},0)}function ra(t,e){this.c=t,this.a=e}function sa(t,e){this.c=t,this.a=e}W.prototype.g=function(t){var e=this.a;e.g&&w(e.f,[e.a.c("wf",t.c,J(t).toString(),"active")],[e.a.c("wf",t.c,J(t).toString(),"loading"),e.a.c("wf",t.c,J(t).toString(),"inactive")]),K(e,"fontactive",t),this.m=!0,na(this)},W.prototype.h=function(t){var e=this.a;if(e.g){var n=y(e.f,e.a.c("wf",t.c,J(t).toString(),"active")),i=[],r=[e.a.c("wf",t.c,J(t).toString(),"loading")];n||i.push(e.a.c("wf",t.c,J(t).toString(),"inactive")),w(e.f,i,r)}K(e,"fontinactive",t),na(this)},oa.prototype.load=function(t){this.c=new function ca(t,e){this.a=t,this.o=e||t,this.c=this.o.document}(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function pa(t,e,n){var i=[],r=n.timeout;!function ia(t){t.g&&w(t.f,[t.a.c("wf","loading")]),K(t,"loading")}(e);var i=function ka(t,e,n){var i,r=[];for(i in e)if(e.hasOwnProperty(i)){var o=t.c[i];o&&r.push(o(e[i],n))}return r}(t.a,n,t.c),o=new W(t.c,e,r);for(t.h=i.length,e=0,n=i.length;e<n;e++)i[e].load(function(e,n,i){qa(t,o,e,n,i)})}(this,new function ha(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new F("-"),this.j=!1!==e.events,this.g=!1!==e.classes}(this.c,t),t)},ra.prototype.load=function(t){var e=this,n=e.a.projectId,i=e.a.version;if(n){var r=e.c.o;A(this.c,(e.a.api||"https://fast.fonts.net/jsapi")+"/"+n+".js"+(i?"?v="+i:""),function(i){i?t([]):(r["__MonotypeConfiguration__"+n]=function(){return e.a},function b(){if(r["__mti_fntLst"+n]){var e,i=r["__mti_fntLst"+n](),o=[];if(i)for(var s=0;s<i.length;s++){var a=i[s].fontfamily;void 0!=i[s].fontStyle&&void 0!=i[s].fontWeight?(e=i[s].fontStyle+i[s].fontWeight,o.push(new G(a,e))):o.push(new G(a))}t(o)}else setTimeout(function(){b()},50)}())}).id="__MonotypeAPIScript__"+n}else t([])},sa.prototype.load=function(t){var e,n,i=this.a.urls||[],r=this.a.families||[],o=this.a.testStrings||{},s=new B;for(e=0,n=i.length;e<n;e++)z(this.c,i[e],C(s));var a=[];for(e=0,n=r.length;e<n;e++)if((i=r[e].split(":"))[1])for(var l=i[1].split(","),u=0;u<l.length;u+=1)a.push(new G(i[0],l[u]));else a.push(new G(i[0]));E(s,function(){t(a,o)})};var h="https://fonts.googleapis.com/css";var m={latin:"BESbswy","latin-ext":"",cyrillic:"",greek:"",khmer:"",Hanuman:""},g={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},S={i:"i",italic:"i",n:"n",normal:"n"},x=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Ea(t,e){this.c=t,this.a=e}var _={Arimo:!0,Cousine:!0,Tinos:!0};function Ga(t,e){this.c=t,this.a=e}function Ha(t,e){this.c=t,this.f=e,this.a=[]}Ea.prototype.load=function(t){var e=new B,n=this.c,i=new function ta(t,e){this.c=t||h,this.a=[],this.f=[],this.g=e||""}(this.a.api,this.a.text),r=this.a.families;!function va(t,e){for(var n=e.length,i=0;i<n;i++){var r=e[i].split(":");3==r.length&&t.f.push(r.pop());var o="";2==r.length&&""!=r[1]&&(o=":"),t.a.push(r.join(o))}}(i,r);var o=new function ya(t){this.f=t,this.a=[],this.c={}}(r);!function Da(t){for(var e=t.f.length,n=0;n<e;n++){var i=t.f[n].split(":"),r=i[0].replace(/\+/g," "),o=["n4"];if(2<=i.length){var s;if(s=[],a=i[1])for(var a,l=(a=a.split(",")).length,u=0;u<l;u++){var c;if((c=a[u]).match(/^[\w-]+$/))if(null==(p=x.exec(c.toLowerCase())))c="";else{if(c=null==(c=p[2])||""==c?"n":S[c],null==(p=p[1])||""==p)p="4";else var h=g[p],p=h||(isNaN(p)?"4":p.substr(0,1));c=[c,p].join("")}else c="";c&&s.push(c)}0<s.length&&(o=s),3==i.length&&(s=[],0<(i=(i=i[2])?i.split(","):s).length&&(i=m[i[0]])&&(t.c[r]=i))}for(t.c[r]||(i=m[r])&&(t.c[r]=i),i=0;i<o.length;i+=1)t.a.push(new G(r,o[i]))}}(o),z(n,function wa(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,n=[],i=0;i<e;i++)n.push(t.a[i].replace(/ /g,"+"));return e=t.c+"?family="+n.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(i),C(e)),E(e,function(){t(o.a,o.c,_)})},Ga.prototype.load=function(t){var e=this.a.id,n=this.c.o;e?A(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",function(e){if(e)t([]);else if(n.Typekit&&n.Typekit.config&&n.Typekit.config.fn){e=n.Typekit.config.fn;for(var i=[],r=0;r<e.length;r+=2)for(var o=e[r],s=e[r+1],a=0;a<s.length;a++)i.push(new G(o,s[a]));try{n.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(i)}},2e3):t([])},Ha.prototype.load=function(t){var e=this.f.id,n=this.c.o,i=this;e?(n.__webfontfontdeckmodule__||(n.__webfontfontdeckmodule__={}),n.__webfontfontdeckmodule__[e]=function(e,n){for(var r=0,o=n.fonts.length;r<o;++r){var s=n.fonts[r];i.a.push(new G(s.name,ga("font-weight:"+s.weight+";font-style:"+s.style)))}t(i.a)},A(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function ea(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",function(e){e&&t([])})):t([])};var k=new oa(window);k.a.c.custom=function(t,e){return new sa(e,t)},k.a.c.fontdeck=function(t,e){return new Ha(e,t)},k.a.c.monotype=function(t,e){return new ra(e,t)},k.a.c.typekit=function(t,e){return new Ga(e,t)},k.a.c.google=function(t,e){return new Ea(e,t)};var R={load:p(k.load,k)};void 0===(r=function(){return R}.call(n,i,n,e))||(e.exports=r)}()},function(t,e,n){t.exports=n(342)},function(t,e,n){(t.exports=n(343)).includeInNamespace(n(359)).addModules({Config:n(412),DefaultProps:n(415),FullScreenApp:n(452),Macros:n(470),NormalizeProps:n(414),StandardImport:n(382)}),n(403),n(360),n(384),n(434),n(471),n(449),n(393)},function(t,e,n){t.exports=n(344).addNamespace("Engine",class Engine extends Neptune.PackageNamespace{}._configureNamespace(n(345))),n(346),n(347),n(350),n(355),n(356),n(357),n(358)},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Art"),n(343)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","bugs":"https:/github.com/art-suite/art-engine/issues","dependencies":{"art-atomic":"*","art-build-configurator":"*","art-canvas":"git://github.com/imikimi/art-canvas.git","art-events":"*","art-foundation":"git://github.com/imikimi/art-foundation.git","art-frame-stats":"*","art-text":"*","art-xbd":"*","javascript-detect-element-resize":"^0.5.3","keyboardevent-key-polyfill":"^1.0.2"},"description":"The ArtEngine is a layout, rendering and event engine for creating user interfaces in HTML5 Canvas elements.","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","coffee-loader":"^0.7.3","css-loader":"^3.0.0","json-loader":"^0.5.7","mocha":"^6.2.0","mock-fs":"^4.10.0","script-loader":"^0.7.2","style-loader":"^1.0.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"homepage":"https://github.com/art-suite/art-engine","license":"ISC","name":"art-engine","repository":{"url":"https://github.com/art-suite/art-engine."},"scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"4.4.4"}')},function(t,e,n){t.exports=n(343).addNamespace("Animation",class Animation extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(343).addNamespace("Core",class Core extends Neptune.PackageNamespace{}),n(348),n(349)},function(t,e,n){t.exports=n(347).addNamespace("Drawing",class Drawing extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(347).addNamespace("EpochLayout",class EpochLayout extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(343).addNamespace("Elements",class Elements extends Neptune.PackageNamespace{}),n(351),n(352),n(353),n(354)},function(t,e,n){t.exports=n(350).addNamespace("Filters",class Filters extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(350).addNamespace("ShapeChildren",class ShapeChildren extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(350).addNamespace("Shapes",class Shapes extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(350).addNamespace("Widgets",class Widgets extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(343).addNamespace("Events",class Events extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(343).addNamespace("File",class File extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(343).addNamespace("Forms",class Forms extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(343).addNamespace("Layout",class Layout extends Neptune.PackageNamespace{})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(360),n(384),n(403),n(449),n(393),{GestureRecognizer:n(434).GestureRecognizer,createGestureRecognizer:n(434).GestureRecognizer.createGestureRecognizer}])}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(347)).includeInNamespace(n(361)).addModules({AnimatedElementMixin:n(402),CanvasElement:n(447),Element:n(390),ElementBase:n(398),ElementFactory:n(399),EpochedElementMixin:n(401),EventedElementMixin:n(400),GlobalEpochCycle:n(362),IdleEpoch:n(445),Lib:n(383),NamedElementPropValues:n(413),SourceToBitmapCache:n(446),StandardImport:n(381),StateEpoch:n(373)}),n(407),n(448)},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>{let t;return n(362),n(407),({merge:t}=n(42)),(()=>{let e,i,r;return t((({newElement:e,getElementClassNames:i}=n(399)),{newElement:e,getElementClassNames:i}),(({sourceToBitmapCache:r}=n(446)),{sourceToBitmapCache:r}),{DrawCacheManager:n(380)},n(380),n(383))})()})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{let t;return i.importInvoke(["registerStatColor","registerEventColors","Epoch","arrayWithout","startFrameTimer","endFrameTimer"],[e,n(42),n(124),t=n(363)],(e,r,o,s,a,l)=>{let u,c,h,p,d,f;return u=n(373).stateEpoch,c=n(116).EventEpoch.eventEpoch,h=n(379).drawEpoch,p=n(445).idleEpoch,e("#1","idle"),e("#39c","draw"),e("#9c3","aim","redrawCheck","textLayout","aimLayout","stateEpoch"),e("gold","react","reactUpdate","reactCreate","reactRender"),e("#d936a3","flux"),e("#ff6347","event"),r({generateDrawCache:"green",animation:"#77f",animationAborted:"#f77",animationDone:"#77f",default:"gray"}),({dummyEpoch:d}=f=i.defClass(class DummyEpoch extends o{},function(t,e,n){this.singletonClass()})),i.defClass(class GlobalEpochCycle extends o{constructor(){super(...arguments),this.cycleQueued=!1,this._processingCycle=!1,this.activeCanvasElements=[],d.queueNextEpoch=p.queueNextEpoch=u.queueNextEpoch=h.queueNextEpoch=c.queueNextEpoch=(()=>this.queueNextEpoch()),this.subEpochs={idle:p,event:c,aim:u,draw:h,react:d,flux:d},c.logEvent=t.logFrameEvent}},function(e,n,r){this.singletonClass(),this.classGetter({activeCanvasElements:function(){return this.globalEpochCycle.activeCanvasElements}}),this.getter({numActivePointers:function(){let t;return t=0,i.each2(this.activeCanvasElements,e=>t+=e.getNumActivePointers()),t},idle:function(){return 0===this.subEpochs.react.getEpochLength()&&0===this.subEpochs.aim.getEpochLength()&&0===this.subEpochs.event.getEpochLength()},epochLength:function(){let t,e,n;if(t=0,n=e=this.subEpochs,null!=e)for(let n in e){let i;t+=(i=e[n]).getEpochLength()}return t}}),this.getter({idleEpoch:function(){return this.subEpochs.idle},eventEpoch:function(){return this.subEpochs.event},stateEpoch:function(){return this.subEpochs.aim},drawEpoch:function(){return this.subEpochs.draw},reactEpoch:function(){return this.subEpochs.react},fluxEpoch:function(){return this.subEpochs.flux}}),this.prototype.includeReact=function(t){return(this.subEpochs.react=t).queueNextEpoch=(()=>this.queueNextEpoch())},this.prototype.includeFlux=function(t){return(this.subEpochs.flux=t).queueNextEpoch=(()=>this.queueNextEpoch())},this.prototype.detachCanvasElement=function(t){return this.activeCanvasElements=s(this.activeCanvasElements,t)},this.prototype.attachCanvasElement=function(t){return this.activeCanvasElements.push(t)},this.prototype.flushEpochNow=function(){return this._processingCycle?void 0:(this._processingCycle=!0,this._processCycleExceptDraw(),this._processingCycle=!1)},this.prototype.processEpochItems=function(e){let n,i;if(t.startFrame(),this._processingCycle=!0,i=n=this.subEpochs,null!=n)for(let t in n){let e;(e=n[t])._frameSecond=this._frameSecond}return this._processCycleExceptDraw(),this.subEpochs.aim.getEpochLength()>0&&this._processSubEpoch("aim"),this._processSubEpoch("draw"),this.getEpochLength()>0&&this.queueNextEpoch(),this._processingCycle=!1,t.endFrame()},this.prototype._processSubEpoch=function(t){return a(t),this.subEpochs[t].processEpoch(),l()},this.prototype._processCycleExceptDraw=function(){return this._processSubEpoch("event"),this._processSubEpoch("flux"),this.getIdle()&&this._processSubEpoch("idle"),this._processSubEpoch("react"),this._processSubEpoch("aim")}})})})}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(364))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(365)).includeInNamespace(n(367)).addModules({FrameSampleSet:n(372),FrameStatStorage:n(371),Main:n(368),StandardImport:n(369),Style:n(370)})},function(t,e,n){t.exports=n(18).addNamespace("Art.FrameStats",class FrameStats extends Neptune.PackageNamespace{}._configureNamespace(n(366)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC\\"","dependencies":{"art-build-configurator":"*"},"description":"Art.Frame.Stats","license":"ISC","name":"art-frame-stats","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"1.2.1"}')},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>{let t,e,i,r,o,s,a,l,u,c,h,p;return[(({enableFrameStats:t,disableFrameStats:e,getFrameStatsEnabled:i,startFrame:r,endFrame:o,startFrameTimer:s,endFrameTimer:a,logFrameEvent:l,logEvent:u}=n(368)),{enableFrameStats:t,disableFrameStats:e,getFrameStatsEnabled:i,startFrame:r,endFrame:o,startFrameTimer:s,endFrameTimer:a,logFrameEvent:l,logEvent:u}),(({registerStatColor:c,registerEventColors:h}=n(370)),{registerStatColor:c,registerEventColors:h}),(({frameStatStorage:p}=n(371)),{frameStatStorage:p})]})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","currentSecond","log","Style"],[e,n(369),{Style:n(370)}],(t,e,r,o)=>{return i.defClass(class Main extends Object{},function(i,s,a){let l;l=n(371).frameStatStorage,this.enabled=!1,this._resetFrameTimers=(()=>(this._frameStartTime=e(),this._subtimerElapsedTimes=[],this._timerNames=[],this._timerStartTimes=[],this._sampleSet={})),this._resetFrameTimers(),this.getFrameStatsEnabled=(()=>this.enabled),this.enableFrameStats=(()=>(l.reset(),this.enabled=!0)),this.disableFrameStats=(()=>this.enabled=!1),this.startFrame=(()=>this.enabled?(l.startFrame(),this._resetFrameTimers(),this._frameStartTime=e(),this._sampleSet={}):void 0),this.endFrame=(()=>this.enabled?l.addFrame(this._frameStartTime,e()-this._frameStartTime,this._sampleSet):void 0),this.logEvent=((t,e)=>this.enabled?(r.warn("ArtFrameStats 'logEvent' is DEPRICATED - use logFrameEvent"),this.logFrameEvent(t,e)):void 0),this.logFrameEvent=((t,e)=>this.enabled?l.logEvent(t,e):void 0),this.startFrameTimer=((t,n)=>{let i;return this.enabled?(o.statColors[t]||o.registerStatColor(null!=n?n:"pink",t),this._timerNames.push(t),this._timerStartTimes.push(i=e()),this._subtimerElapsedTimes.push(0),i):void 0}),this.endFrameTimer=(()=>{let t,n,i,r,o,s;return this.enabled?(t=this._timerNames.pop(),n=this._timerStartTimes.pop(),i=this._subtimerElapsedTimes.pop(),r=e()-n,0<(o=this._subtimerElapsedTimes.length)&&(this._subtimerElapsedTimes[o-1]+=r),this._sampleSet[t]=(null!=(s=this._sampleSet[t])?s:0)+(r-i),r):void 0}),null!=t().perfGraphs&&this.enableFrameStats()})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(42).mergeWithSelf(n(96),n(313),n(325)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["rgbColor"],[e,n(369)],t=>{return i.defClass(class Style extends Object{},function(e,n,r){this.legendWidth=100,this.namedEventColors={},this.statFields=["total"],this.statColors={total:"gray"},this.normalizeFrameTimes=!0,this.registerStatColor=((e,...n)=>{let r,o,s,a;return a=this,r=this.statFields,o=this.statColors,e=t(e),i.array(n,t=>r.push(t),t=>!o[t]),s=.5/n.length,i.object(n,(t,n)=>e.withScaledLightness(1-s*n),null,o),this}),this.registerEventColors=(t=>(i.object(t,null,null,this.namedEventColors),this))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{let t=e.Math;return i.importInvoke(["BaseClass","toInspectedObjects","currentSecond","FrameSampleSet","max","Style","min","timeout","log","point","Matrix","floor","rect","Bitmap"],[e,t,n(369),{Style:n(370),FrameSampleSet:n(372)}],(t,e,r,o,s,a,l,u,c,h,p,d,f,m)=>{return i.defClass(class FrameStatStorage extends t{constructor(){super(...arguments),this.reset()}},function(t,g,y){let v,S;this.singletonClass(),this.prototype.reset=function(){return this.maxMs=1.1/60,this.stats=[],this.nextEventIdIndex=0,this.eventsById={},this.eventLegend={},this._minSampleTime=null,this._maxSampleTime=null},this.getter("minSampleTime","maxSampleTime",{sampleTimeRange:function(){return this.maxSampleTime-this.minSampleTime},inspectedObjects:function(){return{maxMs:this.maxMs,nextEventIdIndex:this.nextEventIdIndex,eventsById:this.eventsById,eventLegend:this.eventLegend,minSampleTime:this.minSampleTime,maxSampleTime:this.maxSampleTime,stats:e(this.stats)}}}),this.prototype.startFrame=function(){return this._minSampleTime?void 0:this._minSampleTime=this._maxSampleTime=r()},this.prototype.addFrame=function(t,e,n){return this.stats.push(new o(t,e,n)),this.maxMs=s(this.maxMs,1.5*e),this._logAndResetWhenIdle(),this._addSampleTime(t),this._addSampleTime(t+s(e,1/60))},this.prototype.logEvent=function(t,e){let n,i,o,u;return n=r(),null!=e||(e=t),this._addSampleTime(n),i=a.namedEventColors[t]||a.namedEventColors.default,(o=(u=this.eventsById)[e]||(u[e]={name:t,color:i,startTime:n,endTime:n,index:this.nextEventIdIndex++,events:[]})).startTime=l(n,o.startTime),o.endTime=s(n,o.endTime),this.eventLegend[t]=i,o.events.push({name:t,color:i,time:n})},this.prototype._addSampleTime=function(t){return this._minSampleTime=l(t,this._minSampleTime||t),this._maxSampleTime=s(t,this._maxSampleTime||t)},this.prototype._logAndResetWhenIdle=function(){let t;return 0<(t=this.stats.length)?u(1e3,()=>t===this.stats.length&&n(368).getFrameStatsEnabled()?(this.stats.length>0&&c(this.drawGraph(h(1e3,600))),this.reset()):void 0):void 0},this.getter("drawMatrix"),v=function(){return a.legendWidth+5},S=function(t){return t-v()},this.prototype.getSampleWidth=function(t){return s(1,t/this.sampleTimeRange/60-1)},this.prototype.getDrawMatrix=function({w:t,h:e}){let n,i,r,o,s,a,l,u;return u=this,n=this.sampleTimeRange,i=this.minSampleTime,r=this.maxMs,o=S(t),s=this.getSampleWidth(o),a=o/n,l=e/r,p.scaleXY(1,-1).translateXY(-i,0).scaleXY(a,l).translateXY(v(),e)},this.prototype.drawAllSamplesForOneField=function(t,e){let n,r,o,s,a,l,u,c;return u=this,n=this.sampleTimeRange,r=this.stats,o=this.drawMatrix,s=(c=t.size).w,a=c.h,l=this.getSampleWidth(S(s)),i.each2(r,n=>n.drawSample(t,o,l,e,a))},this.prototype.normalizeFrameTimes=function(){let t,e;return t=i.exists(e=this.stats[0])&&e.sampleTime,i.each2(this.stats,e=>{let n,i;return i=(60*((n=e.sampleTime)-t)|0)/60+t,e.sampleTime=i})},this.prototype.drawLabeledHRule=function(t,e,n,i){return this.drawLabeledHLineFromTimes(t,this._minSampleTime,this._maxSampleTime,e,n,i)},this.prototype.drawLabeledHLineFromTimes=function(t,e,n,i,r,o){let s,a,l,u;return s=this.drawMatrix,a=d(s.transformX(e,0)),l=d(s.transformX(n,0)),i=d(i),t.drawRectangle(null,f(a,i,l-a,1),u={color:r}),t.drawText(h(a,i-5),o,{size:[14,u]})},this.prototype.drawEvents=function(t,e){let n,r,o,s,a;return n=(a=t.size).w,r=a.h,o=this._drawMatrix,s=d(r/20),i.each2(e,({index:e,startTime:n,endTime:r,color:a,events:l,name:u},c)=>{let h;return this.drawLabeledHLineFromTimes(t,n,r,h=(e+1)*s,a,u),i.each2(l,({time:e,name:n,color:i})=>{let r;return r=d(o.transformX(e,0)),t.drawRectangle(null,f(r,h,1,1*s/3),{color:i})})})},this.prototype.drawGraph=function(t){let e,r,o,s,l,u,c,h,p,d,f;return f=this,e=this.stats,r=this.sampleTimeRange,o=this.eventsById,s=new m(t),a.normalizeFrameTimes&&this.normalizeFrameTimes(),this._drawMatrix=l=this.getDrawMatrix(t),c=r/(u=e.length),p=(h=60*r+.5|0)-u,s.clear("#f"),i.each2(n(370).statFields,t=>this.drawAllSamplesForOneField(s,t)),this.drawLabeledHRule(s,l.transformY(0,.01),"#0007","10ms"),this.drawLabeledHRule(s,l.transformY(0,.005),"#0007","5ms"),this.drawEvents(s,o),this.drawLabeledHRule(s,l.transformY(0,1/60),"green",55>(d=1/c+.5|0)?"60fps - 16.7ms":""),this.drawLabeledHRule(s,l.transformY(0,c),"#0007",`average: ${i.toString(d)}fps (miss-rate: ${i.toString((100*p/h).toPrecision(2))}% ${i.toString(p)}/${i.toString(h)})`),this._drawLegend(s),s.drawBorder(null,s.size,"#e"),s},this.prototype._drawLegend=function(t){let e,r,o,s,a;return e=(a=n(370)).statFields,r=a.statColors,o=a.legendWidth,s=0,i.each2(e,e=>(t.drawRectangle(null,f(0,s,o,23),{color:r[e]}),t.drawText(h(5,s+18),e,{size:16,color:"white"}),s+=25))}})})})}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","Style","rect"],[e,n(369),{Style:n(370)}],(t,e,n)=>{return i.defClass(class FrameSampleSet extends t{constructor(t,e,n){super(...arguments),this.sampleTime=t,this.total=e,this.sampleSet=n}},function(t,i,r){this.getter({inspectedObjects:function(){return{sampleTime:this.sampleTime,total:this.total,sampleSet:this.sampleSet}}}),this.prototype.getStacked=function(t){let n,i,r,o;if("total"===t)return this.total;if(n=0,r=i=e.statFields,null!=i)for(o=i.length-1;o>=0;){let e;if(e=i[o],n+=this.sampleSet[e]||0,e===t){r=void 0;break}o--}return n},this.prototype.drawSample=function(t,i,r,o,s){let a,l,u,c;return a=this.sampleTime,t.drawRectangle(null,n(l=i.transformX(a,u=this.getStacked(o)),c=i.transformY(a,u),r,s-c),{color:e.statColors[o]})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},m={}.hasOwnProperty;(u=n(42)).log,u.requestAnimationFrame,l=u.longestCommonSubsequence,u.select,u.inspect,u.globalCount,s=u.defineModule,e=n(124).EpochClass,i=n(374),(c=n(313)).point,c.Point,h=n(363),d=h.startFrameTimer,a=h.endFrameTimer,p=n(212).simpleBrowserInfo,o=function(t,e){return window.lcs=l(t,e)},r=function(t,e){var n,i,r,s;if(t){for(s=[],i=0,r=t.length;i<r;i++)n=t[i],f.call(o(t,e),n)<0&&s.push(n);return s}return e},s(t,function(t){var n,o;function StateEpoch(){StateEpoch.__super__.constructor.call(this,{emptyQueueAfterProcessing:!0})}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(StateEpoch,e),StateEpoch.singletonClass(),StateEpoch._stateEpochLayoutInProgress=!1,StateEpoch.prototype._addChangingElement=function(t){return this.queueItem(t)},StateEpoch.prototype._isChangingElement=function(t){return this.isItemQueued(t)},StateEpoch.prototype.computeDepth=function(t){return t?t.__depth=1+this.computeDepth(t.getPendingParent()):0},StateEpoch.prototype.computeDepths=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)e=t[n],this.computeDepth(e);return null},StateEpoch.prototype.sortChangingElementsDepthsAscending=function(t){return t.sort(function(t,e){return t.__depth-e.__depth})},StateEpoch.prototype.notifyLayoutPropertiesChanged=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)(e=t[n]).__layoutPropertiesChanged&&e._layoutPropertiesChanged();return null},StateEpoch.prototype.getDrawChangedElements=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)(e=t[n]).__redrawRequired&&r.push(e);return r},StateEpoch.prototype.elemensNeedRedrawing=function(t){var e,n;for(d("redrawCheck"),e=0,n=t.length;e<n;e++)t[e]._needsRedrawing();return a(),null},StateEpoch.prototype.applyStateChanges=function(t){var e,n;for(e=0,n=t.length;e<n;e++)t[e]._applyStateChanges();return null},o=function(t){var e,n,i;if(t.getChildrenChanged())for(e=0,n=(i=r(t.children,t.getPendingChildren())).length;e<n;e++)i[e].__redrawRequired=!0;return null},StateEpoch.prototype.markRedrawRequired=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)(e=t[n]).__redrawRequired=e.getRedrawRequired(),o(e);return null},StateEpoch.prototype.markDrawAreaChanged=function(t){var e,n,i,r;for(n=0,i=t.length;n<i;n++)(e=t[n]).__drawAreaChanged||(e.__drawAreaChanged=e.getChildrenChanged()||e.getCurrentSizeChanged()&&e.getSizeAffectsDrawArea(!0)),e.getElementToParentMatrixChanged()&&(r=e.getPendingParent())&&(r.__drawAreaChanged=!0,r._elementChanged());return null},StateEpoch.prototype.resetAbsMatriciesR=function(t){var e,n,i,r;if(null!==t._elementToAbsMatrix||null!==t._absToElementMatrix){for(t._elementToAbsMatrix=t._absToElementMatrix=null,t.queueEvent("absMatriciesChanged"),n=0,i=(r=t.getPendingChildren()).length;n<i;n++)e=r[n],this.resetAbsMatriciesR(e);return null}},StateEpoch.prototype.resetParentToElementMatricies=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)(e=t[n])&&e.getElementToParentMatrixChanged()&&(e._parentToElementMatrix=null);return null},StateEpoch.prototype.getElementToAbsMatrixChangedElementsDepthAscending=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)((e=t[n]).getElementToParentMatrixChanged()||e.getParentChanged())&&r.push(e);return r},StateEpoch.prototype.resetAbsMatricies=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)e=t[n],this.resetAbsMatriciesR(e);return null},StateEpoch.prototype.updateElementParentChangingElements=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)(e=t[n]).getParentChanged()&&(e._clearRootElement(),e._updateRegistryFromPendingState());return null},StateEpoch.prototype.recomputeMousePathAndCursor=function(t){var e,n,i,r,o;for(o=[],e=0,n=t.length;e<n;e++)r=t[e].getRootElement(),f.call(o,r)<0&&(o.push(r),null!=(i=r.pointerEventManager)&&i.updateMousePath());return null},n=0,StateEpoch.prototype.inspectChangingElements=function(t){var e,i,r,o,s,a,l,u;return{epoch:++n,changingElements:function(){var n,c,h,p,d;for(d=[],n=0,h=t.length;n<h;n++){if(i=t[n],l={},(o=i._getChangingStateKeys()).length>0)for(l.changing=r={},c=0,p=o.length;c<p;c++){switch(s=o[c],u=i[s],a=i._pendingState[s],s){case"_parent":u=null!=u?u.inspectedName:void 0,a=null!=a?a.inspectedName:void 0;break;case"_children":u=function(){var t,n,i;for(i=[],t=0,n=u.length;t<n;t++)e=u[t],i.push(e.inspectedName);return i}(),a=function(){var t,n,i;for(i=[],t=0,n=a.length;t<n;t++)e=a[t],i.push(e.inspectedName);return i}()}r[s]={old:u,new:a}}l.__depth=i.__depth,i.__drawAreaChanged&&(l.drawAreaChanged=!0),i.__redrawRequired&&(l.drawPropertiesChanged=!0),d.push([i.inspect(),l])}return d}()}},StateEpoch.prototype.preprocessElementsForEpoch=function(t){var e,n;for(e=0,n=t.length;e<n;e++)t[e].preprocessForEpoch();return null},StateEpoch.prototype.processEpochItems=function(t){var e,n,r,o,s,l;for(d("stateEpoch"),this.preprocessElementsForEpoch(t),this.computeDepths(t),this.notifyLayoutPropertiesChanged(t),i.markLayoutPropertiesChanged(t),e=t.length,this.sortChangingElementsDepthsAscending(t),StateEpoch._stateEpochLayoutInProgress=!0,i.updateLayouts(t),StateEpoch._stateEpochLayoutInProgress=!1,this.markRedrawRequired(t),this.markDrawAreaChanged(t),t.length!==e&&this.sortChangingElementsDepthsAscending(t),o=this.getElementToAbsMatrixChangedElementsDepthAscending(t),n=this.getDrawChangedElements(t),this.elemensNeedRedrawing(n),this.resetParentToElementMatricies(o),this.updateElementParentChangingElements(t),this.applyStateChanges(t),this.resetAbsMatricies(o),s=0,l=t.length;s<l;s++)(r=t[s]).__drawAreaChanged&&r._drawAreaChanged();return p.touch||this.recomputeMousePathAndCursor(t),this.elemensNeedRedrawing(n),a()},StateEpoch}())}).call(this,n(2)(t))},function(t,e,n){"use strict";var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_={}.hasOwnProperty;Math.abs,(v=n(42)).log,f=v.max,m=v.min,x=v.shallowEq,v.longestCommonSubsequence,v.select,v.Unique,v.peek,v.inspect,v.isFunction,v.eachRunAsCharCodes,l=v.float32Eq0,v.isNumber,i=n(96).BaseClass,(S=n(313)).point,S.Point,S.perimeter,y=S.point0,o=S.Rectangle,n(347),b=n(363),C=b.startFrameTimer,a=b.endFrameTimer,c=n(375).layoutChildrenFlex,h=n(378).layoutChildrenFlow,w=r=n(377),g=w.nearInfiniteSize,w.nearInfinity,w.nearInfinityResult,p=w.layoutMargin,P=w.sizeWithPadding,d=w.layoutPadding,s=w.deinfinitize,u=w.isInfiniteResult,t.exports=function(t){var e,n,v,S,b,w,E,T;function StateEpochLayout(){return StateEpochLayout.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)_.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(StateEpochLayout,i),StateEpochLayout.markLayoutPropertiesChanged=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)((e=t[n]).getParentChanged()&&e.getPendingParent()||e.getChildrenChanged()&&e.getPendingLayoutMovesChildren())&&(e.__layoutPropertiesChanged||(e.__layoutPropertiesChanged=!0,e._elementChanged())),r.push(E(e));return r},StateEpochLayout.updateLayouts=function(t){var e,n,i;for(C("aimLayout"),n=0,i=t.length;n<i;n++)(e=t[n]).__layoutPropertiesChanged&&w(e,e.getPendingParentSizeForChildren());return a(),null},E=function(t){var e;for(e=[];(t=t.getPendingParent())&&(t.getPendingSize().getChildrenRelative()||t.getPendingLayoutMovesChildren())&&!t.__layoutPropertiesChanged;)t.__layoutPropertiesChanged=!0,e.push(t._elementChanged());return e},b=function(t,e,n,i,r,o){var s,a,l,c,h,p,d;if(!i)return y;for(h=p=!1,d=[],a=0,c=i.length;a<c;a++)(l=(s=i[a]).getPendingLayoutLocationParentCircular())&&(s._setElementToParentMatrixFromLayout(y,n),o.push(s)),w(s,n,l),h=u(s.getPendingMaxXInParentSpace()),p=u(s.getPendingMaxYInParentSpace()),h||p?d.push(r.push(s)):l?d.push(o.push(s)):d.push(void 0);return d},T=new o,v=function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,g,v,S,b,w;if(!((null!=e?e.length:void 0)>0))return y;if(o=S=0,a=t.getPendingChildArea()){for(w=h=0,c=v=b=r=0,l=!0,u=0,p=e.length;u<p;u++)c=(i=a(s=e[u],T)).getLeft(),b=i.getTop(),v=i.getRight(),r=i.getBottom(),l?(l=!1,h=c,w=b,S=v,o=r):(h=m(c,h),w=m(b,w),S=f(v,S),o=f(r,o));return P(S-h,o-w,n)}for(g=0,d=e.length;g<d;g++)s=e[g],S=f(S,s.getPendingMaxXInParentSpace()),o=f(o,s.getPendingMaxYInParentSpace());return P(S,o,n)},S=function(t,e){return e[t]},e=function(t,e,n){var i,r,o,s,a,u,c,h,p,d,f,m,g,y,v,b,w,x,P,C,_;for(r=t.childrenAlignment,h=t.flowChildren,a=t.firstChildIndexOfEachLine,g=t.lastChildIndexOfEachLine,C=t.widthOfEachLine,(_=t.widthOfEachLineFunction)||(_=S),o=r.x,s=r.y,x=[],p=f=0,v=a.length;f<v;p=++f)c=a[p],y=g[p],P=_(p,C),(u=h[c]).getPendingLayoutSizeParentCircular()&&u.getPendingSize().getXParentRelative()&&(P=u.getPendingCurrentSize().x),b=(e.x-P)*o,w=(e.y-n.y)*s,l(b)&&l(w)?x.push(void 0):x.push(function(){var t,n,r;for(r=[],d=t=c,n=y;t<=n;d=t+=1)i=h[d],m=i.getPendingCurrentLocation(),r.push(i._setElementToParentMatrixFromLayoutXY(m.x+b,m.y+w,e));return r}());return x},n=function(t){return!t.getPendingLayoutSizeParentCircular()||t._pendingState._size.childrenRelative},r.layoutElement=w=function(t,i,r){var o,a,l,u,f,m,S,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W;if(!t.__layoutPropertiesChanged&&x(t._lastParentSize,i))return t.getPendingCurrentSize();if(t._lastParentSize=i,t.__layoutPropertiesChanged=!1,r||(S=t._layoutLocation(i)),I=t._layoutSize(i,g),m=d(t,i),p(t,i,t.getPendingParent()),A=t.getSizeForChildren(!0,I),M=t.getSizeForChildren(!0,t._layoutSizeForChildren(i,g)),W=t.getPendingChildren(),k=P=null,u=t.getPendingChildrenLayout(),B=t.getPendingSize().getChildrenRelative(),u||B){for(k=W,a=F=0,R=W.length;F<R;a=++F)(o=W[a]).getPendingInFlow()&&(u||n(o))&&o.getPendingVisible()?P&&k.push(o):(P||(k=W.slice(0,a),P=[]),P.push(o));_=[],C=[],P||(P=[])}else P=W;if(f=t.nonChildrenLayoutFirstPass?f=m.addedToSize(t.nonChildrenLayoutFirstPass(M,A)):y,k){switch(u){case"flow":l=h(t,m,A,M,k,_);break;case"column":c(!1,t,m,M,k,i);break;case"row":c(!0,t,m,M,k,i);break;default:b(0,0,M,k,P,C)}if((B||(null!=l?l.childrenAlignment:void 0))&&(f=f.max(v(t,k,m))),E=t._layoutSize(i,f),T=t.getSizeForChildren(!0,E),_)for(D=0,z=_.length;D<z;D++)o=_[D],w(o,T,!0);if(null!=l?l.childrenAlignment:void 0)e(l,T,f);else for(N=0,O=C.length;N<O;N++)(o=C[N])._setElementToParentMatrixFromLayout(o._layoutLocation(T),i)}else E=I,T=M;if("function"==typeof t.nonChildrenLayoutFinalPass&&t.nonChildrenLayoutFinalPass(T),P)for(U=0,L=P.length;U<L;U++)o=P[U],w(o,T);return t._setSizeFromLayout(s(E)),r||t._setElementToParentMatrixFromLayout(s(S),i),E},StateEpochLayout}()},function(t,e,n){"use strict";var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y;(p=n(42)).log,p.inspect,p.shallowEq,p.select,p.peek,p.inspect,s=p.float32Eq0,(d=n(376)).isInfiniteResult,a=d.isFiniteResult,f=n(313),c=f.point,r=f.Point,f.perimeter,m=i=n(377),l=m.layoutMargin,g=m.sizeWithPadding,h=r.point0,Math.abs,u=Math.max,o=function(t,e){return(t+e)/2},y=function(t,e,n,i){var r,o;return r=o=0,t?(r=e,o=n):(r=n,o=e),i?g(r,o,i):c(r,o)},t.exports=function(){function FlexLayout(){}return FlexLayout.layoutChildrenFlex=function(t,e,n,r,c,p){var d,f,m,g,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q,H,V,$,G,Y,K,X,J,Q,Z,tt,et,nt,it,rt,ot,st,at,lt,ut,ct,ht,pt,dt,ft,mt,gt,yt,vt,St,bt,wt,xt,Pt,Ct,_t,Et,Tt,kt,It,Mt,At;for(t?(lt="x",k="y",wt="left",yt="right",ot="getXRelativeToParentW",T="getYRelativeToParentH"):(lt="y",k="x",wt="top",yt="bottom",ot="getYRelativeToParentH",T="getXRelativeToParentW"),ut=r[lt],I=r[k],null,mt=At=0,Mt=r[lt],at=0,G=0,z=null,O=null,U=H=0,K=c.length;H<K;U=++H)(q=(w=c[U]).getPendingSize()[ot]())?(A=w._layoutSize(r,h),(null!=O?O:O=[]).push(w),P=w.getPendingLayoutWeight(),At+=P):(i.layoutElement(w,r,!0),at+=ht=(A=w.getPendingCurrentSize())[lt],Mt-=ht,w.getPendingLayoutSizeParentCircular()&&w.getPendingSize()[T]()?((z||(z=[])).push(w),(!t&&w._pendingState._size.xChildrenRelative||t&&w._pendingState._size.yChildrenRelative)&&(mt=u(mt,A[k]))):mt=u(mt,A[k])),dt=l(w,r,e,!q),U>0&&(at+=F=o(G,dt[wt]),Mt-=F),G=dt[yt];if(0,Mt=u(0,Mt),O){for(L=function(){var t,e,n;for(n=[],U=t=0,e=O.length;t<e;U=++t)w=O[U],P=w.getPendingLayoutWeight(),Pt=P/At,n.push(Mt*Pt);return n}(),function(){var t,e,n;for(n=[],t=0,e=L.length;t<e;t++)R=L[t],n.push(R);return n}(),S=0,b=ft=2;b>0;){for(S++,d=0,W=0,B=0,j=0,f=0,U=V=0,X=O.length;V<X;U=++V)w=O[U],D=L[U],i.layoutElement(w,y(t,D,I),!0),Y=w.getPendingCurrentSize()[lt],.001<Math.abs(1-Y/D)?(B+=D,j++,W+=Y):(f++,d+=Y);if(m=W+d-Mt,--b>0&&j>0&&.01<Math.abs(m))if(It=u(0,Mt-W),Tt=W>Mt?Mt/W:0===f&&W>0?Mt/W:B>0?W/B:1,s(1-(Et=d>0?It/d:1))&&s(1-Tt))b=0;else for(U=$=0,J=O.length;$<J;U=++$)w=O[U],pt=L[U],ht=w.getPendingCurrentSize()[lt],.001<Math.abs(1-ht/pt)?L[U]*=Tt:L[U]*=Et;else b=0}if(S>ft)for(U=gt=0,Q=O.length;gt<Q;U=++gt)w=O[U],P=w.getPendingLayoutWeight(),D=Mt*(Pt=P/At),i.layoutElement(w,y(t,D,I),!0);for(U=vt=0,Z=O.length;vt<Z;U=++vt)at+=ht=(A=(w=O[U]).getPendingCurrentSize())[lt],w.getPendingLayoutSizeParentCircular()&&w.getPendingSize()[T]()?(z||(z=[])).push(w):mt=u(mt,A[k])}if(_=y(t,at,mt,n),t?(ut=e.getPendingSize().layoutX(p,_)-n.getWidth(),I=e.getPendingSize().layoutY(p,_)-n.getHeight()):(I=e.getPendingSize().layoutX(p,_)-n.getWidth(),ut=e.getPendingSize().layoutY(p,_)-n.getHeight()),z){for(St=mt,y(t,ut,I),U=bt=0,tt=z.length;bt<tt;U=++bt)w=z[U],kt=y(t,w.getPendingCurrentSize()[lt],I),i.layoutElement(w,kt,!0),mt=u(mt,w.getPendingCurrentSize()[k]);St!==mt&&(_=y(t,at,mt,n),t?(ut=e.getPendingSize().layoutX(p,_)-n.getWidth(),I=e.getPendingSize().layoutY(p,_)-n.getHeight()):(I=e.getPendingSize().layoutX(p,_)-n.getWidth(),ut=e.getPendingSize().layoutY(p,_)-n.getHeight()))}for(G=0,(C=e.getPendingChildrenAlignment())[lt],E=C[k],N=!s(E),st=ct=a(ut)&&a(at)?(ut-at)*C[lt]:0,U=xt=0,et=c.length;xt<et;U=++xt)dt=(w=c[U]).getPendingCurrentMargin(),U>0&&(ct+=F=o(G,dt[wt])),G=dt[yt],A=w.getPendingCurrentSize(),ht=U===c.length-1&&a(ut)?ut-ct:A[lt],M=0,g=I,N&&(M=(I-(x=A[k]))*E,g=x),v=y(t,ht,g),nt=w._layoutLocationX(v),it=w._layoutLocationY(v),t?(nt+=ct,it+=M):(it+=ct,nt+=M),w._setElementToParentMatrixFromLayoutXY(nt,it,v),ct+=ht;return e.postFlexLayout(lt,c,at,ut,st),at>(rt=ut)?(null!=(Ct=e._on)?Ct.childrenDontFit:void 0)&&e.queueEvent("childrenDontFit",{mainChildrenSize:at,mainSize:rt}):(null!=(_t=e._on)?_t.childrenFit:void 0)&&e.queueEvent("childrenFit",{mainChildrenSize:at,mainSize:rt}),null},FlexLayout}()},function(t,e,n){"use strict";var i,r,o,s,a,l,u;r=n(160),i=n(313),r.BaseClass,r.isPlainObject,r.log,r.isFunction,a=r.nearInfinity,l=r.nearInfinityResult,o=r.abs,u=i.point,t.exports={nearInfinity:a,nearInfinityResult:l,nearInfinitePoint:s=u(a),nearInfiniteSize:s,isInfiniteResult:function(t){return o(t)>=l},isFiniteResult:function(t){return o(t)<l}}},function(t,e,n){"use strict";var i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty;o=n(160),i=n(313),d=i.point,i.Point,h=i.perimeter,p=i.perimeter0,r=o.BaseClass,s=o.isFunction,o.abs,f=n(376),l=f.nearInfiniteSize,u=f.nearInfinity,c=f.nearInfinityResult,a=f.isInfiniteResult,t.exports=function(t){function LayoutTools(){return LayoutTools.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(LayoutTools,r),LayoutTools.nearInfiniteSize=l,LayoutTools.nearInfinity=u,LayoutTools.nearInfinityResult=c,LayoutTools.isInfiniteResult=a,LayoutTools.layoutMargin=function(t,e,n,i){var r,o,a,l;return o=t.getPendingMargin()||(null!=n?n.getPendingChildrenMargins():void 0),o=h(s(o)?o(e):o||p),i&&(l=(a=t.getPendingCurrentSize()).w,r=a.h,o=o.minWH(l,r)),t._setMarginFromLayout(o)},LayoutTools.layoutPadding=function(t,e){var n;return n=t.getPendingPadding(),t._setPaddingFromLayout(h(s(n)?n(e):n||p))},LayoutTools.deinfinitize=function(t){var e,n;return e=t.x,n=t.y,e=a(e)?0:e,n=a(n)?0:n,t.with(e,n)},LayoutTools.sizeWithPadding=function(t,e,n){return d(t+n.getWidth(),e+n.getHeight())},LayoutTools.layoutElement=null,LayoutTools}()},function(t,e,n){"use strict";(function(t){var e,i,r,o,s,a,l,u,c;i=(l=n(42)).defineModule,r=l.float32Eq0,o=l.max,u=n(313),s=u.point,a=u.point0,c=(e=n(377)).sizeWithPadding,i(t,function(){var t,n;function FlexLayout(){}return n=function(t,n,i){var r,o,s,l;for(l=[],o=0,s=n.length;o<s;o++)(r=n[o]).getPendingLayoutSizeParentCircular()&&!r._pendingState._size.childrenRelative?(r._setSizeFromLayout(r._layoutSize(a,a)),l.push(i.push(r))):l.push(e.layoutElement(r,t,!0));return l},t=function(t,e,n){var i,r,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P;for(P=n.y,u=n.firstChildOnLine,d=n.lastLineMarginBottom,S=n.maxWidth,y=0,v=0,g=0,f=0,p=u,x=0,r=c=u,b=t.length;c<b;r=c+=1){if(l=(i=t[p=r]).getPendingCurrentMargin(),a=i.getPendingCurrentSize(),p!==u&&(x+=o(l.left,f)),x+=a.x,f=l.right,m=x>=e,i.getPendingLayoutSizeParentCircular()&&i.getPendingSize().getXParentRelative()&&(p!==u&&p--,m=!0),m&&p!==u){p--;break}if(v=o(l.top,v),y=o(l.bottom,y),g=o(g,a.y),m)break}for(null!=d&&(P+=o(d,v)),x=0,f=0,r=h=u,w=p;h<=w;r=h+=1)l=(i=t[r]).getPendingCurrentMargin(),a=i.getPendingCurrentSize(),r!==u&&(x+=o(l.left,f)),i._setElementToParentMatrixFromLayout(s(x,P),s(a.x,g)),x+=a.x,f=l.right;return n.flowChildren&&(n.firstChildIndexOfEachLine.push(u),n.lastChildIndexOfEachLine.push(p),n.widthOfEachLine.push(x)),n.lastLineMarginBottom=y,n.y=P+g,n.firstChildOnLine=p+1,n.maxWidth=o(S,x)},FlexLayout.layoutChildrenFlow=function(e,i,o,s,a,l){var u,h,p,d;for(n(s,a,l),.5,p=o.x+.5,d={y:0,firstChildOnLine:0,lastLineMarginBottom:null,maxWidth:0},u=e.getPendingChildrenAlignment(),r(u.x)&&r(u.y)||(d.childrenAlignment=u,d.flowChildren=a,d.firstChildIndexOfEachLine=[],d.lastChildIndexOfEachLine=[],d.widthOfEachLine=[]),h=a.length;d.firstChildOnLine<h;)t(a,p,d);return d.childrenSize=c(d.maxWidth,d.y,i),d},FlexLayout}())}).call(this,n(2)(t))},function(t,e,n){"use strict";var i,r,o,s,a,l={}.hasOwnProperty;s=n(160),i=n(313),r=n(380),i.point,i.Point,s.log,s.requestAnimationFrame,s.longestCommonSubsequence,s.select,s.inspect,o=s.Epoch,s.globalCount,a=r.drawCacheManager,t.exports=function(t){function DrawEpoch(){return DrawEpoch.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(DrawEpoch,o),DrawEpoch.singletonClass(),DrawEpoch.prototype.processEpochItems=function(){return DrawEpoch.__super__.processEpochItems.apply(this,arguments),a.advanceFrame()},DrawEpoch}()},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","BaseClass","Map","log","Error","logFrameEvent","point1","remove","timeout","getIsMobileBrowser"],[e,n(381),n(212)],(t,e,r,o,s,a,l,u,c,h)=>{let p,d,f,m;return p=n(160).humanByteSize,d=t().drawCacheDebug,f=function(t,e){let n;return n=t.get(e),t.delete(e),n},m=i.defClass(class CacheBitmap extends e{constructor(t,e,n){super(...arguments),this.element=t,this.bitmap=e,this._reset(n)}},function(t,e,n){this.prototype._reset=function(t){return this.useCount=0,this.lastFrameUsed=t||0},this.prototype.release=function(){let t,e,n;return this.elementDoneWithCacheBitmap(),t=(n=this.bitmap).byteSize,(e=n._canvas)&&(e.width=e.height=1),this.bitmap=null,t},this.prototype.recycle=function(t,e){return this.elementDoneWithCacheBitmap(),this.element=t,this._reset(e),this.bitmap.clear(),this.bitmap},this.prototype.use=function(t){return this.lastFrameUsed=t,this.useCount++},this.prototype.elementDoneWithCacheBitmap=function(){return this.element&&this.element._drawCacheBitmap===this.bitmap&&this.element.__clearDrawCacheCallbackFromDrawCacheManager(),this.element=null},this.getter({inspectedObjects:function(){return{size:this.size,byteSize:this.byteSize,bitmap:this.bitmap}},size:function(){return this.bitmap.size},byteSize:function(){return this.bitmap.getByteSize()}})}),i.defClass(class DrawCacheManager extends e{constructor(){super(...arguments),this._currentFrameNumber=0,this._maxCacheByteSize=1048576*(h()?64:128),this._bitmapsCreated=0,this._initCache()}},function(t,e,n){let h,g,y;this.byteSizeFromSize=h=function(t){return t.x*t.y*4},this.singletonClass(),this.getDrawCacheManager=function(){return t.singleton},this.usableBitmap=g=function(t,e,n){let i,r,o;return i=(o=t.size).x,r=o.y,e<=i&&n<=r&&i*r<e*n*2},this.prototype._initCache=function(){return this._cacheByteSize=0,this._cacheBitmaps=new r,this._unusedCacheBitmaps=[],this._unusedCacheByteSize=0},this.getter("cacheByteSize","unusedCacheByteSize","maxCacheByteSize","bitmapsCreated",{byteSize:function(){return this._cacheByteSize+this._unusedCacheByteSize},humanByteSize:function(){return p(this.byteSize)},humanCacheSummary:function(){return`${i.toString(p(this._cacheByteSize))} + ${i.toString(p(this._unusedCacheByteSize))} = ${i.toString(this.humanByteSize)}`},cacheByteSizeOk:function(){return this.byteSize<=this._maxCacheByteSize},inspectedObjects:function(){let t;return t=[],this._cacheBitmaps.forEach(e=>t.push(e.inspectedObjects)),{cacheBitmaps:t}},currentFrameNumber:function(){return this._currentFrameNumber},recycleableSortedCacheBitmaps:function(){let t,e;return t=[],e=this._currentFrameNumber,this._cacheBitmaps.forEach((n,i)=>n.lastFrameUsed<e-1?t.push(n):void 0),t.sort((t,e)=>t.lastFrameUsed-e.lastFrameUsed)}}),this.getCacheInfo=function(){return t.singleton.getCacheInfo()},this.prototype.getCacheInfo=function(){return{cacheBitmaps:this._cacheBitmaps.size,unusedCacheBitmaps:this._unusedCacheBitmaps.length,cacheByteSize:this.cacheByteSize,unusedCacheByteSize:this.unusedCacheByteSize,maxCacheByteSize:this.maxCacheByteSize,bitmapsCreated:this.bitmapsCreated}},this.prototype.allocateCacheBitmap=function(t,e){let n;return this.doneWithCacheBitmap(t),null!=(n=this._recycleUnusedCacheBitmap(t,e))?n:this._createCacheBitmap(t,e)},this.prototype.useDrawCache=function(t){let e;return i.exists(e=this._cacheBitmaps.get(t))&&e.use(this._currentFrameNumber)},this.prototype.doneWithCacheBitmap=function(t){let e,n;return(e=f(this._cacheBitmaps,t))?(e.elementDoneWithCacheBitmap(),n=e.getByteSize(),this._unusedCacheByteSize+=n,this._cacheByteSize-=n,this._unusedCacheBitmaps.push(e)):void 0},this.prototype.advanceFrame=function(){return this._currentFrameNumber++},this.validateCacheByteSize=function(e){return t.singleton.validateCacheByteSize(e)},this.prototype.validateCacheByteSize=function(t){let e,n,r;if(e=[],n=0,r=0,this._cacheBitmaps.forEach((t,n)=>(r+=t.byteSize,e.push({bitmap:t,element:n.inspectedName}))),i.each2(this._unusedCacheBitmaps,t=>n+=t.byteSize),!(this._cacheByteSize+this._unusedCacheByteSize<=this._maxCacheByteSize&&this._cacheByteSize===r&&this._unusedCacheByteSize===n))throw o.error({validateCacheByteSize:{context:t,tracked:{cacheByteSize:this.cacheByteSize,unusedCacheByteSize:this.unusedCacheByteSize},actual:{cacheByteSize:r,unusedCacheByteSize:n},cacheBitmaps:e.length,unusedCacheBitmaps:this._unusedCacheBitmaps.length}}),new s("bad _cacheByteSize");return{message:"ok",eq:this._cacheByteSize===r,cacheByteSize:r,_cacheByteSize:this._cacheByteSize,unusedCacheByteSize:n,_unusedCacheByteSize:this._unusedCacheByteSize}},this.flushCache=function(){return t.singleton.flushCache()},this.prototype.flushCache=function(){let t,e;return o({DrawCacheManager:{flushCache:"start",info:this.getCacheInfo()}}),t=this._unusedCacheBitmaps.length,e=this.releaseUnusedBitmaps(),this._cacheBitmaps.forEach((n,i)=>(t++,o("flushCache_release"),e+=n.release())),e+=this._cacheByteSize,this._initCache(),o({DrawCacheManager:{flushCache:"done",info:this.getCacheInfo(),results:{bytesReleased:e,bitmapsReleased:t}}}),{bytesReleased:e,bitmapsReleased:t}},this.prototype.releaseUnusedBitmaps=function(){let t;return t=0,i.each2(this._unusedCacheBitmaps,e=>t+=e.release()),this._unusedCacheByteSize=0,this._unusedCacheBitmaps=[],t},this.prototype._recycleUnusedCacheBitmap=function(t,e){let n;return(n=this._getUnusedCacheBitmap(e))?(a("recycleUnusedCacheBitmap","recycleUnusedCacheBitmap"),n.recycle(t,this._currentFrameNumber),this._addCacheBitmap(t,n)):void 0},this.prototype._addCacheBitmap=function(t,e){return this._cacheBitmaps.set(t,e),this._cacheByteSize+=e.getByteSize(),e.bitmap},this.prototype._createCacheBitmap=function(t,e){let n;return e=e.max(l),this._bitmapsCreated++,a("createCacheBitmap","createCacheBitmap"),n=this._addCacheBitmap(t,new m(t,t.getBitmapFactory().newBitmap(e),this._currentFrameNumber)),d&&o(`+${i.toString(p(h(e)))} - new ${i.toString(e)} (${i.toString(this.humanCacheSummary)})`),this._ensureSafeMemorySize(),n},this.prototype._validateCacheByteSize=function(t){return this.validateCacheByteSize(t)},this.prototype.canUseBitmap=y=function(t,e){let n,r,o,s,a;return(i.exists(t)?n=t.size:void 0)&&n.area<2*e.area?(r=e.w,o=e.h,s=n.x,a=n.y,s>=r&&a>=o):void 0},this.prototype._getUnusedCacheBitmap=function(t){let e,n,i,r;if(n=e=this._unusedCacheBitmaps,null!=e)for(i=e.length,r=0;r<i;){let n,i;if(n=e[r],i=r,y(n,t))return this._unusedCacheBitmaps=u(this._unusedCacheBitmaps,i),this._unusedCacheByteSize-=n.byteSize,n;r++}return null},this.prototype._evictCacheBitmaps=function(){let t,e,n,r;if(this._evictUnusedBitmaps(),!this.cacheByteSizeOk){if(e=t=this.recycleableSortedCacheBitmaps,null!=t)for(n=t.length,r=0;r<n;){let n,s;if(n=t[r],(n=f(this._cacheBitmaps,n.element))&&(this._cacheByteSize-=s=n.getByteSize(),n.release(),d&&o(`-${i.toString(p(s))} - releasing not-recently-used (${i.toString(this.humanCacheSummary)})`),this.cacheByteSizeOk)){e=void 0;break}r++}this.cacheByteSizeOk||o.warn(`evictCacheBitmaps was unable to release enough memory: ${i.toString(p(this.byteSize))} > ${i.toString(p(this._maxCacheByteSize))}`)}return null},this.prototype._evictUnusedBitmaps=function(){for(this._unusedCacheBitmaps.sort((t,e)=>t.byteSize-e.byteSize);!this.cacheByteSizeOk&&0!==this._unusedCacheBitmaps.length;){let t,e,n;e=(t=this._unusedCacheBitmaps.pop()).byteSize,n=t.size,t.release(),this._unusedCacheByteSize-=e,d&&o(`-${i.toString(p(e))} - releasing unused ${i.toString(n)} (${i.toString(this.humanCacheSummary)})`)}return null},this.prototype._ensureSafeMemorySize=function(){return this.cacheByteSizeOk||(this._evictUnusedBitmaps(),this.cacheByteSizeOk||c(0,()=>this._evictCacheBitmaps())),null}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(382).mergeWithSelf(n(383),n(393),n(414)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(42).mergeWithSelf(n(96),n(313),n(325),n(363)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["plainObjectsDeepEq","shallowEq","mipmapCache","isString","isBoolean","isNumber","isArray","isPlainObject","isFunction","console","Neptune","isObject","lowerCamelCase"],[e,n(42),n(325)],(t,e,r,o,s,a,l,u,c,h,p,d,f)=>{let m;return{propsEq:t,shallowPropsEq:e,flushAllCaches:m=function(){return n(380).drawCacheManager.flushCache(),n(325).MipmapCache.singleton.releaseAll(),null},releaseAllCaches:m,validateAll:function(){return n(380).validateCacheByteSize()},getArtEngineUsage:function(){let t,e,m,g,y,v,S,b,w,x,P,C;return t=(C=n(380).drawCacheManager).cacheByteSize,e=C.unusedCacheByteSize,m=n(384).BitmapElement.bitmapCache,g=0,y={total:0},v={array:0,string:0,function:0,plainObject:0,objects:{},number:0,rest:0,totalGcObjects:0,null:0,boolean:0},S=[],b=((t,e)=>{let n,r;if(!i.in(t,S))return(()=>{switch(!1){case!o(t):return v.string++;case!s(t):return v.boolean++;case!a(t):return v.number++;case!(null==t):return v.null++;case!l(t):return v.totalGcObjects++,v.array++,S.push(t),i.each2(t,t=>b(t)),S.pop();case!u(t):return v.totalGcObjects++,v.plainObject++,S.push(t),i.each2(t,(t,e)=>b(t,e)),S.pop();case!c(t):return v.totalGcObjects++,v.function++;case!(n=i.exists(r=t.class)&&r.name):return v.totalGcObjects++,v.objects[n]=1+(0|v.objects[n]);default:return h.log({rest:t}),v.rest++}})()}),i.each2(n(361).ElementBase._elementInstanceRegistry,t=>(y.total++,y[t.shortNamespacePath]=1+(0|y[t.shortNamespacePath]),b(t.minimalProps),t instanceof p.Art.Engine.Core.CanvasElement?g+=t.canvasByteSize:void 0)),w=/Bytes$|ByteSize$/i,x=i.pow(2,20),(P=(t=>d(t)?i.object(t,(t,e)=>d(t)||/Bytes$|ByteSize$/i.test(e)?P(t):t,null,null,(t,e)=>t>=x&&w.test(e)?f(e.replace(/Bytes$|ByteSize$/i,"Megabytes")):e):t>=x?t/i.pow(1024,2)|0:t))({imageMemory:{mipmapCache:r.memoryInfo,bitmapCache:m.memoryInfo,drawCacheByteSize:t,drawCacheUnusedCacheByteSize:e,canvasByteSize:g,totalBytes:r.byteSize+m.byteSize+t+e+g},elementCounts:y,propObjectCount:v})}}}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(350)).includeInNamespace(n(385)).addModules({AtomElement:n(389),ShadowableElement:n(388)}),n(426),n(442),n(386),n(430)},function(t,e,n){t.exports=[n(386),n(426),n(430),n(442)]},function(t,e,n){(t.exports=n(353)).addModules({BitmapElement:n(387),RectangleElement:n(416),ShapeElement:n(424),TextElement:n(425)})},function(t,n,i){(function(t){var n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b={}.hasOwnProperty;Math.ceil,Math.round,a=(y=i(42)).defineModule,y.inspect,y.min,y.max,y.bound,p=y.log,y.createWithPostCreate,h=y.isString,u=y.isNumber,c=y.isPlainArray,y.timeout,y.Promise,i(96).BaseClass,v=i(313),d=v.point,g=v.rect,r=v.Matrix,f=v.point0,m=v.point1,S=i(325),l=S.isImage,S.Bitmap,n=S.BitmapBase,o=i(388),s=i(360).SourceToBitmapCache,a(t,function(t){var i,a;function BitmapElement(t){BitmapElement.__super__.constructor.apply(this,arguments),this._bitmapToElementMatrix=new r}return function(t,e){for(var n in e)b.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(BitmapElement,o),BitmapElement.bitmapCache=a=s.singleton,BitmapElement.prototype._releaseCachedBitmap=function(){if(this._previousCacheSource)return a.release(this._previousCacheSource),this._previousCacheSource=null},BitmapElement.prototype._unregister=function(){return this._releaseCachedBitmap(),BitmapElement.__super__._unregister.apply(this,arguments)},BitmapElement.getter({cacheable:function(){return!1}}),BitmapElement.prototype.nonChildrenLayoutFirstPass=function(){var t;return(null!=(t=this.getPendingBitmap())?t.pointSize:void 0)||f},i=d(.5),BitmapElement.drawProperty({focus:{default:i,preprocess:function(t){return null!=t?d(t).bound(f,m):i}},layout:{default:"stretch",preprocess:function(t){return(null!=t?t.toString():void 0)||null}},sourceArea:{default:null,preprocess:function(t){return null!=t?g(t):null}},aspectRatio:{default:null,validate:function(t){return null==t||u(t)}}}),BitmapElement.drawLayoutProperty({bitmap:{default:null,validate:function(t){return!t||t instanceof n}}}),BitmapElement.virtualProperty({mode:{setter:function(t){return p.error("DEPRICATED BitmapElement property 'mode' is now 'layout'"),this.setLayout(t)}}}),BitmapElement.concreteProperty({source:{default:null,validate:function(t){return!t||l(t)||h(t)},postSetter:function(t){return t&&this._loadBitmapFromSource(t)}},altSources:{default:null,validate:function(t){return!t||c(t)}}}),BitmapElement.prototype._loadBitmapFromSource=function(t){return this._releaseCachedBitmap(),this._previousCacheSource=t,a.get(t).then((n=this,function(t){return n.onNextReady(function(){return n.queueEvent("load",function(){return{bitmap:t}})}),n.setBitmap(t)}),function(t){return function(n){return console.error({BitmapElement:{_loadBitmapFromSource:{error:n}}}),t.onNextReady(function(){return t.queueEvent("error",function(){return{error:e}})})}}(this));var n},BitmapElement.getter({currentBitmap:function(){var t,e,n,i,r;if(this._bitmap)return this._bitmap;if(this._altSources)for(t=0,e=(i=this._altSources).length;t<e;t++)if(r=i[t],n=a.loaded(r))return n}}),BitmapElement.prototype._prepareDrawOptions=function(t,e,n){return BitmapElement.__super__._prepareDrawOptions.apply(this,arguments),t.mipmap=!0,t.focus=this._focus,t.layout=this.getLayout(),t.targetSize=this.getSizeForChildren(),t.aspectRatio=this.getAspectRatio()},BitmapElement.prototype._drawBitmapElement=function(t,e,n){return t.drawBitmapWithLayout(e,this.getCurrentBitmap(),n)},BitmapElement.prototype.fillShape=function(t,e,n){return this._drawBitmapElement(t,e,n)},BitmapElement}())}).call(this,i(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty;s=n(160),r=n(313),o=n(325),i=n(389),d=n(393),a=d.PointLayout,l=d.PointLayoutBase,s.log,c=s.isPlainObject,s.min,h=s.max,u=s.createWithPostCreate,s.isNumber,p=s.merge,f=r.rgbColor,r.Color,r.point,r.Point,r.rect,r.Rectangle,r.matrix,r.Matrix,r.point0,r.point1,o.GradientFillStyle,n(414).normalizeShadow,t.exports=u(function(t){var e,n;function ShadowableElement(){return ShadowableElement.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ShadowableElement,i),ShadowableElement.registerWithElementFactory=function(){return this!==ShadowableElement},ShadowableElement.getter({cacheable:function(){return this.getHasChildren()}}),e=new a({y:2}),n={color:f(0,0,0,0),blur:0,offset:new a(0)},ShadowableElement.drawLayoutProperty({shadow:{default:null,validate:function(t){return!t||!0===t||c(t)},preprocess:function(t){var n,i,r;return t?(i=t.color,r=t.offset,n=t.blur,(i=f(i||"#0007")).a<1/255?null:(r=null!=r?r instanceof l?r:new a(r):e,null==n&&(n=4),{blur:n,offset:r,color:i})):null}}}),ShadowableElement.getter({normalizedCanvasShadow:function(t){var e,i,r,o;return(i=this.getShadow(t))&&i!==n?(r=(e=i.offset).layoutX(this._currentSize),o=e.layoutY(this._currentSize),p(i,{offsetX:r,offsetY:o})):null}}),ShadowableElement.prototype._expandRectangleByShadow=function(t,e,n){var i,r,o,s,a,l,u,c,p,d,f;return n?(d=t.x,f=t.y,p=t.w,l=t.h,i=n.blur,u=n.offsetX,c=n.offsetY,u||(u=0),c||(c=0),i||(i=0),o=h(0,(i*=1.25)-u),a=h(0,i-c),s=h(0,i+u),r=h(0,i+c),t.with(d-o,f-a,p+o+s,l+a+r)):t},ShadowableElement.virtualProperty({drawAreaPadding:function(t){return 0},baseDrawArea:function(t){return this._expandRectangleByShadow(this.getPreFilteredBaseDrawArea(t),t,this.getNormalizedCanvasShadow(t))}}),ShadowableElement.prototype._prepareDrawOptions=function(t,e,n){return ShadowableElement.__super__._prepareDrawOptions.apply(this,arguments),t.shadow=this.normalizedCanvasShadow},ShadowableElement}())},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g={}.hasOwnProperty;(p=n(42)).inspect,l=p.defineModule,c=p.isPlainArray,u=p.isNumber,p.log,h=p.isPlainObject,d=n(313),m=d.rgbColor,e=d.Color,i=n(390),f=n(393),r=f.PointLayout,o=f.PointLayoutBase,s=new r,a=new r({hh:1}),l(t,function(t){function AtomElement(){AtomElement.__super__.constructor.apply(this,arguments),this._drawOptions={}}return function(t,e){for(var n in e)g.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(AtomElement,i),AtomElement.registerWithElementFactory=function(){return this!==AtomElement},AtomElement.prototype.getSizeAffectsDrawArea=function(){return!0},AtomElement.drawProperty({color:{default:null,preprocess:function(t){var e,n,i,r,o,s;return t?c(t)&&!u(t[0])?t:h(t)?(r=t.r,i=t.g,n=t.b,e=t.a,null!=(null!=(o=null!=(s=null!=r?r:i)?s:n)?o:e)?m(t):t):m(t):null},setter:function(t){return(null!=t?t.constructor:void 0)===e?t:(t&&this.setColors(t),null)}},colors:{default:null},from:{preprocess:function(t){return t&&(t instanceof o?t:new r(t))}},to:{preprocess:function(t){return t&&(t instanceof o?t:new r(t))}},gradientRadius:{default:null}}),AtomElement.prototype._computeElementSpaceDrawArea=function(t){var e;return(null!=(e=this._children)?e.length:void 0)>0?AtomElement.__super__._computeElementSpaceDrawArea.apply(this,arguments):this.baseDrawArea},AtomElement.prototype.drawBasic=function(t,e,n,i){return this._prepareDrawOptions(this._drawOptions,n,i),this.fillShape(t,e,this._drawOptions)},AtomElement.prototype._useStagingBitmap=function(){return this.getHasChildren()?AtomElement.__super__._useStagingBitmap.apply(this,arguments):this.getChildRequiresParentStagingBitmap()||this.getIsMask()},AtomElement.prototype._drawChildren=function(t,e,n){return this.hasChildren?AtomElement.__super__._drawChildren.apply(this,arguments):n?this.drawBasic(t,e):this.drawBasic(t,e,this.getCompositeMode(),this.getOpacity())},AtomElement.prototype.fillShape=function(t,e,n){throw new Error("fillShape or drawBasic must be overridden")},AtomElement.prototype._prepareDrawOptions=function(t,e,n){return t.compositeMode=e,t.opacity=n,this._prepareColorOptions(t)},AtomElement.prototype._prepareColorOptions=function(t){var e,n,i,r,o,l,c,h,p,d;if(this,e=this._color,n=this._colors,i=this._currentSize,t.color=e,t.colors=null,t.gradientRadius=null,t.gradientRadius1=null,t.gradientRadius2=null,t.from=null,t.to=null,n)return r=(d=this)._from,l=d._to,o=d._gradientRadius,r||(r=s),t.colors=n,null!=o&&(l||(l=r),c=i.min()/2,u(o)?t.gradientRadius=o*c:(h=o[0],p=o[1],t.gradientRadius1=h*c,t.gradientRadius2=p*c)),l||(l=a),t.from=r.layout(i),t.to=l.layout(i)},AtomElement}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q,H,V,$,G,Y,K,X,J,Q,Z,tt,et,nt={}.hasOwnProperty,it=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};e=n(313),n(160),i=n(325),n(391),u=n(393),o=n(398),m=n(373),a=(Y=n(407)).ElementDrawMixin,r=Y.DrawCacheManager,s=Y.ElementDrawAreaMixin,n(412).config,_=n(376).isInfiniteResult,K=n(413),N=K.namedSizeLayouts,U=K.namedSizeLayoutsRaw,e.rgbColor,H=e.point,h=e.Point,e.rect,f=e.Rectangle,c=e.Matrix,F=e.matrix,w=e.identityMatrix,V=e.point0,$=e.point1,q=e.perimeter0,k=e.isPoint,j=e.perimeter,D=h.namedPoints,Math.floor,Math.ceil,r.drawCacheManager,p=u.PointLayout,G=p.pointLayout,(X=n(381)).each,X.find,X.arrayWithout,X.neq,X.inspect,X.inspectLean,g=X.clone,X.time,X.plainObjectsDeepEq,X.shallowEq,X.Unique,X.compact,M=X.keepIfRubyTrue,A=X.log,x=X.insert,J=X.remove,R=X.merge,B=X.max,O=X.min,X.arrayWithoutValue,L=X.minimumOrderedOverlappingMerge,T=X.isPlainObject,X.isPlainArray,E=X.isNumber,I=X.isString,C=X.isFunction,z=X.mergeInto,b=X.float32Eq0,l=X.Join,X.rubyTrue,X.createWithPostCreate,X.currentSecond,X.repeat,X.present,d=X.Promise,X.modulo,P=X.inspectedObjectLiteral,S=X.defineModule,X.isArray,X.formattedInspect,W=X.object,tt=X.toInspectedObjects,y=X.customCompactFlatten,Z=g(et={stagingBitmapsCreated:0,lastStagingBitmapSize:null,elementsDrawn:0}),v=H(100),Q=m.stateEpoch,o.nonStatePropertyKeyTest,S(t,function(t){var e,n,r,u,h,m,g,S,Y;function Element(t,e){Element.created++,Element.__super__.constructor.call(this,t),this._propertiesInitialized=!1,null!=e&&this.setChildren(e),this._propertiesInitialized=!0}return function(t,e){for(var n in e)nt.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Element,a(s(o))),Element.registerWithElementFactory=function(){return!0},Element.stats=Z,Element.resetStats=function(){return z(Z,et)},Element.created=0,Element.createdByType={},Element.resetCreated=function(){return Element.created=0,Element.createdByType={}},Element.prototype._initFields=function(){return Element.__super__._initFields.apply(this,arguments),this._resetDrawCache(),this._initTemporaryFields(),this._initComputedFields(),this._activeAnimator=null,this._toVoidAnimationStatus=!1,this._locationLayoutDisabled=!1},Element.prototype._initTemporaryFields=function(){return this._currentDrawTarget=null,this._currentToTargetMatrix=null,this._lastParentSize=null,this._bitmapFactory=null},Element.prototype._initComputedFields=function(){return this._elementSpaceDrawArea=null,this._filterChildren=[],this._rootElement=this,this._elementToAbsMatrix=null,this._absToElementMatrix=null,this._parentToElementMatrix=null},Element.getter({absToElementMatrix:function(){return this._absToElementMatrix||(this._absToElementMatrix=this._parent?this._parent.getAbsToElementMatrix().mul(this.getParentToElementMatrix()):this.getParentToElementMatrix())},parentToElementMatrix:function(){return this._parentToElementMatrix||(this._parentToElementMatrix=this._elementToParentMatrix.inv)},elementToDocumentMatrix:function(){return this.getElementToAbsMatrix().mul(this.getCanvasElement()._absToDocumentMatrix)},documentToElementMatrix:function(){return this.getCanvasElement()._documentToAbsMatrix.mul(this.getAbsToElementMatrix())},absOpacity:function(){var t,e;return t=this.getVisible()?this.getOpacity():0,(e=this.getParent())&&(t*=e.getAbsOpacity()),t},isChanging:function(){return this.__stateChangeQueued},isFilter:function(){return!1},rootElement:function(){return this._rootElement||(this._rootElement=this._parent?this._parent.getRootElement():this)},bitmapFactory:function(){var t;return this._bitmapFactory||(null!=(t=this.getCanvasElement())?t.bitmapFactory:void 0)||i.Bitmap},devicePixelsPerPoint:function(){return this.getRootElement()._devicePixelsPerPoint||1},canvasElement:function(){var t;return(t=this.getRootElement())!==this?t.getCanvasElement():null}}),Element.prototype.transformToParentSpace=function(t){return this._elementToParentMatrix.transform(t)},Element.prototype.transformFromParentSpace=function(t){return this._elementToParentMatrix.inverseTransform(t)},Element.prototype._clearRootElement=function(){var t,e,n,i,r,o,s;if(i=this._rootElement){for(this._rootElement=null,this.queueEvent("rootElementChanged",(s=this,function(){return{oldRootElement:i,rootElement:s.getRootElement()}})),o=[],e=0,n=(r=this._children).length;e<n;e++)t=r[e],o.push(t._clearRootElement());return o}},Element.prototype.preprocessEventHandlers=function(t){var e;for(e in t)t[e],"rootElementChanged"===e&&this.getRootElement();return t},Element.setter({absToElementMatrix:function(t){return this.setElementToAbsMatrix(t.invert())},parentToElementMatrix:function(t){return this.setElementToParentMatrix(t.invert())}}),r=new p({ps:1}),n=new p(0),Element.getSizePointLayout=h=function(t,e){var n;if(I(t)){if(!(n=N[t]))throw new Error("invalid named size layout: "+t);return e?G(U[t],e):n}return G(t,e||r)},(S=W(D,function(t){return{ps:t}}))[0]=0,g=W(S,function(t){return G(t)}),Element.getLocationPointLayout=u=function(t,e){var i;if(0===t||I(t)){if(!(i=g[t]))throw new Error("invalid named location layout: "+t);return e?G(S[t],e):i}return G(t,e||n)},Element.drawLayoutProperty({size:{default:"parentSize",validate:function(t){return!I(t)||!!N[t]},preprocess:h}}),Element.layoutProperty({location:{default:0,validate:function(t){return!I(t)||!!g[t]},preprocess:u,postSetter:function(){return this._locationLayoutDisabled=!1}},scale:{default:1,preprocess:function(t){return C(t)?t:H(t)},postSetter:function(){return this._locationLayoutDisabled=!1}},angle:{default:0,postSetter:function(){return this._locationLayoutDisabled=!1}},childrenLayout:{default:null,validate:function(t){return null===t||"flow"===t||"column"===t||"row"===t}},childrenAlignment:{default:V,preprocess:function(t){return H(t)}},axis:{default:V,preprocess:function(t){return H(t)}},inFlow:{default:!0,preprocess:function(t){return!!t}},layoutWeight:{default:1,validate:function(t){return E(t)}},padding:{default:0,drawAreaProperty:!0,preprocess:function(t){return C(t)?t:!1===t||void 0===t||null===t?null:j(t)}},margin:{default:null,preprocess:function(t){return C(t)?t:!1===t||void 0===t||null===t?null:j(t)}},childrenMargins:{default:null,preprocess:function(t){return C(t)?t:!1===t||void 0===t||null===t?null:j(t)}}}),m={ignoreTransforms:function(t){return t.getPendingCurrentSize()},totalArea:function(t,e){return t.getAreaInParentSpace(!0,e)},logicalArea:function(t,e){return t.getLogicalAreaInParentSpace(!0,e)}},Element.layoutProperty({childArea:{default:null,preprocess:function(t){return C(t)?t:m[t]},validate:function(t){return null==t||C(t)||m[t]}}}),Element.concreteProperty({noFocus:{default:!1,preprocess:function(t){return!!t},validate:function(t){return null==t||!0===t||!1===t}},currentSize:{default:v,setter:function(t,e){return e}},currentPadding:{default:q,setter:function(t,e){return e}},currentMargin:{default:q,setter:function(t,e){return e}}}),Element.virtualProperty({currentLocationX:function(t,e){var n,i,r,o;return r=(o=this.getState(t))._currentSize,n=e||o._axis,i=o._currentPadding,o._elementToParentMatrix.transformX(r.x*n.x-i.left,r.y*n.y-i.top)},currentLocationY:function(t,e){var n,i,r,o;return r=(o=this.getState(t))._currentSize,n=e||o._axis,i=o._currentPadding,o._elementToParentMatrix.transformY(r.x*n.x-i.left,r.y*n.y-i.top)},currentLocation:function(t,e){var n,i,r,o;return r=(o=this.getState(t))._currentSize,n=o._axis,i=o._currentPadding,e||(e=o._elementToParentMatrix),e.transformXY(r.x*n.x-i.left,r.y*n.y-i.top)},currentAngle:function(t){return this.getState(t)._elementToParentMatrix.angle},currentScale:function(t){return this.getState(t)._elementToParentMatrix.getExactScale()},elementToAbsMatrix:{getter:function(t){var e;return(e=this.getState(t))._elementToAbsMatrix||(e._elementToAbsMatrix=e._parent?e._elementToParentMatrix.mul(e._parent.getElementToAbsMatrix()):e._elementToParentMatrix)},setter:function(t){return this.setElementToParentMatrix(this._parent?t.mul(this._parent.getAbsToElementMatrix()):t)}}}),Element.getter({currentElementToParentMatrix:function(t,e,n){return e||n?(e||(e=this.getCurrentLocation(t)),this._getElementToParentMatrixForXY(t,e.x,e.y,n)):this.getState(t)._elementToParentMatrix}}),Element.concreteProperty({cursor:{default:null,validate:function(t){return!t||"string"==typeof t}},elementToParentMatrix:{default:c.identityMatrix,preprocess:function(t){return F(t)},setter:function(t){return this._locationLayoutDisabled=!0,F(t)}},parent:{default:null,setter:function(t){return t?t.addChild(this):this.removeFromParent(),t}},children:{default:Y=[],setter:function(t,e){var n,i,r,o,s,a,l,u,c,h,p,d;for(this.__drawPropertiesChanged=!0,t=y(t,M),e===Y,this._filterChildren=null,r=0,s=e.length;r<s;r++)if((n=e[r]).getPendingHasToVoidAnimators()){i=!0;break}if(i){for(o=[],c=0,a=e.length;c<a;c++)"done"===(n=e[c])._toVoidAnimationStatus?n._toVoidAnimationStatus=!1:it.call(t,n)>=0?o.push(n):n.getPendingHasToVoidAnimators()&&(n._activateToVoidAnimators(),o.push(n));t=L(o,t)}for(p=0,l=e.length;p<l;p++)n=e[p],it.call(t,n)<0&&n._setParentOnly(null);for(d=0,u=t.length;d<u;d++)(n=t[d]).getIsFilter()&&(this._filterChildren||(this._filterChildren=[])).push(n),(h=n.getPendingParent())!==this&&(null!=h&&h._setChildrenOnly(h.pendingChildrenWithout(n)),n._setParentOnly(this));return this._filterChildren||(this._filterChildren=Y),t}}}),Element.prototype.eachChild=function(t){var e,n,i;for(e=0,n=(i=this._children).length;e<n;e++)t(i[e]);return this},Element.prototype._toVoidAnimationDone=function(){var t,e,n;for(e in n=this.animators)if(null!=(t=n[e]).toVoid&&null!=t.active)return;return this._toVoidAnimationStatus="done",this.removeFromParent()},Element.prototype._activateToVoidAnimators=function(){var t,e,n,i;if(!this._toVoidAnimationStatus&&this.getPendingHasToVoidAnimators()){for(e in this._toVoidAnimationStatus="active",i=[],n=this.getPendingAnimators())(t=n[e]).getHasToVoidAnimation()&&i.push(t.startToVoidAnimation(this).then(function(t){return function(){return t._toVoidAnimationDone()}}(this)));return i}},Element.getter({logicalArea:function(){var t,e,n,i,r,o;return t=(e=this.getCurrentPadding()).left,i=e.top,r=(n=this._currentSize).x,o=n.y,new f(-t,-i,r,o)},paddedWidth:function(){return this._currentSize.x-this.getCurrentPadding().getWidth()},paddedHeight:function(){return this._currentSize.y-this.getCurrentPadding().getHeight()},paddedSize:function(){var t,e,n,i;return t=this.getCurrentPadding(),n=(e=this._currentSize).x,i=e.y,H(n-t.getWidth(),i-t.getHeight())},paddedArea:function(t){var e,n;return e=this.getCurrentPadding(),n=this._currentSize,null==t&&(t=new f(0,0)),t.x=t.y=0,t.w=B(0,n.x-e.getWidth()),t.h=B(0,n.y-e.getHeight()),t}}),Element.drawAreaProperty({clip:{default:!1,preprocess:function(t){return!!t}}}),Element.drawLayoutProperty({visible:{default:!0,preprocess:function(t){return!!t}}}),Element.concreteProperty({opacity:{default:1,validate:function(t){return"number"==typeof t}},compositeMode:{default:"normal",validate:function(t){return"string"==typeof t}},pointerEventPriority:{default:0,preprocess:function(t){return 0|t}},userProps:{default:null,validate:function(t){return null==t||T(t)}},receivePointerEvents:{default:"inLogicalArea",validate:function(t){return C(t)||"always"===t||"never"===t||"inLogicalArea"===t||"inPaddedArea"===t||"passToChildren"===t}}}),Element.virtualProperty({invisible:{getter:function(t){return this.getState(t)._visible},setter:function(t){return this.setVisible(!t)}},hasToVoidAnimators:{getter:function(t){var e,n;if(e=this.getState(t)._animators)for(n in e)if(e[n].hasToVoidAnimation)return!0;return!1}},isMask:{getter:function(t){return"alphaMask"===this.getState(t)._compositeMode},setter:function(t){return this.setCompositeMode(t?"alphaMask":"normal")}},opacityPercent:function(t){return 100*this.getState(t)._opacity|0},hasMask:function(t){var e,n,i;for(e=0,n=(i=this.getState(t)._children).length;e<n;e++)if(i[e].isMask)return!0;return!1},firstMask:function(t){var e,n,i,r;for(n=0,i=(r=this.getState(t)._children).length;n<i;n++)if((e=r[n]).isMask)return e},sizeAffectsLocation:function(t){var e;return 0!==(e=this.getState(t))._axis.x||0!==e._axis.y},absoluteAxis:function(t){var e;return(e=this.getState(t))._currentSize.mul(e._axis)},sizeForChildren:function(t,e){var n,i,r;return n=(r=this.getState(t))._currentPadding,i=r._currentSize,n.subtractedFromSize(e||i)},parentSizeForChildren:function(t){var e;return(null!=(e=this.getState(t)._parent)?e.getSizeForChildren(t):void 0)||v},nextSibling:{getter:function(t){var e;return[e=this.getState(t)._parent,(null!=e?e.getChildren(t)[e.getChildIndex(this,t)+1]:void 0)||null]},setter:function(t){return this.placeRelativeToSibling(t,0)}},prevSibling:{getter:function(t){var e;return[e=this.getState(t)._parent,(null!=e?e.getChildren(t)[e.getChildIndex(this,t)-1]:void 0)||null]},setter:function(t){return this.placeRelativeToSibling(t,1)}},maxXInParentSpace:function(t){var e,n,i,r,o,s,a,l;return e=(s=this.getState(t))._currentPadding,n=s._currentSize,i=s._elementToParentMatrix,a=n.x+(o=-e.left),r=n.y+(l=-e.top),B((i.transformX(o,l),i.transformX(o,r),i.transformX(a,l),i.transformX(a,r)))},maxYInParentSpace:function(t){var e,n,i,r,o,s,a,l;return e=(s=this.getState(t))._currentPadding,n=s._currentSize,i=s._elementToParentMatrix,a=n.x+(o=-e.left),r=n.y+(l=-e.top),B((i.transformY(o,l),i.transformY(o,r),i.transformY(a,l),i.transformY(a,r)))},areaInParentSpace:function(t,e){var n,i,r,o,s,a,l,u,c,h,p,d,m,g,y,v,S,b;return n=(a=this.getState(t))._currentPadding,i=a._currentSize,r=a._elementToParentMatrix,e||(e=new f),l=i.x+(s=-n.left),o=i.y+(u=-n.top),e.x=c=O(h=r.transformX(s,u),p=r.transformX(s,o),d=r.transformX(l,u),m=r.transformX(l,o)),e.y=g=O(y=r.transformY(s,u),v=r.transformY(s,o),S=r.transformY(l,u),b=r.transformY(l,o)),e.w=B(h,p,d,m)-c,e.h=B(y,v,S,b)-g,e},logicalAreaInParentSpace:function(t,e){var n,i,r;return n=(r=this.getState(t))._axis,i=r._currentSize,e||(e=new f),e.x=this.getCurrentLocationX(t)-i.x*n.x,e.y=this.getCurrentLocationY(t)-i.y*n.y,e.w=i.x,e.h=i.y,e},widthInParentSpace:function(t){var e,n,i,r,o,s,a,l,u,c;return s=-(a=(u=this.getState(t))._currentPadding).left,c=-a.top,l=u._currentSize.x+s,i=u._currentSize.y+c,e=u._elementToParentMatrix.transformX(s,c),n=u._elementToParentMatrix.transformX(s,i),r=u._elementToParentMatrix.transformX(l,c),o=u._elementToParentMatrix.transformX(l,i),B(e,n,r,o)-O(e,n,r,o)},heightInParentSpace:function(t){var e,n,i,r,o,s,a,l,u,c;return s=-(a=(u=this.getState(t))._currentPadding).left,c=-a.top,l=u._currentSize.x+s,i=u._currentSize.y+c,e=u._elementToParentMatrix.transformY(s,c),n=u._elementToParentMatrix.transformY(s,i),r=u._elementToParentMatrix.transformY(l,c),o=u._elementToParentMatrix.transformY(l,i),B(e,n,r,o)-O(e,n,r,o)},layoutLocationParentCircular:function(t){var e,n;return!!(n=this.getState(t))._location.layoutIsCircular(null!=(e=n._parent)?e.getState(t)._size:void 0)},layoutSizeParentCircular:function(t){var e,n;return!!(n=this.getState(t))._size.layoutIsCircular(null!=(e=n._parent)?e.getState(t)._size:void 0)},layoutMovesChildren:function(t){return!!this.getState(t)._childrenLayout}}),Element.getter({allChildrenAreUpLayout:function(){return!1}}),Element.getter({coreProps:function(){var t,e,n,i,r;for(r={},t=0,e=(i=[this._axis&&!this.axis.eq(H())?"axis":void 0,this.location.eq(V)?void 0:"location",this._currentSize?"size":void 0,b(this.angle)?void 0:"angle",this.scale.eq(H(1,1))?void 0:"scale",this._compositeMode&&"normal"!==this._compositeMode?"compositeMode":void 0,null!=this._opacity&&this._opacity<1?"opacity":void 0,this._invisible?"invisible":void 0,this._layout?"layout":void 0]).length;t<e;t++)(n=i[t])&&(r[n]=this[n]);return r},requiresParentStagingBitmap:function(){return"normal"!==this._compositeMode},firstChildRequiringParentStagingBitmap:function(){var t,e,n,i;for(e=0,n=(i=this._children).length;e<n;e++)if((t=i[e]).getRequiresParentStagingBitmap())return t},childRequiresParentStagingBitmap:function(){return!!this.getFirstChildRequiringParentStagingBitmap()}}),Element.prototype.inspectParentStructure=function(t){return null==t&&(t=this.elementPath),1===t.length?[t[0].inspectedName,t[0].coreProps]:[t[0].inspectedName,t[0].coreProps,this.inspectParentStructure(t.slice(1))]},Element.prototype.inspectChildrenStructure=function(){var t;return[this.inspectedName,this.coreProps].concat(function(){var e,n,i,r;for(r=[],e=0,n=(i=this._children).length;e<n;e++)t=i[e],r.push(t.inspectChildrenStructure());return r}.call(this))},Element.prototype.inspectRender=function(t,e){var n,i;return n=t.area||"parentLogicalArea",this.onNextReady((i=this,function(){var r,o,s,a,u,c;for((a=new l).do(function(e){return i.toBitmapWithInfo(R(t,{area:"logicalArea"}),function(t){var n;return(n={})[i.inspectedName]=[i.inspectedName,t],e(n)})}),r=function(e,i){return a.do(function(r){return e.toBitmapWithInfo(R(t,{area:n}),function(t){var n;return(n={})["child"+i]=[e.inspectedName,t],r(n)})})},o=s=0,u=(c=i.children).length;s<u;o=++s)r(c[o],o);return a.join(function(t){return e(R(t))})}))},Element.prototype.logInspectRender=function(t){return null==t&&(t={}),t.pixelsPerPoint||(t.pixelsPerPoint=this.devicePixelsPerPoint),this.inspectRender(t,(e=this,function(t){return e.log(t)}));var e},Element.prototype.abortAnimations=function(){if(this._activeAnimator)return this._activeAnimator.abort()},Element.prototype.finishAnimations=function(){if(this._activeAnimator)return this._activeAnimator.finish()},Element.prototype.startChildAddedAnimation=function(t){var e;if(e=t.getPendingAddedAnimation()||this._propertiesInitialized&&this.getPendingChildAddedAnimation())return t.animate=e},Element.getter({hasCustomClipping:function(){return!1}}),Element.prototype._elementToParentMatrixChanged=function(t){},Element.prototype.toBitmapWithInfo=function(t){var e,n;return null==t&&(t={}),T(e=t)||(e={size:H(t)}),new d((n=this,function(t){return Q.onNextReady(function(){var i;return t(i=n.toBitmapSync(e)),"function"==typeof callback?callback(i.bitmap,i.elementToBitmapMatrix):void 0})}))},Element.prototype.scrollOnscreen=function(t,e){return this.scrollOnScreen(t,e)},Element.prototype.scrollOnScreen=function(t,e){var n,i,r;for(n=this.parent,r=[];n;)"function"==typeof n.scrollToChild&&n.scrollToChild(this,t,e),r.push((n=(i=n).parent,i));return r},Element.prototype.toBitmap=function(t){return A.error("DEPRICATED: ArtEngine.Element.toBitmap use toBitmapBasic of toBitmapWithInfo"),this.toBitmapWithInfo(t)},Element.prototype.toBitmapBasic=function(t){return this.toBitmapWithInfo(t).then(function(t){return t.bitmap})},Element.prototype.toBitmapSync=function(t){var e,n,i,r,o,s,a,l,u,h,p,d,f;return null==t&&(t={}),t.elementToDrawAreaMatrix&&!t.area&&(t.area="targetDrawArea"),e=function(){switch(t.area||"drawArea"){case"logicalArea":return{drawArea:this.logicalArea,elementToDrawAreaMatrix:w};case"paddedArea":return{drawArea:this.paddedArea,elementToDrawAreaMatrix:w};case"drawArea":return{drawArea:this.elementSpaceDrawArea,elementToDrawAreaMatrix:w};case"parentLogicalArea":return{drawArea:this.parent.logicalArea,elementToDrawAreaMatrix:this.elementToParentMatrix};case"parentPaddedArea":return{drawArea:this.parent.paddedArea,elementToDrawAreaMatrix:this.elementToParentMatrix};case"parentDrawArea":return{drawArea:this.parent.elementSpaceDrawArea,elementToDrawAreaMatrix:this.elementToParentMatrix};case"targetDrawArea":return{drawArea:this.getDrawAreaIn(t.elementToDrawAreaMatrix||w),elementToDrawAreaMatrix:w};default:throw new Error("invalid area option: "+t.area)}}.call(this),o=(t=R(e,t)).drawArea,a=t.elementToDrawAreaMatrix,f=t.size,l=t.mode,r=t.bitmapFactory,h=t.pixelsPerPoint,n=t.backgroundColor,h||(h=1),l||(l="fit"),p=(f=H(f||o.size).mul(h).ceil()).div(o.size.max($)),"zoom"===l?d=p.max():(d=p.min(),f=o.size.mul(d).ceil()),s=a.mul(c.translate(o.cc.neg).scale(d).translate(f.cc)),u=this._bitmapFactory,this._bitmapFactory=r||this.bitmapFactory,(i=this.bitmapFactory.newBitmap(f.max($))).pixelsPerPoint=h,n&&i.clear(n),this.drawOnBitmap(i,s),this._bitmapFactory=u,{bitmap:i,elementToBitmapMatrix:s}},Element.prototype.logBitmap=function(t){return null==t&&(t={}),t.pixelsPerPoint||(t.pixelsPerPoint=this.devicePixelsPerPoint),this.toBitmapBasic(t).then((e=this,function(t){return e.log({currentSize:e.currentSize,currentLocation:e.currentLocation,size:e.size,location:e.location,elementToParentMatrix:e.elementToParentMatrix,bitmap:t})}));var e},Element.prototype.fillShape=function(t,e,n){null==n&&(n={})},Element.prototype.strokeShape=function(t,e,n){null==n&&(n={})},Element.prototype.compositingChanged=function(){return this.getOpacityChanged()||this.getCompositeModeChanged()},Element.getter({redrawRequired:function(){var t;return t=this._pendingState,this.__drawPropertiesChanged||this._opacity!==t._opacity||this._compositeMode!==t._compositeMode||this._parent!==t._parent||!this._currentSize.eq(t._currentSize)||!this._elementToParentMatrix.eq(t._elementToParentMatrix)}}),Element.prototype._setChildrenOnly=function(t){return this._pendingState._children=t,this._elementChanged(),t},Element.prototype._setParentOnly=function(t){return this._pendingState._parent=t,this._elementChanged(),t},Element.prototype._getElementToParentMatrixForXY=function(t,e,n,i,r){var o,s,a,l,u,h,p,d,f,m,g,y,v,S,b,w,x,P,_;return a=(w=P=this.getState(t))._currentPadding,l=w._currentSize,s=w._axis,p=w._scale,o=w._angle,u=w._elementToParentMatrix,S=p,null!=i&&(p=i),C(p)&&(h=P._parent,p=p(b=r||h.getState(t)._currentSize,l)),(p=H(p)).isInfinite&&(A.warn({"Art.Engine.Element":{message:"Scale is infinite. Replacing with point(1).",element:this.inspectedName,scale:{input:S,output:p},parentSize:b,currentSize:l}}),p=$),v=a.left,_=a.top,x=l,f=(d=s).x*x.x-v,m=d.y*x.y-_,this._locationLayoutDisabled?(g=u.transformX(f,m),y=u.transformY(f,m),u.translate(e-g,n-y)):(new c).translateXY(-f,-m,!0).scale(p,!0).rotate(o,!0).translateXY(e,n,!0)},Element.prototype._setElementToParentMatrixFromLayout=function(t,e){return this._setElementToParentMatrixFromLayoutXY(t.x,t.y,e)},Element.prototype._setElementToParentMatrixFromLayoutXY=function(t,e,n){var i;if(!this._locationLayoutDisabled)return i=this._getElementToParentMatrixForXY(!0,t,e,null,n),this._pendingState._elementToParentMatrix.eq(i)||(this._pendingState._elementToParentMatrix=i,this._elementChanged()),this},Element.prototype._translateLocationXY=function(t,e){return this._pendingState._elementToParentMatrix=this._pendingState._elementToParentMatrix.translateXY(t,e),this._elementChanged()},Element.prototype._sizeDirectlyEffectsDrawing=function(){var t;return(t=this.getPendingChildren())&&0===t.length||this.getPendingClip()||this._draw},Element.prototype._setSizeFromLayout=function(t){if(t.x,t.y,!t.eq(this.getPendingCurrentSize()))return this._pendingState._currentSize=t,this._sizeDirectlyEffectsDrawing()&&(this.__drawPropertiesChanged=!0),this._elementChanged(),t},Element.prototype._setPaddingFromLayout=function(t){return this._pendingState._currentPadding=t,this._elementChanged(),t},Element.prototype._setMarginFromLayout=function(t){return this._pendingState._currentMargin=t,this._elementChanged(),t},Element.prototype._setElementToParentMatrixWithoutChangingLocation=function(t){var e,n,i,r,o,s,a,l,u;return o=(r=this._pendingState)._currentSize,n=r._axis,e=o.x*n.x,i=o.y*n.y,s=r._elementToParentMatrix.transformX(e,i),l=r._elementToParentMatrix.transformY(e,i),a=t.transformX(e,i),u=t.transformY(e,i),this.setElementToParentMatrix(t.translateXY(s-a,l-u))},Element.prototype.getElementToElementMatrix=function(t){return null==t&&(t=this.getRootElement()),t===this?F():this.getElementToAbsMatrix().mul(t.getAbsToElementMatrix())},Element.prototype.getElementToTargetMatrix=function(t){return this._elementToParentMatrix.mul(t)},Element.prototype.transformToAncestorSpace=function(t,e){var n,i,r,o,s;for(i=t.x,o=t.y,n=this;n;)if(r=n._elementToParentMatrix.transformX(i,o),s=n._elementToParentMatrix.transformY(i,o),i=r,o=s,(n=n.parent)===e)return H(i,o);return null},Element.prototype.transformToAncestorSpaceX=function(t,e){var n,i,r;for(k(t)?(i=t.x,r=t.y):(i=t,r=0),n=this;n;)if(i=n._elementToParentMatrix.transformX(i,r),r=n._elementToParentMatrix.transformY(i,r),(n=n.parent)===e)return i;return null},Element.prototype.transformToAncestorSpaceY=function(t,e){var n,i,r;for(k(t)?(i=t.x,r=t.y):(i=0,r=t),n=this;n;)if(i=n._elementToParentMatrix.transformX(i,r),r=n._elementToParentMatrix.transformY(i,r),(n=n.parent)===e)return r;return null},Element.prototype.pointInsideChildren=function(t){return!(!this._visible||!this.childUnderPoint(this.getParentToElementMatrix().transform(t)))},Element.prototype.pointInside=function(t){var e,n,i,r,o,s,a;return this._visible&&!this.getIsMask()&&function(){if(C(this._receivePointerEvents))return this._receivePointerEvents(this.getParentToElementMatrix().transform(t),this,t);switch(this._receivePointerEvents){case"always":return!0;case"never":return!1;case"passToChildren":return this.pointInsideChildren(t);case"inPaddedArea":return n=this.getParentToElementMatrix(),r=this._currentSize,i=this._currentPadding,s=n.transformX(t.x,t.y),a=n.transformY(t.x,t.y),o=r.x-i.getWidth(),e=r.y-i.getHeight(),s>=0&&a>=0&&s<o&&a<e;case"inLogicalArea":return n=this.getParentToElementMatrix(),r=this._currentSize,i=this._currentPadding,s=n.transformX(t.x,t.y),a=n.transformY(t.x,t.y),s+=i.left,a+=i.top,o=r.x,e=r.y,s>=0&&a>=0&&s<o&&a<e}}.call(this)},Element.prototype.childUnderPoint=function(t){var e,n,i;for(n=(i=this._children).length-1;n>=0;n+=-1)if((e=i[n]).pointInside(t))return e;return!1},Element.prototype.getChildIndex=function(t,e){return this.getChildren(e).indexOf(t)},Element.prototype.find=function(t,e,n){var i,r,o,s,a,l,u,c,h,p;if(i=(u=null!=e?e:{}).findAll,p=u.verbose,null==n&&(n=[]),(l=(h=C(t))?!!(r=t(this)):(a=this.pathStringWithNames+(this.key?":"+this.key:"")+":"+this.objectId).match(t))&&(p&&this.log(h?{found:this.inspectedNameWithoutIds,functionResult:r}:{found:this.inspectedNameWithoutIds,pattern:t,matched:a}),n.push(this)),!l||i)for(o=0,s=(c=this._children).length;o<s;o++)c[o].find(t,arguments[1],n);return n},Element.prototype.findElementsWithKey=function(t){return this.find(function(e){return e.key===t})},Element.prototype.findElementWithKey=function(t){return this.findElementsWithKey(t)[0]},Element.getter({elementPathWithoutIds:function(){return this.parent?this.parent.elementPath+" > "+this.classPathNameAndId:this.classPathNameAndId},topMostParent:function(){return this._parent?this._parent.topMostParent||this._parent:null},hasChildren:function(){return this._children.length>0},reverseChildren:function(){return this._children.slice().reverse()},elementPath:function(){var t;return this.parent?((t=this.parent.elementPath).push(this),t):[this]},pathIdString:function(){var t;return function(){var e,n,i,r;for(r=[],e=0,n=(i=this.elementPath).length;e<n;e++)t=i[e],r.push(t.className+t.objectId);return r}.call(this).join("/")},pathString:function(){var t;return function(){var e,n,i,r;for(r=[],e=0,n=(i=this.elementPath).length;e<n;e++)t=i[e],r.push(t.className);return r}.call(this).join("/")},pathStringWithNames:function(){var t;return function(){var e,n,i,r;for(r=[],e=0,n=(i=this.elementPath).length;e<n;e++)t=i[e],r.push(t.inspectedNameWithoutIds);return r}.call(this).join("/")},fullPathString:function(){var t;return function(){var e,n,i,r;for(r=[],e=0,n=(i=this.elementPath).length;e<n;e++)t=i[e],r.push(t.classPathNameAndId);return r}.call(this).join("/")},childrenInspectedNames:function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this._children).length;e<n;e++)t=i[e],r.push(t.inspectedName);return r},inspectedObjects:function(){var t;return[P(this.inspectedName),tt(this.minimalProps)].concat(function(){var e,n,i,r;for(r=[],e=0,n=(i=this.children).length;e<n;e++)t=i[e],r.push(t.inspectedObjects);return r}.call(this))}}),e=function(t,e){var n;return(n=(t=t.slice()).indexOf(e))>=0&&J(t,n,1),t},Element.prototype.childrenWithout=function(t){return e(this._children,t)},Element.prototype.pendingChildrenWithout=function(t){return e(this.getPendingChildren(),t)},Element.prototype.insertChild=function(t,e){var n;return n=this.pendingChildrenWithout(t),e<0&&(e=n.length+1+e),this.setChildren(x(n,e,t)),t},Element.prototype.addChild=function(t){return this.insertChild(t,-1)},Element.prototype.addChildBelow=function(t,e){var n;return e!==t&&it.call(this.getPendingChildren(),e)>=0?(n=this.pendingChildrenWithout(t),this.setChildren(x(n,n.indexOf(e),t)),t):this.insertChild(t,0)},Element.prototype.addChildAbove=function(t,e){var n;return e!==t&&it.call(this.getPendingChildren(),e)>=0?(n=this.pendingChildrenWithout(t),this.setChildren(x(n,n.indexOf(e)+1,t)),t):this.insertChild(t,-1)},Element.prototype.addBelow=function(t){return t.getPendingParent().addChildBelow(this,t)},Element.prototype.addAbove=function(t){return t.getPendingParent().addChildAbove(this,t)},Element.prototype.addChildBelowMask=function(t){return this.addChildBelow(t,this.getPendingFirstMask())},Element.prototype.placeRelativeToSibling=function(t,e){var n,i,r;if(t&&t.constructor===Array){if(2!==t.length)throw new Error("If array is provided, it must be formated: [parent, sibling]");if(i=t[0],(r=t[1])&&r.getPendingParent()!==i)throw new Error("Sibling's current parent does not match specified parent. Did the sibling move?")}else i=(null!=(r=t)?r.getPendingParent():void 0)||this.getPendingParent();if(!i){if(r)throw new Error("Can't place next to sibling. Sibling is an orphan.");return this.setParent(null)}return n=i.pendingChildrenWithout(this),i.setChildren(x(n,n.indexOf(r)+e,this))},Element.prototype.removeChild=function(t){if(t)return this.setChildren(this.pendingChildrenWithout(t)),t},Element.prototype.releaseChildren=function(){return this.setChildren([])},Element.prototype.removeFromParent=function(){var t,e;return null!=(e=t=this.getPendingParent())&&e.removeChild(this),t},Element.prototype.moveChildToFront=function(t){return this.insertChild(t,-1)},Element.prototype.moveChildToBack=function(t){return this.insertChild(t,0)},Element.prototype.moveToFront=function(){var t;return null!=(t=this.getPendingParent())?t.insertChild(this,-1):void 0},Element.prototype.moveToBack=function(){var t;return null!=(t=this.getPendingParent())?t.insertChild(this,0):void 0},Element.prototype.moveBelow=function(t){var e;return null!=t&&null!=(e=t.getPendingParent())?e.addChildBelow(this,t):void 0},Element.prototype.moveBelowMask=function(){var t;return null!=(t=this.getPendingParent())?t.addChildBelowMask(this):void 0},Element.prototype._sizeChanged=function(t,e){return this.queueEvent("sizeChanged",{oldSize:e,size:t})},Element.prototype._applyStateChanges=function(){var t,e;if(this.getCurrentSizeChanged()&&this._sizeChanged(this._pendingState._currentSize,this._currentSize),this.getElementToParentMatrixChanged()&&(t=this._elementToParentMatrix),e=this.parentChanged,Element.__super__._applyStateChanges.apply(this,arguments),this.__drawAreaChanged&&this._drawAreaChanged(),this.__drawPropertiesChanged&&this._drawPropertiesChanged(),t&&this._elementToParentMatrixChanged(t),this.__drawAreaChanged=!1,this.__redrawRequired=!1,this.__drawPropertiesChanged=!1,this.__layoutPropertiesChanged=!1,e&&!this._parent)return this._releaseAllCacheBitmaps()},Element.prototype._layoutPropertiesChanged=function(){},Element.prototype._updateDrawArea=function(){},Element.prototype._layoutSize=function(t,e){return this.getPendingSize().layout(t,e)},Element.prototype._layoutSizeForChildren=function(t,e){var n,i,r,o;return n=(i=this.getPendingSize()).layout(t,e),i.getChildrenRelative()?(r=n.x,o=n.y,n.with(_(r)?t.x:r,_(o)?t.y:o)):n},Element.prototype._layoutLocation=function(t){return this.getPendingLocation().layout(t,this.getPendingCurrentSize())},Element.prototype._layoutLocationX=function(t){return this.getPendingLocation().layoutX(t,this.getPendingCurrentSize())},Element.prototype._layoutLocationY=function(t){return this.getPendingLocation().layoutY(t,this.getPendingCurrentSize())},Element.prototype.depth=function(){return this.parent?this.parent.depth()+1:1},Element.getter({focused:function(){var t;return!(!(t=this.getCanvasElement())||!t.isFocused(this))}}),Element.prototype._focus=function(){var t;return null!=(t=this.getCanvasElement())?t.focusElement(this):void 0},Element.prototype._blur=function(){var t;if(this.focused)return null!=(t=this.getCanvasElement())?t.focusElement(this.parent):void 0},Element.prototype._focusDomElement=function(){var t;return null!=(t=this.getCanvasElement())?t._focusDomElement():void 0},Element.prototype.focus=function(){return this._focus()},Element.prototype.blur=function(){return this._blur()},Element.prototype.capturePointerEvents=function(){var t;return null!=(t=this.getCanvasElement())?t.capturePointerEvents(this):void 0},Element.getter({pointerEventsCaptured:function(){var t;return null!=(t=this.getCanvasElement())?t.pointerEventsCapturedBy(this):void 0}}),Element.prototype.nonChildrenLayoutFirstPass=null,Element.prototype.nonChildrenLayoutFinalPass=null,Element.prototype.postFlexLayout=function(t,e){},Element}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g={}.hasOwnProperty;d=n(160),l=d.currentSecond,d.min,d.max,a=d.Transaction,c=d.inspect,d.inspectLean,h=d.log,i=d.BaseClass,(f=n(313)).rgbColor,f.Color,f.point,f.Point,f.rect,f.Rectangle,f.matrix,f.Matrix,o=(m=n(116)).EventEpoch,s=m.EventedMixin,r=n(392),u=o.eventEpoch,p=n(363).logFrameEvent,t.exports=function(t){function Animator(t,e){if(null==e&&(e={}),Animator.__super__.constructor.apply(this,arguments),this.transaction=new a(t,e),this.fixedStep=e.fixedStep,this.fixedStep&&this.fixedStep<=0)throw new Error("fixedStep must be > 0");this.duration=e.duration||.25,this.f=e.f,this.f?"string"==typeof this.f?(this.fName=this.f,this.f=r[this.f]):this.fName="custom":this.f=r[this.fName="easeInQuad"],e.on&&this.on(e.on),this.then=e.then,this.start()}return function(t,e){for(var n in e)g.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Animator,s(i)),Animator.animate=function(t,e){return new Animator(t,e)},Animator.prototype.inspect=function(t){return t.put(this.classPathName),t.put(" duration: "+this.duration+", function: "+this.fName),this.activated&&t.put(", activated, frames: "+this.frames+", pos: "+this.pos),this.aborted&&t.put(", aborted"),this.deactivated&&t.put(", deactivated"),this.transaction.inspectParts(t)},Animator.prototype.abort=function(){if(!this.aborted)return p("animationAborted",this.getObjectId()),this.aborted=!0,this.deactivateAnimation(),this.queueEvent("abort")},Animator.prototype.start=function(){return this.transaction.saveFromValues(),this.transaction.saveToValues(),this.transaction.optimize(),this.updateValues(0),this.activateAnimation(),this.frames=0,u.queue((t=this,function(){if(!t.deactivated)return t.updateValues(0),p("animation",t.getObjectId()),t.startTime=l(),t.queueEvent("start"),u.queue(function(){return t.advance()})}));var t},Animator.prototype.finish=function(){return this.updateValues(1),this.done()},Animator.getter({pos:function(){return this.fixedStep?this.frames*this.fixedStep:(this.now-this.startTime)/this.duration},objects:function(){return this.transaction.objects}}),Animator.prototype.activateAnimation=function(){var t,e,n,i,r;if(!this.activated){for(this.activated=!0,h({activateAnimation:this}),r=[],e=0,n=(i=this.objects).length;e<n;e++)t=i[e],h("  for: "+c(t)),t._activeAnimator&&(h(t.classPathName+" already has _activeAnimator... aborting last animation to start this one"),t._activeAnimator.abort()),r.push(t._activeAnimator=this);return r}},Animator.prototype.deactivateAnimation=function(){var t,e,n,i,r;if(!this.deactivated){for(this.deactivated=!0,r=[],e=0,n=(i=this.objects).length;e<n;e++)(t=i[e])._activeAnimator!==this&&(this.log("INTERNAL WARNING - animatedObject._activeAnimator should == @"),this.log("  animatedObject: ("+c(t,1)),this.log("  animatedObject._activeAnimator: ("+c(t._activeAnimator,1)),this.log("  @: ("+c(this,1))),r.push(t._activeAnimator=null);return r}},Animator.prototype.advance=function(){var t,e;if(!this.aborted&&!this.deactivated)return this.frames++,this.now=l(),(t=this.pos)<1?(this.updateValues(this.f(t)),u.queue((e=this,function(){return e.advance()}))):(this.updateValues(1),this.done())},Animator.prototype.done=function(){if(!this.aborted)return p("animation",this.getObjectId()),this.deactivateAnimation(),this.queueEvent("done"),this.nextAnimation()},Animator.prototype.nextAnimation=function(){if(this.then)return new Animator(this.then.objects||this.then.object||this.objects,this.then)},Animator.prototype.updateValues=function(t){return this.transaction.interpolate(t),this.queueEvent("update",{p:t})},Animator}()},function(t,e){t.exports=function(){function EasingFunctions(){}return EasingFunctions.linear=function(t){return t},EasingFunctions.easeOutQuad=function(t){return t*t},EasingFunctions.easeInQuad=function(t){return-t*(t-2)},EasingFunctions.easeBothQuad=function(t){return t<.5?.5*EasingFunctions.easeOutQuad(2*t):.5*EasingFunctions.easeInQuad(2*t-1)+.5},EasingFunctions.easeOutCubic=function(t){return t*t*t},EasingFunctions.easeInCubic=function(t){return(t-=1)*t*t+1},EasingFunctions.easeBothCubic=function(t){return t<.5?.5*EasingFunctions.easeOutCubic(2*t):.5*EasingFunctions.easeInCubic(2*t-1)+.5},EasingFunctions.easeOutQuart=function(t){return t*t*t*t},EasingFunctions.easeInQuart=function(t){return-((t-=1)*t*t*t-1)},EasingFunctions.easeBothQuart=function(t){return t<.5?.5*EasingFunctions.easeOutQuart(2*t):.5*EasingFunctions.easeInQuart(2*t-1)+.5},EasingFunctions.easeOutQuint=function(t){return 1*t*t*t*t*t},EasingFunctions.easeInQuint=function(t){return 1*((t-=1)*t*t*t*t+1)},EasingFunctions.easeBothQuint=function(t){return t<.5?.5*EasingFunctions.easeOutQuint(2*t):.5*EasingFunctions.easeInQuint(2*t-1)+.5},EasingFunctions.easeOutSine=function(t){return 1-Math.cos(t*Math.PI/2)},EasingFunctions.easeInSine=function(t){return Math.sin(t*Math.PI/2)},EasingFunctions.easeBothSine=function(t){return-.5*(Math.cos(Math.PI*t)-1)},EasingFunctions.easeOutExp=function(t){return t<=0?0:Math.pow(2,10*(t-1))},EasingFunctions.easeInExp=function(t){return t>=1?1:1-Math.pow(2,-10*t)},EasingFunctions.easeBothExp=function(t){return t<.5?.5*EasingFunctions.easeOutExp(2*t):.5*EasingFunctions.easeInExp(2*t-1)+.5},EasingFunctions.easeOutCirc=function(t){return-(Math.sqrt(1-t*t)-1)},EasingFunctions.easeInCirc=function(t){return Math.sqrt(1-(t-=1)*t)},EasingFunctions.easeBothCirc=function(t){return t<.5?.5*EasingFunctions.easeOutCirc(2*t):.5*EasingFunctions.easeInCirc(2*t-1)+.5},EasingFunctions.easeOutElastic=function(t){return t<=0?0:t>=1?1:(.3,.075,t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*(2*Math.PI)/.3))},EasingFunctions.easeInElastic=function(t){return t<=0?0:t>=1?1:(.3,.075,Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1)},EasingFunctions.easeBothElastic=function(t){return t<.5?.5*EasingFunctions.easeOutElastic(2*t):.5*EasingFunctions.easeInElastic(2*t-1)+.5},EasingFunctions.easeOutBack=function(t,e){return null==e&&(e=1.70158),t*t*((e+1)*t-e)},EasingFunctions.easeInBack=function(t,e){return null==e&&(e=1.70158),(t-=1)*t*((e+1)*t+e)+1},EasingFunctions.easeBothBack=function(t,e){return t<.5?.5*EasingFunctions.easeOutBack(2*t):.5*EasingFunctions.easeInBack(2*t-1)+.5},EasingFunctions.easeOutBounce=function(t){return 1-EasingFunctions.easeInBounce(1-t)},EasingFunctions.easeInBounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},EasingFunctions.easeBothBounce=function(t){return t<.5?.5*EasingFunctions.easeOutBounce(2*t):.5*EasingFunctions.easeInBounce(2*t-1)+.5},EasingFunctions}()},function(t,e,n){(t.exports=n(358)).includeInNamespace(n(394)).addModules({InterpolatedPointLayout:n(397),PointLayout:n(395),PointLayoutBase:n(396)})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>{let t;return({pointLayout:t}=n(395)),{pointLayout:t}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v={}.hasOwnProperty;g=n(313),f=g.point,i=g.Point,m=i.point0,s=(y=n(42)).defineModule,y.log,a=y.inspect,l=y.inspectLean,u=y.isFunction,c=y.isNumber,p=y.isString,h=y.isPlainObject,d=y.min,y.max,e=function(){var t,e,n,i,o,s,l,h,p,d,m,g;function Components(){}return Components.setupPointLayout=function(e,n,i){var o,s,l,u;for(s in l=e.maxLayout=n.max?new r(n.max):void 0,n){if(u=n[s],!(o=t[s]))throw new Error("invalid PointLayout component: "+a(s)+" in "+a(n));o(u,e)}return!e._hasXLayout&&(null!=i?i._hasXLayout:void 0)&&e.copyXLayout(i),!e._hasYLayout&&(null!=i?i._hasYLayout:void 0)&&e.copyYLayout(i),l&&e.mergeInLayoutRelativity(l),e},n=function(t,e){if(t||(t=0),!c(t))throw new Error("Each PointLayout component must be a number. Not "+a(t)+" from "+e);return t},e=function(t,e){return f(t)},Components._applyComponentsFunctions=t={max:function(t,e){},pts:i=function(t,n){return t=e(t),n._hasXLayout=n._hasYLayout=!0,n.x+=t.x,n.y+=t.y},x:o=function(t,e){return e._hasXLayout=!0,u(t)?e.customLayoutX=t:(t=n(t,e),e.x+=t)},y:p=function(t,e){return e._hasYLayout=!0,u(t)?e.customLayoutY=t:(t=n(t,e),e.y+=t)},ps:function(t,n){return t=e(t),n._hasXLayout=n._hasYLayout=n._xRelativeToParentW=n._yRelativeToParentH=!0,n.xpw+=t.x,n.yph+=t.y},xpw:h=function(t,e){return t=n(t,e),e._hasXLayout=e._xRelativeToParentW=!0,e.xpw+=t},yph:m=function(t,e){return t=n(t,e),e._hasYLayout=e._yRelativeToParentH=!0,e.yph+=t},xph:l=function(t,e){return t=n(t,e),e._hasXLayout=e._xRelativeToParentH=!0,e.xph+=t},ypw:g=function(t,e){return t=n(t,e),e._hasYLayout=e._yRelativeToParentW=!0,e.ypw+=t},cs:function(t,n){return t=e(t),n._hasXLayout=n._hasYLayout=n._xRelativeToChildrenW=n._yRelativeToChildrenH=!0,n.xcw+=t.x,n.ych+=t.y},xcw:s=function(t,e){return t=n(t,e),e._hasXLayout=e._xRelativeToChildrenW=!0,e.xcw+=t},ych:d=function(t,e){return t=n(t,e),e._hasYLayout=e._yRelativeToChildrenH=!0,e.ych+=t},plus:i,w:o,h:p,ww:h,hh:m,xw:h,yh:m,wh:l,hw:g,xh:l,yw:g,wpw:h,hph:m,wph:l,hpw:g,wcw:s,hch:d,width:o,height:p,widthParentWidth:h,heightParentHeight:m,widthChildrenWidth:s,heightChildrenHeight:d,xParentWidth:h,yParentHeight:m},Components}(),s(t,r=function(t){var r;function PointLayout(t,e){if(this.initializer=null!=t?t:m,PointLayout.__super__.constructor.apply(this,arguments),this._reset(),u(this.initializer))this._setupFromFunction(this.initializer);else if(h(this.initializer))this._setupFromOptions(this.initializer,e);else{if(c(this.initializer)&&isNaN(this.initializer))throw new Error("PointLayout#constructor: @initializer is NaN");this._setupFromPoint(this.initializer)}}return function(t,e){for(var n in e)v.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PointLayout,o=n(396)),PointLayout.pointLayout=r=function(t,e){return null==t?null!=e?r(e):new PointLayout:t instanceof o?t:new PointLayout(t,e)},PointLayout.prototype._reset=function(){return this.maxLayout=null,this.customLayout=null,this.customLayoutX=null,this.customLayoutY=null,this.x=this.xpw=this.xph=this.xcw=this.y=this.yph=this.ypw=this.ych=0},PointLayout.prototype.toString=function(){return"pointLayout("+this.toStringLean()+")"},PointLayout.prototype.toStringLean=function(){var t;return t=this.initializer?this.initializer instanceof i&&this.initializer.x===this.initializer.y?this.initializer.x:l(this.initializer):"0",this._inheritedXLayout&&(t+=", inheritedXLayout: "+this._inheritedXLayout),this._inheritedYLayout&&(t+=", inheritedYLayout: "+this._inheritedYLayout),t},PointLayout.getter({inspectedInitializer:function(){return this.initializer?a(this.initializer):"0"},plainObjects:function(){var t;return(t=this.initializer||0)instanceof i&&t.x===t.y&&(t=t.x),t.getPlainObjects&&(t=t.getPlainObjects()),t},inspectObjects:function(){return h(this.initializer)?{inspect:(t=this,function(){return l(t.initializer)})}:u(this.initializer)?{inspect:function(t){return function(){return t.initializer.toString().replace(/\s+/g," ")}}(this)}:this.initializer;var t}}),PointLayout.prototype.eq=function(t){return this.maxLayout===t.maxLayout&&this.customLayout===t.customLayout&&this.customLayoutX===t.customLayoutX&&this.customLayoutY===t.customLayoutY&&this.x===t.x&&this.xpw===t.xpw&&this.xph===t.xph&&this.xcw===t.xcw&&this.y===t.y&&this.yph===t.yph&&this.ypw===t.ypw&&this.ych===t.ych},PointLayout.prototype.layoutX=function(t,e){var n,i,r,o,s,a,l,u;return this,s=this.x,u=this.xpw,l=this.xph,a=this.xcw,n=this.customLayout,i=this.customLayoutX,r=this.maxLayout,n?n(t,e).x:i?i(t,e):(o=s,null!=t&&(o+=u*t.x+l*t.y),null!=e&&(o+=a*e.x),(null!=r?r.getHasXLayout():void 0)?d(o,r.layoutX(t)):o)},PointLayout.prototype.layoutY=function(t,e){var n,i,r,o,s,a,l,u;return this,s=this.y,l=this.yph,u=this.ypw,a=this.ych,n=this.customLayout,i=this.customLayoutY,r=this.maxLayout,n?n(t,e).y:i?i(t,e):(o=s,null!=t&&(o+=l*t.y+u*t.x),null!=e&&(o+=a*e.y),(null!=r?r.getHasYLayout():void 0)?d(o,r.layoutY(t)):o)},PointLayout.prototype.copyXLayout=function(t){return this._hasXLayout=!0,t.maxLayout||t.customLayout?this.customLayoutY=fastBind(t.layoutX,t):(this.x=t.x,this.xpw=t.xpw,this.xph=t.xph,this.xcw=t.xcw,this.customLayoutX=t.customLayoutX),this._copyXRelativity(t)},PointLayout.prototype.copyYLayout=function(t){return this._hasYLayout=!0,t.maxLayout||t.customLayout?this.customLayoutY=fastBind(t.layoutY,t):(this.y=t.y,this.yph=t.yph,this.ypw=t.ypw,this.ych=t.ych,this.customLayoutY=t.customLayoutY),this._copyYRelativity(t)},PointLayout.prototype._setupFromPoint=function(t){var e,n,i;return this._hasXLayout=this._hasYLayout=!0,c(t)?this.x=this.y=t:(n=(e=this.initializer=f(t)).x,i=e.y,p(t)?(this.xpw=n,this.yph=i):(this.x=n,this.y=i))},PointLayout.prototype._setupFromFunction=function(t){return this._hasXLayout=this._hasYLayout=!0,c(t(m,m))?(this.customLayoutX=t,this.customLayoutY=t):this.layout=this.customLayout=t,this._detectRelativity()},PointLayout.prototype._setupFromOptions=function(t,n){if(e.setupPointLayout(this,t,n),this.customLayoutX&&this._detectXRelativity(),this.customLayoutY)return this._detectYRelativity()},PointLayout}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h={}.hasOwnProperty;u=n(313),a=u.point,r=u.Point,l=r.point0,(c=n(42)).log,c.inspect,c.isFunction,c.isNumber,c.isPlainObject,s=c.nearInfinity,c.nearInfinityResult,o=c.inspectedObjectLiteral,i=n(96).BaseClass,t.exports=function(t){var e,n,r;function PointLayoutBase(t,e){this._xRelativeToParentW=this._xRelativeToParentH=this._yRelativeToParentW=this._yRelativeToParentH=this._xRelativeToChildrenW=this._xRelativeToChildrenH=this._yRelativeToChildrenW=this._yRelativeToChildrenH=!1,this._hasXLayout=this._hasYLayout=!1,this._inheritedXLayout=this._inheritedYLayout=!1}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PointLayoutBase,i),PointLayoutBase.prototype.layout=function(t,e){return a(this.layoutX(t,e),this.layoutY(t,e))},PointLayoutBase.prototype.mergeInLayoutRelativity=function(t){return this._xRelativeToParentW||(this._xRelativeToParentW=t._xRelativeToParentW),this._xRelativeToParentH||(this._xRelativeToParentH=t._xRelativeToParentH),this._yRelativeToParentW||(this._yRelativeToParentW=t._yRelativeToParentW),this._yRelativeToParentH||(this._yRelativeToParentH=t._yRelativeToParentH),this._xRelativeToChildrenW||(this._xRelativeToChildrenW=t._xRelativeToChildrenW),this._xRelativeToChildrenH||(this._xRelativeToChildrenH=t._xRelativeToChildrenH),this._yRelativeToChildrenW||(this._yRelativeToChildrenW=t._yRelativeToChildrenW),this._yRelativeToChildrenH||(this._yRelativeToChildrenH=t._yRelativeToChildrenH)},PointLayoutBase.prototype.interpolate=function(t,e){return 0===e?this:1===e?t:new PointLayoutBase.InterpolatedPointLayout(this,t,e)},PointLayoutBase.getter({inspectedString:function(){return this.toString()}}),PointLayoutBase.prototype.inspect=function(){return this.toString()},PointLayoutBase.prototype._copyXRelativity=function(t){return this._xRelativeToParentW=t._xRelativeToParentW,this._xRelativeToParentH=t._xRelativeToParentH,this._xRelativeToChildrenW=t._xRelativeToChildrenW,this._xRelativeToChildrenH=t._xRelativeToChildrenH},PointLayoutBase.prototype._copyYRelativity=function(t){return this._yRelativeToParentW=t._yRelativeToParentW,this._yRelativeToParentH=t._yRelativeToParentH,this._yRelativeToChildrenW=t._yRelativeToChildrenW,this._yRelativeToChildrenH=t._yRelativeToChildrenH},PointLayoutBase.getter({inspectedObjects:function(){return o(this.toString())}}),PointLayoutBase.getter("xRelativeToParentW\nxRelativeToParentH\nyRelativeToParentW\nyRelativeToParentH\nxRelativeToChildrenW\nxRelativeToChildrenH\nyRelativeToChildrenW\nyRelativeToChildrenH\nhasXLayout\nhasYLayout"),PointLayoutBase.getter({hasFullLayout:function(){return this._hasXLayout&&this._hasYLayout},hasLayout:function(){return this._hasXLayout||this._hasYLayout},parentRelative:function(){return this._xRelativeToParentH||this._xRelativeToParentW||this._yRelativeToParentH||this._yRelativeToParentW},childrenRelative:function(){return this._xRelativeToChildrenH||this._xRelativeToChildrenW||this._yRelativeToChildrenH||this._yRelativeToChildrenW},xParentRelative:function(){return this._xRelativeToParentH||this._xRelativeToParentW},yParentRelative:function(){return this._yRelativeToParentH||this._yRelativeToParentW},xChildrenRelative:function(){return this._xRelativeToChildrenH||this._xRelativeToChildrenW},yChildrenRelative:function(){return this._yRelativeToChildrenH||this._yRelativeToChildrenW}}),PointLayoutBase.prototype.layoutIsCircular=function(t){var e,n,i,r,o,s,a,l;return!!t&&(i=this._xRelativeToParentW,r=this._xRelativeToParentH,a=this._yRelativeToParentW,l=this._yRelativeToParentH,e=t.getXRelativeToChildrenW(),n=t.getXRelativeToChildrenH(),o=t.getYRelativeToChildrenW(),s=t.getYRelativeToChildrenH(),!!(i&&e||r&&o||l&&s||a&&n||r&&s&&a&&n||i&&n&&l&&o))},e=a(s,s),n=l.withX(s),r=l.withY(s),PointLayoutBase.prototype.isParentRelative=function(t,e,n,i){return this[t](i,n)!==e},PointLayoutBase.prototype.isChildrenRelative=function(t,e,n,i){return this[t](n,i)!==e},PointLayoutBase.prototype._detectXRelativity=function(){var t,i;return t=this.layoutX(l,l),i=this.layoutX(e,e),this._xRelativeToParentW=this.isParentRelative("layoutX",t,l,n)||this.isParentRelative("layoutX",i,e,r),this._xRelativeToParentH=this.isParentRelative("layoutX",t,l,r)||this.isParentRelative("layoutX",i,e,n),this._xRelativeToChildrenW=this.isChildrenRelative("layoutX",t,l,n)||this.isChildrenRelative("layoutX",i,e,r),this._xRelativeToChildrenH=this.isChildrenRelative("layoutX",t,l,r)||this.isChildrenRelative("layoutX",i,e,n)},PointLayoutBase.prototype._detectYRelativity=function(){var t,i;return t=this.layoutY(l,l),i=this.layoutY(e,e),this._yRelativeToParentW=this.isParentRelative("layoutY",t,l,n)||this.isParentRelative("layoutY",i,e,r),this._yRelativeToParentH=this.isParentRelative("layoutY",t,l,r)||this.isParentRelative("layoutY",i,e,n),this._yRelativeToChildrenW=this.isChildrenRelative("layoutY",t,l,n)||this.isChildrenRelative("layoutY",i,e,r),this._yRelativeToChildrenH=this.isChildrenRelative("layoutY",t,l,r)||this.isChildrenRelative("layoutY",i,e,n)},PointLayoutBase.prototype._detectRelativity=function(){return this._detectXRelativity(),this._detectYRelativity()},PointLayoutBase}()},function(t,e,n){var i,r,o={}.hasOwnProperty;i=n(160),r=n(396),i.log,t.exports=function(t){var e;function InterpolatedPointLayout(t,n,i){InterpolatedPointLayout.__super__.constructor.apply(this,arguments),this.layout1=t,this.layout2=n,this.p=i,this._hasXLayout=this.layout1._hasXLayout||!this.layout2._hasXLayout,this._hasYLayout=this.layout1._hasYLayout||!this.layout2._hasYLayout,this._xRelativeToParentW=this.layout1._xRelativeToParentW||this.layout2._xRelativeToParentW,this._xRelativeToParentH=this.layout1._xRelativeToParentH||this.layout2._xRelativeToParentH,this._yRelativeToParentW=this.layout1._yRelativeToParentW||this.layout2._yRelativeToParentW,this._yRelativeToParentH=this.layout1._yRelativeToParentH||this.layout2._yRelativeToParentH,this._xRelativeToChildrenW=this.layout1._xRelativeToChildrenW||this.layout2._xRelativeToChildrenW,this._xRelativeToChildrenH=this.layout1._xRelativeToChildrenH||this.layout2._xRelativeToChildrenH,this._yRelativeToChildrenW=this.layout1._yRelativeToChildrenW||this.layout2._yRelativeToChildrenW,this._yRelativeToChildrenH=this.layout1._yRelativeToChildrenH||this.layout2._yRelativeToChildrenH,this.layoutX=function(r,o){return e(i,t._hasXLayout,n._hasXLayout,t.layoutX(r,o),n.layoutX(r,o))},this.layoutY=function(r,o){return e(i,t._hasYLayout,n._hasYLayout,t.layoutY(r,o),n.layoutY(r,o))}}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(InterpolatedPointLayout,r),r.InterpolatedPointLayout=InterpolatedPointLayout,InterpolatedPointLayout.prototype.eq=function(t){return this.layout2.eq(t.layout2)},InterpolatedPointLayout.prototype.toString=function(){return"InterpolatedPointLayout(from: ("+this.layout1.toStringLean()+"), to: ("+this.layout2.toStringLean()+"), "+(100*this.p|0)+"%)"},InterpolatedPointLayout.getter({inspectedString:function(){return this.toString()}}),InterpolatedPointLayout.prototype.inspect=function(){return this.toString()},InterpolatedPointLayout.interpolate1D=e=function(t,e,n,i,r){return e?n?(r-i)*t+i:i:r},InterpolatedPointLayout}()},function(t,e,n){"use strict";var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b={}.hasOwnProperty,w=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};n(313),c=n(399).elementFactory,a=n(400),s=n(401),i=n(402),r=n(96).BaseClass,(v=n(42)).log,h=v.inspect,v.merge,g=v.peek,y=v.present,d=v.isFunction,p=v.inspectLean,l=v.compact,f=v.isObject,m=v.object,u=v.compactFlattenFast,S=v.w,o=n(325).Bitmap,t.exports=function(t){var e,n,v,x,P,C,_;function ElementBase(){return ElementBase.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)b.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElementBase,i(a(s(r)))),ElementBase.registerWithElementFactory=function(){return!1},ElementBase.postCreate=function(){return this.registerWithElementFactory()&&c.register(this),ElementBase.__super__.constructor.postCreate.apply(this,arguments)},ElementBase.prototype._initFields=function(){return ElementBase.__super__._initFields.apply(this,arguments),this.remoteId=null,this.creator=null,this.__depth=0,this.__redrawRequired=!1},ElementBase.concreteProperty({key:{default:null,validate:function(t){return null===t||d(t.toString)},preprocess:function(t){return null===t?t:t.toString()}}}),ElementBase.virtualProperty({name:{getter:function(t){return this.getState(t)._key},setter:function(t){return this.setKey(t)}}}),ElementBase.layoutProperty=function(t){var e,n,i;for(n in i=[],t)(e=t[n]).layoutProperty=!0,i.push(this._defineElementProperty(n,e));return i},ElementBase.drawProperty=function(t){var e,n,i;for(n in i=[],t)(e=t[n]).drawProperty=!0,i.push(this._defineElementProperty(n,e));return i},ElementBase.drawLayoutProperty=function(t){var e,n,i;for(n in i=[],t)(e=t[n]).layoutProperty=!0,e.drawAreaProperty=!0,e.drawProperty=!0,i.push(this._defineElementProperty(n,e));return i},ElementBase.drawAreaProperty=function(t){var e,n,i;for(n in i=[],t)(e=t[n]).drawAreaProperty=!0,e.drawProperty=!0,i.push(this._defineElementProperty(n,e));return i},ElementBase.prototype._layoutPropertyChanged=function(){return this._elementChanged(!0)},ElementBase.prototype._drawPropertyChanged=function(){return this._elementChanged(!1,!0,!1)},ElementBase.prototype._drawAreaPropertyChanged=function(){return this._elementChanged(!1,!0,!0)},ElementBase.concreteProperty({willConsumeKeyboardEvent:{default:function(t,e){return!1},validate:function(t){return f(t)||"beforeDescendents"===t||"beforeAncestors"===t||d(t)},preprocess:function(t){return d(t)?t:function(){return t}}}}),ElementBase._elementInstanceRegistry=e={},ElementBase.getter({isRegistered:function(){return!!e[this.getInstanceId()]}}),ElementBase.getElementByInstanceId=function(t){return e[t]},ElementBase.prototype._register=function(){var t,n,i,r;if(!e[n=this.getInstanceId()]){for(this._activateContinuousPersistantAnimators(),e[n]=this,t=0,i=(r=this._children).length;t<i;t++)r[t]._register();return this}},ElementBase.prototype._unregister=function(){var t,n,i,r;if(e[n=this.getInstanceId()]){for(this._deactivatePersistantAnimators(),delete e[n],t=0,i=(r=this._children).length;t<i;t++)r[t]._unregister();return this.queueEvent("unregistered"),null}},ElementBase.prototype._updateRegistryFromPendingState=function(){var t;return(t=this.getPendingParent())?t.getIsRegistered()?this._register():void 0:this._unregister()},ElementBase.getter({instanceId:function(){return this.remoteId||this.getUniqueId()},shortNamespacePath:function(){var t;return t=this.namespacePath,g(t.split("."))},inspectedPath:function(){var t;return u([null!=(t=this.parent)?t.inspectedPath:void 0,this.inspectedName]).join("/")},inspectedName:function(){return this.shortNamespacePath+":"+(this.pendingKey||this.instanceId)},inspectedNameWithoutIds:function(){var t;return this.shortNamespacePath+((t=this.pendingKey)?":"+t:"")},inspectedString:function(){return this.inspectedName}}),C=S(_="pages children name on parent"),P=S("key instanceId location size currentLocation currentSize"),x=S("key location size"),n=S(_+" currentLocation currentSize currentPadding elementToParentMatrix"),v=function(t){var e,n,i;return t.constructor===o?["Bitmap",t.size.exportedValue]:null!=(e=null!=(n=null!=(i=t&&t.initializer)?i:t.exportedValue)?n:t.plainObjects)?e:t},ElementBase.getter({inspectedPropsMaps:function(){var t,e,n,i,r,o,s,a,l,u;for(o={},e=0,r=P.length;e<r;e++)i=P[e],y(l=this[i])&&(o[i]=l);for(i in s=this.metaProperties)n=(a=s[i]).internalName,u=a.virtual,t=a.defaultValue,u||w.call(C,i)>=0||ElementBase.propsEq(t,l=this[n])||"parent"===i||(o[i]=v(l));return o},exportedProps:function(){var t,e;return t=m(this.metaProperties,{into:m(x,{when:(e=this,function(t,n){return y(e[n])}),with:function(t){return function(e,n){return v(t[n])}}(this)}),when:function(t){return function(e,i){var r,o,s;return o=e.internalName,s=e.virtual,r=e.defaultValue,!(s||w.call(n,i)>=0||ElementBase.propsEq(r,t[o]))}}(this),with:function(t){return function(e){var n;return n=e.internalName,v(t[n])}}(this)}),this.parent||t.size||(t.size=v(this.currentSize)),t},exportedStructure:function(){var t,e;return e=[this.class.getName(),this.exportedProps],this.hasChildren&&(e=e.concat(function(){var e,n,i,r;for(r=[],e=0,n=(i=this.children).length;e<n;e++)t=i[e],r.push(t.exportedStructure);return r}.call(this))),e},plainObjectProps:function(){var t,e,n,i;for(t in n=e=this.minimalProps)(null!=(i=n[t])?i.getPlainObjects:void 0)&&(e[t]=i.getPlainObjects());return e},propsInspectObjects:function(){var t,e,n,i,r;for(e in n=0,t=function(t,e){return i[t]=function(){var t;switch(null!=(t=e.class)&&"function"==typeof t.getName?t.getName():void 0){case"Bitmap":return e;default:return(null!=e?e.getInspectObjects:void 0)?e.getInspectObjects():{inspect:function(){return(null!=e?e.getPlainObjects:void 0)&&(e=e.getPlainObjects()),p(e)}}}}()},r=i=this.minimalProps)n++,t(e,r[e]);return 0===n?null:i},inspectedProps:function(){return p(this.getPlainObjectProps())},plainObjects:function(){var t;return[this.class.getName(),this.plainObjectProps].concat(function(){var e,n,i,r;for(r=[],e=0,n=(i=this._children).length;e<n;e++)t=i[e],r.push(t.plainObjects);return r}.call(this))},inspectObjects:function(){var t,e;return l([{inspect:(e=this,function(){return e.class.getName()})},this.propsInspectObjects].concat(function(){var e,n,i,r;for(r=[],e=0,n=(i=this._children).length;e<n;e++)t=i[e],r.push(t.inspectObjects);return r}.call(this)))},inspectTree:function(){var t;return[this.getInspectedName(),function(){var e,n,i,r;for(r=[],e=0,n=(i=this._children).length;e<n;e++)t=i[e],r.push(t.inspectTree);return r}.call(this)]},inspectedStructure:function(){return h(this.plainObjects)}}),ElementBase.prototype.inspect=function(){var t,e,n;return n=this.inspectedProps,t=this.class.getName()+" "+n,0<this._children.length&&(t+=(n.length>0?",":"")+" children: ["+function(){var t,n,i,r;for(r=[],t=0,n=(i=this._children).length;t<n;t++)e=i[t],r.push(e.class.getName());return r}.call(this).join(", ")+"]"),t},ElementBase}()},function(t,e,n){"use strict";var i,r,o,s,a={}.hasOwnProperty;i=(r=n(160)).BaseClass,s=r.timeout,o=r.inspect,t.exports=function(t){function ElementFactory(){ElementFactory.__super__.constructor.apply(this,arguments),this._elementClasses={}}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElementFactory,i),ElementFactory.singletonClass(),ElementFactory.newElement=function(t,e,n,i){return ElementFactory.singleton.newElement(t,e,n,i)},ElementFactory.classGetter({elementClasses:function(){return ElementFactory.singleton._elementClasses},elementClassNames:function(){return Object.keys(ElementFactory.elementClasses)}}),ElementFactory.prototype.register=function(t){var e,n;return e=t.name,this._elementClasses[e]?s(100,(n=this,function(){return console.warn("ElementFactory: element with class-name "+e+" already exists. ClassPaths: Existing: "+n._elementClasses[e].namespacePath+", Adding: "+t.namespacePath)})):this._elementClasses[e]=t},ElementFactory.prototype.classForElement=function(t){return this._elementClasses[t]},ElementFactory.prototype.newElement=function(t,e,n,i){var r;if(!this._elementClasses[t])throw new Error("ElementFactor: class not found for "+o(t)+" (props: "+o(e)+")");return(r=new this._elementClasses[t](e,n)).creator=i,r},ElementFactory}()},function(t,e,n){"use strict";var i,r,o,s,a,l,u={}.hasOwnProperty;o=n(160),r=n(116),n(373),i=r.EventedBaseMixin,l=o.log,a=o.isPlainObject,s={},t.exports=function(t){return function(e){var n,r;function EventedElementMixin(t){null==t&&(t=s),EventedElementMixin.__super__.constructor.apply(this,arguments),this._initDefaultEventHandlers(t)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EventedElementMixin,i(t)),EventedElementMixin.concreteProperty({on:{default:{},validate:function(t){return a(t)},setter:function(t){return this.preprocessEventHandlers(t)}}}),EventedElementMixin.prototype.preprocessEventHandlers=n=function(t){return t},r={},EventedElementMixin.prototype._initDefaultEventHandlers=function(t){if(!t.on&&this.preprocessEventHandlers!==n)return this.setOn(r)},EventedElementMixin.prototype._applyStateChanges=function(){return this.getParentChanged()&&this.queueEvent("parentChanged",{oldParent:this._parent,parent:this._pendingState._parent}),this.queueEvent("ready"),EventedElementMixin.__super__._applyStateChanges.apply(this,arguments)},EventedElementMixin.prototype._hasEventHandler=function(t){var e,n;return(e=this._pendingState._on||this._on)&&!!(e[t]||(null!=(n=e.preprocess)?n[t]:void 0))},EventedElementMixin.prototype._sendToEventHandler=function(t){var e,n,i,r,o,s,a;if(e=this._on){if(a=(o=t).type,r=null!=(s=e.preprocess)?s[a]:void 0)try{o=r(t)}catch(e){l({eventError1:n=e}),o=null,this._handleErrorInHandler(t,r,n)}if(null!=o&&(i=e[a]))try{return i(o)}catch(t){return l({eventError2:n=t}),this._handleErrorInHandler(o,i,n)}}},EventedElementMixin}()}},function(module,exports,__webpack_require__){"use strict";var StateEpoch,blankOptions,capitalize,compactFlattenAllFast,compactFlattenFast,globalEpochCycle,inspect,isFunction,isNumber,isPlainArray,isPlainObject,isString,log,merge,mergeInto,nextTick,object,plainObjectsDeepEq,point0,propInternalName,propsEq,ref,ref1,shallowEq,shallowPropsEq,stateEpoch,extend=function(t,e){for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};ref=__webpack_require__(381),log=ref.log,merge=ref.merge,mergeInto=ref.mergeInto,capitalize=ref.capitalize,compactFlattenFast=ref.compactFlattenFast,compactFlattenAllFast=ref.compactFlattenAllFast,isNumber=ref.isNumber,isFunction=ref.isFunction,shallowEq=ref.shallowEq,plainObjectsDeepEq=ref.plainObjectsDeepEq,isString=ref.isString,inspect=ref.inspect,isPlainObject=ref.isPlainObject,isPlainArray=ref.isPlainArray,nextTick=ref.nextTick,object=ref.object,ref1=ref.BaseClass,propInternalName=ref1.propInternalName,point0=ref.point0,propsEq=ref.propsEq,shallowPropsEq=ref.shallowPropsEq,stateEpoch=(StateEpoch=__webpack_require__(373)).stateEpoch,globalEpochCycle=__webpack_require__(362).globalEpochCycle,blankOptions={},module.exports=function(superClass){var EpochedElementMixin;return function(superClass1){var _setPropertiesTempVirtualPropSetterNames,_setPropertiesTempVirtualPropValues,minimalPropsIngore;function EpochedElementMixin(t){null==t&&(t=blankOptions),EpochedElementMixin.__super__.constructor.apply(this,arguments),this._initFields(),this._initProperties(t)}return extend(EpochedElementMixin,superClass1),EpochedElementMixin.extendableProperty({propertyInitializerList:[],metaProperties:{}}),EpochedElementMixin._defineElementProperty=function(t,e){var n,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v;return null==e&&(e={}),p=propInternalName(t),a=e.validate,o=e.preprocess,l=e.default,f={internalName:p,externalName:t,preprocessor:y=o&&a?function(e){if(null==e&&(e=l),!a(e))throw new Error("invalid value for "+t+": "+inspect(e));return o(e)}:a?function(e){if(null==e&&(e=l),!a(e))throw new Error("invalid value for "+t+": "+inspect(e));return e}:o||function(t){return null==t&&(t=l),t},getterName:this.getPropGetterName(t),setterName:this.getPropSetterName(t)},e.virtual?(f.virtual=!0,i=e.setter||function(){},n=e.getter,h=n,m=function(){return n.call(this,!0)},v=function(t){return i.call(this,y(t),t,y)}):(f.defaultValue=l=y(l),h=function(t){return t?this._pendingState[p]:this[p]},m=function(){return this._pendingState[p]},d=e.layoutProperty,c=e.drawProperty,u=e.drawAreaProperty,g=e.postSetter,v=e.setter,v=(s=v)?g?function(t){var e,n;return n=this._pendingState[p],e=this._pendingState[p]=s.call(this,y(t),n,t,y),this._elementChanged(d,c,u),g.call(this,e,n,t),e}:function(t){var e,n;return n=this._pendingState[p],y(t),e=this._pendingState[p]=s.call(this,y(t),n,t,y),this._elementChanged(d,c,u),e}:g?function(t){var e,n;return n=this._pendingState[p],e=this._pendingState[p]=y(t),this._elementChanged(d,c,u),g.call(this,e,n),e}:y.length>1?function(t){var e;return this._pendingState[p],e=this._pendingState[p]=y(t),this._elementChanged(d,c,u),e}:function(t){var e;return e=this._pendingState[p]=y(t),this._elementChanged(d,c,u),e},this.extendPropertyInitializerList().push([p,l,t])),this.extendMetaProperties(t,f),r=capitalize(t),this._addGetter(this.prototype,t,h),this._addGetter(this.prototype,"pending"+r,m),this._addGetter(this.prototype,t+"Changed",function(){return!shallowPropsEq(h.call(this),m.call(this))}),this._addSetter(this.prototype,t,v)},EpochedElementMixin.concreteProperty=function(t){var e,n,i;for(n in i=[],t)e=t[n],i.push(this._defineElementProperty(n,e));return i},EpochedElementMixin.virtualProperty=function(t){var e,n,i;for(n in i=[],t)e=t[n],isFunction(e)&&(e={getter:e}),e.virtual=!0,i.push(this._defineElementProperty(n,e));return i},_setPropertiesTempVirtualPropSetterNames=[],_setPropertiesTempVirtualPropValues=[],EpochedElementMixin.prototype.setProperties=function(t){var e,n,i,r,o,s,a,l,u;for(o in i=this.metaProperties,u=0,t)void 0!==(l=t[o])&&(r=i[o])&&(a=r.setterName)&&(r.virtual?(_setPropertiesTempVirtualPropSetterNames[u]=a,_setPropertiesTempVirtualPropValues[u++]=l):this[a](l));for(e=n=0,s=u;0<=s?n<s:n>s;e=0<=s?++n:--n)this[_setPropertiesTempVirtualPropSetterNames[e]](_setPropertiesTempVirtualPropValues[e]);return t},EpochedElementMixin.prototype.replaceProperties=function(t){var e,n,i,r,o;for(o in n=this.metaProperties)(i=n[o]).virtual||(e=i.externalName,"function"==typeof this[r=i.setterName]&&this[r](t.hasOwnProperty(e)?t[e]:i.defaultValue));return t},EpochedElementMixin.prototype.setProperty=function(t,e){var n,i;if(n=this.metaProperties[t])return"function"==typeof this[i=n.setterName]?this[i](e):void 0},EpochedElementMixin.prototype.preprocessProperty=function(t,e,n){var i;if(i=this.metaProperties[t])return i.preprocessor(e,n)},EpochedElementMixin.prototype.resetProperty=function(t){var e,n;if(e=this.metaProperties[t])return"function"==typeof this[n=e.setterName]?this[n](e.defaultValue):void 0},EpochedElementMixin.prototype.preprocessProperties=function(t){var e,n,i,r;for(i in e=this.metaProperties,t)r=t[i],(n=e[i])&&(t[i]=n.preprocessor(r,this[n.internalName]));return t},EpochedElementMixin.prototype.getPendingPropertyValues=function(t){var e,n,i,r,o;for(o={},e=0,n=t.length;e<n;e++)r=t[e],(i=this.metaProperties[r])&&(o[r]=this._pendingState[i.internalName]);return o},EpochedElementMixin.prototype.getPropertyValues=function(t){var e,n,i,r,o;for(o={},e=0,n=t.length;e<n;e++)r=t[e],(i=this.metaProperties[r])&&(o[r]=this[i.internalName]);return o},minimalPropsIngore=["children","parent"],EpochedElementMixin.getter({props:function(){var t,e,n;for(t in n={},e=this.metaProperties)e[t].virtual,n[t]=this[t];return n},concreteProps:function(){var t,e,n,i,r;for(e in r={},n=this.metaProperties)t=(i=n[e]).internalName,i.virtual||(r[e]=this[t]);return r},virtualProps:function(){var t,e,n;for(t in n={},e=this.metaProperties)e[t].virtual&&(n[t]=this[t]);return n},minimalProps:function(){var t,e,n,i,r,o,s,a,l;for(i in s={},point0.eq(this.currentLocation)||(s.currentLocation=this.currentLocation),r=this.metaProperties)e=(o=r[i]).externalName,n=o.internalName,l=o.virtual,t=o.defaultValue,l||indexOf.call(minimalPropsIngore,e)<0&&(propsEq(t,a=this[n])||(s[i]=a));return s},changingProps:function(){return object(this._pendingState,{when:(t=this,function(e,n){return t[n]!==e}),with:function(t){return function(e,n){return{old:t[n],new:e}}}(this)});var t}}),EpochedElementMixin.getConcreteProps=function(){var t,e,n;for(t in n=[],e=this.getMetaProperties())e[t].virtual||n.push(t);return n},EpochedElementMixin.prototype.preprocessForEpoch=function(){},EpochedElementMixin.prototype.onNextReady=function(t,e){return null==e&&(e=!0),stateEpoch.onNextReady(t,e,this)},EpochedElementMixin.onNextReady=function(t,e){return null==e&&(e=!0),stateEpoch.onNextReady(t,e)},EpochedElementMixin.prototype.onNextEpoch=function(t,e){return null==e&&(e=!0),globalEpochCycle.onNextReady(t,e,this)},EpochedElementMixin.onNextEpoch=function(t,e){return null==e&&(e=!0),globalEpochCycle.onNextReady(t,e)},EpochedElementMixin.prototype.onIdle=function(t){return stateEpoch.onNextReady(t)},EpochedElementMixin.prototype.getState=function(t){return null==t&&(t=!1),t?this._pendingState:this},EpochedElementMixin.prototype.getPendingState=function(){return this._pendingState},EpochedElementMixin.prototype._initFields=function(){return this._pendingState={},this.__stateEpochCount=0,this.__stateChangeQueued=!1,this.__layoutPropertiesChanged=!1,this.__drawAreaChanged=!0,this.__drawPropertiesChanged=!0},EpochedElementMixin._generateSetPropertyDefaults=function(){var defaultName,defaultOverride,externalName,functionString,i,k,metaProperties,preprocessor,propertyInitializerList,v,value;return propertyInitializerList=this.getPropertyInitializerList(),metaProperties=this.getMetaProperties(),functionString=compactFlattenAllFast("(function(options) {\nvar _pendingState = this._pendingState;\nvar metaProperties = this.metaProperties;",function(){var t,e,n,r;for(r=[],i=t=0,e=propertyInitializerList.length;t<e;i=++t)n=propertyInitializerList[i],k=n[0],v=n[1],externalName=n[2],value=void 0!==(defaultOverride=this.prototype[defaultName="default"+capitalize(externalName)])?((preprocessor=metaProperties[externalName].preprocessor)&&(this.prototype[defaultName]=preprocessor(defaultOverride)),"this."+defaultName):null===v||!1===v||!0===v||void 0===v||isNumber(v)?v:"metaProperties."+externalName+".defaultValue;",r.push("this."+k+" = _pendingState."+k+" = "+value+";");return r}.call(this),"})").join("\n"),eval(functionString)},EpochedElementMixin.prototype._initProperties=function(t){return this.metaProperties,this.__proto__.hasOwnProperty("_initPropertiesAuto")||(this.__proto__._initPropertiesAuto=this.class._generateSetPropertyDefaults()),this._initPropertiesAuto(t),this.setProperties(t),this._elementChanged(!0,!0,!0),null},EpochedElementMixin.prototype._getChangingStateKeys=function(){var t,e,n;for(t in n=[],e=this._pendingState)e[t],shallowPropsEq(this[t],this._pendingState[t])||n.push(t);return n},EpochedElementMixin.prototype._logPendingStateChanges=function(){var t,e,n,i,r;for(t in n={},e={},i=this._pendingState)r=i[t],t.match(/^__/)||plainObjectsDeepEq(r,this[t])||(n[t]=this[t],e[t]=r);return log({"ElementBase pending state changes":{element:this.inspectedName,old:n,new:e}})},EpochedElementMixin.prototype._getIsChangingElement=function(){return stateEpoch._isChangingElement(this)},EpochedElementMixin.prototype._elementChanged=function(t,e,n){if(this._pendingState,t&&(StateEpoch._stateEpochLayoutInProgress&&console.error("__layoutPropertiesChanged while _stateEpochLayoutInProgress"),this.__layoutPropertiesChanged=!0),e&&(this.__drawPropertiesChanged=!0),n&&(this.__drawAreaChanged=!0),!this.__stateChangeQueued)return this.__stateChangeQueued=!0,stateEpoch._addChangingElement(this)},EpochedElementMixin.prototype._applyStateChanges=function(){return this.__stateChangeQueued=!1,this.__stateEpochCount++,mergeInto(this,this._pendingState)},EpochedElementMixin}(superClass)}},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b={}.hasOwnProperty;y=n(381),p=y.log,l=y.isFunction,u=y.isNumber,h=y.isString,c=y.isPlainArray,d=y.merge,g=y.propsEq,f=y.nextTick,S=n(373).stateEpoch,v=n(403),o=v.PersistantAnimator,i=v.EasingPersistantAnimator,r=v.PeriodicPersistantAnimator,m=null,s=function(t,e){var n,s;return m||(m={}),(s=t.match(/^_(.*)/))?(n=t,s[0],t=s[1]):n="_"+t,m[n]=e instanceof o?e:l(e)?new o(t,{animate:e}):u(null!=e?e.period:void 0)?new r(t,d(e,{continuous:!0})):(null!=e?e.animate:void 0)?new o(t,e):new i(t,e)},a=function(t){var e,n,i,r,o,l,u,p,d,f,m;if(t){if(h(t)){for(d=[],n=0,r=(p=t.match(/[a-z]+/gi)).length;n<r;n++)u=p[n],d.push(s(u));return d}if(c(t)){for(f=[],i=0,o=t.length;i<o;i++)e=t[i],f.push(a(e));return f}for(u in m=[],t)(l=t[u])&&m.push(s(u,l));return m}},t.exports=function(t){return function(e){var n;function AnimatedElementMixin(t){AnimatedElementMixin.__super__.constructor.apply(this,arguments),this.internalAnimators&&this.setAnimators(null!=t?t.animators:void 0)}return function(t,e){for(var n in e)b.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(AnimatedElementMixin,t),AnimatedElementMixin.concreteProperty({animateOnCreation:{default:!1,validate:function(t){return!t||!0===t}},animators:{default:null,setter:function(t){var e;return m=null,(e=this.internalAnimators)&&a(e),a(t),m}}}),AnimatedElementMixin.getter({internalAnimators:function(){}}),AnimatedElementMixin.prototype._deactivatePersistantAnimators=function(){var t,e,n,i;for(e in i=[],n=this.animators)t=n[e],i.push(t.deactivate());return i},AnimatedElementMixin.prototype._activateContinuousPersistantAnimators=function(){return f((t=this,function(){return t._elementChanged()}));var t},AnimatedElementMixin.prototype.getPendingCreatedAndAddedToExistingParent=function(){var t,e,n;return(e=this._pendingState)._parent,t=e._animateOnCreation,0===this.__stateEpochCount&&(t||!(0===(null!=(n=this._pendingState._parent)?n.__stateEpochCount:void 0)))},n=0,AnimatedElementMixin.prototype.preprocessForEpoch=function(){var t,e,i,r,o,s,a,l,u,c,h;if(u=this._pendingState._animators)for(h in e=this.getPendingCreatedAndAddedToExistingParent(),a=S.frameSecond,S.epochCount,u){t=(i=u[h]).active;try{c=this._pendingState[h],r=0===this.__stateEpochCount?c:this[h],o=e&&i.hasFromVoidAnimation?(this._animatingFromVoid=!0,i.getPreprocessedFromVoid(this,r)):r,l=t||!g(o,c)?i.animateAbsoluteTime(this,o,c,a):c,this._pendingState[h]=l}catch(t){s=t,this._pendingState[h]=c,n++<10&&p.error({ArtEngine:{AnimatedElementMixin:{errorApplyingProp:{element:this.inspectedName,prop:h,currentValue:this[h],pendingValue:this._pendingState[h],animator:i,error:s}}}})}}return null},AnimatedElementMixin}()}},function(t,e,n){(t.exports=n(346)).addModules({Animator:n(391),EasingFunctions:n(392),EasingPersistantAnimator:n(404),PeriodicPersistantAnimator:n(406),PersistantAnimator:n(405)})},function(t,e,n){var i,r,o,s,a,l,u,c,h,p={}.hasOwnProperty;o=n(160),r=n(116),i=n(392),s=n(405),o.log,o.BaseClass,o.isFunction,u=o.isString,l=o.isNumber,h=o.min,c=o.max,r.EventedObject,a=s.interpolate,t.exports=function(t){function EasingPersistantAnimator(t,e){var n,i;null==e&&(e={}),EasingPersistantAnimator.__super__.constructor.apply(this,arguments),this.setEasingFunction(e.f||e.easingFunction),n=e.d,this.duration=null!=(i=e.duration)?i:n,this.delay=e.delay}return function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EasingPersistantAnimator,s),EasingPersistantAnimator.getter("duration easingFunction delay"),EasingPersistantAnimator.getter({animationPos:function(){var t,e;return e=this.getAnimationSeconds(),this,this.duration,e<=(t=this.delay)?0:h(1,(e-=t)/this._duration)}}),EasingPersistantAnimator.setter({duration:function(t){return this._duration=l(t)?c(.001,t):.25},delay:function(t){return this._delay=l(t)?c(0,t):0},easingFunction:function(t){return this._easingFunction=t,u(t)&&((this._easingFunction=i[t])||console.warn("invalid easing easingFunction: "+t)),this._easingFunction||(this._easingFunction=i.easeInQuad)}}),EasingPersistantAnimator.prototype.animate=function(){var t,e,n,i;return this,n=this.startValue,i=this.toValue,t=this.animationPos,e=this.easingFunction,1===t&&this.stop(),a(n,i,e(t))},EasingPersistantAnimator}()},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty;o=n(116),d=n(42),p=d.log,u=d.isFunction,d.isString,d.capitalize,d.inspectedObjectLiteral,d.plainObjectsDeepEq,h=d.isPlainObject,a=d.eq,f=d.rubyOr,c=d.isNumber,d.rubyTrue,s=d.Promise,l=d.isArray,i=n(96).BaseClass,r=o.EventedMixin,t.exports=function(t){var e;function PersistantAnimator(t,e){var n,i;null==e&&(e={}),PersistantAnimator.__super__.constructor.apply(this,arguments),this._prop=t,this._options=e,this._active=!1,this._startSecond=0,this._currentSecond=0,this._lastSecond=0,this._activatedAtSecond=0,this._startValue=null,this._currentValue=null,this._toValue=null,this._element=null,this._animate=e.animate,this._continuous=e.continuous,this._voidValue=f(e.voidValue,e.toFromVoid,e.fromToVoid,e.void,e.toFrom,e.fromTo),this._toVoid=null!=(n=e.toVoid)?n:e.to,this._fromVoid=null!=(i=e.fromVoid)?i:e.from,(null!=e?e.on:void 0)&&this.on(e.on)}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PersistantAnimator,r(i)),PersistantAnimator.interpolate=e=function(t,n,i,r){var o,s,a,p;return null==r&&(r=!0),0===i?t:1===i?n:null==t||null==n?t||n:u(t.interpolate)?t.interpolate(n,i):t.constructor!==n.constructor?n:c(t)?t+(n-t)*i:a=function(){var r,u,c;if(h(t)){for(s in a={},t)p=t[s],a[s]=e(p,n[s],i,!1);return a}if(l(t)&&t.length===n.length){for(c=[],o=r=0,u=t.length;r<u;o=++r)p=t[o],c.push(e(p,n[o],i,!1));return c}return n||t}()},PersistantAnimator.getter("options prop element startValue currentValue toValue continuous voidValue currentSecond startSecond"),PersistantAnimator.getter({active:function(){return this._active||this._continuous&&(!this._element||this._element.isRegistered)},state:function(){return this._state||(this._state={})}}),PersistantAnimator.prototype.deactivate=function(){if(this._active)return this._deactivate()},PersistantAnimator.getter({inspectedObjects:function(){var t;return(t={})[""+this.prop]=this.options,t}}),PersistantAnimator.getter({fromVoid:function(){return null!=this._voidValue?this._voidValue:this._fromVoid},toVoid:function(){return null!=this._voidValue?this._voidValue:this._toVoid},hasFromVoidAnimation:function(){return null!=this.fromVoid},hasToVoidAnimation:function(){return null!=this.toVoid}}),PersistantAnimator.getter({animationSeconds:function(){return this._currentSecond-this._startSecond},frameSeconds:function(){return this._active?this._currentSecond-this._lastSecond:0},stop:function(){return null!=this._boundStop?this._boundStop:this._boundStop=(t=this,function(){return t._stop()});var t}}),PersistantAnimator.prototype._stop=function(){return this._active=!1,this._toValue},PersistantAnimator.prototype.startToVoidAnimation=function(t){return this._element=t,this.hasToVoidAnimation?new s((e=this,function(t,n){return e._active&&e._toValueChanged(),e._element[e._prop]=e._toValue=e.toVoid,e.on({done:t})})):s.reject();var e},PersistantAnimator.prototype.getPreprocessedFromVoid=function(t,e){return this._element=t,this._element.preprocessProperty(this._prop,this.fromVoid,e)},PersistantAnimator.prototype.animate=function(){return this._animate?this._animate(this):(p("no @_animate"),this.stop())},PersistantAnimator.prototype._activate=function(){if(this._active)throw new Error;return this._lastSecond=this._startSecond=this._activatedAtSecond=this._currentSecond,this._startValue=this._currentValue,this.queueEvent("start",{target:this._element,animator:this}),this._active=!0},PersistantAnimator.prototype._toValueChanged=function(){return this._lastSecond=this._startSecond=this._currentSecond-this.frameSeconds,this._startValue=this._currentValue},PersistantAnimator.prototype._deactivate=function(){return this.queueEvent("done",{target:this._element,animator:this}),this._active=!1},PersistantAnimator.prototype.animateAbsoluteTime=function(t,e,n,i){var r,o,s;return this._element=t,this._currentValue=e,this._currentSecond=i,this._active?a(n,this._toValue)?this._activatedAtSecond===this._startSecond&&(this._startSecond=this._currentSecond):this._toValueChanged():this._activate(),this._toValue=n,r=this.getAnimationSeconds(),o=this.animate(),this._active?(r>0&&this.queueEvent("update",{target:this._element,animator:this}),this._element.onNextEpoch((s=this,function(){return s._element[s._prop]=s._toValue}))):this._deactivate(),this._lastSecond=this._currentSecond,this._element.preprocessProperty(this._prop,o)},PersistantAnimator}()},function(t,e,n){var i,r,o,s={}.hasOwnProperty;r=n(160),i=n(116),n(392),o=n(405),r.log,r.BaseClass,r.isFunction,r.isString,r.isNumber,r.min,r.max,i.EventedObject,o.interpolate,t.exports=function(t){function PeriodicPersistantAnimator(t,e){null==e&&(e={}),PeriodicPersistantAnimator.__super__.constructor.apply(this,arguments),this.period=e.period}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PeriodicPersistantAnimator,o),PeriodicPersistantAnimator.getter({animationPos:function(){return this.getAnimationSeconds()%this._period/this._period}}),PeriodicPersistantAnimator.property("period"),PeriodicPersistantAnimator}()},function(t,e,n){(t.exports=n(348)).addModules({DrawAreaCollector:n(408),DrawCacheManager:n(380),DrawEpoch:n(379),ElementDrawAreaMixin:n(409),ElementDrawLib:n(410),ElementDrawMixin:n(411)})},function(t,e,n){"use strict";(function(t){var e,i,r,o,s,a,l,u,c,h={}.hasOwnProperty;u=n(42),r=u.clone,s=u.defineModule,u.log,u.min,a=u.max,e=n(96).BaseClass,c=n(313),l=c.rect,i=c.Rectangle,o=n(325).compositeModeMap,s(t,function(){var t,n;return n=function(t,e){var n,i,r,o,s,u,c,h,p,d,f,m;return(h=e.shadow)?(c=t.left,f=t.right,m=t.top,i=t.bottom,n=h.blur,p=h.offsetX,d=h.offsetY,null==p&&(p=0),null==d&&(d=0),null==n&&(n=0),o=a(0,(n*=1.25)-p-1),u=a(0,n-d-1),s=a(0,n+p+1),r=a(0,n+d+1),l(c-o,m-u,f-c+o+s,i-m+u+r)):t},t=function(t,e,n){var i,r,o,s,u,c,h;return s=n.obtuse,r=null!=(u=e.lineWidth)?u:defaultLineWidth,i=null!=(c=e.lineJoin)?c:"miter",o=null!=(h=e.miterLimit)?h:defaultMiterLimit,s||"miter"!==i||(r=a(r,o*r)),l(t).grow(.5*r)},function(s){function DrawAreaCollector(t){this.padding=t,this.reset()}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(DrawAreaCollector,e),DrawAreaCollector.singletonClass(),DrawAreaCollector.prototype.reset=function(){return this.targetDrawArea=null,this.clippingArea=null},DrawAreaCollector.getter({drawArea:function(){return this.targetDrawArea||new i},inspectedObjects:function(){return{DrawAreaCollector:r(this.targetDrawArea)}}}),DrawAreaCollector.prototype.clipDrawArea=function(t){return this.clippingArea?(t,t.toString(),t.intersection(this.clippingArea)):t},DrawAreaCollector.prototype.openClipping=function(t,e,n,i){var r;return r=this.clippingArea,this.clippingArea=e.transformBoundingRect(n),null!=r&&r},DrawAreaCollector.prototype.closeClipping=function(t){return this.clippingArea=t},DrawAreaCollector.prototype.fillShape=function(t,e,i,r,o){return this.compositeDrawAreas(e.compositeMode,t.transformBoundingRect(n(r,e)))},DrawAreaCollector.prototype.strokeShape=function(e,i,r,o,s){return this.compositeDrawAreas(i.compositeMode,e.transformBoundingRect(t(n(o,i),i,r)))},DrawAreaCollector.prototype.drawDrawable=function(t,e){return this.compositeDrawAreas(t.compositeMode,e.transformBoundingRect(t.elementSpaceDrawArea))},DrawAreaCollector.prototype.compositeDrawAreas=function(t,e){var n,i,r;return this.targetDrawArea&&this.clippingArea&&!this.clippingArea.contains(this.targetDrawArea)&&(n=!0),e=this.clipDrawArea(e),i=function(){switch(o[t]){case"destination-in":case"source-in":return r=!0,e.intersection(this.targetDrawArea,this.targetDrawArea);case"destination-atop":case"source-out":return r=!0,e;case"destination-out":case"source-atop":return this.targetDrawArea;default:return e.unionInto(this.targetDrawArea)}}.call(this),this.targetDrawArea=r&&n?i.unionInto(this.targetDrawArea):i},DrawAreaCollector}()})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){var e,i,r,o,s,a,l,u,c,h,p,d={}.hasOwnProperty;(c=n(42)).objectWithout,s=c.defineModule,c.formattedInspect,c.clone,l=c.max,c.isFunction,c.log,c.object,c.isNumber,c.isArray,c.isPlainObject,c.isString,c.each,c.isPlainObject,c.merge,c.mergeInto,(h=n(313)).Matrix,a=h.identityMatrix,h.Color,h.point,u=h.rect,h.rgbColor,h.isRect,h.isColor,h.perimeter,r=h.Rectangle,(p=n(325)).GradientFillStyle,(i=p.Paths).rectanglePath,i.ellipsePath,i.circlePath,n(96).BaseClass,e=n(408),o=n(410).addDirtyDrawArea,s(t,function(){return function(t){return function(n){var i;function ElementDrawAreaMixin(){return ElementDrawAreaMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)d.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElementDrawAreaMixin,t),ElementDrawAreaMixin.setter({dirtyDrawAreasChanged:function(t){var e;return t?this._dirtyDrawAreasChangedWasTrue=t:this._dirtyDrawAreasChangedWasTrue&&this.onNextReady((e=this,function(){return e._dirtyDrawAreasChangedWasTrue=!1})),this._dirtyDrawAreasChanged=t}}),ElementDrawAreaMixin.virtualProperty({preFilteredBaseDrawArea:function(t){var e,n,i,r,o,s,a;return e=(r=this.getState(t))._currentPadding,s=(n=r._currentSize).x,a=n.y,o=e.w,i=e.h,u(0,0,l(0,s-o),l(0,a-i))},baseDrawArea:function(t){return this.getPreFilteredBaseDrawArea(t)}}),i=new r,ElementDrawAreaMixin.prototype.clipElementSpaceArea=function(t,e){var n,o,s,a;return this.clip?this.padding?this.getPaddedArea(i).intersection(t,e):this.currentSize.intersection(t,e):t!==e?(s=t.x,a=t.y,o=t.w,n=t.h,e?e._setAll(s,a,o,n):new r(s,a,o,n)):t},ElementDrawAreaMixin.prototype.getSizeAffectsDrawArea=function(t){var e,n,i,r;return i=(r=this.getState(t))._draw,e=r._children,n=r._clip,i||e.length>0&&n},ElementDrawAreaMixin.getter({parentSpaceDrawArea:function(){return this._elementToParentMatrix.transformBoundingRect(this.getElementSpaceDrawArea())},elementSpaceDrawArea:function(){return this._elementSpaceDrawArea||(this._elementSpaceDrawArea=this._computeElementSpaceDrawArea())},drawArea:function(){return this.elementSpaceDrawArea},drawAreaIn:function(t){return null==t&&(t=this.getElementToAbsMatrix()),t.transformBoundingRect(this.getElementSpaceDrawArea())},drawAreaInParent:function(t,e){return this.elementToParentMatrix.transformBoundingRect(null!=t?t:this.elementSpaceDrawArea,!1,e)},clippedDrawAreaInParent:function(t,e){var n,i;return n=this.getDrawAreaInParent(t,e),null!=(i=this.parent)&&i.clipElementSpaceArea(n,n),n},clippedDrawAreaInAncestor:function(t,e){var n,i,r;for(r=this,n=e;(i=r.parent)&&(n=r.getClippedDrawAreaInParent(n,n),i!==t);)r=i;return null!=n?n:this.drawArea},logicalAreaInAncestor:function(t){return this.getElementToElementMatrix(t).transformBoundingRect(this.logicalArea)}}),ElementDrawAreaMixin.prototype._drawAreaChanged=function(){var t;if(this._elementSpaceDrawArea&&(this._elementSpaceDrawArea=null,t=this.getPendingParent()))return t._childsDrawAreaChanged()},ElementDrawAreaMixin.prototype._childsDrawAreaChanged=function(){return this._drawAreaChanged()},ElementDrawAreaMixin.prototype._computeElementSpaceDrawArea=function(t){var n;return n=new e(this.currentPadding),this.clip&&n.openClipping(null,a,this.paddedArea),this._drawChildren(n,a,!1,t),n.drawArea},ElementDrawAreaMixin.prototype._addDescendantsDirtyDrawArea=function(t){return!t||this._redrawAll?(this._dirtyDrawAreas=null,this._redrawAll=!0):t!==this?this._addDirtyDrawArea(t.getClippedDrawAreaInAncestor(this),!0):void 0},ElementDrawAreaMixin.prototype._addDirtyDrawArea=function(t,e){return null==t&&(t=this.drawArea),this.getDevicePixelsPerPoint(),1,e&&this.setDirtyDrawAreasChanged(!0),this._dirtyDrawAreas=o(this._dirtyDrawAreas,t,1)},ElementDrawAreaMixin.prototype._clipInPlace=function(t){return this.clip?this.currentSize.intersection(t,t):t},ElementDrawAreaMixin}()}})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Paths","pointLayout","isString","isColor","isArray","GradientFillStyle","isRect","point","Color","isNumber","isPlainObject","rgbColor","normalizeShadow","merge","objectWithout","perimeter","compactFlattenFast","compactFlattenAllFast","log","formattedInspect","Error","push"],[e,n(381)],(t,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C)=>{let _,E,T,k,I,M,A;return({rectanglePath:_,ellipsePath:E,circlePath:T}=t),({getDevicePixelRatio:k}=n(160).Browser.Dom),I=3,M=1,A=r({y:2}),i.defClass(class ElementDrawLib extends Object{},function(t,n,_){let E,T,k,I,M,A,F,B;this.colorPrecision=E=1/256,this.legalDrawCommands=T={circle:!0,rectangle:!0,clip:!0,children:!0,reset:!0,resetShape:!0,resetDrawArea:!0,logicalDrawArea:!0,paddedDrawArea:!0,padded:!0,resetClip:!0,debug:!0},this.looksLikeColor=k=function(t){return null!=t?o(t)?!T[t]:s(t)||a(t)||null!=t[0]&&null!=t[1]||t.constructor===l:void 0},I={},M={},this.prepareShadow=A=function(t,e){let n,i,r;return t?(({blur:n,color:i,offset:r}=t),M.blur=n,M.color=i,M.offsetX=r.layoutX(e),M.offsetY=r.layoutY(e),M):void 0},this.layoutToFrom=F=function(t,e){let n,i,r;return u(e)?(({size:n,x:i,y:r}=e),i+=t.layoutX(n),r+=t.layoutY(n),c(i,r)):t.layout(e)},this.prepareDrawOptions=function(t,e,n){let r,o,s,a,u,c,h,p,d,f,m,g,y,v,S,b,w;return r=I,o=t.color,s=t.colors,a=t.compositeMode,u=t.opacity,c=t.shadow,h=t.radius,p=t.radial,d=t.fillRule,f=t.to,m=t.from,n&&(g=void 0!==(b=t.lineWidth)?b:1,y=void 0!==(w=t.miterLimit)?w:3,v=t.lineJoin,S=t.lineCap,r.lineWidth=g,r.miterLimit=y,r.lineJoin=v,r.lineCap=S),r.radial=!!p,r.color=o,r.colors=s,r.compositeMode=a,r.opacity=u,r.shadow=A(c),r.from=s&&(null!=m?F(m,e):e.topLeft),r.to=s&&(null!=f?F(f,e):e.bottomLeft),r.radius=h,r.fillRule=d,(i.exists(s)&&s.constructor)===l&&(s.to=r.to,s.from=r.from),r},this.normalizeDrawProps=B=function(t){let e,n,i,o,s,u,c,y;return null!=t?(k(t)&&(t={color:t}),e=t.shadow,n=t.color,i=t.colors,o=t.to,s=t.from,null!=n&&n.constructor!==h&&(n.constructor===l?i=n:((a(n)&&!p(n[0])||d(n)&&null==(null!=(u=null!=(c=null!=(y=n.r)?y:n.g)?c:n.b)?u:n.a))&&(i=n),i&&(i=l.normalizeColors(i))),n=null!=i?void 0:f(n)),null!=i&&(s=s&&r(null!=s?s:"topLeft"),o=o&&r(null!=o?o:"bottomLeft")),e&&(e=m(e)),e||n!==t.color||i!==t.colors||o!==t.to||s!==t.from?((t=g(t)).shadow=e,t.color=n,t.colors=i,t.to=o,t.from=s,t):t):void 0},this.normalizeDrawStep=function(t){let e,n,r,o,s,a,l,c,h,p,f,m,S,b,w,x,P,C;return(()=>{switch(!1){case!k(t):return{fill:B({color:t})};case!!d(t):return t;default:return e=t.fill,n=t.shadow,r=t.outline,o=t.radius,s=t.color,a=t.colors,l=t.padding,c=t.rectangle,h=t.circle,p=t.shape,f=t.to,m=t.from,(null!=(b=null!=(w=null!=(x=null!=s?s:a)?x:f)?w:m)?b:n)&&(e=g(B({color:s,colors:a,shadow:n,to:f,from:m})),t=y(t,"color","colors","to","from","shadow")),null!=o&&(c=u(c)?{radius:o,area:c}:d(c)?((S=g(c)).radius=o,S):{radius:o}),null!=l||(l=null!=(P=null!=(C=i.exists(h)&&h.padding)?C:i.exists(c)&&c.padding)?P:i.exists(p)&&p.padding),l=null!=l&&!1!==l&&v(l),e=B(e),r=B(r),l!==t.padding||e!==t.fill||r!==t.outline||c!==t.rectangle?g(t,{fill:e,outline:r,padding:l,rectangle:c}):t}})()},this.validateDrawAreas=function(t,n,r){let o;return o=S([n,r]),i.each2(b(n,r),o=>{let s,a,l,u,c;return a=null,null!=(s=t)&&(l=s.length,u=0,(()=>{for(;u<l;){let t;if((t=s[u]).contains(o)){a=t;break}c=u++}})()),a?void 0:(w(x({validateDrawAreasFail:e.validateDrawAreasFail={newDrawAreas:t,oldDrawAreas:n,addedDrawArea:r}})),(()=>{throw new P(`expected one of ${i.toString(x(t))} to contain ${i.toString(o)}`)})())}),i.each2(t,e=>{let o;return o=0,i.each2(t,t=>o++,t=>e.overlaps(t)),1!==o?(w(x({newDrawAreas:t,oldDrawAreas:n,addedDrawArea:r})),(()=>{throw new P(`expected newDrawAreas to be mutually exclusive: ${i.toString(x(t))}`)})()):void 0}),null},this.chromeBugExpandDirtyDrawAreas=1,this.disableChromeBugExpandDrawAreaPatch=(()=>this.chromeBugExpandDirtyDrawAreas=0),this.addDirtyDrawArea=((t,e,n)=>{let i,r,o,s,a,l,u,c,h,p;return 0===e.area?t:(e=(i=e).roundOut(n,1/256,this.chromeBugExpandDirtyDrawAreas),r=!1,u=null,null!=(l=t)&&(c=l.length,h=0,(()=>{for(;h<c;){let t;if(t=l[h],u=!!t.contains(e)||(r||(r=t.overlaps(e)),!1))break;p=h++}})()),u?t:r?(o=i!==e?e:e.clone(),s=-1,a=t.length,(()=>{for(;a!==s;){let e,n,i;for(s=a,a=0,i=(n=0)<(e=s)?1:-1;i>0&&n<e||i<0&&n>e;){let e,r;e=n,o.overlaps(r=t[e])?r.unionInto(o):(a!==e&&(t[a]=r),a++),n+=i}}})(),t[a++]=o,t.length===a?t:t.slice(0,a)):C(t,e))}),this.partitionAreasByInteresection=function(t,e){let n,r;return n=r=null,i.each2(e,e=>e.overlaps(t)?((null!=n?n:n=[]).push(e.intersection(t)),i.each2(e.cutout(t),t=>(null!=r?r:r=[]).push(t))):(null!=r?r:r=[]).push(e)),{insideAreas:n,outsideAreas:r}}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A={}.hasOwnProperty;T=n(42),a=T.compactFlattenFast,T.objectWithout,u=T.defineModule,p=T.formattedInspect,T.clone,T.max,m=T.isFunction,S=T.log,T.object,T.isNumber,d=T.isArray,g=T.isPlainObject,v=T.isString,T.each,g=T.isPlainObject,x=T.merge,T.mergeInto,h=T.float32Eq,T.neq,k=n(313),i=k.Matrix,k.identityMatrix,k.Color,k.point,k.rect,k.rgbColor,y=k.isRect,f=k.isColor,k.perimeter,I=n(325),e=I.GradientFillStyle,r=I.Paths,E=r.rectanglePath,r.ellipsePath,o=r.circlePath,n(96).BaseClass,l=n(412).config,c=n(380).drawCacheManager,b=n(363).logFrameEvent,M=n(410),P=M.normalizeDrawStep,_=M.prepareDrawOptions,w=M.looksLikeColor,M.legalDrawCommands,C=M.partitionAreasByInteresection,s=M.colorPrecision,u(t,function(){return function(t){return function(n){var r;function ElementDrawMixin(){return ElementDrawMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)A.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElementDrawMixin,t),{},{},ElementDrawMixin.drawProperty({stage:{default:null,validate:function(t){return null===t||!1===t||!0===t},description:"true:   always stage\nfalse:  never stage\nnull:   stage as needed"},cacheThrough:{default:!1,validate:function(t){return!1===t||!0===t}},cacheDraw:{default:!1,validate:function(t){return!1===t||!0===t||g(t)}}}),ElementDrawMixin.drawLayoutProperty({draw:{default:null,validate:function(t){return null==t||y(t)||m(t)||d(t)||g(t)||v(t)||f(t)||t.constructor===e},preprocess:function(t){var e,n,i,r,o,s,l,u,c,h,p,f,m,g,y,v,S,b,x,C,_,E,T;if(null!=t){for(d(t)||(t=[t]),h=!1,s=0,u=(t=a(t)).length;s<u;s++)if(r=(E=t[s]).fill,p=E.outline,m=E.radius,e=E.color,n=E.colors,f=E.padding,T=E.to,o=E.from,null!=(null!=(y=null!=(v=null!=(S=null!=(b=null!=(x=null!=(C=null!=(g=null!=m?m:r)?g:p)?C:e)?x:n)?b:f)?S:T)?v:o)?y:w(E))){h=!0;break}if(h){for(_=[],l=0,c=t.length;l<c;l++)i=t[l],_.push(P(i));return _}return t}return null}}}),ElementDrawMixin.virtualProperty({drawOrder:{getter:function(t){return this.getState(t)._draw},setter:function(t){return this.setDraw(t)}}}),ElementDrawMixin.prototype.drawOnBitmap=function(t,e){var n,i,r;try{if(this.opacity<s)return;if(this._currentDrawTarget=t,this._currentToTargetMatrix=e,!((r=this.getDrawAreaIn(e).intersection(t.getClippingArea())).area>0))return;if(n=this.getCacheDrawRequested(e),this.getNeedsStagingBitmap(e)||n&&!this._cacheThrough&&!this._dirtyDrawAreasChanged&&!this._dirtyDrawAreasChangedWasTrue?this._drawWithCaching(r,t,e):(n||this._clearDrawCache(),(n||this._cacheThrough)&&t.shouldPixelSnap(e)&&(e=t.pixelSnapMatrix(e)),this._clip?this._drawWithClipping(r,t,e):this._drawChildren(t,e)),this._dirtyDrawAreasChanged)return this._dirtyDrawAreasChangedWasTrue=!0,this.setDirtyDrawAreasChanged(!1)}catch(t){return i=t,S({ArtEngine:{drawOnBitmap:{inspectedPath:this.inspectedPath,error:i}}})}finally{this._currentDrawTarget=this._currentToTargetMatrix=null}},ElementDrawMixin.prototype._debugDrawSteps=function(t,e,n){var r,s,a,l,u,c,h,p,d,f,b,w,P,C,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q,H,V,$,G,Y,K,X;u=this.children,I=this.getDraw(),b=E,w=void 0,C=this._currentPadding.needsTranslation?i.translateXY(-this._currentPadding.left,-this._currentPadding.top).mul(e):e,f=this._currentSize,M=!1,N=null,S({debugDrawStart:{target:(null!=t&&"function"==typeof t.clone?t.clone():void 0)||t}});try{for(F=null,R=0,U=I.length;R<U;R++)null!=(l=(k=I[R]).child)&&((F||(F={}))[l]=!0);if(F)for(c={},O=0,W=u.length;O<W;O++)s=u[O],null!=(D=s._key)&&(c[D]=s);for(L=0,j=I.length;L<j;L++)k=I[L],m(k)?S({drawFunction:{elementToParentMatrix:elementToParentMatrix,currentDrawArea:f,currentPath:b,f:present(q=k.name)?q:k.toString()}}):y(k)?(w=void 0,S({drawSet:{currentPath:b=E,currentDrawArea:f=k}})):v(z=k)?S(((V={})["draw "+z]=function(){var t,e;switch(z){case"debug":return!0;case"reset":return b=E,f=this.currentSize,w=void 0,null!=N&&(N=void 0),{currentPath:b,currentDrawArea:f,clipping:!1};case"resetClip":return null!=N?(N=void 0,{clip:!1}):{clip:"wasn't clipping"};case"resetDrawArea":case"logicalDrawArea":return{currentDrawArea:f=this.currentSize};case"padded":case"paddedDrawArea":return f=this.currentPadding.pad(this.currentSize),{inputs:{currentPadding:currentPadding,currentSize:currentSize},output:{currentDrawArea:f}};case"resetShape":return w=void 0,{currentPath:b=E};case"circle":return w=void 0,{currentPath:b=o};case"rectangle":return w=void 0,{currentPath:b=E};case"clip":return N&&S({drawAutoResetClipping:!0}),N=!0,{currentPath:b,drawMatrix:C,currentDrawArea:f,currentPathOptions:w};case"children":for(h=[],t=0,e=u.length;t<e;t++)s=u[t],null!=(D=s._key)&&null!=F&&F[D]||s.visible&&h.push(s.inspectedName);return M=!0,{childrenDrawn:h};default:return console.warn("Art.Engine.Element: invalid draw instruction: "+z)}}.call(this),V)):g(k)&&(G=k.padding,B=k.fill,d=k.clip,$=k.outline,X=k.shape,Y=k.rectangle,s=k.child,p=k.circle,T=[],(H=null!=(K=null!=Y?Y:p)?K:X)&&(w=g(H)?(r=H.area,P=H.path,H):void(X?P=X:r=H),f=m(r)?r(this._currentSize,w,this):y(r)?r:f,b=function(){switch(!1){case!p:return o;case!Y:return E;case!X:return P}}(),T.push({shape:{in:x({rectangle:Y,circle:p,shape:X}),out:x({currentDrawArea:f,currentPath:b,currentPathOptions:w})}})),G&&(f=G.pad(this.currentSize),T.push({padding:{inputs:{padding:G,currentPath:this.currentPath},output:{currentDrawArea:f}}})),null!=d&&T.push({clip:d?(null!=N&&S({drawAutoResetClipping:!0}),N=!0,{currentPath:b,drawMatrix:C,currentDrawArea:f,currentPathOptions:w}):null!=N?(N=void 0,!1):"wasn't clipping"}),null!=B&&T.push({fill:x(B,{fillShape:x({drawMatrix:C,options:x(_(B,f)),currentPath:b,currentDrawArea:f,currentPathOptions:w})})}),null!=$&&T.push({outline:x($,{strokeShape:x({drawMatrix:C,options:x(_(B,f)),currentPath:b,currentDrawArea:f,currentPathOptions:w})})}),null!=s&&T.push((a=c[s])?{child:s,childElement:a.inspectedName}:{child:s,childElement:"not found (ignored)"}),S({drawOptionActions:T}))}catch(t){A=t,S.error({ArtEngine:{drawChildren:{inspectedPath:this.inspectedPath,error:A}}})}return M||S(F?{drawRemainingChildren:function(){var t,e,n;for(n=[],t=0,e=u.length;t<e;t++)s=u[t],null!=(D=s._key)&&null!=F&&F[D]?n.push(s.inspectedName):n.push(s.inspectedName+" already drawn");return n}()}:{drawAllChildren:function(){var t,e,n;for(n=[],t=0,e=u.length;t<e;t++)s=u[t],n.push(s.inspectedName);return n}()}),S(null!=N?{drawDoneClippingReset:!0}:{drawDone:!0})},ElementDrawMixin.prototype._drawChildren=function(t,e,n,r){var s,a,l,u,c,h,p,d,f,b,w,x,P,C,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q,H,V,$,G,Y,K,X,J,Q,Z;if(c=this.children,k=this.getDraw()){P=!1,b=E,w=null,C=this._currentPadding.needsTranslation?i.translateXY(-this._currentPadding.left,-this._currentPadding.top).mul(e):e,f=this._currentSize,I=!1,N=null;try{for(A=null,B=0,U=k.length;B<U;B++)null!=(u=(T=k[B]).child)&&((A||(A={}))[u]=!0);if(A)for(h={},z=0,W=c.length;z<W;z++)null!=(L=(a=c[z])._key)&&(h[L]=a);for(O=0,j=k.length;O<j;O++)if(T=k[O],m(T))T(t,e,this,f,b);else if(y(T))b=E,f=T,w=null;else if(v(R=T)){switch(R){case"debug":P=!0,this._debugDrawSteps(t,e,n,r);break;case"reset":b=E,f=this.currentSize,w=null,null!=N&&(t.closeClipping(N),N=null);break;case"resetClip":null!=N&&(t.closeClipping(N),N=null);break;case"resetDrawArea":case"logicalDrawArea":f=this.currentSize;break;case"padded":case"paddedDrawArea":f=this.currentPadding.pad(this.currentSize);break;case"resetShape":b=E,w=null;break;case"circle":b=o,w=null;break;case"rectangle":b=E,w=null;break;case"clip":N&&t.closeClipping(N),N=t.openClipping(b,C,f,w);break;case"children":for(D=0,q=c.length;D<q;D++)if(null==(L=(a=c[D])._key)||null==A||!A[L]){if(r===a){r="done";break}a.visible&&t.drawDrawable(a,a.getElementToTargetMatrix(e))}I=!0;break;default:console.warn("Art.Engine.Element: invalid draw instruction: "+R)}if("done"===r)break}else if(g(T)&&(X=T.padding,F=T.fill,d=T.clip,K=T.outline,Z=T.shape,J=T.rectangle,a=T.child,p=T.circle,(Y=null!=(Q=null!=J?J:p)?Q:Z)&&(w=g(Y)?(s=Y.area,x=Y.path,Y):(Z?x=Z:s=Y,null),f=m(s)?s(this._currentSize,w,this):y(s)?s:f,b=function(){switch(!1){case!p:return o;case!J:return E;case!Z:return x}}()),X&&(f=X.pad(this.currentSize)),null!=d&&(d?(null!=N&&t.closeClipping(N),N=t.openClipping(b,C,f,w)):null!=N&&(t.closeClipping(N),N=null)),null!=F&&t.fillShape(C,_(F,f),b,f,w),null!=K&&t.strokeShape(C,_(K,f,!0),b,f,w),null!=a&&(l=h[a]))){if(r===a)break;t.drawDrawable(l,l.getElementToTargetMatrix(e))}}catch(t){M=t,S.error({ArtEngine:{drawChildren:{inspectedPath:this.inspectedPath,error:M}}})}if(!I)for($=0,H=c.length;$<H;$++)if(null==(L=(a=c[$])._key)||null==A||!A[L]){if(r===a)break;a.visible&&t.drawDrawable(a,a.getElementToTargetMatrix(e))}null!=N&&t.closeClipping(N),P&&S({debugDrawEnd:{target:(null!=t&&"function"==typeof t.clone?t.clone():void 0)||t}})}else for(G=0,V=c.length;G<V&&(a=c[G])!==r;G++)a.visible&&t.drawDrawable(a,a.getElementToTargetMatrix(e));return c},ElementDrawMixin.prototype._drawWithClipping=function(t,e,n){var i;return i=e.openClipping(t),this._drawChildren(e,n),e.closeClipping(i)},ElementDrawMixin.prototype._resetDrawCache=function(){return this._dirtyDrawAreasChangedWasTrue=!1,this._dirtyDrawAreasChanged=!1,this._redrawAll=!1,this._drawCacheBitmap=this._drawCacheToElementMatrix=this._dirtyDrawAreas=null,this._elementToDrawCacheMatrix=null},ElementDrawMixin.prototype._drawPropertiesChanged=function(){return this._clearDrawCache()},ElementDrawMixin.prototype._needsRedrawing=function(t){var e;if(null==t&&(t=this),this._drawCacheBitmap&&this._addDescendantsDirtyDrawArea(t),(this.getVisible()||this.getPendingVisible())&&(this.getPendingOpacity()>s||this.getOpacity()>s))return null!=(e=this.getParent())?e._needsRedrawing(t):void 0},ElementDrawMixin.prototype.__clearDrawCacheCallbackFromDrawCacheManager=function(){return this._resetDrawCache()},ElementDrawMixin.prototype._clearDrawCache=function(){if(this._drawCacheBitmap)return c.doneWithCacheBitmap(this),!0},ElementDrawMixin.prototype._releaseAllCacheBitmaps=function(){var t,e,n,i;for(t=this._clearDrawCache()?1:0,e=0,n=(i=this._children).length;e<n;e++)t+=i[e]._releaseAllCacheBitmaps();return t},ElementDrawMixin._activeCacheDrawDepth=0,ElementDrawMixin.prototype.getCacheDrawRequested=function(t){return l.drawCacheEnabled&&0===this.class._activeCacheDrawDepth&&this.getCacheable()&&this.getCacheDraw()},ElementDrawMixin.getter({drawOrderRequiresStaging:function(){var t,e,n,i,r,o,s;if(!(e=this.draw))return!1;for(i=0,r=e.length;i<r;i++){if(n=(s=e[i]).fill,o=s.outline,n&&null!=(t=n.compositeMode)&&"normal"!==t)return!0;if(o&&null!=(t=o.compositeMode)&&"normal"!==t)return!0}}}),ElementDrawMixin.prototype.getNeedsStagingBitmap=function(t){var e,n;return null!=(n=this.stage)?n:(e=this.draw,!!(this.getIsMask()||(this.getHasChildren()||null!=e)&&!this.getCompositingIsBasic()||this._clip&&(null!=t?t.getHasSkew():void 0)||this.getChildRequiresParentStagingBitmap()||this.drawOrderRequiresStaging))},ElementDrawMixin.prototype.getWhyStagingIsNeeded=function(t){switch(!1){case!this.stage:return"stage property is true";case!this.getIsMask():return"is mask";case!((this.getHasChildren()||null!=this.draw)&&!this.getCompositingIsBasic()):return"compositing requires staging: "+this.compositeMode+", opacity: "+this.opacity;case!(this._clip&&(null!=t?t.getHasSkew():void 0)):return"clipping and non-rectangular area due to matrix: "+t;case!this.getChildRequiresParentStagingBitmap():return"child needs parent staging";case!this.drawOrderRequiresStaging:return"draw property requries staging: "+p(this.draw)}},ElementDrawMixin.getter({compositingIsBasic:function(){return"normal"===this._compositeMode&&h(this._opacity,1)},cacheIsValid:function(){return!!this._drawCacheBitmap},cacheable:function(){return!0}}),r={opacity:1,compositeMode:null},ElementDrawMixin.prototype._drawWithCaching=function(t,e,n){if(this._updateDrawCache(t,n),!!this._drawCacheBitmap!=!!this._drawCacheToElementMatrix)throw new Error("expected both or neither: @_drawCacheToElementMatrix, @_drawCacheBitmap");if(this._drawCacheBitmap)return r.opacity=this.opacity,r.compositeMode=this.compositeMode,e.drawBitmap(this._drawCacheToElementMatrix.mul(n),this._drawCacheBitmap,r)},ElementDrawMixin.prototype._updateDrawCache=function(t,e){var n,r,o,a,u,h,p,d,f,m,g,y,v,w,x,P,_,E,T,k,I,M;if(M=1/(P=null!=(_=null!=(E=this._cacheDraw)?E.pixelsPerPoint:void 0)?_:this.getDevicePixelsPerPoint()),!((f=this.getElementSpaceDrawArea().roundOut(M,s)).getArea()<=0)){for(w=r=this.getCacheDraw()||this.getStage()?P:e.getExactScaler(),x=o=f.mul(r);o.area>=16777216;)o=f.mul(r*=.75);if(x!==o&&S.warn("ArtEngine.Element "+this.inspectedName+"._updateDrawCache\n  maxCanvasSize:            16777216\n  cacheSpaceDrawArea.area:  "+x.area+"\n  cacheSpaceDrawArea:       "+x+"\n  cacheScale changed from "+w+" to "+r),o=o.roundOut(M,s),n=!1,(u=i.translateXY(-f.x,-f.y).scale(r).inv).eq(this._drawCacheToElementMatrix)&&c.canUseBitmap(this._drawCacheBitmap,o)){if(c.useDrawCache(this),this._drawCacheBitmap.clearOutsideArea(o.size),!this._dirtyDrawAreas&&!this._redrawAll)return}else this._clearDrawCache(),this._drawCacheBitmap=c.allocateCacheBitmap(this,o.size),n=!0,this._dirtyDrawAreas=null,this._redrawAll=!0;if(this._drawCacheToElementMatrix=u,this._elementToDrawCacheMatrix=this._drawCacheToElementMatrix.inv,!e)throw new Error("why no elementToTargetMatrix?");a=e.inv.transformBoundingRect(t).roundOut(M,s).intersection(f),k=null,h=this._dirtyDrawAreas,a.contains(f)||(h=(T=C(a,h||[f])).insideAreas,k=T.outsideAreas),this.class.stats.stagingBitmapsCreated++,this.class.stats.lastStagingBitmapSize=this._drawCacheBitmap.size,this._currentDrawTarget=this._drawCacheBitmap,this._currentToTargetMatrix=this._elementToDrawCacheMatrix;try{if(this.class._activeCacheDrawDepth++,!l.partialRedrawEnabled||0!==this._filterChildren.length||!h&&!k)return b("fullDrawCache",this.uniqueId),this._updateCurrentDrawCacheClippedArea(n);if(h){for(I=[],g=0,v=h.length;g<v;g++)p=h[g],d=this._elementToDrawCacheMatrix.transformBoundingRect(p,!0),y=this._drawCacheBitmap.openClipping(d),this._updateCurrentDrawCacheClippedArea(n,!0),I.push(this._drawCacheBitmap.closeClipping(y));return I}}catch(t){return m=t,S({ArtEngine:{_updateDrawCache:{inspectedPath:this.inspectedPath,error:m}}})}finally{this._redrawAll=!1,this._dirtyDrawAreas=(null!=k?k.length:void 0)>0?k:null,this.class._activeCacheDrawDepth--}}},ElementDrawMixin.prototype._updateCurrentDrawCacheClippedArea=function(t,e){var n,i;return t||this._drawCacheBitmap.clear(),!this._clip||e&&!(n=this.getHasCustomClipping())?this._drawChildren(this._drawCacheBitmap,this._elementToDrawCacheMatrix,!0):(n||(i=this.getDrawAreaIn(this._elementToDrawCacheMatrix).intersection(this._drawCacheBitmap.size)),this._drawWithClipping(i,this._drawCacheBitmap,this._elementToDrawCacheMatrix))},ElementDrawMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;(r=n(160)).w,r.Validator,i=r.defineModule,r.mergeInto,r.BaseClass,e=r.Configurable,i(t,function(t){function Config(){return Config.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Config,e),Config.defaults({drawCacheEnabled:!0,partialRedrawEnabled:!0,showPartialDrawAreas:!1}),Config}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s;o=n(42).object,i=n(393).PointLayout,s=i.pointLayout,t.exports={namedSizeLayoutsRaw:r={parentSize:{ps:1},childrenSize:{cs:1},parentHeightSquare:{hh:1,wh:1},parentWidthSquare:{hw:1,ww:1},parentFitSquare:{hh:1,wh:1,max:{hw:1,ww:1}},childrenSizeMaxParentWidth:{cs:1,max:{ww:1}},childrenSizeMaxParentHeight:{cs:1,max:{hh:1}},parentHeightChildrenWidth:{hh:1,wcw:1},childrenWidthParentHeight:{hh:1,wcw:1},parentWidthChildrenHeight:{ww:1,hch:1},childrenHeightParentWidth:{ww:1,hch:1},parentWidthChildrenHeightMaxParentHeight:{ww:1,hch:1,max:{hh:1}},childrenHeightParentWidthMaxParentHeight:{ww:1,hch:1,max:{hh:1}},parentHeightChildrenWidthMaxParentWidth:{wcw:1,hh:1,max:{ww:1}}},namedSizeLayouts:o(r,function(t){return s(t)})}},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["rgbColor","PointLayoutBase","PointLayout"],[e,n(382),n(393)],(t,e,r)=>{let o;return o=n(415).shadow,i.defClass(class NormalizeProps extends Object{},function(n,i,s){this.normalizeShadow=function(n){let i,s,a;return(()=>{switch(!1){case!(!0===n):return o;case!(null!=n):return({color:i,offset:s,blur:a}=n),{blur:null!=a?a:o.blur,color:t(null!=i?i:o.color),offset:null!=s?s instanceof e?s:new r(s):o.offset}}})()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointLayout","rgbColor"],[e,n(382),n(393)],(t,e)=>({shadow:{blur:4,offset:new t({y:2}),color:e("#0007")}})))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c={}.hasOwnProperty;n(313),n(417),i=n(388),e=n(325).Paths,(u=n(42)).pureMerge,o=u.float32Eq0,u.log,u.AtomElement,r=u.defineModule,a=u.isPlainObject,s=u.isNumber,l=e.rectanglePath,r(t,function(t){var e;function RectangleElement(){return RectangleElement.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(RectangleElement,i),RectangleElement.drawProperty({radius:{default:0,validate:function(t){return!t||s(t)||a(t)},preprocess:function(t){return t||0}}}),RectangleElement.prototype.fillShape=function(t,e,n){return n.radius=this._radius,n.color||(n.color=this._color),t.drawRectangle(e,this.getPaddedArea(),n)},RectangleElement.prototype.strokeShape=function(t,e,n){return n.radius=this._radius,n.color||(n.color=this._color),t.strokeRectangle(e,this.getPaddedArea(),n)},e={radius:0},RectangleElement.prototype._drawWithClipping=function(t,n,i){var r;return o(this._radius)?RectangleElement.__super__._drawWithClipping.apply(this,arguments):(e.radius=this._radius,r=n.openClipping(l,i,this.paddedArea,e),this._drawChildren(n,i),n.closeClipping(r))},RectangleElement.getter({hasCustomClipping:function(){return this._radius>0}}),RectangleElement}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(418)},function(t,e,n){(t.exports=n(419)).addModules({Layout:n(421),Metrics:n(422),TextLayoutFragment:n(423)})},function(t,e,n){t.exports=n(18).addNamespace("Art.Text",class Text extends Neptune.PackageNamespace{}._configureNamespace(n(420)))},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC\\"","dependencies":{"art-build-configurator":"*","art-canvas":"git://github.com/imikimi/art-canvas.git"},"description":"Art.Text","license":"ISC","name":"art-text","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"1.2.6"}')},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A={}.hasOwnProperty;n(160),o=n(325).Bitmap,i=n(313),l=n(422),f=i.isMatrix,C=i.rect,i.matrix,a=i.Matrix,u=i.Rectangle,x=i.point,Math.floor,Math.ceil,(_=n(42)).log,d=_.inspect,P=_.pureMerge,_.flatten,S=_.nearInfinity,b=_.nearInfinityResult,w=_.peek,v=_.min,g=_.max,y=_.merge,_.time,m=_.isNumber,h=_.float32Eq,p=_.float32Eq0,I=_.toInspectedObjects,r=n(96).BaseObject,T=n(212).simpleBrowserInfo,k=l.toFontCss,c={},t.exports=s=function(t){var e,n,i;function Layout(t,i,r,o,s){if(null==o&&(o=S),null==s&&(s=S),!m(o)||!m(s))throw new Error("layoutAreaWidth, layoutAreaHeight must be numbers: "+d(s));this._layoutAreaWidth=o,this._layoutAreaHeight=s,this._fontOptions=l.normalizeFontOptions(i||{}),this._layoutOptions=r=P(e,r),this._text=t||n,this._textLines=t.split("\n"),r.wordWrapWidth&&console.error("Art.Text.Layout#wordWrapWidth is depricated. Pass layoutAreaWidth and layoutAreaHeight into constructor."),this._maxHeight=r.maxHeight,this._overflow=r.overflow,this._clipped="clipped"===this._overflow,this._ellipsis="ellipsis"===this._overflow,this._align=x(r.align),this._leading=r.leading,this._paragraphLeading=r.paragraphLeading,this._maxLines=r.maxLines,this._layoutMode=r.layoutMode,this._resetLayout(),this._left=this._right=this._top=this._bottom=0}return function(t,e){for(var n in e)A.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Layout,r),Layout.defaultText=n="",Layout.defaultLayoutOptions=e={leading:1.25,paragraphLeading:null,align:x("left"),layoutMode:"textualBaseline",overflow:"ellipsis",maxLines:void 0},i=function(t){var e,n,i,r;for(r={},e=0,n=(i=t.split(/\s+/)).length;e<n;e++)r[i[e]]=!0;return r},Layout.validLayoutOptions={layoutMode:i("textual textualBaseline tight tight0"),overflow:i("ellipsis visible clipped")},Layout.getter("text align leading"),Layout.getter({fontStyle:function(){return this._fontOptions.fontStyle},fontVariant:function(){return this._fontOptions.fontVariant},fontWeight:function(){return this._fontOptions.fontWeight},fontFamily:function(){return this._fontOptions.fontFamily},fontSize:function(){return this._fontOptions.fontSize},leading:function(){return this._leading},paragraphLeading:function(){return this._paragraphLeading},align:function(){return this._align},layoutMode:function(){return this._layoutMode},fragments:function(){return this._updateLayout(),this._fragments},size:function(){return this._updateLayout(),this._size||(this._size=x(this._right-this._left,this._bottom-this._top))},area:function(){return this._updateLayout(),this._area||(this._area=C(this._left,this._top,this._right-this._left,this._bottom-this._top))},drawArea:function(){return this._updateLayout(),this._drawArea||(this._drawArea=this._computeDrawArea())},fontCss:function(){return this._fontCss||(this._fontCss=k(this._fontOptions))},lineCount:function(){return this._updateLayout(),this._fragments.length},inspectedObjects:function(){return{ArtTextLayout:I({area:this.area,drawArea:this.drawArea,fragments:this.fragments})}}}),Layout.prototype._getFragmentLogicalAreas=function(t){var e,n,i,r,o;for(o=[],e=0,i=(r=this.fragments).length;e<i;e++)n=r[e].layoutArea,o.push(n);return o},Layout.prototype.draw=function(t,e,n){var i,r,o;return null==n&&(n=c),(i=t.context2D)?(this._updateLayout(),n.stroke&&M&&f(e)&&(o=g(e.sx,e.sy),n.lineWidth=(null!=(r=n.lineWidth)?r:1)*o),t._setupDraw(e,n)?(i.font=this.getFontCss(),i.textAlign="left",i.textBaseline="alphabetic",n.stroke?this._strokeAllFragments(i):this._fillAllFragments(i),t._cleanupDraw(n)):void 0):this.drawToNonArtBitmap(t,e,n)},Layout.prototype.stroke=function(t,e,n){return null==n&&(n=c),this.draw(t,e,y(n,{stroke:!0}))},Layout.prototype.drawToNonArtBitmap=function(t,e,n){var i,r;return null==n&&(n=c),r=e.exactScale,i=new o(this.getSize().mul(r)),this.draw(i,a.scale(r),n),t.drawBitmap(a.scale(r.inv).mul(e),i)},Layout.prototype.newBitmap=function(t){var e,n;return null==t&&(t=c),n=t.size||this.getSize(),this._align.x>0&&this._layoutAreaWidth<b&&(n=n.withX(this._layoutAreaWidth)),this._align.y>0&&this._layoutAreaHeight<b&&(n=n.withY(this._layoutAreaHeight)),(e=t.scale)&&(n=n.mul(e)),new o(n.ceil())},Layout.prototype.toBitmap=function(t){var e,n,i,r;return null==t&&(t=c),i=t.drawMatrix||new a,"drawArea"===t.area&&(n=this.drawArea,t=y(t,{size:n.size}),i=i.translateXY(-n.x,-n.y)),(r=t.scale)&&(i=i.mul(a.scale(r))),e=this.newBitmap(t),t.background&&e.drawRectangle(i,C(this.size),{color:t.background}),this.draw(e,i,t),e},Layout.prototype._fillAllFragments=function(t){var e,n,i,r,o;for(o=[],n=0,i=(r=this.fragments).length;n<i;n++)e=r[n],o.push(t.fillText(e.text,e.getTextX(),e.getTextY()));return o},Layout.prototype._strokeAllFragments=function(t){var e,n,i,r,o;for(o=[],n=0,i=(r=this.fragments).length;n<i;n++)e=r[n],o.push(t.strokeText(e.text,e.getTextX(),e.getTextY()));return o},Layout.prototype._drawFragmentAreas=function(t){var e,n,i,r,o;for(this.getFontSize(),o=[],e=0,i=(r=this.fragments).length;e<i;e++)n=r[e].layoutArea,o.push(t.fillRect(n.x,n.y,n.w,n.h));return o},Layout.prototype._computeDrawArea=function(){var t,e,n,i,r,o,s,a,l;if(1===(n=this.fragments).length)return n[0].alignedDrawArea;for(o=l=a=t=0,i=r=0,s=n.length;r<s;i=++r)e=n[i],0===i?(o=e.getAlignedDrawAreaLeft(),l=e.getAlignedDrawAreaTop(),a=e.getAlignedDrawAreaRight(),t=e.getAlignedDrawAreaBottom()):(o=v(o,e.getAlignedDrawAreaLeft()),l=v(l,e.getAlignedDrawAreaTop()),a=g(a,e.getAlignedDrawAreaRight()),t=g(t,e.getAlignedDrawAreaBottom()));return new u(o,l,a-o,t-l)},Layout.prototype._alignFragments=function(){var t,e,n,i,r,o,s,a,l,u,c,h;if(this,n=this._layoutAreaWidth,e=this._layoutAreaHeight,t=this._align,i=this.area,c=t.x,h=t.y,n>=b&&(c=0),e>=b&&(h=0),a=(e-i.h)*h,!p(a)||!p(c)){for(u=[],o=0,s=(l=this.fragments).length;o<s;o++)(r=l[o]).alignmentOffsetX=(n-r.layoutW)*c,u.push(r.alignmentOffsetY=a);return u}},Layout.prototype._setArea=function(t){return this._top=t.getTop(),this._left=t.getLeft(),this._bottom=t.getBottom(),this._right=t.getRight()},Layout.prototype._expandArea=function(t){return this._top=v(this._top,t.getTop()),this._left=v(this._left,t.getLeft()),this._bottom=g(this._bottom,t.getBottom()),this._right=g(this._right,t.getRight())},Layout.prototype._generateFragments=function(){var t,e,n,i,r,o,s,a,u;return this,this._fontOptions,e=this._layoutAreaWidth,n=this._layoutMode,i=this._textLines,t=this._fontOptions,r=this.getFontCss(),this._fragments=function(){var c,h,p,d,f,m,g;if(e<b&&("textual"===n||"textualBaseline"===n)){for(s=[],c=0,d=i.length;c<d;c++)for(a=i[c],h=0,f=(u=l.wrap(a,t,e,r,n)).length;h<f;h++)o=u[h],s.push(o);return s}for(g=[],p=0,m=i.length;p<m;p++)a=i[p],g.push(l.get(a,t,n,r));return g}()},Layout.prototype._layoutFragments=function(){var t,e,n,i,r,o,s,a,u,c,h,p,d,f,m,g,y,v;for(this,i=this._layoutAreaWidth,n=this._layoutAreaHeight,r=this._maxLines,t=this._clipped,e=this._ellipsis,0,f=0,s=Math.floor(this.getFontSize()*this.getLeading()),a=(null!=(m=this.getParagraphLeading())?m:this.getLeading())*this.getFontSize()-s,o=this._fragments,r&&r<this._fragments.length&&(this._fragments=this._fragments.slice(0,r)),c=h=0,p=(g=this._fragments).length;h<p;c=++h){if(u=g[c],c>0&&u.firstFragment&&(f+=a),u.move(0,f),0===c)this._setArea(u);else{if(t){if(u.getTop()-this._top>n){this._fragments=this._fragments.slice(0,c);break}}else if(e&&u.getBottom()-this._top>n){this._fragments=this._fragments.slice(0,c);break}this._expandArea(u)}f+=s}if(e&&this._fragments.length<o.length){for("."===(y=w(this._fragments).text)[y.length-1]&&(y=y.slice(0,y.length-1)),v=y+"";y.length>0&&(d=l.get(v,this._fontOptions,this._layoutMode,this.getFontCss())).layoutW>i;)v=(y=y.slice(0,y.length-1))+"";if(d)return d.setLayoutLocationFrom(w(this._fragments)),this._fragments[this._fragments.length-1]=d,this._expandArea(d)}},Layout.prototype._resetLayout=function(){return this._fragments=this._area=this._size=this._drawArea=null},Layout.prototype._updateLayout=function(){if(!this._fragments)return this._resetLayout(),this._generateFragments(),this._layoutFragments(),this._alignFragments()},Layout.setter({width:function(t){return this._updateLayout(),h(t,this._layoutAreaWidth)||(this._layoutAreaWidth=t,this._area=null,this._size=null,this._drawArea=null,this._alignFragments()),null}}),Layout}(),M=!1,E=function(){var t,e,n,i;return e=(i=(n=(t=new s("-",{fontFamily:"Times New Roman",fontSize:32},{layoutMode:"tight"}).toBitmap({stroke:!0,lineWidth:5,scale:5})).size).x)*(n.y/2|0)+(i/2|0),0===t.getImageDataArray("alpha")[e]},"safari"===T.browser&&(M=E())},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y={}.hasOwnProperty;Math.floor,Math.ceil,s=(m=n(42)).defineModule,c=m.merge,u=m.log,m.logL,l=m.inspect,m.max,m.min,m.isObject,m.isString,m.allIndexes,a=m.eachMatch,m.clone,d=m.present,e=n(96).BaseClass,i=n(325).Bitmap,g=n(313),h=g.point,f=g.rect,p=g.point0,r=g.Rectangle,o=n(423),s(t,function(){return 3,4,127,function(t){var n,s,m,g,v;function Metrics(){return Metrics.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)y.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Metrics,e),Metrics.defaultFontSizeProportionalDrawAreaPadding=.45,Metrics.tightDrawAreaPadding=1,Metrics.defaultFontOptions=n={fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontSize:16,fontFamily:"Times"},Metrics.toFontCss=v=function(t){return(t.fontStyle||"normal")+" "+(t.fontVariant||"normal")+" "+(t.fontWeight||"normal")+" "+(t.fontSize||16)+"px "+(t.fontFamily||"Times")+", Times"},Metrics.normalizeFontOptions=m=function(t){return t.fontStyle||(t.fontStyle=n.fontStyle),t.fontVariant||(t.fontVariant=n.fontVariant),t.fontWeight||(t.fontWeight=n.fontWeight),t.fontSize||(t.fontSize=n.fontSize),t.fontFamily||(t.fontFamily=n.fontFamily),t},Metrics.get=function(t,e,n,i){switch(null==e&&(e={}),e.fontSize||(e=m(e)),n){case null:case void 0:case"textual":return this._getTextualFontMetrics(t,e,null,i);case"textualBaseline":return this._getTextualFontMetrics(t,e,null,i,!1);case"tight":case"tight0":return this._getTightFontMetrics(t,0,e,i);default:throw new Error("invalid layoutMode: "+l(n))}},Metrics.getWidth=function(t,e,n){var i;return(i=Metrics.getScratchCanvasBitmap().context).font=n||v(e),i.measureText(t).width},Metrics._wrapOnce=function(t,e,n){if(t.measureText(e).width<=n)return[e,null]},Metrics._noBreaksWrapIndex=s=function(t,e,n){var i,r,o,s,a,l,u;for(i=0,r=0,o=null,a=e.length;a-i>1;)s=(i+a)/2|0,(u=t.measureText(l=e.slice(0,s)).width)>n?a=s:(o=l,r=u,i=s);return o||(o=e.slice(0,1),r=t.measureText(o).width),[r,o]},"",Metrics.wrap=function(t,e,n,i,r){var o,l,u,c,h,p,d,f,m,g;return null==r&&(r="textual"),o="textual"===r,""===t?[this._getTextualFontMetrics("",e,0,i,o)]:(n<0&&(n=0),(l=this.getScratchCanvasBitmap().context).font=i,c=0,h=[],u="",f="",m=0,g=this,p=function(){if(c>0)return h.push(g._getTextualFontMetrics(u,e,c,i,o)),u="",c=0,f="",m=0},a(t,/(\s*[^-\s]+-*|\s*-+)(\s*)/g,function(t){var e,i,r,o,a,h,d;if(t.index,t[0],h=t[1],o=t[2],h.length,o.length,a=l.measureText(o).width,(d=l.measureText(h).width)>n){for(;d>n;)p(),i=(r=s(l,h,n))[0],e=r[1],u=e,c=i,h=h.slice(e.length,h.length),d=l.measureText(h).width;p(),u=h,c=d}else m+c+d>n?(p(),u=h,c=d):(u+=f+h,c+=m+d);return f=o,m=a}),p(),null!=(d=h[0])&&(d.firstFragment=!0),h)},Metrics._tightFontMetricCache={},Metrics._getTightFontMetrics=function(t,e,n,i){var r,s,a;return d(t)?(s=t+":"+e+":"+(i||(i=v(n))),((r=this._tightFontMetricCache)[s]||(r[s]=t.length<=3?(a=2,n=c(n,{fontSize:n.fontSize*a}),i=v(n),this._generateTightFontMetrics(t,e,n,i).mul(1/a)):this._generateTightFontMetrics(t,e,n,i))).clone()):new o(t,n)},g=new r,32,Metrics._generateTightFontMetrics=function(t,e,n,i){var r,s,a,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I;for(k=Metrics.tightDrawAreaPadding,g=2*Metrics.defaultFontSizeProportionalDrawAreaPadding,P=1,(h=n.fontSize)<32&&(P=h/32,h=32),w=1!==P?c(n,{fontSize:h}):n,C=(y=this.renderTextToScratchBitmap(t,w,g))[0],_=y[1],m=y[2],C.context.getImageData(0,0,_.x,_.y).data,f=(v=C.preciseContentArea).left,x=v.right,I=v.top,s=v.bottom;f<1||I<1||x>_.x-1||s>_.y-1;)u("Art.Text.Metrics#_generateTightFontMetrics: "+l(n,1)+", padding: "+g+" too small. scratchBitmap.size: "+C.size),g*=2,C=(S=this.renderTextToScratchBitmap(t,w,g))[0],_=S[1],m=S[2],f=(b=C.preciseContentArea).left,x=b.right,I=b.top,s=b.bottom;return 1!==P&&(m=m.mul(P),f*=P,x*=P,I*=P,s*=P),E=m.x-f,T=m.y-I,d=x-f,p=s-I,r=m.y-I+1,a=s-m.y,new o(t,n,r,a,E,T,d,p,-k,-k,d+2*k,p+2*k)},Metrics._getTextualFontMetrics=function(t,e,n,i,r){var s,a,l,u,c;return null==r&&(r=!0),a=.75*(u=e.fontSize-0),l=.25*u,c=null!=n?n:this.getWidth(t,e,i),s=f(0,l-u,c,u-(r?0:l)),this.pessimisticDrawArea(c,e,g),new o(t,e,a,l,-s.x,-s.y,s.w,s.h,g.x,g.y,g.w,g.h)},Metrics.classGetter({scratchCanvasBitmap:function(){return this._scratchCanvasBitmap||(this._scratchCanvasBitmap=new i(h(10,10)))}}),Metrics.pessimisticDrawArea=function(t,e,n,i){var r,o,s,a,l,u,c,h;return l=(s=e.fontSize)*(i||e.padding||Metrics.defaultFontSizeProportionalDrawAreaPadding),c=Math.floor(r=-l),h=Math.floor(o=-l),u=Math.ceil(r+t+2*l)-c,a=Math.ceil(o+s+2*l)-h,n?(n.x=c,n.y=h,n.w=u,n.h=a,n):f(c,h,u,a)},Metrics._scratchBitmap=null,Metrics.renderTextToScratchBitmap=function(t,e,n){var r,o,s,a,l,u,c;return l=(o=this.pessimisticDrawArea(this.getWidth(t,e),e,null,n)).size.size,(a=(null!=(s=this._scratchBitmap)?s.size:void 0)||p).gt(l)?this._scratchBitmap.clear():this._scratchBitmap=new i(a.max(l)),(r=this._scratchBitmap.context).textAlign="left",r.textBaseline="alphabetic",r.font=v(e),r.fillText(t,u=-o.x,c=-o.y+3*e.fontSize/4),[this._scratchBitmap,l,h(u,c)]},Metrics.debug=function(t,e,n,r){var o;return(o=new i(e.size)).clear("white"),o.drawRectangle(n,t,"#ddf"),o.drawRectangle(n,f(t.location.x,0,t.size.x,1),"red"),o.drawRectangle(n,f(0,t.location.y,1,t.size.y),"green"),o.drawBitmap(h(),e),u(o,{layoutMode:r.layoutMode})},Metrics}()})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l={}.hasOwnProperty;(s=n(42)).log,r=s.inspect,i=s.defineModule,e=n(96).BaseClass,(a=n(313)).point,o=a.rect,a.point0,i(t,function(t){function TextLayoutFragment(t,e,n,i,r,o,s,a,l,u,c,h){this.text=t,this.font=e,this.ascender=null!=n?n:0,this.descender=null!=i?i:0,this.textOffsetX=null!=r?r:0,this.textOffsetY=null!=o?o:0,this.layoutW=null!=s?s:0,this.layoutH=null!=a?a:0,this.drawAreaX=null!=l?l:0,this.drawAreaY=null!=u?u:0,this.drawAreaW=null!=c?c:0,this.drawAreaH=null!=h?h:0,this.firstFragment=!1,this.layoutX=this.layoutY=0,this.alignmentOffsetX=0,this.alignmentOffsetY=0}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TextLayoutFragment,e),TextLayoutFragment.getter({inspectedObjects:function(){return this.toPlainObject()}}),TextLayoutFragment.prototype.toString=function(){return r(this.toPlainObject())},TextLayoutFragment.prototype.mul=function(t){return new TextLayoutFragment(this.text,this.font,t*this.ascender,t*this.descender,t*this.textOffsetX,t*this.textOffsetY,t*this.layoutW,t*this.layoutH,t*this.drawAreaX,t*this.drawAreaY,t*this.drawAreaW,t*this.drawAreaH)},TextLayoutFragment.prototype.toPlainObject=function(){return{text:this.text,font:this.font,ascender:this.ascender,descender:this.descender,textOffsetX:this.textOffsetX,textOffsetY:this.textOffsetY,layoutX:this.layoutX,layoutY:this.layoutY,layoutW:this.layoutW,layoutH:this.layoutH,drawAreaX:this.drawAreaX,drawAreaY:this.drawAreaY,drawAreaW:this.drawAreaW,drawAreaH:this.drawAreaH,alignmentOffsetX:this.alignmentOffsetX,alignmentOffsetY:this.alignmentOffsetY}},TextLayoutFragment.prototype.clone=function(){return new TextLayoutFragment(this.text,this.font,this.ascender,this.descender,this.textOffsetX,this.textOffsetY,this.layoutW,this.layoutH,this.drawAreaX,this.drawAreaY,this.drawAreaW,this.drawAreaH)},TextLayoutFragment.prototype.move=function(t,e){return this.moveX(t),this.moveY(e)},TextLayoutFragment.prototype.moveX=function(t){return this.layoutX+=t,this.drawAreaX+=t},TextLayoutFragment.prototype.moveY=function(t){return this.layoutY+=t,this.drawAreaY+=t},TextLayoutFragment.prototype.setLayoutLocationFrom=function(t){return this.layoutX=t.layoutX,this.layoutY=t.layoutY,this.drawAreaX=t.drawAreaX,this.drawAreaY=t.drawAreaY},TextLayoutFragment.getter({left:function(){return this.getAlignedLayoutX()},top:function(){return this.getAlignedLayoutY()},bottom:function(){return this.getAlignedLayoutY()+this.layoutH},right:function(){return this.getAlignedLayoutX()+this.layoutW},alignedLayoutX:function(){return this.layoutX+this.alignmentOffsetX},alignedLayoutY:function(){return this.layoutY+this.alignmentOffsetY},alignedDrawAreaX:function(){return this.drawAreaX+this.alignmentOffsetX},alignedDrawAreaY:function(){return this.drawAreaY+this.alignmentOffsetY},layoutArea:function(){return o(this.layoutX,this.layoutY,this.layoutW,this.layoutH)},alignedLayoutArea:function(){return o(this.getAlignedLayoutX(),this.getAlignedLayoutY(),this.layoutW,this.layoutH)},alignedDrawArea:function(){return o(this.getAlignedDrawAreaX(),this.getAlignedDrawAreaY(),this.drawAreaW,this.drawAreaH)},alignedDrawAreaLeft:function(){return this.getAlignedDrawAreaX()},alignedDrawAreaTop:function(){return this.getAlignedDrawAreaY()},alignedDrawAreaRight:function(){return this.getAlignedDrawAreaX()+this.drawAreaW},alignedDrawAreaBottom:function(){return this.getAlignedDrawAreaY()+this.drawAreaH},area:function(){return console.error("TextLayoutFragment.area is DEPRICATED. Use: TextLayoutFragment#layoutArea"),o(this.layoutX-this.textOffsetX,this.layoutY-this.textOffsetY,this.layoutW,this.layoutH)},textX:function(){return this.layoutX+this.textOffsetX+this.alignmentOffsetX},textY:function(){return this.layoutY+this.textOffsetY+this.alignmentOffsetY}}),TextLayoutFragment}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a={}.hasOwnProperty;i=n(160),n(313),n(417),r=n(388),i.pureMerge,s=i.isFunction,o=i.createWithPostCreate,t.exports=o(function(t){function ShapeElement(){ShapeElement.__super__.constructor.apply(this,arguments),this._lastPathFunction=null,this._curriedPathFunction=null}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ShapeElement,r),ShapeElement.drawProperty({fillRule:{default:"nonzero",validate:function(t){return"nonzero"===t||"evenodd"===t}},path:{default:function(t,e){var n,i;return i=e.w,n=e.h,t.beginPath(),t.moveTo(0,0),t.lineTo(0,n),t.lineTo(i,n),t.lineTo(i,0),t.lineTo(0,0),t.closePath()},validate:function(t){return s(t)}}}),ShapeElement.prototype.drawBasic=function(t,e,n,i){return this._prepareDrawOptions(this._drawOptions,n,i),this.fillShape(t,e,this._drawOptions)},ShapeElement.prototype.fillShape=function(t,e,n){return n.color||(n.color=this._color),n.fillRule=this._fillRule,t.fillShape(e,n,this._path,this.paddedSize)},ShapeElement.prototype.strokeShape=function(t,e,n){return n.color||(n.color=this._color),t.strokeShape(e,n,this._path,paddedSize)},ShapeElement}())},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y={}.hasOwnProperty;o=n(160),i=n(313),a=n(417),s=n(388),o.log,r=o.BaseClass,o.shallowClone,f=o.pureMerge,o.merge,l=o.createWithPostCreate,h=o.isPlainArray,p=o.isString,c=o.isNumber,d=i.point,i.rect,a.Metrics.normalizeFontOptions,m=n(363),g=m.startFrameTimer,u=m.endFrameTimer,r.propInternalName,r._propSetterName,t.exports=l(function(t){function TextElement(){TextElement.__super__.constructor.apply(this,arguments),this._textLayout=null}return function(t,e){for(var n in e)y.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TextElement,s),TextElement.getter({cacheable:function(){return!0}}),TextElement.drawLayoutProperty({fontSize:{default:16,validate:function(t){return c(t)}},fontFamily:{default:"Times",validate:function(t){return p(t)}},fontStyle:{default:"normal",validate:function(t){return p(t)}},fontVariant:{default:"normal",validate:function(t){return p(t)}},fontWeight:{default:"normal",validate:function(t){return p(t)}},align:{default:0,preprocess:function(t){return d(t)}},layoutMode:{default:"textualBaseline",validate:function(t){return p(t)}},leading:{default:1.25,validate:function(t){return c(t)}},paragraphLeading:{default:null,validate:function(t){return null===t||c(t)}},maxLines:{default:null,validate:function(t){return null==t||c(t)}},overflow:{default:"ellipsis",validate:function(t){return p(t)}},text:{default:a.Layout.defaultText,preprocess:function(t){return h(t)?t.join("\n"):null!=t?""+t:""}}}),TextElement.virtualProperty({font:{getter:function(t){var e;return{fontFamily:(e=this.getState(t))._fontFamily,fontSize:e._fontSize,fontStyle:e._fontStyle,fontVariant:e._fontVariant,fontWeight:e._fontWeight}}},format:{getter:function(t){var e,n,i,r;return e=(r=this.getState(t))._align,n=r._layoutMode,i=r._paragraphLeading,{align:e,layoutMode:n,leading:r._leading,paragraphLeading:i,maxLines:r._maxLines,overflow:r._overflow}}}}),TextElement.virtualProperty({preFilteredBaseDrawArea:function(t){var e;return(null!=(e=this._textLayout)?e.getDrawArea():void 0)||s.preFilteredBaseDrawArea.call(this,t)}}),TextElement.prototype.nonChildrenLayoutFirstPass=function(t,e){var n;return null,g("textLayout"),this._textLayout=new a.Layout(this.getPendingText(),this.getPendingFont(),this.getPendingFormat(),e.x,e.y),n=this._textLayout.getSize(),u(),n},TextElement.prototype.nonChildrenLayoutFinalPass=function(t){return this._textLayout.setWidth(t.x),this._textLayout.size},TextElement.prototype.fillShape=function(t,e,n){return this._textLayout.draw(t,e,f(n,{layoutSize:this.getCurrentSize(),color:(null!=n?n.color:void 0)||this._color}))},TextElement.prototype.strokeShape=function(t,e,n){return this._textLayout.stroke(t,e,f(n,{layoutSize:this.getCurrentSize(),color:(null!=n?n.color:void 0)||this._color}))},TextElement}())},function(t,e,n){(t.exports=n(351)).addModules({BlurElement:n(427),FilterElement:n(428),ShadowElement:n(429)})},function(t,e,n){(function(t){var e,i,r={}.hasOwnProperty;i=n(160),n(313),e=n(428),(0,i.defineModule)(t,function(t){function BlurElement(){return BlurElement.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(BlurElement,e),BlurElement.prototype.defaultRadius=10,BlurElement.prototype.defaultCompositeMode="replace",BlurElement.prototype.applyFilter=function(t,e){return t.blur(this.radius*e)},BlurElement}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l={}.hasOwnProperty;a=n(42),o=a.isFunction,a.log,s=a.isString,r=a.defineModule,i=n(313).Matrix,e=n(389),r(t,function(t){function FilterElement(){return FilterElement.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(FilterElement,e),FilterElement.registerWithElementFactory=function(){return!0},FilterElement.drawProperty({filterSource:{default:null,validate:function(t){return!t||s(t)}}}),FilterElement.drawProperty({filter:{default:null,validate:function(t){return!t||o(t)}}}),FilterElement.drawAreaProperty({radius:{default:0,validate:function(t){return"number"==typeof t}}}),FilterElement.prototype.filterPixelData=function(t,e,n){return e},FilterElement.prototype.applyFilter=function(t,e,n,i){var r;return r=t.imageData,this.filterPixelData(t,r.data,e),t.putImageData(r),t},FilterElement.prototype.fillShape=function(t,e,n){var i,r,o,s;return s=e.exactScaler,this._filter?this._filter(t,s,e,n):(r=(o=this._filterFilterSource(s,t,n)).filterTargetToElementMatrix,i=o.filterTarget,t.drawBitmap(r.mul(e),i,n))},FilterElement.prototype.overDraw=function(t,e){var n,i;return n=e.inv.mul(this.parentToElementMatrix).transformBoundingRect(t).grow(this.radius).intersection(this.elementSpaceDrawArea),i=e.transformBoundingRect(n),t.union(i)},FilterElement.virtualProperty({baseDrawArea:function(t){var e,n,i;return(i=this.getState(t))._currentSize,e=i._radius,n=this.getElementSpaceSourceDrawArea(t),this._inverted&&this.filterSourceDrawAreaInElementSpace.unionInto(n),n.grow(e)}}),FilterElement.getter({requiresParentStagingBitmap:function(){return!0},isFilter:function(){return!0}}),FilterElement.prototype._getFilterSourceElement=function(t,e){var n,i,r,o;if(i=(o=this.getState(t))._filterSource){for(r=o._parent,n=this;r&&r.name!==i;)n=r,r=r.getState(t)._parent;if(r)return e?n:r;console.warn(this.inspectedName+": no ancestor's name matches filterSource:"+inspect(i))}return e?this:o._parent},FilterElement.prototype._filterFilterSource=function(t,e,n){var r,o,s,a,l;return a=this.getFilterSourceElement(),r=this.getElementSpaceDrawArea(),o=i.translate(r.location.neg.add(this.radius)).scale(t),l=a._currentToTargetMatrix.inv.scale(this.getFilterSourceSizeRatio()).mul(o),s=e.newBitmap(r.size.add(2*this.radius).mul(t)).drawBitmap(l,a._currentDrawTarget),{filterTargetToElementMatrix:o.inv,filterTarget:this.applyFilter(s,t,o,n)}},FilterElement.virtualProperty({filterSourceDrawArea:function(t){var e,n;return n=this.getFilterSourceElement(t),e=this.getFilterSourceChildElement(t),n._computeElementSpaceDrawArea(e)},filterSourceSize:function(t){return this.getFilterSourceElement(t).getCurrentSize(t)},filterSourceSizeRatio:function(t){var e,n;return e=this.getState(t)._currentSize,n=this.getFilterSourceSize(t),e.eq(n)?1:e.div(n)},elementSpaceSourceDrawArea:function(t){return this.getFilterSourceDrawArea(t).mul(this.getFilterSourceSizeRatio(t))},filterSourceElement:function(t){return this._getFilterSourceElement(t)},filterSourceChildElement:function(t){return this._getFilterSourceElement(t,!0)},filterSourceDrawAreaInElementSpace:function(t){return this.getFilterSourceElement(t).getElementToElementMatrix(this).transformBoundingRect(this.getFilterSourceDrawArea(t))}}),FilterElement}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s={}.hasOwnProperty;i=(o=n(42)).defineModule,o.log,r=o.merge,e=n(428),i(t,function(t){function ShadowElement(){return ShadowElement.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ShadowElement,e),ShadowElement.prototype.defaultCompositeMode="destOver",ShadowElement.drawProperty({inverted:{default:!1}}),ShadowElement.prototype.applyFilter=function(t,e,n,i){return t.blurAlpha(this._radius*e,{inverted:this.inverted}),(i=r(i,{compositeMode:"sourceTopIntersection",opacity:1})).from&&(i.from=n.transform(i.from)),i.to&&(i.to=n.transform(i.to)),t.drawRectangle(null,t.size,i)},ShadowElement}())}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(354)).addModules({PagingScrollElement:n(431),ScrollElement:n(433),ScrollElementAnimator:n(441)})},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B=function(t,e){for(var n in e)R.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},R={}.hasOwnProperty;s=n(160),e=n(313),o=n(116).EventEpoch,r=n(390),a=n(432),P=s.log,b=s.inspect,y=s.currentSecond,f=s.bound,A=s.round,S=s.first,x=s.last,s.peek,T=s.min,C=s.max,c=s.abs,E=s.merge,s.createWithPostCreate,i=s.BaseClass,F=s.timeout,m=s.ceil,A=s.round,w=s.isPlainArray,p=s.absLt,d=s.absLte,h=s.absGt,s.absGte,k=s.minMagnitude,_=s.maxMagnitude,s.maxChange,p=s.absLt,M=s.requestAnimationFrame,v=s.defineModule,I=e.point,l=e.Point,e.rect,e.Rectangle,e.matrix,e.Matrix,e.isPoint,l.point0,l.pointNearInfinity,o.eventEpoch,g=a.createGestureRecognizer,u=function(t){var e,n;function ScrollAnimator(t,e){this.scrollElement=t,this.maximumVelocity=e,ScrollAnimator.__super__.constructor.apply(this,arguments),this._referenceFrame=this.scrollElement.getPendingReferenceFrame(),this._velocity=0,this._mode="tracking"}return B(ScrollAnimator,i),ScrollAnimator.getter("desiredScrollPosition",{mode:function(){return this._mode},minScrollPosition:function(){return this.scrollElement.getMinScrollPositionInReferenceFrame(this._referenceFrame)},maxScrollPosition:function(){return this.scrollElement.getMaxScrollPositionInReferenceFrame(this._referenceFrame)},scrollPosition:function(){return this.scrollElement.getScrollPositionInReferenceFrame(this._referenceFrame)},animationDone:function(){switch(this.mode){case"spring":return this.velocityIsSlow()&&this._desiredScrollPosition===this.getScrollPosition();case"braking":return this.velocityIsSlow();default:return!this._activeTouch}},animationContinues:function(){return!this.getAnimationDone()}}),ScrollAnimator.setter("desiredScrollPosition",{mode:function(t){return this._mode=t},referenceFrame:function(t){return this._referenceFrame=t},scrollPosition:function(t){return this.scrollElement.setScrollPositionInReferenceFrame(A(t),this._referenceFrame)},activeTouch:function(t){if(!(this._activeTouch=!!t))return this.mode="spring",this._desiredScrollPosition=this.boundLocation(this._desiredScrollPosition)}}),ScrollAnimator.prototype.addToDesiredScrollPosition=function(t){return this._desiredScrollPosition+=t},ScrollAnimator.prototype.animateToLocation=function(t){return this.mode="spring",this._desiredScrollPosition=t},ScrollAnimator.prototype.boundLocation=function(t){return f(this.getMinScrollPosition(),t,this.getMaxScrollPosition())},ScrollAnimator.prototype.startTracking=function(t,e){return this._referenceFrame=e,this.mode="tracking",this._velocity=0,this.setDesiredScrollPosition(t),this._activeTouch=!0},ScrollAnimator.prototype.addVelocity=function(t){return this._velocity=t,this.mode="braking"},ScrollAnimator.prototype.velocityIsSlow=function(){return d(this._velocity,60)},e=0,n=0,ScrollAnimator.prototype.frameUpdate=function(t){var i,r,o,s,a,l,u,h,d,m,g,y;switch(g=Math.round(60*t),e++,p(60*t-1,.25)||g>1&&n++,d=this.getScrollPosition(),m=this._desiredScrollPosition,this._velocity=_(this._velocity,this.maximumVelocity),this._mode){case"tracking":y=this.scrollElement.windowSize,o=this.boundLocation(m),l=y/3,h=T(o,m),u=C(o,m),m=f(h,o+Math.atan((m-o)/l)*(2/Math.PI)*l,u),this._velocity=0,this.setScrollPosition(m);break;case"braking":this._activeTouch=!1,a=3,i=this._velocity*-a,this._velocity+=i*t,d+=this._velocity*t,this.setScrollPosition(d),d!==(r=this.boundLocation(d))&&(this.mode="spring",this._desiredScrollPosition=r);break;case"spring":(s=m-d)*s,a=25,i=s*300+this._velocity*-a,this._velocity=this._velocity+i*t,this.setScrollPosition(this.velocityIsSlow()&&c(d-m)<=1?m:d+k(this._velocity*t,1))}return this.getAnimationContinues()||P("frameUpdate "+this._mode+": DONE (miss rate: "+n+" / "+e+")"),this.getAnimationContinues()},ScrollAnimator}(),v(t,function(t){var e;function PagingScrollElement(){var t;this.initAnimatorSupport(),this._initGestureProps(),this._pages=null,this._currentPage=null,this._atEnd=!1,this._atStart=!0,this._scrollContents=this._pagesBeforeBaselineWrapper=this._pagesAfterBaselineWrapper=null,this._setVerticalAxis(),this._lastScrollUpdatedAt=y(),this._activelyScrolling=!1,PagingScrollElement.__super__.constructor.apply(this,arguments),self.pagingScrollElement=this,this._updateHiddenChildren(),this.onNextReady((t=this,function(){return t.startAtEnd&&t.jumpToEnd(),t._scrollPositionChanged()}))}return B(PagingScrollElement,t),PagingScrollElement.prototype.preprocessEventHandlers=function(t){return E(this._externalHandlerMap=t,{mouseWheel:(e=this,function(t){var n,i,r;switch(e._mostRecentMouseWheelEvent=t,r=e.windowSize,i="horizontal"===e.scroll?t.props.deltaX||0:t.props.deltaY||0,t.props.deltaMode){case"line":i*=16;break;case"page":i*=.75*r}return e.getActiveScrollAnimator()||e.startScrollAnimatorTracking(),i=f(-r,-i,r),n=e.getScrollAnimator().desiredScrollPosition+i,e.getScrollAnimator().desiredScrollPosition=f(e.getScrollAnimator().minScrollPosition,n,e.getScrollAnimator().maxScrollPosition),F(100).then(function(){if(e._mostRecentMouseWheelEvent===t)return e.endScrollAnimatorTracking()})}),animatorDone:function(t){return function(e){if(e.props.animator===t._scrollAnimator)return t._scrollAnimator=null}}(this)},g({custom:{resume:this.gestureResume.bind(this),recognize:this.gestureRecognize.bind(this),begin:this.gestureBegin.bind(this),move:this.gestureMove.bind(this),end:this.gestureEnd.bind(this)}}));var e},PagingScrollElement.prototype._setVerticalAxis=function(){return this.newPoint=function(t,e){return null==e&&(e=0),I(e,t)},this.getPagePosition=function(t){return(null!=t?t.transformToAncestorSpaceY(0,this):void 0)||0},this.getMainCoordinate=function(t){return t.y}},PagingScrollElement.prototype._setHorizontalAxis=function(){return this.newPoint=function(t,e){return null==e&&(e=0),I(t,e)},this.getPagePosition=function(t){return(null!=t?t.transformToAncestorSpaceX(0,this):void 0)||0},this.getMainCoordinate=function(t){return t.x}},PagingScrollElement.prototype.getPageSize=function(t){return t?this.getMainCoordinate(t.getCurrentSize()):0},PagingScrollElement.prototype.getPageEdgeOffset=function(t){var e;return e=t.page,t.atEndEdge?this.getPageSize(e):0},PagingScrollElement.prototype.getPageCenter=function(t){return this.getPagePosition(t)+this.getPageSize(t)/2},e={page:null,atEndEdge:!1},PagingScrollElement.concreteProperty({startAtEnd:{default:!1},referenceFrame:{default:e,postSetter:function(t,e){return t===e&&console.warn("referenceFrame_postSetter - frame didn't change"),this._addToScrollPosition(this.getReferenceFrameDelta(t,e)),this._updatePointerReferenceFrame(t),this._queueUpdateEvent(t,e),this._updatePagesSplit()}},pages:{default:[],validate:function(t){return w(t)},postSetter:function(t,e){var n,i,r,o,s;if(r=o=this.getPendingReferenceFrame(),i=r.page,n=r.atEndEdge,this._atEnd&&(n=!0,i=x(t)),!this._atStart&&i||(n=!1,i=S(t)),o.page&&0>t.indexOf(o.page)&&console.warn("PagingScrollElement#pages setter: New page list does not contain the current referenceFrame. ALWAYS include the current referenceFrame when setting pages. Screen will jump!\n\npage keys: "+b(function(){var e,n,r;for(r=[],e=0,n=t.length;e<n;e++)i=t[e],r.push(i.key);return r}())),o.page!==i||o.atEndEdge!==n?this.setReferenceFrame({page:i,atEndEdge:n}):this._updatePagesSplit(),e.length>0)return this.onNextReady((s=this,function(){return s._updateAtStartAndAtEnd()}))}},scrollPosition:{default:0,postSetter:function(t){var e;return this._scrollPositionChanged(),this.onNextReady((e=this,function(){return e._updateAtStartAndAtEnd()})),this._scrollContents.setLocation(this.newPoint(t))}}}),PagingScrollElement.prototype._scrollPositionChanged=function(){var t,e;return this._activelyScrolling||(this.queueEvent("scrollingActive"),this._activelyScrolling=!0),this._lastScrollUpdatedAt=t=y(),F(250,(e=this,function(){if(e._lastScrollUpdatedAt===t)return e._activelyScrolling=!1,e.queueEvent("scrollingIdle")}))},PagingScrollElement.prototype._updatePagesSplit=function(t,e){var n,i,r;return null==t&&(t=this.getPendingPages()),null==e&&(e=this.getPendingReferenceFrame()),i=e.page,n=e.atEndEdge,(r=t.indexOf(i))<0&&(i&&console.warn("PagingScrollElement#_updatePagesSplit: could not find the old referenceFrame.page(key: "+(i.key||i.inspectedName)+") in the new children. New current page picked; display WILL jump."),r=0),n&&r++,this._pagesBeforeBaselineWrapper.setChildren(t.slice(0,r)),this._pagesAfterBaselineWrapper.setChildren(t.slice(r))},PagingScrollElement.layoutProperty({scroll:{default:"vertical",validate:function(t){return"vertical"===t||"horizontal"===t},postSetter:function(t){return"vertical"===t?this._setVerticalAxis():this._setHorizontalAxis(),this._updateHiddenChildren(t)}}}),PagingScrollElement.prototype.getReferenceFrameDelta=function(t,n){return null==t&&(t=e),null==n&&(n=e),t===n?0:(t.page===n.page?0:this.getPagePosition(t.page)-this.getPagePosition(n.page))+(this.getPageEdgeOffset(t)-this.getPageEdgeOffset(n))},PagingScrollElement.prototype.getScrollPositionInReferenceFrame=function(t){return this.getScrollPosition()+this.getReferenceFrameDelta(t,this.getReferenceFrame())},PagingScrollElement.prototype.setScrollPositionInReferenceFrame=function(t,e){var n,i;return null==e&&(e=this.getPendingReferenceFrame()),this.onNextReady((i=this,function(){return i._updateReferenceFrame()})),n=this.getPendingReferenceFrame(),t+=this.getReferenceFrameDelta(n,e),this.setScrollPosition(t)},PagingScrollElement.getter({minScrollPosition:function(){return this.getMinScrollPositionInReferenceFrame(this.getReferenceFrame())},maxScrollPosition:function(){return this.getMaxScrollPositionInReferenceFrame(this.getReferenceFrame())}}),PagingScrollElement.prototype.getMinScrollPositionInReferenceFrame=function(t){var e,n;return n=this.getWindowSize(),this.getPagesBeforeBaselineSize()+(e=this.getPagesAfterBaselineSize())<=n?0:n-e+this.getReferenceFrameDelta(t,this.getReferenceFrame())},PagingScrollElement.prototype.getMaxScrollPositionInReferenceFrame=function(t){var e,n,i,r;return r=this.getWindowSize(),n=this.getPagesBeforeBaselineSize(),e=this.getPagesAfterBaselineSize(),i=this.getReferenceFrameDelta(t,this.getReferenceFrame()),n+e<=r?0:n+i},PagingScrollElement.prototype.jumpToStart=function(){return this.setScrollPositionInReferenceFrame(0,{page:S(this.getPendingPages()),atEndEdge:!1})},PagingScrollElement.prototype.jumpToEnd=function(){return P("jumpToEnd"),this.getPagesFitInWindow()?this.jumpToStart():this.setScrollPositionInReferenceFrame(this.getWindowSize(),{page:x(this.getPendingPages()),atEndEdge:!0})},PagingScrollElement.getter({atEnd:function(){return this._atEnd},atStart:function(){return this._atStart},inMiddle:function(){return!this._atEnd&&!this._atStart},pagesFitInWindow:function(){return this.getWindowSize()>=this.getTotalPageSize()},windowSize:function(){return this.getMainCoordinate(this.getCurrentSize())},currentPagePosition:function(){return this.getMainCoordinate(this._scrollContents.getCurrentLocation())},pagesBeforeBaselineSize:function(){return this.getMainCoordinate(this._pagesBeforeBaselineWrapper.getCurrentSize())},pagesAfterBaselineSize:function(){return this.getMainCoordinate(this._pagesAfterBaselineWrapper.getCurrentSize())},pagesBeforeBaseline:function(){return this._pagesBeforeBaselineWrapper.getChildren()},pagesAfterBaseline:function(){return this._pagesAfterBaselineWrapper.getChildren()},totalPageSize:function(){return this.getPagesBeforeBaselineSize()+this.getPagesAfterBaselineSize()},pagesOnScreenBeforeBaseline:function(){var t,e,n,i,r,o,s,a;for(o=this.getScrollPosition(),a=0,e=0,n=(s=r=this._pagesBeforeBaselineWrapper.getChildren()).length-1;n>=0&&(i=s[n],e++,!((a+=this.getMainCoordinate(i.getCurrentSize()))>=o));n+=-1);return a<o&&r.length>0&&a>0&&(t=a/r.length,e+=m((o-a)/t)),e},pagesOnScreenAfterBaseline:function(){var t,e,n,i,r,o,s,a,l;for(s=this.getWindowSize()-this.getScrollPosition(),l=0,e=0,n=0,i=(a=o=this._pagesAfterBaselineWrapper.getChildren()).length;n<i&&(r=a[n],e++,!((l+=this.getMainCoordinate(r.getCurrentSize()))>=s));n++);return l<s&&o.length>0&&l>0&&(t=l/o.length,e+=m((s-l)/t)),e},currentGeometry:function(){var t,e,n,i,r,o,s;return s=this.getWindowSize(),t=this.getCurrentPagePosition(),i=this.getPagesBeforeBaselineSize(),n=this.getPagesAfterBaselineSize(),e=this._pages.length,o=i+n,r=this.getPagesOnScreenBeforeBaseline()+this.getPagesOnScreenAfterBaseline(),{currentPagePosition:t,windowSize:s,numPages:e,numPagesBeforeBaseline:this._pagesBeforeBaselineWrapper.getChildren().length,numPagesAfterBaseline:this._pagesAfterBaselineWrapper.getChildren().length,totalPageSize:o,focusedPageBeforeBaseline:this.getReferenceFrame().atEndEdge,suggestedPageSpread:r,pixelsOffscreenBeforeWindow:i-t,pixelsOffscreenAfterWindow:n-s+t,pagesBeforeBaselineSize:i,pagesAfterBaselineSize:n}}}),PagingScrollElement.prototype._initGestureProps=function(){return this._flicked=!1,this._pointerStartPosition=0,this._pointerReferenceFrame=null,this._lastPointerEventTime=null,this._flickSpeed=0,this._gestureActive=!1,this._scrollAnimator=null},PagingScrollElement.getter({activeScrollAnimator:function(){return this._scrollAnimator},scrollAnimator:function(){var t;return t=60*this.getWindowSize()/2,this._scrollAnimator||(this._scrollAnimator=this.startAnimator(new u(this,t)))},debugState:function(){var t,e,n;return{referenceFrame:{page:null!=(e=(n=this.referenceFrame).page)?e.inspectedName:void 0,atEndEdge:n.atEndEdge},pagesBefore:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._pagesBeforeBaselineWrapper.children).length;e<n;e++)t=i[e],r.push(t.inspectedName+" "+(0|this.getMainCoordinate(t.currentSize)));return r}.call(this),pagesAfter:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._pagesAfterBaselineWrapper.children).length;e<n;e++)t=i[e],r.push(t.inspectedName+" "+(0|this.getMainCoordinate(t.currentSize)));return r}.call(this),geometry:this.currentGeometry}}}),PagingScrollElement.prototype.gestureRecognize=function(t){var e;return e=t.delta,"vertical"===this._scroll?1>e.absoluteAspectRatio:1<e.absoluteAspectRatio},PagingScrollElement.prototype.gestureBegin=function(t){var e,n,i;return e=t.location,n=t.timeStamp,this._flickSpeed=0,this._gestureActive=!0,e=this.getMainCoordinate(e),this._pointerReferenceFrame=this._referenceFrame,this._pointerStartPosition=e-this._scrollPosition,this._lastPointerEventTime=n,this.getActiveScrollAnimator()?(this._flicked=!1,F(60,(i=this,function(){var t,n;if(!i._flicked&&i._gestureActive)return i._pointerReferenceFrame=i._referenceFrame,n=i.getPendingScrollPosition(),t=i.getPendingReferenceFrame(),i._pointerStartPosition=e-n,i.getScrollAnimator().startTracking(n,t)}))):this.startScrollAnimatorTracking()},PagingScrollElement.prototype.gestureResume=function(t){return!!this.getActiveScrollAnimator()},PagingScrollElement.prototype.gestureMove=function(t){var e,n,i,r,o;return o=t.timeStamp,e=t.delta,i=t.location,i=this.getMainCoordinate(i),e=this.getMainCoordinate(n=e),r=this.getScrollAnimator(),o>this._lastPointerEventTime&&(this._flickSpeed=n.getMagnitude()/(o-this._lastPointerEventTime),this._flickDirection=e/c(e)||1,this._lastPointerEventTime=o),r.setDesiredScrollPosition(i-this._pointerStartPosition)},PagingScrollElement.prototype.gestureEnd=function(t){return this._gestureActive=!1,h(this._flickSpeed,300)?(this.getScrollAnimator().addVelocity(this._flickSpeed*this._flickDirection*1),this._flicked=!0):this.endScrollAnimatorTracking()},PagingScrollElement.prototype.startScrollAnimatorTracking=function(){return this.getScrollAnimator().startTracking(this._scrollPosition,this._referenceFrame)},PagingScrollElement.prototype.endScrollAnimatorTracking=function(){var t;if(t=this.getActiveScrollAnimator())return t.setReferenceFrame(this.getReferenceFrame()),t.setDesiredScrollPosition(this.getScrollPosition()),t.setActiveTouch(!1)},PagingScrollElement.prototype.setChildren=function(t,e){var n;return null==e&&(e=this.getPendingChildren()),n=(null!=e?e.length:void 0)>0?e:(this._updateHiddenChildren(),[this._scrollContents]),this.setPages(t),PagingScrollElement.__super__.setChildren.call(this,n)},PagingScrollElement.prototype._updatePointerReferenceFrame=function(t){var e,n,i;if(this._pointerReferenceFrame)return e=this.getReferenceFrameDelta(t,this._pointerReferenceFrame),this._pointerStartPosition-=e,null!=(n=this.getActiveScrollAnimator())&&n.addToDesiredScrollPosition(e),null!=(i=this.getActiveScrollAnimator())?i.setReferenceFrame(this._pointerReferenceFrame=t):void 0},PagingScrollElement.prototype._getPageUnderPosition=function(t){var e,n,i,r,o,s;for(n=0,i=(r=((o=t-this.getScrollPosition())<0?(o+=this.getMainCoordinate(this._pagesBeforeBaselineWrapper.getCurrentSize()),this._pagesBeforeBaselineWrapper):this._pagesAfterBaselineWrapper).getChildren()).length;n<i;n++){if(e=r[n],o<(s=this.getMainCoordinate(e.getCurrentSize())))return e;o-=s}return console.warn("PagingScrollElement#_getPageUnderPosition: could not find page under position"),null},PagingScrollElement.prototype._updateAtStartAndAtEnd=function(){var t,e,n,i;return i=this.getScrollPosition(),this.getTotalPageSize()<=this.getWindowSize()?(e=!0,t=!1):(t=i<=this.getMinScrollPosition(),e=i>=this.getMaxScrollPosition()),n=this.getPages(),e&&e!==this._atStart?this.setReferenceFrame({page:S(n)}):t&&t!==this._atEnd&&this.setReferenceFrame({atEndEdge:!0,page:x(n)}),this._atEnd=t,this._atStart=e,t||e},PagingScrollElement.prototype._addToScrollPosition=function(t){return this.setScrollPosition(this.getPendingScrollPosition()+t)},PagingScrollElement.prototype._updateReferenceFrame=function(){var t,e,n,i;if(!this._updateAtStartAndAtEnd())return this.getScrollPosition(),e=this.getWindowSize()/2,(n=this._getPageUnderPosition(e))||console.warn("_updateReferenceFrame: no newCurrentPage"),t=e>this.getPageCenter(n),(i=this.getReferenceFrame()).page!==n||i.atEndEdge!==t?this.setReferenceFrame({page:n,atEndEdge:t}):void 0},PagingScrollElement.prototype._queueUpdateEvent=function(t,e){return this.onNextReady((n=this,function(){var t;return t=n.getReferenceFrame(),n.queueEvent("scrollUpdate",{previousReferenceFrame:e,referenceFrame:t,focusedPage:t.page,currentGeometry:n.getCurrentGeometry(),pagesBeforeBaseline:n.getPagesBeforeBaseline(),pagesAfterBaseline:n.getPagesAfterBaseline()})}));var n},PagingScrollElement.prototype._sizeChanged=function(t,e){return this._queueUpdateEvent(),PagingScrollElement.__super__._sizeChanged.apply(this,arguments)},PagingScrollElement.prototype._updateHiddenChildren=function(t){var e;return null==t&&(t=this.getPendingScroll()),this._scrollContents||(this._scrollContents=new r({key:"scrollContents",receivePointerEvents:"passToChildren"},[this._pagesBeforeBaselineWrapper=new r({key:"pagesBeforeBaseline"}),this._pagesAfterBaselineWrapper=new r({key:"pagesAfterBaseline"})])),"horizontal"===t?(e={hh:1,wcw:1},this._pagesBeforeBaselineWrapper.setAxis("topRight"),this._pagesBeforeBaselineWrapper.setChildrenLayout("row"),this._pagesAfterBaselineWrapper.setChildrenLayout("row")):(e={ww:1,hch:1},this._pagesBeforeBaselineWrapper.setAxis("bottomLeft"),this._pagesBeforeBaselineWrapper.setChildrenLayout("column"),this._pagesAfterBaselineWrapper.setChildrenLayout("column")),this._scrollContents.setSize(e),this._pagesBeforeBaselineWrapper.setSize(e),this._pagesAfterBaselineWrapper.setSize(e),this._lastScrollUpdatedAt=y(),this._activelyScrolling=!1},PagingScrollElement}(function(t){return function(e){function AnimatorSupport(){return AnimatorSupport.__super__.constructor.apply(this,arguments)}return B(AnimatorSupport,t),AnimatorSupport.getter({animatorsActive:function(){return!!this._activeAnimators}}),AnimatorSupport.prototype.initAnimatorSupport=function(){return this._lastTime=0,this._activeAnimators=null,this._frameUpdateQueued=!1},AnimatorSupport.prototype.startAnimator=function(t){return this.getAnimatorsActive()?this._activeAnimators.push(t):(this._activeAnimators=[t],this._lastTime=y(),this.getAnimatorsActive()),this._startAnimatorLoop(),t},AnimatorSupport.prototype.replaceAnimator=function(t,e){var n;return this._activeAnimators&&e&&(n=this._activeAnimators.indexOf(e))>=0?this._activeAnimators[n]=t:this.startAnimator(t)},AnimatorSupport.prototype.stopAllAnimators=function(){return this._activeAnimators=null},AnimatorSupport.prototype._frameUpdate=function(t){var e,n,i,r,o,s,a;if(this._activeAnimators){for(t=(s=t)-this._lastTime,o=null,n=i=0,r=(a=this._activeAnimators).length;i<r;n=++i)(e=a[n]).frameUpdate(t)?null!=o&&o.push(e):(this.queueEvent("animatorDone",{animator:e}),o||(o=this._activeAnimators.slice(0,n)));return o&&(0===o.length?(this._activeAnimators=null,this.queueEvent("allAnimatorsDone")):this._activeAnimators=o),this._lastTime=s}},AnimatorSupport.prototype._startAnimatorLoop=function(){var t;if(!this._frameUpdateQueued)return M((t=this,function(e){var n;return t._lastTime=e/1e3,(n=function(){if(t.getAnimatorsActive())return t._frameUpdateQueued=!0,M(function(e){return t._frameUpdateQueued=!1,t._frameUpdate(e/1e3),n()})})()}))},AnimatorSupport}()}(r)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","merge","clone","currentSecond","timeout","abs","absGt","Function","Object"],[e,n(382)],(t,e,n,r,o,s,a,l,u)=>{let c,h;return c=300,h=90,i.defClass(class GestureRecognizer extends t{constructor(t){super(...arguments),this._nonGestureHandlers=i.object(t,null,t=>i.is(t,l)),this._gestureRecognizers=i.object(t,null,t=>i.is(t,u)),this._activeGesture=this._lastActiveGesture=this._startEvent=null,this._capturedEvents=!1,this._lastPointerEventTime=this._flickDuration=this._flickSpeed=0,this._flickStartEvent=this._lastFlickTime=this._flickVector=this._flickDirection=null,this.setupDefaultRecognizers(),this._noFlickYet=this._startEvent=null}},function(t,l,u){this.createGestureRecognizer=function(e){let n;return(n=new t(e)).getPointerHandlers()},this.create=this.createGestureRecognizer,this.prototype.setupDefaultRecognizers=function(){return i.each2(this._gestureRecognizers,(t,e)=>(()=>{switch(e){case"horizontal":return t.recognize||(t.recognize=(t=>t.delta.absoluteAspectRatio>1));case"vertical":return t.recognize||(t.recognize=(t=>t.delta.absoluteAspectRatio<1));case"rotate":return t.recognize||(t.recognize=(({firstLocation:t,target:e,delta:n})=>{let i,r,o;return(r=(i=t.sub(e.currentSize.div(2))).scalerProjectionSquared(n))<(o=i.magnitudeSquared-r)}))}})())},this.getter({pointerHandlers:function(){return e(this._nonGestureHandlers,{pointerDown:t=>{let e,s,a,l,u;return this._flickSpeed=0,this._capturedEvents=!1,this._startEvent=n(t),this._noFlickYet=!0,(e=i.exists(s=this._nonGestureHandlers)&&s.didNotImmediatelyFlick)&&(this._downAt=r(),o(90,()=>this._noFlickYet?e(t):void 0)),this._lastPointerEventTime=t.timeStamp,this._activeGesture||i.isF((a=this._nonGestureHandlers).pointerDown)&&a.pointerDown(t),i.isF((l=this._nonGestureHandlers).prepare)&&l.prepare(t),i.exists(u=this._lastActiveGesture)&&i.isF(u.resume)&&u.resume(t)?this._resumeGesture(t):void 0},pointerMove:t=>{let e,n,r,o,s;return this._flickForMove(t),this._activeGesture?(!this._capturedEvents&&t.leftDeadzone&&i.exists(e=t.target)&&e.capturePointerEvents&&this._activeGesture.recognize(t)&&(i.exists(n=t.target)&&i.isF(n.capturePointerEvents)&&n.capturePointerEvents(),this._capturedEvents=!0),i.isF((r=this._activeGesture).move)&&r.move(t)):this._startEvent?(this._startGesture(t),i.isF((o=this._nonGestureHandlers).pointerCancel)&&o.pointerCancel(t)):i.isF((s=this._nonGestureHandlers).pointerMove)&&s.pointerMove(t),this._lastPointerEventTime=t.timeStamp},pointerUp:t=>{let e,n,r,o,s,a,l;return e=!1,this._flickForEnd(t),this._activeGesture?(t.leftDeadzone?i.isF((n=this._activeGesture).end)&&n.end(t):(i.isF((r=this._activeGesture).cancel)&&r.cancel(t),e=!0),i.isF((o=this._activeGesture).finally)&&o.finally(t),this._activeGesture=null):e=!0,i.isF((s=this._nonGestureHandlers).finally)&&s.finally(t),e?(i.isF((a=this._nonGestureHandlers).pointerUp)&&a.pointerUp(t),i.isF((l=this._nonGestureHandlers).pointerClick)&&l.pointerClick(t)):void 0},pointerClick:t=>{},pointerCancel:t=>{let e,n,r;return this._activeGesture?(i.isF((e=this._activeGesture).cancel)&&e.cancel(t),i.isF((n=this._activeGesture).finally)&&n.finally(t),this._activeGesture=null):i.isF((r=this._nonGestureHandlers).pointerCancel)&&r.pointerCancel(t),this._startEvent=null}})}}),this.prototype._resumeGesture=function(t){let e,n;return i.exists(e=t.target)&&i.isF(e.capturePointerEvents)&&e.capturePointerEvents(),this._activeGesture=this._lastActiveGesture,i.isF((n=this._activeGesture).begin)&&n.begin(this._startEvent)},this.prototype._startGesture=function(t){let e,n;return i.find(this._gestureRecognizers,(t,e)=>this._lastActiveGesture=this._activeGesture=t,(e,n)=>i.isF(e.recognize)&&e.recognize(t)),this._activeGesture?(i.isF((e=this._activeGesture).begin)&&e.begin(this._startEvent),i.isF((n=this._activeGesture).move)&&n.move(t)):void 0},this.prototype._flickForMove=function(t){let e,n,r,o,a;return e=t.timeStamp,n=t.delta,e>this._lastPointerEventTime&&(i.exists(a=this._activeGesture)&&a.flick||this._nonGestureHandlers.flick)?(this._flickStartEvent=t,this._flickSpeed=n.getMagnitude()/(this._flickDuration=e-this._lastPointerEventTime),({x:r,y:o}=this._flickVector=n),this._flickDirection=s(r)>s(o)?r<0?"left":"right":o<0?"up":"down"):void 0},this.prototype._flickForEnd=function(t){let e,r,o;return a(this._flickSpeed,300)?(e=n(this._flickStartEvent).mergeInProps({flickDirection:this._flickDirection,flickSpeed:this._flickSpeed,flickDuration:this._flickDuration,secondsSinceLastFlick:null!=this._lastFlickTime&&0<t.timeStamp-this._lastFlickTime?t.timeStamp-this._lastFlickTime:void 0}),this._lastFlickTime=t.timeStamp,this._flickStartEvent=null,this._noFlickYet=!1,i.exists(r=this._activeGesture)&&i.isF(r.flick)&&r.flick(e),i.isF((o=this._nonGestureHandlers).flick)&&o.flick(e)):void 0}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Element","bound","max","min","merge","createGestureRecognizer","timeout","Math","point0","Error","ScrollElementAnimator","currentSecond"],[e,n(382),n(360),n(434).GestureRecognizer,{ScrollElementAnimator:n(441)}],(t,e,n,r,o,s,a,l,u,c,h,p)=>{let d,f;return d=.5,f=1,i.defClass(class ScrollElement extends t{constructor(){super(...arguments),this._animating=this._gesturePending=this._validScrollPositionCheckScheduled=!1,this._inFlowChildren=null,this._spMinusTp=this._childrenOffset=this._childrenSize=this._windowSize=this._gestureScrollStartPosition=this._gestureScrollPosition=0,this._firstOnScreenChildIndex=this._lastOnScreenChildIndex=this._focusedChildIndex=-1,this._flickAcceleratorMultiplier=1,this.onNextReady(()=>this._scrollPositionChanged())}},function(t,d,f){let m;m={top:"start",start:"start",left:"start",bottom:"end",right:"end",end:"end"},this.layoutProperty({focusedChild:{default:null},track:{default:"start",validate:function(t){return!!m[t]},preprocess:function(t){return m[t]}},tracking:{default:null},scrollPosition:{default:0,postSetter:function(t){return this._scrollPositionChanged()}}}),this.prototype.defaultChildrenLayout="column",this.prototype.defaultChildArea="logicalArea",this.getter("childrenOffset firstOnScreenChildIndex lastOnScreenChildIndex focusedChildIndex childrenSize windowSize inFlowChildren",{scrollRatio:function(){return-this.childrenOffset/(this.childrenSize-this.windowSize)}}),this.setter({scrollRatio:function(t){return this.setFirstElementPosition(-t*(this.childrenSize-this.windowSize))}}),this.prototype.sp2tp=function(t){return t-this._spMinusTp},this.prototype.tp2sp=function(t){return this._spMinusTp+t},this.prototype.sp2fp=function(t){return this.tp2fp(this.sp2tp(t))},this.prototype.fp2sp=function(t){return this.tp2sp(this.fp2tp(t))},this.prototype.tp2fp=function(t){return(()=>{switch(this.getPendingTracking()){case"end":return t-this._childrenSize;case"child":return t-this.focusedChildOffsetFromPendingGeometry;default:return t}})()},this.prototype.fp2tp=function(t){return(()=>{switch(this.getPendingTracking()){case"end":return t+this._childrenSize;case"child":return t+this.focusedChildOffsetFromPendingGeometry;default:return t}})()},this.prototype.boundFp=function(t){let n;return 0<(n=this.childrenSize-this.windowSize)?e(-n,t,0):0},this.prototype.boundSp=function(t){return this.fp2sp(this.boundFp(this.sp2fp(t)))},this.getter({minScrollPosition:function(){return this.boundSp(-this.childrenSize)},maxScrollPosition:function(){return this.boundSp(this.childrenSize)}}),this.prototype.scrollToTop=function(){return this.animateToValidScrollPositionDelta(this.childrenSize)},this.prototype.scrollToBottom=function(){return this.animateToValidScrollPositionDelta(-this.childrenSize)},this.prototype.scrollToChild=function(t,e,n){switch(n){case"horizontal":if(!this.isHorizontal)return;break;case"vertical":if(!this.isVertical)return}return e?this.centerArea(t.getLogicalAreaInAncestor(this)):this.scrollAreaOnscreen(t.getLogicalAreaInAncestor(this))},this.prototype.pageDown=function(){return this.animateToValidScrollPositionDelta(-this.windowSize)},this.prototype.pageUp=function(){return this.animateToValidScrollPositionDelta(this.windowSize)},this.prototype.scrollAreaOnscreen=function(t){let e,i,r;return e=this.windowSize,i=this._getAreaStart(t),r=this._getAreaEnd(t),i<0?this.animateToValidScrollPositionDelta(-i):r>e?this.animateToValidScrollPositionDelta(n(-i,e-r)):void 0},this.prototype.centerArea=function(t){let e,n,i;return e=this.windowSize,n=this._getAreaStart(t),i=this._getAreaEnd(t),this.animateToValidScrollPositionDelta(-r((n+i-e)/2,n))},this.prototype.animateToValidScrollPositionDelta=function(t=0){let e;return({scrollPosition:e}=this),this._validScrollPositionCheckScheduled=!1,this._scrollAnimator.animatingMemomentum?void 0:this._scrollAnimator.animateToValidScrollPosition(e+t)},this.prototype.setFirstElementPosition=function(t){return this.scrollPosition=this.boundSp(this.fp2sp(t))},this.prototype.preprocessEventHandlers=function(t){return o(this._externalHandlerMap=t,{mouseWheel:t=>{let n,i,r;switch(this._mostRecentMouseWheelEvent=t,({windowSize:n,tracking:i}=this),r=this.isVertical?t.props.deltaY||0:t.props.deltaX||0,t.props.deltaMode){case"line":r*=16;break;case"page":r*=.75*n}return this.scrollPosition=this.boundSp(this.getScrollPosition(!0)+e(-n,-r,n)),a(100).then(()=>{if(this._mostRecentMouseWheelEvent===t)return this.animateToValidScrollPositionDelta()})}},s({didNotImmediatelyFlick:t=>(this._flickAcceleratorMultiplier=1,this._scrollAnimator.animatingTo?void 0:this._scrollAnimator.freeze()),prepare:()=>this._gesturePending=!0,finally:()=>(this.animateToValidScrollPositionDelta(),this._gesturePending=!1),custom:{flick:({props:{flickDirection:t,flickSpeed:e,secondsSinceLastFlick:n}})=>{let i;return e*=i=null!=n&&n<=.5?this._flickAcceleratorMultiplier*=1.25:this._flickAcceleratorMultiplier=1,(()=>{switch(t){case"up":return this.isVertical&&this._scrollAnimator.addVelocity(-e);case"down":return this.isVertical&&this._scrollAnimator.addVelocity(e);case"left":return this.isHorizontal&&this._scrollAnimator.addVelocity(-e);case"right":return this.isHorizontal&&this._scrollAnimator.addVelocity(e)}})()},recognize:({delta:t})=>this.isVertical?1>t.absoluteAspectRatio:1<t.absoluteAspectRatio,begin:()=>this._beginGestureAt(this.getPendingScrollPosition()),move:t=>{let e,n;return e=this._gestureScrollPosition+=this._getMainCoordinate(t.delta),this.scrollPosition=e!==(n=this.boundSp(e))?n+this._overScrollTransformation(e-n):e},resume:t=>this._scrollAnimator.active,cancel:()=>this.scrollPosition=this._gestureScrollStartPosition}}))},this.prototype._beginGestureAt=function(t){let e;return this._gestureScrollStartPosition=this._gestureScrollPosition=t!==(e=this.boundSp(t))?e+this._inverseOverScrollTransformation(t-e):t},this.prototype._freeze=function(t=this.scrollPosition){return this._beginGestureAt(this.scrollPosition=t)},this.prototype.postFlexLayout=function(t,e,n,r,o){let s,a,l,u;return s=n<=r,a=this._windowSize!==r,(l=!this._pendingState._tracking)&&!s&&"end"===(this._pendingState._tracking=this._pendingState._track)?this._spMinusTp-=r:a&&"end"===this._pendingState._tracking&&(this._spMinusTp+=this._windowSize-r),this._windowSize=r,this._childrenSize=n,this._inFlowChildren=e,0!==(u=s?this.firstElementPosition:this.firstElementPosition-o)&&(this.isHorizontal?i.each2(e,t=>t._translateLocationXY(u,0)):i.each2(e,t=>t._translateLocationXY(0,u))),this._updateTracking(t,e,n,r,o+u)},this.prototype._updateTracking=function(t,e,n,i,r){let o,s,a,u,c,h,p,d,f,m;return o=this._childrenOffset,this._childrenOffset=r,({_scrollPosition:s,_tracking:a,_track:u}=this.getPendingState()),c=n<=i,p=!(h=!a),d=r+n<=i,f=r>=0,m=this._scrollPosition!==s,1/256<l.abs(s-this.boundSp(s))&&this.scheduleValidScrollPositionCheck(),this._pendingState._tracking=a=c?null:h&&!m?u:d?"end":f?"start":"child","child"===a?this._updateFocusedChild(t,e,n,i):this._pendingState._focusedChild=null,c?p&&(this._spMinusTp=s):this._spMinusTp=s-this.trackingPositionFromPendingGeometry,this._updateOnScreenInfo(this._childrenOffset-o)},this.prototype._updateOnScreenInfo=function(t){let e,o,s,a,l,c,h;return({isVertical:e,windowSize:o}=this),s=this._pendingState._focusedChild,a=this._pendingState._children,l=a.length,c=h=-1,i.each2(a,(t,i)=>{let a,p;return t.getPendingInFlow()?(e?(a=t.getCurrentLocationY(!1,u),p=t.getCurrentSize().y):(a=t.getCurrentLocationX(!1,u),p=t.getCurrentSize().x),a<o&&a+p>0?(l=r(i,l),c=n(i,c),t===s?h=i:void 0):void 0):void 0}),l===a.length&&(l=-1),0===t&&l===this._firstOnScreenChildIndex&&c===this._lastOnScreenChildIndex&&h===this._focusedChildIndex&&s===this._focusedChild||this.queueEvent("scrollUpdate",()=>({scrollRatio:this.scrollRatio,childrenOffset:this.childrenOffset,childrenSize:this.childrenSize,childrenOffsetDelta:t,windowSize:o,focusedChild:s,firstOnScreenChildIndex:l,lastOnScreenChildIndex:c,focusedChildIndex:h})),this._firstOnScreenChildIndex=l,this._lastOnScreenChildIndex=c,this._focusedChildIndex=h,null},this.prototype._updateFocusedChild=function(t,e,n,r){let o,s,a;if(o=r/2,s=null,a=0,this.isHorizontal?i.each2(e,t=>{let e;return o>(e=t.getCurrentLocationX(!0,u))||!s?(s=t,a=e):void 0}):i.each2(e,t=>{let e;return o>(e=t.getCurrentLocationY(!0,u))||!s?(s=t,a=e):void 0}),!s)throw new c("no focused child");return this._pendingState._focusedChild=s,a},this.getter({internalAnimators:function(){let t;return null!=(t=this._scrollAnimator)||(this._scrollAnimator=new h("scrollPosition",{scrollElement:this})),{scrollPosition:this._scrollAnimator}},maxOverscrollDistance:function(){return this._windowSize/3}}),this.prototype._overScrollTransformation=function(t){let e;return(e=this.maxOverscrollDistance)*(2/l.PI)*l.atan(t/e)},this.prototype._inverseOverScrollTransformation=function(t){let e;return(e=this.maxOverscrollDistance)*l.tan(t/(2*e/l.PI))},this.prototype.scheduleValidScrollPositionCheck=function(){return this._validScrollPositionCheckScheduled||!this._gesturePending||this._scrollAnimator.active?void 0:(this._validScrollPositionCheckScheduled=!0,a(250,()=>(this._gesturePending||this._scrollAnimator.active||this.animateToValidScrollPositionDelta(),this._validScrollPositionCheckScheduled=!1)))},this.prototype._scrollPositionChanged=function(){let t;return this._activelyScrolling||(this.queueEvent("scrollingActive"),this._activelyScrolling=!0),this._lastScrollUpdatedAt=t=p(),a(250,()=>this._lastScrollUpdatedAt===t?(this._activelyScrolling=!1,this.queueEvent("scrollingIdle")):void 0)},this.getter({focusedChildFromPendingGeometry:function(){let t;return(t=this.getPendingFocusedChild())&&t.getPendingParent()!==this?this.getPendingState()._focusedChild=this._inFlowChildren[r(this._inFlowChildren.length-1,this._focusedChildIndex)]:t},firstChildPositionFromPendingGeometry:function(){return this._getChildPosition(this.inFlowChildren[0])},lastChildPositionFromPendingGeometry:function(){return this._childrenOffset+this._childrenSize},focusedChildPositionFromPendingGeometry:function(){return this._getChildPosition(this.focusedChildFromPendingGeometry)},focusedChildOffsetFromPendingGeometry:function(){return this.focusedChildPositionFromPendingGeometry-this.firstChildPositionFromPendingGeometry},trackingPositionFromPendingGeometry:function(){return this.fp2tp(this.firstChildPositionFromPendingGeometry)},trackingPosition:function(){return this.sp2tp(this.getPendingScrollPosition())},firstElementPosition:function(){return this.sp2fp(this.getPendingScrollPosition())},boundedScrollPosition:function(){return this.boundSp(this.getPendingScrollPosition())},isHorizontal:function(){return"column"!==this.getPendingChildrenLayout()},isVertical:function(){return"column"===this.getPendingChildrenLayout()}}),this.prototype._getMainCoordinate=function(t){return this.isHorizontal?t.x:t.y},this.prototype._getAreaStart=function(t){return this.isHorizontal?t.left:t.top},this.prototype._getAreaEnd=function(t){return this.isHorizontal?t.right:t.bottom},this.prototype._getChildPosition=function(t){return this.isVertical?t.getCurrentLocationY(!0,u):t.getCurrentLocationX(!0,u)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(355)).addModules({GestureRecognizer:n(432),KeyEvent:n(435),MultitouchManager:n(437),Pointer:n(438),PointerEvent:n(439),PointerEventManager:n(440)})},function(t,e,n){var i,r,o={}.hasOwnProperty;r=n(160),i=n(116),n(436).polyfill(),r.log,t.exports=function(t){function KeyEvent(t,e){this._keyboardEvent=e,KeyEvent.__super__.constructor.call(this,t,{key:this._keyboardEvent.key,altKey:this._keyboardEvent.altKey,ctrlKey:this._keyboardEvent.ctrlKey,shiftKey:this._keyboardEvent.shiftKey,metaKey:this._keyboardEvent.metaKey})}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(KeyEvent,i.Event),KeyEvent}()},function(t,e,n){var i,r;!function(){var o,s={polyfill:function polyfill(){if(!("KeyboardEvent"in window)||"key"in KeyboardEvent.prototype)return!1;var t={get:function(t){var e=s.keys[this.which||this.keyCode];return Array.isArray(e)&&(e=e[+this.shiftKey]),e}};return Object.defineProperty(KeyboardEvent.prototype,"key",t),t},keys:{3:"Cancel",6:"Help",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",28:"Convert",29:"NonConvert",30:"Accept",31:"ModeChange",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",42:"Print",43:"Execute",44:"PrintScreen",45:"Insert",46:"Delete",48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],91:"OS",93:"ContextMenu",144:"NumLock",145:"ScrollLock",181:"VolumeMute",182:"VolumeDown",183:"VolumeUp",186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"'],224:"Meta",225:"AltGraph",246:"Attn",247:"CrSel",248:"ExSel",249:"EraseEof",250:"Play",251:"ZoomOut"}};for(o=1;o<25;o++)s.keys[111+o]="F"+o;var a="";for(o=65;o<91;o++)a=String.fromCharCode(o),s.keys[o]=[a.toLowerCase(),a.toUpperCase()];void 0===(r="function"==typeof(i=s)?i.call(e,n,e,t):i)||(t.exports=r)}()},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","point0","matrix","Error","Matrix"],[e,n(382)],(t,e,n,r,o)=>{return i.defClass(class MultitouchManager extends t{constructor(){super(...arguments),this._activePointers=[],this._resetMultitouchTracking()}},function(t,s,a){this.getter("multitouchOccured","activePointers",{firstActivePointer:function(){return this._activePointers[0]},secondActivePointer:function(){return this._activePointers[1]},numActivePointers:function(){return this._activePointers.length},moveToPoint:function(){return(()=>{switch(this.numActivePointers){case 0:return e;case 1:return this.firstActivePointer.location;default:return this.firstActivePointer.location.average(this.secondActivePointer.location)}})()},multitouchTransform:function(){return this._transformCorrection.mul(this.uncorrectedMultitouchTransform)},rotate:function(){return this.multitouchTransform.angle},scale:function(){return this.multitouchTransform.exactScaler},translate:function(){return this.moveToPoint.sub(this._moveFromPoint)},multitouchTransformParts:function(){return this._getMultitouchTransformParts(this.multitouchTransform,this.translate)}}),this.prototype.getActivePointer=function(t){return i.find(this._activePointers,null,e=>e.id===t)},this.prototype.translateIn=function({absToElementMatrix:t}){return t.transform(this.moveToPoint).sub(t.transform(this._moveFromPoint))},this.prototype.moveToPointIn=function({absToElementMatrix:t}){return t.transform(this.moveToPoint)},this.prototype.multitouchTransformIn=function({absToElementMatrix:t}){return t.invertAndMul(this.multitouchTransform).mul(t)},this.prototype.multitouchTransformPartsIn=function(t){return this._getMultitouchTransformParts(this.multitouchTransformIn(t),this.translateIn(t))},this.prototype.addActivePointer=function(t){let e,n,i;if(!this.getActivePointer(t.id))switch(e=(i=this).multitouchTransform,n=i.translate,this._activePointers.push(t),this.numActivePointers){case 1:this._moveFromPoint=t.location;break;case 2:this._correctMultitouchTracking(e,n),this._multitouchOccured=!0}return this},this.prototype.updateActivePointer=function(t){return i.find(this._activePointers,(e,n)=>this._activePointers[n]=t,(e,n)=>e.id===t.id),this},this.prototype.removeActivePointer=function(t){let e,n,r;return r=this,e=this.multitouchTransform,n=this.translate,this._activePointers=i.array(this._activePointers,null,e=>e.id!==t.id),this._activePointers.length>0&&this._correctMultitouchTracking(e,n),0===this.numActivePointers&&this._resetMultitouchTracking(),this},this.prototype._getMultitouchTransformParts=function(t,e){return{rotate:t.angle,scale:t.exactScaler,translate:e}},this.prototype._resetMultitouchTracking=function(){return this._transformCorrection=n(),this._moveFromPoint=e,this._multitouchOccured=!1},this.prototype._correctMultitouchTracking=function(t,e){return this._transformCorrection=t.div(this.uncorrectedMultitouchTransform),this._moveFromPoint=this.moveToPoint.sub(e),this.translate.eq(e)?void 0:(()=>{throw new r})()},this.getter({uncorrectedMultitouchTransform:function(){let t,e;return(()=>{switch(this.numActivePointers){case 0:return n();case 1:return o.translate(this.firstActivePointer.totalDelta);default:return[t,e]=this.activePointers,o.multitouch(t.firstLocation,t.location,e.firstLocation,e.location)}})()}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;(r=n(42)).inspect,i=r.defineModule,r.clone,r.peek,r.first,r.log,s=n(160).Browser.simpleBrowserInfo,e=n(96).BaseClass,(o=n(313)).point,o.rect,o.matrix,i(t,function(t){var n,i,r;function Pointer(t,e,n,i,r,o){this.pointerEventManager=t,null==o&&(o=!0),this.id=e,this.location=n,this.lastLocation=i||n,this.firstLocation=r||n,this.stayedWithinDeadzone=o}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Pointer,e),Pointer.pointerDeadZone=i=s.pixelsPerPoint*("android"===s.os?8:3),Pointer.pointerDeadZoneSquared=r=i*i,Pointer.getter({activePointers:function(){return this.pointerEventManager.activePointers},inspectedObjects:function(){return{pointer:{id:this.id,location:this.location,lastLocation:this.lastLocation,firstLocation:this.firstLocation,stayedWithinDeadzone:this.stayedWithinDeadzone}}}}),n={},Pointer.prototype.newPointer=function(t){return null==t&&(t=n),new Pointer(t.pointerEventManager||this.pointerEventManager,t.id||this.id,t.location||this.location,t.lastLocation||this.lastLocation,t.firstLocation||this.firstLocation,t.stayedWithinDeadzone||this.stayedWithinDeadzone)},Pointer.prototype.moved=function(t){var e;return e=this.stayedWithinDeadzone&&t.distanceSquared(this.firstLocation)<=r,new Pointer(this.pointerEventManager,this.id,t,this.location,this.firstLocation,e)},Pointer.prototype.locationIn=function(t){return t?t.absToElementMatrix.transform(this.location):this.location},Pointer.prototype.lastLocationIn=function(t){return t?t.absToElementMatrix.transform(this.lastLocation):this.lastLocation},Pointer.prototype.firstLocationIn=function(t){return t?t.absToElementMatrix.transform(this.firstLocation):this.firstLocation},Pointer.prototype.deltaIn=function(t){return t?t.absToElementMatrix.transformDifference(this.location,this.lastLocation):this.location.sub(this.lastLocation)},Pointer.prototype.totalDeltaIn=function(t){return t?t.absToElementMatrix.transformDifference(this.location,this.firstLocation):this.location.sub(this.firstLocation)},Pointer.getter({totalDelta:function(){return this.location.sub(this.firstLocation)}}),Pointer}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Event","log","Math","isNumber"],[e,n(382),n(116)],(t,e,n,r)=>{let o,s;return o=function(t,e,n){return t?[t]:e||n||[]},s=function(t,e){return i.array(t,t=>e.transform(t))},i.defClass(class PointerEvent extends t{constructor(t,n,o){let s;super(t,s=r(o)?(e.warn("DEPRICATED: propsOrTime should always be props. Use: 'time: eventTime'"),{time:o}):o,i.exists(s)&&s.time),this.pointer=n}},function(t,r,o){let s,a,l;this.prototype.clone=function(){return this.newEvent()},s={},this.prototype.newEvent=function(n){let i,r,o,a,l,u;return n?e.warn("DEPRICATED: PointerEvent.newEvent(options); Use: mergeInto event.clone(), options"):n=s,(i=new t(null!=(r=n.type)?r:this.type,null!=(o=n.pointer)?o:this.pointer,null!=(a=n.time)?a:this.time,null!=(l=n.props)?l:this.props)).timeStamp=this.timeStamp,i.target=null!=(u=n.target)?u:this.target,i},a=function({currentSize:t},{x:e,y:i}){return n.atan2(i-t.y/2,e-t.x/2)},l=function(t,e){let r;return(r=i.mod(t-e,2*n.PI))>n.PI?r-2*n.PI:r},this.getter({numActivePointers:function(){return this.pointer.activePointers.length},activePointers:function(){return this.pointer.activePointers},stayedWithinDeadzone:function(){return this.pointer.stayedWithinDeadzone},leftDeadzone:function(){return!this.stayedWithinDeadzone},location:function(){return this.pointer.locationIn(this.target)},firstLocation:function(){return this.pointer.firstLocationIn(this.target)},lastLocation:function(){return this.pointer.lastLocationIn(this.target)},firstAngle:function(){return a(this.target,this.firstLocation)},angle:function(){return a(this.target,this.location)},angleDelta:function(){return l(this.firstAngle,this.angle)},absLocation:function(){return this.pointer.location},absFirstLocation:function(){return this.pointer.firstLocation},absLastLocation:function(){return this.pointer.lastLocation},parentLocation:function(){return this.pointer.locationIn(this.target.parent)},parentParentLocation:function(){return this.pointer.locationIn(this.target.parent.parent)},parentFirstLocation:function(){return this.pointer.firstLocationIn(this.target.parent)},parentParentFirstLocation:function(){return this.pointer.firstLocationIn(this.target.parent.parent)},parentLastLocation:function(){return this.pointer.lastLocationIn(this.target.parent)},parentParentLastLocation:function(){return this.pointer.lastLocationIn(this.target.parent.parent)},absDelta:function(){return this.pointer.location.sub(this.pointer.lastLocation)},delta:function(){return this.location.sub(this.lastLocation)},parentDelta:function(){return this.pointer.deltaIn(this.target.parent)},parentParentDelta:function(){return this.pointer.deltaIn(this.target.parent.parent)},absTotalDelta:function(){return this.pointer.location.sub(this.pointer.firstLocation)},totalDelta:function(){return this.location.sub(this.firstLocation)},totalParentDelta:function(){return this.pointer.totalDeltaIn(this.target.parent)},totalParentParentDelta:function(){return this.pointer.totalDeltaIn(this.target.parent.parent)},pointerEventManager:function(){return this.pointer.pointerEventManager},multitouchManager:function(){return this.pointerEventManager.multitouchManager},locations:function(){let t;return(i.exists(t=this.activePointers)&&t.length)>1?i.array(this.activePointers,t=>t.locationIn(this.target)):[this.locationIn]},firstLocations:function(){let t;return(i.exists(t=this.activePointers)&&t.length)>1?i.array(this.activePointers,t=>t.firstLocationIn(this.target)):[this.firstLocation]},multitouchLeftDeadzone:function(){let t;return(i.exists(t=this.activePointers)&&t.length)>1?!i.find(this.activePointers,null,t=>!t.leftDeadzone):this.leftDeadzone},multitouchTransformInAbsSpace:function(){return this.multitouchManager.multitouchTransform},multitouchTransformInParent:function(){return this.multitouchTransformIn(this.target.parent)},multitouchTransform:function(){return this.multitouchTransformIn(this.target)},multitouchParts:function(){return this.multitouchTransformPartsIn(this.target)},multitouchOccured:function(){return this.multitouchManager.multitouchOccured}}),this.prototype.multitouchTransformIn=function(t){return this.multitouchManager.multitouchTransformIn(t)},this.prototype.multitouchTransformPartsIn=function(t){return this.multitouchManager.multitouchTransformPartsIn(t)},this.prototype.toElementMatrix=function(t){return this.target.getElementToElementMatrix(t)},this.prototype.locationIn=function(t){return this.pointer.locationIn(t)},this.prototype.lastLocationIn=function(t){return this.pointer.lastLocationIn(t)},this.prototype.firstLocationIn=function(t){return this.pointer.firstLocationIn(t)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x={}.hasOwnProperty;(v=n(42)).inspect,v.clone,v.shallowClone,g=v.peek,v.first,m=v.min,f=v.max,v.eq,u=v.arrayWithoutValue,w=v.stableSort,v.log,p=v.isObject,v.formattedInspect,h=v.isArray,i=n(96).BaseClass,S=n(313),y=S.point,S.rect,S.matrix,r=n(116).EventEpoch,c=r.eventEpoch,b=n(160).Browser.simpleBrowserInfo,d=n(363).logFrameEvent,s=n(437),a=n(438),l=n(439),o=n(435),t.exports=function(t){var e,n,r,v;function PointerEventManager(t){null==t&&(t={}),PointerEventManager.__super__.constructor.apply(this,arguments),this.canvasElement=t.canvasElement,this.mouse=new a(this,"mouse",y(-1)),this.multitouchManager=new s(this),this._capturingElement=null,this._currentMousePath=[],this._currentFocusPath=[this.canvasElement],this._pointerFocusPath=null,this._savedFocusedElement=null,this._doingMultitouchMoveEvents=!1,this._moveEventOccured=!1}return function(t,e){for(var n in e)x.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PointerEventManager,i),PointerEventManager.prototype.saveFocus=function(){return this._savedFocusedElement=g(this._currentFocusPath)},PointerEventManager.prototype.restoreFocus=function(){if(this._savedFocusedElement&&!b.touch)return this._savedFocusedElement.canvasElement===this.canvasElement&&this.focus(null,r(this._savedFocusedElement)),this._savedFocusedElement=null},PointerEventManager.getter("currentFocusPath",{focusedElement:function(){return g(this._currentFocusPath)},hasMouseCursor:function(){return!0},currentMousePathClassNames:function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this._currentMousePath).length;e<n;e++)t=i[e],r.push(t.classPathName);return r},activePointers:function(){return this.multitouchManager.activePointers},firstActivePointer:function(){return this.multitouchManager.firstActivePointer},numActivePointers:function(){return this.multitouchManager.numActivePointers}}),PointerEventManager.prototype.getActivePointer=function(t){return this.multitouchManager.getActivePointer(t)},PointerEventManager.prototype.addActivePointer=function(t){return this.multitouchManager.addActivePointer(t)},PointerEventManager.prototype.updateActivePointer=function(t){return this.multitouchManager.updateActivePointer(t)},PointerEventManager.prototype.removeActivePointer=function(t){if(this.multitouchManager.removeActivePointer(t),0===this.numActivePointers)return this._pointerFocusPath=this._capturingElement=null},PointerEventManager.prototype.startMultitouchMoveEvents=function(){return this._doingMultitouchMoveEvents=!0,this._moveEventOccured=!1},PointerEventManager.prototype.endMultitouchMoveEvents=function(){return this._doingMultitouchMoveEvents=this._moveEventOccured=!1},PointerEventManager.prototype.capturePointerEvents=function(t){var e,n,i,r,o;for(e=u(this._pointerFocusPath,t),n=0,i=(o=this.activePointers).length;n<i;n++)r=o[n],this.queuePointerEventForElements(e,"pointerCancel",r);return this._capturingElement=t},PointerEventManager.prototype.pointerEventsCapturedBy=function(t){return t===this._capturingElement},PointerEventManager.prototype.pointerElementPath=function(t){var e,n,i;if(!(i=this.canvasElement).pointInside(t.location))return[];for(e=i,n=[];e;)n.push(e),e=e.childUnderPoint(t.locationIn(e));return n},PointerEventManager.prioritySortElements=n=function(t){return null!=t?w(t,function(t,e){return e._pointerEventPriority-t._pointerEventPriority}):[]},PointerEventManager.sortElementsBaseOnRelationshipPriority=function(t){var e,n,i;return n=[],e=function(t){return n.push(t)},(i=function(n,r){var o,s,a,l,u,c,h,p,d,f,m;if(!(r<=n)){if(n+1===r)return e(n);for(a=r,s=r,l=u=r-1,p=n;u>=p;l=u+=-1)switch(t[l]){case"beforeDescendents":a=l;break;case"beforeAncestors":l>n&&(s=l)}if(a<=s){for(o=!1,l=c=n,d=a;c<d;l=c+=1)"afterChildren"===t[l]?o=!0:e(l);if(a<r&&e(a),i(a+1,r),o){for(m=[],l=h=a-1,f=n;h>=f;l=h+=-1)"afterChildren"===t[l]?m.push(e(l)):m.push(void 0);return m}}else if(s<r)return i(s,r),i(n,s)}})(0,t.length),n},PointerEventManager.prototype.forEachPointerFocusedElement=function(t){var e,i,r,o,s;if(e=this._capturingElement)return t(e);for(s=[],i=0,r=(o=n(this._pointerFocusPath)).length;i<r;i++)e=o[i],s.push(t(e));return s},PointerEventManager.prototype.queueEventForElements=function(t,e,n){var i,r,o,s;for(s=[],r=0,o=t.length;r<o;r++)i=t[r],s.push(i.queueEvent(e,n));return s},PointerEventManager.prototype.queuePointerEventForElement=function(t,e,n,i){return t.queueEvent(e,(r=this,function(){if(!r._capturingElement||"pointerCancel"===e||t===r._capturingElement)return new l(e,n,i)}));var r},PointerEventManager.prototype.queuePointerEventForElements=function(t,e,i,r){var o,s,a,l;for(l=[],s=0,a=(t=n(t.slice())).length;s<a;s++)o=t[s],l.push(this.queuePointerEventForElement(o,e,i,r));return l},PointerEventManager.prototype.queuePointerEvents=function(t,e,n){return this.forEachPointerFocusedElement((i=this,function(r){return i.queuePointerEventForElement(r,t,e,n)}));var i},PointerEventManager.prototype.queueMouseEvents=function(t,e,n){return this.queuePointerEventForElements(this._currentMousePath,t,e,n)},PointerEventManager.prototype.queuePointerUpInAndOutsideEvents=function(t,e){return this.forEachPointerFocusedElement((n=this,function(i){var r,o;return r=t.locationIn(i.parent),o=i.pointInside(r)?"pointerUpInside":"pointerUpOutside",n.queuePointerEventForElement(i,o,t,e)}));var n},PointerEventManager.prototype.queuePointerMoveInAndOutEvents=function(t,e){var n,i,r;return n=!0,i=!0,this.forEachPointerFocusedElement((r=this,function(o){var s,a,l,u,c;return a=t.lastLocationIn(o.parent),l=t.locationIn(o.parent),c=i&&o.pointInside(a),(s=n&&o.pointInside(l))!==c&&(u=s?"pointerIn":"pointerOut",r.queuePointerEventForElement(o,u,t,e)),n=s,i=c}))},PointerEventManager.prototype.queueOutEvents=function(t,e){return this.queuePointerEventForElements(e,"mouseOut",t)},PointerEventManager.prototype.queueInEvents=function(t,e){return this.queuePointerEventForElements(e,"mouseIn",t)},PointerEventManager.prototype.queueBlurEvents=function(t,e){return this.queuePointerEventForElements(e,"blur",t)},PointerEventManager.prototype.queueFocusEvents=function(t,e){return this.queuePointerEventForElements(e,"focus",t)},PointerEventManager.prototype.queueKeyEvents=function(t,e){var n,i,r,s,a,l,u,c,h,d,f,m,g,y;for(s=r=this.refreshFocusPath(),c=null,a=l=0,h=r.length;l<h;a=++l)if(m=y=(i=r[a]).getWillConsumeKeyboardEvent()(t,e))switch(p(y)&&(m=y.order,n=y.allowBrowserDefault),n||e.preventDefault(),m){case"beforeAncestors":c=i;break;case"beforeDescendents":if(!c){s=r.slice(0,a+1);break}}if(f=function(){return new o(t,e)},c)return c.queueEvent(t,f);for(g=[],u=0,d=s.length;u<d;u++)i=s[u],g.push(i.queueEvent(t,f));return g},PointerEventManager.elementToRootPath=e=function(t){var e;for(e=[];t;)e.push(t),t=t.parent;return e},PointerEventManager.rootToElementPath=r=function(t){return e(t).reverse()},PointerEventManager.updatePath=v=function(t,e,n,i,r){var o,s,a,l,u;for(l=m(t.length,e.length),a=f(t.length,e.length),o=s=0,u=l;s<u;o=s+=1)if(t[o]!==e[o])return n(t.slice(o)),i(e.slice(o)),r&&r(e),e;return l===a?t:(l<t.length&&n(t.slice(l)),l<e.length&&i(e.slice(l)),r&&l!==a&&r(e),e)},PointerEventManager.prototype.updateCursor=function(t){var e,n,i,r;for(n="default",i=0,r=t.length;i<r;i++)(e=t[i].cursor)&&(n=e);return this.canvasElement.cssCursor=n},PointerEventManager.prototype.isFocused=function(t){return this._currentFocusPath.indexOf(t)>=0},PointerEventManager.getter({validatedFocusPath:function(){var t,e,n,i,r,o,s;if(this._currentFocusPath[0]!==this.canvasElement)return[this.canvasElement];for(i=this.canvasElement.parent,s=[],e=n=0,r=(o=this._currentFocusPath).length;n<r&&((t=o[e]).canvasElement===this.canvasElement&&t.parent===i);e=++n)s.push(i=t);return s}}),PointerEventManager.prototype.refreshFocusPath=function(){return this._updateFocusedPath(null,r(this.focusedElement))},PointerEventManager.prototype._updateFocusedPath=function(t,e){var n;if(null==t&&(t=this.firstActivePointer),e[0]!==this.canvasElement&&(e=this.validatedFocusPath),this._currentFocusPath=v(this._currentFocusPath,e,(n=this,function(e){return n.queueBlurEvents(t,e)}),function(e){return function(n){return e.queueFocusEvents(t,n)}}(this)),this._currentFocusPath[0]!==this.canvasElement)throw new Error("root focusPath should be canvas (internal error - it should be impossible for this to happen)");return this._currentFocusPath},PointerEventManager.prototype.blur=function(t){return this.focus(t,[this.canvasElement])},PointerEventManager.prototype.focus=function(t,e){return e&&(h(e)||(e=r(e)),g(e)._focusDomElement()),this._updateFocusedPath(t,null!=e?e:[this.canvasElement])},PointerEventManager.prototype.updateMousePath=function(){var t,e;if(t=this.mouse,0===this.numActivePointers&&this.getHasMouseCursor())return this._currentMousePath=v(this._currentMousePath,this.pointerElementPath(t),(e=this,function(n){return e.queueOutEvents(t,n)}),function(e){return function(n){return e.queueInEvents(t,n)}}(this),function(t){return function(e){return t.updateCursor(e)}}(this))},PointerEventManager.prototype.pointerDown=function(t,e,n){var i,r,o,s,l,u;if(i=0===this.numActivePointers?"pointerDown":"pointerAdd",d(i,t),this.addActivePointer(l=new a(this,t,e)),1===this.numActivePointers||null==this._pointerFocusPath){for(this._capturingElement=null,this._pointerFocusPath=this.pointerElementPath(l),r=!0,o=0,s=(u=this._pointerFocusPath).length;o<s;o++)if(u[o].noFocus){r=!1;break}r&&this.focus(l,this._pointerFocusPath)}return this.queuePointerEvents(i,l,n)},PointerEventManager.prototype.pointerUp=function(t,e){var n,i;if(c.flushEpochNow(),n=1===this.numActivePointers?"pointerUp":"pointerRemove",d(n,t),i=this.getActivePointer(t))return this.queuePointerUpInAndOutsideEvents(i,e),this.queuePointerEvents(n,i,e),i.stayedWithinDeadzone&&(this.queuePointerEvents("pointerClick",i,e),c.flushEpochNow()),this.removeActivePointer(i)},PointerEventManager.prototype.mouseWheel=function(t,e){return this.queueMouseEvents("mouseWheel",this.mouse,e)},PointerEventManager.prototype.pointerCancel=function(t,e){var n;if(d("pointerCancel",t),n=this.getActivePointer(t))return this.queuePointerEvents("pointerCancel",n,e),this.removeActivePointer(n)},PointerEventManager.prototype.pointerMove=function(t,e,n){var i;if(d("pointerMove",t),(i=this.getActivePointer(t))&&!i.location.eq(e))return this.updateActivePointer(i=i.moved(e)),this.queuePointerMoveInAndOutEvents(i,n),this._doingMultitouchMoveEvents&&this._moveEventOccured?void 0:(this._moveEventOccured=!0,this._doingMultitouchMoveEvents&&(i=this.firstActivePointer),this.queuePointerEvents("pointerMove",i,n))},PointerEventManager.prototype.mouseDown=function(t,e){return this.pointerDown("mousePointer",t,e)},PointerEventManager.prototype.mouseUp=function(t){return this.pointerUp("mousePointer",t),this.updateMousePath()},PointerEventManager.prototype.mouseMove=function(t,e){if(!this.mouse.location.eq(t))return this.mouse=this.mouse.moved(t),this.updateMousePath(),this.numActivePointers>0&&this.pointerMove("mousePointer",t,e),this.queueMouseEvents("mouseMove",this.mouse)},PointerEventManager}()},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PersistantAnimator","floatEq0","absLte","min","float32Eq","abs"],[e,n(382),n(403)],(t,e,n,r,o,s)=>{let a,l,u,c;return a=2,l=15,u=200,c=25,i.defClass(class ScrollElementAnimator extends t{constructor(t,e){super(...arguments),this._scrollElement=e.scrollElement,this._velocity=0,this._springConstant=0,this._frictionConstant=0}},function(t,i,a){this.property("springConstant","frictionConstant","velocity"),this.getter("scrollElement",{tracking:function(){return e(this._frictionConstant)},hasSpring:function(){return!e(this._springConstant)},hasVelocity:function(){return!e(this.velocity)},animatingMemomentum:function(){return this.hasVelocity&&!this.animatingTo},animatingTo:function(){return this.hasSpring&&this.currentValue!==this.toValue},active:function(){return this.hasVelocity||this.animatingTo},velocityIsSlow:function(){return n(this._velocity,60)},scrollPosition:function(){let t;return null!=(t=this.scrollElement.scrollPosition)?t:0},inspectedObjects:function(){return{ScrollElementAnimator:{uniqueId:this.uniqueId,scrollElement:this.scrollElement.inspectedName,velocity:this.velocity,springConstant:this.springConstant,frictionConstant:this.frictionConstant,scrollPosition:this.scrollPosition,currentValue:this.currentValue,toValue:this.toValue,active:this.active}}}}),this.setter({scrollPosition:function(t){return this.scrollElement.scrollPosition=t}}),this.prototype.freeze=function(){return this.active?(this._velocity=this._springConstant=this._frictionConstant=0,this.scrollElement._freeze(),this._deactivate()):void 0},this.prototype.boundSp=function(t){return this.scrollElement.boundSp(t)},this.prototype.addVelocity=function(t){return this.velocity+=t,this.springConstant=0,this.frictionConstant=2,this.scrollPosition+=10},this.prototype.animateToValidScrollPosition=function(t=this.scrollPosition){return this.springConstant=200,this.frictionConstant=25,this.scrollPosition=this._toValue=this.boundSp(t)},this.prototype._stop=function(){return this.velocity=this.springConstant=this.frictionConstant=0,a._stop.apply(this,arguments)},this.prototype.animate=function(){let t,e,n,i,a,l,u,c,h,p;return p=this,t=this.springConstant,e=this.frictionConstant,n=this.tracking,i=this.frameSeconds,a=this.toValue,l=this.currentValue,i=r(i,1/30),n?this.stop():(u=this.velocityIsSlow,c=o(l,this.boundSp(l)),this.hasSpring||c||(e=15),h=this._velocity*-e+(a-l)*t,this._velocity+=h*i,l+=this._velocity*i,this.velocityIsSlow&&(this.hasSpring?1>=s(l-a)&&(l=this.stop()):c?this.stop():this.animateToValidScrollPosition(l)),l)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(352)).addModules({FillElement:n(443),OutlineElement:n(444)})},function(t,e,n){var i,r,o,s,a={}.hasOwnProperty;r=n(160),n(313),i=n(325),o=n(388),r.log,s=r.createWithPostCreate,i.GradientFillStyle,t.exports=s(function(t){var e;function FillElement(){return FillElement.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(FillElement,o),FillElement.virtualProperty({preFilteredBaseDrawArea:function(t){return this.getParent(t).getPreFilteredBaseDrawArea(t)}}),FillElement.prototype.getNormalizedCanvasShadow=function(t){var e;return this.getShadow(t)?FillElement.__super__.getNormalizedCanvasShadow.apply(this,arguments):null!=(e=this.getParent(t))?e.getNormalizedCanvasShadow(t):void 0},e={},FillElement.prototype.drawBasic=function(t,n,i,r){var o,s,a;for(s in"function"==typeof(o=this._parent)._prepareDrawOptions&&o._prepareDrawOptions(this._drawOptions,i,r),this._prepareDrawOptions(e,i,r),e)(a=e[s])&&(this._drawOptions[s]=a);return this._parent.fillShape(t,n,this._drawOptions)},FillElement}())},function(t,e,n){var i,r,o,s,a,l={}.hasOwnProperty,u=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};r=n(160),i=n(313),o=n(388),r.merge,s=r.createWithPostCreate,r.log,a=r.isPlainArray,i.color,i.Color,i.point,i.Point,i.rect,i.Rectangle,i.matrix,i.Matrix,t.exports=s(function(t){var e,n;function OutlineElement(){return OutlineElement.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(OutlineElement,o),e=["butt","round","square"],n=["round","bevel","miter"],OutlineElement.drawAreaProperty({lineWidth:{default:1,validate:function(t){return"number"==typeof t}},lineJoin:{default:"miter",validate:function(t){return u.call(n,t)>=0}},miterLimit:{default:3,validate:function(t){return!t||"number"==typeof t},preprocess:function(t){return null!=t?t:3}}}),OutlineElement.drawProperty({lineCap:{default:"butt",validate:function(t){return u.call(e,t)>=0}},lineDash:{default:null,validate:function(t){return!t||a(t)}},filled:{default:!1}}),OutlineElement.virtualProperty({drawAreaPadding:function(t){var e,n,i,r;return n=(r=this.getState(t))._lineWidth,e=r._lineJoin,i=r._miterLimit,n*("miter"===e?i/2:.5)}}),OutlineElement.prototype.getPreFilteredBaseDrawArea=function(t){return OutlineElement.__super__.getPreFilteredBaseDrawArea.apply(this,arguments).grow(this.getDrawAreaPadding(t))},OutlineElement.getter({cacheable:function(){return this.getHasChildren()}}),OutlineElement.prototype.fillShape=function(t,e,n){return this._filled&&this._parent.fillShape(t,e,n),this._parent.strokeShape(t,e,n)},OutlineElement.prototype._prepareDrawOptions=function(t,e,n){return OutlineElement.__super__._prepareDrawOptions.apply(this,arguments),t.lineWidth=this._lineWidth,t.lineCap=this._lineCap,t.lineJoin=this._lineJoin,t.lineDash=this._lineDash,t.miterLimit=this._miterLimit},OutlineElement}())},function(t,e,n){"use strict";var i,r,o={}.hasOwnProperty;(r=n(160)).log,i=r.Epoch,t.exports=function(t){function IdleEpoch(){return IdleEpoch.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(IdleEpoch,i),IdleEpoch.singletonClass(),IdleEpoch.prototype.queue=function(t){return this.queueItem(t)},IdleEpoch}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f={}.hasOwnProperty;Math.ceil,Math.round,o=(c=n(42)).defineModule,s=c.inspect,u=c.min,c.max,c.bound,c.log,c.createWithPostCreate,l=c.isString,a=c.isNumber,c.isPlainArray,d=c.timeout,r=c.Promise,e=n(96).BaseClass,(h=n(313)).point,h.rect,h.Matrix,h.point0,h.point1,(p=n(325)).isImage,i=p.Bitmap,p.BitmapBase,o(t,function(t){function SourceToBitmapCache(){this._cache={},this._referenceCounts={},this._loaded={}}return function(t,e){for(var n in e)f.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(SourceToBitmapCache,e),SourceToBitmapCache.singletonClass(),SourceToBitmapCache.prototype.get=function(t,e){var n,r;return l(t)?(this._referenceCounts[t]=(this._referenceCounts[t]||0)+1,(n=this._cache)[t]||(n[t]=e||this._get(t).tap((r=this,function(e){return r._loaded[t]=e})))):i.get(t)},SourceToBitmapCache.prototype._get=function(t,e){return null==e&&(e=0),i.get(t).catch((n=this,function(i){var r;if(n._referenceCounts[t]>0)return r=.9*u(30,Math.pow(2,e))+.2*Math.random(),d(1e3*r,function(){if(n._referenceCounts[t]>0)return n._get(t,e+1);throw i});throw i}));var n},SourceToBitmapCache.prototype.loaded=function(t){return this._loaded[t]},SourceToBitmapCache.getter({byteSize:function(){return this.memoryUsage},memoryInfo:function(){return{totalBytes:this.memoryUsage,htmlCanvasBytes:this.htmlCanvasMemoryUsage}},memoryUsage:function(){var t,e,n;for(e in t=0,n=this._loaded)t+=n[e].byteSize;return t},htmlCanvasMemoryUsage:function(){var t,e,n,i;for(e in t=0,n=this._loaded)(null!=(i=n[e])?i._canvas:void 0)&&(t+=i.byteSize);return t}}),SourceToBitmapCache.prototype.temporaryPut=function(t,e,n){return this.get(e,r.resolve(n)),d(t,(i=this,function(){return i.release(e)}));var i},SourceToBitmapCache.prototype.release=function(t){if(l(t)){if(!a(this._referenceCounts[t]))throw new Error("no references for "+t);return 0!==this._referenceCounts[t]&&a(this._referenceCounts[t])?(this._referenceCounts[t]--,0===this._referenceCounts[t]&&(delete this._cache[t],delete this._loaded[t],!0)):console.error("invalid referenceCount: "+s(this._referenceCounts[t])+" for url: "+t)}},SourceToBitmapCache}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R={}.hasOwnProperty;C=n(42),b=C.log,C.inspect,C.nextTick,C.currentSecond,B=C.timeout,C.durationString,F=C.timeStampToPerformanceSecond,C.first,C.wordsArray,I=C.select,w=C.merge,x=C.objectDiff,S=C.isPlainObject,C.clone,m=C.getEnv,C.peek,o=n(390),u=n(412).config,M=m().showPartialDrawAreas,c=n(96).createWithPostCreate,i=n(325).Bitmap,_=r=n(212),g=_.getOrientationAngle,A=_.simpleBrowserInfo,s=r.DomElementFactories.Canvas,(E=n(313)).rgbColor,v=E.hslColor,P=E.point,E.Point,E.rect,E.Rectangle,E.matrix,a=E.Matrix,T=r.Dom,f=T.getDevicePixelRatio,h=T.domElementOffset,k=n(434),l=k.PointerEventManager,k.PointerEvent,k.KeyEvent,y=n(362).globalEpochCycle,p=n(407).DrawEpoch.drawEpoch,d=function(t){var e,n,i,r;return e=t.ctrlKey,n=t.metaKey,i=t.shiftKey,r=t.timeStamp,{ctrlKey:e,metaKey:n,shiftKey:i,time:F(r)}},t.exports=c(function(t){var n,r;function CanvasElement(t){var e;null==t&&(t={}),CanvasElement.__super__.constructor.apply(this,arguments),this._devicePixelsPerPoint=null!=(e=t.pixelsPerPoint)?e:t.disableRetina?1:f(),this._domEventListeners=[],this._drawEpochPreprocessing=[],this._drawEpochQueued=!1,this._documentToElementMatrix=this._elementToDocumentMatrix=this._absToDocumentMatrix=this._documentToAbsMatrix=null,this.pointerEventManager=new l({canvasElement:this}),this._attach(this._getOrCreateCanvasElement(t)),self.canvasElement||(self.canvasElement=this)}return function(t,e){for(var n in e)R.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(CanvasElement,o),CanvasElement.classGetter({devicePixelsPerPoint:function(){return f()}}),CanvasElement.prototype._updateRegistryFromPendingState=function(){return null},CanvasElement.getter("documentToElementMatrix elementToDocumentMatrix absToDocumentMatrix documentToAbsMatrix"),CanvasElement.prototype._getOrCreateCanvasElement=function(t){var e,n,i;if(e=t.canvas,n=t.canvasId,i=t.parentHtmlElement,!t.noHtmlCanvasElement)return this._parentHtmlElement=i||document.getElementById("artDomConsoleArea")||document.body,e||(e=document.getElementById(n))?(this._parentHtmlElement=e.parentElement||this._parentHtmlElement,e):this._createCanvasElement(this._parentHtmlElement)},CanvasElement.prototype._createCanvasElement=function(t){var e;return this._createdHtmlCanvasElement=s({style:w(this.pendingStyle,{position:"absolute",outline:"none",top:"0",left:"0"}),id:"artCanvas"}),this.onNextReady().then((e=this,function(){return t.appendChild(e._createdHtmlCanvasElement)})),this._createdHtmlCanvasElement},CanvasElement.concreteProperty({style:{default:{},validate:function(t){return S(t)},postSetter:function(t,e,n){var i,r,o;return o=this,r=function(t,e){return o._canvas.style[t]=e},i=function(t){return function(e){return t._canvas.style[e]=null}}(this),this._canvas&&x(t,e,r,i,r)}}}),CanvasElement.virtualProperty({parentSizeForChildren:function(t){return this.getParentSize(t)},parentSize:function(t){var n,i,r,o,s,a,l,u,c;return this._canvas?(this._parentHtmlElement&&this._parentHtmlElement!==e.document.body&&(i=(a=this._parentHtmlElement).clientWidth,n=a.clientHeight),s=e.innerWidth,o=e.innerHeight,c=(l=e.screen).width,r=l.height,90===Math.abs(g())&&r>c&&(c=(u=[r,c])[0],r=u[1]),i>0&&n>0?(c=i,r=n):s>0&&o>0&&(c=s,r=o),P(c,r)):P(100)}}),CanvasElement.prototype._domListener=function(t,e,n){return t.addEventListener(e,n),this._domEventListeners.push({target:t,type:e,listener:n})},CanvasElement.prototype.detach=function(){var t;return y.detachCanvasElement(this),this._createdHtmlCanvasElement&&(b("CanvasElement#detach: removing createdHtmlCanvasElement..."),null!=(t=this._createdHtmlCanvasElement.parentElement)&&t.removeChild(this._createdHtmlCanvasElement),this._createdHtmlCanvasElement=null,this._canvas=null,b("CanvasElement#detach: removed createdHtmlCanvasElement.")),this._unregister(),this._detachDomEventListeners()},CanvasElement.prototype._detachDomEventListeners=function(){var t,e,n,i;if(this._eventListenersAttached){for(this._eventListenersAttached=!1,t=0,e=(i=this._domEventListeners).length;t<e;t++)(n=i[t]).target.removeEventListener(n.type,n.listener);return this._domEventListeners=[]}},CanvasElement.prototype.isFocused=function(t){return null==t&&(t=this.focusedElement),(!this._canvas||document.hasFocus()&&(document.activeElement===this._canvas||document.activeElement===(null!=t?t._domElement:void 0)))&&this.pointerEventManager.isFocused(t)},CanvasElement.prototype._blur=function(){},CanvasElement.prototype._focus=function(){return this._focusDomElement()},CanvasElement.prototype._focusDomElement=function(){var t;return null!=(t=this._canvas)?t.focus():void 0},CanvasElement.prototype.blur=function(){var t;return null!=(t=this._canvas)&&t.blur(),this._blur()},CanvasElement.getter({focusedElement:function(){return this.pointerEventManager.focusedElement}}),CanvasElement.prototype.blurElement=function(t){return this.pointerEventManager.focus(null,null!=t?t.parent:void 0)},CanvasElement.prototype.focusElement=function(t){return this.pointerEventManager.focus(null,t)},CanvasElement.prototype._saveFocus=function(){return this.pointerEventManager.saveFocus()},CanvasElement.prototype._restoreFocus=function(){return this.pointerEventManager.restoreFocus()},CanvasElement.prototype.enableFileDrop=function(){return window.FileReader?(this._domListener(window,"dragover",(t=this,function(e){return t.routeFileDropEvent(e,"dragOver")})),this._domListener(window,"dragenter",function(t){return function(e){return t.routeFileDropEvent(e,"dragEnter")}}(this)),this._domListener(window,"dragleave",function(t){return function(e){return t.routeFileDropEvent(e,"dragLeave")}}(this)),this._domListener(window,"drop",function(t){return function(e){return t.routeFileDropEvent(e,"drop")}}(this)),this.log(this.className+"#enableFileDrop enabled"),!0):(this.log(this.className+"#enableFileDrop failed - browser not supported"),!1);var t},CanvasElement.prototype.routeFileDropEvent=function(t,e){return"Files"!==t.dataTransfer.types[0]||(t.preventDefault(),this.pointerEventManager.fileDropEvent(e,{locations:[this._domEventLocation(t)],files:t.dataTransfer.files}),!1)},CanvasElement.prototype._needsRedrawing=function(t){return this._addDescendantsDirtyDrawArea(t),CanvasElement.__super__._needsRedrawing.apply(this,arguments),this.queueDrawEpoch()},CanvasElement.prototype._releaseAllCacheBitmaps=function(){},CanvasElement.prototype.queueDrawEpoch=function(){if(!this._drawEpochQueued)return this._drawEpochQueued=!0,p.queueItem((t=this,function(){return t.processEpoch()}));var t},CanvasElement.prototype.queueDrawEpochPreprocessor=function(t){return this._drawEpochPreprocessing.push(t),this.queueDrawEpoch()},CanvasElement.prototype.processEpoch=function(){var t,e,n;if(this._drawEpochQueued=!1,this._drawEpochPreprocessing.length>0)for(n=this._drawEpochPreprocessing,this._drawEpochPreprocessing=[],t=0,e=n.length;t<e;t++)(0,n[t])();return this.drawOnBitmap()},CanvasElement.setter({cssCursor:function(t){var e;if(null==t&&(t=null),t!==this._cssCursor)return null!=(e=this._canvas)&&(e.style.cursor=t),this._cssCursor=t}}),CanvasElement.getter({inspectedObjects:function(){return{CanvasElement:{currentSize:this.currentSize,canvasBitmap:this.canvasBitmap}}},canvasByteSize:function(){return this.canvasBitmap.byteSize},htmlCanvasElement:function(){return this._canvas},numActivePointers:function(){return this.pointerEventManager.getNumActivePointers()},focusPath:function(){return this.pointerEventManager.currentFocusPath},cacheable:function(){return!1},canvasElement:function(){return this},cssCursor:function(){return this._cssCursor},windowScrollOffset:function(){return P(window.scrollX,window.scrollY)},geometry:function(){return{size:this.size,scale:this.scale,absToElementMatrix:this.absToElementMatrix,elementToAbsMatrix:this.elementToAbsMatrix,documentToElementMatrix:this.documentToElementMatrix,elementToDocumentMatrix:this.elementToDocumentMatrix,documentToAbsMatrix:this.documentToAbsMatrix,absToDocumentMatrix:this.absToDocumentMatrix,parentToElementMatrix:this.parentToElementMatrix,elementToParentMatrix:this.elementToParentMatrix}},canvasInnerSize:function(){return P(this._fullPageWidth?window.innerWidth:this._canvas.clientWidth,this._fullPageHeight?window.innerHeight:this._canvas.clientHeight)}}),CanvasElement.prototype._attach=function(t){var e;if(y.attachCanvasElement(this),this.onNextReady((e=this,function(){return e._register()})),this._canvas=t,t)return this._updateCanvasGeometry(),this._attachDomEventListeners()},CanvasElement.prototype._sizeChanged=function(t,e){return CanvasElement.__super__._sizeChanged.apply(this,arguments),this._pointSize=t,this._canvas.style.width=t.x+"px",this._canvas.style.height=t.y+"px",this._pixelSize=this._pointSize.mul(this._devicePixelsPerPoint),this._canvas.setAttribute("width",this._pixelSize.x),this._canvas.setAttribute("height",this._pixelSize.y),this._updateDocumentMatricies(),this._bitmapFactory=this.canvasBitmap=new i(this._canvas,{alpha:!1}),this.queueDrawEpoch()},CanvasElement.prototype._setElementToParentMatrixFromLayoutXY=function(t,e){var n,i,r;if(!this._locationLayoutDisabled)return n=this._getElementToParentMatrixForXY(!0,t,e,1),null!=(i=this._canvas)&&(i.style.left=n.locationX+"px"),null!=(r=this._canvas)&&(r.style.top=n.locationY+"px"),n=this._getElementToParentMatrixForXY(!0,t,e).withLocation(0),this._pendingState._elementToParentMatrix.eq(n)?void 0:(this._pendingState._elementToParentMatrix=n,this._elementChanged())},CanvasElement.prototype._updateCanvasGeometry=function(t){var e;if(null==t&&(t=3),this._updateDocumentMatricies(),this._layoutPropertyChanged(),this._elementChanged(),t>0)return B({1:1e3,2:100,3:10}[t],(e=this,function(){return e._updateCanvasGeometry(t-1)}))},CanvasElement.prototype._updateDocumentMatricies=function(){var t,e,n,i;if(e=(n=h(this._canvas)).left,i=n.top,!(t=a.translateXY(e,i)).eq(this._elementToDocumentMatrix))return this._elementToDocumentMatrix=t,this._documentToElementMatrix=this._elementToDocumentMatrix.inv,this._documentToAbsMatrix=this._documentToElementMatrix.scale(this._devicePixelsPerPoint),this._absToDocumentMatrix=this._documentToAbsMatrix.inv,this._parentToElementMatrix=this._absToElementMatrix=this._absToDocumentMatrix.mul(this._documentToElementMatrix),this._elementToParentMatrix=this._elementToAbsMatrix=this._absToElementMatrix.inv,this.scale=this._devicePixelsPerPoint,this.queueEvent("documentMatriciesChanged")},CanvasElement.prototype._domEventLocation=function(t){var e;return e=this.getWindowScrollOffset(),this._documentToAbsMatrix.transformXY(t.clientX+e.x,t.clientY+e.y)},CanvasElement.prototype._attachResizeListener=function(){return this._domListener(window,"resize",(t=this,function(e){return t._updateCanvasGeometry(),y.processEpoch()}));var t},CanvasElement.prototype._attachBlurFocusListeners=function(){var t;return this._domListener(this._canvas,"blur",(t=this,function(e){return B(100,function(){if(!t.isFocused())return t._saveFocus(),t.blurElement()})})),this._domListener(this._canvas,"focus",function(t){return function(e){return t._restoreFocus()}}(this))},CanvasElement.prototype._attachPointerMoveListeners=function(){var t;return this._domListener(this._canvas,"mousemove",(t=this,function(e){if(0===t.numActivePointers)return t.mouseMove(t._domEventLocation(e,d(e)))})),this._domListener(window,"mousemove",function(t){return function(e){if(t.numActivePointers>0)return t.mouseMove(t._domEventLocation(e),d(e))}}(this))},CanvasElement.getter({numActivePointers:function(){return this.pointerEventManager.numActivePointers},activePointers:function(){return this.pointerEventManager.activePointers}}),CanvasElement.prototype.mouseDown=function(t,e){return this.pointerEventManager.mouseMove(t,e),this.pointerEventManager.mouseDown(t,e)},CanvasElement.prototype.mouseMove=function(t,e){return this.pointerEventManager.mouseMove(t,e)},CanvasElement.prototype.mouseUp=function(t,e){return this.pointerEventManager.mouseMove(t,e),this.pointerEventManager.mouseUp(e)},CanvasElement.prototype.mouseWheel=function(t,e){return this.pointerEventManager.mouseWheel(t,e)},CanvasElement.prototype.touchDown=function(t,e,n){return this.pointerEventManager.pointerDown(t,e,n)},CanvasElement.prototype.touchMove=function(t,e,n){return this.pointerEventManager.pointerMove(t,e,n)},CanvasElement.prototype.touchUp=function(t,e,n){return this.pointerEventManager.pointerMove(t,e,n),this.pointerEventManager.pointerUp(t,n)},CanvasElement.prototype.touchCancel=function(t,e){return this.pointerEventManager.pointerCancel(t,e)},CanvasElement.prototype.capturePointerEvents=function(t){return this.pointerEventManager.capturePointerEvents(t)},CanvasElement.prototype.pointerEventsCapturedBy=function(t){return this.pointerEventManager.pointerEventsCapturedBy(t)},CanvasElement.prototype._attachPointerButtonListeners=function(){var t;return this._domListener(this._canvas,"mouseover",(t=this,function(e){return t._updateDocumentMatricies()})),this._domListener(this._canvas,"mousedown",function(t){return function(e){if(t._updateDocumentMatricies(),t._restoreFocus(),0===e.button)return e.preventDefault(),t.mouseDown(t._domEventLocation(e),d(e))}}(this)),this._domListener(window,"mouseup",function(t){return function(e){if(0===e.button&&t.pointerEventManager.getActivePointer("mousePointer"))return e.preventDefault(),t.mouseUp(t._domEventLocation(e),d(e))}}(this))},CanvasElement.prototype._handleDomWheelEvent=function(t){return t.preventDefault(),this.mouseWheel(this._domEventLocation(t),w(null,d(t),{deltaMode:function(){switch(t.deltaMode){case 0:return"pixel";case 1:return"line";case 2:return"page"}}()},I(t,"deltaX","deltaY","deltaZ")))},CanvasElement.prototype._attachPointerWheelListeners=function(){return this._domListener(this._canvas,"wheel",(t=this,function(e){return t._handleDomWheelEvent(e)}));var t},CanvasElement.prototype._attachPointerTouchListeners=function(){var t;return this._domListener(this._canvas,"touchstart",(t=this,function(e){var n,i,r,o;for(t._updateDocumentMatricies(),e.preventDefault(),t._restoreFocus(),i=0,r=(o=e.changedTouches).length;i<r;i++)n=o[i],t.touchDown(n.identifier,t._domEventLocation(n),d(e));return null})),this._domListener(this._canvas,"touchmove",function(t){return function(e){var n,i,r,o;for(e.preventDefault(),t.pointerEventManager.startMultitouchMoveEvents(),i=0,r=(o=e.changedTouches).length;i<r;i++)n=o[i],t.pointerEventManager.pointerMove(n.identifier,t._domEventLocation(n),d(e));return t.pointerEventManager.endMultitouchMoveEvents(),null}}(this)),this._domListener(this._canvas,"touchend",function(t){return function(e){var n,i,r,o;for(e.preventDefault(),i=0,r=(o=e.changedTouches).length;i<r;i++)n=o[i],t.touchUp(n.identifier,t._domEventLocation(n),d(e));return null}}(this)),this._domListener(this._canvas,"touchcancel",function(t){return function(e){var n,i,r,o;for(e.preventDefault(),i=0,r=(o=e.changedTouches).length;i<r;i++)n=o[i],t.touchCancel(n.identifier,d(e));return null}}(this))},CanvasElement.prototype.queueKeyEvents=function(t,e){return this.pointerEventManager.queueKeyEvents(t,e)},CanvasElement.prototype.keyDownEvent=function(t){return this.queueKeyEvents("keyDown",t),this.queueKeyEvents("keyPress",t)},CanvasElement.prototype.keyUpEvent=function(t){return this.queueKeyEvents("keyUp",t)},CanvasElement.prototype._attachKeypressListeners=function(){var t;return this._domListener(this._canvas,"keydown",(t=this,function(e){if(t.keyDownEvent(e),"Backspace"===e.key)return e.preventDefault()})),this._domListener(this._canvas,"keyup",function(t){return function(e){return t.keyUpEvent(e)}}(this))},CanvasElement.prototype._enableHtmlFocusOnCanvas=function(){if(!A.touch)return this._canvas.tabIndex="-1",this._canvas.contentEditable=!0},CanvasElement.prototype._attachDomEventListeners=function(){if(!this._eventListenersAttached)return this._eventListenersAttached=!0,this._enableHtmlFocusOnCanvas(),this._attachBlurFocusListeners(),this._attachPointerMoveListeners(),this._attachPointerTouchListeners(),this._attachPointerButtonListeners(),this._attachPointerWheelListeners(),this._attachResizeListener(),this._attachKeypressListeners()},n=function(){return M||u.showPartialDrawAreas},r=0,CanvasElement.prototype.drawOnBitmap=function(){var t,e,i,r,s;if(o.resetStats(),this.canvasBitmap)if(u.partialRedrawEnabled&&this._dirtyDrawAreas)for(e=0,r=(s=this._dirtyDrawAreas).length;e<r;e++)t=s[e],i=this.canvasBitmap.openClipping(t.mul(this._devicePixelsPerPoint)),CanvasElement.__super__.drawOnBitmap.call(this,this.canvasBitmap,this.elementToParentMatrix),this.canvasBitmap.closeClipping(i);else CanvasElement.__super__.drawOnBitmap.call(this,this.canvasBitmap,this.elementToParentMatrix);return n()&&this._drawPartialDrawAreas(),this._redrawAll=!1,this._dirtyDrawAreas=null},CanvasElement.prototype._drawPartialDrawAreas=function(){var t,e,i,o,s,a,l,u,c,h,p;for(u=n(),l=[],e=0,i=(o=this._dirtyDrawAreas||[this.drawArea]).length;e<i;e++)t=o[e],c={color:v(++r%36/36,1,(p="full"===u)?1:.8,p?1/3:1)},h=t.mul(this._devicePixelsPerPoint),"log"===u&&b(t.toString()+" ("+t.area+" pixels)"),p?l.push(null!=(s=this.canvasBitmap)?s.drawRectangle(null,h,c):void 0):l.push(null!=(a=this.canvasBitmap)?a.drawBorder(null,h,c):void 0);return l},CanvasElement}())}).call(this,n(5))},function(t,e,n){(t.exports=n(349)).addModules({FlexLayout:n(375),FlowLayout:n(378),Infinity:n(376),LayoutTools:n(377),StateEpochLayout:n(374)})},function(t,e,n){(t.exports=n(357)).addModules({SynchronizedDomOverlay:n(450),TextInputElement:n(451)})},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c,h,p={}.hasOwnProperty;s=n(160),i=n(313),o=n(390),h=s.timeout,s.log,l=s.merge,s.inspect,a=s.float32Eq,c=i.rect,i.point1,i.point,u=i.point0,r=s.Browser.DomElementFactories.Div,t.exports=function(t){function SynchronizedDomOverlay(t){null==t&&(t={}),this._attachedToCanvasElement=null,this._updateQueued=!1,this.setDomElement(t.domElement),SynchronizedDomOverlay.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(SynchronizedDomOverlay,o),SynchronizedDomOverlay.getter({domElement:function(){return this._domElement},domElementFocused:function(){return e.document.activeElement===this._domElement}}),SynchronizedDomOverlay.setter({domElement:function(t){return this._detachDomElement(),this._domElement=t,this._domElement.style.position="absolute",this._domElement.style.top="0",this.onNextReady((e=this,function(){return e._attachDomElement()}));var e}}),SynchronizedDomOverlay.concreteProperty({captureWheelEvents:{preprocess:function(t){return!!t},default:!1}}),SynchronizedDomOverlay.prototype.preprocessEventHandlers=function(t){return SynchronizedDomOverlay.__super__.preprocessEventHandlers.call(this,l(t,{rootElementChanged:(e=this,function(t){return e._rootElementChanged(t)})}));var e},SynchronizedDomOverlay.prototype._rootElementChanged=function(t){return this.onNextReady((e=this,function(){return e._attachDomElement()}));var e},SynchronizedDomOverlay.prototype._unregister=function(){return SynchronizedDomOverlay.__super__._unregister.apply(this,arguments),this._detachDomElement()},SynchronizedDomOverlay.prototype._queueUpdate=function(){var t;if(!this._updateQueued&&this._attachedToCanvasElement)return this._updateQueued=!0,this.onNextReady((t=this,function(){return t._updateQueued=!1,t._updateDomLayout(),t._queueUpdate()}),!1)},SynchronizedDomOverlay.prototype._updateDomLayout=function(){var t,e,n,i,r,o,s,l,c,p,d,f,m,g;if(this._shouldAttachDomElement){if(!("undefined"!=typeof canvasElement&&null!==canvasElement&&null!=(l=canvasElement.htmlCanvasElement)?l.parentElement:void 0))return h(50,(g=this,function(){return g._updateDomLayout()})),null;this._attachDomElementNow()}if(this._attachedToCanvasElement!==(o=this.getCanvasElement())&&this._attachDomElement(o),this._attachedToCanvasElement)return i=(c=this._attachedToCanvasElement).elementToDocumentMatrix,c.htmlCanvasElement,n=this.clippedDrawAreaInAncestor.roundOut(),r=this.getElementToElementMatrix(this._attachedToCanvasElement),d=this.getPaddedSize(),s=this.getAbsOpacity(),t=(p=i.transform(u)).x,e=p.y,this._domElementWrapper.style.top=e+n.top+"px",this._domElementWrapper.style.left=t+n.left+"px",this._domElementWrapper.style.width=n.w+"px",this._domElementWrapper.style.height=n.h+"px",this._domElementWrapper.style.display=0===s?"none":"block",this._domElement.style.opacity=s,this._domElement.style.left=this.domLeftDelta+r.getLocationX()-n.left+"px",this._domElement.style.top=this.domTopDelta+r.getLocationY()-n.top+"px",this._domElement.style.width=this.domWidthDelta+d.x+"px",this._domElement.style.height=this.domHeightDelta+d.y+"px",f=r.getScaleX(),m=r.getScaleY(),this._domElement.style.transform=a(f,1)&&a(m,1)?"none":(this._domElement.style["transform-origin"]="left top","scale("+f+", "+m+")")},SynchronizedDomOverlay.getter({domLeftDelta:function(){return 0},domTopDelta:function(){return 0},domHeightDelta:function(){return 0},domWidthDelta:function(){return 0}}),SynchronizedDomOverlay.prototype.getSizeAffectsDrawArea=function(){return!0},SynchronizedDomOverlay.prototype._computeElementSpaceDrawArea=function(t){return c(this.currentSize)},SynchronizedDomOverlay.prototype._focusDomElement=function(){var t;if(!this.domElementFocused)return null!=(t=this._domElement)?t.focus():void 0},SynchronizedDomOverlay.prototype._blurDomElement=function(){var t;if(this.domElementFocused)return null!=(t=this._domElement)?t.blur():void 0},SynchronizedDomOverlay.prototype._attachDomElement=function(){var t;if(this.isRegistered){if(t=this.getCanvasElement(),this._attachedToCanvasElement){if(t===this._attachedToCanvasElement)return;this._detachDomElement()}return t&&(this._attachedToCanvasElement=t,this._shouldAttachDomElement=!0,this._updateDomLayout(),this._queueUpdate()),this._layoutPropertyChanged()}},SynchronizedDomOverlay.prototype._attachDomElementNow=function(){var t,e,n,i,o,s,a;return this._shouldAttachDomElement=!1,o=(i=(e=this._attachedToCanvasElement.htmlCanvasElement).style).top,n=i.left,s=i.width,t=i.height,e.parentElement.appendChild(this._domElementWrapper=r({style:{top:o,left:n,width:s,height:t,overflow:"hidden",position:"absolute"}},this.captureWheelEvents?{on:{wheel:(a=this,function(t){return a.canvasElement._handleDomWheelEvent(t)})}}:void 0,this._domElement)),this.queueEvent("domElementAttached")},SynchronizedDomOverlay.prototype._detachDomElement=function(){var t,e;if(this._attachedToCanvasElement)return this._shouldAttachDomElement=!1,null!=(t=this._domElementWrapper)&&null!=(e=t.parentElement)&&e.removeChild(this._domElementWrapper),this._domElementWrapper=null,this._attachedToCanvasElement=null},SynchronizedDomOverlay}()}).call(this,n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x={}.hasOwnProperty;l=(y=n(42)).defineModule,h=y.log,f=y.object,d=y.merge,y.select,y.inspect,y.wordsArray,w=y.timeout,p=y.max,c=y.isNumber,v=n(313),b=v.rgbColor,m=v.point,g=v.rect,e=n(417).Layout,a=e.defaultLayoutOptions.leading,i=n(160),u=i.Browser.iOSDetect,i.Browser.Dom.createElementFromHtml,S=i.Browser.DomElementFactories,s=S.TextArea,r=S.Input,o=n(450),l(t,function(t){var e,n;function TextInputElement(t){var i,o,l,u,c,p,f;null==t&&(t={}),this._focusEventsDisabled=!1,l=d({placeholder:t.placeholder||"",type:t.type,maxlength:t.maxLength||t.maxlength,autocapitalize:n(null!=(u=t.autoCapitalize)?u:t.autocapitalize),autocomplete:n(null!=(c=t.autoComplete)?c:t.autocomplete),autocorrect:n(null!=(p=t.autoCorrect)?p:t.autocorrect),spellcheck:null!=t.spellcheck?""+!!t.spellcheck:void 0}),i=(o=this.isTextarea="textarea"===l.type)?(delete l.type,s):(l.type||(l.type="text"),r),t.domElement=i(l,t.attrs,t.style,{value:t.value||"",style:{resize:"none",backgroundColor:"transparent",border:"0px",color:b(t.color||"black").toString(),fontFamily:t.fontFamily||"Arial",fontSize:(t.fontSize||e)+"px",margin:"0",outline:"0",padding:"0",textAlign:t.align||"left",verticalAlign:"bottom",lineHeight:(100*(t.leading||a)|0)+"%"},on:d({cut:(f=this,function(t){return f.delayedCheckIfValueChanged()}),paste:function(t){return function(e){return t.delayedCheckIfValueChanged()}}(this),drop:function(t){return function(e){return t.delayedCheckIfValueChanged()}}(this),keydown:function(t){return function(e){var n;return t.delayedCheckIfValueChanged(),null!=(n=t.getCanvasElement())?n.keyDownEvent(e):void 0}}(this),keyup:function(t){return function(e){var n;return null!=(n=t.getCanvasElement())?n.keyUpEvent(e):void 0}}(this),change:function(t){return function(e){return t.checkIfValueChanged()}}(this),input:function(t){return function(e){return t.checkIfValueChanged()}}(this),select:function(t){return function(e){return t.queueEvent("selectionChanged")}}(this),focus:function(t){return function(e){if(t._safeToProcessFocusEvents())return t.scrollOnScreen(),t._canvasElementToFocusOnBlur=t.getCanvasElement(),t._focus()}}(this),blur:function(t){return function(e){if(t._safeToProcessFocusEvents())return t._canvasElementToFocusOnBlur&&w(0,function(){if(document.body===document.activeElement)return t._canvasElementToFocusOnBlur._focusDomElement()}),t._blur(),w(100,function(){var e;try{if((null!=(e=t.canvasElement)?e.focusedElement:void 0)===t)return t.focused||t.canvasElement._saveFocus(),t.canvasElement.blurElement()}catch(t){return h({TextInputElement:{blurHandler:{error:t}}})}})}}(this),wheel:o?void 0:function(t){return function(e){return t.canvasElement._handleDomWheelEvent(e)}}(this)})}),TextInputElement.__super__.constructor.apply(this,arguments),this.willConsumeKeyboardEvent={order:"beforeAncestors",allowBrowserDefault:!0},this.lastValue=this.value}return function(t,e){for(var n in e)x.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TextInputElement,o),e=16,TextInputElement.concreteProperty({leading:{preprocess:function(t){return c(t)?t:a},postSetter:function(t){var e;return null!=(e=this.domElement)?e.style.lineHeight=(100*t|0)+"%":void 0}},placeholder:{postSetter:function(t){var e;return null!=(e=this.domElement)?e.placeholder=null!=t?t:"":void 0}},maxLength:{postSetter:function(t){var e;return null!=(e=this.domElement)?e.maxLength=null!=t?t:null:void 0}},fontFamily:"sans-serif",postSetter:function(t){var e;return null!=(e=this.domElement)?e.fontFamily=null!=t?t:"sans-serif":void 0},align:{preprocess:function(t){var e;switch(t){case"left":case"center":case"right":return t;case null:case void 0:return"left";default:return(e=m(t).x)<.25?"left":e>.75?"right":"center"}},postSetter:function(t){var e;return null!=(e=this.domElement)?e.style.textAlign=t:void 0}},fontSize:{validate:function(t){return t>0},default:e,postSetter:function(t){var n;return null!=(n=this.domElement)?n.fontSize=(t||e)+"px":void 0}},color:{postSetter:function(t){var e;return null!=(e=this.domElement)?e.color=b(t||"black").toString():void 0}}}),n=function(t){return null!=t?t||"off":void 0},function(t){return f(t,{when:function(t){return null!=t},with:function(t,e){return function(n){var i;try{return t(n)}catch(t){return i=t,h.error({message:"Error in TextInputElement handler: "+e,error:i}),null}}}})},TextInputElement.prototype.nonChildrenLayoutFirstPass=function(){return m(this.domElement.scrollWidth,p(.75*this.getPendingFontSize(),this.value.length>0&&this.isTextarea?(this.domElement.style.height="0",this.domElement.scrollHeight-this.domHeightDelta):0))},TextInputElement.prototype._safeToProcessFocusEvents=function(){return!this._focusEventsDisabled&&(this._focusEventsDisabled=!0,w(100,(t=this,function(){return t._focusEventsDisabled=!1})),!0);var t},TextInputElement.prototype.preprocessEventHandlers=function(t){return d(TextInputElement.__super__.preprocessEventHandlers.apply(this,arguments),{focus:(e=this,function(n){return e._focusDomElement(),"function"==typeof t.focus?t.focus(n):void 0}),blur:function(e){return function(n){return e._blurDomElement(),"function"==typeof t.blur?t.blur(n):void 0}}(this),keyPress:function(e){return function(n){var i;if("function"==typeof t.keyPress&&t.keyPress(n),"Enter"===(i=n.props).key&&e.handleEvent("enter",d(i,{value:e.value})),"Escape"===i.key)return e.handleEvent("escape",d(i,{value:e.value}))}}(this)});var e},TextInputElement.prototype._unregister=function(){var t;return null!=(t=this._canvasElementToFocusOnBlur)&&t._focusDomElement(),TextInputElement.__super__._unregister.apply(this,arguments)},TextInputElement.prototype.delayedCheckIfValueChanged=function(){return w(0,(t=this,function(){return t.checkIfValueChanged()}));var t},TextInputElement.prototype.checkIfValueChanged=function(){if(this.lastValue!==this.value)return this.size.childrenRelative&&this._layoutPropertyChanged(),this.lastValue=this.value,this.queueEvent("valueChanged",{value:this.value,lastValue:this.lastValue})},TextInputElement.getter({domTopDelta:function(){return this.fontSize*(this.isTextarea?-.16279:-.3)},domHeightDelta:function(){return this.isTextarea?.25*this.fontSize-this.domTopDelta:.7*this.fontSize}}),TextInputElement.prototype._computeElementSpaceDrawArea=function(){var t,e,n,i,r;return n=(t=this.getState()._currentSize).w,e=t.h,i=r=0,r+=this.domTopDelta,e+=this.domHeightDelta,this.isTextarea&&(e+=.25*this.fontSize),g(i,r,n,e)},TextInputElement.virtualProperty({value:{getter:function(t){return this.domElement.value},setter:function(t){if(t=null!=t?""+t:"",this.domElement.value!==t)return this._elementChanged(!0),this.lastValue=t,this.domElement.value=t}},color:{getter:function(){return b(this.domElement.style.color)},setter:function(t){return self.domElement=this.domElement,this.domElement.style.color=b(t).toString()}}}),TextInputElement.prototype.selectAll=function(){return this.domElement.select()},TextInputElement.prototype.copy=function(){var t,e,n,i,r,o;return e=this.domElement,u()?(i=e.readOnly,t=e.contentEditable,e.contentEditable=!0,e.readOnly=!1,(n=document.createRange()).selectNodeContents(e),(o=window.getSelection()).removeAllRanges(),o.addRange(n),e.setSelectionRange(0,999999),r=document.execCommand("copy"),e.contentEditable=t,e.readOnly=i,o.removeAllRanges(),e.blur(),r):(e.select(),document.execCommand("copy"))},TextInputElement.getter({selectionStart:function(){return this.domElement.selectionStart},selectionEnd:function(){return this.domElement.selectionEnd}}),TextInputElement.setter({selectionStart:function(t){return this.domElement.selectionStart=t},selectionEnd:function(t){return this.domElement.selectionEnd=t}}),TextInputElement.prototype.moveCursorToEnd=function(){return this.selectionEnd=this.selectionStart=this.domElement.value.length},TextInputElement.prototype.insertAtCursor=function(t){var e,n,i,r;return this.domElement.selectionStart||"0"===this.domElement.selectionStart?(r=(e=this.domElement).value,i=e.selectionStart,n=e.selectionEnd,this.domElement.value=r.substring(0,i)+t+r.substring(n,r.length),this.domElement.selectionEnd=this.domElement.selectionStart=i+t.length):this.domElement.value+=t,this.checkIfValueChanged()},TextInputElement}())}).call(this,n(2)(t))},function(t,e,n){(function(e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g;f=n(42),d=f.merge,a=f.Promise,c=f.getEnv,p=f.log,f.isPlainObject,l=n(106).configure,m=(i=n(160).Browser).DomElementFactories,s=m.Meta,o=m.Link,u=i.getDomReadyPromise,r=n(325).FontLoader,g=n(313).rgbColor,h=e.cordova,t.exports=function(){function FullScreenApp(){}return FullScreenApp._domReady=function(){var t;return n(341),t=c(),p("Art.Engine.FullScreenApp options:\n  ?dev=true\n    show DomConsole\n  ?perfGraphs=true\n    show performance graphs"),null==t.dev&&null==t.perfGraphs||(n(453),Neptune.Art.Foundation.DevTools.DomConsole.enable()),p("Art.Engine.FullScreenApp: app ready")},FullScreenApp._setBodyStyles=function(t){var n,i,r;if(t.backgroundColor,e.document&&(n=(r=e.document).body,i=r.documentElement,n.style.padding="0px",n.style.margin="0px",n.style.overflow="hidden",n.style.fontSize="0px",n.style.height="100%",!h))return i.style.height="100%"},FullScreenApp.init=function(t){var e;return null==t&&(t={}),l(t),e=t.fonts,FullScreenApp.writeDom(t),a.all([a.resolve(e&&r.loadFonts(e)),u().then(function(){return FullScreenApp._domReady(),FullScreenApp._setBodyStyles(t)})])},FullScreenApp.writeDom=function(t){var e,n,i,r,a,l,u,c,p,f,m,y,v,S,b,w,x,P,C;for(p in m=t.noDocumentWrite,C=t.title,P=t.styleSheets,w=t.scripts,c=t.meta,l=t.link,u=t.manifest,e=t.backgroundColor,document.title=C||"Art App",w||(w=[]),P||(P=[]),S=function(){var t,e,n;for(n=[],t=0,e=w.length;t<e;t++)(b=w[t])&&n.push("<script type='text/javascript' src='"+b+"'><\/script>");return n}(),"\n    ",f=d({viewport:"user-scalable=no, width=device-width, initial-scale=1.0, viewport-fit=cover","mobile-web-app-capable":"yes","apple-touch-fullscreen":"yes","apple-mobile-web-app-capable":"yes","apple-mobile-web-app-status-bar-style":"black","format-detection":"telephone=no"},c),document.head.appendChild(s({charset:"utf-8"})),document.head.appendChild(s({"http-equiv":"X-UA-Compatible",content:"IE=edge,chrome=1"})),f)n=f[p],document.head.appendChild(s({name:p,content:n}));for(i=0,a=P.length;i<a;i++)x=P[i],document.head.appendChild(o({rel:"stylesheet",href:x}));for(v in y=l||{})r=y[v],document.head.appendChild(o({rel:v},r));return!m&&document.write("<html "+(u?"manifest='"+u+"'":"")+">\n\n  <style>\n    "+(h?"":"html {height: 100%;}")+"\n    body {\n      padding: 0px;\n      margin: 0px;\n      background-color: "+g(e||"#eee")+";\n      overflow: hidden;\n      font-size: 0px;\n      height: 100%;\n    }\n  </style>\n\n  <body>\n    "+S.join("\n    ")+"\n  </body>\n</html>")},FullScreenApp}()}).call(this,n(5))},function(t,e,n){t.exports=n(454)},function(t,e,n){(t.exports=n(455)).includeInNamespace(n(459)).addModules({Chart:n(469),Console:n(460),Images:n(468),ToolBar:n(465)}),n(466)},function(t,e,n){t.exports=n(456).addNamespace("DomConsole",class DomConsole extends Neptune.PackageNamespace{}),n(458)},function(t,e,n){t.exports=n(162).addNamespace("DevTools",class DevTools extends Neptune.PackageNamespace{}),n(455),n(457)},function(t,e,n){t.exports=n(456).addNamespace("Webpack",class Webpack extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(455).addNamespace("PseudoReact",class PseudoReact extends Neptune.PackageNamespace{})},function(t,e,n){var i,r,o=[].slice;i=n(160),r=n(460).console,t.exports=[{enable:function(){return i.Log.alternativeLogger=r,this.enabled=!0,r.show()},disable:function(){return this.enabled=!1,i.Log.alternativeLogger=null,r.hide(),r.reset()},hide:function(){return r.hide()},show:function(){return r.show()},reset:function(){return r.reset()},increaseWidth:function(){return r.increaseWidth()},decreaseWidth:function(){return r.decreaseWidth()},foo:function(){return"foo"},getShown:function(){return null!=r?r.getShown():void 0},logCore:function(){var t;return(t=r.logCore).call.apply(t,[r].concat(o.call(arguments)))},logF:function(){var t;return(t=r.logF).call.apply(t,[r].concat(o.call(arguments)))},log:function(){var t;return(t=r.log).call.apply(t,[r].concat(o.call(arguments)))}}]},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W={}.hasOwnProperty,j=[].slice;self.document&&n(461),s=n(160),i=n(313),p=n(465),_=i.isColorOrColorString,D=i.rgbColor,i.Color,i.point,i.point0,r=s.BaseObject,s.inspect,s.clone,A=s.merge,F=s.nextTick,N=s.timeout,w=s.flatten,s.isArray,M=s.isString,s.isFunction,T=s.isNumber,y=s.createWithPostCreate,f=s.colorRegExp,c=s.Promise,g=s.containsPromises,v=s.deepAll,U=s.toInspectedObjects,k=s.isPlainArray,I=s.isPlainObject,x=s.hasProperties,B=s.objectKeyCount,a=s.InspectedObjectLiteral,s.deepEach,s.deepMap,C=s.inspectLean,S=s.escapeJavascriptString,b=s.findColorRegExp,z=n(468),m=z.containsImages,L=z.resolveImages,E=z.isHTMLImageElement,P=z.imgToDom,O=s.Browser.DomElementFactories,o=O.Div,u=O.Pre,h=O.Span,O.Img,l=O.Li,d=O.Ul,R=function(t){return 1===t.length?t[0]:t},t.exports=y(function(t){var e,n,i,s,y;function Console(){window.domConsole=this,this._width=500,this.initDom()}return function(t,e){for(var n in e)W.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Console,r),Console.singletonClass(),Console.postCreate=function(){return self.domConsole=this.singleton,Console.__super__.constructor.postCreate.apply(this,arguments)},Console.prototype.reset=function(){return this.domContainer.innerHTML=""},Console.prototype.hide=function(){return this.domConsoleParent.style.display="none"},Console.prototype.show=function(){return this.domConsoleParent.style.display="block"},Console.prototype.increaseWidth=function(){return this.width+=25},Console.prototype.decreaseWidth=function(){return this.width-=25},Console.getter({shown:function(){return"block"===this.domContainer.style.display}}),y=function(t){var e,n,i;for(e=0,n=(i=t.parentElement.children).length;e<n;e++)i[e].style.display="block";return t.style.display="none"},Console.setter({width:function(t){return this._width=t,this.domConsoleParent.style.width=t+"px"}}),Console.getter("width"),Console.prototype.initDom=function(){var t,e,n,i,r,s;if(s=document.getElementById("mocha"),t=function(){var t,n,i,r;for(r=[],t=0,n=(i=document.body.childNodes).length;t<n;t++)e=i[t],r.push(e);return r}(),document.body.appendChild(o(null,o({style:{display:"flex",flexDirection:"row",position:"fixed",left:"0",right:"0",top:"0",bottom:"0"}},o({id:"artDomConsoleArea",style:{flex:"1 1 auto",overflow:"scroll"}},t),this.domConsoleParent=o({style:{overflow:"auto",backgroundColor:"white",top:"0",bottom:"0",paddingTop:"25px",flex:"0 0 auto",width:this._width+"px",borderLeft:"1px solid #aaa"}},this.domContainer=o({class:"domConsole",style:{padding:"5px"},on:{click:function(t){var e,n;for(n=t.target,e=[];n;){if(n.className.match("collapsable")){y(n);break}e.push(n=n.parentElement)}return e}}}))),p())),s)return r=8,i=function(){var t;if(r--)return n*=2,(t=document.getElementById("mocha-stats"))?t.style.position="relative":(console.log("domConsoleMocha fixMochaStats... (waiting "+n+"ms for #mocha-stats div to appear: "+r+")"),N(n,i));console.log("domConsoleMocha fixMochaStats... giving up; sorry for the ugly screen")},N(n=62.5,i)},Console.prototype.appendLog=function(t){return this.domContainer.appendChild(o({class:"logLine"},t)),F((e=this,function(){return e.domConsoleParent.scrollTop=e.domConsoleParent.scrollHeight}));var e},Console.prototype.log=function(){var t;return t=1<=arguments.length?j.call(arguments,0):[],this.logCore(R(t)),t[t.length-1]},Console.prototype.logF=function(t){return this.logCore(t.log,null,null,t),t.log},Console.prototype.format=function(t,e){var n,i,r;return i=e.label,r=e.labelColor,n=e.backgroundColor,i&&(t=o({style:{backgroundColor:n}},o(i,{style:{color:r,fontWeight:"bold"}}),o({style:{paddingLeft:"10px"}},t))),t},Console.prototype.arrayKidsToDomArray=function(t,e,n,i){var r,o,s;return n.maxDepth--,s=function(){var i,s,a;for(a=[],o=i=0,s=t.length;i<s&&(r=t[o],!(o>50));o=++i)50===o?a.push(e({class:"value"},"array length: "+t.length+" (showing the first "+o+")")):a.push(e({class:"value"},this.toDom(r,n)));return a}.call(this),n.maxDepth++,i&&(s=this.addCommasAndBrackets(s,"[","]")),s},Console.prototype.arrayToDomBasic=function(t,e){var n;return 0===e.maxDepth?h({class:"array maxdepth "+e.class},0===t.length?"[]":t.length<=5&&(n=C(t)).length<=30?"["+n+"]":"[... "+t.length+"]"):h({class:"array "+e.class},this.arrayKidsToDomArray(t,h,e,!0))},Console.prototype.arrayToDom=function(t,e){return e.treeView?this.arrayToDomTreeView(t,e):this.arrayToDomBasic(t,e)},Console.prototype.addCommasAndBrackets=function(t,e,n,i){var r,o,s,a;for(r=o=0,a=t.length;o<a;r=++o)s=t[r],r+1<t.length&&s.appendChild(h(", "));return w(e,i,t,n)},Console.prototype.mapKidsToDomArray=function(t,e,n,i){var r,o,s;return n.maxDepth--,o=function(){var i;for(r in i=[],t)s=t[r],i.push(e(null,h({class:"key"},r+": "),h({class:"value"},this.toDom(s,n))));return i}.call(this),n.maxDepth++,i?this.addCommasAndBrackets(o,"{","}"):o},Console.prototype.objectToDomBasic=function(t,e){var n,i,r;return 0===e.maxDepth?(n=0===(r=B(t))?"":r<=5?(i=C(t)).length<=40?i:Object.keys(t).join(" "):""+r,h({class:"object maxdepth "+e.class},"{"+n+"}")):h({class:"object"},this.mapKidsToDomArray(t,h,e,!0))},Console.prototype.treeViewCollapsable=function(t,e){return t[e.collapsed?0:1].style.display="none",t},Console.prototype.arrayToDomTreeView=function(t,e){return 0===t.length?h({class:"array"},"[]"):this.treeViewCollapsable([d({class:"array collapsable open"},this.arrayKidsToDomArray(t,l,e)),d({class:"array collapsable closed"},this.arrayToDomBasic(t,A(e,{maxDepth:1,treeView:!1})))],e)},Console.prototype.objectToDomTreeView=function(t,e){return x(t)?this.treeViewCollapsable([d({class:"object collapsable open"},this.mapKidsToDomArray(t,l,e)),d({class:"object collapsable closed"},this.objectToDomBasic(t,A(e,{maxDepth:1,treeView:!1})))],e):h({class:"object"},"{}")},Console.prototype.objectToDom=function(t,e){return e.treeView?this.objectToDomTreeView(t,e):this.objectToDomBasic(t,e)},e=function(t,e){return(e.match(/\s\s+|\n/)?u:h)({class:t},e)},Console.prototype.literalToDom=function(t){return e("literal",M(t)?S(t):""+t)},Console.prototype.errorLiteralToDom=function(t){return e("errorLiteral",t.toString())},Console.prototype.warningLiteralToDom=function(t){return e("warningLiteral",t.toString())},Console.prototype.colorToDom=function(t){var e,n,i,r;return i=M(n=t)?(e=t.match(b)[0],t=D(e),n):null!=(r="function"==typeof t.inspect?t.inspect():void 0)?r:t.toString(),h({class:"inspected",style:{backgroundColor:t,padding:"0 5px",color:t.perceptualLightness<.8&&t.a>.25?"white":"black"}},""+i)},Console.prototype.toDom=function(t,n){return null==n&&(n={}),null==t?this.literalToDom(t):t instanceof a?_(t.literal)?this.colorToDom(t.literal):t.isError?(console.error(t.literal),this.errorLiteralToDom(t.literal)):t.isWarning?(console.warn(t.literal),this.warningLiteralToDom(t.literal)):e("literal",t.literal):E(t)?P(t):_(t)?this.colorToDom(t):k(t)?this.arrayToDom(t,n):I(t)?this.objectToDom(t,n):this.literalToDom(t)},i=new c.Serializer,n=1,s={},Console.prototype.logCore=function(t,e,r){var o,a,l,h,p;return null==r&&(r=s),o=function(t){var e,n,i,r;return i=t.success,e=t.failure,n=t.pending,r=t.warning,{backgroundColor:function(){switch(!1){case!e:return"#fee";case!r:return"#ffe"}}(),labelColor:function(){switch(!1){case!i:return"green";case!e:return"#a00";case!n:return"blue";case!r:return"#aa0"}}(),label:(i||e||n||r)+": (log #"+l+")"}},l=n,(a=g(t))&&(r=A(r,o({pending:"RESOLVING PROMISES"}))),r.isError&&(r=A(r,o({failure:"ERROR"}))),r.isWarning&&(r=A(r,o({warning:"WARNING"}))),h=i.then((p=this,function(){var e;return r.treeView=!0,e=r.maxDepth,T(e)||(e=20),"string"!=typeof t||f.test(t)?c.then(function(){var e;return m(e=U(t))?L(e):e}).then(function(t){var e;return e=p.toDom(t,r),p.appendLog(p.format(e,r))}):p.appendLog(p.format(u(t),r))})),i.catch(function(t){return console.error("Error in DomConsole.Console",t)}),a&&v(t,function(t){return{"promise.then":t}}).then(function(t){return function(n){return t.logCore(n,e,A(r,o({success:"ALL PROMISES RESOLVED"})))}}(this)).catch(function(t){return function(n){return t.logCore(n,e,A(r,o({failure:"ONE OR MORE PROMISES WERE REJECTED"})))}}(this)),n++,h},Console}())},function(t,e,n){var i=n(462);"string"==typeof i&&(i=[[t.i,i,""]]);var r={insert:"head",singleton:!1};n(464)(i,r);i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(463)(!1)).push([t.i,'@charset "UTF-8";\n.domConsole {\n  }\n  .domConsole img {\n    image-rendering: -moz-crisp-edges;\n    image-rendering: -o-crisp-edges;\n    image-rendering: -webkit-optimize-contrast;\n    image-rendering: crisp-edges;\n    -ms-interpolation-mode: nearest-neighbor;\n    background-image: linear-gradient(-45deg, rgba(255, 255, 255, .9) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .9) 50%, rgba(255, 255, 255, .9) 75%, transparent 75%, transparent);\n    background-color: #ddd;\n    background-size: 50px 50px;\n    border: 1px solid rgba(255, 255, 255, 255);\n  }\n  .domConsole img:hover {\n    border: 1px solid #bbbbbb; }\n  .domConsole ul {\n    list-style-type: none; }\n  .domConsole .collapsable {\n    cursor: pointer;\n    margin: 0;\n    padding: 0;\n    padding-left: 12px;\n    margin-bottom: 5px;\n    position: relative;\n    border-left: 1px solid transparent; }\n    .domConsole .collapsable:before {\n      content: "";\n      position: absolute;\n      left: 2px;\n      top: 0;\n      bottom: 0; }\n    .domConsole .collapsable:hover {\n      border-left: 1px solid #cccc44;\n      border-radius: 5px; }\n  .domConsole .collapsable.closed {\n    overflow: hidden;\n    height: 14px;\n  }\n  .domConsole .collapsable.closed.array:before {\n    content: ""; }\n  .domConsole .collapsable.open.array:before {\n    content: ""; }\n  .domConsole .collapsable.closed.object:before {\n    content: ""; }\n  .domConsole .collapsable.open.object:before {\n    content: ""; }\n  .domConsole pre {\n    margin: 0;\n    color: #555555;\n    font-family: Monaco, monospace; }\n  .domConsole .logLine {\n    font-family: Monaco, monospace;\n    font-size: 11px;\n    color: #aaaaaa;\n    border-right: 2px solid transparent; }\n    .domConsole .logLine .literal {\n      color: green; }\n    .domConsole .logLine .errorLiteral {\n      color: red; }\n    .domConsole .logLine .warningLiteral {\n      color: yellow; }\n    .domConsole .logLine .object .key {\n      color: #bbbb00; }\n    .domConsole .logLine:hover {\n      border-right: 2px solid #e0e0e0; }\n  .domConsole h1 {\n    margin-bottom: 20px;\n    margin-top: 40px; }\n  .domConsole h2 {\n    margin-bottom: 15px;\n    margin-top: 30px; }\n  .domConsole h3 {\n    margin-bottom: 10px;\n    margin-top: 20px; }\n  .domConsole h1 .logLine {\n    font-size: 24px;\n    border-bottom: 4px solid #e0e0e0; }\n  .domConsole h2 .logLine {\n    font-size: 20px;\n    border-bottom: 3px solid #e0e0e0; }\n  .domConsole h3 .logLine {\n    font-size: 16px;\n    border-bottom: 2px solid #e0e0e0; }\n',""])},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function toString(){return this.map(function(e){var n=function cssWithMappingToString(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=function toComment(t){var e=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(n," */")}(i),o=i.sources.map(function(t){return"/*# sourceURL=".concat(i.sourceRoot).concat(t," */")});return[n].concat(o).concat([r]).join("\n")}return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2],"{").concat(n,"}"):n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];null!=o&&(i[o]=!0)}for(var s=0;s<t.length;s++){var a=t[s];null!=a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="(".concat(a[2],") and (").concat(n,")")),e.push(a))}},e}},function(t,e,n){"use strict";var i={},r=function isOldIE(){var t;return function memorize(){return void 0===t&&(t=Boolean(window&&document&&document.all&&!window.atob)),t}}(),o=function getTarget(){var t={};return function memorize(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}();function listToStyles(t,e){for(var n=[],i={},r=0;r<t.length;r++){var o=t[r],s=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};i[s]?i[s].parts.push(a):n.push(i[s]={id:s,parts:[a]})}return n}function addStylesToDom(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=i[r.id],s=0;if(o){for(o.refs++;s<o.parts.length;s++)o.parts[s](r.parts[s]);for(;s<r.parts.length;s++)o.parts.push(addStyle(r.parts[s],e))}else{for(var a=[];s<r.parts.length;s++)a.push(addStyle(r.parts[s],e));i[r.id]={id:r.id,refs:1,parts:a}}}}function insertStyleElement(t){var e=document.createElement("style");if(void 0===t.attributes.nonce){var i=n.nc;i&&(t.attributes.nonce=i)}if(Object.keys(t.attributes).forEach(function(n){e.setAttribute(n,t.attributes[n])}),"function"==typeof t.insert)t.insert(e);else{var r=o(t.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}return e}var s=function replaceText(){var t=[];return function replace(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}();function applyToSingletonTag(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=s(e,r);else{var o=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}var a=null,l=0;function addStyle(t,e){var n,i,r;if(e.singleton){var o=l++;n=a||(a=insertStyleElement(e)),i=applyToSingletonTag.bind(null,n,o,!1),r=applyToSingletonTag.bind(null,n,o,!0)}else n=insertStyleElement(e),i=function applyToTag(t,e,n){var i=n.css,r=n.media,o=n.sourceMap;if(r&&t.setAttribute("media",r),o&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,n,e),r=function remove(){!function removeStyleElement(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function updateStyle(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).attributes="object"==typeof e.attributes?e.attributes:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r());var n=listToStyles(t,e);return addStylesToDom(n,e),function update(t){for(var r=[],o=0;o<n.length;o++){var s=n[o],a=i[s.id];a&&(a.refs--,r.push(a))}t&&addStylesToDom(listToStyles(t,e),e);for(var l=0;l<r.length;l++){var u=r[l];if(0===u.refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete i[u.id]}}}}},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;s=n(160),o=n(455),i=n(466).Component,s.BaseObject,a=s.defineModule,s.wordsArray,l=s.Browser.DomElementFactories,r=l.Div,e=l.A,a(t,function(t){function ToolBar(){return ToolBar.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ToolBar,i),ToolBar.prototype.render=function(){var t;return this.state.shown,r({style:{position:"fixed",top:0,right:0,display:"flex",flexDirection:"row",borderBottom:"1px solid #aaa",borderLeft:"1px solid #aaa",fontSize:"10px",fontFamily:"Arial",justifyContent:"flex-end",backgroundColor:"#f7f3df"}},r({style:{margin:"5px"}},"Art.Foundation.DomConsole"),function(){var n,i,s,a;for(a=[],n=0,i=(s=["reset","show","hide","increaseWidth","decreaseWidth"]).length;n<i;n++)t=s[n],a.push(function(t){return r({style:{margin:"5px"}},e({href:"#",on:{click:function(){return o[t]()}}},t))}(t));return a}.call(this))},ToolBar}())}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(458)).addModules({Component:n(467)})},function(t,e,n){var i,r,o,s,a={}.hasOwnProperty;o=n(160),r=o.Browser.DomElementFactories.Div,o.merge,i=o.BaseObject,s=n(192).createObjectTreeFactory,t.exports=function(t){function Component(t){this.props=null!=t?t:{},this.state=this.getInitialState(),this._pendingState=null}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Component,i),Component.postCreate=function(){return this.toComponentFactory()},Component.toComponentFactory=function(){return s((t=this,function(e,n){return null!=e&&(e.children||(e.children=n)),new t(e).rerender()}));var t},Component.prototype.getInitialState=function(){return{}},Component.prototype.getPendingState=function(){return this._pendingState?this._pendingState:(this._queueApplyPendingState(),this._pendingState={})},Component.prototype._queueApplyPendingState=function(){return setTimeout((t=this,function(){return t._applyPendingState()}),0);var t},Component.prototype._applyPendingState=function(){var t,e,n;for(t in e=this._pendingState)n=e[t],this.state[t]=n;return this.rerender(),this._pendingState=null},Component.prototype._setState=function(t,e){return this.getPendingState()[t]=e},Component.prototype.setState=function(t,e){var n,i,r;if(t.constructor===Object){for(n in i=[],t)r=t[n],i.push(this._setState(n,r));return i}return this._setState(t,e)},Component.prototype.rerender=function(){var t,e;return t=this._rootElement,this._render(),null!=t&&null!=(e=t.parentElement)&&e.replaceChild(this._rootElement,t),this._rootElement},Component.prototype.render=function(){return r()},Component.prototype._render=function(){return this._rootElement=this.render()},Component}()},function(t,e,n){(function(t,e){var n,i,r,o,s,a,l,u,c,h,p,d,f;i=(f=Neptune.Art).Foundation,n=f.Atomic,s=i.deepAll,l=i.deepMap,h=i.isFunction,u=i.defineModule,a=i.deepEach,o=i.Promise,r=i.Browser.DomElementFactories.Img,p=n.point,d=n.point0,c=i.Browser.Dom.getDevicePixelRatio(),u(t,function(){var t,n;function Images(){}return Images.isHTMLImageElement=t=e.HTMLImageElement?function(t){return t instanceof HTMLImageElement}:function(){return!1},Images.isImage=n=function(e){return e&&h(e.toImage)||t(e)},Images.containsImages=function(t){var e;return e=!1,a(t,function(t){return e||(e=n(t))}),e},Images.resolveImages=function(e){return s(l(e,function(e){return n(e)?o.then(function(){return t(e)?e:e.toImage()}).then(function(t){return t.complete?t:new o(function(e){return t.onload=function(){return e(t)}})}):e}))},Images.imgToDom=function(t){var e,n,i,o;return n=p(32),e=p(1024,512).mul(c),o=p(t.width,t.height),i=1/c,o.gte(n)?o.lt(e)||(i*=e.div(o).min()):i*=Math.ceil(n.div(o).min()),r({src:t.src},o.gt(d)?{style:{width:(t.naturalWidth*i|0)+"px",height:(t.naturalHeight*i|0)+"px","image-rendering":"pixelated"}}:void 0)},Images}())}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s,a,l;i=n(313),r=n(160),s=i.point,l=i.rgbColor,a=i.rect,o=i.Matrix,r.inspect,r.log,t.exports=function(){function Chart(){}return Chart.bar=function(t,e){var n,i,r,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I;for(null==e&&(e={}),T=e.range,_=e.pixelsPerPoint||2,d=e.fontSize||10,b=e.margin||(T?1.4*d:0),u=l(e.bgColor||l(1,1,1,0)),c=l(e.chartBgColor||"#fff7f0"),i=l(e.barColor||"rgba(0,0,0,.5)"),I=l(e.textColor||"orange"),x=e.minWidth||50,k=e.size||s(4*t.length,50+2*b),e.barWidth&&(k=k.withX(t.length*e.barWidth)),k.x<x&&(k=k.withX(x)),r=k.x/t.length,p=o.scale(_),(P=new Art.Canvas.Bitmap(k.mul(_))).pixelsPerPoint=_,P.clear(u),h=a(0,b,k.w,k.h-2*b),P.drawRectangle(p,h,c),E=h.left,w=0,g=0,v=t.length;g<v;g++)(m=t[g])>w&&(w=m);for(y=0,S=t.length;y<S;y++)C=(m=t[y])/w,f=h.h*C,n=a(E,h.bottom-f,r,f).round(),P.drawRectangle(p,n,i),E+=r;return T&&(P.drawText(o.translate(0,d).mul(p),"max: "+w,{size:d,color:I}),P.drawText(o.translate(0,k.y).mul(p),T[0],{size:d,color:I}),P.drawText(o.translate(k).mul(p),T[1],{size:d,color:I,align:"right"})),P},Chart}()},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["w","merge","lowerCamelCase","dashCase"],[e,n(42)],(t,r,o,s)=>{let a,l,u,c,h,p,d,f;return a=n(393).PointLayout.pointLayout,l=n(360).NamedElementPropValues.namedSizeLayouts,u=n(313).Point.namedAlignmentPoints,c=t("default pointer allScroll contextMenu help wait progress crosshair cell text verticalText alias copy move noDrop notAllowed zoomIn zoomOut grab grabbing eResize nResize neResize nwResize sResize seResize swResize wResizee wResize nsResize neswResize nwseResize colResize rowResize"),e.artEngineMacros=r(i.object(l,t=>({size:t})),i.object(u,(t,e)=>({location:a(e),axis:t})),i.object(u,(t,e)=>({childrenAlignment:t}),null,null,(t,e)=>o(`children ${i.toString(e)}`)),i.object(u,(t,e)=>({align:t}),null,null,(t,e)=>o(`text ${i.toString(e)}`)),{row:{childrenLayout:"row"},column:{childrenLayout:"column"},flow:{childrenLayout:"flow"},bold:{fontWeight:"bold"},italic:{fontStyle:"italic"},clip:{clip:!0},cacheDraw:{cacheDraw:!0},scaleToFit:{scale:h=function(t,e){return t.minRatio(e)}},scaleToFill:{scale:p=function(t,e){return t.maxRatio(e)}},fitSizeToParentWidth:{size:{ww:1,y:function(t,e){return e.x>0?e.y*t.x/e.x:100}}},scaleFit:{scale:h},scaleFill:{scale:p},fitParent:d={scale:h,location:"centerCenter",axis:"centerCenter"},fillParent:f={scale:p,location:"centerCenter",axis:"centerCenter"},fitIntoParent:d,zoomIntoParent:f},i.object(c,t=>({cursor:s(t)}),null,null,t=>`${i.toString(t)}Cursor`))}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(356)).addModules({StandardImport:n(472),V1CompositeModes:n(473),V1LayoutModes:n(474),V1Loader:n(475),V1Writer:n(483)})},function(t,e,n){var i,r;r=(i=n(382)).merge,t.exports=r(n(360),i)},function(t,e){var n,i;for(i in t.exports=n={0:"normal",1:"add",2:"difference",3:"multiply",4:"targetTopUnion",5:"replace",6:"targetTopIntersection",7:"targetWithoutSource",8:"targetWithoutSource"},n)n[n[i]]=i},function(t,e){var n,i;for(n in t.exports=i={leftAddWidthFixed:0,rightAddWidthFixed:1,centeredWidthFixed:2,leftAddWidthChildren:3,rightAddWidthChildren:4,centeredWidthChildren:5,bothAdd:6,bothMul:7,bothStretch:8},i)i[i[n]]=n},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b={}.hasOwnProperty;(m=n(42)).inspect,l=m.Promise,c=m.log,d=m.mergeInto,h=m.lowerCamelCase,m.merge,a=m.ErrorWithInfo,u=m.defineModule,e=n(96).BaseClass,g=n(313),f=g.point,g.rect,p=g.matrix,i=n(325).Bitmap,s=n(167).EncodedImage,S=n(476).xbd,o=n(360).Element,r=n(384).BitmapElement,y=n(473),v=n(474),u(t,function(t){function V1Loader(){return V1Loader.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)b.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(V1Loader,e),V1Loader.singletonClass(),V1Loader.load=function(t,e){return this.singleton.load(t,e)},V1Loader.prototype.load=function(t,e){return this.bitmapFactory=null!=e?e:i,this.decodeTopTag(S(t).tag("art_file")).then((n=this,function(t){var e;return t.axis=f(),t.location=f(),t.children=function(){var n,i,r,o;for(o=[],n=0,i=(r=t.getPendingChildren()).length;n<i;n++)(e=r[n]).getPendingIsMask()||o.push(e);return o}(),t.bitmapFactory=n.bitmapFactory,t.onNextReady()}));var n},V1Loader.objectFactory={art_file:function(){return new o},pego:function(){return new o},art_stencil_shape:function(){return new o},art_bitmap:function(t,e){var n,i;return i=t.attrs.bitmap_id,n=e.bitmaps[i],new r({bitmap:n})}},V1Loader.prototype.decodeBitmapsTag=function(t){var e,n,i;return t?(this.bitmaps=[],n=function(){var n,r,o,l;for(o=t.tags,l=[],e=n=0,r=o.length;n<r;e=++n)i=o[e],l.push(function(e){return function(n,i){return s.toImage(i.attrs.pixel_data).then(function(r){var o,s;if(s=0|i.attrs.bitmap_id,e.bitmaps[s]=o=e.bitmapFactory.newBitmap(r),o.tainted)throw c.warn({ArtEngine_V1Loader_decodeBitmapsTag:{i:n,length:t.tags.length,bitmap:o.taintedInfo}}),new a("ArtEngine_V1Loader_decodeBitmapsTag - tainted bitmap detected",{bitmap:o.taintedInfo,numBitmaps:t.tags.length});return o})}}(this)(e,i));return l}.call(this),l.all(n)):l.resolve()},V1Loader.prototype.decodeTopTag=function(t){return this.decodeBitmapsTag(t.tag("bitmaps")).then((e=this,function(){return e.createElementFromTag(t)}));var e},V1Loader.prototype.createElement=function(t){var e;return(e=V1Loader.objectFactory[t.name])?e(t,this):(c.warn("WARNING: unknown object type: "+t.name+". Defaulting to Art.Engine.Core.Element"),new o)},V1Loader.prototype.populateChildrenFromTag=function(t,e){var n,i,r,o,s,a,l,u,h,p,d;for(p={"-stencil":d=[],"+stencil":d,stencil:d,normal:i=[],post:l=[]},r=0,o=(u=e.tags).length;r<o;r++)p[(n=u[r]).attrs.stack_mode||"normal"].push(this.createElementFromTag(n,t));for(t.setChildren(i),d.length>0&&(d[0].isMask=!0,t.addChild(d[0]),d.length>1&&c.warn("WARNING - loading more than one mask (shape/stencil) child not currently supported! (using first one only)")),h=[],a=0,s=l.length;a<s;a++)n=l[a],h.push(t.addChild(n));return h},V1Loader.prototype.decodeHorizontalLinearLayout=function(t,e,n,i,r,o){switch(e){case v.leftAddWidthFixed:return d(r,{x:n}),d(o,{w:i});case v.rightAddWidthFixed:return d(r,{x:n,xpw:1}),d(o,{w:i});case v.centeredWidthFixed:return d(r,{xpw:n}),d(o,{w:i});case v.bothAdd:return d(r,{x:n}),d(o,{w:i,wpw:1});case v.bothMul:return d(r,{xpw:n}),d(o,{wpw:i});case v.bothStretch:case v.centeredWidthChildren:case v.rightAddWidthChildren:case v.leftAddWidthChildren:return c.warn("WARNING: unsupported layout "+v[e]+" for "+channel+" loc="+location+" size="+size)}},V1Loader.prototype.decodeVerticalLinearLayout=function(t,e,n,i,r,o){switch(e){case v.leftAddWidthFixed:return d(r,{y:n}),d(o,{h:i});case v.rightAddWidthFixed:return d(r,{y:n,yph:1}),d(o,{h:i});case v.centeredWidthFixed:return d(r,{yph:n}),d(o,{h:i});case v.bothAdd:return d(r,{y:n}),d(o,{h:i,hph:1});case v.bothMul:return d(r,{yph:n}),d(o,{hph:i});case v.bothStretch:case v.centeredWidthChildren:case v.rightAddWidthChildren:case v.leftAddWidthChildren:return c.warn("WARNING: unsupported layout "+v[e]+" for "+channel+" loc="+location+" size="+size)}},V1Loader.prototype.decodeLayout=function(t,e,n){var i,r,o,s,a,l,u,c;return a=0|(e.attrs.x_layout_mode||v.leftAddWidthFixed),u=0|(e.attrs.y_layout_mode||v.leftAddWidthFixed),l=(e.attrs.x_val||0)-0,c=(e.attrs.y_val||0)-0,s=(e.attrs.w_val||0)-0,i=(e.attrs.h_val||0)-0,r={},o={},this.decodeHorizontalLinearLayout(t,a,l,s,r,o),this.decodeVerticalLinearLayout(t,u,c,i,r,o),t.location=r,t.size=o},V1Loader.prototype.setCompositeMode=function(t,e){return y[e]||c.warn("WARNING: unknown composite mode: "+e),t.compositeMode=y[e]||"normal"},V1Loader.prototype.createElementFromTag=function(t,e){var n,i,r,o,s,a,l;for(i in null==e&&(e=null),(r=this.createElement(t)).axis=f(t.attrs.handle||f(.5,.5)),this.decodeLayout(r,t,e),a={},o=t.attrs)switch(l=o[i],i){case"name":r.name=l;break;case"matrix":r.elementToParentMatrix=p(l);break;case"composite_mode":this.setCompositeMode(r,l);break;case"drop_in_enabled":a.dropInEnabled=!0;break;case"art_engine_version":case"kimi_editor_version":case"lock_mode":break;case"handle":case"w_val":case"h_val":case"x_val":case"y_val":case"x_layout_mode":case"y_layout_mode":case"stack_mode":break;default:switch(s=t.name+":"+i){case"art_file:bitmaps":case"art_bitmap:bitmap_id":break;default:a[h(i)]=l.toString(),c.warn("WARNING: unknown tag:attribute: "+s+" (ignored)")}}return r.userProps=a,(n=t.tags.children)&&this.populateChildrenFromTag(r,n),r},V1Loader}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(477)},function(t,e,n){t.exports=n(478),t.exports.includeInNamespace(n(480)).addModules({XbdDictionary:n(482),XbdTag:n(481)})},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(18).addNamespace("Art.Xbd",function(t){function Xbd(){return Xbd.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Xbd,Neptune.PackageNamespace),Xbd.version=n(479).version,Xbd}())},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*"},"description":"Art.Xbd","license":"ISC","name":"art-xbd","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"1.1.0"}')},function(t,e,n){var i,r;n(478),i=n(481),t.exports=[[i,"createTagFactories"],{fromXbd:i.fromXbd,parse:i.fromXbd,xbd:i.fromXbd,package:r=n(479),version:r.version}]},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d={}.hasOwnProperty;n(478),r=n(482),(c=n(42)).isFunction,c.log,c.countKeys,c.upperCamelCase,u=c.plainObjectsDeepEq,c.inspect,o=c.compactFlatten,c.object,c.isString,l=c.objectHasKeys,a=c.defineModule,e=n(96).BaseClass,s=n(192).createObjectTreeFactories,(h=n(167)).binary,p=h.stream,i=h.WriteStream,a(t,function(t){var n,a,c;function XbdTag(t,e,n){this.name=t,this.attrs=null!=e?e:{},this.tags=null!=n?n:[]}return function(t,e){for(var n in e)d.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(XbdTag,e),XbdTag.createTagFactories=function(t,e){return null==e&&(e="Tag"),s({suffix:e},t,function(t,e,n){return new XbdTag(t,e,n)})},XbdTag.fromXbd=function(t){return(t=p(t)).read(c.length),XbdTag._parse(t,r.parse(t,"tag names"),r.parse(t,"attribute names"),r.parse(t,"attribute values"))},XbdTag.prototype.inspect=function(){return this.toXml("  ")},XbdTag.prototype.eq=function(t){return t&&u(this.plainObjects,t.plainObjects)},XbdTag.prototype.toXbd=function(){var t,e,n,r,o;return this,n=this.tagNamesDictionary,t=this.attrNamesDictionary,e=this.attrValuesDictionary,a(r=new i),n.writeWithPromise(r).then(function(){return t.writeWithPromise(r)}).then(function(){return e.writeWithPromise(r)}).then((o=this,function(){return o._getBinaryStringPromise(n,t,e)})).then(function(t){return r.writeAsiString(t),r.binaryStringPromise})},XbdTag.prototype.find=function(t,e){var n,i,r,o;for(null==e&&(e=[]),n=0,i=(r=this.tags).length;n<i;n++)(o=r[n]).name.match(t)?e.push(o):o.find(t,e);return e},XbdTag.prototype.tag=function(t){var e,n,i,r;for(e=0,n=(i=this.tags).length;e<n;e++)if((r=i[e]).name===t)return r;return null},XbdTag.prototype.toString=function(){return this.toXml("  ")},XbdTag.prototype.toPlainObjects=function(){var t,e,n,i,r;return l(this.attrs)&&(e=this.attrs),(null!=(i=this.tags)?i.length:void 0)>0&&(n=function(){var t,e,n,i;for(i=[],t=0,e=(n=this.tags).length;t<e;t++)r=n[t],i.push(r.toPlainObjects());return i}.call(this)),(t={})["XbdTag_"+this.name]=e?n?o([e,n]):e:null!=n?n:{},t},XbdTag.prototype.toXml=function(t){var e;return null==t&&(t=""),e="",this.attrs&&(e=this._attributesXml())&&(e=" "+e),0===this.tags.length?"<"+this.name+e+"/>":"<"+this.name+e+">\n"+this._tagsXml(t)+"\n</"+this.name+">"},XbdTag.getter({xbdPromise:function(){return this.toXbd()},xml:function(){return this.toXml()},plainObjects:function(){return this.toPlainObjects()},inspectedObjects:function(){return this.toPlainObjects()},tagNamesDictionary:function(t){var e,n,i;for(null==t&&(t=new r([],"tag names")),t.add(this.name),e=0,n=(i=this.tags).length;e<n;e++)i[e].getTagNamesDictionary(t);return t},attrNamesDictionary:function(t){var e,n,i,o,s;for(n in null==t&&(t=new r([],"attribute names")),o=this.attrs)o[n],t.add(n);for(e=0,i=(s=this.tags).length;e<i;e++)s[e].getAttrNamesDictionary(t);return t},attrValuesDictionary:function(t){var e,n,i,o,s,a;for(n in null==t&&(t=new r([],"attribute values")),o=this.attrs)a=o[n],t.add(a);for(e=0,i=(s=this.tags).length;e<i;e++)s[e].getAttrValuesDictionary(t);return t}}),c="SBDXML\0",a=function(t){return t.write("SBDXML"),t.write([1,0])},n=function(t,e){return e+t.split("\n").join("\n"+e)},XbdTag.prototype._attributesXml=function(){var t,e;return function(){var n,i;for(t in i=[],n=this.attrs)e=n[t],i.push(t+"='"+e+"'");return i}.call(this).join(" ")},XbdTag.prototype._tagsXml=function(t){var e;return e=this.tags.map(function(e){return e.toXml(t)}),n(e.join("\n"),t)},XbdTag.prototype._getAttributesBinaryStringPromise=function(t,e){var n,r,o,s;for(n in s=new i,r=this.attrs)o=r[n],s.writeAsi(t.get(n)),s.writeAsi(e.get(o));return s.binaryStringPromise},XbdTag.prototype._writeSubTagsWithPromise=function(t,e,n,i){var r,o,s;return r=0,s=this,(o=function(){var a,l;return(l=null!=(a=s.tags)?a[r++]:void 0)?l._getBinaryStringPromise(e,n,i).then(function(e){return t.writeAsiString(e),o()}):Promise.resolve()})()},XbdTag.prototype._getBinaryStringPromise=function(t,e,n){var r,o;return(r=new i).writeAsi(t.get(this.name)),this._getAttributesBinaryStringPromise(e,n).then((o=this,function(i){return r.writeAsiString(i),o._writeSubTagsWithPromise(r,t,e,n)})).then(function(){return r.binaryStringPromise})},XbdTag._parse=function(t,e,n,i){var r,o,s,a,l,u,c,h,p;for(c=t.readAsiString(),a=e.readString(c).toString(),r=c.readAsiString(),o=null;!r.done();)o||(o={}),s=n.readString(r).toString(),p=i.readString(r),o[s]=p;for(h=[];!c.done();)u=XbdTag._parse(c,e,n,i),h.push(u),h[l=u.name]||(h[l]=u);return new XbdTag(a,o,h)},XbdTag}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u={}.hasOwnProperty;(l=n(42)).log,a=l.inspect,r=n(160).Binary,s=r.binary,o=r.WriteStream,r.stream,i=n(96).BaseClass,t.exports=function(t){function XbdDictionary(t,e){this.strings=t,this.name=e}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(XbdDictionary,i),XbdDictionary.parse=function(t,e){var n,i,r;return n=t.readAsiString(),r=function(){var t,e,i;for(i=[],t=0,e=n.readAsi();0<=e?t<e:t>e;0<=e?++t:--t)i.push(n.readAsi());return i}(),new XbdDictionary(function(){var t,e,o;for(o=[],t=0,e=r.length;t<e;t++)i=r[t],o.push(n.read(i));return o}(),e)},XbdDictionary.prototype.add=function(t){var e;return t=s(t),0<=(e=this._indexOf(t))?e:(this.strings.push(t),this.strings.length)},XbdDictionary.prototype.get=function(t){var e;if(t=s(t),0<=(e=this._indexOf(t)))return e;throw new Error("string not found in dictionary: "+a(t))},XbdDictionary.prototype.readString=function(t){var e,n;if(e=t.readAsi(),!(n=this.strings[e]))throw"string id("+e+") not in "+this.name+" dictionary. keys = '"+Object.keys(this.strings)+"'";return n},XbdDictionary.getter({binaryStringPromise:function(){var t,e,n,i,r,s,a,l;for(l=new o,r=this._getNormalizeStrings(),l.writeAsi(r.length),t=0,n=r.length;t<n;t++)s=r[t],l.writeAsi(s.length);for(e=0,i=r.length;e<i;e++)a=r[e],l.write(a);return l.binaryStringPromise}}),XbdDictionary.prototype.writeWithPromise=function(t){return this.binaryStringPromise.then(function(e){return t.writeAsiString(e)})},XbdDictionary.prototype._getNormalizeStrings=function(){var t,e,n,i,r;for(i=[],t=0,e=(n=this.strings).length;t<e;t++)r=n[t],i.push(s(r));return i},XbdDictionary.prototype._indexOf=function(t){var e,n,i,r;for(e=n=0,i=(r=this.strings).length;n<i;e=++n)if(r[e].eq(t))return e;return-1},XbdDictionary}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E=function(t,e){return function(){return t.apply(e,arguments)}},T={}.hasOwnProperty;n(160),a=n(313),n(325),m=n(476),n(360),n(384),g=n(473),w=n(325).normalizedCompositeModeMap,l=(C=n(472)).BaseClass,b=C.log,C.createObjectTreeFactories,y=C.createWithPostCreate,S=C.float32Eq0,d=C.Promise,P=C.propsEq,x=a.point,m.XbdTag,_=(0,m.createTagFactories)("Root bitmaps bitmap art_file pego art_bitmap children art_stencil_shape art_rectangle art_solid_fill"),i=_.ArtFileTag,p=_.PegoTag,e=_.ArtBitmapTag,h=_.ChildrenTag,s=_.ArtStencilShapeTag,r=_.ArtRectangleTag,o=_.ArtSolidFillTag,c=_.BitmapsTag,u=_.BitmapTag,f=_.RootTag,v={Element:p,RectangleElement:p,BitmapElement:e},t.exports=y(t,function(t){function V1Writer(){this._toXbdTag=E(this._toXbdTag,this),this.toEncodedArtFile=E(this.toEncodedArtFile,this),V1Writer.__super__.constructor.apply(this,arguments),this.reset()}return function(t,e){for(var n in e)T.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(V1Writer,l),V1Writer.singletonClass(),V1Writer.toArtFileTags=function(t){return V1Writer.singleton.toArtFileTags(t)},V1Writer.toEncodedArtFile=function(t){return V1Writer.singleton.toEncodedArtFile(t)},V1Writer.prototype.reset=function(){return this.bitmapTags={},this.bitmapTagCount=0},V1Writer.prototype.toArtFileTags=function(t){return this.reset(),t.onNextReady().then((e=this,function(){return e._generateBitmapsTag(t)})).then(function(e){return function(){return d.all([e._encodeProps(t),e._getChildrenTagPromise(t)])}}(this)).then(function(t){return function(e){var n,r;return r=e[0],n=e[1],r.art_engine_version="0.0.2",r.kimi_editor_version="0.6.0",f(i(r,n,t.bitmapsTag))}}(this));var e},V1Writer.prototype.toEncodedArtFile=function(t){return this.toArtFileTags(t).then(function(t){return t.toXbd()})},V1Writer.prototype._encodeLayout=function(t,e){var n,i,r,o,s,a;if(o=t.currentSize,r=t.currentLocation,i=t.axis,"1,1,0,0,0,0"!==(a=(s=t.getElementToParentMatrix()).withLocation(0).toArray().join(","))&&(e.matrix=a),S(n=s.getAngle())||(e.angle=""+n),e.w_val=o.x.toString(),e.h_val=o.y.toString(),P(r,x())||(e.x_val=r.x.toString(),e.y_val=r.y.toString()),!P(i,x(.5)))return e.handle="("+i.x+","+i.y+")"},V1Writer.prototype._addTagForBitmap=function(t){var e,n,i,r,o;return e=t.bitmap,r=t.userProps,i=e.uniqueId,this.bitmapTags[i]?d.resolve():(r&&(n=r.encodedBitmap),d.resolve().then(function(){return n||(e.hasAlpha?e.toPng():e.toJpg())}).then((o=this,function(t){return o.bitmapTags[i]=u({bitmap_id:o.bitmapTagCount++,pixel_data:t})})))},V1Writer.prototype._populateBitmapSubTagsRecursive=function(t){var e,n,i;return e=t.bitmap,n=t.children,d.resolve().then((i=this,function(){return e&&i._addTagForBitmap(t)})).then(function(t){return function(){var e;return d.all(function(){var t,i,r;for(r=[],t=0,i=n.length;t<i;t++)e=n[t],r.push(this._populateBitmapSubTagsRecursive(e));return r}.call(t))}}(this))},V1Writer.prototype._generateBitmapsTag=function(t){return this._populateBitmapSubTagsRecursive(t).then((e=this,function(){var t,n;if(e.bitmapTagCount>0)return e.bitmapsTag=c(function(){var e,i;for(t in i=[],e=this.bitmapTags)n=e[t],i.push(n);return i}.call(e))}));var e},V1Writer.prototype._encodeProps=function(t){var e,n,i,r,o,s,a;for(i in n={},r=t.minimalProps)switch(a=r[i],i){case"userProps":a.dropInEnabled&&(n.drop_in_enabled="true",n.lock_mode="2");break;case"compositeMode":switch(o=w[a]){case"targetTopIntersection":n.stack_mode="+stencil";break;case"targetWithoutSource":n.stack_mode="-stencil";break;default:(s=g[o])?n.composite_mode=s:b.warn("WARNING: V1Writer does not support composite mode: "+o+" (from: "+a+")")}break;case"key":n.name=a.toString();break;case"elementToParentMatrix":n.matrix=a.toString();break;case"bitmap":(e=this.bitmapTags[a.uniqueId])||console.warn("Bitmap missing: "+a.uniqueId),n.bitmap_id=e.attrs.bitmap_id;break;case"location":case"children":case"parent":case"currentSize":case"size":case"axis":case"color":case"scale":case"angle":break;default:b.warn("Art.Engine.V1Writer: ignored unsupported prop type: elementType: "+t.class.name+", propType: "+i)}return this._encodeLayout(t,n),n},V1Writer.prototype._getChildrenTagPromise=function(t){return d.resolve().then((e=this,function(){var n,i;switch(t.class.name){case"RectangleElement":return h(null,s({stack_mode:"+stencil",x_layout_mode:"7",x_val:"0.5",w_val:"1",y_layout_mode:"7",y_val:"0.5",h_val:"1"},r()),o({color:(null!=(i=t.color)?i.rawRgbaHexString:void 0)||"000000ff"}));default:return d.all(function(){var e,i,r,o;for(o=[],e=0,i=(r=t.children).length;e<i;e++)n=r[e],o.push(this._toXbdTag(n));return o}.call(e)).then(function(t){return t.length>0&&h(t)})}}));var e},V1Writer.prototype._toXbdTag=function(t){var e;return(e=v[t.class.name])?d.all([this._encodeProps(t),this._getChildrenTagPromise(t)]).then(function(t){var n,i;return i=t[0],n=t[1],e(i,n)}):(console.warn("Art.Engine.V1Writer: unsupported Element type: "+t.class.name),null)},V1Writer}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(485))}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v={}.hasOwnProperty;m=n(160),p=m.isFunction,f=m.objectWithout,d=m.log,m.isPlainObject,u=m.Promise,a=n(341),c=n(486),s=a.ElementFactory,o=a.Element,r=a.CanvasElement,l=a.FullScreenApp,t.exports=c,i=n(504),g=n(363),y=g.startFrameTimer,h=g.endFrameTimer,c.addElementFactories=function(t){var e,n,r,o;for(n in r=e=i.createVirtualElementFactories(c.VirtualElementArtEngine,t))o=r[n],c[n]||(c[n]=o);return e},c.VirtualElementArtEngine=function(t){var e,n,i;function VirtualElementArtEngine(){return VirtualElementArtEngine.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)v.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(VirtualElementArtEngine,c.VirtualElement),n=null,e=function(t,e){if("children"!==t)return n.setProperty(t,e)},i=function(t,e){if("children"!==t)return n.resetProperty(t)},VirtualElementArtEngine.prototype._updateElementProps=function(t){var r;return n=this.element,r=this._updateElementPropsHelper(t,e,i),n=null,r},VirtualElementArtEngine.prototype._setElementChildren=function(t){return this.element.setChildren(t)},VirtualElementArtEngine.prototype._newElement=function(t,e,n,i){var a;return y("reactCreate"),e.children&&(e=f(e,"children")),a=s.newElement(this.elementClassName,e,n,this),i&&(i instanceof o?i.addChild(a):(e=merge(i,{webgl:"true"===Browser.Parse.query().webgl,children:[a]}),new r(e))),h(),a},VirtualElementArtEngine.prototype._newErrorElement=function(){return this._newElement("RectangleElement",{key:"ART_REACT_ERROR_CREATING_CHILD_PLACEHOLDER",color:"orange"})},VirtualElementArtEngine}(),c.initArtReactApp=function(t){var e,n,i,r,o,s,a;if(o=t.prepare,i=t.mainComponent,r=t.mainComponentProps,e=null!=(s=t.MainComponent)?s:i,n=null!=(a=t.MainComponentProps)?a:r,!e)throw new Error("MainComponent required");return t.title||(t.title=e.getName()),l.init(t).then(function(){return u.then(function(){return p(o)?o():o})}).then(function(){return e.instantiateAsTopComponent(n)}).catch(function(t){return d.error("Art.React.initArtReactApp failed",t)})},c.addElementFactories()},function(t,e,n){(t.exports=n(487)).includeInNamespace(n(491)),n(492)},function(t,e,n){t.exports=n(488).addNamespace("React",class React extends Neptune.PackageNamespace{}._configureNamespace(n(489))),n(490)},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Art"),n(487)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-engine":"*"},"description":"Art.React is inspired by Facebook\'s React. In fact, it is much the same. However, ArtReact is designed from the ground up to run with the Art.Engine.","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","mocha":"^6.2.0","mock-fs":"^4.10.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"license":"ISC","name":"art-react","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"1.35.1"}')},function(t,e,n){t.exports=n(487).addNamespace("Core",class Core extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(492)},function(t,e,n){(t.exports=n(490)).includeInNamespace(n(493)).addModules({Component:n(494),HotStyleProps:n(503),PropFieldsMixin:n(501),ReactArtEngineEpoch:n(496),StateFieldsMixin:n(500),VirtualElement:n(502),VirtualNode:n(495)})},function(t,e,n){var i,r,o,s,a,l,u,c,h;i=n(494),c=n(496).reactArtEngineEpoch,(h=n(160)).isPlainArray,l=h.isString,h.arrayWith,u=h.log,h.isFunction,a=h.isArray,o=n(495),r=n(502),s=function(t,e){return null!=t?a(t)?t.concat(e):[t,e]:e},t.exports=[[i,"createAndInstantiateTopComponent","createComponentFactory"],{resetReactPerfCounters:function(){return r.resetCounters(),i.resetCounters()},getReactPerfCounters:function(){return{VirtualElement:r.getCounters(),Component:i.getCounters()}},instantiateTopComponent:function(t,e){return console.warn("React.instantiateTopComponent is DEPRICATED. Use: componentInstance.instantiateAsTopComponent"),t.instantiateAsTopComponent(e)},onNextReady:function(t){return c.onNextReady(t)},objectTreeFactoryOptions:{postProcessProps:function(t){var e;return(e=null!=t?t._textFromString:void 0)&&(t.text=s(t.text,e),delete t._textFromString),t},mergePropsInto:function(t,e){var n,i;for(n in e)i=e[n],"_textFromString"===n?t.text=s(t.text,i):t[n]=i;return t},preprocessElement:function(t,e){var n;return l(t)?(u.warn("ArtReact: string children are DEPRICATED. Use text: 'string'. Currently rendering: "+((null!=(n=o.currentlyRendering)?n.inspectedName:void 0)||"none")+". Factory: "+e.inspect()),{_textFromString:t}):t}}}]},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F=function(t,e){for(var n in e)B.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},B={}.hasOwnProperty;i=n(160),u=n(495),a=n(496),f=i.defineModule,P=i.log,C=i.merge,i.mergeInto,i.clone,i.shallowClone,b=i.inspect,i.keepIfRubyTrue,i.BaseObject,i.fastBind,i.slice,i.isObject,x=i.isString,i.isArray,w=i.isFunction,S=i.globalCount,i.time,i.stackTime,i.countStep,d=i.createWithPostCreate,c=i.arrayWithout,i.upperCamelCase,p=i.createObjectTreeFactory,I=i.select,g=i.formattedInspect,v=i.getModuleBeingDefined,r=i.InstanceFunctionBindingMixin,y=i.getEnv,_=i.mergeIntoUnless,T=a.reactArtEngineEpoch,k=n(363),M=k.startFrameTimer,m=k.endFrameTimer,s=n(490),h=y().artReactDebug,n(497).HotLoader.runHot,l=n(500),o=n(501),(e=Neptune.Art.Engine.Core)?(A=e.StateEpoch.stateEpoch,E=function(t){return A.onNextReady(t)}):E=function(t){return T.onNextReady(t)},f(t,function(){return function(t){var e,n,i,r,o,a,l,f,y,k,A,B,R;function Component(t){null==t&&(t=k),Component.created++,S("ReactComponent_Created"),Component.__super__.constructor.call(this,t),this.state={},this.refs=null,this._pendingState=null,this._pendingUpdates=null,this._virtualAimBranch=null,this._mounted=!1,this._wasMounted=!1,this._bindList=null,this._epochUpdateQueued=!1,Component.pushCreatedComponent(this)}return F(Component,t),Component.abstractClass(),Component.nonBindingFunctions="getInitialState componentWillReceiveProps componentWillMount componentWillUnmount componentWillUpdate componentDidMount componentDidUpdate render".split(/\s+/),Component.resetCounters=function(){return this.created=this.rendered=this.instantiated=0},Component.resetCounters(),Component.getCounters=function(){return{created:this.created,rendered:this.rendered,instantiated:this.instantiated}},Component.topComponentInstances=[],Component.rerenderAll=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.topComponentInstances).length;e<n;e++)t=i[e],r.push(t.rerenderAll());return r},Component.prototype.rerenderAll=function(){var t,e,n,i,r,o;if(this._queueRerender(),(null!=(i=this.subComponents)?i.length:void 0)>0){for(o=[],e=0,n=(r=this.subComponents).length;e<n;e++)t=r[e],o.push(t.rerenderAll());return o}},Component.createAndInstantiateTopComponent=function(t){return Component.createComponentFactory(t).instantiateAsTopComponent()},R={},Component.createComponentFactory=function(t,e){var n,i,r;return null==e&&(e=Component),r=function(){if((null!=t?t.prototype:void 0)instanceof Component)return t;if((null!=t?t.constructor:void 0)===Object)return(n=B(t)||R).uniqueComponentNameId||(n.uniqueComponentNameId=1),i="Anonymous"+e.getClassName(),i+="_"+n.uniqueComponentNameId++,i+=n.id?"_Module"+n.id:"_ModuleUnknown",function(e){var n,r;function AnonymousComponent(){return AnonymousComponent.__super__.constructor.apply(this,arguments)}for(n in F(AnonymousComponent,e),AnonymousComponent._name=i,t)r=t[n],AnonymousComponent.prototype[n]=r;return AnonymousComponent}(e);throw new Error("Specification Object or class inheriting from Component required.")}.call(this),d(r)},Component.getModule=B=function(t){return null==t&&(t=this.prototype),t.module||t.hotModule||v()},Component.getCanHotReload=function(){var t;return null!=(t=this.getModule())?t.hot:void 0},Component._hotReloadUpdate=function(t){var e,n,i,r,o,s;if(this._moduleState=t,this.getClassName(),e=this._moduleState.hotInstances){for(P(((o={})["Art.React.Component "+this.getName()+" HotReload"]={instanceToRerender:e.length},o)),s=[],i=0,r=e.length;i<r;i++)n=e[i],s.push(n._componentDidHotReload());return s}},Component.allComponents={},Component.postCreateConcreteClass=function(t){var e,n;return e=t.classModuleState,n=t.hotReloadEnabled,Component.__super__.constructor.postCreateConcreteClass.apply(this,arguments),n&&this._hotReloadUpdate(e),this.toComponentFactory()},Component.toComponentFactory=function(){var t,e,n;return t=s.objectTreeFactoryOptions,e=t.postProcessProps,p(C(t,{inspectedName:this.getName()+"ComponentFactory",class:this,bind:"instantiateAsTopComponent"}),(n=this,function(t,i){return i&&(t=C(t,{children:i})),new n(e(t))}))},Component.instantiateAsTopComponent=function(t,e){return new this(t).instantiateAsTopComponent(e)},Component.createdComponents=null,Component.pushCreatedComponent=function(t){return this.createdComponents||(this.createdComponents=[]),this.createdComponents.push(t)},Component.resetCreatedComponents=function(){return this.createdComponents=null},k={},Component.prototype.withElement=function(t){return this._virtualAimBranch.withElement(t)},Component.prototype.instantiateAsTopComponent=function(t){return Component.topComponentInstances.push(this),this._instantiate(null,t)},Component.prototype.unbindTopComponent=function(){var t;if(!(0<=(t=Component.topComponentInstances.indexOf(this))))throw new Error("not a top component!");return Component.topComponentInstances=c(Component.topComponentInstances,t),this._unmount()},Component.getter({inspectedName:function(){return this.className+(this.key?"-"+this.key:"")},mounted:function(){return this._mounted}}),Component.prototype.onNextReady=function(t,e){return null==e&&(e=!0),E(t,e,this)},Component.prototype.setState=function(t,e,n){var i,r,o,s,a,l;if(x(t))return n&&this.onNextReady(n),this._setSingleState(t,e);if(s=t,(r=e)&&this.onNextReady(r),s)if(w(s))this._queueUpdate(s);else for(o in a=this.state,i=null,s)l=s[o],(this._pendingState||a[o]!==l)&&(i||(i=this._getStateToSet()),i[o]=l);return s},Component.prototype.replaceState=function(t,e){return this._setPendingState(t),e&&this.onNextReady(e),t},Component.prototype.forceUpdate=function(t){return P.error("forceUpdate is DEPRICATED"),this._queueChangingComponentUpdates(),t&&this.onNextReady(t),!0},Component.prototype.getInitialState=function(){return{}},Component.prototype.componentDidHotReload=function(){var t;return t=(this.state._hotModuleReloadCount||0)+1,this.setState({_hotModuleReloadCount:t})},Component.prototype.componentWillReceiveProps=r=function(t){},Component.prototype.componentWillMount=i=function(){},Component.prototype.componentWillUnmount=o=function(){},Component.prototype.componentWillUpdate=a=function(t,e){},Component.prototype.componentDidMount=e=function(){},Component.prototype.componentDidUpdate=n=function(t,e){},Component.prototype.preprocessProps=l=function(t){return t},Component.prototype.preprocessState=f=function(t){return t},Component.prototype.find=function(t,e,n,i){var r,o,s,a,l,u,c,h,p,d;if(r=(c=null!=e?e:{}).findAll,d=c.verbose,null==n&&(n=[]),u=i?i+"/"+this.inspectedName:this.inspectedName,(l=(p=w(t))?!!(o=t(this)):u.match(t))?(d&&this.log(p?{matched:u,functionResult:o}:{matched:u}),n.push(this)):"all"===d&&this.log(p?{notMatched:u,functionResult:o}:{notMatched:u}),(!l||r)&&this.subComponents)for(s=0,a=(h=this.subComponents).length;s<a;s++)h[s].find(t,arguments[1],n);return n},Component.getter({inspectedObjects:function(){var t,e,n,i,r;return(t={})["Component-"+this.inspectedName+" "+(null!=(i=null!=(r=this._virtualAimBranch)?r.inspectedName:void 0)?i:"(not instantiated)")]=null!=(e=null!=(n=this._virtualAimBranch)?n.inspectedObjectsContents:void 0)?e:{props:this.props},t}}),Component.prototype.getPendingState=function(){return this._pendingState||this.state},Component.prototype._getStateToSet=function(){return this._wasMounted?this._getPendingState():this.state},Component.prototype._setSingleState=function(t,e,n){return(this._pendingState||this.state[t]!==e)&&(this._getStateToSet()[t]=e),e},Component.prototype._queueRerender=function(){return this._getPendingState()},Component.prototype._setPendingState=function(t){return this._queueChangingComponentUpdates(),this._pendingState=t},Component.prototype._queueChangingComponentUpdates=function(){if(!this._epochUpdateQueued)return this._epochUpdateQueued=!0,T.addChangingComponent(this)},Component.prototype._queueUpdate=function(t){return this._queueChangingComponentUpdates(),(null!=this._pendingUpdates?this._pendingUpdates:this._pendingUpdates=[]).push(t)},Component.prototype._getPendingState=function(){return this._pendingState||this._setPendingState({})},Component.prototype._unmount=function(){var t;return this._removeHotInstance(),this._componentWillUnmount(),null!=(t=this._virtualAimBranch)&&t._unmount(),this._mounted=!1},Component.prototype._addHotInstance=function(){var t;if(t=this.class._moduleState)return(t.hotInstances||(t.hotInstances=[])).push(this)},Component.prototype._removeHotInstance=function(){var t,e,n;if((n=this.class._moduleState)&&(t=n.hotInstances)&&0<=(e=t.indexOf(this)))return n.hotInstances=c(t,e)},A={},Component.prototype._instantiate=function(t,e){var n,i;return Component.__super__._instantiate.apply(this,arguments),S("ReactComponent_Instantiated"),this.bindFunctionsToInstance(),this.props=this._preprocessProps(this.props),this._addHotInstance(),this._componentWillMount(),i=this.getInitialState(),n=this.state,this.state=A,this.state=this._preprocessState(C(this.getStateFields(),n,i)),this._virtualAimBranch=this._renderCaptureRefs(),this._virtualAimBranch._instantiate(this,e),this.element=this._virtualAimBranch.element,this._componentDidMount(),this._wasMounted=this._mounted=!0,this},y=[],Component.prototype._renderCaptureRefs=function(){var t;if(Component.rendered++,M("reactRender"),null,S("ReactComponent_Rendered"),u.assignRefsTo=this.refs={},u.currentlyRendering=this,Component.resetCreatedComponents(),h&&P("render "+Component.rendered+", component: "+this.className),!((t=this.render())instanceof u))throw new Error(this.className+": render must return a VirtualNode. Got: "+b(t));return this.subComponents=Component.createdComponents||y,u.currentlyRendering=u.assignRefsTo=null,m(),t},Component.prototype._updateRefsAfterReRender=function(){var t,e,n,i,r,o,s,a,l;for(i in o=this.refs)o[i],(t=this.refs[i]._updateTarget)&&(this.refs[i]=t);for(a=[],e=n=0,r=(s=this.subComponents).length;n<r;e=++n)(l=s[e]._updateTarget)&&a.push(this.subComponents[e]=l);return a},Component.prototype._canUpdateFrom=function(t){return this.class===t.class&&this.key===t.key},Component.prototype._shouldReRenderComponent=function(t){return this._propsChanged(t)||this._pendingState},Component.prototype._reRenderComponent=function(){var t,e;if(this.refs,!(t=this._renderCaptureRefs()))throw P.error({ComponentRenderError:this}),new Error("Component render function returned: "+g(t));return this._virtualAimBranch._canUpdateFrom(t)?(M("reactUpdate"),this._virtualAimBranch._updateFrom(t),m(),this._updateRefsAfterReRender()):(console.error("REACT-ART-ENGINE ERROR - The render function's top-level Component/VirtualElement changed 'too much.' The VirtualNode returned by a component's render function cannot change its Type or Key.\n\nSolution: Wrap your changing VirtualNode with a non-changing VirtualElement.\n\nOffending component: "+this.classPathName+"\nOffending component assigned to: self.offendingComponent"),console.log("CHANGED-TOO-MUCH-ERROR-DETAILS - all these properties must be the same on the oldRoot and newRoot",{oldRoot:I(this._virtualAimBranch,"key","elementClassName","class"),newRoot:I(t,"key","elementClassName","class")}),self.offendingComponent=this,null!=(e=this._virtualAimBranch)&&e._unmount(),(this._virtualAimBranch=t)._instantiate(this)),this.element=this._virtualAimBranch.element},Component.prototype._updateFrom=function(t){return Component.__super__._updateFrom.apply(this,arguments),this._shouldReRenderComponent(t)?(S("ReactComponent_UpdateFromTemporaryComponent_Changed"),this._applyPendingState(t.props)):S("ReactComponent_UpdateFromTemporaryComponent_NoChange"),this},Component.prototype._resolvePendingUpdates=function(t){var e,n,i,r;if(null==t&&(t=this.state),this._pendingState&&(i=_(this._pendingState,t),this._pendingState=null),this._pendingUpdates){for(null==i&&(i=C(t)),e=0,n=(r=this._pendingUpdates).length;e<n;e++)i=r[e].call(this,i);this._pendingUpdates=null}return null!=i?i:t},Component.prototype._applyPendingState=function(t){var e,n;if(this._epochUpdateQueued||t)return e=this.props,n=this.state,t?(t=this._preprocessProps(this._rawProps=t),this._componentWillReceiveProps(t)):t=e,this._updateComponent(t,this._resolvePendingUpdates()),this._reRenderComponent(),this._componentDidUpdate(e,n)},Component.prototype._updateComponent=function(t,e){return this._componentWillUpdate(t,e),e=this._resolvePendingUpdates(e),this._epochUpdateQueued=!1,this.props=t,this.state=this._preprocessState(e)},Component.prototype._componentWillReceiveProps=function(t){if(r!==this.componentWillReceiveProps)return this.componentWillReceiveProps(t)},Component.prototype._preprocessProps=function(t){if(t=Component.__super__._preprocessProps.call(this,t),l===this.preprocessProps)return t;try{return this.preprocessProps(t)}catch(e){return P({preprocessProps:{Component:this,error:e}}),t}},Component.prototype._preprocessState=function(t){var e;if(f===this.preprocessState)return t;try{return this.preprocessState(t)}catch(n){return P({ArtReact_preprocessState:{Component:this,error:e=n}}),console.log(e),t}},Component.prototype._componentWillMount=function(){if(i!==this.componentWillMount)return this.componentWillMount()},Component.prototype._componentDidHotReload=function(){this.bindFunctionsToInstance(!0);try{return this.componentDidHotReload()}catch(t){}},Component.prototype._componentWillUnmount=function(){if(o!==this.componentWillUnmount)return this.componentWillUnmount()},Component.prototype._componentWillUpdate=function(t,e){if(a)return this.componentWillUpdate(t,e)},Component.prototype._componentDidMount=function(){var t;if(e!==this.componentDidMount)return this.onNextReady((t=this,function(){return t.componentDidMount()}))},Component.prototype._componentDidUpdate=function(t,e){var i;if(n!==this.componentDidUpdate)return this.onNextReady((i=this,function(){return i.componentDidUpdate(t,e)}))},Component}(o(l(r(u))))})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty,g=[].slice;i=n(160),r=n(496),i.log,i.compact,i.globalCount,i.flatten,e=i.BaseObject,i.shallowClone,l=i.inspect,p=i.objectKeyCount,u=i.isObject,o=i.deepEach,c=i.isPlainObject,h=i.keepIfRubyTrue,d=i.propsEq,s=i.defineModule,f=r.reactArtEngineEpoch,a={},s(t,function(t){function VirtualNode(t){null==t&&(t=a),this._updateTarget=null,this._parentComponent=null,this.key=t.key,this.props=this._rawProps=t,this._propsLength=-1,this.element=null,VirtualNode._assignRefs(this)}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(VirtualNode,e),VirtualNode.prototype.onNextReady=function(t,e){return null==e&&(e=!0),f.onNextReady(t,e,this)},VirtualNode.assignRefsTo=null,VirtualNode.currentlyRendering=null,VirtualNode.getter("rawProps",{propsLength:function(){return this._propsLength>=0?this._propsLength:this._propsLength=p(this.props)}}),VirtualNode.setter({propsLength:function(t){return this._propsLength=t}}),VirtualNode.prototype.withElement=function(t){return new Promise((e=this,function(n){return n(t(e.element))}));var e},VirtualNode.prototype.sendToElement=function(){var t,e,n;return e=arguments[0],t=2<=arguments.length?g.call(arguments,1):[],new Promise((n=this,function(i){var r;return i((r=n.element)[e].apply(r,t))}))},VirtualNode._separateConstructionParams=function(t,e,n){return o(t,function(t){var i,r,o;if(c(t)){for(i in r=[],t)o=t[i],r.push(e[i]=o);return r}if(h(t))return n.push(t)})},VirtualNode._assignRefs=function(t){var e;if((e=t.key)&&this.assignRefsTo)return this.assignRefsTo[e]?console.warn("WARNING: Duplicate key found. This MUST be fixed for correct operation.\n  key: "+l(e)+"\n  new VirtualNode: "+t.inspectedName+"\n  old VirtualNode: "+this.assignRefsTo[e].inspectedName):this.assignRefsTo[e]=t},VirtualNode.prototype._validateChildren=function(t){var e,n,i;if(!t)return t;for(n=0,i=t.length;n<i;n++)if(!((e=t[n])instanceof VirtualNode))throw console.warn({"invalid VirtualNode child":e,parent:this}),u(e)&&console.warn("Hint: Did you place properties AFTER a child element?"),new Error("VirtualNode child is not a VirtualNode.\ninvalid child: "+l(e)+"\nparent: "+this.inspectedName);return t},VirtualNode.prototype._propsChanged=function(t){var e,n,i,r,o;for(n in i=t.rawProps,e=0,r=this.rawProps)if(o=r[n],e++,!d(o,i[n]))return!0;return this._propsLength=e,e!==t.getPropsLength()},VirtualNode.prototype._updateFrom=function(t){return t._updateTarget=this},VirtualNode.prototype._canUpdateFrom=function(t){return!1},VirtualNode.prototype._instantiate=function(t,e){return this._parentComponent=t,this},VirtualNode}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u={}.hasOwnProperty;(o=n(160)).log,o.merge,o.clone,o.peek,o.inspect,r=o.Epoch,a=o.globalCount,l=o.stackTime,o.isWebWorker,t.exports=s=function(t){function ReactArtEngineEpoch(){return ReactArtEngineEpoch.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ReactArtEngineEpoch,r),ReactArtEngineEpoch.singletonClass(),ReactArtEngineEpoch.prototype.addChangingComponent=function(t){return this.queueItem(t)},ReactArtEngineEpoch.prototype.processEpochItems=function(t){return a("ReactArtEngineEpoch processEpochItems",l(function(){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(e._applyPendingState());return r}))},ReactArtEngineEpoch}(),(i=Neptune.Art.Engine.Core)&&i.GlobalEpochCycle.singleton.includeReact(s.singleton)},function(t,e,n){t.exports=n(498)},function(t,e,n){(t.exports=n(457)).addModules({HotLoader:n(499)})},function(t,e,n){var i,r,o,s={}.hasOwnProperty;i=(o=n(160)).BaseObject,r=o.peek,o.log,t.exports=function(t){function HotLoader(){this._modulePersistantState=[]}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(HotLoader,i),HotLoader.singletonClass(),HotLoader.runHot=function(t,e){return HotLoader.singleton.runHot(t,e)},HotLoader.getModuleState=function(){return r(HotLoader.singleton._modulePersistantState)},HotLoader.prototype.runHot=function(t,e){var n,i;return(null!=t?t.hot:void 0)&&(this._modulePersistantState.push(((n=t.hot).data||(n.data={modulePersistantState:{}})).modulePersistantState),t.hot.accept(),t.hot.dispose(function(e){return e.modulePersistantState=t.hot.data.modulePersistantState})),i=e(r(this._modulePersistantState)),(null!=t?t.hot:void 0)&&this._modulePersistantState.pop(),i},HotLoader}()},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;e=(s=n(42)).defineModule,r=s.log,s.mergeInto,i=s.each,o=s.lowerCamelCase,e(t,function(){return function(t){return function(e){var n;function StateFieldsMixin(){return StateFieldsMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(StateFieldsMixin,t),StateFieldsMixin.extendableProperty({stateFields:{}}),StateFieldsMixin.stateFields=n=function(t){return this.extendStateFields(t),i(t,(e=this,function(t,n){var i,s;return s=t,i=null,e.addGetter(n,function(){return this.state[n]}),!0===t||!1===t?(i=!1,s=!0,e.addSetter(n,function(t){return this.setState(n,!!t)}),e.prototype[o("set is "+n)]=function(){return r.warn("StateFieldsMixin "+o("set is "+n)+" is DEPRICATED. Use: "+o("trigger "+n)+"."),this.setState(n,!0)},e.prototype[o("trigger "+n)]=function(){return this.setState(n,!0)},e.prototype[o("toggle "+n)]=function(){return this.setState(n,!this.state[n])}):e.addSetter(n,function(t){return this.setState(n,void 0===t?s:t)}),e.prototype[o("clear "+n)]=function(){return this.setState(n,i)}}));var e},StateFieldsMixin.stateField=n,StateFieldsMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c={}.hasOwnProperty,h=[].slice;u=n(42),r=u.formattedInspect,e=u.defineModule,a=u.isString,o=u.isArray,u.log,u.object,i=u.each,s=u.isPlainObject,u.merge,l=u.mergeInto,e(t,function(){return function(t){return function(e){var n;function PropFieldsMixin(){return PropFieldsMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PropFieldsMixin,t),function(t,e){return{default:e}},PropFieldsMixin.extendableProperty({propFields:null,extend:function(t,e){return l(null!=t?t:{},e)}}),PropFieldsMixin.propFields=n=function(){var t,e,n,l,u,c,p;if(n=arguments[0],t=2<=arguments.length?h.call(arguments,1):[],a(n))this.propFields(((c={})[""+n]=null,c));else if(o(n))for(l=0,u=n.length;l<u;l++)e=n[l],this.propFields(e);else{if(!s)throw new Error("invalid propFields type: "+r(n));this.extendPropFields(n),i(n,(p=this,function(t,e){return p.addGetter(e,function(){return this.props[e]})}))}if(t.length>0)return this.propFields(t)},PropFieldsMixin.propField=n,PropFieldsMixin.prototype._preprocessProps=function(t){var e,n,i,r;if(i=this.getPropFields()){for(e in n={},i)r=i[e],n[e]=r;for(e in t)r=t[e],n[e]=r;return n}return t},PropFieldsMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d={}.hasOwnProperty;(h=n(42)).objectHasKeys,p=h.toInspectedObjects,l=h.log,h.globalCount,h.time,h.stackTime,h.BaseObject,h.shallowClone,h.inspect,a=h.keepIfRubyTrue,h.stackTime,h.isPlainObject,h.isWebWorker,u=h.objectDiff,h.Browser,h.merge,e=h.Promise,c=h.propsEq,s=h.defineModule,r=h.compactFlattenAllFast,o=h.customCompactFlattenFast,i=n(495),s(t,function(t){var n,s;function VirtualElement(t,e,i){VirtualElement.created++,this.elementClassName=t,VirtualElement.__super__.constructor.call(this,e||s),this.children=null!=i?this._validateChildren(o(i,a)):n}return function(t,e){for(var n in e)d.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(VirtualElement,i),VirtualElement.resetCounters=function(){return this.created=0,this.instantiated=0},VirtualElement.resetCounters(),VirtualElement.getCounters=function(){return{created:this.created,instantiated:this.instantiated}},s={},n=[],VirtualElement.getter({inspectedName:function(){var t;return this,t=this.key,"Virtual-"+this.elementClassName+(t?"-"+t:"")},inspectedObjects:function(){var t;return(t={})[""+this.inspectedName]=this.inspectedObjectsContents,t},inspectedObjectsContents:function(){return this.children.length>0?r({props:this.props},p(this.children)):{props:this.props}}}),VirtualElement.prototype.withElement=function(t){return new e((n=this,function(e){return e(t(n.element))}));var n},VirtualElement.prototype._updateElementProps=function(t){},VirtualElement.prototype._setElementChildren=function(t){},VirtualElement.prototype._newElement=function(t,e,n,i){return t},VirtualElement.prototype._newErrorElement=function(){return null},VirtualElement.prototype._findOldChildToUpdate=function(t){var e,n,i,r,o;for(e=n=0,i=(o=this.children).length;n<i;e=++n)if((r=o[e])&&r._canUpdateFrom(t))return o[e]=null,r;return null},VirtualElement.prototype._canUpdateFrom=function(t){return this.elementClassName===t.elementClassName&&this.key===t.key},VirtualElement.prototype._fastUpdateChildren=function(t){var e,n,i,r,o,s;if((s=this.children).length!==t.length)return!1;for(e=n=0,r=s.length;n<r;e=++n)if(!s[e]._canUpdateFrom(t[e]))return!1;for(e=i=0,o=s.length;i<o;e=++i)s[e]._updateFrom(t[e]);return!0},VirtualElement.prototype._slowUpdateChildren=function(t){var e,n,i,r,o,s,a,l,u;for(u=this.children,n=function(){var e,n,o;for(o=[],r=e=0,n=t.length;e<n;r=++e)a=t[r],i=(l=this._findOldChildToUpdate(a))?t[r]=l._updateFrom(a):a._instantiate(this._parentComponent),o.push(i.element);return o}.call(this),o=0,s=u.length;o<s;o++)(e=u[o])&&e._unmount();return this._setElementChildren(n),this.children=t},VirtualElement.prototype._updateChildren=function(t){return!this._fastUpdateChildren(t)&&(this._slowUpdateChildren(t),!0)},VirtualElement.prototype._unmount=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.children).length;e<n;e++)t=i[e],r.push(t._unmount());return r},VirtualElement.prototype._updateFrom=function(t){if(VirtualElement.__super__._updateFrom.apply(this,arguments),this.element)return this._updateElementProps(t.props),this._updateChildren(t.children),this},VirtualElement.prototype._instantiate=function(t,e){var n,i,r,o;return VirtualElement.__super__._instantiate.apply(this,arguments),VirtualElement.instantiated++,i=function(){var e,i,s,a;for(s=this.children,a=[],r=e=0,i=s.length;e<i;r=++e){n=s[r];try{n._instantiate(t),a.push(n.element)}catch(t){o=t,l.error(o),l.error({"Error instantiating child":{childIndex:r,error:o,child:n,elementClassName:this.elementClassName,props:this.props}}),a.push(this._newErrorElement())}}return a}.call(this),this.element=this._newElement(this.elementClassName,this.props,i,e),this},VirtualElement.prototype._updateElementPropsHelper=function(t,e,n){var i,r,o,s,a;return a=this.getPropsLength(),s=this.props,o=0,r=function(){return o++},((i=this.setPropsLength(u(t,s,e,n,e,r,c)))!==o||a!==i)&&(this.props=this._rawProps=t,!0)},VirtualElement}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o={}.hasOwnProperty;r=n(160),i=n(494),t.exports=function(t){function HotStyleProps(){return HotStyleProps.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(HotStyleProps,r.BaseObject),HotStyleProps.postCreate=function(t){return t.hotReloaded&&i.rerenderAll(),HotStyleProps.__super__.constructor.postCreate.apply(this,arguments)},HotStyleProps}()},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f;(p=n(42)).merge,l=p.log,p.object,u=p.mergeInto,a=p.isString,o=n(192).createObjectTreeFactories,(d=n(492)).VirtualElement,c=d.objectTreeFactoryOptions,s=n(505).getNextPageIndexes,r=n(492).VirtualNode,f="BitmapElement BlurElement CanvasElement ShapeElement Element FillElement OutlineElement PagingScrollElement RectangleElement ShadowElement TextElement TextInputElement ScrollElement FilterElement",h=c.postProcessProps,i=n(341).Macros,c.preprocessElement=function(t,e){var n,o;return a(t)?(n=i[t])?n:(l.warn("ArtReact-ArtEngine: string '"+t.slice(0,20)+"' didn't match any macros. Implicit-text children are DEPRICATED. Use text: 'string'. Currently rendering: "+((null!=(o=r.currentlyRendering)?o.inspectedName:void 0)||"none")+". Factory: "+e.inspect()),{_textFromString:t}):t},t.exports=function(){function Aim(){}return Aim.createVirtualElementFactories=function(t,e){return null==e&&(e=f),u(this,o(c,e,function(e){return function(n,i){return new t(e,h(n),i)}})),this.bindHelperFunctions(),this},Aim.bindHelperFunctions=function(){return this.PagingScrollElement.getNextPageIndexes=s},Aim}()},function(t,e,n){var i,r,o,s;(s=n(42)).log,r=s.max,o=s.min,i=s.bound,t.exports=function(){function PagingScrollElement(){}return PagingScrollElement.getNextPageIndexes=function(t,e,n,s,a,l,u){var c,h,p,d,f,m;return null==u&&(u=0),h=t.firstPageIndex,p=t.lastPageIndex,n=i(u,null!=n?n:0,l),m=o(s/2|0,e+a),d=i(u,n-m,l),0<(c=s-((f=i(u,n+m,l))-d))&&(h<d&&(c=s-(f-(d=r(h,d-c)))),0<c&&p>f&&(f=o(p,f+c))),h=i(u,d,l),p=i(u,f,l),h===t.firstPageIndex&&p===t.lastPageIndex?null:{firstPageIndex:h,focusedPageIndex:n,lastPageIndex:p}},PagingScrollElement}()},function(t,e,n){n(341),n(484),n(507),t.exports=n(522)},function(t,e,n){(t.exports=n(508)).includeInNamespace(n(514)).addModules({FluxComponent:n(515)})},function(t,e,n){t.exports=n(509).addNamespace("React",class React extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(510).addNamespace("Flux",class Flux extends Neptune.PackageNamespace{}._configureNamespace(n(511))),n(512),n(513)},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Art"),n(509)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-react":"*"},"devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","mocha":"^6.2.0","mock-fs":"^4.10.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"license":"ISC","name":"art-flux","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"1.22.1"}')},function(t,e,n){t.exports=n(509).addNamespace("Core",class Core extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(509).addNamespace("Models",class Models extends Neptune.PackageNamespace{})},function(t,e,n){n(508).namespace.includeInNamespace({FluxComponent:n(515)})},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S={}.hasOwnProperty,b=[].slice;s=n(160),r=n(516),i=(y=Neptune.Art.React).Component,y.createComponentFactory,c=s.defineModule,s.BaseObject,s.nextTick,s.mergeInfo,g=s.log,f=s.isPlainObject,m=s.isString,d=s.isFunction,p=s.inspect,s.time,s.globalCount,s.rubyTrue,s.rubyFalse,u=s.compactFlatten,l=s.Validator,h=s.formattedInspect,c=s.defineModule,e=s.CommunicationStatus,a=r.ModelRegistry,o=r.FluxSubscriptionsMixin,e.pending,v=e.success,c(t,function(t){var e,n;function FluxComponent(){FluxComponent.__super__.constructor.apply(this,arguments),this.class._prepareSubscriptions()}return function(t,e){for(var n in e)S.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(FluxComponent,o(i)),FluxComponent.abstractClass(),FluxComponent.prototype._componentDidHotReload=function(){return this.unsubscribeAll(),this._updateAllSubscriptions(),FluxComponent.__super__._componentDidHotReload.apply(this,arguments)},FluxComponent.postCreateConcreteClass=function(t){var e;return e=t.hotReloaded,this.prototype.subscriptions&&this.subscriptions(this.prototype.subscriptions),this._subscriptionsPrepared=!1,e&&this._prepareSubscriptions(),FluxComponent.__super__.constructor.postCreateConcreteClass.apply(this,arguments)},FluxComponent.subscriptions=function(){var t,e,n,i,r,o,s,a,l,c,h,p,d,g;for(e=1<=arguments.length?b.call(arguments,0):[],r=0,s=(l=u(e)).length;r<s;r++)if(t=l[r],f(p=t))for(h in n=function(t){return function(e,n){return t._addSubscription(e,n)}}(this),p)g=p[h],n(h,g);else if(m(d=t))for(c=d.match(/[_a-z][._a-z0-9]*/gi),i=function(t){return function(e){var n,i,r;return(n=e.match(/([_a-z0-9]+)\.([_a-z0-9]+)/i))?(n[0],i=n[1],h=n[2],t._addSubscription(h,{model:i})):(r=e+"Id",t._addSubscription(e,{key:function(t){var n;return(null!=(n=t[e])?n.id:void 0)||t[r]}}))}}(this),o=0,a=c.length;o<a;o++)i(c[o]);return null},FluxComponent.prototype._preprocessProps=function(t){return this._updateAllSubscriptions(t=FluxComponent.__super__._preprocessProps.apply(this,arguments)),t},FluxComponent.prototype.componentWillUnmount=function(){return FluxComponent.__super__.componentWillUnmount.apply(this,arguments),this.unsubscribeAll()},FluxComponent.extendableProperty({subscriptionProperties:{}}),n=new l({stateField:"present string",model:{required:{validate:function(t){return d(t)||m(t)}}},key:{required:{validate:function(t){return"undefined"!==t}}}}),FluxComponent._normalizeSubscriptionOptions=e=function(t,e){var n;return f(e)?(n=e.key,{stateField:t,model:e.model||t,key:e.hasOwnProperty("key")?n:t}):{stateField:t,model:t,key:e}},FluxComponent._addSubscription=function(t,i){var r,o,s,a;if(i=e(t,i),n.validate(i),this.getSubscriptionProperties()[t])throw new Error("subscription already defined for: "+h({stateField:t}));if(this.extendSubscriptionProperties(t,i),r=/element/,!t.match(r))return this.addGetter(t,function(){return this.state[t]}),this.addGetter(a=t+"Status",function(){return this.state[a]}),this.addGetter(s=t+"Progress",function(){return this.state[s]}),this.addGetter(o=t+"FailureInfo",function(){return this.state[o]})},FluxComponent._prepareSubscription=function(t){var e,n,i,r,o;if(o=t.stateField,i=t.model,n=t.key,!i)throw new Error("no model specified in subscription: "+p({stateField:o,model:i,class:this.name,subscription:t}));if(m(i)&&(r=i,!(i=a.models[r])))throw console.error(e=this.getName()+"::subscriptions() model '"+r+"' not registered (component = "+this.getNamespacePath()+")"),new Error(e);return t.model=i,t.keyFunction=d(n)?n:function(){return n}},FluxComponent._prepareSubscriptions=function(){var t,e,n,i;if(!this._subscriptionsPrepared){for(n in this._subscriptionsPrepared=!0,e=[],t=this.getSubscriptionProperties())i=t[n],e.push(this._prepareSubscription(i));return e}},FluxComponent.prototype._toFluxKey=function(t,e,n,i){var r;return null==e&&(e=null!=(r=i[t])?r.id:void 0),null!=e?n.toKeyString(e):null},FluxComponent.prototype._updateSubscription=function(t,e,n,i){var r;return this.subscribe(t,n.modelName,e,{stateField:t,initialFluxRecord:(r=i[t])?{status:v,data:r}:void 0})},FluxComponent.prototype._updateAllSubscriptions=function(t){var e,n,i,r,o,s;for(o in null==t&&(t=this.props),r=this.class.getSubscriptionProperties())s=r[o],n=s.keyFunction,i=s.model,i=function(){try{return d(i)?i(t):i}catch(t){return g({"UpdateSubscription modelFunction error":{FluxComponent:this,stateField:o,model:i,subscriptionProps:s,error:t}}),null}}.call(this),m(i)&&((i=this.models[i])||console.error("Could not find model named "+p(i)+" for subscription in component "+this.inspectedName)),i&&(e=function(){try{return n(t)}catch(t){return g({"UpdateSubscription keyFunction error":{FluxComponent:this,stateField:o,model:i,subscriptionProps:s,error:t}}),null}}.call(this),this._updateSubscription(o,e,i,t));return null},FluxComponent}())}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(512)).addModules({FluxEntry:n(517),FluxModel:n(518),FluxStore:n(519),FluxSubscriptionsMixin:n(521),ModelRegistry:n(520)})},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P={}.hasOwnProperty;(y=n(42)).log,y.merge,S=y.removeFirstMatch,g=y.pushIfNotPresent,y.Epoch,y.shallowClone,l=y.inspect,y.Unique,y.clone,c=y.isPlainObject,m=y.propsEq,r=y.defineModule,w=y.timeoutAt,p=y.min,x=y.toSeconds,s=y.floatEq,e=n(96).BaseObject,v=n(141),f=v.pending,v.success,o=v.failure,h=v.isSuccess,u=v.isFailure,d=v.networkFailure,b=v.serverFailure,i=null,a=function(){return null!=i?i:i=Neptune.Art.Flux.fluxStore},r(t,function(t){var n,i,r;function FluxEntry(t,e){FluxEntry.__super__.constructor.apply(this,arguments),this._model=Neptune.Art.Flux.models[t],this._autoReload=this._model.autoReloadEnabled,this._updatedAt=this._createdAt=x(),this._reloadAt=this._lastSuccessfulLoadAt=null,this._tryCount=0,this._fluxRecord={key:e,modelName:t,status:f,updateAt:new Date},this._subscribers=[],this._previousFluxRecord=null}return function(t,e){for(var n in e)P.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(FluxEntry,e),FluxEntry.warnCantSetField=i=function(t,e,n){var i,r;if(i=t[n],r=null!=e?e[n]:void 0,t.hasOwnProperty(n)&&i!==r)return console.warn(FluxEntry.namespacePath+": Do not put/post the '"+n+"' field (new value == "+l(i)+", old value == "+l(r)+"). Ignored.")},FluxEntry.warnUnsettableFields=r=function(t,e){return i(t,e,"key"),i(t,e,"modelName")},FluxEntry.property("createdAt updatedAt reloadAt lastSuccessfulLoadAt tryCount"),FluxEntry.getter("previousFluxRecord fluxRecord subscribers model autoReload",{dataChanged:function(){var t,e;return!m(null!=(t=this._fluxRecord)?t.data:void 0,null!=(e=this._previousFluxRecord)?e.data:void 0)},fluxRecordChanged:function(){return!m(this._fluxRecord,this._previousFluxRecord)},subscriberCount:function(){return this._subscribers.length},key:function(){return this._fluxRecord.key},modelName:function(){return this._fluxRecord.modelName},status:function(){return this._fluxRecord.status},reloadAt:function(){return this._fluxRecord.reloadAt}}),FluxEntry.setter({fluxRecord:function(t){var e,n,i;if(!c(t))throw new Error("fluxRecord must be an object");if(r(t,this._fluxRecord),e=(i=this._fluxRecord).key,n=i.modelName,this._fluxRecord=t,t.key=e,t.modelName=n,null==t.status&&(t.status=f),t.createdAt=this._createdAt,t.updatedAt=this._updatedAt=x(),this._autoReload)return this._updateAutoReloadFields()}}),FluxEntry.prototype._updateAutoReloadFields=function(){var t;return t=function(){if(h(this.status))return this.lastSuccessfulLoadAt=this._updatedAt,this.tryCount=1,this.model.getStaleDataReloadSeconds();if(u(this.status))switch(this.tryCount+=1,this.status){case d:return this.nextNetworkFailureRetryDelay;case b:case o:return this.nextServerFailureRetryDelay}}.call(this),this._fluxRecord.lastSuccessfulLoadAt=this.lastSuccessfulLoadAt,this._fluxRecord.tryCount=this.tryCount,this.reloadAt=t>0?this._updatedAt+t:null},FluxEntry.prototype.reload=function(){return this.model.reload(this.key)},FluxEntry.setter({reloadAt:function(t){var e,i,r,o,s,a,l,u,c;if(0<t)return o=(e=t-(a=x()))-(u=e<80?0:15),r=e+u,this._reloadAt&&(l=this._reloadAt-a)>o&&l<r||(this._reloadAt=t=a+o+(r-o)*Math.random(),s=(c=this).modelName,i=c.key,n(s,i,t)),this._fluxRecord.reloadAt=this._reloadAt}}),n=function(t,e,n){return w(n,function(){var i;if((i=a()._getEntry(t,e))&&s(n,i.reloadAt))return i.reload()})},2,FluxEntry.getter({age:function(){var t;return{reload:(t=x())-this.reloadAt|0,created:t-this.createdAt|0,updated:t-this.updatedAt|0,lastSuccessfulLoad:t-this.lastSuccessfulLoadAt|0}},nextNetworkFailureRetryDelay:function(){var t,e;if(0<(t=this.model.getMinNetworkFailureReloadSeconds()))return p(t*Math.pow(null!=(e=this.tryCount)?e:1,2),this.model.getMaxNetworkFailureReloadSeconds())},nextServerFailureRetryDelay:function(){var t,e;if(0<(t=this.model.getMinServerFailureReloadSeconds()))return p(t*Math.pow(null!=(e=this.tryCount)?e:1,2),this.model.getMaxServerFailureReloadSeconds())}}),FluxEntry.getter({plainStructure:function(){return{fluxRecord:this._fluxRecord,subscribers:this._subscribers}},hasSubscribers:function(){return this._subscribers.length>0}}),FluxEntry.prototype._merge=function(t){if(!c(t))throw new Error("fluxRecord must be an object");return this._fluxRecord=t._fluxRecord,this._subscribers=this._subscribers.concat(t._subscribers)},FluxEntry.prototype._notifySubscribers=function(){var t,e,n;if(this._previousFluxRecord){for(t=0,e=(n=this._subscribers).length;t<e;t++)(0,n[t])(this._fluxRecord,this._previousFluxRecord);return this._previousFluxRecord=null}},FluxEntry.prototype._updateFluxRecord=function(t){if(this._previousFluxRecord||(this._previousFluxRecord=this._fluxRecord),this.setFluxRecord(("function"==typeof t?t(this._fluxRecord):void 0)||{}),m(this._fluxRecord,this._previousFluxRecord))return this._previousFluxRecord=null},FluxEntry.prototype._subscribe=function(t){return g(this._subscribers,t)},FluxEntry.prototype._unsubscribe=function(t){return S(this._subscribers,t)},FluxEntry}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P={}.hasOwnProperty,C=[].slice;b=(r=n(160)).CommunicationStatus,v=b.missing,w=b.success,S=b.pending,c=b.failure,x=b.validStatus,b.defineModule,d=b.isFailure,h=n(519).fluxStore,s=n(520),g=r.log,e=r.BaseObject,u=r.decapitalize,r.pluralize,y=r.merge,r.shallowClone,m=r.isString,r.emailRegexp,r.urlRegexp,r.isNumber,r.nextTick,r.capitalize,r.inspect,r.isFunction,r.pureMerge,r.isoDateRegexp,r.time,r.globalCount,l=r.compactFlatten,o=r.InstanceFunctionBindingMixin,a=r.Promise,p=r.formattedInspect,f=r.isPlainObject,i=r.ErrorWithInfo,(0,r.defineModule)(t,function(t){function FluxModel(t){FluxModel.__super__.constructor.apply(this,arguments),this._name=t||u(this.class.getName()),this.bindFunctionsToInstance(),this._activeLoadingRequests={}}return function(t,e){for(var n in e)P.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(FluxModel,o(e)),FluxModel.abstractClass(),FluxModel.declarable({staleDataReloadSeconds:null,minNetworkFailureReloadSeconds:null,maxNetworkFailureReloadSeconds:Infinity,minServerFailureReloadSeconds:null,maxServerFailureReloadSeconds:Infinity}),FluxModel.getter({autoReloadEnabled:function(){return this.getStaleDataReloadSeconds()>0||this.getMinNetworkFailureReloadSeconds()>0||this.getMinServerFailureReloadSeconds()>0}}),FluxModel.register=function(){return this.singletonClass(),s.register(this.getSingleton())},FluxModel.prototype.register=function(){return s.register(this)},FluxModel.postCreateConcreteClass=function(t){return t.hotReloaded?this.singleton.bindFunctionsToInstance():this.register(),FluxModel.__super__.constructor.postCreateConcreteClass.apply(this,arguments)},FluxModel.aliases=function(){var t;return t=1<=arguments.length?C.call(arguments,0):[],this._aliases=l([t,this._aliases]),null},FluxModel._aliases=[],FluxModel.prototype.onNextReady=function(t){return h.onNextReady(t)},FluxModel.classGetter({models:function(){return s.models},fluxStore:function(){return h}}),FluxModel.getter({models:function(){return s.models},fluxStore:function(){return h},singlesModel:function(){return this._singlesModel||this},fluxStoreEntries:function(){return h.getEntriesForModel(this.name)}}),FluxModel.prototype.subscribe=function(t,e){return g.error("DEPRICATED - use FluxSubscriptionsMixin and it's subscribe"),h.subscribe(this._name,t,e)},FluxModel.getter("name",{modelName:function(){return this._name}}),FluxModel.prototype.load=function(t){return this.loadData||this.loadFluxRecord?(this.loadPromise(t),null):this.updateFluxStore(t,{status:v})},FluxModel.prototype.loadPromise=function(t){var e,n;return(e=this._activeLoadingRequests[t])?e:(e=this.loadData?a.then((n=this,function(){return n.loadingRecord(t)})).then(function(e){return function(){return e.loadData(t)}}(this)).then(function(e){return function(n){return e.updateFluxStore(t,null!=n?{status:w,data:n}:{status:v})}}(this)).catch(function(e){return function(n){var i,r,o;return o=x(o=(null!=n&&null!=(r=n.info)?r.status:void 0)||n)?o:c,i=null!=n?n.info:void 0,n instanceof Error||(n=null),e.updateFluxStore(t,{status:o,info:i,error:n})}}(this)):this.loadFluxRecord?this.loadFluxRecord(t).then(function(e){return function(n){return e.updateFluxStore(t,n)}}(this)).catch(function(e){return function(n){return e.updateFluxStore(t,{status:c,error:n})}}(this)):a.resolve(this.updateFluxStore(t,{status:v})),this._activeLoadingRequests[t]=e.then(function(t){return function(e){return t.onNextReady(),e}}(this)).then(function(e){return function(n){return e._activeLoadingRequests[t]=null,n}}(this)))},FluxModel.prototype.reload=function(t){return this.loadData||this.loadFluxRecord?this.loadPromise(t):this.load(t)},FluxModel.prototype.loadingRecord=function(t){var e,n;if(d(null!=(n=e=this.fluxStoreGet(t))?n.status:void 0))return this.updateFluxStore(t,y(e,{status:S}))},FluxModel.prototype.updateFluxStore=function(t,e){return h.update(this._name,t,e)},FluxModel.prototype.onModelRegistered=function(t){return s.onModelRegistered(t)},FluxModel.prototype.fluxStoreGet=function(t){return h.get(this._name,this.toKeyString(t))},FluxModel.prototype.get=function(t){return t=this.toKeyString(t),a.then((e=this,function(){var n;return(n=e.fluxStoreGet(t))&&n.status===S&&(n=null),n||e.loadPromise(t)})).then(function(t){var e,n;return n=t.status,e=t.data,n!==w&&new i("FluxModel#get: Error getting data. Status: "+n+".",{status:n,fluxRecord:t}),e});var e},FluxModel.prototype.toKeyString=function(t){if(f(t))return this.dataToKeyString(t);if(m(t))return t;throw new Error("FluxModel "+this.name+": Must implement custom toKeyString for non-string keys like: "+p(t))},FluxModel.prototype.dataToKeyString=function(t){throw new Error("FluxModel "+this.name+": must override dataToKeyString for converting objects to key-strings.")},FluxModel.prototype.fluxStoreEntryUpdated=function(t){},FluxModel.prototype.fluxStoreEntryAdded=function(t){},FluxModel.prototype.fluxStoreEntryRemoved=function(t){},FluxModel.prototype._localStoreKey=function(t){return"fluxModel:"+this._name+":"+t},FluxModel.prototype._localStoreGet=function(t){var e;return(e=localStorage.getItem(this._localStoreKey(t)))?JSON.parse(e):null},FluxModel.prototype._localStoreSet=function(t,e){return localStorage.setItem(this._localStoreKey(t),JSON.stringify(e))},FluxModel}())}).call(this,n(2)(t))},function(t,e,n){(function(t,e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C={}.hasOwnProperty;(v=n(42)).merge,v.removeFirstMatch,y=v.pushIfNotPresent,v.removeFirstMatch,d=v.log,h=v.isFunction,v.Unique,v.clone,v.consistentJsonStringify,p=v.isString,v.globalCount,v.time,c=v.inspect,v.object,l=v.defineModule,v.currentSecond,f=v.min,v.max,P=v.toSeconds,v.ReschedulableTimer,S=n(141),x=S.success,g=S.pending,m=S.missing,u=S.failure,i=n(124).EpochClass,r=n(517),a=n(520),l(t,o=function(t){function FluxStore(){FluxStore.__super__.constructor.apply(this,arguments),this._reset()}return function(t,e){for(var n in e)C.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(FluxStore,i),FluxStore.singletonClass(),FluxStore.getter("length"),FluxStore.prototype.get=function(t,e){var n;return null!=(n=this._getEntry(t,e))?n.fluxRecord:void 0},FluxStore.prototype.getSubscribers=function(t,e){var n;return null!=(n=this._getEntry(t,e))?n.subscribers:void 0},FluxStore.prototype.getHasSubscribers=function(t,e){var n;return!!(null!=(n=this._getEntry(t,e))?n.getHasSubscribers():void 0)},FluxStore.prototype.getEntriesForModel=function(t){return this._entriesByModelName[t]},FluxStore.prototype.subscribe=function(t,e,n,i){return this._queueChange({modelName:t,key:e,addSubscriber:n}),this._vivifyAndLoadEntry(t,e,i).fluxRecord},FluxStore.prototype.unsubscribe=function(t,e,n){return this._queueChange({modelName:t,key:e,removeSubscriber:n})},FluxStore.prototype.update=function(t,e,n){if(!p(e))throw new Error("key must be a string. Inputs: "+c({modelName:t,key:e}));return this._queueChange({modelName:t,key:e,updateFunction:h(n)?n:function(t){return n}}),n},FluxStore.getter({status:function(){var t,e,n,i,r,o,s,a,l,u,c;for(o in i=0,s=0,n=0,c=0,a=Infinity,l=P(),u=this._entriesByModelName)for(r in s++,t=u[o])n++,i+=(e=t[r]).subscriberCount,e.reloadAt>l&&(c++,a=Math.ceil(f(a,e.reloadAt-l)));return{entryCount:n,entrySubscribers:i,modelCount:s,reloadsPending:c,nextReload:a}}}),FluxStore.prototype.getEntriesByStatus=function(t){var e,n,i,r,o,s,a;for(o in s={},a=this._entriesByModelName)n=a[o],(i=function(){var i;for(r in i=[],n)(e=n[r]).status===t&&i.push(e);return i}()).length>0&&(s[o]=i);return s},FluxStore.prototype._reset=function(){return this._length=0,this._entriesByModelName={},this._addedEntries=[]},FluxStore.prototype._getEntriesForModelName=function(t){var e;return(e=this._entriesByModelName)[t]||(e[t]={})},FluxStore.prototype._getEntry=function(t,e){if(!p(t))throw new Error("Expected 'modelName' to be a String. Inputs: "+c({key:e,modelName:t}));if(!p(e))throw new Error("Expected 'key' to be a String. Inputs: "+c({key:e,modelName:t}));return this._getEntriesForModelName(t)[e]},FluxStore.prototype._addEntry=function(t,e){var n;return this._length++,n=this._getEntriesForModelName(t)[e]=new r(t,e),y(this._addedEntries,n),n},FluxStore.prototype._removeEntry=function(t){return this._length--,delete this._getEntriesForModelName(t.fluxRecord.modelName)[t.fluxRecord.key]},FluxStore.prototype._vivifyAndLoadEntry=function(t,n,i){var r,o,s,a;return(o=this._getEntry(t,n))||(o=this._addEntry(t,n),i||(r=null!=(s=e.artFluxInit)&&null!=(a=s[t])?a[n]:void 0)&&(i={status:x,data:r}),i?o.setFluxRecord(i):this._loadKeyWithRetriesWithExponentalFalloff(t,n,o)),o},FluxStore.prototype._loadKeyWithRetriesWithExponentalFalloff=function(t,e,n){var i,r,o,s,l,c,h;if(c=250,!(l=a.models[t]))return console.warn("ArtFlux: there is no model registered with the name: "+t+". FluxEntry for "+t+":"+e+" will forever be status: pending.");h=this,o=function(n){if(n.status!==g&&n.status!==x&&n.status!==m)return h._getEntry(t,e)?(c<6e4&&(c*=2),console.warn("FluxStore retry is disabled")):d({FluxStore_get_retry:{model:t,key:e,status:n.status,aborting:"no longer have subscribers"}})};try{if(r=l.load(e,o))return n.setFluxRecord(r)}catch(r){return s="Error loading record from model '"+t+"' for key '"+e+"'. Error: "+(i=r),console.error(s,i.stack),n.setFluxRecord({status:u,errorObject:i,message:s})}},FluxStore.prototype._vivifyEntry=function(t,e){return this._getEntry(t,e)||this._addEntry(t,e)},FluxStore.prototype._queueChange=function(t){var e,n;if(n=t.modelName,e=t.key,!p(n))throw new Error("Expected 'modelName' to be a String. Inputs: "+c({key:e,modelName:n}));if(!p(e))throw new Error("Expected 'key' to be a String. Inputs: "+c({key:e,modelName:n}));return this.queueItem(t),null},FluxStore.prototype.processEpochItems=function(t){var e,n,i,r,o,s,l,u,c,h,p,d,f,m,g,v,S,b,w,x,P,C;for(C=[],x=[],i=0,u=t.length;i<u;i++)d=(m=t[i]).modelName,s=m.key,m.removeEntry,e=m.addSubscriber,w=m.removeSubscriber,P=m.updateFunction,n=this._vivifyEntry(d,s),P?n._updateFluxRecord(P):e?n._subscribe(e):w&&n._unsubscribe(w),y(C,n);for(f=a.models,r=0,c=C.length;r<c;r++)null!=(g=f[(n=C[r]).getModelName()])&&g.fluxStoreEntryUpdated(n),n._notifySubscribers(),0===n.subscribers.length&&(y(x,n),this._removeEntry(n));for(o=0,h=(v=this._addedEntries).length;o<h;o++)null!=(S=f[(n=v[o]).getModelName()])&&S.fluxStoreEntryAdded(n);for(l=0,p=x.length;l<p;l++)null!=(b=f[(n=x[l]).getModelName()])&&b.fluxStoreEntryRemoved(n);return this._addedEntries=[],null},FluxStore}()),(s=null!=(b=Neptune.Art.Engine)&&null!=(w=b.Core)?w.GlobalEpochCycle:void 0)&&s.singleton.includeFlux(o.singleton)}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t,e){var i,r,o,s,a,l={}.hasOwnProperty;a=n(160),r=a.Promise,a.timeout,a.log,s=a.formattedInspect,i=a.BaseObject,o=a.decapitalize,a.isClass,a.inspect,(0,a.defineModule)(t,function(t){var n,a;function ModelRegistry(){return ModelRegistry.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ModelRegistry,i),ModelRegistry.models=e.artFluxModels=a={},ModelRegistry._modelRegistrationPromiseResolvers={},n=function(t,e){if(a[t])throw new Error("ArtFlux.ModelRegistry: model already registered for name: '"+t+"'. "+s({alreadyRegisteredModel:a[t],attemptingToRegisterModel:e,name:t}));return a[t]=e},ModelRegistry.register=function(t){var e,i,r,o,s;for(o=t.modelName,i=0,r=(s=t.class._aliases).length;i<r;i++)e=s[i],n(e,t);return n(o,t),ModelRegistry._modelRegistered(t)},ModelRegistry._modelRegistered=function(t){var e,n,i,r;if(i=t.modelName,r=this._modelRegistrationPromiseResolvers[i])for(e=0,n=r.length;e<n;e++)(0,r[e])(t);return t},ModelRegistry.onModelRegistered=function(t){return new r((e=this,function(n,i){var r,o;return(o=e.models[t])?n(o):((r=e._modelRegistrationPromiseResolvers)[t]||(r[t]=[])).push(n)}));var e},ModelRegistry._singletonName=function(t){return o(t.name)},ModelRegistry._reset=function(){var t,e,n,i,r;for(r=[],t=0,n=(i=Object.keys(a)).length;t<n;t++)e=i[t],r.push(delete a[e]);return r},ModelRegistry}())}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d={}.hasOwnProperty;c=n(160),u=c.isString,r=c.defineModule,l=c.isPlainObject,h=c.rubyTrue,e=c.CommunicationStatus,c.log,a=c.isFunction,c.BaseObject,c.nextTick,c.mergeInfo,c.capitalize,c.globalCount,c.time,p=e.success,s=e.isFailure,o=n(519).fluxStore,i=n(520),r(t,function(){return function(t){return function(e){var n;function FluxSubscriptionsMixin(){FluxSubscriptionsMixin.__super__.constructor.apply(this,arguments),this._subscriptions={}}return function(t,e){for(var n in e)d.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(FluxSubscriptionsMixin,t),FluxSubscriptionsMixin.getter({models:function(){return i.models},subscriptions:function(){return this._subscriptions}}),FluxSubscriptionsMixin.prototype.subscribe=function(t,e,n,i){var r,s,c,d,f,m,g,y,v;if(l(r=t)?(t=r.subscriptionKey,e=r.modelName,n=r.key,m=r.stateField,d=r.initialFluxRecord,y=r.updatesCallback,s=r.callback,y||(y=s),t||(t=m||e+" "+n)):(m=i.stateField,d=i.initialFluxRecord,y=i.updatesCallback),!u(t))throw new Error("REQUIRED: subscriptionKey");if(!u(m)&&!a(y))throw new Error("REQUIRED: updatesCallback or stateField");if(this.unsubscribe(t),!h(n)||!e)return this.setStateFromFluxRecord(m,d||{status:p});if(!(f=this.models[e]))throw new Error("No model registered with the name: "+e+". Registered models:\n  "+Object.keys(this.models).join("\n  "));return c=f.toKeyString(n),v=this,g=function(t){return"function"==typeof y&&y(t),v.setStateFromFluxRecord(m,t)},this._subscriptions[t]={modelName:e,fluxKey:c,subscriptionFunction:g},this.setStateFromFluxRecord(m,o.subscribe(e,c,g,d),d)},FluxSubscriptionsMixin.prototype.subscribeOnModelRegistered=function(t,e,n,r){return l(t)&&(e=t.modelName),i.onModelRegistered(e).then((o=this,function(){return o.subscribe(t,e,n,r)}));var o},FluxSubscriptionsMixin.prototype.unsubscribe=function(t){var e,n,i,r;return(i=this._subscriptions[t])&&(r=i.subscriptionFunction,n=i.modelName,e=i.fluxKey,o.unsubscribe(n,e,r),delete this._subscriptions[t]),null},FluxSubscriptionsMixin.prototype.unsubscribeAll=function(){var t,e;for(e in t=this._subscriptions)t[e],this.unsubscribe(e);return null},n=function(t,e){return function(){return o._getEntry(t,e).reload()}},FluxSubscriptionsMixin.prototype.setStateFromFluxRecord=function(t,e,i){var r,o,l,u,c,h,d,f,m,g;return(null!=e?e.status:void 0)!==p&&(null!=i?i.status:void 0)===p&&(e=i),t&&a(this.setState)&&(e&&(m=null!=(c=e.status)?c:null,u=null!=(h=e.progress)?h:null,r=null!=(d=e.data)?d:null),this.setState(t,r),this.setState(t+"Status",m),this.setState(t+"Progress",u),this.setState(t+"FailureInfo",e&&s(m)?(f=e.reloadAt,g=e.tryCount,l=e.modelName,o=e.key,{reloadAt:f,tryCount:g,status:m,retryNow:n(l,o)}):null)),e},FluxSubscriptionsMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(509)).includeInNamespace(n(523)),n(516),n(526)},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u;l=n(160).defineModule,r=(e=n(516)).FluxStore,s=e.ModelRegistry,i=e.FluxModel,o=e.FluxSubscriptionsMixin,u=r.fluxStore,l(t,[{FluxSubscriptionsMixin:o,FluxStore:r,FluxModel:i,ModelRegistry:s,ApplicationState:n(524),models:s.models,fluxStore:u,_reset:function(){return u._reset(),s._reset()},package:a=n(511),version:a.version}])}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_={}.hasOwnProperty;e=n(516),(w=n(42)).lowerCamelCase,C=w.timeout,S=w.object,w.each,w.clone,w.BaseObject,m=w.log,d=w.isString,p=w.isPlainObject,g=w.merge,b=w.propsEq,w.mergeInto,w.Unique,l=w.defineModule,s=w.Promise,w.formattedInspect,w.eq,v=w.neq,c=w.getEnv,h=w.isFunction,r=e.FluxStore,i=e.FluxModel,u=r.fluxStore,(x=n(141)).pending,P=x.success,x.failure,y=x.missing,a=n(525),o=n(160).JsonStore,f=o.jsonStore,l(t,function(t){function ApplicationState(){ApplicationState.__super__.constructor.apply(this,arguments),this._updateAllState(this.state=this._getInitialState())}return function(t,e){for(var n in e)_.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ApplicationState,a(i)),ApplicationState.abstractClass(),ApplicationState.persistant=function(){return this._persistant=!0},ApplicationState.postCreateConcreteClass=function(t){var e,n,i,r,o,s,a,l,u,c;return i=t.hotReloaded,e=t.classModuleState,u=ApplicationState.__super__.constructor.postCreateConcreteClass.apply(this,arguments),i&&(o=e.liveClass,r=e.hotUpdatedFromClass,s=o.getSingleton(),l=(new r).state,n=s.state,a=g(l,n),c=S(a,{when:function(t,e){return n[e]!==t}}),m({"Flux.ApplicationState: model hot-reloaded":{model:s.name,stateDelta:c}}),C(0,function(){return s.setState(c)})),u},ApplicationState.prototype.getInitialState=function(){return{}},ApplicationState.prototype.setState=function(t,e){var n,i,r,o;if(r=!1,h(t))return r=!0,this.replaceState(t(this.state));if(p(i=t))for(n in i)o=i[n],b(this.state[n],o)||(r=!0,this.state[n]=o,this.load(n));else d(t)&&!b(this.state[t],e)&&(r=!0,this.state[t]=e,this.load(t));return r&&(this._updateAllState(),this._saveToLocalStorage()),t},ApplicationState.prototype.removeState=function(t){var e;return this._removeFromFluxStore(t),e=this.state[t],delete this.state[t],this._saveToLocalStorage(),e},ApplicationState.prototype.clearState=function(){var t,e;for(t in e=this.state)e[t],this._removeFromFluxStore(t);return this.state={},this._saveToLocalStorage()},ApplicationState.prototype.resetState=function(){return this.replaceState(this._getInitialState(!1))},ApplicationState.prototype.replaceState=function(t){var e,n;for(e in n=this.state)n[e],t.hasOwnProperty(e)||(this._removeFromFluxStore(e),delete this.state[e]);return this.setState(t)},ApplicationState.prototype.load=function(t,e){var n;return n=t===this.name?{status:P,data:this.savableState}:this.state.hasOwnProperty(t)?{status:P,data:this.state[t]}:{status:y},this.updateFluxStore(t,n),e&&u.onNextReady(function(){return e(n)}),n},ApplicationState.prototype._removeFromFluxStore=function(t){return this.updateFluxStore(t,{status:y})},ApplicationState.prototype.postProcessLoadedState=function(t){return t},ApplicationState.prototype._loadFromLocalStorage=function(){if(this.class._persistant&&!c().resetAppState)return s.then((t=this,function(){return f.getItem(t.localStorageKey)})).then(function(t){return function(e){if((e=t.postProcessLoadedState(e))&&v(e,t.state))return m("ApplicationState "+t.class.name+" loaded"),t.replaceState(g(t.state,e))}}(this));var t},ApplicationState.prototype._updateAllState=function(){return this.load(this.name),this.state},ApplicationState.getter({savableState:function(){return g(this.state)},localStorageKey:function(){return"ApplicationState:"+this.name}}),ApplicationState.prototype._saveToLocalStorage=function(t){if(null==t&&(t=this.state),this.class._persistant)return s.then((e=this,function(){return f.setItem(e.localStorageKey,e.savableState)}));var e},ApplicationState.prototype._getInitialState=function(t){return null==t&&(t=!0),t&&this._loadFromLocalStorage(),g(this.getInitialState(),this.getStateFields())},ApplicationState}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(500))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(513)).addModules({ApplicationState:n(524)})},function(t,e,n){t.exports=n(528)},function(t,e,n){(t.exports=n(529)).includeInNamespace(n(530)).addModules({ArtEryFluxModel:n(531),ArtEryQueryFluxModel:n(532)})},function(t,e,n){t.exports=n(136).addNamespace("Flux",class Flux extends Neptune.PackageNamespace{})},function(t,e,n){var i;(i=n(531)).bindWithArtEry(),t.exports={defineArtEryPipelineFluxModels:i.defineModelsForAllPipelines}},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b=function(t,e){for(var n in e)w.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},w={}.hasOwnProperty;if(!Neptune.Art.Flux)throw new Error("Neptune.Art.Flux not loaded. Please pre-require Flux or Flux/web_worker.");o=(y=Neptune.Art.Flux).FluxModel,m=y.models,e=n(134),i=n(532),v=Neptune.Art.Foundation,c=v.each,v.log,r=v.CommunicationStatus,v.select,v.isString,p=v.isFunction,h=v.fastBind,v.decapitalize,d=v.merge,v.Promise,v.eq,S=v.upperCamelCase,v.arrayWith,v.arrayWithElementReplaced,v.formattedInspect,u=v.defineModule,l=v.createWithPostCreate,v.inspect,a=v.compactFlatten,g=v.object,v.isPlainObject,s=n(156),f=r.missing,r.success,r.pending,u(t,function(t){function ArtEryFluxModel(){ArtEryFluxModel.__super__.constructor.apply(this,arguments),this._updateSerializers={},this._pipeline=this.class._pipeline,this._defineQueryModels(),this._bindPipelineMethods()}return b(ArtEryFluxModel,t),ArtEryFluxModel.abstractClass(),ArtEryFluxModel.createModel=function(t){var e,n,i;if(e=t.aliases,i=t.getName(),!m[i])return n="ArtEryFluxModel:"+i,l(function(r){function AnonymousArtErtFluxModel(){return AnonymousArtErtFluxModel.__super__.constructor.apply(this,arguments)}return b(AnonymousArtErtFluxModel,r),AnonymousArtErtFluxModel._name=S(i),t.keyFields&&AnonymousArtErtFluxModel.keyFields(t.keyFields),AnonymousArtErtFluxModel.pipeline(t),e&&AnonymousArtErtFluxModel.aliases(e),AnonymousArtErtFluxModel.getHotReloadKey=function(){return n},AnonymousArtErtFluxModel}(this.applyMixins(t,ArtEryFluxModel)))},ArtEryFluxModel.applyMixins=function(t,e){var n,i,r;for(n=0,i=(r=a(t.getFluxModelMixins())).length;n<i;n++)e=(0,r[n])(e);return e},ArtEryFluxModel.defineModelsForAllPipelines=function(){var t,n,i,r;for(t in r=[],i=e.pipelines)t===(n=i[t]).getName()&&r.push(ArtEryFluxModel.createModel(n));return r},ArtEryFluxModel.bindWithArtEry=function(){return s.on({register:function(t){var e;return t.name,e=t.pipeline,ArtEryFluxModel.createModel(e)}}),ArtEryFluxModel.defineModelsForAllPipelines()},ArtEryFluxModel.pipeline=function(t){return this._pipeline=t,this._pipeline},ArtEryFluxModel.getter("pipeline"),ArtEryFluxModel.prototype._defineQueryModels=function(){return this._queryModels=g(this._pipeline.queries,(t=this,function(e){return t._createQueryModel(e)}));var t},ArtEryFluxModel.prototype._createQueryModel=function(t){var e,n,r;return e=t.options,r=t.queryName,n=d(e,{_pipeline:this._pipeline,_recordsModel:this,query:function(t){return this._pipeline[r]({key:t,props:{include:"auto"}})}}),new(function(t){var e,i;function ArtEryQueryFluxModelChild(){return ArtEryQueryFluxModelChild.__super__.constructor.apply(this,arguments)}for(e in b(ArtEryQueryFluxModelChild,t),ArtEryQueryFluxModelChild._name=S(r),n)i=n[e],ArtEryQueryFluxModelChild.prototype[e]=i;return ArtEryQueryFluxModelChild}(this.class.applyMixins(this._pipeline,i)))},ArtEryFluxModel.prototype.loadData=function(t){return this._pipeline.get({returnNullIfMissing:!0,key:t,props:{include:"auto"}})},ArtEryFluxModel.prototype.dataUpdated=function(t,e){var n,i,r;return i=null!=(r=this.fluxStoreGet(t))?r.data:void 0,n=d(i,e),this.updateFluxStore(t,function(t){return d(t,{data:d(t.data,e)})}),c(this._queryModels,function(t){var e,r;if(e=i&&t.dataToKeyString(i),r=t.dataToKeyString(n),e&&e!==r&&t.dataDeleted(e,i),r)return t.dataUpdated(r,n)})},ArtEryFluxModel.prototype.dataDeleted=function(t,e){return this.updateFluxStore(t,{status:f}),e&&c(this._queryModels,function(t){var n;return(n=t.toKeyString(e))&&t.dataDeleted(n,e)})},ArtEryFluxModel.prototype._bindPipelineMethods=function(){var t,e,n,i,r;for(e in t=this._pipeline.class.getAbstractPrototype(),i=[],n=this._pipeline)r=n[e],this[e]||t[e]||!p(r)||i.push(this[e]=h(r,this._pipeline));return i},ArtEryFluxModel}(e.KeyFieldsMixin(o)))}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty;o=n(160),i=Neptune.Art.Flux,n(134),p=o.log,e=o.CommunicationStatus,o.select,o.isString,h=o.isArray,o.isFunction,o.decapitalize,d=o.merge,s=o.Promise,o.eq,o.upperCamelCase,a=o.arrayWith,l=o.arrayWithElementReplaced,o.formattedInspect,f=o.propsEq,c=o.defineModule,u=o.arrayWithout,e.missing,e.success,e.pending,r=i.FluxModel,c(t,function(t){function ArtEryQueryFluxModel(){ArtEryQueryFluxModel.__super__.constructor.call(this,null),this.register()}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ArtEryQueryFluxModel,r),ArtEryQueryFluxModel.abstractClass(),ArtEryQueryFluxModel.prototype.loadData=function(t){return s.resolve(this.query(t,this.pipeline)).then((e=this,function(t){return e.localSort(t)}));var e},ArtEryQueryFluxModel.setter("recordsModel pipeline"),ArtEryQueryFluxModel.getter("recordsModel pipeline"),ArtEryQueryFluxModel.prototype.query=function(t){return[]},ArtEryQueryFluxModel.prototype.localSort=function(t){return t},ArtEryQueryFluxModel.prototype.localMerge=function(t,e,n){var i,r,o,s,c;if(null==t&&(t=[]),!e&&!n)return t;if(null!=t&&!h(t))return t;if(!((null!=t?t.length:void 0)>0))return n?[]:[e];for(c=this.recordsModel.toKeyString(e),r=o=0,s=t.length;o<s;r=++o)if(i=t[r],c===this.recordsModel.toKeyString(i))return n?u(t,r):f(i,e)?(p("saved 1 fluxStore update due to no-change check! (model: "+this.name+", record-key: "+c+")"),null):l(t,e,r);return n?t:a(t,e)},ArtEryQueryFluxModel.prototype._updateFluxStoreIfExists=function(t,e,n){if(this.fluxStoreGet(t))return this.updateFluxStore(t,(i=this,function(t){var r;return(r=i.localMerge(t.data,e,n))?d(t,{data:i.localSort(r)}):t}));var i},ArtEryQueryFluxModel.prototype.dataUpdated=function(t,e){return this._updateFluxStoreIfExists(t,e)},ArtEryQueryFluxModel.prototype.dataDeleted=function(t,e){return this._updateFluxStoreIfExists(t,e,!0)},ArtEryQueryFluxModel}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(534))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(535)).addModules({PointerActionsMixin:n(536),PollingComponentMixin:n(537)})},function(t,e,n){t.exports=n(487).addNamespace("Mixins",class Mixins extends Neptune.PackageNamespace{})},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty;s=n(42),a=s.timeout,e=s.defineModule,i=s.log,r=s.merge,o=n(313).point,l=n(212).simpleBrowserInfo.touch,e(t,function(){return function(t){return function(e){function PointerActionsMixin(){this.dragPointerMoveHandler=u(this.dragPointerMoveHandler,this),this._drag=u(this._drag,this),this.dragPointerDownHandler=u(this.dragPointerDownHandler,this),this.pointerUpInsideHandler=u(this.pointerUpInsideHandler,this),PointerActionsMixin.__super__.constructor.apply(this,arguments),this._pointerDownAt=o()}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PointerActionsMixin,t),PointerActionsMixin.prototype.deadZone=3,PointerActionsMixin.stateFields({hover:!1,pointerIsDown:!1,mouseIsIn:!1,dragOffset:o(),dragging:!1}),PointerActionsMixin.prototype.setHover=function(t){var e;this.hover=t;try{return"function"==typeof(e=this.hoverAction||this.props.hoverAction)?e(t,this.props):void 0}catch(t){}},PointerActionsMixin.property("pointerDownAt"),PointerActionsMixin.prototype._settingHover=function(t,e){var n;return null==e&&(e=this.state),t!==e.hover&&this.onNextReady((n=this,function(){var e;return"function"==typeof(e=n.hoverAction||n.props.hoverAction)?e(t,n.props):void 0})),t},PointerActionsMixin.prototype.mouseIn=function(){return this.setState((t=this,function(e){return r(e,{mouseIsIn:!0,hover:t._settingHover(!0,e)})}));var t},PointerActionsMixin.prototype.mouseOut=function(){return this.setState((t=this,function(e){return r(e,{mouseIsIn:!1,hover:t._settingHover(e.pointerIsDown,e)})}));var t},PointerActionsMixin.prototype.pointerDownHandler=function(){return this.setState((t=this,function(e){return r(e,{pointerIsDown:!0,hover:t._settingHover(!0,e)})}));var t},PointerActionsMixin.prototype.pointerUpHandler=function(){return this.setState((t=this,function(e){return r(e,{pointerIsDown:!1,hover:t._settingHover(e.mouseIsIn,e)})}));var t},PointerActionsMixin.prototype.pointerUpInsideHandler=function(t){var e,n,r,o;return t.target.capturePointerEvents(),this.props.disabled?"function"==typeof(n=null!=(o=this.disabledAction)?o:this.props.disabledAction)?n(t,this.props):void 0:(this.doAction&&i.error("DEPRICATED: @doAction is no longer supported, use @action"),"function"==typeof(e=null!=(r="undefined"!=typeof customAction&&null!==customAction?customAction:this.action)?r:this.props.action)?e(t,this.props):void 0)},PointerActionsMixin.getter({touchDragTimeoutMs:function(){return 1e3},pointerDown:function(){return this.pointerIsDown},buttonHandlers:function(t){return this,{mouseIn:this.mouseIn,mouseOut:this.mouseOut,pointerDown:this.pointerDownHandler,pointerIn:this.pointerDownHandler,pointerUp:this.pointerUpHandler,pointerCancel:this.pointerUpHandler,pointerOut:this.pointerUpHandler,pointerUpInside:this.pointerUpInsideHandler}},pointerHandlers:function(){return this.buttonHandlers},hoverHandlers:function(){return{mouseIn:this.mouseIn,mouseOut:this.mouseOut}},dragHandlers:function(){return{mouseIn:this.mouseIn,mouseOut:this.mouseOut,pointerDown:this.dragPointerDownHandler,pointerMove:this.dragPointerMoveHandler,pointerUp:this.dragPointerUpHandler,pointerUpInside:(t=this,function(e){if(t.dragFinally(e,t.dragging,!1),!t.dragging)return t.pointerUpInsideHandler(e)}),pointerCancel:function(t){return function(e){return t.pointerUpHandler(),t.dragging&&t.dragCanceled(e,t.dragOffset),t.dragFinally(e,t.dragging,!0),t.dragging=!1}}(this)};var t}}),PointerActionsMixin.prototype.dragPointerDownHandler=function(t){var e,n,i;if(this.dragPrepare(t),this.pointerDownHandler(t),this.pointerDownAt=t.parentLocation,this.dragOffset=o(),this._pointerDownKey=e=(null!=(n=this._pointerDownKey)?n:0)+1,t=t.clone(),l)return a(this.touchDragTimeoutMs,(i=this,function(){if(!i.dragging&&i.pointerIsDown&&i._pointerDownKey===e)return i._drag(t)}))},PointerActionsMixin.prototype._drag=function(t){var e,n;return this.dragOffset=e=t.parentLocation.sub(this.pointerDownAt),this.dragging||(this.dragging=!0,null!=(n=t.target)&&"function"==typeof n.capturePointerEvents&&n.capturePointerEvents(),this.dragStart(t,e)),this.dragMove(t,e)},PointerActionsMixin.prototype.dragPointerMoveHandler=function(t){var e;if(e=t.parentLocation.sub(this.pointerDownAt),this.dragging||!l&&Math.max(Math.abs(e.x),Math.abs(e.y))>this.deadZone)return this._drag(t)},PointerActionsMixin.prototype.dragPointerUpHandler=function(t){return this.pointerUpHandler(t),this.dragging&&this.dragEnd(t,t.parentLocation.sub(this.pointerDownAt)),this.dragFinally(t,this.dragging,!1),this.dragOffset=o(),this.dragging=!1},PointerActionsMixin.prototype.dragPrepare=function(t){},PointerActionsMixin.prototype.dragFinally=function(t,e,n){},PointerActionsMixin.prototype.dragMove=function(t,e){},PointerActionsMixin.prototype.dragStart=function(t,e){},PointerActionsMixin.prototype.dragEnd=function(t,e){},PointerActionsMixin.prototype.dragCanceled=function(t,e){},PointerActionsMixin}()}})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;e=(r=n(42)).defineModule,r.log,i=r.interval,e(t,function(){return function(t){return function(e){function PollingComponentMixin(){return PollingComponentMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PollingComponentMixin,t),PollingComponentMixin.extendableProperty({pollInterval:10}),PollingComponentMixin.prototype.poll=function(){},PollingComponentMixin.getter({pollCount:function(){var t;return null!=(t=this.state.pollCount)?t:0}}),PollingComponentMixin.setter({pollCount:function(t){return this.setState("pollCount",t)}}),PollingComponentMixin.prototype.componentWillMount=function(){var t,e;return PollingComponentMixin.__super__.componentWillMount.apply(this,arguments),this.poll(null!=(t=this.pollCount)?t:0),this._interval=i(1e3*this.getPollInterval(),(e=this,function(){var t,n;return e.pollCount=t=(null!=(n=e.pollCount)?n:0)+1,e.poll(t)}))},PollingComponentMixin.prototype.componentWillUnmount=function(){return this._interval.stop()},PollingComponentMixin}()}})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>(n(539).log("Imikimi.Oz.StandardImport.loaded"),n(539).mergeWithSelf(n(595))))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(540).mergeWithSelf(n(541),{config:n(560).config,StringConstants:n(590),EventLogMixin:n(594)}))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(309).includeInNamespace(n(312)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(42).merge(n(542),n(589)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(275)).includeInNamespace(n(543)).addModules({ColorsLib:n(573),EmailLib:n(592),MarkdownLib:n(558),MediaLib:n(572),PosterTextLib:n(587),PostLib:n(586),RegExpLib:n(593),StandardImport:n(559),TagsLib:n(571),TopicLib:n(585),UrlLib:n(588),UserLib:n(584)})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(544),n(558),n(571),n(572),n(573),n(584),n(585),n(586),n(587),n(588),n(592),n(593)])}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(276)).includeInNamespace(n(545)).addModules({StringLib:n(546)})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(546),n(547)])}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["present"],[e,n(42)],t=>{return i.defClass(class StringLib extends Object{},function(e,n,r){this.applyStringVariables=function(t,e){return i.exists(t)&&t.replace(/%([-a-z_]+)%/gi,(t,n)=>{let r;return null!=(r=i.exists(e)&&e[n])?r:`\n\n> (ERROR: expecting variable: ${i.toString(t)})\n\n`})},this.getPlainTextTitle=function(e,n=50){let r,o,s,a;return(r=t(e)?((o=e.match(/[^\.!\?\n]+[\.!\?\n]+(?=[\s\n]|$)/g))&&([e]=o,[e]=e.split(/\.*\s*$/)),e.trim()):"").length>n&&([s]=r.split(/[-=|]/),(i.exists(s)&&s.length)>0&&(r=s)),r.length>n&&([s]=r.split(/["'[{(]/),(i.exists(s)&&s.length)>0&&(r=s)),r.length>n&&(a=r.split(/\s+/),r=null,i.each2(a,t=>r=r?`${i.toString(r)} ${i.toString(t)}`:t,t=>!r||r.length<n)),r}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(548))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(549)).includeInNamespace(n(553)).addModules({Formatters:n(556),TimeConstants:n(554),TimePresenters:n(555)})},function(t,e,n){t.exports=n(550).addNamespace("Lib",class Lib extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(18).addNamespace("Art.AppKit",class AppKit extends Neptune.PackageNamespace{}._configureNamespace(n(551))),n(549),n(552)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","bugs":"https:/github.com/art-suite/art-app-kit/issues","dependencies":{"art-build-configurator":"*","art-canvas-path":"*","art-markdown":"*","copy-to-clipboard":"*"},"description":"Art.App.Kit","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","coffee-loader":"^0.7.3","css-loader":"^3.0.0","json-loader":"^0.5.7","mocha":"^6.2.0","mock-fs":"^4.10.0","script-loader":"^0.7.2","style-loader":"^1.0.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"homepage":"https://github.com/art-suite/art-app-kit","license":"ISC","name":"art-app-kit","repository":{"type":"git","url":"https://github.com/art-suite/art-app-kit.git"},"scripts":{"build":"webpack --progress","build-assets":"cpf-tool asset-source/font-awesome/*.svg -o assets/icons.cpf --camelCase","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"webpack-dev-server  --progress --env.devServer"},"version":"0.8.3"}')},function(t,e,n){t.exports=n(550).addNamespace("Style",class Style extends Neptune.PackageNamespace{})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(554),n(555),n(556)])}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){let e=n(3);e.defMod(t,()=>{let t,n,i;return t={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",mo:"month",y:"year",w:"week"},e.object(t,(t,e)=>e,null,n={},(t,e)=>t),e.object(t,(t,e)=>e,null,n),i={ms:.001,s:1,m:60,h:3600,d:86400,w:604800,mo:2629746,y:31556952},e.each2(n,(t,e)=>i[e]=i[t]),{normalizedTimeNames:n,longTimeNames:t,secondsPer:i}})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["secondsPer","round","pluralize","longTimeNames","formatDate","toDate","firstOfDayLocale","dateAgeInSeconds"],[e,n(540),n(554)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class TimePresenters extends Object{},function(u,c,h){let p,d,f;this.dateAgePartArray=function(t,e){return f(t,e)},p=function(t){let e;return e=t.getHours(),(()=>{switch(!1){case!(e<12):return"morning";case!(e<17):return"afternoon";default:return"evening"}})()},this.daysDurationString=function(n){return n<3*t.day?d(n,!0):`${i.toString(e(n/t.day))} days`},this.humanDurationString=d=function(o,s){let a,l;return a=(()=>{switch(!1){case!(o<t.m):return"s";case!(o<3*t.h):return"m";case!(o<3*t.d):return"h";case!(o<3*t.mo):return"d";case!(o<=2*t.y):return"mo";default:return"y"}})(),l=e(o/t[a]),s?n(l,r[a]):`${i.toString(l)}${i.toString(a)}`},this.niceFullDateString=function(t){return o(t,"h:mmtt mmmm d, yyyy")},this.niceMonthYear=function(t){return o(t,"mmmm yyyy")},this.niceDateString=function(t){let e;return e=s(),t=s(t),e.getFullYear()!==t.getFullYear()?o(t,"mmmm d yyyy"):e.getMonth()!==t.getMonth()?o(t,"mmmm d"):(()=>{switch(t.getDate()-e.getDate()){case 1:return"tomorrow";case-1:return"yesterday";case 0:return"today";default:return o(t,"mmmm d")}})()},this.niceTimeDetailsString=(t=>`${i.toString(o(t,"h:mmtt"))} ${i.toString(this.niceDateString(t))}`),this.dayAgeString=function(e,n){let i,r;return i=a(),r=a(e),(()=>{switch(r){case i:return"today";case i-t.day:return"yesterday";case i+t.day:return"tomorrow";default:return r>=i-6*t.day?o(r,"dddd"):o(r,n?"dddd, mmmm dS":"mmm dS")}})()},this.dateAgeString=f=function(r,a,u){let c,h,f,m,g,y,v;return c=s(),(r=s(r))>c?d((r-c)/1e3,a):(f=(h=l(r))/t.minute,m=h/t.hour,g=h/t.day,f<1?u?n(0|h,"second")+" ago":"just now":m<1?(y=n(e(f),a?"minute":"min"),a?y+" ago":y):g<2&&c.getDay()===(r.getDay()+1)%7?`yesterday ${i.toString(p(r))}`:g<1?"12:00am"===(v=o(r,"h:MMtt"))?"midnight":v:g<7&&c.getDay()!==r.getDay()?o(r,"dddd")+" "+p(r):c.getYear()===r.getYear()&&(g<60||c.getMonth()!==r.getMonth())?o(r,"mmmm dS"):o(r,"mmm dS yyyy"))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["pluralize","commaize"],[e,n(557)],(t,e)=>{return i.defClass(class Formatters extends Object{},function(n,r,o){let s,a;s={k:"thousand",m:"million",b:"billion"},this.formatted3DigitCount=a=function(t,e){let n;return t=(()=>{switch(!1){case!(t<1e3):return t;case!(t<1e6):return n="k",t<1e5?(t/100|0)/10:t/1e3|0;case!(t<1e9):return n="m",t<1e6?(t/1e5|0)/10:t/1e6|0;default:return n="b",t/1e9|0}})(),n?(e&&(n=" "+s[n]),`${i.toString(t)}${i.toString(n)}`):t},this.pluralize3DidgetCount=function(e,n,r){return`${i.toString(a(e,r))} ${i.toString(1!==e?t(n):n)}`},this.nicePluralize=function(n,r,o){let s;return 1===n?`${i.toString(n)} ${i.toString(r)}`:(s=o?n>=1e6?`${i.toString(n/1e6|0)}m`:n>=1e3?`${i.toString(n/1e3|0)}k`:`${i.toString(n)}`:e(n),`${i.toString(s)} ${i.toString(t(r))}`)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{let t,r,o=e.Object;return n(540).mergeWithSelf({HotStyleProps:null!=(t=i.exists(r=e.Neptune.Art.Suite)&&r.HotStyleProps)?t:o})})}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getPlainTextTitle","compactFlatten","present","peek","min"],[e,n(559)],(t,e,n,r,o)=>{return i.defClass(class MarkdownLib extends Object{},function(s,a,l){this.deMarkdown=(t=>t.replace(this._findMarkdownBlockRegExp,"")),this.markdownBlockDefaults={align:"left",depth:0,style:"paragraph"},this._findTitleMarkdownRegExp=/^(?:[\n\s]*\n)?[#*>]+-*\s+([^\n]+)/,this.getMarkdownTitle=((e,n=50)=>{let r;return(r=i.exists(e)&&e.match(this._findTitleMarkdownRegExp))?t(r[1],n):void 0}),this.hasMarkdownCodeBlocks=(t=>this._markdownCodeBlockDelimiterRegExp.test(t)),this._codeBlockStart=/\^*```/,this.hasAlignmentMarkdown=function(t){return RegExp(`(^|\\n)((?=-)|\\#+|\\^+|>+|\\d\\.+|\\*+|${i.toString(this._codeBlockStart.source)})(-+)`).test(t)},this._markdownCodeBlockDelimiterRegExp=RegExp(`${i.toString(this._codeBlockStart.source)}`),this.markdownCodeBlockLineStartRegExp=RegExp(`^${i.toString(this._markdownCodeBlockDelimiterRegExp.source)}`),this.markdownCodeOrHeaderBlockLineStartRegExp=RegExp(`^(${i.toString(this._markdownCodeBlockDelimiterRegExp.source)}|\\#+\\s+[^\\s])`),this._findMarkdownCodeBlockDelimiterRegExp=RegExp(`(^|\\n *)${i.toString(this._markdownCodeBlockDelimiterRegExp.source)}`),this._markdownBlockStartRegexp=RegExp(`(?:(?=-)|\\#+|\\^+|>+|\\d\\.+|\\*+|${i.toString(this._codeBlockStart.source)})(?:-*)(?: +|\\n|$)`),this._markdownBlockStartWithSubmatchesRegexp=RegExp(`((?=-)|\\#+|\\^+|>+|\\d\\.+|\\*+|${i.toString(this._codeBlockStart.source)})(-*)(?: +|\\n|$)`),this._findMarkdownBlockRegExp=RegExp(`(^|\\n)\\s*${i.toString(this._markdownBlockStartRegexp.source)}`),this._markdownBlockLineStartRegExp=RegExp(`^\\s*${i.toString(this._markdownBlockStartRegexp.source)}`),this._markdownBlockLineStartWithSubmatchesRegexp=RegExp(`^\\s*${i.toString(this._markdownBlockStartWithSubmatchesRegexp.source)}((?:.|\\n)+)`),this.removeMarkdownCodeBlocks=(t=>{let e;return null!=t&&this._findMarkdownCodeBlockDelimiterRegExp.test(t)?(e=!1,i.array(t.split(/\s*\n/g),null,t=>this.markdownCodeBlockLineStartRegExp.test(t)?(e=!e,!1):!e).join("\n")):t}),this.isMarkdown=(t=>this._findMarkdownBlockRegExp.test(t)),this.splitMarkdownParagraphs=(t=>{let o,s,a,l;return o=t.split(/\ *\n/g),s=[],a=null,l=null,i.each2(o,(t,e)=>{let o,a;return(o=t.match(this.markdownCodeBlockLineStartRegExp))?l?(s.push(l+"\n```"),l=null):([l]=o,[l]):l?l+="\n"+t:(t=t.trim(),this._markdownBlockLineStartRegExp.test(t)?s.push(t):n(t)?(a=r(s),(()=>{switch(!1){case!(null!=a&&!this.markdownCodeBlockLineStartRegExp.test(a)):return s[s.length-1]=`${i.toString(a)} ${i.toString(t)}`;case!(0===(i.exists(a)&&a.length)):return s[s.length-1]=t;default:return s.push(t)}})()):s.push(null))}),l&&s.push(l+"\n```"),e(s)}),this.parseParagraphText=function(t){return t.replace(/\<br\>/g,"\n")},this.parseMarkdown=(t=>{let e;return e=this.splitMarkdownParagraphs(t),i.array(e,e=>{let n,i,r,s,a,l;return(n=e.match(this._markdownBlockLineStartWithSubmatchesRegexp))?([i,r,s,t]=n,/^\d+/.test(r)&&(r=r.replace(/^\d+/,"")),(n=r.match(/(\^*)`+/))?([i,a]=n,{text:t=t.replace(/\n```[\s\n]*$/,""),depth:o(2,a.length),style:"code",align:"left"}):{text:this.parseParagraphText(t),style:l=(()=>{switch(r[0]){case"^":return"indented";case">":return"quote";case"#":return"heading";case"*":return"bullet";case".":return"list";default:return"paragraph"}})(),depth:(()=>{switch(l){case"paragraph":return 0;default:return o(2,r.length)}})(),align:(()=>{switch(s.length){case 0:return"left";case 1:return"center";default:return"right"}})()}):{text:this.parseParagraphText(e),depth:0,align:"left",style:"paragraph"}})}),this.parseMarkdown2=((t,e)=>{let n;return n=this.splitMarkdownParagraphs(t),i.array(n,n=>{let i,r,s,a,l,u;return(i=n.match(this._markdownBlockLineStartWithSubmatchesRegexp))?([r,s,a,t]=i,/^\d+/.test(s)&&(s=s.replace(/^\d+/,"")),(i=s.match(/(\^*)`+/))?([r,l]=i,{text:t=t.replace(/\n```[\s\n]*$/,""),level:o(2,l.length),style:"code",align:"left"}):{text:e?t:this.parseParagraphText(t),style:u=(()=>{switch(s[0]){case"^":return"indented";case">":return"quote";case"#":return"heading";case"*":return"unorderedList";case".":return"orderedList";default:return"paragraph"}})(),level:(()=>{switch(u){case"paragraph":return 0;case"heading":return o(2,s.length)-3;default:return o(2,s.length)}})(),align:(()=>{switch(a.length){case 0:return"left";case 1:return"center";default:return"right"}})()}):{text:this.parseParagraphText(n),level:0,align:"left",style:"paragraph"}})})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(540).mergeWithSelf(n(160).Browser,n(544),{config:n(560).config}))}).call(this,n(2)(t))},function(module,exports,__webpack_require__){"use strict";(function(module,global){let Caf=__webpack_require__(3);Caf.defMod(module,()=>Caf.importInvoke(["getEnv","isNode","urlJoin","appendQuery","merge"],[global,__webpack_require__(42)],(getEnv,isNode,urlJoin,appendQuery,merge)=>{let ImikimiOzConfig;return Caf.defClass(class ImikimiOzConfig extends __webpack_require__(106).Configurable{},function(ImikimiOzConfig,classSuper,instanceSuper){this.setNamespace(__webpack_require__(270)),this.defaults({vertical:__webpack_require__(561),zoKimi:"imikimi"===__webpack_require__(561),[__webpack_require__(561)]:!0,edge:getEnv().edge,staffPicksChannelId:null,staffPicksUserId:null,curators:[],newsTopicId:null,minTopCount:10,helpChannelId:null,zoimages:{getZoImageUrl:function(t,e){return urlJoin(ImikimiOzConfig.config.zoimages.domain,appendQuery(t,merge(e,{ver:"1.2"})))},domain:null},slideShow:!0,stripe:{secret:"...",publishable:"...",endpointSecret:"...",plan:null}}),isNode&&this.on({configured:()=>{let realRequire;return this.stripe=realRequire=eval("require")("stripe")(ImikimiOzConfig.config.stripe.secret),this.stripe.setApiVersion("2018-11-08")}})})}))}).call(this,__webpack_require__(2)(module),__webpack_require__(5))},function(t,e,n){t.exports=n(562)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv"],[e,n(563)],t=>{let n,i,r,o,s,a,l,u,c,h,p;return n=(h=t()).zoStream,i=h.zostream,r=h.zoPeople,o=h.zopeople,s=h.vertical,a=h.imikimi,l=h.zokimi,u=h.zoKimi,c=void 0!==(p=h.hostname)?p:"",null!=s?s:(()=>{switch(!1){case!e.cordova:return"imikimi";case!a:case!l:case!u:case!/imikimi.com$/i.test(c):return"imikimi";case!o:case!r:case!/zoPeople.com$/i.test(c):return"zoPeople";default:return"zoStream"}})()}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{let t,r,o=e.Object;return n(540).mergeWithSelf(n(564).Style,{HotStyleProps:null!=(t=i.exists(r=e.Neptune.Art.Suite)&&r.HotStyleProps)?t:o})})}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(565))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(550)).includeInNamespace(n(566)).addModules({StandardImport:n(557)}),n(548),n(567)},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(567),n(548)])}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(552)).addModules({AppPalette:n(568),TextPalette:n(569),TextStyles:n(570)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["HotStyleProps","rgbColor","merge","hslColor"],[e,n(557)],(t,e,n,r)=>{return i.defClass(class AppPalette extends t{},function(t,o,s){this.setColors=function(t){return i.object(t,t=>e(t),null,this)},this.setAppPalette=(t=>{let o,s,a,l,u,c;return s=(o=e(null!=(c=i.exists(t)&&t.primary)?c:"#55b13f")).sat,this.setColors(n({red:a=r(0,.9*s,1),green:l=r(120/360,.9*s,.8),primary:o,veryLightPrimary:o.blend("white",7/8),lightPrimary:o.blend("white",5/8),mediumLightPrimary:o.blend("white",3/8),mediumPrimary:o,mediumDarkPrimary:o.withScaledLightness(7/8),darkPrimary:o.withScaledLightness(.5),white:"white",background:"white",toolbarColor:"white",offWhite:"#f9",warning:u=a.withHue(55/360),lightWarning:u.blend("white",.5),activityBadge:a,veryLightGrey:"#f9",lightGrey:"#ee",mediumLightGrey:"#bb",mediumGrey:"#aa",mediumDarkGrey:"#77",darkGrey:"#22",veryLightDarken:"#00000007",lightDarken:"#00000011",mediumLightDarken:"#00000044",mediumDarken:"#00000066",heavyDarken:"#000000dd"},t)),this.grey=this.mediumGrey,this.darkent=this.mediumDarken}),this.setAppPalette()})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["HotStyleProps","rgbColor"],[e,n(557)],(t,e)=>{return i.defClass(class TextPalette extends t{},function(t,n,i){this.black={primary:e("#000000d2"),softPrimary:e("#000a"),secondary:e("#0008"),tertiary:e("#0005"),quaternary:e("#0002"),barely:e("#0001"),disabled:e("#0004"),opaquePrimary:e("#2"),opaqueSecondary:e("#7"),opaqueTertiary:e("#a")},this.white={primary:e("#fffd"),softPrimary:e("#fffb"),secondary:e("#fff8"),tertiary:e("#fff5"),quaternary:e("#fff2"),barely:e("#fff1"),disabled:e("#fff4"),opaquePrimary:e("#e"),opaqueSecondary:e("#8")}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Math","HotStyleProps","compactFlattenAll","w","lowerCamelCase","merge"],[e,n(557)],(t,e,r,o,s,a)=>{let l;return l=t.pow,i.defClass(class TextStyles extends e{},function(t,e,u){let c;this.smallFontSize=14,this.fontSizeRatio=1.25,this.fontSizes={bitty:this.smallFontSize*l(this.fontSizeRatio,-2),tiny:this.smallFontSize*l(this.fontSizeRatio,-1),small:this.smallFontSize,medium:this.smallFontSize*l(this.fontSizeRatio,1),large:this.smallFontSize*l(this.fontSizeRatio,2),xLarge:this.smallFontSize*l(this.fontSizeRatio,3),xxLarge:this.smallFontSize*l(this.fontSizeRatio,4),xxxLarge:this.smallFontSize*l(this.fontSizeRatio,5),x9Large:this.smallFontSize*l(this.fontSizeRatio,9)},c=function(...t){return r(i.array(t,t=>o(t)),"sans-serif").join(",")},this.fonts={monospace:{fontFamily:c("Monoco","monospace")},regular:{fontFamily:c("AvenirNext-Regular")},light:{fontFamily:c("AvenirNext-UltraLight")},italic:{fontStyle:"italic",fontFamily:c("AvenirNext-Italic")},bold:{fontWeight:"bold",fontFamily:c("AvenirNext-DemiBold")},boldItalic:{fontStyle:"italic",fontWeight:"bold",fontFamily:c("AvenirNext-DemiBoldItalic")},extraBold:{fontWeight:"bold",fontFamily:c("AvenirNext-Bold")}},i.each2(this.fontSizes,(t,e)=>{let r;return r={fontSize:t,color:n(569).black.primary,size:"parentWidthChildrenHeight"},i.each2(this.fonts,(t,n)=>{let o;return this[o=s(`${i.toString(e)} ${i.toString("regular"!==n?n:void 0)} text`)]=a(t,r)})})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["findAllUrlsWithOptionalProtocolRegExp","findEmailRegExp","findEmailLocalRegExp","findUrlWithOptionalProtocolRegExp","codeWords","upperCamelCase","urlRegexp","config","isString","splitMarkdownParagraphs","compactFlatten","markdownCodeBlockLineStartRegExp","present","normalizeUrl"],[e,n(559),n(558)],(t,n,r,o,s,a,l,u,c,h,p,d,f,m)=>{return i.defClass(class TagsLib extends Object{},function(g,y,v){let S,b,w,x,P,C,_,E,T,k,I;this.hashtagRegexp=S=/\#(?:(?!\d)[$\w\u007f-\uffff]|\d\d\d\d)[-$\w\u007f-\uffff]*/g,this.nonNormalHashtagRegexp=b=RegExp(`(?:${i.toString(S.source)})(?!\\#(?![a-z])[\\w\\u007f-\\uffff]+\\b)`,"g"),this.isHashTag=function(t){return/^#/.test(t)},this.detagRegexp=w=RegExp(`${i.toString(t.source)}|${i.toString(n.source)}|${i.toString(S.source)}`,"g"),x=RegExp(`${i.toString(w.source)}`),e.findEmailLocalRegExp=r,e.findMailtoRegExp=P=RegExp(`mailto:${i.toString(r.source)}@${i.toString(o.source)}`,"i"),e.tailUrlsRegexp=C=RegExp(`(\\s*(${i.toString(P.source)}|${i.toString(n.source)}|${i.toString(t.source)}))+\\s*$`),_=/([-$\w\u007f-\uffff])#([-$\w\u007f-\uffff])/,this.tagToText=E=function(t){return s(t).join(" ")},this.findAllTags=function(t){return i.exists(t)&&t.match(S)},this.stringHasTagsOrLinks=function(t){return x.test(t)},this.normalizeTagsInText=function(t,e){let n;return n=e,{text:t.replace(_,(t,r,o,s)=>(e>=s&&n++,`${i.toString(r)} #${i.toString(o)}`)),cursor:n}},this.normalizeTags=function(t){return b.test(t)?t.replace(S,t=>"#"+a(t)):t},this.extractDomain=T=function(t){return o.exec(t)[3]},this.extractEmail=k=function(t){return n.exec(t)[0]},this.internalLinkToPostId=function(t){let e,n,r;return(e=i.exists(t)&&i.exists(n=t.match(l))&&i.exists(r=n[6])&&r.match(/^\/post\/([-_a-z0-9]+)/i))?e[1]:void 0},this.detagString=I=((e,r,o)=>{let s,l,g,y,v,b;return"imikimi"===u.vertical&&(null!=r||(r=3)),(()=>{switch(!1){case!!c(e):return[null,null];case!!x.test(e):return[null,e];default:return s=[],l={},g=[],y=null,v={},b=i.array(h(e),e=>{let r;return!d.test(e)&&(r=e.match(w))?(i.each2(r,t=>{let e,r;return(()=>{switch(!1){case!/^#/.test(t):return l[e=`#${i.toString(a(t))}`]?void 0:(s.push(e),l[e]=!0);case!n.test(t):return g.push(t);default:return f(r=m(t))&&v[r]?void 0:(v[r]=!0,null!=y||(y=this.internalLinkToPostId(r)),g.push(r))}})()}),e=e.replace(C,"").replace(t,T).replace(P,k),o||(e=e.replace(S,E)),e):e}),[p([g,s]).slice(0,r),b.join("\n\n"),y]}})()}),this.justDetagString=(e=>(()=>{switch(!1){case!!c(e):return null;case!!x.test(e):return e;default:return i.array(h(e),e=>d.test(e)?e:e.replace(t,T).replace(P,k).replace(S,E)).join("\n\n")}})()),this.detagAnyString=function(t,e=3,n){let i,r,o;return[i,r,o]=I(t,e,n),{tags:i,displayText:r,linkToPostId:o}}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","max","min","getArtConfig","config","uriPathJoin","point","Neptune","randomString","Promise"],[e,n(559)],(t,e,n,r,o,s,a,l,u,c)=>{let h;return h=t().lowBandwidth,i.defClass(class MediaLib extends Object{},function(h,p,d){let f,m,g,y,v,S,b,w;this.mediaSizes={64:64,128:128,256:256,512:512,768:768,1024:1024,small:64,medium:256,large:512},this.altMediaSizesMap={max:["512","256","768","1024"],512:f=["256","128","768","1024"],256:m=["512","128","64","768"],128:["256","512","64","768"],64:g=["128","256","512","768"],large:f,medium:m,small:g,auto:["1024","768","512","256","128","64"]},this.legalMediaResolutions=[64,128,256,512,768,1024,1280,1536,1792,2048,2560,3072,3840],this.maxMediaResolution=e(...this.legalMediaResolutions),this.minMediaResolution=n(...this.legalMediaResolutions),this.connonicalMediaSizes=[64,128,256,512],this.defaultMediaSizeName="medium",this.defaultAltMediaSizeMap=this.altMediaSizesMap[this.defaultMediaSizeName],this.defaultMediaSize=y=this.mediaSizes[this.defaultMediaSizeName],this.maxMediaResolutionByBandwidthSetting={low:this.mediaSizes.large,veryLow:this.mediaSizes.medium},this.mediaBandwidthSetting=(()=>{switch(!1){case!t().veryLowBandwidth:return"veryLow";case!t().lowBandwidth:return"low";default:return"max"}})(),this.getBandwidthLimitedMaxResolution=(()=>{let t;return null!=(t=this.maxMediaResolutionByBandwidthSetting[this.mediaBandwidthSetting])?t:this.maxMediaResolution}),v=(t=>null!=t&&n(null!=t?t:1e4,this.getBandwidthLimitedMaxResolution())),this.getExpiringUploadsUrlForFile=function(t){return`https://${i.toString(r().Art.Aws.s3Buckets.expiringUploads)}.s3.amazonaws.com/${i.toString(t)}`},this.getMediaUrlForFile=function(t){let e,n;return(e=i.exists(n=o.files)&&n.domain)?s(e,t):`https://${i.toString(r().Art.Aws.s3Buckets.media)}.s3.amazonaws.com/${i.toString(t)}`},this.getResolutionForMediaSize=((t,e=b())=>v("max"===t||"original"===t?null:(this.mediaSizes[t]||this.defaultMediaSize)*(e>1.9?2:1))),this.dimensionsForMediaSize=((t,e,n)=>i.exists(t)&&t.dimensions?"max"===e?a(t.dimensions):a(t.dimensions).fitInto(this.getResolutionForMediaSize(e,n)):void 0),S=null,b=function(){let t,e;return null!=S?S:S=null!=(t=i.exists(e=l.Art.Flux)&&e.models.viewState.devicePixelsPerPoint)?t:1},this.getLegalMediaResolutionWithinRange=function(t,e){let n,i,r,o,s;return(()=>{switch(!1){case!(t>e):return null;case!(t>=this.maxMediaResolution):return this.maxMediaResolution;case!(e<=this.minMediaResolution):return this.minMediaResolution;default:return n=this.legalMediaResolutions,i=null,null!=n&&(r=n.length,o=0,(()=>{for(;o<r;){let r;if((r=n[o])>=t&&r<=e){i=r;break}s=o++}})()),i}})()},w=.8125,this.getAutoMediaResolutionForPost=((t,e,n=b())=>{let i;return v(this.getLegalMediaResolutionWithinRange((i=a(e.dimensions).max())*t.maxRatio(e.dimensions)*n*.8125,i))}),this.getAutoMediaUrlForPost=((t,e,n=b())=>this.getMediaUrlForPostAndResolution(e,this.getAutoMediaResolutionForPost(t,e,n))),this.getMediaUrlForPost=((t,e,n)=>this.getMediaUrlForPostAndResolution(t,this.getResolutionForMediaSize(e,n))),this.getMediaUrlForPostAndResolution=((t,e)=>{let n;return(i.exists(t)?n=t.mediaFile:void 0)?e&&o.zoimages.domain?o.zoimages.getZoImageUrl(n,{w:e,h:e}):this.getMediaUrlForFile(n):void 0}),this.getTemplateUrlForPost=(t=>this.getMediaUrlForFile(t.templateFile)),this.getColorInfoForPost=((t,e)=>{let n,r;return n=this.getMediaUrlForPost(t,null!=(r=i.exists(e)&&e.mediaSize)?r:"medium"),n+=/\?/.test(n)?"&":"?",n+=u(10),l.Art.Canvas.Bitmap.get(n,{}).then(t=>l.Art.ColorExtractor.extractColors(t,e))}),this.getAlreadyLoadedBitmap=((t,e="medium")=>{let n,r,o;return n=this.altMediaSizesMap[e],({bitmapCache:r}=l.Art.Engine.BitmapElement),(o=r.loaded(this.getMediaUrlForPost(t,e)))||i.find(n,e=>r.loaded(this.getMediaUrlForPost(t,e))),null}),this.getAllLoadedBitmaps=(t=>{let e;return({bitmapCache:e}=l.Art.Engine.BitmapElement),i.object(this.connonicalMediaSizes,n=>e.loaded(this.getMediaUrlForPost(t,n)))}),this.getBitmap=function(t,e="medium"){let n,i,r;return({bitmapCache:n}=l.Art.Engine.BitmapElement),(i=n.loaded(r=this.getMediaUrlForPost(t,e)))?c.resolve(i):l.Art.Canvas.Bitmap.get(r)},this.altMediaSizesFor=(t=>this.altMediaSizesMap[t]||this.defaultAltMediaSizeMap)})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","rgbColor","Neptune","Math","Color","hslColor"],[e,n(559)],(t,e,r,o,s,a)=>{let l,u,c,h;return l=n(574),({config:u}=n(560)),({uriPathJoin:c}=n(160).Browser),({unpackColorMap:h}=n(576)),i.defClass(class ColorsLib extends t{},function(t,n,u){let c,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T;this.defaultPostPalette=c={foreground:p=e(l.primary),background:d=e("#333"),foregroundColor:p,backgroundColor:d},this.getDarkBackgroundColor=f=function(t){let n;return(n=e(t)).withLightness(.5*n.l)},this.getBackgroundColor=m=function(t,n=c.backgroundColor){let r;return(r=i.exists(t)&&t.colors)&&e(r.darkMuted||r.darkVibrant||r.muted||r.vibrant)||n},this.getForegroundColor=g=function(t,n=c.foregroundColor){let r;return(r=i.exists(t)&&t.colors)&&e(r.vibrant||r.lightVibrant||r.darkVibrant||r.muted||r.lightMuted||r.darkMuted)||n},this.getColorPaletteFromColorInfo=y=function(t){return{background:m(t).toString(),foreground:g(t).toString()}},this.getColorPaletteFromBitmap=function(t){return y(r.Art.ColorExtractor.extractColors(t))},this.packColorMap=v=function(t){return t.join("").replace(/#/g,"")},this.getPostPerceptualLightnessTopRight=function(t,n){let r;return(r=i.exists(t)&&t.colorMap)?e(h(r)[2]).perceptualLightness:void 0},this.getPostColorInfoFromBitmap=function(t){let e;return{colors:y(e=r.Art.ColorExtractor.extractColors(t)),colorMap:v(e.colorMap)}},this.getPostColors=(t=>{let e,n;return i.exists(t)&&t.colors?{foreground:e=this.getPostForeground(t),background:n=this.getPostBackground(t),foregroundColor:e,backgroundColor:n}:c}),this.getPostForeground=(t=>e((i.exists(t)&&t.colors||c).foreground)),this.getPostBackground=(t=>e((i.exists(t)&&t.colors||c).background)),this.getPostDarkBackground=(t=>f(e((i.exists(t)&&t.colors||c).background))),this.getColorPalette=function({post:t,colorInfo:n}){let r,s,a,l,u,p,d,f,m;return null!=t||(t={}),null!=n||(n=i.exists(t)&&t.colorInfo),n&&({colors:r,colorMap:s}=n),null!=r||(r=t.colors),null!=s||(s=h(t.colorMap)),a=((t,e)=>{let n,i,r,s,a;return(n=3*(i=t.perceptualLightness)|0)===(r=3*(s=e.perceptualLightness)|0)?(a=t.h-e.h,o.abs(a)<.05?i-s:a):n-r}),l={},u=[],p=(t=>{let n,r;return null!=t?(n=(t=e(t)).perceptualLightness,r=t.h,i.find(u,null,e=>{let n,i;return n=e.perceptualLightness,i=e.h,.05>x(t,e)&&.01>P(t,e)})&&(t=null),t?u.push(t):void 0):void 0}),t.colors&&(p(t.colors.background),p(t.colors.foreground)),i.each2(r,(t,e)=>p(t)),s&&i.each2(h(s),t=>p(t)),(d=i.array(u,null,t=>t.perceptualLightness>.3)).length>12&&(f=i.array(u,null,t=>t.l>.3)).length>=6&&(d=f),p(c.background),i.each2(u,t=>(t.l>.5||t.s>.5)&&t.l>.4?(p(t.withScaledLAndS(.5,.5)),p(t.withScaledLightness(1/3)),p(t.withScaledLightness(.5)),p(t.withScaledLightness(2/3))):void 0),m=i.array(u,null,t=>t.perceptualLightness<.7),{foregroundColors:d.slice(0,24).sort(a),backgroundColors:m.slice(0,24).sort(a)}},this.getMostSaturatedColor=S=function(t){return i.reduce(t,(t,n)=>(n=e(n),(i.exists(t)&&t.s)>n.s?t:n),(t,e)=>null!=e,null)},this.satDistance=b=function(t,e){return o.abs(t.s-e.s)},this.perceptualLightnessDistance=w=function(t,e){return o.abs(t.perceptualLightness-e.perceptualLightness)},this.lightnessDistance=x=function(t,e){return o.abs(t.s-e.s)},this.hueDistance=P=function(t,e){let n,r,o;return n=t.hue,r=e.hue,(o=i.mod(n-r,1))>.5?1-o:o},this.reduceExpandedPalette=C=function(t,e=1/180){let n,r;return t.sort((t,e)=>t.hue-e.hue),n=null,i.array(t,null,t=>!n||e<P(n,t)?(n=t,!0):(n=n&&t.saturation>n.saturation?r[r.length-1]=t:n,!1),r=[])},this.getNamedRainbow=_=function(){return i.array(s.namedValues,(t,e)=>t.withSaturation(1).withLightness(1),(t,e)=>t.s>2/3&&t.perceptualLightness>.5)},this.getRelatedColors=E=function(t){let e,n,i,r;return t?(e=t.saturation,n=t.hue,i=t.lightness,e<.5&&(e=e<1/3?1-e:(1+e)/2),r=[a(n-1/12,e,1),a(n,e,1),a(n+1/12,e,1),a(n+4/12,e,1),a(n+5/12,e,1),a(n+.5,e,1),a(n+7/12,e,1),a(n+8/12,e,1)]):void 0},this.getExpandColorPalette=T=function(t){let e,n,r,o,s,l,u,c,h;return({vibrant:e,lightVibrant:n,darkVibrant:r}=t.colors),s=(o=S(e||n||r?[e,n,r]:i.array(t.colors))).saturation<.1?(u=[],c=0,h=l=1/18,(()=>{for(;h>0&&c<.99||h<0&&c>.99;){let t;t=c,u.push(a(t,1,1)),c+=h}})(),u):E(o)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=n(575)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["hslColor","HotStyleProps","isColorOrColorString","rgbColor","Object","TextPalette"],[e,n(563)],(t,e,r,o,s,a)=>{let l,u,c,h,p,d;return u=(l=function(t,e={}){return i.object(t,t=>(()=>{switch(!1){case!r(t):return o(t);case!i.is(t,s):return l(t);default:return t}})(),null,e)})({zoStream:t(37/360,.9,.98),zoPeople:t(340/360,.9,.85),default:t(200/360,.9,1)}),null!=(c=u[n(562)])||(c=u.default),h=c.sat,p=t(0,.9*h,1),d=t(120/360,.9*h,.8),i.defClass(class ImikimiPalette extends e{},function(e,n,r){this.verticalColors=u,this.getVerticalColor=function(t){let e;return null!=(e=u[t])?e:u.default},this.imikimi="#46a0e2",this.primary=c,this.member=t(200/360,h,2/3),this.darkPrimary=c.withLightness(.8),this.lightPrimary=c.withSaturation(.75*h),this.veryLightPrimary=c.withSaturation(.25*h),this.primaryBackground=c.withSaturation(.05*h),this.imikimi2=c,this.white="white",this.mediumGrey="#0006",this.grey=this.mediumGrey,this.background="#e",this.lightGrey="#e",this.mediumLightGrey="#b",this.darkGrey="#2",this.veryLightGrey="#f9f9f9",this.warning=t(47/360,1,1),this.warningBackground=t(47/360,.5,1),this.noProfilePhotoDefaultBackground="#74",this.codePalette={light:{background:"#0000000a",foreground:"#000a"},dark:{background:"#ffffff0a",foreground:"#fffa"}},this.goldGradient=l({1:"#be8e42",".8":"#fef5ac",".5":"#9e682a",".4":"#d7bb73",0:"#a36828"}),this.darkGolden=o("#be8e42"),this.golden=o("#9e682a"),this.lightGolden=o("#fef5ac").withScaledSaturation(.5),this.lightGoldenBackground="#f5f0e9",this.membershipGradient=this.goldGradient,this.membershipRequiredGradient=i.object(this.goldGradient,t=>t.withSaturation(0)),this.barelyDarken="#00000009",this.slightlyDarken="#00000022",this.darken="#00000044",this.darkContrastOutlineColor="#00000008",this.lightContrastOutlineColor="#fffa",this.red=p,this.green=d,this.yellow=t(1/6,p.s,.9),this.warning=p.withHue(.125),this.activityBadge=p,this.loading="white",this.selectedTabColor="#fc",this.tabBackgroundColor="#f4",this.buttonPalettes={primary:{color:a.white.primary,backgroundColor:e.primary,hoverColor:e.lightPrimary},secondary:{color:a.black.secondary,backgroundColor:"#fffa",hoverColor:e.primary}},l(this,this)})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=n(577)},function(t,e,n){t.exports=n(578),t.exports.includeInNamespace(n(581)).addModules({Vibrant:n(582)})},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(579).addNamespace("ColorExtractor",function(t){function ColorExtractor(){return ColorExtractor.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ColorExtractor,Neptune.PackageNamespace),ColorExtractor.version=n(580).version,ColorExtractor}())},function(t,e,n){t.exports=n(18).vivifySubnamespace("Art"),n(578)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*"},"description":"Art.Color.Extractor","license":"ISC","name":"art-color-extractor","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"1.6.0"}')},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E;o=n(582),S=n(42),f=S.log,S.object,m=S.merge,C=S.toPlainObjects,d=S.isString,p=S.isArray,s=S.currentSecond,b=n(313),x=b.rgb256Color,P=b.rgbColor,g=b.point,r=b.Matrix,i=n(325).Bitmap,a=g(3),v=(w=[10,5])[0],y=w[1],t.exports={version:E=n(580).version,getColorMap:c=function(t,e){var n,i,o,s,l,u,c,h,p;for(null==e&&(e=a),n=t.getMipmap(e),(i=t.newBitmap(e)).drawBitmap(r.scale(e.div(n.size)),n),p=[],o=s=0,l=(h=u=i.imageData.data).length;s<l;o=s+=4)c=h[o],p.push(x(c,u[o+1],u[o+2]));return p},getColorMapBitmap:h=function(t){var e,n,r,o,s,a,l,u,c,h,p;for(a=0,o=(l=(r=new i(3)).imageData).data,u=0,c=t.length;u<c;u++)n=t[u],h=(p=P(n)).r256,s=p.g256,e=p.b256,o[a+0]=h,o[a+1]=s,o[a+2]=e,o[a+3]=255,a+=4;return r.putImageData(l)},generatePreviewBitmap:u=function(t){var e;if(d(t)&&54===t.length)e=_(t);else{if(!p(t)||9!==t.length){if(null!=t?t.colorMap:void 0)return u(t.colorMap);throw new Error("invalid colorInfo")}e=t}return h(e).scale(v).blur(y)},packColorMap:function(t){return t.join("").replace(/#/g,"")},unpackColorMap:_=function(t){var e,n,i,r,o;if(d(t)){for(o=[],n=0,i=(r=t.match(/[0-9a-f]{6}/g)).length;n<i;n++)e=r[n],o.push("#"+e);return o}return t},mipmapSize:128,getVibrantQualifyingColors:o.getVibrantQualifyingColors,extractColors:l=function(t,e){var n,i,r;return n=(t=t.getMipmap(128)).imageData.data,r=s(),i=m({version:0|E.split(".")[0],colorMap:(null!=e?e.noColorMap:void 0)?void 0:c(t),colors:new o(n,e).colors}),(null!=e?e.verbose:void 0)&&f({scaledBitmap:t,extractColors:i,milliseconds:1e3*(s()-r)|0}),i},extractColorsAsPlainObjects:function(t){return C(l(t))}}},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f=function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},m={}.hasOwnProperty,g=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};c=n(160),i=c.compact,c.array,l=c.object,r=c.defineModule,e=c.BaseObject,o=c.log,s=c.max,a=c.min,h=n(313),p=h.rgb256Color,d=h.rgbColor,h.hslColor,u=n(583),r(t,function(){var t,n,r,c;return 5e-4,7,12,7,.1,.3,.4,.4,.5,.6,.6,.85,1.01,0,.15,.4,.4,1,1.01,n={darkMuted:{targetLuma:.3,minLuma:.1,maxLuma:.4,targetSat:.15,minSat:0,maxSat:.4},muted:{targetLuma:.5,minLuma:.4,maxLuma:.6,targetSat:.15,minSat:0,maxSat:.4},lightMuted:{targetLuma:.85,minLuma:.6,maxLuma:1.01,targetSat:.15,minSat:0,maxSat:.4},darkVibrant:{targetLuma:.3,minLuma:.1,maxLuma:.4,targetSat:1,minSat:.4,maxSat:1.01},vibrant:{targetLuma:.5,minLuma:.4,maxLuma:.6,targetSat:1,minSat:.4,maxSat:1.01},lightVibrant:{targetLuma:.85,minLuma:.6,maxLuma:1.01,targetSat:1,minSat:.4,maxSat:1.01}},r=function(t,e,n,i,r){var o,s,a;return a=t.targetSat,s=t.targetLuma,i.color,o=7*i.count/r,7*c(e,a)+12*c(n,s)+o},c=function(t,e){return 1-Math.abs(t-e)},t=function(t){function Swatch(t,e){this.rgb=t,this.count=e,this._hsl=this._color=null}return f(Swatch,e),Swatch.property("rgb count"),Swatch.getter({inspectedObjects:function(){return{color:this.color,luma:this.luma,sat:this.sat,normalSat:this.normalSat,count:this.count}},hsl:function(){return this._hsl||(this._hsl=this.color.arrayHsl)},color:function(){return this._color||(this._color=p(this.rgb))},luma:function(){return null!=this._luma?this._luma:this._luma=this.color.perceptualLightness},sat:function(){return this._sat||(this._sat=this.color.perceptualSaturation)},normalSat:function(){return this.color.sat},isVibrant:function(){var t;return.4<=(t=this.sat)&&t<=1.01},isMuted:function(){var t;return 0<=(t=this.sat)&&t<=.4},isDark:function(){var t;return.1<=(t=this.luma)&&t<=.4},isNormal:function(){var t;return.4<=(t=this.luma)&&t<=.6},isLight:function(){var t;return.6<=(t=this.luma)&&t<=1.01}}),Swatch.prototype.getHueDiff=function(t){return this.color.getHueDifference(t.color)*Math.pow(s(this.sat,t.sat),2)*Math.pow(s(this.luma,t.luma),2)},Swatch.prototype.getLumaDiff=function(t){return Math.abs(this.luma-t.luma)},Swatch.prototype.qualifiesFor=function(t,e){var n,i,r,o,s,a;return r=t.minLuma,n=t.maxLuma,o=t.minSat,i=t.maxSat,this.count/e>5e-4&&r<=(s=this.luma)&&s<n&&o<=(a=this.sat)&&a<i},Swatch}(),function(c){var h,p,m,y;function Vibrant(t,e){var n,i,r,o;null==e&&(e={}),n=null!=(r=e.colorCount)?r:64,i=null!=(o=e.quality)?o:1,this.verbose=e.verbose,this._selectedSwatches={},this._selectedSwatchesList=[],this._populateSwatches(t,n,i),this._selectColors()}return f(Vibrant,e),p=function(t,e){return e=d(e),y(t,e.perceptualLightness,e.perceptualSaturation)},y=function(t,e,n){var i,r,o,s;return o=t.minLuma,i=t.maxLuma,s=t.minSat,r=t.maxSat,o<=e&&e<i&&s<=n&&n<r},Vibrant.getVibrantQualifyingColors=function(t,e){var i,r,o,s,a,l;for(l=null!=(s=n[e])?s:n.vibrant,a=[],r=0,o=t.length;r<o;r++)i=t[r],p(l,i)&&a.push(i);return a},Vibrant.getter({colors:function(){return l(this._selectedSwatches,function(t){return t.color})},rgbs:function(){return l(this._selectedSwatches,function(t){return t.rgb})}}),h=function(t,e,n,i){var r,o,s,a,l,u,c,h;for(r=[],(h=4*e)>0?(a=l=0,u=t.length):a=l=t.length-1;h>0?l<u:l>=0;a=l+=h)c=t[a],s=t[a+1],o=t[a+2],t[a+3]>=n&&c<=i&&s<=i&&o<=i&&r.push([c,s,o]);return r},Vibrant.prototype._populateSwatches=function(e,n,r){var a,l,c,p;return e.length/4,0===(a=h(e,r,128,250)).length&&(a=h(e,r,32,1e3)),0===a.length&&a.push([0,0,0]),l=u(a,n),this._maxCount=0,this._totalCount=0,this._inputSwatches=i(l.vboxes.map((p=this,function(e){var n;if(0<(n=e.vbox.count()))return p._totalCount+=n,p._maxCount=s(p._maxCount,n),new t(e.color,n)}))),this.verbose&&o({inputColors:function(){var t,e,n,i;for(i=[],t=0,e=(n=this._inputSwatches).length;t<e;t++)c=n[t],i.push(c.color);return i}.call(this)})},Vibrant.getter({debugSwatches:function(){var t;return{isVibrant:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._inputSwatches).length;e<n;e++)(t=i[e]).isVibrant&&r.push(t);return r}.call(this),isMuted:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._inputSwatches).length;e<n;e++)(t=i[e]).isMuted&&r.push(t);return r}.call(this),isDark:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._inputSwatches).length;e<n;e++)(t=i[e]).isDark&&r.push(t);return r}.call(this),isNormal:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._inputSwatches).length;e<n;e++)(t=i[e]).isNormal&&r.push(t);return r}.call(this),isLight:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._inputSwatches).length;e<n;e++)(t=i[e]).isLight&&r.push(t);return r}.call(this)}}}),Vibrant.prototype._selectColors=function(){var t,e,i,r,s,a,l,u,c;for(i in this.verbose&&o({_selectColors:{swatches:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._inputSwatches).length;e<n;e++)t=i[e].color,r.push(t);return r}.call(this)}}),n)if(u=n[i],s=function(){var t,e,n,i;for(i=[],t=0,e=(n=this._inputSwatches).length;t<e;t++)(l=n[t]).qualifiesFor(u,this._totalCount)&&i.push(l);return i}.call(this),this.verbose&&o(((r={})["qualifying swatches for "+i]=s,r)),this._selectSwatch(i,c=this._findColorVariation(i,s)))for(a=[c],e=2;c=this._findMaxDifferentVariation(i,s,a);)a.push(c),this._selectSwatch(""+i+e++,c);if(this.verbose)return o({Vibrant:{inputSwatches:function(){var e,n,i,r;for(r=[],e=0,n=(i=this._inputSwatches).length;e<n;e++)t=i[e].color,r.push(t);return r}.call(this),outputColors:this.colors}})},.015,1/8,.036,10,m=function(t,e){return Math.sqrt(Math.pow(10*t,2)+Math.pow(.5*e,2))},Vibrant.prototype._findMaxDifferentVariation=function(t,e,n){var i,r,s,l,u,c,h,p,d,f,g,y,v,S;for(r=0,s=0,i=0,l=null,y=null,this.verbose&&o({_findMaxDifferentVariation:{name:t,selectedVariations:function(){var t,e,i;for(i=[],t=0,e=n.length;t<e;t++)v=n[t],i.push(v.color);return i}()}}),h=0,d=e.length;h<d;h++)if(v=e[h],!this._isSelected(v)){for(c=10,g=10,u=10,p=0,f=n.length;p<f;p++)S=n[p],c=a(c,v.getHueDiff(S)),g=a(g,v.getLumaDiff(S)),u=a(u,m(c,g));i<u&&(i=u,r=c,s=g,u>.036?l=v:y=v)}return this.verbose&&o(l?{_findColorVariation:{bestSwatch:{name:t,color:l.color,bestHueDifference:r,bestLumaDifference:s,bestCartesianDiff:i,minCartesianDiff:.036}}}:{_findColorVariation:{done:{name:t,nextBest:null!=y?y.color:void 0,bestHueDifference:r,bestLumaDifference:s,bestCartesianDiff:i,minCartesianDiff:.036}}}),l},Vibrant.prototype._selectSwatch=function(t,e){return e&&(this._selectedSwatches[t]=e,this._selectedSwatchesList.push(e)),e},Vibrant.prototype._isSelected=function(t){return g.call(this._selectedSwatchesList,t)>=0},Vibrant.prototype._findColorVariation=function(t,e){var i,o,s,a,l,u,c,h,p;for(p=n[t],i=null,l=0,o=0,s=e.length;o<s;o++)h=e[o],this._isSelected(h)||(c=h.sat,a=h.luma,l<(u=r(p,c,a,h,this._maxCount))&&(i=h,l=u));return i},Vibrant}()})}).call(this,n(2)(t))},function(t,e){if(!n)var n={map:function(t,e){var n={};return e?t.map(function(t,i){return n.index=i,e.call(n,t)}):t.slice()},naturalOrder:function(t,e){return t<e?-1:t>e?1:0},sum:function(t,e){var n={};return t.reduce(e?function(t,i,r){return n.index=r,t+e.call(n,i)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?n.map(t,e):t)}};var i=function(){var t=5,e=8-t,i=1e3,r=.75;function getColorIndex(e,n,i){return(e<<2*t)+(n<<t)+i}function PQueue(t){var e=[],n=!1;function sort(){e.sort(t),n=!0}return{push:function(t){e.push(t),n=!1},peek:function(t){return n||sort(),void 0===t&&(t=e.length-1),e[t]},pop:function(){return n||sort(),e.pop()},size:function(){return e.length},map:function(t){return e.map(t)},debug:function(){return n||sort(),e}}}function VBox(t,e,n,i,r,o,s){this.r1=t,this.r2=e,this.g1=n,this.g2=i,this.b1=r,this.b2=o,this.histo=s}function CMap(){this.vboxes=new PQueue(function(t,e){return n.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function medianCutApply(t,e){if(e.count()){var i=e.r2-e.r1+1,r=e.g2-e.g1+1,o=e.b2-e.b1+1,s=n.max([i,r,o]);if(1==e.count())return[e.copy()];var a,l,u,c,h=0,p=[],d=[];if(s==i)for(a=e.r1;a<=e.r2;a++){for(c=0,l=e.g1;l<=e.g2;l++)for(u=e.b1;u<=e.b2;u++)c+=t[getColorIndex(a,l,u)]||0;h+=c,p[a]=h}else if(s==r)for(a=e.g1;a<=e.g2;a++){for(c=0,l=e.r1;l<=e.r2;l++)for(u=e.b1;u<=e.b2;u++)c+=t[getColorIndex(l,a,u)]||0;h+=c,p[a]=h}else for(a=e.b1;a<=e.b2;a++){for(c=0,l=e.r1;l<=e.r2;l++)for(u=e.g1;u<=e.g2;u++)c+=t[getColorIndex(l,u,a)]||0;h+=c,p[a]=h}return p.forEach(function(t,e){d[e]=h-t}),doCut(s==i?"r":s==r?"g":"b")}function doCut(t){var n,i,r,o,s,l=t+"1",u=t+"2",c=0;for(a=e[l];a<=e[u];a++)if(p[a]>h/2){for(r=e.copy(),o=e.copy(),s=(n=a-e[l])<=(i=e[u]-a)?Math.min(e[u]-1,~~(a+i/2)):Math.max(e[l],~~(a-1-n/2));!p[s];)s++;for(c=d[s];!c&&p[s-1];)c=d[--s];return r[u]=s,o[l]=r[u]+1,[r,o]}}}return VBox.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var e=this.histo;if(!this._count_set||t){var n,i,r,o=0;for(n=this.r1;n<=this.r2;n++)for(i=this.g1;i<=this.g2;i++)for(r=this.b1;r<=this.b2;r++)o+=e[getColorIndex(n,i,r)]||0;this._count=o,this._count_set=!0}return this._count},copy:function(){return new VBox(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(e){var n=this.histo;if(!this._avg||e){var i,r,o,s,a=0,l=1<<8-t,u=0,c=0,h=0;for(r=this.r1;r<=this.r2;r++)for(o=this.g1;o<=this.g2;o++)for(s=this.b1;s<=this.b2;s++)a+=i=n[getColorIndex(r,o,s)]||0,u+=i*(r+.5)*l,c+=i*(o+.5)*l,h+=i*(s+.5)*l;this._avg=a?[~~(u/a),~~(c/a),~~(h/a)]:[~~(l*(this.r1+this.r2+1)/2),~~(l*(this.g1+this.g2+1)/2),~~(l*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var n=t[0]>>e;return gval=t[1]>>e,bval=t[2]>>e,n>=this.r1&&n<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},CMap.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,n=0;n<e.size();n++)if(e.peek(n).vbox.contains(t))return e.peek(n).color;return this.nearest(t)},nearest:function(t){for(var e,n,i,r=this.vboxes,o=0;o<r.size();o++)((n=Math.sqrt(Math.pow(t[0]-r.peek(o).color[0],2)+Math.pow(t[1]-r.peek(o).color[1],2)+Math.pow(t[2]-r.peek(o).color[2],2)))<e||void 0===e)&&(e=n,i=r.peek(o).color);return i},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return n.naturalOrder(n.sum(t.color),n.sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var i=t.length-1,r=t[i].color;r[0]>251&&r[1]>251&&r[2]>251&&(t[i].color=[255,255,255])}},{quantize:function quantize(o,s){if(!o.length||s<2||s>256)return!1;var a=function getHisto(n){var i,r,o,s,a=new Array(1<<3*t);return n.forEach(function(t){r=t[0]>>e,o=t[1]>>e,s=t[2]>>e,i=getColorIndex(r,o,s),a[i]=(a[i]||0)+1}),a}(o);a.forEach(function(){});var l=function vboxFromPixels(t,n){var i,r,o,s=1e6,a=0,l=1e6,u=0,c=1e6,h=0;return t.forEach(function(t){i=t[0]>>e,r=t[1]>>e,o=t[2]>>e,i<s?s=i:i>a&&(a=i),r<l?l=r:r>u&&(u=r),o<c?c=o:o>h&&(h=o)}),new VBox(s,a,l,u,c,h,n)}(o,a),u=new PQueue(function(t,e){return n.naturalOrder(t.count(),e.count())});function iter(t,e){for(var n,r=1,o=0;o<i;)if((n=t.pop()).count()){var s=medianCutApply(a,n),l=s[0],u=s[1];if(!l)return;if(t.push(l),u&&(t.push(u),r++),r>=e)return;if(o++>i)return}else t.push(n),o++}u.push(l),iter(u,r*s);for(var c=new PQueue(function(t,e){return n.naturalOrder(t.count()*t.volume(),e.count()*e.volume())});u.size();)c.push(u.pop());iter(c,s-c.size());for(var h=new CMap;c.size();)h.push(c.pop());return h}}}();t.exports=i.quantize},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","String","Error","upperCase","peek","toSeconds","Neptune","lowerCamelCase","log"],[e,n(42)],(t,e,n,r,o,s,a,l,u)=>{let c,h,p;return p=t(),c=p.fakeExpired,h=p.fakeSubscriptionEnded,i.defClass(class UserLib extends Object{},function(t,p,d){this.getInitials=function(t){let o;return(o=i.exists(t)&&t.displayName||t)?(i.is(o,e)||(()=>{throw new n})(),r(o.match(/\b\w/g).join(""))):"..."},this.getDisplayName=function(t){let e;return null!=(e=i.exists(t)&&t.displayName)?e:"..."},this.getShortDisplayName=function(t){let e,n,r;return null!=(e=i.exists(n=null!=(r=i.exists(t)&&t.displayName)?r:t)&&n.match(/\b\w+/)[0])?e:"..."},this.getMediumDisplayName=function(t){let e,n,r,s;return(e=i.exists(t)&&t.displayName||t)?((e=e.trim()).length>20&&(r=(n=e.split(/\s+/g))[0],e=1===n.length?r:(s=o(n),e=`${i.toString(r)} ${i.toString(s)}`)),e):"..."},this.validMembershipTypes={trial:!0,subscriber:!0,purchase:!0,patron:!0,reward:!0},this.isOrWasMember=(t=>null!=this.getMembershipType(t)),this.isMember=(t=>this.isOrWasMember(t)&&0<this.membershipExpiresIn(t)),this.getMembershipType=(t=>t?t.membershipType||(null!=t.subscriptionExpiresAt?"subscriber":void 0):void 0),this.membershipExpiresIn=(t=>{let e;return s(null!=(e=i.exists(t)&&t.subscriptionExpiresAt)?e:0)-s()}),this.humanMembershipType=(t=>{let e;return(()=>{switch(e=i.exists(t)&&t.membershipType){case"subscriber":return"subscription";default:return e}})()}),this.receivedTrialMembership=(t=>null!=(i.exists(t)&&t.receivedTrialMembershipAt)),this.eligibleForTrialMembership=(t=>t&&!this.isMember(t)&&!this.receivedTrialMembership(t)),this.membershipExpired=(t=>this.isOrWasMember(t)&&0>this.membershipExpiresIn(t)),this.wasSubscribingMember=(t=>t.stripeCustomerId&&"subscriber"!==this.getMembershipType(t)||this.membershipExpired(t)),this.shouldStartTrialMembership=(t=>!this.isMember(t)&&this.eligibleForTrialMembership(t)),i.object(this.validMembershipTypes,(t,e)=>t=>{let n;return null!=t||(t=i.exists(n=a.Art.Flux)&&n.models.currentSession.currentUser),this.isMember(t)&&this.getMembershipType(t)===e},null,this,(t,e)=>l(`is ${i.toString(e)} member`)),this.isFullMember=(t=>this.isMember(t)&&"trial"!==this.getMembershipType(t)),this.isContributingMember=this.isFullMember,this.isNonTrialMember=(t=>(u.warn("isNonTrialMember is DEPRICATED. Use isFullMember."),this.isMember(t)&&"trial"!==this.getMembershipType(t))),c&&(this.isMember=function(t){return!1},this.receivedTrialMembership=function(t){return!0},this.membershipExpiresIn=function(t){return-3600}),h&&(this.getMembershipType=function(){return"subscriber"},this.isMember=function(){return!1},this.receivedTrialMembership=function(){return!0},this.membershipExpiresIn=function(){return-3600})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["justDetagString","detagString","merge","present","normalizeTags","findAllTags","upperCamelCase"],[e,n(559),n(571)],(t,e,n,r,o,s,a)=>{return i.defClass(class TopicLib extends Object{},function(l,u,c){let h,p;this.getDisplayTitle=h=function(e){let n;return null!=(n=t(i.exists(e)&&e.title))?n:"..."},this.getTopicTitle=h,this.preprocessTopic=function(t){let i,r;return[i,r]=e(t.title,1),n(t,{tags:i,displayTitle:r})},p=function(t,e){return r(e)&&t.test(o(e))},this.filterTopics=function(t,e){return e?i.array(t,null,t=>{let n,r,o;return p(e,t.title)||p(e,t.description)||p(e,i.exists(n=t.user)&&n.displayName)||p(e,i.exists(r=t.lastPost)&&r.caption)||p(e,i.exists(o=t.lastChapterPost)&&o.chapterTitle)}):null!=t?t:[]},this.getTagsFromTopics=function(t){let e;return i.each2(t,t=>(i.each2(s(t.title),t=>i.in(t=a(t),e)?void 0:e.push(t)),i.each2(s(t.description),t=>i.in(t=a(t),e)?void 0:e.push(t))),null,e=[])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["arrayToTruthMap","lowerCase","present","detagString","merge","toSeconds","secondsPer","hashtagRegexp","upperCamelCase","deMarkdown","justDetagString","niceMonthYear","stringHasTagsOrLinks","findUrlRegExp","getPlainTextTitle","getMarkdownTitle"],[e,n(559),n(571),n(558)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{let y;return y=t(e("#adelaide #atardecer #daphnie #hrit #irena1963 #kathip #lbaksheeva48 #lela123lela #lissy005 #lvw1122 #margarita #mironna #nazarenko432 #nette1652 #queenie #ruthie #sinnlich #portrait #frame #frames #double #multiple").split(/\s+/g)),i.defClass(class PostLib extends Object{},function(t,v,S){let b,w,x,P,C,_;this.preprocessPost=b=function(t){let e,s,a,l,u,c,h,p;return null!=t?(e=t.caption,s=t.chapterTitle,a=t.displayCaption,l=t.captionTags,u=t.linkToPostId,c=t.chapterTags,h=t.displayChapterTitle,p=!1,n(e)&&!a&&(p=!0,[l,a,u]=r(e.slice(0,256),null,!0)),n(s)&&!h&&(p=!0,[c,h]=r(s.slice(0,256),1)),p?o(t,{displayCaption:i.exists(a)&&a.replace(/\s*(\n\s*)+/g,"\n"),chapterTags:c,displayChapterTitle:h,captionTags:l,linkToPostId:u}):t):void 0},this.getCompactCaption=function(t){let e;return(e=i.exists(t)&&t.caption)?e.replace(/[\s\n]+/g," "):void 0},this.shortFormTextMaxLength=w=140,this.getIsChapterStart=function(t){return!(!i.exists(t)||!t.isChapterStart)},this.getIsCoverPhoto=(t=>{let e;return null!=(e=t.isCoverPhoto)?e:this.getIsChapterStart(t)}),this.getTrendingTags=(t=>{let e,n;return e=s()-a.month,n=i.array(t,null,t=>e<s(t.createdAt)),this.getMostUsedTags(n.length<5?t:n)}),this.getMostUsedTags=function(t){let r,o;return r={},o=!1,i.each2(t,t=>{let n;return n=t.caption.match(l),r.length>3&&(n=n.slice(0,3)),i.each2(n,n=>{let i,s;return i=e(n="#"+u(n)),y[i]?void 0:(o=!0,(null!=(s=r[i])?s:r[i]={tag:n,count:0}).count+=t.templateUseCount)})},t=>n(t.caption)),o?i.array(r).sort((t,e)=>e.count-t.count):[]},this.getIsCoverPhoto=function(t){return!(!i.exists(t)||!t.mediaFile)&&(null!=t.isCoverPhoto?!!t.isCoverPhoto:!!t.isChapterStart)},this.getShortCaption=function(t,e=32){let n,r,o;return(n=i.exists(t)&&t.caption)?([n,...r]=n.split(/\n/),n=c(n),r=!1,o="",i.each2(n.split(/[\s\n]+/g),t=>0===o.length||o.length+t.length+1<=e?o+=` ${i.toString(t)}`:r=!0),r&&(o+="..."),o.trim()):void 0},this.getAutoChapterTitle=((t,e)=>null!=t?n(t.chapterTitle)?h(t.chapterTitle):n(t.caption)?this.getPostTitle(t):p((null!=e?e:t).createdAt):void 0),this.getDisplayChapterTitle=x=function(t){return h(i.exists(t)&&t.chapterTitle)},this.getDisplayCaption=P=function(t){return h(i.exists(t)&&t.caption)},this.getCaption=P,this.getChapterTitle=x,this.getTextOnlyPostLayoutInfo=(t=>{let e,n,i;return(e=!t.mediaFile)&&(this.isShortFormTextPost(t)?(n=!1,i=!0):(n=!0,i=!1)),{textOnlyPost:e,showNoMedia:n,showNoText:i}}),this.isShortFormTextPost=function(t){let e;return!t.mediaFile&&(i.exists(e=t.caption)&&e.length)<=140&&!d(t.caption)},this.useFullscreenShortCaptionMode=function(t){let e;return!!t&&t.mediaFile&&!t.templatePostId&&!t.templateFile&&(!n(e=t.caption)||e.length<300&&!/\n+[^\n]+\n+/.test(e)&&!f.test(e))},this.getPostTitle=(t=>{let e;return t?n(t.chapterTitle)?this.getChapterTitle(t):n(t.caption)?h(m(null!=(e=g(t.caption))?e:t.caption)):void 0:void 0}),C=function(t,e){let n,r,o,s;return(i.exists(t)&&t.length)>e?(n=t.split(/\s+/),r=1,o=n[0].length,s=null,(()=>{for(;(s=n[r+1])&&o+1+s.length<_;)r++})(),n.slice(0,r).join(" ")):t},_=100,this.getShortPostTitle=(t=>C(this.getPostTitle(t),_)),this.getChapterOrPostTitle=(t=>t?t.chapterTitle?this.getDisplayChapterTitle(t):this.getPostTitle(t):void 0),this.getPostAspectRatio=function(t){let e,n,r,o,s;return null!=t&&(e=null!=(o=t.dimensions)?o:i.exists(s=t.bitmap)&&s.size)?(({x:n,y:r}=e),n/r):1},this.aspectRatioForPost=this.getPostAspectRatio})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["rgbColor","float32Eq","compactFlatten","reduceExpandedPalette"],[e,n(559),n(573)],(t,e,n,r)=>{let o,s,a,l,u;return o=o=t("#777"),{compareColorHues:s=s=function(t,e){return t.hue-e.hue},shadeColor:a=function(n,i){return n=t(n),null!=i||(i=.5),e(i,.5)?n:(n.eq(o)||(i=1/6+.75*i),i<.5?n.blend("black",1-i/.5):n.blend("white",(i-.5)/.5))},getPosterTextColorPalette:l=function(e){let a,l,u;return a=i.array(e.colors,e=>t(e)).sort(s),l=i.array(a,null,t=>t.sat>=.33&&t.perceptualLightness>=.5),u=i.array(a,null,t=>t.sat<.33||t.perceptualLightness<.5),n([o,r(l),r(u).reverse()])},generateBlurredBitmap:u=function(t,e){return t.fastBlurRGB(t.size.max()*e,{toClone:!0})}}}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["simpleBrowserInfo","verticalHostname"],[e,n(559),n(589)],(t,r)=>{let o,s,a,l;return o=n(270),s=(l=e).zoMask128DataUri,a=l.document,i.defClass(class UrlLib extends Object{},function(e,n,l){let u;this.zoMask128=u=i.exists(a)&&a.getElementById("zo_mask_128"),this.cacheSafeUrl=function(t){let e;return/#/.test(t)&&([t,e]=t.split("#")),`/${i.toString(t)}?${i.toString(o.version)}${i.toString(e?"#"+e:"")}`},this.assetUrl=(t=>s&&"zo_mask_128.png"===t?s:this.cacheSafeUrl(`assets/${i.toString(t)}`)),this.getFileFromUrl=function(t){return i.exists(t)&&t.match(/[a-zA-Z0-9]+\.[a-z]+$/)[0]},this.zoMaskBitmapProps={source:u||this.assetUrl("zo_mask_128.png")},this.corsSafeImageAssetUrl=(e=>{let n;return n=this.assetUrl(e),t.nativeApp&&!/^data:/.test(e)?`https://${i.toString(r)}/${i.toString(n)}`:n})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["mergeInto"],[e,n(42)],t=>{return i.defClass(class VerticalInfo extends Object{},function(e,r,o){let s,a;this.vertical=s=n(561)||"zoStream",this.isValidVertical=function(t){return(()=>{switch(t){case"imikimi":case"zoStream":case"zoPeople":return!0;default:return!1}})()},this.verticalHostnames={zoStream:"www.ZoStream.com",zoPeople:"www.ZoPeople.com",default:"zo.imikimi.com"},this.verticalEmailHostnames={zoStream:"ZoStream.com",zoPeople:"ZoPeople.com",default:"imikimi.com"},this.verticalProductNames={zoStream:"ZoStream",zoPeople:"ZoPeople",default:"Imikimi Zo"},this._getVerticalProp=((t,e)=>{let n;return null!=(n=this[t][null!=e?e:s])?n:this[t].default}),this.getVerticalProductName=(t=>this._getVerticalProp("verticalProductNames",t)),this.getVerticalHostname=(t=>this._getVerticalProp("verticalHostnames",t)),this.getVerticalEmailHostname=(t=>this._getVerticalProp("verticalEmailHostnames",t)),this.getVerticalRootHostname=(t=>this._getVerticalProp("verticalEmailHostnames",t)),this.getVerticalFromHostname=function(t){let e,n;return i.exists(t)&&(e=void 0!==(n=t.hostname)?n:t),(()=>{switch(!1){case!/zostream\.com/i.test(e):return"zoStream";case!/zopeople\.com/i.test(e):return"zoPeople";default:return"imikimi"}})()},this.getDocUrls=(t=>{let e;return e=this.getVerticalHostname(t),i.object(["community","terms","privacy","copyright"],t=>`https://${i.toString(e)}/docs/${i.toString(t)}.html`)}),this.verticalProductName=this.getVerticalProductName(s),this.verticalHostname=this.getVerticalHostname(s),this.docUrls=this.getDocUrls(s),t(this,n(590).verticalStrings[s]),null!=(a=this.verticalWelcomeHeader)||(this.verticalWelcomeHeader=`Welcome to ${i.toString(this.verticalName)}, ${i.toString(this.verticalTagline)}`)})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","Neptune","Object","upperCamelCase","isFailure","formattedInspect","networkFailure"],[e,n(540)],(t,e,r,o,s,a,l)=>{let u,c,h,p,d;return u=t().edge,i.exists(d=e.Art.Suite)&&(c=d.HotStyleProps),null!=c||(c=r),h=i.array(p=n(591).member,t=>o(t," ")).join(", "),i.defClass(class StringConstants extends c{},function(t,e,n){let r,o,c,d,f;this.communicationStatusMessages={success:"Success!",pending:"Your request is pending...",missing:"We couldn't find the requested object.",networkFailure:"Something when wrong with the internet. Can you check your internet connection and try again?",serverFailure:"Something went wrong on our servers.",clientFailure:"Something went wrong in our client.",failure:"Something went wrong."},this.humanStatusErrors={networkFailure:"Ooops! Something went wrong trying to reach our servers. Please check your internet connection and try again.",serverFailure:"Ooops! Something went wrong on our servers. We'll get right on that. In the mean time, would you care for some tea?",clientFailure:"Yikes! That's not quite right.",default:"Yikes! Something went wrong. Don't worry, we'll get it fixed as soon as possible."},this.getCommunicationStatusMessage=((t,e)=>{let n,r;return null!=(r=!(n=this.communicationStatusMessages[t])||s(t)?(n||(n=this.communicationStatusMessages.failure+` (${i.toString(a({status:t}))})`),t!==l&&(n+=" We'll work on making it better."),n=`We're sorry. ${i.toString(n)}\n\nIf the problem persists, please report the problem to feedback@imikimi.com.`,e&&(n+=`\n\n## Details:\n\n\`\`\`\n${i.toString(e)}\n\`\`\``),n):void 0)?r:n}),this.verticalStrings={zoPeople:{verticalName:"ZoPeople",verticalTagline:"the messenger for building amazing relationships & community",verticalGetStarted:"One trust at a time.",verticalSiteDescription:r="Our goal is to help people build meaningful relationships. That's why we created Zo Streams, a combination of blogs,\nphoto albums and social media. Streams give you total control over how you share and what you follow.\nWelcome to Zo."},zoStream:{verticalName:"ZoStream",verticalTagline:"apps for bringing out the best in people",verticalWelcomeHeader:"Bringing out the best in people",verticalGetStarted:"ZoStream is a safe place to share photos and stories of your kids, community, travels, projects and ideas with just the right people.",verticalSiteDescription:r},imikimi:{verticalName:u?"ZoKimi":"Imikimi Zo",verticalTagline:"creative frames and text for your treasured photos",verticalGetStarted:"Pick a frame to get started, then add your photo...",verticalSiteDescription:r}},this.systemNotifications={referralThankyou:"Thank you for inviting %displayName%. You have earned 1 free month of Imikimi Zo Membership.",receivedReferral:"Thank you for joining us! Your invite from %displayName% was successful. Please enjoy your two free months of full Imikimi Zo Membership. You can earn more free months by inviting your friends.",topicMembership:{invite:"%invitedByUserDisplayName% invited you to join: %streamTitle%.",accept:"%acceptedByUserDisplayName% accepted your invite for: %streamTitle%.",declined:"%acceptedByUserDisplayName% declined your invite for: %streamTitle%. You can leave the invitation open in case they change their mind, or you can delete your invitation.",updated:"%updatedByUserDisplayName% updated your access to: %streamTitle%. You can now perform the following actions: %canDoActions%."}},this.membershipBenefits={goldProfileRing:o="The Gold Profile Ring is a gold-colored ring that appears around your profile photo everywhere on Imikimi Zo. The ring\nshows everyone that you are a valued Contributing Member of the Imikimi Zo community.",contributingMember:`${i.toString(o)}\n\nAll paying customers are contributing members. You can also become a contributing member by inviting your friends.`,isAContributingMember:"You are a Contributing Member. Thank you!",isNotAContributingMember:"Start your subscription now to become a Contributing Member and get your Gold Profile Ring!"},this.membership={ourMission:c="Our mission is to create a positive place for you and all your favorite people.\nWe are ad-free and do not share your private information with anyone.\nWe do this so you can relax, enjoy and spend more time connecting with the people who matter most.",thankyouSignature:d=">-- Thank you,<br>Shane & Kent",joinUs:`${i.toString(c)}\n\nWe need your help. Please become a Member.\n\n${i.toString(">-- Thank you,<br>Shane & Kent")}`,streamEditorFeatures:f=["re-order posts within a stream","move posts to other streams","quickly organize chapters","bulk-upload photos","bulk-delete posts"],memberBenefits:`There are many membership benefits, and we are adding more all the time.\n\n* Support our mission of positive contribution, creative expression and meaningful connection\n* Create up to 100 Kimis per week<br>(non-member limit: 7/week)\n* Say YES to no-ads and privacy protection\n* ${i.toString(p.length)} Member Poster Text styles: ${i.toString(h)}\n* 100 fonts of all kinds: light, bold, cursive, handwritten, dirty, playful, themed, slab and many more\n* 9 Member text effects including Platinum, Flashy, Paper, Wood and Gems\n* Following: See what's new from the people and streams you are following quick and easy - right on your home page.\n* Stream Editor: The steam editor gives you full control over your streams.\n\n${i.toString(i.array(f,t=>`** ${i.toString(t)}\n`))}`,memberShortPitch:"Basic image creation, streams and sharing are always free.\n\nBecome a member to join our community,\nget the Gold Profile Ring,\nand ensure interruption-free access to all the premium member benefits.",appSubscriptionNotSupported:"## How to become a Member\n\nWe appologize, but we don't support Membership payments in this App yet...\n\nHowever, you can start and manage your membership with a web browser and enjoy\nthe benefits everywhere, including here in the app.\n\n1. Go to Imikimi.com\n1. Log into your account\n1. Tap the become-a-member button in your Profile Settings\n\nIf you have questions, please let us know at feedback@imikimi.com.",startSubscriptionSectionTitle:"Start a Subscription",purchaseTimeSectionTitle:"Purchase time without a subscription",signUpLongPrompt:"Sign up for your FREE, 1-month trial with access to all membership benefits. All you need is an email.",howToBecomeAMemberSectionTitle:"How to become a Member",howToBecomeAMember:"We have many ways for you to become member:\n\n1. Start a subscription<br>or purchase time without a subscription\n1. Invite friends\n1. Apply for sponsorship",referralProgramSectionTitle:"Invite Friends",referralProgramPrompt:"> We appriciate you sharing Imikimi Zo with your friends. In exchange, we'll give you and each friend who joins an extra FREE month of Imikimi Zo Membership.",shortPurchaseTimeExplanation:"Time-purchases are billed once, immediately. When that time expires, your account will return to the free level.",shortSubscriptionExplanation:"New subscriptions are billed immediatly and then once every month or year respecitvely. You can cancel or resume your subscription at any time."},this.referrals={shortShareMessage:"Use this link to join Imikimi Zo and get two FREE months Membership:\n\n%referralLink%",emailBody:"Join Imikimi Zo and get two FREE months Membership:\n\n1) Open this: %referralLink%\n\n2) Create your account to receive two FREE months of Imikimi Zo membership(*)\n\n* Only new customers are eligable. If you already have an Imikimi Zo account, you can earn free months by inviting new people to the site from your Profile Settings.",notEligableMessage:"## Invite others to earn free months\n\nSince you already have an account, you are not eligible to receive a invite from\n%displayName%.\n\nDon't worry! You can still earn free months by\ninviting your friends to Imikimi Zo. Find out more under your Profile Settings.",ownReferralLinkMessage:"## Your invite link works!\n\nNow send it to friends, family, or anyone you think may be\ninterested in trying Imikimi Zo.\n\nEach person that signs up after clicking your link:\n\n* receives 1 free month plus their 1 free month trial for a total\nof 2 free months of Imikimi Zo Membership\n* you receive an additional free month of Imikimi Zo Membership\n* and you both get promoted to Contributing Members with the Gold Profile Ring\n\n>-- Thank you for sharing Imikimi Zo,\n<br> - Shane & Kent",referralCongratulations:"Congratulations, you have an invite from %displayName%!",createAccountWithReferralRewardInfo:"When you create your account you will receive\nan additional free month for a total of:\n\n## 2 FREE months of Imikimi Zo Membership",explanationPart1:"## Invite Friends\n\nEarn a FREE month of Imikimi Zo Membership for\nyou and every friend who joins.",explanationPart2:"Invite more people to get more free months!\n\n>-- Thank you for sharing Imikimi Zo,<br>-Shane & Kent",faq:`Q: How does the invite work?\n> A: Send an invite to a friend. They open the link and create their Imikimi Zo account. All they need is\ntheir email address.\nThen you both get an extra free month of Imikimi Zo membership.\n\nQ: What exactly happens when someone signs up after using my invite link?\n> A: They receive 2 free months of Imikimi Zo Membership.\nPlus, they get the Contributing\nMember Gold Profile Ring.\n> Normally, new customers only receive one free month\nand no Gold Profile Ring.\n\nQ: I have a trial membership, what happens when I invite someone?\n> A: Your membership will be extended by one month, and you will get the Contributing Member Gold Profile Ring.\n\nQ: I'm already a subscriber, what happens when I invite someone?\n> A: Each time you invite someone your membership will be extended and your next payment date will be moved back by one month.\n\nQ: What is the Gold Profile Ring?\n> A: ${i.toString(o)}`},this.auth={aboutCodesMessage:"Please enter the code we emailed you to finish. Search your email for 'zo login'. If you have multiple code-emails, use the newest code.\n\n example: ABC-XYZ\n uppercase or lowercase, doesn't matter\n dashes (-) are optional\n for your security, codes expire after %codeExpiresIn%",aboutDisplayNameMessage:"Please enter your name to continue.\nNote: This name is public.",aboutEmailMessage:"Please enter a valid email address to continue.\nWe will always respect your email address. We won't send you emails you didn't request. We will never share your email."},this.streamExplanations={streamFollows:"When you follow a stream it will show up on your home page.\nYou will also show up in the list of followers for that stream.",streamSubscriptions:"When you subscribe to a stream you will receive\nan email for each new post. Only you can see if\nyou are subscribed or not to a stream.",streamMemberships:"You must be a member to view and comment on other people's private streams.\nYour membership status is visible to other members of that stream.\nAs a member you may also be granted posting or adminstrator access by\nthe stream owner or other administrators.",outstandingInvites:"Accept outstanding stream invites to view the stream.\nOnce you accept, you can\nchoose separately to follow or subscribe to that stream.",declinedInvites:"Declined invitations can be accepted at a later date.",streamInviteLink:"Share this stream invite-link with anyone\nyou want to join this stream."}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["log","compactFlatten","getEnv"],[e,n(42)],(t,e,n)=>{let i,r,o,s;return i=["AsYouLikeIt"],o=[],{member:s=t(e([r=["MuchAdoAboutNothing","SenseAndSensibility","HenryIv","TheAdventuresOfTomSawyer","TheGreatGatsby","Neuromancer","JuliusCaesar","BassettDinner","SaintNicholas"],n().edge?o:void 0])),all:e([i,s])}}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Promise","Neptune","log","isString"],[e,n(559)],(t,e,n,r)=>{return i.defClass(class EmailLib extends Object{},function(o,s,a){let l;l=null,this.resetTestEmails=function(){return l=[]},this.getTestEmails=function(){return l},this.sendEmail=function(o){return t.then(()=>{let t;return i.exists(t=e.Art.Mailgun)&&t.configured()?e.Art.Mailgun.sendEmail(o):"Test"===e.Art.Config.configName?(null!=l?l:l=[]).push(o):n({EmailLib:{sendEmail:{message:"Mailgun not configured",emailParams:i.object(o,(t,e)=>r(t)&&t.length>80?`${i.toString(t.length)} bytes: ${i.toString(t.slice(0,20))}...`:t)}}})})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["RegExp"],[e,n(559)],t=>{return i.defClass(class RegExpLib extends Object{},function(e,n,i){this.paragraphBoundaryRegexp=/\s*(?:\n\s*)+/g,this.createFilterRegExp=function(e){return new t(e,"i")}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s,a={}.hasOwnProperty;s=n(42),i=s.lowerCamelCase,r=s.merge,o=n(134).pipelines,t.exports=function(t){return function(e){function EventLogMixin(){return EventLogMixin.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(EventLogMixin,t),EventLogMixin.extendableProperty({eventKey:null}),EventLogMixin.getter({internalEventKey:function(){var t;return null!=this.__eventKey?this.__eventKey:this.__eventKey=null!=(t=this.getEventKey())?t:i(this.class.getName())},eventPipeline:function(){return this.eventPipelineOverride||o.event}}),EventLogMixin.prototype.buildEventKey=function(t){return this.internalEventKey+":"+t},EventLogMixin.prototype.createEvent=function(t,e){return this.eventPipeline.create(this.buildEventKey(t),{data:this.filterEventData(e)})},EventLogMixin.prototype.createEventOncePerHour=function(t,e){return this.eventPipeline.create(this.buildEventKey(t),{data:this.filterEventData(e),props:{oncePerHour:!0}})},EventLogMixin.prototype.filterEventData=function(t){return t},EventLogMixin.prototype.createRequestEvents=function(t,e,n){return this.createEvent(t+":start",n),e.tap((i=this,function(e){return i.createEvent(t+":success",r(e,n)),null})).tapCatch(function(e){return function(i){var o,s;return o=i.message,s=i.status,e.createEvent(t+":failure",r({message:o,status:s},n)),null}}(this));var i},EventLogMixin}()}},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","Neptune","log"],[e,n(540)],(t,e,n)=>{let r;return r=t().dev,i.defClass(class ServerSideMixins extends Object{},function(t,o,s){let a,l;this.ServerSide=a=void 0!==(l=e.Imikimi.Oz.ServerSide)?l:{},this.ServerSideMixin=function(t,e){let o,s;return(o=null!=(s=a[t])?s:a[t+="Mixin"])?(n(`ServerSideMixin ENABLED: ${i.toString(t)}`),o(e)):(r&&n(`ServerSideMixin DISABLED: ${i.toString(t)}`),e)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=n(597)},function(t,e,n){(t.exports=n(598)).includeInNamespace(n(601)).addModules({Formatters:n(602),Icons:n(603),ImikimiPalette:n(575),ImikimiStyles:n(604),MarkdownStyles:n(605),StandardImport:n(563),Vertical:n(562)})},function(t,e,n){t.exports=n(599).addNamespace("Style",class Style extends Neptune.PackageNamespace{}._configureNamespace(n(600)))},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Imikimi"),n(598)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-class-system":"*","art-config":"*","art-standard-lib":"*","art-testbench":"*","bluebird":"^3.5.0","caffeine-script":"*","caffeine-script-runtime":"*","case-sensitive-paths-webpack-plugin":"^2.1.1","chai":"^4.0.1","coffee-loader":"^0.7.3","coffee-script":"^1.12.6","colors":"^1.1.2","commander":"^2.9.0","css-loader":"^0.28.4","dateformat":"^2.0.0","detect-node":"^2.0.3","fs-extra":"^3.0.1","glob":"^7.1.2","glob-promise":"^3.1.0","json-loader":"^0.5.4","mocha":"^3.4.2","neptune-namespaces":"*","script-loader":"^0.7.0","style-loader":"^0.18.1","webpack":"^2.6.1","webpack-dev-server":"^2.4.5","webpack-merge":"^4.1.0","webpack-node-externals":"^1.6.0"},"description":"Imikimi.Style","license":"Copyright (C) 2019 Imikimi, LLC","name":"imikimi-style","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"webpack-dev-server --progress","testInBrowser":"webpack-dev-server --progress"},"version":"0.14.2"}')},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(602),n(564).Style])}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["pluralize","commaize"],[e,n(563)],(t,e)=>{return i.defClass(class Formatters extends Object{},function(n,r,o){let s,a;s={k:"thousand",m:"million",b:"billion"},this.formatted3DigitCount=a=function(t,e){let n;return t=(()=>{switch(!1){case!(t<1e3):return t;case!(t<1e6):return n="k",t<1e5?(t/100|0)/10:t/1e3|0;case!(t<1e9):return n="m",t<1e6?(t/1e5|0)/10:t/1e6|0;default:return n="b",t/1e9|0}})(),n?(e&&(n=" "+s[n]),`${i.toString(t)}${i.toString(n)}`):t},this.pluralize3DidgetCount=function(e,n,r){return`${i.toString(a(e,r))} ${i.toString(1!==e?t(n):n)}`},this.nicePluralize=function(n,r,o){let s;return 1===n?`${i.toString(n)} ${i.toString(r)}`:(s=o?n>=1e6?`${i.toString(n/1e6|0)}m`:n>=1e3?`${i.toString(n/1e3|0)}k`:`${i.toString(n)}`:e(n),`${i.toString(s)} ${i.toString(t(r))}`)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l={}.hasOwnProperty;a=n(540),r=a.log,i=a.defineModule,o=a.mergeInto,s=a.object,e=a.HotStyleProps,i(t,function(t){var n;function Icons(){return Icons.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Icons,e||s),n={ticket:"",tag:"",trending:"",camera:"",leaf:"",openArmPerson:"",thumbsUp:",",trophy:",",tree:",",birthday:",",sun:",",moon:",",filter:",",tiles:",",sliders:",",alignCenter:",C",alignLeft:",L",alignRight:",R",pause:",",appleInc:",",layers:",",android:",",checkboxUnchecked:",",checkboxChecked:",",eyeBlocked:",",blockUser:",",blockComment:",",link:",",enlarge:"",shrink:"",frame:",",flip:",",eye:",",brokenHeart:",",heart:",",book:",",menu:",",first:"",last:"",palette:",",home:",",magicWand:",",footprint:"",helpInverted:",?",help:",?",creditCard:",",paintbrush:",",bookmarkBook:",",chapter:",",login:",",logout:",",cloudUpload:",",cloudDownload:",",mail:",",angleLeft:",",back:",",angleRight:",",angleUp:",",angleDown:",",angleArrowDownLarge:",",angleArrowDownSmall:",",angleArrowDownSmallBold:",",angleDoubleLeft:",",angleDoubleRight:",",angleDoubleUp:",",angleDoubleDown:",",arrowCircleLeft:",",arrowCircleRight:",",arrowCircleUp:",",arrowCircleDown:",",arrowLeft:",",arrowRight:",",arrowUp:",",arrowDown:",",download:",",bars:"",bell:"",bell2:"",bell3:"",bookmark:"",bubble:",",bubbles:",",cancel:",",check:",",checkMark:",",checkmark:",",clipboard:"",close:",X",cog:",",copy:",+",cut:",",droplet:",",earth:",",share:",",export:",",flag:",",handLeft:",",handRight:",",image:",",info:",i",infoInverted:",i",info2:",i",list:"",lock:",",unlock:",",private:",",public:",",loop:"",list:"",newspaper:"",pencil:",",pie:"",quill:"",redo:",",reload:"",retry:"",save:"",search:",",smiley:",",smileyInverted:",",spinner:"",target:",",trash:",",triangleLeft:",",triangleRight:",",triangleUp:",",triangleDown:",",undo:",",user:",",users:",",vDown:"",vDownSmall:"",vDownSmallBold:"",gift:","},Icons.icomoon=s(n,function(t){return{fontFamily:"icomoon",layoutMode:"tight",fontSize:24,text:t.split(",")[0],size:"childrenSize"}}),o(Icons.icomoon,{bullet:{fontFamily:"Times",fontSize:32,text:"",layoutMode:"tight"},capitalA:{fontFamily:"Times",fontSize:32,text:"A",layoutMode:"tight"},capitalT:{fontFamily:"Times",fontSize:32,text:"T",layoutMode:"tight"},box:{fontFamily:"Times",fontSize:32,text:"",layoutMode:"tight"},plus:{fontFamily:"Times",fontSize:32,text:"+",layoutMode:"tight"},minus:{fontFamily:"Times",fontSize:32,text:"-",layoutMode:"tight"},error:{fontFamily:"Times",fontSize:32,text:"!",layoutMode:"tight",fontWeight:"bold"},circlePlus:{fontFamily:"Times",fontSize:32,text:"",layoutMode:"tight"},hashtag:{fontFamily:"Arial",fontSize:32,text:"#",layoutMode:"tight"},"+":{fontFamily:"Arial Black",layoutMode:"tight",fontSize:36,text:"+"},"!":{fontFamily:"Arial Black",layoutMode:"tight",fontSize:36,text:"!"},star:{fontFamily:"Arial",fontSize:26,text:"",layoutMode:"tight"},openStar:{fontFamily:"Arial",fontSize:26,text:"",layoutMode:"tight"},square:{fontFamily:"Arial",fontSize:26,text:"",layoutMode:"tight"}}),o(Icons,Icons.icomoon),Icons.icons=Icons.icomoon,Icons.setFontFailedToLoad=function(){return o(Icons,o(Icons.icomoon,s(n,function(t,e){var n,i,r;return(n=t.split(","))[0],{color:(r=null!=(i=n[1])?i:"-").charCodeAt()>255?"black":void 0,fontFamily:"Arial",fontSize:26,layoutMode:"tight",text:r}}))),r({icomoon:Icons.icomoon})},Icons}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Object","veryLightGrey","merge","darkContrastOutlineColor","rgbColor","lightContrastOutlineColor","Math","max","bound"],[e,n(42),n(313),n(575)],(t,n,r,o,s,a,l,u,c)=>{let h,p;return h=i.exists(p=e.Neptune.Art.Suite)&&p.HotStyleProps||t,i.defClass(class ImikimiStyles extends h{},function(t,e,i){this.tabBarColor="#f",this.popOverColor=n,this.touchButtonSize=48,this.desktopButtonSize=38,this.overBackgroundShadow={color:"#0007",blur:4},this.tabBarBackground={color:this.tabBarColor,shadow:r(this.overBackgroundShadow,{offset:0})},this.topTabBarBackground={color:this.tabBarColor},this.getContrastingColor=function(t,e){return e=s(e||"white"),t=s(t),(t=e.blend(t)).perceptualLightness<.25?a:o},this.imageContrastOutlineStyle={color:o},this.tinyShadow={color:"#0007",offset:{y:1},blur:.5},this.tinyUpShadow={color:"#0007",offset:{y:-1},blur:.5},this.lightShadow={color:"#0007",blur:15,offset:{y:5}},this.mediumShadow={color:"#000d",blur:10,offset:{y:3}},this.heavyShadow={color:"#000",blur:20,offset:{y:5}},this.sineGradient=function(t,e,n=10,i=0){let r,o,a,h,p,d;return t=s(t),e=s(e),r=1/(1-l.abs(i)),o=u(i,0),a=[],d=(p=0)<(h=n)?1:-1,(()=>{for(;d>0&&p<h||d<0&&p>h;){let i,s,u;i=p,a.push((u=((s=c(0,s=(i/(n-1)-o)*r,1))-.5)*l.PI,t.interpolate(e,(l.sin(u)+1)/2))),p+=d}})(),a}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Neptune","Object","TextPalette","select","merge","TextStyles"],[e,n(563)],(t,e,n,r,o,s)=>{let a,l,u,c;return a={leading:1.58},l=null!=(u=i.exists(c=t.Art.Suite)&&c.HotStyleProps)?u:e,i.defClass(class MarkdownStyles extends l{},function(t,e,i){this.dialog={textPalette:{black:{primary:n.black.softPrimary}}},this.preview={textPalette:{black:{primary:n.black.secondary}}},this.default={bullets:["",""],textPalette:{white:r(n.white,"primary","secondary"),black:r(n.black,"primary","secondary")},textStyles:{large:{titleStyle:o(s.xxLargeBoldText,a),h1Style:o(s.xLargeBoldText,a),h2Style:o(s.largeBoldText,a),paragraphStyle:o(s.largeText,a),l1Style:o(s.largeText,a),l2Style:o(s.largeText,a),quoteStyle:o(s.largeItalicText,a),monoStyle:o(s.mediumMonospaceText,a)},medium:{titleStyle:o(s.xLargeBoldText,a),h1Style:o(s.largeBoldText,a),h2Style:o(s.mediumBoldText,a),paragraphStyle:o(s.mediumText,a),l1Style:o(s.mediumText,a),l2Style:o(s.mediumText,a),quoteStyle:o(s.mediumItalicText,a),monoStyle:o(s.smallMonospaceText,a)},small:{titleStyle:o(s.largeBoldText,a),h1Style:o(s.mediumBoldText,a),h2Style:o(s.smallBoldText,a),paragraphStyle:o(s.smallText,a),l1Style:o(s.smallText,a),l2Style:o(s.smallText,a),quoteStyle:o(s.smallItalicText,a),monoStyle:o(s.tinyMonospaceText,a)},smallWithSmallTitles:{titleStyle:o(s.mediumBoldText,a),h1Style:o(s.mediumBoldText,a),h2Style:o(s.smallBoldText,a),paragraphStyle:o(s.smallText,a),l1Style:o(s.smallText,a),l2Style:o(s.smallText,a),quoteStyle:o(s.smallItalicText,a),monoStyle:o(s.tinyMonospaceText,a)}}}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=n(607)},function(t,e,n){(t.exports=n(608)).addModules({ActivityBadge:n(611),AnimatedIcon:n(612),AnimatedIconTextButton:n(614),BarButton:n(616),ButtonWrapper:n(615),ButtonWrapper2:n(617),DelayApplyTextInput:n(618),LoadingOverlay:n(619),PrimaryMenuButton:n(621),ProgressBar:n(622),ScrollerWithBar:n(623),ShowColorMap:n(624),SimpleMenuTextInput:n(625),SimpleTagLink:n(626),Spinner:n(620),StandardImport:n(613),SubmitField:n(627),TabbedBar:n(629),TabButton:n(630),TabButtonWithConfirm:n(631),TextInputSubmitButton:n(628),TimeoutWrapper:n(632)})},function(t,e,n){t.exports=n(609).addNamespace("Widgets",class Widgets extends Neptune.PackageNamespace{}._configureNamespace(n(610)))},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Imikimi"),n(608)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-suite":"git://github.com/imikimi/art-suite.git","case-sensitive-paths-webpack-plugin":"^1.1.4","chai":"^3.5.0","coffee-loader":"^0.7.2","coffee-script":"^1.11.1","css-loader":"^0.23.1","json-loader":"^0.5.4","mocha":"^2.5.3","neptune-namespaces":"^1.5.0","script-loader":"^0.7.0","sourcemapped-stacktrace":"^1.1.3","style-loader":"^0.13.1","webpack":"^1.13.2","webpack-dev-server":"^1.16.2"},"description":"Common Components shared across Imikimi ArtSuite apps","license":"Copyright (C) 2019 Imikimi, LLC","name":"imikimi-widgets","scripts":{"build":"nn -s; webpack --progress","nodeTest":"nn -s; mocha -u tdd --compilers coffee:coffee-script/register","start":"nn -s; webpack-dev-server --hot --inline --progress","test":"nn -s; webpack-dev-server -d --progress"},"version":"1.6.0"}')},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p={}.hasOwnProperty;(u=Neptune.Art).Foundation,u.Atomic,u.React,u.Flux,a=u.defineModule,a=(c=Neptune.Art.Suite).defineModule,c.log,c.merge,c.clone,c.peek,c.inspect,c.timeout,c.randomElement,l=c.min,c.max,c.currentSecond,c.round,c.shuffleArray,c.shallowClone,c.point,c.rgbColor,e=c.Component,c.createComponentFactory,i=c.Element,c.RectangleElement,o=c.TextElement,c.OutlineElement,c.BitmapElement,c.TextInputElement,c.FillElement,l=c.min,h=n(596),s=h.TextStyles,h.TextPalette,r=h.ImikimiPalette,a(t,function(t){function ActivityBadge(){return ActivityBadge.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ActivityBadge,e),ActivityBadge.prototype.render=function(){var t,e,n,a,u,c,h;return n=(c=this.props).count,a=c.location,t=c.axis,u=c.radius,e=c.border,u||(u=5),e=e?1:0,h=n>0?(n=l(n,99),13+u+e):3+u+e,i({animators:{scale:{toFrom:0,duration:1,f:"easeInElastic"}},location:null!=a?a:{xw:11/12,yw:1/12},axis:null!=t?t:"topRight",inFlow:!1,size:h,draw:{radius:1e3,fill:r.activityBadge,outline:e>0?"white":void 0,lineWidth:e}},n>0?o(s.bittyText,{size:"childrenSize",location:{ps:.5,x:1===n?-.5:0,y:-.5},layoutMode:"tight",axis:.5,color:"white",text:n}):void 0)},ActivityBadge}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","Icons"],[e,n(613)],(t,e,n,r)=>{return i.defClass(class AnimatedIcon extends t{},function(t,i,o){this.subscriptions("viewState.buttonSize"),this.propFields("scale","icon","color","size"),this.prototype.render=function(){let t,i,o,s,a,l,u;return u=this,t=this.scale,i=this.color,o=this.icon,s=this.size,a=this.buttonSize,l=this.shadow,null!=s||(s=a),null!=t||(t=s/a),e({size:25*t},n(r[o],"parentSize","textCenterCenter","centerCenter",{key:o,fontSize:r[o].fontSize*t,color:i,shadow:l,animators:{scale:{toFrom:0,f:"easeInBounce",duration:1}}}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(307).mergeWithSelf(n(596)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette","ButtonWrapper","Element","TextElement","TextStyles"],[e,n(613),{ButtonWrapper:n(615),ActivityBadge:n(611)}],(t,e,r,o,s,a)=>{return i.defClass(class AnimatedIconTextButton extends t{},function(t,i,l){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x;return t=(b=this.props).height,i=b.icon,l=b.tight,u=b.textStyle,c=b.shadow,h=b.iconColor,p=b.text,d=b.label,f=b.iconScale,m=void 0!==(w=b.color)?w:e.white.primary,g=b.backgroundElements,y=b.backgroundIcon,v=(x=this.viewState).buttonSize,S=x.gridSize,null!=t||(t=v),null!=f||(f=t/v),null!=d||(d=p),r(this.props,{size:l?d?{wcw:1,h:t}:t:{ww:1,h:t},clip:!0,key:"AnimatedIconTextButton-internal"},o("row","childrenCenterCenter",{childrenMargins:S/2},g,l&&d?["parentHeightChildrenWidth",{padding:{h:S}}]:void 0,y&&o({draw:"blue",inFlow:!1,size:25*f},d?"centerLeft":"centerCenter",y),i&&n(612)({icon:i,scale:f,color:h||m,size:t,shadow:c}),d&&o("parentHeightChildrenWidth",{key:"label",clip:!0,margin:S/2,animators:{size:{toFrom:{w:0}},margin:{toFrom:0}}},s(a.smallText,u,["centerLeft","childrenSize"],{text:d,color:m,shadow:c}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty;s=(p=n(307)).defineModule,e=p.Element,p.Component,h=p.objectWithout,o=p.PointerActionsMixin,i=p.FluxComponent,f=p.rgbColor,l=p.hslColor,c=p.merge,p.OutlineElement,u=p.isFunction,a=n(341).Element.getSizePointLayout,(d=Neptune.Imikimi.Style).Icons,d.TextPalette,r=d.ImikimiPalette,d.TextStyles,s(t,function(t){function ButtonWrapper(){return ButtonWrapper.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ButtonWrapper,o(i)),ButtonWrapper.subscriptions("viewState.gridSize"),ButtonWrapper.stateFields({children:[]}),ButtonWrapper.prototype.preprocessProps=function(t){var e,n,i,o,s,a,u,p,d,m,g;return s=t.disabled,o=t.children,e=t.action,u=t.hoverColor,i=t.backgroundColor,(n=null!=(d=t.background)?d:i)?(a=(m=n=f(n)).h,g=m.s,p=m.l,u=u?f(u):n.eq(r.primary)?l(a,2*g/3,1-1*(1-p)/3):g<.1?r.primary:n.withAlpha(.5)):(u=f(u||r.primary),n||(n=u.withAlpha(0))),e||(s=!0),this.setState({children:o}),c(h(t,"children"),{background:n,hoverColor:u,disabled:s})},ButtonWrapper.prototype.render=function(){var t,n,i,o,s,l,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E;return m=null!=(y=(g=this.props).radius)?y:this.gridSize/2,i=null!=(v=g.backgroundPadding)?v:2,P=g.selected,C=g.selectedColor,c=g.disabled,p=g.hoverColor,n=g.backgroundColor,t=null!=(S=g.background)?S:n,E=g.size,_=g.shadow,h=null!=(b=g.disabledOpacity)?b:.5,x=null!=(w=g.scaleAxis)?w:.5,d=g.noBackground,f=g.outline,l=!c&&this.hover?p:P?null!=C?C:p.withAlpha(.5):t===r.primary&&c?r.grey:t,E&&(E=a(E)).childrenRelative&&(s=E),e({on:this.buttonHandlers},this.props,{size:null!=E?E:"parentSize",childArea:"ignoreTransforms"},e({animators:{scale:{duration:.15},opacity:!0,draw:!0},location:{ps:x},cursor:!c&&"pointer",axis:x,scale:!c&&this.pointerIsDown?.9:1,opacity:c?h:1,size:s,draw:d?void 0:{rectangle:{radius:m},padding:i,fill:{shadow:_,color:l},outline:f||void 0}},this.children&&function(){var t,e,n,i;for(i=[],t=0,e=(n=this.children).length;t<e;t++)o=n[t],u(o)?i.push(o(this.hover)):i.push(o);return i}.call(this)))},ButtonWrapper}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d={}.hasOwnProperty;c=(h=n(613)).defineModule,r=h.FluxComponent,i=h.Element,a=h.TextElement,h.merge,h.objectWithout,h.min,h.max,h.log,h.formatted3DigitCount,p=Neptune.Imikimi.Style,o=p.Icons,l=p.TextPalette,s=p.ImikimiPalette,u=p.TextStyles,e=n(615),n(611),c(t,function(t){function BarButton(){return BarButton.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)d.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(BarButton,r),BarButton.subscriptions("viewState.viewState"),BarButton.prototype.render=function(){var t,n,r,c,h,p,d,f,m,g,y,v;return d=(f=this.props).primary,h=f.icon,f.center,y=f.text,t=f.action,p=null!=(m=f.iconScale)?m:1,r=(g=this.viewState).buttonSize,c=g.gridSize,d?(n=s.primary,v=l.white.primary):(n=s.lightGrey,v=l.black.secondary),e({size:"parentWidthChildrenHeight",action:t,radius:r/2,backgroundColor:n,backgroundPadding:0},i({size:"parentWidthChildrenHeight",childrenLayout:"row",childrenAlignment:.5,childrenMargins:c/2,padding:{h:c}},h&&i({size:{h:r,w:.75*r}},a(o[h],{color:v,scale:p,location:"centerCenter",axis:.5,align:.5})),a(u.mediumText,{size:"childrenSize",text:y,color:v,padding:{v:(r-.75*u.mediumText.fontSize)/2}})))},BarButton}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","rgbColor","ImikimiPalette","merge","objectWithout","color","Element","isFunction"],[e,n(613)],(t,e,r,o,s,a,l,u,c)=>{let h;return h=n(341).Element.getSizePointLayout,i.defClass(class ButtonWrapper2 extends(t(e)){},function(t,e,n){this.subscriptions("viewState.gridSize"),this.stateFields({children:[],hoverScale:1.1}),this.prototype.preprocessProps=function(t){let e,n,i,u,c,p,d,f;return e=t.disabled,n=t.children,i=t.action,u=t.hoverColor,c=t.backgroundColor,p=t.size,d=t.selected,f=t.selectedColor,c?(c=r(c),u=r(null!=u?u:(()=>{switch(!1){case!c.eq(o.primary):return o.lightPrimary;case!(c.s<.1):return o.primary;default:return c.withAlpha(.5)}})())):(u=r(null!=u?u:o.primary),c=u.withAlpha(0)),p=h(null!=p?p:"parentSize"),d&&(null!=f||(f=u.withAlpha(.5))),i||(e=!0),this.setState({children:n}),s(a(t,"children"),{backgroundColor:c,hoverColor:u,disabled:e,size:p,color:l,selectedColor:f,on:this.buttonHandlers,childArea:"ignoreTransforms"})},this.getter({color:function(){let t,e,n,i,r,s;return t=(s=this.props).disabled,e=s.hoverColor,n=s.selectedColor,i=s.backgroundColor,r=s.selected,!t&&this.hover?e:r?n:i===o.primary&&t?o.grey:i}}),this.prototype.preprocessState=function(t){let e,r,o,a,l;return e=t.gridSize,s(n.preprocessState.apply(this,arguments),{hoverScale:(r=i.exists(o=this.refs)&&i.exists(a=o.rootElement)&&i.exists(l=a.element)&&l.currentSize.max())?(r+e/2)/r:1.1})},this.prototype.render=function(){let t,e,n,r,o,s,l,h,p,d,f,m,g,y,v,S,b,w;return t=this.gridSize,e=void 0!==(v=(y=this.props).radius)?v:t/2,n=y.disabled,r=y.size,o=y.shadow,s=void 0!==(S=y.disabledOpacity)?S:.5,l=void 0!==(b=y.scaleAxis)?b:.5,h=y.noBackground,p=y.outline,d=y.noZoom,f=y.hoverExpand,m=y.borderPadding,r.childrenRelative&&(g=r),u(this.props.draw?a(this.props,"draw"):this.props,u({key:"rootElement",animators:{scale:{duration:.15},opacity:!0,draw:!0},location:{ps:l},cursor:!n&&"pointer",axis:l,scale:(()=>{switch(!1){case!d:return 1;case!(!n&&this.pointerIsDown):return.9;case!(f&&this.hover):return this.hoverScale;default:return 1}})(),opacity:n?s:1,size:g,draw:null!=(w=this.props.draw)?w:h?void 0:{padding:null!=m?m:0,rectangle:{radius:e},fill:{shadow:o,color:this.color},outline:p||void 0}},i.array(this.children,t=>c(t)?t(this.hover):t)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p={}.hasOwnProperty;u=(c=n(307)).defineModule,i=c.FluxComponent,e=c.Element,o=c.TextElement,c.merge,c.objectWithout,c.min,c.log,r=c.PushBackTimer,s=c.TextInputElement,(h=Neptune.Imikimi.Style).Icons,a=h.TextPalette,h.ImikimiPalette,l=h.TextStyles,u(t,function(t){function DelayApplyTextInput(){DelayApplyTextInput.__super__.constructor.apply(this,arguments),this.pushBackTimer=new r}return function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(DelayApplyTextInput,i),DelayApplyTextInput.stateFields({currentValue:null,autoFocused:!1}),DelayApplyTextInput.prototype.render=function(){var t,n,i,r,u,c,h,p,d,f,m;return d=(u=this.props).type,f=u.value,r=u.placeholder,i=u.maxLength,p=null!=(c=u.size)?c:{ww:1,hch:1},n=u.autoFocus,t=u.align,e({key:"textEditElement",size:p,draw:["padded",{rectangle:{radius:3},outline:a.black.tertiary}]},s(l.mediumText,{type:d,value:f,placeholder:r,maxLength:i,size:p},{padding:10,align:t,color:a.black.primary,on:{ready:n&&(m=this,function(t){var e;if(e=t.target,!m.autoFocused)return e.focus(),m.autoFocused=!0}),valueChanged:function(t){return function(e){var n,i;return i=e.target,f=i.value,t.currentValue=f,"function"==typeof(n=t.props).valueChanged&&n.valueChanged(f),t.pushBackTimer.timeout(500,function(){var e;return"function"==typeof(e=t.props).valueApplied?e.valueApplied(f):void 0})}}(this)}}),i&&(null!=(h=this.currentValue)?h.length:void 0)>i/2?o(l.tinyText,{location:"topRight",animators:{opacity:{toFrom:0}},padding:5,color:a.black.secondary,axis:"topRight",text:this.currentValue.length+" / "+i+" characters"}):void 0)},DelayApplyTextInput}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l={}.hasOwnProperty;s=n(307),i=s.Element,a=s.rgbColor,e=s.Component,o=s.defineModule,n(596).ImikimiPalette,r=n(620),o(t,function(t){function LoadingOverlay(){return LoadingOverlay.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(LoadingOverlay,e),LoadingOverlay.prototype.render=function(){var t,e;return t=null!=(e=this.props.backgroundColor)?e:"white",i({animators:{opacity:{toFrom:0}},inFlow:!1,draw:[{rectangle:{radius:10},padding:-10,color:a(t).withAlpha(.9)}]},r())},LoadingOverlay}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Icons","merge","Component","TextPalette","interval","timeout","Element","ImikimiPalette","Math","TextElement"],[e,n(613)],(t,e,n,r,o,s,a,l,u,c)=>{let h;return h=[t.moon,e(t.sun,{scale:1.5})],i.defClass(class Spinner extends n{},function(t,e,n){this.stateFields({renderCount:0,enabled:!1}),this.propFields({monocrome:!1,color:void 0,delay:1e3}),this.getter({iconNumber:function(){return this.renderCount%h.length},icon:function(){return h[this.iconNumber]},color:function(){let t;return null!=(t=this.props.color)?t:this.monocrome?r.black.primary:"white"}}),this.prototype.componentWillMount=function(){return this.timer=o(3e3,()=>this.renderCount++),s(100,this.triggerEnabled),n.componentWillMount.apply(this,arguments)},this.prototype.componentWillUnmount=function(){let t;return i.exists(t=this.timer)&&t.stop(),n.componentWillUnmount.apply(this,arguments)},this.prototype.render=function(){return a("centerCenter",{size:35,draw:["circle",this.monocrome?void 0:l.primary.withLightness(.5+.5*this.iconNumber),"clip"],animators:{opacity:{toFrom:0},draw:{f:"easeBothQuad",duration:1}}},this.enabled&&a({location:{xw:.5,yh:2},axis:{x:.5,y:2},key:this.iconNumber,animators:{angle:{duration:1,f:"easeBothQuad",to:-u.PI/5,from:u.PI/5}}},c(this.icon,"centerCenter",{color:this.color,fontSize:14})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ImikimiPalette","TextPalette","Icons","Element","ButtonWrapper","TextElement","TextStyles","capitalize"],[e,n(613),{ButtonWrapper:n(615)}],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class PrimaryMenuButton extends t{},function(t,i,c){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,c,h,p,d,f,m,g,y,v;return({gridSize:t,buttonSize:i}=this.viewState),({color:c,icon:h,text:p,hoverColor:d,rightIcon:f,backgroundColor:m,action:g,disabled:y}=this.props),null==g&&(y=!0),m||(m=y?e.mediumGrey:e.primary),d||(d=e.primary.withAlpha(.67)),c||(c=n.white.primary),h=r[h],f=r[f],v={size:i,color:c,align:.5},(y=this.props.disabled||!this.props.action)&&this.props.disabledAction&&(null!=f||(f=r.helpInverted)),o({noFocus:!0,size:{ww:1,h:i},padding:{h:-t/2},clip:!0,animators:{size:{toFrom:{ww:1,h:0}}}},s(this.props,{radius:100,backgroundColor:m,hoverColor:d,size:{ww:1,h:i}},o({size:{ww:1,h:i},childrenLayout:"row",padding:{h:t/2}},h&&a(h,v),a(l.mediumText,{size:"parentSize",text:u(p),color:c,align:h?"centerLeft":"centerCenter"}),f?a(f,v,{inFlow:!1,location:"centerRight",axis:"centerRight"}):void 0)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;s=(a=n(307)).defineModule,i=a.FluxComponent,a.RectangleElement,e=a.Element,o=a.bound,l=n(596),r=l.ImikimiPalette,l.TextPalette,s(t,function(t){function ProgressBar(){return ProgressBar.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ProgressBar,i),ProgressBar.subscriptions("viewState.gridSize"),ProgressBar.prototype.render=function(){var t,n,i,s,a;return n=this.gridSize,i=(s=this.props).progress,t=null!=(a=s.color)?a:r.primary,i=o(0,i-0,1),e({axis:"topRight",location:"topRight",padding:n,animators:{size:{toFrom:{w:n,hh:1}},opacity:{toFrom:0}}},e({size:{ww:1,h:n},axis:"centerLeft",location:"centerLeft",draw:{color:r.lightGrey,rectangle:{radius:1e3}}},e({size:{wh:1-i,ww:i,hh:1},animators:"size color",draw:{rectangle:{radius:1e3},color:t}})))},ProgressBar}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","rgbColor","bound","Math","Element","ScrollElement","objectWithout","min","ReschedulableTimer"],[e,n(613)],(t,e,n,r,o,s,a,l,u,c)=>{let h;return h=20,i.defClass(class ScrollerWithBar extends t{constructor(){super(...arguments),this.scrollBarTimer=new c}},function(t,c,h){this.subscriptions("viewState.viewState"),this.stateFields({scrollBarActive:!1,recentlyScrolled:!1,contentsDontFit:!1,flushLeftDistance:0,flushRightDistance:0,portionShown:0,scrollPosition:0,scrollUpdate:null}),this.getter({showScrollBar:function(){return this.recentlyScrolled||this.scrollBarActive}}),this.prototype.getInitialState=function(){return{scrollUpdate:t=>{let e,n,r,o,s,a;return i.exists(s=this.props.on)&&i.isF(s.scrollUpdate)&&s.scrollUpdate(t),e=(a=t.props).windowSize,n=a.childrenSize,r=a.childrenOffset,o=a.scrollRatio,this.flushLeftDistance=-r,this.flushRightDistance=n+r-e,this.contentsDontFit=n>e,this.recentlyScrolled=!0,this.scrollBarTimer.timeout(500,()=>this.clearRecentlyScrolled()),this.scrollPosition=o,this.portionShown=e/n}}},this.getter({scrollElement:function(){return this.refs.scrollElement.element}}),this.prototype.preprocessProps=function(t){let i;return(i=t.barColor)?e(t,{barColor:n(i)}):t},this.prototype.renderBar=function(){let t,e,n,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_;return t=(x=this.viewState).gridSize,e=x.isTouchScreen,n=this.contentsDontFit,a=(P=this.props).barAlwaysOn,l=P.barSize,u=P.barBackground,c=P.barColor,h=P.edgeShadows,p=P.childrenLayout,d=P.size,f=P.noPadding,m=void 0!==(C=P.scrollBarOpacity)?C:0,g=P.barPadding,[n||a?(y=(v="row"===p)?"x":"y",null!=l||(l=t),S=e?3.5:2*t/3,b=r(0,this.scrollPosition,1),w=o.abs(b-this.scrollPosition)*(1-this.portionShown),s({animators:{opacity:{toFrom:0}},draw:u,receivePointerEvents:e?"never":void 0,cursor:"pointer"},v?{location:"bottomLeft",axis:"bottomLeft",size:{h:l}}:{location:"topRight",axis:"topRight",size:{w:l}},{on:{pointerDown:()=>this._scrollPositionAtPointerDown=this.scrollPosition,pointerMove:({totalDelta:t,target:e,leftDeadzone:n})=>(n&&i.exists(e)&&i.isF(e.capturePointerEvents)&&e.capturePointerEvents(),this.refs.scrollElement.element.scrollRatio=this._scrollPositionAtPointerDown+t[y]/((1-this.portionShown)*e.currentSize[y])),mouseIn:this.triggerScrollBarActive,mouseOut:this.clearScrollBarActive},padding:null!=g?g:f?void 0:(l-S)/2},n&&s(v?{location:{yh:.5,xw:b},axis:{y:.5,x:b},size:{h:S,xw:r(0,this.portionShown-w,1)}}:{location:{xw:.5,yh:b},axis:{x:.5,y:b},size:{w:S,yh:r(0,this.portionShown-w,1)}},{opacity:this.showScrollBar?.9:m,animators:{opacity:{duration:.5},draw:!0},draw:[{radius:100},this.scrollBarActive?null!=c?c:"#000a":null!=(_=i.exists(c)&&c.withScaledAlpha(.75))?_:"#0007"]}))):void 0]},this.prototype.render=function(){let t,e,n,i,r,o,c,h,p,d,f,m,g;return t=(f=this.viewState).gridSize,e=f.isTouchScreen,n=(m=this.props).barBackground,i=m.barColor,r=m.edgeShadows,o=m.childrenLayout,c=m.size,h=m.noPadding,p=void 0!==(g=m.scrollBarOpacity)?g:0,d=m.barPadding,s({size:c},a("column",l(this.props,"children"),{size:c,key:"scrollElement",on:{scrollUpdate:this.scrollUpdate},draw:this.props.draw},this.props.children),this.renderBar(),s({receivePointerEvents:"never",clip:!0},r&&this.contentsDontFit&&this.flushLeftDistance>0?s({key:"leftShadow",size:{ps:1,h:-t},axis:"centerRight",location:"centerLeft",animators:{opacity:{toFrom:0}},opacity:u(1,this.flushLeftDistance/20),draw:{color:"black",shadow:{offset:0,blur:2*t}}}):void 0,r&&this.contentsDontFit&&this.flushRightDistance>0?s({key:"rightShadow",size:{ps:1,h:-t},axis:"centerLeft",location:"centerRight",animators:{opacity:{toFrom:0}},opacity:u(1,this.flushRightDistance/20),draw:{color:"black",shadow:{offset:0,blur:2*t}}}):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l={}.hasOwnProperty;i=(a=n(307)).FluxComponent,r=a.defineModule,e=a.BitmapElement,s=a.merge,a.log,o=n(576).generatePreviewBitmap,r(t,function(t){function ShowColorMap(){return ShowColorMap.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ShowColorMap,i),ShowColorMap.stateField({bitmap:null}),ShowColorMap.prototype.preprocessState=function(t){return this.props.colorMap===this.state.colorMap&&t.bitmap?t:s(t,{bitmap:o(this.props.colorMap)})},ShowColorMap.prototype.render=function(){return e(this.props,{bitmap:this.bitmap})},ShowColorMap}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","TextPalette","ImikimiPalette","TextInputElement"],[e,n(613)],(t,e,n,r,o,s,a)=>{return i.defClass(class SimpleMenuTextInput extends t{},function(t,l,u){this.subscriptions("viewState.viewState"),this.stateFields({value:""}),this.prototype.submit=function(){let t,e;return({submissionValidRegexp:t,submit:e}=this.props),!t||t.test(this.value)?i.isF(e)&&e(this.value):void 0},this.prototype.componentWillMount=function(){return this.onNextReady(()=>this.refs.textInput.element.scrollOnScreen()),u.componentWillMount.apply(this,arguments)},this.prototype.valueChanged=function(t){let e;return this.value=t.props.value,i.isF((e=this.props).valueChanged)&&e.valueChanged(t)},this.prototype.render=function(){let t,l,u,c,h;return({gridSize:t}=this.viewState),({valueChanged:l,submit:u,label:c,disabled:h}=this.props),e({size:"parentWidthChildrenHeight",clip:!0,animators:{size:{toFrom:{ww:1,h:0}}},padding:{h:-t/2},childrenLayout:"column",childrenMargins:t/2},c&&n(r.mediumText,{size:"parentWidthChildrenHeight",text:c,padding:t/2,color:o.black.secondary}),e({size:"parentWidthChildrenHeight",padding:t/2,drawOrder:["white",{outline:s.lightGrey}]},h&&n(r.largeBoldText,this.props,{size:"parentWidthChildrenHeight",text:this.props.value}),a(r.largeBoldText,this.props,{key:"textInput",size:"parentWidthChildrenHeight",visible:!h,on:{valueChanged:this.valueChanged,enter:this.submit,domElementAttached:({target:t})=>i.exists(t)&&i.isF(t.focus)&&t.focus()}})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p={}.hasOwnProperty;u=(h=n(613)).defineModule,r=h.Element,s=h.TextElement,i=h.Component,h.present,h.urlWithOptionalProtocolRegExp,h.lowerCase,l=h.TextStyles,a=h.TextPalette,h.compactFlatten,h.internalLinkToPostId,h.openLink,h.log,o=h.Icons,c=h.isString,h.emailRegExp,h.encodeMailto,e=n(615),u(t,function(t){function SimpleTagLink(){return SimpleTagLink.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(SimpleTagLink,i),SimpleTagLink.prototype.render=function(){var t,n,i,u,h,p,d,f,m,g,y,v,S;return f=this.props,S=f.text,d=f.icon,y=f.selected,t=f.action,n=f.actionWithTag,h=f.foregroundColor,i=f.backgroundColor,u=null!=(m=f.buttonSize)?m:4*l.smallText.fontSize/3,p=null!=(g=f.gridSize)?g:l.smallText.fontSize/2,c(d)&&(d=o[d]),e({hoverColor:h,backgroundColor:i,selected:y,action:n?function(t){return n(S,t)}:t,radius:1e3,size:{h:v=u,wcw:1}},r({childrenLayout:"row",childrenAlignment:"centerLeft",childrenMargins:p/4,padding:{h:p/2},size:{h:v,wcw:1,max:{ww:1}}},d&&s(d,{size:"childrenSize",fontSize:14,color:a.white.primary}),s(l.smallText,{size:"childrenSizeMaxParentWidth",maxLines:1,color:i?a.white.primary:a.black.secondary,text:S})))},SimpleTagLink}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v={}.hasOwnProperty;(m=n(307)).log,h=m.defineModule,e=m.Element,s=m.TextElement,m.OutlineElement,m.BitmapElement,a=m.TextInputElement,m.Component,m.createComponentFactory,i=m.FluxComponent,m.rgbColor,f=m.present,p=m.merge,o=m.Promise,m.formattedInspect,m.ImikimiPalette,m.TextPalette,m.TextStyles,m.Icons,y=m.timeout,d=m.pluralize,g=n(596),r=g.ImikimiPalette,u=g.TextPalette,c=g.TextStyles,g.Icons,l=n(628),n(620),n(615),h(t,function(){return function(t){function SubmitField(){return SubmitField.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)v.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(SubmitField,i),SubmitField.getter({textInputElement:function(){var t;return null!=(t=this.refs.textInput)?t.element:void 0}}),SubmitField.stateFields({internalDisplayOnly:!1,lastSubmittedValue:null,submitting:!1,delayedFocus:!1,errorSubmitting:!1}),SubmitField.prototype.isValid=function(t){return!this.props.validationRegex||!!t.match(this.props.validationRegex)},SubmitField.prototype.focus=function(){var t;return null!=(t=this.textInputElement)&&"function"==typeof t.focus?t.focus():void 0},SubmitField.prototype.preprocessProps=function(t){var e,n,i,r,o;return o=t.value,e=t.attempt,i=t.displayOnly,n=t.delayedFocus,r=t.noAutoFocus,null==o||null!=this.state.value&&this.props.value===o&&this.props.attempt===e||(this.lastSubmittedValue=o,this.setState(this.getValueStates(o))),n&&(this.triggerDelayedFocus(),y(250,this.clearDelayedFocus)),r&&this.triggerInternalDisplayOnly(),i&&this.clearInternalDisplayOnly(),SubmitField.__super__.preprocessProps.apply(this,arguments)},SubmitField.prototype.submit=function(){var t,e,n,i,r,s,a,l;if(i=this.state,a=i.value,n=i.isValid,e=i.isNew,s=(r=this.props).requireNew,t=r.clearValueAfterSubmit,n&&(!s||e))return this.triggerInternalDisplayOnly(),this.onNextReady((l=this,function(){var e;return l.setState({lastSubmittedValue:a}),l.submitting=!0,o.resolve("function"==typeof(e=l.props).submit?e.submit(a):void 0).then(function(){return l.submitting=!1,t?(a="",l.clearInternalDisplayOnly()):l.refs.rootElement.element.blur(),l.onNextReady(function(){return l.valueChanged(a)})},function(t){throw l.internalDisplayOnly=l.submitting=!1,l.triggerErrorSubmitting(),y(2e3,l.clearErrorSubmitting),t})}))},SubmitField.prototype.getValueStates=function(t){var e;return{value:t,isValid:this.isValid(t),isNew:t!==(null!=(e=this.state)?e.lastSubmittedValue:void 0)&&t!==this.props.value}},SubmitField.prototype.valueChanged=function(t){var e,n;return this.setState(n=this.getValueStates(t)),"function"==typeof(e=this.props).valueChanged?e.valueChanged(n):void 0},SubmitField.setter({value:function(t){var e;return null!=(e=this.refs.input)&&(e.value=t),this.setState({value:t})}}),SubmitField.prototype.render=function(){var t,n,i,o,h,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F;return y=(_=this.props).gridSize,P=_.noButtons,y||(y=15),C=(E=this.props).placeholder,h=E.buttonType,i=E.backIcon,F=E.whiteBackground,x=E.maxLength,w=E.large,I=E.textInputType,t=E.backAction,g=E.displayOnly,k=E.requireNew,n=E.backButtonColor,o=E.buttonSize,b=(T=this.state).isValid,S=T.isNew,M=T.value,v=o||y*(w?3:2),m=p({padding:{left:t?0:y,right:P?y:0},animators:{padding:!0}},w?c.largeBoldText:c.mediumText),e({size:{ww:1,h:v},key:"rootElement",padding:{h:-y/2},childrenLayout:"row",drawOrder:["paddedDrawArea",{color:F?r.background:r.white,rectangle:{radius:1e3}}]},t&&l({key:"backAction",action:t,icon:i||"left",size:v,color:n||r.imikimi}),this.delayedFocus||this.submitting||g||this.internalDisplayOnly?s(m,{align:"centerLeft",size:"parentSize",on:{pointerClick:this.clearInternalDisplayOnly},cursor:"text",maxLines:1,text:f(M)?M:C,color:this.submitting?u.black.secondary:f(M)?u.black.primary:"#0000004a"}):(A=(null!=M?M.length:void 0)||0,[a(m,{size:"parentSize",color:u.black.primary,type:I,key:"input",placeholder:C,value:M,maxLength:x,on:{domElementAttached:function(t){var e;return(e=t.target).focus(),e.selectAll()},preprocess:{valueChanged:function(t){return t.props.value}},enter:this.submit,blur:this.triggerInternalDisplayOnly,valueChanged:this.valueChanged}}),null!=x&&A/x>.5&&s(c.tinyText,{inFlow:!1,animators:{opacity:{toFrom:0}},size:"childrenSize",key:"warnings",text:d(x-A,"char")+" left",color:u.black.secondary},this.props.warningsOnTop?{location:{xw:1,y:-3,x:-v/2},axis:1}:{location:{ps:1,y:3,x:-v/2},axis:{x:1}})]),!P&&l({action:this.submit,size:v,color:this.errorSubmitting?r.red:r.imikimi,icon:this.errorSubmitting?"!":h,waiting:this.submitting,disabled:!b||k&&!S}))},SubmitField}()})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m={}.hasOwnProperty;(p=Neptune.Art.Suite).Foundation,p.Atomic,p.React,p.Flux,p.Element,s=p.RectangleElement,l=p.TextElement,p.OutlineElement,p.BitmapElement,p.TextInputElement,p.Component,p.createComponentFactory,i=p.FluxComponent,p.FillElement,c=p.defineModule,p.log,h=p.isString,d=Neptune.Imikimi.Style,d.TextPalette,d.Icons,a=n(620),f=n(596),o=f.ImikimiPalette,u=f.TextPalette,f.TextStyles,r=f.Icons,e=n(615),c(t,function(t){function TextInputSubmitButton(){return TextInputSubmitButton.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)m.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TextInputSubmitButton,i),TextInputSubmitButton.prototype.render=function(){var t,n,i,c,p,d,f,m,g,y;return d=(m=this.props).gridSize,c=m.disabled,f=m.icon,i=m.color,g=m.size,y=m.waiting,t=m.action,d||(d=15),g||(g=2*d),i=c?u.black.disabled:i||o.primary,f=function(){if(h(f||(f="right")))switch(f){case"up":return n=!0,"arrowCircleUp";case"down":return n=!0,"arrowCircleDown";case"left":return n=!0,"arrowCircleLeft";case"right":return n=!0,"arrowCircleRight";default:return r[f]||function(){throw new Error("invalid icon name: "+f)}()}}(),y&&(n=!1),p=o.background,f=h(f)?r[f]:f,e({size:g,disabled:c,action:t,hoverColor:"#fff0",clip:!0,location:"centerCenter",axis:.5,animators:{size:{toFrom:{h:g,w:0}},scale:{toFrom:0}}},n?void 0:s({color:i,radius:1e3,padding:d/4,animators:"color"}),y?a({color:p}):l(f,n?{size:"childrenSize",padding:d/4,scale:function(t,e){return t.div(e)},location:"centerCenter",axis:.5,color:i,animators:"color"}:{location:"centerCenter",axis:.5,size:"childrenSize",animators:"color",color:p,scale:function(t,e){return(t.min()-g/2)/e.max()}}))},TextInputSubmitButton}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h={}.hasOwnProperty;l=(c=n(613)).defineModule,i=c.FluxComponent,e=c.Element,c.TextElement,u=c.merge,c.objectWithout,c.min,c.log,c.PushBackTimer,c.TextInputElement,a=c.array,c.Icons,s=c.TextPalette,r=c.ImikimiPalette,c.TextStyles,o=n(630),l(t,function(t){var n,l;function TabbedBar(){return TabbedBar.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TabbedBar,i),n={radius:{top:5},fill:r.selectedTabColor,padding:{bottom:-2,top:2,h:2},outline:s.black.tertiary},l=u(n,{fill:n.fill.withAlpha(0)}),TabbedBar.propFields({currentTab:null}),TabbedBar.prototype.render=function(){var t,i,u,c,h,p;return t=(i=this.props).buttonSize,h=i.tabs,c=i.tabChanged,u=i.secondary,e({noFocus:!0,size:{ww:1,h:null!=t?t:45},childrenLayout:"row",draw:[{fill:u?[r.selectedTabColor,r.tabBackgroundColor]:r.tabBackgroundColor,clip:!0},{padding:{top:-2,h:-1},outline:{color:s.black.tertiary}}]},a(h,{when:function(t){return null!=t},with:(p=this,function(t){var i,r,s,a;return a=t.tab,s=t.label,i=t.action,r=t.enabled,null==a&&(a=s),e({animators:"location draw",location:p.currentTab===a?{y:0}:{y:3},draw:p.currentTab===a?n:l},o(t,{iconScale:.7,backgroundPadding:5,action:(i||!1!==r)&&function(){return"function"==typeof c&&c(a),"function"==typeof i?i():void 0}}))})}))},TabbedBar}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S={}.hasOwnProperty;h=(v=n(613)).defineModule,o=v.FluxComponent,r=v.Element,l=v.TextElement,m=v.merge,y=v.objectWithout,g=v.min,v.log,f=v.isString,p=v.formatted3DigitCount,s=v.Icons,u=v.TextPalette,a=v.ImikimiPalette,c=v.TextStyles,d=n(341).Element.getSizePointLayout,i=n(615),e=n(611),h(t,function(t){function TabButton(){return TabButton.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)S.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TabButton,o),TabButton.subscriptions("viewState.gridSize"),TabButton.prototype.renderIcon=function(){var t,n,i,r,o,a,u,c,h,p,d,m,g;return n=(h=this.props).badgeBorder,o=h.icon,c=h.iconShadow,a=h.iconColor,u=null!=(p=h.iconScale)?p:1,i=h.color,t=h.badge,r=h.customIcon,[o&&l(null,f(o)?null!=(d=s[o])?d:{text:o}:o,{size:25*u,animators:"size fontSize",fontSize:o.fontSize*u,align:.5,color:null!=(m=null!=(g=null!=o?o.color:void 0)?g:a)?m:i,shadow:c}),r,t>0&&e({axis:.5,location:{xw:.75,yh:.22},count:t,border:n})]},TabButton.prototype.preprocessProps=function(t){var e,n,i,r,o,l;return l=t.palette,n=t.color,i=t.dimText,e=t.brightText,r=t.icon,o=t.lightColor,r=s[r],null!=l?m(t,a.buttonPalettes[l],{icon:r}):(n||(n=o?e?u.white.primary:u.white.secondary:i?u.black.tertiary:u.black.secondary),m(t,{icon:r,color:n}))},TabButton.prototype.renderIconWithCount=function(){var t,e,n,i;return e=(i=this.props).count,t=i.color,n=this.margin,null!=e?r({childrenLayout:"row",childrenMargins:n,childrenAlignment:"centerLeft",size:"childrenSize"},e>0&&l(c.smallText,{animators:{size:{toFromVoid:{hch:1,w:0}}},clip:!0,size:"childrenSize",color:t,text:p(e)}),this.renderIcon()):this.renderIcon()},TabButton.getter({margin:function(){return this.gridSize/2}}),TabButton.prototype.render=function(){var t,e,n,o,s,a,u,h,p,f,m,v,S,b,w,x,P;return(S=this.props).palette,v=S.maxLines,s=S.iconRight,e=S.childrenMargins,a=S.iconShadow,f=S.labelStyle,P=S.textPadding,u=S.innerPadding,w=S.size,n=S.color,o=S.hoverAction,t=S.align,null!=(b=S.maxLargeLabelLength)?b:8,S.action,S.disabled,S.selected,S.gridSize,x=S.text,h=S.label,S.lightColor,S.icon,S.count,S.badge,p=S.labelBottom,S.customIcon,m=this.gridSize/2,h||(h=x),w&&(w=d(w)),i(y(this.props,"children"),{hoverAction:o},r({size:(null!=w?w.childrenRelative:void 0)?w:"parentSize",padding:null!=u?u:p&&null==v?void 0:h?{h:this.gridSize/2}:{h:m/2},childrenLayout:p?"column":"row",childrenAlignment:t||"centerCenter",childrenMargins:null!=e?e:p?c.smallText.fontSize/4:this.gridSize/2},s?void 0:this.renderIconWithCount(),h&&r({size:p?"parentWidthChildrenHeight":"childrenSizeMaxParentWidth"},l(null!=f?f:p?c.tinyText:c.smallText,{maxLines:v},p?v?{size:"parentWidthChildrenHeight",align:.5}:{size:"childrenSize",axis:"topCenter",location:"topCenter"}:{size:{cs:1,max:{ps:1.5}},maxLines:2},{scale:function(t,e){return g(1,t.minRatio(e))},padding:P,text:h,color:n,shadow:a})),s?this.renderIconWithCount():void 0))},TabButton}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","Element","AnimatedIconTextButton","TextPalette"],[e,n(613),{AnimatedIconTextButton:n(614)}],(t,e,n,r,o)=>{return i.defClass(class TabButtonWithConfirm extends t{},function(t,i,s){this.stateFields({confirm:!1}),this.prototype.preprocessProps=function(t){let n;return e({size:{h:null!=(n=t.height)?n:50,wcw:1},animators:{size:{toFrom:{w:0}},clip:{toFrom:!0}}},t)},this.prototype.render=function(){let t,e,i,s;return({size:t,text:e,animators:i,confirmText:s}=this.props),n("row",{size:t,animators:i,childrenMargins:5},r({key:"main",tight:!0,color:o.black.secondary},this.props,this.confirm?{icon:"cancel",text:"cancel",action:this.clearConfirm}:{action:this.triggerConfirm}),this.confirm?r(this.props,{tight:!0,color:o.black.secondary,animators:{size:{toFrom:{w:0}}},text:null!=s?s:e?e+" now":"are you sure?",icon:null}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;r=(s=n(307)).defineModule,e=s.Component,i=s.Element,s.TextElement,o=s.merge,s.objectWithout,s.min,s.max,s.log,l=s.timeout,(a=Neptune.Imikimi.Style).Icons,a.TextPalette,a.ImikimiPalette,a.TextStyles,r(t,function(t){function TimeoutWrapper(){return TimeoutWrapper.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TimeoutWrapper,e),TimeoutWrapper.stateFields({timeoutExpired:!1}),TimeoutWrapper.prototype.componentWillMount=function(){var t,e;return l(1e3*(null!=(t=this.props.delay)?t:1),(e=this,function(){return e.timeoutExpired=!0})),TimeoutWrapper.__super__.componentWillMount.apply(this,arguments)},TimeoutWrapper.prototype.render=function(){var t;return t=this.timeoutExpired?o(this.props,this.props.expired):this.props,i(t,t.children)},TimeoutWrapper}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["HotStyleProps","clientFailure","log","models","window","openLink","isString","merge","parseQuery","present","encodeUri","bound","aspectRatioForPost","compactFlatten"],[e,n(307),n(541),n(160).Browser],(t,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{return i.defClass(class ClientLib extends t{},function(t,y,v){let S,b,w;this.getHumanStatusError=((t,e)=>t===r&&e||n(590).humanStatusErrors[t]||n(590).humanStatusErrors.default),this.minAspectRatio=S=.75,this.maxAspectRatio=b=3,this.maxRecentConversationsToShow=15,this.getPostParticipantsToShow=((t,e=0)=>{let n,r;return{allPostParticipants:n=i.array(t||[],t=>t,t=>t.activityCount>0),selectedPostParticipants:r=n.slice(0,this.maxRecentConversationsToShow)}}),this.openLink=function(t){return o({custom:{openLink:t}}),s.event.create("link:outgoing",{data:{url:t}}),e.cordova?a.open(t,"_system"):l(t)},this.openLocalUrlInNewWindow=(t=>{let n,i,r;return u(t)?([n,i]=t.split(/\?/),i=c(h(),p(i)?h(i):void 0)):(n="/",i=c(h(),t)),r=d({path:n,query:i}),e.openLocalUrlInNewWindowUrl=r,this.openLink(r)}),this.boundAspectRatio=w=function(t,e=.75){return f(e,t,3)},this.generateRows=function(t,{width:e,rowAspectRatio:n,marginAr:r,numRows:o,minAspectRatio:s}){let a,l,u,c,h,p,d,f;if(a=0,l=n,u=[c={rowNumber:0,totalWeight:0,posts:[]}],h=e,p=!0,d=((t,e)=>{let i,h;return i=w(m(t),s),h=p,p=!1,h||(l-=r),(i/2<=l||h?(l-=i,c.totalWeight+=i,c.posts.push(e?null:t),e):u.length===o?!e:(l=n-i,a++,e||(c.fullRow=!0,u.push(c={rowNumber:a,totalWeight:i,posts:[t]})),!1))&&t}),f=i.find(t,null,t=>d(t)))for(;d(f,!0););return u},this.layoutPostRowWithDynamicAspectRatios=function(t,e){let n,r,o,s,a,l,u,c,h,p,d,f;return n=t.posts,r=t.rowNumber,o=t.totalWeight,s=t.fullRow,a=e.marginAr,l=e.rowAspectRatio,u=e.width,c=e.margin,h=e.minAspectRatio,s||(p=o/l)>.9&&(s=!0),d=(n.length-1)*c,f=0,i.array(n,(t,e)=>{let n,i,a,u,p,g;return n=f,f+=i=s?w(m(t),h)/o:m(t),a=s?t=>t-d:t=>t/l,{size:{hw:1/l,w:u=(({w:t})=>a(t)*i)},location:{y:p=(({w:t})=>(t/l+c)*r+t/l/2),x:g=(({w:t})=>a(t)*(n+i/2)+c*e)},axis:.5,post:t}},(t,e)=>t)},this.layoutPostsWithDynamicAspectRatios=function(e){let n,r,o,s,a,l,u,c,h;return({posts:n,margin:r,width:o,rowHeight:s,rowAspectRatio:a,numRows:l,minAspectRatio:u}=e),null!=a||(a=o/s),c=r/(o/a),h=t.generateRows(n,e={margin:r,marginAr:c,width:o,rowAspectRatio:a,numRows:l,minAspectRatio:u}),g(i.array(h,n=>t.layoutPostRowWithDynamicAspectRatios(n,e)))},this.ownPost=function(t){let e;return t&&(e=s.currentSession.currentUserId)?t.userId===e:void 0},this.photoDownloadOk=((t,e,n)=>(i.exists(e)&&e.mediaFile||n)&&(i.exists(t)&&t.private||this.ownPost(e)))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","self","Promise","Binary","Bitmap","console","merge","getImageSize","point","Error","readAsArrayBuffer","toSeconds","float32Eq","extractColorsAsPlainObjects","isArray","models","sourceToBitmapCache"],[e,n(635),n(167).File,n(576)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v)=>{let S,b,w,x;return S="image/jpeg",b="image/png",w="other",x=n(636),i.defClass(class ImagePicker extends t{constructor(){super(...arguments)}},function(t,n,S){let b,w,P,C,_,E,T;this.singletonClass(),this.classGetter({cordovaImagePickerAvailable:function(){return!!e.imagePicker}}),this.zoPickImage=(t=>this.singleton.pickImage(t)),b={width:2048,height:2048,quality:95},this.pickImageFromLocalUrl=function(t,n={}){let i,a;return({success:i,error:a}=n),new r((n,i)=>e.resolveLocalFileSystemURL(t,t=>t.file(t=>o.EncodedImage.toImage(t,e=>n({file:t,bitmap:new s(e)})),i),i))},this.cordovaPickImage=function(t={}){let n,i;return({width:n,height:i}=t),new r((n,i)=>e.imagePicker.getPictures(e=>{let i;return(i=e[0])?(t.success=n,this.pickImageFromLocalUrl(i,t)):a.log("no files returned. canceled?")},i||(t=>a.log("error calling imagePicker.getPictures: "+t)),{maximumImagesCount:1,quality:t.quality||b.quality,width:t.width||b.width,height:t.height||b.height}))},this.htmlPickImage=function(t){return s.requestImage(t)},this.nativePickImage=function(t){return this.cordovaImagePickerAvailable?this.cordovaPickImage(t):this.htmlPickImage(t)},this.dataIsJpg=w=function(t){return 255===t[0]&&216===t[1]&&255===t[t.length-2]&&217===t[t.length-1]&&"image/jpeg"},this.dataIsPng=P=function(t){return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]&&"image/png"},this.containsTransparentPixels=C=function(t){let e,n,i,r,o;if(({data:e}=t.imageData),i=n=e,null!=n)for(r=n.length,o=0;o<r;){let t,i;if(t=n[o],e[(i=o)+3]<255)return!0;o+=4}return!1},this.detectFileFormat=_=function(t){return P(t)||w(t)||"other"},this.encodeBitmap=function(t,e){return"image/jpeg"===e||"image/png"!==e&&!C(t)?t.toJpg().then(t=>({data:t.arrayBuffer,mimeType:"image/jpeg"})):t.toPng().then(t=>({data:t.arrayBuffer,mimeType:"image/png"}))},this.encodeBitmapIfNeeded=function(t){let e,n,i;return({mimeType:e,data:n,bitmap:i}=t),!n||"image/jpeg"!==e&&"image/png"!==e?this.encodeBitmap(i,e).then(e=>l(t,e)):r.resolve(t)},this.applyMaxPixelCount=function(t,e){let n,i,r;return({bitmap:n,image:i}=e),r=u(i),t>0&&r.area>t?l(e,{bitmap:n.size.area>t?n.resize(c({area:t,aspectRatio:n.aspectRatio})):n,file:null,data:null,image:null}):e},this.processImageMetaData=function(t,e,n){let r,o,s;return({metadata:r}=n),r&&(o=i.exists(r)&&r.Orientation)>1&&(({bitmap:s}=n),n=l(n,{file:null,data:null,bitmap:(()=>{switch(o){case 2:return s.flipped;case 3:return s.rotated180;case 4:return s.flippedAndRotated180;case 5:return s.flippedAndRotated90Clockwise;case 6:return s.rotated90Clockwise;case 7:return s.flippedAndRotated90CounterClockwise;case 8:return s.rotated90CounterClockwise}})()})),n},this._processPickResult=(({bitmap:t,file:e,mimeType:n,image:r},o)=>{let s,a,c,g;if(!n)throw new h("expected mimeType");return({maxPixelCount:s,renderMetadataRotations:a,stripMetadata:c}=o),({name:g}=e),p(e).then(o=>{let s,a,l,u,c,h;s=x.create(o);try{a=s.parse()}catch(t){}return i.exists(a)&&(l=a.DateTimeOriginal,u=a.CreateDate),c=d(null!=(h=null!=l?l:u)?h:e.lastModified),{image:r,bitmap:t,file:e,name:g,data:o,mimeType:n,mediaCreatedAt:c,metadata:(()=>{try{return i.exists(a)&&a.tags}catch(t){}})()}}).then(t=>this.applyMaxPixelCount(s,t)).then(t=>this.processImageMetaData(a,c,t)).then(t=>this.encodeBitmapIfNeeded(t)).then(e=>{let n,o,s,a;return({data:n,bitmap:t,image:r}=e),o=i.exists(t)&&t.size,null!=(a=null!=(s=r&&u(r))?s:o)&&null!=o&&f(a.aspectRatio,1/o.aspectRatio)&&(a=a.swapped),l(e,{byteLength:n.byteLength,colorInfo:m(e.bitmap),dimensions:a.plainObjects})})}),this.fullPickImage=function(t={}){return this.nativePickImage(t).then(e=>g(e)?i.array(e,e=>()=>this._processPickResult(e,t)):this._processPickResult(e,t))},this.prototype.pickImage=function(e={}){return t.fullPickImage(l({maxPixelCount:(y.currentSession.grantMemberAccess?20:3)*i.pow(1024,2)},e)).then(t=>{let n;return n=e.multiple?(g(t)||(t=[t]),this._precacheImages(t),t[0]):(this._precacheImages([t]),t),t})},E=1,T=function(){return"ImagePicker-selectedImage-"+E++},this.prototype._releasePrecachedImages=function(){return this._precachedImageSources?(i.each2(this._precachedImageSources,t=>v.release(t)),this._precachedImageSources=null):void 0},this.prototype._precacheImages=function(t){return this._releasePrecachedImages(),this._precachedImageSources=[],i.each2(t,t=>{let e;return this._precachedImageSources.push(e=T()),v.get(e,r.resolve(t.bitmap))}),null},this.prototype.reset=function(){return this._releasePrecachedImages()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(307))}).call(this,n(2)(t))},function(t,e,n){var i=n(637);t.exports={create:function(t,e){if(t instanceof(e=e||function getGlobal(){return(0,eval)("this")}()).ArrayBuffer){var r=n(643);return new i(new r(t,0,t.byteLength,!0,e))}var o=n(644);return new i(new o(t,0,t.length,!0))}}},function(t,e,n){var i=n(638),r=n(639),o=n(640);function ExifResult(t,e,n,i,r,o,s){this.startMarker=t,this.tags=e,this.imageSize=n,this.thumbnailOffset=i,this.thumbnailLength=r,this.thumbnailType=o,this.app1Offset=s}function Parser(t){this.stream=t,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}ExifResult.prototype={hasThumbnail:function(t){return!(!this.thumbnailOffset||!this.thumbnailLength)&&("string"!=typeof t||("image/jpeg"===t.toLowerCase().trim()?6===this.thumbnailType:"image/tiff"===t.toLowerCase().trim()&&1===this.thumbnailType))},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var t,e=this._getThumbnailStream();return i.parseSections(e,function(e,n){"SOF"===i.getSectionName(e).name&&(t=i.getSizeFromSOFSection(n))}),t}},Parser.prototype={enableBinaryFields:function(t){return this.flags.readBinaryTags=!!t,this},enablePointers:function(t){return this.flags.hidePointers=!t,this},enableTagNames:function(t){return this.flags.resolveTagNames=!!t,this},enableImageSize:function(t){return this.flags.imageSize=!!t,this},enableReturnTags:function(t){return this.flags.returnTags=!!t,this},enableSimpleValues:function(t){return this.flags.simplifyValues=!!t,this},parse:function(){var t,e,s,a,l,u,c,h,p,d=this.stream.mark(),f=d.openWithOffset(0),m=this.flags;return m.resolveTagNames&&(c=n(642)),m.resolveTagNames?(t={},h=function(e){return t[e.name]},p=function(e,n){t[e.name]=n}):(t=[],h=function(e){var n;for(n=0;n<t.length;++n)if(t[n].type===e.type&&t[n].section===e.section)return t.value},p=function(e,n){var i;for(i=0;i<t.length;++i)if(t[i].type===e.type&&t[i].section===e.section)return void(t.value=n)}),i.parseSections(f,function(n,h){var p=h.offsetFrom(d);225===n?r.parseTags(h,function(e,n,i,u){if(m.readBinaryTags||7!==u){if(513===n){if(s=i[0],m.hidePointers)return}else if(514===n){if(a=i[0],m.hidePointers)return}else if(259===n&&(l=i[0],m.hidePointers))return;if(m.returnTags)if(m.simplifyValues&&(i=o.simplifyValue(i,u)),m.resolveTagNames){var h=(e===r.GPSIFD?c.gps:c.exif)[n];h||(h=c.exif[n]),t.hasOwnProperty(h)||(t[h]=i)}else t.push({section:e,type:n,value:i})}})&&(u=p):m.imageSize&&"SOF"===i.getSectionName(n).name&&(e=i.getSizeFromSOFSection(h))}),m.simplifyValues&&(o.castDegreeValues(h,p),o.castDateValues(h,p)),new ExifResult(d,t,e,s,a,l,u)}},t.exports=Parser},function(t,e){t.exports={parseSections:function(t,e){var n,i;for(t.setBigEndian(!0);t.remainingLength()>0&&218!==i;){if(255!==t.nextUInt8())throw new Error("Invalid JPEG section offset");n=(i=t.nextUInt8())>=208&&i<=217||218===i?0:t.nextUInt16()-2,e(i,t.branch(0,n)),t.skip(n)}},getSizeFromSOFSection:function(t){return t.skip(1),{height:t.nextUInt16(),width:t.nextUInt16()}},getSectionName:function(t){var e,n;switch(t){case 216:e="SOI";break;case 196:e="DHT";break;case 219:e="DQT";break;case 221:e="DRI";break;case 218:e="SOS";break;case 254:e="COM";break;case 217:e="EOI";break;default:t>=224&&t<=239?(e="APP",n=t-224):t>=192&&t<=207&&196!==t&&200!==t&&204!==t?(e="SOF",n=t-192):t>=208&&t<=215&&(e="RST",n=t-208)}var i={name:e};return"number"==typeof n&&(i.index=n),i}}},function(t,e){function readExifValue(t,e){switch(t){case 1:return e.nextUInt8();case 3:return e.nextUInt16();case 4:return e.nextUInt32();case 5:return[e.nextUInt32(),e.nextUInt32()];case 6:return e.nextInt8();case 8:return e.nextUInt16();case 9:return e.nextUInt32();case 10:return[e.nextInt32(),e.nextInt32()];case 11:return e.nextFloat();case 12:return e.nextDouble();default:throw new Error("Invalid format while decoding: "+t)}}function readExifTag(t,e){var n,i,r=e.nextUInt16(),o=e.nextUInt16(),s=function getBytesPerComponent(t){switch(t){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}(o),a=e.nextUInt32(),l=s*a;if(l>4&&(e=t.openWithOffset(e.nextUInt32())),2===o){var u=(n=e.nextString(a)).indexOf("\0");-1!==u&&(n=n.substr(0,u))}else if(7===o)n=e.nextBuffer(a);else if(0!==o)for(n=[],i=0;i<a;++i)n.push(readExifValue(o,e));return l<4&&e.skip(4-l),[r,n,o]}function readIFDSection(t,e,n){var i,r,o=e.nextUInt16();for(r=0;r<o;++r)n((i=readExifTag(t,e))[0],i[1],i[2])}t.exports={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(t,e){var n,i,r,o;try{n=function readHeader(t){if("Exif\0\0"!==t.nextString(6))throw new Error("Invalid EXIF header");var e=t.mark(),n=t.nextUInt16();if(18761===n)t.setBigEndian(!1);else{if(19789!==n)throw new Error("Invalid TIFF header");t.setBigEndian(!0)}if(42!==t.nextUInt16())throw new Error("Invalid TIFF data");return e}(t)}catch(t){return!1}var s=n.openWithOffset(t.nextUInt32()),a=this.IFD0;readIFDSection(n,s,function(t,n,o){switch(t){case 34853:r=n[0];break;case 34665:i=n[0];break;default:e(a,t,n,o)}});var l=s.nextUInt32();0!==l&&readIFDSection(n,n.openWithOffset(l),e.bind(null,this.IFD1));r&&readIFDSection(n,n.openWithOffset(r),e.bind(null,this.GPSIFD));if(i){var u=n.openWithOffset(i),c=this.InteropIFD;readIFDSection(n,u,function(t,n,i){40965===t?o=n[0]:e(c,t,n,i)})}o&&readIFDSection(n,n.openWithOffset(o),e.bind(null,this.InteropIFD));return!0}}},function(t,e,n){var i=n(639),r=n(641),o=[{section:i.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:i.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],s=[{section:i.SubIFD,type:306,name:"ModifyDate"},{section:i.SubIFD,type:36867,name:"DateTimeOriginal"},{section:i.SubIFD,type:36868,name:"CreateDate"},{section:i.SubIFD,type:306,name:"ModifyDate"}];t.exports={castDegreeValues:function(t,e){o.forEach(function(n){var i=t(n);if(i){var r=t({section:n.section,type:n.refType,name:n.refName})===n.posVal?1:-1,o=(i[0]+i[1]/60+i[2]/3600)*r;e(n,o)}})},castDateValues:function(t,e){s.forEach(function(n){var i=t(n);if(i){var o=r.parseExifDate(i);void 0!==o&&e(n,o)}})},simplifyValue:function(t,e){return Array.isArray(t)&&1===(t=t.map(function(t){return 10===e||5===e?t[0]/t[1]:t})).length&&(t=t[0]),t}}},function(t,e){function parseNumber(t){return parseInt(t,10)}var n=3600,i=60;function parseDateTimeParts(t,e){t=t.map(parseNumber),e=e.map(parseNumber);var n=t[0],i=t[1]-1,r=t[2],o=e[0],s=e[1],a=e[2];return Date.UTC(n,i,r,o,s,a,0)/1e3}function parseDateWithTimezoneFormat(t){var e=t.substr(0,10).split("-"),r=t.substr(11,8).split(":"),o=t.substr(19,6).split(":").map(parseNumber),s=o[0]*n+o[1]*i,a=parseDateTimeParts(e,r);if("number"==typeof(a-=s)&&!isNaN(a))return a}function parseDateWithSpecFormat(t){var e=t.split(" "),n=parseDateTimeParts(e[0].split(":"),e[1].split(":"));if("number"==typeof n&&!isNaN(n))return n}t.exports={parseDateWithSpecFormat:parseDateWithSpecFormat,parseDateWithTimezoneFormat:parseDateWithTimezoneFormat,parseExifDate:function parseExifDate(t){var e=19===t.length&&":"===t.charAt(4);return 25===t.length&&"T"===t.charAt(10)?parseDateWithTimezoneFormat(t):e?parseDateWithSpecFormat(t):void 0}}},function(t,e){t.exports={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65000:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}},function(t,e){function DOMBufferStream(t,e,n,i,r,o){this.global=r,e=e||0,n=n||t.byteLength-e,this.arrayBuffer=t.slice(e,e+n),this.view=new r.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(i),this.offset=0,this.parentOffset=(o||0)+e}DOMBufferStream.prototype={setBigEndian:function(t){this.littleEndian=!t},nextUInt8:function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.view.getInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},nextUInt32:function(){var t=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},nextInt16:function(){var t=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},nextInt32:function(){var t=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},nextFloat:function(){var t=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},nextDouble:function(){var t=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},nextBuffer:function(t){var e=this.arrayBuffer.slice(this.offset,this.offset+t);return this.offset+=t,e},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(t){var e=this.arrayBuffer.slice(this.offset,this.offset+t);return e=String.fromCharCode.apply(null,new this.global.Uint8Array(e)),this.offset+=t,e},mark:function(){var t=this;return{openWithOffset:function(e){return e=(e||0)+this.offset,new DOMBufferStream(t.arrayBuffer,e,t.arrayBuffer.byteLength-e,!t.littleEndian,t.global,t.parentOffset)},offset:this.offset,getParentOffset:function(){return t.parentOffset}}},offsetFrom:function(t){return this.parentOffset+this.offset-(t.offset+t.getParentOffset())},skip:function(t){this.offset+=t},branch:function(t,e){return e="number"==typeof e?e:this.arrayBuffer.byteLength-(this.offset+t),new DOMBufferStream(this.arrayBuffer,this.offset+t,e,!this.littleEndian,this.global,this.parentOffset)}},t.exports=DOMBufferStream},function(t,e){function BufferStream(t,e,n,i){this.buffer=t,this.offset=e||0,n="number"==typeof n?n:t.length,this.endPosition=this.offset+n,this.setBigEndian(i)}BufferStream.prototype={setBigEndian:function(t){this.bigEndian=!!t},nextUInt8:function(){var t=this.buffer.readUInt8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.buffer.readInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,t},nextUInt32:function(){var t=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,t},nextInt16:function(){var t=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,t},nextInt32:function(){var t=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,t},nextFloat:function(){var t=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,t},nextDouble:function(){var t=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,t},nextBuffer:function(t){var e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},remainingLength:function(){return this.endPosition-this.offset},nextString:function(t){var e=this.buffer.toString("utf8",this.offset,this.offset+t);return this.offset+=t,e},mark:function(){var t=this;return{openWithOffset:function(e){return e=(e||0)+this.offset,new BufferStream(t.buffer,e,t.endPosition-e,t.bigEndian)},offset:this.offset}},offsetFrom:function(t){return this.offset-t.offset},skip:function(t){this.offset+=t},branch:function(t,e){return e="number"==typeof e?e:this.endPosition-(this.offset+t),new BufferStream(this.buffer,this.offset+t,e,this.bigEndian)}},t.exports=BufferStream},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","merge","timeout","models"],[e,n(635)],(t,e,r,o)=>{return i.defClass(class ImageUploader extends(n(594)(t)){constructor(t,e,n){super(...arguments),this.imageInfo=t,this.onProgress=e,this.onImagePutPropsReady=n,this._attempts=0,this._progress=0,this._previousAttemptFailed=!1,this._tryCount=0,this.createEvent("start"),this._startUpload()}},function(t,n,s){this.zoUploadImage=function(e,n,i){return new t(e,n,i)},this.property("imageInfo attempts progress previousAttemptFailed onProgress tryCount uploadPromise"),this.prototype.try=function(){return this.previousAttemptFailed?this.startUpload():this.uploadPromise},this.prototype.abort=null,this.prototype.createEvent=function(t,n){return s.createEvent.call(this,t,e(n,this.imageInfo,{attempts:this.attempts,tryCount:this.tryCount}))},this.prototype._startUpload=function(){return this.attempts>0&&this.createEvent("restart"),this.attempts++,this.progress=0,this.previousAttemptFailed=!1,this.onProgress&&r(0,()=>this.onProgress(0)),this.uploadPromise=o.imageStore.put(e(this.imageInfo,{onImagePutPropsReady:this.onImagePutPropsReady,onProgress:({progress:t,abort:e})=>(this.abort=e,this.progress=t,i.isF(this.onProgress)&&this.onProgress(t))})).tapCatch(()=>(this.previousAttemptFailed=!0,this.createEvent("failure"))).tap(()=>this.createEvent("success")).finally(()=>this.abort=null)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(269)).includeInNamespace(n(647)).addModules({ClientLib:n(633),Cordova:n(776),ErrorNotificationFilter:n(648),Modernizer:n(1020),StandardImport:n(268),ZoLogoElementProps:n(905)}),n(1021),n(1235),n(1237),n(758)},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>(n(307),n(307).log("Client/Client load StringConstants"),n(590),n(134).Pipeline.filter(n(648)),n(649),n(758),n(268),n(1010),null))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Filter","isFailure","isClientFailure","models","getEnv","log"],[e,n(268)],(t,e,n,r,o,s)=>{return i.defClass(class ErrorNotificationFilter extends t{},function(t,a,l){let u;this.location("client"),this.group("loggers"),this.filterFailures(!0),u={missing:!0,networkFailure:!0},this.after({all:function(t){let a,l,c,h,p,d,f,m;return!e(a=t.status)||u[a]||n(a)||(l=t.key,c=t.type,h=t.responseProps,p=t.pipelineName,d=`artEry:failure:${i.toString(p)}:${i.toString(c)}:${i.toString(a)}`,"event"!==t.pipelineName?r.event.create(d,{data:{pipeline:p,type:c,key:l,status:a,message:i.exists(h)&&i.exists(f=h.data)&&i.exists(m=f.message)&&m.slice(0,1024)}}):o().logEvents&&s(`ignore event: ${i.toString(d)} (ErrorNotificationFilter)`)),t}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(277)).addModules({Channel:n(650),ChannelTopic:n(698),DbPipelineBase:n(695),Flag:n(699),FollowerBase:n(700),ImageStore:n(701),Notification:n(702),Post:n(703),PostParticipant:n(715),PostPipelineLib:n(704),PostPrivacyFilter:n(705),PostSearch:n(716),PostTagsFilter:n(706),SearchPipelineBase:n(717),SharePasswordFilter:n(707),StandardImport:n(651),Status:n(730),Subscription:n(731),Topic:n(732),TopicFollower:n(734),TopicHide:n(735),TopicSearch:n(736),TopicTagsFilter:n(733),User:n(737),UserSearch:n(738)}),n(708),n(739),n(744),n(696),n(755)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["pipelines","Promise","merge","compactFlatten","log","Error"],[e,n(651)],(t,e,r,o,s,a)=>{return i.defClass(class Channel extends(n(695)){},function(n,l,u){this.publicRequestTypes("follow toggleFollowing channelsByUserId get unfollow recentActivity"),this.globalIndexes({channelsByUserId:"userId/createdAt"}),this.addDatabaseFilters({fields:{title:"trimmedString",topicCount:"count"},userOwned:!0}),this.handlers({toggleFollowing:function(e){let n,i,r;return({topicId:n,subscribed:i,vertical:r}=e.data),this._getValidChannelForCurrentUser(e).then(o=>{let s,a;return s=o.id,t.channelTopic.get(e,{key:a={topicId:n,channelId:s},returnNullIfMissing:!0}).then(o=>t.channel[o?"unfollow":"follow"](e,{data:{topicId:n,channelId:s,subscribed:i,vertical:r}}))})},recentActivity:function(n){let s,a;return s=n.session.userId,a=n.key,n.requiredFields({channelId:a}).then(()=>e.all([n.cachedGet("channel",a),t.channelTopic.channelTopicsByChannelId(n,a,{props:{include:!1}})])).tap(([t])=>{let e;return({userId:e}=n.session),n.require(e===t.userId,"own channel")}).then(([t,r])=>{let o;return o=[],e.all(i.array(r,({followedUserId:t})=>(o.push(t),n.cachedGet("user",t)),({followedUserId:t})=>t!==s&&!i.in(t,o)))}).then(o=>(o=o.sort((t,e)=>e.lastPostCreatedAt-t.lastPostCreatedAt),e.all(i.array(o.slice(0,12),o=>t.topic.topicsByUserIdDesc(n,{key:o.id,originatedOnServer:!1,props:{include:!1}}).then(t=>{let s,a,l;return(s=i.find(t,null,t=>!t.isProfileTopic))?e.deepAll({lastPost:null!=(a=s.lastPost)?a:n.cachedGet("post",s.lastPostId),lastChapterPost:null!=(l=s.lastChapterPost)?l:n.cachedGet("post",s.lastChapterPostId)}).then(t=>({user:o,topic:r(s,t)})):void 0}))))).then(t=>o(t))},follow:function(e){let n,i,o,a;return a=e.data,n=a.topicId,i=a.subscribed,o=a.vertical,t.topic.canView(e,n).tapCatch(({status:t})=>s({followFailed:{status:t,topicId:n}})).then(s=>s?this._getValidChannelForCurrentUser(e).then(s=>{let a,l;return({id:a,userId:l}=s),e.cachedGet("topic",n).then(({userId:s})=>t.channelTopic.createOrUpdate(e,{props:{subscribed:i,vertical:o,include:"auto"},key:{channelId:a,topicId:n},data:{userId:l,channelId:a,topicId:n,followedUserId:s}}).then(t=>r(t,{channelId:a,topicId:n}))).tap(()=>i?t.topicFollower.update(e,{key:{userId:l,topicId:n},data:{subscribed:i,vertical:o}}):void 0)}):e.clientFailureNotAuthorized())},unfollow:function(e){let n;return({topicId:n}=e.data),this._getValidChannelForCurrentUser(e).then(i=>t.channelTopic.deleteIfExists(e,{key:{channelId:i.id,topicId:n}}))},getDefaultChannel:function(e){let n;if(({userId:n}=e.session),!n)throw new a("userId required");return e.cachedGet("user",n).then(n=>{let i;return({defaultChannelId:i}=n),i?e.cachedGet("channel",i):t.channel.create(e,{data:{title:"Default"}})})}}),this.updateAfter({create:{channelTopic:function(t){return{key:t.data.channelId,add:{topicCount:1}}}},delete:{channelTopic:function(t){return{key:t.data.channelId,add:{topicCount:-1}}}}}),this.prototype._getValidChannelForCurrentUser=function(e){let n,r;return({channelId:n}=e.data),({userId:r}=e.session),e.cachedGetIfExists("channel",n).then(o=>o?(o.userId!==r&&(()=>{throw new a(`current user (${i.toString(r)}) does not own the channel (${i.toString(n)})`)})(),o):t.channel.getDefaultChannel(e))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(538).mergeWithSelf(n(560),n(652),n(15),n(541)))}).call(this,n(2)(t))},function(t,e,n){t.exports=n(653)},function(t,e,n){t.exports=n(654)},function(t,e,n){t.exports=n(655),t.exports.addModules({DynamoDbPipeline:n(657),SqsPipeline:n(694)})},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(18).addNamespace("Art.EryExtensions.Aws",function(t){function Aws(){return Aws.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Aws,Neptune.PackageNamespace),Aws.version=n(656).version,Aws}())},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-aws":"git://github.com/imikimi/art-aws.git","art-build-configurator":"*","art-ery":"git://github.com/imikimi/art-ery.git","uuid":"^2.0.3"},"description":"ArtEry for AWS Lambda + DynamoDB","license":"ISC","name":"art-ery-aws","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"1.35.0"}')},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I={}.hasOwnProperty;c=(C=n(42)).defineModule,S=C.mergeInto,s=C.Promise,w=C.object,m=C.isPlainObject,C.deepMerge,l=C.compactFlatten,C.inspect,y=C.log,v=C.merge,u=C.compare,C.Validator,g=C.isString,f=C.isFunction,k=C.withSort,h=C.formattedInspect,C.mergeIntoUnless,x=C.objectWithExistingValues,C.present,g=C.isString,E=C.timeout,p=C.intRand,d=C.isArray,T=C.upperCamelCase,b=n(141).networkFailure,o=(_=n(134)).Pipeline,r=_.KeyFieldsMixin,P=_.pipelines,a=_.UpdateAfterMixin,i=(e=n(658)).DynamoDb,c(t,function(t){var n,c;function DynamoDbPipeline(){return DynamoDbPipeline.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)I.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(DynamoDbPipeline,r(a(o))),DynamoDbPipeline.abstractClass(),DynamoDbPipeline.createTablesForAllRegisteredPipelines=function(){var t,e,n;return n=function(){var n;for(t in n=[],P)e=P[t],f(e.createTable)&&n.push(e.createTable());return n}(),s.all(n)},DynamoDbPipeline.classGetter({dynamoDb:function(){return i.singleton}}),DynamoDbPipeline.globalIndexes=function(t){return this._globalIndexes=t,this.query(this._getAutoDefinedQueries(t))},DynamoDbPipeline.localIndexes=function(t){return this._localIndexes=t,this.query(this._getAutoDefinedQueries(t))},DynamoDbPipeline.getter({globalIndexes:function(){return this._options.globalIndexes||this.class._globalIndexes},localIndexes:function(){return this._options.localIndexes||this.class._localIndexes}}),DynamoDbPipeline.primaryKey=function(){var t,e,n,i;if(DynamoDbPipeline.__super__.constructor.primaryKey.apply(this,arguments),t=(i=e=this.getKeyFields())[0],i&&2===(null!=e?e.length:void 0))return this.query(this._getAutoDefinedQueries(((n={})[this.getPluralPipelineName()+"By"+T(t)]=this.getKeyFieldsString(),n)))},DynamoDbPipeline.getter({status:function(){return this._vivifyTable().then(function(){return"OK: table exists and is reachable"}).catch(function(){return"ERROR: could not connect to the table"})},dynamoDb:function(){return i.singleton}}),DynamoDbPipeline.prototype.queryDynamoDb=function(t){return y.warn("DEPRICATED: queryDynamoDb; use queryDynamoDbWithRequest"),this._retryIfServiceUnavailable(null,(e=this,function(){return e.dynamoDb.query(v(t,{table:e.tableName}))}));var e},DynamoDbPipeline.prototype.queryDynamoDbWithRequest=function(t,e){return this._retryIfServiceUnavailable(t,(n=this,function(){return n.dynamoDb.query(v(e,{table:n.tableName}))}));var n},DynamoDbPipeline.prototype.scanDynamoDb=function(t){return this.dynamoDb.scan(v(t,{table:this.tableName}))},DynamoDbPipeline.prototype.withDynamoDb=function(t,e){return this.dynamoDb[t](v(e,{table:this.tableName}))},DynamoDbPipeline.prototype.batchedEach=function(t,e){var n,i,r,o,a;return null==e&&(e={}),r=e.lastEvaluatedKey,o=e.limit,n=e.batchLimit,null!=o&&null==n&&(n=o),i=r,this.getAll({returnResponse:!0,props:v(e.props,{lastEvaluatedKey:r,limit:n})}).then((a=this,function(n){var r,l,u,c;if(c=n.props,u=c.lastEvaluatedKey,r=n.data,l=(!o||o>r.length)&&!!u,y("got "+r.length+" records. "+h({getMore:l,limit:o,lastEvaluatedKey:u})),null!=u&&i===u)throw new Error("same last-key "+i);return s.then(function(){return t(r)}).then(function(){return l?a.batchedEach(t,v(e,{lastEvaluatedKey:u,limit:null!=o&&o-r.length})).then(function(t){return t+r.length}):r.length})}))},DynamoDbPipeline.handlers({createTable:function(){return this._vivifyTable().then(function(){return{message:"success"}})},initialize:function(t){return this._vivifyTable().then(function(){return{message:"success"}})},getInitializeParams:function(){return this.createTableParams},get:function(t){return this._artEryToDynamoDbRequest(t,{requiresKey:!0,then:(e=this,function(n){return e.dynamoDb.getItem(n).then(function(e){return e.item||t.missing()})})});var e},scan:function(t){var e,n,i;return n=(i=t.props).limit,e=i.lastEvaluatedKey,this.scanDynamoDb({limit:n,lastEvaluatedKey:e}).then(function(e){var n,i;return i=e.lastEvaluatedKey,n=e.items,t.success({data:n,props:{lastEvaluatedKey:i}})})},getAll:function(t){return t.subrequest(t.pipeline,"scan",{returnResponse:!0,props:t.props})},batchGet:function(t){var e,n,i;return(e=t.props).keys,n=e.select,t.require(d(t.props.keys)).then(function(){if(n)return t.require(g(t.props.select))}).then((i=this,function(){return i._artEryToDynamoDbRequest(t,{then:function(t){return i.dynamoDb.batchGetItem(t).then(function(t){return t.items})}})}))},create:function(t){return this._artEryToDynamoDbRequest(t,{then:(e=this,function(n){return e.dynamoDb.putItem(n).then(function(){return t.data})})});var e},update:function(t){var e,n;return e=t.props.createOk,t.requireServerOriginIf(e,"to use createOk").then((n=this,function(){return t.rejectIf(e&&"id"===n.getKeyFieldsString(),"createOk not available on tables with auto-generated-ids")})).then(function(n){return function(){var i;return i=null,n._artEryToDynamoDbRequest(t,{mustExist:!e,requiresKey:!0,then:function(e){return i=e,n.dynamoDb.updateItem(e).then(function(i){var r,o,s,a;return o=i.item,(null!=(a=e.returnValues)?a.match(/old/i):void 0)?t.success({props:{oldData:o,data:t.requestDataWithKey}}):(s=n.getFieldsRequestWillModify(t),t.success({props:{data:r=S(t.requestDataWithKey,o),updatedData:w(r,{when:function(t,e){return null!=s[e]}})}}))}).catch(function(e){if(e.message.match(/ConditionalCheckFailedException/))return t.missing("Attempted to update a non-existant record.");throw y({DynamoDbPipeline_update:{error:e,request:t}}),e})}}).tapCatch(function(e){return y({ArtEryDynamoDb:{request:t,_dynamoDbParams:i}})})}}(this))},delete:function(t){return this._artEryToDynamoDbRequest(t,{mustExist:!0,returnValues:"allOld",then:(e=this,function(n){return e.dynamoDb.deleteItem(n).then(function(t){return t.item}).catch(function(e){if(e.message.match(/ConditionalCheckFailedException/))return t.missing("Attempted to delete a non-existant record.");throw e})})});var e},deleteIfExists:function(t){var e,n;return n=t.key,e=t.data,t.subrequest(this.pipelineName,"delete",{key:n,data:e,returnNullIfMissing:!0}).then(function(e){return null!=e?e:t.success({data:t.requestDataWithKey})})},createOrUpdate:function(t){return t.requireServerOrigin().then((e=this,function(){return t.rejectIf("id"===e.getKeyFieldsString(),"createOk not available on tables with auto-generated-ids")})).then(function(e){return function(){var n,i,r,o,s;return o=t.props,r=o.key,i=o.data,n=o.add,s=o.setDefault,t.subrequest(e.pipelineName,"update",{returnNullIfMissing:!0,props:{key:r,data:i,add:n,setDefault:s}}).then(function(o){var a;return a=m(r)?r:g(r)&&e.toKeyObject?e.toKeyObject(r):void 0,null!=o?o:t.subrequest(e.pipelineName,"create",{key:r,data:v(a,s,i,n)})})}}(this));var e}}),DynamoDbPipeline.prototype.getFieldsRequestWillModify=function(t){return v(t.props.setDefault,t.props.add,t.data)},DynamoDbPipeline._getAutoDefinedQueries=function(t){var e,n,i,r;if(!t)return{};for(i in n={},r=this,e=function(t,e){var i,o,s,a,c;if((null!=e?e.key:void 0)&&(e=e.key),g(e))return a=e.split("/"),o=a[0],c=a[1],s=e!==r.getKeyFieldsString()?t:void 0,i=function(t,e){var n,i,r,a,u,h,p,f,S,b,w,x;if(S={where:(f={},f[""+o]=t.key,f)},null!=s&&(S.index=s),e&&(S.descending=!0),(x=null!=(b=t.props.where)?b[c]:void 0)&&(m(x)?(r=x.eq,h=x.lt,p=x.lte,a=x.gt,u=x.gte,i=x.between,n=x.beginsWith,S.where[c]=v({eq:r,lt:h,lte:p,gt:a,gte:u,between:i,beginsWith:n})):S.where[c]={eq:x}),w=t.props.select){if(d(w)&&(w=l(w).join(" ")),!g(w))return t.clientFailure("select must be a string or array of strings");S.select=w}return t.pipeline.queryDynamoDbWithRequest(t,S).then(function(t){return t.items}).tapCatch(function(e){return y({DynamoDbPipeline_query:{error:e,params:S,request:t}})})},n[t]={query:function(t){return i(t)},dataToKeyString:function(t){return t[o]},localSort:function(t){return k(t,function(t,e){var n;return 0===(n=u(t[c],e[c]))?u(t.id,e.id):n})}},n[t+"Desc"]={query:function(t){return i(t,!0)},dataToKeyString:function(t){return t[o]},localSort:function(t){return k(t,function(t,e){var n;return 0===(n=u(e[c],t[c]))?u(e.id,t.id):n})}}},t)e(i,t[i]);return n},DynamoDbPipeline.prototype._vivifyTable=function(){return this._vivifyTablePromise||(this._vivifyTablePromise=s.resolve().then((t=this,function(){return t.tablesByNameForVivification.then(function(e){if(!e[t.tableName])return y.warn(t.getClassName()+"#_vivifyTable() dynamoDb table does not exist: "+t.tableName+", creating..."),t._createTable()})})));var t},DynamoDbPipeline.classGetter({tablesByNameForVivification:function(){return this._tablesByNameForVivificationPromise||(this._tablesByNameForVivificationPromise=this.getDynamoDb().listTables().then(function(t){var e;return e=t.TableNames,w(e,function(){return!0})}))}}),DynamoDbPipeline.getter({tablesByNameForVivification:function(){return DynamoDbPipeline.getTablesByNameForVivification()},dynamoDbCreationAttributes:function(){var t,e,n,i;for(t in e={},n=this.normalizedFields)"string"!==(i=n[t]).dataType&&"number"!==i.dataType||(e[t]=i.dataType);return e},streamlinedCreateTableParams:function(){return v({table:this.tableName,globalIndexes:this.globalIndexes,localIndexes:this.localIndexes,attributes:this.dynamoDbCreationAttributes,key:this.keyFieldsString},this._options)},createTableParams:function(){return e.StreamlinedDynamoDbApi.CreateTable.translateParams(this.streamlinedCreateTableParams)}}),DynamoDbPipeline.prototype._createTable=function(){return this.dynamoDb.createTable(this.streamlinedCreateTableParams).catch((t=this,function(e){throw y.error("DynamoDbPipeline#_createTable "+t.tableName+" FAILED",e),e}));var t},DynamoDbPipeline.prototype._artEryToDynamoDbRequest=function(t,e){var n,i,r,o,a,l,u,c,h,p,d,f,m,g;return null==e&&(e={}),p=e.requiresKey,(u=e.mustExist)&&(p=!0),c=t.props,a=c.key,o=c.data,n=c.add,m=c.setDefault,i=c.conditionExpression,d=c.returnValues,r=c.consistentRead,l=c.keys,f=c.select,h=t.requestType,this._retryIfServiceUnavailable(t,(g=this,function(){return s.then(function(){return t.requireServerOriginOr(!(n||m||i||d),"to use add, setDefault, returnValues, or conditionExpression props")}).then(function(){return t.require(!(n||m)||"update"===h,"add and setDefault only valid for update requests")}).then(function(){var s,c;return p&&(o=g.dataWithoutKeyFields(o),a=g.toKeyObject(t.key)),"update"===h&&(c=function(){var t;for(s in t=[],o)null===o[s]&&t.push(s);return t}()),o=x(o),e.returnValues&&(d=e.returnValues),"update"===h&&(d||(d="allNew")),i||(i=u&&a),r&&(r=!0),x({tableName:g.tableName,data:o,key:a,keys:l,select:f,remove:c,add:n,setDefault:m,returnValues:d,conditionExpression:i,consistentRead:r})}).then(e.then,function(e){var n;return n=e.message,t.clientFailure(n)})}))},n=function(t){return t.message.match(/Service *Unavailable/i)},DynamoDbPipeline.prototype._retryIfServiceUnavailable=c=function(t,e,i){return null==i&&(i=2),s.then(function(){return e()}).catch(function(r){if(n(r)){if(i>0)return E(10+p(20)).then(function(){return c(t,e,i-1)});if(t)return t.toResponse(b).then(function(t){return t.toPromise()});throw r}throw r})},DynamoDbPipeline}())}).call(this,n(2)(t))},function(t,e,n){t.exports=n(659)},function(t,e,n){(t.exports=n(660)).includeInNamespace(n(664)).addModules({Aws4RestClient:n(681),Config:n(667),DynamoDb:n(668),Elasticsearch:n(690),S3:n(691),Sqs:n(692),StreamlinedSqsApi:n(693)}),n(669)},function(t,e,n){t.exports=n(661).addNamespace("Aws",class Aws extends Neptune.PackageNamespace{}._configureNamespace(n(662))),n(663)},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Art"),n(660)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","aws-sdk":"^2.447.0","aws4":"^1.6.0","corsproxy":"^1.5.0","dynamodb-local":"*"},"description":"Streamlined APIs for AWS SDK with Promises and Art.Foundation","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","mocha":"^6.2.0","mock-fs":"^4.10.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"license":"ISC","name":"art-aws","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"1.28.0"}')},function(t,e,n){t.exports=n(660).addNamespace("StreamlinedDynamoDbApi",class StreamlinedDynamoDbApi extends Neptune.PackageNamespace{})},function(module,exports,__webpack_require__){(function(global){var _package,isNode,nodeOnlyRequire;if(isNode=__webpack_require__(42).isNode,isNode?(nodeOnlyRequire=eval("require"),global.AWS=nodeOnlyRequire("aws-sdk")):__webpack_require__(665),!self.AWS)throw new Error("Art.Aws: global.AWS required\n\nPlease use one of the following:\n\n  > require 'art-aws/Client'\n  > require 'art-aws/Server'");module.exports=[{config:__webpack_require__(667).config},__webpack_require__(668),{package:_package=__webpack_require__(662),version:_package.version}]}).call(this,__webpack_require__(5))},function(t,e,n){n(666),t.exports=n(658)},function(t,e){t.exports=global.AWS={}},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;l=n(160),s=l.merge,o=l.log,a=l.objectHasKeys,r=l.formattedInspect,i=l.defineModule,l.select,l.newObjectFromEach,l.mergeInto,e=l.Configurable,i(t,function(t){var n;function Config(){return Config.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Config,e),Config.defaults({credentials:{accessKeyId:"blah",secretAccessKey:"blah"},region:"us-east-1",s3Buckets:{},dynamoDb:{maxRetries:5},sqs:{queueUrlPrefix:null}}),Config.awsServiceToConfigNameMap=n={es:"elasticsearch"},Config.getAwsCredentials=function(t){var e;return(null!=(e=Config.getAwsServiceConfig(t))?e.credentials:void 0)||Config.config.credentials},Config.getAwsServiceConfig=function(t){return Config.config[t]||Config.config[n[t]]},Config.getNormalizedConfig=function(t,e){var n,i,l;if(i=Config.getDefaultConfig().credentials,l=Config.getAwsServiceConfig(t),(n=s({accessKeyId:Config.config.credentials.accessKeyId,secretAccessKey:Config.config.credentials.secretAccessKey,region:Config.config.region,maxRetries:5},null!=l?l.credentials:void 0,l,e)).accessKeyId===i.accessKeyId&&!n.endpoint)throw o.error("Art.Aws invalid configuration for "+t+".\n\nPlease set one of:\n- Art.Aws.credentails for connection to AWS\n- Art.Aws."+t+".endpoint for connection to a local server.\n\n"+(e&&a(e)?r({"Art.Aws.config":Config.config,options:e,"merged config":n}):r({"Art.Aws.config":Config.config,"merged config":n}))+"\n"),new Error("invalid config options");return n},Config}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T={}.hasOwnProperty;E=n(42),x=E.merge,E.isPlainObject,E.isPlainArray,E.isBoolean,E.isString,E.isNumber,E.inspect,E.capitalize,E.decapitalize,E.lowerCamelCase,E.wordsArray,g=E.array,w=E.log,b=E.eq,E.formattedInspect,E.objectHasKeys,u=E.Promise,E.objectDiff,C=E.objectDiffReport,P=E.object,E.diff,_=E.objectKeyCount,S=E.each,i=n(96).BaseClass,y=(o=n(667)).config,d=n(669),p=d.Scan,h=d.Query,s=d.CreateTable,c=d.PutItem,m=d.UpdateItem,a=d.DeleteItem,l=d.GetItem,f=d.TableApiBaseClass,r=d.BatchGetItem,v=f.decodeDynamoItem,t.exports=function(t){var e;function DynamoDb(t){null==t&&(t={}),this._awsDynamoDb=new AWS.DynamoDB(x(o.getNormalizedConfig("dynamoDb",t)))}return function(t,e){for(var n in e)T.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(DynamoDb,i),DynamoDb.singletonClass(),e=/ConditionalCheckFailedException|ResourceNotFoundException/,DynamoDb.prototype.invokeAws=function(t,n){return u.withCallback((i=this,function(e){return i._awsDynamoDb[t](n,e)})).catch(function(i){throw!y.verbose&&e.test(i.message)||w.error({"Art.Aws.DynamoDb":{method:t,status:"request was rejected",message:i.message,verbose:y.verbose,params:n,error:i}}),i});var i},DynamoDb.bindAll=function(t){var e,n,i;for(n in i=[],t)e=t[n],i.push(function(t){return function(e,n){return t.prototype[e]=n||function(t){return this.invokeAws(e,t)}}}(this)(n,e));return i},DynamoDb.bindAll({createTable:function(t){var e;try{return this.invokeAws("createTable",s.translateParams(x({attributes:{id:"string"},key:{id:"hash"}},t)))}catch(n){throw e=n,w({createTableInputParams:t}),e}},createNewGlobalSecondaryIndexes:function(t){var e,n;return e=f.translateParams(t).TableName,u.all([this.getTableChanges(t),this.getTableStatus(t)]).then((n=this,function(i){var r,o,a,l,u,c,h,p,d;return l=i[0].GlobalSecondaryIndexes,u=i[1].TableStatus,l&&(c=l.added),0<_(c)?"ACTIVE"!==u?{info:"Can't modify indexes until TableStatus is ACTIVE"}:(l=(p=s.translateParams(t)).GlobalSecondaryIndexes,e=p.TableName,r=p.AttributeDefinitions,h=P(l,{key:function(t){return t.IndexName}}),d={},o=P(r,{key:function(t){return t.AttributeName}}),a=g(c,function(t){var e,n;return n=t.KeySchema,e=t.IndexName,S(n,function(t){var e;return e=t.AttributeName,d[e]=!0}),{Create:h[e]}}),r=g(d,function(t,e){return o[e]}),n.invokeAws("updateTable",{TableName:e,GlobalSecondaryIndexUpdates:a,AttributeDefinitions:r}).then(function(t){return{creating:c,info:t}})):{info:"no new GlobalSecondaryIndexes"}})).then(function(e){return function(n){return e.getTableStatus(t).then(function(t){return x(n,{status:t})})}}(this))},deleteOldGlobalSecondaryIndexes:function(t){var e,n;return e=f.translateParams(t).TableName,u.all([this.getTableChanges(t),this.getTableStatus(t)]).then((n=this,function(t){var i,r,o,s;return r=t[0].GlobalSecondaryIndexes,o=t[1].TableStatus,r&&(s=r.removed),0<_(s)?"ACTIVE"!==o?{info:"Can't modify indexes until TableStatus is ACTIVE"}:(i=g(s,function(t){return{Delete:{IndexName:t.IndexName}}}),n.invokeAws("updateTable",{TableName:e,GlobalSecondaryIndexUpdates:i}).then(function(t){return{deleting:s,info:t}})):{info:"no old GlobalSecondaryIndexes"}})).then(function(e){return function(n){return e.getTableStatus(t).then(function(t){return x(n,{status:t})})}}(this))},query:function(t){return this.invokeAws("query",h.translateParams(t)).then(function(t){var e,n,i,r,o,s;return i=t.Items,n=t.Count,o=t.ScannedCount,r=t.LastEvaluatedKey,e=t.ConsumedCapacity,x(t,{items:function(){var t,e,n;for(n=[],t=0,e=i.length;t<e;t++)s=i[t],n.push(v(s));return n}(),count:n,scannedCount:o,lastEvaluatedKey:r,consumedCapacity:e})})},putItem:function(t){return this.invokeAws("putItem",c.translateParams(t)).then(function(t){return x(t,{item:v(t.Attributes)})})},deleteItem:function(t){return this.invokeAws("deleteItem",t=a.translateParams(t)).then(function(t){return x(t,{item:v(t.Attributes)})})},getItem:function(t){return this.invokeAws("getItem",l.translateParams(t)).then(function(t){return{item:t.Item&&v(t.Item)}})},batchGetItem:function(t){return this.invokeAws("batchGetItem",r.translateParams(t)).then(function(e){var n,i,r;return n=t.table,i=t.tableName,{items:function(){var t,o,s,a;for(a=[],t=0,o=(s=e.Responses[null!=n?n:i]).length;t<o;t++)r=s[t],a.push(v(r));return a}()}})},updateItem:function(t){return this.invokeAws("updateItem",m.translateParams(t)).then(function(t){return x(t,{item:v(t.Attributes)})})},describeTable:function(t){return this.invokeAws("describeTable",f.translateParams(t))},deleteTable:function(t){return this.invokeAws("deleteTable",f.translateParams(t))},waitFor:function(t){return this.invokeAws("waitFor",f.translateParams(t))},getTableChanges:function(t){var e,n,i;return e=f.translateParams(t).TableName,i=function(t,e){var n;return C((n=function(t){return P(t,{key:function(t){return t.IndexName},with:function(t){return{IndexName:t.IndexName,KeySchema:t.KeySchema,Projection:t.Projection}}})})(t),n(e),b)},n=function(t,e){var n;return C((n=function(t){return P(t,{key:function(t){return t.AttributeName}})})(t),n(e),b)},this.describeTable({TableName:e}).then(function(e){var r,o,s,a,l,u,c;return o=(c=e.Table).KeySchema,r=c.GlobalSecondaryIndexes,s=c.LocalSecondaryIndexes,a=c.TableStatus,u={KeySchema:n(t.KeySchema,o),GlobalSecondaryIndexes:i(t.GlobalSecondaryIndexes,r),LocalSecondaryIndexes:i(t.LocalSecondaryIndexes,s)},l=0,u=P(u,{when:function(t){return null!=t&&++l}}),l>0?(u.TableStatus=a,u):"ACTIVE"!==a?{TableStatus:a}:"up to date"})},getTableStatus:function(t){var e;return e=f.translateParams(t).TableName,this.describeTable({TableName:e}).then(function(t){var e;return{TableStatus:(e=t.Table).TableStatus,GlobalSecondaryIndexStatus:P(e.GlobalSecondaryIndexes,{key:function(t){return t.IndexName},with:function(t){return t.IndexStatus}})}})},scan:function(t){return this.invokeAws("scan",p.translateParams(t)).then(function(t){var e,n,i,r,o;return n=t.Items,e=t.Count,r=t.ScannedCount,i=t.LastEvaluatedKey,x({items:function(){var t,e,i;for(i=[],t=0,e=n.length;t<e;t++)o=n[t],i.push(v(o));return i}(),count:e,lastEvaluatedKey:i&&v(i),scannedCount:r})})},listTables:null,describeLimits:null,batchWriteItem:null,updateTable:null}),DynamoDb}()},function(t,e,n){(t.exports=n(663)).includeInNamespace(n(670)).addModules({BatchGetItem:n(672),Common:n(671),CreateTable:n(674),DeleteItem:n(675),GetItem:n(676),PutItem:n(677),Query:n(678),Scan:n(679),TableApiBaseClass:n(673),UpdateItem:n(680)})},function(t,e,n){t.exports=[n(671)]},function(t,e,n){var i,r,o;(i=n(160)).log,r=i.lowerCamelCase,o=i.wordsArray,i.isString,i.isPlainArray,i.isPlainObject,i.isNumber,i.isBoolean,t.exports=function(){var t,e,n,i;function Common(){}for(Common.apiConstantsMap={string:"S",number:"N",binary:"B",bothImages:"NEW_AND_OLD_IMAGES"},e=0,n=(i=o("ALL\nALL_ATTRIBUTES\nALL_NEW\nALL_OLD\nALL_PROJECTED_ATTRIBUTES\nCOUNT\nHASH\nINCLUDE\nINDEXES\nKEYS_ONLY\nNEW_AND_OLD_IMAGES\nNEW_IMAGE\nNONE\nOLD_IMAGE\nRANGE\nS N B\nSPECIFIC_ATTRIBUTES\nTOTAL\nUPDATED_NEW\nUPDATED_OLD\n")).length;e<n;e++)t=i[e],Common.apiConstantsMap[r(t)]=t;return Common}()},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["merge"],[e,n(42)],t=>{return i.defClass(class BatchGetItem extends(n(673)){},function(e,n,r){this.prototype.translateParams=function(e){return this._translateSelect(e),this._target.RequestItems={[this._getTableName(e)]:t({Keys:i.array(e.keys,t=>this._getTranslatedKey(t)),ProjectionExpression:this._target.ProjectionExpression})},delete this._target.ProjectionExpression,this._target}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d;(i=n(160)).log,i.lowerCamelCase,i.wordsArray,p=i.isString,c=i.isPlainArray,h=i.isPlainObject,u=i.isNumber,l=i.isBoolean,a=i.inspect,d=i.upperCamelCase,o=i.compact,s=i.formattedInspect,r=n(671).apiConstantsMap,t.exports=function(){var t;function TableApiBaseClass(){this._uniqueExpressionAttributeId=0,this._target={}}return TableApiBaseClass.prototype.translateParams=function(t){return t.TableName?t:(this._translateTableName(t),this._translateParams(t),this._target)},TableApiBaseClass.translateParams=function(t){return(new this).translateParams(t)},TableApiBaseClass.decodeDynamoData=t=function(e){var n,i,r,o,s,l,u,c,h,p,d;if(l=e.M){for(o in c={},l)d=l[o],c[o]=t(d);return c}if(n=e.L){for(h=[],r=0,s=n.length;r<s;r++)d=n[r],h.push(t(d));return h}if(p=e.S)return p;if(null!=(u=e.N))return parseFloat(u);if(null!=(i=e.BOOL))return!!i;if(e.NULL)return null;throw new Error("unknown dynamo data type: "+a(e))},TableApiBaseClass.decodeDynamoItem=function(e){var n,i,r;for(n in i={},e)r=e[n],i[n]=t(r);return i},TableApiBaseClass.prototype._translateParams=function(){},TableApiBaseClass.prototype._encodeDynamoData=function(t){var e,n,i;return function(){if(h(t)){for(e in i={},t)void 0!==(n=t[e])&&(i[e]=this._encodeDynamoData(n));return{M:i}}if(c(t))return{L:function(){var e,i,r;for(r=[],e=0,i=t.length;e<i;e++)void 0!==(n=t[e])&&r.push(this._encodeDynamoData(n));return r}.call(this)};if(l(t))return{BOOL:t};if(p(t))return{S:t};if(u(t))return{N:t.toString()};if(null===t)return{NULL:!0};throw new Error("invalid data type: "+a(t))}.call(this)},TableApiBaseClass.prototype._decodeDynamoData=t,TableApiBaseClass.prototype._encodeItem=function(t){return this._encodeDynamoData(t).M},TableApiBaseClass.prototype._addExpressionAttributeValue=function(t,e){var n;return((n=this._target).ExpressionAttributeValues||(n.ExpressionAttributeValues={}))[t]=this._encodeDynamoData(e)},TableApiBaseClass.prototype._addExpressionAttributeName=function(t,e){var n;return((n=this._target).ExpressionAttributeNames||(n.ExpressionAttributeNames={}))[t]=e},TableApiBaseClass.prototype._getNextUniqueExpressionAttributeId=function(){return this._uniqueExpressionAttributeId=(this._uniqueExpressionAttributeId||0)+1},TableApiBaseClass.prototype._translateConsistentRead=function(t){if(t.consistentRead)return this._target.ConsistentRead=!0},TableApiBaseClass.prototype._translateLimit=function(t){if(t.limit)return this._target.Limit=t.limit},TableApiBaseClass.prototype._translateExclusiveStartKey=function(t){var e,n;if(e=t.exclusiveStartKey,n=t.lastEvaluatedKey,e||(e=n))return this._target.ExclusiveStartKey=this._encodeItem(e)},TableApiBaseClass.prototype._translateConsumedCapacity=function(t){return this._translateConstantParam(t,"returnConsumedCapacity")},TableApiBaseClass.prototype._translateSelect=function(t){var e;if(!(e=t.select))return this._target;switch(e){case"*":this._target.Select="ALL_ATTRIBUTES";break;case"count(*)":this._target.Select="COUNT";break;default:p(e)&&(e=e.match(/[a-z0-9\[\].]+/gi)),this._target.ProjectionExpression=e.join(", ")}return this._target},TableApiBaseClass.prototype._translateConditionExpression=function(t){var e,n,i,r,s,a,l;return"()"==(r="("+(r=c(t)?(i=function(){var e,n,i;for(i=[],e=0,n=t.length;e<n;e++)s=t[e],p(s)?i.push(s):i.push(this._translateConditionExpression(s));return i}.call(this),o(i).join(" ")):(i=function(){var i;for(n in i=[],t)a=t[n],l=this._getNextUniqueExpressionAttributeId(this._target),e="#attr"+l,this._addExpressionAttributeName(e,n),i.push(this._translateConditionExpressionField(e,a,l));return i}.call(this)).join(" AND "))+")")?null:r},TableApiBaseClass.prototype._translateConditionExpressionField=function(t,e,n){var i,r,o,l,u,c,p,d;if(d=":val"+n,i=null!=e?e.between:void 0){if(2!==i.length)throw new Error("between test must have exactly two values: "+s({between:i}));e={gte:i[0],lte:i[1]}}switch(!1){case!(e&&(o=e.gte)&&(u=e.lte)):return this._addExpressionAttributeValue(l=d+"Gte",o),this._addExpressionAttributeValue(c=d+"Lte",u),t+" BETWEEN "+l+" AND "+c;case!e.attributeExists:return"attribute_exists("+t+")";case!e.attributeNotExists:return"attribute_not_exists("+t+")";default:return r=function(){if(h(p=e)){if(null!=(p=e.eq))return t+" = "+d;if(null!=(p=e.lt))return t+" < "+d;if(null!=(p=e.gt))return t+" > "+d;if(null!=(p=e.lte))return t+" <= "+d;if(null!=(p=e.gte))return t+" >= "+d;if(null!=(p=e.beginsWith))return"begines_with("+t+", "+d+")";if(null!=(p=e.attributeType))return"begines_with("+t+", "+d+")";if(null!=(p=e.contains))return"begines_with("+t+", "+d+")";throw new Error("no valid test detected in: "+t+": "+a(e))}return t+" = "+d}(),this._addExpressionAttributeValue(d,p),r}},TableApiBaseClass.prototype._translateConditionExpressionParam=function(t){var e,n;return(e=t.conditionExpression)?((n=this._translateConditionExpression(e))&&(this._target.ConditionExpression=n),this._target):this._target},TableApiBaseClass.prototype._getTranslatedKey=function(t){var e,n,i;if(!t)throw new Error("key required");for(e in n={},p(t)&&(t={id:t}),t)i=t[e],n[e]=this._encodeDynamoData(i);return n},TableApiBaseClass.prototype._translateKey=function(t){return this._target.Key=this._getTranslatedKey(t.key)},TableApiBaseClass.prototype._getTableName=function(t){var e,n;if(e=t.table,n=t.tableName,null==e&&(e=n),!e)throw new Error("table or tableName required");return e},TableApiBaseClass.prototype._translateTableName=function(t){return this._target.TableName=this._getTableName(t)},TableApiBaseClass.prototype._translateIndexName=function(t){if(t.index)return this._target.IndexName=t.index},TableApiBaseClass.prototype._normalizeConstant=function(t,e){var n;if(!(n=r[t]||e))throw new Error("constant '"+t+"' not found/supported");return n},TableApiBaseClass.prototype._translateConstantParam=function(t,e,n){var i,r;if(i=d(e),r=t[e]||n)return this._target[i]=this._normalizeConstant(r)},TableApiBaseClass}()},function(t,e,n){var i,r,o,s,a,l=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty;(i=n(160)).lowerCamelCase,i.wordsArray,s=i.isPlainObject,i.log,o=i.compactFlatten,a=i.isString,o=i.compactFlatten,i.deepEachAll,i.uniqueValues,r=n(673),t.exports=function(t){function CreateTable(){this._translateLocalIndexes=l(this._translateLocalIndexes,this),this._translateGlobalIndexes=l(this._translateGlobalIndexes,this),this._translateParams=l(this._translateParams,this),CreateTable.__super__.constructor.apply(this,arguments),this._requiredAttributes={}}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(CreateTable,r),CreateTable.prototype._translateParams=function(t){return this._requiredAttributes={},this._translateGlobalIndexes(t),this._translateLocalIndexes(t),this._translateKey(t,this._target),this._translateAttributes(t),this._target.BillingMode=this._isPayPerRequest(t)?"PAY_PER_REQUEST":(this._translateProvisioning(t,this._target),"PROVISIONED"),this._target},CreateTable.prototype._isPayPerRequest=function(t){return"PAY_PER_REQUEST"===(t.billingMode||t.BillingMode)||!t.provisioning&&!t.provisionedThroughput},CreateTable.prototype._translateAttributes=function(t,e){var n,i,r;return null==e&&(e=this._requiredAttributes),i=t.attributes||{id:"string"},this._target.AttributeDefinitions=function(){var t,o,a,l;if(s(i)){for(l=[],t=0,o=(a=Object.keys(e).sort()).length;t<o;t++){if(n=a[t],!(r=i[n]))throw new Error("Required attribute definition for '"+n+"'' not present. Please add it to 'attributes'.");l.push({AttributeName:n,AttributeType:this._normalizeConstant(r)})}return l}return i}.call(this),this._target},CreateTable.prototype._translateKey=function(t,e){var n,i,r,l,u,c,h,p,d;for(null==e&&(e={}),u=t.key||t.keySchema||{id:"hash"},e.KeySchema=function(){var t,e;if(s(u)){for(l in e=[],u)d=u[l],e.push({AttributeName:l,KeyType:this._normalizeConstant(d)});return e}if(a(u))return t=u.split("/"),i=t[0],h=t[1],o([{AttributeName:i,KeyType:"HASH"},h?{AttributeName:h,KeyType:"RANGE"}:void 0])}.call(this),r=0,c=(p=e.KeySchema).length;r<c;r++)n=p[r].AttributeName,this._requiredAttributes[n]=!0;return e},CreateTable.prototype._translateProvisioning=function(t,e){var n;return null==e&&(e={}),n=(null!=t?t.provisioning:void 0)||(null!=t?t.provisionedThroughput:void 0)||{},e.ProvisionedThroughput={ReadCapacityUnits:n.read||n.readCapacityUnits||1,WriteCapacityUnits:n.write||n.writeCapacityUnits||1},e},CreateTable.prototype._translateGlobalIndexes=function(t){var e,n,i,r;return(n=null!=t?t.globalIndexes:void 0)&&(this._target.GlobalSecondaryIndexes=function(){var o;if(s(n)){for(i in o=[],n)r=n[i],e={IndexName:i},a(r)?this._translateKey({key:r},e):this._translateKey(r,e),this._translateProjection(r,e),this._isPayPerRequest(t)||this._translateProvisioning(r,e),o.push(e);return o}return n}.call(this)),this._target},CreateTable.prototype._translateLocalIndexes=function(t){var e,n,i,r;return(r=(null!=t?t.localIndexes:void 0)||(null!=t?t.localSecondaryIndexes:void 0))&&(this._target.LocalSecondaryIndexes=function(){var t;if(s(r)){for(n in t=[],r)i=r[n],e={IndexName:n},a(i)?this._translateKey({key:i},e):this._translateKey(i,e),this._translateProjection(i,e),t.push(e);return t}return globalIndexes}.call(this)),this._target},CreateTable.prototype._translateProjection=function(t,e){var n,i,r;return null==e&&(e={}),i=(null!=t?t.projection:void 0)||{type:"all"},r=a(i)?i:i.type,e.Projection=n={ProjectionType:this._normalizeConstant(r,i.attributes?"INCLUDE":"ALL")},i.attributes&&(n.NonKeyAttributes=i.attributes),n},CreateTable}()},function(t,e,n){var i,r,o={}.hasOwnProperty;(i=n(160)).lowerCamelCase,i.wordsArray,i.isPlainObject,i.log,i.compactFlatten,i.isString,i.compactFlatten,i.deepEachAll,i.uniqueValues,i.isNumber,r=n(673),t.exports=function(t){function DeleteItem(){return DeleteItem.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(DeleteItem,r),DeleteItem.prototype._translateParams=function(t){return this._translateKey(t),this._translateOptionalParams(t),this._target},DeleteItem.prototype._translateOptionalParams=function(t){return this._translateConditionExpressionParam(t),this._translateConstantParam(t,"returnConsumedCapacity"),this._translateConstantParam(t,"returnItemCollectionMetrics"),this._translateConstantParam(t,"returnValues")},DeleteItem}()},function(t,e,n){var i,r,o={}.hasOwnProperty;(i=n(160)).lowerCamelCase,i.wordsArray,i.isPlainObject,i.log,i.compactFlatten,i.isString,i.compactFlatten,i.deepEachAll,i.uniqueValues,i.isNumber,r=n(673),t.exports=function(t){function GetItem(){return GetItem.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(GetItem,r),GetItem.prototype._translateParams=function(t){return this._translateKey(t),this._translateOptionalParams(t),this._target},GetItem.prototype._translateOptionalParams=function(t){return this._translateConsistentRead(t),this._translateConsumedCapacity(t),this._translateSelect(t)},GetItem}()},function(t,e,n){var i,r,o=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty;(i=n(160)).lowerCamelCase,i.wordsArray,i.isPlainObject,i.log,i.compactFlatten,i.isString,i.compactFlatten,i.deepEachAll,i.uniqueValues,i.isNumber,r=n(673),t.exports=function(t){function PutItem(){return this._translateItem=o(this._translateItem,this),this._translateParams=o(this._translateParams,this),PutItem.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PutItem,r),PutItem.prototype._translateParams=function(t){return this._translateItem(t),this._translateOptionalParams(t),this._target},PutItem.prototype._translateItem=function(t){var e,n;if(n=t.item,e=t.data,n||(n=e),!n)throw new Error("item or data required");return this._target.Item=this._encodeItem(n),this._target},PutItem.prototype._translateOptionalParams=function(t){return this._translateConditionExpressionParam(t),this._translateConstantParam(t,"returnConsumedCapacity"),this._translateConstantParam(t,"returnItemCollectionMetrics"),this._translateConstantParam(t,"returnValues")},PutItem}()},function(t,e,n){var i,r,o,s=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty;(i=n(160)).lowerCamelCase,i.wordsArray,i.isPlainObject,i.log,i.compactFlatten,i.isString,i.compactFlatten,i.deepEachAll,i.uniqueValues,o=i.formattedInspect,i.isNumber,r=n(673),t.exports=function(t){function Query(){return this._translateParams=s(this._translateParams,this),Query.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Query,r),Query.prototype._translateParams=function(t){return this._translateOptionalParams(t),this._translateWhere(t),this._target},Query.prototype._translateLimit=function(t){if(null!=t.limit)return this._target.Limit=t.limit},Query.prototype._translateExclusiveStartKey=function(t){if(t.exclusiveStartKey)return this._target.ExclusiveStartKey=t.exclusiveStartKey},Query.prototype._translateDescending=function(t){if(t.descending)return this._target.ScanIndexForward=!1},Query.prototype._translateWhere=function(t){var e,n;if(null==(n=t.where))throw new Error("where param required");if(e=this._translateConditionExpression(n))this._target.KeyConditionExpression=e;else if(null==n)throw new Error("non-empty where param required: where: "+o(n));return this._target},Query.prototype._translateFilterExpression=function(t){var e,n;if(n=t.filterExpression)return(e=this._translateConditionExpression(n))&&(this._target.FilterExpression=e),this._target},Query.prototype._translateOptionalParams=function(t){return this._translateIndexName(t),this._translateLimit(t),this._translateConsistentRead(t),this._translateConsumedCapacity(t),this._translateDescending(t),this._translateExclusiveStartKey(t),this._translateSelect(t),this._target},Query}()},function(t,e,n){var i,r,o={}.hasOwnProperty;(i=n(160)).lowerCamelCase,i.wordsArray,i.isPlainObject,i.log,i.compactFlatten,i.isString,i.compactFlatten,i.deepEachAll,i.uniqueValues,i.isNumber,r=n(673),t.exports=function(t){function Scan(){return Scan.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Scan,r),Scan.prototype._translateParams=function(t){return this._translateOptionalParams(t),this._target},Scan.prototype._translateOptionalParams=function(t){return this._translateLimit(t),this._translateExclusiveStartKey(t)},Scan}()},function(t,e,n){var i,r,o,s,a=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty;(i=n(160)).lowerCamelCase,i.wordsArray,i.isPlainObject,i.log,o=i.compactFlatten,i.isString,o=i.compactFlatten,i.deepEachAll,i.uniqueValues,i.isNumber,s=i.merge,r=n(673),t.exports=function(t){function UpdateItem(){return this._translateUpdateExpression=a(this._translateUpdateExpression,this),this._translateParams=a(this._translateParams,this),UpdateItem.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(UpdateItem,r),UpdateItem.prototype._translateParams=function(t){return this._translateKey(t),this._translateUpdateExpression(t),this._translateOptionalParams(t),this._target},UpdateItem.prototype._translateUpdateExpression=function(t){var e,n,i,r,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x;if(p=t.item,g=t.set,c=t.data,n=t.add,d=t.remove,y=t.setDefault,h=t.defaults,p=s(p,g,c),h=s(y,h),e=function(){var t;for(l in t=[],p)void 0!==(u=p[l])&&(b=this._getNextUniqueExpressionAttributeId(this._target),a="#attr"+b,x=":val"+b,this._addExpressionAttributeName(a,l),this._addExpressionAttributeValue(x,u),t.push(a+" = "+x));return t}.call(this),v=function(){var t;for(l in t=[],h)void 0!==(u=h[l])&&(b=this._getNextUniqueExpressionAttributeId(this._target),a="#attr"+b,x=":val"+b,this._addExpressionAttributeName(a,l),this._addExpressionAttributeValue(x,u),t.push(a+" = if_not_exists("+a+", "+x+")"));return t}.call(this),i=function(){var t,e;for(l in e=[],t=n||{})void 0!==(u=t[l])&&(b=this._getNextUniqueExpressionAttributeId(this._target),a="#attr"+b,x=":val"+b,this._addExpressionAttributeName(a,l),this._addExpressionAttributeValue(x,u),e.push(a+" "+x));return e}.call(this),f=function(){var t,e,n,i;for(i=[],t=0,e=(n=d||[]).length;t<e;t++)l=n[t],b=this._getNextUniqueExpressionAttributeId(this._target),a="#attr"+b,this._addExpressionAttributeName(a,l),i.push(a);return i}.call(this),!(e.length+v.length+i.length>0))throw new Error("at least one 'item/set/data', 'add' or 'defaults/setDefault' entry required");return e.length+v.length>0&&(S="SET "+o([e,v]).join(", ")),i.length>0&&(r="ADD "+i.join(", ")),f.length>0&&(m="REMOVE "+f.join(", ")),w=o([S,r,m]).join(" "),this._target.UpdateExpression=w,this._target},UpdateItem.prototype._translateOptionalParams=function(t){return this._translateConditionExpressionParam(t),this._translateConstantParam(t,"returnConsumedCapacity"),this._translateConstantParam(t,"returnItemCollectionMetrics"),this._translateConstantParam(t,"returnValues","updatedNew")},UpdateItem}()},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f={}.hasOwnProperty;c=n(42),u=c.objectWithout,r=c.formattedInspect,p=c.select,a=c.isString,i=c.defineModule,d=c.urlRegexp,c.getEnv,l=c.merge,c.log,p=c.select,h=n(667),s=h.getAwsServiceConfig,o=h.getAwsCredentials,e=n(682),i(t,function(t){var i;function Aws4RestClient(t){var e;if(Aws4RestClient.__super__.constructor.apply(this,arguments),!a(null!=t?t.service:void 0))throw new Error("service required");this.service=t.service,this.endpoint=t.endpoint,this.credentials=t.credentials,this.credentials||(this.credentials=o(this.service)),this.endpoint||(this.endpoint=null!=(e=s(this.service))?e.endpoint:void 0)}return function(t,e){for(var n in e)f.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Aws4RestClient,n(197).RestClientClass),Aws4RestClient.singletonClass(),i=function(t,e){return e=e?e.replace(/^\//,""):"",(t=t?t.replace(/\/$/,""):"")+"/"+e},Aws4RestClient.prototype.sign=function(t){var e,n,o,s,a,u,c,h,f,m;if(m=t.url,n=t.headers,e=t.body,s=t.method,!d.test(m)){if(!this.endpoint)throw new Error("url does not have a host and no endpoint specified for service. "+r({service:this.service,url:m}));m=i(this.endpoint,m)}if((h=m.match(d))[0],h[1],h[2],o=h[3],h[4],u=h[5],a=null!=(f=h[6])?f:"/",h[7],c=h[8],!o)throw new Error("unvalid url: "+r({url:m}));return null!=u&&(o=o+":"+u),c&&(a=a+"?"+c),l(t,{url:m,headers:this._getSignatureHeaders({method:s,host:o,service:this.service,path:a,headers:p(n,"content-type","Content-Type"),body:e})})},Aws4RestClient.prototype._getSignatureHeaders=function(t){return u(e.sign(t,this.credentials).headers,"Host","Content-Length")},Aws4RestClient.prototype._normalizedRestRequest=function(t){return Aws4RestClient.__super__._normalizedRestRequest.call(this,this.sign(t))},Aws4RestClient}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var i=e,r=n(683),o=n(686),s=n(64),a=n(689)(1e3);function hmac(t,e,n){return s.createHmac("sha256",t).update(e,"utf8").digest(n)}function hash(t,e){return s.createHash("sha256").update(t,"utf8").digest(e)}function encodeRfc3986(t){return t.replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function RequestSigner(t,e){"string"==typeof t&&(t=r.parse(t));var n=t.headers=t.headers||{},i=this.matchHost(t.hostname||t.host||n.Host||n.host);this.request=t,this.credentials=e||this.defaultCredentials(),this.service=t.service||i[0]||"",this.region=t.region||i[1]||"us-east-1","email"===this.service&&(this.service="ses"),!t.method&&t.body&&(t.method="POST"),n.Host||n.host||(n.Host=t.hostname||t.host||this.createHost(),t.port&&(n.Host+=":"+t.port)),t.hostname||t.host||(t.hostname=n.Host||n.host),this.isCodeCommitGit="codecommit"===this.service&&"GIT"===t.method}RequestSigner.prototype.matchHost=function(t){var e=((t||"").match(/([^\.]+)\.(?:([^\.]*)\.)?amazonaws\.com(\.cn)?$/)||[]).slice(1,3);return"es"===e[1]&&(e=e.reverse()),e},RequestSigner.prototype.isSingleRegion=function(){return["s3","sdb"].indexOf(this.service)>=0&&"us-east-1"===this.region||["cloudfront","ls","route53","iam","importexport","sts"].indexOf(this.service)>=0},RequestSigner.prototype.createHost=function(){var t=this.isSingleRegion()?"":("s3"===this.service&&"us-east-1"!==this.region?"-":".")+this.region;return("ses"===this.service?"email":this.service)+t+".amazonaws.com"},RequestSigner.prototype.prepareRequest=function(){this.parsePath();var e,n=this.request,i=n.headers;n.signQuery?(this.parsedPath.query=e=this.parsedPath.query||{},this.credentials.sessionToken&&(e["X-Amz-Security-Token"]=this.credentials.sessionToken),"s3"!==this.service||e["X-Amz-Expires"]||(e["X-Amz-Expires"]=86400),e["X-Amz-Date"]?this.datetime=e["X-Amz-Date"]:e["X-Amz-Date"]=this.getDateTime(),e["X-Amz-Algorithm"]="AWS4-HMAC-SHA256",e["X-Amz-Credential"]=this.credentials.accessKeyId+"/"+this.credentialString(),e["X-Amz-SignedHeaders"]=this.signedHeaders()):(n.doNotModifyHeaders||this.isCodeCommitGit||(!n.body||i["Content-Type"]||i["content-type"]||(i["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"),!n.body||i["Content-Length"]||i["content-length"]||(i["Content-Length"]=t.byteLength(n.body)),!this.credentials.sessionToken||i["X-Amz-Security-Token"]||i["x-amz-security-token"]||(i["X-Amz-Security-Token"]=this.credentials.sessionToken),"s3"!==this.service||i["X-Amz-Content-Sha256"]||i["x-amz-content-sha256"]||(i["X-Amz-Content-Sha256"]=hash(this.request.body||"","hex")),i["X-Amz-Date"]||i["x-amz-date"]?this.datetime=i["X-Amz-Date"]||i["x-amz-date"]:i["X-Amz-Date"]=this.getDateTime()),delete i.Authorization,delete i.authorization)},RequestSigner.prototype.sign=function(){return this.parsedPath||this.prepareRequest(),this.request.signQuery?this.parsedPath.query["X-Amz-Signature"]=this.signature():this.request.headers.Authorization=this.authHeader(),this.request.path=this.formatPath(),this.request},RequestSigner.prototype.getDateTime=function(){if(!this.datetime){var t=this.request.headers,e=new Date(t.Date||t.date||new Date);this.datetime=e.toISOString().replace(/[:\-]|\.\d{3}/g,""),this.isCodeCommitGit&&(this.datetime=this.datetime.slice(0,-1))}return this.datetime},RequestSigner.prototype.getDate=function(){return this.getDateTime().substr(0,8)},RequestSigner.prototype.authHeader=function(){return["AWS4-HMAC-SHA256 Credential="+this.credentials.accessKeyId+"/"+this.credentialString(),"SignedHeaders="+this.signedHeaders(),"Signature="+this.signature()].join(", ")},RequestSigner.prototype.signature=function(){var t=this.getDate(),e=[this.credentials.secretAccessKey,t,this.region,this.service].join(),n=a.get(e);return n||(n=hmac(hmac(hmac(hmac("AWS4"+this.credentials.secretAccessKey,t),this.region),this.service),"aws4_request"),a.set(e,n)),hmac(n,this.stringToSign(),"hex")},RequestSigner.prototype.stringToSign=function(){return["AWS4-HMAC-SHA256",this.getDateTime(),this.credentialString(),hash(this.canonicalString(),"hex")].join("\n")},RequestSigner.prototype.canonicalString=function(){this.parsedPath||this.prepareRequest();var t,e=this.parsedPath.path,n=this.parsedPath.query,i=this.request.headers,r="",s="s3"!==this.service,a="s3"===this.service||this.request.doNotEncodePath,l="s3"===this.service,u="s3"===this.service;return t="s3"===this.service&&this.request.signQuery?"UNSIGNED-PAYLOAD":this.isCodeCommitGit?"":i["X-Amz-Content-Sha256"]||i["x-amz-content-sha256"]||hash(this.request.body||"","hex"),n&&(r=encodeRfc3986(o.stringify(Object.keys(n).sort().reduce(function(t,e){return e?(t[e]=Array.isArray(n[e])?u?n[e][0]:n[e].slice().sort():n[e],t):t},{})))),"/"!==e&&(s&&(e=e.replace(/\/{2,}/g,"/")),"/"!==(e=e.split("/").reduce(function(t,e){return s&&".."===e?t.pop():s&&"."===e||(a&&(e=decodeURIComponent(e)),t.push(encodeRfc3986(encodeURIComponent(e)))),t},[]).join("/"))[0]&&(e="/"+e),l&&(e=e.replace(/%2F/g,"/"))),[this.request.method||"GET",e,r,this.canonicalHeaders()+"\n",this.signedHeaders(),t].join("\n")},RequestSigner.prototype.canonicalHeaders=function(){var t=this.request.headers;return Object.keys(t).sort(function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:1}).map(function(e){return e.toLowerCase()+":"+function trimAll(t){return t.toString().trim().replace(/\s+/g," ")}(t[e])}).join("\n")},RequestSigner.prototype.signedHeaders=function(){return Object.keys(this.request.headers).map(function(t){return t.toLowerCase()}).sort().join(";")},RequestSigner.prototype.credentialString=function(){return[this.getDate(),this.region,this.service,"aws4_request"].join("/")},RequestSigner.prototype.defaultCredentials=function(){var t=process.env;return{accessKeyId:t.AWS_ACCESS_KEY_ID||t.AWS_ACCESS_KEY,secretAccessKey:t.AWS_SECRET_ACCESS_KEY||t.AWS_SECRET_KEY,sessionToken:t.AWS_SESSION_TOKEN}},RequestSigner.prototype.parsePath=function(){var t=this.request.path||"/",e=t.indexOf("?"),n=null;e>=0&&(n=o.parse(t.slice(e+1)),t=t.slice(0,e)),/[^0-9A-Za-z!'()*\-._~%/]/.test(t)&&(t=t.split("/").map(function(t){return encodeURIComponent(decodeURIComponent(t))}).join("/")),this.parsedPath={path:t,query:n}},RequestSigner.prototype.formatPath=function(){var t=this.parsedPath.path,e=this.parsedPath.query;return e?(null!=e[""]&&delete e[""],t+"?"+encodeRfc3986(o.stringify(e))):t},i.RequestSigner=RequestSigner,i.sign=function(t,e){return new RequestSigner(t,e).sign()}}).call(this,n(175).Buffer)},function(t,e,n){"use strict";var i=n(684),r=n(685);function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=urlParse,e.resolve=function urlResolve(t,e){return urlParse(t,!1,!0).resolve(e)},e.resolveObject=function urlResolveObject(t,e){return t?urlParse(t,!1,!0).resolveObject(e):e},e.format=function urlFormat(t){r.isString(t)&&(t=urlParse(t));return t instanceof Url?t.format():Url.prototype.format.call(t)},e.Url=Url;var o=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(l),c=["%","/","?",";","#"].concat(u),h=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=n(686);function urlParse(t,e,n){if(t&&r.isObject(t)&&t instanceof Url)return t;var i=new Url;return i.parse(t,e,n),i}Url.prototype.parse=function(t,e,n){if(!r.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var s=t.indexOf("?"),l=-1!==s&&s<t.indexOf("#")?"?":"#",v=t.split(l);v[0]=v[0].replace(/\\/g,"/");var S=t=v.join(l);if(S=S.trim(),!n&&1===t.split("#").length){var b=a.exec(S);if(b)return this.path=S,this.href=S,this.pathname=b[1],b[2]?(this.search=b[2],this.query=e?y.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var w=o.exec(S);if(w){var x=(w=w[0]).toLowerCase();this.protocol=x,S=S.substr(w.length)}if(n||w||S.match(/^\/\/[^@\/]+@[^@\/]+/)){var P="//"===S.substr(0,2);!P||w&&m[w]||(S=S.substr(2),this.slashes=!0)}if(!m[w]&&(P||w&&!g[w])){for(var C,_,E=-1,T=0;T<h.length;T++){-1!==(k=S.indexOf(h[T]))&&(-1===E||k<E)&&(E=k)}-1!==(_=-1===E?S.lastIndexOf("@"):S.lastIndexOf("@",E))&&(C=S.slice(0,_),S=S.slice(_+1),this.auth=decodeURIComponent(C)),E=-1;for(T=0;T<c.length;T++){var k;-1!==(k=S.indexOf(c[T]))&&(-1===E||k<E)&&(E=k)}-1===E&&(E=S.length),this.host=S.slice(0,E),S=S.slice(E),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var M=this.hostname.split(/\./),A=(T=0,M.length);T<A;T++){var F=M[T];if(F&&!F.match(p)){for(var B="",R=0,z=F.length;R<z;R++)F.charCodeAt(R)>127?B+="x":B+=F[R];if(!B.match(p)){var O=M.slice(0,T),L=M.slice(T+1),D=F.match(d);D&&(O.push(D[1]),L.unshift(D[2])),L.length&&(S="/"+L.join(".")+S),this.hostname=O.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=i.toASCII(this.hostname));var N=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+N,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==S[0]&&(S="/"+S))}if(!f[x])for(T=0,A=u.length;T<A;T++){var W=u[T];if(-1!==S.indexOf(W)){var j=encodeURIComponent(W);j===W&&(j=escape(W)),S=S.split(W).join(j)}}var q=S.indexOf("#");-1!==q&&(this.hash=S.substr(q),S=S.slice(0,q));var H=S.indexOf("?");if(-1!==H?(this.search=S.substr(H),this.query=S.substr(H+1),e&&(this.query=y.parse(this.query)),S=S.slice(0,H)):e&&(this.search="",this.query={}),S&&(this.pathname=S),g[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var V=this.search||"";this.path=N+V}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",i=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(s=y.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),i&&"#"!==i.charAt(0)&&(i="#"+i),a&&"?"!==a.charAt(0)&&(a="?"+a),e+o+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+i},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(r.isString(t)){var e=new Url;e.parse(t,!1,!0),t=e}for(var n=new Url,i=Object.keys(this),o=0;o<i.length;o++){var s=i[o];n[s]=this[s]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),l=0;l<a.length;l++){var u=a[l];"protocol"!==u&&(n[u]=t[u])}return g[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!g[t.protocol]){for(var c=Object.keys(t),h=0;h<c.length;h++){var p=c[h];n[p]=t[p]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||m[t.protocol])n.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var f=n.pathname||"",y=n.search||"";n.path=f+y}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),S=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=S||v||n.host&&t.pathname,w=b,x=n.pathname&&n.pathname.split("/")||[],P=(d=t.pathname&&t.pathname.split("/")||[],n.protocol&&!g[n.protocol]);if(P&&(n.hostname="",n.port=null,n.host&&(""===x[0]?x[0]=n.host:x.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),b=b&&(""===d[0]||""===x[0])),S)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,x=d;else if(d.length)x||(x=[]),x.pop(),x=x.concat(d),n.search=t.search,n.query=t.query;else if(!r.isNullOrUndefined(t.search)){if(P)n.hostname=n.host=x.shift(),(k=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=k.shift(),n.host=n.hostname=k.shift());return n.search=t.search,n.query=t.query,r.isNull(n.pathname)&&r.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!x.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var C=x.slice(-1)[0],_=(n.host||t.host||x.length>1)&&("."===C||".."===C)||""===C,E=0,T=x.length;T>=0;T--)"."===(C=x[T])?x.splice(T,1):".."===C?(x.splice(T,1),E++):E&&(x.splice(T,1),E--);if(!b&&!w)for(;E--;E)x.unshift("..");!b||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),_&&"/"!==x.join("/").substr(-1)&&x.push("");var k,I=""===x[0]||x[0]&&"/"===x[0].charAt(0);P&&(n.hostname=n.host=I?"":x.length?x.shift():"",(k=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=k.shift(),n.host=n.hostname=k.shift()));return(b=b||n.host&&x.length)&&!I&&x.unshift(""),x.length?n.pathname=x.join("/"):(n.pathname=null,n.path=null),r.isNull(n.pathname)&&r.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},Url.prototype.parseHost=function(){var t=this.host,e=s.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e,n){(function(t,i){var r;!function(o){e&&e.nodeType,t&&t.nodeType;var s="object"==typeof i&&i;s.global!==s&&s.window!==s&&s.self;var a,l=2147483647,u=36,c=1,h=26,p=38,d=700,f=72,m=128,g="-",y=/^xn--/,v=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=u-c,x=Math.floor,P=String.fromCharCode;function error(t){throw new RangeError(b[t])}function map(t,e){for(var n=t.length,i=[];n--;)i[n]=e(t[n]);return i}function mapDomain(t,e){var n=t.split("@"),i="";return n.length>1&&(i=n[0]+"@",t=n[1]),i+map((t=t.replace(S,".")).split("."),e).join(".")}function ucs2decode(t){for(var e,n,i=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(n=t.charCodeAt(r++)))?i.push(((1023&e)<<10)+(1023&n)+65536):(i.push(e),r--):i.push(e);return i}function ucs2encode(t){return map(t,function(t){var e="";return t>65535&&(e+=P((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=P(t)}).join("")}function digitToBasic(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function adapt(t,e,n){var i=0;for(t=n?x(t/d):t>>1,t+=x(t/e);t>w*h>>1;i+=u)t=x(t/w);return x(i+(w+1)*t/(t+p))}function decode(t){var e,n,i,r,o,s,a,p,d,y,v,S=[],b=t.length,w=0,P=m,C=f;for((n=t.lastIndexOf(g))<0&&(n=0),i=0;i<n;++i)t.charCodeAt(i)>=128&&error("not-basic"),S.push(t.charCodeAt(i));for(r=n>0?n+1:0;r<b;){for(o=w,s=1,a=u;r>=b&&error("invalid-input"),((p=(v=t.charCodeAt(r++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:u)>=u||p>x((l-w)/s))&&error("overflow"),w+=p*s,!(p<(d=a<=C?c:a>=C+h?h:a-C));a+=u)s>x(l/(y=u-d))&&error("overflow"),s*=y;C=adapt(w-o,e=S.length+1,0==o),x(w/e)>l-P&&error("overflow"),P+=x(w/e),w%=e,S.splice(w++,0,P)}return ucs2encode(S)}function encode(t){var e,n,i,r,o,s,a,p,d,y,v,S,b,w,C,_=[];for(S=(t=ucs2decode(t)).length,e=m,n=0,o=f,s=0;s<S;++s)(v=t[s])<128&&_.push(P(v));for(i=r=_.length,r&&_.push(g);i<S;){for(a=l,s=0;s<S;++s)(v=t[s])>=e&&v<a&&(a=v);for(a-e>x((l-n)/(b=i+1))&&error("overflow"),n+=(a-e)*b,e=a,s=0;s<S;++s)if((v=t[s])<e&&++n>l&&error("overflow"),v==e){for(p=n,d=u;!(p<(y=d<=o?c:d>=o+h?h:d-o));d+=u)C=p-y,w=u-y,_.push(P(digitToBasic(y+C%w,0))),p=x(C/w);_.push(P(digitToBasic(p,0))),o=adapt(n,b,i==r),n=0,++i}++n,++e}return _.join("")}a={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function toASCII(t){return mapDomain(t,function(t){return v.test(t)?"xn--"+encode(t):t})},toUnicode:function toUnicode(t){return mapDomain(t,function(t){return y.test(t)?decode(t.slice(4).toLowerCase()):t})}},void 0===(r=function(){return a}.call(e,n,e,t))||(t.exports=r)}()}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e,n){"use strict";e.decode=e.parse=n(687),e.encode=e.stringify=n(688)},function(t,e,n){"use strict";function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,r){e=e||"&",n=n||"=";var o={};if("string"!=typeof t||0===t.length)return o;var s=/\+/g;t=t.split(e);var a=1e3;r&&"number"==typeof r.maxKeys&&(a=r.maxKeys);var l=t.length;a>0&&l>a&&(l=a);for(var u=0;u<l;++u){var c,h,p,d,f=t[u].replace(s,"%20"),m=f.indexOf(n);m>=0?(c=f.substr(0,m),h=f.substr(m+1)):(c=f,h=""),p=decodeURIComponent(c),d=decodeURIComponent(h),hasOwnProperty(o,p)?i(o[p])?o[p].push(d):o[p]=[o[p],d]:o[p]=d}return o};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,n){"use strict";var i=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,s){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?map(o(t),function(o){var s=encodeURIComponent(i(o))+n;return r(t[o])?map(t[o],function(t){return s+encodeURIComponent(i(t))}).join(e):s+encodeURIComponent(i(t[o]))}).join(e):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(t)):""};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function map(t,e){if(t.map)return t.map(e);for(var n=[],i=0;i<t.length;i++)n.push(e(t[i],i));return n}var o=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},function(t,e){function LruCache(t){this.capacity=0|t,this.map=Object.create(null),this.list=new DoublyLinkedList}function DoublyLinkedList(){this.firstNode=null,this.lastNode=null}t.exports=function(t){return new LruCache(t)},LruCache.prototype.get=function(t){var e=this.map[t];if(null!=e)return this.used(e),e.val},LruCache.prototype.set=function(t,e){var n=this.map[t];if(null!=n)n.val=e;else{if(this.capacity||this.prune(),!this.capacity)return!1;n=new function DoublyLinkedNode(t,e){this.key=t,this.val=e,this.prev=null,this.next=null}(t,e),this.map[t]=n,this.capacity--}return this.used(n),!0},LruCache.prototype.used=function(t){this.list.moveToFront(t)},LruCache.prototype.prune=function(){var t=this.list.pop();null!=t&&(delete this.map[t.key],this.capacity++)},DoublyLinkedList.prototype.moveToFront=function(t){this.firstNode!=t&&(this.remove(t),null==this.firstNode?(this.firstNode=t,this.lastNode=t,t.prev=null,t.next=null):(t.prev=null,t.next=this.firstNode,t.next.prev=t,this.firstNode=t))},DoublyLinkedList.prototype.pop=function(){var t=this.lastNode;return null!=t&&this.remove(t),t},DoublyLinkedList.prototype.remove=function(t){this.firstNode==t?this.firstNode=t.next:null!=t.prev&&(t.prev.next=t.next),this.lastNode==t?this.lastNode=t.prev:null!=t.next&&(t.next.prev=t.prev)}},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h={}.hasOwnProperty;n(197),c=n(42),o=c.compactFlatten,c.mergeInto,r=c.clone,c.object,c.log,u=c.present,a=c.defineModule,c.parseUrl,c.peek,c.Promise,l=c.merge,s=n(667).config,e=n(681),i=n(96).BaseClass,a(t,function(t){function Elasticsearch(t){var e;Elasticsearch.__super__.constructor.apply(this,arguments),e=this.options=l(s.elasticsearch,t),this.host=e.host,this.index=e.index,this.type=e.type,this.parentField=e.parentField,this.routingField=e.routingField}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Elasticsearch,i),Elasticsearch.prototype.get=function(t){return this.aws4RestClient.getJson(this.getEntryUrl(this.normalizeEntryRequestParams(t)))},Elasticsearch.getter({aws4RestClient:function(){return this._aws4RestClient||(this._aws4RestClient=new e(l({service:"es"},s.elasticsearch)))}}),Elasticsearch.prototype.indicesGet=function(t){},Elasticsearch.property("elasticsearchType elasticsearchIndex"),Elasticsearch.prototype.getIndexUrl=function(t){return this.host+"/"+t.index},Elasticsearch.prototype.getIndexTypeUrl=function(t){return this.getIndexUrl(t)+"/"+t.type},Elasticsearch.prototype.getSearchUrl=function(t){return this.getIndexTypeUrl(t)+"/_search"},Elasticsearch.prototype.getEntryBaseUrl=function(t){return this.getIndexUrl(t)+"/"+t.type+"/"+t.id},Elasticsearch.prototype.getEntryUrl=function(t){return""+this.getEntryBaseUrl(t)+this.getEntryUrlParams(t)},Elasticsearch.prototype.getUpdateUrl=function(t){return this.getEntryBaseUrl(t)+"/_update"+this.getEntryUrlParams(t)},Elasticsearch.prototype.getEntryUrlParams=function(t){var e,n;return t.data,n=t.routing,e=t.parent,"?"+o([u(n)?"routing="+encodeURIComponent(u):void 0,u(e)?"parent="+encodeURIComponent(e):void 0]).join("&")},Elasticsearch.prototype.normalizeEntryRequestParams=function(t){var e,n;if(e=t.data,n=r(t),this.routingField){if(!u(null!=e?e[this.routingField]:void 0))throw new Error("routing field '"+this.routingField+"' is not present in data: "+formattedInspect(e));n.routing=e[this.routingField]}if(this.parentField){if(!u(null!=e?e[this.parentField]:void 0))throw new Error("parent field '"+this.parentField+"' is not present in data: "+formattedInspect(e));n.parent=e[this.parentField]}return n.index=this.index,n.type=this.type,n},Elasticsearch}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w={}.hasOwnProperty;s=n(197),S=n(42),u=S.isArray,c=S.isPlainObject,b=S.upperCamelCase,d=S.lowerCamelCase,m=S.object,h=S.isString,p=S.log,v=S.present,l=S.defineModule,g=S.parseUrl,y=S.peek,r=S.Promise,f=S.merge,(o=n(686)).escape||(o.escape=encodeURIComponent),o.unescape||(o.unescape=decodeURIComponent),a=(i=n(667)).config,e=n(96).BaseClass,l(t,function(t){var n,o,l,S;function S3(){return S3.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)w.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(S3,e),S3.put=function(t){var e,n,i,r,o,a,l,u;if(e=t.bucket,o=t.objectName,n=t.data,a=t.onProgress,r=t.mimeType,i=null!=(l=t.headers)?l:{},!(e=S3._normalizeBucket(e)))throw new Error("no bucket!");return u="https://"+(e+".s3.amazonaws.com")+("/"+o),v(r)&&(i["Content-Type"]=r),s.put(u,n,{headers:i,onProgress:a}).then(function(t){return{location:u,response:t}})},n=function(t){var e,n,i;return e=(i=h(t)?S3.parseS3Url(t):t).bucket,n=i.key,{Bucket:S3._normalizeBucket(e),Key:n}},S3.get=function(t){return p({get:t}),r.withCallback(function(e){return S3.getS3().getObject(n(t),e)}).then(o)},S3.delete=function(t){return r.withCallback(function(e){return S3.getS3().deleteObject(n(t),e)})},S3._normalizeBucket=function(t){return a.s3Buckets[t]||t},S3._denormalizeBucket=function(t){var e,n;for(e in n=a.s3Buckets)if(t===n[e])return e;return t},S3.classGetter({s3:function(){return this._s3||(this._s3=new AWS.S3(i.getNormalizedConfig("S3")))}}),S3.parseS3Url=function(t){var e,n,i;return e=(i=g(t)).host,n=i.pathName,{key:y(n.split("/")),bucket:S3._denormalizeBucket(e.split(".s3.amazonaws")[0])}},S3.putSdk=function(t){var e,n,i,o;return n=t.bucket,i=t.key,e=t.body,r.withCallback((o=this,function(t){return o.getS3().putObject({Bucket:o._normalizeBucket(n),Key:i,Body:e},t)}))},S3.copy=function(t){var e,n,i,o,s;return n=t.key,o=t.toBucket,e=t.fromBucket,i=t.params,o=this._normalizeBucket(o),e=this._normalizeBucket(e),r.withCallback((s=this,function(t){return s.getS3().copyObject(f(i,{CopySource:e+"/"+n,Bucket:o,Key:n,MetadataDirective:"COPY"}),t)})).then(function(t){return{copyObjectResult:t,url:"https://"+o+".s3.amazonaws.com/"+n}})},l=function(t,e){var n,i,r,o;if(c(t))return m(t,{key:function(t,n){return e(n)},with:function(t){return l(t,e)}});if(u(t)){for(r=[],n=0,i=t.length;n<i;n++)o=t[n],r.push(l(o,e));return r}return t},S=function(t){return l(t,b)},o=function(t){return l(t,d)},S3.list=function(t){return r.withCallback((e=this,function(n){return e.getS3().listObjectsV2(S(t),n)})).then(function(t){var e;return(t=o(t)).contents=function(){var n,i,r,s;for(s=[],n=0,i=(r=t.contents).length;n<i;n++)e=r[n],s.push(o(e));return s}(),t});var e},S3.restore=function(t){return r.withCallback((e=this,function(n){return e.getS3().restoreObject(S(t),n)})).then(o);var e},S3}())}).call(this,n(2)(t))},function(t,e,n){var i,r,o,s,a,l,u,c,h,p={}.hasOwnProperty;u=n(42),a=u.merge,o=u.Promise,s=u.each,i=n(96).BaseClass,c=n(693),h=c.sqsCommands,l=c.normalizeQueueUrl,r=n(667),t.exports=function(t){var e,n;function Sqs(t){null==t&&(t={}),this._awsSqs=new AWS.SQS(a(this.sqsConfig=r.getNormalizedConfig("sqs",t)))}return function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Sqs,i),Sqs.singletonClass(),Sqs.getter({queueUrl:function(){return l(null,this.sqsConfig)}}),e={},n=function(t){return t},s(h,function(t,i){var r,s,a,l;return s=null!=(a=t.preprocess)?a:n,r=null!=(l=t.postprocess)?l:n,Sqs.prototype[i]=function(t){return o.withCallback((n=this,function(o){return n._awsSqs[i](s(null!=t?t:e,n.sqsConfig),function(t,n){return o(t,r(null!=n?n:e))})}));var n}}),Sqs}()},function(t,e,n){var i,r,o,s,a,l,u;(l=n(42)).log,r=l.findUrlRegExp,s=l.object,a=l.present,u=l.urlJoin,o=l.merge,i=n(667).config,t.exports=function(){var t,e,n;function StreamlinedSqsApi(){}return StreamlinedSqsApi.normalizeQueueUrl=e=function(t,e){var n,o,s,l,c,h,p,d;if(t||(t=null!=(o=null!=(s=null!=(l=null!=e?e.queue:void 0)?l:null!=e?e.queueUrl:void 0)?s:null!=i&&null!=(c=i.sqs)?c.queue:void 0)?o:null!=i&&null!=(h=i.sqs)?h.queueUrl:void 0),t&&r.test(t))return t;if(n=null!=(p=null!=e?e.queueUrlPrefix:void 0)?p:null!=i&&null!=(d=i.sqs)?d.queueUrlPrefix:void 0,!a(n)||!a(t))throw new Error("queueUrlPrefix && queue OR queueUrl required");return u(n,t.replace(/[^-_a-zA-Z0-9]/g,"-"))},t=/^[^a-z]/,n=function(e){return s(e,{when:function(e,n){return t.test(n)}})},StreamlinedSqsApi.sqsCommands={createQueue:{preprocess:function(t,e){var i,r;return i=t.name,r=t.visibilityTimeout,o(n(t),{QueueName:i,Attributes:o(t.Attributes,{VisibilityTimeout:r})})},postprocess:function(t){return t.QueueUrl}},sendMessage:{preprocess:function(t,i){var r,s,a,l,u;return r=t.body,u=t.queue,a=t.delaySeconds,s=t.deduplicationId,l=t.groupId,o(n(t),{QueueUrl:e(u,i),MessageBody:JSON.stringify(r),DelaySeconds:a,MessageDeduplicationId:s,MessageGroupId:l})},postprocess:function(t){var e;return e=t.MessageId,o(t,{id:e})}},receiveMessage:{preprocess:function(t,i){var r,s,a,l;return s=t.queue,a=t.visibilityTimeout,l=t.wait,r=t.limit,o(n(t),{QueueUrl:e(s,i),MaxNumberOfMessages:r,VisibilityTimeout:a,WaitTimeSeconds:null!=l?l:5})},postprocess:function(t){var e,n,i,r,s,a,l,u,c;for(c=[],s=0,a=(u=t.Messages||[]).length;s<a;s++)n=(l=u[s]).MessageId,e=l.Body,i=l.ReceiptHandle,r=function(){try{return JSON.parse(e)}catch(t){return e}}(),c.push(o(l,{id:n,body:r,receiptHandle:i}));return c}},deleteMessage:{preprocess:function(t,i){var r,s;return s=t.receiptHandle,r=t.queue,o(n(t),{QueueUrl:e(r,i),ReceiptHandle:s})}},listQueues:{preprocess:function(t,e){var i;return i=t.QueueNamePrefix,o(n(t),{prefix:i})},postprocess:function(t){return t.QueueUrls}},purgeQueue:{preprocess:function(t,i){return o(n(t),{QueueUrl:e(t.queue,i)})}}},StreamlinedSqsApi}()},function(t,e,n){(function(t){var e,i,r,o,s={}.hasOwnProperty;r=(o=n(42)).defineModule,o.Promise,o.log,o.merge,e=n(134).Pipeline,i=n(658).Sqs,r(t,function(t){function SqsPipeline(){return SqsPipeline.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(SqsPipeline,e),SqsPipeline.abstractClass(),SqsPipeline.getter({sqs:function(){return i.singleton}}),SqsPipeline.handlers({sendMessage:function(t){var e;return e=t.body,this.sqs.sendMessage({queue:this.tableName,body:JSON.stringify(e)})},receiveMessage:function(t){var e,n,i;return n=(e=t.data).visibilityTimeout,i=e.wait,this.sqs.receiveMessage({queue:this.tableName},{limit:1,visibilityTimeout:n,wait:i}).then(function(t){return t[0]})},receiveMessages:function(t){var e,n,i,r,o;return n=null!=(i=(e=t.data).limit)?i:10,r=e.visibilityTimeout,o=e.wait,this.sqs.receiveMessage({queue:this.tableName},{limit:n,visibilityTimeout:r,wait:o})},deleteMessage:function(t){var e;return e=t.key,this.sqs.deleteMessage({queue:this.tableName,receiptHandle:e})}}),SqsPipeline}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c=function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},h={}.hasOwnProperty;s=(u=n(42)).defineModule,u.findUrlRegex,u.toSeconds,u.object,l=u.log,o=u.appendQuery,a=u.isString,n(134).pipelines,e=n(652).DynamoDbPipeline,i=n(15).PusherPipelineMixin,r=n(696).TopCountFilter,s(t,function(t){var e;function DbPipelineBase(){return DbPipelineBase.__super__.constructor.apply(this,arguments)}return c(DbPipelineBase,t),DbPipelineBase.abstractClass(),DbPipelineBase.prototype.requireServerOriginOrOwner=function(t){return t.originatedOnServer?Promise.resolve():t.subrequest(t.pipelineName,"get",{key:t.key,props:{include:!1}}).tap(function(e){return t.requireServerOriginOr(e.userId===t.session.userId,"must be "+t.pipelineName+"'s owner to "+t.type)})},DbPipelineBase.fluxModelMixin(function(t){var e;return e=t.prototype instanceof Neptune.Art.Ery.Flux.ArtEryQueryFluxModel,function(n){function FluxModelReloadSeconds(){return FluxModelReloadSeconds.__super__.constructor.apply(this,arguments)}return c(FluxModelReloadSeconds,t),FluxModelReloadSeconds.staleDataReloadSeconds(60*(e?1:12)*60),FluxModelReloadSeconds.minNetworkFailureReloadSeconds(1),FluxModelReloadSeconds.maxNetworkFailureReloadSeconds(60),FluxModelReloadSeconds.minServerFailureReloadSeconds(60),FluxModelReloadSeconds.maxServerFailureReloadSeconds(43200),FluxModelReloadSeconds}()}),155,DbPipelineBase.sanitizeUrlText=e=function(t){var e,n,i,r,o,s,a;if(!t)return"";if((e=t.replace(/['"`]/g,"").replace(/[^-._~:\/?#\[\]@!$&'()*+;=\w\u007f-\uffff]+/g,"-").replace(/^-|-$/g,"-")).length>155){for(i=0,o=[],n=0,r=(a=e.split("-")).length;n<r;n++){if((s=a[n]).length+i>155){0===i&&o.push(s.slice(0,155));break}o.push(s),i+=s.length}return o.join("-")}return e},DbPipelineBase.prototype.getConnonicalUrl=function(t,e){var i,r;return e&&(i=e.location,r=e.params),null==i&&(i="https://"+n(589).verticalHostname),o(""+i+this.getConnonicalUrlPath(t),r)},DbPipelineBase.prototype.getConnonicalUrlPath=function(t,n){var i;return i="/"+this.urlResourceName+"/"+(a(t)?t:t.id),n&&(i+="/"+e(n)),i},DbPipelineBase.getter({urlResourceName:function(){return this.name}}),DbPipelineBase.filter(r),DbPipelineBase.filter({name:"async-delete",group:"outer",before:{delete:function(t){var e;return e=t.key,t.props.async?t.require(t.props.force,"props: force: true").then(function(){return t.pipeline.requireServerOriginOrOwner(t)}).then(function(){return l(t.pipelineName+".delete_async_true "+e+" - start..."),t.subrequest(t.pipelineName,"delete",{key:e,props:{force:!0}}).then(function(n){return l(t.pipelineName+".delete_async_true "+e+" - done."),l({delete_async_true:{pipeline:t.pipelineName,key:e,result:n}})}),l(t.pipelineName+".delete_async_true "+e+" - return response to original request..."),{message:"delete in progress",topicId:e}}):t}}}),DbPipelineBase}(i(e)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(281)).addModules({TopCountFilter:n(697)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Filter","pipelines","config","isNumber"],[e,n(651)],(t,e,n,r)=>{return i.defClass(class TopCountFilter extends t{},function(t,o,s){this.getter({countFieldRegExp:function(){let t;return null!=(t=this._countFieldRegExp)?t:this._countFieldRegExp=e.topCount.countFieldRegExp}}),this.after({update:function(t){return i.each2(t.requestProps.add,(i,r)=>{let o,s;return n.minTopCount<=(o=t.responseData[r])?e.topCount.createOrUpdate(t,s={data:{recordId:t.key,recordType:t.pipelineName,fieldName:r,count:o}}):void 0},(t,e)=>r(t)&&this.countFieldRegExp.test(e)),t}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["pipelines"],[e,n(651)],t=>{return i.defClass(class ChannelTopic extends(n(695)){},function(e,n,i){this.publicRequestTypes("channelTopicsByChannelId"),this.primaryKey("channelId/topicId"),this.prototype.isRecord=function({channelId:t,topicId:e}){return null!=t&&null!=e},this.addDatabaseFilters({userOwned:!0,fields:{channel:["required","link"],topic:["required","include","link"],followedUser:{required:{link:"user"}}}}),this.filter({name:"onlyTopicsUserCanView",group:"inner",after:{channelTopicsByChannelId:function(e){return e.originatedOnServer?e:e.withTransformedRecords(n=>t.topic.canView(e,n.topicId).then(t=>t?n:void 0))}}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Pipeline","Promise","pipelines","compactFlatten","verticalHostname","getMediaUrlForPost","Neptune"],[e,n(651)],(t,e,n,r,o,s,a)=>{return i.defClass(class Flag extends t{},function(t,l,u){this.publicRequestTypes("create"),this.handlers({create:function(t){let l,u,c,h,p,d,f,m;return l=t.session,u=t.data,c=u.userId,h=u.topicId,p=u.messageId,d=u.postId,f=u.reason,t.requiredFields({"session.userId":m=l.userId}).then(()=>t.require(f&&f.length<=1e3)).then(()=>e.all([c&&n.user.get(t,{key:c,returnNullIfMissing:!0,props:{include:!1}}),m&&n.user.get(t,{key:m,returnNullIfMissing:!0,props:{include:!1}}),h&&n.topic.get(t,{key:h,returnNullIfMissing:!0,props:{include:!1}}),d&&n.post.get(t,{key:d,returnNullIfMissing:!0,props:{include:!1}}),p&&n.message.get(t,{key:p,returnNullIfMissing:!0,props:{include:!1}})])).then(([l,u,m,g,y])=>{let v,S;return(!l&&(c=null!=(v=null!=(S=i.exists(y)&&y.userId)?S:i.exists(g)&&g.userId)?v:i.exists(m)&&m.userId)?n.user.get(t,{key:c,returnNullIfMissing:!0,props:{include:!1}}):e.resolve(l)).then(t=>{let e,n,l,c,v;return e=i.exists(t)&&t.displayName,n=i.exists(u)&&u.displayName,l={to:"feedback@imikimi.com",from:"FlagPipeline <client@imikimi.com>",subject:"Zo community flag: "+r([e,p&&`comment: ${i.toString(p)}`,d&&`post: ${i.toString(d)}`,h&&`stream: ${i.toString(h)}`,`by ${i.toString(n)}`]).join(", "),html:r(["<html><body>",u&&`<a href='https://${i.toString(o)}/member/${i.toString(u.id)}'>${i.toString(u.displayName)} (${i.toString(u.id)})</a> flagged:`,y&&`<a href='https://${i.toString(o)}/message/${i.toString(y.postId)}'>message (${i.toString(y.id)})</a> text: ${i.toString(y.text)}`,g&&`<a href='https://${i.toString(o)}/post/${i.toString(g.id)}'>post (${i.toString(g.id)})</a> caption: ${i.toString(null!=(c=g.caption)?c:"no caption")}`,m&&`<a href='https://${i.toString(o)}/post/${i.toString(m.lastPostId)}'>topic (${i.toString(m.id)})</a> title: ${i.toString(m.title)}`,t&&`<a href='https://${i.toString(o)}/member/${i.toString(t.id)}'>user: ${i.toString(t.displayName)} (${i.toString(t.id)})</a>`,"(note: first item is the one that was actually flagged. The rest are merely the other, relevant records.)",`Reason: ${i.toString(f)}`,g&&`<a href='https://${i.toString(o)}/post/${i.toString(g.id)}'><img src='${i.toString(s(g,"medium"))}'></a>`,"</body></html>"]).join("<br>\n")},i.exists(v=a.Art.Mailgun)&&v.sendEmail(l),l})})}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;o=n(160),s=o.toSeconds,o.Promise,o.log,i=o.defineModule,o.objectHasKeys,r=o.merge,e=n(134).Filters.AfterEventsFilter,i(t,function(){return function(t){function FollowerBase(){return FollowerBase.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(FollowerBase,n(695)),FollowerBase.abstractClass(),FollowerBase.prototype.getFollowerForChannelTopicResponse=function(t){var e;return this.get(t,{key:e=this.toKeyObject(t.data),data:e,returnNullIfMissing:!0}).then(function(t){return t||e})},FollowerBase.prototype.decreaseFollowingCount=function(t,e){return this.getFollowerForChannelTopicResponse(t).then((n=this,function(e){var i;if(null!=e.followingCount)return n.update(t,{props:{key:i=n.toKeyObject(e),data:i,add:{followingCount:-1}}}).then(function(e){if(e.followingCount<=0)return n.delete(t,{props:{key:i,conditionExpression:{followingCount:{lte:0}}}}).catch(function(t){var e,n;if(!(null!=t&&null!=(e=t.info)&&null!=(n=e.response)?n.isMissing:void 0))throw t})}).catch(function(t){var e;if(!(null!=t&&null!=(e=t.message)&&"function"==typeof e.match?e.match(/ConditionalCheckFailedException/):void 0))throw t})}));var n},FollowerBase.prototype.increaseFollowingCount=function(t){return this.getFollowerForChannelTopicResponse(t).then((n=this,function(i){var o;return n.update(t,{props:{key:o=n.toKeyObject(i),data:o,add:{followingCount:1},setDefault:{createdAt:s(Date.now())+.5|0},createOk:!0}}).then(function(i){if(1===i.followingCount)return e.sendEvents(t.createSubRequest(n.pipelineName,"create").success({data:r(o,{followingCount:1})}))})}));var n},FollowerBase}()})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Neptune","Pipeline","merge","Error","Promise","binary","present","peek","console","inspect","cryptoRandomString"],[e,n(651)],(t,e,n,r,o,s,a,l,u,c,h)=>{let p;return({S3:p}=t.Art.Aws),i.defClass(class ImageStore extends e{},function(t,e,d){this.prototype.put=function(t){let e,a,l,u;if(({data:e,imageData:a,bitmap:l,onImagePutPropsReady:u}=t),t=n(t,{data:e||a}),!e&&!l)throw new r("options.data required");return this._getImagePutProps(t).then(e=>{let a,l,c,h,d,f,m,g,y,v,S,b;if(!e.data)throw new r("data required");return i.isF(u)&&u(e),({templateData:a,onProgress:l}=t),c=a?0:1,h=0,a&&(d=this._getTemplatePutProps(e,t)),f=null,m=null,g=null,y=null,v={imageUploadRequest:null,templateUploadRequest:null,abort:()=>(i.isF(m)&&m(),i.isF(f)&&f())},S=l?()=>l(n({progress:a?.5*h+.5*c:h},v)):()=>{},b={bucket:"expiringUploads",headers:{"x-amz-grant-full-control":"uri=http://acs.amazonaws.com/groups/global/AllUsers"}},o.all([p.put(n(b,e,{onProgress:({progress:t,abort:e,options:n})=>(m=e,v.imageUploadRequest=n,h=t,S())})),a&&p.put(n(b,d,{onProgress:({progress:t,abort:e,options:n})=>(f=e,v.templateUploadRequest=n,c=t,S())}))]).then(([r,o])=>n(t,{url:r.location,templateUrl:i.exists(o)&&o.location,imageData:s(e.data),mimeType:e.mimeType}))})},this.prototype.delete=function(t){return p.delete(t)},this.prototype._getTemplatePutProps=function(t,e){let n,i;return({objectName:n}=t),({templateData:i}=e),{objectName:n.replace(/\.[a-z]+$/,".kimi"),data:i,mimeType:"application/octet-stream",extension:"kimi"}},this.prototype._getImagePutProps=function(t){let e,n,s,p;return({mimeType:e,name:n,data:s,bitmap:p}=t),o.then(()=>{let o,h;return p&&!s?p.autoEncode():(e||n||(()=>{throw new r("mimeType, name or data-as-bitmap required")})(),a(e)||(e=(()=>{switch(l(n.split(".")).toLowerCase()){case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png"}})()),o=(()=>{switch(e){case"image/png":return"png";case"image/jpeg":return"jpeg";default:return u.error(h=`unsupported mimeType: ${i.toString(c(t))}`),null}})(),{mimeType:e,extension:o,data:s})}).then(t=>(t.objectName=h(16)+"."+t.extension,t))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Promise","pipelines","toSeconds"],[e,n(651)],(t,e,r)=>{return i.defClass(class Notification extends(n(695)){},function(n,o,s){this.globalIndexes({notificationsByUserId:"userId/createdAt"}),this.publicRequestTypes("notificationsByUserId seen"),this.addDatabaseFilters({fields:{post:["link","include"],topic:["link","include"],linkToUser:{include:{link:"user"}},text:"trimmedString",title:"trimmedString",seenAt:"secondsTimestamp",action:{fieldType:"trimmedString",verify:function(t){return!(null!=t)||"topicMembershipAccept"===t}}},userOwned:{userUpdatableFields:["seenAt"]}}),this.filter({name:"privateRecords",before:{notificationsByUserId:function(t){return t.requireServerOriginOr(t.key===t.session.userId)}}}),this.filter({name:"authorization",after:{notificationsByUserId:function(n){return n.withTransformedRecords(r=>{let o,s,a,l,u;return o=r.topicId,s=r.postId,a=r.topic,l=r.post,(null!=o?o:o=(null!=(u=i.exists(a)&&a.id)?u:i.exists(l)&&l.topicId)||(null!=s?s:s=i.exists(l)&&l.id))?t.then(()=>o||n.cachedGet("post",s).then(t=>t.topicId)).then(t=>e.topic.canView(n,t)).then(t=>t?r:void 0):r})}}}),this.handlers({seen:function(t){return this.requireServerOriginOrOwner(t).then(()=>t.subrequest("notification","update",{key:t.key,originatedOnServer:t.originatedOnServer,data:{seenAt:0|r()}}))}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z={}.hasOwnProperty;k=n(651),T=k.present,o=k.caption,k.compact,e=k.Promise,A=k.round,S=k.log,w=k.merge,k.array,y=k.isNumber,v=k.isString,g=k.isArray,k.isPlainObject,a=k.defineModule,R=k.withSort,s=k.compare,b=k.max,P=k.object,C=k.objectWithout,F=k.toPlainObjects,M=k.rgbColor,m=k.hslColor,_=k.pipelines,k.missing,B=k.toSeconds,T=k.present,k.getColorPaletteFromBitmap,k.getExpiringUploadsUrlForFile,h=k.getMediaUrlForFile,c=k.getFileFromUrl,k.defaultPostPalette,k.getColorPaletteFromColorInfo,k.packColorMap,p=k.getPostColorInfoFromBitmap,k.hashtagRegexp,k.removeMarkdownCodeBlocks,r=k.bound,k.compactFlatten,x=k.mergeInto,f=k.getShortPostTitle,i=Neptune.Art.Aws.S3,I=n(704),l=I.generateUpdatePostOrdersFromPosts,E=I.postOrderThreshold,d=I.getPostOrders,u=n(106).getArtConfig,a(t,function(t){var a,k,I,O,L;function Post(){return Post.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)z.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Post,n(695)),Post.publicRequestTypes("get create update delete chapterPostsByTopicId postsByTopicId postsByTopicIdDesc prevPostByPostId prevChapterByPostId nextPostByPostId nextChapterByPostId move updatePostOrders"),Post.globalIndexes({postsByTopicId:"topicId/postOrder",chapterPostsByTopicId:"topicId/chapterOrder",partialPostsByUserIdCreatedAt:{key:"userId/createdAt",projection:["topicId"]}}),Post.prototype.getTitleText=f,Post.prototype.getUrlText=f,Post.prototype.canViewPost=k=function(t,n,i){return null==i&&(i=t.session.userId),e.then(function(){return v(n)?t.cachedGetWithoutInclude("post",n):e.resolve(n)}).then(function(e){return e.userId===i||_.topicMembership.getUserHasTopicAccessFromRequest(t,"canView",e.topicId)})},Post.prototype.getRandomProfilePostProps=function(){var t;return{colors:{background:(t=m(Math.random(),1,1)).withHue(t.h-1/3/2).withLightness(.5).toString(),foreground:t.toString()},colorMap:function(){var e,n;for(n=[],e=1;e<=9;++e)n.push(t.withLightness(1-.25*Math.random()).withHue(t.h+Math.random()*(1/3)-1/3/2).toString());return n}()}},Post.prototype.getPrevPosts=function(t,e,n,i){return null==i&&(i=5),this.queryDynamoDbWithRequest(t,{index:"postsByTopicId",where:{topicId:e,postOrder:{lt:n}},descending:!0,limit:r(1,i,100)}).then(function(t){return t.items})},Post.prototype.getNextPosts=function(t,e,n,i){return null==i&&(i=5),this.queryDynamoDbWithRequest(t,{index:"postsByTopicId",where:{topicId:e,postOrder:{gt:n}},limit:r(1,i,100)}).then(function(t){return t.items})},Post.query({prevPostByPostId:{query:function(t){var e,n;return e=t.key,t.cachedGetWithoutInclude("post",e).then((n=this,function(e){var i,r;return r=e.topicId,i=e.postOrder,n.getPrevPosts(t,r,i,1)})).then(function(e){var n;return n=e[0],t.success({data:n})})},dataToKeyString:function(t){return t.id}},nextPostByPostId:{query:function(t){var e,n;return e=t.key,t.cachedGetWithoutInclude("post",e).then((n=this,function(e){var i,r;return r=e.topicId,i=e.postOrder,n.getNextPosts(t,r,i,1)})).then(function(e){var n;return n=e[0],t.success({data:n})})},dataToKeyString:function(t){return t.id}},prevChapterByPostId:{query:function(t){var e,n;return e=t.key,t.cachedGetWithoutInclude("post",e).then((n=this,function(e){var i,r;return r=e.topicId,i=e.postOrder,n.queryDynamoDbWithRequest(t,{index:"chapterPostsByTopicId",where:{topicId:r,chapterOrder:{lt:i}},descending:!0,limit:1})})).then(function(e){var n;return n=e.items,t.success({data:n[0]})})},dataToKeyString:function(t){return t.id}},nextChapterByPostId:{query:function(t){var e,n;return e=t.key,t.cachedGetWithoutInclude("post",e).then((n=this,function(e){var i,r;return r=e.topicId,i=e.postOrder,n.queryDynamoDbWithRequest(t,{index:"chapterPostsByTopicId",where:{topicId:r,chapterOrder:{gt:i}},limit:1})})).then(function(e){var n;return n=e.items,t.success({data:n[0]})})},dataToKeyString:function(t){return t.id}},allPosts:{query:function(t){return t.pipeline.scanDynamoDb().then(function(t){var e;return e=t.items,R(e,function(t,e){return s(e.createdAt,t.createdAt)})})},dataToKeyString:function(){return"all"}}}),Post.aliases("chapterPost"),Post.filter({name:"createComputedFields",before:{create:function(t){var e,n,i,r,o,s;return n=(s=t.data).createdAt,o=s.postOrder,e=s.chapterOrder,i=s.isChapterStart,r=s.lastActivityAt,t.withData(w({postOrder:B(null!=o?o:n),lastActivityAt:b(0|r,n),chapterOrder:i?B(null!=e?e:n):void 0},t.data))}}}),Post.addDatabaseFilters({fields:{topic:"link autoCreate required",mediaFile:"trimmedString",mediaCreatedAt:"secondsTimestamp",mediaByteLength:"number",colorMap:{fieldType:"trimmedString",validate:function(t){return!t||v(t)&&t.match(/^[a-f0-9]{54}$/)||g(t)&&9===t.length},preprocess:function(t){var e;return g(t)?function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(M(e).rawHexString);return r}().join(""):t}},dimensions:{fields:{x:"required number",y:"required number"}},templateFile:"trimmedString",templateByteLength:"number",templateDropInCount:"number",templateText:"trimmedString",templateDropInLocations:"array",templateUseCount:"number",focus:{fields:{x:"number",y:"number"},preprocess:function(t){var e,n;if(t)return e=t.x,n=t.y,{x:A(e,.001),y:A(n,.001)}}},colors:{fields:{foreground:"color",background:"color"}},caption:{fieldType:"trimmedString",maxLength:25e3},chapterTitle:{fieldType:"trimmedString",maxLength:40},chapterOrder:"fractionalSecondsTimestamp",postOrder:"fractionalSecondsTimestamp",isChapterStart:"boolean",isCoverPhoto:"boolean",activityCount:"count",messageCount:"count",participantCount:{fieldType:"number",default:1},lastActivityAt:"secondsTimestamp",lastActiveUser:{link:"user"},lastMessage:{link:"message"},templatePost:{link:"post"},templateAuthor:{link:"user"}},userOwned:{publicFields:!0,userCreatableFields:"caption mediaFile mediaCreatedAt mediaByteLength colorMap dimensions templateFile templateByteLength templateDropInCount templateText templateDropInLocations bitmap colors focus topic topicId isChapterStart isCoverPhoto chapterTitle templatePostId templateAuthorId postOrder chapterOrder",userUpdatableFields:"caption mediaFile mediaCreatedAt mediaByteLength dimensions colorMap focus colors isChapterStart isCoverPhoto chapterTitle postOrder chapterOrder",requireUserCanUpdate:a=function(t,e,n){return e.userId===t.session.userId?t:_.topicMembership.requireCanAdmin(t,e.topicId)},requireUserCanDelete:a}}),Post.filter({name:"firstPost",before:{create:function(t){return t.data.topic&&!t.data.topic.id?t.withMergedData({isChapterStart:!0}):t}}}),Post.filter({name:"updateChapterOrder",before:{update:function(t){return t.data.hasOwnProperty("isChapterStart")?(t.data.isChapterStart?t.cachedGetWithoutInclude("post",t.key).then(function(t){return t.createdAt}):e.resolve(null)).then(function(e){return t.withMergedData({chapterOrder:e})}):t}}}),Post.filter({name:"createTopicWithoutNeedingUpdateAfter",before:{create:function(t){var e,n,i,r,o;return n=t.data,r=t.props,(null!=n?n.topic:void 0)&&!n.topic.id?(i=n.id,e=n.createdAt,o=n.topic,t.with({props:w(r,{preventUpdateTopicAfterPostCreate:!0,data:w(n,{topic:w(o,{postCount:1,lastPostCreatedAt:e,lastPostId:i,lastChapterPostId:i})})})})):t}}}),Post.filter(n(705)),Post.updateAfter({delete:{postParticipant:function(t){return{key:t.data.postId,add:{participantCount:-1}}},message:function(t){var e,n;return e=(n=t.data).createdAt,{key:n.postId,add:{activityCount:-1,messageCount:-1},data:{lastActivityAt:e}}}},create:{postParticipant:function(t){var e,n,i;if(i=(n=t.rootRequest).requestType,e=n.pipelineName,"create"!==i||"post"!==e)return{key:t.data.postId,add:{participantCount:1}}},message:function(t){var e,n;return e=(n=t.data).createdAt,{key:n.postId,add:{activityCount:1,messageCount:1},data:{lastActivityAt:e,lastActiveUserId:n.userId,lastMessageId:n.id}}},post:function(t){var e;if((e=t.data.templatePostId)&&!t.requestProps.migration)return{key:e,add:{templateUseCount:1}}}}}),Post.filter(n(706)),I=function(t){var e;return e=u().Art.Aws.s3Buckets,i.copy({key:t,fromBucket:e.expiringUploads,toBucket:e.media,params:{GrantRead:"uri=http://acs.amazonaws.com/groups/global/AllUsers"}})},Post.filter({name:"copy-files",before:{create:function(t){var n,i,r;return i=t.data,n=i.mediaFile,r=i.templateFile,e.then(function(){if(n&&("testFile.jpg"!==n||"Test"!==Neptune.Art.Config.configName))return e.all([I(n),r?I(r):void 0])}).then(function(){return t})},update:function(t){return e.then((n=this,function(){var i,r;if(i=null!=(r=t.data)?r.mediaFile:void 0)return t.cachedGet("post",t.key).then(function(t){var r;if((r=t.mediaFile)!==i)return e.all([I(i),n.pipelines.imageStore.delete(h(r))])})})).then(function(){return t});var n}}}),Post.filter({name:"delete-assets",after:{delete:function(t){var n,i,r;return n=(i=t.data).mediaFile,r=i.templateFile,e.all([n&&this.pipelines.imageStore.delete(h(n)),r&&this.pipelines.imageStore.delete(h(r))]).then(function(){return t})}}}),Post.prototype.getPostsNeedingInlineMediaUpdates=function(){return this.getAll({originatedOnServer:!0}).then(function(t){var e;return function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)(e=t[n]).colors&&v(e.mediaFile)||r.push(e);return r}()})},Post.filter({name:"validateNewPostContents",before:{create:function(t){var e,n,i,r,s,a,l;return t.data&&(a=t.data,o=a.caption,n=a.colors,s=a.mediaFile,r=a.mediaByteLength,e=a.colorMap,i=a.dimensions,l=a.topicId),t.require(s||T(o)||e,"caption OR mediaFile OR colorMap").then(function(){return s?t.require(null!=r&&null!=i&&null!=e,"mediaByteLength and dimensions"):t.require(T(l)||e&&n,"text-only: Must not be first post unless there is a colorMap and colors.")})}}}),Post.prototype.preprocessMedia=O=function(t){return t?e.then(function(){var e,n;return n=t.imageData,!(e=t.bitmap)&&n?Neptune.Art.Canvas.Bitmap.get(n).then(function(e){return w(t,{bitmap:e})}):e&&!n?e.toJpg().then(function(e){return w(t,{imageData:e,mimeType:"image/jpeg"})}):t}).then(function(t){var e,n,i;return(e=t.bitmap)?(i=t.templateData,n=t.imageData,_.imageStore.put({bitmap:e,imageData:n,templateData:i,mimeType:t.mimeType}).then(function(n){var r,o,s;return s=n.url,o=n.templateUrl,r=n.imageData,w(C(t,"mimeType","bitmap","imageData","templateData"),F(w({mediaFile:c(s),mediaByteLength:r.length,templateFile:c(o),templateByteLength:null!=i?i.length:void 0,dimensions:e.size},p(e))))})):P(t)}):e.resolve(null)},Post.filter({location:"client",name:"upload-files",before:{create:L=function(t){return O(t.data).then(function(e){return t.withData(e)})},update:L}}),Post.filter({name:"preventDeletingFirstPostIfSecondHasNoImage",before:{delete:function(t){var n,i,r,o;return(n=t.parentRequest)&&(o=n.type,i=n.pipelineName,"delete"===o&&"topic"===i)?t:(r=t.key,e.all([t.subrequest("post","prevPostByPostId",r),t.subrequest("post","nextPostByPostId",r)]).then(function(e){var n,i;return i=e[0],n=e[1],t.require(i||!n||(null!=n?n.mediaFile:void 0),"Cannot delete first post if next post doesn't have an image.")}))}}}),Post.filter({name:"normalizeDateFields",before:{all:function(t){var e,n,i,r,o,s;return"create"===t.type||"update"===t.type?(n=(o=t.data).createdAt,s=o.updatedAt,i=o.lastActivityAt,r=o.postOrder,e=o.chapterOrder,t.withMergedData({createdAt:n&&B(n),updatedAt:s&&B(s),lastActivityAt:i&&B(i),postOrder:r&&B(r),chapterOrder:e&&B(e)})):t}}}),Post.filter(n(707)),Post.prototype.getConnonicalUrlAsync=function(t,n){return e.then(function(){return v(t)?_.post.get(t):t}).then(function(t){return e.then(function(){var e;return!(e=null!=n?n.topic:void 0)||e.private&&!T(e.sharePassword)?_.topic.getPrivateSharePassword({key:t.topicId,returnNullIfMissing:!0}):e.private&&e.sharePassword}).then(function(e){return _.post.getConnonicalUrl(t,w({params:e&&{sharePassword:e}},n))})})},Post.filter(n(708).LogCreateEventFilter),x(Post.prototype,n(704)),Post.handlers({canView:function(t){return k(t,t.key)},updatePostOrdersFromPosts:function(){throw new Error("client-side only")},updatePostOrders:function(t){var n,i,r,o,s,a,l,u,c;return l=t.props,o=l.keys,n=l.afterPostOrder,r=l.beforePostOrder,y(n)||(n=null),y(r)||(r=null),u=a=null,s=!0,i=!0,c=t.session.userId,t.require(null!=n||null!=r,"afterPostOrder or beforePostOrder or both required").then(function(){return t.require(g(o)&&o.length>0&&o.length<=100,"keys must be an array: 0 < length <= 100")}).then(function(){if(null!=n&&null!=r)return t.require(n<r,"afterPostOrder must be strictly < beforePostOrder").then(function(){return t.require(E<(r-n)/o.length,"((beforePostOrder:"+r+" - afterPostOrder:"+n+") / keys.length:"+o.length+") > "+E)})}).then(function(){var n;return e.all(function(){var e,i,r;for(r=[],e=0,i=o.length;e<i;e++)n=o[e],r.push(t.cachedGet("post",n));return r}()).then(function(t){var e;return a=t,e=t[0],u=e.topicId,e})}).then(function(){var e,n,r;for(e=0,n=a.length;e<n;e++)(r=a[e]).topicId!==u&&(i=!1),r.userId!==c&&(s=!1);return t.require(i,"all posts must be in the same topic")}).then(function(){return t.requireServerOriginOr(s||_.topicMembership.canAdmin(t,u),"must be owner of all posts, owner of topic, or topic admin")}).then(function(){var i,s,l,u,c,h,p,f;for(i={},l=0,c=a.length;l<c;l++)(h=a[l]).isChapterStart&&(i[h.id]=h);return f=d(a.length,n,r),e.all(function(){var e,n,r;for(r=[],s=e=0,n=o.length;e<n;s=++e)u=o[s],r.push(_.post.update(t,{key:u,data:w({postOrder:p=f[s]},i[u]?{chapterOrder:p}:void 0)}));return r}())}).tap(function(){return _.topic.updateComputedPostFields(t,{props:{include:!1,key:u}})})},move:function(t){var n,i,r,o,s,a;return o=t.props,r=o.keys,a=o.toTopicId,i=null,n=s=null,t.requiredFields({keys:r,toTopicId:a}).then(function(){var n;return e.all(function(){var e,i,o;for(o=[],e=0,i=r.length;e<i;e++)n=r[e],o.push(t.cachedGet("post",n));return o}())}).tap(function(e){var n,r;for(i=e[0].topicId,n=0,r=e.length;n<r;n++)if(e[n].topicId!==i)return t.rejectWithClientFailure("All posts must be from the same topic.");if(i===a)return t.rejectWithClientFailure("Nothing to do. props.toTopic == post.topicId")}).tap(function(){return e.all([t.subrequest("topic","get",{key:i,props:{include:!1}}),t.subrequest("topic","get",{key:a,props:{include:!1}})]).then(function(e){return n=e[0],s=e[1],t.requireServerOriginOr(n.userId===s.userId&&n.userId===t.session.userId,"must be owner of both To and From topics")})}).tap(function(n){var i,o,l;return l=d(r.length,s.lastPostCreatedAt),e.all(function(){var e,n,s;for(s=[],i=e=0,n=r.length;e<n;i=++e)o=r[i],s.push(t.subrequest("post","update",{key:o,data:{topicId:a,postOrder:l[i]}}));return s}())}).finally(function(){return e.all([t.subrequest("topic","updateComputedPostFields",{props:{include:!1,key:i}}),t.subrequest("topic","updateComputedPostFields",{props:{include:!1,key:a}})]).then(function(t){return n=t[0],s=t[1],t})}).then(function(){return{fromTopic:n,toTopic:s}})}}),Post.prototype.updatePostOrdersFromPosts=function(t){var e,n,i,r;if(n=t.posts,r=t.selectedPostIds,e=t.afterPost,i=l({posts:n,selectedPostIds:r,afterPost:e}))return this.updatePostOrders({props:i})},Post.filter({name:"afterPostId",before:{create:function(t){var e;return(e=t.props.afterPostId)?t.cachedGet("post",e).then(function(e){return _.post.getNextPosts(t,e.topicId,e.postOrder,1).then(function(n){var i,r,o,s,a;return o=null!=(a=null!=(r=n[0])?r.postOrder:void 0)?a:0|B(),i=e.postOrder,S({afterPostOrder:i,beforePostOrder:o}),o<i&&(o=i+2),(s=(o+i)/2)-i>1&&(s|=0),t.withMergedData({postOrder:s})})}):t}}}),Post.filter({name:"authorization",before:{create:function(t){return t.data.topicId?_.topicMembership.requireTopicMembershipAccess(t,"canPost"):t}}}),Post.filter({name:"maxPostsPerTime",before:{create:function(t){return _.recentPost.requireCanPost(t)}}}),Post}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["mergeInto","Array","toSeconds","Error","compactFlatten","neq","peek","secondsPer"],[e,n(651)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class PostPipelineLib extends Object{},function(u,c,h){let p,d,f,m,g;t(this,{postOrderThreshold:p=1e-6,roundPostOrdersUnique:d=function(t,n,r){let o,s,a;for(o=0,s=!1,a=new e(t.length);!s&&o<=10;){let e;e=n,s=!0,i.each2(t,(t,n)=>{let i;return i=t.toFixed(o)-0,e<i&&i<r||(s=!1),a[n]=e=i}),o++}return s?a:t},getPostOrders:f=function(t,e,i){let r,o,s,a,l,u;return null!=i||(i=n()),r=null!=e&&null!=i?(i-e)/(t+1):3600,o=null!=e?e+r:i-r*t,r>2&&(o|=0,r|=0),d((s=[],u=(l=0)<(a=t)?1:-1,(()=>{for(;u>0&&l<a||u<0&&l>a;){let t;t=l,s.push(o+t*r),l+=u}})(),s),e,i)},posterOrderUpdateIsSafe:m=function({beforePostOrder:t,afterPostOrder:e,postCount:n}){return(t-e)/n>1e-6},generateUpdatePostOrdersFromPosts:g=function({posts:t,selectedPostIds:e,afterPost:n}){let u,c,h,p,d,f,g,y,v,S,b,w,x,P,C,_,E,T,k,I;if(i.in(i.exists(n)&&n.id,e))throw new r("afterPost is in selectedPostIds");if(u=i.array(t,null,t=>!i.in(t.id,e)),c=i.array(u,({id:t})=>t),n&&!i.in(n.id,c))throw new r("afterPost is NOT in posts");return h=n?(w=[],null!=(b=u)&&(x=b.length-1,(()=>{for(;x>=0;){let t;(t=b[x]).postOrder>n.postOrder&&w.push(t),P=x--}})()),p=w,d=i.array(u,null,t=>t.postOrder<=n.postOrder),f=c.indexOf(i.exists(n)&&n.id),o([c.slice(0,f+1),e,c.slice(f+1,c.length)])):(_=[],null!=(C=t)&&(E=C.length-1,(()=>{for(;E>=0;){let t;t=C[E],_.push(t),T=E--}})()),p=_,n=[],o([e,c])),s(h,i.array(t,({id:t})=>t))?(g=i.exists(k=a(d))&&k.postOrder,y=i.exists(I=a(p))&&I.postOrder,null==g&&null==y&&(()=>{throw new r("could not determine post order")})(),v=(1+e.length)*l.minute,null!=g||(g=y-v),null!=y||(y=g+v),S=5,(()=>{for(;!(0===S||e.length<=98&&m({beforePostOrder:y,afterPostOrder:g,postCount:e.length}));){let t,r,s,l;S--,e=o([i.exists(t=d.pop())&&t.id,e,i.exists(r=p.pop())&&r.id]),g=i.exists(s=a(n))&&s.postOrder,y=i.exists(l=a(p))&&l.postOrder,null==g&&null==y&&(g=0),null!=g||(g=y-v),null!=y||(y=g+v)}})(),{keys:e,afterPostOrder:g,beforePostOrder:y}):void 0}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s={}.hasOwnProperty;n(42).log,n(141).missing,i=(o=n(134)).Filter,r=o.pipelines,t.exports=function(t){function PostPrivacyFilter(){return PostPrivacyFilter.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PostPrivacyFilter,i),PostPrivacyFilter.location("server"),PostPrivacyFilter.after({all:function(t){var e;return t.originatedOnServer?t:(e=t.session.userId,t.withTransformedRecords({when:function(t){return t.topicId&&t.userId!==e},with:function(e){return r.post.canViewPost(t,e).then(function(n){return n?e:t.clientFailureNotAuthorized({props:{}})})}}))}}),PostPrivacyFilter}()},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Filter","preprocessPost"],[e,n(651)],(t,e)=>{return i.defClass(class PostTagsFilter extends t{},function(t,n,i){this.location("server"),this.after({all:function(t){return t.withTransformedRecords(e)}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s,a,l,u={}.hasOwnProperty;(a=n(42)).present,a.log,r=a.getEnv,o=a.isString,n(141).missing,i=(l=n(134)).Filter,s=l.pipelines,t.exports=function(t){function SharePasswordFilter(){return SharePasswordFilter.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(SharePasswordFilter,i),SharePasswordFilter.location("client"),SharePasswordFilter.before({all:function(t){var e,n,i;return n=(e=r()).sharePassword,e.streamInvite,e.stream,e.secret,o(n)&&n.length<64?t.withMergedProps({sharePassword:n}):(i=s.topicInviteLink.getTopicInviteLinkIdFromEnv())?t.withMergedProps({topicInviteLinkId:i}):t}}),SharePasswordFilter}()},function(t,e,n){(t.exports=n(278)).addModules({Event:n(709),EventCluster:n(713),EventLocalStore:n(711),EventLog:n(712),LogCreateEventFilter:n(714),StandardImport:n(710)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","log","timeout","isNode","Pipeline","objectKeyCount","formattedInspect","merge","Object","Neptune","lowerCase","Promise","isError","isString","present","console","setTimeout","Error","EventLocalStore","toSeconds","isFunction","lowerCamelCase","objectWithout","firstOfHour"],[e,n(710),{EventLocalStore:n(711)}],(t,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E)=>{let T,k,I,M,A,F,B,R,z,O,L,D,N,U;return({normalizeEventData:T}=n(712)),({logEvents:k,dev:I}=t()),M=k?r:function(){},A=!0,F=k?function(t,e){let n,o,s;return({data:n,key:o}=t),n&&(s=l(n))>0?r("verbose"===k?u({Event:c({event:o,data:n,context:e})}):(A&&(A=!1,r.warn("Event Pipeline NOTE: use ?logEvents=verbose to log event property details")),`Event: ${i.toString(o)} (${i.toString(h.keys(n).join(", "))}) ${i.toString(null!=e?e:"")}`)):r(`Event: ${i.toString(o)} ${i.toString(null!=e?e:"")}`)}:function(){},B=!1,o(100,R=function(){let t;return e.Honeybadger&&!B?(B=!0,e.Honeybadger.configure(t={revision:p.Imikimi.Oz.version,environment:d(p.Art.Config.configName)}),r({honeyBadgerConfigured:t})):void 0}),z=!0,O=function(t){return f.then(()=>{let n;return R(),i.exists(n=e.Honeybadger)&&i.isF(n.notify)&&n.notify(t)}).catch(()=>null)},L=function(t,e){return f.then(()=>{let n,o,s,a,l,h,d,f,v,S,b;return n=m(e)?(({message:o,description:s,filename:a,fileName:l,lineNumber:h,lineno:d,stack:f}=e),null!=a||(a=l),null!=o||(o=s),null!=h||(h=d),!a&&(v=i.exists(f)&&i.isF(f.match)&&f.match(/([-:.\/\\_a-z0-9<>]+)(:\d+:\d+)\b/i))&&([S,a,h]=v),{message:o,filename:a,lineNumber:h}):g(e)?{message:e}:{message:u(e)},b=`client:error:${i.toString(t)}`,n=c(n,{version:p.Imikimi.Oz.version}),n=i.object(n,null,t=>y(t)),I?r({logErrorEvent:{lettingHoneyBadgerHandleIt:{key:b,data:n}}}):void 0}).catch(()=>null)},s||(D=function(){let t,n;return e.addEventListener("error",t=(({error:t})=>L("unhandledException",t))),e.addEventListener("unhandledrejection",n=(t=>(e.unhandledRejectionEvent=t,f.then(()=>{let e,n,r,o;return t.detail&&(({Error:e,error:n,reason:r,promise:o}=t.detail),null!=n||(n=e)),(null!=n?n:n=i.exists(r)&&r.message&&r)?n:o?o.catch(t=>t):r?{name:"unhandledRejection fallback1",message:u({reason:r})}:{name:"unhandledRejection fallback2",message:u({detail:t.detail})}}).then(t=>(L("unhandledRejection",t),O(t),null)).catch(t=>(v.error("ERROR IN unhandledrejection ERROR HANDLER"),v.error(t),null))))),e.testException=(()=>S(()=>(()=>{throw new b("test exception")})(),0)),e.testRejection=(()=>f.then(()=>(()=>{throw new b("test rejection")})()))})(),N=null,U=/^\/([a-z]+)/i,i.defClass(class Event extends a{},function(t,n,o){let s,a,l,u,p,d,m;this.publicRequestTypes("create","userChanged","pageChanged"),this.prototype.toEventHierachy=function(t){let e;return e={},i.each2(t,(t,n)=>{let r,o;return r=e,o=n.split(":"),i.each2(o,(e,n)=>{let i;return r=null!=(i=r[e])?i:r[e]=n===o.length-1?t:{}})}),e},this.prototype.flattenEventHierarchy=s=function(t,e="",n={}){return i.each2(t,(t,r)=>i.is(t,h)?s(t,e+r+":",n):n[e+r]=t),n},this.prototype.EventLocalStore=w,this.prototype.eventRegexp=a=/^(?:([^:]+)?:)?([^\/]*)(?:\/(.+)?)?$/,l={},u={},p=x(),this.prototype.createError=function(t){return O(t)},this.filter({location:"client",name:"handledClientSide",before:{pageChanged:function(){return!0},userChanged:function(){return!0}}}),this.filter({location:"client",name:"googleAnalytics",before:{create:function(t){let n,i,r,o,s,l,u;return({gtag:n}=e),P(n)&&(({key:i,data:r}=t),[o,s,l,u]=i.match(a),n("event",l,{event_category:s,event_label:u})),t}}}),d=function(t){return i.array(t.split(":"),t=>C(t)).join(":")},this.filter({location:"client",name:"lastEventAt",before:{create:function(t){let e,n;return({eventAt:e}=t.props),n=t.key,F(t),w.updateForEvent(n,e).then(e=>t.withMergedProps(e))}}}),this.filter({location:"client",name:"Honeybadger",before:{userChanged:function(t){let n,r;return i.exists(n=e.Honeybadger)&&n.setContext({user_id:i.exists(r=t.data)&&r.id}),t}}}),this.filter({location:"client",name:"EventClientStoreUpdater",before:{userChanged:function(t){return w.get().then(({userId:e})=>{let n,r;return(n=i.exists(r=t.data)&&r.id)||(n=void 0),e||(e=void 0),e!==n?(null!=n?null!=e?w.reset({userId:n}):w.set({userId:n}):w.reset(),w.logSessionStart()):void 0}).then(()=>t)}}}),this.filter({location:"client",name:"oncePerHour",before:{create:function(t){return t.props.oncePerHour?(x()>p+3600&&(u={}),u[t.key]?(F(t,"(oncePerHour)"),t.success()):(u[t.key]=!0,t)):t}}}),this.filter({location:"client",name:"createAlwaysSucceeds",filterFailures:!0,after:{create:function(t){return t.failed&&r({FAILED:t}),t.success()}}}),this.prototype.disableEvents=function(){return z=!1},this.filter({location:"client",name:"normalizeEvent",before:{create:m=function(t){let e,n;return z?(({key:e,data:n}=t),t.require(a.test(e),`bad key: ${i.toString(e)} ${i.toString(a)}`).then(()=>t.withMergedProps({key:d(e),data:T(n)}))):t.failure()}}}),this.filter({location:"server",name:"normalizeEvent",before:{create:m,createServerEvent:m}}),this.handler({create:function(t){let e,n,o,s,a,l,u,h,p;return({key:e,eventAt:n,data:o,lastActivityAt:s,lastEventAt:a,returnDetails:l,clientId:u,sessionId:h,userId:p}=t.props),!u||t.requireServerOriginIf(null!=n,"to pass eventAt").then(()=>t.requiredFields({key:e})).then(()=>{let d,m;return d=e,null!=p||(p=t.session.userId),null!=n||(n=x()),i.exists(o)&&o.user&&(o=_(o,"user")),m=f.all([t.subrequest("eventCluster","increment",{data:{eventAt:n,cluster:E(n),event:"hourly:"+d}}),t.subrequest("eventCluster","uniqueIncrement",{data:{eventAt:n,event:d,lastEventAt:a}}),t.subrequest("eventCluster","uniqueIncrement",{data:{eventAt:n,event:"anyEvent",lastEventAt:s}}),t.subrequest("eventLog","create",{data:c(o,{clientId:u,sessionId:h,event:d,userId:p})})]).tapCatch(t=>(r({event:{create:{error:t}}}),{failed:t.messsage})),!l||m.then(([t,e,n,i])=>l?{increment:t,uniqueIncrement:e,uniqueIncrementAnyEvent:n,eventLog:i}:void 0)})},createServerEvent:function(t){return F(t),t.requireServerOrigin().then(()=>t.requiredFields({key:t.key})).then(()=>{let e,n,i;return e=t.key,n=t.data,i=0|x(),f.all([t.subrequest("eventCluster","increment",{data:{eventAt:i,cluster:E(i),event:"hourly:"+e}}),t.subrequest("eventLog","create",{data:c(n,{eventAt:i,event:e})})]),!0})},userChanged:function(){},pageChanged:function(){}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=n(651)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["JsonStore","merge","timeout","pipelines","objectWithout","Browser","toSeconds","cryptoRandomString"],[e,n(710),n(160)],(t,e,n,r,o,s,a,l)=>{let u,c;return u=t.jsonStore,c="imikimiZoClientEventSession",i.defClass(class EventLocalStore extends Object{},function(t,c,h){let p;this.clientEventSessionIdleTimeout=p=3600,this.testModeCurrentTime=null,this.get=(()=>this._getRaw().then(t=>!t||this._sessionExpired(i.exists(t)&&t.lastEventTimes.anyEvent)?this.reset():t)),this.set=(t=>this._getRaw().then((n={})=>this._updateStore(e(n,t)))),this.reset=(t=>this._getRaw().then(n=>this._updateStore(e(this._create(n),t)))),this._updateStore=function(t){return u.setItem("imikimiZoClientEventSession",t).then(()=>t)},this.logSessionStart=function(){return n(10,()=>this.get().then(({sessionId:t})=>r.event.create({key:"sessionStart",data:e(o(s.simpleBrowserInfo,"pixelsPerPoint"),{sessionStartId:t})})))},this.updateForEvent=((e,n)=>this.get().then(({lastEventTimes:i,clientId:r,sessionId:o,userId:s})=>{let l,u;return l=i.anyEvent,u=i[e],i.anyEvent=i[e]=a(n),t.set({lastEventTimes:i}).then(()=>({lastActivityAt:l,lastEventAt:u,clientId:r,sessionId:o,userId:s}))})),this._sessionExpired=function(t,e=this.testModeCurrentTime){return t?t+3600<a(e):void 0},this._create=function(t){let e;return{clientId:null!=(e=i.exists(t)&&t.clientId)?e:l(10),sessionId:l(10),lastEventTimes:{}}},this._getRaw=function(){return u.getItem("imikimiZoClientEventSession")}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["secondsPer","DynamoDbPipeline","UniqueIdFilter","isObject","String","present","Number","Boolean","Date","Object","lowerCamelCase","toSeconds","log","merge"],[e,n(710)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m)=>{let g;return g=45*t.day,i.defClass(class EventLog extends e{},function(t,e,y){let v,S;this.getter({tableName:function(){return this.getPrefixedTableName("eventLog2")}}),this.publicRequestTypes("eventLogsBySessionIdCreatedAt eventLogsBySessionIdCreatedAtDesc eventLogsByClientIdCreatedAt eventLogsByClientIdCreatedAtDesc eventLogsByAddressCreatedAt eventLogsByAddressCreatedAtDesc eventLogsByEventCreatedAt eventLogsByEventCreatedAtDesc eventLogsByUserIdSessionStartId eventLogsByUserIdSessionStartIdDesc eventLogsByClientIdSessionStartId eventLogsByClientIdSessionStartIdDesc finalizeSession get batchGet"),this.globalIndexes({eventLogsByEventCreatedAt:{projection:"keysOnly",key:"event/createdAt"},eventLogsBySessionIdCreatedAt:{projection:"keysOnly",key:"sessionId/createdAt"},eventLogsBySessionIdCreatedAt:{projection:"keysOnly",key:"sessionId/createdAt"},eventLogsByUserIdSessionStartId:{projection:"keysOnly",key:"userId/sessionStartId"},eventLogsByClientIdSessionStartId:{projection:"keysOnly",key:"clientId/sessionStartId"},eventLogsByAddressCreatedAt:{projection:"keysOnly",key:"address/createdAt"}}),this.validEventValue=v=function(t){return null!=t?(()=>{switch(!1){case!o(t):return t.id;case!i.is(t,s):return a(t)?t:void 0;case!i.is(t,l):case!i.is(t,u):case!i.is(t,c):return t}})():void 0},this.normalizeEventData=S=function(t){let e;return i.is(t,h)?i.each2(t,(t,n)=>{let r;return null!=(r=v(t))?(i.is(t,h)&&(n=`${i.toString(n)}Id`),e[p(n)]=r):void 0},null,e={}):{}},this.fields({clientId:"id",sessionId:"id",userId:"id",createdAt:"secondsTimestamp",expiresAt:"secondsTimestamp",event:"string",address:"string",endedAt:"secondsTimestamp",eventCount:"count",sessionStartId:"id"}),this.filter({name:"normalizeData",before:{create:function(t){let e;return e=t.data,t.requiredFields({data:e}).then(()=>t.withData(S(e)))}}}),this.filter({name:"addCreatedAtAndExpiresAt",before:{create:function(t){let e;return t.withMergedData({createdAt:e=0|d(),expiresAt:e+g|0})}}}),this.filter({before:{all:function(t){return t.requireServerOrigin()}}}),this.filter(r),this.handlers({finalizeSession:function(t){return f({finalizeSession:t.key}),t.cachedGet("eventLog",t.key).then(e=>{let r,o;return({sessionId:r,finalized:o}=e),o?e:t.subrequest("eventLog","eventLogsBySessionIdCreatedAtDesc",r).then(r=>{let o,s,a;return s={endedAt:o=i.exists(a=r[0])&&a.createdAt,eventCount:r.length},n(711)._sessionExpired(o)?t.subrequest("eventLog","update",{key:t.key,data:m(s,{finalized:!0})}):m(e,s)})})}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["DynamoDbPipeline","isString","isNumber","Promise","merge","firstOfHour","firstOfDay","firstOfWeek","firstOfMonth","Math","toSeconds"],[e,n(710)],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class EventCluster extends t{},function(t,p,d){let f,m,g,y;this.primaryKey("event/cluster"),this.publicRequestTypes("eventClustersByEvent eventsClusteredByType"),this.fields({count:"count",cluster:"string",event:"string"}),f=/^\d{4}-\d{2}-\d{2}_\d{2}$/,m="allEvents",g=256,y=function(t){return e(t)&&t.length<=256},this.handler({increment:function(t){let i,s,a,l;return({event:i,eventAt:s,cluster:a}=null!=(l=t.props.data)?l:{}),n(a)&&(a=a.toString()),t.require(e(a)&&n(s)&&y(i),"invalid cluster, eventAt or event").then(()=>{let e;return r.all([t.subrequest("eventCluster","createOrUpdate",{props:{key:e={event:i,cluster:a},data:e,add:{count:1}}}),t.subrequest("eventCluster","createOrUpdate",{props:{key:e={event:"allEvents",cluster:i},data:o(e,{updatedAt:s}),setDefault:{createdAt:s},add:{count:1}}})])}).then(([t])=>t)},uniqueIncrement:function(t){let e,o,c,h;return({lastEventAt:e=0,event:o,eventAt:c}=null!=(h=t.props.data)?h:{}),t.require(y(o)&&n(c)&&n(e),`event must be a string <= ${i.toString(256)}; eventAt must be a number; lastEventAt must be a number, if present`).then(()=>{let n,h,p,d;return n=s(c),h=a(c),p=l(c),d=u(c),r.deepAll({hour:e<n?t.subrequest("eventCluster","increment",{data:{eventAt:c,event:`unique:hourly:${i.toString(o)}`,cluster:n}}):void 0,day:e<h?t.subrequest("eventCluster","increment",{data:{eventAt:c,event:`unique:daily:${i.toString(o)}`,cluster:h}}):void 0,week:e<p?t.subrequest("eventCluster","increment",{data:{eventAt:c,event:`unique:weekly:${i.toString(o)}`,cluster:p}}):void 0,month:e<d?t.subrequest("eventCluster","increment",{data:{eventAt:c,event:`unique:monthly:${i.toString(o)}`,cluster:d}}):void 0})})},eventClustersByEvent:function(t){let e,n,i,r;return({key:e,beforeHour:n,afterHour:i,limit:r}=t.props),i&&n&&(null!=r||(r=c.ceil((h(n)-h(i))/3600))),t.requiredFields({event:e}).then(()=>this.queryDynamoDbWithRequest(t,{where:o({event:e,cluster:i?{gte:h(i).toString()}:n?{lte:h(n).toString()}:void 0}),descending:!i,limit:null!=r?r:720})).then(({items:t})=>t)},eventsClusteredByType:function(t){return this.queryDynamoDbWithRequest(t,{where:{event:"allEvents"}}).then(({items:t})=>(t=t.sort((t,e)=>e.count-t.count),i.object(t,({createdAt:t,updatedAt:e,count:n,cluster:i})=>({createdAt:t,updatedAt:e,count:n}),null,null,({createdAt:t,updatedAt:e,count:n,cluster:i})=>i)))}}),this.filter({before:{all:function(t){return t.requireServerOrigin()}}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){var i,r,o,s,a={}.hasOwnProperty;(o=n(42)).upperCamelCase,o.merge,o.uniqueValues,o.compactFlatten,o.object,s=n(134),r=s.pipelines,i=s.Filter,t.exports=function(t){function LogCreateEventFilter(){return LogCreateEventFilter.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(LogCreateEventFilter,i),LogCreateEventFilter.location("client"),LogCreateEventFilter.after({create:function(t){var e;return r.event.create({key:t.pipelineName+":create",data:(e={},e[t.pipelineName+"Id"]=t.data.id,e)}),t}}),LogCreateEventFilter}()},function(t,e,n){(function(t){var e,i,r,o,s={}.hasOwnProperty;(o=n(160)).merge,e=o.CommunicationStatus,o.formattedInspect,o.log,o.isString,i=o.Promise,r=o.defineModule,o.max,e.missing,n(134).pipelines,r(t,function(t){var e;function PostParticipant(){return PostParticipant.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PostParticipant,n(695)),PostParticipant.publicRequestTypes("participantsByUserId participantsByUserIdDesc joinConversation leaveConversation seen"),PostParticipant.primaryKey("postId/userId"),PostParticipant.globalIndexes({participantsByUserId:"userId/lastActivityAt"}),PostParticipant.localIndexes({participantsByPostIdAndUnseenActivityCount:"postId/outdatedCount"}),PostParticipant.addDatabaseFilters({userOwned:!0,fields:{post:{include:{required:{link:"post"}}},topic:{required:{link:"topic"}},lastActiveUser:{include:{link:"user"}},lastMessage:{include:{link:"message"}},activityCount:"count",outdatedCount:"count",lastActivityAt:{fieldType:"secondsTimestamp",default:0},lastSeenActivityCount:{fieldType:"number",default:-1},lastSeenActivityAt:{fieldType:"secondsTimestamp"}}}),PostParticipant.prototype._createOrUpdatePostParticipant=function(t,e){var n,i,r,o;return o=e.userId,i=e.postId,r=e.updateOnly,n=e.createOnly,t.cachedGet("post",i).then(function(e){var s,a,l,u,c,h;return h=e.topicId,l=e.lastActivityAt,a=e.lastActiveUserId,s=e.activityCount,u=e.lastMessageId,c=r?"update":n?"create":"createOrUpdate",t.subrequest("postParticipant",c,{returnNullIfMissing:r,key:{postId:i,userId:o},data:{postId:i,userId:o,topicId:h,lastActivityAt:l,lastActiveUserId:a,activityCount:s,lastMessageId:u,outdatedCount:0,lastSeenActivityCount:s,lastSeenActivityAt:l}})})},PostParticipant.handlers({joinConversation:e=function(t,e){var n,i,r,o,s;return t.data&&(r=t.data,i=r.postId,o=r.userId,n=r.createOnly),i||(i=t.key),o||(o=t.session.userId),t.require(o&&i,"userId (from session or data) and postId (from key)").then(function(){return t.requireServerOriginOr(!t.data,"when passing additional params via data")}).then((s=this,function(){return s._createOrUpdatePostParticipant(t,{userId:o,postId:i,updateOnly:e,createOnly:n})}))},seen:function(t){return e.call(this,t,!0).then(function(t){return t||{}})},leaveConversation:function(t){var e,n;return e=t.key,n=t.session.userId,t.subrequest("postParticipant","deleteIfExists",{key:{userId:n,postId:e}})}}),PostParticipant.prototype._updateParticipants=function(t,e){return this.queryDynamoDbWithRequest(t,{index:"participantsByPostIdAndUnseenActivityCount",where:{postId:e.id,outdatedCount:0}}).then(function(n){var r,o,s,a,l,u,c,h;return o=n.Items,u=e.id,h=e.userId,r=e.activityCount,s=e.lastActiveUserId,l=e.lastMessageId,a=e.lastActivityAt,e.topicId,s||(s=h),c=function(){var e,n,i,c,p,d;for(d=[],e=0,n=o.length;e<n;e++)c=(i=o[e]).postId,u=c.S,p=i.userId,h=p.S,d.push(t.subrequest("postParticipant","update",{key:{postId:u,userId:h},data:{postId:u,userId:h,lastActivityAt:a,lastMessageId:l,lastActiveUserId:s,activityCount:r,outdatedCount:h===s?0:1,lastSeenActivityCount:h===s?r:void 0}}));return d}(),i.all(c)})},PostParticipant.filter({name:"updatePostParticipant after every get/query",description:"update any outdated postParticipant after every get/query",after:{get:function(t){var e,n,i;return t.data.outdatedCount>0?(n=t.data,i=n.userId,e=n.postId,t.cachedGet("post",e).then(function(n){var r,o,s;return r=n.activityCount,o=n.lastActiveUserId,s=n.lastActivityAt,t.subrequest("postParticipant","update",{key:{postId:e,userId:i},data:{postId:e,userId:i,activityCount:r,lastActiveUserId:o,lastActivityAt:s}}).then(function(e){return t.withMergedData(e)})})):t}}}),PostParticipant.afterEvent({update:{post:function(t){var e;if(null!=(null!=(e=t.request.props.add)?e.activityCount:void 0))return PostParticipant.singleton._updateParticipants(t,t.data)}},create:{message:function(t){return t.subrequest("postParticipant","joinConversation",{key:t.data.postId})},post:function(t){return t.subrequest("postParticipant","joinConversation",{key:t.data.id,data:{userId:t.data.userId,createOnly:!0}})}}}),PostParticipant}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;(a=n(42)).present,a.object,a.mergeInto,i=a.bound,a.present,a.log,a.array,o=a.merge,r=a.defineModule,a.withSort,a.compare,a.max,a.select,a.isString,a.Promise,l=n(134),e=l.LinkFieldsFilter,l.pipelines,l.UpdateAfterMixin,l.KeyFieldsMixin,s=n(313).point,r(t,function(t){function PostSearch(){return PostSearch.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(PostSearch,n(717)),PostSearch.sourcePipelineName("post"),PostSearch.parentField("topicId"),PostSearch.routingField("userId"),PostSearch.elasticsearchType("post"),PostSearch.searchPipelineMapping({parent:"topic",indexed:{caption:"text",chapterTitle:"text",topicId:"keyword",userId:"keyword",templatePostId:"keyword",postOrder:"int64",isChapterStart:"boolean",templateUseCount:"int64",activityCount:"int64",lastActivityAt:"int64",messageCount:"int64",participantCount:"int32",mediaFile:"keyword",aspectRatio:"int16",pixelCountLog2:"int8",templateFile:"keyword",templateText:"text",templateDropInCount:"int8"},ignored:{mediaId:!0}}),PostSearch.filter(new e({verbose:!0,fields:{user:"link",topic:"link"}})),PostSearch.filter(n(706)),PostSearch.prototype.getElasticsearchData=function(t,e){var n;return t.dimensions?(n=s(t.dimensions),PostSearch.__super__.getElasticsearchData.call(this,o(t,{aspectRatio:1e3*i(0,s(t.dimensions).aspectRatio,32)|0,pixelCountLog2:Math.ceil(Math.log(n.area)/Math.log(2))}),e)):PostSearch.__super__.getElasticsearchData.apply(this,arguments)},PostSearch.prototype.getApplicationData=function(t){return o(t,{aspectRatio:t.aspectRatio/1e3})},PostSearch}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k={}.hasOwnProperty,I=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};w=n(651),r=w.array,o=w.bound,S=w.present,b=w.randomSort,y=w.objectWithout,w.toDate,f=w.max,u=w.each,S=w.present,l=w.defineModule,m=w.merge,r=w.array,w.min,i=w.Promise,u=w.each,E=w.toSeconds,s=w.compactFlatten,p=w.isString,r=w.array,d=w.log,T=w.upperCamelCase,g=w.object,w.isFunction,c=w.getTrendingTags,P=w.secondsPer,w.lowerCase,w.arrayToTruthMap,x=n(134),v=x.pipelines,x.UpdateAfterMixin,x.KeyFieldsMixin,e=n(718).MirroredElasticsearchPipeline,h=n(541).hashtagRegexp,a=n(560).config,C=function(t){return y(t,"lastChapterPost","lastPost")},_=function(t){return y(t,"profileTopic")},l(t,function(){return function(t){var n,l,y,w,x,M;function SearchPipelineBase(){return SearchPipelineBase.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)k.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(SearchPipelineBase,e),SearchPipelineBase.prototype.defaultLimit=250,70,SearchPipelineBase.publicRequestTypes("search trendingTags"),SearchPipelineBase.abstractClass(),SearchPipelineBase.baseMappingProperties={autoTags:"keywords",autoText:"text",updatedAt:"int64",createdAt:"int64"},M={keywords:{type:"text",analyzer:"standard"},text:{type:"text",analyzer:"english"},int64:{type:"long"},int32:{type:"integer"},int16:{type:"short"},int8:{type:"byte"},keyword:{type:"keyword"},boolean:{type:"boolean"},json:{type:"keyword",index:!1}},SearchPipelineBase.declarable({searchableTextFields:!0,jsonProps:!0}),SearchPipelineBase.searchPipelineMapping=function(t){var e,n,i,r,o,s,a,l;return l=t.parent,n=t.indexed,e=t.ignored,this.searchableTextFields(function(){var t;for(s in t=[],n)"text"===n[s]&&t.push(s);return t}()),o={},l&&(o._parent={type:l}),e||(e={}),e.id=!0,r={},i=g(n=m(this.baseMappingProperties,n),function(t,e){return"json"===t&&(r[e]=!0),M[t]||function(){throw new Error("invalid type: "+t)}()}),a=g(this.getSourcePipeline().fields,{when:function(t,n){return!e[n]&&!i[n]},with:function(t,e){return r[e]=!0,M.json}}),this.jsonProps(r),o.properties=m(a,i),this.mapping(o)},SearchPipelineBase.prototype.getSearchText=function(t){var e,n;return 1===(n=this.getSearchableTextFields()).length?t[n[0]]:s(function(){var i,r,o;for(o=[],i=0,r=n.length;i<r;i++)e=n[i],o.push(t[e]);return o}()).join(" ")},SearchPipelineBase.prototype.denormalizeTagsField=function(t){var e,n,i;return(n=null!=(i=this.getSearchText(t))?i.match(h):void 0)?(t.autoTags&&(n=s([t.autoTags,n])),m(t,{autoTags:function(){var t,i,r;for(r=[],t=0,i=n.length;t<i;t++)e=n[t],r.push(T(e));return r}().join(" "),autoText:function(){var t,i,r;for(r=[],t=0,i=n.length;t<i;t++)e=n[t],r.push(T(e," "));return r}().join(" ")})):t},SearchPipelineBase.prototype.encodedJsonFields=function(t){var e;return e=this.getJsonProps(),g(t,function(t,n){return e[n]?JSON.stringify(t):t})},SearchPipelineBase.prototype.decodeJsonFields=function(t){var e;return e=this.getJsonProps(),g(t,function(t,n){return e[n]?JSON.parse(t):t})},SearchPipelineBase.prototype.getElasticsearchData=function(t,e){return i.resolve(SearchPipelineBase.__super__.getElasticsearchData.call(this,this.denormalizeTagsField(t),e)).then((n=this,function(t){return n.encodedJsonFields(t)}));var n},SearchPipelineBase.prototype.getEleasticsearchQuery=function(t){},SearchPipelineBase.prototype.getElasticsearchQueryHashTags=function(t){var e,n,i;if(n=t.data.query,e=n.match(h))return e=function(){var t,n,r;for(r=[],t=0,n=e.length;t<n;t++)i=e[t],r.push(T(i));return r}(),n.replace(h," ")},x=/([^:\s]+)?:([^:\s]+)/g,SearchPipelineBase.prototype.extractQueryStringProps=n=function(t){var e,n,i,r;return n={},(i=t.match(x))&&(t=t.replace(x," "),u(i,function(t){var e,i,r;if(e=(r=t.split(":"))[0],i=r[1],S(e)){if(S(i))return n[e]=i}else if(S(i))return n[i]=!0})),(e=t.match(h))&&(e=function(){var t,n,i;for(i=[],t=0,n=e.length;t<n;t++)r=e[t],i.push(T(r));return i}(),t=t.replace(h," ")),{query:t.trim(),queryOptions:n,hashtags:e}},function(t){return t.sort(function(t,e){return(0|e.templateUseCount)-(0|t.templateUseCount)})},function(t){return t.sort(function(t,e){return(0|e.createdAt)-(0|t.createdAt)})},w=function(t,e){var n,i,r,o,s;for(o=[],n=[],i=0,r=t.length;i<r;i++)(0|(s=t[i]).templateUseCount)<e?o.push(s):n.push(s);return e>10&&(o=w(o,10)),n.concat(o)},function(t,e){return t=r(t,{when:function(t){return t.templateUseCount>e}}),b(t)},function(t,e){var n,i,r,o,s,a,l;for(n={},s=[],i=o=0,a=f(t.length,e.length);0<=a?o<a:o>a;i=0<=a?++o:--o)(l=t[i])&&!n[r=l.id]&&s.push(n[r]=l),(l=e[i])&&!n[r=l.id]&&s.push(n[r]=l);return s},function(t){var e,n,i,r;for(i=0,e=0,n=t.length;e<n;e++)(r=t[e].templateUseCount)>i&&(i=r);return i},y=function(t){var e;if(S(t)){if(0<(e=Date.parse(t.replace("_"," "))))return E(e)+.5|0;if(/^\d+$/.test(t.trim()))return E(t);throw new Error("invalid date: "+t)}},SearchPipelineBase.handlers({trendingTags:function(t){return v.postSearch.search(t,{props:{include:!1},data:{query:":templates order:trending createdAfter:"+(E()-P.week|0),vertical:"imikimi"}}).then(c)},search:function(t){var e,i,r,o;return t.data&&(i=t.data,e=i.query,r=i.vertical),t.require(p(e),"data.query string required").then((o=this,function(){var i,s,l,u,c,h,p,d,f,g,v,b,w,x,P,C,_,E,T,k,M,A,F;return c=(b=n(e)).hashtags,v=b.queryOptions,e=b.query,u=(w=m(t.data,v)).curate,p=null!=(x=w.limit)?x:o.defaultLimit,_=w.skip,s=w.createdAfter,l=w.createdBefore,T=w.templates,h=w.kimis,E=w.frames,A=w.user,k=w.stream,g=w.order,d=w.new,M=w.trending,F=w.uses,(null!=h?h:E)&&(T=!0),E&&(E|=0),E>0||(E=null),d&&(g="date"),M&&(g="trending"),F&&(g="uses"),f=v.or?"or":"and",d=v.new,!u||S(t.session.userId)&&(P=t.session.userId,I.call(a.curators,P)>=0)?(p|=0)<1||p>1e3?t.clientFailure("invalid limit: "+p):null!=_&&((_|=0)<0||_+p>1e4)?t.clientFailure("invalid skip: "+_):(i={curate:u&&(C=t.session.userId,I.call(a.curators,C)>=0),templates:T,templateDropInCount:E,vertical:r,userId:A,topicId:k,operator:f,query:e,hashtags:c,createdBefore:y(l),createdAfter:y(s),limit:p,skip:_,order:g},o.runQuery(t,i)):t.clientFailureNotAuthorized()}))}}),l=function(t){switch(null!=t&&(t=s(t)),null!=t?t.length:void 0){case 0:return;case 1:return t[0];default:return t}},SearchPipelineBase.prototype.runQuery=function(t,e){var n,a,u,c,h,p,f,g,y,b,w,x,P,T,k;return h=e.limit,y=e.skip,n=e.createdAfter,a=e.createdBefore,P=e.userId,x=e.topicId,w=e.templates,T=e.vertical,g=e.query,c=e.hashtags,u=e.curate,f=e.order,p=e.operator,b=e.templateDropInCount,"zoStream"===T&&(w=!1),i.then(function(){return!!x&&v.topic.canView(t,x)}).then((k=this,function(I){var M,A,F,B,R,z,O,L;switch(g=null!=(A=null!=g?g.trim():void 0)?A:"",M=s([k.getSearchableTextFields(),"autoText"]),k.pipelineName){case"postSearch":w&&null==f&&(f="trending"),(L="trending"===f)&&(null==n&&(n=E(Date.now())-2592e3|0),f="uses"),B=!0;break;case"topicSearch":R=!0;break;case"userSearch":if(z=!0,P)return t.subrequest("user","get",{key:P,returnNullIfMissing:!0}).then(function(t){return s([t])})}return x&&!B?[]:u||w||x||P||(null!=c?c.length:void 0)>0||S(g)?(B||"trending"!==f&&"uses"!==f||(f=null),O=function(){switch(f){case"uses":return{templateUseCount:{order:"desc"}};case"date":return R?{lastPostCreatedAt:{order:"desc"}}:{createdAt:{order:"desc"}}}}(),I||(I=u||null!=P&&P===t.session.userId),F=m({size:h=o(1,null!=h?h:0|k.defaultLimit,1e3),from:y?o(0,h+(0|y),1e4)-h:void 0,sort:O,query:m({bool:m({must:l([S(g)?{multi_match:{query:g,fields:M,type:"cross_fields",operator:null!=p?p:"and"}}:void 0,c?{match:{autoTags:{query:c.join(" "),operator:p}}}:void 0,P?{match:{userId:P}}:void 0,B?{has_parent:{parent_type:"topic",inner_hits:{},query:{bool:{must:l([{exists:{field:"createdAt"}},x?{match:{_id:x}}:void 0,{has_parent:{parent_type:"user",inner_hits:{},query:{exists:{field:"createdAt"}}}}])}}}}:void 0]),filter:l([n?{range:{createdAt:{gte:n}}}:void 0,a?{range:{createdAt:{lte:a}}}:void 0,b>1?{term:{templateDropInCount:b}}:void 0,B&&w?{exists:{field:"templateFile"}}:void 0]),must_not:l([R?{term:{isProfileTopic:!0}}:void 0,R&&!I?{term:{private:!0}}:void 0,B?["zoStream"!==T||P||x?void 0:[{exists:{field:"templateFile"}},{exists:{field:"templatePostId"}}],{has_parent:{parent_type:"topic",filter:{bool:{should:[I?void 0:{term:{private:!0}},{term:{isProfileTopic:!0}}]}}}}]:void 0])})})}),b>0&&d({SearchPipelineBase:{options:e,pipelineName:k.pipelineName,searchParams:F,searchingForTopics:R,searchingForPosts:B}}),t.subrequest(t.pipeline,"elasticsearch",{data:F,returnResponse:!0}).then(function(e){var o;return o=e.data,i.all(r(o.hits.hits,function(t){var e,n,i,r,o,s,a,l,u,c,h,p,d,f,g;switch(i=t._id,e=t._score,n=t._source,!1){case!B:(d=null!=(o=t.inner_hits)&&null!=(s=o.topic)&&null!=(a=s.hits)&&null!=(l=a.hits)?l[0]:void 0)&&(p=C(v.topicSearch.decodeJsonFields(d._source)),(g=null!=(u=d.inner_hits)&&null!=(c=u.user)&&null!=(h=c.hits)&&null!=(r=h.hits)?r[0]:void 0)&&(f=_(v.userSearch.decodeJsonFields(g._source))));break;case!R:n=C(n);break;case!z:n=_(n)}return k.getApplicationData(m(k.decodeJsonFields(n),{id:i,_score:e,topic:p,user:f}))})).then(function(e){var r;return r=null,(L&&e.length<h?k.runQuery(t,{limit:h,userId:P,templates:w,query:g,hashtags:c,curate:u,operator:p,order:"uses",templateDropInCount:b}).then(function(t){var n,i,o;return n=(i=t.props).data,o=i.metadata,r=o.totalFound,e.concat(n)}):i.resolve(e)).then(function(e){return t.success({props:{data:e,metadata:m({totalFound:o.hits.total,secondQueryFound:r,searchParams:{limit:h,skip:y,trending:L,operator:p,order:f,query:g,hashtags:c,createdAfter:n,createdBefore:a,userId:P}})}})})})}).catch(function(t){throw t})):[]}))},SearchPipelineBase.filter({after:{search:function(t){var e;return e={},t.withData(r(t.data,{when:function(t){var n;return n=t.id,!e[n]&&(e[n]=!0)}}))}}}),SearchPipelineBase}()})}).call(this,n(2)(t))},function(t,e,n){t.exports=n(719)},function(t,e,n){t.exports=n(720),t.exports.includeInNamespace(n(723)).addModules({ElasticsearchConfig:n(726)}),n(724)},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(18).addNamespace("Art.EryExtensions.Elasticsearch",function(t){function Elasticsearch(){return Elasticsearch.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Elasticsearch,Neptune.PackageNamespace),Elasticsearch.version=n(721).version,Elasticsearch}()),n(722)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*"},"description":"Elasticsearch for ArtEry","license":"ISC","name":"art-ery-elasticsearch","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress"},"version":"0.13.6"}')},function(t,e,n){var i={}.hasOwnProperty;t.exports=n(720).addNamespace("Pipelines",function(t){function Pipelines(){return Pipelines.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Pipelines,Neptune.PackageNamespace),Pipelines}())},function(t,e,n){t.exports=n(724)},function(t,e,n){t.exports=n(722),t.exports.addModules({ElasticsearchGlobal:n(725),ElasticsearchPipeline:n(727),ElasticsearchPipelineBase:n(728),MirroredElasticsearchPipeline:n(729)})},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p={}.hasOwnProperty;(c=n(42)).formattedInspect,c.log,r=c.defineModule,c.merge,i=c.array,a=c.object,l=c.objectWithout,o=c.mergeInto,n(96).DeclarableMixin,(h=n(134)).Pipeline,u=h.pipelines,n(726).config,n(658).Aws4RestClient,s=n(160).CommunicationStatus.missing,e=n(727),r(t,function(t){function ElasticsearchGlobal(){return ElasticsearchGlobal.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElasticsearchGlobal,n(728)),ElasticsearchGlobal.getElasticsearchMappings=function(){var t,n;return t=i(u,{when:function(t){return t instanceof e}}),n={},{mappings:a(t,{key:function(t){return t.elasticsearchType},with:function(t){var e;return(e=t.getMapping()).settings?(o(n,e.settings),l(e,"settings")):e}}),settings:n}},ElasticsearchGlobal.handlers({initialize:function(t){return t.subrequest(t.pipeline,"indexExists").then((e=this,function(n){return n?{status:"alreadyInitialized"}:e.normalizeJsonRestClientResponse(t,e.restClient.putJson(e.getIndexUrl(),e.class.getElasticsearchMappings()))}));var e},getInitializeParams:function(t){return this.class.getElasticsearchMappings()},getIndicies:function(t){return this.restClient.getJson("/*")},indexExists:function(t){return this.restClient.getJson(this.getIndexUrl()).then(function(){return t.success({data:!0})}).catch((e=this,function(n){return n.status===s?t.success({data:!1}):e.normalizeJsonRestClientError(t,n)}));var e},createIndex:function(t){return this.normalizeJsonRestClientResponse(t,this.restClient.putJson(this.getIndexUrl()))},deleteIndex:function(t){var e,n;return t.require(null!=(e=t.data)?e.force:void 0,"data.force=true required").then((n=this,function(){return n.normalizeJsonRestClientResponse(t,n.restClient.deleteJson(n.getIndexUrl()))}))}}),ElasticsearchGlobal}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;(r=n(160)).merge,i=r.defineModule,r.select,r.newObjectFromEach,r.mergeInto,e=r.Configurable,i(t,function(t){function ElasticsearchConfig(){return ElasticsearchConfig.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElasticsearchConfig,e),ElasticsearchConfig.defaults({index:"ArtEryElasticsearch",endpoint:"http://localhost:9200"}),ElasticsearchConfig}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g={}.hasOwnProperty;p=n(42),o=p.formattedInspect,p.log,h=p.present,a=p.isPlainObject,r=p.defineModule,m=p.snakeCase,p.array,p.object,p.find,i=p.compactFlatten,c=p.objectWithout,p.mergeInto,l=p.isString,p.merge,s=p.isFunction,n(96).DeclarableMixin,d=n(141),u=d.missing,e=d.clientFailure,(f=n(134)).Pipeline,f.pipelines,n(726).config,r(t,function(t){function ElasticsearchPipeline(){return ElasticsearchPipeline.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)g.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElasticsearchPipeline,n(728)),ElasticsearchPipeline.abstractClass(),ElasticsearchPipeline.declarable({parentField:{validate:l},routingField:{validate:l},elasticsearchType:{validate:l},mapping:{extendable:{}}}),ElasticsearchPipeline.getter({elasticsearchType:function(){var t;return(t=this.class)._elasticsearchType||(t._elasticsearchType=m(this.class.getName()))},indexTypeUrl:function(){return this.getIndexUrl()+"/"+this.elasticsearchType},searchUrl:function(){return this.getIndexTypeUrl()+"/_search"}}),ElasticsearchPipeline.prototype.getEntryBaseUrl=function(t){return this.getIndexUrl()+"/"+this.elasticsearchType+"/"+t},ElasticsearchPipeline.prototype.getEntryUrl=function(t,e){return""+this.getEntryBaseUrl(t)+this.getEntryUrlParams(e)},ElasticsearchPipeline.prototype.getUpdateUrl=function(t,e){return this.getEntryBaseUrl(t)+"/_update"+this.getEntryUrlParams(e)},ElasticsearchPipeline.prototype.getEntryUrlParams=function(t){var e,n,r,o;return"?"+i([null!=t&&(r=this.getRoutingField())&&h(o=t[r])?"routing="+encodeURIComponent(o):void 0,null!=t&&(e=this.getParentField())&&h(n=t[e])?"parent="+encodeURIComponent(n):void 0]).join("&")},ElasticsearchPipeline.prototype.getEntryUrlFromRequest=function(t){var e,n,i;return n=t.key,e=t.data,t.require(h(n),"key required for "+t.type+": "+o({key:n,data:e})).then((i=this,function(){return i.getEntryUrl(n,e)}))},ElasticsearchPipeline.handlers({findDuplicateIds:function(t){var e;return t.subrequest(t.pipelineName,"elasticsearch",{data:{size:null!=(e=t.props.limit)?e:100,query:{term:{_id:t.key}}}}).then(function(t){return t.hits.hits})},get:function(t){var e;return t.key,t.data,this.getEntryUrlFromRequest(t).then((e=this,function(n){return e.normalizeJsonRestClientResponse(t,e.restClient.getJson(n))})).then(function(e){if(null!=e._source)return t.success({data:e._source,elasticsearch:c(e,"_source")})})},addOrReplace:function(t){var e,n,i;return n=t.key,e=t.data,t.require(h(n)&&a(e),"key and data required, "+o({key:n,data:e})).then((i=this,function(){return i.normalizeJsonRestClientResponse(t,i.restClient.putJson(i.getEntryUrl(n,e),e))}))},update:function(t){var n,i,r;return i=t.key,n=t.data,t.require(h(i)&&a(n),"key and data required, "+o({key:i,data:n})).then((r=this,function(){return r.normalizeJsonRestClientResponse(t,r.restClient.postJson(r.getUpdateUrl(i,n),{doc:n,doc_as_upsert:!0}))})).then(function(n){return function(r){var o,a,l,u;return r.status===e&&"version_conflict_engine_exception"===(null!=(o=r.data)&&null!=(a=o.error)&&null!=(l=a.root_cause)&&null!=(u=l[0])?u.type:void 0)&&s(n.reindex)?t.subrequest(t.pipelineName,"reindex",{key:i}):r}}(this))},delete:function(t){return this.getEntryUrlFromRequest(t).then((e=this,function(n){return e.normalizeJsonRestClientResponse(t,e.restClient.deleteJson(n))})).then(function(e){return(null!=e?e.status:void 0)===u?t.missing():t.success({props:e})});var e},elasticsearch:function(t){var e;return e=t.data,this.normalizeJsonRestClientResponse(t,this.restClient.postJson(this.getSearchUrl(),e))}}),ElasticsearchPipeline}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h={}.hasOwnProperty;(l=n(42)).formattedInspect,l.log,s=l.defineModule,a=l.merge,l.array,l.mergeInto,l.object,l.objectWithout,c=l.snakeCase,i=n(96).DeclarableMixin,r=(u=n(134)).Pipeline,u.pipelines,o=n(726).config,e=n(658).Aws4RestClient,s(t,function(t){function ElasticsearchPipelineBase(){return ElasticsearchPipelineBase.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElasticsearchPipelineBase,i(r)),ElasticsearchPipelineBase.abstractClass(),ElasticsearchPipelineBase.getter({restClient:function(){return new e(a(o,{service:"es"}))},elasticsearchIndex:function(){return this._elasticsearchIndex||(this._elasticsearchIndex=c(o.index))},indexUrl:function(t){return"/"+(t||this.getElasticsearchIndex())}}),ElasticsearchPipelineBase.prototype.normalizeJsonRestClientResponse=function(t,e){return e.catch((n=this,function(e){return n.normalizeJsonRestClientError(t,e)}));var n},ElasticsearchPipelineBase.prototype.normalizeJsonRestClientError=function(t,e){if(e.status)return t.toResponse(e.status,{data:e.data});throw e},ElasticsearchPipelineBase}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y={}.hasOwnProperty;m=n(42),a=m.eq,f=m.present,h=m.merge,m.isArray,p=m.object,s=m.defineModule,m.array,c=m.log,u=m.isString,l=m.formattedInspect,r=m.Promise,g=n(134),d=g.pipelines,o=g.UpdateAfterMixin,i=g.KeyFieldsMixin,e=n(727),s(t,function(){return function(t){function MirroredElasticsearchPipeline(){return MirroredElasticsearchPipeline.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)y.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(MirroredElasticsearchPipeline,o(i(e))),MirroredElasticsearchPipeline.abstractClass(),MirroredElasticsearchPipeline.declarable({sourcePipelineName:{validate:u}}),MirroredElasticsearchPipeline.classGetter({sourcePipeline:function(){return d[this.getSourcePipelineName()]}}),MirroredElasticsearchPipeline.getter({sourcePipeline:function(){return d[this.getSourcePipelineName()]}}),MirroredElasticsearchPipeline.prototype.getElasticsearchData=function(t,e){return p(this.getMapping().properties,{when:function(e,n){return null!=t[n]},with:function(e,n){return t[n]}})},MirroredElasticsearchPipeline.prototype.getApplicationData=function(t){return t},MirroredElasticsearchPipeline.postCreateConcreteClass=function(){var t,e,n,i;if(i=MirroredElasticsearchPipeline.__super__.constructor.postCreateConcreteClass.apply(this,arguments),!u(this.getSourcePipelineName()))throw new Error("sourcePipelineName invalid: "+l(getSourcePipelineName()));return this.updateAfter({create:(t={},t[""+this.getSourcePipelineName()]=function(t){return this._getElasticsearchUpdateProps(t)},t),update:(e={},e[""+this.getSourcePipelineName()]=function(t){return this._getElasticsearchUpdateProps(t)},e)}),this.deleteAfter({delete:(n={},n[""+this.getSourcePipelineName()]=function(t){var e,n;if(n=t.responseData,e=t.key,n)return{key:e,data:n}},n)}),i},MirroredElasticsearchPipeline.handler({fixDuplicateIds:function(t){var e,n,i;return e=t.key,n=t.props.pretend,r.all([t.subrequest(t.pipelineName,"findDuplicateIds",e),t.subrequest(this.sourcePipeline.name,"get",{key:e,props:{include:!1}})]).then((i=this,function(o){var s,l,u,c,h,p,d,f,m,g,y;for(u=o[0],y=o[1],l=i.getEntryUrlParams(y),c=null,d=[],p=[],h=0,f=u.length;h<f;h++)if(s=u[h]._source,a(l,m=i.getEntryUrlParams(s))){if(c)throw new Error("found TWO correct records, WTF");c=s}else d.push(m),p.push(s);return r.all([function(){var i,r,o;for(o=[],i=0,r=p.length;i<r;i++)g=p[i],n?o.push(e):o.push(t.subrequest(t.pipelineName,"delete",{key:e,data:g}));return o}()]).then(function(){var t;return(t={})[(n?"pretend-":"")+"deleted"]=p.length,t.key=e,t.correctParams=l,t.incorrectParams=d,t})}))},reindexFromElasticsearch:function(t){var e,n;return e=t.props.pretend,n=h(t.data,{stored_fields:[]}),t.subrequest(t.pipelineName,"elasticsearch",{data:n,props:{include:!1}}).then(function(n){var i;return c({reindexFromElasticsearch:{reindexing:!e,found:n.hits.hits.length}}),r.all(function(){var r,o,s,a;for(a=[],r=0,o=(s=n.hits.hits).length;r<o;r++)i=s[r],a.push(function(n){return e?n._id:t.subrequest(t.pipelineName,"reindex",n._id).then(function(){return n._id})}(i));return a}())})},reindex:function(t){return t.data?this._getElasticsearchUpdateProps(t,t.data).then(function(e){return t.subrequest(t.pipeline,"addOrReplace",e)}):t.require(t.key).then((e=this,function(){return t.subrequest(e.getSourcePipelineName(),"get",{key:t.key,returnResponseObject:!0,props:{include:!1}})})).then(function(t){return function(e){return t._getElasticsearchUpdateProps(e)}}(this)).then(function(e){return t.subrequest(t.pipeline,"addOrReplace",e)});var e},reindexAll:function(t){var e;return e=t.props.pageLimit,this.reindexPage(t,null,e)}}),MirroredElasticsearchPipeline.prototype.reindexPage=function(t,e,n){var i,o,s;return o=(i=t.context).reindex||(i.reindex={itemCount:0,pageCount:0}),t.subrequest(this.getSourcePipelineName(),"getAll",{returnResponse:!0,originatedOnServer:!0,props:{include:!1,lastEvaluatedKey:e,limit:n}}).then((s=this,function(e){var i,a,l,u;return u=e.props,l=u.lastEvaluatedKey,a=u.data,r.all(function(){var e,n,r;for(r=[],e=0,n=a.length;e<n;e++)i=a[e],r.push(t.subrequest(t.pipeline,"reindex",{data:i}));return r}()).then(function(){if(o.itemCount+=a.length,o.pageCount++,c({reindex:h(o,{lastEvaluatedKey:l})}),l)return s.reindexPage(t,l,n)})})).then(function(){return o})},MirroredElasticsearchPipeline.filter({after:{get:function(t){return t.withData(t.pipeline.getApplicationData(t.responseData))}}}),MirroredElasticsearchPipeline.prototype._getElasticsearchUpdateProps=function(t,e){return e||(e=h(t.requestData,t.responseData,t.responseProps.updatedData)),r.resolve(this.getElasticsearchData(e,t)).then((n=this,function(i){return{key:(null!=e?e.id:void 0)||t.key,data:n._getElasticsearchDataWithRouting(i,e)}}));var n},MirroredElasticsearchPipeline.prototype._getElasticsearchDataWithRouting=function(t,e){var n,i;if(i=this.class.getRoutingField(),n=this.class.getParentField(),(i||n)&&(t=p(t)),i&&!f(t[i]||(t[i]=e[i])))throw new Error("missing routing field: "+l({routingField:i,requestData:requestData,sourceData:e}));if(n&&!f(t[n]||(t[n]=e[n])))throw new Error("missing parent field: "+l({parentField:n,requestData:requestData,sourceData:e}));return t},MirroredElasticsearchPipeline}()})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a={}.hasOwnProperty;i=(o=n(42)).defineModule,r=o.isObject,(s=n(134)).pipelines,e=s.Pipeline,n(560).config,i(t,function(t){function Status(){return Status.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Status,e),Status.publicRequestTypes("version"),Status.handler({version:function(){return{serverVersion:Neptune.Imikimi.Oz.version,serverDeployedAt:Neptune.Imikimi.Oz.deployedAt}}}),Status.filter({location:"client",after:{version:function(t){var e,n,i,o;return o=t.data,r(o)&&(o=(n=o).serverVersion,i=n.serverDeployedAt),{serverVersion:o,clientVersion:e=Neptune.Imikimi.Oz.version,deployedAt:Neptune.Imikimi.Oz.deployedAt,serverDeployedAt:i,updateAvailable:o!==e}}}}),Status}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;e=(r=n(42)).defineModule,i=r.isString,r.log,r.array,e(t,function(){return function(t){function Subscription(){return Subscription.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(Subscription,n(695)),Subscription.globalIndexes({subscriptionsByUserId:"userId/expiresAt",subscriptionsByStripeSubscriptionId:"stripeSubscriptionId/expiresAt"}),Subscription.addDatabaseFilters({fields:{stripeSubscriptionId:{fieldType:"trimmedString",validate:function(t){return null===t||i(t)&&t.match(/^sub_/)}},expiresAt:"required secondsTimestamp"},userOwned:!0}),Subscription.handler({currentUsersSubscriptionDetails:function(t){return t.subrequest("stripeCustomer","get")}}),Subscription}()})}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","getDisplayTitle","Neptune","pipelines","log","Promise","toSeconds","secondsPer","randomSort","cryptoRandomString"],[e,n(651)],(t,e,r,o,s,a,l,u,c,h)=>{return i.defClass(class Topic extends(t("Topic",n(695))){},function(t,p,d){this.publicRequestTypes("get","delete","update","staffPicks","getPrivateSharePassword","resetSharePassword","submit","canView","topicsByUserId","topicsByUserIdDesc"),this.globalIndexes({topicsByUserId:"userId/lastPostCreatedAt"}),this.prototype.getUrlText=e,this.getter({urlResourceName:function(){return"stream"}}),this.query({staffPicks:{query:function(t){let e,n,h,p,d;return({staffPicksChannelId:e,staffPicksUserId:n}=r.Imikimi.Oz.config),({session:h}=t),({userId:p}=t.session),(d=null!=e?o.channelTopic.channelTopicsByChannelId(t,{key:e,props:{include:!1}}).then(e=>a.all(i.array(e,({topicId:e})=>t.cachedGetWithoutInclude("topic",e).catch(()=>null)))):(s({"staffPicks: scanDynamoDb":{staffPicksChannelId:e,staffPicksUserId:n,session:h}}),t.pipeline.scanDynamoDb().then(({items:t})=>t))).then(t=>i.array(t,null,t=>t&&!t.private)).then(t=>{let e,n;return e={},n=l()-14*u.day,i.array(t,t=>(e[t.userId]=!0,t),t=>n<l(t.lastPostCreatedAt)&&!e[t.userId])}).then(t=>c(t).slice(0,25))},dataToKeyString:function(){return"all"}}}),this.prototype.getNewSharePasswordProps=function(){return{sharePassword:h(10),sharePasswordCreatedAt:l()}},this.filter({name:"sharePassword",group:"inner",before:{create:function(t){let e;return i.exists(e=t.data)&&e.private?t.withMergedData(t.pipeline.getNewSharePasswordProps()):t}}}),this.handlers({resetSharePassword:function(t){return this.requireServerOriginOrOwner(t).then(()=>o.topic.update(t,{key:t.key,data:t.pipeline.getNewSharePasswordProps()}))},getPrivateSharePassword:function(t){return o.topic.get(t).tap(e=>t.requireServerOriginOr(!e.private||e.userId===t.session.userId,"must be own topic")).then(e=>{let n;return(null!=(n=e.sharePassword)?n:!e.private)?e:o.topic.resetSharePassword(t)}).then(({sharePassword:t,private:e})=>e?t:void 0)}}),this.addDatabaseFilters({fields:{title:{present:!0,fieldType:"trimmedString",maxLength:40},description:{fieldType:"trimmedString",maxLength:512},lastPostCreatedAt:{fieldType:"secondsTimestamp",default:0},lastPost:{include:{link:"post"}},lastChapterPost:{include:{link:"post"}},postCount:"count",followerCount:"count",participantCount:"count",activityCount:"count",messageCount:"count",isProfileTopic:"boolean",sharePassword:"trimmedString",sharePasswordCreatedAt:"secondsTimestamp",private:"boolean"},userOwned:{publicFields:"title description lastPostCreatedAt lastPostId lastPost lastChapterPost lastChapterPostId postCount followerCount activityCount participantCount messageCount isProfileTopic private",userCreatableFields:"title description private",userUpdatableFields:"title description private",requireUserCanUpdate:function(t,e,n){return e.userId===t.session.userId?t:o.topicMembership.requireCanAdmin(t)}}}),this.updateAfter({create:{message:function(t){return t.cachedGet("post",t.data.postId).then(t=>({key:t.topicId,add:{activityCount:1,messageCount:1}}))},post:function({requestProps:t,data:{topicId:e,createdAt:n,isChapterStart:i,id:r}}){let o;return t.preventUpdateTopicAfterPostCreate?void 0:((o={key:e,add:{postCount:1},data:{lastPostCreatedAt:n,lastPostId:r},setDefault:{}})[i?"data":"setDefault"].lastChapterPostId=r,o)},topicFollower:function(t){return{key:t.data.topicId,add:{followerCount:1}}},topicMembership:function(t){return{key:t.data.topicId,add:{participantCount:1}}}},delete:{topicFollower:function(t){return{key:t.data.topicId,add:{followerCount:-1}}},topicMembership:function(t){return{key:t.data.topicId,add:{participantCount:-1}}}}}),this.afterEvent({delete:{post:function(t){let e,n,r,s,a;return"topic"!==(i.exists(s=t.parentRequest)?(e=s.key,n=s.type,r=s.pipelineName):void 0)||"delete"!==n||e!==(i.exists(a=t.data)&&a.topicId)?o.topic.updateComputedPostFields(t,t.data.topicId,{props:{include:!1}}):void 0}},update:{post:function(t){let e,n,r;return null!=(i.exists(r=t.requestData)?(e=r.postOrder,n=r.isChapterStart):void 0)||null!=e?o.topic.updateComputedPostFields(t,t.data.topicId,{props:{include:!1}}):void 0}}}),this.filter(n(707)),this.filter(n(733))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Filter","detagString","merge"],[e,n(651)],(t,e,n)=>{return i.defClass(class TopicTagsFilter extends t{},function(t,i,r){this.location("server"),this.after({all:function(t){return t.withTransformedRecords(t=>{let i,r;return[i,r]=e(t.title,1),n(t,{tags:i,displayTitle:r})})}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","isValidVertical","pipelines"],[e,n(651)],(t,e,r)=>{return i.defClass(class TopicFollower extends(t("TopicFollower",n(700))){},function(t,n,o){this.primaryKey("userId/topicId"),this.globalIndexes({topicFollowersByTopicId:"topicId/createdAt",topicFollowersByUserId:"userId/createdAt"}),this.publicRequestTypes("get","unsubscribe","subscribe","topicFollowersByTopicId","topicFollowersByUserId"),this.addDatabaseFilters({userOwned:!0,fields:{topic:"link",followingCount:"count",subscribed:"boolean",subscribedAt:"secondsTimestamp",unsubscribedAt:"secondsTimestamp",vertical:{validate:function(t){return!(null!=t)||e(t)}}}}),this.afterEvent({delete:{channelTopic:function(t){return this.decreaseFollowingCount(t)}},create:{channelTopic:function(t){return this.increaseFollowingCount(t)},post:function(t){let e;return e=t.data,r.topicFollower.topicFollowersByTopicId(t,e.topicId).then(n=>i.find(n,null,({subscribed:t})=>t)?this._sendNewPostNotifications(t,e,n):void 0)}}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e={}.hasOwnProperty;(0,n(42).defineModule)(t,function(){return function(t){function TopicHide(){return TopicHide.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function ctor(){this.constructor=t}ctor.prototype=n.prototype,t.prototype=new ctor,t.__super__=n.prototype}(TopicHide,n(695)),TopicHide.publicRequestTypes("hideTopic topicHidesByUserId"),TopicHide.primaryKey("userId/topicId"),TopicHide.addDatabaseFilters({userOwned:!0,fields:{topic:"required link",hiddenOnPost:{link:"post"},reason:"trimmedString"}}),TopicHide.handlers({hideTopic:function(t){var e,n,i,r,o,s,a,l;return s=t.session,a=t.key,r=t.data,i=r.reason,n=r.hiddenOnPostId,o=t.props,e=o.alsoNotify,l=s.userId,t.require(l,"current user").then(function(){var r;return Promise.all([t.subrequest(t.pipelineName,"create",{data:{userId:l,topicId:a,reason:i,hiddenOnPostId:n}}),e&&(null!=(r=Neptune.Art.Mailgun)?r.sendEmail({to:"feedback@imikimi.com",fromName:"TopicHidePipeline",subject:"TopicHide Notification: user:"+l+" hid topic:"+a,text:"user: "+l+"\nhid topic: "+a+"\non post: https://"+verticalHostname+"/post/"+n+"\nreason: "+i}):void 0)])}).then(function(t){var e,n;return e=t[0],n=t[1],{hid:e=!!e,notified:n=!!n}})}}),TopicHide}()})}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o={}.hasOwnProperty;(i=n(160)).present,i.object,i.mergeInto,i.bound,i.present,i.log,i.array,i.merge,e=i.defineModule,i.withSort,i.compare,i.max,i.select,i.isString,(r=n(134)).UpdateAfterMixin,r.KeyFieldsMixin,r.LinkFieldsFilter,n(718).MirroredElasticsearchPipeline,e(t,function(t){function TopicSearch(){return TopicSearch.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(TopicSearch,n(717)),TopicSearch.sourcePipelineName("topic"),TopicSearch.parentField("userId"),TopicSearch.elasticsearchType("topic"),TopicSearch.prototype.defaultLimit=50,TopicSearch.searchPipelineMapping({parent:"user",indexed:{title:"text",description:"text",userId:"keyword",lastPostCreatedAt:"int64",lastPostId:"keyword",lastChapterPostId:"keyword",postCount:"int32",participantCount:"int32",followerCount:"int32",activityCount:"int64",messageCount:"int64",isProfileTopic:"boolean",private:"boolean"},ignored:{lastChapterPost:!0,lastPost:!0}}),TopicSearch.filter(n(733)),TopicSearch}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","getDisplayName","isString","validMembershipTypes","compactFlatten","merge"],[e,n(651)],(t,e,r,o,s,a)=>{return i.defClass(class User extends(t("User",n(695))){},function(t,n,l){this.prototype.getUrlText=e,this.getter({urlResourceName:function(){return"member"}}),this.publicRequestTypes("get update startTrialMembership grantPatronage applyReferral delete merge getWithMergedIntoUserRedirect"),this.addDatabaseFilters({fields:{displayName:{present:!0,fieldType:"trimmedString",maxLength:40},postCount:"count",topicCount:"count",channelCount:"count",followerCount:"count",messageCount:"count",socialActivityCount:"count",lastTopicCreatedAt:"secondsTimestamp",lastPostCreatedAt:"secondsTimestamp",profileTopic:{include:{link:"topic"}},defaultChannel:{link:"channel"},templateUseCount:"number",imikimiUserId:"number",imikimiUsername:"trimmedString",imikimiUserSince:"secondsTimestamp",mergedIntoUser:{link:"user"},referringUser:{link:"user"},membershipPatron:{link:"user"},migrationStatus:{validate:function(t){return r(t)&&/^(queued|error|started|done)$/.test(t)}},migrationUpdatedAt:"secondsTimestamp",subscriptionExpiresAt:"secondsTimestamp",membershipType:{fieldType:"trimmedString",postValidate:function(t){return!(null!=t)||o[t]}},receivedTrialMembershipAt:"secondsTimestamp",preferredAuthenticationKey:{link:"authenticationKey"},subscription:"link",stripeCustomerId:{dataType:"string",validate:function(t){return null===t||r(t)&&/^cus_/.test(t)}}}}),this.prototype.publicFields=["id","createdAt","updatedAt","displayName","profileTopic","profileTopicId","imikimiUserId","postCount","topicCount","followerCount","messageCount","templateUseCount","socialActivityCount","imikimiUserSince","imikimiUsername","lastTopicCreatedAt","lastPostCreatedAt","subscriptionExpiresAt","receivedTrialMembershipAt","membershipType"],this.updateAfter({create:{message:function(t){let e;return e=t.data,t.cachedPipelineGet("post",e.postId).then(t=>s([e.userId!==t.userId?[{key:e.userId,add:{socialActivityCount:1}},{key:t.userId,add:{socialActivityCount:1}}]:void 0,{key:e.userId,add:{messageCount:1}}]))},post:function({data:{userId:t,createdAt:e,templateAuthorId:n}}){return[{key:t,data:{lastPostCreatedAt:e},add:{postCount:1}},n&&{key:n,add:{templateUseCount:1}}]},topic:function({data:{userId:t,createdAt:e,isProfileTopic:n,id:i}}){return{key:t,data:{lastTopicCreatedAt:e},add:{topicCount:1},setDefault:n&&{profileTopicId:i}}},userFollower:function(t){return{key:t.data.followedUserId,add:{followerCount:1}}},channel:function(t){return{key:t.data.userId,add:{channelCount:1},setDefault:{defaultChannelId:t.data.id}}},subscription:function(t){let e,n,i,r;return e=(r=t.data).userId,n=r.expiresAt,i=r.id,{key:t.data.userId,data:{subscriptionId:i,subscriptionExpiresAt:n,membershipType:"subscriber"}}}},delete:{userFollower:function(t){return{key:t.data.followedUserId,add:{followerCount:-1}}},topic:function(t){let e,n,r,o,s,l;return(i.exists(s=t.parentRequest)?(e=s.type,n=s.pipelineName):void 0)&&"user"===n&&"delete"===e?null:(i.exists(l=t.data)&&(r=l.userId,o=l.isProfileTopic),a({key:r,add:{topicCount:-1},data:o&&{profileTopicId:null}}))}}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c={}.hasOwnProperty;(a=n(42)).present,a.object,a.mergeInto,a.bound,a.present,a.log,a.array,s=a.merge,i=a.defineModule,a.withSort,a.compare,a.max,a.select,a.isString,u=a.w,o=a.findEmailRegExp,r=a.find,e=a.compactFlatten,(l=n(134)).UpdateAfterMixin,l.KeyFieldsMixin,l.LinkFieldsFilter,n(718).MirroredElasticsearchPipeline,i(t,function(t){function UserSearch(){return UserSearch.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(UserSearch,n(717)),UserSearch.sourcePipelineName("user"),UserSearch.searchableTextFields(["displayName"]),UserSearch.elasticsearchType("user"),UserSearch.searchPipelineMapping({indexed:{displayName:"text",postCount:"int32",topicCount:"int16",followerCount:"int32",messageCount:"int64",templateUseCount:"int64",lastTopicCreatedAt:"int64",lastPostCreatedAt:"int64"},notIndexed:u("profileTopicId"),ignored:{defaultChannelId:!0,preferredAuthenticationKeyId:!0,subscriptionId:!0,channelCount:!0,stripeCustomerId:!0,profileTopic:!0}}),UserSearch.prototype.defaultLimit=25,UserSearch.filter({after:{search:function(t){var n,i,a,l;return(i=null!=(a=t.requestData)&&null!=(l=a.query)?l.match(o):void 0)?(n=i[0],t.subrequest("authenticationKey","authenticationKeysByAddress",n).then(function(e){var n,i;if((i=null!=(n=e[0])?n.userId:void 0)&&!r(t.responseData,function(t){return t.id===i}))return t.subrequest("user","get",{key:i,originatedOnServer:!1})}).then(function(n){var i,r,o;return n?(r=(o=t.props).metadata,i=o.data,t.withMergedProps({data:i=e([n,i]),metadata:s(r,{totalFound:i.length})})):t})):t}}}),UserSearch}())}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(279)).addModules({AuthenticationKey:n(740),AuthenticationRequest:n(742),Session:n(743),StandardImport:n(741)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","DynamoDbPipeline"],[e,n(741)],(t,e)=>{return i.defClass(class AuthenticationKey extends(t("AuthenticationKey",e)){},function(t,e,n){this.publicRequestTypes("authenticationKeysByUserId","authenticationKeysByAddress","create","delete","getPreferredAuthenticationKey"),this.globalIndexes({authenticationKeysByAddress:"address/createdAt",authenticationKeysByUserId:"userId/updatedAt"}),this.addDatabaseFilters({fields:{address:["present","trimmedString"],denormalizedAddress:"trimmedString",user:["required","link"],lastUsedAt:"secondsTimestamp",useCount:"count"}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(651))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","DynamoDbPipeline","isValidVertical","pipelines","isObject","JSON","isString"],[e,n(741)],(t,e,n,r,o,s,a)=>{return i.defClass(class AuthenticationRequest extends(t("AuthenticationRequestMixin",e)){},function(t,e,l){this.globalIndexes({authenticationRequestsByAddress:"address/createdAt"}),this.addDatabaseFilters({fields:{address:"present email",denormalizedAddress:"present trimmedString",isNewUser:"boolean",used:"boolean",useCount:"number",vertical:{dataType:"string",validate:function(t){return!(null!=t)||n(t)}},imikimiUser:{preprocess:function(t){let e;return t&&i.exists(e=r.imikimiMigration)&&e.sanitizeImikimiUser(t)},postValidate:function(t){return(()=>{try{return o(t)&&s.stringify(t).length<500}catch(t){return!1}})()}},requestHandle:"trimmedString",reason:{dataType:"string",validate:function(t){return!t||a(t)&&"add"===t}}}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","DynamoDbPipeline"],[e,n(741)],(t,e)=>{return i.defClass(class Session extends(t("Session",e)){},function(t,e,n){this.publicRequestTypes("authenticate","bestEmailForCurrentUser","createAuthenticationRequest","currentUser","currentUserId","deleteAuthenticationKey","getAuthenticationKeys","logOut"),this.addDatabaseFilters({fields:{user:["required","link"]}}),this.filter({location:"both",before:{currentUserId:function({session:{userId:t}}){return t}}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(280)).addModules({Admin:n(745),BlockedUser:n(746),Message:n(747),RecentPost:n(748),SentNotification:n(749),TopCount:n(750),TopicInvite:n(751),TopicInviteLink:n(752),TopicMembership:n(753),UserFollower:n(754)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Pipeline","getArtConfigName","Promise","emailRegexp","merge"],[e,n(651),n(106)],(t,e,r,o,s)=>{let a;return({config:a}=n(560)),i.defClass(class Admin extends t{},function(t,n,l){let u,c;this.publicRequestTypes("authorized getUser switchUser"),this.prototype.isAdminSync=u=function(t){return!(!a.curators||!i.in(t,a.curators))},this.prototype.authorizedSync=c=function(t){let n,i;return({userId:n,adminUserId:i}=t.session),u(null!=i?i:n)||"Test"===e()},this.filter({name:"adminRequired",before:{all:function(t){return"authorized"===t.type?t:t.require(c(t),"admin")}}}),this.handler({authorized:function(t){return u(t.session.userId)},getUser:function(t){let e;return({key:e}=t),r.then(()=>o.test(e)?t.subrequest("authenticationKey","authenticationKeysByAddress",e).then(([t])=>i.exists(t)&&t.userId):e).then(e=>e&&t.subrequest("user","get",e))},switchUser:function(t){return t.subrequest("admin","getUser",t.key).then(e=>t.success({data:{user:e},session:s(t.session,{userId:e.id})}))}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["pipelines","formattedInspect"],[e,n(651)],(t,e)=>{return i.defClass(class BlockedUser extends(n(695)){},function(n,r,o){this.publicRequestTypes("create get isBlocked delete"),this.primaryKey("userId/blockedUserId"),this.addDatabaseFilters({fields:{user:{link:"user"},blockedUser:{link:"user"},reason:{present:!0,fieldType:"trimmedString",maxLength:80}}}),this.query({blockedUserByUserIdAndBlockedUserId:{query:function(t){let e,n;return[e,n]=t.key.split("/"),this.queryDynamoDbWithRequest(t,{where:{userId:e,blockedUserId:n}}).then(({items:t})=>t)},dataToKeyString:function({userId:t,blockedUserId:e}){return`${i.toString(t)}/${i.toString(e)}`}}}),this.handler({isBlocked:function(e){return t.blockedUser.get(e,{key:e.data,returnNullIfMissing:!0}).then(t=>{let e;return null!=(e=i.exists(t)&&t.reason)&&e})}}),this.filter({name:"publicCreateAccessRestructions",before:{create:function(t){let e,n;return({data:e,session:n}=t),t.requiredFields({userId:i.exists(e)&&e.userId,blockedUserId:i.exists(e)&&e.blockedUserId}).then(()=>t.requireServerOriginOr(e.userId===n.userId))}}}),this.filter({name:"auto-populate-userId",before:{create:function(t){let e,n;return({data:e,session:n}=t),e.userId?t:t.withMergedData({userId:n.userId})}}}),this.filter({name:"authorization",before:{delete:function(t){let n;return n=t.pipeline.toKeyObject(t.key),t.require(t.session.userId===n.userId,`current user (${i.toString(t.session.userId)}) must match userId in key: ${i.toString(e(n))}`)}}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin"],[e,n(651)],t=>{return i.defClass(class Message extends(t("MessageMixin",n(695))){},function(t,e,i){this.publicRequestTypes("create","messagesByPostId","get","delete"),this.globalIndexes({messagesByPostId:"postId/createdAt"}),this.addDatabaseFilters({fields:{post:"required link",text:"present trimmedString"},userOwned:{userCreatableFields:"postId text post",publicFields:!0}}),this.filter(n(708).LogCreateEventFilter),this.filter(n(707))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","secondsPer","Promise","pipelines","isMember","toSeconds","max","merge"],[e,n(651)],(t,e,r,o,s,a,l,u)=>{let c,h,p;return p=t(),c=p.enableRecentPostLimits,h=p.enforceRecentPostLimits,i.defClass(class RecentPost extends(n(695)){},function(t,n,p){let d,f,m,g,y,v,S;this.publicRequestTypes("recentPostCount","canPostInfo"),this.globalIndexes({recentPostsByUserId:"userId/createdAt"}),this.prototype.recentPostLimitsEnabled=c,this.prototype.recentPostLimitsEnforced=h,this.addDatabaseFilters({userOwned:!0,fields:{post:"link",expiresAt:"secondsTimestamp"}}),d=7,f=7*e.day,m=7,g=14,y=function(t){return t.session.userId?r.all([o.session.currentUser(t,{props:{include:!1}}),o.recentPost.recentPostsByUserId(t,t.session.userId)]).then(([t,e])=>{let n;return{secondsUntilCanPost:n=S(e),recentPostCount:e.length,currentUser:!!t,member:s(t),canPost:!o.recentPost.recentPostLimitsEnabled||t&&(n<=0||s(t))}}):r.resolve({canPost:!1,member:!1,currentUser:!1})},this.filter({before:{create:function(t){return t.withMergedData({expiresAt:a()+f|0})}}}),this.prototype.requireCanPost=function(t){return y(t).then(({canPost:e,member:n,secondsUntilCanPost:r})=>(o.event.createServerEvent({key:"server:recentPost:requireCanPostV2:"+(()=>{switch(!1){case!(e&&n):return"canPost:member";case!e:return`canPost:recentPostCountUnder${i.toString(7)}`;default:return`postDenied:recentPostCountOver${i.toString(6)}`}})(),session:t.session,originatedOnServer:!0,data:{canPost:e,secondsUntilCanPost:r,userId:t.session.userId,member:n}}),o.recentPost.recentPostLimitsEnforced||(e=!0),t.requireServerOriginOr(e,`. Become a full member to create more than ${i.toString(7)} posts per ${i.toString(7)} days.`)))},v=function(t,e){return e.expiresAt-t.expiresAt},S=function(t){let e,n;return l(0,(null!=(e=i.exists(n=t.sort(v)[6])&&n.expiresAt)?e:0)-a())},this.handlers({canPostInfo:function(t){return y(t).then(t=>u(t,{maxPostsPerTimespan:7,timespanInDays:7}))},recentPostCount:function(t){return o.recentPost.recentPostsByUserId(t,t.session.userId).then(t=>{let e;return e=a(),i.reduce(t,(t,e)=>t+1,(t,n)=>e<n.expiresAt,0)})}}),this.afterEvent({create:{post:function(t){return o.recentPost.create(t,{data:{userId:t.session.userId,postId:t.data.id}})}}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin"],[e,n(651)],t=>{return i.defClass(class SentNotification extends(t("SentNotification",n(695))){},function(t,e,n){this.globalIndexes({sentNotificationsByToUserId:"toUserId/createdAt"}),this.addDatabaseFilters({fields:{transport:{verify:function(t){return"email"===t}},type:"string",recordType:"string",recordId:"string",verificationKey:"string",toUser:{required:!0,link:"user"},expiresAt:"secondsTimestamp"}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{let t=e.Math;return i.importInvoke(["DynamoDbPipeline","merge","compactFlatten","pipelines"],[e,t,n(651)],(t,e,n,r)=>{return i.defClass(class TopCount extends t{},function(t,o,s){let a,l,u;this.primaryKey("recordId"),this.publicRequestTypes("createOrUpdate","topCountsByType","topCountsByTypeDesc","getAllTypes"),this.prototype.countFieldRegExp=a=/Count$/i,this.globalIndexes({topCountsByType:"type/count"}),this.addDatabaseFilters({fields:{type:["present","trimmedString"],recordId:"trimmedString",recordType:["present","trimmedString"],fieldName:["present","trimmedString"],count:"count"}}),this.prototype.getType=l=function(t){return`${i.toString(t.recordType)}/${i.toString(t.fieldName)}`},this.filter({name:"populate type field",before:{createOrUpdate:function(t){let n;return t.withMergedProps({data:e(t.data,{type:l(t.data)}),key:null!=(n=t.key)?n:t.data.recordId})}}}),this.filter({name:"normalize key",before:{topCountsByType:u=function(t){return null!=t.key?t:t.withMergedProps({key:l(t.props)})},topCountsByTypeDesc:u}}),this.filter({location:"client",before:{getAllTypes:function(){return n(i.array(r,t=>{let e;return e=t.pipelineName,i.array(t.fields,(t,n)=>l({recordType:e,fieldName:n}),(t,e)=>a.test(e))}))}}}),this.handlers({getAllTypes:function(){}}),this.filter({name:"requireServerOrigin",before:{all:function(t){return t.requireServerOrigin()}}})})})})}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","secondsPerDay","toSeconds"],[e,n(651)],(t,e,r)=>{return i.defClass(class TopicInvite extends(t("TopicInvite",n(695))){},function(t,n,o){this.publicRequestTypes("accept","decline","get","create","delete","topicInvitesByUserId","topicInvitesByTopicId"),this.primaryKey("topicId/userId"),this.globalIndexes({topicInvitesByUserId:"userId/createdAt"}),this.addDatabaseFilters({fields:{user:["required","link"],topic:["required","link"],invited:["required","boolean"],invitedByUser:["required","link"],invitedAt:"secondsTimestamp",acceptedAt:"secondsTimestamp",declinedAt:"secondsTimestamp"}}),this.filter({name:"inviteOnCreate",group:"outer",location:"client",before:{create:function(t){return t.withMergedData({invited:!0})}}}),this.prototype.topicInviteExpiration=7*e,this.prototype.inviteIsExpired=function(t){return t&&r()-r(t.invitedAt)>this.topicInviteExpiration},this.prototype.inviteIsOutstanding=function(t){return i.exists(t)&&t.invited&&!(null!=t.acceptedAt)&&!(null!=t.declinedAt)&&!this.inviteIsExpired(t)},this.prototype.inviteWasDeclined=function(t){return i.exists(t)&&t.invited&&null!=t.declinedAt&&!this.inviteIsExpired(t)},this.prototype.inviteWasAccepted=function(t){return i.exists(t)&&t.invited&&null!=t.acceptedAt&&!this.inviteWasDeclined(t)},this.prototype.getInviteStatus=function(t){return(()=>{switch(!1){case!this.inviteIsOutstanding(t):return"outstanding";case!this.inviteWasDeclined(t):return"declined";case!this.inviteWasAccepted(t):return"accepted"}})()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","appendQuery","pipelines","getEnv","present"],[e,n(651)],(t,e,r,o,s)=>{return i.defClass(class TopicInviteLink extends(t("TopicInviteLink",n(695))){},function(t,n,i){this.publicRequestTypes("get","createPersonalTopicInvite","create","topicInviteLinksByTopicId"),this.globalIndexes({topicInviteLinksByTopicId:"topicId/createdAt"}),this.addDatabaseFilters({fields:{topic:["required","link"],useCount:"count",expiresAt:"secondsTimestamp",invitedByUser:[{link:"user"},"required","prefetch"]},linkFilterVersion:2}),this.prototype.createInviteLinkUrl=function(t){return e(r.topic.getConnonicalUrl(t.topicId),{streamInvite:t.id})},this.prototype.getTopicInviteLinkIdFromEnv=function(){let t;return t=o().streamInvite,s(t)?t:void 0}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin"],[e,n(651)],t=>{return i.defClass(class TopicMembership extends(t("TopicMembership",n(695))){},function(t,e,n){this.publicRequestTypes("topicMembershipsByTopicId","topicMembershipsByUserId","get","update","delete","canView","canAdmin","canPost"),this.primaryKey("topicId/userId"),this.globalIndexes({topicMembershipsByUserId:"userId/createdAt"}),this.addDatabaseFilters({fields:{user:["required","link"],topic:["required","link"],canPost:"boolean",canAdmin:"boolean"}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){let e=n(3);e.defMod(t,()=>e.defClass(class UserFollower extends(n(700)){},function(t,e,n){let i;this.primaryKey("userId/followedUserId"),this.publicRequestTypes("userFollowersByFollowedUserId","userFollowerByUserId"),this.globalIndexes({userFollowersByFollowedUserId:"followedUserId/createdAt"}),this.query({userFollowerByUserId:{query:function(t){return this.queryDynamoDbWithRequest(t,{where:{userId:t.key}}).then(({items:e})=>t.success({data:e}))},dataToKeyString:function({userId:t}){return t}}}),this.addDatabaseFilters({userOwned:!0,fields:{followedUser:{include:!0,link:"user"},followingCount:"count"}}),this.filter({before:{userFollowersByFollowedUserId:i=function(t){let e;return t.requiredFields((({key:e=t.session.userId}=t),{key:e})).then(e=>t.withMergedProps(e))},userFollowerByUserId:i}}),this.afterEvent({delete:{channelTopic:function(t){return this.decreaseFollowingCount(t)}},create:{channelTopic:function(t){return this.increaseFollowingCount(t)}}})}))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(282)).addModules({StripeCustomer:n(756),StripeSubscription:n(757)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","Pipeline"],[e,n(651)],(t,e)=>{return i.defClass(class StripeCustomer extends(t("StripeCustomer",e)){},function(t,e,n){this.publicRequestTypes("get","setDefaultCard","deleteCard","addCard","syncUsers","create","purchaseMembershipTime","purchaseMembershipTimePlans")})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ServerSideMixin","Pipeline"],[e,n(651)],(t,e)=>{return i.defClass(class StripeSubscription extends(t("StripeSubscription",e)){},function(t,e,n){this.publicRequestTypes("start","cancel","resume","refreshFromStripe","membershipPlans","addFreeTime")})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(303)).addModules({AgeString:n(759),CurrentSubscription:n(761),Feedback:n(762),PostBackMap:n(763),Share:n(764),StandardImport:n(760),ViewState:n(765)}),n(766),n(1004),n(1008)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxModel","toSeconds","dateAgeString"],[e,n(760)],(t,e,n)=>{return i.defClass(class AgeString extends t{constructor(){super(...arguments)}},function(t,r,o){this.prototype.toKeyString=function(t){return`${i.toString(t)}`},this.prototype.secondPassed=function(){return i.each2(this.fluxStoreEntries,(t,e)=>this.load(t)),null},this.prototype.toFluxKey=function(t){return`${i.toString(e(t))}`},this.prototype.loadData=function(t){return n(t,!0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(268))}).call(this,n(2)(t))},function(t,e,n){(function(t,e){var i,r,o,s,a,l,u,c,h,p,d,f,m,g={}.hasOwnProperty;m=n(760),p=m.objectWithout,u=m.isSubscriberMember,h=m.merge,m.timeout,d=m.pipelines,a=m.defineModule,c=m.log,r=m.ErrorWithInfo,o=m.FluxSubscriptionsMixin,m.currentSecond,m.timeout,s=m.Promise,i=m.ApplicationState,f=m.present,l=m.getVerticalProductName,a(t,function(t){var n;function CurrentSubscription(){CurrentSubscription.__super__.constructor.apply(this,arguments),this.subscribeOnModelRegistered({modelName:"currentSession",key:"currentUser",updatesCallback:this._loadDetails})}return function(t,e){for(var n in e)g.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(CurrentSubscription,o(i)),CurrentSubscription.stateFields({subscribed:!1,subscriptionDetails:null,currentAbTestName:null}),CurrentSubscription.prototype._loadDetails=function(){var t,e;return(null!=(t=this.models.currentSession.currentUser)?t.stripeCustomerId:void 0)?d.stripeCustomer.get().then((e=this,function(t){e.subscriptionDetails=t})):this.subscriptionDetails=null},CurrentSubscription.prototype.createEvent=function(t,e){var n;if(n=this.models.subscriptionPromptState.expiredUserInterventionMessageShown?this.models.subscriptionPromptState.expiredUserInterventionEventKey:"normal",this.models.event.create("currentSubscription:"+t+":"+n,{data:e}),this.currentAbTestName)return this.models.abTest.createEvent(this.currentAbTestName,"currentSubscription:"+t+":"+n,{data:e})},CurrentSubscription.prototype.filterEventData=function(t){return t&&(t.token&&(t=p(t,"token")),t.stripeEmail&&((t=p(t,"stripeEmail")).address=t.stripeEmail)),t},CurrentSubscription.prototype.createRequestEvents=function(t,e,n){return this.createEvent(t+":start"),e.tap((i=this,function(e){return i.createEvent(t+":success",i.filterEventData(h(e,n))),null})).tapCatch(function(e){return function(i){var r,o;return r=i.message,o=i.status,e.createEvent(t+":failure",h({message:r,status:o},n)),null}}(this));var i},CurrentSubscription.prototype.cancel=function(){return this.createRequestEvents("cancel",d.stripeSubscription.cancel()).then(this._loadDetails)},CurrentSubscription.prototype.resume=function(){return this.createRequestEvents("resume",d.stripeSubscription.resume()).then(this._loadDetails)},CurrentSubscription.prototype.addPaymentMethod=function(t){var e;return null==t&&(t={}),e=t.opened,this.createRequestEvents("addPaymentMethod",this.showStripeDialog({stripeCheckoutOptions:{label:"add card",panelLabel:"add card",opened:e}})).then(function(t){var e;return e=t.token,t.stripeEmail,d.stripeCustomer.addCard({data:{token:e}})}).then(this._loadDetails)},CurrentSubscription.prototype.setDefaultPaymentMethod=function(t){return this.createRequestEvents("setDefaultPaymentMethod",d.stripeCustomer.setDefaultCard({data:{cardId:t}})).then(this._loadDetails)},CurrentSubscription.prototype.deletePaymentMethod=function(t){return this.createRequestEvents("deletePaymentMethod",d.stripeCustomer.deleteCard({data:{cardId:t}})).then(this._loadDetails)},n=function(t){var e,n,i;return i=t.intervalCount,n=t.interval,e=t.id,n?i>1?""+i+n:n:e},CurrentSubscription.prototype.promptForPayment=function(t,e,i){var r,o,s,a,l;return s=t.plan,o=t.opened,a=t.stripeDialogDescription,r=n(s),this.createEvent(e+":preStripe:"+r),d.session.currentUser().then((l=this,function(t){var e;return u(t)?"already member":(e={panelLabel:"pay "+s.humanPaymentInfo,opened:o},(t.stripeCustomerId?d.stripeCustomer.get({returnNullIfMissing:!0}).then(function(t){return t?0===t.paymentMethods.length?l.addPaymentMethod().then(function(){return{}}):{}:l.showStripeDialog({stripeCheckoutOptions:e,stripeDialogDescription:a})}):l.showStripeDialog({stripeCheckoutOptions:e,stripeDialogDescription:a})).then(i))})).tap(function(t){return function(n){return t.createEvent(e+":postStripe:success:"+r)}}(this)).catch(function(t){return function(n){var i;if(null!=(i=n.info)?i.userAborted:void 0)return t.createEvent(e+":postStripe:userAborted:"+r),"userAborted";throw c({promptForPayment:{error:n}}),n}}(this))},CurrentSubscription.prototype.purchaseMembershipTime=function(t){var e,n,i;return n=t.plan,e=t.opened,this.promptForPayment({plan:n,opened:e,stripeDialogDescription:"Purchase Membership Time"},"purchaseMembershipTime",(i=this,function(t){var e,r;return r=t.token,e=t.stripeEmail,i.createRequestEvents("stripeCustomer.purchaseMembershipTime",d.stripeCustomer.purchaseMembershipTime({data:{plan:n.id,token:r,stripeEmail:e}}))}))},CurrentSubscription.prototype.start=function(t){var e,n,i;return n=t.plan,e=t.opened,this.promptForPayment({plan:n,opened:e},"subscribe",(i=this,function(t){var e,r;return r=t.token,e=t.stripeEmail,i.createRequestEvents("stripeSubscriptionStart",d.stripeSubscription.start({data:{plan:n.id,token:r,stripeEmail:e}}))}))},CurrentSubscription.prototype.loadStripeCheckout=function(){var t;return t=e.StripeCheckout?s.resolve(e.StripeCheckout):new s(function(t,n){var i;return(i=document.createElement("script")).type="text/javascript",document.body.appendChild(i),i.onerror=function(){return n(new Error("Could not load Stripe checkout."))},i.onload=function(){return t(e.StripeCheckout)},i.src="https://checkout.stripe.com/checkout.js"}),this.loggedOnce?t:(this.loggedOnce=!0,this.createRequestEvents("loadStripe",t))},CurrentSubscription.prototype.showStripeDialog=function(t){var e,n,i;if(null==t&&(t={}),i=null!=(e=t.stripePublishableKey)?e:Neptune.Imikimi.Oz.config.stripe.publishable,t.stripeCheckoutOptions,n=t.stripeDialogDescription,!f(i))throw c({keyConfigPath:"Neptune.Imikimi.Oz.config.stripe.publishable",configPath:"Neptune.Imikimi.Oz.config",config:Neptune.Imikimi.Oz.config}),new Error("expecting stripePublishableKey");return this.createRequestEvents("showStripeDialog",s.all([d.session.bestEmailForCurrentUser(),this.loadStripeCheckout()]).then(function(e){var o,a;return a=e[0],o=e[1],new s(function(e,s){var u;return u=!1,o.configure(h(null!=t?t.stripeCheckoutOptions:void 0,{key:i,locale:"auto",token:function(t){return u=!0,e({token:t.id,stripeEmail:t.email})},closed:function(){if(!u)return s(new r("user closed stripe dialog",{userAborted:!0}))}})).open({name:l(),email:a,description:null!=n?n:"Membership Subscription"})})}))},CurrentSubscription}())}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxModel","getEnv","generateQuery","upperCamelCase","document","JSON","Neptune","formattedInspect","openLink","encodeMailto","applyStringVariables","StringConstants"],[e,n(160).Browser,n(760)],(t,n,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class Feedback extends t{},function(t,f,m){this.getter({currentUser:function(){return this.models.currentSession.currentUser},referralLink:function(){return this.currentUser&&`http://${i.toString(n().host)}?${i.toString(r({referrer:this.currentUser.id,from:o(this.currentUser.displayName)}))}`},memberInfo:function(){let t,n;return`--------------------------------------------------------------\nIMIKIMI ZO HELP INFORMATION\nURL: ${i.toString(s.location)}\nMember Name: ${i.toString(i.exists(t=this.currentUser)&&t.displayName||"(anonymous)")}\nMember ID: ${i.toString(i.exists(n=this.currentUser)&&n.id||"(anonymous)")}\nUser Agent: ${i.toString(e.navigator.userAgent)}\nVersions: ${i.toString(a.stringify(l.getVersions()))}\n${i.toString(u(this.models.navState.feedbackEmailState).slice(0,1e3))}`}}),this.prototype.sendFeedback=function(t){return this.models.event.create("feedback:send"),c(h({to:"feedback@imikimi.com",subject:"Imikimi Zo Help",body:`Thank you for using Imikimi Zo. How can we help you today?\n\n--------------------------------------------------------\nProblem Reports\n\nIf you are reporting a problem, help us help you: Answer as many of the questions below as you can so we can help you with your problem quickly and concisely.\n\n> What are you trying to do?\n\n> What exactly happens?\n\n> Was that different than what you've seen before? How?\n\n> Did you recently change computers, operating systems, or browsers?\n\n> Copy/Paste any error messages\n\n> Send screenshots of each step of what you are seeing. That REALLY helps our techs see what you are seeing. If you don't know how to do a screenshot, a good photo of your screen taken with your phone or digital camera usually works fine.\n\n> Did you try a different browser? A different computer? A different wifi? Does that change anything?\n\n${i.toString(this.memberInfo)}\n\n${i.toString(null!=t?t:"")}`}))},this.prototype.requestSponsorship=function(){return this.models.event.create("feedback:requestSponsorship"),c(h({to:"feedback@imikimi.com",subject:"Imikimi Zo Sponsorship",body:`Please tell us why you'd like to request sponsorship for full Imikimi Zo Membership.\n\n${i.toString(this.memberInfo)}`}))},this.prototype.emailReferralLink=function(){return this.currentUser?(this.models.event.create("mail:emailReferralLink"),c(h({body:p(d.referrals.emailBody,{referralLink:this.referralLink})}))):void 0}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState"],[e,n(760)],t=>{return i.defClass(class PostBackMap extends t{},function(t,e,n){this.prototype.add=function(t,e){return t&&e&&t!==e?this.setState(t,e):void 0}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxModel","pipelines","openLink","encodeUri","lowerCase","peek","getEnv","getShortCaption","getDisplayTitle","Neptune","String","uriPathJoin","downloadFromUrl","Promise","getMediaUrlForPost","getArrayBuffer","merge","randomString","downloadBinaryData","models","getShortDisplayName","encodeMailto","pluralize","logPromise","vertical","log","binary","isString"],[e,n(760),n(197),n(212)],(t,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I)=>{return i.defClass(class Share extends t{},function(t,M,A){let F;this.prototype.sharePostOnFacebook=function(t){return this.models.event.create({key:"share:facebook",data:{post:t}}),n.post.getConnonicalUrlAsync(t).then(F)},this.prototype.shareUrlOnFacebook=F=function(t){return r(o({uri:"https://www.facebook.com/sharer/sharer.php",query:{u:t}}))},this.prototype.logPostLinkCopied=function(t){return this.models.event.create({key:"share:copyPostLink",data:{post:t}})},this.prototype.sharePostOnPinterest=function(t){return this.models.event.create({key:"share:pinterest",data:{post:t}}),n.post.getConnonicalUrlAsync(t).then(t=>r(o({uri:"http://pinterest.com/pin/create/button",query:{url:t}})))},this.prototype.downloadFullSizePhoto=function(t,e){let n,r,o,w,x,P,C,_,E;return i.exists(e)&&(n=e.topic),r="image/"+(o=s(a(t.mediaFile.split(".")))),w=l().curate?`post_${i.toString(t.id)} - user_${i.toString(t.userId)}`:(null!=(_=null!=(E=u(t))?E:n&&c(n))?_:"imikimi zo photo").replace(/[^-_\w ]+/g," ").replace(/\ +/g," ").trim(),w=`${i.toString(w)}.${i.toString(o)}`,this.models.event.create({key:"share:download",data:{post:t,url:C,mimeType:r,fileType:o,filename:w}}),(x=h.Art.Ery.getArtEryRemoteServer())?(P=`/api/download/${i.toString(t.mediaFile)}`,i.is(x,p)&&(P=d(x,P)),f(P,w),m.resolve()):(C=g(t,"max"),y(g(t,"original"),v({verbose:!0,query:{cacheBust:S(16)}},e)).then(t=>b(w,t,r)))},this.prototype.downloadBitmap=function(t){return t.toJpg().then(({arrayBuffer:t})=>b("zoImage",t,"image/jpeg"))},this.prototype.getPostInfo=function(t){return m.deepAll({topic:w.topic.get(t.topicId),user:w.user.get(t.userId)})},this.prototype.getPostTitle=function(t,e,n){let r,o;return({currentUser:r}=h.Art.Flux.models.currentSession),[null!=(o=u(t))?o:null!=t.templateFile||null!=t.templatePostId?"A Kimi":"A post","from",(i.exists(r)&&r.id)===t.userId?"my":x(n)+"s",e&&e.title+" zoStream"].join(" ")},this.prototype.sharePostViaEmail=function(t){return this.getPostInfo(t).then(({topic:e,user:o})=>n.post.getConnonicalUrlAsync(t).then(n=>{let s,a,l,u;return s=h.Art.Flux.models.currentSession.currentUser,a=null!=t.templateFile||null!=t.templatePostId,l=(i.exists(s)&&s.id)===t.userId,u=(i.exists(s)&&s.id)===e.userId,r(P({subject:this.getPostTitle(t,e,o),body:`I wanted to share ${i.toString(l?"my":o.displayName+"'s")} ${i.toString(a?"kimi":"post")} with you.\n\nLink: ${i.toString(n)}\n\nFrom ${i.toString(u?"my":"the")} Zo Stream: ${i.toString(e.title)} (${i.toString(C(e.postCount,"post"))})\n\nYou can follow ${i.toString(u?"my":"this")} stream and keep up with ${i.toString(u?"my":"the")} latest posts. Click on the link above then click 'follow.'`}))}))},this.prototype.nativeSharePhoto=function(t,e){return m.then(()=>t.toJpgUri?t.toJpgUri(95):g(t,"max")).then(t=>this.nativeShare(v(e,{files:[t]})))},this.prototype.nativeSavePhoto=function(t,n){let r;return _(`nativeSavePhoto (${i.toString(E)})`,y(r=g(t,"original"),T(v({verbose:!0,query:{cacheBust:S(16)}},n))).then(t=>k(t).toBase64()).then(t=>(T({nativeSavePhoto3:t.length}),new m((n,r)=>e.imageSaver.saveBase64Image({data:t,prefix:`${i.toString(E)}_`},n,r)))))},this.prototype.nativeShareLink=function(t,e){return(I(t)?m.resolve(t):n.post.getConnonicalUrlAsync(t)).then(t=>this.nativeShare(v(e,{url:t})))},this.prototype.nativeShare=function(t){let n,r;return(n=i.exists(r=e.plugins)&&r.socialsharing)?new m((e,i)=>n.shareWithOptions(t,e,i)):(T({nativeShare:t}),m.resolve())},this.prototype.savePhoto=function(t,n){return e.imageSaver?this.nativeSavePhoto(t,n):this.downloadFullSizePhoto(t,n)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ImikimiStyles","getEnv","ReschedulableTimer","ApplicationState","getDevicePixelRatio","getIsMobileBrowser","isNumber","getOrientationAngle","getCssSafeAreaInset","min","point","getSimpleBrowserInfo","getScreenSize","log","isNaN","formattedInspect","Error","max"],[e,n(760)],(t,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b)=>{let w,x,P,C,_,E,T;return w=t.touchButtonSize,x=t.desktopButtonSize,P=e.screen,C=n(760).simpleBrowserInfo,_=E=r().previewNotch,T=new o,i.defClass(class ViewState extends s{constructor(){super(...arguments),e.window.addEventListener("orientationchange",()=>this.update())}},function(t,n,r){let o,s,k,I,M,A,F,B,R,z,O;o=2,s=10,k=459,I=432,M={top:0,left:0,right:0,bottom:0},this.stateFields({devicePixelsPerPoint:A=a(),gridSize:20,viewSize:null,viewWidth:null,viewHeight:null,fullScreen:!1,smallTabBar:!1,feedWidth:P.width,popOverWidth:P.width,feedSpacing:2,isTouchScreen:C.touch,isMobileBrowser:l(),isMobile:l(),zo:!0,buttonSize:w,tabBar:"top",externalPrevNextButtons:!1,nativeApp:F=C.nativeApp,keyboardVisible:!1,simpleBrowserInfo:C,safePadding:M,suggestedPadding:M}),B=function(t){let e;return u(e=c())?e%180==0:null==t||t.x<=t.y},R=function(){return _||"iPhoneX"===C.subDevice||"iPhoneXSMax"===C.subDevice},z=function(t){return"iOS"===C.os?i.object(t,t=>44===t?30:t):t},O=function(){let t,e,n,i;return t=e=h(),(n=R())?(E=_||n&&C.fakeNativeApp,{notchHeight:30,notchWidth:i=209,antiNotchWidth:(p(P.availWidth,P.availHeight)-i)/2,roundedCornerRadius:40,notchLocation:B()?"top":90===c()?"left":"right",safePadding:z(t),suggestedPadding:e}):{safePadding:z(t),suggestedPadding:e}},this.prototype.update=function(){return this.setViewSize(this.viewSize)},this.setter({viewSize:function(t){return this.refresh(d(t))}}),this.prototype.refresh=function(t,n){let r,o,s,a,l,u,c,h,d,P,_,k,I,M,A,R,z,L,D,N,U,W,j,q,H,V,$,G,Y,K,X,J,Q,Z,tt,et,nt,it,rt,ot,st,at,lt,ut;switch(null!=t||(t=this.viewSize),({window:r,navigator:o}=e),C=f(),s=t.x,a=t.y,l=(lt=m()).x,u=lt.y,c=C.deviceType,h=C.touch,d=C.deviceMinorScreenSize,F=C.nativeApp,P=(ut=O()).notchHeight,_=ut.notchWidth,k=ut.roundedCornerRadius,I=ut.notchLocation,M=ut.safePadding,A=ut.suggestedPadding,R=ut.antiNotchWidth,z=L=D=!1,c){case"phone":z=!0;break;case"tablet":L=!0;break;case"desktop":D=!0}if(null!=n||(n=this.keyboardVisible),F?e.Keyboard&&!!n!=!!e.Keyboard.isVisible&&(g("set keyboardTimer"),T.timeout(250,()=>(g(`keyboardTimer keyboardVisible: ${i.toString(!!e.Keyboard.isVisible)}`),this.refresh(null,!!e.Keyboard.isVisible)))):"android"===C.os&&(n=a<.5*u),N=!B(t),U=z&&N,W=s>=600&&!z,j=(()=>{switch(!1){case!D:return a<600;case!z:return N;default:return!1}})(),q=!h&&s<550,H=w,V=D?x:w,$=0,G=n&&z&&!U?"hidden":U?(H=55,"right"):(W||(H=w),z?"bottom":"top"),Y=s,K=X=W&&s>1200?459:p(Y,432),J=X/27,$="right"===G?V+M.right+J/2:0,y(J))throw g(v({ViewStateFAIL:{gridSize:J,feedWidth:X,fullScreen:W,viewWidth:s,maxFeedWidth:459,minFeedWidth:Y,midFeedWidth:432,viewSize:t}})),new S("gridSize is NaN");switch(Q=s,"right"===G&&(Q-=H),Z=(Q-X)/2,tt=n?u:a-("bottom"===G||"top"===G?H:0),et=s-2*$,G){case"bottom":tt-=M.bottom;break;case"top":tt-=M.top;break;case"right":K=et}return it=(nt=b(X,p(46*J,tt)))<X+8*J,rt=W?J:2,this.setState({viewSize:t,deviceType:c,isPhone:z,isTablet:L,isDesktop:D,simpleBrowserInfo:C,smallTabBar:q,viewWidth:s,viewHeight:a,screenWidth:l,screenHeight:u,reducedHeightMode:j,fullscreen:W,fullscreenPostWidth:ot=W?700:X,fullScreen:W,fullScreenPostWidth:ot,tabBarHeight:H,tabBarWidth:$,tabBar:G,buttonSize:V,smallButtonSize:st=35,reducedButtonSize:at=40,autoReducedButtonSize:(()=>{switch(!1){case!D:return x;case!(d<=320):return 40;default:return V}})(),heightAdjustedButtonSize:U?35:V,gridSize:J,shortFeed:it,feedWidth:X,paddedFeedWidth:p(X,s-2*J),feedHeight:nt,feedPosition:Z,feedSpacing:rt,popOverWidth:K,landscape:U,mainAreaHeight:tt,mainAreaWidth:et,externalPrevNextButtons:s-4*J-3*V>=X,notchHeight:P,notchWidth:_,roundedCornerRadius:k,notchLocation:I,antiNotchWidth:R,safePadding:M,suggestedPadding:i.object(A,t=>b(t,J)),keyboardVisible:n,previewNotch:E,touchButtonSize:w,desktopButtonSize:x,isTouchScreen:h,nativeApp:F})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(304)).addModules({AbTest:n(767),FeaturedKimiTags:n(769),FollowingTopic:n(770),GdprComplianceState:n(771),HidingTopic:n(772),NavState:n(773),NewPostState:n(775),NewsState:n(777),PosterTextState:n(778),SearchState:n(1001),StandardImport:n(768),SubscriptionPromptState:n(1002),UrlBarState:n(1003)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","boolRand","toSeconds","log"],[e,n(768)],(t,e,r,o)=>{return i.defClass(class AbTest extends(n(594)(t)){},function(t,n,s){this.persistant(),this.prototype.testGroup=function(t){let n;return null==(n=this.state[t])&&(this.onNextReady(()=>this.createEvent(t,"assign")),this.setState(t,n={testGroup:e(),createdAt:0|r()}),o({AbTest:{assign:{testName:t,testGroup:n.testGroup}}})),n.testGroup},this.prototype.controlGroup=function(t){return!this.testGroup(t)},this.prototype.createEvent=function(t,e,n){return this.state[t]?s.createEvent.call(this,`${i.toString(this._getEventNameRoot(t))}:${i.toString(e)}`,n):o.warn(`AbTest.createEvent: '${i.toString(t)}' test not started. Not logging event: '${i.toString(e)}'`)},this.prototype._getEventNameRoot=function(t){return`${i.toString(t)}:${i.toString(this.testGroup(t)?"test":"control")}Group`}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=n(760)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["compactFlatten","toDate","Date"],[e,n(768)],(t,e,n)=>{let r,o;return t([(r=function(t,r=new n){let o,s,a;return r=e(r),o=100*(r.getMonth()+1)+r.getDate(),s=null,a=1e3,i.each2(t,(t,e)=>{let n;return 0<(n=(e|=0)-o)&&(!s||n<a)?(s=t,a=n):void 0}),s})({"0216":["valentinesDay","inLove","loveMyGirl","loveMyGuy","roses","flowers"],"0306":["carnival","costumes","parade","greatestShowOnEarth","brazil","rioDeJaneiro"],"0318":"stPatricksDay","0320":"marchEquinox","0421":"easter","0512":"mothersDay","0621":"summerSolstice","0923":"fallEquinox",1031:["halloween","vampire","ghost","zombie","trickOrTreat","witch","pumpkins","jackOLantern"],1131:["thanksgiving","turkey","pumpkins"],1231:["winterSolstice","santaClause","christmas","santa","hanukkah","jesus","christmasLights","happyHolidays","seasonsGreetings","solstice","newYearsEve","2019","newYearsResolutions","happyNewYear"]}),r({1031:["autumn","fall","leaves","fallColors","harvest"],1231:o=["winter","snow"],"0229":o,"0531":"spring","0801":"summer"}),"abstract","anniversary","beautiful","birthdays","childloss","coffee","colorful","family","goodEvening","goodMorning","goodNight","grief","heaven","inMemoryOf","kids","loss","love","memorial","mountain","nature","ocean","portrait","river","romantic","scenery","sunset","tiger","toast","wolf"]).sort()}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxSubscriptionsMixin","ApplicationState","isPlainObject","logRejectedPromises","timeout","Promise","pipelines","merge"],[e,n(768)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class FollowingTopic extends(t(e)){constructor(){super(...arguments),this._subscribeToChannelChanges()}},function(t,e,u){this.stateFields({followingTopics:[]}),this.prototype.toggleFollowing=function(t,e){return this._followRequest("toggleFollowing",t,e)},this.prototype.follow=function(t,e){return this._followRequest("follow",t,e)},this.prototype.unfollow=function(t,e){return this._followRequest("unfollow",t,e)},this.prototype._followRequest=function(t,e,s){let a,l;return a=n(e)?e.id:e,this.models.currentSession.currentUserId?("toggleFollowing"===t&&this.state[a],this.setState(a,l="follow"===t),this.models.event.create(`topic:${i.toString(this.state[a]?"unfollow":"follow")}`,{data:{topicId:a}}),r("_followRequest",this.models.channel[t]({props:{include:!l},data:{channelId:this.models.navState.currentChannelId,topicId:a,subscribed:s}})).then(()=>this.models.navState.currentChannelId?void 0:o(100,()=>this.models.currentSession.reload()))):this.models.navState.showLogin({reason:"followTopic"})},this.prototype._subscribeToChannelChanges=function(){return this.subscribeOnModelRegistered({modelName:"navState",key:"currentChannelId",updatesCallback:({data:t})=>this._subscribeToChannelTopics(t)})},this.prototype._subscribeToChannelTopics=function(t){return t||this.resetState(),this.subscribe({modelName:"channelTopicsByChannelId",subscriptionKey:"channelTopicsByChannelId",key:t,updatesCallback:({data:t})=>s.all(i.array(t,t=>t.topic?t:a.topic.get({key:t.topicId}).then(e=>l(t,{topic:e})))).then(t=>{let e;return this.replaceState(l(e=l({followingTopics:i.array(t).sort((t,e)=>e.topic.lastPostCreatedAt-t.topic.lastPostCreatedAt)},i.object(t,t=>!0,null,null,t=>t.topicId)),i.object(this.state,(t,e)=>!1,(t,n)=>!e[n])))})})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","toSeconds"],[e,n(768)],(t,e)=>{return i.defClass(class GdprComplianceState extends t{},function(t,n,i){this.persistant(),this.stateFields({userAcceptedTracking:!1,userAcceptedTrackingAt:null}),this.prototype.acceptTracking=function(){return this.setState({userAcceptedTracking:!0,userAcceptedTrackingAt:0|e()})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxSubscriptionsMixin","ApplicationState","pipelines","merge"],[e,n(768)],(t,e,n,r)=>{return i.defClass(class HidingTopic extends(t(e)){constructor(){super(...arguments),this._subscribeToUserChanges()}},function(t,e,o){this.stateFields({hiddenTopicsLoaded:!1,hiddenTopicCount:0}),this.prototype.hideTopic=function({topicId:t,reason:e,alsoNotify:i,hiddenOnPostId:r}){return this.setState(t,{id:t}),n.topicHide.hideTopic({key:t,data:{hiddenOnPostId:r,reason:e},props:{alsoNotify:i}})},this.prototype._subscribeToUserChanges=function(){return this.subscribeOnModelRegistered({modelName:"currentSession",key:"currentUserId",updatesCallback:({data:t})=>this._subscribeToHiddenTopics(t)})},this.prototype._subscribeToHiddenTopics=function(t){return t||this.resetState(),this.subscribe({modelName:"topicHidesByUserId",subscriptionKey:"topicHidesByUserId",key:t,updatesCallback:({data:t})=>this.replaceState(r({hiddenTopicsLoaded:!0,hiddenTopicCount:i.exists(t)&&t.length||0},i.object(t,({topicId:t})=>{},null,null,({topicId:t})=>t)))})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M={}.hasOwnProperty;(E=n(768)).formattedInspect,o=E.Promise,a=E.array,S=E.merge,k=E.w,g=E.isPlainObject,T=E.timeout,E.parseQuery,E.present,E.lowerCamelCase,p=E.defineModule,P=E.pipelines,v=E.log,C=E.propsEq,y=E.isString,e=E.ApplicationState,r=E.FluxSubscriptionsMixin,f=E.getTemplateUrlForPost,E.Bitmap,u=E.arrayWithoutLast,l=E.arrayWith,_=E.randomSort,x=E.peek,b=E.object,y=E.isString,m=E.isObject,w=E.objectWithout,T=E.timeout,E.isBoolean,E.isNumber,h=E.currentSecond,k=E.w,I=E.zoPickImage,E.missing,E.networkFailure,i=E.EventLogMixin,E.config,d=E.getEnv,E.toSeconds,E.formatDate,c=E.clientFailureNotAuthorized,s=E.StringConstants,p(t,function(t){var p,E,A,F,B,R,z;function NavState(){NavState.__super__.constructor.apply(this,arguments),this._subscribeToUserChanges()}return function(t,e){for(var n in e)M.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(NavState,i(r(e))),NavState.eventKey("navigate"),NavState.prototype.featuredCategories=E=n(769),NavState.prototype.featuredCategoryTags=function(){var t,e,n;for(n=[],t=0,e=E.length;t<e;t++)p=E[t],n.push("#"+p);return n}(),NavState.stateFields({searchVisible:!1,searchBarVisible:!1,searchOptions:d().zoStream?{order:"createdAt"}:{searchKimis:!0,order:"trending"},featuredKimiTags:function(){var t,e,i,r;for(r=[],t=0,e=(i=_(E).concat(_(n(774)).slice(0,5)).slice(0,3)).length;t<e;t++)p=i[t],r.push("#"+p);return r}(),overlay:null,currentChannelId:null,loading:!0,feedScrollingActive:!1,navStack:[],currentTab:"ZoHome",sortMode:"trending"}),NavState.prototype.searchWithinUserId=function(t){return this.search({userId:t,order:"date"})},NavState.prototype.searchWithinTopicId=function(t){return this.search({topicId:t,order:"date"})},NavState.prototype.toggleSearchKimis=function(){return this.updateSearch({searchKimis:!this.searchOptions.searchKimis})},NavState.prototype.clearSearchKimis=function(){return this.updateSearch({searchKimis:!1})},NavState.prototype.setSearchKimis=function(){return this.updateSearch({searchKimis:!0})},NavState.prototype.removeSearchOption=function(t){return this.searchOptions=w(this.searchOptions,t)},NavState.prototype.sortByTrending=function(){return this.updateSearch({order:"trending"})},NavState.prototype.sortByDate=function(){return this.updateSearch({order:"date"})},NavState.prototype.sortByUses=function(){return this.updateSearch({order:"uses"})},NavState.getter({humanSortName:function(t){var e;switch(null==t&&(t=null!=(e=this.searchOptions)?e.order:void 0),t){case"uses":return"uses";case"date":return"new";default:return"trending"}},currentPageName:function(){var t;return null!=(t=x(this.navStack))?t.pageName:void 0},overlayVisible:function(){return!!this.overlay}}),NavState.prototype.showTab=function(t){return this.currentTab=t,this.overlay=null,this.navStack=[]},z=function(t){if(!Neptune.Imikimi.Oz.Client.Components.Pages[t.pageName])throw new Error(t.pageName+" not found");return t},NavState.prototype.popNavState=A=function(){return this.navStack=u(this.navStack)},NavState.prototype.pushNavState=F=function(t){var e,n;return t.pageName===(null!=(n=x(e=this.navStack))?n.pageName:void 0)&&(e=this.popNavState()),this.navStack=l(e,z(t))},NavState.prototype.pushNavStack=F,NavState.prototype.popNavStack=A,NavState.prototype.justPushNavStack=function(t){return this.navStack=l(this.navStack,t)},NavState.prototype.popNavStateIfCurrent=function(t){if(this.currentPageName===t)return this.popNavState()},NavState.prototype.pushNavStateUnique=function(t){if(t.pageName!==this.currentPageName)return this.pushNavState(t)},NavState.getter({currentPageComponent:function(){var t,e;if(t=x(this.navStack))return e=t.pageName,Neptune.Imikimi.Oz.Client.Components.Pages[e]},currentPrimaryToolbarRenderer:function(){var t,e;return this.models.viewState.fullScreen?null!=(t=this.currentPageComponent)?t.renderFullscreenToolbar:void 0:null!=(e=this.currentPageComponent)?e.renderPhoneToolbar:void 0},currentSecondaryToolbarRenderer:function(){var t,e;return this.models.viewState.fullScreen?null!=(t=this.currentPageComponent)?t.renderSecondaryFullscreenToolbar:void 0:null!=(e=this.currentPageComponent)?e.renderSecondaryPhoneToolbar:void 0}}),NavState.getter({currentPage:function(){return x(this.navStack)},feedbackEmailState:function(){return{currentTab:this.currentTab,currentPage:R(this.currentPage)}},onHomePage:function(){var t,e,n;return t=(n=this.state).currentTab,!((e=n.navStack)&&0!==e.length||"KimiHome"!==t&&"ZoHome"!==t)}}),R=function(t){return b(t,function(t){return m(t)?y(t.id)?{id:t.id}:R(t):t})},NavState.setter({overlay:function(t){return t&&(this.searchBarVisible=!1),this.setState("overlay",t)},feedScrollingActive:function(t){return!t&&this._pendingFocusedTopicId&&this.setFocusedTopicInternal(this._pendingFocusedTopicId),this.setState({feedScrollingActive:t})},focusedTopic:function(t){var e;if(y(e=(null!=t?t.id:void 0)||t))return this.state.feedScrollingActive?this._pendingFocusedTopicId=e:this.setFocusedTopicInternal(e)}}),NavState.prototype.setFocusedTopicInternal=function(t){return this._pendingFocusedTopicId=null,this._previousFocusedTopicId&&this.removeState(this._previousFocusedTopicId+"_focused"),(this._previousFocusedTopicId=t)&&this.setState(this._previousFocusedTopicId+"_focused",!0),this.setState({focusedTopicId:t})},NavState.prototype.pickImageAndStartPost=function(){return I().then((t=this,function(e){return t.models.newPostState.selectedImageInfo=e,t.models.navState.showNewPost()}));var t},NavState.prototype.back=function(){return this.popNavState()},NavState.prototype.closeFullScreenPost=function(){if(this.fullscreenPost)return this.popNavState()},NavState.getter({fullscreenPost:function(){var t,e;if("FullscreenPost"===(null!=(e=t=x(this.navStack))?e.pageName:void 0))return t}}),NavState.setter({fullScreenPost:function(t){if(!t)throw new Error("expecting post");return this.pushNavState({pageName:"FullscreenPost",hideTabBar:!0,props:{post:t}}),this.models.urlBarState.pushRecordLocation(P.post,t)},searchQuery:function(t){return this.models.urlBarState.pushSearchLocation(t),this.setState({searchBarVisible:!0,searchQuery:t}),this.showTab("Search")}}),NavState.prototype.searchForKimis=function(){return this.search(S(this.searchOptions,{searchKimis:!0}))},NavState.prototype.reset=function(){return this.resetState()},NavState.prototype.home=function(){return this.models.urlBarState.pushHomeLocation(),this.navigateTo()},NavState.prototype.kimiHome=function(){return this.models.urlBarState.pushKimisLocation(),this.navigateTo({kimis:!0})},NavState.prototype.navigateTo=function(t,e){var n,i,r,s,a;return null==t&&(t={}),i=t.pipelineName,n=t.kimis,r=t.record,s=t.search,this.hideOverlay(),o.resolve(function(){if(s)return this.showSearch(s);switch(r&&i){case"post":return this.showPost(r,{back:e});case"topic":return this.showTopic(r);case"user":return this.showUser(r);case"kimis":break;default:return n?this.showTab("KimiHome"):this.showTab("ZoHome")}}.call(this)).then((a=this,function(){return a.loading=!1}))},NavState.prototype.showTopic=function(t){return o.then((e=this,function(){if(y(t))return P.topic.get(t).then(e.showTopic);if(t.lastPost)return e.showPost(t.lastPost);if(t.lastPostId)return P.post.get(t.lastPostId).then(e.showPost);throw new Error("invalid showTopic")})).catch(function(e){return function(n){if(n.status===c)return e.showSystemMessage("We're sorry, but you do not have access to that stream."),v.warn("showTopic: can't do it, clientFailureNotAuthorized topicId: "+t);throw v({showTopic:{error:n,topic:t}}),t.id&&(v.warn({"Attempting to fix topic":t}),t.id&&e.models.topic.updateComputedPostFields(t.id)),n}}(this));var e},a(k("AuthSettings EditNewImage Help Login NewPost ProfileSettings SocialActivity Subscription ReferralOverlay BlockUserOverlay FlagUserOverlay"),function(t){return NavState.prototype["toggleShow"+t]=function(){return this.toggleOverlay({type:t})},NavState.prototype["show"+t]=function(e){return this.showOverlay(S({props:e,type:t}))},NavState.prototype["hide"+t]=function(){return this.hideOverlay(t)}}),NavState.prototype.showOverlay=function(t){var e;if(t.type&&(null!=(e=this.overlay)?e.type:void 0)!==t.type&&this.createEvent("showOverlay:"+t.type,null!=t?t.props:void 0),!t.type&&!t.overlayFactory)throw new Error("no type");return this.overlay=t},NavState.prototype.hideOverlay=function(t){var e,n,i,r;return y(t)||(t=null),e=null!=(n=this.overlay)?n.type:void 0,null!=t&&(null!=(i=this.overlay)?i.type:void 0)!==t||(this.overlay=null),T(250).then((r=this,function(){return e&&r.models.newPostState.overlayClosed(),null}))},NavState.prototype.toggleOverlay=function(t){return this.overlay&&C(this.overlay,t)?this.hideOverlay():this.overlay?(this.overlay=null,T(300,(e=this,function(){return e.showOverlay(t)}))):this.showOverlay(t);var e},NavState.prototype.showTopicSettings=function(t){var e,n,i;return y(t.topicId)?(i=t.topicId,e=t):y(t)?i=t:g(t)&&(n=t),this.showOverlay({type:"StreamSettings",props:{topic:n,topicId:i,post:e}})},NavState.prototype.showFullscreenProfile=function(t){return this.pushNavState({pageName:"FullscreenProfile",props:{user:t}})},NavState.prototype.showFullscreenTextEditor=function(t){return this.pushNavState({pageName:"FullscreenTextEditor",props:{post:t}})},NavState.prototype.showUser=function(t){return this.hideOverlay(),this.showFullscreenProfile(t)},NavState.prototype.authenticate=function(t){return v("navState.authenticate"),new o((e=this,function(n,i){return e.showLogin(S(t,{success:n}))}));var e},NavState.prototype.showSearch=function(t){return this.search(t)},NavState.prototype.updateSearch=function(t){return y(t)&&(t={query:t}),this.search(g(t)?S(this.searchOptions,t):void 0)},NavState.prototype.clearSearch=function(){var t,e;return e=(t=this.searchOptions).searchKimis,t.order,this.searchOptions={searchKimis:e,order:e?"trending":"date"},this.models.searchState.clearSearchResults()},NavState.getter({searchIsVisible:function(){return"Search"===this.currentTab}}),NavState.prototype.search=function(t){return y(t)&&(t=S(this.searchOptions,{query:t})),g(t)&&(null==t.order&&(t.order=t.searchKimis?"trending":"date"),this.searchOptions=t),this.onNextReady((e=this,function(){return e.showTab("Search")}));var e},NavState.prototype.showMessages=function(t){return this.showOverlay({type:"Messages",props:{post:t}})},NavState.prototype.showSystemMessage=function(t){return y(t)&&(t={message:t}),this.showOverlay({type:"SystemMessage",props:t})},NavState.prototype.showSystemError=function(t,e){var n,i,r,o,a,l,u,c;return(u=null!=t&&null!=(i=t.info)?i.response:void 0)?(c=u.status,n=null!=(r=null!=(o=t.info.message)?o:null!=(a=u.props)?a.message:void 0)?r:null!=(l=u.data)?l.message:void 0):(n=t.message,c=t.status,n=n.replace(/\s*\n[\s\n]*/g," ")),(null!=n?n.length:void 0)>500&&(n=(n=n.split("\n")[0]).slice(0,500)),this.showSystemMessage({title:null!=e?e:"Aw snap!",warning:!0,message:s.getCommunicationStatusMessage(c,n)})},NavState.prototype.showChapterNavigator=B=function(t){return this.showOverlay({type:"ChapterNavigator",props:{topic:t}})},NavState.prototype.showTopicBrowser=B,NavState.prototype.showPosterText=function(){return this.hideOverlay(),this.pushNavState({pageName:"PosterText"})},NavState.prototype.hidePosterText=function(){return this.popNavStateIfCurrent("PosterText")},NavState.prototype.showPost=function(t,e,n){var i,r;return null==n&&(n=!0),v("showPost id: "+(null!=t?t.id:void 0)+" topicId: "+(null!=t?t.topicId:void 0)),y(i=t)?this.models.post.get(i).then((r=this,function(t){return r.showPost(t,e)})):t?(n&&this.hideOverlay(),this.fullScreenPostProps=e,this.setFullScreenPost(t)):void 0},NavState.prototype.showSharePost=function(t){return this.showOverlay({type:"SharePost",props:{post:t}})},NavState.prototype.showKimiCreator=function(){return this.hideOverlay().then((t=this,function(){return t.pushNavStateUnique({pageName:"KimiEditorPage"})}));var t},NavState.prototype.hideKimiEditor=function(){return this.popNavStateIfCurrent("KimiEditorPage")},NavState.prototype.resumeKimiCreator=function(){return this.showKimiCreator()},NavState.prototype.cancelKimiEditor=function(){return this.hideKimiEditor(),this.models.openFile.reset()},NavState.prototype.startNewKimi=function(t){return o.resolve(this.models.openFile.initCreatorEdit(S(t,{postCancel:this.hideKimiEditor}))).then((e=this,function(){return e.showKimiCreator()}));var e},NavState.prototype.customizeKimi=function(t){var e,n;return this.models.newPostState.resetState(),this.createEvent("editor:startCustomizeKimi",{templatePostId:t.id,templatePostAuthorId:t.userId}),e=h(),o.all([I(),this.models.openFile.loadKimiTemplateForCustomizing({customizeUrl:f(t),onProgress:function(t){var n,i;if(n=t.progress,i=t.request,h()-e>5)return Neptune.Art.Flux.models.navState.showSystemMessage({title:"Loading",message:"Fetching template...",progress:n,buttons:[{icon:"cancel",text:"cancel",action:function(){return i.abort(),Neptune.Art.Flux.models.navState.hideOverlay()}}]})},newPostProps:{templatePost:t},postCancel:this.cancelKimiEditor})]).tap((n=this,function(){return n.showKimiCreator()})).then(function(t){return function(e){var n;return n=e[0],t.onNextReady(function(){return t.models.elementEditState.addBitmapToDropIn(null,n)})}}(this)).catch(function(t){return function(e){return t.hideKimiEditor(),T(1e3,function(){return Neptune.Art.Flux.models.navState.showSystemMessage({title:"Load Failed",message:"We're sorry, but we weren't able to fetch the template you requested."})}),v({customizeKimi:{error:e}})}}(this))},NavState.prototype.setupKimiCreator=function(t){return this.models.openFile.initCreatorEdit({bitmap:t,postCancel:this.hideKimiEditor})},NavState.prototype.onKimiEditorSave=function(t){return this.hideKimiEditor(),this.models.openFile.encodeForOz().then((e=this,function(n){var i;return i=S(n,t),e.createEvent("editor:save",i),e.showNewPost({editorSave:!0}),e.models.newPostState.selectedImageInfo=i}));var e},NavState.prototype.showOrPushSubscriptions=function(t,e,n){return this.models.currentSession.reload(),(null!=t?t.pushPage:void 0)?t.pushPage(Neptune.Imikimi.Oz.Client.Components.Overlays.SubscriptionPartials.ManageSubscription,{closeOnAccessGranted:e,reason:n,popPage:t.popPage}):this.showSubscription({closeOnAccessGranted:e,reason:n})},NavState.prototype.postToTopic=function(t){return o.then(function(){return y(t)?P.topic.get(t):t}).then((e=this,function(t){return e.models.newPostState.selectedTopic=t,e.models.navState.showNewPost()}));var e},NavState.prototype._subscribeToUserChanges=function(){return this.subscribeOnModelRegistered({modelName:"currentSession",key:"currentUser",updatesCallback:(t=this,function(e){var n,i;return(n=e.data)&&(i=n.defaultChannelId,n.displayName),t.currentChannelId=(i=null!=n?n.defaultChannelId:void 0)?t.currentChannelId||i:null})});var t},NavState}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>"4ThOfJuly abstractArt colorfulKimis africa aidsAwareness algeria angels announcements apologies appreciation aprilFoolsDay armedForcesDay aroundTheWorld ashWednesday asia astrology auntsUncles autumn babies babyAnnouncements backToSchool ballroomSwingLatin beautiful belgium bestFriendsDay bffs bicycling birthdays boats breakUps bride bridesmaids brothersSisters calendars canada careers cars cartoonsComicsAnimeManga cats cheerUpSmile children childrensDay chineseNewYears christian christmas cincoDeMayo classOfXx classicKimis classicalMusic columbusDay communityCauses congratulations countryMusic couplesDating couplesDuos cousins cowboysAndCowgirls danceMusic dayOfTheDead dayOfTheWeek dogs earthDay easterSunday electronics europe faceCutOuts faith fall family fantasy fashion fathersDay firstDayOfSummer firstDayOfWinter flagDay france friday friends friendshipDay frog fun funny gearheads getWellSoon ghost girlyGirls godchildrenAndParents goodFriday goodMorningGoodEvening gothPunkEmo graduation grandchildren grandparents grandparentsDay greatBritain greetings groom groundhogDay halloween hanukkah haveAGreatDay haveAGreatTime haveAGreatWeek haveAGreatWeekend healthAndFitness hello horses hotStuff huntingFishing iLoveMusic iLoveYou inLaws inLove inLovingMemory inMemoryOf inspiration inspirational islanders italy kidPhotoAlbums kids kimiArt kimiHelp laborDay latinAmerica letterFrames lotsOfPhotos love loveMyGirl loveMyGuy magazineCovers mardiGras marriage martinLutherKingDay me memorialDay mexico middleEast missingYou monday motherInLawsDay mothersDay motorcycles music myFamily myFriends myGirls nativeAmerican nature neon newAge newYearsEve niecesAndNephews northAmerica ocean oklahoma olympics outdoors palmSunday parents parentsDay passover pets philippines photoAlbums poems politics pregnancy presidentsDay prettyBoys puertoRico rap relationships remembrance rockMusic royalty running saturday scenery school schoolEvents schoolSports scrapbook shopping showSomeLove shows specialDays spiritual sports spring springEquinox stPatricksDay stylin summer sunday sunset support survivors sympathy taiwan talkLikeAPirateDay teamSports thankYou thanksForTheAdd thanksgiving thingsYouDo thinkingOfYou thursday travel trickOrTreat tuesday tunisia turkey unitedStates valentinesDay vampire vehicles veteransDay vintageFrames wedding weddings wednesday whatYouDo whyILoveYou wilderness wildlife winter winterSports witch womensEquality yomKippur youRock yourName zombie roses portrait flowers grief colorful abstract goodMorning goodEvening goodNight childloss river mountain tiger wolf loss hearts anniversary windowView coffee romantic romance toast kidsPlaying kidsPhotoAlbum carnaval heaven memorial men women party drinks moonlight happyBirthday pink red green blue orange yellow purple cyan magenta brown grey silver gold black white".split(" "))}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B={}.hasOwnProperty;I=n(768),m=I.formattedInspect,c=I.currentSecond,I.select,l=I.Validator,h=I.defineModule,x=I.log,I.max,P=I.merge,I.ProgressAdapter,I.timeout,I.isString,f=I.formatDate,_=I.pending,A=I.success,d=I.failure,e=I.ApplicationState,a=I.Promise,i=I.Bitmap,S=I.getMediaUrlForPost,y=I.getFileFromUrl,I.getMediaUrlForFile,g=I.getColorPaletteFromColorInfo,k=I.present,T=I.preprocessTopic,s=I.FluxSubscriptionsMixin,I.peek,F=I.zoPickImage,b=I.hashtagRegexp,I.normalizeTagsInText,o=I.ErrorWithInfo,E=I.pipelines,w=I.isFailure,v=I.getImageSize,M=n(576),p=M.extractColorsAsPlainObjects,C=M.packColorMap,r=n(341).BitmapElement,u=n(776).appRatePrompt,h(t,function(t){var n;function NewPostState(){NewPostState.__super__.constructor.apply(this,arguments),this._setupSubscriptions()}return function(t,e){for(var n in e)B.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(NewPostState,s(e)),NewPostState.getDefaultTitle=function(){return f(new Date,"dddd mmmm dS")},n=new l({source:"string",bitmap:{verify:function(t){return!t||t instanceof i}},dimensions:"required object",byteLength:"required number",colorInfo:"object"}),NewPostState.prototype._setupSubscriptions=function(){return this.subscribeOnModelRegistered({modelName:"currentSession",key:"currentUserId",updatesCallback:(t=this,function(e){var n;return n=e.data,t._subscribeToTopics(n)})});var t},NewPostState.prototype._subscribeToTopics=function(t){return this.subscribe({modelName:"topicsByUserId",subscriptionKey:"topicsByUserId",key:t,updatesCallback:(e=this,function(t){var n,i,r,o,s,a,l,u,c;for(i=null,s=0,c={},r=0,o=(u=null!=(a=t.data)?a:[]).length;r<o;r++)(l=u[r]).isProfileTopic||(c[l.title]=l,s++,i=l);for(;c[n=s>0?"Photos "+(s+1):"Photos"];)s++;return e.defaultNewTopicTitle=n,e.defaultTopic=i,null!=e.selectedTopic?e.selectedTopic:e.selectedTopic=e.defaultTopic})});var e},NewPostState.prototype.startNewPostForTopic=function(t,e){return this.resetState(),this.selectedTopic=t,this.showWillPostToTopic=!0,this.models.navState.showNewPost(),this.afterPost=null!=e?e.afterPost:void 0},NewPostState.stateFields({defaultTopic:null,afterPost:null,showWillPostToTopic:!1,defaultNewTopicTitle:"Photos",selectedImageInfo:null,caption:null,isChapterStart:!1,isProfilePost:!1,chapterTitle:null,selectedTopic:null,newTopicTitle:null,newTopicPrivate:!0,focus:null,abort:null,retry:null,postStatus:null,newPost:null,progress:0}),E.post.fields.caption.maxTags,NewPostState.setter({caption:function(t){var e;return(null!=t&&null!=(e=t.match(b))?e.length:void 0)>3?this.state.caption:(this.setState({caption:t}),t)}}),NewPostState.getter({isNewTopic:function(){return!this.state.selectedTopic||this.state.selectedTopic.isNewTopic},isNewTemplate:function(){var t;return null!=(t=this.selectedImageInfo)?t.templateData:void 0},isNewKimiUse:function(){var t;return null!=(t=this.selectedImageInfo)?t.templatePost:void 0},newTopicTitle:function(){return this.state.newTopicTitle||this.defaultNewTopicTitle||"Photos"},newTopic:function(){return T({user:this.models.currentSession.currentUser,userId:this.models.currentSession.currentUserId,title:this.newTopicTitle,private:this.newTopicPrivate,lastChapterPost:this.postForShowMedia})},postForShowMedia:function(){var t,e,n,i,r;if(this,n=this.focus,r=this.selectedImageInfo)return t=r.bitmap,e=r.colorInfo,i={focus:n,bitmap:t,url:r.source,dimensions:t.size},e&&(i.colorMap=e.colorMap,i.colors=g(e)),i},eventInfo:function(){var t,e,n,i,r,o,s;return this,i=this.isNewTopic,r=this.selectedImageInfo,e=this.caption,n=this.isChapterStart,r&&(s=r.templatePost,t=r.byteLength,o=r.templateByteLength),{isChapterStart:n,isNewTopic:i,photoPresent:t>0,templatePresent:o>0,captionPresent:k(e),byteLength:t,templateByteLength:o,templatePost:s,haveCurrentUser:!!this.models.currentSession.currentUserId}},eventLabel:function(){var t,e,n,i;switch(this.selectedImageInfo&&(t=(e=this.selectedImageInfo).byteLength,n=e.templateByteLength,i=e.templatePost),!1){case null==n:return"newFrame";case!i:return"frameUse";case null==t:return"photo";default:return"textOnly"}}}),NewPostState.prototype.selectDefaultTopic=function(){return this.selectedTopic=this.defaultTopic},NewPostState.prototype.removePhoto=function(){if(this.setState({selectedImageInfo:null,isProfilePost:!1}),this.models.posterTextState.resetState(),!this.selectedTopic||this.selectedTopic.isNewTopic)return this.selectedTopic=this.defaultTopic},NewPostState.prototype.updateProfilePhoto=function(){return F().then((t=this,function(e){return t.selectedImageInfo=e,t.isProfilePost=!0,t.models.navState.showNewPost()}));var t},NewPostState.setter({newTopicTitle:function(t){var e;return t=null!=t?t.trim():void 0,e=this.state.selectedTopic,this.setState({selectedTopic:(null!=e?e.isNewTopic:void 0)?P(e,{title:t}):null,newTopicTitle:t})},selectedTopic:function(t){var e;return this.setState(P({selectedTopic:t,newTopicTitle:(null!=t?t.isNewTopic:void 0)?(null!=(e=t.title)?e.trim():void 0)||this.newTopicTitle:void 0}))}}),NewPostState.prototype.normalizedSelectedImageInfo=function(t){var e,i,r,o,s,l,u;return e=t.bitmap,t.templateData,r=t.data,t.colorInfo,l=t.name,t.dimensions,t.source,i=t.byteLength,s=t.image,o=t.editorSave,u=t.originalBitmap,e&&(o||u)&&(s=null),(!e||r&&s&&!e.size.neq(v(s))?a.resolve(t):(c(),a.all([e.toPng(),e.toJpg(),a.resolve(p(e))]).then(function(n){var o,s,a,u;return u=n[0],a=n[1],o=n[2],i=(r=u.byteLength<a.byteLength?(s="png",u):(s="jpg",a)).byteLength,l||(l="memory_bitmap."+s),P(t,{data:r,colorInfo:o,byteLength:i,name:l,dimensions:e.size.plainObjects,colors:g(o)})}).catch(function(t){throw x.error("NewPostState#normalizedSelectedImageInfo FAIL",t),t}))).then(function(t){return n.validate(t,{context:"normalizedSelectedImageInfo"})})},NewPostState.setter({selectedImageInfo:function(t){return(null!=t?t.bitmap:void 0)&&!t.editorSave&&this.models.navState.setupKimiCreator(t.bitmap),this.normalizedSelectedImageInfo(t).then((e=this,function(t){return e.setState({selectedImageInfo:t,focus:null}),e.uploadingImageStatus=e.startImageUpload(t)})).catch(function(t){throw x.error("NewPostState#setSelectedImageInfo FAIL",t),t});var e}}),NewPostState.prototype.createEvent=function(t,e){return this.models.event.create("post:new:"+t+":"+this.eventLabel,{data:P(e,this.eventInfo)})},NewPostState.prototype.startImageUpload=function(t){var e,n,i,r,o,s,a,l,u;return this.createEvent("imageUpload:start"),e=0,r=0,i=!1,n=null,u=this,o=function(){return e>0&&u.createEvent("imageUpload:restart"),e++,x("NewPostState#startImageUpload try #"+s+"... ("+t.name+": "+t.byteLength+" bytes) (attempt "+e+")"),r=0,i=!1,u.models.imageStore.put(P(t,{onProgress:function(t){var e;return r=t.progress,e=t.abort,t.imageUploadRequest,t.templateUploadRequest,"function"==typeof n&&n(r),l.abort=e}})).tapCatch(function(){return u.createEvent("imageUpload:failure")}).tap(function(){return u.createEvent("imageUpload:success")})},s=0,a=o(),l={try:function(t){var e;return s++,"function"==typeof(n=t)&&n(r),x(m({startImageUpload:{try:{retrying:e=i,tryCount:s}}})),a.catch(function(t){if(x(m({startImageUpload:{try_fail:{retrying:e,tryCount:s}}})),l.abort=null,e&&s>1)return a=o();throw i=!0,t}).then(function(t){return l.abort=null,t})},abort:null}},NewPostState.prototype.resetState=function(){var t;return t=this.defaultTopic,Neptune.Imikimi.Oz.Client.MainThreadLib.ImagePicker.imagePicker.reset(),NewPostState.__super__.resetState.apply(this,arguments),this.selectedTopic=this.defaultTopic=t,this.models.posterTextState.resetState()},NewPostState.prototype.startNewChapter=function(){return this.isChapterStart=!0,this.chapterTitle||(this.chapterTitle=NewPostState.getDefaultTitle())},NewPostState.prototype.cancelNewChapter=function(){return this.isChapterStart=!1},NewPostState.prototype.reloadTopics=function(t){return Neptune.Art.Flux.models.topic.reload(t),this.models.topicsByUserId.reload(this.models.currentSession.currentUserId)},NewPostState.prototype.preCacheBitmap=function(t,e){return r.bitmapCache.temporaryPut(3e4,S(t,"max"),e),r.bitmapCache.temporaryPut(3e4,S(t,"large"),e)},NewPostState.prototype.overlayClosed=function(){if(this.postStatus)return this.resetState()},NewPostState.prototype.postDirectlyFromImageStorePutResult=function(t,e){var n,i,r,o;return o=t.url,n=t.byteLength,i=t.colorInfo,r=t.dimensions,this.models.post.create({data:P({mediaFile:y(o),mediaByteLength:n,colorMap:i&&C(i.colorMap),colors:i&&g(i),dimensions:r},e)})},NewPostState.prototype.post=function(){var t,e,n,i,r,s,l,c,h,p,f,m,v,S,b,E,T,I,M,F,B,R,z,O,L,D,N,U,W;if(this,S=this.isProfilePost,v=this.isNewTopic,I=this.newTopicTitle,T=this.newTopicPrivate,B=this.selectedImageInfo,U=this.uploadingImageStatus,R=this.selectedTopic,r=this.caption,s=this.chapterTitle,m=this.isChapterStart,p=this.focus,e=this.afterPost,B&&(B.source,c=B.dimensions,i=B.byteLength,l=B.colorInfo,E=B.mediaCreatedAt,B.templateType,z=B.templateByteLength,O=B.templateDropInCount,N=B.templateText,L=B.templateDropInLocations,D=B.templatePost,n=B.bitmap,f=B.hasPosterText),v){if(!k(I))throw new Error("no newTopicTitle");m=!0}return this,this.eventLabel,h=this.eventInfo,this.createEvent("save:start"),F=0,b=null,t=null,M=new a((W=this,function(k,j){return t=function(){return null!=U&&"function"==typeof U.abort&&U.abort(),j(new o("post attempt aborted",P({retryCount:F},W.state))),W.resetState()},b=function(){return F>0&&W.createEvent("save:retry"),F++,W.postStatus=_,(B?U.try(W.setProgress):a.resolve({})).then(function(t){var n,o,a;return a=t.url,n=t.templateUrl,W.retry=!1,(S||v||(null!=e?e.topicId:void 0)!==R.id)&&(e=null),W.models.post.create({props:{afterPostId:null!=e?e.id:void 0},data:P({caption:r||null},S?(o=W.models.currentSession.currentUser.profileTopicId)?{topicId:o}:{topic:{title:"Profile Photos",isProfileTopic:!0}}:v?{topic:{title:I,private:T}}:{topicId:R.id},a?{mediaFile:y(a),mediaByteLength:i,mediaCreatedAt:E,colorMap:C(l.colorMap),colors:g(l),dimensions:c,focus:null!=p?p.plainObjects:void 0,isChapterStart:m,chapterTitle:s}:void 0,D?{templatePostId:D.id,templateAuthorId:D.userId}:void 0,n?{templateFile:y(n),templateByteLength:z,templateDropInCount:O,templateText:N,templateDropInLocations:L}:void 0)})}).then(function(t){return(W.newPost=t).topicId,0,u(),f&&W.models.posterTextState.posted(t),h=P(h,{postId:t.id,topicId:t.topicId}),W.preCacheBitmap(t,n),W.createEvent("save:success",{post:t}),v&&W.createEvent("save:newTopic",{post:t}),null!=W.postStatus&&(W.postStatus=A),k(W.newPost)}).catch(function(t){throw w(W.postStatus)||x({NewPostState:{error:t}}),W.createEvent("save:failure:"+(W.postStatus||d),{data:{message:t.message}}),null!=W.postStatus&&(W.postStatus=d),j(t),t}),M}})),this.setState({abort:t,retry:b}),b()},NewPostState.getter({eventProps:function(){return{haveCurrentUser:!!this.models.currentSession.currentUserId}}}),NewPostState.prototype.selectPhoto=function(){return this.models.event.create("post:new:selectPhoto",{data:this.eventProps}),F().then((t=this,function(e){var n;return n=e.bitmap.size,t.models.event.create("post:new:photoSelected",{data:P(t.eventProps,{pixels:n.area,aspectRatio:n.aspectRatio,width:n.x,height:n.y})}),t.models.newPostState.selectedImageInfo=e}));var t},NewPostState}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["currentSecond","log","Engine","Promise","models","merge","document","mergeInto","openLink","self","Error","interval","secondsPer","window","timeout"],[e,n(268)],(t,r,o,s,a,l,u,c,h,p,d,f,m,g,y)=>{let v,S;return v=t(),e.memoryWarning=(()=>(r({memoryWarning:o.getCacheInfo()}),S.cordovaEvent("memoryWarning",o.getCacheInfo()),o.flushCache())),S=i.defClass(class Cordova extends Object{},function(o,S,b){let w;this.init=function(){return s.then(()=>e.cordova?this.initCordova():void 0)},this.cordovaEvent=function(r,s){return a.event.create(`cordova:${i.toString(r)}`,{data:l(o.getDeviceInfo(),{version:n(272).version,userAgent:e.navigator.userAgent,upTime:t()-v|0},s)})},this.initCordova=(()=>u.addEventListener("memorywarning",e.memoryWarning)),this.appRatePrompt=(()=>e.cordova?e.AppRate?(this.cordovaEvent("appRate:prompt:start"),e.AppRate.promptForRating(!1),this.cordovaEvent("appRate:prompt:startSuccess")):this.cordovaEvent("appRate:prompt:notLoaded"):void 0),this.appRateInit=function(){return e.AppRate?(this.cordovaEvent("appRate:loading"),c(e.AppRate.preferences,{usesUntilPrompt:3,displayAppName:"Imikimi Zo",inAppReview:!0,storeAppURL:{ios:"1353175034",android:"market://details?id=com.imikimi.app11"},customLocale:{title:"Rate %@",message:"If you enjoy using %@, would you mind taking a moment to rate us? It won't take more than a minute. Thank you for your support!",cancelButtonLabel:"Not right now",laterButtonLabel:"Remind me later",rateButtonLabel:"Rate it now",yesButtonLabel:"Yes!",noButtonLabel:"Not really",appRatePromptTitle:"Do you like using %@?",feedbackPromptTitle:"Would you mind giving us some feedback so we can do better?"},callbacks:{handleNegativeFeedback:()=>h("mailto:feedback@imikimi.com"),onRateDialogShow:()=>this.cordovaEvent("appRate:prompt:dialogShown"),onButtonClicked:t=>(()=>{switch(t){case 0:return this.cordovaEvent("appRate:prompt:clicked:rateItNow");case 1:return this.cordovaEvent("appRate:prompt:clicked:remindMeLater");case 2:return this.cordovaEvent("appRate:prompt:clicked:notRightNow");default:return this.cordovaEvent(`appRate:prompt:clicked:button${i.toString(t)}`)}})()}}),this.cordovaEvent("appRate:loaded")):this.cordovaEvent("appRate:notLoaded")},e.universalLinksLog=w=[],this.initDeepLinking=function(){let t;return i.exists(t=e.universalLinks)&&t.subscribe(null,t=>{let e,n,o,s,l;return({params:e,path:n,host:o,scheme:s,url:l}=t),e=i.object(e,t=>""===t||t),r("universalLinks event 1"),r({universalLinks:t}),a.urlBarState.initFromPathAndParams(n,e,!0),r("universalLinks event done")})},this.getDeviceInfo=function(){let t,e,n,i,r,o;if(p.device)({cordova:t,model:e,isVirtual:n,platform:i,version:r,manufacturer:o}=p.device);else if(p.cordova)throw new d("We have cordova, but device isn't ready.");return{platform:null!=i?i:"web",platformVirtual:n,platformModel:e,platformVersion:r,platformManufacturer:o,cordovaVersion:t}},this.triggerCordovaLoadedEvent=function(){return this.cordovaEvent("loaded")},this.initAfterDeviceReady=function(){return f(1e3*m.day,this.triggerCordovaLoadedEvent),this.triggerCordovaLoadedEvent(),this.appRateInit(),this.keyboardInit(),this.initDeepLinking()},this.keyboardInit=function(){let t;return t=((t=0)=>{let n;return(n=e.canvasElement.focusedElement)?y(t,()=>n.scrollOnscreen()):void 0}),g.addEventListener("keyboardWillHide",()=>y(250,()=>(r("keyboardWillHide - viewState.refresh"),a.viewState.refresh(null,!1)))),g.addEventListener("keyboardWillShow",()=>(t(250),a.viewState.refresh(null,!0))),g.addEventListener("keyboardDidHide",()=>a.viewState.refresh(null,!1)),g.addEventListener("keyboardDidShow",()=>(t(),a.viewState.refresh(null,!0)))},this.postInit=function(){return p.navigator&&p.navigator.splashscreen?y(100,()=>p.navigator.splashscreen.hide()):void 0},e.cordova&&e.document.addEventListener("deviceready",function(){return o.initAfterDeviceReady()})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","merge"],[e,n(768)],(t,e)=>{return i.defClass(class NewsState extends t{},function(t,n,r){this.persistant(),this.stateFields({lastSeenByTopicId:{}}),this.prototype.markSeen=function(t){return t&&(this.lastSeenByTopicId=e(this.lastSeenByTopicId,{[t.id]:t.lastPostId}))},this.prototype.seen=function(t){let e;return t&&(i.exists(e=this.lastSeenByTopicId)&&e[t.id])===t.lastPostId},this.prototype.unseen=function(t){let e;return t&&(i.exists(e=this.lastSeenByTopicId)&&e[t.id])!==t.lastPostId}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","Math","point0","bound","posterTextStyles","shadeColor","pipelines","lowerCamelCase","compactFlatten","clone","rgbColor"],[e,n(768),n(779)],(t,e,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class PosterTextState extends(n(594)(t)){},function(t,d,f){let m,g,y,v;this.eventKey("posterText"),this.prototype.posterTextScales=m=[1,11/12,10/12,.75,8/12,7/12,.5,5/12,4/12],this.prototype.minPosterTextScale=g=e.min(...m),this.prototype.maxPosterTextScale=y=e.max(...m),this.prototype.posterTextScaleStepFromScale=v=function(t){let n,r;return n=null,r=0,i.each2(m,(i,o)=>{let s;return s=e.abs(t-i),null==n||r>s?(n=o,r=s):void 0}),n},this.prototype.boundPosterTextScale=function(t){return o(g,t,y)},this.prototype.snapPosterTextScale=function(t){return m[v(t)]},this.setter({posterTextScale:function(t){return this.posterTextScaleStep=v(t)}}),this.prototype.ensureFree=function(){return this.posterTextStyle=i.find(s,null,t=>t.free)},this.stateFields({editStep:null,posterTextQuoteCategory:null,posterTextText:null,posterTextLocationMode:"inside",posterTextSeedsByStyleName:{},posterTextStyle:null,posterTextLocation:r,posterTextScaleStep:1,posterTextForeground:"white",posterTextForegroundShade:.5,posterTextBackground:null,posterTextBackgroundOpacity:1,posterTextBlurredBackgroundOpacity:.5,posterTextBackgroundShade:.5,posterTextCornersRounded:!0,posterTextBackgroundBlur:null,randomize:!0}),this.getter({posterTextScale:function(){let t;return null!=(t=m[this.posterTextScaleStep])?t:1},bitmap:function(){let t,e,n;return i.exists(n=this.models.newPostState.selectedImageInfo)&&(t=n.originalBitmap,e=n.bitmap),null!=t?t:e},shadedPosterTextForeground:function(){return a(this.posterTextForeground,this.posterTextForegroundShade)},shadedPosterTextBackground:function(){return a(this.posterTextBackground,this.posterTextBackgroundShade)},shadedPosterTextBackgroundWithAlpha:function(){return this.shadedPosterTextBackground.withAlpha(this.posterTextBackgroundBlur?.6*this.posterTextBackgroundOpacity+.2:.8*this.posterTextBackgroundOpacity+.2)}}),this.prototype.posted=function(t){let n,r,o,s,a,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_;return n=this.posterTextScale,_=this.state,r=_.posterTextQuoteCategory,o=_.posterTextText,s=_.posterTextStyle,a=_.posterTextLocation,h=_.posterTextForeground,p=_.posterTextForegroundShade,d=_.posterTextBackground,f=_.posterTextBackgroundOpacity,m=_.posterTextBlurredBackgroundOpacity,g=_.posterTextBackgroundShade,y=_.posterTextCornersRounded,v=_.posterTextBackgroundBlur,S=_.posterTextLocationMode,l.event.create("posterText:postedWith:text:"+(b=(()=>{switch(!1){case!(null!=r):return`quote:${i.toString(r)}`;case!o:return w=o.match(/^\s*\S/gm).length,"multilineMagnitude"+i.pow(2,e.floor(e.log2(w)));default:return"default"}})())),x={posterTextStyle:s=s.getName(),posterTextLocation:a,posterTextScale:n,posterTextQuoteCategory:r,posterTextForeground:h,posterTextForegroundShade:p,posterTextBackground:d,posterTextBackgroundOpacity:f,posterTextBlurredBackgroundOpacity:m,posterTextBackgroundShade:g,posterTextCornersRounded:y,posterTextBackgroundBlur:v,posterTextLocationMode:S,posterTextTextInfo:b,postId:i.exists(t)&&t.id},P=i.object(x,(t,e)=>`${i.toString(t)}`,null,null,(t,e)=>u(e.replace(/^posterText/,""))),C=u(c([d?"color":void 0,v?`blur ${i.toString(v)}`:void 0,y&&(d||v)?"round":void 0]).join(" ")),l.event.create("posterText:posted",{data:P}),l.event.create(`posterText:postedWith:style:${i.toString(s)}`),l.event.create(`posterText:postedWith:theme:${i.toString(null!=r?r:"custom")}`),l.event.create(`posterText:postedWith:textScale:${i.toString(100*n+.5|0)}percent`),l.event.create(`posterText:postedWith:location:${i.toString(S)}`),l.event.create(`posterText:postedWith:background:type:${i.toString(C)}`),l.event.create(`posterText:postedWith:background:colored:${i.toString(!!d)}`),l.event.create(`posterText:postedWith:background:rounded:${i.toString(!!y)}`),l.event.create(`posterText:postedWith:background:blur:${i.toString(v||"none")}`)},this.prototype.tryPosterText=function(){return n(779).loadAll().then(()=>l.event.create("posterText:stylesLoaded")),l.event.create("posterText:try"),this.models.newPostState.resetState(),this.models.newPostState.selectPhoto().then(this.models.navState.showPosterText)},this.prototype.cyclePosterTextScale=function(){return this.createEventOncePerHour("edit:cycle:textScale"),this.posterTextScaleStep=(this.posterTextScaleStep+1)%this.posterTextScales.length},this.prototype.cycleRoundedCorners=function(){return this.createEventOncePerHour("edit:cycle:roundedCorners"),this.posterTextCornersRounded=!this.posterTextCornersRounded},this.prototype.cyclePosterTextSeed=function(t){let n;return this.createEventOncePerHour(`edit:random:style:${i.toString(t.getName())}`),(n=h(this.posterTextSeedsByStyleName))[t.name]=e.random(),this.posterTextSeedsByStyleName=n},this.prototype.cyclePosterTextBackgroundBlur=function(){return this.createEventOncePerHour("edit:cycle:backgroundBlur"),this.posterTextBackgroundBlur=(()=>{switch(this.posterTextBackgroundBlur){case"light":return null;default:return"light"}})()},this.prototype.setPosterTextBackground=function(t){let e;return t=t&&p(t),(e=(()=>{switch(!1){case!(i.exists(t)&&t.eq(this.posterTextBackground)):return null;case!(null!=t):return"edit:background:setColor";default:return"edit:background:clearedColor"}})())&&this.createEventOncePerHour(e),this.posterTextBackground=t},this.prototype.setPosterTextForeground=function(t){return(t=p(t)).eq(this.posterTextForeground)||this.createEventOncePerHour("edit:foreground:setColor"),this.posterTextForeground=t},this.prototype.setPosterTextBackgroundOpacity=function(t){let e;return null!=(e=this.posterTextBackground)||(this.posterTextBackground=this.savedBackgroundColor),this.posterTextBackgroundOpacity=o(0,t-0,1),this.createEventOncePerHour("edit:background:opacity")},this.prototype.setPosterTextForegroundShade=function(t){return this.createEventOncePerHour("edit:foreground:setShade"),this.posterTextForegroundShade=t},this.prototype.setPosterTextBackgroundShade=function(t){return this.createEventOncePerHour("edit:background:setShade"),this.posterTextBackgroundShade=t}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(780))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(781)).includeInNamespace(n(786)).addModules({PosterTextAssetLoader:n(956),StandardImport:n(787)}),n(793),n(788),n(952)},function(t,e,n){t.exports=n(18).addNamespace("Imikimi.PosterText",class PosterText extends Neptune.PackageNamespace{}._configureNamespace(n(782))),n(783),n(784),n(785)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*","art-suite-clientApp":"git://github.com/imikimi/art-suite-clientApp"},"description":"Imikimi.Poster.Text","license":"Copyright (C) 2019 Imikimi, LLC","name":"imikimi-poster-text","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"webpack-dev-server  --progress","testInBrowser":"webpack-dev-server --progress"},"version":"0.1.4"}')},function(t,e,n){t.exports=n(781).addNamespace("PosterTextComponents",class PosterTextComponents extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(781).addNamespace("PosterTextLayout",class PosterTextLayout extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(781).addNamespace("PosterTextStyles",class PosterTextStyles extends Neptune.PackageNamespace{})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Promise"],[e,n(787)],t=>[n(788),{posterTextStyles:i.object(n(591).all,t=>n(952).modules[t]),loadAll:function(){return t.all(i.array(n(591).all,t=>n(952).modules[t].load()))}}]))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(307).mergeWithSelf())}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(784)).addModules({PtlBase:n(789),PtlBorder:n(790),PtlColumn:n(791),PtlDraw:n(792),PtlGlyph:n(795),PtlHBar:n(796),PtlInvert:n(797),PtlPadding:n(798),PtlRow:n(950),PtlText:n(951)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","Component","createObjectTreeFactory","merge","toInspectedObjects","point"],[e,n(787)],(t,e,n,r,o,s)=>{return i.defClass(class PtlBase extends t{constructor(t,e){super(...arguments),this.children=e,this.props=null!=t?t:{},i.each2(this.children,t=>t.parent=this)}},function(t,a,l){this.abstractClass(),this.postCreateConcreteClass=function({classModuleState:t,hotReloaded:i}){return a.postCreateConcreteClass.apply(this,arguments),i&&e.rerenderAll(),n(this)},this.getter({width:function(){let t;return i.exists(t=this.size)&&t.x||this.defaultWidth},fontSize:function(){return 24},margin:function(){let t;return null!=(t=this.props.margin)?t:this.parent?this.parent.margin:30},defaultWidth:function(){return 400},inspectedObjects:function(){let t;return{[this.class.name]:r(this.props,{size:this.size,children:(i.exists(t=this.children)&&t.length)>0?o(this.children):void 0})}},renderedChildren:function(){return i.array(this.children,t=>t.render())}}),this.prototype.scaleToFitParent=function(t,e){return t.minRatio(e)},this.prototype.stretchToFitParent=function(t,e){return t.div(e)},this.prototype.layoutChildren=function(t){return i.each2(this.children,e=>e.layout(t))},this.prototype.layout=function(t){return null!=t||(t=this.defaultWidth),this.layoutChildren(t),this.size=s(t,t/this.getAspectRatio(t))},this.prototype.layoutAndRender=function(){return this.layout(),this.render()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["point","Element"],[e,n(787)],(t,e)=>{return i.defClass(class PtlInvert extends(n(789)){},function(n,i,r){this.getter({marginlessAspectRatio:function(){return this.children[0].aspectRatio},lineWidth:function(){let t;return null!=(t=this.props.lineWidth)?t:this.margin},totalPadding:function(){return this.margin+this.lineWidth},aspectRatio:function(t=this.width){return t/((t-2*this.totalPadding)/this.marginlessAspectRatio+2*this.totalPadding)}}),this.prototype.layout=function(e=this.defaultWidth){return this.children[0].layout(e-2*this.totalPadding),this.size=t(e,e/this.getAspectRatio(e))},this.prototype.render=function(){return e({padding:this.margin+this.lineWidth,size:this.size,draw:{padding:this.lineWidth/2,outline:{lineWidth:this.lineWidth,color:"black"}}},this.renderedChildren)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Element"],[e,n(787)],t=>{return i.defClass(class PtlColumn extends(n(789)){},function(e,n,r){this.getter({totalMarginSize:function(){return(this.children.length-1)*this.margin},childrenColumnAspectRatio:function(){return 1/i.reduce(this.children,(t,{aspectRatio:e})=>t+1/e,null,0)},aspectRatio:function(t=this.width){return t/(t/this.childrenColumnAspectRatio+this.totalMarginSize)}}),this.prototype.render=function(){return t({size:this.size,childrenLayout:"column",childrenMargins:this.margin},this.renderedChildren)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Element"],[e,n(787),n(793)],t=>{return i.defClass(class PtlGlyph extends(n(789)){},function(e,n,i){this.getter({aspectRatio:function(){let t;return null!=(t=this.props.aspectRatio)?t:1}}),this.prototype.render=function(){return t(this.props,{size:this.size})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(783)).addModules({CanvasPath:n(794)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Component","Matrix","Element","Object","merge","String"],[e,n(787),n(313)],(t,e,n,r,o,s)=>{return i.defClass(class CanvasPath extends t{},function(t,a,l){this.propFields({fill:"black"}),this.getter({canvasPath:function(){let t;return null!=(t=this.props.canvasPath)?t:this.props.glyph}}),this.prototype.shape=function(t,n){return this.canvasPath.applyPath(t,e.scale(n))},this.prototype.hFlippedShape=function(t,n){return this.canvasPath.applyPath(t,e.scaleXY(-1,1).translateXY(1,0).scale(n))},this.prototype.render=function(){let t,e,a,l,u;return({fill:t,scale:e=1,size:a,hFlipped:l,hFlip:u}=this.props),l||(l=u),n({size:a||(this.canvasPath?{x:24*e*this.canvasPath.aspectRatio,y:24*e}:0),draw:this.canvasPath?{shape:l?this.hFlippedShape:this.shape,fill:i.is(t,r)?o(t,{fillRule:"nonzero"}):i.is(t,s)?{fillRule:"nonzero",color:t}:{fillRule:"nonzero",color:"black"}}:void 0})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Element","matrix","Math"],[e,n(787),n(793)],(t,e,r)=>{return i.defClass(class PtlGlyph extends(n(789)){},function(n,i,o){this.getter({glyph:function(){return this.props.glyph},rotated:function(){return this.props.rotated},glyphAspectRatio:function(){return this.glyph.aspectRatio},aspectRatio:function(){return this.rotated?1/this.glyphAspectRatio:this.glyphAspectRatio}}),this.prototype.render=function(){let n,i,o;return({hFlip:n,vFlip:i,rotated:o}=this.props),t({size:this.size,draw:{shape:(t,s)=>{let a;return this.glyph.applyPath(t,(n||i||o?(a=e(),o&&(a=a.rotate(r.PI/2).translateXY(1,0)),(n||i)&&(a=a.scaleXY(n?-1:1,i?-1:1).translateXY(n?1:0,i?1:0)),a):e()).scale(s))},fill:{fillRule:"nonzero",color:"black"}}})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Element"],[e,n(787),n(793)],t=>{return i.defClass(class PtlHBar extends(n(789)){},function(e,n,i){this.getter({height:function(){return this.margin},aspectRatio:function(t=this.defaultWidth){return t/this.height}}),this.prototype.render=function(){let e;return t({draw:null!=(e=this.props.draw)?e:"black",size:this.size})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["point","Element"],[e,n(787)],(t,e)=>{return i.defClass(class PtlInvert extends(n(789)){},function(n,i,r){this.getter({totalMarginSize:function(){return 2*this.margin},marginlessAspectRatio:function(){return this.children[0].aspectRatio},aspectRatio:function(t=this.width,e=this.margin){let n,i;return t/((i=(n=t-2*e)/this.marginlessAspectRatio)+2*e)}}),this.prototype.layout=function(e=this.defaultWidth){return this.children[0].layout(e-this.totalMarginSize),this.size=t(e,e/this.getAspectRatio(e))},this.prototype.render=function(){return e({padding:this.margin,size:this.size,draw:"black"},e({compositeMode:"targetWithoutSource"},this.renderedChildren))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["point","Element"],[e,n(787),n(417),n(799)],(t,e)=>{return i.defClass(class PtlPadding extends(n(789)){},function(n,i,r){this.getter({marginlessAspectRatio:function(){return this.children[0].aspectRatio},hWeight:function(){let t;return 2*(null!=(t=this.props.h)?t:0)+1},vWeight:function(){let t;return 2*(null!=(t=this.props.v)?t:0)+1},aspectRatio:function(){return this.marginlessAspectRatio*this.hWeight/this.vWeight}}),this.prototype.layout=function(e=this.defaultWidth){return this.children[0].layout(e/this.hWeight),this.size=t(e,e/this.aspectRatio)},this.prototype.render=function(){return e({size:this.size,childrenLayout:"row",childrenAlignment:.5},this.renderedChildren)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(800))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","mergeInto","Object","log","w","upperCamelCase","merge","GoogleFontLoader","Error","Promise"],[e,n(801)],(t,e,n,r,o,s,a,l,u,c)=>{let h,p,d;return d=t(),h=d.newFeatures,p=d.edge,null!=h||(h=p),i.defClass(class Fonts extends n{},function(t,p,d){let f,m;this.defaultFont="arial",this.fonts={arial:{tags:"sans paragraph",guest:!0,builtIn:!0,fontFamily:"Arial, sans-serif"},courierNew:{tags:"serif monospace",guest:!0,builtIn:!0,fontFamily:"Courier New"},timesNewRoman:{tags:"serif paragraph",guest:!0,builtIn:!0,fontFamily:"Times New Roman"},impact:{tags:"sans bold poster",guest:!0,builtIn:!0,fontFamily:"Impact, AvenirNext-Heavy, Helvetica,Neue-Bold, sans-serif"},poppins:{tags:"sans paragraph",fontFamily:"'Poppins', sans-serif"},aBeeZee:{tags:"sans paragraph",fontFamily:"'ABeeZee', sans-serif"},openSans:{tags:"sans paragraph",fontFamily:"'Open Sans', sans-serif"},raleway:{tags:"sans paragraph",fontFamily:"'Raleway', sans-serif"},josefinSans:{tags:"sans paragraph",fontFamily:"'Josefin Sans', sans-serif"},arimo:{tags:"sans paragraph",fontFamily:"'Arimo', sans-serif"},titanOne:{tags:"sans bold poster",fontFamily:"'Titan One', cursive"},sigmarOne:{tags:"sans bold poster",fontFamily:"'Sigmar One', cursive"},fredokaOne:{tags:"sans bold poster",fontFamily:"'Fredoka One', cursive"},lobster:{tags:"sans bold",fontFamily:"'Lobster', cursive"},bangers:{tags:"sans bold poster playful",fontFamily:"'Bangers', cursive"},rammettoOne:{tags:"sans bold poster",fontFamily:"'Rammetto One', cursive"},balooTammudu:{tags:"sans bold",fontFamily:"'Baloo Tammudu', cursive"},playfairDisplay:{tags:"serif paragraph",fontFamily:"'Playfair Display', serif"},alegreya:{tags:"serif paragraph",fontFamily:"'Alegreya', serif"},cardo:{tags:"serif paragraph",fontFamily:"'Cardo', serif"},cantataOne:{tags:"serif paragraph",fontFamily:"'Cantata One', serif"},bellefair:{tags:"serif paragraph",fontFamily:"'Bellefair', serif"},crimsonText:{tags:"serif paragraph",fontFamily:"'Crimson Text', serif"},cormorantGaramond:{tags:"serif paragraph",fontFamily:"'Cormorant Garamond', serif"},oldStandardTt:{tags:"serif paragraph",fontFamily:"'Old Standard TT', serif"},specialElite:{tags:"serif dirty",fontFamily:"'Special Elite', cursive"},stylish:{tags:"serif dirty",fontFamily:"'Stylish', sans-serif"},anonymousPro:{tags:"serif monospace",fontFamily:"'Anonymous Pro', monospace"},gabriela:{tags:"serif",fontFamily:"'Gabriela', serif"},slabo:{tags:"serif slab",fontFamily:"'Slabo 27px', serif",name:"Slabo"},portLligatSlab:{tags:"serif slab",fontFamily:"'Port Lligat Slab', serif"},breeSerif:{tags:"serif slab bold",fontFamily:"'Bree Serif', serif"},shrikhand:{tags:"serif slab bold",fontFamily:"'Shrikhand', cursive"},alfaSlabOne:{tags:"serif slab bold",fontFamily:"'Alfa Slab One', cursive"},ultra:{tags:"serif slab bold poster",fontFamily:"'Ultra', serif"},fugazOne:{tags:"sans slab bold poster",fontFamily:"'Fugaz One', cursive"},inknutAntiqua:{tags:"serif slab",fontFamily:"'Inknut Antiqua', serif"},homemadeApple:{tags:"handwritten dirty cursive",fontFamily:"'Homemade Apple', cursive"},frederickaTheGreat:{tags:"handwritten dirty serif",fontFamily:"'Fredericka the Great', cursive"},laBelleAurore:{tags:"handwritten cursive",fontFamily:"'La Belle Aurore', cursive"},gamjaFlower:{tags:"handwritten sans playful",fontFamily:"'Gamja Flower', cursive"},indieFlower:{tags:"handwritten sans playful",fontFamily:"'Indie Flower', cursive"},emilysCandy:{tags:"handwritten dirty playful",fontFamily:"'Emilys Candy', cursive"},sedgwickAveDisplay:{tags:"handwritten bold playful",fontFamily:"'Sedgwick Ave Display', cursive"},barrio:{tags:"handwritten bold theme playful",fontFamily:"'Barrio', cursive"},chelseaMarket:{tags:"handwritten dirty playful",fontFamily:"'Chelsea Market', cursive"},loveYaLikeASister:{tags:"handwritten dirty playful",fontFamily:"'Love Ya Like A Sister', cursive"},freckleFace:{tags:"handwritten bold playful",fontFamily:"'Freckle Face', cursive"},newRocker:{tags:"theme bold playful",fontFamily:"'New Rocker', cursive"},frijole:{tags:"theme bold dirty playful",fontFamily:"'Frijole', cursive"},griffy:{tags:"theme dirty playful",fontFamily:"'Griffy', cursive"},eater:{tags:"theme bold dirty playful",fontFamily:"'Eater', cursive"},creepster:{tags:"theme bold dirty theme playful",fontFamily:"'Creepster', cursive"},nosifer:{tags:"theme bold playful",fontFamily:"'Nosifer', cursive"},aclonica:{tags:"theme bold playful",fontFamily:"'Aclonica', sans-serif"},fasterOne:{tags:"theme bold playful",fontFamily:"'Faster One', cursive"},blackOpsOne:{tags:"theme bold poster playful",fontFamily:"'Black Ops One', cursive"},meriendaOne:{tags:"theme bold",fontFamily:"'Merienda One', cursive"},shojumaru:{tags:"theme bold playful",fontFamily:"'Shojumaru', cursive"},sancreek:{tags:"theme bold",fontFamily:"'Sancreek', cursive"},tradeWinds:{tags:"theme bold dirty playful",fontFamily:"'Trade Winds', cursive"},jollyLodger:{tags:"theme bold playful",fontFamily:"'Jolly Lodger', cursive"},metalMania:{tags:"theme bold dirty playful",fontFamily:"'Metal Mania', cursive"},pressStart2P:{tags:"theme bold playful",fontFamily:"'Press Start 2P', cursive",googleFontFamily:"Press Start 2P"},flavors:{tags:"theme bold dirty playful",fontFamily:"'Flavors', cursive"},hennyPenny:{tags:"playful serif",fontFamily:"'Henny Penny', cursive"},luckiestGuy:{tags:"playful sans bold poster",fontFamily:"'Luckiest Guy', cursive"},rancho:{tags:"playful sans",fontFamily:"'Rancho', cursive"},fontdinerSwanky:{tags:"playful bold serif",fontFamily:"'Fontdiner Swanky', cursive"},peralta:{tags:"playful bold serif slab",fontFamily:"'Peralta', cursive"},milonga:{tags:"serif",fontFamily:"'Milonga', cursive"},risque:{tags:"playful serif",fontFamily:"'Risque', cursive"},snowburstOne:{tags:"playful serif",fontFamily:"'Snowburst One', cursive"},irishGrover:{tags:"playful serif",fontFamily:"'Irish Grover', cursive"},spicyRice:{tags:"playful bold theme sans",fontFamily:"'Spicy Rice', cursive"},ribeye:{tags:"playful bold serif",fontFamily:"'Ribeye', cursive"},rumRaisin:{tags:"playful sans",fontFamily:"'Rum Raisin', sans-serif"},poiretOne:{tags:"theme light sans",fontFamily:"'Poiret One', cursive"},unifrakturCook:{tags:"theme bold sans",fontFamily:"'UnifrakturCook', cursive",googleFontFamily:"UnifrakturCook:700"},unifrakturMaguntia:{tags:"theme serif",fontFamily:"'UnifrakturMaguntia', cursive"},limelight:{tags:"theme bold sans poster",fontFamily:"'Limelight', cursive"},cinzelDecorative:{tags:"theme light serif",fontFamily:"'Cinzel Decorative', cursive"},cinzel:{tags:"theme light serif",fontFamily:"'Cinzel', serif"},ruthie:{tags:"cursive light",fontFamily:"'Ruthie', cursive"},pinyonScript:{tags:"cursive",fontFamily:"'Pinyon Script', cursive"},mrDafoe:{tags:"cursive bold",fontFamily:"'Mr Dafoe', cursive"},monsieurLaDoulaise:{tags:"cursive light",fontFamily:"'Monsieur La Doulaise', cursive"},italianno:{tags:"cursive",fontFamily:"'Italianno', cursive"},dancingScript:{tags:"cursive",fontFamily:"'Dancing Script', cursive"},satisfy:{tags:"cursive",fontFamily:"'Satisfy', cursive"},greatVibes:{tags:"cursive",fontFamily:"'Great Vibes', cursive"},kaushanScript:{tags:"cursive bold",fontFamily:"'Kaushan Script', cursive"},sacramento:{tags:"cursive light",fontFamily:"'Sacramento', cursive"},tangerine:{tags:"cursive light",fontFamily:"'Tangerine', cursive"},badScript:{tags:"cursive light playful handwritten",fontFamily:"'Bad Script', cursive"},playball:{tags:"cursive bold",fontFamily:"'Playball', cursive"},alexBrush:{tags:"cursive",fontFamily:"'Alex Brush', cursive"},allura:{tags:"cursive",fontFamily:"'Allura', cursive"},rochester:{tags:"cursive",fontFamily:"'Rochester', cursive"},rougeScript:{tags:"cursive",fontFamily:"'Rouge Script', cursive"},stalemate:{tags:"cursive light",fontFamily:"'Stalemate', cursive"},mrsSaintDelafield:{tags:"cursive light",fontFamily:"'Mrs Saint Delafield', cursive"},molle:{tags:"cursive bold",fontFamily:"'Molle', cursive",googleFontFamily:"Molle:400i"},pacifico:{tags:"cursive bold",fontFamily:"'Pacifico', cursive"},seaweedScript:{tags:"new dirty handwritten theme cursive playful",fontFamily:"'Seaweed Script', cursive"},fellEnglish:{tags:"new dirty handwritten poster serif",fontFamily:"'IM Fell English SC', serif",googleFontFamily:"IM+Fell+English+SC",name:"Fell English"},diplomataSc:{tags:"new bold theme serif",fontFamily:"'Diplomata SC', cursive"},ewert:{tags:"new theme playful",fontFamily:"'Ewert', cursive"},oswald:{tags:"new bold sans poster",fontFamily:"'Oswald', sans-serif",googleFontFamily:"Oswald:700"},bungee:{tags:"new bold poster sans",fontFamily:"'Bungee', cursive"},monoton:{tags:"new theme",fontFamily:"'Monoton', cursive"},orbitron:{tags:"new bold sans theme poster",fontFamily:"'Orbitron', sans-serif",googleFontFamily:"Orbitron:900"},exo2:{tags:"new bold sans theme poster",fontFamily:"'Exo 2', sans-serif",googleFontFamily:"Exo+2:900"}},f={anton:{tags:"new bold poster sans",fontFamily:"'Anton', sans-serif"},bungeeShade:{tags:"new bold poster sans",fontFamily:"'Bungee Shade', cursive"},heebo:{tags:"new bold sans poster",fontFamily:"'Heebo', sans-serif",googleFontFamily:"Heebo:900"},kanit:{tags:"new bold sans poster",fontFamily:"'Kanit', sans-serif",googleFontFamily:"Kanit:900"},kavoon:{tags:"new bold theme playful",fontFamily:"'Kavoon', cursive"},modak:{tags:"new bold sans playful",fontFamily:"'Modak', cursive"},montserrat:{tags:"new bold sans poster",fontFamily:"'Montserrat', sans-serif",googleFontFamily:"Montserrat:900"},ralewayBold:{tags:"new bold sans poster",fontFamily:"'Raleway', sans-serif",googleFontFamily:"Raleway:900",fontWeight:"900",name:"Railway Bold"},ranchers:{tags:"new bold sans",fontFamily:"'Ranchers', cursive"},titilliumWeb:{tags:"new bold sans poster",fontFamily:"'Titillium Web', sans-serif",googleFontFamily:"Titillium+Web:900"},wendyOne:{tags:"new bold sans poster",fontFamily:"'Wendy One', sans-serif"},workSans:{tags:"new bold sans poster",fontFamily:"'Work Sans', sans-serif",googleFontFamily:"Work+Sans:900"},carterOne:{tags:"new bold sans",fontFamily:"'Carter One', cursive"},asul:{tags:"new light serif",fontFamily:"'Asul', sans-serif"},capriola:{tags:"new light sans",fontFamily:"'Capriola', sans-serif"},comfortaa:{tags:"new light sans",fontFamily:"'Comfortaa', cursive"},economica:{tags:"new light sans",fontFamily:"'Economica', sans-serif"},tillana:{tags:"new light theme dirty",fontFamily:"'Tillana', cursive"},neuton:{tags:"new serif paragraph",fontFamily:"'Neuton', serif"},spaceMono:{tags:"new sans monospace",fontFamily:"'Space Mono', monospace"}},h&&e(this.fonts,f),this.fontTags={},this.fonts=i.object(this.fonts,(t,e)=>{let n,r,l,u,c,h,p;return({fontFamily:n,googleFontFamily:r,tags:l,name:u}=t),l.match(/playful/)||(l+=" staid"),l.match(/bold|light/)||(l+=" medium"),l.match(/serif|sans|theme|playful|cursive/)||(l+=" todoSerif"),l=i.array(o(l),t=>"#"+t),i.array(l,t=>this.fontTags[t]=!0),/'/.test(n)?([c,h]=n.split("'"),null!=u||(u=h),null!=r||(r=h)):null!=u||(u=s(e," ")),null!=r||(r=n),p=`${i.toString(u)} ${i.toString(l)}`,a(t,{name:u,googleFontFamily:r,search:p,tags:l})}),this.fontTags=n.keys(this.fontTags),this.searchFonts=(t=>i.array(this.fonts,null,e=>e.search.match(t))),this.getFontFamily=(t=>this.fonts[t].fontFamily),this.getFontName=(t=>this.fonts[t].name),this.loadAllFonts=(()=>((this._allFontsLoadPromise=l.load(i.array(this.fonts,t=>t.googleFontFamily,t=>!t.builtIn))).then(()=>i.object(this.fonts,()=>!0,null,this._loadedFonts)),i.object(this.fonts,()=>this._allFontsLoadPromise,null,this._loadingFontPromises),this._allFontsLoadPromise)),this.getFontIsLoaded=(t=>!!this._loadedFonts[t]),this.loadFont=m=(t=>{let e,n,r;if(!(e=this.fonts[t]))throw new u(`invalid font key: ${i.toString(t)}`);return null!=(n=(r=this._loadingFontPromises)[t])?n:r[t]=c.then(()=>!!this._loadedFonts[t]||l.load(e.googleFontFamily).then(()=>this._loadedFonts[t]=!0))}),this.zoLoadFont=m,this.getFonts=(()=>this.fonts),this._loadedFonts={},i.array(this.fonts,({builtIn:t},e)=>this._loadedFonts[e]=!!t),this._loadingFontPromises={},h&&(r("newFeatures: loading all fonts!"),this.loadAllFonts().then(function(){return r("newFeatures: all fonts loaded")}))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(802))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(803).mergeWithSelf(n(804)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(268))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(307).merge(n(805),n(906)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(298)).includeInNamespace(n(806)).addModules({AbstractOverlayComponent:n(873),ColorFadeOverlay:n(876),CommentForm:n(877),CustomizeKimiButton:n(822),DisplayTags:n(817),DownloadButton:n(878),FeedLabel:n(879),FilterTextInput:n(880),LargeBecomeAMemberButton:n(857),LargeMenuButton:n(881),MarkdownInlinePost:n(820),MarkdownView:n(816),MemberCircle:n(855),MembershipRequiredButton:n(882),NativeAppSubscriptionPrompt:n(883),NewFeature:n(884),NotchPreview:n(885),PopOver:n(874),PopOverTitleBar:n(875),PostDate:n(886),PosterTextButton:n(887),PosterTextIcon:n(888),PrevNextButton:n(889),PrivateStreamBadge:n(890),RelaxedMenuButton:n(891),SearchBar:n(892),SelectableTextWrapper:n(893),SelectedTextPopover:n(847),ShowError:n(894),ShowMedia:n(819),ShowMediaWithText:n(821),SlideshowElement:n(895),StandardImport:n(809),StatusBarPreview:n(896),StatusMessage:n(865),StreamHeading:n(897),TabBarSpacer:n(898),TabbedPage:n(899),TabbedSection:n(901),TabbedSection2:n(900),TagLink:n(818),TextCopier:n(902),Toggle:n(868),TrackingConsentMessage:n(903),TrialMembershipExpired:n(856),UserCircle:n(872),ZoLogo:n(904)}),n(811),n(807)},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(807),n(811)])}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(300)).addModules({MenuFollowOptions:n(808),MenuTopic:n(870),MenuUser:n(871)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pipelines","vertical","timeout","MenuChooseAndConfirm","MenuSection","Element","MenuToggle","ImikimiPalette","MenuSectionGroup","getVerticalRootHostname","MenuMarkdown"],[e,n(809),n(811)],(t,e,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class MenuFollowOptions extends t{},function(t,f,m){let g,y;this.subscriptions("viewState.gridSize","currentSession.currentUser",{topic:g=function({topic:t}){return i.exists(t)&&t.id},followingTopic:g,topicFollower:y=function(t){let e,n;return e=g(t),n=t.currentUserId,e&&n?{topicId:e,userId:n}:void 0},topicMembership:y,topicInvite:y}),this.propFields("currentUserId"),this.getter({topicId:function(){let t;return i.exists(t=this.props.topic)&&t.id},isFollowing:function(){return!!this.followingTopic},isSubscribed:function(){let t;return i.exists(t=this.topicFollower)&&t.subscribed}}),this.prototype.toggleFollowing=function(){return this.currentUserId?(this.isSubscribed&&this.toggleSubscribing(),this.models.followingTopic.toggleFollowing(this.topic)):this.showLogin()},this.prototype.toggleSubscribing=function(){return this.isSubscribed?e.topicFollower.unsubscribe(this.topicId):e.topicFollower.subscribe(this.topicId,{data:{vertical:r}})},this.prototype.showLogin=function(){return this.props.pushPage({render:this.renderAuthUi})},this.prototype.showLeaveStream=function(){return o(500,()=>this.props.pushPage({component:s,props:{label:"Cancel Stream Membership",generateConfirmMessage:t=>`Hide this stream because ${i.toString(t)}`,currentUserRequired:!0,icon:"logout",info:`This is a private stream. If you leave, you will no longer be able to:\n\n* see this stream or any of its posts\n\n${i.toString(this.isFollowing?"* follow this stream":void 0)}\n${i.toString(this.isSubscribed?"* subscribe to this stream":void 0)}\n\nYou will not be able to re-join this stream without being re-invited.\n\nAre you sure you want to cancel your membership and leave this stream?`,options:"Yes, I want to leave this stream",completionMessage:"",action:()=>(this.props.popPage(),this.leaveStream()),noConfirm:!0}}))},this.prototype.leaveStream=function(){return e.topicMembership.delete({key:{topicId:this.topicId,userId:this.currentUserId}})},this.prototype.renderAuthUi=function(){let t;return t=this.gridSize,this.currentUser&&this.props.popPage(),a(l({size:t}),n(869).Auth.Authenticate({heading:"Join to Follow this Stream",reason:"follow",success:this.props.popPage}))},this.prototype.render=function(){let t,e,n,o;return t=i.exists(n=this.topic)&&n.private&&this.topicMembership,l("parentWidthChildrenHeight","column",this.topicMembership?u({key:"streamMemberToggle",icon:"user",isOn:!0,text:"Stream Member",action:this.showLeaveStream}):void 0,u({key:"followToggle",icon:"heart",text:"Follow stream",iconColor:this.followingTopic&&c.red,isOn:this.followingTopic,action:this.toggleFollowing}),this.currentUserId&&this.followingTopic?h(u({icon:"mail",key:"subscriptionToggle",heartOverlay:this.isSubscribed,text:"Subscribe to email updates",isOn:this.isSubscribed,action:this.toggleSubscribing})):void 0,this.isSubscribed||this.isFollowing||t?(e=`> ${i.toString(t?"You are a member of this private stream.":void 0)} ${i.toString(this.isFollowing?"This stream will show up on your home page.":void 0)} ${i.toString(this.isSubscribed?"You will receive emails for new posts.":void 0)} ${i.toString(i.exists(o=this.topicFollower)&&o.vertical&&this.topicFollower.vertical!==r?`You subscribed to this stream on ${i.toString(p(this.topicFollower.vertical))}.`:void 0)}`,h({key:e},d({text:e}))):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(810))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(268))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(299)).addModules({MenuButton:n(812),MenuButton2:n(813),MenuChooseAndConfirm:n(814),MenuDivider:n(854),MenuEditableText:n(858),MenuField:n(861),MenuHeading:n(862),MenuInfo:n(860),MenuLib:n(852),MenuLoadingSpinner:n(863),MenuMarkdown:n(815),MenuSection:n(850),MenuSectionGroup:n(853),MenuSectionLabel:n(851),MenuStatusMessage:n(864),MenuTextEdit:n(859),MenuTextInput:n(866),MenuToggle:n(867)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ImikimiPalette","TextPalette","Element","ButtonWrapper","BitmapElement","TextElement","Icons","TextStyles","capitalize"],[e,n(809)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class MenuButton extends t{},function(t,h,p){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T;return t=(C=this.viewState).gridSize,h=C.buttonSize,_=this.props,p=_.icon,d=_.rightText,f=_.text,m=void 0!==(E=_.height)?E:h,g=_.bitmapIcon,y=_.customIcon,v=_.centered,S=_.hoverColor,b=_.lightText,w=_.backgroundColor,x=b?(w||(w=e.primary),S||(S=e.primary.withAlpha(.67)),n.white.primary):n.black.softPrimary,r({size:{ww:1,h:m},padding:(P=!(p||g||y))?{right:-t/2,left:h-t}:{h:-t/2}},o(this.props,{backgroundColor:w,hoverColor:S,size:{ww:1,h:m}},r({padding:P?{left:t}:void 0,childrenMargins:t/2},"row",v?"childrenCenterCenter":"childrenCenterLeft",(()=>{switch(!1){case!g:return s({padding:10,size:h,source:g});case!y:return r({size:h},r({size:25},"centerCenter",y));case!p:return a(p=l[p],{size:h,color:null!=(T=i.exists(p)&&p.color)?T:x,align:.5},this.props.memberOnly?{color:e.goldGradient,to:"bottomRight"}:void 0)}})(),a(this.props.small?u.smallText:u.mediumText,"parentWidthChildrenHeight","textCenterLeft",{text:c(f),color:x}),d&&a(u.smallText,"childrenSize",{animators:{opacity:{toFrom:0}},padding:{right:t},text:d,color:x}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette","ButtonWrapper2","Element","TextElement","Icons","TextStyles","capitalize"],[e,n(809)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class MenuButton2 extends t{},function(t,u,c){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,u,c,h,p,d,f,m,g,y,v;return g=this.viewState,t=g.gridSize,u=g.buttonSize,c=(y=this.props).noIcons,h=y.customIcon,p=y.icon,d=y.rightText,f=y.text,m=e.black.softPrimary,n(this.props,{size:{ww:1,h:u}},r({childrenMargins:t/2},"row","childrenCenterLeft",{padding:p||h?void 0:{left:t}},(()=>{switch(!1){case!h:return r({padding:t/4,size:u},h);case!p:return o(p=s[p],{size:u,color:null!=(v=i.exists(p)&&p.color)?v:m},"textCenterCenter")}})(),o(a.mediumText,"parentWidthChildrenHeight","textCenterLeft",{text:l(f),color:m}),null!=d&&o(a.smallText,"childrenSize",{padding:{right:t},text:d,color:m})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","isString","Promise","MenuSectionGroup","MenuSection","Neptune","MenuMarkdown","MenuButton","isArray","LoadingOverlay","openLink"],[e,n(809),{MenuMarkdown:n(815),MenuButton:n(812),MenuSection:n(850),MenuSectionGroup:n(853)}],(t,e,n,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class MenuChooseAndConfirm extends t{},function(t,d,f){this.subscriptions("viewState.gridSize","currentSession.currentUserId"),this.stateFields({selectedOptionKey:null,selectedOption:null,showCompletionMessage:!1,loading:!1}),this.prototype.preprocessProps=function(t){let r,o;return({options:r,generateConfirmMessage:o}=t),e([t,n(r)?{options:r.trim().split("\n")}:void 0],{generateConfirmMessage:null!=o?o:(t,e)=>`confirm your selection:\n${i.toString(e)}`})},this.prototype.close=function(){let t;return i.isF((t=this.props).close)&&t.close()},this.prototype.applyChoice=function(){let t,e;return({action:t,completionMessage:e}=this.props),this.triggerLoading(),r.then(()=>t(this.selectedOptionKey,this.selectedOption)).then(()=>e?this.triggerShowCompletionMessage():this.close()).finally(this.clearLoading)},this.prototype.render=function(){let t,r,d,f,m,g,y,v,S,b,w,x,P,C,_,E;return t=(_=this.props).options,r=_.action,d=_.close,f=_.label,m=_.info,g=_.prompt,y=_.completionMessage,v=_.generateConfirmMessage,S=_.changeSelectionMessage,b=_.icon,w=_.noConfirm,x=_.infoLink,o(this.props.currentUserRequired&&!this.currentUserId?s({key:"login"},a.Imikimi.Oz.Client.Components.Auth.Authenticate({padding:{top:this.gridSize},reason:"menuChoose",heading:`Join to ${i.toString(null!=f?f:"Continue")}`})):[s({label:f},l(null,this.showCompletionMessage?{key:y,text:y}:n(m)?{key:m,text:m}:e({key:m.text},m)),x?(({text:P,url:C}=x),u(x,{action:()=>p(x.url)})):void 0),this.showCompletionMessage||!t?void 0:null!=this.selectedOption?s({key:"confirm step",label:`Confirm: ${i.toString(g)}`},u({height:5*this.gridSize,icon:"checkmark",text:null!=(E=i.isF(v)&&v(this.selectedOptionKey,this.selectedOption))?E:this.selectedOption,action:this.applyChoice}),u({icon:"undo",text:S||"choose another option",action:()=>this.selectedOptionKey=this.selectedOption=null})):s({key:"select step",label:g},c(t)?i.array(t,t=>u({icon:b,text:t,action:()=>this.selectStepOne(t,t)})):i.array(t,(t,e)=>u({icon:b,text:t,action:()=>this.selectStepOne(e,t)})))],this.props.close&&s(u({icon:"cancel",text:"cancel",action:this.close})),this.loading&&h())},this.prototype.selectStepOne=function(t,e){return this.selectedOptionKey=t,this.selectedOption=e,this.props.noConfirm?this.applyChoice():void 0}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element"],[e,n(809)],(t,e)=>{return i.defClass(class MenuMarkdown extends t{},function(t,i,r){this.subscriptions("viewState.gridSize"),this.stateFields({showMoreButton:!1,showMore:!1}),this.prototype.showingLess=function(){return this.showMoreButton=!0},this.prototype.render=function(){let t,i,r,o,s,a,l,u;return t=(l=this.props).maxMarkdownBlocks,i=l.text,r=l.small,o=l.large,s=l.includeTags,a=l.stringVariables,this.showMore&&(t=void 0),n(816)({style:"dialog",padding:null!=(u=this.props.padding)?u:{v:this.gridSize},maxMarkdownBlocks:t,text:i,small:r,large:o,includeTags:s,stringVariables:a,showingLess:this.showingLess},this.showMoreButton?e({padding:{top:this.gridSize}},"parentWidthChildrenHeight",n(812)({small:!0},this.showMore?{icon:"triangleUp",text:"less..."}:{icon:"triangleDown",text:"more..."},{action:this.toggleShowMore})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["MarkdownStyles","FluxComponent","isString","log","merge","deepMerge","applyStringVariables","ImikimiPalette","parseMarkdown","vertical","detagString","config","present","TextElement","ScrollElement","Element","DisplayTags","internalLinkToPostId","max","MarkdownInlinePost","rgbColor","TextPalette","SelectedTextPopover"],[e,n(809),{DisplayTags:n(817),MarkdownInlinePost:n(820),SelectedTextPopover:n(847)}],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C)=>{let _,E;return _=t,E=t.default,i.defClass(class MarkdownView extends(n(594)(e)){},function(t,e,n){this.subscriptions("viewState.viewState","post",{topic:function({topicId:t,post:e}){return null!=t?t:i.exists(e)&&e.topicId}}),this.prototype.preprocessProps=function(t){let e,n;return E!==(e=t.style)?(r(n=e)&&(null==(e=_[e])&&o.warn(`invalid markdown style: ${i.toString(n)}`)),s(t,{style:a(E,e)})):t},this.propFields({style:E}),this.stateFields({showCopyButton:!1,selectedTextMenuLocation:null}),this.getter({text:function(){let t,e;return l(null!=(t=this.props.text)?t:i.exists(e=this.props.post)&&e.caption,this.props.stringVariables)},textStyles:function(){let t,e;return null!=(e=(t=this.style.textStyles)[this.props.textStyle])?e:(()=>{switch(!1){case!this.props.large:return t.large;case!this.props.small:return t.small;default:return t.medium}})()},baseFontSize:function(){return this.textStyles.paragraphStyle.fontSize},size:function(){let t;return null!=(t=this.props.size)?t:"parentWidthChildrenHeight"},baseMargin:function(){return this.baseFontSize*(this.props.preview?1.5:2)},compressedMargin:function(){return this.baseMargin/4},indent:function(){return this.baseFontSize*(this.props.preview?.5:1.5)},leading:function(){return this.props.preview?1.25:1.58},palette:function(){return this.style.palette},textPalette:function(){return this.props.lightText?this.style.textPalette.white:this.style.textPalette.black},codePalette:function(){return this.props.lightText?u.codePalette.dark:u.codePalette.light},markdownBlocks:function(){let t,e,n,r;return({maxMarkdownBlocks:t}=this.props),t<(e=c(null!=(n=this.text)?n:"")).length&&(i.isF((r=this.props).showingLess)&&r.showingLess(),e=e.slice(0,t)),e}}),this.prototype.renderBodyText=function(){let t,e,n,r,o,s,a,l,u,c,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q,H,V,$,G;return H=this.props,t=H.includeTags,e=H.foregroundColor,n=H.backgroundColor,r=H.post,o=H.preview,r=H.post,s=H.topic,a=H.searchKimis,l=H.searchInTopicId,"imikimi"!==h&&(null!=l||(l=null!=(V=i.exists(r)&&r.topicId)?V:i.exists(s)&&s.id)),u=this.viewState.gridSize,$=this.textStyles,c=$.h1Style,x=$.titleStyle,P=$.h2Style,C=$.paragraphStyle,_=$.monoStyle,E=$.quoteStyle,T=$.l1Style,k=$.l2Style,G=this,I=this.baseMargin,M=this.compressedMargin,A=this.indent,F=this.leading,B=this.textPalette,R=this.markdownBlocks,z=this.baseFontSize,O=this.codeBackgroundColor,L=this.codeForegroundColor,D=this.codePalette,N=[null,null,null],U=null,W=null,j=!1,q=0,i.array(R,({text:s,align:a,style:h,depth:M},R)=>{let z,O,L,q,H,V,$,G,Y,K,X,J,Q,Z,tt,et;return"code"!==h&&(t||o)?[z,s]=p(s,"imikimi"===d.vertical?3:10,!0):z=null,O=(i.exists(z)&&z.length)>0,L=j,j=O,O&&(q=[],H=[],i.each2(z,t=>{let e;return(e=S(t))?q.push(e):H.push(t)}),z=H),V="left"!==a?"parentWidthChildrenHeight":this.size,$=B.primary,G={align:a,leading:F,text:s,color:$,size:V},o&&(G.maxLines=5),Y=W,K=U,U=M,W=h,X=0,J=f(s)?(()=>{switch(h){case"heading":return m(1===M?Y?c:x:P,G);case"code":return G.text=s.replace(/\n```$/,""),g({pointerEventPriority:1,size:"childrenSizeMaxParentWidth",padding:{left:A*M},childrenLayout:"row"},y({size:"childrenSize",draw:{radius:A/4,fill:D.background}},m(_,G,{padding:A/2,size:"childrenSize",color:D.foreground})));case"quote":return m(E,{padding:{h:X=A*M}},G,{color:B.secondary});case"bullet":return Q=(()=>{switch(M){case 1:return T;case 2:return k}})(),y({size:V,padding:{left:X=A*M}},m(Q,"textCenterCenter",{text:this.style.bullets[M-1],axis:"topRight",color:G.color,size:{hch:1,w:A}}),m(Q,G));case"indented":return Q=(()=>{switch(M){case 1:return T;case 2:return k}})(),y({size:V,padding:{left:X=A*M,right:"left"!==a?A*M:void 0}},m(Q,G));case"list":if(Q=(()=>{switch(M){case 1:return T;case 2:return k}})(),Y!==h)for(Z=K+1;Z<3;)N[Z]=null,Z++;return tt=N[M]=1+(0|N[M]),M<1&&(N[1]=null),M<2&&(N[2]=null),y("row",{size:V,padding:{left:X=A*(M-1)}},m(Q,{text:`${i.toString(tt)}.`,color:G.color,padding:{right:h.fontSize/2},size:{hch:1,w:(t,e)=>b(e.w,A)}}),m(Q,G));default:return f(s)?m(C,G):void 0}})():void 0,[Y?(et=I*(J?(()=>{switch(h){case"bullet":case"list":return(()=>{switch(Y){case"bullet":case"list":return.75;default:return 1}})();case"heading":return 1===M?1.5:1.25;default:return 1}})():1),L&&(et-=.5*I),("code"===Y||"code"===h)&&(et-=I/4),y({size:et})):void 0,J,(i.exists(q)&&q.length)>0&&!o?q.length>1?y("parentWidthChildrenHeight","column",{childrenMargins:u},i.array(q,e=>w({postId:e,inTopic:this.topic,inPost:r,imageOnly:!t}))):y({padding:{top:J?I/2:0,h:X},size:"parentWidthChildrenHeight",childrenLayout:"column"},i.array(q,e=>w({postId:e,inTopic:this.topic,inPost:r,imageOnly:!t}))):void 0,t&&O?y({size:"parentWidthChildrenHeight",padding:{top:1*I/4,bottom:"bullet"===h||"list"===h?I/4:0,h:X}},v({tags:z,align:a,backgroundColor:n,foregroundColor:e,searchInTopicId:l,kimis:this.props.searchKimis,largeCrossLinks:!0,fromPostId:i.exists(r)&&r.id})):void 0]})},this.prototype.render=function(){let t,e;return t=this.viewState.gridSize,y({size:this.size,padding:this.props.padding,on:{pointerClick:({location:t})=>(this.showCopyButton||(this.selectedTextMenuLocation=t),this.toggleShowCopyButton()),blur:this.clearShowCopyButton},childrenLayout:"column"},this.showCopyButton?y({inFlow:!1,animators:{opacity:{toFrom:0}},draw:{padding:-t/2,radius:t/2,outline:x(null!=(e=this.props.backgroundColor)?e:P.black.tertiary).withAlpha(.25)}}):void 0,f(this.text)?this.renderBodyText():void 0,this.props.children,this.showCopyButton?C({text:this.text,post:this.post,context:"markdownView",startLocation:this.selectedTextMenuLocation,close:this.clearShowCopyButton}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TagLink","isHashTag","getPostForeground","Element","internalLinkToPostId"],[e,n(809),{TagLink:n(818)}],(t,e,n,r,o,s)=>{let a;return a=i.defClass(class TagLinkPost extends t{},function(t,n,i){this.subscriptions("post"),this.prototype.render=function(){return e({post:this.post},this.props)}}),i.defClass(class DisplayTags extends t{},function(t,l,u){let c;this.subscriptions("viewState.viewState"),c=function(t,e){let i,r;return(i=n(t))!==(r=n(e))?i?1:-1:t.localeCompare(e)},this.prototype.render=function(){let t,n,l,u,h,p,d,f,m,g,y,v,S,b;return t=(v=this.props).chapterPost,n=v.searchInTopicId,l=v.tags,u=v.align,h=void 0!==(S=v.foregroundColor)?S:r(t),p=v.backgroundColor,d=v.kimis,f=v.fromPostId,b=this.viewState,m=b.buttonSize,g=b.gridSize,o(["parentWidthChildrenHeight","flow"],{childrenAlignment:u},(i.exists(l)&&l.length)>0?(y={},i.array(l.sort(c),t=>{let i,r,o,l,u,c,v;return i=t.postId?(r=t.backLink,o=t.text,l=t.icon,u=t.color,c=t.postId):c||(c=s(t))?c:(o=t,t),y[i]?void 0:(y[i]=!0,(v=c?a:e)({kimis:d,buttonSize:m,gridSize:g,fromPostId:f,searchInTopicId:n,foregroundColor:u?void 0:h,backgroundColor:null!=u?u:p,text:o,icon:l,postId:c,backLink:r}))})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","present","openLink","emailRegExp","encodeMailto","urlWithOptionalProtocolRegExp","lowerCase","findEmailRegExp","isString","Icons","ButtonWrapper2","Element","ShowMedia","TextElement","TextPalette","TextStyles","getPostTitle","getDisplayChapterTitle","getDisplayTitle"],[e,n(809),{ShowMedia:n(819)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S)=>{return i.defClass(class TagLink extends t{},function(t,b,w){this.subscriptions({topic:function({post:t}){return!e(i.exists(t)&&t.caption)&&i.exists(t)&&t.topicId},prevChapterByPostId:function({post:t}){return!e(i.exists(t)&&t.caption)&&!(i.exists(t)&&t.isChapterStart)&&i.exists(t)&&t.id}}),this.propFields({post:null}),this.getter({chapterPost:function(){return this.prevChapterByPostId||this.post}}),this.prototype.action=function(){let t,e,a,l,u,c,h,p,d,f;return t=(f=this.props).text,e=f.backLink,a=f.fromPostId,l=f.kimis,u=f.post,c=f.postId,h=f.searchInTopicId,(p=f.tagAction)?p(t,this.props):(d=null!=c?c:i.exists(u)&&u.id)?(e||this.models.postBackMap.add(d,a),this.models.navState.showPost(u||d)):/^mailto:/i.test(t)?n(t):r.test(t)?n(o({to:t})):s.test(t)?n(t):this.models.navState.searchIsVisible?this.models.navState.updateSearch({query:t,topicId:h}):this.models.navState.updateSearch({searchKimis:!!l,order:l?"trending":"date",query:t,topicId:h})},this.prototype.render=function(){let t,e,n,r,o,b,w,x,P,C,_,E,T,k,I,M,A,F;return({text:t,searchInTopicId:e,backLink:n,margin:r=2,postId:o,icon:b,buttonSize:w=45,gridSize:x=15,foregroundColor:P,backgroundColor:C}=this.props),!this.props.post&&(_=s.exec(t))?(E=t,[T,T,T,k,T,T,I]=_,I=I?(M="",i.array(I.split("/"),t=>(1!==M.length&&(M+="/"),M+=t),t=>M.length+t.length<=35),M):"",t=`${i.toString(a(k))}${i.toString(a(I))}`):(_=l.exec(t))&&([t]=_),u(b)&&(b=c[b]),null!=b||(b=n?c.angleLeft:void 0),h({hoverColor:P,backgroundColor:C,margin:r,radius:1e3,size:{h:A=.75*w,wcw:1,max:{ww:1}},url:E,action:this.props.action||this.action},p("row","childrenCenterLeft",{childrenMargins:x/2,size:{h:A,wcw:1,max:{ww:1}},padding:{h:(A-4)/2}},i.exists(F=this.post)&&F.mediaFile?d({mediaSize:"small",size:A,radius:100,post:this.post}):b&&f(b,"childrenSize",{fontSize:14,color:m.white.primary}),f(g.smallText,"childrenSizeMaxParentWidth",{maxLines:1,color:C?m.white.primary:m.black.secondary,text:t||(this.post?y(this.post)||this.chapterPost&&v(this.chapterPost)||this.topic&&S(this.topic)||"untitled post":void 0)})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["addElementFactories","FluxComponent","point","getResolutionForMediaSize","getMediaUrlForPost","altMediaSizesFor","max","bound","Math","getPostForeground","Element","RectangleElement","OutlineElement","getAutoMediaUrlForPost","timeout","merge","log"],[e,n(809)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v)=>{let S;return t("MediaBackground"),S=n(484).MediaBackground,i.defClass(class ShowMedia extends e{},function(t,e,n){let b,w,x;this.subscriptions("post",{prevChapterByPostId:function({post:t}){return t&&!t.mediaFile&&!t.colorMap&&t.id}}),this.stateFields({dragging:!1,draggingFocus:null,showReticle:!1,reticleFocus:null,reticleCount:0,mediaSizeOverride:null,autoUrl:null,animationsOn:!1}),this.getter({post:function(){return this.state.prevChapterByPostId||this.state.post},focus:function(){let t;return this.props.focus||i.exists(t=this.post)&&t.focus||r(.5)},aspectRatio:function(){return this.post?(this.post.bitmap?this.post.bitmap:r(this.post.dimensions)).aspectRatio:void 0},autoMediaSize:function(){return"auto"===this.props.mediaSize},mediaSize:function(){return this.mediaSizeOverride||this.props.mediaSize},sourceResolution:function(t,e){return o(t||this.mediaSize,e)},source:function(){let t;return({url:t}=this.props),this.props.previewOnly?null:t||(this.autoMediaSize?this.autoUrl:s(this.post,this.mediaSize))},altSources:function(){let t;return this.props.previewOnly?void 0:this.post&&(t=a(this.mediaSize))?i.array(t,t=>s(this.post,t)):void 0}}),b=function(t,e){return l(t.x/e.x,t.y/e.y)},this.focusBasedLocation=w=function(t,e,n){let o,s,a,l,c,h,p,d,f,m;return({w:o,h:s}=t),a=0,l=0,c=o,h=s,p=null!=(f=i.exists(e)&&e.x)?f:.5,d=null!=(m=i.exists(e)&&e.y)?m:.5,t.aspectRatio<n?a=u(o-(c=h*n),.5*o-p*c,0):l=u(s-(h=c/n),.5*s-d*h,0),r(a,l)},this.prototype.fillBasedBitmapSize=function(t){return x(t,this.aspectRatio)},this.fillBasedBitmapSize=x=function(t,e){let n,i;return({x:n,y:i}=t),t.aspectRatio<e?n=i*e:i=n/e,r(n,i)},this.prototype.pointerDown=function({target:t}){return!1!==this.props.dragOk&&t.capturePointerEvents(),this.dragging=!0,this._dragChangedFocus=!1},this.prototype.drag=function({target:t,delta:e}){let n,r,o,s,a,l;if(!1!==this.props.dragOk)return({currentSize:n}=t),({x:r=.5,y:o=.5}=this.focus||{}),s=c.abs(t.parent.currentSize.x-n.x)<c.abs(t.parent.currentSize.y-n.y),this.draggingFocus=a={x:s?r:u(0,r-e.x/n.x,1),y:s?u(0,o-e.y/n.y,1):o},this._dragChangedFocus=!0,i.isF((l=this.props).focusChanged)&&l.focusChanged(a,!0)},this.prototype.pointerUp=function({target:t,location:e}){let n,r;return this.reticleFocus=n=this._dragChangedFocus?this.draggingFocus:e.div(t.currentSize),i.isF((r=this.props).focusChanged)&&r.focusChanged(n,!1),this.showReticle=!0,this.reticleCount++,this.dragging=!1},this.prototype.renderEditFocusMode=function(){let t,e,n,r,o,s,a,l;return({focus:t,aspectRatio:e}=this),({borderColor:n,foregroundColor:r}=this.props),r||(r=h(this.post)),p(this.props,{clip:!0,cursor:"crosshair"},p({size:this.fillBasedBitmapSize,location:n=>w(n,t,e),animators:this.dragging?void 0:{location:{duration:.5}},on:{pointerDown:this.pointerDown,pointerMove:this.drag,pointerUp:this.pointerUp}},S({post:this.post,source:this.source,altSources:this.altSources}),this.showReticle?(this.onNextReady(()=>this.showReticle=!1),p({key:this.reticleCount,axis:.5,size:50,radius:100,scale:2,location:{xw:null!=(o=i.exists(s=this.reticleFocus)&&s.x)?o:.5,yh:null!=(a=i.exists(l=this.reticleFocus)&&l.y)?a:.5},animators:{scale:{duration:1,to:.5},opacity:{duration:1,to:0}},draw:["circle",{outline:{color:"white",lineWidth:6}},{outline:{color:r,lineWidth:2}}]})):void 0),n&&d({receivePointerEvents:"never",radius:this.props.radius},f({color:n})))},this.prototype.ready=function({target:t}){let e,n;return({currentSize:e}=t),({post:n}=this),this.autoMediaSize&&i.exists(n)&&n.mediaFile?this.autoUrl=m(e,n):void 0},this.prototype.preprocessState=function(t){let e;return e=!!this.post||(t.post&&!t.animationsOn&&g(10,()=>this.animationsOn=!0),!1),y(n.preprocessState.apply(this,arguments),{animationsOn:e})},this.prototype.render=function(){let t,e,n,i,r,o;return t=(r=this.props).click,e=r.shadow,n=r.layout,(i=r.focusEditMode)?this.renderEditFocusMode():(!this.post||this.post.id||this.post.bitmap||v.warn({ShowMedia:{invalid:{post:this.post}}}),S(this.props,{layout:n||"zoom",animators:this.animationsOn&&!this.dragging?null!=(o=this.props.animators)?o:{focus:{duration:.5}}:void 0,post:this.post,source:this.source,altSources:this.altSources,focus:this.focus,on:t||this.autoMediaSize?{pointerClick:t,ready:this.autoMediaSize&&this.ready}:void 0,shadow:!0!==e?e:{blur:2,offsetY:1,color:"#0005"}}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","PointerActionsMixin","getPostTitle","niceMonthYear","getTopicTitle","TextElement","TextStyles","TextPalette","Element","aspectRatioForPost","missing"],[e,n(809)],(t,e,r,o,s,a,l,u,c,h,p)=>{let d;return d=i.defClass(class MarkdownInlinePostText extends t{},function(t,e,n){this.subscriptions({topic:function({post:t}){return i.exists(t)&&t.topicId}},"viewState.gridSize"),this.propFields("post","inTopic"),this.prototype.render=function(){let t,e,n,c,h,p,d;return p=this,t=this.post,e=this.inTopic,n=this.topic,c=this.gridSize,h=null!=(d=r(t))?d:o(t.createdAt),(i.exists(e)&&e.id)!==t.topicId&&(h=`${i.toString(s(this.topic))} - ${i.toString(h)}`),a(l.smallText,"textCenterCenter",{padding:{top:c/2},text:h,color:u.black.secondary})}}),i.defClass(class MarkdownInlinePost extends(e(t)){},function(t,e,i){this.subscriptions("viewState.buttonSize","viewState.gridSize","post"),this.propFields("inPost","imageOnly","inTopic"),this.prototype.action=function(){return this.post?(this.inPost&&this.models.postBackMap.add(this.post.id,this.inPost.id),this.models.navState.showPost(this.post)):void 0},this.prototype.render=function(){let t,e,i,r;return r=this,t=this.imageOnly,e=this.gridSize,i=this.buttonSize,c("cacheDraw","column","parentWidthChildrenHeight","childrenTopCenter",t?void 0:{cursor:"pointer",on:this.pointerHandlers},{animators:"size",draw:this.post?void 0:u.black.barely},this.post?this.post.mediaFile?[c({size:{ww:1,hw:1/h(this.post)}},n(821)({post:this.post,mediaSize:"auto",drawBackground:!this.props.mediaFile,tutorialMode:t})),t?void 0:d({post:this.post,inTopic:this.inTopic})]:n(846).Partials.SimpleStreamCard({post:this.post}):this.postStatus===p?a(l.mediumText,{size:"parentSize",align:"centerCenter",text:"post not found"}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ShowMedia","CustomizeKimiButton","isMarkdown","paragraphBoundaryRegexp","getPostDarkBackground","isShortFormTextPost","hasMarkdownCodeBlocks","MarkdownView","TextElement","TextStyles","TextPalette","min"],[e,n(809),{MarkdownView:n(816),ShowMedia:n(819),CustomizeKimiButton:n(822)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f)=>{return i.defClass(class ShowMediaWithText extends t{},function(t,m,g){this.subscriptions("post","chapterPost","viewState.viewState"),this.prototype.showDetails=function(){return this.models.navState.showPost(this.post)},this.prototype.render=function(){let t,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M;return({gridSize:t}=this.viewState),({post:m,chapterPost:g}=this),null!=g||(g=i.exists(m)&&m.chapterPost),({contrast:y,click:v,largeMode:S,suggestedPadding:b,noCustomizeButton:w,shadow:x,thumbnailMode:P,customizeKimiButtonAlignment:C}=this.props),m&&({caption:_}=m),e(m?m.mediaFile||m.colorMap?e({draw:y?[{radius:this.props.radius},"clip","children",{outline:"#0003"}]:void 0},n({size:"parentSize"},this.props),P||!m.templateFile||w?void 0:(e({receivePointerEvents:"passToChildren"}),E=r({post:this.post,align:null!=C?C:"bottomRight"}),b?e({receivePointerEvents:"passToChildren",padding:b},E):E)):null!=_?((T=o(_))||(k=_.replace(s,"\n")),e({clip:!0,draw:this.props.drawBackground?a(g):void 0},e({padding:t*(()=>{switch(!1){case!S:return 4;case!P:return.5;default:return 2}})()},T?(I=(M=l(m))?u(_)?{cs:1}:{w:200,hch:1}:{w:200,hch:1,max:{h:200}},e("centerCenter",{size:I,scale:(t,e)=>t.minRatio(e)},c({post:m,lightText:!0,preview:!0,size:I,maxMarkdownBlocks:M?void 0:3}))):h(p.xxxLargeBoldText,"centerCenter","textCenterCenter",{size:{cs:1,max:{w:600}},text:k,paragraphLeading:2,color:d.white.primary,scale:(t,e)=>{let n;return n=t.minRatio(e),f(n,_.length<=10?2:1)}})))):void 0:{draw:d.white.tertiary})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ButtonWrapper","ImikimiPalette","Element","TextElement","TextStyles","TextPalette","config"],[e,n(809)],(t,e,r,o,s,a,l,u)=>{let c,h;return c=n(823),h=n(845),i.defClass(class CustomizeKimiButton extends t{},function(t,n,i){this.subscriptions("viewState.gridSize"),this.stateFields({infoText:null}),this.getter({post:function(){return this.props.post}}),this.prototype.customizeKimi=function(){return this.models.navState.customizeKimi(this.post)},this.prototype.renderInfo=function(){let t;return({gridSize:t}=this),e({size:"childrenSize",background:r.primary,action:this.customizeKimi,radius:1e3,shadow:h.kimiViewShadow},o({padding:3*t/4},"childrenSize",s(a.mediumText,"childrenSize",{text:"add your photo",color:l.white.primary})))},this.prototype.render=function(){let t,e,n,i;return({gridSize:t}=this),({align:e,bottom:n,center:i}=this.props),(n||null==e)&&(e="bottomRight"),u.zoStream?o({size:0}):o(["row","childrenSize"],this.props.center?"childrenCenterCenter":"childrenCenterRight",{childrenMargins:t/2,receivePointerEvents:"passToChildren",padding:t/2},e?{location:e,axis:e}:void 0,e.match(/left/i)?void 0:this.renderInfo(),c({action:this.customizeKimi,axis:"topLeft"}),e.match(/left/i)?this.renderInfo():void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","Element","StyleProps","ImikimiPalette","TextElement","Icons"],[e,n(307),n(824),n(596)],(t,e,n,r,o,s,a)=>{return i.defClass(class AddPhotoButton extends(t(e)){},function(t,e,i){this.prototype.action=function({target:t}){let e,n,i,r;return t.capturePointerEvents(),r=this.props,e=r.action,n=r.disabled,i=r.dropIn,e=r.action,n?void 0:(()=>{switch(!1){case!e:return e();case!i:return this.models.elementEditState.selectAndAddPhotoToDropIn(i)}})()},this.prototype.render=function(){let t,e,i,l,u,c,h;return n("pointerCursor",{on:this.buttonHandlers,size:55},(({axis:t,visible:e,location:i,scale:l,animators:u,pointerEventPriority:c}=this.props),{axis:t,visible:e,location:i,scale:l,animators:u,pointerEventPriority:c}),n("centerCenter",r.buttonActivationProps(this.pointerIsDown),{draw:{color:this.hover?o.veryLightPrimary:o.primary,radius:1e3,shadow:null!=(h=this.props.shadow)?h:r.kimiViewShadow},animators:"draw"},s(a.frame,"childrenSize","centerCenter",{fontSize:35,axis:{x:.5,y:.62},color:r.zoomWidgetColor,on:{pointerClick:this.resetZoom}})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(825)).addModules({ColorPickerStyleProps:n(844),StyleProps:n(845)})},function(t,e,n){t.exports=n(826).addNamespace("Styles",class Styles extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(827).addNamespace("KimiEditor",class KimiEditor extends Neptune.PackageNamespace{}._configureNamespace(n(828))),n(829),n(830),n(840),n(841),n(825),n(842)},function(t,e,n){t.exports=t.exports=n(18).vivifySubnamespace("Imikimi"),n(826)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","dependencies":{"art-build-configurator":"*"},"description":"ArtSuite Kimi Editor","license":"Copyright (C) 2019 Imikimi, LLC","name":"imikimi-kimi-editor","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress","test":"webpack-dev-server --progress","testInBrowser":"webpack-dev-server --progress"},"version":"2.33.13"}')},function(t,e,n){t.exports=n(826).addNamespace("Assets",class Assets extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(826).addNamespace("Components",class Components extends Neptune.PackageNamespace{}),n(831),n(834),n(835),n(836),n(838),n(839)},function(t,e,n){t.exports=n(830).addNamespace("Dialogs",class Dialogs extends Neptune.PackageNamespace{}),n(832),n(833)},function(t,e,n){t.exports=n(831).addNamespace("AdvancedColorPicker",class AdvancedColorPicker extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(831).addNamespace("ShapeDialogWidgets",class ShapeDialogWidgets extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(830).addNamespace("EditOverlays",class EditOverlays extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(830).addNamespace("Overlays",class Overlays extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(830).addNamespace("Partials",class Partials extends Neptune.PackageNamespace{}),n(837)},function(t,e,n){t.exports=n(836).addNamespace("KimiPresenterHelpers",class KimiPresenterHelpers extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(830).addNamespace("Toolbars",class Toolbars extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(830).addNamespace("Widgets",class Widgets extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(826).addNamespace("CustomElements",class CustomElements extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(826).addNamespace("Models",class Models extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(826).addNamespace("TextEffects",class TextEffects extends Neptune.PackageNamespace{}),n(843)},function(t,e,n){t.exports=n(842).addNamespace("Renderers",class Renderers extends Neptune.PackageNamespace{})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["HotStyleProps","w","GradientFillStyle","point","Math","rgbColor"],[e,n(307),n(484)],(t,e,n,r,o,s)=>{return i.defClass(class ColorPickerStyleProps extends t{},function(t,a,l){this.sortedColors=i.array(e("#000000 #696969 #808080 #a9a9a9 #c0c0c0 #d3d3d3 #dcdcdc #f5f5f5 #ffffff #fffafa #fffaf0 #fffff0 #f5fffa #f8f8ff #8b0000 #800000 #8b4513 #006400 #008000 #008b8b #008080 #2f4f4f #000080 #00008b #191970 #4b0082 #8b008b #800080 #a52a2a #b22222 #a0522d #b8860b #808000 #6b8e23 #228b22 #556b2f #2e8b57 #4682b4 #4169e1 #483d8b #9932cc #9400d3 #dc143c #d2691e #cd853f #daa520 #bdb76b #9acd32 #32cd32 #3cb371 #8fbc8f #20b2aa #1e90ff #0000cd #8a2be2 #c71585 #ff0000 #ff4500 #ff8c00 #ffa500 #ffd700 #ffff00 #7fff00 #00ff00 #00ff7f #00ffff #00bfff #0000ff #7f00ff #ff00ff #cd5c5c #ff6347 #ff7f50 #f4a460 #f0e68c #ffff7f #adff2f #7cfc00 #00fa9a #00ced1 #6495ed #6a5acd #ba55d3 #ff1493 #f08080 #fa8072 #ffa07a #d2b48c #f5deb3 #fafad2 #90ee90 #98fb98 #7fffd4 #66cdaa #48d1cc #7b68ee #da70d6 #ff69b4 #db7093 #bc8f8f #e9967a #deb887 #ffe4c4 #ffebcd #eee8aa #f5f5dc #f0ffff #afeeee #40e0d0 #9370db #dda0dd #ee82ee #ffb6c1 #ffc0cb #ffdab9 #ffdead #ffe4b5 #ffefd5 #fffacd #ffffe0 #e0ffff #b0e0e6 #87ceeb #87cefa #b0c4de #d8bfd8 #ffe4e1 #fff0f5 #fff5ee #faf0e6 #faebd7 #fdf5e6 #fff8dc #f0fff0 #f0f8ff #add8e6 #5f9ea0 #778899 #708090 #e6e6fa"),t=>s(t)),this.backgroundGradient=new n(null,null,{stripes:["#e","#f","#e","#f"]}),this.swatchesPerRow=14,this.swatchWidth=30,this.swatchMargin=2,this.swatchSize=r(this.swatchWidth-this.swatchMargin),this.swatchesPerColumn=o.ceil(this.sortedColors.length/this.swatchesPerRow),this.contentSize=r(this.swatchesPerRow,this.swatchesPerColumn).mul(this.swatchWidth).sub(1),this.swatchIndex=(t=>{let e,n;return n=(e=t.location.div(this.swatchSize).floor()).y*this.swatchesPerRow+e.x,e.x<0||e.x>=this.swatchesPerRow||e.y<0||n>=this.sortedColors.length?null:n}),this.swatchRowColumn=(t=>r(t%this.swatchesPerRow,t/this.swatchesPerRow|0))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["HotStyleProps","merge","TextStyles","TextPalette","rgbColor"],[e,n(307),n(596)],(t,e,n,r,o)=>{return i.defClass(class StyleProps extends t{},function(t,i,s){this.zoomWidgetColor="white",this.textColor="white",this.textShadow={color:"#0000006b",offset:{y:1}},this.kimiViewShadow={color:"#0000006b",blur:10,offset:{y:5}},this.getContrastingColor=function(t,e){return t=o(t),e&&(t=(e=o(e||"white")).blend(t)),t.perceptualLightness<.5&&t.a>.49?"#f":"#000a"},this.getColoredHandleOutlineProps=(t=>({color:this.getContrastingColor(t)})),this.basicText={fontFamily:"Arial, sans-serif",fontSize:16},this.fontIconText=e(this.basicText,{fontSize:13.5,color:this.textColor,shadow:this.textShadow}),this.editTextFont=e(this.basicText,{fontSize:18,color:"#1"}),this.iconLabelText=e(this.basicText,{fontSize:11,shadow:this.textShadow,color:"white"}),this.menuItemLabelText=e(n.mediumText,{color:r.black.secondary,size:{hch:1,w:4*n.mediumText.fontSize}}),this.buttonActivationProps=function(t){return{animators:{scale:{duration:.1}},scale:t?.9:1}}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(283))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette","compactFlatten","log","timeout","point","Element","TabButton"],[e,n(809)],(t,e,r,o,s,a,l,u)=>{return i.defClass(class SelectedTextPopover extends(n(594)(t)){},function(t,c,h){let p,d;this.subscriptions("viewState.viewState"),this.stateFields({copied:!1}),this.propField({startLocation:null,text:null,context:null,post:null,close:null,buttons:null}),this.prototype.copyText=function(){let t,e;return t=n(848)(this.text),this.createEvent(r([this.context,"copyText",t?"sucess":"failed"]).join(":"),{textLength:i.exists(e=this.text)&&e.length,fromPost:!!this.post}),o.warn(this.text),o.warn({copied:t}),this.triggerCopied(),s(500,()=>i.isF(this.close)&&this.close())},this.prototype.location=function(t,e){let n,i;return(n=this.startLocation).add(a(this.viewState.isTouchScreen?-this.viewState.buttonSize:this.viewState.gridSize,0)).bound(i=e.div(2),t.sub(i))},p={size:{wcw:1,h:45},innerPadding:{h:15},color:e.white.primary},d={size:45,color:e.white.primary,iconScale:2/3},this.prototype.render=function(){let t,n,r;return r=this,t=this.copied,n=this.buttons,l(["childrenSize","row"],this.startLocation?"centerLeft":"centerCenter",{animators:{opacity:{toFrom:0}},inFlow:!1,draw:[{radius:10},e.black.opaquePrimary]},this.startLocation?{location:this.location}:void 0,u(p,{text:t?"copied":"copy",action:this.copyText}),!t&&n&&i.array(n,t=>u(t.icon?d:p,t)),!t&&u(d,{iconScale:1/3,icon:"close",action:this.close}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";var i=n(849),r="Copy to clipboard: #{key}, Enter";t.exports=function copy(t,e){var n,o,s,a,l,u,c=!1;e||(e={}),n=e.debug||!1;try{if(s=i(),a=document.createRange(),l=document.getSelection(),(u=document.createElement("span")).textContent=t,u.style.all="unset",u.style.position="fixed",u.style.top=0,u.style.clip="rect(0, 0, 0, 0)",u.style.whiteSpace="pre",u.style.webkitUserSelect="text",u.style.MozUserSelect="text",u.style.msUserSelect="text",u.style.userSelect="text",u.addEventListener("copy",function(n){n.stopPropagation(),e.format&&(n.preventDefault(),n.clipboardData.clearData(),n.clipboardData.setData(e.format,t))}),document.body.appendChild(u),a.selectNodeContents(u),l.addRange(a),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");c=!0}catch(i){n&&console.error("unable to copy using execCommand: ",i),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",t),c=!0}catch(i){n&&console.error("unable to copy using clipboardData: ",i),n&&console.error("falling back to prompt"),o=function format(t){var e=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return t.replace(/#{\s*key\s*}/g,e)}("message"in e?e.message:r),window.prompt(o,t)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(a):l.removeAllRanges()),u&&document.body.removeChild(u),s()}return c}},function(t,e){t.exports=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,n=[],i=0;i<t.rangeCount;i++)n.push(t.getRangeAt(i));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null}return t.removeAllRanges(),function(){"Caret"===t.type&&t.removeAllRanges(),t.rangeCount||n.forEach(function(e){t.addRange(e)}),e&&e.focus()}}},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","MenuSectionLabel","TextPalette"],[e,n(809),{MenuSectionLabel:n(851)}],(t,e,n,r)=>{return i.defClass(class MenuSection extends t{},function(t,i,o){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,i,o,s,a,l;return({white:t,label:i,disabled:o,button:s,large:a,padding:l}=this.props),e(["parentWidthChildrenHeight","column"],{childrenMargins:this.gridSize,receivePointerEvents:o?"never":void 0,opacity:o?2/3:1,padding:null!=l?l:{top:this.props.label?0:this.gridSize/2,bottom:this.gridSize},animators:{opacity:!0,size:{toFrom:{ww:1,h:0}}},draw:[{padding:{h:-this.gridSize}},"clip"]},i?n({label:i,button:s,large:a}):void 0,e({draw:t?{color:"white",padding:{v:-this.gridSize/2},outline:r.black.barely}:void 0,padding:{h:this.gridSize}},["parentWidthChildrenHeight","column"],this.props.children))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","menuItemLayout","ImikimiPalette","TextElement","TextStyles","TextPalette","TabButton"],[e,n(809),n(852)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class MenuSectionLabel extends t{},function(t,i,u){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,u,c,h,p;return({gridSize:t,heightAdjustedButtonSize:i}=this.viewState),({large:u,button:c,text:h,label:p}=this.props),null!=h||(h=p),e(n(this.viewState),["parentWidthChildrenHeight","row"],{padding:{left:t/2},childrenAlignment:u?"bottomLeft":"centerLeft",draw:u?["clip",{padding:{h:-1,top:-2},outline:{color:"#0002"}}]:{padding:{h:-1},color:r.barelyDarken,outline:{color:"#0002"}}},o(u?s.largeBoldText:s.smallText,{padding:{top:.5*i,bottom:t/2},color:a.black.secondary,text:h},"parentWidthChildrenHeight"),c&&l({size:i},c))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>({menuItemLayout:function({gridSize:t,buttonSize:e}){return{size:{ww:1,h:e},padding:{h:-t/2},animators:{size:{toFrom:{ww:1,h:0}},clip:{toFrom:!0}}}}}))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","objectWithout"],[e,n(809)],(t,e,n)=>{return i.defClass(class MenuSectionGroup extends t{},function(t,i,r){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){return e(["parentWidthChildrenHeight","column"],{animators:{size:{toFrom:{h:0}}},draw:[{padding:{h:-this.gridSize}},"clip"]},n(this.props,"children"),this.props.children)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ImikimiPalette","Element","TextElement","TextStyles","TabButton","TextPalette","TrialMembershipExpired"],[e,n(809),{MemberCircle:n(855),MarkdownView:n(816),TrialMembershipExpired:n(856)}],(t,e,n,r,o,s,a,l)=>{return i.defClass(class MenuDivider extends t{},function(t,i,u){this.subscriptions("viewState.viewState currentSession.currentSession"),this.prototype.render=function(){let t,i,u,c,h,p,d,f,m,g,y,v;return({text:t,color:i,memberFeature:u,message:c,button:h,memberOnly:p,inMenuSection:d,pushPage:f}=this.props),({smallButtonSize:m,gridSize:g}=this.viewState),({grantMemberAccess:y,currentUser:v}=this.currentSession),p?(c=this.models.currentSession.getMembershipStatusMessage(),null!=i||(i=e.membershipGradient)):null!=i||(i=e.primary),n(["parentWidthChildrenHeight","column"],{padding:{h:d?-g/2:void 0},margin:d?g/2:void 0},n({size:{h:m}},["row","childrenCenterLeft"],{childrenMargins:g,draw:{radius:g/2,color:i,to:"topRight"}},r(o.mediumBoldText,"childrenSize",{padding:{left:g},color:"white",text:t}),c&&r(o.mediumText,"childrenSize",{color:"white",text:c}),n(),h&&s("topRight",{size:m,inFlow:!1,color:"white",hoverColor:a.white.secondary},h)),p&&!y?l({memberFeature:u,pushPage:f}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","Element","ImikimiPalette","TextElement","TextStyles","TextPalette"],[e,n(809)],(t,e,n,r,o,s,a)=>{return i.defClass(class MemberCircle extends(t(e)){},function(t,e,i){this.subscriptions("viewState.viewState"),this.prototype.action=function(){return this.models.navState.showSubscription()},this.prototype.render=function(){let t,e,i;return t=this.viewState.gridSize,e=this.props.size,i=1.5*t,n("pointerCursor",{size:null!=e?e:i,on:this.pointerHandlers},n({size:i,scale:(t,e)=>t.minRatio(e),animators:"draw",draw:["circle",{padding:1,outline:{lineWidth:this.pointerDown?8:this.hover?5:2,colors:r.goldGradient,from:"bottomRight",to:"topLeft"}},{colors:r.goldGradient,to:"bottomRight"}]},o(s.smallBoldText,"parentSize","textCenterCenter",{color:a.white.primary,text:"M"})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element"],[e,n(809)],(t,e)=>{return i.defClass(class TrialMembershipExpired extends t{},function(t,r,o){this.subscriptions("viewState.viewState","currentSession.currentUser"),this.prototype.signUp=function(){let t;return({pushPage:t}=this.props),this.models.navState.showOrPushSubscriptions({pushPage:t})},this.prototype.render=function(){let t,r,o,s;return t=this.viewState.gridSize,r=void 0!==(o=this.props.memberFeature)?o:"These features",e("parentWidthChildrenHeight","column","childrenCenterCenter",{padding:null!=(s=this.props.padding)?s:{h:t/2}},n(816)({style:"dialog",padding:{v:t},text:this.currentUser?`${i.toString(r)} require a membership.\nLearn more about these and other great benefits:`:`${i.toString(r)} require a membership.\n\n> All you need\nis an email address to start your FREE 1-month\ntrial membership.`}),n(857)({action:this.signUp}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ButtonWrapper2","ImikimiPalette","MemberCircle","TextElement","TextStyles","isSubscriberMember"],[e,n(809),{MarkdownView:n(816),MemberCircle:n(855)}],(t,e,n,r,o,s,a,l)=>{return i.defClass(class LargeBecomeAMemberButton extends t{},function(t,i,u){this.subscriptions("viewState.viewState","currentSession.currentUser"),this.prototype.action=function(){return(()=>{switch(!1){case!this.props.action:return this.props.action();default:return this.models.navState.showOrPushSubscriptions(this.props.overlay,!0)}})()},this.prototype.render=function(){let t,i,u,c,h,p;return t=(p=this.viewState).gridSize,i=p.buttonSize,u=p.nativeApp,c=p.feedWidth,h=3*t,e(["parentWidthChildrenHeight","column","childrenTopCenter"],{padding:{v:t/2}},n({action:this.action,radius:100,hoverColor:r.lightGolden,size:{h:h,w:c-2*t}},e(["row","childrenCenterCenter"],{childrenMargins:t/2,padding:{left:t/2,right:1.5*t},draw:{radius:100,outline:{color:r.darkGolden,lineWidth:4}}},o({size:h-t}),s(a.largeBoldText,"textCenterCenter",{text:(()=>{switch(!1){case!u:return"learn how to join";case!l():return"update membership";case!this.currentUser:return"become a member today";default:return"sign up to start your free trial"}})(),color:r.darkGolden,maxLines:2}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","MenuTextEdit","log","TextStyles","Element","menuItemLayout","ButtonWrapper","TextElement","TextPalette","Icons","max"],[e,n(809),n(852),{MenuTextEdit:n(859)}],(t,e,n,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class MenuEditableText extends t{},function(t,d,f){this.subscriptions("viewState.viewState"),this.propFields({text:null}),this.prototype.overlayAction=function(){let t,o,s,a;return({overlay:t,editTextProps:o,text:s,placeholder:a}=this.props),o&&i.exists(t)&&t.pushPage?(o=e({value:s,placeholder:a},o),t.pushPage({component:n,props:e(o,{close:()=>t.popPage()})})):r.warn({"invalid overlayAction":{editTextProps:o,overlay:t}})},this.prototype.render=function(){let t,e,n,i,r,d,f,m,g,y;return({gridSize:t,buttonSize:e,buttonSize:e}=this.viewState),({label:n,large:i,placeholder:r,text:d,action:f,locked:m,maxLines:g=5}=this.props),y=i?o.largeBoldText:o.mediumText,s(a(this.viewState),{size:{ww:1,h:(t,n)=>p(e,n.y)}},l({disabled:m,action:f||this.overlayAction},"parentWidthChildrenHeight",s({size:{ww:1,h:(t,n)=>p(e,n.y)},padding:{top:t}},"childrenCenterLeft","row",n?u(o.tinyText,{inFlow:!1,size:"childrenSize",text:n,color:c.black.secondary,location:{x:t/2,y:-t/4}}):void 0,u(y,{color:d?c.black.primary:c.black.secondary,text:d||r||"-",maxLines:g,padding:{v:(e-.8*y.fontSize)/2,h:t/2}},"parentWidthChildrenHeight"),!m&&u(h.icomoon.pencil,{color:c.black.tertiary,align:.5,size:e}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ImikimiPalette","TextInputElement","TextStyles","TextElement","pluralize","TextPalette","SubmitField"],[e,n(809)],(t,r,o,s,a,l,u,c,h)=>{return i.defClass(class MenuTextEdit extends t{},function(t,p,d){this.subscriptions("viewState.viewState"),this.stateFields({value:null}),this.prototype.preprocessProps=function(t){return this.setState({value:t.value}),t},this.prototype.submit=function(){let t,e;return i.isF((t=this.props).submit)&&t.submit(this.value),i.isF((e=this.props).close)&&e.close()},this.getOverlayPageProps=function(t){return{okay:t=>(e.submitMenuTextEdit=t,t.submit()),title:t.title}},this.prototype.render=function(){let t,e,p,d,f,m,g,y,v,S,b,w,x,P,C,_;return({title:t,info:e,spellcheck:p,value:d,placeholder:f,cancel:m,close:g,textArea:y,maxLength:v}=this.props),({gridSize:S,viewHeight:b,isTouchScreen:w,nativeApp:x}=this.viewState),P=w&&!x,n(850)(null,null!=e?n(860)({text:e}):void 0,r({key:"edit",padding:{v:S/2},on:{focus:y&&this.clearDisplayOnly},size:y?P?{ww:1,hch:1}:{ww:1,hh:1}:{ww:1,hch:1}},y?(C=i.exists(_=this.value)&&_.length||0,[P?r({draw:{radius:S/2,fill:o.lightGrey,padding:-S/2},size:{ww:1,h:1*b/4}}):void 0,s(a.mediumText,{spellcheck:p,size:y?P?{ww:1,h:1*b/4}:{ww:1,hh:1}:{ww:1,hch:1},placeholder:f,key:"menuTextEditInput",type:"textarea",value:this.props.value,maxLength:v,on:{valueChanged:({props:t})=>this.value=t.value,domElementAttached:({target:t})=>(t.focus(),t.selectAll())}}),null!=v&&C/v>.5&&l(a.tinyText,{inFlow:!1,size:"childrenSize",text:u(v-C,"char")+" left",location:"bottomRight",axis:1,color:c.black.secondary})]):h({value:d,placeholder:f,submit:this.submit,whiteBackground:!0,noButtons:!0,maxLength:v,large:!0,valueChanged:({value:t})=>this.value=t})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","TextPalette"],[e,n(809),n(852)],(t,e,n,r,o)=>{return i.defClass(class MenuInfo extends t{},function(t,i,s){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,i,s,a,l;return t=this.gridSize,i=(l=this.props).large,s=l.text,a=l.color,e("parentWidthChildrenHeight",{margin:t/2},n(i?r.mediumText:r.smallText,"textCenterLeft","parentWidthChildrenHeight",{padding:{v:t/2},paragraphLeading:2,color:a||o.black.secondary,text:s}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextStyles","TextElement","TextPalette"],[e,n(809)],(t,e,n,r,o)=>{return i.defClass(class MenuField extends t{},function(t,i,s){this.subscriptions("viewState.viewState"),this.propFields({text:null}),this.prototype.render=function(){let t,i,s,a;return({gridSize:t,buttonSize:i}=this.viewState),({label:s,value:a}=this.props),e(["centerLeft","row","childrenBottomLeft"],{padding:t/2,size:{ww:1,h:1.5*n.mediumBoldText.fontSize},childrenMargins:t/2},r({text:n.smallText,text:s,color:o.black.secondary},'parentWidthChildrenHeight"',"textBottomLeft"),r(n.mediumBoldText,"childrenSize",{text:a,color:o.black.primary}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","menuItemLayout","TextElement","TextStyles","TextPalette"],[e,n(809),n(852)],(t,e,n,r,o,s)=>{return i.defClass(class MenuHeading extends t{},function(t,i,a){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,a;return({gridSize:t,buttonSize:i}=this.viewState),({text:a}=this.props),e(n(this.viewState),"parentWidthChildrenHeight",{margin:{top:1.5*t,bottom:t}},r(o.mediumBoldText,["centerLeft","parentWidthChildrenHeight"],{padding:{h:t/2,top:t/2},color:s.black.secondary,paragraphLeading:2},this.props))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","Spinner"],[e,n(809)],(t,e,n)=>{return i.defClass(class MenuLoadingSpinner extends t{},function(t,i,r){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){return e({size:{h:5*this.gridSize}},n())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ReschedulableTimer","FluxComponent","isString","clientFailure","networkFailure","timeout","Element","present"],[e,n(809)],(t,e,r,o,s,a,l,u)=>{let c;return c=new t,i.defClass(class MenuStatusMessage extends e{},function(t,e,h){this.subscriptions("viewState.gridSize"),this.stateFields({message:null,messageCount:0,isErrorMessage:!1,action:null}),this.prototype.showErrorMessage=function(t,e,n){let l,u;return this.isErrorMessage=!0,this.messageCount++,this.action=e?()=>(this.clearMessage(),e()):void 0,l=r(t)?t:(({message:l,status:u}=t),(()=>{switch(u){case o:return this.action=null,l;case s:return e?"We're sorry. We were unable to reach our servers.\n\nTap here to try again.":"We're sorry. We were unable to reach our servers. Try again?";default:return this.action=(()=>{let e;return this.models.feedback.sendFeedback(`--------------------------\n${i.toString(null!=(e=this.props.context)?e:"MenuStatusMessage")}\ncontext: ${i.toString(n)}\nstatus: ${i.toString(u)}\nerror: ${i.toString(t.message)}`)}),"Oops. Something went wrong. We'll do our best to fix it as soon as possible. If this error persists, we'd greatly appreciate if you'd let us know about the problem.\n\nClick here to email feedback@imikimi.com"}})()),n&&(l=`${i.toString(n)}\n\n${i.toString(l)}`),this.message=l,a(300,()=>{let t,e;return i.exists(t=this.refs.errorMessageSection)&&i.exists(e=t.element)&&e.scrollOnscreen()}),c.timeout(1e4,this.clearMessage)},this.prototype.render=function(){return l("parentWidthChildrenHeight","column",{key:"errorMessageSection",padding:{bottom:this.gridSize}},u(this.message)?n(850)({padding:0,key:`errorMessageSectionWrapper${i.toString(this.messageCount)}`},n(865)({action:this.action,message:this.message,isErrorMessage:this.isErrorMessage,clearMessage:this.clearMessage})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextPalette","TextElement","TextStyles","TabButton"],[e,n(809)],(t,e,n,r,o,s)=>{return i.defClass(class StatusMessage extends t{},function(t,i,a){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,a,l,u,c,h;return t=this.viewState.gridSize,i=(h=this.props).isErrorMessage,a=h.action,l=h.message,u=h.clearMessage,e({key:"errorMessageWrapper",size:"parentWidthChildrenHeight",cursor:a?"pointer":void 0,on:{pointerClick:a},padding:{v:t/2,top:t/2},draw:[{radius:t,padding:{h:-t/2+2,top:t/2+2},outline:n.black.barely,color:c=i?"#ff7":"white"},"clip"],animators:{size:{toFrom:{h:0}},opacity:{toFrom:0}}},e({size:"parentWidthChildrenHeight",childrenLayout:"row",childrenAlignment:"topLeft",childrenMargins:t/2},e({size:2*t,draw:{radius:t,color:n.black.tertiary}},r(o.largeBoldText,{size:"parentSize",align:.5,text:i?"!":"?",color:c})),r(o.smallText,{padding:{v:2*t/3},size:"parentWidthChildrenHeight",text:l,paragraphLeading:1.75,color:n.black.secondary}),!i&&s({size:2*t,radius:100,backgroundPadding:0,iconScale:.5,icon:"close",action:u})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextStyles","merge","Element","menuItemLayout","TextPalette","TextElement","TextInputElement","present"],[e,n(809),n(852)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class MenuTextInput extends t{},function(t,c,h){this.subscriptions("viewState.viewState"),this.stateFields({edit:!1,autoFocus:!1}),this.prototype.getInitialState=function(){let t;return({edit:t}=this.props),{edit:t}},this.prototype.startEdit=function(){return this.edit=!0,this.autoFocus=!0},this.prototype.render=function(){let t,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T;return({gridSize:t,buttonSize:c}=this.viewState),h=(T=this.props).large,p=T.displayValue,d=T.fontSize,f=T.value,m=T.lean,g=T.text,y=T.size,v=T.color,S=T.placeholder,b=T.valueChanged,w=T.submit,x=T.textarea,P=!0,C=t/2,_=e.mediumText,d&&(_=n(_,{fontSize:d})),r(o(this.viewState),["parentWidthChildrenHeight","column"],{childrenMargins:t/4,draw:m?void 0:{padding:{h:-t/2},radius:t/4,fill:"white",outline:s.black.barely},padding:m?{bottom:C}:{v:C,h:C/2}},g&&a(e.tinyText,"parentWidthChildrenHeight",{color:s.black.secondary,text:g}),this.edit?l(_,{type:x&&"textarea",animators:"size",size:null!=y?y:x?{ww:1,hch:1,max:{hw:3/8}}:"parentWidthChildrenHeight",placeholder:S,value:f,on:{ready:({target:t})=>this.autoFocus?(this.autoFocus=!1,t.selectAll(),t.focus()):void 0,blur:this.clearEdit,valueChanged:b&&(t=>i.isF(b)&&b(t.target.value)),enter:w&&(t=>i.isF(w)&&w(t.target.value))}}):a(_,"parentWidthChildrenHeight",{padding:{v:1*_.fontSize/3},on:{pointerClick:this.startEdit}},u(E=null!=p?p:f)?E:{color:s.black.secondary,text:S}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Promise","merge","Element","menuItemLayout","TextElement","Icons","rgbColor","TextPalette","TextStyles","Toggle"],[e,n(809),n(852),{Toggle:n(868)}],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class MenuToggle extends t{},function(t,p,d){this.subscriptions("viewState.viewState"),this.stateField({toggling:!1,toggledTo:null}),this.prototype.toggle=function(){let t,n;return this.toggling=!0,t=this.props.isOn,this.toggledTo=!t,e.resolve(i.isF((n=this.props).action)&&n.action()).then(()=>this.toggling=!1)},this.prototype.preprocessState=function(t){return null!=t.isOn&&null!=this.state.isOn&&t.isOn!==this.state.isOn?n(d.preprocessState.apply(this,arguments),{toggledTo:null}):d.preprocessState.apply(this,arguments)},this.prototype.render=function(){let t,e,n,i,p,d,f,m,g,y,v,S;return({gridSize:t,fullScreen:e,buttonSize:n,buttonSize:n}=this.viewState),({text:i,isOn:p,icon:d,offIcon:f,tight:m,action:g,iconColor:y,heartOverlay:v}=this.props),p=null!=(S=this.toggledTo)?S:p,r(["row","childrenCenterLeft"],{childrenMargins:m?0:t/2,opacity:g?1:.5},m?{size:{wcw:1,h:n}}:o(this.viewState),d&&r("parentHeightSquare",s(a.icomoon[d],"parentHeightSquare",{align:.5,animators:"color",color:l(y||u.black.softPrimary)}),v?s(a.heart,{animators:{opacity:{toFrom:0},axis:{d:1,f:"easeInElastic",from:{x:.5,y:1},to:{x:.5,y:0}}},scale:.6},"centerCenter",{color:"white"}):void 0),i&&s(c.mediumText,{color:u.black.softPrimary,size:m?{cs:1}:{ww:1,hch:1},text:i}),m?i&&r({size:{w:t/2}}):void 0,h({action:g,isOn:p,offIcon:f}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Promise","merge","Element","ImikimiPalette","TextElement","TextPalette","Spinner"],[e,n(809)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class Toggle extends t{},function(t,u,c){this.subscriptions("viewState.viewState"),this.stateField({toggling:!1,toggledTo:null}),this.prototype.toggle=function(){let t,n;return this.toggling=!0,t=this.props.isOn,this.toggledTo=!t,e.resolve(i.isF((n=this.props).action)&&n.action()).then(this.clearToggling)},this.prototype.preprocessState=function(t){return null!=t.isOn&&null!=this.state.isOn&&t.isOn!==this.state.isOn?n(c.preprocessState.apply(this,arguments),{toggledTo:null}):c.preprocessState.apply(this,arguments)},this.prototype.render=function(){let t,e,n,i,u,c,h,p;return({fullScreen:t}=this.viewState),e=this.toggling,n=(h=this.props).isOn,i=h.offIcon,u=h.action,n=null!=(p=this.toggledTo)?p:n,r("pointerCursor",{on:{pointerClick:u&&!e&&this.toggle},size:t?{h:30,w:60}:{h:35,w:65},draw:{rectangle:{radius:1e3},color:c=n?o.primary:o.mediumLightGrey},animators:"draw"},i&&s(i,["parentHeightSquare","topRight"],{axis:{x:1},align:.5,color:a.black.tertiary}),r({padding:2},r("parentHeightSquare",{animators:{location:!0,axis:!0}},n?{location:"topRight",axis:{x:1}}:void 0,{draw:["circle",{color:"white",clip:!0}]},e&&l({color:c,monocrome:!0}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(283))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","models","Element","ButtonWrapper2","TextElement","TextStyles","getPostTitle","getTopicTitle","TextPalette","Icons","AnimatedIcon","ImikimiPalette"],[e,n(809)],(t,e,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class MenuTopic extends t{},function(t,f,m){this.subscriptions("viewState.gridSize","topic",{post:function({postId:t,topic:e}){return i.exists(e)&&e.lastPost?void 0:null!=t?t:i.exists(e)&&e.lastPostId},topicFollower:function({topic:t,currentUserId:e}){return t&&e?{topicId:t.id,userId:e}:void 0},followingTopic:function({topic:t}){return i.exists(t)&&t.id}}),this.getter({post:function(){let t,e;return null!=(t=i.exists(e=this.topic)&&e.lastPost)?t:this.state.post}}),this.prototype.action=function(){let t,n;return this.props.action||this.props.selectTopic?(i.isF((t=this.props).action)&&t.action(this.topic),i.isF((n=this.props).selectTopic)&&n.selectTopic(this.topic)):e.navState.showTopic(this.topic)},this.prototype.render=function(){let t,e,f,m,g,y,v;return y=this,t=this.gridSize,e=this.post,f=this.topic,m=this.props.rightText,r({size:{h:(g=2*t)+t},draw:[{padding:{h:-t/2}},"clip"],animators:{size:{toFrom:{h:0}}}},o({size:{h:g+t}},this.props,{radius:100,action:this.action,padding:{h:-t/2},borderPadding:t/4},r("row","childrenCenterLeft",{padding:{h:t/2},childrenMargins:t},r({size:g},n(819)({size:g+t/2,post:e,mediaSize:"small"},"centerCenter")),s(a.mediumText,{text:this.props.usePostTitle&&e?l(e):u(f),color:c.black.softPrimary},"textCenterLeft"),m&&s(a.smallText,"childrenSize",{color:c.black.softPrimary,text:m}),i.exists(v=this.topicFollower)&&v.subscribed?r({key:"subscribed",size:2*t,animators:{size:{toFrom:{w:0,h:2*t}}},margin:0},"clip",s(h.mail,["centerCenter","childrenSize"],{location:t,color:c.black.softPrimary})):void 0,null!=this.followingTopic?p({size:2.25*t,icon:this.followingTopic?"heart":"brokenHeart",color:this.followingTopic?d.red:c.black.softPrimary}):void 0)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ButtonWrapper2","TextElement","TextStyles","getDisplayName","TextPalette"],[e,n(809)],(t,e,r,o,s,a,l)=>{return i.defClass(class MenuUser extends t{},function(t,u,c){this.subscriptions("viewState.gridSize","user"),this.prototype.action=function(){let t,e;return i.isF((t=this.props).action)&&t.action(this.user),i.isF((e=this.props).selectUser)&&e.selectUser(this.user)},this.prototype.render=function(){let t,i,u,c,h;return h=this,t=this.gridSize,i=this.user,u=this.props.rightText,e({size:{h:(c=2*t)+t},draw:[{padding:{h:-t/2}},"clip"],animators:{size:{toFrom:{h:0}}}},r({size:{h:c+t}},this.props,{radius:100,action:this.action,padding:{h:-t/2},borderPadding:t/4},e("row","childrenCenterLeft",{padding:{h:t/2},childrenMargins:t},n(872)({size:c,user:i}),o(s.mediumText,{text:a(i),color:l.black.softPrimary},"textCenterLeft"),u&&o(s.smallText,"childrenSize",{padding:{right:t},text:u,color:l.black.softPrimary}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","getInitials","Promise","pipelines","isFullMember","ImikimiPalette","rgbColor","ButtonWrapper2","ShowMedia","TextElement","TextStyles","TextPalette","Icons","min","max"],[e,n(809),{ShowMedia:n(819)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{let y;return y=i.defClass(class UserCircle extends(t(e)){},function(t,e,y){let v,S;v=function(t){let e,n,r,o,s;return({postId:e,profileTopic:n,user:r}=t),null!=(o=null!=e?e:i.exists(n)&&n.lastPostId)?o:i.exists(r)&&i.exists(s=r.profileTopic)&&s.lastPostId},S=function(t){let e,n,r,o,s;return({post:e,profileTopic:n,user:r}=t),null!=(o=null!=e?e:i.exists(n)&&n.lastPost)?o:i.exists(r)&&i.exists(s=r.profileTopic)&&s.lastPost},this.subscriptions({post:function(t){return S(t)?void 0:v(t)}},"user"),this.getter({post:function(){let t;return null!=(t=this.state.post)?t:S(this.props)},initials:function(){let t;return null!=(t=this.props.initials)?t:n(this.user)}}),this.setter({post:function(t){return this.setState("post",t)}}),this.prototype.preprocessState=function(t){let e,n,s;return null==t.post&&!this.props.post&&!this.props.user&&(e=t.user,i.exists(e)?(n=e.profileTopic,s=e.profileTopicId):void 0)&&r.then(()=>null!=n?n:o.topic.get(s)).then(({lastPost:t,lastPostId:e})=>null!=t?t:o.post.get(e)).then(t=>this.post=t||!1).catch(()=>this.post=!1),y.preprocessState.apply(this,arguments)},this.prototype.action=function(){return this.props.action?this.props.action():this.props.showProfileTopic&&this.post?this.models.navState.showPost(this.post):this.user?this.models.navState.showUser(this.user):void 0},this.prototype.render=function(){let t,e,n,r,o,y,v,S,b,w,x,P,C,_,E,T;return({mediaSize:t,forceGoldCircle:e,memberLineWidth:n=5,shadow:r,noClicks:o,withContrast:y,withDarkContrast:v,noExpand:S}=this.props),({user:b}=this),w=2,x=i.exists(_=this.post)&&_.mediaFile,C=(P=e||s(b))?{color:a.goldGradient,lineWidth:n*(this.hover?2:1),to:"bottomRight",shadow:r}:{color:v?(y=!0,w=.5,l(x?"#fff9":"#0009")):l("#fff"),lineWidth:(()=>{switch(!1){case!this.hover:return 2*n;case!y:return w;default:return 0}})(),shadow:r},u(this.props,{action:this.action,hoverExpand:!o&&!S},{draw:["circle",{padding:this.props.padding},this.props.clipOutline?void 0:{outline:C},"clip",(()=>{switch(!1){case!!this.post:return{color:a.mediumGrey,shadow:r};case!!this.post.mediaFile:return{color:a.noProfilePhotoDefaultBackground,shadow:r}}})(),"children",this.props.clipOutline?{outline:C}:void 0]},i.exists(E=this.post)&&E.mediaFile?c({post:this.post,mediaSize:t||"small"}):void 0,i.exists(T=this.post)&&T.mediaFile?void 0:this.initials?h(p.mediumBoldText,["childrenSize","centerCenter"],/^[a-z0-9]+$/.test(this.initials)?void 0:{layoutMode:"tight"},{color:d.white.primary,scale:(t,e)=>{let n,i;return n=t.x/e.x,i=t.y/e.y,m(.5*g(i,n),.75*m(i,n))},text:this.initials}):h(f.user,["childrenSize","centerCenter"],{scale:2,color:d.white.primary}))}}),i.defClass(class UserCircleWrapper extends e{},function(t,e,n){this.subscriptions({profileTopic:{model:"topic",key:function({post:t,user:e}){return!t&&i.exists(e)&&e.profileTopicId}}}),this.prototype.render=function(){return y(this.props,this.state)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["EventLogMixin","FluxComponent","isPlainObject","isString","isFunction","Component","log","merge","present","objectWithout","Error","arrayWith","MenuSection","MarkdownView","fastBind","PopOver","Element","LoadingOverlay","TabButton"],[e,n(809),n(811),{PopOver:n(874),MarkdownView:n(816)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S)=>{return i.defClass(class AbstractOverlayComponent extends(t(e)){},function(t,e,b){this.abstractClass(),this.subscriptions("viewState.viewState"),this.stateFields({pageStack:null,loading:!1}),this.prototype.pushPage=function(t,e,d=this.pageStack){let f,m,g,y,v,S,b,w;if(({render:f,rendererName:m,rendered:g,component:y,name:v}=S=n(t)?t:r(t)?{rendererName:t,props:e}:o(t)?{render:t,props:e}:t instanceof s?{rendered:t,props:e}:a.error({messsage:{"pushPage invalid inputs":[t,e]}})),S=l(S,{name:null!=v?v:v=null!=(b=null!=m?m:i.exists(f)&&f.name)?b:i.exists(y)&&i.exists(w=y.class)&&w.getName()}),u(v)&&this.createEvent(v,c(S,"render","rendered")),null==g&&null==y&&null==f&&null==m)throw new h("pushPage invalid inputs: One of the following required: rendered, component, render, or rendererName");return this.pageStack=p(d,S)},this.prototype.popPage=function(t=1){let e;return this.setPageStack(e=this.pageStack.slice(0,this.pageStack.length-t))},this.prototype.resetAndPushPage=function(t){return this.pushPage(t,null,[])},this.prototype.renderMessage=function({message:t,label:e}){return d({label:e},f({style:"dialog",padding:{v:this.viewState.gridSize},text:t}))},this.getter({popBackToHereAction:function(){let t;return({pageStack:t}=this),()=>this.setState({pageStack:t})},subPageActionProps:function(){let t;return null!=(t=this._subPageActionProps)?t:this._subPageActionProps={popPage:m(this.popPage,this),resetAndPushPage:m(this.resetAndPushPage,this),pushPage:m(this.pushPage,this),pageStackManager:this}}}),this.prototype.render=function(t,e){let n,r,o,s,a,u,h,p,d;return({gridSize:n}=this.viewState),({pageStack:r}=this),o=null,s=null,(i.exists(r)&&r.length)>0&&(t=c(t,"fixedTopChildren","fixedBottomChildren","noScrollChildren")),g(t,{scrollAreaKey:`stackNum${i.toString(null!=(d=i.exists(r)&&r.length)?d:0)}`},y("parentWidthChildrenHeight","column",{key:"mainContents"},(i.exists(r)&&r.length)>0?i.array(r,(t,e)=>{let n,a,u,c,h,p,d,f,m;return({name:n,render:a,rendererName:u,rendered:c,component:h,showDoneButton:p,props:d}=t),a=null!=(m=null!=h?h:a)?m:this[u],o=(f=i.exists(a)&&i.isF(a.getOverlayPageProps)&&a.getOverlayPageProps(d))?l(t,f):t,y("column",{clip:!0,size:e===r.length-1?"parentWidthChildrenHeight":{ww:1,h:0}},null!=c?c:a(l(d,this.subPageActionProps,{key:s=`pageStack${i.toString(e)}`})))}):e,this.loading?v():void 0),o?(a=o.back,u=o.okay,h=o.track,p=o.title,{fixedButtonButtons:[S({key:`back button ${i.toString(i.exists(r)&&r.length)}`,iconScale:.75,radius:100,icon:"back",text:"back",align:u?void 0:"centerLeft",action:()=>(this.popPage(),i.isF(a)&&a(this.refs.lastPageKey))}),u?S({iconScale:.75,radius:100,icon:"checkmark",text:"okay",action:()=>(this.clearPageStack(),i.isF(u)&&u(this.refs[s]))}):void 0],track:h,title:null!=p?p:i.exists(t)&&t.title}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","ImikimiPalette","Element","max","rect","ImikimiStyles","PopOverTitleBar","ScrollerWithBar","TextPalette","LoadingOverlay"],[e,n(809),{ShowMedia:n(819),PopOverTitleBar:n(875)}],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class PopOver extends t{},function(t,p,d){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q,H,V,$,G,Y,K,X,J,Q;return t=(K=this.viewState).fullScreen,p=K.tabBar,d=K.isPhone,f=K.gridSize,m=K.popOverWidth,g=K.heightAdjustedButtonSize,y=K.feedWidth,v=K.viewWidth,S=K.fullScreenPost,b=K.safePadding,w=K.isTablet,x=K.landscape,P=K.reducedHeightMode,C=K.mainAreaWidth,_=K.desktopButtonSize,E=(X=this.props).titlebarColor,T=X.visible,k=X.title,I=X.titlePost,M=X.fullHeight,A=X.icon,F=X.track,T=!1!==T,B="top"!==p,R="bottom"===p,t||(B=!0,R=!x),"top"===p&&b.top>0&&(b=e(b,{top:0})),(z=!t||B||d)?(O="bottomCenter",L={x:.5,y:.875},D={xw:.5,yh:1},N={xw:.5,yh:1,y:25}):(O="topRight",L={x:1,y:.125},D={xw:1},N={xw:1,y:-10}),U=null!=E?E:i.exists(I)&&i.exists(J=I.colors)&&J.background||n.primary,W=f/2,j=f,q=m>=this.viewState.viewWidth,z?(H=(V=M)?0:q?0:{top:$=W},q&&(G=!0)):H={bottomLeft:W},r({inFlow:!1,receivePointerEvents:"passToChildren",size:Y=V?q?"parentSize":{hh:1,w:m}:q?{ww:1,hch:1,max:{hh:1}}:{w:m,hch:1,max:{hh:1}},padding:{top:o(b.top,0)},axis:T?O:L,location:T?D:N,animators:{location:{duration:.125,toFrom:N},axis:{duration:.125,toFrom:L},opacity:{duration:.125,toFrom:0}},draw:V&&b.top>0?{rectangle:s(this.viewState.viewWidth,b.top),fill:U}:void 0},r("column",{size:{ww:1,hch:1,max:{hh:1}},draw:[H?{rectangle:{radius:H}}:void 0,{fill:{color:a.popOverColor,shadow:G?void 0:a.lightShadow}},"clip","children",{child:"fixedTopChildren"},{child:"topBar"}],padding:x&&b.bottom>0&&this.props.fixedBottomChildren?{bottom:b.bottom}:void 0},l({title:k,radius:$,backgroundColor:U,titlePost:I,icon:A,clickTitle:this.props.clickTitle,action:this.props.close||this.models.navState.hideOverlay}),this.props.fixedTopChildren&&r({size:"parentWidthChildrenHeight",key:"fixedTopChildren",childrenLayout:"row"},this.props.fixedTopChildren),null!=(Q=this.props.noScrollChildren)?Q:u({key:this.props.scrollAreaKey,size:Y,clip:!0,track:this.props.track,childArea:"totalArea",track:F},"bottom"===F?"childrenBottomLeft":void 0,t?this.props.children:r("parentWidthChildrenHeight",this.props.children),!R&&b.bottom>0&&!this.props.fixedBottomChildren?r({size:b.bottom}):void 0),this.props.fixedBottomChildren,!this.props.fixedButtonButtons||x&&this.viewState.keyboardVisible?void 0:r({childrenLayout:"row",noFocus:!0,size:{h:_+("bottom"!==p?b.bottom:0),ww:1},padding:{bottom:"bottom"!==p?b.bottom:void 0},drawOrder:[{color:"#f7"},{padding:{h:-10,bottom:-10},clip:!0,outline:{color:c.black.tertiary}}]},this.props.fixedButtonButtons),this.props.loading?h():void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ImikimiPalette","TextPalette","Element","isNumber","ImikimiStyles","TextElement","Icons","UserCircle","TextStyles","TabButton"],[e,n(809),{UserCircle:n(872),ShowMedia:n(819)}],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class PopOverTitleBar extends t{},function(t,i,p){this.subscriptions("viewState.viewState","user"),this.prototype.render=function(){let t,i,p,d,f,m,g,y,v,S,b;return({buttonSize:t,gridSize:i}=this.viewState),({title:p,shadow:d,radius:f,backgroundColor:m=e.primary,titlePost:g,clickTitle:y,action:v,icon:S}=this.props),b=m.perceptualLightness>.85?n.black.secondary:n.white.primary,t=this.viewState.buttonSize,r("row",this.props.clickTitle?"pointerCursor":void 0,{key:"topBar",size:{ww:1,h:t},draw:d?[{rectangle:{radius:f&&(o(f)?{top:f}:f)},fill:{color:m,shadow:s.tinyShadow,to:"topRight"}},"resetDrawArea","clip"]:[{rectangle:{radius:f&&(o(f)?{top:f}:f)}},"clip",{fill:{color:m,to:"topRight"},padding:{h:-1,top:-10},outline:"#0002"}]},r({on:{pointerClick:y}},"row",S&&a(l[S],{color:b},"textCenterCenter","parentHeightSquare"),null!=this.user&&u({padding:i/4,size:[t,this.user]}),a(c.mediumBoldText,"parentSize","textCenterLeft",{padding:!(this.user||S)&&{h:i},maxLines:1,color:b,text:p||"Title"})),v&&h({hoverColor:"#fff7",icon:"close",color:b,lightColor:!0,iconScale:.5,radius:f?{bottom:i/2,topLeft:i/2,topRight:f-2}:void 0,size:t,action:v}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Component","rect","rgbColor","defaultPostPalette","Element","merge","ImikimiStyles"],[e,n(809)],(t,e,n,r,o,s,a)=>{return i.defClass(class ColorFadeOverlay extends t{},function(t,i,l){let u;u=function({w:t,h:n},{fadeSize:i}){let r;return e(0,n-(r=n*(i||2)),t,r)},this.prototype.render=function(){let t,e,i,l,c,h;return({color:t,children:e,fadeSize:i,animators:l,reverse:c,receivePointerEvents:h}=this.props),t=n(t||r.background),o(["parentWidthChildrenHeight","column"],{receivePointerEvents:null!=h?h:"passToChildren"},c?void 0:["bottomLeft",{animators:l||{opacity:{toFrom:0}}}],t?{animators:"draw",draw:{rectangle:{area:u,fadeSize:i},fill:s({colors:a.sineGradient(t.withAlpha(0),t)},c?{from:"bottomLeft",to:"topLeft"}:{from:"topLeft",to:"bottomLeft"})}}:void 0,e)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","present","clientFailureNotAuthorized","timeout","Element","ImikimiPalette","TextElement","TextStyles","TextInputElement","TextPalette","ButtonWrapper","Icons"],[e,n(809)],(t,e,n,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class CommentForm extends t{},function(t,i,d){this.subscriptions("viewState.gridSize","currentSession.currentUser","viewState.buttonSize"),this.stateFields({comment:null,errorMessage:null}),this.prototype.submit=function(){return e(this.comment)?(this.models.message.create({data:{postId:this.props.post.id,text:this.comment}}).catch(t=>{let e;return(e=t.info.response)&&t.status===n?(this.errorMessage=e.data.message,r(1e4,this.clearErrorMessage)):void 0}),this.comment=null,this.refs.commentInput.element.value=""):void 0},this.prototype.enterHandler=function(t){let e;return({ctrlKey:e}=t.props),e?this.refs.commentInput.element.insertAtCursor("\n"):this.submit()},this.prototype.render=function(){let t,n,i,r,d,f;return({gridSize:t}=this),({lightColor:n,disabled:i}=this.props),r=40,o(["parentWidthChildrenHeight","column"],this.currentUser?o(["parentWidthChildrenHeight","row","childrenBottomLeft"],{childrenMargins:t/2,animators:{opacity:{toFrom:0}}},o("parentWidthChildrenHeight",{draw:[{rectangle:{radius:3*t/4}},s.lightGrey]},i?a(l.mediumText,{text:" "}):u((({fontSize:d}=l.mediumText),{fontSize:d}),{key:"commentInput",type:"textarea",padding:{h:3*t/4,v:t/2},animators:"size",size:{ww:1,hch:1,max:{h:8*d}},placeholder:"comment",color:c.black.primary,on:{enter:this.enterHandler,valueChanged:({target:t})=>this.setComment(t.value)}})),h({noFocus:!0,key:"copyButton",size:40,icon:"arrowCircleUp",backgroundPadding:0,radius:3*t/4,hoverColor:s.lightPrimary,action:e(this.comment)&&this.submit},a(p.arrowCircleUp,"textCenterCenter",{size:40,fontSize:30,color:s.primary}))):(f=n?c.white.secondary:c.black.secondary,h("parentWidthChildrenHeight",{hoverColor:this.props.hoverColor,action:()=>this.models.navState.showLogin({reason:"comment"}),animators:{opacity:{toFrom:0}}},o(["parentWidthChildrenHeight","row","childrenCenterCenter"],a(p.login,"textCenterCenter",{size:{wcw:1,h:this.buttonSize},color:f}),a(l.smallText,"textCenterCenter",{color:f,text:"log in to comment",size:{wcw:1,h:this.buttonSize},padding:t})))),this.errorMessage&&a(l.mediumText,"parentWidthChildrenHeight",{padding:t,color:s.red,animators:{size:{toFrom:{ww:1,h:0}},clip:!0},text:this.errorMessage}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Promise","pending","timeout","success","failure","Element","MenuButton","ProgressBar","isFailure","ImikimiPalette","TextElement","TextStyles","networkFailure"],[e,n(809),n(811)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f)=>{return i.defClass(class DownloadButton extends t{},function(t,m,g){this.subscriptions("viewState.viewState",{topic:function({post:t}){return i.exists(t)&&t.topicId}}),this.stateFields({downloadProgress:0,downloadStatus:null}),this.propFields({post:null}),this.getter({postPromise:function(){let t,n,i;return t=(i=this.props).post,n=i.getPost,t?e.resolve(t):n()}}),this.prototype.downloadFullSizePhoto=function(){return this.downloadStatus=n,r(200).then(()=>this.postPromise).then(t=>this.models.share.downloadFullSizePhoto(t,{topic:this.topic,onProgress:({progress:t})=>this.downloadProgress=t}).then(()=>this.downloadStatus=o).tapCatch(t=>{let e;return this.downloadStatus=null!=(e=i.exists(t)&&t.status)?e:s}).finally(()=>r(3e3,this.clearDownloadStatus)))},this.prototype.render=function(){let t,e;return t=this.viewState.gridSize,e=this.props.text,a(["parentWidthChildrenHeight","column"],l({key:"download",text:null!=e?e:"Download photo",icon:"download",action:this.post&&(this.downloadStatus!==n?this.downloadFullSizePhoto:void 0)}),this.downloadStatus&&a({size:{ww:1,h:t},clip:!0,animators:{size:{toFrom:{ww:1,h:0}}}},u({progress:this.downloadStatus!==n?1:this.downloadProgress,color:c(this.downloadStatus)?h.red:h.primary}),this.downloadStatus!==n?p(d.tinyText,"parentSize","textCenterCenter",{color:"white",text:(()=>{switch(this.downloadStatus){case o:return o;case f:return"sorry, we couldn't reach our servers - try again?";default:return"oops, something went wrong"}})()}):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette","Element","TextElement","Icons","ImikimiPalette","TextStyles"],[e,n(809)],(t,e,n,r,o,s,a)=>{return i.defClass(class FeedLabel extends t{},function(t,i,l){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,l,u,c,h,p,d,f,m,g,y,v,S,b;return t=(S=this.props).details,i=S.title,l=S.customIcon,u=S.icon,c=S.iconColor,h=S.iconScale,p=S.action,d=S.secondTitle,f=S.secondTitleSelected,m=(b=this.viewState).gridSize,g=b.paddedFeedWidth,y=e.black.primary,v=e.black.secondary,n("row","parentWidthChildrenHeight",{childrenMargins:m,padding:{v:m}},p?"pointerCursor":void 0,t?void 0:"childrenCenterLeft",p?{on:{pointerClick:p}}:void 0,n({size:2*m},null!=l?l:r(o[u],["centerCenter","childrenSize"],{fontSize:2*m,scale:null!=h?h:1,color:null!=c?c:s.mediumLightGrey})),n("flow","parentWidthChildrenHeight",{childrenMargins:m/2},r(a.mediumBoldText,"childrenSizeMaxParentWidth",{animators:"Color",text:i,color:f?v:y}),d?r(a.mediumBoldText,"childrenSizeMaxParentWidth",{animators:"Color",color:f?y:v,text:d}):void 0,t&&n({size:this.props.wide?{ww:1,hch:1}:{w:g,hch:1},animators:{clip:{toFrom:!0},size:{toFrom:{ww:1,h:0}}}},r(a.smallText,"parentWidthChildrenHeight",{color:e.black.secondary,text:t}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","present","log","RegExp","normalizeTags","TextElement","TextInputElement","Element","Icons","ImikimiPalette","TextPalette","TextStyles","TabButton"],[e,n(809)],(t,e,r,o,s,a,l,u,c,h,p,d,f)=>{return i.defClass(class FilterTextInput extends t{},function(t,m,g){this.subscriptions("viewState.gridSize"),this.stateFields({filter:null}),this.setter({filter:function(t){let n;return i.isF((n=this.props).applyFilterRegExp)&&n.applyFilterRegExp(e(t)?r(new o(s(t).trim(),"i")):null),this.setState("filter",t)}}),this.prototype.reset=function(){return this.refs.filterTextInput.element.value="",this.filter=null},this.prototype.valueChanged=function(t){return this.filter=t.props.value},this.prototype.render=function(){let t,r,o,s,m,g;return t=(g=this.props).totalCount,r=g.filteredCount,o=g.suggestedTags,s=this.gridSize,m=this.props.hideTextInput?a:l,u("column","parentWidthChildrenHeight",{childrenMargins:s},u("row",{size:{h:1.5*s}},a(c.filter,{animators:"color",color:e(this.filter)?h.primary:p.black.tertiary,fontSize:s,size:1.5*s,align:.5}),m(d.smallText,"parentSize","textCenterLeft",{key:"filterTextInput",color:p.black.secondary,placeholder:"filter",value:this.filter,text:e(this.filter)?this.filter:m===a?"filter":void 0,on:{valueChanged:this.valueChanged}}),e(this.filter)?f({size:1.5*s,icon:"close",iconScale:.4,action:this.reset}):void 0,null!=t?a(d.tinyText,"parentHeightChildrenWidth","textCenterLeft",{color:p.black.tertiary,padding:{right:s/2},text:r<t?`${i.toString(r)}/${i.toString(t)}`:`${i.toString(t)}`}):void 0),o?n(298).namespace.Partials.TagList({tags:i.array(o,t=>"#"+t),tagAction:t=>this.setFilter(t)}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette","Element","ButtonWrapper2","Icons","TextElement","ImikimiPalette","TextStyles","capitalize"],[e,n(809)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class LargeMenuButton extends t{},function(t,i,c){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,c,h,p,d,f,m,g,y;return t=(m=this.viewState).gridSize,i=m.buttonSize,c=(g=this.props).icon,h=g.text,p=void 0!==(y=g.height)?y:3*t,d=g.lightText,f=e.black.softPrimary,n({size:{ww:1,h:p+t},padding:{v:t/2}},r(this.props,{radius:100,size:{ww:1,h:p}},n(["row","childrenCenterLeft"],{padding:{h:t/2},childrenMargins:t/2,draw:{radius:100,outline:{color:f,lineWidth:2}}},(c=o[c])?s({color:f},c,{size:i,align:.5},this.props.memberOnly?{color:a.goldGradient,to:"bottomRight"}:void 0):void 0,s(l.largeText,"parentWidthChildrenHeight","textCenterLeft",{text:u(h),color:f}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ButtonWrapper","ImikimiPalette","TextElement","TextStyles","TextPalette"],[e,n(809)],(t,e,n,r,o,s,a)=>{return i.defClass(class MembershipRequiredButton extends t{},function(t,i,l){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,l,u;return t=(l=this.viewState).buttonSize,i=l.gridSize,e({size:"childrenSize",key:"MembershipRequiredButton"},n({size:"childrenSize",radius:100,text:"membership required",backgroundColor:r.darkGolden,hoverColor:r.primary,action:()=>this.models.navState.showOrPushSubscriptions(this.props.overlay,!0)},this.props,o(s.mediumBoldText,{size:"childrenSize",align:"centerCenter",padding:{v:i/2,h:i},color:a.white.primary,text:null!=(u=this.props.text)?u:"membership required"})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","MenuSectionGroup","MenuMarkdown","StringConstants"],[e,n(809),n(811)],(t,e,n,r)=>{return i.defClass(class NativeAppSubscriptionPrompt extends t{},function(t,i,o){this.subscriptions("viewState.viewState","currentSession.currentUser"),this.prototype.render=function(){let t;return({gridSize:t}=this.viewState),e({key:"renderNativeAppPrompt"},n({text:r.membership.appSubscriptionNotSupported}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","timeout","toSeconds","secondsPer","Element","ImikimiPalette","TextElement","TextStyles","TextPalette"],[e,n(809)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class NewFeature extends t{},function(t,i,c){this.subscriptions("viewState.gridSize"),this.stateFields({show:!1}),this.prototype.componentWillMount=function(){return e(500,this.triggerShow)},this.prototype.render=function(){let t,e,i,c;return t=(c=this.props).memberFeature,e=c.addedAt,i=c.location,null!=e&&n()>n(e)+r.week?o({size:0}):o({location:null!=i?i:"topRight",axis:"centerCenter",size:{wcw:1,h:this.gridSize},padding:{h:this.gridSize/2},scale:this.show?1:0,animators:{scale:{f:"easeInBounce",duration:1}},childrenLayout:"row",childrenAlignment:"centerCenter",draw:[{radius:100},t?s.golden:"red"]},a(l.tinyBoldText,{size:"childrenSize",text:"new",layoutMode:"tight",color:u.white.primary}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Paths","getEnv","FluxComponent","Element","TextElement","TextStyles","rect"],[e,n(809)],(t,e,n,r,o,s,a)=>{let l,u,c,h;return l=t.roundedRectanglePath,u=(h=e()).previewNotch,c=h.fakeNativeApp,i.defClass(class NotchPreview extends n{},function(t,e,n){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,e,n,u,c,h,p,d,f;return({notchLocation:t,notchWidth:e,notchHeight:n,antiNotchWidth:u,roundedCornerRadius:c}=this.viewState),h="#3",({statusBarStyle:p}=this.props),(d="off"!==p)&&(f="light"===p?"#f":"#3"),r({receivePointerEvents:"never"},"top"===t?r({size:{h:n}},"row",o(s.smallBoldText,"textBottomCenter",{size:{w:u},color:f,text:d?"Wi-Fi":"",padding:{left:c/2,bottom:2}}),r({size:{h:2*n},draw:{radius:{bottom:22},fill:"#3"},axis:.5,location:"topCenter"}),o(s.smallBoldText,"textBottomCenter",{size:{w:u},padding:{right:c/2,bottom:2},color:f,text:d?"stat-icons":""})):r({size:{h:e,w:2*n},draw:{radius:{[`${i.toString("left"===t?"right":"left")}`]:22},fill:"#3"},axis:.5,location:"left"===t?"centerLeft":"centerRight"}),r({receivePointerEvents:"never",draw:{shape:(e,n)=>{let i,r,o,s;switch(i=10,r=l(e,n,c),l(e,n),t){case"top":l(e,a(u,10),{topRight:100}),l(e,a(u,10)),l(e,a(n.x-u,0,u,10),{topLeft:100}),l(e,a(n.x-u,0,u,10)),o=132;break;case"left":l(e,a(10,u),{bottomLeft:100}),l(e,a(10,u)),l(e,a(0,n.y-u,10,u),{topLeft:100}),l(e,a(0,n.y-u,10,u)),o=202}return s=5,l(e,a((n.x-o)/2,n.y-13,o,5),10)},fill:"#3"}}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","toDate","toSeconds","Date","formatDate","Math","secondsPer","Element","TextElement","TextStyles","TextPalette"],[e,n(809)],(t,e,n,r,o,s,a,l,u,c,h,p)=>{let d,f;return d=2,f=10,i.defClass(class PostDate extends(t(e)){},function(t,e,d){this.subscriptions("viewState.gridSize",{ageString:function({post:t}){return i.exists(t)&&t.createdAt},mediaCreatedAtAgeString:{model:"ageString",key:function({post:t}){return i.exists(t)&&t.mediaCreatedAt}}}),this.propFields("post"),this.stateFields({forceFull:!1}),this.prototype.action=function(){return this.toggleForceFull()},this.prototype.getHoverDate=function(t,e){let a,l,u,c,h,p,d,f;return this.hover||this.forceFull?(a=(d=this.props).oneLine,l=d.detialsBottom,u=n(r(i.exists(f=this.props.post)&&f[e])),c=new o,h=s(u,"h:MMtt"),p=[s(u,"h:MMtt"),s(u,"mmm dS yyyy")],(l?p.reverse():p).join(a?", ":"\n")):t},this.prototype.render=function(){let t,e,n,r,o,s,d;return t=(s=this.props).color,e=s.oneLine,n=this.getHoverDate(this.ageString,"createdAt"),(i.exists(d=this.post)?(r=d.createdAt,o=d.mediaCreatedAt):void 0)&&a.abs(r-o)>12*l.hour&&(n=`post: ${i.toString(n)}\nphoto: ${i.toString(this.getHoverDate(this.mediaCreatedAtAgeString,"mediaCreatedAt"))}`),u({on:this.pointerHandlers,size:e?"childrenSize":{hch:1,w:7*this.gridSize}},this.props,c(h.tinyText,"textTopRight",e?"childrenSize":"parentWidthChildrenHeight",{color:null!=t?t:p.white.primary,text:n}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ButtonWrapper","TextPalette","ImikimiPalette","Element"],[e,n(809)],(t,e,r,o,s)=>{return i.defClass(class PosterTextButton extends t{},function(t,i,a){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,a,l,u,c,h,p;return t=(u=this.viewState).gridSize,i=u.buttonSize,a=void 0!==(h=(c=this.props).location)?h:"bottomRight",l=c.simple,e({backgroundPadding:t/4,size:i,color:r.white.primary,size:4*t,location:a,axis:a,action:null!=(p=this.props.action)?p:this.models.navState.showPosterText,background:o.primary,radius:l?5:void 0},s({padding:t/2},n(888)({simple:l}),this.props.showNewFeature?n(884)({addedAt:"2018-11-20",location:"topCenter"}):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","TextStyles","TextPalette","Element","TextElement"],[e,n(809)],(t,e,n,r,o,s)=>{return i.defClass(class PosterTextIcon extends t{},function(t,i,a){let l,u;l=function(t,e){return e.mul(t.x/e.x)},u=e(n.mediumBoldText,{size:"childrenSize",color:r.white.primary,scale:function(t,e){return t.minRatio(e)}}),this.prototype.render=function(){let t;return t=this.props.simple,o({childrenLayout:"column",childrenMargins:3,childrenAlignment:"centerCenter",padding:t?2:5,draw:t?void 0:{radius:5,outline:{lineWidth:3,color:r.white.primary}}},o({size:l},s(u,{text:"Poster"})),o({size:l},s(u,{text:"Text"})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Icons","ButtonWrapper2","RectangleElement","OutlineElement","Element","TextElement","TextPalette"],[e,n(809),{ShowMedia:n(819)}],(t,e,n,r,o,s,a,l)=>{return i.defClass(class PrevNextButton extends t{},function(t,i,u){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P;return({gridSize:t,buttonSize:i}=this.viewState),u=(P=this.props).currentIndex,c=P.right,h=P.nextIndex,p=P.backgroundColor,d=P.foregroundColor,f=P.action,m=P.fullScreen,g=P.external,y=P.icon,v=P.disabled,S=P.darkBackgroundColor,null!=v||(v=!f),y||(y=c?"triangleRight":"triangleLeft"),b=y&&e.icomoon[y],w=t,x=c?{tl:w,bl:w}:{tr:w,br:w},n({hoverColor:d,backgroundColor:p,draw:[{radius:c?{left:1.25*t}:{right:1.25*t},padding:-t/4,fill:"black"},"reset",{radius:c?{left:t}:{right:t},color:d}],hoverExpand:!0,inFlow:!1,key:this.props.key,disabledOpacity:1,disabled:v,action:f,animators:{axis:{toFrom:c?"centerLeft":"centerRight"}},size:"childrenSize",backgroundPadding:0,radius:x},m&&r({radius:c?{tl:w+5,bl:w+5}:{tr:w+5,br:w+5},compositeMode:"sourceTopInTarget",padding:-5.5},o({lineWidth:10,color:"white",shadow:{color:"#fff2",blur:15,offset:{y:0,x:0}}})),c?{axis:"centerRight",location:{ps:"centerRight",x:1.25*t}}:{axis:"centerLeft",location:{ps:"centerLeft",x:1.25*-t}},s({size:{w:3*t,h:6*t},padding:c?{right:1.25*t}:{left:1.25*t}},b&&a(b,{animators:{opacity:{toFrom:0}},opacity:v?.25:1,color:l.white.primary},"centerCenter","childrenSize")))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","getPostBackground","Element","TextElement","Icons","TextPalette"],[e,n(809)],(t,e,n,r,o,s)=>{return i.defClass(class PrivateStreamBadge extends t{},function(t,i,a){this.subscriptions("viewState.gridSize"),this.propFields("chapterPost","background","small"),this.prototype.render=function(){let t,i,a,l,u;return u=this,t=this.gridSize,i=this.background,a=this.chapterPost,l=this.small,null!=i||(i=e(a)),n({inFlow:!1,padding:t*(l?1/3:.5)},"topRight","childrenSize",n({size:t*(l?1.75:2),draw:{radius:1e3,color:i}},r(o.lock,"parentSize","textCenterCenter",{fontSize:t,color:s.white.primary})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette","ButtonWrapper2","Element","TextElement","Icons","TextStyles"],[e,n(809)],(t,e,n,r,o,s,a)=>{return i.defClass(class RelaxedMenuButton extends t{},function(t,l,u){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,l,u,c,h,p,d,f;return t=this.gridSize,l=(d=this.props).action,u=d.icon,c=d.color,h=d.text,null!=c||(c=e.black.softPrimary),n("parentWidthChildrenHeight","clip",this.props,{animators:{size:{toFrom:{h:0}}},radius:100,action:l,padding:{h:-t/2},borderPadding:t/4},r("parentWidthChildrenHeight","row","childrenCenterLeft",{padding:{h:t/2},childrenMargins:t},o(u=s[u],{size:p=2*t,color:null!=(f=i.exists(u)&&u.color)?f:c},"textCenterCenter"),o(a.mediumText,"textCenterLeft",{size:{h:p+t},text:h,color:c})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","present","timeout","TextInputElement","TextElement","Element","ImikimiPalette","TextStyles","ButtonWrapper","Icons","TextPalette"],[e,n(809)],(t,n,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class SearchBar extends t{},function(t,d,f){this.subscriptions("viewState.viewState"),this.prototype.setDefaultTextFocus=function(){let t,e;return this.viewState.nativeApp?void 0:i.exists(t=this.refs)&&i.exists(e=t.searchTextInput)&&e.element.focus()},this.propFields("placeholder"),this.stateFields({searchString:""}),this.prototype.preprocessProps=function(t){return t.searchString!==this.props.searchString&&(this.searchString=t.searchString),t},this.prototype.searchNow=function(){let t;return i.isF((t=this.props).searchNow)&&t.searchNow(this.searchString)},this.prototype.clearSearch=function(){let t;return i.isF((t=this.props).clearSearch)&&t.clearSearch(),this.setSearchString(""),this.setDefaultTextFocus()},this.prototype.setSearchString=function(t){let e;return i.isF((e=this.props).setSearchString)&&e.setSearchString(t),this.setState("searchString",t)},this.getter({textInputHandlers:function(){let t;return null!=(t=this._textInputHandlers)?t:this._textInputHandlers={valueChanged:({target:t})=>this.setSearchString(t.value),domElementAttached:({target:t})=>(e.searchBox=t,this.viewState.isMobileBrowser&&(n(t.value)||n(this.toSearchString))?void 0:r(100,()=>(t.focus(),t.selectAll()))),enter:this.searchNow}}}),this.prototype.render=function(){let t,e,i,r,d,f,m,g,y;return t=(g=this.viewState).gridSize,e=g.buttonSize,y=this,i=this.searchString,r=this.placeholder,f=(d=this.inputDisabled)?s:o,a(["parentWidthChildrenHeight","row"],{key:"renderSearch",childrenMargins:t/2},a(["parentWidthChildrenHeight","row"],{padding:{left:t},draw:{rectangle:{radius:m=100},color:l.lightGrey}},f(u.mediumText,"textCenterLeft",{size:{ww:1,h:e},maxLength:75,key:d?void 0:"searchTextInput",value:i,on:this.textInputHandlers,placeholder:null!=r?r:"search",text:null!=i?i:r,willConsumeKeyboardEvent:(t,e)=>"Enter"===e.key?"beforeDescendents":void 0}),n(i)?c("parentHeightChildrenWidth",{key:"closeButton",radius:100,backgroundPadding:t/4,action:this.clearSearch},s(h.close,{padding:{h:t}},"parentHeightChildrenWidth","textCenterCenter",{fontSize:12,color:p.black.secondary})):void 0,c("parentHeightChildrenWidth",{key:"searchButton",backgroundColor:l.primary,radius:100,backgroundPadding:t/4,action:this.searchNow},s(h.search,"parentHeightChildrenWidth","textCenterCenter",{padding:{h:t},fontSize:16,color:p.white.primary}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","rgbColor","TextPalette"],[e,n(809)],(t,e,r,o)=>{return i.defClass(class SelectableTextWrapper extends t{},function(t,i,s){this.subscriptions("viewState.gridSize"),this.propFields("context","text","post","size","buttons"),this.stateFields({showCopyButton:!1,selectedTextMenuLocation:null}),this.prototype.pointerClick=function({location:t}){return this.showCopyButton||(this.selectedTextMenuLocation=t),this.toggleShowCopyButton()},this.prototype.render=function(){let t;return e({size:this.size,on:{pointerClick:this.pointerClick,blur:this.clearShowCopyButton}},this.showCopyButton?e({inFlow:!1,animators:{opacity:{toFrom:0}},draw:{padding:-this.gridSize/2,radius:this.gridSize/2,outline:r(null!=(t=this.props.backgroundColor)?t:o.black.tertiary).withAlpha(.25)}}):void 0,e({size:this.size,key:"SelectableTextWrapperChildren"},this.props.children),this.showCopyButton?n(847)({text:this.text,post:this.post,context:this.context,buttons:this.buttons,startLocation:this.selectedTextMenuLocation,close:this.clearShowCopyButton}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","toSeconds","Element","TextElement","TextStyles","TextPalette","networkFailure","clientFailureNotAuthorized","compactFlatten","isClientFailure","BarButton","lowerCase","codeWords"],[e,n(809)],(t,e,n,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class ShowError extends t{},function(t,f,m){this.subscriptions("viewState.viewState",{ageString:function({failureInfo:t}){return i.exists(t)&&t.reloadAt}}),this.prototype.render=function(){let t,f,m,g,y,v,S,b,w,x,P,C;return P=this.props,t=P.status,f=P.message,m=P.failureInfo,g=(C=this.viewState).gridSize,y=C.feedWidth,null!=(v=m?(({reloadAt:S,tryCount:b,retryNow:w}=m),1<(x=e(S)-e())?` Retrying in ${i.toString(this.ageString)}.`:void 0):void 0)||(v=""),n({padding:g},n(["topCenter","column"],"childrenCenterCenter",{childrenMargins:g,size:{w:y,max:{ww:1}}},r(o.mediumText,"parentWidthChildrenHeight",{color:s.black.secondary,text:[(()=>{switch(!1){case!(t===a):return"Oops! We're sorry, but we can't seem to reach our servers.";case!(t===l):return u(["Your request is not allowed",f]).join(": ");case!c(t):return u(["Your request is invalid",f]).join(": ");default:return"Oops, something went wrong. Sorry about that. We'll get right on fixing it."}})(),v]}),w&&h({icon:"redo",text:"retry now",primary:!0,action:w}),n(),t!==a?(t=p(d(t).join(" ")),r(o.tinyText,{size:"childrenSize",color:s.black.secondary,text:f?`(${i.toString(t)}) ${i.toString(f)}`:t})):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","getDisplayCaption","ButtonWrapper","ImikimiStyles","ShowMediaWithText","Element","ColorFadeOverlay","getPostBackground","TextElement","TextStyles","TextPalette","getDisplayTitle","UserCircle"],[e,n(809),{ShowMediaWithText:n(821),ColorFadeOverlay:n(876),UserCircle:n(872)}],(t,e,n,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class SlideshowElement extends t{},function(t,f,m){this.subscriptions({topic:function({post:t,justPost:e}){return!e&&i.exists(t)&&t.topicId},user:function({post:t,justPost:e}){return!e&&i.exists(t)&&t.userId},ageString:function({post:t,justPost:e}){return e&&i.exists(t)&&t.createdAt}}),this.prototype.action=function(){return this.models.navState.showPost(this.props.post)},this.prototype.render=function(){let t,i,f,m,g,y,v,S,b,w,x,P;return x=this.props,t=x.post,i=x.gridSize,f=x.location,m=x.size,g=x.axis,y=x.justPost,v=x.chapterPost,P=this,S=this.topic,b=this.user,w=e(t),n({action:this.action,noBackground:!0,location:f,size:m,axis:g,animators:{location:!0,size:{toFrom:0}},draw:[{rectangle:{radius:i/4}},"clip","children",{outline:r.imageContrastOutlineStyle}]},o({post:t,chapterPost:v,thumbnailMode:!0}),e=>e&&s({animators:{opacity:{toFrom:0}}},a({color:l(t)},s("parentWidthChildrenHeight","column",{padding:y?i/2:i,childrenMargins:i/2},S&&u(c.mediumBoldText,"parentWidthChildrenHeight",{maxLines:w?1:2,color:h.white.primary,text:p(S)}),w&&u(c.smallText,{size:"parentWidthChildrenHeight",maxLines:2,color:h.white.primary,text:w}),y&&u(c.tinyText,{size:"parentWidthChildrenHeight",maxLines:1,color:h.white.primary,text:this.ageString}))),b&&d("topRight",{user:b,padding:i/2,size:4*i,animators:{opacity:{toFrom:0}}})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles"],[e,n(809)],(t,e,n,r)=>{return i.defClass(class StatusBarPreview extends t{},function(t,i,o){this.prototype.render=function(){let t,i,o;return({statusBarStyle:t}=this.props),(i="off"!==t)&&(o="light"===t?"#f":"#3"),e({size:{h:20},padding:{h:5}},"row",i&&n(r.tinyBoldText,"parentSize","textCenterLeft",{text:"carrier",color:o}),i&&n(r.tinyBoldText,"parentSize","textCenterRight",{text:"bars wifi battery",color:o}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextStyles","TextPalette","ImikimiStyles","Element","UserCircle","TextElement","getPostTitle","getAutoChapterTitle","getDisplayTitle","getShortDisplayName","getMediumDisplayName","getDisplayName","pluralize3DidgetCount","dateAgeString"],[e,n(809),{UserCircle:n(872),PostDate:n(886)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m)=>{return i.defClass(class StreamHeading extends t{},function(t,g,y){this.subscriptions("viewState.gridSize",{user:function({post:t}){return i.exists(t)&&t.userId},streamOwner:{model:"user",key:function({topic:t}){return i.exists(t)&&t.userId}}}),this.stateFields({currentWidth:400}),this.getter({tight:function(){return this.currentWidth<200},medium:function(){return this.currentWidth<500}}),this.prototype.ready=function({target:{currentSize:t}}){return this.currentWidth=t.x},this.prototype.render=function(){let t,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L;return R=this,t=this.gridSize,g=this.user,y=this.streamOwner,(i.exists(y)&&y.id)===(i.exists(g)&&g.id)&&(y=null),v=(z=this.props).post,S=z.topic,b=void 0!==(O=z.chapterPost)?O:i.exists(S)&&S.lastChapterPost,w=z.shadow,x=z.secondaryInfoOpacity,P=z.smallText,C=z.small,_=z.showPostTitle,E=z.showPostDate,T=z.showPostCount,null!=x||(x=1),k=P?e.smallBoldText:e.mediumBoldText,I=P?e.tinyText:e.smallText,M=n.white.primary,A=w?n.white.primary:n.white.secondary,F=.5*k.fontSize,w&&(w=r.tinyShadow,M="white"),o("parentWidthChildrenHeight","row","childrenCenterLeft",{on:{ready:this.ready},childrenMargins:C?2*t/3:t},o({size:B=t*(C?2:3),padding:y?-B/12:void 0},y?s({key:"streamOwner",withContrast:!0,user:y,size:.6*B,shadow:!0,pointerEventPriority:1,axis:"bottomRight",location:"bottomRight"}):void 0,s({key:"postingUser",withContrast:!0,user:g,size:B*(y?.9:1),shadow:!0,pointerEventPriority:1})),o(["parentWidthChildrenHeight","column"],{childrenMargins:F},!C&&a(k,"textCenterLeft",{key:"username",opacity:x,color:M,shadow:w,maxLines:1,text:(null!=(L=_&&l(v))?L:u(b,v))||null}),a(k,"textCenterLeft",{key:"title",color:M,maxLines:1,text:c(S),shadow:w}),o("row","parentWidthChildrenHeight",{childrenMargins:t/2},a(I,"textTopLeft",{key:"chaptertitle",size:{h:.75*k.fontSize},color:A,opacity:x,maxLines:1,text:(C||this.tight?h(g):this.medium?p(g):d(g))+(T?` - ${i.toString(f(S.postCount,"post"))}`:""),shadow:w}),E?a(I,"textTopRight",{size:{h:.75*k.fontSize,wcw:1},color:A,opacity:x,text:m(v.createdAt)}):void 0)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextPalette"],[e,n(809)],(t,e,n)=>{return i.defClass(class TabBarSpacer extends t{},function(t,i,r){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t;return t=this.gridSize,e({size:{w:1+t/4},padding:{v:t/2,h:t/8},draw:["padded",n.black.barely]})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ScrollerWithBar","TextElement","TextStyles","TextPalette","TabButton","Function"],[e,n(809)],(t,e,r,o,s,a,l,u)=>{return i.defClass(class TabbedPage extends t{},function(t,c,h){this.subscriptions("viewState.viewState"),this.stateFields({selectedTab:null}),this.propFields("tabs","tabOrder"),this.getter({selectTab:function(){return this.setSelectedTab},selectedTab:function(){let t,e,n;return t=this.state.selectedTab,null!=(n=(e=this.tabs)[t]&&t)?n:i.find(this.tabOrder,null,t=>e[t])}}),this.prototype.render=function(){let t,c,h,p,d,f,m,g,y,v,S,b,w,x;return w=this.props,t=w.tabs,c=w.tabOrder,h=w.suggestedPadding,p=w.size,x=this,d=this.viewState,f=d.gridSize,m=d.buttonSize,g=this.selectedTab,e("column",y={size:p},e("parentWidthChildrenHeight",{padding:(({left:v,right:S,top:b}=h),{left:v,right:S,top:b})},n(900)(this.props,{selectedTab:this.selectedTab,selectTab:this.selectTab,hideDetails:!0})),e(y,i.array(c,n=>{let c,p,d,v,S;return c=(S=t[n]).children,p=S.details,d=S.action,v=S.tabButton,e(y,{key:`${i.toString(n)} children`,visible:n===g,padding:{top:f/2}},"clip",r(y,{padding:{left:h.left,right:h.right,bottom:h.bottom}},p||v?e({size:{h:m+f/2},padding:{bottom:f/2}},["row","childrenCenterLeft"],d?"pointerCursor":void 0,{on:d?{pointerClick:d}:void 0,animators:{clip:{toFrom:!0},size:{toFrom:{ww:1,h:0}}}},o(s.smallText,"parentWidthChildrenHeight",{color:a.black.secondary,text:p}),l({size:{wcw:1,h:m}},v)):void 0,i.is(c,u)?n===g?c():void 0:c))},e=>{let n;return i.exists(n=t[e])&&n.children})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Object","TextPalette","Element","ScrollElement","ImikimiPalette","TextElement","TextStyles","max","rect","Icons"],[e,n(809)],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class TabbedSection2 extends t{},function(t,p,d){this.subscriptions("viewState.viewState"),this.stateFields({hover:null}),this.propFields("tabs","selectTab"),this.getter({tabOrder:function(){let t,n,i,r;return null!=(t=(r=this.props).tabs,i=n=r.tabOrder)?i:e.keys(t)},selectedTab:function(){let t,e,n,r;return t=(n=this.props).selectedTab,null!=(r=(e=n.tabs)[t]&&t)?r:i.find(this.tabOrder,null,t=>e[t])}}),this.prototype.render=function(){let t,e,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A;return t=(k=this.props).tabList,e=k.hideDetails,I=this,p=this.tabs,d=this.tabOrder,f=this.selectedTab,m=this.hover,i.exists(M=p[f])&&(g=M.details,y=M.action),A=this.viewState,v=A.gridSize,S=A.paddedFeedWidth,b=A.fullScreen,w=A.reducedButtonSize,x=!b,P=n.black.primary,C=n.black.secondary,_={color:"#0000",blur:v,offset:{y:-v/8}},E={color:"#0001",blur:v,offset:{y:-v/8}},T=!1,d.length>0||(p=null),r("column","parentWidthChildrenHeight",null!=p?{childrenMargins:v}:void 0,o("row","parentWidthChildrenHeight",p&&r("row",x?{size:{hch:1,w:(t,e)=>u(t.x,e.x)}}:"childrenSize",{childrenMargins:v/2,draw:["children",{padding:{top:-v,left:-v,right:10*-v}},"clip",{rectangle:t=>c(-v/2,t.y-1,t.x+v*(x?1:2.5),10),fill:{color:s.veryLightGrey,shadow:E}},{child:f}]},i.array(d,t=>{let e,n,o,u,c,d,g,y,S;return e=(y=p[t]).title,n=y.icon,o=y.iconScale,u=void 0!==(S=y.iconColor)?S:s.grey,d=(c=f===t)?P:C,g=v*(c?0:.25),m!==t||c||(g-=.25*v),r("row","pointerCursor","childrenCenterCenter",{size:{wcw:1,h:w},childrenMargins:w/3,padding:{top:.5*v+g,h:w/3,bottom:.5*v-g},key:t,on:{mouseIn:()=>this.hover=t,mouseOut:this.clearHover,pointerClick:({target:e})=>(i.isF(e.scrollOnScreen)&&e.scrollOnScreen(!0,"horizontal"),this.selectTab(t))},animators:["draw","padding"],draw:{radius:{top:v/2},padding:{top:g},fill:c?{color:"white",shadow:E}:{color:m===t?s.lightPrimary:s.veryLightGrey,shadow:_}}},n&&r({size:l.mediumBoldText.fontSize},a(h[n],["centerCenter","childrenSize"],{animators:["scale","color"],fontSize:l.mediumBoldText.fontSize,scale:(null!=o?o:1)*(c?1.25:1),color:c&&u||d})),a(this.viewState.fullScreen?l.mediumBoldText:l.smallBoldText,{size:{wcw:1,h:l.mediumBoldText.fontSize},animators:"color",text:e,color:d},"textCenterCenter"))},t=>null!=p[t]))),!e&&g&&r("parentWidthChildrenHeight",y?"pointerCursor":void 0,{on:y?{pointerClick:y}:void 0,animators:{clip:{toFrom:!0},size:{toFrom:{ww:1,h:0}}}},a(l.smallText,"parentWidthChildrenHeight",{color:n.black.secondary,text:g})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Object","TextPalette","Element","ScrollElement","ImikimiPalette","TextElement","TextStyles","max","rect","Icons"],[e,n(809)],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class TabbedSection extends t{},function(t,p,d){this.subscriptions("viewState.viewState"),this.stateFields({hover:null}),this.prototype.render=function(){let t,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B;return I=this.props,t=I.selectTab,p=I.tabList,d=void 0!==(M=I.tabs)?M:i.object(p,null,t=>null!=t,null,t=>t.key),f=void 0!==(A=I.tabOrder)?A:e.keys(d),m=I.currentTab,g=this.hover,d[m]||(m=f[0],i.isF(t)&&t(m)),i.exists(F=d[m])&&(y=F.details,v=F.action),B=this.viewState,S=B.gridSize,b=B.paddedFeedWidth,w=B.buttonSize,x=B.fullScreen,P=!x,C=n.black.primary,_=n.black.secondary,E={color:"#0000",blur:S,offset:{y:-S/8}},T={color:"#0001",blur:S,offset:{y:-S/8}},k=!1,f.length>0||(d=null),r("column","parentWidthChildrenHeight",null!=d?{childrenMargins:S,padding:{bottom:S,top:S/2}}:void 0,o("row","parentWidthChildrenHeight",d&&r("row",P?{size:{hch:1,w:(t,e)=>u(t.x,e.x)}}:"childrenSize",{childrenMargins:S/2,draw:["children",{padding:{top:-S,left:-S,right:10*-S}},"clip",{rectangle:t=>c(-S/2,t.y-1,t.x+S*(P?1:2.5),10),fill:{color:s.veryLightGrey,shadow:T}},{child:m}]},i.array(null!=f?f:e.keys(d),e=>{let n,o,u,c,p,f,y,v,b;return n=(v=d[e]).title,o=v.icon,u=v.iconScale,c=void 0!==(b=v.iconColor)?b:s.grey,f=(p=m===e)?C:_,y=S*(p?0:.25),g!==e||p||(y-=.25*S),r("row","pointerCursor","childrenCenterCenter",{size:{wcw:1,h:w},childrenMargins:w/3,padding:{top:.5*S+y,h:w/3,bottom:.5*S-y},key:e,on:{mouseIn:()=>this.hover=e,mouseOut:this.clearHover,pointerClick:({target:n})=>(i.isF(n.scrollOnScreen)&&n.scrollOnScreen(!0,"horizontal"),i.isF(t)&&t(e))},animators:["draw","padding"],draw:{radius:{top:S/2},padding:{top:y},fill:p?{color:"white",shadow:T}:{color:g===e?s.lightPrimary:s.veryLightGrey,shadow:E}}},o&&r({size:l.mediumBoldText.fontSize},a(h[o],["centerCenter","childrenSize"],{animators:["scale","color"],fontSize:l.mediumBoldText.fontSize,scale:(null!=u?u:1)*(p?1.25:1),color:p&&c||f})),a(this.viewState.fullScreen?l.mediumBoldText:l.smallBoldText,{size:{wcw:1,h:l.mediumBoldText.fontSize},animators:"color",text:n,color:f},"textCenterCenter"))},t=>null!=d[t]))),y&&r("parentWidthChildrenHeight",v?"pointerCursor":void 0,{on:v?{pointerClick:v}:void 0,animators:{clip:{toFrom:!0},size:{toFrom:{ww:1,h:0}}}},a(l.smallText,"parentWidthChildrenHeight",{color:n.black.secondary,text:y})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ImikimiPalette","TextPalette","TextInputElement","TextStyles","TextElement","AnimatedIconTextButton"],[e,n(809)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class TextCopier extends t{},function(t,u,c){this.subscriptions("viewState.gridSize","viewState.buttonSize"),this.stateFields({copied:!1}),this.prototype.copyText=function(){let t;return this.refs.copyFromTextInput.element.copy()?(this.copied=!0,i.isF((t=this.props).onCopy)&&t.onCopy(this.refs.copyFromTextInput.element.value)):void 0},this.prototype.render=function(){let t,i,u,c,h,p,d;return t=(p=this.props).loading,i=p.copied,u=p.text,d=this,c=this.buttonSize,h=this.gridSize,e({size:{ww:1,h:c},padding:{right:-h/4},draw:[{padding:{h:-h/2}},n.white,{outline:r.black.barely}],childrenMargins:h/2},"row",t?a(s.smallText,{color:r.black.secondary,layoutMode:"tight",text:"..."},"textCenterCenter"):o(s.smallText,"parentSize",{key:"copyFromTextInput",color:r.black.secondary,value:u}),l({tight:!0,icon:"copy",backgroundPadding:h/4,radius:100,backgroundColor:n.primary,label:this.copied?"copied":"copy",action:!t&&this.copyText}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","max","TextPalette","MenuMarkdown","TextStyles","MenuButton","TabButton","openLink","docUrls"],[e,n(809),n(811)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class TrackingConsentMessage extends t{},function(t,i,h){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,h,p,d;return t=(d=this.viewState).gridSize,i=d.feedWidth,h=d.fullScreen,p=d.safePadding,e("bottomCenter","parentWidthChildrenHeight",h?"row":"column",{childrenMargins:h?t:0,inFlow:!1,padding:{left:n(t,p.left),right:n(t,p.right),bottom:p.bottom},animators:{axis:{toFrom:"topCenter"}},draw:{fill:{color:"white",shadow:{color:r.black.secondary,blur:20}}}},o(s.mediumText,{includeTags:!0,small:!0,text:"We use tracking to improve our service."}),h?[l({tight:!0,size:"childrenSize",innerPadding:t/2,text:"Privacy Policy",icon:"helpInverted",action:()=>u(c.privacy)}),l({tight:!0,size:"childrenSize",innerPadding:t/2,text:"Accept",icon:"checkmark",action:this.models.gdprComplianceState.acceptTracking})]:[a({text:"Privacy Policy",icon:"helpInverted",action:()=>u(c.privacy)}),a({text:"Accept",icon:"checkmark",action:this.models.gdprComplianceState.acceptTracking})])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","getZoLogoElementProps","standardZoLogoProps"],[e,n(809),n(905)],(t,e,n,r)=>{return i.defClass(class ZoLogo extends t{},function(t,i,o){this.prototype.render=function(){let t,i,o,s;return t=this.props.color,e((({size:i,location:o,axis:s}=this.props),{size:i,location:o,axis:s}),e(t?n(t):r,"fitParent"))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["point","rect","ImikimiPalette"],[e,n(268)],(t,e,n)=>{let i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x;return i=410,r=96.35,o=75.85,s=86.1,a=1,l=.3,u=c=410,u/=1,h=t(96.35),p=t(c-96.35,u-96.35),d=20.5,f=172.2,m=e({center:h,size:172.2}),g=e({center:p,size:172.2}),y=h.x+25.83,v=p.x-25.83,S=h.y,b=p.y,w=function(t){return t.moveTo(y,S),t.lineTo(v,S),t.lineTo(y,b),t.lineTo(v,b)},{getZoLogoElementProps:x=function(e){return{size:t(c,u),draw:[{circle:m,outline:{color:e,lineWidth:20.5}},{shape:w,outline:{lineCap:"round",lineJoin:"round",lineWidth:86.1,color:e}},{circle:g,fill:{compositeMode:"targetWithoutSource",color:e}},{circle:g,outline:{color:e,lineWidth:20.5}}]}},standardZoLogoProps:x(n.primary)}}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(284)).addModules({Authenticate:n(907),AuthNextButton:n(949),StandardImport:n(908)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["getEnv","FluxComponent","findEmailRegExp","present","timeout","isString","MenuSectionGroup","Element","TextStyles","TextElement","TextPalette","applyStringVariables","StringConstants","UserCircle","MenuMarkdown","SimpleMenuTextInput","PrimaryMenuButton","TabButton","ImikimiPalette","AuthNextButton","humanDurationString","pipelines","openLink","docUrls","MenuInfo","pending","StatusMessage","LoadingOverlay"],[e,n(908),n(590).membership,{AuthNextButton:n(949)}],(t,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M)=>{let A,F;return A=/^[^0-9a-z]*([0-9a-z][^0-9a-z]*){6}$/i,F=t().referrer,i.defClass(class Authenticate extends(n(594)(r)){},function(t,n,r){let B,R;this.eventKey("auth"),this.subscriptions("viewState.viewState","authenticationState.authenticationState",{referrer:{model:"user",key:function(){return F}}}),this.propFields({prompt:"Enter your email:",emailPlaceholder:"email",reason:"normal",heading:null,info:null}),this.stateFields({code:"",email:null,validEmail:null,requestsSent:0,authenticating:!1,emailIsValid:!1,displayNameIsReady:!1,loggedEmailIsValid:!1,loggedDisplayNameIsValid:!1,loggedCodeIsValid:!1}),B=function(t){return null!=t&&t.trim().length>=2},R=function(t){let e;return(e=i.exists(t)&&t.match(o))?e[0]:void 0},this.prototype.componentWillMount=function(){return this.models.authenticationState.reason=this.props.reason,this.createEvent("showAuthUi",{data:{reason:this.props.reason}}),e.authenticateComponent=this,r.componentWillMount.apply(this,arguments)},this.prototype.componentWillUnmount=function(){return e.authenticateComponent=null,r.componentWillUnmount.apply(this,arguments)},this.prototype.getInitialState=function(){let t,e;return{email:t=this.models.authenticationState.currentRequestEmail,validEmail:e=R(t),emailIsValid:!!e,displayNameIsReady:B(this.models.authenticationState.displayName)}},this.getter({displayName:function(){return this.authenticationState.displayName},displayNameIsValid:function(){return B(this.authenticationState.displayName)},editingEmail:function(){let t;return t=this.authenticationState.currentRequestEmail,!this.emailIsValid||t!==this.validEmail||!s(t)}}),this.prototype.logReferrerState=function(){let t;return this.createEventOncePerHour("validReferrer:"+(this.haveOpenRequests?this.isNewUser?"newUser":"oldUser":"start"),{referrerUserId:i.exists(t=this.referrer)&&t.id,email:this.validEmail})},this.prototype.preprocessState=function(t){let e;return(e=t.referrer)&&a(10,this.logReferrerState),r.preprocessState.apply(this,arguments)},this.prototype.submitEmail=function(){let t;return this.emailIsValid&&this.validEmail?(this.email=this.validEmail,!this.haveOpenRequests||(t=this.resendOk)?(this.createEvent(t?"resend":"submitEmail",{email:this.validEmail}),this.requestsSent++,this.models.authenticationState.requestAuthentication(this.validEmail,this.props.addEmail&&"add")):this.models.authenticationState.selectOpenRequest(this.validEmail)):void 0},this.prototype.submitDisplayName=function(){return B(this.displayName)?(this.createEvent("submitDisplayName",{displayName:this.displayName}),this.displayNameIsReady=!0):void 0},this.getter({haveOpenRequests:function(){let t;return!!((i.exists(t=this.models.authenticationState.getOpenRequests(this.validEmail))&&t.length)>0)},resendOk:function(){return!this.haveOpenRequests||this.models.authenticationState.resendOk(this.validEmail)}}),this.prototype.authenticateUser=function(){let t,e;return this.authenticating=!0,t=this.models.authenticationState.authenticateUser(this.code.trim(),{referringUserId:F}),this.referrer&&this.isNewUser&&this.createRequestEvents("authenticateAndApplyReferral",t,{referringUserId:F,email:this.validEmail}),t.tap(null!=(e=this.props.success)?e:()=>{}).finally(()=>this.authenticating=!1).catch(()=>{})},this.prototype.setEmailValue=function(t){return this.emailValueChanged(this.email=t)},this.prototype.emailValueChanged=function(t){let e,n;return l(t)?e=t:({props:{value:e}}=t),e=i.exists(e)&&e.trim(),(this.emailIsValid=!!(n=R(e)))&&(this.validEmail=n,this.loggedEmailIsValid||(this.loggedEmailIsValid=!0,this.createEvent("emailIsValid"))),this.displayNameIsReady=this.displayNameIsValid},this.prototype.displayNameChanged=function({props:{value:t}}){let e;return this.models.authenticationState.displayName=e=0===(t=t.trim()).length?null:t,!this.loggedDisplayNameIsValid&&B(e)?(this.loggedDisplayNameIsValid=!0,this.createEvent("displayNameIsValid")):void 0},this.prototype.codeChanged=function({props:{value:t}}){return this.code=t=t.replace(/[^a-z0-9]/gi,""),!this.loggedCodeIsValid&&A.test(t)?(this.loggedCodeIsValid=!0,this.createEvent("codeIsValid")):void 0},this.prototype.renderReferrer=function(){let t;return t=this.viewState.gridSize,this.editingEmail||this.isNewUser?u({key:"renderReferrer"},c("row","childrenCenterCenter",{size:{ww:1,h:3*h.mediumBoldText.fontSize},childrenMargins:t,padding:{bottom:t,top:t/2}},p(h.mediumBoldText,{color:d.black.softPrimary,text:f(m.referrals.referralCongratulations,this.referrer)}),g({size:3*t,user:this.referrer,noClicks:!0})),y({padding:{bottom:2*t,top:t},text:m.referrals.createAccountWithReferralRewardInfo})):u({key:"no referral info"},y({padding:{bottom:2*t},text:m.referrals.notEligableMessage,stringVariables:this.referrer}))},this.prototype.renderNewUser=function(){let t;return({gridSize:t}=this.viewState),[v({label:"What is your name?",value:this.displayName,placeholder:"first and last name",valueChanged:this.displayNameChanged,submit:this.displayNameIsValid&&this.submitDisplayName}),this.renderCompleteRegistration("complete registration")]},this.prototype.renderNoValidRequests=function(){let t;return[p(h.mediumText,{color:d.black.secondary,padding:{v:this.viewState.gridSize},size:"parentWidthChildrenHeight",text:`Your ${i.toString(t=this.isNewUser?"sign-up":"log in")} email expired, but no worries, just click this:`}),S({text:`send new ${i.toString(t)} email`,action:this.submitEmail})]},this.prototype.renderCompleteRegistration=function(t){let e,n;return({gridSize:e}=this.viewState),({haveOpenRequests:n}=this),u({key:`completeReg ${i.toString(n)}`,padding:{top:e/2}},n?this.renderHaveValidRequests(t):this.renderNoValidRequests())},this.prototype.renderHaveValidRequests=function(t){let e,n,r,o,s;return({isNewUser:e}=this.authenticationState),({gridSize:n}=this.viewState),r=(()=>{switch(!1){case!/log.*in/i.test(t):return"By logging in to";case!/regist/i.test(t):return"By registering with"}})(),[v({label:`Enter the code we emailed you to ${i.toString(e?"finish":"log in")}:`,value:"",placeholder:"xxx-xxx",valueChanged:this.codeChanged,submit:this.authenticateUser,submissionValidRegexp:A,autocapitalize:!1,autocomplete:!1,autocorrect:!1,spellcheck:!1}),this.resendOk?c({clip:!0,animators:{size:{toFrom:{h:0}}},childrenMargins:n/2,padding:{v:n,right:-n/2}},"row","parentWidthChildrenHeight","childrenCenterCenter",p(h.smallText,"parentWidthChildrenHeight",{text:"Didnt get email? Search for zo login in your email and check your spam folder.",color:d.black.secondary}),b({icon:"redo",radius:100,size:{h:this.viewState.buttonSize,wcw:1},key:"resendButton",action:this.submitEmail,text:"send new code"})):void 0,r?c("parentWidthChildrenHeight","column","childrenCenterCenter",{key:"eulaMessage",padding:{top:n/2}},p(h.tinyText,"childrenSizeMaxParentWidth",{color:d.black.secondary,text:`${i.toString(r)} Imikimi Zo, you agree to the Imikimi`}),c("childrenSize","row",p(o=[h.tinyText,"pointerCursor","textCenterCenter",{size:{wcw:1,h:2*n},color:w.primary}],{text:"community guidelines",on:{pointerClick:()=>_(E.community)}}),p(s=[[h.tinyText,{color:d.black.secondary}],{size:{wcw:1,h:2*n}},"textCenterCenter"],{text:", "}),p(o,{text:"terms of use",on:{pointerClick:()=>_(E.terms)}}),p(s,{text:" and "}),p(o,{text:"privacy policies",on:{pointerClick:()=>_(E.privacy)}}))):void 0,x({text:this.authenticating?"Verifying...":t,disabled:!(this.authenticating||this.codeIsValid&&(!e||this.displayNameIsValid)),action:this.authenticateUser,helpMessage:f(e&&!this.displayNameIsValid?m.auth.aboutDisplayNameMessage:m.auth.aboutCodesMessage,{codeExpiresIn:P(C.authenticationRequest.authenticationExpirationSeconds,!0)})})]},this.getter({codeIsValid:function(){return A.test(this.code)},isNewUser:function(){return this.authenticationState.isNewUser}}),this.stateFields({message:null}),this.prototype.showMessage=function(t){return this.message=t},this.prototype.render=function(){let t,e,n,r,o,s,a,l,f,g,y,S,b,w,P,C,_,E,A,F,B,R,z;return t=(A=this.props).tip,e=A.addEmail,n=A.prompt,r=A.emailPlaceholder,o=A.heading,s=A.info,a=A.padding,l=(F=this.authenticationState).isNewUser,f=F.openRequests,g=F.currentRequestEmail,y=F.didYouMean,S=F.errorMessage,b=(B=this.viewState).gridSize,w=B.buttonSize,R=this,P=this.message,C=this.editingEmail,this.switching=!1,_={axis:{duration:.5,on:E={start:this.setIsAnimating,done:this.clearAnimating}}},c("parentWidthChildrenHeight",{padding:a,animators:{size:{toFrom:{ww:1,h:0},duration:.5,on:E},clip:{toFrom:!0}}},c("parentWidthChildrenHeight","column",o&&p(h.largeBoldText,"parentWidthChildrenHeight","textCenterCenter",{color:d.black.secondary,margin:2*b,text:o}),s&&T({text:s}),this.referrer?this.renderReferrer():void 0,v({disabled:this.authenticationState.requestAuthenticationStatus===k,label:n,value:this.email,placeholder:r,valueChanged:this.emailValueChanged,submit:this.submitEmail,textInputType:"email",autocomplete:"email"}),C?x({key:'submit email next button"',action:this.emailIsValid&&this.submitEmail,disabled:this.authenticationState.requestAuthenticationStatus===k,helpMessage:m.auth.aboutEmailMessage}):this.props.addEmail?this.renderCompleteRegistration("add email address"):u({key:"post email prompt group",padding:{top:b/2}},p(h.largeBoldText,"parentWidthChildrenHeight",{padding:{v:b},text:l?"Welcome to Imikimi Zo!":"Welcome back!"}),l?this.renderNewUser():this.renderCompleteRegistration("log in")),S||P||y?I({action:y?()=>(this.models.authenticationState.clearMessages(),this.setEmailValue(y)):void 0,message:null!=(z=null!=S?S:P)?z:y?`Did you mean ${i.toString(y)}`:void 0,isErrorMessage:null!=S,clearMessage:this.clearMessage}):void 0),this.authenticationState.requestAuthenticationStatus===k?M():void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(810).mergeWithSelf(n(805),n(909)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(295)).includeInNamespace(n(910)).addModules({ChapterColorEditor:n(919),Dashboard2:n(920),Dashboard3:n(923),Dots:n(924),FocusEditor:n(925),FollowedUserWhatsNew:n(926),HomeButtonBar:n(927),InlineFlagOptions:n(928),InlineShare:n(929),ListItemWithDefault:n(930),MiniStreamSlideshow:n(931),MiniTopic:n(932),MiniUser:n(933),NewsHomeView:n(934),NewsPostView:n(935),PostInfo:n(936),PostMessages:n(937),ProfileRingPreview:n(939),SecondaryToolbar:n(940),ShowMessage:n(938),SimpleStreamCard:n(921),SimpleStreamCardForPost:n(941),SimpleStreamList:n(922),StandardImport:n(913),StartReferral:n(942),TabBar:n(943),TagList:n(944),TopicBrowserWrapper:n(945),TopicSelector:n(946),Welcome:n(947),WelcomeExpiredUser:n(948)}),n(911),n(914)},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(307).merge(n(805),n(911),n(914)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(296)).addModules({PostActions:n(912)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","TextPalette","getPostForeground","ImikimiStyles","Element","AnimatedIconTextButton","ImikimiPalette","TextElement","Icons","pluralize","photoDownloadOk"],[e,n(913)],(t,e,r,o,s,a,l,u,c,h,p,d)=>{let f,m;return f=2,m=10,i.defClass(class PostActions extends t{},function(t,f,m){let g;this.subscriptions("viewState.viewState","post","currentSession.currentUserId",{followingTopic:g=function({post:t}){return i.exists(t)&&t.topicId},topicFollower:function({post:t}){let e;return t&&(e=n(134).session.data.userId)?{userId:e,topicId:t.topicId}:void 0},topic:g}),this.stateFields({wasFollowing:!1}),this.getter({isSubscribed:function(){let t;return i.exists(t=this.topicFollower)&&t.subscribed}}),this.prototype.showMessages=function(){return this.models.navState.showMessages(this.post)},this.prototype.share=function(){return this.models.navState.showSharePost(this.post)},this.prototype.savePhoto=function(){return this.models.share.savePhoto(this.post)},this.prototype.showTopicSettings=function(){return this.models.navState.showTopicSettings(this.post)},this.prototype.toggleFollowing=function(){let t;return this.models.followingTopic.toggleFollowing(i.exists(t=this.post)&&t.topicId)},this.prototype.preprocessState=function(t){return t.followingTopic?e(m.preprocessState.apply(this,arguments),{wasFollowing:!0}):m.preprocessState.apply(this,arguments)},this.prototype.render=function(){let t,e,n,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U;return O=this,t=this.post,e=this.topic,n=this.currentUserId,f=(L=this.props).size,m=L.padding,g=L.chapterPost,y=L.foregroundColor,v=void 0!==(D=L.iconScale)?D:.75,S=L.divider,b=void 0!==(N=L.color)?N:r.white.primary,w=L.tight,x=L.compact,P=L.height,C=L.backgroundColor,_=L.shadow,E=(U=this.viewState).isTouchScreen,T=U.gridSize,k=U.buttonSize,I=U.fullScreen,M=null!=n&&n===(i.exists(t)&&t.userId),A=null!=n&&n===(i.exists(e)&&e.userId),F=e,y||(y=o(g)),null!=P||(P=k),B=!x,R={height:P,iconScale:v,color:b,hoverColor:y,backgroundColor:C,tight:w},_&&(R.shadow=s.tinyShadow),z=T,a("row",{size:w?{wcw:1,h:P}:{ww:1,h:P}},F&&a("childrenSize",l(R,{iconScale:this.isSubscribed?.66:.75,key:"follow",icon:!this.followingTopic&&this.wasFollowing?"brokenHeart":"heart",action:this.toggleFollowing,label:B&&(this.followingTopic?"following":"follow"),iconColor:this.followingTopic&&u.red,backgroundIcon:this.isSubscribed?c(h.mail,R,{inFlow:!1,color:"white"},"childrenSize","centerCenter"):void 0})),l(R,{key:"comments",icon:"bubble",action:this.props.commentAction||this.showMessages,count:!B&&i.exists(t)&&t.activityCount,label:B?(i.exists(t)&&t.activityCount)>0?p(t.activityCount,"comment"):"comments":void 0}),l(R,{key:"share",icon:"export",action:this.share,label:B?"share":void 0}),I&&d(e,t)?l(R,{key:"save",icon:"download",action:this.savePhoto}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(810).mergeWithSelf(n(805)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(297)).addModules({PaginatedSearchResults:n(915),PostSearchResult:n(916),PostSearchSection:n(917),SearchSection:n(918)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","max","Element","TabButton","TextStyles","TextPalette","merge"],[e,n(913)],(t,e,n,r,o,s,a)=>{return i.defClass(class PaginatedSearchResults extends t{},function(t,l,u){this.subscriptions("viewState.viewState"),this.stateFields({currentPage:0,pageSize:30}),this.prototype.preprocessProps=function({pageSize:t}){return t&&this.setState({pageSize:t}),u.preprocessProps.apply(this,arguments)},this.propFields("renderPage","renderItem","padding","results"),this.prototype.scrollTop=function(){let t;return i.isF((t=this.props).scrollTop)&&t.scrollTop()},this.prototype.nextPage=function(){return this.scrollTop(),this.currentPage++},this.prototype.prevPage=function(){return this.scrollTop(),this.currentPage=e(0,this.currentPage-1)},this.getter({gridSize:function(){return this.viewState.gridSize},startShowIndex:function(){return this.currentPage*this.pageSize},endShowIndex:function(){return(this.currentPage+1)*this.pageSize},haveNextPage:function(){let t;return this.endShowIndex<(i.exists(t=this.results)&&t.length)},havePrevPage:function(){return this.currentPage>0},selectedItems:function(){let t;return i.exists(t=this.props.results)&&t.slice(this.startShowIndex,this.endShowIndex)}}),this.prototype.renderPaginator=function(){let t,e,a,l,u;return u=this,t=this.haveNextPage,e=this.havePrevPage,a=this.gridSize,t||e?n({size:{ww:1,h:this.viewState.buttonSize}},["row","childrenCenterCenter"],r({disabled:!e,margin:a,icon:"angleDoubleLeft",size:l={hh:1,w:7*a},radius:100,action:this.prevPage}),r(o.smallText,{size:l,color:s.black.secondary,text:`page ${i.toString(this.currentPage+1)}`,action:()=>this.currentPage=0,radius:100}),r({disabled:!t,margin:a,icon:"angleDoubleRight",size:l,radius:100,action:this.nextPage})):void 0},this.prototype.renderCurrentPage=function(){let t,e,r,o,s;return s=this,t=this.renderPage,e=this.selectedItems,r=this.gridSize,o=this.renderItem,t?t(a(this.viewState,{items:e,key:this.currentPage})):n("parentWidthChildrenHeight","flow","topCenter",{key:this.currentPage,childrenMargins:r},i.array(e,t=>o(t)))},this.prototype.render=function(){return n(["column","parentWidthChildrenHeight"],{padding:this.padding},this.renderCurrentPage(),this.renderPaginator())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","Element","TextPalette","ShowMedia","ColorFadeOverlay","getPostBackground","TextStyles","TextElement","getPostTitle","getShortDisplayName","nicePluralize","humanDurationString","toSeconds","dateAgeString","Icons"],[e,n(913)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{return i.defClass(class PostSearchResult extends(t(e)){},function(t,e,y){this.subscriptions({ageString:function({post:t}){return i.exists(t)&&t.createdAt},topic:function({post:t}){return t&&!t.topic?t.topicId:void 0},user:function({post:t}){return t&&!t.user?t.userId:void 0}}),this.prototype.action=function(){return this.models.navState.showPost(this.props.post)},this.prototype.render=function(){let t,e,y,v,S,b,w,x,P,C,_,E;return C=this.props,t=C.post,e=C.small,y=null!=(_=this.user)?_:t.user,v=null!=(E=this.topic)?E:t.topic,S=t.templateUseCount,b=t.templateFile?"kimi":"post",({ageString:w}=this),e&&(x=i.exists(w)&&w.match(/\d{4}$/))&&(w=x[0]),n(this.props,"pointerCursor",{on:this.pointerHandlers},n("centerCenter",{cacheDraw:!0,scale:this.pointerIsDown?.95:this.hover?1.025:1,animators:{scale:{duration:.1,easingFunction:"easeInQuad"},draw:!0},draw:[{rectangle:{radius:5},clip:!0},"children",{outline:r.black.barely}]},o({post:t,mediaSize:"auto"}),this.props.noOverlay?void 0:s({fadeSize:2,color:P=a(t)},n(["parentWidthChildrenHeight","column"],{padding:1*l.tinyText.fontSize/2,childrenMargins:1*l.tinyText.fontSize/2},n(["parentWidthChildrenHeight","row","childrenBottomRight"],{childrenMargins:l.tinyText.fontSize/4},u(l.tinyBoldText,"parentWidthChildrenHeight",{text:"post"===b?c(t):h(y),maxLines:1,overflow:"",color:r.white.primary}),u(l.bittyText,"childrenSize",{text:(()=>{switch(b){case"kimi":return`${i.toString(S?p(S,"use",!0):"")} in ${i.toString(d(f()-t.createdAt,!0))}`;default:return m(t.createdAt)}})(),color:r.white.secondary})))),i.exists(v)&&v.private?n("topRight",{size:35,draw:{padding:2,rectangle:{radius:35},fill:P}},u(g.private,"parentSize",{fontSize:18,align:.5,color:r.white.secondary})):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","layoutPostsWithDynamicAspectRatios","max","PostSearchResult","PaginatedSearchResults"],[e,n(913),{PostSearchResult:n(916),PaginatedSearchResults:n(915)}],(t,e,n,r,o,s)=>{return i.defClass(class PostSearchSection extends t{},function(t,a,l){this.prototype.renderPage=function({key:t,gridSize:s,viewWidth:a,items:l}){return e({key:t},"parentWidthChildrenHeight",i.array(n({posts:l,gridSize:s,margin:s,width:a-s,rowAspectRatio:r(4/3,a/300),minAspectRatio:.8}),t=>o(t,{key:t.post.key,small:a<=450})))},this.prototype.render=function(){return s(this.props,{renderPage:this.renderPage,padding:0})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","max","ImikimiPalette","pipelines","nicePluralize","commaize","Element","TabbedSection","merge","TabButton","TextStyles","TextPalette"],[e,n(913)],(t,e,n,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class SearchSection extends t{},function(t,d,f){this.subscriptions("viewState.viewState"),this.stateFields({currentPage:0,pageSize:30}),this.prototype.preprocessProps=function({pageSize:t}){return t&&this.setState({pageSize:t}),f.preprocessProps.apply(this,arguments)},this.propFields({results:[]}),this.prototype.scrollTop=function(){let t;return i.isF((t=this.props).scrollTop)&&t.scrollTop()},this.prototype.nextPage=function(){return this.scrollTop(),this.currentPage++},this.prototype.prevPage=function(){return this.scrollTop(),this.currentPage=e(0,this.currentPage-1)},this.getter({startShowIndex:function(){return this.currentPage*this.pageSize},endShowIndex:function(){return(this.currentPage+1)*this.pageSize},haveNextPage:function(){return this.endShowIndex<this.results.length},havePrevPage:function(){return this.currentPage>0},selectedItems:function(){return this.props.results.slice(this.startShowIndex,this.endShowIndex)}}),this.prototype.render=function(){let t,e,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z;return t=(A=this.viewState).gridSize,e=A.buttonSize,F=this,d=this.selectedItems,f=this.haveNextPage,m=this.havePrevPage,g=(B=this.props).icon,y=B.results,v=B.padding,S=B.renderPage,b=B.action,w=B.secondQueryFound,x=B.title,P=B.details,C=B.renderItem,_=B.searchParams,E=B.totalFound,T=B.kind,k=void 0!==(R=B.iconColor)?R:n.primary,I=void 0!==(z=B.defaultLimit)?z:r.postSearch.defaultLimit,null==x&&(x=T,0===E&&w>0?(E=w,w=0):i.exists(_)&&_.trending&&(x=`trending ${i.toString(x)}`),x=o(null!=E?E:y.length,x),w>0&&(x+=` in ${i.toString(s(w))} matches`)),a(["column","parentWidthChildrenHeight"],{padding:null!=v?v:{h:t}},l({tabs:{label:{title:x,details:P,icon:g,action:b}}}),S?S(u(this.viewState,{items:d,key:this.currentPage})):a("parentWidthChildrenHeight","flow","topCenter",{key:this.currentPage,childrenMargins:t},i.array(d,t=>C(t))),f||m?a({size:{ww:1,h:e}},["row","childrenCenterCenter"],c({disabled:!m,margin:t,icon:"angleDoubleLeft",size:M={hh:1,w:7*t},radius:100,action:this.prevPage}),c(h.smallText,{size:M,color:p.black.secondary,text:`page ${i.toString(this.currentPage+1)}`,action:()=>this.currentPage=0,radius:100}),c({disabled:!f,margin:t,icon:"angleDoubleRight",size:M,radius:100,action:this.nextPage})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","TextPalette","TextInputElement","rgbColor","merge","getColorPalette","getPostColors","MenuSectionGroup","MenuSection","MenuMarkdown","getIsChapterStart","getIsCoverPhoto","getPostAspectRatio","ShowMedia","StreamHeading","AnimatedIconTextButton","LoadingOverlay"],[e,n(913),n(576)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b)=>{let w;return w=i.defClass(class ColorPicker extends t{},function(t,l,u){let c;c=function(t){return t.x/6},this.prototype.render=function(){let t,l,u,h,p,d;return t=(d=this.props).gridSize,l=d.colors,u=d.selectedColor,h=d.text,p=d.maxPerceptualLightness,e({padding:{v:t}},["row","parentWidthChildrenHeight"],h&&n(r.mediumText,{padding:{top:t/2},size:{w:9*t,hch:1},text:h}),e(["column","parentWidthChildrenHeight"],{childrenMargins:t/2},e(["flow","parentWidthChildrenHeight"],i.array(l,(t,n)=>{let i;return i=a(t),null==p||i.perceptualLightness<=p?(t=>{let n;return n=t.toString()===u.toString(),e({size:c,on:{pointerClick:()=>this.props.action(t)},cursor:"pointer",draw:[{color:t},{color:n?"white":"#fff0",rectangle:{radius:100},padding:10}],animators:"draw"})})(i):void 0})),e(["row","parentWidthChildrenHeight"],{size:{h:2*t}},e({draw:{radius:t/2,fill:u}},n(r.smallText,{color:o.white.primary,text:"example text"},"textCenterCenter","parentSize")),s(r.mediumMonospaceText,"parentSize","textCenterRight",{value:u.hexString,on:{enter:({target:{value:t}})=>this.props.action(a(t).withAlpha(1))}}))))}}),i.defClass(class ChapterColorEditor extends t{},function(t,n,r){let s;this.subscriptions("viewState.viewState","post",{topic:function({topic:t,post:e,topicId:n}){let r;return null!=(r=null!=n?n:i.exists(t)&&t.id)?r:i.exists(e)&&e.topicId},user:function({user:t,post:e,userId:n}){let r;return null!=(r=null!=n?n:i.exists(t)&&t.id)?r:i.exists(e)&&e.userId}}),this.stateFields({foreground:void 0,background:void 0}),this.propFields({colorInfo:null}),this.prototype.preprocessState=function(t){let e;return l(r.preprocessState.apply(this,arguments),i.exists(e=t.post)&&e.colors)},this.prototype.setForegroundColor=function(t){return this.save({foreground:t,background:t.eq(this.background)?this.foreground:this.background})},this.prototype.setBackgroundColor=function(t){return this.save({background:t,foreground:t.eq(this.foreground)?this.background:this.foreground})},this.prototype.save=function(t){return this.setState(t),this.models.post.update({key:this.props.post.id,data:{colors:i.object(t,t=>t.toString(),t=>null!=t)}})},this.prototype.preprocessProps=function(t){let e,n;return({post:e,colorInfo:n}=t),e||n?l(t,u(t)):t},s=function(){},this.prototype.render=function(){let t,n,i,r,a,l,u,x,P,C,_;return({topic:t,foregroundColors:n,backgroundColors:i}=this.props),({gridSize:r}=this.viewState),({colorInfo:a,post:l}=this),({foreground:u,background:x}=c(l)),P={post:l,foreground:u},C=.8*r,_=o.white.primary,h(p(d({text:f(l)?"Chapter colors set the foreground and background colors for all non-cover-photo posts in this chapter.":m(l)?"Cover-photo colors set the foreground and background colors for this post only. This does not affect the colors of other posts.":"Changing this post's colors will only have an affect if you change it to a chapter-start or cover-photo post."})),a&&p({label:"Chapter Color Preview"},e("column","parentWidthChildrenHeight",e("parentWidthChildrenHeight",{draw:x.withScaledLightness(.5),padding:1<g(this.post)?{v:2*r}:{h:2*r}},y({post:this.post,size:{ww:1,hw:1/g(this.post)}})),e({draw:x,padding:r,childrenMargins:r},"parentWidthChildrenHeight","row",v({chapterPost:this.post,topic:this.topic,post:this.post}),e(["column","childrenCenterCenter"],"parentHeightChildrenWidth",S({icon:"heart",text:"example",tight:!0,action:s,iconScale:.75,hoverColor:u,background:u}),S({icon:"bubble",tight:!0,text:"example",iconScale:.75,action:s,hoverColor:u}))))),a&&p({label:"Chapter Colors"},e({size:"parentWidthChildrenHeight",childrenLayout:"column"}),a&&w({text:"Background",gridSize:r,colors:i,selectedColor:x,action:this.setBackgroundColor}),a&&w({text:"Foreground",gridSize:r,colors:n,selectedColor:u,action:this.setForegroundColor})),!a&&b())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pending","Promise","pipelines","success","merge","failure","min","Element","TabbedSection","ImikimiPalette"],[e,n(913),{SimpleStreamCard:n(921)}],(t,e,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class Dashboard2 extends t{},function(t,d,f){let m,g;this.subscriptions("viewState.viewState","navState.currentChannelId","currentSession.currentSession",{topicMembershipsByUserId:function({currentUser:t}){return i.exists(t)&&t.id},currentChannelTopics:{model:"channelTopicsByChannelId",key:m=function({channelId:t,currentUser:e}){return t||i.exists(e)&&e.defaultChannelId}}}),this.stateFields({recentActivity:[],recentActivityStatus:e,showAll:!1,showStreams:!1,currentStreamTab:"followingPeople",topics:[],currentChannelTopics:null}),this.getter({followingPeopleCount:function(){let t,e;return(t={})[this.currentSession.currentUserId]=!0,e=0,i.each2(this.currentChannelTopics,({topic:n})=>t[n.userId]?void 0:(t[n.userId]=!0,e++)),e}}),g=!1,this.prototype.preprocessState=function(t){let e,n,u,c,h,p,d;return e=t.recentActivityStatus,({currentChannelId:n,topicMembershipsByUserId:u,currentChannelTopics:c,currentSession:h}=t),p=h.currentUserId,c&&i.find(c,null,({topic:t})=>!t)&&(r.all(i.array(c,t=>t.topic?t:o.topic.get(t.topicId).then(e=>a(t,{topic:e})))).then(this.setCurrentChannelTopics),c=null),c&&u&&(u!==this.topicMembershipsByUserId||c!==this.currentChannelTopics)&&(d=i.object(c,({topic:t})=>t,({topic:t})=>t,null,({topic:t})=>t.id),r.all(i.array(u,({topicId:t})=>o.topic.get(t),({topicId:t})=>!d[t])).then(t=>(i.array(d,null,null,t),t.sort((t,e)=>e.lastPostCreatedAt-t.lastPostCreatedAt),this.setTopics(t)))),n&&n!==this.currentChannelId&&o.channel.recentActivity(n).then(t=>(this.recentActivity=t,null)).tap(()=>this.recentActivityStatus=s).catch(t=>{let e;return this.recentActivityStatus=null!=(e=i.exists(t)&&t.status)?e:l}),n||(e=s),a(f.preprocessState.apply(this,arguments),{currentChannelTopics:c,recentActivityStatus:e})},this.prototype.render=function(){let t,e,r,o,s,l,d,f,m,y,v,S,b,w,x,P;for(t=(b=this.viewState).gridSize,e=b.viewWidth,r=b.feedWidth,o=b.buttonSize,s=this.followingPeopleCount,({suggestedPadding:l}=this.props),l&&(e-=l.left+l.right),d=u(r,e-t),f=e-2*t,m=1,f-=y=25*t;f>=t+y;)f-=t+y,m++;return v=m*y+(m*t-t),S="followingStreams"===this.currentStreamTab?this.topics:i.array(this.recentActivity,({topic:t,user:e})=>a(t,{user:e})),c("parentWidthChildrenHeight",this.currentSession.currentUserId?(g||(g=!0,this.models.event.create("dashboard:show",{data:{count:this.recentActivity.length}})),c("parentWidthChildrenHeight",["column","childrenTopCenter"],{animators:{size:{toFrom:{ww:1,h:0}},clip:{toFrom:!0}}},h({currentTab:this.currentStreamTab,selectTab:this.setCurrentStreamTab,tabOrder:["followingStreams",s>0?"followingPeople":void 0],tabs:{followingPeople:{title:s>1?`${i.toString(s)} People`:"People",details:"latest from people who's streams you follow",icon:"users"},followingStreams:{title:(i.exists(w=this.topics)&&w.length)>1?`${i.toString(i.exists(x=this.topics)&&x.length)} Streams`:"Streams",details:`latest from streams you follow ${i.toString((i.exists(P=this.topicMembershipsByUserId)&&P.length)>0?"or participate in":void 0)}`,icon:"heart",iconColor:p.red}}}),c({visible:"followingStreams"===this.currentStreamTab},"parentWidthChildrenHeight",n(922)({key:"followingStreams",showRows:this.props.showRows,topics:this.topics})),c({visible:"followingPeople"===this.currentStreamTab},"parentWidthChildrenHeight",n(922)({key:"followingPeople",showRows:this.props.showRows,topics:i.array(this.recentActivity,({topic:t,user:e})=>a(t,{user:e}))})))):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Bitmap","rect","ImikimiStyles","FluxComponent","PointerActionsMixin","Element","ShowMedia","rgbColor","merge","StreamHeading","getIsCoverPhoto","getPostBackground","MarkdownView","point","bound","PrivateStreamBadge","BitmapElement","vertical"],[e,n(913)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S)=>{let b,w,x,P;return b=n(823),(w=new t(128)).drawRectangle(null,x=e(w.size),{colors:r.sineGradient("#fff","#fff0"),from:x.centerCenter,to:x.centerRight,radial:!0}),w.toImage().then(function(e){return w=new t(e)}),P=i.defClass(class PreloadPosts extends o{},function(t,e,n){this.subscriptions({postsByTopicIdDesc:function({topic:t,all:e}){return e&&i.exists(t)&&t.id},topic:function({topic:t}){return i.exists(t)&&t.id}}),this.prototype.render=function(){return a({size:0,inFlow:!1})}}),i.defClass(class SimpleStreamCard extends(s(o)){},function(t,n,o){this.subscriptions("viewState.gridSize","user",{topic:function({post:t,topicId:e}){return null!=e?e:i.exists(t)&&t.topicId},chapterPost:function({topic:t}){return i.exists(t)&&t.lastChapterPostId},post:function({post:t,postId:e,topic:n}){let r,o;return null!=(r=null!=(o=i.exists(t)&&t.id)?o:e)?r:i.exists(n)&&n.lastPostId}}),this.stateFields({hoverLocation:null,mouseLocation:null}),this.getter({width:function(){let t;return null!=(t=this.props.width)?t:25*this.gridSize},post:function(){let t,e;return null!=(t=this.state.post)?t:i.exists(e=this.topic)&&e.lastPost},user:function(){let t,e;return null!=(t=this.state.user)?t:i.exists(e=this.topic)&&e.user},small:function(){return this.width<16*this.gridSize},headingPadding:function(){return this.small?2*this.gridSize/3:this.gridSize}}),this.prototype.action=function(){let t;return this.models.event.create("dashboard:click",{data:{topic:this.topic}}),this.models.navState.showPost(i.exists(t=this.post)&&t.id)},this.prototype.renderMedia=function(){let t,e,n;return n=this,t=this.gridSize,e=this.post,a("centerCenter",{padding:.15*-t,animators:"location",location:{ps:.5,x:this.hoverLocation&&this.hover?-.15*t*this.hoverLocation.x:0,y:this.hoverLocation&&this.hover?-.15*t*this.hoverLocation.y:0}},l({post:e,mediaSize:"large"}))},this.prototype.renderCoverPhoto=function(){let t,n,i,o;return o=this,t=this.gridSize,n=this.post,i=u(0,0,0,.5),a(this.renderMedia(),a("parentWidthChildrenHeight","bottomLeft",{animators:"draw",draw:{rectangle:t=>e({w:t.x,h:1.5*t.y,y:.5*-t.y}),fill:c({colors:r.sineGradient(i.withAlpha(0),i,20,-1/3),from:"topLeft",to:"bottomLeft"})},padding:this.headingPadding},this.renderHeading()))},this.prototype.renderHeading=function(){return h({topic:this.topic,post:this.post,chapterPost:this.chapterPost,small:this.small,shadow:p(this.post),smallText:!0,showPostDate:!0,showPostTitle:!!this.post.mediaFile,showPostCount:!!this.post.mediaFile})},this.prototype.renderTextOnly=function(){let t,e,n;return n=this,t=this.gridSize,e=this.post,[a("parentWidthChildrenHeight",{draw:d(this.chapterPost),padding:this.headingPadding},this.renderHeading()),f({padding:t,small:!0,preview:!0,text:this.post.caption})]},this.prototype.renderNormal=function(){let t,e,n;return n=this,t=this.gridSize,e=this.post,[this.renderMedia(),a("parentWidthChildrenHeight",{draw:d(this.chapterPost),padding:this.headingPadding},this.renderHeading())]},this.prototype.mouseMove=function({location:t,target:{currentSize:e}}){let n,i;return({x:n,y:i}=this.mouseLocation=t),this.hoverLocation=m(2*(g(0,n/e.x,1)-.5),2*(g(0,i/e.x,1)-.5))},this.prototype.pointerDownHandler=function(t){return this.mouseMove(t),o.pointerDownHandler.apply(this,arguments)},this.prototype.pointerMove=function(t){return this.mouseMove(t)},this.prototype.customizeKimi=function(){return this.models.navState.customizeKimi(this.post)},this.prototype.render=function(){let t,e,n,i;return i=this,t=this.gridSize,e=this.width,a({size:{w:e,h:n=19*e/25},on:c(this.buttonHandlers,{mouseMove:this.mouseMove,pointerMove:this.pointerMove}),margins:{h:t,v:2*t}},"pointerCursor",this.post&&this.topic?a("column","centerCenter",{location:{ps:.5,x:this.hoverLocation&&this.hover?.35*t*this.hoverLocation.x:0,y:this.hoverLocation&&this.hover?.35*t*this.hoverLocation.y:0},animators:{scale:{duration:.1,easingFunction:"easeInQuad"},location:!0},draw:[{radius:this.small?t/2:t,fill:{color:"white",shadow:{offset:0,blur:25,color:"#0003"}}},"clip","children"],scale:this.pointerIsDown?.975:this.hover?1.025:1},"cacheDraw",(()=>{switch(!1){case!!this.post.mediaFile:return this.renderTextOnly();case!p(this.post):return this.renderCoverPhoto();default:return this.renderNormal()}})(),this.topic.private?y({chapterPost:this.chapterPost}):void 0,this.hover||this.pointerIsDown?P({topic:this.topic,postId:this.props.postId,all:this.pointerIsDown}):void 0,this.hover?a({clip:!0,stage:!1,inFlow:!1},v("centerCenter",{receivePointerEvents:"never",size:2*e,opacity:.2,animators:{opacity:{toFrom:0}},location:this.mouseLocation,bitmap:w,compositeMode:"add"})):void 0,"imikimi"===S&&this.post.templateFile&&this.props.showAddPhotoButton?a({inFlow:!1,padding:t},"topRight","childrenSize",b({shadow:r.tinyShadow,action:this.customizeKimi,pointerEventPriority:1},"topLeft")):void 0):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","max","merge","getTagsFromTopics","filterTopics","min","Math","Element","FilterTextInput","TabButton","SimpleStreamCard"],[e,n(913),{SimpleStreamCard:n(921)}],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class SimpleStreamList extends t{},function(t,p,d){let f;this.subscriptions("viewState.viewState","navState.navState"),this.stateFields({topics:[],filteredTopics:[],filterRegExp:null,showRows:f=2}),this.propFields("topics"),this.getter({minShowRows:function(){let t;return null!=(t=this.props.showRows)?t:2}}),this.prototype.preprocessProps=function(t){let n;return t.showRows>0&&(this.showRows=e(null!=(n=this.showRows)?n:2,t.showRows)),t},this.prototype.applyFilterRegExp=function(t){this.filterRegExp=t},this.prototype.preprocessState=function(t){let e,s;return e=t.filterRegExp,s=this.props.topics,n(d.preprocessState.apply(this,arguments),{topics:i.exists(s)&&s.sort((t,e)=>e.lastPostCreatedAt-t.lastPostCreatedAt),topicTags:r(s),filteredTopics:o(s,e)})},this.prototype.render=function(){let t,e,n,r,o,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M;for(k=this.viewState,t=k.gridSize,e=k.feedWidth,n=k.mainAreaWidth,r=k.mainAreaWidth,o=k.buttonSize,p=k.fullScreen,d=k.landscape,I=this,f=this.topics,m=this.filteredTopics,M=this,g=this.minShowRows,y=this.showRows,v=t,S=t,b=s(e,n-t),w=n-2*v,x=1,w-=P=C=(()=>{switch(!1){case!d:return(r-3*t)/2;case!p:return 22*t;default:return 25*t}})();w>=t+P;)w-=t+P,x++;return _=x*P+(x*t-t),E=((E=(n-2*v-S*(x-1))/x)+C)/2,T=(i.exists(m)&&m.length)>0?a.ceil(m.length/x):2,_=t*(x-1)+E*x,l("parentWidthChildrenHeight",["column","childrenTopCenter"],this.props.beforeChildren?l("column",{size:{hch:1,w:_}},this.props.beforeChildren):void 0,(i.exists(f)&&f.length)>0?l(["flow","topCenter"],{size:{hch:1,w:_},childrenMargins:S,padding:{bottom:t/2}},(i.exists(f)&&f.length)>=3?u({filteredCount:i.exists(m)&&m.length,totalCount:f.length,hideTextInput:this.models.navState.overlayVisible,suggestedTags:this.state.topicTags,applyFilterRegExp:this.applyFilterRegExp}):void 0,i.array(m.slice(0,x*y),t=>h({topic:t,width:E,key:t.id,postId:t.lastPostId}))):void 0,(i.exists(f)&&f.length)>0?l("parentWidthChildrenHeight",["row","childrenCenterCenter"],y>g&&T>g?c({size:{h:o,wcw:1},text:"less",action:()=>this.showRows=g}):void 0,y<T?c({size:{h:o,wcw:1},text:"more...",action:()=>this.showRows+=g}):void 0):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pending","Promise","pipelines","timeout","success","failure","vertical","pluralize","ImikimiPalette","models","present","Element","MarkdownView","TabbedPage","LoadingOverlay"],[e,n(913),{SimpleStreamCard:n(921)}],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y)=>{return i.defClass(class Dashboard3 extends t{},function(t,v,S){let b,w,x,P,C,_,E;this.subscriptions("viewState.viewState","navState.currentChannelId",{followingStreamsSource:{model:"channelTopicsByChannelId",key:b=function({channelId:t,currentUser:e}){return t||i.exists(e)&&e.defaultChannelId}},invitesSource:{model:"topicInvitesByUserId",key:w=function({currentUser:t}){return i.exists(t)&&t.id}},ownStreamsSource:{model:"topicsByUserId",key:w},getStartedPost:{model:"post",key:"VRq6OGpZmqf2"}}),x=["invites","followingStreams","followingPeople","ownStreams","getStarted"],this.stateFields(i.object(x,()=>null)),this.stateFields({loading:!0,followingPeople:[],followingPeopleStatus:e}),P=function(t){return t?r.all(i.array(t,t=>{let e,n,i,r;return e=t.topic,n=t.topicId,i=t.title,r=t.id,i&&r?t:e||o.topic.get(n)})):void 0},C=function(t){return t?r.all(i.array(t,({user:t,userId:e})=>t||o.user.get(e))):void 0},this.prototype.stateChanged=function(t,e){return this.state[e]!==t[e]&&t[e]},this.prototype.preprocessState=function(t){let n,r,u,c,h,p;return!(n=t.currentChannelId)||n===this.currentChannelId&&this.followingPeople||o.channel.recentActivity(n).then(t=>(this.followingPeople=t,null)).tap(()=>this.followingPeopleStatus=a).catch(t=>{let e;return this.followingPeopleStatus=null!=(e=i.exists(t)&&t.status)?e:l}),i.exists(c=P(this.stateChanged(t,"followingStreamsSource")))&&c.then(t=>this.followingStreams=t),i.exists(h=P(this.stateChanged(t,"ownStreamsSource")))&&h.then(t=>this.ownStreams=i.array(t,null,t=>!t.isProfileTopic)),(r=this.stateChanged(t,"invitesSource"))&&P(i.array(r,null,t=>o.topicInvite.inviteIsOutstanding(t))).then(t=>this.invites=t),(u=t.followingStreamsSourceStatus===e||i.exists(p=this.props.currentUser)&&p.defaultChannelId&&!t.followingStreams||t.ownStreamsSourceStatus===e||!t.ownStreams)||s(500,this.clearLoading),S.preprocessState.apply(this,arguments)},_=function(){return"imikimi"===u?2:4},E={invites:function(t){return{title:"Invites",icon:"ticket",details:"you have been invited to join these streams",children:n(922)({topics:t,showRows:_()})}},followingPeople:function(t){return{title:"People",icon:"users",details:`latest from ${i.toString(c(t.length,"people"))} who's streams you follow`,children:n(922)({topics:i.array(t,({topic:t})=>t),showRows:_()})}},followingStreams:function(t){return{title:"Following",icon:"heart",details:`latest from ${i.toString(c(t.length,"stream"))} you follow`,children:n(922)({topics:t,showRows:_()}),iconColor:h.red}},ownStreams:function(t,{viewState:e}){return{title:"Your Streams",icon:"book",details:`your ${i.toString(c(t.length,"stream"))}`,tabButton:{iconScale:.7,icon:"search",action:()=>p.navState.searchWithinUserId(p.currentSession.currentUserId),text:"search your streams"},children:n(922)({topics:t,showRows:_()})}},getStarted:function(t,e){let n,r;return{title:"Get Started",details:"tips to help you get started",icon:"magicWand",children:d(i.exists(r=e.getStartedPost)?n=r.caption:void 0)?f("topCenter",{size:{hch:1,ww:1,max:{w:700}}},m({large:!0,text:n,includeTags:!0})):void 0}}},this.prototype.render=function(){let t;return t={size:this.props.size},f("top"===this.viewState.tabBar?{padding:{top:this.viewState.gridSize/2}}:void 0,t,f({visible:!this.loading},t,g(t,{suggestedPadding:this.props.suggestedPadding,tabOrder:x,tabs:i.object(x,t=>E[t](this.state[t],this.state),t=>{let e;return"getStarted"===t||(i.exists(e=this.state[t])&&e.length)>0})})),this.loading?f(y()):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","min","TextStyles","TextPalette","ButtonWrapper","Element","TextElement","rect"],[e,n(913)],(t,e,n,r,o,s,a,l)=>{let u,c,h,p;return u=15,c=5,h=5,p=10,i.defClass(class Dots extends t{},function(t,u,c){this.subscriptions("viewState.gridSize"),this.stateFields({hover:!1}),this.prototype.render=function(){let t,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C;for(t=this.gridSize,u=(b=this.props).hoverColor,c=b.chapterNumber,h=b.numChapters,p=b.currentPostIndex,d=b.numPosts,f=e(f=5,d);d%f==1&&f<10;)f++;return g=p-(m=(p/f|0)*f),y=e(f,d-m),v=12.5,this.hover&&(S=[n.tinyText,"parentSize",{animators:{opacity:{toFrom:0}},padding:{h:3*t/4},color:r.white.secondary}]),o("parentWidthChildrenHeight",{action:this.props.action,hoverColor:u,padding:{h:t/2},hoverAction:this.setHover,axis:"centerCenter",radius:100,location:{xw:.5,yh:1,y:-t}},s("topCenter",{animators:{draw:!0},size:{h:30,w:15*(f+1)},draw:(w=[],x=f,P=0,C=P<x?1:-1,(()=>{for(;C>0&&P<x||C<0&&P>x;){let t;t=P,w.push([l(15*t+12.5,12.5,5,5),"circle",(()=>{switch(!1){case!(t===g):return r.white.primary;case!(t>=y):return"#fff1";default:return r.white.secondary}})()]),P+=C}})(),w)}),this.hover&&h>1?a("textCenterLeft",S,{text:`chapter ${i.toString(c)} / ${i.toString(h)}`}):void 0,this.hover?a("textCenterRight",S,{text:`post ${i.toString(p+1)} / ${i.toString(d)}`}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","getPostColors","TextPalette","MenuSectionGroup","MenuSection","Element","ShowMedia","MenuInfo"],[e,n(913)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class FocusEditor extends t{},function(t,u,c){this.subscriptions("viewState.viewState",{topic:function({topic:t,post:e,topicId:n}){let r;return null!=(r=null!=n?n:i.exists(t)&&t.id)?r:i.exists(e)&&e.topicId},user:function({user:t,post:e,userId:n}){let r;return null!=(r=null!=n?n:i.exists(t)&&t.id)?r:i.exists(e)&&e.userId}}),this.stateFields({focus:null,foregroundColor:null,backgroundColor:null}),this.propFields({post:{}}),this.prototype.setForegroundColor=function(t){return t.eq(this.backgroundColor)&&this.setState({backgroundColor:this.foregroundColor}),this.setState({foregroundColor:t})},this.prototype.setBackgroundColor=function(t){return t.eq(this.foregroundColor)&&this.setState({foregroundColor:this.backgroundColor}),this.setState({backgroundColor:t})},this.prototype.getInitialState=function(){let t,n,i,r;return({post:t}=this),({focus:n}=t),({foregroundColor:i,backgroundColor:r}=e(t)),{focus:n,backgroundColor:r,foregroundColor:i}},this.prototype.setAndSaveFocus=function(t,e){let n,i;return({x:n,y:i}=this.focus=t),e?void 0:this.models.post.update({key:this.post.id,data:{focus:t?{x:n,y:i}:void 0}})},this.prototype.render=function(){let t,e,i,u,c,h,p,d,f,m;return({post:t,topic:e}=this),({buttonSize:i,gridSize:u}=this.viewState),({foregroundColor:c,focus:h,backgroundColor:p}=this.state),d={focus:h,post:t,focusChanged:this.setAndSaveFocus,focusEditMode:!0,borderColor:"#0002",foregroundColor:c},f=.8*u,m=n.white.primary,r(e.isProfileTopic&&o({label:"Profile Focal-point Preview",key:"set focus"},s(["parentWidthChildrenHeight","row","center"],{padding:{v:u}},s({size:12*u,draw:{rectangle:{radius:1e3},clip:!0}},a(d,{size:12*u,radius:1e3})))),o({label:"Portrait and Landscape Focus Preview",key:"set focus"},s("row",{size:{h:2*u+23*u*.75*(4/6)},childrenMargins:u,padding:{v:u/2}},a(d,{size:{w:23*u*2/6}}),a(d,{size:{w:23*u*4.25/6}}))),o({label:t.isCoverPhoto?"Cover Photo Focus Preview":"Widescreen Focus Preview"},s({size:{h:u/2}}),s(["parentWidthChildrenHeight","column","childrenCenter"],t.isCoverPhoto?{draw:[{radius:{top:u}},"clip"]}:void 0,s({size:{w:27*u,h:8*u},scale:25/27},"topCenter",s("topCenter",a(d))))),o(l({text:"Drag your photo to position it, or tap to set its focal-point."})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","getDisplayCaption","Element","ShowMedia","UserCircle","TextElement","TextStyles","getDisplayTitle","TextPalette","dateAgeString"],[e,n(913)],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class FollowedUserWhatsNew extends(t(e)){},function(t,e,p){this.subscriptions("viewState.viewState","user","topic"),this.prototype.action=function(){return this.models.event.create("dashboard:click",{data:{topic:this.topic}}),this.models.navState.showPost(this.topic.lastPost)},this.prototype.render=function(){let t,e,p,d,f;return({gridSize:t}=this.viewState),e=i.exists(d=this.topic)&&d.lastPost,p=n(e),r({size:{w:null!=(f=this.props.width)?f:20*t,h:7*t},on:this.buttonHandlers},"pointerCursor",r(["row","centerCenter"],{animators:{scale:{duration:.1,easingFunction:"easeInQuad"}},draw:[{radius:t/2,fill:{color:"white",shadow:{offset:0,blur:25,color:"#0001"}}},"clip"],scale:this.pointerIsDown?.95:this.hover?1.025:1},o({size:{wh:1},post:e}),e&&r("column",{padding:{top:t/2,h:t/2,bottom:t/4},childrenMargins:t/2},r("row",{childrenMargins:t/2,size:{h:2*t}},s({size:2*t,user:this.user}),this.user?r(["column","childrenCenterLeft"],{childrenMargins:t/2},a(l.smallBoldText,{text:this.user.displayName+"\n"+u(this.topic),maxLines:2})):void 0,a(l.tinyText,"childrenSize",{text:p,color:c.black.secondary,align:"bottomRight",text:h(e.createdAt)})),a(l.tinyText,{size:"parentSize",padding:t/4,text:i.exists(p)&&p.replace(/\n[ \n]*/,"\n")}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextStyles","Element","min","ButtonWrapper","ImikimiPalette","PosterTextButton","TextElement","TabButton"],[e,n(913)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class HomeButtonBar extends t{},function(t,c,h){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,c,h,p,d,f,m,g,y,v;return t=(v=this.props).buttons,c=v.children,h=v.featureDemoStreamId,p=v.padding,({paddedFeedWidth:d,viewWidth:f,gridSize:m,buttonSize:g}=this.viewState),y={backgroundColor:"#eee",selectedColor:"#fff",backgroundPadding:0,iconScale:1.25,labelBottom:!0,childrenMargins:m/2,labelStyle:e.smallText},n({size:"parentWidthChildrenHeight",padding:p},n({childrenLayout:"column",childrenAlignment:"center",location:"center",axis:"center",childrenMargins:m,size:{hch:1,w:r(d,f-m)}},(i.exists(t)&&t.length)>0?n({childrenLayout:"row",childrenMargins:m/4,size:{ww:1,h:1.75*g}},i.array(t,t=>u(y,t))):void 0,c,o({size:"parentWidthChildrenHeight",action:this.models.posterTextState.tryPosterText,radius:0,hoverColor:s.lightPrimary},n({size:"parentWidthChildrenHeight",draw:{clip:!0,radius:m/2,outline:{color:s.primary,lineWidth:4}}},a({location:"topLeft",simple:!0}),l(e.largeText,{size:"parentSize",align:.5,text:"Try Poster Text 2",color:s.primary})))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","MenuChooseAndConfirm","upperCamelCase","docUrls"],[e,n(913)],(t,e,n,r)=>{let o;return o={users:{},posts:{},messages:{}},i.defClass(class InlineFlagOptions extends t{},function(t,s,a){let l;this.subscriptions("viewState.viewState"),this.stateFields({flagged:!1,confirm:!1,reason:null}),l={user:"egregious or multiple personal attacks\negregious or multiple threatening statements\nrepeated derailing of conversations\nrepeated posting of uncivlized content\nrepeated lack of civility".split("\n"),post:"personal attack\nthreatening images or language\nviolent images\nprofanity or vulgar language\nsexually explicit images\nother uncivilized content".split("\n"),comment:"personal attack\nthreatening language\nprofanity or vulgar language\nother uncivilized language".split("\n")},this.getter({type:function(){let t,e,n;return({postId:t,messageId:e,userId:n}=this.props),(()=>{switch(!1){case!e:return"comment";case!t:return"post";case!n:return"user"}})()}}),this.prototype.flag=function(t){let e,n,i;return({postId:e,messageId:n,userId:i}=this.props),this.models.flag.create({data:{postId:e,messageId:n,userId:i,reason:t}}).then(()=>(this.triggerFlagged(),i&&(o.users[i]=!0),e&&(o.posts[e]=!0),n&&(o.messages[n]=!0)))},this.getter({alreadyFlaggedType:function(){let t,e,n;return({postId:t,userId:e,messageId:n}=this.props),(()=>{switch(!1){case!(n&&o.messages[n]):return"comment";case!(t&&o.posts[t]):return"post";case!(e&&o.users[e]):return"user"}})()}}),this.prototype.render=function(){return e({close:this.props.close,currentUserRequired:!0,icon:"flag"},this.alreadyFlaggedType?{label:`${i.toString(n(this.alreadyFlaggedType))} flagged`,info:`Thank you for reporting this ${i.toString(this.alreadyFlaggedType)}.`}:{options:l[this.type],info:{includeTags:!0,text:`Thank you for reporting inappropriate ${i.toString(this.type)}s. We strive to create\na safe, supportive environment. Please\nhelp us by selecting a specific reason you wish to flag this ${i.toString(this.type)}.\n\nPlease read our community guidelines for more information on appropriate behavior on Imikimi Zo:`},infoLink:{icon:"users",text:"Community guidelines",url:r.community},prompt:"Select flagging reason",action:this.flag,successMessage:"Thank you. Your report has been submitted.",generateConfirmMessage:t=>`Report this ${i.toString(this.type)}'s ${i.toString(t)}`})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pipelines","log","vertical","merge","Promise","timeout","photoDownloadOk","MenuSectionGroup","MenuButton","assetUrl","models","MenuToggle","MenuMarkdown","MenuSection"],[e,n(913)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{return i.defClass(class InlineShare extends t{},function(t,y,v){this.subscriptions("viewState.viewState","currentSession.currentUserId",{topic:function({post:t}){return i.exists(t)&&t.topicId}}),this.propFields({post:{}}),this.stateFields({copied:!1,connonicalUrl:null,whoCanSeeThis:!1,sharePassword:null,sharePostLink:null,shareStreamLink:null,shareStream:!1,shareStatus:null,saveStatus:null}),this.getter({private:function(){let t;return i.exists(t=this.topic)&&t.private},connonicalStreamUrl:function(){return this.topic&&e.topic.getConnonicalUrl(this.topic.id)}}),this.getter({wideButtonProps:function(){return{size:{ww:1,h:3*this.state.viewState.gridSize},backgroundPadding:0,margin:1}}}),this.prototype.preprocessState=function(t){let n,i,a,l,u,c,h;return n=t.topic,i=t.post,a=t.sharePassword,l=t.sharePostLink,u=t.shareStreamLink,c=t.currentUserId,null!=i||(i=this.props.post),n&&i&&(n.private&&!a&&n.userId===c?e.topic.getPrivateSharePassword({key:n.id,returnNullIfMissing:!0}).then(this.setSharePassword):l&&u&&a===this.state.sharePassword||(h=r({params:{sharePassword:a},location:(()=>{switch(o){case"zoStream":return"https://www.zostream.com";case"zoPeople":return"https://www.zopeople.com"}})()}),null!=l||(l=e.post.getConnonicalUrl(i,h)),null!=u||(u=e.topic.getConnonicalUrl(n,h)))),s(t,{sharePostLink:l,shareStreamLink:u})},this.prototype.encodePostMailto=function(){return this.models.share.encodePostMailto(this.post)},this.prototype.sharePostViaEmail=function(){return this.models.share.sharePostViaEmail(this.post)},this.prototype.sharePostOnFacebook=function(){return this.models.share.sharePostOnFacebook(this.post)},this.prototype.sharePostOnPinterest=function(){return this.models.share.sharePostOnPinterest(this.post)},this.prototype.showTopicSettings=function(){return this.models.navState.showTopicSettings(this.post)},this.prototype.nativeShareLink=function(t){return this.models.share.nativeShareLink(null!=t?t:this.post)},this.prototype.nativeSharePhoto=function(){return this.shareStatus="0%",a.then(()=>this.models.share.nativeSharePhoto(this.post,{onProgress:({progress:t})=>this.shareStatus=`${i.toString(100*t|0)}%`})).tap(()=>this.shareStatus="success").tapCatch(()=>this.shareStatus="failed").finally(()=>l(5e3,this.clearShareStatus))},this.prototype.savePhoto=function(){return this.saveStatus="0%",a.then(()=>this.models.share.savePhoto(this.post,{onProgress:({progress:t})=>this.saveStatus=`${i.toString(100*t|0)}%`})).tap(()=>this.saveStatus="success").tapCatch(()=>this.saveStatus="failed").finally(()=>l(5e3,this.clearSaveStatus))},this.getter({havePhoto:function(){let t;return i.exists(t=this.post)&&t.mediaFile||this.props.willHavePhoto},ownPost:function(){let t;return this.currentUserId&&(i.exists(t=this.post)&&t.userId)===this.currentUserId},ownTopic:function(){let t;return this.currentUserId&&(i.exists(t=this.topic)&&t.userId)===this.currentUserId},shareLinkOk:function(){return this.post&&(!this.private||this.ownPost)},downloadOk:function(){return u(this.topic,this.post,this.props.willHavePhoto)}}),this.prototype.renderWebLinkShareOptions=function(t,e){let r,o;return({gridSize:r,buttonSize:o}=this.viewState),c(h({icon:"link",rightText:this.shareStatus,text:t?"Copy Post Link":"Copy Stream Link",action:()=>{let r;return this.shareStatus="copying...",n(848)(e)?(this.models.event.create({key:t?"share:copyPostLink":"share:copyStreamLink",data:{postId:this.post.id,topicId:i.exists(r=this.topic)&&r.id}}),this.shareStatus="copied"):this.shareStatus="failed",l(5e3,this.clearShareStatus)}}),h({action:()=>d.share.shareUrlOnFacebook(e),text:t?"Share Post on Facebook":"Share Stream on Facebook",bitmapIcon:p("share/facebook-256.png")}))},this.prototype.renderShareOptions=function(t){return[this.renderShareLinkActions(!this.shareStream,this.shareStream?this.shareStreamLink:this.sharePostLink),f({text:this.shareStream?"Stream Link":"Post Link",icon:this.shareStream?"book":"bookmarkBook",isOn:this.shareStream,action:this.toggleShareStream}),c({key:`shareInfo${i.toString(this.shareStream)}`},m({text:this.shareStream?"Share a link to this Stream. Visitors will start on the most recent post.":"Share a link directly to this post."})),this.private&&this.sharePassword&&c(m({text:"This link allows visitors to see all posts in this private stream."}))]},this.prototype.renderSharePhoto=function(){return this.viewState.nativeApp&&this.downloadOk&&h({key:"shareImageNative",icon:"image",text:"Share Photo",action:this.nativeSharePhoto,disabled:!this.post,rightText:this.shareStatus})},this.prototype.renderShareLinkActions=function(t,e){return this.viewState.nativeApp?this.shareLinkOk&&h({disabled:!this.post,key:"shareLinkNative",icon:"link",text:`Share ${i.toString(t?"Post":"Stream")} Link`,action:()=>this.nativeShareLink(e)}):this.renderWebLinkShareOptions(t,e)},this.prototype.renderSavePhotoButton=function(){return this.downloadOk&&h({disabled:!this.post,key:"saveToPhotoLibrary",icon:"download",text:"Save Photo",action:this.savePhoto,rightText:this.saveStatus})},this.prototype.render=function(){let t,e,n,i,r,o;return({fullScreen:t,gridSize:e,feedWidth:n,nativeApp:i}=this.viewState),({willHavePhoto:r,showPrivateTopicHelp:o}=this.props),this.post||(o=!1),c(g({label:"share link"},this.private&&!this.ownTopic?m({text:"This is a private stream. Only existing members of this\nstream can use this link."}):void 0,this.renderShareOptions()),this.downloadOk?g({label:"share photo"},this.renderSharePhoto(),this.renderSavePhotoButton()):void 0,this.ownTopic?g({label:"change stream settings and invite people"},h({icon:"menu",text:"Stream Settings",action:this.showTopicSettings})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","TabButton"],[e,n(913)],(t,e,n,r,o)=>{return i.defClass(class ListItemWithDefault extends t{},function(t,s,a){this.subscriptions("viewState.gridSize"),this.stateFields({deleteConfirm:!1}),this.prototype.setDefaultItem=function(){let t;return i.isF((t=this.props).setDefaultItem)&&t.setDefaultItem(this.props.id)},this.prototype.deleteItem=function(){let t;return i.isF((t=this.props).deleteItem)&&t.deleteItem(this.props.id)},this.prototype.render=function(){let t,i,s,a,l;return({gridSize:t}=this),({id:i,description:s,defaultItemId:a,deletable:l}=this.props),e("row","childrenCenterCenter",{size:{ww:1,h:50},padding:{left:t}},n(r.smallText,"parentWidthChildrenHeight",{text:s}),!this.deleteConfirm&&a&&(i!==a?o({animators:{size:{toFrom:{h:50,w:0}}},size:50,key:"makeDefault",text:"select",action:this.setDefaultItem}):e(["row","childrenCenterCenter"],{clip:!0,padding:{right:t},animators:{size:{toFrom:{h:50,w:t}}},size:{wcw:1,h:50}},n(r.smallText,"childrenSize",{text:"default",color:"green",fontWeight:"bold"}))),l&&o({size:50,animators:{size:{toFrom:{h:50,w:0}}},key:"trash",icon:this.deleteConfirm?"cancel":"trash",action:this.toggleDeleteConfirm}),l&&this.deleteConfirm&&o({key:"confirm?",animators:{size:{toFrom:{h:50,w:0}}},size:{h:50,w:120},text:"delete now?",color:"#d00",fontWeight:"bold",action:this.deleteItem}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ButtonWrapper","TextElement","Icons","TextPalette","toSeconds","min","max","interval","Element","ShowMedia","peek","MarkdownView"],[e,n(913)],(t,e,n,r,o,s,a,l,u,c,h,p,d)=>{let f;return f=i.defClass(class SlideShowButton extends t{},function(t,i,s){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,i,s;return t=(s=this.props).icon,i=s.action,e({size:4*this.gridSize,radius:100,backgroundColor:"white",action:i},n(r[t],{color:o.black.secondary,size:"parentSize",align:.5}))}}),i.defClass(class MiniStreamSlideshow extends t{},function(t,e,n){let r;this.subscriptions("viewState.viewState",{posts:{key:function({topicId:t}){return t},model:"postsByTopicId"}}),this.stateFields({slide:0,slideShowStarted:!1,showControls:!1,advanceAt:0,slowTransition:!1}),this.getter({post:function(){let t;return i.exists(t=this.posts)&&t[this.slide]},nextPost:function(){let t;return i.exists(t=this.posts)&&t[this.slide+1]},firstPost:function(){let t;return i.exists(t=this.posts)&&t[0]},lastPost:function(){let t;return this.slide>0?i.exists(t=this.posts)&&t[this.slide-1]:void 0},done:function(){return this.posts&&this.slide>=this.posts.length-1},slideTransitionDuration:function(){return this.slowTransition?2:.5}}),r=10,this.prototype.queueNextSlide=function(){return this.advanceAt=s()+10},this.prototype.advanceSlide=function(t){return this.posts?(this.slowTransition=!1,this.advanceAt=null,this.slide=a(this.slide+1,this.posts.length-1)):void 0},this.prototype.lastSlide=function(){return this.advanceAt=null,this.slowTransition=!1,this.slide=l(0,this.slide-1)},this.prototype.componentWillMount=function(){return u(1e3,()=>this.pollingUpdate()),n.componentWillMount.apply(this,arguments)},this.prototype.getInitialState=function(){return{advanceAt:s()+10}},this.prototype.pollingUpdate=function(){return null!=this.advanceAt&&s()>this.advanceAt?(this.advanceSlide(),this.slowTransition=!0,this.queueNextSlide()):void 0},this.prototype.showPost=function(){return this.models.navState.showPost(this.post)},this.prototype.restartSlideShow=function(){return this.slide=0},this.prototype.renderPost=function(t,e){return t&&c({key:t.id,opacity:e,animators:{opacity:{f:"easeInSine",duration:this.slideTransitionDuration}}},h({post:t,mediaSize:"large"}))},this.prototype.render=function(){let t,e,n,r,o,s,a,l,u,h,m,g;return t=(h=this.viewState).viewWidth,e=h.feedWidth,n=h.gridSize,r=h.isTouchScreen,m=this,o=this.slide,s=this.post,a=this.nextPost,l=this.firstPost,u=this.lastPost,c({size:{w:e,h:2*e/3},cursor:"pointer",on:{mouseIn:this.triggerShowControls,mouseOut:this.clearShowControls,pointerClick:r?this.toggleShowControls:this.showPost},draw:[t>e?{radius:n/2}:void 0,"clip",u?void 0:"#e"]},this.renderPost(u,1),this.renderPost(s,1),this.renderPost(a,0),this.showControls?c({childrenLayout:"column",animators:{opacity:{toFrom:0}},draw:"#fff7",childrenAlignment:"centerCenter"},c(),c({size:"parentWidthChildrenHeight",childrenLayout:"row",childrenAlignment:"centerCenter",padding:{h:n/2},key:"controls"},f({action:this.slide>0?this.lastSlide:void 0,icon:"angleLeft"}),c(),f({action:(()=>{switch(!1){case!this.done:return this.restartSlideShow;case!this.advanceAt:return this.clearAdvanceAt;default:return this.queueNextSlide}})(),icon:(()=>{switch(!1){case!this.done:return"undo";case!this.advanceAt:return"pause";default:return"triangleRight"}})()}),c(),f({action:this.showPost,icon:"enlarge"}),c(),f({action:this.slide<(i.exists(g=this.posts)&&g.length)-1?this.advanceSlide:void 0,icon:"angleRight"})),c({padding:n,on:{pointerClick:this.showPost}},c({padding:n,childrenAlignment:"centerCenter",childrenLayout:"column",draw:[{radius:n},"white"]},(null!=s?s:s=p(this.posts))?d({post:s,maxMarkdownBlocks:1,preview:!0,includeTags:!0,style:"dialog"}):void 0))):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","getPostColors","Element","ImikimiPalette","ImikimiStyles","ShowMedia","getPostBackground","TextElement","TextStyles","TextPalette","getTopicTitle","Icons","PrivateStreamBadge"],[e,n(913)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f)=>{return i.defClass(class MiniTopic extends(t(e)){},function(t,e,m){this.subscriptions("viewState.viewState topic"),this.prototype.action=function(){let t,e;return i.isF(t=null!=(e=this.props.action)?e:this.props.selectTopic)&&t(this.topic)},this.getter({topic:function(){return this.props.topic||this.state.topic},isNewTopic:function(){let t;return i.exists(t=this.topic)&&t.isNewTopic}}),this.prototype.render=function(){let t,e,m,g,y,v,S,b,w,x,P;return({topic:t,isNewTopic:e}=this),({viewState:m}=this.state),({fullScreen:g,gridSize:y}=m),({selected:v,selectable:S,visible:b}=this.props),({backgroundColor:w}=n(i.exists(t)&&t.lastChapterPost)),r({visible:!1!==b,size:x=23*y/3,on:this.pointerHandlers,opacity:e&&!v?.5:1,animators:"opacity"},"pointerCursor",t&&r({cacheDraw:!0,location:"centerCenter",axis:.5,scale:this.pointerIsDown?.95:this.hover?1.025:1,animators:{scale:{duration:.1,easingFunction:"easeInQuad"}},draw:[{radius:y/2,outline:v?{lineWidth:10,color:o.primary}:void 0,fill:{color:w,shadow:s.tinyShadow}},"clip","children","reset",{child:"newStream"}]},a({post:null!=(P=t.lastPost)?P:t.lastChapterPost}),r("parentWidthChildrenHeight","bottomLeft",{draw:l(t.lastPost),padding:y/2},u(c.tinyBoldText,{color:h.white.primary,text:p(t)})),e&&r({key:"newStream",axis:"centerCenter",location:"centerCenter",size:"childrenSize",draw:{color:v?o.primary:"#888",outline:{color:h.white.primary,lineWidth:y/4},radius:1e3}},u(d.plus,{size:"childrenSize",fontSize:4*y,color:h.white.primary,padding:.75*y})),t.private?f({small:!0,chapterPost:t.lastChapterPost}):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","ButtonWrapper","Element","UserCircle","TextElement","TextStyles","TextPalette"],[e,n(913)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class MiniUser extends(t(e)){},function(t,e,u){this.subscriptions("viewState.viewState","user"),this.prototype.action=function(){return this.models.navState.showUser(this.user)},this.prototype.render=function(){let t,e,u;return t=this.viewState.gridSize,n({size:{h:5*t,w:12*t},action:this.action},r("row",{childrenMargins:t/2,padding:t/2},(i.exists(u=this.user)?e=u.displayName:void 0)?[o({user:this.user,mediaSize:"medium",size:"parentHeightSquare"}),s(e.length>20?a.tinyText:a.smallText,'textCenterLeft"',{color:l.black.secondary,text:e,size:"parentSize"})]:void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","config","Element"],[e,n(913)],(t,e,r)=>{return i.defClass(class NewsHomeView extends t{},function(t,i,o){this.subscriptions("viewState.viewState","newsState.lastSeenByTopicId",{newsTopic1:{model:"topic",key:function(){return e.newsTopicId}},newsTopic2:{model:"topic",key:function(){return e.newsTopic2Id}}}),this.getter({showNews1:function(){return this.models.newsState.unseen(this.newsTopic1)},showNews2:function(){return this.models.newsState.unseen(this.newsTopic2)},showTopic:function(){return this.newsTopic1&&this.newsTopic2?(()=>{switch(!1){case!(this.showNews1&&this.showNews2):return this.newsTopic1.lastPost.createdAt>this.newsTopic2.lastPost.createdAt?this.newsTopic1:this.newsTopic2;case!this.showNews1:return this.newsTopic1;case!this.showNews2:return this.newsTopic2}})():void 0}}),this.prototype.render=function(){let t,e,i,o,s;return t=(s=this.viewState).feedWidth,e=s.gridSize,i=s.viewWidth,o=this.showTopic,r("parentWidthChildrenHeight","column",{key:"newsHome",animators:"padding",padding:o?this.props.padding:0},o?n(935)({topic:o,key:o.id,hidable:!0}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","getPostTitle","present","Element","ButtonWrapper2","getPostForeground","ShowMediaWithText","TextElement","TextStyles","TabButton","TextPalette","ButtonWrapper"],[e,n(913)],(t,e,n,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class NewsPostView extends t{},function(t,p,d){this.subscriptions("viewState.viewState","topic",{post:function({postId:t,topic:e}){return null!=t?t:i.exists(e)&&e.lastPostId},chapterPost:function({chapterPostId:t,topic:e}){return null!=t?t:i.exists(e)&&e.lastChapterPostId}}),this.getter({title:function(){let t;return this.post&&(t=e(this.post)),n(t)||(t=null),t},mediaPost:function(){let t;return i.exists(t=this.post)&&t.mediaFile?this.post:this.chapterPost}}),this.prototype.action=function(){let t;return this.post?(this.models.event.create(`news:show:${i.toString(i.exists(t=this.topic)&&t.id)}`),this.models.navState.showPost(this.post)):void 0},this.prototype.hide=function(){let t;return this.props.topic?(this.models.event.create(`news:hide:${i.toString(i.exists(t=this.topic)&&t.id)}`),this.models.newsState.markSeen(this.props.topic)):void 0},this.prototype.renderEdge=function(){let t,e,n,p,d,f,m,g,y,v;return t=(g=this.viewState).gridSize,e=g.buttonSize,y=this,n=this.title,p=this.mediaPost,d=this.post,f=this.chapterPost,r({size:{ww:1,h:3*t},animators:{size:{toFrom:{h:0}}},clip:!0},f&&d&&o({action:this.action,backgroundColor:m=s(p),hoverColor:m.blend("white",.25),backgroundPadding:0,radius:0,noZoom:!0,animators:{opacity:{toFrom:0}}},r("row",{padding:{h:t},childrenMargins:t},"childrenCenterLeft",r({size:2*t},a({post:p,contrast:!0,radius:t/4})),l(u.smallText,"childrenSize",{maxLines:1,color:"#fff",text:null!=n?n:i.exists(v=this.topic)&&v.title}))),this.props.hidable&&this.props.topic?c("centerRight",this.viewState.fullScreen?{location:{yh:.5,xw:1,x:-t}}:void 0,{icon:"close",size:e,iconScale:.5,action:this.hide,color:h.white.secondary}):void 0)},this.prototype.render=function(){let t,e,n,i,r,o,s,a;return t=(s=this.viewState).gridSize,e=s.buttonSize,a=this,n=this.title,i=this.mediaPost,r=this.post,o=this.chapterPost,this.renderEdge()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","Element","getMediumDisplayName","TextElement","TextStyles","TextPalette","compactFlattenAllFast","pluralize","formatDate"],[e,n(913)],(t,e,n,r,o,s,a,l,u,c)=>{let h,p;return h=2,p=10,i.defClass(class PostInfo extends(t(e)){},function(t,e,h){this.subscriptions({user:function({post:t}){return i.exists(t)&&t.userId},ageString:function({post:t}){return i.exists(t)&&t.createdAt}}),this.prototype.action=function(){return this.models.navState.showUser(this.user)},this.prototype.render=function(){let t,e,h,p,d,f;return({topic:t,post:e,mini:h,postCount:p}=this.props),t&&({isProfileTopic:d}=t),n("childrenSize","pointerCursor",{on:this.pointerHandlers},this.user?(f=r(this.user),o(s.tinyText,"childrenSize","textTopRight",{color:a.white.primary,text:h?f:l(p?u(p,"post"):void 0,this.hover&&i.exists(e)&&e.createdAt?c(e.createdAt,"h:MMtt mmm d"):this.ageString,p?void 0:`by ${i.toString(f)}`),maxLines:3})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","getPostColors","Element","TextElement","TextStyles","TextPalette","ShowMessage"],[e,n(913),{ShowMessage:n(938)}],(t,e,n,r,o,s,a)=>{return i.defClass(class PostMessages extends t{},function(t,l,u){let c;this.subscriptions("viewState.viewState","currentSession.currentUser","post",{messagesByPostId:c=function({post:t,postId:e}){return e||i.exists(t)&&t.id}}),this.prototype.componentWillMount=function(){let t,e,n;return u.componentWillMount.apply(this,arguments),({currentUser:t}=this.state),({post:e,postId:n}=this.props),n||(n=i.exists(e)&&e.id),t&&n?this.models.postParticipant.seen(n):void 0},this.prototype.render=function(){let t,l,u,c,h,p,d;return({currentUser:t}=this.state),({fullScreen:l,deviceType:u,gridSize:c}=this.viewState),h=e(this.post).backgroundColor,p={pushPage:this.props.pushPage,popPage:this.props.popPage,post:this.post,highlightColor:h},n(["parentWidthChildrenHeight","column"],{childrenMargins:c},i.array(this.messagesByPostId,t=>{let e;return a(t,{key:t.id,right:(i.exists(e=this.currentUser)&&e.id)===t.userId},p)}),0===(i.exists(d=this.messagesByPostId)&&d.length)?n(["parentWidthChildrenHeight","clip"],{padding:c,animators:{size:{toFrom:{ww:1,h:0}}}},r(o.mediumText,"parentWidthChildrenHeight",{align:.5,color:s.black.secondary,text:"send the first comment"})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","merge","detagAnyString","MenuSection","Element","ImikimiPalette","MenuMarkdown","MenuButton","InlineFlagOptions","TextPalette","UserCircle","TextElement","TextStyles","DisplayTags","SelectableTextWrapper"],[e,n(913),{InlineFlagOptions:n(928)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{return i.defClass(class ShowMessage extends(t(e)){},function(t,e,y){this.subscriptions("viewState.viewState","user","currentSession.currentUserId",{ageString:function({createdAt:t}){return t}}),this.stateFields({prepDelete:!1,reportComment:!1}),this.prototype.preprocessProps=function(t){return n(y.preprocessProps.apply(this,arguments),r(this.props.text,3,!0))},this.prototype.deleteMessage=function(){return this.models.message.delete(this.props.id)},this.getter({canDelete:function(){return this.ownPost||this.ownMessage},ownPost:function(){let t;return(t=this.props.post)?this.currentUserId===t.userId:void 0},ownMessage:function(){return this.currentUserId===this.props.userId}}),this.prototype.renderTrash=function(){return o({label:"Trash comment"},s("parentWidthChildrenHeight",{padding:this.viewState.gridSize/2,draw:[{radius:this.viewState.gridSize/2},a.warningBackground]},this.renderContents()),l({text:"Are you sure you want to delete this comment? This cannot be undone."}),u({icon:"trash",text:"Trash comment now",action:()=>(this.deleteMessage(),this.props.popPage())}))},this.prototype.showFlagPrompt=function(){let t,e;return this.props.pushPage(c,{currentUserRequired:!0,messageId:this.props.id,postId:this.props.postId,userId:null!=(t=i.exists(e=this.user)&&e.id)?t:this.props.userId})},this.prototype.showTrashPrompt=function(){return this.props.pushPage(this.renderTrash)},this.prototype.renderContents=function(){let t,e,n,i,r,o,l,u,c,g,y;return t=(g=this.props).text,e=g.right,n=g.maxLines,i=g.tags,r=g.displayText,o=(y=this.viewState).buttonSize,l=y.gridSize,u=a.primary,this.prepDelete&&!this.hover&&(this.prepDelete=!1),c=this.hover,s(["parentWidthChildrenHeight","column"],{childrenMargins:l/2},this.reportComment?s({key:"warningBackground",inFlow:!1,animators:{opacity:{toFrom:0}},draw:{padding:-l/4,rectangle:{radius:l/2},color:a.primaryBackground,outline:h.black.barely}}):void 0,s("childrenSizeMaxParentWidth",{key:"body",animators:{size:{toFrom:{wcw:1,h:0,max:{ww:1}}},clip:{toFrom:!0}},padding:{right:2.5*l}},this.props.noUserCircle||!this.props.user&&!this.props.userId?void 0:p({user:this.user,withDarkContrast:!0,size:2*l}),s(["parentWidthChildrenHeight","column"],{location:{x:2.5*l},childrenMargins:l/2},s(["parentWidthChildrenHeight","row"],this.user&&d(f.tinyBoldText,"parentWidthChildrenHeight",{text:this.user.displayName,color:h.black.secondary}),!c&&d(f.tinyText,"childrenSize",{text:this.ageString,color:h.black.tertiary})),d(f.smallText,"childrenSizeMaxParentWidth",{color:h.black.primary,text:r,paragraphLeading:2,maxLines:n}),!(null!=n)&&m({tags:i,backgroundColor:"#aaa"}))))},this.prototype.render=function(){let t,e,n,i,r,o,s,l,u,c,h;return t=(c=this.props).text,e=c.right,n=c.maxLines,i=c.tags,r=c.displayText,o=(h=this.viewState).buttonSize,s=h.gridSize,l=a.primary,this.prepDelete&&!this.hover&&(this.prepDelete=!1),u=this.hover,g("parentWidthChildrenHeight",{text:t,context:"showMessage",buttons:[{icon:"flag",action:this.showFlagPrompt},{icon:"trash",iconScale:.8,action:this.showTrashPrompt}]},this.renderContents())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","isFullMember","UserCircle","TextElement","Icons","TextPalette"],[e,n(913)],(t,e,n,r,o,s,a)=>{return i.defClass(class ProfileRingPreview extends t{},function(t,i,l){this.subscriptions("currentSession.currentUser","viewState.gridSize"),this.prototype.render=function(){return e(["parentWidthChildrenHeight","row","childrenCenterCenter"],{childrenMargins:this.gridSize},n(this.currentUser)?void 0:[r({user:this.currentUser,size:75,memberLineWidth:15}),o(s.triangleRight,{color:a.black.secondary},"childrenSize")],e("childrenSize",{padding:7.5},r({user:this.currentUser,size:75,memberLineWidth:15,forceGoldCircle:!0})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ImikimiStyles","max"],[e,n(913)],(t,e,n,r)=>{return i.defClass(class SecondaryToolbar extends t{},function(t,o,s){this.subscriptions("navState.navState","viewState.viewState"),this.prototype.render=function(){let t,o,s,a,l,u,c,h,p,d;return t=(d=this.viewState).fullscreen,o=d.tabBarHeight,s=d.tabBar,a=d.gridSize,l=d.safePadding,u=d.buttonSize,c=this.models.navState.currentSecondaryToolbarRenderer,e({key:"secondaryToolbar"},c?{size:(h="right"===s)?"parentHeightChildrenWidth":"parentWidthChildrenHeight",cache:!0,padding:h?void 0:{top:l.top+a/2},draw:n.tabBarBackground}:{size:0},i.isF(c)&&c(h?{size:{hh:1,w:this.viewState.buttonSize+this.viewState.safePadding.right},childrenLayout:"column",childrenAlignment:"centerRight",padding:{h:1,left:p=r(0,l.right-a/2)}}:{size:{ww:1,h:o},childrenLayout:"row",padding:t?void 0:{h:a}}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent"],[e,n(913)],(t,e)=>{return i.defClass(class SimpleStreamCardForPost extends(t(e)){},function(t,e,i){this.subscriptions("post"),this.prototype.render=function(){return n(921)(this.props,{post:this.post})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["EventLogMixin","FluxComponent","MenuSectionGroup","MenuSection","MenuMarkdown","StringConstants","Element","LargeMenuButton","ProfileRingPreview"],[e,n(913),{ProfileRingPreview:n(939)}],(t,e,r,o,s,a,l,u,c)=>{return i.defClass(class StartReferral extends(t(e)){},function(t,e,h){this.subscriptions("viewState.viewState"),this.eventKey("refer"),this.prototype.render=function(){let t,e,h;return t=(h=this.viewState).gridSize,e=h.nativeApp,r(o(s({text:a.referrals.explanationPart1}),l({size:t}),e?u({key:"shareLinkNative",text:"Invite Friends",icon:"share",action:()=>(this.createEvent("nativeShare"),this.models.share.nativeShareLink(this.models.feedback.referralLink))}):[u({text:"Invite via Email",icon:"mail",action:()=>(this.createEvent("emailLinkShare"),this.models.feedback.emailReferralLink())}),u({icon:this.copiedReferralLink?"checkmark":"link",text:`Copy Invite Link ${i.toString(this.copiedReferralLink?"(copied)":void 0)}`,action:()=>n(848)(this.models.feedback.referralLink)?(this.createEvent("copyShare"),this.triggerCopiedReferralLink()):void 0})],l({size:t}),s({text:a.referrals.explanationPart2})),o({label:"Referral Program FAQ"},s({text:a.referrals.faq}),c()))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["config","FluxComponent","getPostParticipantsToShow","ButtonWrapper","Element","ImikimiPalette","TextElement","TextStyles","ZoLogo","TabButton","getShortDisplayName","UserCircle","TabBarSpacer","ImikimiStyles","max"],[e,n(913)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m)=>{let g;return g=t.edge,i.defClass(class TabBar extends e{},function(e,y,v){this.subscriptions("navState.navState","viewState.viewState","newPostState.selectedImageInfo",{notificationsByUserId:function({currentUser:t}){return i.exists(t)&&t.id},participantsByUserIdDesc:function({currentUser:t}){return i.exists(t)&&t.id}}),this.stateFields({homeButtonHover:!1}),this.propFields({currentUser:null,currentUserId:null}),this.getter({unseenNotifications:function(){let t,e,r;return t=0,({selectedPostParticipants:e,allPostParticipants:r}=n(this.participantsByUserIdDesc)),i.each2(e,({post:e,activityCount:n,lastSeenActivityCount:i})=>{let r;return e&&({activityCount:n}=e),0<(r=(0|n)-(0|i))?t+=r:void 0}),i.each2(this.notificationsByUserId,({seenAt:e})=>t++,({seenAt:t})=>!t),t}}),this.prototype.renderLogoButton=function(){let e,n,i;return e=(i=this.viewState).gridSize,n=i.tabBarHeight,r({action:this.models.navState.home,hoverAction:this.setHomeButtonHover,size:{hh:1,wcw:1}},o({padding:{h:e}},"row","childrenCenterCenter",{childrenMargins:e/4,size:{h:n,wcw:1},animators:"draw",draw:["children",{fill:{compositeMode:"sourceTopInTarget",color:this.homeButtonHover?"white":s.primary}}]},"imikimi"===t.vertical?a(l.largeText,"childrenSize",{animators:{size:!0},text:"imikimi",color:s.primary}):void 0,o({size:.62*n},u()),a(l.largeText,"childrenSize",{animators:{size:!0},color:s.primary,text:t.vertical.split(/^zo/)[1]})))},this.getter({labelBottom:function(){let t,e;return({isTouchScreen:t,fullScreen:e}=this.viewState),t||!e},currentRootPageName:function(){let t;return i.exists(t=this.navState.overlay)&&t.type||this.navState.currentTab},selected:function(t){return this.currentRootPageName===t&&s.primary},buttonWidth:function(){return this.viewState.isTouchScreen?1.5*this.viewState.buttonSize:100}}),this.prototype.getCommonButtonProps=function(t,e,n){let i,r,o,a,l,u,c,h,p,d;return i=(d=this.viewState).isTouchScreen,r=d.tabBar,o=d.gridSize,a=d.safePadding,l=d.feedWidth,u=d.fullScreen,c=d.buttonSize,h=d.tabBarHeight,u||(n=!1),g&&(!i&&u||(n=!0)),({labelBottom:p}=this),{labelBottom:p,color:this.getSelected(t),hoverColor:s.lightPrimary,size:(()=>{switch(!1){case!("right"===r):return{ps:1};case!!u:return{hh:1,w:(l-2*o)/5};case!n:return h;case!p:return{h:h,w:4*o};default:return{wcw:1,hh:1}}})(),iconScale:.8,label:!n&&e,badgeBorder:!0}},this.prototype.renderSearch=function(){return c({key:"search",icon:"search",action:this.models.navState.search},this.getCommonButtonProps("Search","search",!0),{label:this.labelBottom&&"search"})},this.prototype.renderZoHome=function(){let e;return({fullScreen:e}=this.viewState),c({key:"explicit-home",icon:(()=>{switch(t.vertical){case"zoPeople":return"bubbles";default:return"home"}})(),action:this.models.navState.home},this.getCommonButtonProps("ZoHome",(()=>{switch(t.vertical){case"zoPeople":return"conversations";default:return"home"}})()),{iconScale:g&&"zoPeople"!==t.vertical?1:.8})},this.prototype.renderKimiHome=function(){return c({key:"kimiFrames",icon:"frame",action:this.models.navState.kimiHome},this.getCommonButtonProps("KimiHome","kimis"))},this.prototype.renderSocialActivity=function(){return c({key:"social",icon:"bubbles",action:this.models.navState.toggleShowSocialActivity,badge:this.unseenNotifications},this.getCommonButtonProps("SocialActivity","activity",!0),{label:this.labelBottom&&"activity"})},this.prototype.renderCreate=function(){return c({key:"startPost",icon:"image",action:this.models.navState.toggleShowNewPost},this.getCommonButtonProps("NewPost","create"))},this.prototype.renderHelp=function(){return c({key:"menu",action:this.models.navState.toggleShowHelp,icon:"helpInverted"},this.getCommonButtonProps("Help","help",!0),{label:this.labelBottom&&"help"})},this.prototype.renderAccount=function(){let t;return c({key:"login",maxLines:1,action:this.currentUserId?this.models.navState.toggleShowProfileSettings:()=>this.models.navState.toggleShowLogin({reason:"logInButton"})},t=this.getCommonButtonProps("ProfileSettings",this.currentUser||this.currentUserId?h(this.currentUser):"sign up"),this.currentUser||this.currentUserId?{customIcon:o({size:t.labelBottom?20:25,draw:this.getSelected("ProfileSettings")?["circle",{outline:{lineWidth:4,color:s.primary},outline:{lineWidth:2,color:"white"}}]:void 0},p({user:this.currentUser,memberLineWidth:3,noClicks:!0}))}:this.currentUserId?{icon:"user"}:{icon:"login"})},this.prototype.renderFullscreenTabBar=function(e){let n,i,r,s,a,l;return({viewWidth:n,gridSize:i,isTouchScreen:r,nativeApp:s}=this.viewState),({labelBottom:a}=this),o(e,(l=n>=650&&!s)?this.renderLogoButton():void 0,o(),g?this.renderEdgeToolbar():[this.renderZoHome(),a||"imikimi"!==t.vertical?void 0:d(),this.renderCreate(),a?void 0:d(),this.renderAccount(),a?void 0:d(),this.currentUser?this.renderSocialActivity():void 0,this.renderSearch(),this.renderHelp()])},this.prototype.renderEdgeToolbar=function(){let t;return t=this.labelBottom,[this.renderZoHome(),t?void 0:d(),this.renderCreate(),t?void 0:d(),this.renderAccount(),t?void 0:d(),this.currentUser?this.renderSocialActivity():void 0,this.renderSearch(),c({key:"Settings",action:this.models.navState.toggleShowHelp,icon:"helpInverted"},this.getCommonButtonProps("Settings","settings",!0))]},this.prototype.renderPrimaryPhoneToolbar=function(t){return o(t,o(),g?this.renderEdgeToolbar():[this.renderZoHome(),this.renderSocialActivity(),this.renderCreate(),this.renderAccount(),this.renderHelp()],o())},this.getter({renderTabBarContents:function(){let t,e,n;return({currentPageComponent:t}=this.models.navState),this.viewState.fullScreen?null!=(e=i.exists(t)&&t.renderFullscreenToolbar)?e:this.renderFullscreenTabBar:null!=(n=i.exists(t)&&t.renderPrimaryPhoneToolbar)?n:this.renderPrimaryPhoneToolbar}}),this.prototype.render=function(){let t,e,n,r,s,a,l,u,c;return t=(l=this.viewState).fullScreen,e=l.tabBarHeight,n=l.tabBar,r=l.gridSize,a=(s=l.safePadding).bottom,o("right"===n?"parentHeightChildrenWidth":"parentWidthChildrenHeight","cacheDraw",{key:"primaryToolbar",inFlow:!1!==this.props.inFlow,location:this.props.location,axis:this.props.axis,padding:"top"===n?{top:null!=(u=i.exists(c=this.viewState.safePadding)&&c.top)?u:0}:void 0,draw:"top"===n?f.topTabBarBackground:f.tabBarBackground},this.renderTabBarContents(["childrenCenterLeft","right"===n?"column":"row","right"===n?{size:{hh:1,w:this.viewState.tabBarWidth},padding:{left:1,right:m(0,this.viewState.safePadding.right)}}:{size:{ww:1,h:e+a},padding:t?{h:0}:{h:r,bottom:a}}]))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ButtonWrapper2","TextElement","TextStyles","TextPalette","String","TagLink","ImikimiPalette"],[e,n(913)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class TagList extends t{},function(t,c,h){let p,d;this.subscriptions("viewState.viewState"),p=20,d=10,this.propFields("tags"),this.stateFields({showCount:10}),this.prototype.showMore=function(){return this.tags?this.showCount=this.tags.length>this.showCount+40?this.showCount+20:this.tags.length:void 0},this.prototype.showLess=function(){return this.showCount=10},this.prototype.render=function(){let t,c,h,p,d,f,m,g,y,v,S;return g=this.viewState,t=g.gridSize,c=g.buttonSize,p=10,d=30,(h=this.showCount)+5>=(i.exists(y=this.tags)&&y.length)&&(h=i.exists(v=this.tags)&&v.length),f=h<(i.exists(S=this.tags)&&S.length),m=h>10&&h===this.showCount,e("column","parentWidthChildrenHeight",this.tags&&e("flow","parentWidthChildrenHeight",i.array(this.tags.slice(0,h),e=>{let n;return n=i.is(e,a)?e:e.tag,l({tagAction:this.props.tagAction,key:n,kimis:!0,margin:t/2,backgroundColor:u.primary,buttonSize:c,gridSize:t,text:n})}),f||m?n({key:`showMore ${i.toString(h)}`,size:{wcw:1,h:.75*c},borderPadding:0,radius:100,action:f?this.showMore:this.showLess},r(o.smallText,"childrenWidthParentHeight","textCenterCenter",{color:s.black.secondary,padding:{h:t/2},text:f?"more...":"less"})):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","createGestureRecognizer","merge","timeout","peek","getIsChapterStart","getIsCoverPhoto","getPostForeground","getPostBackground","PrevNextButton","bound","Element","missing","ImikimiPalette","TextElement","TextStyles","TextPalette","Math"],[e,n(913)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b)=>{return i.defClass(class TopicBrowserWrapper extends(t(e)){},function(t,e,w){let x,P,C;this.subscriptions("topic","viewState.viewState","navState.feedScrollingActive",{postsDesc:{model:"postsByTopicIdDesc",key:function({topic:t,loadPosts:e,topicId:n,post:r}){return null!=r||(r=i.exists(t)&&t.lastPost),!r||e?i.exists(t)&&t.id||n:void 0}},post:function({postId:t,post:e,topic:n}){let r;return null!=(r=null!=t?t:i.exists(e)&&e.id)?r:i.exists(n)&&n.lastPostId},user:function({topic:t}){return i.exists(t)&&t.userId}}),this.getter({isTouchScreen:function(){return this.viewState.isTouchScreen},gridSize:function(){return this.viewState.gridSize},showButtons:function(){return!this.props.hideNav&&this.topic&&this.viewState.fullscreen||!this.viewState.isTouchScreen},nextChapterPost:function(){let t;return i.exists(t=this.currentPost)&&t.nextChapterPost},prevChapterPost:function(){let t;return i.exists(t=this.currentPost)&&t.prevChapterPost},prevPost:function(){let t;return i.exists(t=this.currentPost)&&t.prevPost},nextPost:function(){let t;return i.exists(t=this.currentPost)&&t.nextPost},currentPostId:function(){let t;return i.exists(t=this.currentPost)&&t.postId}}),this.stateFields({axisXOffset:0,absoluteXOffset:0,tracking:!1,currentPost:null,willTransitionToPost:null,viewingLastPost:!1,processedPosts:null,showDotInfo:!1,lastCurrentPostId:null,processedPostsByPostId:{},selectedPosts:null}),x=function(t,e){let n,r;return(null!=t?t:t=i.exists(e)&&e.lastPost)?{post:t,postId:t.id,key:t.id,chapterPost:t.isChapterStart?t:(i.exists(e)?(n=e.lastChapterPost,i.exists(n)?r=n.postOrder:void 0):void 0)<t.postOrder?n:void 0}:void 0},this.prototype.preprocessProps=function(t){let e,n,r;return i.exists(e=this.props)&&e.post&&t.post&&this.props.post.id!==t.post.id&&(i.exists(n=this.state.currentPost)&&n.postId)!==t.post.id&&(this.currentPost=x(t.post,null!=(r=t.topic)?r:this.state.topic)),w.preprocessProps.apply(this,arguments)},this.prototype.getInitialState=function(){return{handlers:r(o(this.hoverHandlers,{horizontal:{begin:this.begin,move:this.move,end:this.end,cancel:this.cancel},flick:this.flick}))}},this.prototype.flick=function({props:{flickDirection:t}}){return(()=>{switch(t){case"right":return this.prev();case"left":return this.next()}})()},this.prototype.cancel=function(t){return this.axisXOffset=0,this.tracking=!1,this.willTransitionToPost=null},P=100,this.prototype.begin=function(t){},this.prototype.move=function(t){return this.tracking=!0,s(100,()=>this.tracking=!1),this.absoluteXOffset=t.totalParentDelta.x,this.axisXOffset=t.totalParentDelta.x/t.target.currentSize.x,this.willTransitionToPost=(()=>{switch(!1){case!(this.absoluteXOffset<-100):return this.nextPost;case!(this.absoluteXOffset>100):return this.prevPost}})()},this.prototype.end=function(t){switch(!1){case!(this.absoluteXOffset<-100):this.next();break;case!(this.absoluteXOffset>100):this.prev()}return this.axisXOffset=0,this.tracking=!1,this.willTransitionToPost=null},this.prototype.generateProcessedPosts=function(t,e,n){let r,o,s,a,l,u,c;return r=0,o=s=a=null,t.length>0&&(t[0].isChapterStart=!0),l=1,u={},c=i.array(t,(t,e)=>{let o,c;return u[t.id]=o={post:t,postIndex:e,topic:n,postNumber:l,key:t.id,postId:t.id,processedChapterPost:s,prevPost:a,prevChapterPost:s,chapterPost:null!=(c=i.exists(s)&&s.post)?c:t,isFullProcessedPost:!0,chapterNumber:r},s&&(s.nextChapterPost=o),a&&(a.nextPost=o),a=o,t.isChapterStart||!s?(o.chapterNumber=++r,o.lastPostInChapter=o,o.postsInChapter=1,o.postNumber=l=1,o.processedChapterPost=o,s=o):(s.postsInChapter++,s.lastPostInChapter=o),l++,o}),s&&(s.lastPostInChapter=a),i.each2(c,(t,e)=>{let n,o;return t.numChapters=r,e<c.length-1?null!=(n=t.nextChapterPost)?n:t.nextChapterPost=i.exists(o=t.prevChapterPost)&&o.nextChapterPost:void 0}),{processedPosts:c,processedPostsByPostId:u}},this.prototype.preprocessState=function(t){let e,n,r,s,l,u,c,h,p,d,f,m,g,y,v,S,b,P,C,_,E,T,k,I,M,A,F,B;return e=(t=w.preprocessState.apply(this,arguments)).currentPost,n=t.currentPostIndex,r=t.post,s=t.viewingLastPost,l=t.nextPost,u=t.prevPost,c=t.postsDesc,h=t.processedPosts,p=t.processedPostsByPostId,d=void 0!==(E=t.topic)?E:this.props.topic,f=t.lastCurrentPostId,m=t.selectedPosts,g=i.exists(T=this.state.currentPost)&&T.postId,y=this.state.postsDesc!==c,v=this.state.currentPost!==e,t=((S=this.state.topic!==d)||v||y)&&(r||d)?(b=!!this.state.postsDesc,P=i.exists(c)&&c.slice().reverse(),null!=e||(e=x(null!=r?r:a(P),d)),e&&P&&((!h||y)&&({processedPosts:h,processedPostsByPostId:p}=this.generateProcessedPosts(P,d)),s&&b&&y&&!v&&this.onNextReady(()=>this.currentPost=p[a(P).id]),e=null!=(k=null!=(I=p[i.exists(e)&&e.postId])?I:h[e.postIndex])?k:a(h)),(!m||e.isFullProcessedPost&&!a(m).isFullProcessedPost||(C=!this.inProcessedPostList(e,m)))&&(m=this.selectPosts(e),C&&(this.setCurrentPostAfterDelay(e),e=this.state.currentPost)),o(t,{viewingLastPost:(i.exists(e)&&e.postId)===(i.exists(M=a(h))&&M.postId),currentPost:e,processedPosts:h,selectedPosts:m,processedPostsByPostId:p})):t,(i.exists(A=t.currentPost)?_=A.postId:void 0)&&_!==(i.exists(F=this.currentPost)&&F.postId)&&i.isF((B=this.props).focusedPostChanged)&&B.focusedPostChanged(t.currentPost.post,t.currentPost),t},this.prototype.setCurrentPostAfterDelay=function(t){return s(100,()=>this.currentPost=t)},this.prototype.inProcessedPostList=function(t,e){return i.find(e,null,({postId:e})=>e===t.postId)},C=function(t,e){let n;return e&&(n=e.postId,i.find(t,null,({postId:t})=>t===n)||t.push(e)),t},this.prototype.updateSelectedPosts=function(){return this.selectedPosts=this.selectPosts()},this.prototype.selectPosts=function(t){let e,n,r,o,s,a,l,u,c,h;return null!=t||(t=this.currentPost),e=[],n=(c=this.props).preloadChapterPosts,r=c.offscreenComponent,C(e,t),C(e,this.currentPost),i.exists(t)&&(o=void 0!==(h=t.postIndex)?h:0,s=t.prevPost,a=t.nextPost,l=t.nextChapterPost,u=t.prevChapterPost),C(e,s),C(e,a),n&&(C(e,l),C(e,u)),r&&(s||e.push({postIndex:o-1,offscreen:"left",key:"offscreenLeft"}),a||e.push({postIndex:o+1,offscreen:"right",key:"offscreenRight"})),e.reverse()},this.prototype.navigateTo=function(t){return t?this.currentPost=t:void 0},this.prototype.next=function(){return this.navigateTo(this.nextPost)},this.prototype.prev=function(){return this.navigateTo(this.prevPost)},this.prototype.nextChapter=function(){return this.navigateTo(this.nextChapterPost)},this.prototype.prevChapter=function(){return this.navigateTo(this.prevChapterPost)},this.prototype.renderButton=function(t){let e,n,r,o,s,a,d,f,m,g,y,v,S;return S=this,e=this.currentPost,i.exists(e)&&(n=e.post,r=e.chapterPost,o=e.postIndex),s=this.processedPosts,e&&s?((l(n)||u(n))&&(r=n),d=this[(a=t?"next":"prev")+"Post"],({fullscreenStreamLayout:f,showOverlay:m,externalPrevNextButtons:g}=this.props),y=c(r),v=h(r),this.showButtons&&p({key:t?"nextButton":"prevButton",external:g,right:t,currentIndex:o,backgroundColor:v,foregroundColor:y,fullscreenStreamLayout:f,action:t?e.nextPost&&this.next:e.prevPost&&this.prev,key:`${i.toString(a)}PostButton${i.toString(g?"External":void 0)}`,nextIndex:i.exists(d)&&d.postIndex})):void 0},this.prototype.showChapterNavigator=function(){return this.models.navState.showChapterNavigator(this.topic)},this.prototype.showTopicSettings=function(){let t;return this.models.navState.showTopicSettings(i.exists(t=this.currentPost)&&t.post)},this.prototype.renderDots=function(){let t,e,r,o,s,a,l,u,h,p,d,f;return this.topic&&(i.exists(l=this.currentPost)?(t=l.post,e=l.chapterPost):void 0)&&(r=null!=(u=i.exists(h=this.processedPosts)&&h.length)?u:i.exists(p=this.topic)&&p.postCount)&&(o=null!=(d=this.willTransitionToPost)?d:this.currentPost)?(s=(e=o.chapterPost).chapterNumber,a=e.numChapters,o.isCoverPhoto&&(e=o),n(924)({action:this.showChapterNavigator,hoverColor:c(e),currentPostIndex:null!=(f=i.exists(o)&&o.postIndex)?f:r-1,chapterNumber:s,numChapters:a,numPosts:r})):void 0},this.prototype.render=function(){let t,e,n,r,o,a,l,u,c,h,p,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N;return R=this.props,t=R.component,e=R.fullscreenStreamLayout,n=R.backgroundColor,r=R.externalPrevNextButtons,o=R.preloadChapterPosts,a=R.noDots,l=void 0!==(z=R.hSpacing)?z:0,O=this,u=this.axisXOffset,c=this.tracking,h=this.prev,p=this.next,w=this.topic,x=this.currentPost,i.exists(x)&&(P=x.nextPost,C=x.prevPost,_=x.nextChapterPost,E=x.prevChapterPost),T=this.lastCurrentPostId,k=this.selectedPosts,I=(L=this.viewState).gridSize,M=L.feedWidth,this.hover&&!this.props.loadPosts&&i.isF((D=this.props).loadPostsNow)&&D.loadPostsNow(),(u<0&&!P||u>0&&!C)&&(u/=2),u=d(-1,u,1),A=x&&(i.exists(k)&&k.length)>0,f({receivePointerEvents:"passToChildren",size:F=e?{ps:1}:{w:M,hch:1}},f({size:F,on:this.state.handlers,clip:!e},this.topicStatus===m?[{draw:g.lightGrey},y(v.smallText,"parentWidthChildrenHeight","textCenterCenter",{padding:this.gridSize,color:S.black.tertiary,text:"topic deleted"})]:A?(B=null!=(N=x.postIndex)?N:0,i.array(k,e=>{let n,r,o,a;return n=void 0!==(a=e.postIndex)?a:0,r=b.abs(B-n),o=d(-1,B-n,1),f({key:`${i.toString(e.key)}wrapper-zapper`,size:F,animators:c&&r<=1?void 0:{axis:{on:{done:()=>e.key===x.key?s(30,this.updateSelectedPosts):void 0}}},axis:{x:o-u}},e.post?t(this.props,e,{topic:this.topic}):this.props.offscreenComponent?this.props.offscreenComponent(e):void 0)})):{draw:"white"},!r&&this.renderButton(),!r&&this.renderButton(!0),a?void 0:this.renderDots()),r&&this.renderButton(),r&&this.renderButton(!0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","present","createFilterRegExp","merge","min","Element","MenuInfo","MenuButton","MiniTopic","TextPalette","TextElement","Icons","ImikimiPalette","TextInputElement","TextStyles","TabButton","Spinner","zoPickImage"],[e,n(913),{MiniTopic:n(932)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v)=>{let S;return S=3,i.defClass(class TopicSelector extends t{},function(t,S,b){this.subscriptions("viewState.viewState","currentSession.currentUser","currentSession.currentUserId",{topicSource:{model:"topicsByUserId",key:function({userId:t,user:e,topics:n}){return!n&&(t||i.exists(e)&&e.id)}}}),this.stateFields({filter:null,topics:null,filteredCount:0,filterRegExp:null,numLines:4}),this.prototype.preprocessState=function(t){let o,s,a,l,u,c,h,p;return({topicSource:o,filter:s,topics:a}=t),({skipTopicId:l,topicsPerPage:u}=this.props),null!=o||(o=this.props.topics),!o||a&&o===this.state.topicSource&&s===this.state.filter?r(b.preprocessState.apply(this,arguments)):(a=(a=i.array(o,null,t=>t.id!==l&&!t.isProfileTopic)).sort((t,e)=>e.lastPostCreatedAt-t.lastPostCreatedAt),(c=null!=(p=e(s)?n(s):void 0)?p:null)?(h=0,i.each2(a,t=>h++,t=>c.test(t.title))):h=a.length,r(b.preprocessState.apply(this,arguments),{topics:a,filteredCount:h,filterRegExp:c}))},this.getter({userId:function(){let t,e;return null!=(t=this.props.userId)?t:i.exists(e=this.props.user)&&e.id},ownTopics:function(){return this.currentUserId===this.userId},topicsPerPage:function(){let t;return({topicsPerPage:t=6}=this.props),this.topics.length<=3?3:t}}),this.prototype.renderVerticalList=function(){let t,e,n,r,c,h,p,d,f,m,g,y,v,S,b;return S=this,t=this.numLines,e=this.topics,n=this.filterRegExp,b=this.viewState,r=b.gridSize,c=b.buttonSize,({selectedTopic:h,selectTopic:p,padding:d,margin:f,lightText:m}=this.props),g=o(3*t,e.length),y=0,v=0,s("topLeft","parentWidthChildrenHeight","column",{childrenMargins:r},s("parentWidthChildrenHeight",{childrenMargins:r},"flow",i.array(e,(t,e)=>{let i;return y++,(i=v<g&&(!n||n.test(t.title)))&&v++,u({key:t.id,visible:i,gridSize:r,topic:t,topicIndex:e,selectTopic:p,selectable:!0,selected:h&&t.id===h.id})})),v<y?[a({small:!0,text:`showing ${i.toString(v)} / ${i.toString(y)} streams`}),l({icon:"triangleDown",size:{h:c,wcw:1},text:"show more...",action:()=>this.numLines+=4})]:void 0)},this.prototype.render=function(){let t,n,r,o,a,l,u,S;return t=this.topics,({selectedTopic:n,selectTopic:r,padding:o,margin:a}=this.props),({gridSize:l,buttonSize:u}=this.viewState),S="#222",s("parentWidthChildrenHeight","column",{childrenMargins:l,receivePointerEvents:"passToChildren"},(i.exists(t)&&t.length)>3?s(["row","childrenCenterCenter"],{draw:{radius:3,outline:c.black.barely},size:{hch:1}},h(p.filter,"textCenterCenter",{fontSize:l,size:1.5*l,animators:"color",color:e(this.filter)?d.primary:c.black.tertiary}),f(m.smallText,"parentSize","textCenterLeft",{key:"filterTextInput",color:c.black.secondary,placeholder:"filter",text:this.filter,on:{valueChanged:t=>this.setFilter(t.props.value)}}),e(this.filter)?g({size:1.5*l,icon:"close",iconScale:.4,action:()=>(this.refs.filterTextInput.element.value="",this.clearFilter())}):void 0,h(m.tinyText,"childrenSize",{color:c.black.tertiary,padding:{right:l/2},text:`${i.toString(this.filteredCount)}/${i.toString(this.topics.length)}`})):void 0,t&&"pending"!==this.state.topicsStatus?0===(i.exists(t)&&t.length)?this.ownTopics?g({size:{ww:1,h:9*l},icon:"image",text:"start your first stream with a photo",backgroundColor:d.lightGrey,centered:!0,labelStyle:m.mediumText,action:()=>v().then(t=>(this.models.newPostState.selectedImageInfo=t,this.models.navState.showNewPost()))}):s({key:"no topics",size:{ww:1,h:9*l},animators:{size:{toFrom:{ww:1,h:0}}},clip:!0,draw:{color:d.lightGrey,padding:l/2,radius:l/2}},h(m.smallText,"parentSize","textCenterCenter",{color:c.black.disabled,text:"no topics yet"})):this.renderVerticalList():s({key:"pending",size:{ww:1,h:9*l},animators:{opacity:{toFrom:0}},clip:!0},s({size:u},"centerCenter",y())))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","compactFlatten","max","min","Element","PostSearchResult","point","getPostAspectRatio","TextElement","TextStyles","ImikimiPalette","ZoLogo","config","MarkdownView","verticalWelcomeHeader","verticalGetStarted"],[e,n(913),n(914)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{let y;return y=i.defClass(class WelcomePreviews extends t{},function(t,u,c){let h;this.subscriptions("viewState.viewState",{post1:{model:"post",key:function({postIds:t}){return i.exists(t)&&t[0]}},post2:{model:"post",key:function({postIds:t}){return i.exists(t)&&t[1]}},post3:{model:"post",key:function({postIds:t}){return i.exists(t)&&t[2]}},post4:{model:"post",key:function({postIds:t}){return i.exists(t)&&t[3]}}}),this.propFields("verticalLayout","height","width","samplePosts"),this.getter({samplePosts:function(){let t;return null!=(t=this.props.samplePosts)?t:e([this.post1,this.post2,this.post3,this.post4])},gridSize:function(){return this.viewState.gridSize},previewSize:function(){let t,e,i,o,s;return s=this,t=this.verticalLayout,e=this.height,i=this.width,o=this.gridSize,e>0&&i>0&&o>0?t?n(320,r(.75*e,i/2)-2*o):r(e-4*o,i/2):100}}),h=["bottomRight","bottomLeft","topRight","topLeft"],this.prototype.renderPost=function(t,e){return o({key:t.id},s(h[e],{noOverlay:!0,post:t,size:e=>a({aspectRatio:l(t),fitInto:e})}))},this.prototype.render=function(){let t,e,n,r,s;return s=this,t=this.gridSize,e=this.previewSize,n=this.samplePosts,r=this.verticalLayout,o("column",r?"centerCenter":"centerLeft",{childrenMargins:t,size:e},(i.exists(n)&&n.length)>=4?[o("row","childrenBottomCenter",{childrenMargins:t},o({size:{w:e/10}}),i.array(i.exists(n)&&n.slice(0,2),(t,e)=>this.renderPost(t,e))),o("row","childrenTopCenter",{childrenMargins:t},i.array(i.exists(n)&&n.slice(2,4),(t,e)=>this.renderPost(t,e+2)),o({size:{w:e/10}}))]:void 0)}}),i.defClass(class Welcome extends t{},function(t,e,s){this.subscriptions("viewState.viewState"),this.propFields("samplePosts"),this.getter({feedWidth:function(){return this.viewState.feedWidth},gridSize:function(){return this.viewState.gridSize},height:function(){return.75*this.viewState.mainAreaHeight},width:function(){return this.viewState.mainAreaWidth},verticalLayout:function(){return this.viewState.mainAreaWidth<768},smallMode:function(){return this.viewState.mainAreaWidth<1300},previewSize:function(){return this.verticalLayout?n(320,r(.75*this.height,this.width/2)-2*this.gridSize):r(this.height-4*this.gridSize,this.width/2)}}),this.prototype.renderWelcomeMessage=function(){let t,e,n,r;return r=this,t=this.feedWidth,e=this.gridSize,n=this.verticalLayout?64:100,o("column",this.verticalLayout?"childrenTopCenter":void 0,{size:this.verticalLayout?{ww:1,hch:1,max:{w:t}}:{w:this.smallMode?this.viewState.viewWidth/3:t,hch:1},childrenMargins:e},o(this.verticalLayout?"childrenSize":void 0,[o(this.verticalLayout?"childrenSize":["bottomLeft",{size:{h:n}}],o({size:n},this.verticalLayout?void 0:"centerCenter",this.verticalLayout?void 0:{location:{yh:.5,x:n*(this.verticalLayout?.5:.3)}},p()),"imikimi"!==d.vertical?u(c.largeBoldText,"childrenSize","centerLeft",{fontSize:.5*n,location:{x:n*(this.verticalLayout?1.1:.9),y:.75*n},text:(()=>{switch(d.vertical){case"zoStream":return"Stream";case"zoPeople":return"People";default:return"Kimi"}})(),color:h.primary}):void 0)]),o(this.verticalLayout?"parentWidthChildrenHeight":void 0,"column",{childrenMargins:2*e},f("parentWidthChildrenHeight",{large:!this.smallMode,small:this.smallMode,text:`#${i.toString(this.verticalLayout?"-":void 0)} ${i.toString(m)}\n\n${i.toString(this.verticalLayout?"-":void 0)} ${i.toString(g)}`})))},this.prototype.render=function(){let t,e,n,i,r,s,a,l;return a=this,t=void 0!==(l=this.height)?l:.75*this.viewState.viewHeight,e=this.gridSize,n=this.feedWidth,i=this.width,(r=this.verticalLayout)?o({childrenMargins:e,padding:e},"parentWidthChildrenHeight",["column","childrenCenterCenter"],y({verticalLayout:r,width:i,height:t,samplePosts:this.samplePosts,postIds:this.props.postIds}),this.renderWelcomeMessage()):(s=e*(this.smallMode?2:4),o("column","childrenCenterCenter",{padding:s,size:{h:t}},o({childrenMargins:s,size:{h:t}},["row","childrenCenterCenter"],this.renderWelcomeMessage(),y({verticalLayout:r,width:i,height:t,samplePosts:this.samplePosts,postIds:this.props.postIds}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextStyles","ImikimiPalette","Element","max","min","TextElement","getVerticalProductName","MarkdownView","ButtonWrapper2"],[e,n(913),n(914)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class WelcomeExpiredUser extends t{},function(t,h,p){this.subscriptions("viewState.viewState"),this.getter({gridSize:function(){return this.viewState.gridSize},height:function(){return.75*this.viewState.mainAreaHeight}}),this.prototype.action=function(){return(()=>{switch(!1){case!this.props.action:return this.props.action();default:return this.models.navState.showOrPushSubscriptions(this.props.overlay,!0)}})()},this.prototype.render=function(){let t,h,p,d,f,m;return m=this,t=this.height,p=h=this.gridSize,d=[e.largeBoldText,"textCenterCenter","childrenSize",{padding:h,color:n.darkGolden}],f=["childrenSize",{margin:h,hoverColor:n.lightGolden,radius:100,action:this.action}],r("parentWidthChildrenHeight",{padding:h},r({size:{w:o(this.viewState.feedWidth,s(2*this.viewState.viewWidth/3,2*this.viewState.feedWidth)),hch:1},padding:h,childrenMargins:2*h},["column","childrenCenterLeft"],"topCenter",a(e.xxLargeBoldText,"childrenSize",{text:`${i.toString(l())} Free`}),u({large:!0,text:"\nYour membership expired, but there are many easy ways to renew:\n\n* Purchase time\n* Subscribe\n* Invite a Friend\n* Apply for Sponsorship\n\nThe basics are always free. However, as a member you not\nonly get access to great premium features, but you also help us make a meaningful difference in so many lives."}),c(f,r({draw:{radius:100,outline:{color:n.darkGolden,lineWidth:4}}}),a(d,{text:"Learn More and Become a Member"}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","MenuSectionGroup","PrimaryMenuButton","StatusMessage"],[e,n(908)],(t,e,n,r)=>{return i.defClass(class AuthNextButton extends t{},function(t,o,s){this.subscriptions("viewState.gridSize"),this.stateFields({showMessage:!1}),this.propFields({action:null,helpMessage:null,disabled:null,text:null}),this.prototype.preprocessProps=function(t){let e,n;return e=t.action,n=t.disabled,(e&&!n)!==(this.action&&!this.disabled)&&this.onNextReady(()=>{let t,e;return i.exists(t=this.refs.rootElement)&&i.exists(e=t.element)&&e.scrollOnscreen()}),t},this.prototype.render=function(){let t,i,o,s,a,l;return l=this,t=this.gridSize,i=this.text,o=this.action,s=this.helpMessage,a=this.disabled,e({key:"rootElement",padding:{top:t/2}},n({icon:i?void 0:"arrowCircleDown",text:null!=i?i:"next",action:o&&(()=>(this.showMessage=!1,o())),disabled:a,disabledAction:s&&this.triggerShowMessage}),this.showMessage?r({message:s,clearMessage:this.clearShowMessage}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["log","point","max","Math","Element"],[e,n(787)],(t,e,r,o,s)=>{return i.defClass(class PtlRow extends(n(789)){},function(n,a,l){this.getter({widthWithoutMargins:function(){return this.width-(this.children.length-1)*this.margin},childrenRowAspectRatio:function(){return i.reduce(this.children,(t,{aspectRatio:e})=>t+e,null,0)},aspectRatio:function(t=this.width){return t/(this.widthWithoutMargins/this.childrenRowAspectRatio)}}),this.prototype.layout=function(n=this.defaultWidth){let s,a,l,u;for(s=1,a=5,l=0,u=0;s>.001&&l<5;)u=n/this.getAspectRatio(n),i.each2(this.children,t=>t.layout(u*t.aspectRatio)),s=0,i.each2(this.children,({aspectRatio:t,size:e},n)=>s=r(s,o.abs(1-u/e.y))),l++;return l>=5&&t.warn({maxStepsExceeded:{i:l,maxError:s,height:u,width:n,aspectRatio:this.getAspectRatio(n)}}),this.size=e(n,u)},this.prototype.render=function(){return s({size:this.size,childrenLayout:"row",childrenMargins:this.margin},this.renderedChildren)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["fonts","Layout","point","Element","TextElement"],[e,n(787),n(417),n(799)],(t,e,r,o,s)=>{return i.defClass(class PtlText extends(n(789)){},function(n,i,a){this.getter({paragraphTextMinLength:function(){return 30},fontInfo:function(){let e;return null!=(e=t[this.props.font])?e:t.arial},fontFamily:function(){return this.fontInfo.fontFamily},layoutMode:function(){let t;return null!=(t=this.props.layoutMode)?t:"tight"},isParagraphText:function(){return this.props.noParagraphText?void 0:this.props.text.length>this.paragraphTextMinLength},aspectRatio:function(){let t,n;return t=this.props.text,(this.isParagraphText?new e(t,{fontFamily:this.fontFamily,fontSize:24},{align:r(null!=(n=this.props.align)?n:"center"),layoutMode:"textualBaseline"},400):new e(t,{fontFamily:this.fontFamily,fontSize:32},{layoutMode:this.layoutMode},400)).size.aspectRatio}}),this.prototype.render=function(){return o({size:this.size},s(this.props,{fontFamily:this.fontFamily,layoutMode:this.layoutMode,scale:this.scaleToFitParent},this.isParagraphText?{size:{w:400,hch:1},fontSize:24,layoutMode:"textualBaseline"}:{size:{cs:1,max:{w:400}}}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(785)).addModules({AsYouLikeIt:n(953),BassettDinner:n(992),HenryIv:n(993),JuliusCaesar:n(994),MuchAdoAboutNothing:n(995),Neuromancer:n(996),PosterTextStyleBase:n(955),SaintNicholas:n(997),SenseAndSensibility:n(998),StandardImport:n(954),TheAdventuresOfTomSawyer:n(999),TheGreatGatsby:n(1e3)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PtlColumn","PtlText","randomElement"],[e,n(954)],(t,e,r)=>{return i.defClass(class AsYouLikeIt extends(n(955)){},function(n,i,o){this.fonts=["aBeeZee","arimo","poppins","openSans"],this.free=!0,this.defaultText="All the world's a stage\nAnd all the men and women\nMerely players",this.classGetter({sampleRenderText:function(){return"As You\nLike It"}}),this.renderWithPreprocessedProps=function({text:n,seed:i,rando:o,lines:s,font:a}){return t(e({text:s.join("\n"),noParagraphText:!0,font:a,align:null!=i?r(["left","center","right"],o):void 0,layoutMode:"textualBaseline"}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(787).mergeWithSelf(n(788)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","compactFlatten","Promise","loadPosterTextAssets","zoLoadFont","Error","log","formattedInspect","timeout","codeWords","seededRandomNumberGenerator","randomElement","isString","merge","PtlPadding","PtlGlyph","arrayWithInsertedValue","PtlText","PtlRow"],[e,n(954),n(956),n(799)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S)=>{return i.defClass(class PosterTextStyleBase extends t{},function(t,b,w){let x,P;this.abstractClass(),this.assets={},this.paragraphFont="cardo",this.load=function(){let t,c,h,p;return t=e([this.fonts,this.paragraphFont]),c=e(this.assetFiles),h=(()=>n.deepAll({fonts:n.all(i.array(t,t=>o(t))).catch(()=>(()=>{throw new s(`one or more fonts failed to load: ${i.toString(t.join(", "))}`)})()),assets:r(c).then(t=>this.assets=t).catch(()=>(()=>{throw new s(`assets failed to load: ${i.toString(c.join(", "))}`)})())}).catch(t=>(a.warn(l({PosterTextStyle_retry:{style:this.getName(),error:i.exists(t)&&t.message}})),u(3e3,h)))),null!=(p=this._loadingPromise)?p:this._loadingPromise=h()},this.classGetter({sampleRenderText:function(){return c(this.getName()).join("\n")}}),this.sampleRender=function(t){let e;return this.render({seed:t,text:null!=(e=this.sampleRenderText)?e:"why no\ntext?"})},this.classGetter({defaultRandomizer:function(){return h(1)}}),this.getLines=function(t){return e(i.array(t.split(/\n+/),t=>(t=t.replace(/^ +| +$/,"")).length>0?t:void 0))},this.randomGlyph=function(t,e,n,r){let o;if(!(o=this.assets[e]))throw new s(`asset group not found: ${i.toString(e)}`);return t?p(i.array(o,null,(t,e)=>!r||r.test(e)),t):o[n]},this.autoTextBreakup=!0,x=function(t){let e,n,r;if(!d(t))throw new s;return e=P(t),n=0,r=-1,i.each2(e,({length:t},e)=>t>n?(n=t,r=e):void 0),{lines:e,maxLineLength:n,numLines:e.length,longestLineIndex:r}},P=function(t){return t.split("\n")},this.paragraphLineLength=30,this.wordWrapLine=function(t,e){let n,r,o;return t.length<=e?t:(n=t.split(/\s+/),r=[],o=null,i.each2(n,t=>o=o?o.length+t.length+1<e?`${i.toString(o)} ${i.toString(t)}`:(r.push(o),t):t),o.length>0&&r.push(o),r.join("\n "))},this.breakUpText=function(t){let e,n;return t=t.replace(/([.!:?\]}\)])\s*(?=.)/g,"$1\n"),({numLines:e,maxLineLength:n}=x(t)),5*e<n&&(t=t.replace(/\s+(?!I[^\w])([A-Z][^\s]*)\s*/g,"\n$1\n")),({numLines:e,maxLineLength:n}=x(t)),i.array(P(t),t=>this.wordWrapLine(t,2*this.paragraphLineLength/3)).join("\n").trim()},this.render=function(t){let e,n,r,o,a;if(({text:e,seed:n}=t),n&&(r=h(n)),o=this.getLines(e),a=this.fonts?r?p(this.fonts,r):this.fonts[0]:void 0,!this.renderWithPreprocessedProps)throw new s(`no renderWithPreprocessedProps in ${i.toString(this.getName())}`);return this.renderWithPreprocessedProps(f(t,{rando:r,lines:o,font:a,paragraphFont:this.paragraphFont}))},this.renderAndLayout=function(t){let e;return(e=this.render(t)).layout(),e.render()},this.RandomEndGlyph=function({rando:t,glyphGroup:e,defaultGlyph:n}){return m({h:.75},g({glyph:this.randomGlyph(t,e,n)}))},this.insertRandomDividerGlyph=function({rando:t,glyphs:e,hPadding:n},r){let o,s,a;return t&&e&&(o=t(),s=g({hFlip:t()<.5,glyph:p(e,t)})),a=r(),t&&(i.exists(e)&&e.length)>0&&a.length>=2?(n&&(s=m({h:n},s)),y(a,1+o*(a.length-1)|0,s)):a},this.RandomGlyphLines=function({lines:t,rando:e,textProps:n,glyphGroup:r,defaultGlyph:o,font:s,minParagraphLength:a}){let l,u;return l=null,null!=a||(a=this.paragraphLineLength),u=i.reduce(t,(t,e)=>t+e.length,null,0)/t.length,i.array(t,(t,i)=>{let c,h;return t.length>a?v({text:t,font:this.paragraphFont}):(c=v({text:t,font:s},n),h=t.length>u?null:(()=>{switch(l){case"left":return(()=>{switch(2*e()|0){case 0:return null;case 1:return"right"}})();case"right":return(()=>{switch(2*e()|0){case 0:return null;case 1:return"left"}})();default:return(()=>{switch(e()*(1===i?2:3)|0){case 0:return"left";case 1:return"right";case 2:return null}})()}})(),l=h,S("left"===h?g({glyph:this.randomGlyph(e,r,o),hFlip:e()<.5}):void 0,c,"right"===h?g({glyph:this.randomGlyph(e,r,o),hFlip:e()<.5}):void 0))})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Promise","decodeCpf"],[e,n(787),n(957)],(t,e)=>{return i.defClass(class PosterTextAssetLoader extends Object{},function(r,o,s){this.loadingAssetPromises={},this.loadPosterTextAssets=(e=>t.deepAll(i.object(e,t=>{let e,n;return null!=(e=(n=this.loadingAssetPromises)[t])?e:n[t]=this.loadPosterTextAsset(t)}))),this.loadPosterTextAsset=(t=>n(197).getArrayBuffer(`/assets/poster_text/${i.toString(t)}.cpf`).then(t=>e(t).library))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(958))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(959)).includeInNamespace(n(965)).addModules({StandardImport:n(969)}),n(984),n(966),n(970),n(977)},function(t,e,n){t.exports=n(18).addNamespace("Art.CanvasPath",class CanvasPath extends Neptune.PackageNamespace{}._configureNamespace(n(960))),n(961),n(962),n(963),n(964)},function(t){t.exports=JSON.parse('{"author":"Shane Brinkman-Davis Delamore, Imikimi LLC","bin":{"abc":"./cpf-tool"},"dependencies":{"art-build-configurator":"*","canvas":"^2.0.0","canvg":"^2.0.0","jsdom":"^13.0.0","xmldom":"^0.1.27"},"description":"Art.Canvas.Path","devDependencies":{"art-testbench":"*","case-sensitive-paths-webpack-plugin":"^2.2.0","chai":"^4.2.0","mocha":"^6.2.0","mock-fs":"^4.10.0","webpack":"^4.39.1","webpack-cli":"*","webpack-dev-server":"^3.7.2","webpack-merge":"^4.2.1","webpack-node-externals":"^1.7.2","webpack-stylish":"^0.1.8"},"license":"ISC","name":"art-canvas-path","scripts":{"build":"webpack --progress","start":"webpack-dev-server --hot --inline --progress --env.devServer","test":"nn -s;mocha -u tdd","testInBrowser":"webpack-dev-server --progress --env.devServer"},"version":"0.5.2"}')},function(t,e,n){t.exports=n(959).addNamespace("CanvasPathBuilder",class CanvasPathBuilder extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(959).addNamespace("CanvasPathFile",class CanvasPathFile extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(959).addNamespace("Encoding",class Encoding extends Neptune.PackageNamespace{})},function(t,e,n){t.exports=n(959).addNamespace("Extractor",class Extractor extends Neptune.PackageNamespace{})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(966),n(977)])}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(962)).includeInNamespace(n(967)).addModules({CanvasPath:n(974),CanvasPathLibrary:n(975),CanvasPathSet:n(976),StandardImport:n(968)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["isBinary","fromXbd"],[e,n(968),n(167)],(t,e)=>({decodeCpf:function(i){let r;return r=t(i)?e(i):i,new(n(962)[r.name])(r)}})))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(969).mergeWithSelf(n(970)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(42).mergeWithSelf(n(96),n(313),n(476)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(963)).includeInNamespace(n(971)).addModules({EncodingLib:n(972),XbdFactories:n(973)})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>[n(972),n(973)])}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Uint16Array","Uint8Array"],[e,n(42)],(t,e)=>{let n,r;return n={commandMap:r={noop:0,beginPath:1,closePath:2,moveTo:3,lineTo:4,quadraticCurveTo:5,bezierCurveTo:6,arc:7,antiArc:8},commandIdsToNames:i.each2(r,(t,e)=>n[t]=e,null,n=[]),maxFixedPointValue:65535,valueArrayType:t,commandArrayType:e},i.object(r,(t,e)=>t,null,n,(t,e)=>e+"Command"),n}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["createTagFactories"],[e,n(476)],t=>t("CanvasPathSet CanvasPath CanvasPathLibrary")))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","maxFixedPointValue","point","floatEq","Matrix","float32Eq","float32Eq0","merge","CanvasPathTag","rect","max","min","Rectangle","log","noopCommand","beginPathCommand","closePathCommand","moveToCommand","lineToCommand","quadraticCurveToCommand","bezierCurveToCommand","arcCommand","antiArcCommand","parseFloat","commandArrayType","valueArrayType","XbdTag"],[e,n(968)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T)=>{return i.defClass(class CanvasPath extends t{constructor(t){super(...arguments),t instanceof T?this._initFromXbd(t):this._initFromProps(t)}},function(t,T,k){let I,M;this.property("styleProps","points","radii","commands","x","y","aspectRatio","scale","name"),this.getter({size:function(){return this.aspectRatio>1?n(1,1/this.aspectRatio):n(1*this.aspectRatio,1)},aspectRatioMatrix:function(){return(()=>{switch(!1){case!r(this.aspectRatio,1):return o.identifyMatrix;case!(this.aspectRatio>1):return o.scaleXY(1,1/this.aspectRatio);default:return o.scaleXY(1*this.aspectRatio,1)}})()},normalized:function(){return s(this.aspectRatio,1)&&s(this.scale,1)&&a(this.x)&&a(this.y)},props:function(){return l(this.styleProps,{name:this.name,commands:this.commands,points:this.points,radii:this.radii,x:a(this.x)?void 0:this.x,y:a(this.y)?void 0:this.y,scale:s(1,this.scale)?void 0:this.scale,aspectRatio:s(1,this.aspectRatio)?void 0:this.aspectRatio})},inspectedObjects:function(){return{CanvasPath:this.props}},xbd:function(){return u(this.props)},drawArea:function(){let t,e,n,i,r,o,s;for(this._reset(),({x:t,y:e}=this.nextPoint),n=i=t,r=o=e,s=null;s=this.nextPoint;)({x:t,y:e}=s),n=h(n,t),r=h(r,e),i=p(i,t),o=p(o,e);return c(i,o,n-i,r-o)},nextPoint:function(){let t,e,n,i,r,o,s;return({points:t,_scaleY:e,_scaleX:n,_addX:i,_addY:r}=this),this._pointIndex<t.length?{x:(o=t[this._pointIndex++])*n+i,y:(s=t[this._pointIndex++])*e+r}:void 0},nextRadii:function(){return this.radii[this._radiiIndex++]}}),I=1/e,this.prototype.getNextX=function(){return this.points[this._pointIndex++]*I},this.prototype.getNextY=function(){return this.points[this._pointIndex++]*I},this.prototype.removeStyles=function(){return this.styleProps=null},this.prototype.normalize=function(t=this.drawArea){let n,i,r,o,s,a,l;if(0!==this.x||0!==this.y||1!==this.scale||1!==this.aspectRatio||1!==t.area){for(this._reset(),n=this.points,i=0,r=e/t.w,o=t.x,s=e/t.h,a=t.y,l=null;l=this.nextPoint;){let t,e,u,c;({x:t,y:e}=l),n[i++]=u=(t-o)*r+.5|0,n[i++]=c=(e-a)*s+.5|0}this.x=this.y=0,this.scale=1,this.aspectRatio=1}return this},this.prototype.applyPathFit=function(t,e,n){let r,s,a,l,u,c,h,p,d,f;return r=e.top,s=e.left,a=e.w,l=e.h,u=e.aspectRatio,c=this.aspectRatio,i.exists(n)&&(h=n.scale),null!=h||(h=1),p=a,d=l,1<=(f=c/u)?r+=(l-(d=l/f))/2:s+=(a-(p=a*f))/2,null!=h&&(s+=p*(1-h)/2,r+=d*(1-h)/2,p*=h,d*=h),this.applyRawPath(t,o.scaleXY(p,d).translateXY(s,r))},this.prototype.applyRawPath=function(t,e){let r,s,a,l;return r=(()=>{switch(!1){case!i.is(e,o):return e;case!i.is(e,d):return o.scaleXY(e.w,e.h).translateXY(e.x,e.y);default:return o.scale(n(e))}})(),this._reset(),s=this.commands.length,l=(a=0)<s?1:-1,(()=>{for(;l>0&&a<s||l<0&&a>s;){let e,n;e=a,n=this.commands[e],this._applyCommand(n>>4,t,r),this._applyCommand(15&n,t,r),a+=l}})(),s},this.prototype.applyPath=function(t,e){return f.warn("DEPRICATED: Art.CanvasPath.applyPath - use applyRawPath"),this.applyRawPath(t,e)},this.prototype.getNextTransformedPoint=function(t){let e,n;return e=this.getNextX(),n=this.getNextY(),{x:t.transformX(e,n),y:t.transformY(e,n)}},this.prototype._applyCommand=function(t,e,n){let i,r,o,s,a,l,u,c;return(()=>{switch(t){case m:case g:case y:return null;case v:return({x:i,y:r}=this.getNextTransformedPoint(n)),e.moveTo(i,r);case S:return({x:i,y:r}=this.getNextTransformedPoint(n)),e.lineTo(i,r);case b:return({x:o,y:s}=this.getNextTransformedPoint(n)),({x:a,y:l}=this.getNextTransformedPoint(n)),e.quadraticCurveTo(o,s,a,l);case w:return({x:o,y:s}=this.getNextTransformedPoint(n)),({x:a,y:l}=this.getNextTransformedPoint(n)),({x:u,y:c}=this.getNextTransformedPoint(n)),e.bezierCurveTo(o,s,a,l,u,c);case x:return({x:i,y:r}=this.getNextTransformedPoint(n)),e.arcCommand(i,r,this.nextRadii,this.nextRadii,this.nextRadii);case P:return({x:i,y:r}=this.getNextTransformedPoint(n)),e.arcCommand(i,r,this.nextRadii,this.nextRadii,this.nextRadii,!0)}})()},this.prototype._reset=function(){let t,n,i,r,o;return this._pointIndex=this._radiiIndex=this._commandIndex=0,o=this,t=this.x,n=this.y,i=this.aspectRatio,r=this.scale,this._scaleX=this._scaleY=r,i>1?this._scaleY/=i:this._scaleX*=i,this._addX=null!=t?t:0,this._addY=null!=n?n:0,this._scaleX/=e,this._scaleY/=e},this.prototype._initFromProps=function(t){let e,n,i,r;return this.styleProps=M(t),this.points=t.points,this.radii=t.radii,this.commands=t.commands,this.x=C(null!=(e=t.x)?e:0),this.y=C(null!=(n=t.y)?n:0),this.aspectRatio=C(null!=(i=t.aspectRatio)?i:1),this.scale=C(null!=(r=t.scale)?r:1),this.name=t.name,this._reset()},this.prototype._initFromXbd=function(t){let e,n,r,o,s,a,l,u,c,h,p,d,f;return e=(c=t.attrs).commands,n=c.radii,r=c.points,o=c.x,s=c.y,a=c.scale,l=c.aspectRatio,u=c.name,null!=e&&(this.commands=new _(e.binaryString.buffer)),null!=r&&(this.points=new E(r.binaryString.buffer)),null!=n&&(this.radii=new E(n.binaryString.buffer)),this.x=C(null!=(h=i.exists(o)&&o.toString())?h:0),this.y=C(null!=(p=i.exists(s)&&s.toString())?p:0),this.scale=C(null!=(d=i.exists(a)&&a.toString())?d:1),this.aspectRatio=C(null!=(f=i.exists(l)&&l.toString())?f:1),this.name=i.exists(u)&&u.toString(),this.styleProps=i.object(M(t.attrs),(t,e)=>t.toString())},M=function(t){let e,n,i,r,o,s;return l((({fillStyle:e,strokeStyle:n,lineWidth:i,miterLimit:r,lineCap:o,lineJoin:s}=t),{fillStyle:e,strokeStyle:n,lineWidth:i,miterLimit:r,lineCap:o,lineJoin:s}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","rect","CanvasPathLibraryTag","toInspectedObjects","XbdTag"],[e,n(968)],(t,e,r,o,s)=>{return i.defClass(class CanvasPathLibrary extends t{constructor(t){super(...arguments),this._canvasPathSets={},t instanceof s&&this._initFromXbd(t)}},function(t,s,a){this.property("canvasPathSets"),this.getter({drawArea:function(){return i.reduce(this.canvasPathSets,(t,e)=>e.drawArea.unionInto(t),null,e())},xbd:function(){return r(i.array(this.canvasPathSets,(t,e)=>t.xbd))},inspectedObjects:function(){return{CanvasPathLibrary:o(this._canvasPathSets)}},library:function(){return this._canvasPathSets}}),this.prototype.add=function(t,e){return(this.canvasPathSets[t]=e).name=t},this.prototype.normalize=function(){return i.each2(this.canvasPathSets,t=>t.normalize())},this.prototype.flatten=function(){return this._canvasPathSets=i.object(this.canvasPathSets,t=>t.flattened)},this.prototype._initFromXbd=function(t){return i.each2(t.tags,t=>{let e,i;return(e=n(962)[t.name])?(i=new e(t),this._canvasPathSets[i.name]=i):void 0})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","log","CanvasPathSetTag","merge","toInspectedObjects","rect","commandArrayType","valueArrayType","Error","parseFloat","XbdTag","isArray","formattedInspect"],[e,n(968)],(t,e,r,o,s,a,l,u,c,h,p,d,f)=>{return i.defClass(class CanvasPathSet extends t{constructor(t){super(...arguments),this.paths=t instanceof p?this._initFromXbd(t):d(t)?t:null!=t?(()=>{throw new c(`unsupported type constructing CanvasPathSet: ${i.toString(f(t))}`)})():[]}},function(t,p,d){this.property("aspectRatio","name"),this.getter({aspectRatio:function(){let t;return null!=(t=this._aspectRatio)?t:1}}),this.prototype.applyPath=function(t,n){return e.warn("DEPRICATED: Art.CanvasPath.applyPath - use applyRawPath"),this.applyRawPath(t,n)},this.prototype.applyRawPath=function(t,e){return i.each2(this.paths,n=>n.applyRawPath(t,e))},this.getter({xbd:function(){return r(o({aspectRatio:1!==this.aspectRatio?this.aspectRatio:void 0,name:this.name}),i.array(this.paths,t=>t.xbd))},inspectedObjects:function(){return{CanvasPathSet:s(this.paths)}},drawArea:function(){return i.reduce(this.paths,(t,e)=>e.drawArea.unionInto(t),null,a())},flattened:function(){let t,e,r,o,s,a,h,p,d;return t=e=r=0,i.each2(this.paths,({commands:n,radii:o,points:s,normalized:a},l)=>{if(!a)throw new c(`Path not normalized (i=${i.toString(l)})`);return n&&(t+=n.length),s&&(e+=s.length),o?r+=o.length:void 0}),t>0&&(o=new l(t)),e>0&&(s=new u(e)),r>0&&(a=new u(r)),h=p=d=0,i.each2(this.paths,({commands:t,radii:e,points:n},r)=>(i.each2(t,t=>o[h++]=t),i.each2(n,t=>s[p++]=t),i.each2(e,t=>a[d++]=t))),new(n(974))({commands:o,points:s,radii:a,name:this.name,aspectRatio:this.aspectRatio})}}),this.prototype.normalize=function(t=this.drawArea){return i.each2(this.paths,e=>e.normalize(t)),this.aspectRatio=t.aspectRatio,this},this.prototype.removeStyles=function(){return i.each2(this.paths,t=>t.removeStyles())},this.prototype._initFromXbd=function(t){let e,r;return this.aspectRatio=h(null!=(e=t.attrs.aspectRatio.toString())?e:1),this.name=i.exists(r=t.attrs.name)&&r.toString(),i.array(t.tags,t=>new(n(974))(t))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(964)).includeInNamespace(n(978)).addModules({StandardImport:n(979),SvgPathExtractor:n(983)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["log","DOMParser"],[e,n(979),n(980)],(t,e)=>{let r,o,s;return r=function(e,n={}){return i.each2(e.childNodes,e=>{let o;return(o=i.isF(e.getAttribute)&&e.getAttribute("id"))&&(n[o]?t.warn(`named path '${i.toString(o)}' already exists`):n[o]=e),r(e,n)}),n},{extractSvgPath:o=function(t){return(new(n(983))).extract(t)},svgToCanvasPath:s=function(t){return o(t).canvasPath},encodeSvg:s,extractNamedSvgPaths:function(t){let n;return n=(new e).parseFromString(t,"text/xml"),r(n.documentElement)}}}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(969).mergeWithSelf(n(970),n(966)))}).call(this,n(2)(t))},function(t,e,n){function DOMParser(t){this.options=t||{locator:{}}}function DOMHandler(){this.cdata=!1}function position(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function _locator(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function _toString(t,e,n){return"string"==typeof t?t.substr(e,n):t.length>=e+n||e?new java.lang.String(t,e,n)+"":t}function appendElement(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}DOMParser.prototype.parseFromString=function(t,e){var n=this.options,r=new i,o=n.domBuilder||new DOMHandler,s=n.errorHandler,a=n.locator,l=n.xmlns||{},u={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return a&&o.setDocumentLocator(a),r.errorHandler=function buildErrorHandler(t,e,n){if(!t){if(e instanceof DOMHandler)return e;t=e}var i={},r=t instanceof Function;function build(e){var o=t[e];!o&&r&&(o=2==t.length?function(n){t(e,n)}:t),i[e]=o&&function(t){o("[xmldom "+e+"]\t"+t+_locator(n))}||function(){}}return n=n||{},build("warning"),build("error"),build("fatalError"),i}(s,o,a),r.domBuilder=n.domBuilder||o,/\/x?html?$/.test(e)&&(u.nbsp="",u.copy="",l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",t?r.parse(t,l,u):r.errorHandler.error("invalid doc source"),o.doc},DOMHandler.prototype={startDocument:function(){this.doc=(new r).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,n,i){var r=this.doc,o=r.createElementNS(t,n||e),s=i.length;appendElement(this,o),this.currentElement=o,this.locator&&position(this.locator,o);for(var a=0;a<s;a++){t=i.getURI(a);var l=i.getValue(a),u=(n=i.getQName(a),r.createAttributeNS(t,n));this.locator&&position(i.getLocator(a),u),u.value=u.nodeValue=l,o.setAttributeNode(u)}},endElement:function(t,e,n){var i=this.currentElement;i.tagName;this.currentElement=i.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var n=this.doc.createProcessingInstruction(t,e);this.locator&&position(this.locator,n),appendElement(this,n)},ignorableWhitespace:function(t,e,n){},characters:function(t,e,n){if(t=_toString.apply(this,arguments)){if(this.cdata)var i=this.doc.createCDATASection(t);else i=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(i):/^\s*$/.test(t)&&this.doc.appendChild(i),this.locator&&position(this.locator,i)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,n){t=_toString.apply(this,arguments);var i=this.doc.createComment(t);this.locator&&position(this.locator,i),appendElement(this,i)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,n){var i=this.doc.implementation;if(i&&i.createDocumentType){var r=i.createDocumentType(t,e,n);this.locator&&position(this.locator,r),appendElement(this,r)}},warning:function(t){console.warn("[xmldom warning]\t"+t,_locator(this.locator))},error:function(t){console.error("[xmldom error]\t"+t,_locator(this.locator))},fatalError:function(t){throw console.error("[xmldom fatalError]\t"+t,_locator(this.locator)),t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){DOMHandler.prototype[t]=function(){return null}});var i=n(981).XMLReader,r=e.DOMImplementation=n(982).DOMImplementation;e.XMLSerializer=n(982).XMLSerializer,e.DOMParser=DOMParser},function(t,e){var n=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,i=new RegExp("[\\-\\.0-9"+n.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),r=new RegExp("^"+n.source+i.source+"*(?::"+n.source+i.source+"*)?$"),o=0,s=1,a=2,l=3,u=4,c=5,h=6,p=7;function XMLReader(){}function copyLocator(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function parseElementStartPart(t,e,n,i,r,d){for(var f,m=++e,g=o;;){var y=t.charAt(m);switch(y){case"=":if(g===s)f=t.slice(e,m),g=l;else{if(g!==a)throw new Error("attribute equal must after attrName");g=l}break;case"'":case'"':if(g===l||g===s){if(g===s&&(d.warning('attribute value must after "="'),f=t.slice(e,m)),e=m+1,!((m=t.indexOf(y,e))>0))throw new Error("attribute value no end '"+y+"' match");v=t.slice(e,m).replace(/&#?\w+;/g,r),n.add(f,v,e-1),g=c}else{if(g!=u)throw new Error('attribute value must after "="');v=t.slice(e,m).replace(/&#?\w+;/g,r),n.add(f,v,e),d.warning('attribute "'+f+'" missed start quot('+y+")!!"),e=m+1,g=c}break;case"/":switch(g){case o:n.setTagName(t.slice(e,m));case c:case h:case p:g=p,n.closed=!0;case u:case s:case a:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return d.error("unexpected end of input"),g==o&&n.setTagName(t.slice(e,m)),m;case">":switch(g){case o:n.setTagName(t.slice(e,m));case c:case h:case p:break;case u:case s:"/"===(v=t.slice(e,m)).slice(-1)&&(n.closed=!0,v=v.slice(0,-1));case a:g===a&&(v=f),g==u?(d.warning('attribute "'+v+'" missed quot(")!!'),n.add(f,v.replace(/&#?\w+;/g,r),e)):("http://www.w3.org/1999/xhtml"===i[""]&&v.match(/^(?:disabled|checked|selected)$/i)||d.warning('attribute "'+v+'" missed value!! "'+v+'" instead!!'),n.add(v,v,e));break;case l:throw new Error("attribute value missed!!")}return m;case"":y=" ";default:if(y<=" ")switch(g){case o:n.setTagName(t.slice(e,m)),g=h;break;case s:f=t.slice(e,m),g=a;break;case u:var v=t.slice(e,m).replace(/&#?\w+;/g,r);d.warning('attribute "'+v+'" missed quot(")!!'),n.add(f,v,e);case c:g=h}else switch(g){case a:n.tagName;"http://www.w3.org/1999/xhtml"===i[""]&&f.match(/^(?:disabled|checked|selected)$/i)||d.warning('attribute "'+f+'" missed value!! "'+f+'" instead2!!'),n.add(f,f,e),e=m,g=s;break;case c:d.warning('attribute space is required"'+f+'"!!');case h:g=s,e=m;break;case l:g=u,e=m;break;case p:throw new Error("elements closed character '/' and '>' must be connected to")}}m++}}function appendElement(t,e,n){for(var i=t.tagName,r=null,o=t.length;o--;){var s=t[o],a=s.qName,l=s.value;if((p=a.indexOf(":"))>0)var u=s.prefix=a.slice(0,p),c=a.slice(p+1),h="xmlns"===u&&c;else c=a,u=null,h="xmlns"===a&&"";s.localName=c,!1!==h&&(null==r&&(r={},_copy(n,n={})),n[h]=r[h]=l,s.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(h,l))}for(o=t.length;o--;){(u=(s=t[o]).prefix)&&("xml"===u&&(s.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(s.uri=n[u||""]))}var p;(p=i.indexOf(":"))>0?(u=t.prefix=i.slice(0,p),c=t.localName=i.slice(p+1)):(u=null,c=t.localName=i);var d=t.uri=n[u||""];if(e.startElement(d,c,i,t),!t.closed)return t.currentNSMap=n,t.localNSMap=r,!0;if(e.endElement(d,c,i),r)for(u in r)e.endPrefixMapping(u)}function parseHtmlSpecialContent(t,e,n,i,r){if(/^(?:script|textarea)$/i.test(n)){var o=t.indexOf("</"+n+">",e),s=t.substring(e+1,o);if(/[&<]/.test(s))return/^script$/i.test(n)?(r.characters(s,0,s.length),o):(s=s.replace(/&#?\w+;/g,i),r.characters(s,0,s.length),o)}return e+1}function fixSelfClosed(t,e,n,i){var r=i[n];return null==r&&((r=t.lastIndexOf("</"+n+">"))<e&&(r=t.lastIndexOf("</"+n)),i[n]=r),r<e}function _copy(t,e){for(var n in t)e[n]=t[n]}function parseDCC(t,e,n,i){switch(t.charAt(e+2)){case"-":return"-"===t.charAt(e+3)?(r=t.indexOf("--\x3e",e+4))>e?(n.comment(t,e+4,r-e-4),r+3):(i.error("Unclosed comment"),-1):-1;default:if("CDATA["==t.substr(e+3,6)){var r=t.indexOf("]]>",e+9);return n.startCDATA(),n.characters(t,e+9,r-e-9),n.endCDATA(),r+3}var o=function split(t,e){var n,i=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;r.lastIndex=e,r.exec(t);for(;n=r.exec(t);)if(i.push(n),n[1])return i}(t,e),s=o.length;if(s>1&&/!doctype/i.test(o[0][0])){var a=o[1][0],l=s>3&&/^public$/i.test(o[2][0])&&o[3][0],u=s>4&&o[4][0],c=o[s-1];return n.startDTD(a,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),u&&u.replace(/^(['"])(.*?)\1$/,"$2")),n.endDTD(),c.index+c[0].length}}return-1}function parseInstruction(t,e,n){var i=t.indexOf("?>",e);if(i){var r=t.substring(e,i).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(r){r[0].length;return n.processingInstruction(r[1],r[2]),i+2}return-1}return-1}function ElementAttributes(t){}function _set_proto_(t,e){return t.__proto__=e,t}XMLReader.prototype={parse:function(t,e,n){var i=this.domBuilder;i.startDocument(),_copy(e,e={}),function parse(t,e,n,i,r){function entityReplacer(t){var e=t.slice(1,-1);return e in n?n[e]:"#"===e.charAt(0)?function fixedFromCharCode(t){if(t>65535){var e=55296+((t-=65536)>>10),n=56320+(1023&t);return String.fromCharCode(e,n)}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(r.error("entity not found:"+t),t)}function appendText(e){if(e>h){var n=t.substring(h,e).replace(/&#?\w+;/g,entityReplacer);l&&position(h),i.characters(n,0,e-h),h=e}}function position(e,n){for(;e>=s&&(n=a.exec(t));)o=n.index,s=o+n[0].length,l.lineNumber++;l.columnNumber=e-o+1}var o=0,s=0,a=/.*(?:\r\n?|\n)|.*$/g,l=i.locator,u=[{currentNSMap:e}],c={},h=0;for(;;){try{var p=t.indexOf("<",h);if(p<0){if(!t.substr(h).match(/^\s*$/)){var d=i.doc,f=d.createTextNode(t.substr(h));d.appendChild(f),i.currentElement=f}return}switch(p>h&&appendText(p),t.charAt(p+1)){case"/":var m=t.indexOf(">",p+3),g=t.substring(p+2,m),y=u.pop();m<0?(g=t.substring(p+2).replace(/[\s<].*/,""),r.error("end tag name: "+g+" is not complete:"+y.tagName),m=p+1+g.length):g.match(/\s</)&&(g=g.replace(/[\s<].*/,""),r.error("end tag name: "+g+" maybe not complete"),m=p+1+g.length);var v=y.localNSMap,S=y.tagName==g,b=S||y.tagName&&y.tagName.toLowerCase()==g.toLowerCase();if(b){if(i.endElement(y.uri,y.localName,g),v)for(var w in v)i.endPrefixMapping(w);S||r.fatalError("end tag name: "+g+" is not match the current start tagName:"+y.tagName)}else u.push(y);m++;break;case"?":l&&position(p),m=parseInstruction(t,p,i);break;case"!":l&&position(p),m=parseDCC(t,p,i,r);break;default:l&&position(p);var x=new ElementAttributes,P=u[u.length-1].currentNSMap,m=parseElementStartPart(t,p,x,P,entityReplacer,r),C=x.length;if(!x.closed&&fixSelfClosed(t,m,x.tagName,c)&&(x.closed=!0,n.nbsp||r.warning("unclosed xml attribute")),l&&C){for(var _=copyLocator(l,{}),E=0;E<C;E++){var T=x[E];position(T.offset),T.locator=copyLocator(l,{})}i.locator=_,appendElement(x,i,P)&&u.push(x),i.locator=l}else appendElement(x,i,P)&&u.push(x);"http://www.w3.org/1999/xhtml"!==x.uri||x.closed?m++:m=parseHtmlSpecialContent(t,m,x.tagName,entityReplacer,i)}}catch(t){r.error("element parse error: "+t),m=-1}m>h?h=m:appendText(Math.max(p,h)+1)}}(t,e,n,i,this.errorHandler),i.endDocument()}},ElementAttributes.prototype={setTagName:function(t){if(!r.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,n){if(!r.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:n}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},_set_proto_({},_set_proto_.prototype)instanceof _set_proto_||(_set_proto_=function(t,e){function p(){}for(e in p.prototype=e,p=new p,t)p[e]=t[e];return p}),e.XMLReader=XMLReader},function(e,n){function copy(t,e){for(var n in t)e[n]=t[n]}function _extends(e,n){var i=e.prototype;if(Object.create){var r=Object.create(n.prototype);i.__proto__=r}if(!(i instanceof n)){function t(){}t.prototype=n.prototype,copy(i,t=new t),e.prototype=i=t}i.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),i.constructor=e)}var i="http://www.w3.org/1999/xhtml",r={},o=r.ELEMENT_NODE=1,s=r.ATTRIBUTE_NODE=2,a=r.TEXT_NODE=3,l=r.CDATA_SECTION_NODE=4,u=r.ENTITY_REFERENCE_NODE=5,c=r.ENTITY_NODE=6,h=r.PROCESSING_INSTRUCTION_NODE=7,p=r.COMMENT_NODE=8,d=r.DOCUMENT_NODE=9,f=r.DOCUMENT_TYPE_NODE=10,m=r.DOCUMENT_FRAGMENT_NODE=11,g=r.NOTATION_NODE=12,y={},v={},S=(y.INDEX_SIZE_ERR=(v[1]="Index size error",1),y.DOMSTRING_SIZE_ERR=(v[2]="DOMString size error",2),y.HIERARCHY_REQUEST_ERR=(v[3]="Hierarchy request error",3)),b=(y.WRONG_DOCUMENT_ERR=(v[4]="Wrong document",4),y.INVALID_CHARACTER_ERR=(v[5]="Invalid character",5),y.NO_DATA_ALLOWED_ERR=(v[6]="No data allowed",6),y.NO_MODIFICATION_ALLOWED_ERR=(v[7]="No modification allowed",7),y.NOT_FOUND_ERR=(v[8]="Not found",8)),w=(y.NOT_SUPPORTED_ERR=(v[9]="Not supported",9),y.INUSE_ATTRIBUTE_ERR=(v[10]="Attribute in use",10));y.INVALID_STATE_ERR=(v[11]="Invalid state",11),y.SYNTAX_ERR=(v[12]="Syntax error",12),y.INVALID_MODIFICATION_ERR=(v[13]="Invalid modification",13),y.NAMESPACE_ERR=(v[14]="Invalid namespace",14),y.INVALID_ACCESS_ERR=(v[15]="Invalid access",15);function DOMException(t,e){if(e instanceof Error)var n=e;else n=this,Error.call(this,v[t]),this.message=v[t],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return n.code=t,e&&(this.message=this.message+": "+e),n}function NodeList(){}function LiveNodeList(t,e){this._node=t,this._refresh=e,_updateLiveList(this)}function _updateLiveList(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var n=t._refresh(t._node);__set__(t,"length",n.length),copy(n,t),t._inc=e}}function NamedNodeMap(){}function _findNodeIndex(t,e){for(var n=t.length;n--;)if(t[n]===e)return n}function _addNamedNode(t,e,n,i){if(i?e[_findNodeIndex(e,i)]=n:e[e.length++]=n,t){n.ownerElement=t;var r=t.ownerDocument;r&&(i&&_onRemoveAttribute(r,t,i),function _onAddAttribute(t,e,n){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(e._nsMap[n.prefix?n.localName:""]=n.value)}(r,t,n))}}function _removeNamedNode(t,e,n){var i=_findNodeIndex(e,n);if(!(i>=0))throw DOMException(b,new Error(t.tagName+"@"+n));for(var r=e.length-1;i<r;)e[i]=e[++i];if(e.length=r,t){var o=t.ownerDocument;o&&(_onRemoveAttribute(o,t,n),n.ownerElement=null)}}function DOMImplementation(t){if(this._features={},t)for(var e in t)this._features=t[e]}function Node(){}function _xmlEncoder(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function _visitNode(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(_visitNode(t,e))return!0}while(t=t.nextSibling)}function Document(){}function _onRemoveAttribute(t,e,n,i){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete e._nsMap[n.prefix?n.localName:""]}function _onUpdateChild(t,e,n){if(t&&t._inc){t._inc++;var i=e.childNodes;if(n)i[i.length++]=n;else{for(var r=e.firstChild,o=0;r;)i[o++]=r,r=r.nextSibling;i.length=o}}}function _removeChild(t,e){var n=e.previousSibling,i=e.nextSibling;return n?n.nextSibling=i:t.firstChild=i,i?i.previousSibling=n:t.lastChild=n,_onUpdateChild(t.ownerDocument,t),e}function _insertBefore(t,e,n){var i=e.parentNode;if(i&&i.removeChild(e),e.nodeType===m){var r=e.firstChild;if(null==r)return e;var o=e.lastChild}else r=o=e;var s=n?n.previousSibling:t.lastChild;r.previousSibling=s,o.nextSibling=n,s?s.nextSibling=r:t.firstChild=r,null==n?t.lastChild=o:n.previousSibling=o;do{r.parentNode=t}while(r!==o&&(r=r.nextSibling));return _onUpdateChild(t.ownerDocument||t,t),e.nodeType==m&&(e.firstChild=e.lastChild=null),e}function Element(){this._nsMap={}}function Attr(){}function CharacterData(){}function Text(){}function Comment(){}function CDATASection(){}function DocumentType(){}function Notation(){}function Entity(){}function EntityReference(){}function DocumentFragment(){}function ProcessingInstruction(){}function XMLSerializer(){}function nodeSerializeToString(t,e){var n=[],i=9==this.nodeType?this.documentElement:this,r=i.prefix,o=i.namespaceURI;if(o&&null==r&&null==(r=i.lookupPrefix(o)))var s=[{namespace:o,prefix:null}];return serializeToString(this,n,t,e,s),n.join("")}function needNamespaceDefine(t,e,n){var i=t.prefix||"",r=t.namespaceURI;if(!i&&!r)return!1;if("xml"===i&&"http://www.w3.org/XML/1998/namespace"===r||"http://www.w3.org/2000/xmlns/"==r)return!1;for(var o=n.length;o--;){var s=n[o];if(s.prefix==i)return s.namespace!=r}return!0}function serializeToString(t,e,n,r,c){if(r){if(!(t=r(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case o:c||(c=[]);c.length;var g=t.attributes,y=g.length,v=t.firstChild,S=t.tagName;n=i===t.namespaceURI||n,e.push("<",S);for(var b=0;b<y;b++){"xmlns"==(w=g.item(b)).prefix?c.push({prefix:w.localName,namespace:w.value}):"xmlns"==w.nodeName&&c.push({prefix:"",namespace:w.value})}for(b=0;b<y;b++){var w;if(needNamespaceDefine(w=g.item(b),0,c)){var x=w.prefix||"",P=w.namespaceURI,C=x?" xmlns:"+x:" xmlns";e.push(C,'="',P,'"'),c.push({prefix:x,namespace:P})}serializeToString(w,e,n,r,c)}if(needNamespaceDefine(t,0,c)){x=t.prefix||"",P=t.namespaceURI,C=x?" xmlns:"+x:" xmlns";e.push(C,'="',P,'"'),c.push({prefix:x,namespace:P})}if(v||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(S)){if(e.push(">"),n&&/^script$/i.test(S))for(;v;)v.data?e.push(v.data):serializeToString(v,e,n,r,c),v=v.nextSibling;else for(;v;)serializeToString(v,e,n,r,c),v=v.nextSibling;e.push("</",S,">")}else e.push("/>");return;case d:case m:for(v=t.firstChild;v;)serializeToString(v,e,n,r,c),v=v.nextSibling;return;case s:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,_xmlEncoder),'"');case a:return e.push(t.data.replace(/[<&]/g,_xmlEncoder));case l:return e.push("<![CDATA[",t.data,"]]>");case p:return e.push("\x3c!--",t.data,"--\x3e");case f:var _=t.publicId,E=t.systemId;if(e.push("<!DOCTYPE ",t.name),_)e.push(' PUBLIC "',_),E&&"."!=E&&e.push('" "',E),e.push('">');else if(E&&"."!=E)e.push(' SYSTEM "',E,'">');else{var T=t.internalSubset;T&&e.push(" [",T,"]"),e.push(">")}return;case h:return e.push("<?",t.target," ",t.data,"?>");case u:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function __set__(t,e,n){t[e]=n}DOMException.prototype=Error.prototype,copy(y,DOMException),NodeList.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var n=[],i=0;i<this.length;i++)serializeToString(this[i],n,t,e);return n.join("")}},LiveNodeList.prototype.item=function(t){return _updateLiveList(this),this[t]},_extends(LiveNodeList,NodeList),NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var n=this[e];if(n.nodeName==t)return n}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new DOMException(w);var n=this.getNamedItem(t.nodeName);return _addNamedNode(this._ownerElement,this,t,n),n},setNamedItemNS:function(t){var e,n=t.ownerElement;if(n&&n!=this._ownerElement)throw new DOMException(w);return e=this.getNamedItemNS(t.namespaceURI,t.localName),_addNamedNode(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return _removeNamedNode(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var n=this.getNamedItemNS(t,e);return _removeNamedNode(this._ownerElement,this,n),n},getNamedItemNS:function(t,e){for(var n=this.length;n--;){var i=this[n];if(i.localName==e&&i.namespaceURI==t)return i}return null}},DOMImplementation.prototype={hasFeature:function(t,e){var n=this._features[t.toLowerCase()];return!(!n||e&&!(e in n))},createDocument:function(t,e,n){var i=new Document;if(i.implementation=this,i.childNodes=new NodeList,i.doctype=n,n&&i.appendChild(n),e){var r=i.createElementNS(t,e);i.appendChild(r)}return i},createDocumentType:function(t,e,n){var i=new DocumentType;return i.name=t,i.nodeName=t,i.publicId=e,i.systemId=n,i}},Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return _insertBefore(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return _removeChild(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function cloneNode(t,e,n){var i=new e.constructor;for(var r in e){var a=e[r];"object"!=typeof a&&a!=i[r]&&(i[r]=a)}e.childNodes&&(i.childNodes=new NodeList);i.ownerDocument=t;switch(i.nodeType){case o:var l=e.attributes,u=i.attributes=new NamedNodeMap,c=l.length;u._ownerElement=i;for(var h=0;h<c;h++)i.setAttributeNode(cloneNode(t,l.item(h),!0));break;case s:n=!0}if(n)for(var p=e.firstChild;p;)i.appendChild(cloneNode(t,p,n)),p=p.nextSibling;return i}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==a&&t.nodeType==a?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var n=e._nsMap;if(n)for(var i in n)if(n[i]==t)return i;e=e.nodeType==s?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var n=e._nsMap;if(n&&t in n)return n[t];e=e.nodeType==s?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},copy(r,Node),copy(r,Node.prototype),Document.prototype={nodeName:"#document",nodeType:d,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==m){for(var n=t.firstChild;n;){var i=n.nextSibling;this.insertBefore(n,e),n=i}return t}return null==this.documentElement&&t.nodeType==o&&(this.documentElement=t),_insertBefore(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),_removeChild(this,t)},importNode:function(t,e){return function importNode(t,e,n){var i;switch(e.nodeType){case o:(i=e.cloneNode(!1)).ownerDocument=t;case m:break;case s:n=!0}i||(i=e.cloneNode(!1));i.ownerDocument=t;i.parentNode=null;if(n)for(var r=e.firstChild;r;)i.appendChild(importNode(t,r,n)),r=r.nextSibling;return i}(this,t,e)},getElementById:function(t){var e=null;return _visitNode(this.documentElement,function(n){if(n.nodeType==o&&n.getAttribute("id")==t)return e=n,!0}),e},createElement:function(t){var e=new Element;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new NodeList,(e.attributes=new NamedNodeMap)._ownerElement=e,e},createDocumentFragment:function(){var t=new DocumentFragment;return t.ownerDocument=this,t.childNodes=new NodeList,t},createTextNode:function(t){var e=new Text;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new Comment;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new CDATASection;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var n=new ProcessingInstruction;return n.ownerDocument=this,n.tagName=n.target=t,n.nodeValue=n.data=e,n},createAttribute:function(t){var e=new Attr;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new EntityReference;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var n=new Element,i=e.split(":"),r=n.attributes=new NamedNodeMap;return n.childNodes=new NodeList,n.ownerDocument=this,n.nodeName=e,n.tagName=e,n.namespaceURI=t,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=e,r._ownerElement=n,n},createAttributeNS:function(t,e){var n=new Attr,i=e.split(":");return n.ownerDocument=this,n.nodeName=e,n.name=e,n.namespaceURI=t,n.specified=!0,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=e,n}},_extends(Document,Node),Element.prototype={nodeType:o,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var n=this.ownerDocument.createAttribute(t);n.value=n.nodeValue=""+e,this.setAttributeNode(n)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===m?this.insertBefore(t,null):function _appendSingleChild(t,e){var n=e.parentNode;if(n){var i=t.lastChild;n.removeChild(e),i=t.lastChild}return i=t.lastChild,e.parentNode=t,e.previousSibling=i,e.nextSibling=null,i?i.nextSibling=e:t.firstChild=e,t.lastChild=e,_onUpdateChild(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);n&&this.removeAttributeNode(n)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);return n&&n.value||""},setAttributeNS:function(t,e,n){var i=this.ownerDocument.createAttributeNS(t,e);i.value=i.nodeValue=""+n,this.setAttributeNode(i)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new LiveNodeList(this,function(e){var n=[];return _visitNode(e,function(i){i===e||i.nodeType!=o||"*"!==t&&i.tagName!=t||n.push(i)}),n})},getElementsByTagNameNS:function(t,e){return new LiveNodeList(this,function(n){var i=[];return _visitNode(n,function(r){r===n||r.nodeType!==o||"*"!==t&&r.namespaceURI!==t||"*"!==e&&r.localName!=e||i.push(r)}),i})}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node),Attr.prototype.nodeType=s,_extends(Attr,Node),CharacterData.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(v[S])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,n){n=this.data.substring(0,t)+n+this.data.substring(t+e),this.nodeValue=this.data=n,this.length=n.length}},_extends(CharacterData,Node),Text.prototype={nodeName:"#text",nodeType:a,splitText:function(t){var e=this.data,n=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var i=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(i,this.nextSibling),i}},_extends(Text,CharacterData),Comment.prototype={nodeName:"#comment",nodeType:p},_extends(Comment,CharacterData),CDATASection.prototype={nodeName:"#cdata-section",nodeType:l},_extends(CDATASection,CharacterData),DocumentType.prototype.nodeType=f,_extends(DocumentType,Node),Notation.prototype.nodeType=g,_extends(Notation,Node),Entity.prototype.nodeType=c,_extends(Entity,Node),EntityReference.prototype.nodeType=u,_extends(EntityReference,Node),DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=m,_extends(DocumentFragment,Node),ProcessingInstruction.prototype.nodeType=h,_extends(ProcessingInstruction,Node),XMLSerializer.prototype.serializeToString=function(t,e,n){return nodeSerializeToString.call(t,e,n)},Node.prototype.toString=nodeSerializeToString;try{if(Object.defineProperty){Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return function getTextContent(t){switch(t.nodeType){case o:case m:var e=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&e.push(getTextContent(t)),t=t.nextSibling;return e.join("");default:return t.nodeValue}}(this)},set:function(t){switch(this.nodeType){case o:case m:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),__set__=function(t,e,n){t["$$"+e]=n}}}catch(t){}n.DOMImplementation=DOMImplementation,n.XMLSerializer=XMLSerializer},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","IntermediateCanvasPath","peek","rect","CanvasPathSet","Builder"],[e,n(979),n(984)],(t,e,r,o,s,a)=>{return i.defClass(class SvgPathExtractor extends t{constructor(){super(...arguments),this._paths=[new e]}},function(t,l,u){this.prototype._advancePath=function(){let t;return this._paths.push(t=new e),t},this.prototype.advancePathIfPainted=function(){return this.currentPath.painted?this._advancePath():this.currentPath},this.getter("paths",{currentPath:function(){return r(this._paths)},drawArea:function(){let t;return t=o(),i.each2(this.paths,e=>e.drawArea.unionInto(t)),t},inspectedObjects:function(){return{SvgPathExtractor:{currentPath:this.currentPath.inspectedObjects}}},canvasPath:function(){return new s(i.array(this.paths,t=>t.canvasPath))},xbd:function(){return this.canvasPath.xbd}}),this.prototype.extract=function(t){return n(989)(new a(this),t,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0}),i.each2(this.paths,t=>t.resolveMatrix()),this}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(961)).addModules({Builder:n(985),IntermediateCanvasPath:n(987),IntermediateCanvasPathSet:n(988),StandardImport:n(986)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseObject","matrix","peek","Error"],[e,n(986)],(t,e,n,r)=>{let o,s;return o=i.defClass(class ContextState extends t{constructor(t){super(...arguments),t?(this.fillStyle=t.fillStyle,this.strokeStyle=t.strokeStyle,this.lineWidth=t.lineWidth,this.miterLimit=t.miterLimit,this.lineCap=t.lineCap,this.lineJoin=t.lineJoin,this.matrix=t.matrix):(this.fillStyle,this.strokeStyle,this.lineWidth,this.miterLimit,this.lineCap,this.lineJoin=null,this.matrix=e())}},function(t,e,n){this.property("fillStyle","strokeStyle","lineWidth","miterLimit","lineCap","lineJoin","matrix")}),s=i.defClass(class CanvgCanvasContext2dMock extends t{constructor(t,e){super(...arguments),this.canvas=t,this.svgPathExtractor=e,this.stateStack=[new o]}},function(t,i,s){let a;this.prototype.save=function(){return this.stateStack.push(new o(this.currentState))},this.prototype.restore=function(){return this.stateStack.pop()},a="rgba(0,0,0,0)",this.prototype.fill=function(t){let e;return null!=this.fillStyle&&"rgba(0,0,0,0)"!==this.fillStyle?(({currentPath:e}=this.svgPathExtractor),null!=t||(t="nonzero"),e.fillRule="nonzero"===t?void 0:"evenodd",e.fillStyle=this.fillStyle,e.matrix=this.matrix):void 0},this.prototype.stroke=function(){let t;return this.strokeStyle&&"rgba(0,0,0,0)"!==this.strokeStyle?(({currentPath:t}=this.svgPathExtractor),t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.miterLimit=this.miterLimit,t.lineCap=this.lineCap,t.lineJoin=this._lineJoin,t.matrix=this.matrix):void 0},this.getter({currentState:function(){return n(this.stateStack)},currentPath:function(){return this.svgPathExtractor.currentPath},fillStyle:function(){return this.currentState.fillStyle},strokeStyle:function(){return this.currentState.strokeStyle},lineWidth:function(){return this.currentState.lineWidth},miterLimit:function(){return this.currentState.miterLimit},lineCap:function(){return this.currentState.lineCap},lineJoin:function(){return this.currentState.lineJoin},matrix:function(){return this.currentState.matrix},width:function(){return(()=>{throw new r("can't get width on this")})()},height:function(){return(()=>{throw new r("can't get height on this")})()}}),this.setter({fillStyle:function(t){return this.currentState.fillStyle=t},strokeStyle:function(t){return this.currentState.strokeStyle=t},lineWidth:function(t){return this.currentState.lineWidth=t},miterLimit:function(t){return this.currentState.miterLimit=t},lineCap:function(t){return this.currentState.lineCap=t},lineJoin:function(t){return this.currentState.lineJoin=t},matrix:function(t){return this.currentState.matrix=t},globalAlpha:function(t){return t<254/256?(()=>{throw new r("NOT SUPPORTED: globalAlpha???")})():void 0},globalCompositeOperation:function(){return(()=>{throw new r("NOT SUPPORTED: globalCompositeOperation???")})()}}),this.prototype.translate=function(t,e){return this.matrix=this.matrix.translateXY(t,e)},this.prototype.scale=function(t,e){return this.matrix=this.matrix.scaleXY(t,e)},this.prototype.transform=function(t,n,i,r,o,s){return this.matrix=e(t,r,i,n,o,s).mul(this.matrix)},this.prototype.beginPath=function(){return this.svgPathExtractor.currentPath.beginPath()},this.prototype.moveTo=function(t,e){return this.svgPathExtractor.currentPath.moveTo(t,e)},this.prototype.lineTo=function(){},this.prototype.closePath=function(){},this.prototype.beginPath=function(){return this.svgPathExtractor.advancePathIfPainted().beginPath()},this.prototype.closePath=function(){return this.svgPathExtractor.advancePathIfPainted().closePath()},this.prototype.moveTo=function(t,e){return this.svgPathExtractor.advancePathIfPainted().moveTo(t,e)},this.prototype.lineTo=function(t,e){return this.svgPathExtractor.advancePathIfPainted().lineTo(t,e)},this.prototype.quadraticCurveTo=function(t,e,n,i){return this.svgPathExtractor.advancePathIfPainted().quadraticCurveTo(t,e,n,i)},this.prototype.bezierCurveTo=function(t,e,n,i,r,o){return this.svgPathExtractor.advancePathIfPainted().bezierCurveTo(t,e,n,i,r,o)},this.prototype.arc=function(t,e,n,i,r,o){return this.svgPathExtractor.advancePathIfPainted().arc(t,e,n,i,r,o)}}),i.defClass(class Builder extends Object{constructor(t){super(...arguments),this.svgPathExtractor=t}},function(t,e,n){this.prototype.getContext=function(){return new s(this,this.svgPathExtractor)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(969).mergeWithSelf(n(970),n(966)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","rect","max","min","valueArrayType","maxFixedPointValue","Math","commandArrayType","CanvasPath","merge","commandMap"],[e,n(986)],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class IntermediateCanvasPath extends t{constructor(){super(...arguments),this._originalMaxX=0,this._originalMaxY=0,this._originalMinX=0,this._originalMinY=0,this._commands=[],this._pointData=[],this._radiiData=[]}},function(t,p,d){this.getter("originalMaxX","originalMaxY","originalMinX","originalMinY","pointCount",{originalMax:function(){return[this._originalMaxX,this._originalMaxY]},originalMin:function(){return[this._originalMinX,this._originalMinY]}},"pointData","commands",{inspectedObjects:function(){return{svgPath:{originalMin:this.originalMin,originalMax:this.originalMax,pointCount:this.pointCount,pointData:this.pointData,commands:this.commands}}}}),this.property("fillStyle","strokeStyle","lineWidth","miterLimit","lineCap","lineJoin","matrix"),this.getter({stroke:function(){return null!=this.strokeStyle},fill:function(){return null!=this.fillStyle},drawArea:function(){return e(this._originalMinX,this._originalMinY,this._originalMaxX-this._originalMinX,this._originalMaxY-this._originalMinY)}}),this.prototype._addPoint=function(t,e){return 0===this._pointData.length?(this._originalMaxX=this._originalMinX=t,this._originalMaxY=this._originalMinY=e):(this._originalMaxX=n(t,this._originalMaxX),this._originalMaxY=n(e,this._originalMaxY),this._originalMinX=r(t,this._originalMinX),this._originalMinY=r(e,this._originalMinY)),this._pointData.push(t),this._pointData.push(e)},this.prototype.resolveMatrix=function(){let t,e,n,i,r,o,s;return(t=this.matrix)?(e=this._pointData,this._pointData=[],i=n=e,null!=n&&(r=n.length,o=0,(()=>{for(;o<r;){let i,r,a;i=n[o],a=e[(r=o)+1],this._addPoint(t.transformX(i,a),t.transformY(i,a)),s=o+=2}})()),this.matrix=void 0):void 0},this.getter({painted:function(){return this.stroke||this.fill},encodedPointData:function(){let t,e,n,i,r,a,l,u,c,h;return this._pointData.length>0?(t=new o(this._pointData.length),e=this._originalMinX,n=this._originalMinY,i=s/(this._originalMaxX-this._originalMinX),r=s/(this._originalMaxY-this._originalMinY),l=a=this._pointData,null!=a&&(u=a.length,c=0,(()=>{for(;c<u;){let o,s,l;o=a[c],s=c,l=this._pointData[s+1],t[s]=i*(o-e)+.5|0,t[s+1]=r*(l-n)+.5|0,h=c+=2}})()),t):void 0},encodedRadiiData:function(){let t,e,n,r,l,u,c;return this._radiiData.length>0?(t=new o(this._radiiData.length),e=s/a.PI*2,r=n=this._radiiData,null!=n&&(l=n.length,u=0,(()=>{for(;u<l;){let r,o;r=n[u],t[o=u]=0|i.mod(e*r,s),c=u++}})()),t):void 0},encodedCommands:function(){let t,e,n,i,r,o;return this._commands.length>0?(e=this._commands,n=t=new l(a.ceil(this._commands.length/2)),null!=e&&(i=e.length,r=0,(()=>{for(;r<i;){let n,i,s,a;n=e[r],i=r,s=null!=(a=this._commands[i+1])?a:0,t[i/2]=(n<<4)+s,o=r+=2}})()),n):void 0},originalX:function(){return this._originalMinX},originalY:function(){return this._originalMinY},originalWidth:function(){return this._originalMaxX-this._originalMinX},originalHeight:function(){return this._originalMaxY-this._originalMinY},originalScale:function(){return n(this.originalWidth,this.originalHeight)},encodedWidth:function(){return this.originalWidth/this.originalScale},encodedHeight:function(){return this.originalHeight/this.originalScale},aspectRatio:function(){return this.originalWidth/this.originalHeight},canvasPath:function(){return new u(c({points:this.encodedPointData,radii:this.encodedRadiiData,commands:this.encodedCommands,aspectRatio:this.aspectRatio,x:this.originalX,y:this.originalY,scale:this.originalScale,fillStyle:this.fillStyle,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth,miterLimit:this.miterLimit,lineCap:this.lineCap,lineJoin:this.lineJoin,matrix:this.matrix}))}}),this.prototype._addRadius=function(t){return this._radiiData.push(t)},this.prototype._addCommand=function(t){return this._commands.push(h[t])},this.prototype.beginPath=function(){},this.prototype.closePath=function(){},this.prototype.moveTo=function(t,e){return this._addCommand("moveTo"),this._addPoint(t,e)},this.prototype.lineTo=function(t,e){return this._addCommand("lineTo"),this._addPoint(t,e)},this.prototype.quadraticCurveTo=function(t,e,n,i){return this._addCommand("quadraticCurveTo"),this._addPoint(t,e),this._addPoint(n,i)},this.prototype.bezierCurveTo=function(t,e,n,i,r,o){return this._addCommand("bezierCurveTo"),this._addPoint(t,e),this._addPoint(n,i),this._addPoint(r,o)},this.prototype.arc=function(t,e,n,i,r,o){return this._addCommand(o?"antiArc":"arc"),this._addPoint(t,e),this._addRadius(n),this._addRadius(i),this._addRadius(r)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","min","max"],[e,n(986)],(t,e,n)=>{return i.defClass(class IntermediateCanvasPathSet extends t{constructor(t=[]){super(...arguments),this.paths=t}},function(t,r,o){this.property("paths"),this.prototype.normalize=function(){let t,r,o,s,a;return t=r=o=s=0,a=!0,i.each2(this.paths,i=>{let a,l,u,c;return i.resolveMatrix(),({originalMaxX:a,originalMaxY:l,originalMinX:u,originalMinY:c}=i),o=a,s=l,r=c,t=e(t=u,u),r=e(r,c),o=n(o,a),s=n(s,l)})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=function(t,e){"use strict";var n;return t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,function(n){var i;n.exports,(i=window).DOMParser=window.DOMParser;var r=i.document;function d(t,e){var n;return(n=r.createElement("canvas")).width=t,n.height=e,n}var o,s=function(t,e,n){if(null!=t||null!=e||null!=n){var i=m(n||{});"string"==typeof t&&(t=r.getElementById(t)),null!=t.svg&&t.svg.stop(),t.childNodes&&1==t.childNodes.length&&"OBJECT"==t.childNodes[0].nodeName||(t.svg=i);var o=t.getContext("2d");void 0!==e.documentElement?i.loadXmlDoc(o,e):"<"==e.substr(0,1)?i.loadXml(o,e):i.load(o,e)}else for(var a=r.querySelectorAll("svg"),l=0;l<a.length;l++){var u=a[l],c=r.createElement("canvas");if(void 0!==u.clientWidth&&void 0!==u.clientHeight)c.width=u.clientWidth,c.height=u.clientHeight;else{var h=u.getBoundingClientRect();c.width=h.width,c.height=h.height}u.parentNode.insertBefore(c,u),u.parentNode.removeChild(u);var p=r.createElement("div");p.appendChild(u),s(c,p.innerHTML)}};"undefined"==typeof Element||(void 0!==Element.prototype.matches?o=function(t,e){return t.matches(e)}:void 0!==Element.prototype.webkitMatchesSelector?o=function(t,e){return t.webkitMatchesSelector(e)}:void 0!==Element.prototype.mozMatchesSelector?o=function(t,e){return t.mozMatchesSelector(e)}:void 0!==Element.prototype.msMatchesSelector?o=function(t,e){return t.msMatchesSelector(e)}:void 0!==Element.prototype.oMatchesSelector?o=function(t,e){return t.oMatchesSelector(e)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(o=function(t,e){return $(t).is(e)}),void 0===o&&"undefined"!=typeof Sizzle&&(o=Sizzle.matchesSelector)));var a=/(\[[^\]]+\])/g,l=/(#[^\s\+>~\.\[:]+)/g,u=/(\.[^\s\+>~\.\[:]+)/g,c=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,h=/(:[\w-]+\([^\)]*\))/gi,p=/(:[^\s\+>~\.\[:]+)/g,f=/([^\s\+>~\.\[:]+)/g;function P(t){var e=[0,0,0],n=function(n,i){var r=t.match(n);null!=r&&(e[i]+=r.length,t=t.replace(n," "))};return t=(t=t.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[\s\S]*/gm," "),n(a,1),n(l,0),n(u,1),n(c,2),n(h,1),n(p,1),t=(t=t.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),n(f,2),e.join("")}function m(n){var s={opts:n,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,rootEmSize:12,emSize:12,log:function(){}};1==s.opts.log&&"undefined"!=typeof console&&(s.log=function(t){console.log(t)}),s.init=function(t){var e=0;s.UniqueId=function(){return"canvg"+ ++e},s.Definitions={},s.Styles={},s.StylesSpecificity={},s.Animations=[],s.Images=[],s.ctx=t,s.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(t,e){this.viewPorts.push({width:t,height:e})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(t){return null!=t&&"number"==typeof t?t:"x"==t?this.width():"y"==t?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},s.init(),s.ImagesLoaded=function(){for(var t=0;t<s.Images.length;t++)if(!s.Images[t].loaded)return!1;return!0},s.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},s.compressSpaces=function(t){return t.replace(/(?!\u3000)\s+/gm," ")},s.ajax=function(t){var e;return(e=i.XMLHttpRequest?new i.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(e.open("GET",t,!1),e.send(null),e.responseText):null},s.parseXml=function(t){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var e=new Windows.Data.Xml.Dom.XmlDocument,r=new Windows.Data.Xml.Dom.XmlLoadSettings;return r.prohibitDtd=!1,e.loadXml(t,r),e}if(!i.DOMParser)return t=t.replace(/<!DOCTYPE svg[^>]*>/,""),(e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t),e;try{var o=n.xmldom?new i.DOMParser(n.xmldom):new i.DOMParser;return o.parseFromString(t,"image/svg+xml")}catch(e){return(o=n.xmldom?new i.DOMParser(n.xmldom):new i.DOMParser).parseFromString(t,"text/xml")}},s.Property=function(t,e){this.name=t,this.value=e},s.Property.prototype.getValue=function(){return this.value},s.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},s.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var t=parseFloat(this.value);return(this.value+"").match(/%$/)&&(t/=100),t},s.Property.prototype.valueOrDefault=function(t){return this.hasValue()?this.value:t},s.Property.prototype.numValueOrDefault=function(t){return this.hasValue()?this.numValue():parseFloat(t)},s.Property.prototype.addOpacity=function(e){var n=this.value;if(null!=e.value&&""!=e.value&&"string"==typeof this.value){var i=new t(this.value);i.ok&&(n="rgba("+i.r+", "+i.g+", "+i.b+", "+e.numValue()+")")}return new s.Property(this.name,n)},s.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=this.value),s.Definitions[t]},s.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},s.Property.prototype.getFillStyleDefinition=function(t,e){var n=this.getDefinition();if(null!=n&&n.createGradient)return n.createGradient(s.ctx,t,e);if(null!=n&&n.createPattern){if(n.getHrefAttribute().hasValue()){var i=n.attribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&(n.attribute("patternTransform",!0).value=i.value)}return n.createPattern(s.ctx,t,e)}return null},s.Property.prototype.getDPI=function(){return 96},s.Property.prototype.getREM=function(){return s.rootEmSize},s.Property.prototype.getEM=function(){return s.emSize},s.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},s.Property.prototype.isPixels=function(){if(!this.hasValue())return!1;var t=this.value+"";return!!t.match(/px$/)||!!t.match(/^[0-9]+$/)},s.Property.prototype.toPixels=function(t,e){if(!this.hasValue())return 0;var n=this.value+"";if(n.match(/rem$/))return this.numValue()*this.getREM(t);if(n.match(/em$/))return this.numValue()*this.getEM(t);if(n.match(/ex$/))return this.numValue()*this.getEM(t)/2;if(n.match(/px$/))return this.numValue();if(n.match(/pt$/))return this.numValue()*this.getDPI(t)*(1/72);if(n.match(/pc$/))return 15*this.numValue();if(n.match(/cm$/))return this.numValue()*this.getDPI(t)/2.54;if(n.match(/mm$/))return this.numValue()*this.getDPI(t)/25.4;if(n.match(/in$/))return this.numValue()*this.getDPI(t);if(n.match(/%$/))return this.numValue()*s.ViewPort.ComputeSize(t);var i=this.numValue();return e&&i<1?i*s.ViewPort.ComputeSize(t):i},s.Property.prototype.toMilliseconds=function(){return this.hasValue()?(this.value+"").match(/ms$/)?this.numValue():1e3*this.numValue():0},s.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/deg$/)?this.numValue()*(Math.PI/180):t.match(/grad$/)?this.numValue()*(Math.PI/200):t.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var a={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return s.Property.prototype.toTextBaseline=function(){return this.hasValue()?a[this.value]:null},s.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,e,n,i,r,o){var a=null!=o?this.Parse(o):this.CreateFont("","","","","",s.ctx.font);return{fontFamily:r=r||a.fontFamily,fontSize:i||a.fontSize,fontStyle:t||a.fontStyle,fontWeight:n||a.fontWeight,fontVariant:e||a.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(e){for(var n={},i=s.trim(s.compressSpaces(e||"")).split(" "),r={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},o="",a=0;a<i.length;a++)r.fontStyle||-1==t.Styles.indexOf(i[a])?r.fontVariant||-1==t.Variants.indexOf(i[a])?r.fontWeight||-1==t.Weights.indexOf(i[a])?r.fontSize?"inherit"!=i[a]&&(o+=i[a]):("inherit"!=i[a]&&(n.fontSize=i[a].split("/")[0]),r.fontStyle=r.fontVariant=r.fontWeight=r.fontSize=!0):("inherit"!=i[a]&&(n.fontWeight=i[a]),r.fontStyle=r.fontVariant=r.fontWeight=!0):("inherit"!=i[a]&&(n.fontVariant=i[a]),r.fontStyle=r.fontVariant=!0):("inherit"!=i[a]&&(n.fontStyle=i[a]),r.fontStyle=!0);return""!=o&&(n.fontFamily=o),n}},s.ToNumberArray=function(t){for(var e=(t||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[],n=0;n<e.length;n++)e[n]=parseFloat(e[n]);return e},s.Point=function(t,e){this.x=t,this.y=e},s.Point.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},s.Point.prototype.applyTransform=function(t){var e=this.x*t[0]+this.y*t[2]+t[4],n=this.x*t[1]+this.y*t[3]+t[5];this.x=e,this.y=n},s.CreatePoint=function(t){var e=s.ToNumberArray(t);return new s.Point(e[0],e[1])},s.CreatePath=function(t){for(var e=s.ToNumberArray(t),n=[],i=0;i<e.length;i+=2)n.push(new s.Point(e[i],e[i+1]));return n},s.BoundingBox=function(t,e,n,i){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},this.addX=function(t){this.addPoint(t,null)},this.addY=function(t){this.addPoint(null,t)},this.addBoundingBox=function(t){this.addPoint(t.x1,t.y1),this.addPoint(t.x2,t.y2)},this.addQuadraticCurve=function(t,e,n,i,r,o){var s=t+2/3*(n-t),a=e+2/3*(i-e),l=s+1/3*(r-t),u=a+1/3*(o-e);this.addBezierCurve(t,e,s,l,a,u,r,o)},this.addBezierCurve=function(t,e,n,i,r,o,s,a){var l=[t,e],u=[n,i],c=[r,o],h=[s,a];this.addPoint(l[0],l[1]),this.addPoint(h[0],h[1]);for(var p=0;p<=1;p++){var d=function(t){return Math.pow(1-t,3)*l[p]+3*Math.pow(1-t,2)*t*u[p]+3*(1-t)*Math.pow(t,2)*c[p]+Math.pow(t,3)*h[p]},f=6*l[p]-12*u[p]+6*c[p],m=-3*l[p]+9*u[p]-9*c[p]+3*h[p],g=3*u[p]-3*l[p];if(0!=m){var y=Math.pow(f,2)-4*g*m;if(!(y<0)){var v=(-f+Math.sqrt(y))/(2*m);0<v&&v<1&&(0==p&&this.addX(d(v)),1==p&&this.addY(d(v)));var S=(-f-Math.sqrt(y))/(2*m);0<S&&S<1&&(0==p&&this.addX(d(S)),1==p&&this.addY(d(S)))}}else{if(0==f)continue;var b=-g/f;0<b&&b<1&&(0==p&&this.addX(d(b)),1==p&&this.addY(d(b)))}}},this.isPointInBox=function(t,e){return this.x1<=t&&t<=this.x2&&this.y1<=e&&e<=this.y2},this.addPoint(t,e),this.addPoint(n,i)},s.Transform=function(t){var e=this;this.Type={},this.Type.translate=function(t){this.p=s.CreatePoint(t),this.apply=function(t){t.translate(this.p.x||0,this.p.y||0)},this.unapply=function(t){t.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(t){t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var e=s.ToNumberArray(t);this.angle=new s.Property("angle",e[0]),this.cx=e[1]||0,this.cy=e[2]||0,this.apply=function(t){t.translate(this.cx,this.cy),t.rotate(this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.unapply=function(t){t.translate(this.cx,this.cy),t.rotate(-1*this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.applyToPoint=function(t){var e=this.angle.toRadians();t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),t.applyTransform([Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0]),t.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=s.CreatePoint(t),this.apply=function(t){t.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(t){t.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(t){t.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=s.ToNumberArray(t),this.apply=function(t){t.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(t){var e=this.m[0],n=this.m[2],i=this.m[4],r=this.m[1],o=this.m[3],s=this.m[5],a=1/(e*(1*o-0*s)-n*(1*r-0*s)+i*(0*r-0*o));t.transform(a*(1*o-0*s),a*(0*s-1*r),a*(0*i-1*n),a*(1*e-0*i),a*(n*s-i*o),a*(i*r-e*s))},this.applyToPoint=function(t){t.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=e.Type.matrix,this.base(t),this.angle=new s.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(t)},this.unapply=function(t){for(var e=this.transforms.length-1;0<=e;e--)this.transforms[e].unapply(t)},this.applyToPoint=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].applyToPoint(t)};for(var n=s.trim(s.compressSpaces(t)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<n.length;i++)if("none"!==n[i]){var r=s.trim(n[i].split("(")[0]),o=n[i].split("(")[1].replace(")",""),a=this.Type[r];if(void 0!==a){var l=new a(o);l.type=r,this.transforms.push(l)}}},s.AspectRatio=function(t,e,n,i,r,o,a,l,u,c){var h=(e=(e=s.compressSpaces(e)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",p=e.split(" ")[1]||"meet",d=n/i,f=r/o,m=Math.min(d,f),g=Math.max(d,f);"meet"==p&&(i*=m,o*=m),"slice"==p&&(i*=g,o*=g),u=new s.Property("refX",u),c=new s.Property("refY",c),u.hasValue()&&c.hasValue()?t.translate(-m*u.toPixels("x"),-m*c.toPixels("y")):(h.match(/^xMid/)&&("meet"==p&&m==f||"slice"==p&&g==f)&&t.translate(n/2-i/2,0),h.match(/YMid$/)&&("meet"==p&&m==d||"slice"==p&&g==d)&&t.translate(0,r/2-o/2),h.match(/^xMax/)&&("meet"==p&&m==f||"slice"==p&&g==f)&&t.translate(n-i,0),h.match(/YMax$/)&&("meet"==p&&m==d||"slice"==p&&g==d)&&t.translate(0,r-o)),"none"==h?t.scale(d,f):"meet"==p?t.scale(m,m):"slice"==p&&t.scale(g,g),t.translate(null==a?0:-a,null==l?0:-l)},s.Element={},s.EmptyProperty=new s.Property("EMPTY",""),s.Element.ElementBase=function(t){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(t,e){var n=this.attributes[t];return null!=n?n:(1==e&&(n=new s.Property(t,""),this.attributes[t]=n),n||s.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if("href"==t||t.match(/:href$/))return this.attributes[t];return s.EmptyProperty},this.style=function(t,e,n){var i=this.styles[t];if(null!=i)return i;var r=this.attribute(t);if(null!=r&&r.hasValue())return this.styles[t]=r;if(1!=n){var o=this.parent;if(null!=o){var a=o.style(t);if(null!=a&&a.hasValue())return a}}return 1==e&&(i=new s.Property(t,""),this.styles[t]=i),i||s.EmptyProperty},this.render=function(t){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(t.save(),this.style("mask").hasValue()){var e=this.style("mask").getDefinition();null!=e&&e.apply(t,this)}else if(this.style("filter").hasValue()){var n=this.style("filter").getDefinition();null!=n&&n.apply(t,this)}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(t){for(var e=0;e<this.children.length;e++)this.children[e].render(t)},this.addChild=function(t,e){var n=t;e&&(n=s.CreateElement(t)),n.parent=this,"title"!=n.type&&this.children.push(n)},this.addStylesFromStyleDefinition=function(){for(var e in s.Styles)if("@"!=e[0]&&o(t,e)){var n=s.Styles[e],i=s.StylesSpecificity[e];if(null!=n)for(var r in n){var a=this.stylesSpecificity[r];void 0===a&&(a="000"),a<=i&&(this.styles[r]=n[r],this.stylesSpecificity[r]=i)}}};var e,n=new RegExp("^[A-Z-]+$");if(null!=t&&1==t.nodeType){for(var i=0;i<t.attributes.length;i++){var r=t.attributes[i],a=(e=r.nodeName,n.test(e)?e.toLowerCase():e);this.attributes[a]=new s.Property(a,r.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){var l=this.attribute("style").value.split(";");for(i=0;i<l.length;i++)if(""!=s.trim(l[i])){var u=l[i].split(":"),c=s.trim(u[0]),h=s.trim(u[1]);this.styles[c]=new s.Property(c,h)}}for(this.attribute("id").hasValue()&&null==s.Definitions[this.attribute("id").value]&&(s.Definitions[this.attribute("id").value]=this),i=0;i<t.childNodes.length;i++){var p=t.childNodes[i];if(1==p.nodeType&&this.addChild(p,!0),this.captureTextNodes&&(3==p.nodeType||4==p.nodeType)){var d=p.value||p.text||p.textContent||"";""!=s.compressSpaces(d)&&this.addChild(new s.Element.tspan(p),!1)}}}},s.Element.RenderedElementBase=function(t){this.base=s.Element.ElementBase,this.base(t),this.calculateOpacity=function(){for(var t=1,e=this;null!=e;){var n=e.style("opacity",!1,!0);n.hasValue()&&(t*=n.numValue()),e=e.parent}return t},this.setContext=function(t,e){if(!e){var n;if(this.style("fill").isUrlDefinition())null!=(n=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(t.fillStyle=n);else if(this.style("fill").hasValue()){var i;"currentColor"==(i=this.style("fill")).value&&(i.value=this.style("color").value),"inherit"!=i.value&&(t.fillStyle="none"==i.value?"rgba(0,0,0,0)":i.value)}if(this.style("fill-opacity").hasValue()&&(i=(i=new s.Property("fill",t.fillStyle)).addOpacity(this.style("fill-opacity")),t.fillStyle=i.value),this.style("stroke").isUrlDefinition())null!=(n=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(t.strokeStyle=n);else if(this.style("stroke").hasValue()){var r;"currentColor"==(r=this.style("stroke")).value&&(r.value=this.style("color").value),"inherit"!=r.value&&(t.strokeStyle="none"==r.value?"rgba(0,0,0,0)":r.value)}if(this.style("stroke-opacity").hasValue()&&(r=(r=new s.Property("stroke",t.strokeStyle)).addOpacity(this.style("stroke-opacity")),t.strokeStyle=r.value),this.style("stroke-width").hasValue()){var o=this.style("stroke-width").toPixels();t.lineWidth=0==o?.001:o}if(this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),this.style("paint-order").hasValue()&&(t.paintOrder=this.style("paint-order").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var a=s.ToNumberArray(this.style("stroke-dasharray").value);void 0!==t.setLineDash?t.setLineDash(a):void 0!==t.webkitLineDash?t.webkitLineDash=a:void 0===t.mozDash||1==a.length&&0==a[0]||(t.mozDash=a);var l=this.style("stroke-dashoffset").toPixels();void 0!==t.lineDashOffset?t.lineDashOffset=l:void 0!==t.webkitLineDashOffset?t.webkitLineDashOffset=l:void 0!==t.mozDashOffset&&(t.mozDashOffset=l)}}if(void 0!==t.font)if(this.style("font").hasValue())t.font=this.style("font").value;else{t.font=s.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString();var u=this.style("font-size",!1,!1);u.isPixels()&&(s.emSize=u.toPixels())}if(this.style("transform",!1,!0).hasValue()&&new s.Transform(this.style("transform",!1,!0).value).apply(t),this.style("clip-path",!1,!0).hasValue()){var c=this.style("clip-path",!1,!0).getDefinition();null!=c&&c.apply(t)}t.globalAlpha=this.calculateOpacity()}},s.Element.RenderedElementBase.prototype=new s.Element.ElementBase,s.Element.PathElementBase=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new s.BoundingBox},this.renderChildren=function(t){this.path(t),s.Mouse.checkPath(this,t),""!=t.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?t.fill(this.style("fill-rule").value):t.fill()),""!=t.strokeStyle&&t.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()&&(n=this.style("marker-start").getDefinition()).render(t,e[0][0],e[0][1]),this.style("marker-mid").isUrlDefinition())for(var n=this.style("marker-mid").getDefinition(),i=1;i<e.length-1;i++)n.render(t,e[i][0],e[i][1]);this.style("marker-end").isUrlDefinition()&&(n=this.style("marker-end").getDefinition()).render(t,e[e.length-1][0],e[e.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},s.Element.PathElementBase.prototype=new s.Element.RenderedElementBase,s.SetDefaults=function(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4},s.Element.svg=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),s.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){if(s.SetDefaults(t),t.canvas.style&&void 0!==t.font&&void 0!==i.getComputedStyle){t.font=i.getComputedStyle(t.canvas).getPropertyValue("font");var e=new s.Property("fontSize",s.Font.Parse(t.font).fontSize);e.hasValue()&&(s.rootEmSize=s.emSize=e.toPixels("y"))}this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var n=s.ViewPort.width(),r=s.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){n=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");var o=0,a=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(o=-this.attribute("refX").toPixels("x"),a=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(t.beginPath(),t.moveTo(o,a),t.lineTo(n,a),t.lineTo(n,r),t.lineTo(o,r),t.closePath(),t.clip())}if(s.ViewPort.SetCurrent(n,r),this.attribute("viewBox").hasValue()){var l=s.ToNumberArray(this.attribute("viewBox").value),u=l[0],c=l[1];n=l[2],r=l[3],s.AspectRatio(t,this.attribute("preserveAspectRatio").value,s.ViewPort.width(),n,s.ViewPort.height(),r,u,c,this.attribute("refX").value,this.attribute("refY").value),s.ViewPort.RemoveCurrent(),s.ViewPort.SetCurrent(l[2],l[3])}}},s.Element.svg.prototype=new s.Element.RenderedElementBase,s.Element.rect=function(t){this.base=s.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y"),o=this.attribute("rx").toPixels("x"),a=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(a=o),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(o=a),o=Math.min(o,i/2),a=Math.min(a,r/2),null!=t){var l=(Math.sqrt(2)-1)/3*4;t.beginPath(),0<r&&0<i&&(t.moveTo(e+o,n),t.lineTo(e+i-o,n),t.bezierCurveTo(e+i-o+l*o,n,e+i,n+a-l*a,e+i,n+a),t.lineTo(e+i,n+r-a),t.bezierCurveTo(e+i,n+r-a+l*a,e+i-o+l*o,n+r,e+i-o,n+r),t.lineTo(e+o,n+r),t.bezierCurveTo(e+o-l*o,n+r,e,n+r-a+l*a,e,n+r-a),t.lineTo(e,n+a),t.bezierCurveTo(e,n+a-l*a,e+o-l*o,n,e+o,n),t.closePath())}return new s.BoundingBox(e,n,e+i,n+r)}},s.Element.rect.prototype=new s.Element.PathElementBase,s.Element.circle=function(t){this.base=s.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("cx").toPixels("x"),n=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=t&&0<i&&(t.beginPath(),t.arc(e,n,i,0,2*Math.PI,!1),t.closePath()),new s.BoundingBox(e-i,n-i,e+i,n+i)}},s.Element.circle.prototype=new s.Element.PathElementBase,s.Element.ellipse=function(t){this.base=s.Element.PathElementBase,this.base(t),this.path=function(t){var e=(Math.sqrt(2)-1)/3*4,n=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),r=this.attribute("cx").toPixels("x"),o=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(r+n,o),t.bezierCurveTo(r+n,o+e*i,r+e*n,o+i,r,o+i),t.bezierCurveTo(r-e*n,o+i,r-n,o+e*i,r-n,o),t.bezierCurveTo(r-n,o-e*i,r-e*n,o-i,r,o-i),t.bezierCurveTo(r+e*n,o-i,r+n,o-e*i,r+n,o),t.closePath()),new s.BoundingBox(r-n,o-i,r+n,o+i)}},s.Element.ellipse.prototype=new s.Element.PathElementBase,s.Element.line=function(t){this.base=s.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new s.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new s.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var e=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y)),new s.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)},this.getMarkers=function(){var t=this.getPoints(),e=t[0].angleTo(t[1]);return[[t[0],e],[t[1],e]]}},s.Element.line.prototype=new s.Element.PathElementBase,s.Element.polyline=function(t){this.base=s.Element.PathElementBase,this.base(t),this.points=s.CreatePath(this.attribute("points").value),this.path=function(t){var e=new s.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var n=1;n<this.points.length;n++)e.addPoint(this.points[n].x,this.points[n].y),null!=t&&t.lineTo(this.points[n].x,this.points[n].y);return e},this.getMarkers=function(){for(var t=[],e=0;e<this.points.length-1;e++)t.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);return 0<t.length&&t.push([this.points[this.points.length-1],t[t.length-1][1]]),t}},s.Element.polyline.prototype=new s.Element.PathElementBase,s.Element.polygon=function(t){this.base=s.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(t){var e=this.basePath(t);return null!=t&&(t.lineTo(this.points[0].x,this.points[0].y),t.closePath()),e}},s.Element.polygon.prototype=new s.Element.polyline,s.Element.path=function(t){this.base=s.Element.PathElementBase,this.base(t);var e=this.attribute("d").value;e=e.replace(/,/gm," ");for(var n=0;n<2;n++)e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");for(e=(e=e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2"),n=0;n<2;n++)e=e.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");e=e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),e=s.compressSpaces(e),e=s.trim(e),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new s.Point(0,0),this.control=new s.Point(0,0),this.current=new s.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new s.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var t=this.getPoint();return this.control=t},this.getAsCurrentPoint=function(){var t=this.getPoint();return this.current=t},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new s.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(t){return this.isRelativeCommand()&&(t.x+=this.current.x,t.y+=this.current.y),t},this.addMarker=function(t,e,n){null!=n&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(t,null==e?null:e.angleTo(t))},this.addMarkerAngle=function(t,e){this.points.push(t),this.angles.push(e)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var t=0;t<this.angles.length;t++)if(null==this.angles[t])for(var e=t+1;e<this.angles.length;e++)if(null!=this.angles[e]){this.angles[t]=this.angles[e];break}return this.angles}}(e),this.path=function(t){var e=this.PathParser;e.reset();var n=new s.BoundingBox;for(null!=t&&t.beginPath();!e.isEnd();)switch(e.nextCommand(),e.command){case"M":case"m":var i=e.getAsCurrentPoint();for(e.addMarker(i),n.addPoint(i.x,i.y),null!=t&&t.moveTo(i.x,i.y),e.start=e.current;!e.isCommandOrEnd();)i=e.getAsCurrentPoint(),e.addMarker(i,e.start),n.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y);break;case"L":case"l":for(;!e.isCommandOrEnd();){var r=e.current;i=e.getAsCurrentPoint(),e.addMarker(i,r),n.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"H":case"h":for(;!e.isCommandOrEnd();){var o=new s.Point((e.isRelativeCommand()?e.current.x:0)+e.getScalar(),e.current.y);e.addMarker(o,e.current),e.current=o,n.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y)}break;case"V":case"v":for(;!e.isCommandOrEnd();)o=new s.Point(e.current.x,(e.isRelativeCommand()?e.current.y:0)+e.getScalar()),e.addMarker(o,e.current),e.current=o,n.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y);break;case"C":case"c":for(;!e.isCommandOrEnd();){var a=e.current,l=e.getPoint(),u=e.getAsControlPoint(),c=e.getAsCurrentPoint();e.addMarker(c,u,l),n.addBezierCurve(a.x,a.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"S":case"s":for(;!e.isCommandOrEnd();)a=e.current,l=e.getReflectedControlPoint(),u=e.getAsControlPoint(),c=e.getAsCurrentPoint(),e.addMarker(c,u,l),n.addBezierCurve(a.x,a.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y);break;case"Q":case"q":for(;!e.isCommandOrEnd();)a=e.current,u=e.getAsControlPoint(),c=e.getAsCurrentPoint(),e.addMarker(c,u,u),n.addQuadraticCurve(a.x,a.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y);break;case"T":case"t":for(;!e.isCommandOrEnd();)a=e.current,u=e.getReflectedControlPoint(),e.control=u,c=e.getAsCurrentPoint(),e.addMarker(c,u,u),n.addQuadraticCurve(a.x,a.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y);break;case"A":case"a":for(;!e.isCommandOrEnd();){a=e.current;var h=e.getScalar(),p=e.getScalar(),d=e.getScalar()*(Math.PI/180),f=e.getScalar(),m=e.getScalar(),g=(c=e.getAsCurrentPoint(),new s.Point(Math.cos(d)*(a.x-c.x)/2+Math.sin(d)*(a.y-c.y)/2,-Math.sin(d)*(a.x-c.x)/2+Math.cos(d)*(a.y-c.y)/2)),y=Math.pow(g.x,2)/Math.pow(h,2)+Math.pow(g.y,2)/Math.pow(p,2);1<y&&(h*=Math.sqrt(y),p*=Math.sqrt(y));var v=(f==m?-1:1)*Math.sqrt((Math.pow(h,2)*Math.pow(p,2)-Math.pow(h,2)*Math.pow(g.y,2)-Math.pow(p,2)*Math.pow(g.x,2))/(Math.pow(h,2)*Math.pow(g.y,2)+Math.pow(p,2)*Math.pow(g.x,2)));isNaN(v)&&(v=0);var S=new s.Point(v*h*g.y/p,v*-p*g.x/h),b=new s.Point((a.x+c.x)/2+Math.cos(d)*S.x-Math.sin(d)*S.y,(a.y+c.y)/2+Math.sin(d)*S.x+Math.cos(d)*S.y),w=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},x=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(w(t)*w(e))},P=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(x(t,e))},C=P([1,0],[(g.x-S.x)/h,(g.y-S.y)/p]),_=[(g.x-S.x)/h,(g.y-S.y)/p],E=[(-g.x-S.x)/h,(-g.y-S.y)/p],T=P(_,E);x(_,E)<=-1&&(T=Math.PI),1<=x(_,E)&&(T=0);var k=1-m?1:-1,I=C+k*(T/2),M=new s.Point(b.x+h*Math.cos(I),b.y+p*Math.sin(I));if(e.addMarkerAngle(M,I-k*Math.PI/2),e.addMarkerAngle(c,I-k*Math.PI),n.addPoint(c.x,c.y),null!=t&&!isNaN(C)&&!isNaN(T)){x=p<h?h:p;var A=p<h?1:h/p,F=p<h?p/h:1;t.translate(b.x,b.y),t.rotate(d),t.scale(A,F),t.arc(0,0,x,C,C+T,1-m),t.scale(1/A,1/F),t.rotate(-d),t.translate(-b.x,-b.y)}}break;case"Z":case"z":null!=t&&n.x1!==n.x2&&n.y1!==n.y2&&t.closePath(),e.current=e.start}return n},this.getMarkers=function(){for(var t=this.PathParser.getMarkerPoints(),e=this.PathParser.getMarkerAngles(),n=[],i=0;i<t.length;i++)n.push([t[i],e[i]]);return n}},s.Element.path.prototype=new s.Element.PathElementBase,s.Element.pattern=function(t){this.base=s.Element.ElementBase,this.base(t),this.createPattern=function(t,e,n){var i=this.attribute("width").toPixels("x",!0),r=this.attribute("height").toPixels("y",!0),o=new s.Element.svg;o.attributes.viewBox=new s.Property("viewBox",this.attribute("viewBox").value),o.attributes.width=new s.Property("width",i+"px"),o.attributes.height=new s.Property("height",r+"px"),o.attributes.transform=new s.Property("transform",this.attribute("patternTransform").value),o.children=this.children;var a=d(i,r),l=a.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&l.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0)),n.hasValue()?this.styles["fill-opacity"]=n:delete this.styles["fill-opacity"];for(var u=-1;u<=1;u++)for(var c=-1;c<=1;c++)l.save(),o.attributes.x=new s.Property("x",u*a.width),o.attributes.y=new s.Property("y",c*a.height),o.render(l),l.restore();return t.createPattern(a,"repeat")}},s.Element.pattern.prototype=new s.Element.ElementBase,s.Element.marker=function(t){this.base=s.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,e,n){if(e){t.translate(e.x,e.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(n),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var i=new s.Element.svg;i.attributes.viewBox=new s.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new s.Property("refX",this.attribute("refX").value),i.attributes.refY=new s.Property("refY",this.attribute("refY").value),i.attributes.width=new s.Property("width",this.attribute("markerWidth").value),i.attributes.height=new s.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new s.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new s.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-n),t.translate(-e.x,-e.y)}}},s.Element.marker.prototype=new s.Element.ElementBase,s.Element.defs=function(t){this.base=s.Element.ElementBase,this.base(t),this.render=function(){}},s.Element.defs.prototype=new s.Element.ElementBase,s.Element.GradientBase=function(t){this.base=s.Element.ElementBase,this.base(t),this.stops=[];for(var e=0;e<this.children.length;e++){var n=this.children[e];"stop"==n.type&&this.stops.push(n)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(t){for(var e=0;e<this.attributesToInherit.length;e++){var n=this.attributesToInherit[e];!this.attribute(n).hasValue()&&t.attribute(n).hasValue()&&(this.attribute(n,!0).value=t.attribute(n).value)}},this.createGradient=function(t,e,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var r=function(t){return n.hasValue()?new s.Property("color",t).addOpacity(n).value:t},o=this.getGradient(t,e);if(null==o)return r(i.stops[i.stops.length-1].color);for(var a=0;a<i.stops.length;a++)o.addColorStop(i.stops[a].offset,r(i.stops[a].color));if(this.attribute("gradientTransform").hasValue()){var l=s.ViewPort.viewPorts[0],u=new s.Element.rect;u.attributes.x=new s.Property("x",-s.MAX_VIRTUAL_PIXELS/3),u.attributes.y=new s.Property("y",-s.MAX_VIRTUAL_PIXELS/3),u.attributes.width=new s.Property("width",s.MAX_VIRTUAL_PIXELS),u.attributes.height=new s.Property("height",s.MAX_VIRTUAL_PIXELS);var c=new s.Element.g;c.attributes.transform=new s.Property("transform",this.attribute("gradientTransform").value),c.children=[u];var h=new s.Element.svg;h.attributes.x=new s.Property("x",0),h.attributes.y=new s.Property("y",0),h.attributes.width=new s.Property("width",l.width),h.attributes.height=new s.Property("height",l.height),h.children=[c];var p=d(l.width,l.height),f=p.getContext("2d");return f.fillStyle=o,h.render(f),f.createPattern(p,"no-repeat")}return o}},s.Element.GradientBase.prototype=new s.Element.ElementBase,s.Element.linearGradient=function(t){this.base=s.Element.GradientBase,this.base(t),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(t,e){var n="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox(t):null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var i="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),r="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),s="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return i==o&&r==s?null:t.createLinearGradient(i,r,o,s)}},s.Element.linearGradient.prototype=new s.Element.GradientBase,s.Element.radialGradient=function(t){this.base=s.Element.GradientBase,this.base(t),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.attributesToInherit.push("fr"),this.getGradient=function(t,e){var n=e.getBoundingBox(t);this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var i="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),r="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=i,s=r;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(s="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var a="objectBoundingBox"==this.gradientUnits()?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels(),l=this.attribute("fr").toPixels();return t.createRadialGradient(o,s,l,i,r,a)}},s.Element.radialGradient.prototype=new s.Element.GradientBase,s.Element.stop=function(t){this.base=s.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);var e=this.style("stop-color",!0);""===e.value&&(e.value="#000"),this.style("stop-opacity").hasValue()&&(e=e.addOpacity(this.style("stop-opacity"))),this.color=e.value},s.Element.stop.prototype=new s.Element.ElementBase,s.Element.AnimateBase=function(t){this.base=s.Element.ElementBase,this.base(t),s.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var t=this.attribute("attributeType").value,e=this.attribute("attributeName").value;return"CSS"==t?this.parent.style(e,!0):this.parent.attribute(e,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(t){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+t;var e=!1;if(this.begin<this.duration){var n=this.calcValue();this.attribute("type").hasValue()&&(n=this.attribute("type").value+"("+n+")"),this.getProperty().value=n,e=!0}return e},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var e=t.progress*(this.values.value.length-1),n=Math.floor(e),i=Math.ceil(e);t.from=new s.Property("from",parseFloat(this.values.value[n])),t.to=new s.Property("to",parseFloat(this.values.value[i])),t.progress=(e-n)/(i-n)}else t.from=this.from,t.to=this.to;return t}},s.Element.AnimateBase.prototype=new s.Element.ElementBase,s.Element.animate=function(t){this.base=s.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress(),e=t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress;return"%"===this.initialUnits&&(e*=100),e+this.initialUnits}},s.Element.animate.prototype=new s.Element.AnimateBase,s.Element.animateColor=function(e){this.base=s.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress(),n=new t(e.from.value),i=new t(e.to.value);if(n.ok&&i.ok){var r=n.r+(i.r-n.r)*e.progress,o=n.g+(i.g-n.g)*e.progress,s=n.b+(i.b-n.b)*e.progress;return"rgb("+parseInt(r,10)+","+parseInt(o,10)+","+parseInt(s,10)+")"}return this.attribute("from").value}},s.Element.animateColor.prototype=new s.Element.AnimateBase,s.Element.animateTransform=function(t){this.base=s.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),e=s.ToNumberArray(t.from.value),n=s.ToNumberArray(t.to.value),i="",r=0;r<e.length;r++)i+=e[r]+(n[r]-e[r])*t.progress+" ";return i}},s.Element.animateTransform.prototype=new s.Element.animate,s.Element.font=function(t){this.base=s.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var e=0;e<this.children.length;e++){var n=this.children[e];"font-face"==n.type?(this.fontFace=n).style("font-family").hasValue()&&(s.Definitions[n.style("font-family").value]=this):"missing-glyph"==n.type?this.missingGlyph=n:"glyph"==n.type&&(""!=n.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[n.unicode]&&(this.glyphs[n.unicode]=[]),this.glyphs[n.unicode][n.arabicForm]=n):this.glyphs[n.unicode]=n)}this.render=function(){}},s.Element.font.prototype=new s.Element.ElementBase,s.Element.fontface=function(t){this.base=s.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},s.Element.fontface.prototype=new s.Element.ElementBase,s.Element.missingglyph=function(t){this.base=s.Element.path,this.base(t),this.horizAdvX=0},s.Element.missingglyph.prototype=new s.Element.path,s.Element.glyph=function(t){this.base=s.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},s.Element.glyph.prototype=new s.Element.path,s.Element.text=function(t){this.captureTextNodes=!0,this.base=s.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t);var e=this.style("dominant-baseline").toTextBaseline();null==e&&(e=this.style("alignment-baseline").toTextBaseline()),null!=e&&(t.textBaseline=e)},this.initializeCoordinates=function(t){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(t,this,0)},this.getBoundingBox=function(t){this.initializeCoordinates(t);for(var e=null,n=0;n<this.children.length;n++){var i=this.getChildBoundingBox(t,this,this,n);null==e?e=i:e.addBoundingBox(i)}return e},this.renderChildren=function(t){this.initializeCoordinates(t);for(var e=0;e<this.children.length;e++)this.renderChild(t,this,this,e);s.Mouse.checkBoundingBox(this,this.getBoundingBox(t))},this.getAnchorDelta=function(t,e,n){var i=this.style("text-anchor").valueOrDefault("start");if("start"==i)return 0;for(var r=0,o=n;o<e.children.length;o++){var s=e.children[o];if(n<o&&s.attribute("x").hasValue())break;r+=s.measureTextRecursive(t)}return-1*("end"==i?r:r/2)},this.adjustChildCoordinates=function(t,e,n,i){var r=n.children[i];if("function"!=typeof r.measureText)return r;if(r.attribute("x").hasValue()){r.x=r.attribute("x").toPixels("x")+e.getAnchorDelta(t,n,i);var o=r.attribute("text-anchor").valueOrDefault("start");if("start"!==o){var s=r.measureTextRecursive(t);r.x+=-1*("end"==o?s:s/2)}r.attribute("dx").hasValue()&&(r.x+=r.attribute("dx").toPixels("x"))}else r.attribute("dx").hasValue()&&(e.x+=r.attribute("dx").toPixels("x")),r.x=e.x;return e.x=r.x+r.measureText(t),r.attribute("y").hasValue()?(r.y=r.attribute("y").toPixels("y"),r.attribute("dy").hasValue()&&(r.y+=r.attribute("dy").toPixels("y"))):(r.attribute("dy").hasValue()&&(e.y+=r.attribute("dy").toPixels("y")),r.y=e.y),e.y=r.y,r},this.getChildBoundingBox=function(t,e,n,i){var r=this.adjustChildCoordinates(t,e,n,i),o=r.getBoundingBox(t);for(i=0;i<r.children.length;i++){var s=e.getChildBoundingBox(t,e,r,i);o.addBoundingBox(s)}return o},this.renderChild=function(t,e,n,i){var r=this.adjustChildCoordinates(t,e,n,i);for(r.render(t),i=0;i<r.children.length;i++)e.renderChild(t,e,r,i)}},s.Element.text.prototype=new s.Element.RenderedElementBase,s.Element.TextElementBase=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.getGlyph=function(t,e,n){var i=e[n],r=null;if(t.isArabic){var o="isolated";(0==n||" "==e[n-1])&&n<e.length-2&&" "!=e[n+1]&&(o="terminal"),0<n&&" "!=e[n-1]&&n<e.length-2&&" "!=e[n+1]&&(o="medial"),0<n&&" "!=e[n-1]&&(n==e.length-1||" "==e[n+1])&&(o="initial"),void 0!==t.glyphs[i]&&null==(r=t.glyphs[i][o])&&"glyph"==t.glyphs[i].type&&(r=t.glyphs[i])}else r=t.glyphs[i];return null==r&&(r=t.missingGlyph),r},this.renderChildren=function(t){var e=this.parent.style("font-family").getDefinition();if(null==e)"stroke"==t.paintOrder?(""!=t.strokeStyle&&t.strokeText(s.compressSpaces(this.getText()),this.x,this.y),""!=t.fillStyle&&t.fillText(s.compressSpaces(this.getText()),this.x,this.y)):(""!=t.fillStyle&&t.fillText(s.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle&&t.strokeText(s.compressSpaces(this.getText()),this.x,this.y));else{var n=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(s.Font.Parse(s.ctx.font).fontStyle),r=this.getText();e.isRTL&&(r=r.split("").reverse().join(""));for(var o=s.ToNumberArray(this.parent.attribute("dx").value),a=0;a<r.length;a++){var l=this.getGlyph(e,r,a),u=n/e.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(u,-u);var c=t.lineWidth;t.lineWidth=t.lineWidth*e.fontFace.unitsPerEm/n,"italic"==i&&t.transform(1,0,.4,1,0,0),l.render(t),"italic"==i&&t.transform(1,0,-.4,1,0,0),t.lineWidth=c,t.scale(1/u,-1/u),t.translate(-this.x,-this.y),this.x+=n*(l.horizAdvX||e.horizAdvX)/e.fontFace.unitsPerEm,void 0===o[a]||isNaN(o[a])||(this.x+=o[a])}}},this.getText=function(){},this.measureTextRecursive=function(t){for(var e=this.measureText(t),n=0;n<this.children.length;n++)e+=this.children[n].measureTextRecursive(t);return e},this.measureText=function(t){var e=this.parent.style("font-family").getDefinition();if(null!=e){var n=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize),i=0,r=this.getText();e.isRTL&&(r=r.split("").reverse().join(""));for(var o=s.ToNumberArray(this.parent.attribute("dx").value),a=0;a<r.length;a++)i+=(this.getGlyph(e,r,a).horizAdvX||e.horizAdvX)*n/e.fontFace.unitsPerEm,void 0===o[a]||isNaN(o[a])||(i+=o[a]);return i}var l=s.compressSpaces(this.getText());if(!t.measureText)return 10*l.length;t.save(),this.setContext(t,!0);var u=t.measureText(l).width;return t.restore(),u},this.getBoundingBox=function(t){var e=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize);return new s.BoundingBox(this.x,this.y-e,this.x+this.measureText(t),this.y)}},s.Element.TextElementBase.prototype=new s.Element.RenderedElementBase,s.Element.tspan=function(t){this.captureTextNodes=!0,this.base=s.Element.TextElementBase,this.base(t),this.text=s.compressSpaces(t.value||t.text||t.textContent||""),this.getText=function(){return 0<this.children.length?"":this.text}},s.Element.tspan.prototype=new s.Element.TextElementBase,s.Element.tref=function(t){this.base=s.Element.TextElementBase,this.base(t),this.getText=function(){var t=this.getHrefAttribute().getDefinition();if(null!=t)return t.children[0].getText()}},s.Element.tref.prototype=new s.Element.TextElementBase,s.Element.a=function(t){this.base=s.Element.TextElementBase,this.base(t),this.hasText=0<t.childNodes.length;for(var e=0;e<t.childNodes.length;e++)3!=t.childNodes[e].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].value||t.childNodes[0].data:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var e=new s.Property("fontSize",s.Font.Parse(s.ctx.font).fontSize);s.Mouse.checkBoundingBox(this,new s.BoundingBox(this.x,this.y-e.toPixels("y"),this.x+this.measureText(t),this.y))}else if(0<this.children.length){var n=new s.Element.g;n.children=this.children,n.parent=this,n.render(t)}},this.onclick=function(){i.open(this.getHrefAttribute().value)},this.onmousemove=function(){s.ctx.canvas.style.cursor="pointer"}},s.Element.a.prototype=new s.Element.TextElementBase,s.Element.textPath=function(t){this.base=s.Element.TextElementBase,this.base(t);var e=this.getHrefAttribute().getDefinition();this.text=s.compressSpaces(t.value||t.text||t.textContent||""),this.renderChildren=function(t){this.setTextData(t),t.save();var e=this.parent.style("text-decoration").value,n=this.fontSize(),i=this.glyphInfo,r=t.fillStyle;"underline"===e&&t.beginPath();for(var o=0;o<i.length;o++){var a=i[o].p0,l=i[o].p1,u=i[o].text;t.save(),t.translate(a.x,a.y),t.rotate(i[o].rotation),""!=t.fillStyle&&t.fillText(s.compressSpaces(u),0,0),""!=t.strokeStyle&&t.strokeText(s.compressSpaces(u),0,0),t.restore(),"underline"===e&&(0===o&&t.moveTo(a.x,a.y+n/8),t.lineTo(l.x,l.y+n/5))}"underline"===e&&(t.lineWidth=n/20,t.strokeStyle=r,t.stroke(),t.closePath()),t.restore()},this.path=function(t){var e=this.dataArray;null!=t&&t.beginPath();for(var n=0;n<e.length;n++){var i=e[n].command,r=e[n].points;switch(i){case"L":null!=t&&t.lineTo(r[0],r[1]);break;case"M":null!=t&&t.moveTo(r[0],r[1]);break;case"C":null!=t&&t.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5]);break;case"Q":null!=t&&t.quadraticCurveTo(r[0],r[1],r[2],r[3]);break;case"A":var o=r[0],s=r[1],a=r[2],l=r[3],u=r[4],c=r[5],h=r[6],p=r[7],d=l<a?a:l,f=l<a?1:a/l,m=l<a?l/a:1;null!=t&&(t.translate(o,s),t.rotate(h),t.scale(f,m),t.arc(0,0,d,u,u+c,1-p),t.scale(1/f,1/m),t.rotate(-h),t.translate(-o,-s));break;case"z":null!=t&&t.closePath()}}},this.getText=function(){return this.text},this.fontSize=function(){return this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize)},this.measureText=function(t,e){var n=this.parent.style("font-family").getDefinition();if(e=e||this.getText(),null!=n){var i=this.fontSize(),r=0;n.isRTL&&(e=e.split("").reverse().join(""));for(var o=s.ToNumberArray(this.parent.attribute("dx").value),a=0;a<e.length;a++)r+=(this.getGlyph(n,e,a).horizAdvX||n.horizAdvX)*i/n.fontFace.unitsPerEm,void 0===o[a]||isNaN(o[a])||(r+=o[a]);return r}var l=s.compressSpaces(e);if(!t.measureText)return 10*l.length;t.save(),this.setContext(t);var u=t.measureText(l).width;return t.restore(),u},this.setTextData=function(t){if(!this.hasOwnProperty("glyphInfo")){var e=this,n=this.getText().split(""),i=this.getText().split(" ").length-1,r=s.ToNumberArray(this.parent.attribute("dx").valueOrDefault("0")),o=0,a=this.parent.style("text-anchor").valueOrDefault("start"),l=this.style("letter-spacing"),u=this.parent.style("letter-spacing");l.hasValue()&&"inherit"!==l.getValue()?l.hasValue()&&"initial"!==l.getValue()&&"unset"!==l.getValue()&&(o=l.toPixels()):o=u.toPixels(),this.letterSpacingCache=[];for(var c=0;c<this.getText().length;c++)this.letterSpacingCache.push(void 0!==r[c]?r[c]:o);var h=this.letterSpacingCache.reduce(function(t,e){return t+e||0},0);this.textWidth=this.measureText(t),this.textHeight=this.fontSize();var p=Math.max(this.textWidth+h,0);this.glyphInfo=[];var d=this.getPathLength(),f=this.style("startOffset").numValueOrDefault(0)*d,m=0;"middle"!==a&&"center"!==a||(m=-p/2),"end"!==a&&"right"!==a||(m=-p),m+=f;var g=function(n,r){var o,s=e.measureText(t,n);" "===n&&"justify"===a&&p<d&&(s+=(d-p)/i),-1<r&&(m+=(o=(o=r)||0,e.letterSpacingCache[o]||0));var l=e.textHeight/20,u={p0:e.getEquidistantPointOnPath(m,l),p1:e.getEquidistantPointOnPath(m+s,l)};return m+=s,u};for(c=0;c<n.length;c++){var y=g(n[c],c);if(void 0!==y.p0&&void 0!==y.p1){var v=e.getLineLength(y.p0.x,y.p0.y,y.p1.x,y.p1.y),S=e.getPointOnLine(0+v/2,y.p0.x,y.p0.y,y.p1.x,y.p1.y),b=Math.atan2(y.p1.y-y.p0.y,y.p1.x-y.p0.x);this.glyphInfo.push({transposeX:S.x,transposeY:S.y,text:n[c],rotation:b,p0:y.p0,p1:y.p1})}}}},this.parsePathData=function(t){if(this.pathLength=void 0,!t)return[];var e=[],n=t.PathParser;for(n.reset();!n.isEnd();){var i=[],r=null,o=n.current?n.current.x:0,a=n.current?n.current.y:0;n.nextCommand();var l=n.command.toUpperCase();switch(n.command){case"M":case"m":var u=n.getAsCurrentPoint();for(i.push(u.x,u.y),n.start=n.current;!n.isCommandOrEnd();)u=n.getAsCurrentPoint(),i.push(u.x,u.y),r="L";break;case"L":case"l":for(;!n.isCommandOrEnd();)u=n.getAsCurrentPoint(),i.push(u.x,u.y);r="L";break;case"H":case"h":for(;!n.isCommandOrEnd();){var c=new s.Point((n.isRelativeCommand()?n.current.x:0)+n.getScalar(),n.current.y);i.push(c.x,c.y),n.current=c}r="L";break;case"V":case"v":for(;!n.isCommandOrEnd();)c=new s.Point(n.current.x,(n.isRelativeCommand()?n.current.y:0)+n.getScalar()),i.push(c.x,c.y),n.current=c;r="L";break;case"C":case"c":for(;!n.isCommandOrEnd();){var h=n.getPoint(),p=n.getAsControlPoint(),d=n.getAsCurrentPoint();i.push(h.x,h.y,p.x,p.y,d.x,d.y)}break;case"S":case"s":for(;!n.isCommandOrEnd();)h=n.getReflectedControlPoint(),p=n.getAsControlPoint(),d=n.getAsCurrentPoint(),i.push(h.x,h.y,p.x,p.y,d.x,d.y);r="C";break;case"Q":case"q":for(;!n.isCommandOrEnd();)p=n.getAsControlPoint(),d=n.getAsCurrentPoint(),i.push(p.x,p.y,d.x,d.y);break;case"T":case"t":for(;!n.isCommandOrEnd();)p=n.getReflectedControlPoint(),n.control=p,d=n.getAsCurrentPoint(),i.push(p.x,p.y,d.x,d.y);r="Q";break;case"A":case"a":for(;!n.isCommandOrEnd();){var f=n.current,m=n.getScalar(),g=n.getScalar(),y=n.getScalar()*(Math.PI/180),v=n.getScalar(),S=n.getScalar(),b=(d=n.getAsCurrentPoint(),new s.Point(Math.cos(y)*(f.x-d.x)/2+Math.sin(y)*(f.y-d.y)/2,-Math.sin(y)*(f.x-d.x)/2+Math.cos(y)*(f.y-d.y)/2)),w=Math.pow(b.x,2)/Math.pow(m,2)+Math.pow(b.y,2)/Math.pow(g,2);1<w&&(m*=Math.sqrt(w),g*=Math.sqrt(w));var x=(v==S?-1:1)*Math.sqrt((Math.pow(m,2)*Math.pow(g,2)-Math.pow(m,2)*Math.pow(b.y,2)-Math.pow(g,2)*Math.pow(b.x,2))/(Math.pow(m,2)*Math.pow(b.y,2)+Math.pow(g,2)*Math.pow(b.x,2)));isNaN(x)&&(x=0);var P=new s.Point(x*m*b.y/g,x*-g*b.x/m),C=new s.Point((f.x+d.x)/2+Math.cos(y)*P.x-Math.sin(y)*P.y,(f.y+d.y)/2+Math.sin(y)*P.x+Math.cos(y)*P.y),_=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},E=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(_(t)*_(e))},T=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(E(t,e))},k=T([1,0],[(b.x-P.x)/m,(b.y-P.y)/g]),I=[(b.x-P.x)/m,(b.y-P.y)/g],M=[(-b.x-P.x)/m,(-b.y-P.y)/g],A=T(I,M);E(I,M)<=-1&&(A=Math.PI),1<=E(I,M)&&(A=0),0===S&&0<A&&(A-=2*Math.PI),1===S&&A<0&&(A+=2*Math.PI),i=[C.x,C.y,m,g,k,A,y,S]}break;case"Z":case"z":n.current=n.start}"Z"!==l?e.push({command:r||l,points:i,start:{x:o,y:a},pathLength:this.calcLength(o,a,r||l,i)}):e.push({command:"z",points:[],start:void 0,pathLength:0})}return e},this.getPathLength=function(){if(void 0===this.pathLength||null===this.pathLength||isNaN(this.pathLength))for(var t=this.pathLength=0;t<this.dataArray.length;t++)0<this.dataArray[t].pathLength&&(this.pathLength+=this.dataArray[t].pathLength);return this.pathLength},this.getPointOnPath=function(t){var e=0,n=this.getPathLength(),i=void 0;if(!(t<-5e-5||n<t-5e-5))for(var r=0;r<this.dataArray.length;r++){var o=this.dataArray[r];if(!o||!(o.pathLength<5e-5||e+o.pathLength+5e-5<t)){var s=t-e,a=void 0;switch(o.command){case"L":i=this.getPointOnLine(s,o.start.x,o.start.y,o.points[0],o.points[1],o.start.x,o.start.y);break;case"A":var l=o.points[4],u=o.points[5],c=o.points[4]+u;if(a=l+s/o.pathLength*u,u<0&&a<c||0<=u&&c<a)break;i=this.getPointOnEllipticalArc(o.points[0],o.points[1],o.points[2],o.points[3],a,o.points[6]);break;case"C":1<(a=s/o.pathLength)&&(a=1),i=this.getPointOnCubicBezier(a,o.start.x,o.start.y,o.points[0],o.points[1],o.points[2],o.points[3],o.points[4],o.points[5]);break;case"Q":1<(a=s/o.pathLength)&&(a=1),i=this.getPointOnQuadraticBezier(a,o.start.x,o.start.y,o.points[0],o.points[1],o.points[2],o.points[3])}if(void 0!==i&&i!=={})return i;break}e+=o.pathLength}},this.buildEquidistantCache=function(t,e){var n=this.getPathLength();if(e=e||.25,t=t||n/100,this.equidistantCache=this.equidistantCache||{},!this.equidistantCache.hasOwnProperty("points")||this.equidistantCache.step!=t||this.equidistantCache.precision!=e){this.equidistantCache={step:t,precision:e,points:[]};for(var i=0,r=0;r<=n;r+=e){var o=this.getPointOnPath(r),s=this.getPointOnPath(r+e);void 0!==o&&void 0!==s&&t<=(i+=this.getLineLength(o.x,o.y,s.x,s.y))&&(this.equidistantCache.points.push({x:o.x,y:o.y,distance:r}),i-=t)}}},this.getEquidistantPointOnPath=function(t,e,n){if(this.buildEquidistantCache(e,n),!(t<0||5e-5<t-this.getPathLength())){var i=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||void 0}},this.getLineLength=function(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))},this.getPointOnLine=function(t,e,n,i,r,o,s){void 0===o&&(o=e),void 0===s&&(s=n);var a=(r-n)/(i-e+1e-8),l=Math.sqrt(t*t/(1+a*a));i<e&&(l*=-1);var u,c=a*l;if(i===e)u={x:o,y:s+c};else if((s-n)/(o-e+1e-8)===a)u={x:o+l,y:s+c};else{var h,p,d=this.getLineLength(e,n,i,r);if(d<1e-8)return;var f=(o-e)*(i-e)+(s-n)*(r-n);h=e+(f/=d*d)*(i-e),p=n+f*(r-n);var m=this.getLineLength(o,s,h,p),g=Math.sqrt(t*t-m*m);l=Math.sqrt(g*g/(1+a*a)),i<e&&(l*=-1),u={x:h+l,y:p+(c=a*l)}}return u},this.getPointOnCubicBezier=function(t,e,n,i,r,o,s,a,h){function l(t){return t*t*t}function u(t){return 3*t*t*(1-t)}function c(t){return 3*t*(1-t)*(1-t)}function f(t){return(1-t)*(1-t)*(1-t)}return{x:a*l(t)+o*u(t)+i*c(t)+e*f(t),y:h*l(t)+s*u(t)+r*c(t)+n*f(t)}},this.getPointOnQuadraticBezier=function(t,e,n,i,r,s,a){function o(t){return t*t}function h(t){return 2*t*(1-t)}function l(t){return(1-t)*(1-t)}return{x:s*o(t)+i*h(t)+e*l(t),y:a*o(t)+r*h(t)+n*l(t)}},this.getPointOnEllipticalArc=function(t,e,n,i,r,o){var s=Math.cos(o),a=Math.sin(o),l=n*Math.cos(r),u=i*Math.sin(r);return{x:t+(l*s-u*a),y:e+(l*a+u*s)}},this.calcLength=function(t,e,n,i){var r,o,s,a;switch(n){case"L":return this.getLineLength(t,e,i[0],i[1]);case"C":for(r=0,o=this.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),a=.01;a<=1;a+=.01)s=this.getPointOnCubicBezier(a,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),r+=this.getLineLength(o.x,o.y,s.x,s.y),o=s;return r;case"Q":for(r=0,o=this.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),a=.01;a<=1;a+=.01)s=this.getPointOnQuadraticBezier(a,t,e,i[0],i[1],i[2],i[3]),r+=this.getLineLength(o.x,o.y,s.x,s.y),o=s;return r;case"A":r=0;var l=i[4],u=i[5],c=i[4]+u,h=Math.PI/180;if(Math.abs(l-c)<h&&(h=Math.abs(l-c)),o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),u<0)for(a=l-h;c<a;a-=h)s=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],a,0),r+=this.getLineLength(o.x,o.y,s.x,s.y),o=s;else for(a=l+h;a<c;a+=h)s=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],a,0),r+=this.getLineLength(o.x,o.y,s.x,s.y),o=s;return s=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],c,0),r+=this.getLineLength(o.x,o.y,s.x,s.y)}return 0},this.dataArray=this.parsePathData(e)},s.Element.textPath.prototype=new s.Element.TextElementBase,s.Element.image=function(t){this.base=s.Element.RenderedElementBase,this.base(t);var e=this.getHrefAttribute().value;if(""!=e){var n=e.match(/\.svg$/);if(s.Images.push(this),this.loaded=!1,n)this.img=s.ajax(e),this.loaded=!0;else{this.img=r.createElement("img"),1==s.opts.useCORS&&(this.img.crossOrigin="Anonymous");var i=this;this.img.onload=function(){i.loaded=!0},this.img.onerror=function(){s.log('ERROR: image "'+e+'" not found'),i.loaded=!0},this.img.src=e}this.renderChildren=function(t){var e=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=o&&0!=a&&(t.save(),n?t.drawSvg(this.img,e,r,o,a):(t.translate(e,r),s.AspectRatio(t,this.attribute("preserveAspectRatio").value,o,this.img.width,a,this.img.height,0,0),i.loaded&&(void 0===this.img.complete||this.img.complete)&&t.drawImage(this.img,0,0)),t.restore())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new s.BoundingBox(t,e,t+n,e+i)}}},s.Element.image.prototype=new s.Element.RenderedElementBase,s.Element.g=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(t){for(var e=new s.BoundingBox,n=0;n<this.children.length;n++)e.addBoundingBox(this.children[n].getBoundingBox(t));return e}},s.Element.g.prototype=new s.Element.RenderedElementBase,s.Element.symbol=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.render=function(){}},s.Element.symbol.prototype=new s.Element.RenderedElementBase,s.ParseExternalUrl=function(t){var e=t.match(/url\(('([^']+)'|"([^"]+)"|([^'"\)]+))\)/)||[];return e[2]||e[3]||e[4]},s.Element.style=function(t){this.base=s.Element.ElementBase,this.base(t);for(var e="",n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].data;e=e.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var i=(e=s.compressSpaces(e)).split("}");for(n=0;n<i.length;n++)if(""!=s.trim(i[n]))for(var r=i[n].split("{"),o=r[0].split(","),a=r[1].split(";"),l=0;l<o.length;l++){var u=s.trim(o[l]);if(""!=u){for(var c=s.Styles[u]||{},h=0;h<a.length;h++){var p=a[h].indexOf(":"),d=a[h].substr(0,p),f=a[h].substr(p+1,a[h].length-p);null!=d&&null!=f&&(c[s.trim(d)]=new s.Property(s.trim(d),s.trim(f)))}if(s.Styles[u]=c,s.StylesSpecificity[u]=P(u),"@font-face"==u)for(var m=c["font-family"].value.replace(/"/g,""),g=c.src.value.split(","),y=0;y<g.length;y++)if(0<g[y].indexOf('format("svg")')){var v=s.ParseExternalUrl(g[y]);if(v)for(var S=s.parseXml(s.ajax(v)).getElementsByTagName("font"),b=0;b<S.length;b++){var w=s.CreateElement(S[b]);s.Definitions[m]=w}}}}},s.Element.style.prototype=new s.Element.ElementBase,s.Element.use=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t),this.attribute("x").hasValue()&&t.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&t.translate(0,this.attribute("y").toPixels("y"))};var e=this.getHrefAttribute().getDefinition();this.path=function(t){null!=e&&e.path(t)},this.elementTransform=function(){if(null!=e&&e.style("transform",!1,!0).hasValue())return new s.Transform(e.style("transform",!1,!0).value)},this.getBoundingBox=function(t){if(null!=e)return e.getBoundingBox(t)},this.renderChildren=function(t){if(null!=e){var n=e;"symbol"==e.type&&((n=new s.Element.svg).type="svg",n.attributes.viewBox=new s.Property("viewBox",e.attribute("viewBox").value),n.attributes.preserveAspectRatio=new s.Property("preserveAspectRatio",e.attribute("preserveAspectRatio").value),n.attributes.overflow=new s.Property("overflow",e.attribute("overflow").value),n.children=e.children),"svg"==n.type&&(this.attribute("width").hasValue()&&(n.attributes.width=new s.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(n.attributes.height=new s.Property("height",this.attribute("height").value)));var i=n.parent;n.parent=null,n.render(t),n.parent=i}}},s.Element.use.prototype=new s.Element.RenderedElementBase,s.Element.mask=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(t,e){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y");if(0==r&&0==o){for(var a=new s.BoundingBox,l=0;l<this.children.length;l++)a.addBoundingBox(this.children[l].getBoundingBox(t));n=Math.floor(a.x1),i=Math.floor(a.y1),r=Math.floor(a.width()),o=Math.floor(a.height())}var u=e.style("mask").value;e.style("mask").value="";var c=d(n+r,i+o),h=c.getContext("2d");s.SetDefaults(h),this.renderChildren(h),new s.Element.feColorMatrix({nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(h,0,0,n+r,i+o);var p=d(n+r,i+o),f=p.getContext("2d");s.SetDefaults(f),e.render(f),f.globalCompositeOperation="destination-in",f.fillStyle=h.createPattern(c,"no-repeat"),f.fillRect(0,0,n+r,i+o),t.fillStyle=f.createPattern(p,"no-repeat"),t.fillRect(0,0,n+r,i+o),e.style("mask").value=u},this.render=function(){}},s.Element.mask.prototype=new s.Element.ElementBase,s.Element.clipPath=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(t){var e="undefined"!=typeof CanvasRenderingContext2D,n=t.beginPath,i=t.closePath;e&&(CanvasRenderingContext2D.prototype.beginPath=function(){},CanvasRenderingContext2D.prototype.closePath=function(){}),n.call(t);for(var r=0;r<this.children.length;r++){var o=this.children[r];if(void 0!==o.path){var a=void 0!==o.elementTransform&&o.elementTransform();!a&&o.style("transform",!1,!0).hasValue()&&(a=new s.Transform(o.style("transform",!1,!0).value)),a&&a.apply(t),o.path(t),e&&(CanvasRenderingContext2D.prototype.closePath=i),a&&a.unapply(t)}}i.call(t),t.clip(),e&&(CanvasRenderingContext2D.prototype.beginPath=n,CanvasRenderingContext2D.prototype.closePath=i)},this.render=function(){}},s.Element.clipPath.prototype=new s.Element.ElementBase,s.Element.filter=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(t,e){var n=e.getBoundingBox(t),i=Math.floor(n.x1),r=Math.floor(n.y1),o=Math.floor(n.width()),a=Math.floor(n.height()),l=e.style("filter").value;e.style("filter").value="";for(var u=0,c=0,h=0;h<this.children.length;h++){var p=this.children[h].extraFilterDistance||0;u=Math.max(u,p),c=Math.max(c,p)}var f=d(o+2*u,a+2*c),m=f.getContext("2d");for(s.SetDefaults(m),m.translate(-i+u,-r+c),e.render(m),h=0;h<this.children.length;h++)"function"==typeof this.children[h].apply&&this.children[h].apply(m,0,0,o+2*u,a+2*c);t.drawImage(f,0,0,o+2*u,a+2*c,i-u,r-c,o+2*u,a+2*c),e.style("filter",!0).value=l},this.render=function(){}},s.Element.filter.prototype=new s.Element.ElementBase,s.Element.feDropShadow=function(t){this.base=s.Element.ElementBase,this.base(t),this.addStylesFromStyleDefinition(),this.apply=function(){}},s.Element.feDropShadow.prototype=new s.Element.ElementBase,s.Element.feMorphology=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(){}},s.Element.feMorphology.prototype=new s.Element.ElementBase,s.Element.feComposite=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(){}},s.Element.feComposite.prototype=new s.Element.ElementBase,s.Element.feColorMatrix=function(t){this.base=s.Element.ElementBase,this.base(t);var e=s.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var n=e[0];e=[.213+.787*n,.715-.715*n,.072-.072*n,0,0,.213-.213*n,.715+.285*n,.072-.072*n,0,0,.213-.213*n,.715-.715*n,.072+.928*n,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var i=e[0]*Math.PI/180,r=function(t,e,n){return t+Math.cos(i)*e+Math.sin(i)*n};e=[r(.213,.787,-.213),r(.715,-.715,-.715),r(.072,-.072,.928),0,0,r(.213,-.213,.143),r(.715,.285,.14),r(.072,-.072,-.283),0,0,r(.213,-.213,-.787),r(.715,-.715,.715),r(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function d(t,e,n,i,r,o){return t[n*i*4+4*e+o]}function m(t,e,n,i,r,o,s){t[n*i*4+4*e+o]=s}function y(t,n){var i=e[t];return i*(i<0?n-255:n)}var o=this.attribute("includeOpacity").hasValue();this.apply=function(t,e,n,i,r){var s=t.getImageData(0,0,i,r);for(n=0;n<r;n++)for(e=0;e<i;e++){var a=d(s.data,e,n,i,0,0),l=d(s.data,e,n,i,0,1),u=d(s.data,e,n,i,0,2),c=d(s.data,e,n,i,0,3),h=y(0,a)+y(1,l)+y(2,u)+y(3,c)+y(4,1),p=y(5,a)+y(6,l)+y(7,u)+y(8,c)+y(9,1),f=y(10,a)+y(11,l)+y(12,u)+y(13,c)+y(14,1),g=y(15,a)+y(16,l)+y(17,u)+y(18,c)+y(19,1);o&&(h=p=f=0,g*=c/255),m(s.data,e,n,i,0,0,h),m(s.data,e,n,i,0,1,p),m(s.data,e,n,i,0,2,f),m(s.data,e,n,i,0,3,g)}t.clearRect(0,0,i,r),t.putImageData(s,0,0)}},s.Element.feColorMatrix.prototype=new s.Element.ElementBase,s.Element.feGaussianBlur=function(t){this.base=s.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,n,i,o,a){e&&void 0!==e.canvasRGBA?(t.canvas.id=s.UniqueId(),t.canvas.style.display="none",r.body.appendChild(t.canvas),e.canvasRGBA(t.canvas,n,i,o,a,this.blurRadius),r.body.removeChild(t.canvas)):s.log("ERROR: StackBlur.js must be included for blur to work")}},s.Element.feGaussianBlur.prototype=new s.Element.ElementBase,s.Element.title=function(){},s.Element.title.prototype=new s.Element.ElementBase,s.Element.desc=function(){},s.Element.desc.prototype=new s.Element.ElementBase,s.Element.MISSING=function(t){s.log("ERROR: Element '"+t.nodeName+"' not yet implemented.")},s.Element.MISSING.prototype=new s.Element.ElementBase,s.CreateElement=function(t){var e=t.nodeName.replace(/^[^:]+:/,"");e=e.replace(/\-/g,"");var n=null;return(n=void 0!==s.Element[e]?new s.Element[e](t):new s.Element.MISSING(t)).type=t.nodeName,n},s.load=function(t,e){s.loadXml(t,s.ajax(e))},s.loadXml=function(t,e){s.loadXmlDoc(t,s.parseXml(e))},s.loadXmlDoc=function(t,e){s.init(t);var n=function(e){for(var n=t.canvas;n;)e.x-=n.offsetLeft,e.y-=n.offsetTop,n=n.offsetParent;return i.scrollX&&(e.x+=i.scrollX),i.scrollY&&(e.y+=i.scrollY),e};1!=s.opts.ignoreMouse&&(t.canvas.onclick=function(t){var e=n(new s.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));s.Mouse.onclick(e.x,e.y)},t.canvas.onmousemove=function(t){var e=n(new s.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));s.Mouse.onmousemove(e.x,e.y)});var r=s.CreateElement(e.documentElement);r.root=!0,r.addStylesFromStyleDefinition();var o=!0,a=function(){s.ViewPort.Clear(),t.canvas.parentNode?s.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight):s.ViewPort.SetCurrent(800,600),1!=s.opts.ignoreDimensions&&(o||null==s.opts.scaleWidth&&null==s.opts.scaleHeight)&&(r.style("width").hasValue()&&(t.canvas.width=r.style("width").toPixels("x"),t.canvas.style&&(t.canvas.style.width=t.canvas.width+"px")),r.style("height").hasValue()&&(t.canvas.height=r.style("height").toPixels("y"),t.canvas.style&&(t.canvas.style.height=t.canvas.height+"px")));var n=t.canvas.clientWidth||t.canvas.width,i=t.canvas.clientHeight||t.canvas.height;if(1==s.opts.ignoreDimensions&&r.style("width").hasValue()&&r.style("height").hasValue()&&(n=r.style("width").toPixels("x"),i=r.style("height").toPixels("y")),s.ViewPort.SetCurrent(n,i),null!=s.opts.offsetX&&(r.attribute("x",!0).value=s.opts.offsetX),null!=s.opts.offsetY&&(r.attribute("y",!0).value=s.opts.offsetY),null!=s.opts.scaleWidth||null!=s.opts.scaleHeight){var a=null,l=null,u=s.ToNumberArray(r.attribute("viewBox").value);null!=s.opts.scaleWidth&&(r.attribute("width").hasValue()?a=r.attribute("width").toPixels("x")/s.opts.scaleWidth:isNaN(u[2])||(a=u[2]/s.opts.scaleWidth)),null!=s.opts.scaleHeight&&(r.attribute("height").hasValue()?l=r.attribute("height").toPixels("y")/s.opts.scaleHeight:isNaN(u[3])||(l=u[3]/s.opts.scaleHeight)),null==a&&(a=l),null==l&&(l=a),r.attribute("width",!0).value=s.opts.scaleWidth,r.attribute("height",!0).value=s.opts.scaleHeight,r.style("transform",!0,!0).value+=" scale("+1/a+","+1/l+")"}1!=s.opts.ignoreClear&&t.clearRect(0,0,n,i),r.render(t),o&&(o=!1,"function"==typeof s.opts.renderCallback&&s.opts.renderCallback(e))},l=!0;s.ImagesLoaded()&&(l=!1,a()),s.intervalID=setInterval(function(){var t=!1;if(l&&s.ImagesLoaded()&&(t=!(l=!1)),1!=s.opts.ignoreMouse&&(t=t||s.Mouse.hasEvents()),1!=s.opts.ignoreAnimation)for(var e=0;e<s.Animations.length;e++){var n=s.Animations[e].update(1e3/s.FRAMERATE);t=t||n}"function"==typeof s.opts.forceRedraw&&1==s.opts.forceRedraw()&&(t=!0),t&&(a(),s.Mouse.runEvents())},1e3/s.FRAMERATE)},s.stop=function(){s.intervalID&&clearInterval(s.intervalID)},s.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(t,e){this.events.push({type:"onclick",x:t,y:e,run:function(t){t.onclick&&t.onclick()}})},this.onmousemove=function(t,e){this.events.push({type:"onmousemove",x:t,y:e,run:function(t){t.onmousemove&&t.onmousemove()}})},this.eventElements=[],this.checkPath=function(t,e){for(var n=0;n<this.events.length;n++){var i=this.events[n];e.isPointInPath&&e.isPointInPath(i.x,i.y)&&(this.eventElements[n]=t)}},this.checkBoundingBox=function(t,e){if(e)for(var n=0;n<this.events.length;n++){var i=this.events[n];e.isPointInBox(i.x,i.y)&&(this.eventElements[n]=t)}},this.runEvents=function(){s.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var e=this.events[t],n=this.eventElements[t];n;)e.run(n),n=n.parent;this.events=[],this.eventElements=[]}},s}"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(t,e,n,i,r,o){var a={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:e,offsetY:n,scaleWidth:i,scaleHeight:r};for(var l in o)o.hasOwnProperty(l)&&(a[l]=o[l]);s(this.canvas,t,a)}),s._build=m,n.exports=s}(n={exports:{}}),n.exports}(n(990),n(991))},function(t,e){t.exports=function(t){this.ok=!1,this.alpha=1,"#"==t.charAt(0)&&(t=t.substr(1,6)),t=(t=t.replace(/ /g,"")).toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};t=e[t]||t;for(var n=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseFloat(t[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],i=0;i<n.length;i++){var r=n[i].re,o=n[i].process,s=r.exec(t);if(s){var a=o(s);this.r=a[0],this.g=a[1],this.b=a[2],a.length>3&&(this.alpha=a[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),n=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==n.length&&(n="0"+n),"#"+t+e+n},this.getHelpXML=function(){for(var t=new Array,i=0;i<n.length;i++)for(var r=n[i].example,o=0;o<r.length;o++)t[t.length]=r[o];for(var s in e)t[t.length]=s;var a=document.createElement("ul");a.setAttribute("id","rgbcolor-examples");for(i=0;i<t.length;i++)try{var l=document.createElement("li"),u=new RGBColor(t[i]),c=document.createElement("div");c.style.cssText="margin: 3px; border: 1px solid black; background:"+u.toHex()+"; color:"+u.toHex(),c.appendChild(document.createTextNode("test"));var h=document.createTextNode(" "+t[i]+" -> "+u.toRGB()+" -> "+u.toHex());l.appendChild(c),l.appendChild(h),a.appendChild(l)}catch(t){}return a}}},function(t,e,n){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.r(e),n.d(e,"BlurStack",function(){return o}),n.d(e,"image",function(){return processImage}),n.d(e,"canvasRGBA",function(){return processCanvasRGBA}),n.d(e,"canvasRGB",function(){return processCanvasRGB}),n.d(e,"imageDataRGBA",function(){return processImageDataRGBA}),n.d(e,"imageDataRGB",function(){return processImageDataRGB});var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function processImage(t,e,n,i){if("string"==typeof t&&(t=document.getElementById(t)),t&&"naturalWidth"in t){var r=t.naturalWidth,o=t.naturalHeight;if("string"==typeof e&&(e=document.getElementById(e)),e&&"getContext"in e){e.style.width=r+"px",e.style.height=o+"px",e.width=r,e.height=o;var s=e.getContext("2d");s.clearRect(0,0,r,o),s.drawImage(t,0,0),isNaN(n)||n<1||(i?processCanvasRGBA(e,0,0,r,o,n):processCanvasRGB(e,0,0,r,o,n))}}}function getImageDataFromCanvas(t,e,n,i,r){if("string"==typeof t&&(t=document.getElementById(t)),!(t&&"object"===_typeof(t)&&"getContext"in t))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var o=t.getContext("2d");try{return o.getImageData(e,n,i,r)}catch(t){throw new Error("unable to access image data: "+t)}}function processCanvasRGBA(t,e,n,i,r,o){if(!(isNaN(o)||o<1)){o|=0;var s=getImageDataFromCanvas(t,e,n,i,r);s=processImageDataRGBA(s,e,n,i,r,o),t.getContext("2d").putImageData(s,e,n)}}function processImageDataRGBA(t,e,n,s,a,l){var u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R=t.data,z=2*l+1,O=s-1,L=a-1,D=l+1,N=D*(D+1)/2,U=new o,W=U;for(h=1;h<z;h++)W=W.next=new o,h===D&&(B=W);W.next=U;var j=null,q=null;m=f=0;var H=i[l],V=r[l];for(c=0;c<a;c++){for(C=_=E=T=g=y=v=S=0,b=D*(k=R[f]),w=D*(I=R[f+1]),x=D*(M=R[f+2]),P=D*(A=R[f+3]),g+=N*k,y+=N*I,v+=N*M,S+=N*A,W=U,h=0;h<D;h++)W.r=k,W.g=I,W.b=M,W.a=A,W=W.next;for(h=1;h<D;h++)p=f+((O<h?O:h)<<2),g+=(W.r=k=R[p])*(F=D-h),y+=(W.g=I=R[p+1])*F,v+=(W.b=M=R[p+2])*F,S+=(W.a=A=R[p+3])*F,C+=k,_+=I,E+=M,T+=A,W=W.next;for(j=U,q=B,u=0;u<s;u++)R[f+3]=A=S*H>>V,0!==A?(A=255/A,R[f]=(g*H>>V)*A,R[f+1]=(y*H>>V)*A,R[f+2]=(v*H>>V)*A):R[f]=R[f+1]=R[f+2]=0,g-=b,y-=w,v-=x,S-=P,b-=j.r,w-=j.g,x-=j.b,P-=j.a,p=m+((p=u+l+1)<O?p:O)<<2,g+=C+=j.r=R[p],y+=_+=j.g=R[p+1],v+=E+=j.b=R[p+2],S+=T+=j.a=R[p+3],j=j.next,b+=k=q.r,w+=I=q.g,x+=M=q.b,P+=A=q.a,C-=k,_-=I,E-=M,T-=A,q=q.next,f+=4;m+=s}for(u=0;u<s;u++){for(_=E=T=C=y=v=S=g=0,b=D*(k=R[f=u<<2]),w=D*(I=R[f+1]),x=D*(M=R[f+2]),P=D*(A=R[f+3]),g+=N*k,y+=N*I,v+=N*M,S+=N*A,W=U,h=0;h<D;h++)W.r=k,W.g=I,W.b=M,W.a=A,W=W.next;for(d=s,h=1;h<=l;h++)f=d+u<<2,g+=(W.r=k=R[f])*(F=D-h),y+=(W.g=I=R[f+1])*F,v+=(W.b=M=R[f+2])*F,S+=(W.a=A=R[f+3])*F,C+=k,_+=I,E+=M,T+=A,W=W.next,h<L&&(d+=s);for(f=u,j=U,q=B,c=0;c<a;c++)R[(p=f<<2)+3]=A=S*H>>V,A>0?(A=255/A,R[p]=(g*H>>V)*A,R[p+1]=(y*H>>V)*A,R[p+2]=(v*H>>V)*A):R[p]=R[p+1]=R[p+2]=0,g-=b,y-=w,v-=x,S-=P,b-=j.r,w-=j.g,x-=j.b,P-=j.a,p=u+((p=c+D)<L?p:L)*s<<2,g+=C+=j.r=R[p],y+=_+=j.g=R[p+1],v+=E+=j.b=R[p+2],S+=T+=j.a=R[p+3],j=j.next,b+=k=q.r,w+=I=q.g,x+=M=q.b,P+=A=q.a,C-=k,_-=I,E-=M,T-=A,q=q.next,f+=s}return t}function processCanvasRGB(t,e,n,i,r,o){if(!(isNaN(o)||o<1)){o|=0;var s=getImageDataFromCanvas(t,e,n,i,r);s=processImageDataRGB(s,e,n,i,r,o),t.getContext("2d").putImageData(s,e,n)}}function processImageDataRGB(t,e,n,s,a,l){var u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M=t.data,A=2*l+1,F=s-1,B=a-1,R=l+1,z=R*(R+1)/2,O=new o,L=O;for(h=1;h<A;h++)L=L.next=new o,h===R&&(I=L);L.next=O;var D=null,N=null;m=f=0;var U=i[l],W=r[l];for(c=0;c<a;c++){for(x=P=C=g=y=v=0,S=R*(_=M[f]),b=R*(E=M[f+1]),w=R*(T=M[f+2]),g+=z*_,y+=z*E,v+=z*T,L=O,h=0;h<R;h++)L.r=_,L.g=E,L.b=T,L=L.next;for(h=1;h<R;h++)p=f+((F<h?F:h)<<2),g+=(L.r=_=M[p])*(k=R-h),y+=(L.g=E=M[p+1])*k,v+=(L.b=T=M[p+2])*k,x+=_,P+=E,C+=T,L=L.next;for(D=O,N=I,u=0;u<s;u++)M[f]=g*U>>W,M[f+1]=y*U>>W,M[f+2]=v*U>>W,g-=S,y-=b,v-=w,S-=D.r,b-=D.g,w-=D.b,p=m+((p=u+l+1)<F?p:F)<<2,g+=x+=D.r=M[p],y+=P+=D.g=M[p+1],v+=C+=D.b=M[p+2],D=D.next,S+=_=N.r,b+=E=N.g,w+=T=N.b,x-=_,P-=E,C-=T,N=N.next,f+=4;m+=s}for(u=0;u<s;u++){for(P=C=x=y=v=g=0,S=R*(_=M[f=u<<2]),b=R*(E=M[f+1]),w=R*(T=M[f+2]),g+=z*_,y+=z*E,v+=z*T,L=O,h=0;h<R;h++)L.r=_,L.g=E,L.b=T,L=L.next;for(d=s,h=1;h<=l;h++)f=d+u<<2,g+=(L.r=_=M[f])*(k=R-h),y+=(L.g=E=M[f+1])*k,v+=(L.b=T=M[f+2])*k,x+=_,P+=E,C+=T,L=L.next,h<B&&(d+=s);for(f=u,D=O,N=I,c=0;c<a;c++)M[p=f<<2]=g*U>>W,M[p+1]=y*U>>W,M[p+2]=v*U>>W,g-=S,y-=b,v-=w,S-=D.r,b-=D.g,w-=D.b,p=u+((p=c+R)<B?p:B)*s<<2,g+=x+=D.r=M[p],y+=P+=D.g=M[p+1],v+=C+=D.b=M[p+2],D=D.next,S+=_=N.r,b+=E=N.g,w+=T=N.b,x-=_,P-=E,C-=T,N=N.next,f+=s}return t}var o=function BlurStack(){!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,BlurStack),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PtlColumn","compactFlatten","seededRandomNumberGenerator"],[e,n(954)],(t,e,r)=>{return i.defClass(class BassettDinner extends(n(955)){},function(n,o,s){this.fonts=["spicyRice","homemadeApple","molle","peralta","ribeye"],this.paragraphFont="josefinSans",this.assetFiles=["fall","tops"],this.defaultText="Roast turkey\nand stuffing\nlashings of cider applesauce\nvegetables of every kind\nmince pies and\nplum-puddin'",this.classGetter({sampleRenderText:function(){return"Bassett\nDinner"}}),this.renderWithPreprocessedProps=function({text:n,seed:o,rando:s,lines:a,font:l}){let u;return u=!s||s()<.5?this.RandomEndGlyph({rando:s,glyphGroup:"fall",defaultGlyph:"fall04"}):void 0,t({margin:30,equalHeights:!0},this.insertRandomDividerGlyph({rando:s,hPadding:.5,glyphs:u?void 0:e([i.array(this.assets.tops,null,(t,e)=>/^(smallTop|rep)/.test(e)),i.array(this.assets.fall)])},()=>this.RandomGlyphLines({lines:a,font:l,rando:null!=s?s:r(4),glyphGroup:"fall",defaultGlyph:"fall04"})),u)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PtlColumn","PtlText"],[e,n(954)],(t,e)=>{return i.defClass(class HenryIv extends(n(955)){},function(n,r,o){this.fonts=["fellEnglish","tradeWinds","seaweedScript"],this.paragraphFont="cardo",this.defaultText="I am the\nPrince\nof\nWales",this.classGetter({sampleRenderText:function(){return"Henry\nIV"}}),this.renderWithPreprocessedProps=function({text:n,seed:r,rando:o,lines:s,font:a}){return t({margin:30},i.array(s,t=>e({text:t,font:t.length>this.paragraphLineLength?this.paragraphFont:a})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["randomElement","PtlRow","PtlGlyph","PtlColumn","PtlText"],[e,n(954)],(t,e,r,o,s)=>{return i.defClass(class JuliusCaesar extends(n(955)){},function(n,a,l){this.fonts=["cinzel"],this.paragraphFont="bellefair",this.assetFiles="bars",this.defaultText="Friends\nRomans\ncountrymen\nlend me your ears",this.renderWithPreprocessedProps=function({text:n,seed:a,rando:l,lines:u,font:c,paragraphFont:h}){let p,d,f,m,g;return p=!!l&&l()<.5,d=!!l&&l()<.5,u.length>1&&d&&(f=1+(m=l())*(u.length-1)|0),g=l?t(i.array(this.assets.bars,null,(t,e)=>/^bar/.test(e)),l):this.assets.bars.bar05,u=i.array(u,(e,o)=>(n=s({text:e,font:e.length>this.paragraphLineLength?h:c}),d&&f===o?[r({glyph:t(i.array(this.assets.bars),l)}),n]:n)),p?e({margin:30},r({glyph:g,hFlip:!0,rotated:!0}),o(u),r({glyph:g,rotated:!0})):o({margin:30},r({glyph:g}),u,r({glyph:g,vFlip:!0}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PtlColumn","PtlPadding","PtlGlyph","PtlText","PtlRow"],[e,n(954)],(t,e,r,o,s)=>{return i.defClass(class MuchAdoAboutNothing extends(n(955)){},function(n,a,l){this.fonts=["alexBrush","allura","dancingScript","emilysCandy"],this.assetFiles="hearts",this.defaultText="I do love\nnothing in the\nworld\nso well as you",this.classGetter({sampleRenderText:function(){return"Much Ado\nAbout\nNothing"}}),this.renderWithPreprocessedProps=function({seed:n,rando:a,lines:l,font:u}){let c,h;return null!=a||(a=this.defaultRandomizer),c=null,h=a()<.5?this.randomGlyph(a,"hearts","heart32"):void 0,t({margin:30},i.array(l,(t,e)=>{let n,i;switch(n=o({text:t,font:u}),c){case"left":i=(()=>{switch(2*a()|0){case 0:return null;case 1:return"right"}})();break;case"right":i=(()=>{switch(2*a()|0){case 0:return null;case 1:return"left"}})();break;default:i=(()=>{switch(a()*(1===e?2:3)|0){case 0:return"left";case 1:return"right";case 2:return null}})()}return c=i,s("left"===i?r({glyph:this.randomGlyph(a,"hearts","heart32")}):void 0,n,"right"===i?r({glyph:this.randomGlyph(a,"hearts","heart32")}):void 0)}),h?e({h:.75},r({glyph:h})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PtlRow","PtlGlyph","PtlColumn","PtlText","PtlInvert"],[e,n(954)],(t,e,r,o,s)=>{return i.defClass(class Neuromancer extends(n(955)){},function(n,a,l){this.fonts=["orbitron","exo2"],this.paragraphFont="josefinSans",this.assetFiles="brackets",this.defaultText="The sky above the port\nwas the color of\ntelevision\ntuned to a dead channel",this.classGetter({sampleRenderText:function(){return"Neuro\nmancer"}}),this.renderWithPreprocessedProps=function({text:n,seed:a,rando:l,lines:u,font:c,paragraphFont:h}){let p,d,f;return p=this.randomGlyph(l,"brackets","clean2",/^clean|^square/),null!=l||(l=this.defaultRandomizer),d=0,i.each2(u,(t,e)=>t.length<u[d].length?d=e:void 0),f=["outside","inside"][2*l()|0],t("outside"===f?e({glyph:p}):void 0,r(i.array(u,(i,r)=>(n=o({text:i,font:i.length>this.paragraphLineLength?h:c}),r===d?"inside"===f?t(e({glyph:p}),n,e({glyph:p,hFlip:!0})):s(n):n))),"outside"===f?e({glyph:p,hFlip:!0}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PtlColumn","seededRandomNumberGenerator"],[e,n(954)],(t,e)=>{return i.defClass(class SaintNicholas extends(n(955)){},function(n,i,r){this.fonts=["griffy","alexBrush"],this.paragraphFont="josefinSans",this.assetFiles="holiday",this.defaultText="Merry Christmas\nto all,\nand to all\na good night",this.classGetter({sampleRenderText:function(){return"Saint\nNicholas"}}),this.renderWithPreprocessedProps=function({text:n,seed:i,rando:r,lines:o,font:s}){return t({margin:30},this.RandomGlyphLines({lines:o,font:s,rando:null!=r?r:e(9),glyphGroup:"holiday",defaultGlyph:"xmas03"}),this.RandomEndGlyph({rando:r,glyphGroup:"holiday",defaultGlyph:"xmas19"}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PtlColumn","PtlGlyph","max","PtlPadding","PtlRow","PtlText"],[e,n(954)],(t,e,r,o,s,a)=>{return i.defClass(class SenseAndSensibility extends(n(955)){},function(n,l,u){this.fonts=["mrsSaintDelafield","monsieurLaDoulaise","pinyonScript"],this.paragraphFont="cormorantGaramond",this.assetFiles=["tops","brackets"],this.defaultText="To wish was to\nhope\nand to hope was to expect",this.classGetter({sampleRenderText:function(){return"Sense and\nSensability"}}),this.renderWithPreprocessedProps=function({text:n,seed:l,rando:u,lines:c,font:h,paragraphFont:p}){let d,f,m,g;return null!=u||(u=this.defaultRandomizer),d=this.randomGlyph(u,"tops","top09",/^top\d/),f=this.randomGlyph(u,"brackets","floral23",/^flo/),m=0,i.each2(c,t=>m=r(m,t.length),t=>t.length<this.paragraphLineLength),g=!1,t({margin:40},e({glyph:d}),i.array(c,(t,n)=>!g&&t.length<.67*m&&u()<.25?(g=!0,o({v:.1},s({margin:1},e({glyph:f}),o({v:1/6,h:1/6},a({text:t,font:h,layoutMode:"textual"})),e({glyph:f,hFlip:!0})))):(g=!1,a({text:t,align:"center",font:t.length>this.paragraphLineLength?p:h}))),e({glyph:d,vFlip:!0}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["randomElement","PtlColumn","PtlGlyph","PtlPadding","PtlText"],[e,n(954)],(t,e,r,o,s)=>{return i.defClass(class TheAdventuresOfTomSawyer extends(n(955)){},function(n,a,l){this.fonts=["diplomataSc","sancreek","ewert"],this.paragraphFont="oswald",this.assetFiles=["banners","bars"],this.defaultText="I am\nnot\neverybody.",this.classGetter({sampleRenderText:function(){return"The Adventures of\nTom\nSawyer"}}),this.renderWithPreprocessedProps=function({seed:n,rando:a,lines:l,font:u,paragraphFont:c}){let h,p,d,f;return h=!!a&&a()<.5,l.length>1&&h&&(p=1+(d=a())*(l.length-1)|0),f=a?t(i.array(this.assets.banners,null,(t,e)=>/^banner/.test(e)),a):this.assets.banners.banner06,e(r({glyph:f}),o({h:.1},e(i.array(l,(e,n)=>{let l;return l=s({text:e,font:e.length>this.paragraphLineLength?c:u}),h&&p===n?[o({v:.5},r({glyph:t(i.array(this.assets.bars,null,(t,e)=>/^halfRep/.test(e)),a)})),l]:l}))),r({glyph:f,hFlip:!0,vFlip:!0}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PtlColumn","compactFlatten","PtlBorder","PtlText","PtlInvert","PtlHBar"],[e,n(954)],(t,e,r,o,s,a)=>{return i.defClass(class TheGreatGatsby extends(n(955)){},function(n,l,u){this.fonts=["limelight","bungee","monoton"],this.paragraphFont="raleway",this.defaultText="I like\nlarge\nparties",this.classGetter({sampleRenderText:function(){return"THE\nGREAT\nGATSBY"}}),this.renderWithPreprocessedProps=function({seed:n,rando:l,lines:u,font:c,paragraphFont:h}){let p,d,f,m,g,y,v;switch(p=!!l,null!=l||(l=this.defaultRandomizer),4*l()|0){case 1:d=!0;break;case 2:f=!0;break;case 3:d=f=!0}return u.length>1&&d&&(m=l()*u.length|0),u.length>1&&f&&(g=1+(y=l())*(u.length-1)|0),v=t(e(i.array(u,(t,e)=>{let n;return n=o({text:t,font:t.length>this.paragraphLineLength?h:c}),m===e&&(n=s(n)),g===e&&(n=[a(),n]),n}))),!p||l()<.5?r(v):v}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxSubscriptionsMixin","ApplicationState","Promise","pipelines","log","failure","config","merge","neq","present","interval","secondsPer"],[e,n(768)],(t,e,n,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class SearchState extends(t(e)){constructor(){super(...arguments),this._subscribeToSearchChanges(),h(1e3*p.day,()=>this.refreshKimiHomeSearch())}},function(t,e,h){let p;this.stateFields({loading:!1,topicSearchMetadata:0,postSearchMetadata:0,userSearchMetadata:0,searchError:null,currentSearchOptions:{},postSearchResults:null,userSearchResults:null,topicSearchResults:null,kimiHomeSearchResults:null,kimiHomeSearchQuery:null,trendingTags:null}),p=!1,this.prototype.clearSearchResults=function(){return this.setState({topicSearchMetadata:0,postSearchMetadata:0,userSearchMetadata:0,postSearchResults:null,userSearchResults:null,topicSearchResults:null})},this.prototype.refreshKimiHomeSearch=function(){let t;return t=`${i.toString(this.models.navState.featuredKimiTags.join(" :or "))}`,p||t===this.kimiHomeSearchQuery?void 0:(p=!0,n.all([r.postSearch.trendingTags().then(t=>(this.trendingTags=t,null)).catch(t=>o({"error getting trendingTags":t})),r.postSearch.search({props:{queryVersion:2,data:{query:`${i.toString(t)} order:trending :templates limit:100`}}}).then(t=>{let e,n;return this.kimiHomeSearchResults=e=[],n={},i.each2(t,t=>{let i;return({userId:i}=t),n[i]?void 0:(n[i]=!0,e.push(t))})})]).finally(()=>(this.kimiHomeSearchQuery=t,p=!1)))},this.prototype.ensureFeaturedKimiSearchIsReady=function(){let t;return(i.exists(t=this.kimiHomeSearchResults)&&t.length)>0?void 0:this.refreshKimiHomeSearch()},this.prototype.search=function(t){return this.models.navState.showSearch(t)},this.prototype._searchFailed=function(t){let e,n,r,a;return this.postSearchResults=this.topicSearchResults=this.userSearchResults=[],({info:e}=t),e&&({message:n,status:r,data:a}=e),null!=n||(n=i.exists(a)&&a.message),r||(r=s),n||o({searchFailed:{error:t,status:r,message:n}}),this.searchError={status:r,message:n}},this.prototype._runSearch=function(){return this.searchError=null,this.loading=!0,this.onNextReady().then(()=>{let t,e,s,l,u,c,h,p,d,f,m,g,y;if(({query:t="",searchKimis:e,order:s,userId:l,topicId:u}=this.currentSearchOptions),c=e?"kimis":"normal",e&&(t+=" :templates"),s&&(t+=` order:${i.toString(s)}`),l&&(t+=` user:${i.toString(l)}`),u&&(t+=` stream:${i.toString(u)}`),e)h=!0,p=d=!1;else{if(({people:p,kimis:f,streams:d,posts:h,new:m}=(g=r.postSearch.extractQueryStringProps(t)).queryOptions),o({newOption:m}),m)switch(m){case"people":p=!0;break;case"streams":d=!0;break;case"posts":h=!0;break;case"kimis":f=!0}f&&(h=!0),p||d||h||(p=d=h=!0)}return o({query:t}),y={returnResponse:!0,props:{queryVersion:2,include:"auto",data:{query:t,vertical:a.vertical}}},n.all([h?r.postSearch.search(y):void 0,d?r.topicSearch.search(y):void 0,p?r.userSearch.search(y):void 0]).then(([t,e,n])=>{let r,o,s,a,l,u,c,h,p;return i.exists(c=i.exists(t)&&t.props)&&(r=c.metadata,o=c.data),this.postSearchMetadata=r,this.postSearchResults=o,i.exists(h=i.exists(e)&&e.props)&&(s=h.metadata,a=h.data),this.topicSearchMetadata=s,this.topicSearchResults=a,i.exists(p=i.exists(n)&&n.props)&&(l=p.metadata,u=p.data),this.userSearchMetadata=l,this.userSearchResults=u}).catch(t=>this._searchFailed(t))}).tap(this.clearLoading)},this.prototype._subscribeToSearchChanges=function(){return this.subscribeOnModelRegistered({modelName:"navState",key:"searchOptions",updatesCallback:()=>this.searchQueryChanged()}),this.subscribeOnModelRegistered({modelName:"navState",key:"featuredKimiTags",updatesCallback:this.refreshKimiHomeSearch})},this.prototype.searchQueryChanged=function(){let t,e,n,i,r;return({searchOptions:t}=this.models.navState),({searchKimis:e}=t),e||(t=l(t,{order:"date"})),u(t,this.currentSearchOptions)?(this.clearSearchResults(),({searchKimis:e,query:n,userId:i,topicId:r}=this.currentSearchOptions=t),i||r||c(n)?this._runSearch():void 0):void 0}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","membershipExpired","models","getEnv"],[e,n(768)],(t,e,r,o)=>{return i.defClass(class SubscriptionPromptState extends(n(594)(t)){},function(t,n,i){this.persistant(),this.stateFields({expiredUserInterventionMessageShown:!1}),this.getter({expiredUserInterventionEventKey:function(){return"expiredUserIntervention"},currentUserQualifiesForExpiredIntervention:function(){return e(r.currentSession.currentUser)},showExpiredIntervention:function(){return o().showExpiredIntervention||this.currentUserQualifiesForExpiredIntervention&&!this.expiredUserInterventionMessageShown}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","toSeconds","Date","secondsPer","Promise","pipelines","getDisplayTitle","compactFlatten","getDisplayChapterTitle","getShortPostTitle","upperCamelCase","encodeURIComponent","present","getVerticalProductName","eq","log","nativeAppDetect","formattedInspect","timeout","location","StringConstants","parseQuery","getTopicTitle","clientFailureNotAuthorized","merge","lowerCamelCase","String","config","decodeURIComponent","missing"],[e,n(768)],(n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F)=>{let B;return B=!e.cordova&&!t.hot,i.defClass(class UrlBarState extends n{constructor(){super(...arguments),this._bindOnPopState(),this.onNextReady(this._initFromLocation),this.browserHistoryEnabled=B}},function(t,n,R){let z,O,L,D,N,U;this.stateFields({currentUrlState:null}),this.prototype.getPageTitle=function(t,e){return"post"===t.name?a.all([l.user.get(e.userId),l.topic.get(e.topicId)]).then(([n,r])=>{let o,s;return o=u(r),{title:c([o,h(e),p(e),n.displayName]).join(" - "),urlText:c([d(n.displayName),d(o),e.chapterTitle&&d(h(e)),i.exists(s=t.getTitleText(e))&&s.replace(/[^\w\u007f-\uffff]+/g,"-")]).join("/")}}):a.resolve(t.getUrlText(e))},this.prototype.getRecordLocationState=function(t,e){return e?this.getPageTitle(t,e).then(({title:n,urlText:i})=>({title:n,path:t.getConnonicalUrlPath(e,i),pipelineName:t.name,record:e})):a.resolve(this.getHomeLocationState())},this.prototype.getHomeLocationState=function(){return{title:"Home",path:"/"}},this.prototype.getKimisLocationState=function(){return{title:"Kimis",path:"/kimis",kimis:!0}},this.prototype.pushHomeLocation=function(){return this.push(this.getHomeLocationState())},this.prototype.pushKimisLocation=function(){return this.push(this.getKimisLocationState())},this.prototype.pushRecordLocation=function(t,e){return this.getRecordLocationState(t,e).then(t=>this.push(t))},this.prototype.pushSearchLocation=function(t){return this.push({path:`/search/${i.toString(f(t.replace(/\s+/g,"+")))}`,title:`Search: ${i.toString(t)}`,search:t})},this.prototype.setPageTitle=function(t){let n,i;return({title:n,pipelineName:i}=t),i&&!m(n)&&(n=d(i)),e.document.title=c([g(),n]).join(" - ")},this.prototype.back=function(){return B?e.history.back():void 0},z=0,this.prototype.push=function(t){let n,r,o,s;return({path:n}=t),m(r=i.exists(s=e.location)&&s.search)&&(n+=r),t.count=z++,o=this.setPageTitle(t),y(this.currentUrlState,t)?void 0:(e.cordova||this.browserHistoryEnabled&&(e.history.pushState(t,t.title,t.path),this.doVersionCheck()),l.event.pageChanged({data:{page:[t.path,o]}}),this.currentUrlState=t)},O=L=r(o.now()),D=s.day,N=s.hour,this.prototype.doVersionCheck=function(){let t,e;return t=r(o.now()),e=N-(t-L),v(`seconds until update-check: ${i.toString(e)}`),e<0?this.doVersionCheckNow():void 0},this.prototype.doVersionCheckNow=function(){let t;return S()?void 0:(L=t=r(o.now()),l.status.version().then(e=>l.event.create("client:checkVersion",{data:e}).then(()=>(O=t,v(b({versionCheck:e})),e.updateAvailable?(l.event.create("client:reload",{data:e}),w(100,()=>x.reload())):void 0))).catch(e=>{let n;return v({versionCheck:{error:e}}),(n=t-O)>D?x.reload():void 0}))},U=!1,this.prototype._bindOnPopState=function(){return!U&&B?(e.onpopstate=(({state:t})=>{let n,i;return null!=t||(t={}),null!=t.count?(n=z>t.count,z=t.count):n=!1,i=this.setPageTitle(t),this.currentUrlState=t,this.models.navState.navigateTo(t,n),l.event.pageChanged({data:{page:[e.location,i]}})}),U=!0):void 0},this.prototype._startWithReferrer=function(t){return this.models.user.get(t).then(t=>t?w(100,()=>{let e,n;return(e=this.models.currentSession.currentUserId)?this.models.navState.showSystemMessage({text:e!==t.id?P.referrals.notEligableMessage:P.referrals.ownReferralLinkMessage,stringVariables:(({displayName:n}=t),{displayName:n})}):this.models.navState.showLogin()}):void 0)},this.prototype._initFromLocation=function(){return this.initFromPathAndParams(e.location.pathname,C())},this.prototype.getInitialRecord=function(t,n){return a.then(()=>{let r,o,s;return null!=(r=i.exists(o=e.artFluxInit)&&i.exists(s=o[t])&&s[n])?r:this.models[t].get(n)})},this.prototype.doUrlAction=function({post:t,action:e,actor:n,currentUserId:r,postId:o}){return r=this.models.currentSession.currentUserId,"unsubscribe"===e&&n?l.topicFollower.unsubscribe({key:{topicId:t.topicId,userId:n}}).then(()=>l.topic.get(t.topicId)).then(t=>this.models.navState.showSystemMessage(`Unsubscribe successful. You should no longer recieve notifications for new posts in the stream: ${i.toString(_(t))}`)):n&&n===r?(()=>{switch(e){case"post":return this.models.navState.postToTopic(t.topicId);case"comment":return this.models.navState.showMessages(t);case"settings":case"followSettings":return this.models.navState.showTopicSettings(t)}})():this.models.navState.showSystemMessage((()=>{switch(!1){case!(null==n):return"The action-url parameter also requires an actor-url parameter.";case!r:return"The action you selected was meant for another account. You need to log out and then log in using the matching email address.";default:return"You need to log in to use that action."}})())},this.prototype._startWithStreamInvite=function(t){return v("_startWithStreamInvite"),l.topicInviteLink.get(t).then(t=>this.models.navState.showTopic(t.topicId)).tapCatch(t=>t.status===E?this.models.navState.showSystemMessage("We're sorry, but that streamInvite is invalid."):v({error:t}))},this.prototype.initFromPathAndParams=function(t,e,n){let r,o,s,l,u,c,h,p,d,f,g,y,S,b,w,x,P,C,_,R,z,O,L;return this.browserHistoryEnabled=!1,[r,o,s]=t.split("/"),o=void 0!==(z=e.urlKind)?z:o,s=void 0!==(O=e.urlKey)?O:s,l=e.post,u=e.postId,c=e.stream,h=e.topic,p=e.topicId,d=e.member,f=e.user,g=e.userId,y=e.referrer,S=e.authCode,b=e.authKey,w=e.action,x=e.actor,P=e.notification,C=e.key,_=e.streamInvite,v({UrlBarState_initFromPathAndParams:{dontNavigateHome:n,path:t,params:e,decoded:T({urlKind:o,urlKey:s,post:l,postId:u,stream:c,topic:h,topicId:p,member:d,user:f,userId:g,referrer:y,authCode:S,authKey:b})}}),_&&this._startWithStreamInvite(_),b&&S&&this.models.authenticationState.authenticateFromLink(b,S),y&&this._startWithReferrer(y),null!=d||(d=null!=f?f:g),null!=l||(l=u),null!=h||(h=null!=c?c:p),i.each2({member:d,topic:h,post:l},(t,e)=>(o=e,s=t),(t,e)=>t),R=(()=>{switch(o=k(o)){case"docs":return s=i.is(s,I)?i.exists(L=M.docToPostIds)&&L[s.split(".")[0]]:void 0,"post";case"stream":return"topic";case"member":return"user";case"topic":case"post":return o}})(),m(s)||(s=null),m(o)||(o=null),v({UrlBarState_initFromPathAndParams:{pipelineName:R,urlKind:o,urlKey:s}}),a.then(()=>{let r;return r=this.models.currentSession.currentUserId,(()=>{switch(!1){case!(R&&s):return this.getInitialRecord(R,s).tap(t=>this.models.navState.navigateTo({pipelineName:R,record:t})).tap(o=>"post"===R&&w&&x?r?this.doUrlAction({action:w,actor:x,currentUserId:r,post:o}):this.models.navState.authenticate({prompt:`Log in to ${i.toString((()=>{switch(w){case"post":return"post.";case"comment":return"comment.";case"settings":return"change your stream settings.";case"followSettings":return"change your following and subscription settings.."}})())}`}).then(()=>this.initFromPathAndParams(t,e,n)):void 0);case!("search"===o):return this.models.navState.navigateTo({search:A(s.replace(/\+/g," "))});case!!n:return this.models.navState.home()}})()}).finally(()=>this.browserHistoryEnabled=B).catch(t=>{let e,r,o;return(()=>{switch(e=null!=(r=i.exists(t)&&t.status)?r:i.exists(t)&&i.exists(o=t.info)&&o.status){case E:case F:return v.error({UrlBarState_initFromPathAndParams:{status:e,action:"home"}}),n?void 0:this.models.navState.home();default:return v.error({UrlBarState_initFromPathAndParams:{status:e,error:t,action:"throw"}}),(()=>{throw t})()}})()})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(305)).addModules({AuthenticationState:n(1005),CurrentSession:n(1006),StatusBar:n(1007)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["secondsPer","ApplicationState","currentSecond","merge","objectKeyCount","isString","log","pending","timeout","pipelines","dateFormat","vertical","toSeconds","compactFlatten","success","present","capitalize","failure","getHumanStatusError"],[e,n(760)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S)=>{let b;return b=15*t.minute,i.defClass(class AuthenticationState extends e{},function(t,e,w){let x,P,C,_;this.stateFields({resendOks:0,openRequests:{},reason:null,currentRequestEmail:null,errorMessage:null,didYouMean:null,requestAuthenticationStatus:null,isNewUser:!1,imikimiUser:null,displayName:null}),x={},P=n(),C=function(){return n()-P|0},_=function(t){return t?t.imikimiUser?"newImikimiUser":t.isNewUser?"newUser":"existingUser":"nonFatalInternalError"},this.getter({eventProps:function(){let t;return r({reason:this.reason,isNewUser:this.isNewUser,openRequests:0<(t=o(this.openRequests))?t:void 0,errorMessage:this.errorMessage,displayName:this.displayName,currentRequestEmail:this.currentRequestEmail},this.imikimiUser?{imikimiUsername:this.imikimiUser.username,imikimiUserId:this.imikimiUser.id}:void 0)}}),this.prototype.createEventForUi=function(t,e={}){let n,i;return({email:n,address:i}=e),this.createEvent(t,null!=n?n:i,e)},this.prototype.createEvent=function(t,e,n){let o,l,u;return e&&(s(e)?[o,l]=e.split("@"):a.error({address:e,message:"AuthenticationState createEvent Address is NOT null and not a string"})),u=r({address:e,addressDomain:l},this.eventProps,n),this.models.event.create(`auth:${i.toString(t)}`,{data:u})},this.prototype.requestAuthentication=function(t,e){let o,s,g;return o=`requestAuthentication:${i.toString(e||"login")}:`,x[t]?(a(`AuthenticationState: email is known-invalid, show previous error: ${i.toString(t)}`),this._setErrorMessage(x[t]),{requestCreated:!1,error:x[t]}):(this.createEvent(o+"start",t),this.requestAuthenticationStatus=l,this.authenticationRequestSentAt=s=n(),u(1e3*b+100,()=>this.resendOks++),c.session.createAuthenticationRequest({data:{address:t,requestHandle:g=h("h:MMtt"),reason:e,vertical:p}}).then(n=>{let s,l,u,c,h,p,g;return a({authenticationRequest:n}),({expirationDate:s,createdAt:l}=n),u=d(s),l=d(l),n.clientSideReceivedAt=c=C(),n.clientSideExpiresAt=c+u-l,this.openRequests=r(this.openRequests,{[t]:f([n,this.getOpenRequests(t)])}),h=n.isNewUser,p=n.imikimiUser,e=n.reason,this.isNewUser=h,this.imikimiUser=p,this.reason=e,this.createEvent(o+`success:${i.toString(_(n))}`,t),this.requestAuthenticationStatus=m,this.currentRequestEmail=t,null!=(g=this.displayName)||(this.displayName=this.getDisplayNameFromAddress(t)),this.clearMessages(),{requestCreated:!0}}).catch(n=>{let r,s,l,u,c;return i.exists(l=r=i.exists(u=n.info)&&i.exists(c=u.response)&&c.data)&&l.emailIsInvalid&&(x[t]=n,a(`AuthenticationState: marking email invalid ${i.toString(t)}`),this.createEvent(o+`failure:${i.toString(r.reason||"login")}:emailInvalid`,t,(({reason:e,code:s}=r),{reason:e,code:s}))),this._setErrorMessage(n),{requestCreated:!1,error:n}}))},this.prototype.getDisplayNameFromAddress=function(t){return g(t)?y(t.split("@")[0]):"New Guest"},this.prototype.selectOpenRequest=function(t){let e,n;return(e=i.exists(n=this.openRequests[t])&&n[0])?(this.currentRequestEmail=t,this.isNewUser=e.isNewUser,this.imikimiUser=e.imikimiUser):void 0},this.prototype.getOpenRequests=function(t,e){let n;return null!=e||(e=0),n=e+C(),i.array(this.openRequests[t],null,t=>n<t.clientSideExpiresAt)},this.prototype.getCurrentOpenRequest=function(t){return this.getOpenRequests(t)[0]},this.prototype.haveOpenRequests=function(t){let e;return(i.exists(e=this.openRequests[t])&&e.length)>0},this.prototype.resendOk=function(t,e){let n,r;return null!=e||(e=b),n=C(),r=this.haveOpenRequests(t)&&!i.find(this.openRequests[t],({clientSideReceivedAt:t})=>n<t+e)},this.prototype.authenticateUser=function(t,e){let n,r,o;return i.exists(e)&&(n=e.referringUserId,r=e.testMode),this._authenticate({address:o=this.currentRequestEmail,authenticationRequest:this.getCurrentOpenRequest(o),displayName:this.displayName,authenticationCode:t,referringUserId:n,testMode:r})},this.prototype._authenticate=function(t){let e,n,r,o,s,a;return e=t.address,n=t.authenticationCode,r=t.authenticationRequest,o=t.referringUserId,s=t.displayName,a=t.testMode,null!=s||(s=this.getDisplayNameFromAddress(e)),c.session.authenticate({data:{address:e,authenticationCode:n,referringUserId:o,authenticationRequestId:i.exists(r)&&r.id,displayName:s}}).tap(t=>{let n,s,a,l;return e=t.address,n=t.denormalizedAddress,s=t.lastUsedAt,a=t.useCount,l=t.userId,this.createEvent(`authenticateUser:success:${i.toString(_(r))}`,e,{authKey:t,address:e,denormalizedAddress:n,lastUsedAt:s,useCount:a,referringUserId:o}),this.clearMessages()}).then(({userId:t})=>this.models.user.get(t)).tap(()=>a?void 0:u(1e3,()=>this.resetState())).catch(t=>{let n,o;return this.createEvent(`authenticateUser:failure:${i.toString(_(r))}`,e,(({status:n,message:o}=t),{status:n,message:o})),this._setErrorMessage(t),(()=>{throw t})()})},this.prototype.authenticateFromLink=function(t,e){return this._authenticate({address:t,authenticationCode:e,displayName:this.displayName})},this.prototype.clearMessages=function(){return this.didYouMean=this.errorMessage=null},this.prototype._setErrorMessage=function(t){let e,n,r,o,s,l,c;return a({authenticateState:{errorResponse:t}}),i.exists(l=t.info)&&(e=l.data,i.exists(e)&&(n=e.message,r=e.didYouMean,o=e.reason),s=void 0!==(c=l.status)?c:v),this.requestAuthenticationStatus=s,this.clearMessages(),r?this.didYouMean=r:this.errorMessage=S(s,n),u(1e4,this.clearMessages)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Validator","FluxSubscriptionsMixin","ApplicationState","Object","session","isTrialMember","membershipExpiresIn","fastHash","secondsPer","pipelines","getMembershipType","humanDurationString","isMember","shouldStartTrialMembership","wasSubscribingMember","toSeconds","log","nativeAppDetect","timeout","success","pending","missing","Promise"],[e,n(760)],(t,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C)=>{let _;return _=new t({userId:"string"}),i.defClass(class CurrentSession extends(n(r)){constructor(){super(...arguments),this._lastCurrentUser=null,this._bindSessionChangeEvent()}},function(t,n,r){let E,T;this.persistant(),this.prototype.postProcessLoadedState=function(t){return i.object(t,null,(t,e)=>i.in(e,T))},this.stateFields(E={currentUserId:null,currentUser:null,currentUserStatus:null,grantMemberAccess:!1}),T=o.keys(E),this.getter({adminUserId:function(){return s.data.adminUserId},currentlyAdmin:function(){return this.currentUserId&&this.currentUserId===this.adminUserId},canReturnToAdmin:function(){let t,e;return({adminUserId:t,currentUserId:e}=this),t&&t!==e}}),this.prototype.getMembershipStatusMessage=function(){let t,e,n,r,o,s;return this.currentUser&&(a(this.currentUser)||(t=0>l(this.currentUser)))?(n=(e=l(this.currentUser))>0?14:10+i.mod(u(this.currentUser.id),10),(r=e&&e<n*c.day)&&h.event.create("session:warnTrialExpiration",{startWarningInDays:n}),o=p(this.currentUser),s=r?t?"(membership expired)":`(${i.toString(o)} - ${i.toString(d(e,!0))} left)`:`(${i.toString(o)})`):void 0},this.prototype.reload=function(){return this.models.user.reload(this.currentUserId).then(({data:t})=>this.currentUser=t)},this.setter({currentUserId:function(t){return t!==this.currentUserId?this.setState("currentUserId",t):void 0},currentUser:function(t){let e;return i.exists(t)&&t.mergedIntoUserId?this.logOut(!0):(e=this._lastCurrentUser,this._lastCurrentUser=t,this.setState({currentUser:t,grantMemberAccess:f(t)}),(i.exists(t)&&t.id)!==(i.exists(e)&&e.id)?this._userChanged(t):void 0)}}),this.prototype._userChanged=function(t){let e,n,r,o,s,a;return t?(e=t.id,n=t.displayName,r=t.subscriptionExpiresAt,o=t.membershipType,m(t)&&(h.event.create("session:authenticatedStart:startTrialMembershipOnExistingAccount"),h.user.startTrialMembership()),(g(t)||null!=t.subscriptionExpiresAt&&y()>y(t.subscriptionExpiresAt))&&(v(s=`currentUser (${i.toString(t.id)}) was previously subscribed, but doesn't appear to be now... lets double-check...`),h.stripeSubscription.refreshFromStripe({returnNullIfMissing:!0}).then(t=>v({message:s,result:t}))),a={data:{userId:e,name:n,subscriptionExpiresAt:r,membershipType:o}},h.event.create("session:authenticatedStart:any",a),h.event.create(`session:authenticatedStart:${i.toString(o)}${i.toString(f(t)?"":"Expired")}`,a)):this.resetState()},this.prototype.logOut=function(t){return h.event.create("session:logout").then(()=>(this.currentUser=this.currentUserId=null,h.session.logOut().tapCatch(()=>s.reset()))).then(()=>t||S()?void 0:b(100,()=>e.location.reload()))},this.prototype._updateFromCurrentUserFluxRecord=function(t){return(()=>{switch(this.currentUserStatus=t.status){case w:return this.currentUser=t.data;case x:return null;case P:return this.logOut(!0);default:return v({_updateFromCurrentUserFluxRecord:{problemLoadingUser:{currentUser:this.currentUser,currentUserId:this.currentUserId,fluxRecord:t}}})}})()},this.prototype._bindSessionChangeEvent=function(){return s.loadSession().then(()=>(this._setCurrentUserId(s.data.userId),s.on({change:t=>{let e;return({props:{data:e}}=t),C.then(()=>_.validate(e)).then(()=>e.userId!==this.currentUserId?this._setCurrentUserId(e.userId):void 0).catch(t=>(v.error("Session is invalid. Resetting.",t),s.reset()))}})))},this.prototype._setCurrentUserId=function(t){let e;return h.event.userChanged({data:{id:t}}),(i.exists(e=this.currentUser)&&e.id)!==t&&(this.currentUser=null),this.currentUserId=t,this.unsubscribeAll(),t?(this.models.user.reload(t),this._updateFromCurrentUserFluxRecord(this.subscribe({modelName:"user",key:t,updatesCallback:this._updateFromCurrentUserFluxRecord}))):void 0}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxSubscriptionsMixin","ApplicationState","Error","peek"],[e,n(760)],(t,r,o,s)=>{return n(765),i.defClass(class StatusBar extends(t(r)){constructor(){super(...arguments),this._statusBarStack=[],this.subscribe({modelName:"viewState",stateField:"viewState",key:"mySubscription",updatesCallback:({data:t})=>this._updateStatusBar(this.statusBarStyle,t)})}},function(t,n,r){this.stateFields({statusBarStyle:"dark"}),this.prototype.pushStatusBarTextStyle=function(t){if("light"!==t&&"dark"!==t&&"off"!==t)throw new o(`bad statusBarStyle: ${i.toString(t)}`);return this._statusBarStack.push(this._updateStatusBar(this.statusBarStyle=t))},this.prototype.popStatusBarTextStyle=function(){let t;return this._statusBarStack.pop(),this._updateStatusBar(this.statusBarStyle=null!=(t=s(this._statusBarStack))?t:"dark")},this.prototype._updateStatusBar=function(n,r=this.models.viewState.state){let o,s,a;if(t=e.StatusBar,o=r.isTablet,s=r.landscape,"iOS"===(a=r.simpleBrowserInfo).os)switch(o?n="dark":s&&(n="off"),n){case"light":i.exists(t)&&t.show(),i.exists(t)&&t.styleLightContent();break;case"dark":i.exists(t)&&t.show(),i.exists(t)&&t.styleDefault();break;case"off":i.exists(t)&&t.hide()}return n}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(306)).addModules({PhotoAsset:n(1009)})},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>{})}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(270)).includeInNamespace(n(1011)).addModules({EventLogMixin:n(594),ImikimiOzConfig:n(560),ServerSideMixins:n(595),SharedImport:n(539),SharedLib:n(541),StandardImport:n(538),StringConstants:n(590),VerticalInfo:n(589),ZoNamespace:n(1013)}),n(1014),n(1019),n(542),n(544),n(649)},function(t,e,n){"use strict";(function(t,e){n(3).defMod(t,()=>{let t,i=e.Neptune;return{deployedAt:n(1012).deployedAt,ServerSide:null!=(t=i.Imikimi.Oz.ServerSide)?t:{}}})}).call(this,n(2)(t),n(5))},function(t){t.exports=JSON.parse('{"deployedAt":1576539620.75}')},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(270))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(273)).addModules({Development:n(1015),Production:n(1017),Test:n(1018)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Config"],[e,n(538)],t=>{return i.defClass(class Development extends t{},function(t,e,i){this.prototype.Art={Aws:{credentials:{accessKeyId:"blah",secretAccessKey:"blahblah"},region:"us-east-1",s3Buckets:{expiringUploads:"oz-dev-expiring-uploads",media:"oz-dev-media"},dynamoDb:{endpoint:"http://localhost:1337/localhost:8081"}},Ery:{tableNamePrefix:"oz-dev."},EryExtensions:{Pusher:{key:"844c5741f5bd66ca9150",cluster:"mt1",verifyConnection:!0},Elasticsearch:{index:"ImikimiOzDev",endpoint:"http://localhost:1337/localhost:9200"}}},this.prototype.Imikimi={Oz:{minTopCount:0,zoimages:{domain:"https://oz-dev-media.imgix.net"},stripe:{plan:"kimifan_monthly",membershipProductId:"prod_DsqRPlyV3IuSMv"},analytics:{google:{id:"UA-2375278-5"}}}},this.deepMergeInConfig(n(1016)[this.name])})}))}).call(this,n(2)(t),n(5))},function(t,e){t.exports={}},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Config"],[e,n(538)],t=>{let e;return e=n(212).simpleBrowserInfo,i.defClass(class Production extends t{},function(t,r,o){this.prototype.Art={Aws:{s3Buckets:{expiringUploads:"oz-prod-expiring-uploads",media:"zofiles.imikimi.com"}},Ery:{tableNamePrefix:"oz-prod."},EryExtensions:{Pusher:{appId:"126418",key:"844c5741f5bd66ca9150",cluster:"mt1"},Elasticsearch:{index:"ImikimiOzProd"}}},this.prototype.Imikimi={Oz:{docToPostIds:{community:"SrVzJBWxwSMt",help:"txmQ3jggs4MI",privacy:"SrVzJBWxwSMt",terms:"Uffq6OJ5wvzj",copyright:"lQg4PokO9bX7"},featureDemoStreams:{posterText:"GJ1B6B7U0uBY"},tutorial:{streams:{zGnU5z3RZMjE:"Kimi Basics: Find/Make/Save/Use",bvvJvi6UIjVK:"Finding a Kimi for your Photo","43SxGVugFQD5":"Add Your Photo to a Kimi",JUprWHCnZWSW:"Sharing Your Kimi Post",MgK3z99sE8Ge:"Streams & Chapters, the Basics",FvCqnq5YvP0J:"Make a Stream with Chapters",mpBhZAEtxdwX:"Private Streams - How to",oZaW2RZfliR6:"Streams/Chapters Example: Family",AHimCGitJnP6:"DropIn Basics",LNNQP4p2JLpY:"Kimi Frame Maker Basics","28EyTjg74aFS":"Log in Help"}},newsTopics:["cKya2K2jKXwB","nuJSgS7Bqizc"],newsTopicId:i.exists(e)&&e.nativeApp?void 0:"cKya2K2jKXwB",newsTopic2Id:i.exists(e)&&e.nativeApp?void 0:"nuJSgS7Bqizc",files:{domain:"https://zofiles.imikimi.com"},zoimages:{domain:"https://zoimages.imikimi.com"},stripe:{publishable:"pk_live_jh3d16NC5uG6QKPuAa2cGE3u",plan:"kimifan_monthly",membershipProductId:"prod_BUWXmay8fGf1gI"},analytics:{google:{id:"UA-2375278-4"}}},Auth:{blockedAddresses:["sivilay@gmail.com"]}},this.deepMergeInConfig(n(1016)[this.name])})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Config","getEnv"],[e,n(538)],(t,e)=>{return i.defClass(class Test extends t{},function(t,i,r){this.prototype.Art={Aws:{credentials:{accessKeyId:"blah",secretAccessKey:"blahblah"},region:"us-east-1",s3Buckets:{expiringUploads:"oz-test-expiring-uploads",media:"oz-test-media"},dynamoDb:{endpoint:"http://localhost:1337/localhost:8081"}},Ery:{verbose:!1,tableNamePrefix:"oz-test.",remoteServer:e().prod?"http://localhost:8085":void 0},EryExtensions:{Elasticsearch:{index:"ImikimiOzTest",endpoint:"http://localhost:1337/localhost:9200"}}},this.prototype.Imikimi={Oz:{App:{zoimages:{domain:"https://oz-test-media.imgix.net"}},minTopCount:10,stripe:{plan:"kimifan_monthly",membershipProductId:"prod_DsqRPlyV3IuSMv"},analytics:{google:{id:"UA-2375278-5"}},zoimages:{domain:"https://zoimages.imikimi.com"}},Auth:{testAuthenticationKey:"123-abc",blockedAddresses:["testBlockedAddress@gmail.com"]}},this.deepMergeInConfig(n(1016)[this.name])})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(274)).addModules({KimiCategories:n(774)})},function(t,e){!function(n,r,s){function o(t,e){return typeof t===e}function i(e,n){if("object"==typeof e)for(var r in e)h(e,r)&&i(r,e[r]);else{var o=(e=e.toLowerCase()).split("."),s=c[o[0]];if(2==o.length&&(s=s[o[1]]),void 0!==s)return c;n="function"==typeof n?n():n,1==o.length?c[o[0]]=n:(!c[o[0]]||c[o[0]]instanceof Boolean||(c[o[0]]=new Boolean(c[o[0]])),c[o[0]][o[1]]=n),function t(e){var n=d.className,i=c._config.classPrefix||"";if(f&&(n=n.baseVal),c._config.enableJSClass){var r=new RegExp("(^|\\s)"+i+"no-js(\\s|$)");n=n.replace(r,"$1"+i+"js$2")}c._config.enableClasses&&(n+=" "+i+e.join(" "+i),f?d.className.baseVal=n:d.className=n)}([(n&&0!=n?"":"no-")+o.join("-")]),c._trigger(e,n)}return c}var l=[],u={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(t,e){var n=this;setTimeout(function(){e(n[t])},0)},addTest:function(t,e,n){l.push({name:t,fn:e,options:n})},addAsyncTest:function(t){l.push({name:null,fn:t})}},c=function(){};c.prototype=u,c=new c;var h,p=[];!function(){var t={}.hasOwnProperty;h=o(t,"undefined")||o(t.call,"undefined")?function(t,e){return e in t&&o(t.constructor.prototype[e],"undefined")}:function(e,n){return t.call(e,n)}}();var d=r.documentElement,f="svg"===d.nodeName.toLowerCase();u._l={},u.on=function(t,e){this._l[t]||(this._l[t]=[]),this._l[t].push(e),c.hasOwnProperty(t)&&setTimeout(function(){c._trigger(t,c[t])},0)},u._trigger=function(t,e){if(this._l[t]){var n=this._l[t];setTimeout(function(){var t;for(t=0;t<n.length;t++)(0,n[t])(e)},0),delete this._l[t]}},c._q.push(function(){u.addTest=i}),c.addAsyncTest(function(){function e(t,e,n){function o(e){var o=!(!e||"load"!==e.type)&&1==r.width;i(t,"webp"===t&&o?new Boolean(o):o),n&&n(e)}var r=new Image;r.onerror=o,r.onload=o,r.src=e}var t=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],n=t.shift();e(n.name,n.uri,function(n){if(n&&"load"===n.type)for(var i=0;i<t.length;i++)e(t[i].name,t[i].uri)})}),function a(){var t,e,n,i,r,s;for(var a in l)if(l.hasOwnProperty(a)){if(t=[],(e=l[a]).name&&(t.push(e.name.toLowerCase()),e.options&&e.options.aliases&&e.options.aliases.length))for(n=0;n<e.options.aliases.length;n++)t.push(e.options.aliases[n].toLowerCase());for(i=o(e.fn,"function")?e.fn():e.fn,r=0;r<t.length;r++)1===(s=t[r].split(".")).length?c[s[0]]=i:(!c[s[0]]||c[s[0]]instanceof Boolean||(c[s[0]]=new Boolean(c[s[0]])),c[s[0]][s[1]]=i),p.push((i?"":"no-")+s.join("-"))}}(),delete u.addTest,delete u.addAsyncTest;for(var m=0;m<c._q.length;m++)c._q[m]();n.Modernizr=c}(window,document)},function(t,e,n){(t.exports=n(283)).addModules({App:n(1022),ComponentsNamespace:n(846),ExpiredUserIntervention:n(1233),RootComponent:n(1023),RootLoadingScreen:n(1232),StandardImport:n(810),VersionWatermark:n(1234),ZoComponentsNamespace:n(869)}),n(906),n(1192),n(1024),n(909),n(805)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","CanvasElement"],[e,n(810)],(t,e)=>{return i.defClass(class App extends t{},function(t,i,r){this.subscriptions("currentSession.currentUser","currentSession.currentUserId"),this.prototype.ready=function({target:{currentSize:t}}){return this.models.viewState.setViewSize(t)},this.prototype.render=function(){return e({on:{ready:this.ready}},n(1023)({currentUser:this.currentUser,currentUserId:this.currentUserId}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Pages","peek","Element","Overlays","Error","merge","TabBar","SecondaryToolbar","TrackingConsentMessage","NotchPreview","StatusBarPreview"],[e,n(810),n(805),n(909),{Pages:n(1024),Overlays:n(1192)}],(t,e,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class RootComponent extends t{},function(t,f,m){let g,y;this.subscriptions("statusBar.statusBarStyle","navState.navState","viewState.viewState","subscriptionPromptState.expiredUserInterventionMessageShown","gdprComplianceState.userAcceptedTracking",{participantsByUserIdDesc:g=function({currentUserId:t}){return t},currentChannelTopics:{model:"channelTopicsByChannelId",key:y=function({currentUser:t}){return i.exists(t)&&t.defaultChannelId}},topics:{model:"topicsByUserId",key:g},topicFollowersByUserId:g}),this.propFields({currentUser:null,currentUserId:null}),this.getter({currentUserProps:function(){return{currentUser:this.currentUser,currentUserId:this.currentUserId}},currentTab:function(){return this.navState.currentTab},navStack:function(){return this.navState.navStack},topPageComponent:function(){let t,n;return e[null!=(t=i.exists(n=r(this.navStack))&&n.pageName)?t:this.currentTab]},hideTabBars:function(){let t;return i.exists(t=this.topPageComponent)&&i.isF(t.getFullscreen)&&t.getFullscreen()},rightTabBarVisible:function(){return"right"===this.viewState.tabBar&&(0===this.navState.navStack.length||!r(this.navState.navStack).hideTabBar)},primaryTabBarVisible:function(){let t;return"top"===(t=this.viewState.tabBar)||"bottom"===t||this.rightTabBarVisible}}),this.prototype.renderOverlay=function(){let t,e,n,r,l,u;return({overlay:t}=this.navState),({landscape:e,viewHeight:n}=this.viewState),o({inFlow:!1,receivePointerEvents:t?"inLogicalArea":"never",size:e?{h:n,ww:1}:"parentSize"},t?o({inFlow:!1,on:{pointerClick:this.models.navState.hideOverlay}}):void 0,t?(({overlayFactory:r,type:l,props:u}=t),null!=r||(r=s[l]),r||(()=>{throw new a(`cannot find Overlay named ${i.toString(t.type)}`)})(),r(u,this.currentUserProps)):void 0)},this.prototype.renderMainContent=function(t){let n,s,a,u,c,h,p,d,f;return p=this,n=this.navStack,s=this.currentTab,a=(d=this.viewState).fullScreen,u=d.landscape,c=d.viewHeight,t=l(t,this.currentUserProps),this.models.statusBar.pushStatusBarTextStyle(this.navState.overlay?"light":n.length>0?(({pageName:h}=r(n)),i.exists(f=e[h])&&i.isF(f.getStatusBarType)&&f.getStatusBarType()||"dark"):"dark"),o("column",{key:"main",draw:a||u?void 0:{child:"mainContentWrapper"}},a||u?void 0:this.renderSecondaryToolbar(),o({key:"mainContentWrapper"},i.array(["ZoHome","Search"],i=>{let r;return r=0===n.length&&s===i,e[i](t,{key:i,visible:r})}),i.array(n,({pageName:r,props:o,key:s},a)=>{let l;return l=a===n.length-1,i.isF(e[r])&&e[r](t,o,{key:s,visible:l})})),this.renderOverlay())},this.prototype.renderPrimaryToolbar=function(){let t;return this.primaryTabBarVisible?u(this.currentUserProps,"right"!==this.viewState.tabBar||i.exists(t=this.models.navState.currentPageComponent)&&t.renderPrimaryPhoneToolbar?void 0:[{inFlow:!1},"topRight"]):void 0},this.prototype.renderSecondaryToolbar=function(){return c(this.currentUserProps)},this.prototype.render=function(){let t,e,i,r,s,a,u,c,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k;if(t=(E=this.navState).loading,e=E.navStack,T=this,i=this.hideTabBars,r=this.statusBarStyle,s=(k=this.viewState).tabBar,a=k.landscape,u=k.viewSize,c=k.gridSize,f=k.fullScreen,m=k.safePadding,g=k.nativeApp,y=k.screenHeight,v=k.suggestedPadding,S=k.tabBarWidth,t||(t=!u),({currentSecondaryToolbarRenderer:b}=this.models.navState),!i){switch(s){case"top":v.top>0&&(v=l(v,{top:0}));break;case"bottom":v.bottom>0&&(v=l(v,{bottom:c}));break;case"right":m=l(m,{right:S}),v=l(v,{left:S+c,right:S+c})}"hidden"!==s&&(w=(x=f)?(m=l(m,{top:0}),this.renderPrimaryToolbar()):a?this.renderSecondaryToolbar():void 0,P=x?this.renderSecondaryToolbar():this.renderPrimaryToolbar())}return C=!t,(_=this.models.subscriptionPromptState.showExpiredIntervention)&&(C=!1),o({key:"home",size:a?{h:y,ww:1}:"parentSize"},o(a?"row":"column",{key:"mainContentWithTabBar",visible:C,draw:["children",{child:"primaryToolbar"},{child:"secondaryToolbar"}]},w,this.renderMainContent({safePadding:m,suggestedPadding:v}),P),t&&!g?n(1232)():_?n(1233)():void 0,this.userAcceptedTracking?void 0:h(),this.viewState.previewNotch?p({statusBarStyle:r}):this.viewState.simpleBrowserInfo.fakeNativeApp&&20===m.top?d({statusBarStyle:r}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(290)).addModules({FullscreenPost:n(1025),FullscreenProfile:n(1037),FullscreenTextEditor:n(1038),KimiEditorPage:n(1039),PosterText:n(1151),Search:n(1183),StandardImport:n(1026),ZoHome:n(1188),ZoKimiHome:n(1191),ZoPeopleHome:n(1190),ZoStreamHome:n(1189)}),n(1027),n(1152),n(1184)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","pipelines","merge","LoadingOverlay","TopicBrowserWrapper","FullscreenPostMain","FullscreenPostBrowser","AcceptInvitation"],[e,n(1026),n(1027)],(t,e,n,r,o,s,a,l,u)=>{let c;return c=i.defClass(class FullscreenPostOffscreen extends t{},function(t,n,i){this.prototype.render=function(){return e({draw:"#4"},e("right"===this.props.offscreen?{axis:"topRight",location:"topLeft"}:{axis:"topLeft",location:"topRight"},{size:{w:20,hh:1},draw:{fill:{color:"white",shadow:{offset:0,blur:20,color:"black"}}}}))}}),i.defClass(class FullscreenPost extends t{},function(t,h,p){let d,f;this.getStatusBarType=function(){return"off"},this.subscriptions({topic:d=function({post:t}){return t.topicId},topicMembership:f=function({post:t,currentUserId:e}){return t.topicId&&e&&{topicId:t.topicId,userId:e}},topicInvite:f,topicInviteLink:function(){return n.topicInviteLink.getTopicInviteLinkIdFromEnv()},topicFollower:f,postsDesc:{model:"postsByTopicIdDesc",key:d}},"currentSession.currentUserId"),this.stateFields({showOverlay:!0,canViewTopicResult:null,currentPostInfo:null}),this.propFields("currentUserId"),this.getter({owner:function(){let t;return(i.exists(t=this.topic)&&t.userId)===this.props.currentUserId},simpleCanView:function(){return this.topic&&(!this.topic.private||this.owner)},canViewTopic:function(){let t;return this.topic&&(this.simpleCanView||i.exists(t=this.canViewTopicResult)&&t.canView)},invitationPending:function(){return this.topic&&(null!=this.topicInvite&&!(null!=this.topicInvite.acceptedAt)||this.topicInviteLink&&this.topicInviteLink.topicId===this.topic.id&&this.topic.userId!==this.currentUserId&&"pending"!==this.topicMembershipStatus&&!this.topicMembership)}}),this.prototype.preprocessState=function(t){let e,o,s,a,l,u,c,h,d;return e=t.topic,o=t.canViewTopicResult,s=t.topicStatus,a=(h=this.props).post,l=h.currentUserId,u=null!=(d=i.exists(e)&&e.id)?d:a.topicId,c=(i.exists(e)&&e.userId)===l,e&&(i.exists(o)&&o.topicId)!==u&&(e.private?n.topic.canView(u).then(t=>this.canViewTopicResult={topicId:u,canView:t}):o={topicId:u,canView:!0}),(e&&e.private&&!1===(i.exists(o)&&o.canView)||"success"!==s&&"pending"!==s)&&this.models.navState.closeFullScreenPost(),r(p.preprocessState.apply(this,arguments),{canViewTopicResult:o})},this.prototype.getAnimators=function(t){return t?{axis:{to:{y:1},from:{y:-1}}}:{axis:{to:{y:-1},from:{y:1}}}},this.prototype.preprocessProps=function(t){let e,n,o,s,a;return null!=(i.exists(n=this.props)&&n.post)&&t.post&&(e=this.props.post.topicId)&&e!==t.post.topicId?(i.exists(o=this.refs[e])&&i.exists(s=o.element)&&(s.animators=this.getAnimators(t.back)),t):t.post&&t.post.id!==(i.exists(a=this.props.post)&&a.id)?r(t,{back:t.post.postOrder<this.props.post.postOrder}):t},this.prototype.render=function(){let t,n,r;return e("clip","column",this.canViewTopic?this.topic?s(this.props,{back:null,showOverlay:this.showOverlay,toggleShowOverlay:this.toggleShowOverlay,topic:this.topic,noDots:!0,fullscreenStreamLayout:!0,loadPosts:!0,hideNav:!0,preloadChapterPosts:!1,focusedPostChanged:(t,e)=>(this.currentPostInfo=e,this.models.navState.setFullScreenPost(t)),component:a,offscreenComponent:c}):void 0:e({draw:"white"},o()),l(this.currentPostInfo,{key:"streamNavigator",postId:i.exists(t=this.props.post)&&t.id,topicId:i.exists(n=this.props.post)&&n.topicId}),this.invitationPending?u(null!=(r=this.topicInvite)?r:this.topicInviteLink,{close:this.models.navState.closeFullScreenPost}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(810).mergeWithSelf(n(909)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(291)).addModules({AcceptInvitation:n(1028),FullscreenControlButton:n(1029),FullscreenPostAboveTheFold:n(1030),FullscreenPostBelowTheFold:n(1031),FullscreenPostBrowser:n(1032),FullscreenPostControls:n(1033),FullscreenPostHeading:n(1034),FullscreenPostMain:n(1035),FullscreenPostNavigicationControls:n(1036)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pipelines","pending","logPromise","Element","ImikimiStyles","PopOverTitleBar","ScrollElement","UserCircle","MenuMarkdown","getDisplayName","getTopicTitle","MenuButton","TextStyles","Authenticate"],[e,n(1026),n(906)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m)=>{return i.defClass(class AcceptInvitation extends t{},function(t,g,y){this.subscriptions("viewState.viewState","topic","currentSession.currentUser","currentSession.currentUserId",{invitedByUser:{model:"user",key:function({invitedByUserId:t}){return t}},topicInvite:function({topicId:t,userId:e}){return t&&e&&{topicId:t,userId:e}},topicInviteLink:function(){return e.topicInviteLink.getTopicInviteLinkIdFromEnv()}}),this.propFields("topicId","userId"),this.prototype.close=function(){let t;return i.isF((t=this.props).close)&&t.close()},this.prototype.accept=function(){return e.topicInvite.accept(this.topicId).then(()=>this.models.followingTopic.follow(this.topicId))},this.prototype.acceptAndSubscribe=function(){return e.topicInvite.accept(this.topicId).then(()=>this.models.followingTopic.follow(this.topicId,!0))},this.prototype.decline=function(){return e.topicInvite.decline(this.topicId).then(this.close)},this.prototype.autoCreateInviteFromLink=function(){let t;return this.topicInviteLink&&this.topicInviteStatus!==n&&!this.topicInvite&&this.currentUserId&&this.currentUserId!==(i.exists(t=this.topic)&&t.userId)?r(`AcceptInvitation.render createPersonalTopicInvite: ${i.toString(this.topicInviteLink.id)}`,e.topicInviteLink.createPersonalTopicInvite(this.topicInviteLink.id)):void 0},this.prototype.render=function(){let t,e,n,r,g,y;return t=(g=this.viewState).feedWidth,e=g.gridSize,i.exists(y=this.topicInvite)&&(n=y.declinedAt),this.autoCreateInviteFromLink(),o({draw:"#0007",inFlow:!1},o("centerCenter","column",{draw:[{radius:e,shadow:s.mediumShadow},s.popOverColor],size:r={w:t-e,hch:1,max:{hh:1}}},a({title:n?"Declined Invitation":"Accept Invitation",radius:e,action:this.close}),l({size:r},"clip",o("childrenCenterCenter","column","parentWidthChildrenHeight",{padding:e},u({size:5*e,user:this.invitedByUser,mediaSize:"medium"}),c({text:n?`You declined the\ninvitation to join this stream from ${i.toString(h(this.invitedByUser))}.\n\n>- ${i.toString(p(this.topic))}\n\nWould you like to change your mind?`:`${i.toString(h(this.invitedByUser))}\ninvited you to join this stream:\n\n>- ${i.toString(p(this.topic))}`}),this.currentUser?[c({text:"Would you like to?"}),d(f.mediumText,{icon:"check",text:"accept and subscribe to email updates",action:this.acceptAndSubscribe}),d(f.mediumText,{icon:"check",text:"accept",action:this.accept}),d(f.mediumText,{icon:"cancel",text:"decline",action:this.decline})]:m({padding:{top:e},heading:"Sign Up or Log In to Accept",info:"Sign up with an email address. It takes less than a minute. Then you can choose to follow this stream or subscribe to get email updates.",reason:"acceptTopicInvite"})))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ButtonWrapper2","TextElement","Icons","TextPalette"],[e,n(1026)],(t,e,n,r,o)=>{return i.defClass(class FullscreenControlButton extends t{},function(t,i,s){this.subscriptions("viewState.reducedButtonSize"),this.prototype.render=function(){let t,i,s,a,l,u,c;return t=(c=this.props).action,i=c.shadow,s=c.dark,a=c.foregroundColor,l=c.icon,u=c.scale,e({size:this.reducedButtonSize,hoverColor:a,shadow:i,borderPadding:2,action:t},n(r[l],"textCenterCenter","centerCenter",{scale:null!=u?u:.5,shadow:i,color:(()=>{switch(!1){case!i:return"white";case!s:return o.black.softPrimary;default:return o.white.primary}})()}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","min","getPostAspectRatio","bound","useFullscreenShortCaptionMode","present","CustomizeKimiButton","Element","ShowMedia","TextElement","TextStyles","TextPalette","getAutoChapterTitle","MarkdownView","compactFlatten","pluralize3DidgetCount","PostDate"],[e,n(1026)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y)=>{return i.defClass(class FullscreenPostAboveTheFold extends t{},function(t,v,S){this.subscriptions("viewState.viewState"),this.propFields("backgroundColor","headingHeight","wideLayout","shortView","post","isCoverPhoto","darkBackgroundColor","chapterNumber"),this.stateFields({currentMediaDisplaySize:null}),this.getter({minBelowTheFoldOnscreenHeight:function(){return this.headingHeight*(this.wideLayout&&!this.shortView?2:1)},mediaHeight:function(){let t,i;return t=this.viewState.viewWidth,i=e(t,this.mainAreaFreeHeight-this.minBelowTheFoldOnscreenHeight),this.isCoverPhoto||(i=e(i,t/n(this.post))),i}}),this.prototype.getHeightFromParentSize=function(){let t,r,o,s,a,l,u,c,h,p,d,f,m;return d=this,t=this.headingHeight,r=this.minBelowTheFoldOnscreenHeight,o=this.isCoverPhoto,s=this.post,a=(f=this.viewState).mainAreaWidth,l=f.mainAreaHeight,u=f.gridSize,c=a,p=e(h=l-t-5*u-r),!o&&(i.exists(m=this.post.caption)&&m.length)>200&&(p=e(p,c/n(s))),p+t},this.getter({postAspectRatio:function(){return n(this.post)},partialCoverPhotoPadding:function(){let t,e,n,i,o,s,a;return this.isCoverPhoto?(t=this.getHeightFromParentSize(),e=this.viewState.viewWidth,n=this.postAspectRatio,(o=r(.5*n,i=e/t,2*n))!==i?o<i?{h:(e-(s=o*t))/2}:{v:(t-(a=e/o))/2}:void 0):void 0}}),this.prototype.render=function(){let t,e,n,r,v,S,b,w,x,P,C,_,E,T;return T=this,t=this.headingHeight,e=this.post,n=this.isCoverPhoto,r=this.partialCoverPhotoPadding,v=this.viewState.gridSize,S=o(e),e.mediaFile?(b=S&&s(e.caption),w=e.isChapterStart&&!e.templateFile,b&&!s(e.chapterTitle)&&(w=!1),e.templateFile&&(x=a({post:e})),l("cacheDraw","zoomInCursor",S?void 0:{size:{h:this.getHeightFromParentSize()}},{on:{pointerClick:this.props.toggleShowOverlay}},l(r?{draw:this.darkBackgroundColor,padding:r}:n?null:{draw:this.darkBackgroundColor,padding:{top:t}},u("zoomInCursor",{suggestedPadding:this.suggestedPadding,post:e,mediaSize:"auto",layout:n?"zoom":"fit"})),b||w?l("column","childrenCenterCenter",l(),l("parentWidthChildrenHeight","row","childrenCenterCenter",{padding:(({left:P,right:C}=this.viewState.safePadding),{left:P,right:C})},l("childrenSizeMaxParentWidth",{padding:v},w&&l("childrenSizeMaxParentWidth","column","childrenTopCenter",{childrenMargins:v,padding:v,draw:[{radius:1.5*v+v/4,padding:-v/4,fill:{color:"black"}},"reset",{radius:1.5*v,fill:{color:this.props.foregroundColor}}]},c(h.largeBoldText,"childrenSizeMaxParentWidth","textCenterCenter",{color:p.white.primary,text:d(e)}))),x),b?l("parentWidthChildrenHeight","row","childrenBottomRight",{childrenMargins:v/2,padding:{left:this.viewState.safePadding.left+v,right:this.viewState.safePadding.right+v,v:v},draw:"#00000099"},l("parentWidthChildrenHeight",f({size:{ww:1,hch:1,max:{w:35*v}},lightText:!0,small:!0,text:e.caption,searchKimis:e.templateFile,includeTags:!0,backgroundColor:this.props.backgroundColor,foregroundColor:this.props.foregroundColor})),l("column","childrenSize","childrenTopRight",{childrenMargins:.5*h.tinyText.fontSize},e.templateDropInCount>0||e.templateUseCount>0?c(h.tinyText,"childrenSize","textTopRight",{color:p.white.secondary,text:m([0<(_=e.templateDropInCount)?`${i.toString(g(_,"photo slot"))}`:void 0,0<(E=e.templateUseCount)?`used ${i.toString(g(E,"time"))}`:void 0]).join("\n")}):void 0,y({post:e,oneLine:!0,color:p.white.secondary}))):void 0):x)):l({size:{h:t},draw:this.darkBackgroundColor})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","compactFlatten","pluralize3DidgetCount","max","min","present","Element","MarkdownView","vertical","TextElement","TextStyles","TextPalette","PostDate","SimpleStreamCardForPost"],[e,n(1026)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f)=>{return i.defClass(class FullscreenPostBelowTheFold extends t{},function(t,m,g){this.subscriptions("viewState.viewState","currentSession.currentUserId"),this.getter({infoText:function(){let t,r,o;return t=this.props.post,i.exists(t)&&(r=t.templateUseCount,o=t.templateDropInCount),e([o>0?`frame has ${i.toString(n(o,"photo slot"))}`:void 0,r>0?`frame used ${i.toString(n(r,"time"))}`:void 0]).join(this.wideLayout?", ":"\n")}}),this.prototype.render=function(){let t,e,n,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L;return t=(O=this.viewState).gridSize,e=O.fullScreen,n=O.buttonSize,m=O.isTouchScreen,g=O.viewWidth,y=O.fullScreenPostWidth,v=O.feedWidth,S=O.landscape,b=O.safePadding,w=(L=this.props).post,x=L.topic,P=L.shortView,C=L.suggestedPadding,_=L.backgroundColor,E=L.foregroundColor,T=L.reducedHeading,k=this.infoText,(I=g>=1150)||(y*=.8),M=r(b.left,b.right)+t*(m||!this.wideLayout?1:2),A=1.5*t,F=e?y<g-16*t-4*A?(B=!0,y):o(y,g-t*(m?2:4)):S?((g-v)/2>5*t&&(B=!0),v-2*t):g-2*M,B||(A=1.5*t),R=B?(g-F-2*(A+r(A,M)))/2:F/2,z=s(w.caption),a(["row","childrenTopCenter"],"parentWidthChildrenHeight",{childrenMargins:A,receivePointerEvents:"passToChildren",draw:{padding:{bottom:-1e6},fill:"white"},padding:{h:M,bottom:2*t,top:A}},a(["column","childrenTopCenter"],{size:{w:F,hch:1},padding:e||B?void 0:{left:r(0,C.left-M),right:r(0,C.right-M)}},z?l({post:w,backgroundColor:_,foregroundColor:E,searchInTopicId:("imikimi"!==u||i.exists(x)&&x.private)&&x.id,large:I,searchKimis:w.templateFile,includeTags:!0}):void 0,z?a({size:{h:2*t}}):void 0,a(["parentWidthChildrenHeight","row","cacheDraw"],"childrenTopRight",{childrenMargins:t/2},c(h.tinyText,{color:p.black.secondary,text:k}),d({post:w,oneLine:!0,color:p.black.secondary})),w.templatePostId&&"imikimi"===u?a("parentWidthChildrenHeight","row","childrenCenterCenter",{padding:{top:2*A}},a("childrenSize","column",{childrenMargins:t},c(h.mediumText,{text:this.currentUserId===w.userId?"Add new photo to this frame:":"Add your photo to this frame:",color:p.black.secondary}),f({postId:w.templatePostId,showAddPhotoButton:!0}))):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["TextStyles","ImikimiStyles","PointerActionsMixin","Component","FluxComponent","timeout","getPostForeground","getPostBackground","Element","TextElement","getAutoChapterTitle","ShowMedia","TextPalette","getPostTitle","Number","models","Math","max","min","bound","merge","getIsChapterStart","ScrollerWithBar"],[e,n(1026),{FullscreenControlButton:n(1029)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P)=>{let C,_,E;return C=3*t.tinyBoldText.fontSize,_=e.mediumShadow,E=i.defClass(class FpbPost extends(n(r)){},function(e,n,r){this.prototype.preprocessProps=function(t){return t.selected&&!this.props.selected&&this.scrollOnScreen(),r.preprocessProps.apply(this,arguments)},this.prototype.scrollOnScreen=function(){let t,e;return(i.exists(e=this.refs[this.props.post.id])?t=e.element:void 0)?s(10,()=>this.onNextReady(()=>t.scrollOnScreen(!0))):void 0},this.prototype.action=function(){let t;return i.isF((t=this.props).selectPost)&&t.selectPost(this.props.post)},this.prototype.render=function(){let e,n,i,r,o,s,m,g,y,v,S,b;return e=(b=this.props).size,n=b.post,i=b.selected,r=b.gridSize,o=b.chapterPost,s=b.small,m=b.browserBackgroundColor,g=o===n,y=a(o),v=l(o),S=s?t.bittyBoldText:t.tinyBoldText,u("pointerCursor","cacheDraw",{key:n.id,on:this.buttonHandlers,size:g?{h:e+C,w:e}:e},u("column","centerCenter",{animators:{scale:{duration:.08}},scale:this.hover?1.08:1,draw:[i||this.hover||g?{radius:{top:r*(g?.75:.25),bottom:.25*r},padding:-r/4,fill:{color:i?g?y.withScaledLightness(2/3):y:m,shadow:i&&_}}:void 0,"reset",g?{radius:{top:g?r/2:1},fill:y}:n.mediaFile?void 0:y.withScaledLightness(.5)]},g?u({key:"chapterTitle",size:{h:C}},c(S,"parentSize","textCenterCenter",{padding:r/4,maxLines:2,color:"white",text:h(n)})):void 0,n.mediaFile?p({post:n,padding:g?{bottom:r/4,h:r/4}:void 0,mediaSize:128}):c(S,"parentSize","textCenterCenter",{padding:r/4,color:d.white.primary,text:f(n)})))}}),i.defClass(class FullscreenPostBrowser extends o{},function(t,e,n){this.subscriptions("viewState.viewState",{postsDesc:{model:"postsByTopicIdDesc",key:function({topicId:t}){return t}}}),this.propFields("post","chapterPost","postId","topicId"),this.stateFields({selectingPostId:null,focusedPostIndex:null,posts:null,chaptersByPostId:null}),this.getter({posts:function(){return this.state.posts},small:function(){let t,e;return i.exists(t=this.viewState)&&t.landscape||(i.exists(e=this.viewState)&&e.viewHeight)<650},postSize:function(t){return i.is(i.exists(t)&&t.gridSize,m)||(t=this.viewState),t.gridSize*(this.small?4:5)},postMargin:function(t){return i.is(i.exists(t)&&t.gridSize,m)||(t=this.viewState),t.gridSize/4}}),this.prototype.selectPost=function(t){return this.selectingPostId=i.exists(t)&&t.id,s(50,this.clearSelectingPostId),g.navState.setFullScreenPost(t)},this.prototype.scrollUpdate=function(t){let e;return e=this.viewState.gridSize,this.focusedPostIndex=-t.props.childrenOffset/(this.postSize+this.postMargin)|0},this.prototype.preprocessState=function(t){let e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,P,C,_,E;return n=(e=t.viewState).viewWidth,r=e.gridSize,o=t.focusedPostIndex,s=t.postsDesc,a=t.posts,l=t.chaptersByPostId,s&&s!==this.state.postsDesc&&(a=s.slice().reverse(),u=null,l=i.object(a,t=>!u||x(t)?u=t:u,null,null,t=>t.id)),a&&(c=10,h=100,f=(p=this.getPostSize(e))+(d=this.getPostMargin(e)),m=y.ceil(n/f)+1,null!=o||(o=a.length-m),C=((g=v(0,S(o-c,a.length-m)))+(P=S(a.length,o+m+c)))/2|0,this.state.startPostIndex<g&&(g=b(this.state.startPostIndex,C-h,g)),this.state.endPostIndex>P&&(P=b(P,C+h,this.state.endPostIndex)),_=P-g,E=a.length-P),w(t,{posts:a,startPostIndex:g,endPostIndex:P,shownPostCount:_,remainingPostCount:E,chaptersByPostId:l})},this.prototype.render=function(){let t,e,n,r,o,s,c,h,p,d,f,m,g,y,v,S,b,w,_,T,k,I,M,A,F,B;return t=this.viewState.gridSize,T=this,e=this.selectingPostId,n=this.small,k=this,r=this.posts,o=this.post,s=this.chapterPost,c=this.postId,h=this.chaptersByPostId,p=null,d=0,f=null,m=this.postSize,g=this.postMargin,y=m+g,v=t*(this.viewState.isTouchScreen?.25:.75),s=x(this.props.post)?this.props.post:this.props.chapterPost,S=l(s).withScaledLightness(.2),u({size:{ww:1,h:3*t/4+v+m+C}},"clip",u({animators:"draw",draw:{color:S}},(i.exists(r)&&r.length)>1?P("row","childrenTopCenter",{padding:{v:t/4,bottom:v,h:t/4},barSize:v+.25*t,track:"right",on:{scrollUpdate:this.scrollUpdate},scrollBarOpacity:.5,barColor:a(s)},(i.exists(r)&&r.length)>0?(I=this.state,b=I.startPostIndex,w=I.remainingPostCount,_=I.shownPostCount,u("row","childrenBottomLeft",{draw:"#077",childrenMargins:g,size:{w:r.length*m+g*(r.length-1)},padding:{left:y*b,right:y*w},draw:["children",{child:c}]},(M=[],B=(F=0)<(A=_)?1:-1,(()=>{for(;B>0&&F<A||B<0&&F>A;){let i,s;i=F,M.push((o=r[s=i+b])?E({small:n,post:o,size:m,gridSize:t,browserBackgroundColor:S,chapterPost:h[o.id],key:o.id,selected:o.id===c||o.id===e,selectPost:this.selectPost}):void 0),F+=B}})(),M))):void 0):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","FullscreenControlButton"],[e,n(1026),{FullscreenControlButton:n(1029)}],(t,e,n)=>{return i.defClass(class FullscreenPostControls extends t{},function(t,r,o){this.subscriptions("post","topic","currentSession.currentUserId","viewState.fullScreen"),this.prototype.showTopicSettings=function(){return this.models.navState.showTopicSettings(this.post)},this.prototype.showTopicBrowser=function(){return this.models.navState.showTopicBrowser(this.topic)},this.prototype.postInThisStream=function(){return this.models.newPostState.startNewPostForTopic(this.topic,{afterPost:this.post})},this.prototype.render=function(){let t,r,o,s,a,l;return t=(a=this.props).fullscreenPost,r=a.dark,o=a.shadow,s=a.foregroundColor,e(["childrenSize","row"],{key:"FullscreenPostControls"},(i.exists(l=this.topic)&&l.userId)===this.currentUserId&&n({shadow:o,dark:r,foregroundColor:s,scale:.75,icon:"plus",action:this.postInThisStream}),this.topic&&n({shadow:o,dark:r,foregroundColor:s,scale:.75,icon:"menu",action:this.showTopicSettings}),t&&n({shadow:o,dark:r,foregroundColor:s,icon:"close",action:this.models.navState.closeFullScreenPost}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","max","getIsCoverPhoto","bound","FullscreenPostControls","getPostForeground","PostActions","min","Element","ImikimiStyles","rgbColor","floatEq","ShowMedia","StreamHeading","rect","point"],[e,n(1026),{FullscreenPostControls:n(1033)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{return i.defClass(class FullscreenPostHeading extends t{},function(t,y,v){this.subscriptions("viewState.viewState",{user:function({post:t}){return i.exists(t)&&t.userId}}),this.propFields("headingHeight","scrollOffset","post","chapterPost","topic","wideLayout","colorsPost"),this.getter({safePaddingTop:function(){return this.props.safePadding.top},safePaddingLeft:function(){return e(0,this.viewState.safePadding.left-this.viewState.gridSize)},safePaddingRight:function(){return this.viewState.safePadding.right>this.viewState.safePadding.left?this.viewState.safePadding.right:0},isCoverPhoto:function(){return n(this.post)},fullWideLayout:function(){return this.viewState.mainAreaWidth>=600},extendedWideLayout:function(){return this.viewState.mainAreaWidth>=900},minHeight:function(){return this.viewState.buttonSize+this.safePaddingTop},drawHeight:function(){return r(this.minHeight,this.headingHeight-this.scrollOffset,this.headingHeight)}}),this.prototype.renderStreamViewControls=function(){let t,e,n;return o((({post:t,chapterPost:e,topic:n}=this.props),{post:t,chapterPost:e,topic:n}),{foregroundColor:s(this.chapterPost),fullscreenPost:!0,shadow:this.isCoverPhoto})},this.prototype.action=function(){return this.models.navState.showChapterNavigator(this.topic)},this.prototype.renderPostActions=function(){return a(this.isCoverPhoto?{color:"white"}:void 0,{height:this.viewState.reducedButtonSize,tight:!0,shadow:this.isCoverPhoto,compact:!this.extendedWideLayout,post:this.post,chapterPost:this.chapterPost,topic:this.topic})},this.prototype.getScrollInterpolation=function(t=1){let e,n,i,o;return o=this,e=this.drawHeight,n=this.minHeight,i=this.headingHeight,1-r(0,(e-n)/(i-n)*t,1)},this.prototype.render=function(){let t,n,o,s,a,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z;return B=this.viewState,t=B.gridSize,n=B.reducedButtonSize,o=B.buttonSize,s=B.viewWidth,a=B.mainAreaWidth,R=this,y=this.user,v=this.chapterPost,S=this.safePaddingTop,b=this.safePaddingRight,w=this.safePaddingLeft,x=(z=this.props).backgroundColor,P=z.headingHeight,C=z.reducedHeading,_=z.post,E=z.topic,T=z.scrollOffset,k=t*(this.extendedWideLayout?7:5),I=l(P,n+S),M=r(I,P-T,P),C?(A=0,F=0):P>I?(A=1-this.getScrollInterpolation(2/3),F=this.getScrollInterpolation()):(A=0,F=1-r(0,(P-T)/P,1)),u({size:{ww:1,h:P}},"cacheDraw",C?{location:{y:l(0,1.11*-T)}}:void 0,u({size:{ww:1,h:M},padding:{left:w,right:b}},"column","childrenCenterRight",{draw:this.isCoverPhoto?{rectangle:t=>m(0,0,t.x,(1.5*P-I)*(1-F)+I),fill:{color:c.sineGradient(h(0,0,0,.4).blend(x,F),h(0,0,0,0),20,.5+.5*F),to:"bottomLeft",from:"topLeft",shadow:p(F,1)?c.tinyShadow:void 0}}:{fill:{color:x,shadow:c.tinyShadow}}},this.wideLayout&&!this.isCoverPhoto?u({inFlow:!1},(i.exists(v)&&v.id)!==(i.exists(_)&&_.id)?u({inFlow:!1,size:{w:k+e(3*t,1.5*t+w)},location:{x:-e(1.5*t,w)},draw:["children",{fill:{color:c.sineGradient(x.withAlpha(0),x),from:e=>g(e.x-t*(this.extendedWideLayout?5:3),0),to:t=>g(t.x,0)}}],on:{pointerClick:this.action}},"pointerCursor",d({post:v,mediaSize:"auto"})):void 0):void 0,S>0?u({size:{h:S}}):void 0,u(["row","childrenCenterCenter"],{childrenMargins:t/2,padding:this.wideLayout?this.isCoverPhoto||(i.exists(v)&&v.id)===(i.exists(_)&&_.id)?{h:t}:{left:k,right:t}:{left:t,right:t/2},receivePointerEvents:"passToChildren"},f({shadow:this.isCoverPhoto,secondaryInfoOpacity:A,user:y,chapterPost:v,topic:E,post:_}),this.wideLayout?u("childrenSize","row","cacheDraw",this.renderPostActions(),this.renderStreamViewControls()):u("column","childrenTopRight","parentHeightChildrenWidth","clip",this.renderStreamViewControls(),this.renderPostActions()))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","rect","getIsChapterStart","getPostBackground","getPostForeground","getIsCoverPhoto","max","bound","Element","ShowMediaWithText","ScrollerWithBar","FullscreenPostBelowTheFold","Spinner","ButtonWrapper","TextElement","Icons","TextPalette","useFullscreenShortCaptionMode","FullscreenPostAboveTheFold","FullscreenPostHeading"],[e,n(1026),{FullscreenPostAboveTheFold:n(1030),FullscreenPostBelowTheFold:n(1031),FullscreenPostHeading:n(1034)}],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w)=>{let x;return x=function(t){return e(0,-1e5,t.x,1e5)},i.defClass(class FullscreenPostMain extends t{},function(t,e,P){let C,_;this.subscriptions("viewState.viewState",{post:C=function({post:t}){return t.id},chapterPost:function({chapterPost:t}){return i.exists(t)&&t.id},topic:_=function({post:t}){return i.exists(t)&&t.topicId},messagesByPostId:function({post:t}){return(i.exists(t)&&t.messageCount)>0?t.id:void 0},topicMembershipsByTopicId:function({topic:t}){return(i.exists(t)&&t.participantCount)>0?t.id:void 0}}),this.propFields("suggestedPadding","safePadding","nextChapterPost","nextPost","prevPost","prevChapterPost","toggleShowOverlay","postNumber","postIndex"),this.stateFields({scrollOffset:0,mainAreaViewSize:null}),this.getter({buttonSize:function(){return this.viewState.buttonSize},gridSize:function(){return this.viewState.gridSize},mainAreaHeight:function(){let t,e;return null!=(t=i.exists(e=this.mainAreaViewSize)&&e.y)?t:this.viewState.mainAreaHeight},chapterPost:function(){return this.isChapterStart?this.post:this.props.chapterPost},isChapterStart:function(){return r(this.post)},colorsPost:function(){return this.isCoverPhoto||this.isChapterStart?this.post:this.props.chapterPost},fullHeadingHeight:function(){return 5*this.gridSize},reducedHeadingHeight:function(){return this.buttonSize},shortView:function(){return this.mainAreaHeight<650},reducedHeading:function(){return this.mainAreaHeight<450&&this.viewState.viewWidth>=500},darkBackgroundColor:function(){return this.backgroundColor.withScaledLightness(.5)},backgroundColor:function(){return o(this.colorsPost)},foregroundColor:function(){return s(this.colorsPost)},isCoverPhoto:function(){return a(this.post)},wideLayout:function(){return this.viewState.landscape||this.viewState.fullScreen},headingHeight:function(){return(()=>{switch(!1){case!this.reducedHeading:return this.viewState.safePadding.top+this.reducedHeadingHeight;case!this.wideLayout:return this.fullHeadingHeight;default:return this.viewState.safePadding.top+l(this.fullHeadingHeight,2*this.viewState.reducedButtonSize)}})()}}),this.prototype.scrollUpdate=function(t){let e,n,i,r,o,s,a;return e=(a=t.props).childrenOffset,n=a.childrenOffsetDelta,i=a.windowSize,r=a.childrenSize,s=e-n,n=(e=l(e,o=i-r))-(s=l(s,o)),(e=-e)<0&&(n=l(n+e,0)),this.scrollOffset=e<=0?0:this.isCoverPhoto&&this.wideLayout&&!this.reducedHeading?e:u(0,this.scrollOffset-n,this.headingHeight+this.viewState.gridSize)},this.prototype.renderPostOnly=function(){let t;if(this.post)return t=this.post.mediaFile,c({draw:t?this.darkBackgroundColor:"white"},t?h("zoomOutCursor",{post:this.post,suggestedPadding:this.viewState.gridSize,largeMode:!0,layout:"fit",mediaSize:"auto",click:this.props.toggleShowOverlay}):p("childrenCenterCenter",d(this.commonChildProps)),c("childrenSize","topRight",{padding:this.gridSize},n(1029)({foregroundColor:this.foregroundColor,shadow:!!t,dark:!t,icon:"close",action:this.props.toggleShowOverlay})))},this.prototype.ready=function({target:t}){return this.mainAreaViewSize=t.currentSize},this.getter({commonChildProps:function(){let t,e,n,r;return i.exists(r=this.props.processedChapterPost)&&(t=r.numChapters,e=r.postsInChapter,n=r.chapterNumber),{backgroundColor:this.backgroundColor,foregroundColor:this.foregroundColor,headingHeight:this.headingHeight,wideLayout:this.wideLayout,shortView:this.shortView,suggestedPadding:this.suggestedPadding,safePadding:this.safePadding,reducedHeading:this.reducedHeading,topic:this.topic,post:this.post,isCoverPhoto:this.isCoverPhoto,mainAreaHeight:this.mainAreaHeight,postNumber:this.postNumber,postIndex:this.postIndex,numChapters:t,postsInChapter:e,chapterNumber:n,nextChapterPost:this.nextChapterPost,nextPost:this.nextPost,prevPost:this.prevPost,prevChapterPost:this.prevChapterPost,toggleShowOverlay:this.toggleShowOverlay,chapterPost:this.chapterPost,darkBackgroundColor:this.backgroundColor.withScaledLightness(.5)}}}),this.prototype.renderLoading=function(){return c({draw:"white"},f(),c("childrenSize","topRight",{padding:this.gridSize},m({size:this.buttonSize,hoverColor:this.foregroundColor,action:this.models.navState.closeFullScreenPost},g(y.close,"centerCenter",{color:v.black.secondary,fontSize:.6*this.buttonSize,scale:.5}))))},this.prototype.render=function(){let t,e;return c("clip","cacheDraw",{on:{ready:this.ready}},this.post?(t=this.commonChildProps,e=this.props.showOverlay,[S(this.post)?c({visible:e},b(t)):p({visible:e,on:{scrollUpdate:this.scrollUpdate},padding:{bottom:2*this.gridSize}},c({size:{h:0},draw:{rectangle:x,fill:t.darkBackgroundColor}}),b(t),d(t)),c("parentWidthChildrenHeight",{visible:e,key:"heading"},w(t,{scrollOffset:this.scrollOffset})),e?void 0:this.renderPostOnly()]):this.renderLoading())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette","Element","TabButton"],[e,n(1026)],(t,e,n,r)=>{return i.defClass(class FullscreenPostNavigicationControls extends t{},function(t,o,s){this.subscriptions("viewState.viewState"),this.propFields("topic","prevChapter","prev","next","nextChapter","backgroundColor","foregroundColor"),this.prototype.showTopicBrowser=function(){return this.models.navState.showTopicBrowser(this.topic)},this.prototype.render=function(){let t,o;return t=this.viewState.buttonSize,o={hoverColor:this.foregroundColor,iconScale:.75,color:e.white.primary},n("column",{key:"navControls",size:{h:t},draw:this.backgroundColor,animators:{size:{toFrom:{h:0}}}},n({size:{h:t}},["bottomLeft","row"],i.array([{icon:"first",action:this.prevChapter},{icon:"triangleLeft",action:this.prev},{icon:"chapter",action:this.showTopicBrowser},{icon:"triangleRight",action:this.next},{icon:"last",action:this.nextChapter}],t=>r(o,t))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pluralize3DidgetCount","Element","TabButton","getShortDisplayName","ImikimiPalette","ScrollerWithBar","UserCircle","TextElement","TextStyles","TextPalette","compactFlatten","humanDurationString","toSeconds","SimpleStreamList","FeedLabel","pending","pluralize"],[e,n(1026)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v)=>{return i.defClass(class FullscreenProfile extends t{},function(t,S,b){let w,x;this.subscriptions("user","viewState.viewState",{topicsByUserId:w=function({user:t,userId:e}){let n;return null!=(n=i.exists(t)&&t.id)?n:e},blockedUser:function({user:t,currentUser:e}){return e&&t?{userId:e.id,blockedUserId:t.id}:void 0}}),x=function(t,n,i){let r;return t>0?(r=e(t,n,!0),i?i+" "+r:r):void 0},this.getter({currentSession:function(){return this.models.currentSession},ownProfile:function(){let t,e;return t=w(this.props),({currentUserId:e}=this.currentSession),t===e}}),this.stateFields({loading:!1}),this.prototype.searchForUsersContent=function(){return this.user?this.models.navState.searchWithinUserId(this.user.id):void 0},this.prototype.renderActions=function(){let t,e,a;return({user:t,currentUser:e}=this.props),a={iconScale:.7,size:{h:this.viewState.buttonSize,wcw:1}},n("parentWidthChildrenHeight","row",r(a,{icon:"search",action:this.searchForUsersContent,text:`search ${i.toString(o(t))}'s posts`}),n(),this.ownProfile?void 0:r(a,{key:"blockButton",icon:"blockComment",action:()=>this.models.navState.showBlockUserOverlay({user:t})},this.blockedUser?{text:"blocked",color:s.warning}:{text:"block"}),this.ownProfile?void 0:r(a,{key:"flagButton",icon:"flag",text:"flag",action:()=>this.models.navState.showFlagUserOverlay({user:t})}),this.currentSession.currentlyAdmin?r(a,{key:"becomeThisUser",icon:"user",text:"become this user",action:(i.exists(e)&&e.id)!==t.id&&(()=>this.models.admin.switchUser(t.id))}):this.currentSession.canReturnToAdmin?r(a,{key:"returnToYourAdminAccount",icon:"undo",text:"return to your admin account",action:()=>this.models.admin.switchUser(this.currentSession.adminUserId)}):void 0)},this.prototype.render=function(){let t,e,s,S;return({gridSize:t,buttonSize:e}=this.viewState),s=i.array(i.exists(S=this.topicsByUserId)&&S.sort((t,e)=>e.lastPostCreatedAt-t.lastPostCreatedAt),null,t=>!t.isProfileTopic),n({draw:"white",visible:this.props.visible},a({barPadding:{bottom:this.props.suggestedPadding.bottom,top:this.props.suggestedPadding.top}},n(["parentWidthChildrenHeight","row","childrenTopLeft"],{padding:{bottom:this.props.suggestedPadding.bottom,top:this.props.suggestedPadding.top+t,left:this.props.safePadding.left+t,right:this.props.safePadding.right+t},childrenMargins:t},l({user:this.user,clipOutline:!0,size:10*t,memberLineWidth:t/2,showProfileTopic:!0,noExpand:!0,mediaSize:"medium"}),n("column","parentWidthChildrenHeight",{childrenMargins:t},u(c.xLargeBoldText,{text:this.user.displayName}),u(c.smallText,{color:h.black.secondary,text:p([x(i.exists(s)&&s.length,"topic"),x(this.user.postCount,"post"),x(this.user.followerCount,"follower"),x(this.user.templateUseCount,"Kimi frame use"),`joined ${i.toString(d(f()-f(this.user.createdAt),!0))} ago`])}))),m({topics:s,beforeChildren:[this.renderActions(),g({title:(()=>{switch(!1){case!(this.topicsByUserIdStatus===y):return`Loading ${i.toString(o(this.user))}'s Streams`;case!(0===s.length):return`${i.toString(o(this.user))}'s Streams`;default:return`${i.toString(o(this.user))}'s ${i.toString(v(s.length,"Stream"))}`}})(),icon:"book",wide:!0})],showRows:4})),n("topRight","childrenSize",{visible:this.props.visible,inFlow:!1,padding:{top:this.props.safePadding.top,right:this.viewState.fullScreen?this.props.suggestedPadding.right:this.props.safePadding.right}},r({icon:"close",color:h.black.secondary,lightColor:!0,iconScale:.5,size:e,action:this.models.navState.popNavState})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","MarkdownView"],[e,n(1026)],(t,e,n)=>{return i.defClass(class FullscreenTextEdior extends t{},function(t,i,r){this.subscriptions("post","viewState.viewState"),this.prototype.render=function(){let t,i;return({gridSize:t,buttonSize:i}=this.viewState),e({draw:"yellow"},e({size:{w:700,hch:1}},n(this.props)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Toolbars","KimiEditor"],[e,n(1026),n(1040).Components],(t,e,n)=>{return i.defClass(class KimiEditorPage extends t{},function(t,i,r){this.renderFullscreenToolbar=function(t){return e.MainToolbar(t)},this.renderPrimaryPhoneToolbar=function(t){return e.PhonePrimaryToolbar(t)},this.renderSecondaryPhoneToolbar=function(t){return e.PhoneSecondaryToolbar(t)},this.prototype.render=function(){return n()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=n(1041)},function(t,e,n){(t.exports=n(826)).includeInNamespace(n(1042)).addModules({StandardImport:n(801)}),n(1043),n(1076),n(1148),n(1065),n(824),n(1045)},function(t,e,n){var i;n(802),n(1043),n(824),n(1045),n(1065),n(1148),n(1078),n(1082),n(1128),t.exports=[{package:i=n(828),version:i.version},n(1045)]},function(t,e,n){(t.exports=n(829)).addModules({Images:n(1044)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseObject","lowerCamelCase","corsSafeImageAssetUrl","merge","Promise","SourceToBitmapCache","Bitmap","compactFlatten","Canvas","console","log"],[e,n(801)],(t,e,r,o,s,a,l,u,c,h,p)=>{let d;return d=n(212).getDevicePixelRatio,i.defClass(class Images extends t{},function(t,n,f){this.assetList=["text_effect_bad_copy_texture","text_effect_gems_star","text_effect_gems_textures","text_effect_paper_texture","text_effect_scales_texture","text_effect_snow_texture","text_effect_wood_texture"],this.sourcePaths={},this.setSourcePath=function(t,n="png",o=1){let s,a,l;return s=e(t),a=1!==o?`@${i.toString(o)}x`:"",((l=this.sourcePaths)[o]||(l[o]={}))[s]=r(`kimi_editor/${i.toString(t)}${i.toString(a)}.${i.toString(n)}`)},i.each2(this.assetList,t=>this.setSourcePath(t)),this.selectedAssetNames=[],this.selectAssetResolution=(t=>i.each2(o(this.sourcePaths[1],this.sourcePaths[t]),(t,e)=>(this.selectedAssetNames.push(e),this[e]=t))),this.selectAssetResolution(d()),this.preloadAssets=(()=>{let t;return this._preloadedAssetsPromise?this._preloadedAssetsPromise:(t={},i.each2(this.selectedAssetNames,e=>{let n;return n=this[e],t[e]=a.singleton.get(n,l.get(n,!0))}),this._preloadedAssetsPromise=s.deepAll(t))}),this.load=function(...t){let n;return n={},s.all(i.array(u(t),t=>{let i;return i=this[e(t)],c.Bitmap.get(i).then(e=>n[t]=e).catch(e=>(h.error("Images.load error",e,t,i),p({"Images.load error":{error:e,source:t,sourcePath:i}})))})).then(()=>n)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(842)).includeInNamespace(n(1046)).addModules({Fonts:n(800),TextIcons:n(1064)}),n(1047)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["mergeInto","Object","rgbColor","lowerCamelCase"],[e,n(307)],(t,e,r,o)=>{let s;return s=n(1047),i.defClass(class TextEffects extends e{},function(a,l,u){t(this,n(800)),t(this,n(1064)),this.getStyleIsCustom=function({style:t,font:e,effect:n,color:i}){return t=this.styles[t]||this.defaultStyle,e&&e!==t.font||n&&n!==t.effect||i&&i.toString()!==r(t.color).toString()},this.hasDescenders=function(t){return/[qypgj]/.test(t)},this.renderers={},i.each2(s.modules,(t,e)=>this.renderers[o(e)]=t,(t,e)=>t.prototype instanceof s.Renderer),this.effects=this.renderers,this.defaultEffectIconScale=[.6,"#75"],this.effectIconScale={wood:.75,gems:.75},this.fontIconScale={arial:1,sans_serif:1,comic_sans_ms:1,courierNew:.8125,creepster:.875,eater:1,fredericka_the_great:.75,fredoka_one:.8125,frijole:.6875,griffy:1,henny_penny:1,homemade_apple:9/16,impact:1,italianno:21/16,la_belle_aurore:1,limelight:1,monsieur_la_doulaise:.9375,mr_dafoe:.875,new_rocker:1,nosifer:9/16,pinyon_script:1,ruthie:1.25,sigmar_one:.8125,special_elite:1,timesNewRoman:1,titan_one:1,unifrakturcook:.875},this.defaultStyleIconScale=1,this.styleIconScale={},this.effectExampleColors={default:"grey",paper:"#69",outline:"white",platinum:"#ddd",shadow:"white",normal:"white",badCopy:"black",scales:"green",dark:"red",wood:"orange",flashy:"Red",gems:"dimgray",snow:"red",rainbow:"red"},this.effectNames={normal:"Normal",shadow:"Shadow",outline:"Outline",platinum:"Platinum",badCopy:"BadCopy",flashy:"Flashy",dark:"Dark",rainbow:"Rainbow",paper:"Paper",wood:"Wood",scales:"Scales",gems:"Gems",snow:"Snow"},this.effectOrder=["normal","shadow","outline","snow","dark","scales","badCopy","flashy","gems","paper","platinum","rainbow","wood"],this.styles={hello:{font:"arial",effect:"normal",color:"black",sampleText:"Look at me still talking\nwhen there's science to do"},news:{font:"timesNewRoman",effect:"shadow",color:"black",sampleText:"Extra! Extra!\nRead all about it!"},meme:{font:"impact",effect:"outline",color:"white",sampleText:"I IZ NEEDING MOAR MILK!"},memories:{font:"pinyonScript",effect:"platinum",color:"#ddd",sampleText:"For you, with love"},oldSchool:{font:"specialElite",effect:"badCopy",color:"black",sampleText:"I believe."},sexy:{font:"mrDafoe",effect:"flashy",color:"red",sampleText:"Scandalous"},holiday:{font:"griffy",effect:"snow",color:"red",sampleText:"Ho! Ho! Ho!"},birthday:{font:"sigmarOne",effect:"rainbow",color:"red",sampleText:"!!!Birthday Party!!!"},scary:{font:"creepster",effect:"scales",color:"green",sampleText:"Swamp thing"},loveNote:{font:"monsieurLaDoulaise",effect:"paper",color:"#696969",sampleText:"You had me at hello."},kids:{font:"hennyPenny",effect:"wood",color:"orange",sampleText:"Bundle of Joy!"},bling:{font:"limelight",effect:"gems",color:"dimgray",sampleText:"Fantasic!"},vampire:{font:"nosifer",effect:"dark",color:"red",sampleText:"Dracula"}},this.defaultStyle=this.styles.hello,this.detectStyleName=function({font:t,effect:e,color:n}){let o;return n=r(n),null!=(o=i.find(this.styles,(t,e)=>e,(i,o)=>t===i.font&&e===i.effect&&n.eq(r(i.color))))?o:"Custom"},this.styleNames={hello:"Hello",news:"News",meme:"MEME",memories:"Memories",oldSchool:"Old school",sexy:"Sexy",birthday:"Birthday",loveNote:"Love note",kids:"Kids",bling:"Bling",scary:"Scary",holiday:"Holiday",vampire:"Vampire"},this.styleOrder=["hello","news","meme","holiday","scary","vampire","memories","oldSchool","sexy","birthday","loveNote","kids","bling"],this.order={font:this.fontOrder,effect:this.effectOrder,style:this.styleOrder},this.names={font:e.keys(this.fonts),effect:e.keys(this.effectNames),style:e.keys(this.styleNames)},this.free={font:{arial:!0,timesNewRoman:!0,impact:!0,comicSansMs:!0,courierNew:!0},effect:{normal:!0,shadow:!0,outline:!0},style:{meme:!0,news:!0,hello:!0}},this.premium=i.object(this.names,(t,e)=>{let n;return n=this.free[e],i.object(t,t=>!n[t])}),this.iconTypes={},i.each2(this.names,(t,e)=>i.each2(t,(t,n)=>this.iconTypes[n]=e))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(843)).addModules({BadCopy:n(1048),Dark:n(1052),Flashy:n(1053),Gems:n(1054),Normal:n(1055),Outline:n(1056),Paper:n(1057),Platinum:n(1058),Rainbow:n(1059),Renderer:n(1051),Scales:n(1060),Shadow:n(1061),Snow:n(1062),StandardImport:n(1049),Wood:n(1063)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","FillElement","BitmapElement","Images"],[e,n(1049)],(t,e,n,r)=>{return i.defClass(class BadCopy extends t{},function(t,i,o){this.prototype.createElements=function(){return this.newTextElement([e(),n({source:r.textEffectBadCopyTexture,axis:.5,location:{xw:.5,yh:.65},size:{ww:1.1,hh:1.7},isMask:!0})])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(801).mergeWithSelf(n(1050),n(1043),{Renderer:n(1051)}))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ElementFactory","isString","Macros","log"],[e,n(42),n(341)],(t,e,r,o)=>{let s;return s=t.elementClasses,n(192).createObjectTreeFactories(i.array(s,t=>t.getName()),{preprocessElement:function(t,n){let s,a;return e(s=t)?(a=r[s])?a:(o.warn(`ArtReact-ArtEngine: string '${i.toString(s.slice(0,20))}' didn't match any macros.`),null):t}},function(t,e,n){let i;return new(i=s[t])(e,n)})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseObject","Images","point","min","Matrix","Promise","TextElement","rgbColor"],[e,n(307),n(1043),n(1050)],(t,e,r,o,s,a,l,u)=>{let c,h;return c=n(842),h=null,i.defClass(class Renderer extends t{constructor(t={}){let e,n,i,o,s;super(...arguments),e=c.fonts[t.font],this.loadAssets(),this.fontSize=64,this.fontWeight=null!=(n=e.fontWeight)?n:t.fontWeight,this.iconEffectMode=t.iconEffectMode,this.maxBitmapSize=r(t.maxBitmapSize||1024),this.fontFamily=(null!=(i=null!=(o=e.fontFamily)?o:t.fontFamily)?i:"Arial").toLowerCase(),this.align=null!=(s=t.align)?s:"center",this.color=u(t.color||"white"),this.text=t.text||"The quick brown fox..."}},function(t,n,i){let o,u;this.fontMedianWeights=o={arial:.09,"times new roman":.085,impact:.21,creepster:.19,eater:.15,"fredericka the great":.12,"fredoka one":.175,frijole:.24,griffy:.075,"henny penny":.11,"homemade apple":.09,italianno:.05,"la belle aurore":.08,limelight:.21,"monsieur la doulaise":.04,"mr dafoe":.09,"new rocker":.13,nosifer:.26,"pinyon script":.06,ruthie:.05,"sigmar one":.31,"special elite":.125,"titan one":.27,unifrakturcook:.15},this.fontMaxWeights=u={arial:.1,"times new roman":.11,impact:.21,creepster:.27,eater:.19,"fredericka the great":.2,"fredoka one":.2,frijole:.29,griffy:.1,"henny penny":.15,"homemade apple":.17,italianno:.06,"la belle aurore":.09,limelight:.31,"monsieur la doulaise":.06,"mr dafoe":.13,"new rocker":.16,nosifer:.29,"pinyon script":.06,ruthie:.05,"sigmar one":.36,"special elite":.15,"titan one":.295,unifrakturcook:.18},this.prototype.loadAssets=function(){return e.preloadAssets()},this.getter({medianWeightFontSizeRatio:function(){return o[this.fontFamily]||o.arial},defaultMedianWeightFontSizeRatio:function(){return o.arial},maxWeightFontSizeRatio:function(){return u[this.fontFamily]||u.arial},defaultMaxWeightFontSizeRatio:function(){return u.arial},medianWeight:function(){return this.fontSize*this.medianWeightFontSizeRatio},defaultMedianWeight:function(){return this.fontSize*this.defaultMedianWeightFontSizeRatio},maxWeight:function(){return this.fontSize*this.maxWeightFontSizeRatio},defaultMaxWeight:function(){return this.fontSize*this.defaultMaxWeightFontSizeRatio}}),this.prototype.createBitmap=function(t=this.maxBitmapSize){return t=r(t),t=this.maxBitmapSize.min(t),this.loadAssets().then(()=>this.createElements()).then(t=>(this.rootElement=t,this.rootElement.onNextReady())).then(()=>{let e,n;return e=this.rootElement.elementSpaceDrawArea,n=t.div(e.size).min(),this.rootElement.toBitmapBasic({elementToDrawAreaMatrix:s.scale(n)})})},this.prototype.newElement=function(t){return this.loadAssets().then(()=>this.createElements())},this.prototype.createElements=function(){return a.resolve(this.newTextElement())},this.prototype.newTextElement=function(...t){return l({size:{cs:1},layoutMode:"tight0",color:this.color,text:this.text,fontSize:this.fontSize,fontFamily:this.fontFamily,fontWeight:this.fontWeight,align:this.align},t)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","FillElement","ShadowElement","OutlineElement","point"],[e,n(1049)],(t,e,n,r,o)=>{return i.defClass(class Dark extends t{},function(t,i,s){this.prototype.createElements=function(){let t,i,s,a,l;return i=(t=this.color).withScaledLightness(.25),s=t.withScaledLightness(.15),a=t.blend("white",.75),this.newTextElement([e({colors:[t,i]}),n({color:"black",opacity:.6,radius:this.medianWeight/4,inverted:!0,compositeMode:"sourceTopInTarget",location:{x:.5*(l=.2*this.medianWeight),y:-l}}),n({color:"white",radius:this.medianWeight/4,opacity:.4,inverted:!0,compositeMode:"sourceTopInTarget",location:{x:.5*-l,y:l}}),r({color:s,lineWidth:1.5*this.medianWeight,location:o(0,.2*this.medianWeight),lineJoin:"round",compositeMode:"targetTopUnion"}),n({color:"black",opacity:.6,radius:2*this.medianWeight,location:o(0,this.medianWeight)})])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","rgbColor","FillElement","ShadowElement","point","OutlineElement"],[e,n(1049)],(t,e,n,r,o,s)=>{return i.defClass(class Flashy extends t{},function(t,i,a){this.prototype.createElements=function(){let t,i,a;return i=(t=this.color).withLightness(.75*t.l),a=e("white"),this.newTextElement([n({colors:[t,i,t]}),r({color:"black",opacity:.4,inverted:!0,compositeMode:"sourceTopInTarget",location:o(0,.25*-this.medianWeight)}),r({color:"white",opacity:.4,inverted:!0,compositeMode:"sourceTopInTarget",location:o(0,.25*this.medianWeight)}),s({color:a,lineWidth:.9*this.medianWeight,location:o(0,.2*this.medianWeight),lineJoin:"round",compositeMode:"targetTopUnion"}),r({color:"black",opacity:.4,location:o(0,.5*this.medianWeight)})])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","Images","point","Bitmap","max","OutlineElement","BitmapElement","FillElement","RectangleElement","ShadowElement","random","min","Math"],[e,n(1049)],(t,e,n,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class Gems extends t{},function(t,i,f){this.getTiledTexture=function(){return(this._tiledTexturePromise||(this._tiledTexturePromise=e.preloadAssets())).then(({textEffectGemsTextures:t})=>{let e,i,o,s,a;for(e=n(4,2),i=t.size,o=new r(i.mul(e)),s=e.w,a=0;a<s;){let r,s,l;for(r=a,s=e.h,l=0;l<s;){let e;e=l,o.drawBitmap(i.mul(n(r,e)),t),l++}a++}return o})},this.prototype.createElements=function(){return t.getTiledTexture().then(t=>{let i,r,f,m,g,y,v,S,b,w,x,P;return m=(f=(r=(i=this.color).l<.5)?i.withLightness(o(1-r,r+.5)):i.withLightness(o(1-r,r-.5))).withLightness(.3),g=f.withLightness(.4),y=10,v=.1,S=0,this.newTextElement(s({filled:!0,color:g,lineWidth:.15*this.medianWeight,lineJoin:"miter",miterLimit:3}),a({layout:"zoom",bitmap:t,compositeMode:"lighter"}),s({filled:!0,color:"red",lineWidth:.15*this.medianWeight,lineJoin:"miter",miterLimit:3,isMask:!0}),s({lineWidth:.4*this.medianWeight,compositeMode:"sourceTopInTarget",lineJoin:"miter",miterLimit:3},l(),u({compositeMode:"sourceTopInTarget",colors:{"0.00":i,.15:f,.33:"white",.67:f,"1.00":i}})),c({radius:0,color:"black",opacity:.45,inverted:!0,compositeMode:"sourceTopInTarget",location:n(.05*-this.medianWeight)}),c({radius:0,color:"white",opacity:.75,inverted:!0,compositeMode:"sourceTopInTarget",location:n(.05*this.medianWeight)}),c({radius:.2*this.medianWeight,color:"black",opacity:.25,inverted:!0,compositeMode:"sourceTopInTarget"}),c({radius:0,color:m,compositeMode:"targetTopUnion",location:n(0,.15*this.medianWeight)}),c({radius:.5*this.medianWeight,color:"white",opacity:1,compositeMode:"targetTopUnion",location:n(0,.4*this.medianWeight)}),(b=[],w=10,P=(x=0)<10?1:-1,(()=>{for(;P>0&&x<10||P<0&&x>10;){let t,i,r,o;t=x,b.push((i=.1*h()+S,r=.1+.8*h(),S+=.1,o=.1+p(r,1-r),(0===t||9===t)&&(o=p(o,p(i,1-i))),a({source:e.textEffectGemsStar,location:{xw:i,yh:r},size:"childrenSize",angle:d.PI/6,axis:n(.5),scale:o}))),x+=P}})(),b),u({isMask:!0,size:{ww:1.1,hh:1.5}},"centerCenter"))})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer"],[e,n(1049)],t=>{return i.defClass(class Normal extends t{})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","FillElement","OutlineElement"],[e,n(1049)],(t,e,n)=>{return i.defClass(class Outline extends t{},function(t,i,r){this.prototype.createElements=function(){return this.newTextElement(e(),n({color:this.color.perceptualLightness<.1?"white":"black",compositeMode:"targetTopUnion",lineJoin:"miter",miterLimit:3,lineWidth:(this.medianWeight+this.defaultMedianWeight)*(this.iconEffectMode?2/3:1/3)}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","OutlineElement","Element","BitmapElement","Images","FillElement","ShadowElement","point"],[e,n(1049)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class Paper extends t{},function(t,i,u){this.prototype.createElements=function(){let t,i,u,c;return i=((t=this.medianWeight)+this.defaultMedianWeight)/2,c=(u=4*this.defaultMedianWeight)/2,this.newTextElement(e({color:"black",lineWidth:u,lineJoin:"round"}),e({color:"black",lineWidth:.8*u,lineJoin:"round"}),e({color:"black",lineWidth:.6*u,lineJoin:"round"}),e({color:"black",lineWidth:.4*u,lineJoin:"round"}),e({color:"black",lineWidth:.2*u,lineJoin:"round"}),n("centerCenter",{compositeMode:"sourceTopInTarget",size:{ps:1.05,plus:2*u}},r({layout:"zoom",source:o.textEffectPaperTexture})),s({opacity:.75}),a({radius:1.5*this.defaultMedianWeight,color:"#0003",location:l(.5*i,i)}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","hslColor","min","Math","Element","OutlineElement","ShadowElement","point","FillElement"],[e,n(1049)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class Platinum extends t{},function(t,i,c){this.prototype.createElements=function(){let t,i,c,h,p,d,f,m,g,y,v,S;return t=this.color,c=((i=this.medianWeight)+this.defaultMedianWeight)/2,h=e(t.h,t.s,t.l),p=t.blend(e(t.h,0,1),n(1,r.pow(t.perceptualLightness+.5,1/3))),d=t.withLightness(r.pow(t.perceptualLightness-.1,.5)),f=p.blend(t,.1),m=p.blend(t,.9),y={0:g=t.perceptualLightness>=.7?d:f,".25":t,".30":m,".45":f,".5":p,".55":f,".70":m,".75":t,1:g},v=e(t.h,t.s,.76*t.l),S=e(t.h,t.s,.53*t.l),this.newTextElement(o({draw:{from:{ww:.5,hh:.88},to:{ww:.5,hh:-.0625},colors:[v,S,v]},size:{ps:1,plus:.5*i}},"centerCenter"),s({lineWidth:.5*i,filled:!0,isMask:!0,lineJoin:"round"}),a({inverted:!0,radius:.5*i,color:"black",compositeMode:"sourceTopInTarget",opacity:.5}),s({lineWidth:0,staged:!0,filled:!0,lineJoin:"round",location:l(-.2*i,-.25*i)},o({draw:{from:{ww:.5,hh:.95},to:{ww:.5,hh:-.075},colors:y}}),u({isMask:!0}),a({inverted:!0,radius:.05*i,color:"white",compositeMode:"sourceTopInTarget",location:l(.075*i,.125*i)})),a({radius:c,color:"#0003",location:l(.5*c,c)}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","FillElement","RectangleElement","ShadowElement","point"],[e,n(1049)],(t,e,n,r,o)=>{return i.defClass(class Rainbow extends t{},function(t,i,s){this.prototype.createElements=function(){let t,i,s,a,l;return(t=this.color).sat<.05?i=[t,s=t.withLightness(t.l>.5?t.l-.5:t.l+.5),t,s,t,s]:(a=[],l=0,(()=>{for(;l<=5;){let e;e=l,a.push(t.withHue(t.h+e/6)),l++}})(),i=a),this.newTextElement(e(),n({compositeMode:"sourceTopInTarget",to:"topRight",colors:i}),r({radius:.2*this.medianWeight,location:o(.15*this.medianWeight),color:"white",opacity:.85,inverted:!0,compositeMode:"sourceTopInTarget"}),r({radius:.2*this.medianWeight,location:o(.15*-this.medianWeight),color:"black",opacity:.25,inverted:!0,compositeMode:"sourceTopInTarget"}),r({radius:.1*this.medianWeight,color:"black",opacity:.75,location:o(0,.35*this.medianWeight)}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","hslColor","RectangleElement","FillElement","BitmapElement","Images","OutlineElement","ShadowElement","point"],[e,n(1049)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class Scales extends t{},function(t,i,c){this.prototype.createElements=function(){let t,i;return t=this.color.s<.05?e(this.color.h-1/6,this.color.s,1-this.color.l):e(this.color.h-1/6,this.color.s,1),i=(this.medianWeight+this.defaultMedianWeight)/2,this.newTextElement(n({colors:[this.color,t]}),r({isMask:!0}),o({layout:"zoom",source:s.textEffectScalesTexture,opacity:.5,compositeMode:"sourceTopInTarget"}),a({color:"black",opacity:.3,lineWidth:.6*i,lineJoin:"round",compositeMode:"sourceTopInTarget"}),l({radius:0,color:"black",location:u(0,.5*this.medianWeight)}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","FillElement","ShadowElement","point"],[e,n(1049)],(t,e,n,r)=>{return i.defClass(class Shadow extends t{},function(t,i,o){this.prototype.createElements=function(){return this.newTextElement(e(),n({radius:.2*this.medianWeight,color:"black",opacity:.5,location:r(this.medianWeight*(this.iconEffectMode?.8:.4))}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","rgbColor","OutlineElement","point","FillElement","BitmapElement","Images","BlurElement"],[e,n(1049)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class Snow extends t{},function(t,i,u){this.prototype.createElements=function(t){let i,u,c;return u=(i=this.color).withLightness(.75*i.l),c=e("white"),this.newTextElement(n({color:c,lineWidth:this.defaultMedianWeight,lineJoin:"miter",miterLimit:2,filled:!0,location:r(1,-1.2).mul(.35*this.defaultMedianWeight)}),n({color:i,lineWidth:0,filled:!0,compositeMode:"sourceTopInTarget"},o(),s({layout:"zoom",source:a.textEffectShowTexture,axis:r(.5),location:{xw:.5,yh:.5},opacity:.6,compositeMode:"sourceTopInTarget"}),n({color:"black",opacity:.1,lineWidth:.5*this.defaultMedianWeight,lineJoin:"miter",miterLimit:2,compositeMode:"sourceTopInTarget"})),n({lineJoin:"miter",miterLimit:2,color:"white",opacity:.75,lineWidth:2*this.defaultMedianWeight,location:r(1,-1).mul(.35*this.defaultMedianWeight),compositeMode:"targetTopUnion"},o(),l({radius:2*this.defaultMedianWeight})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Renderer","hslColor","rgbColor","RectangleElement","FillElement","BitmapElement","Images","point","OutlineElement","ShadowElement"],[e,n(1049)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class Wood extends t{},function(t,i,h){this.prototype.createElements=function(){let t,i,h,p,d,f,m,g,y,v;return v=this,t=this.color,i=this.medianWeight,p=e((h=t).h+.0243,h.s-.0754,h.l-.0235),d=e(h.h-.0215,h.s+.0089,h.l-.4705),f=e(h.h-.0215,h.s+.0218,h.l-.345),m=e(h.h-.0226,h.s+.0226,h.l-.5725),g=n(t.r+.5,t.g+.5,t.b+.5),y=h,this.newTextElement(r({color:y}),r({color:"white",compositeMode:"add"},o(),s({source:a.textEffectWoodTexture,axis:l(.5),location:{xw:.5,yh:.5},opacity:.75,isMask:!0})),o({isMask:!0}),u({color:g,lineWidth:.25*i,lineJoin:"round",compositeMode:"sourceTopInTarget",miterLimit:this.miterLimit}),u({color:p,lineWidth:.6*i,location:l(-.5,1).mul(.2*i),lineJoin:"round",compositeMode:"targetTopUnion",miterLimit:this.miterLimit},o(),r({padding:.6*-i,compositeMode:"sourceTopInTarget",from:"bottomCenter",to:"topCenter",colors:[d,f,d,f,d]}),c({radius:.2*i,opacity:.25,inverted:!0,color:"white",compositeMode:"sourceTopInTarget",location:l(1).mul(.1*i)})),c({radius:0,color:m,location:l(0,.4*i)}),c({radius:0,color:"black",opacity:.4,location:l(0,.3*i)}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseObject","point","Element","TextElement","CanvasElement","Bitmap","Matrix","console"],[e,n(307),n(1050)],(t,e,r,o,s,a,l,u)=>{let c,h,p;return c=n(842),h=n(800),({fontIconText:p}=n(824).StyleProps),i.defClass(class TextIcons extends t{},function(t,n,d){this.iconSize=e(110,60),this.newFontIcon=function(e){return h.loadFont(e).then(()=>{let n;return(n=new r({size:t.iconSize},o(p,{text:c.getFontName(e),axis:"centerCenter",location:"centerCenter",fontFamily:c.getFontFamily(e),fontSize:22*(c.fontIconScale[e]||1)}))).toBitmapBasic({area:"logicalArea",pixelsPerPoint:s.devicePixelsPerPoint})})},this.newEffectIcon=function(t){return this._newStyledIcon({text:c.effectNames[t],effect:t,color:c.effectExampleColors[t],font:h.defaultFont,scale:1,iconEffectMode:!0})},this.newStyleIcon=function(t){let e;return e=c.styles[t],this._newStyledIcon({effect:e.effect,color:e.color,font:e.font,text:c.styleNames[t],scale:1})},this.newIcon=(t=>(()=>{switch(c.iconTypes[t]){case"font":return this.newFontIcon(t);case"style":return this.newStyleIcon(t);case"effect":return this.newEffectIcon(t)}})()),this._newBlankIcon=function(){let e,n,i;return e=s.devicePixelsPerPoint,n=t.iconSize.mul(e),(i=new a(n)).pixelsPerPoint=e,i},this._newStyledIcon=function(t){let e,n,r,o;return e=t.effect,n=t.font,r=t.scale,o=null,h.loadFont(n).then(()=>{let n;return o=this._newBlankIcon(),(n=new c.renderers[e](t)).newElement()}).then(t=>t.toBitmapBasic({elementToDrawAreaMatrix:l.scale(2*r)})).catch(t=>u.error(`failed to load font: ${i.toString(n)}`,t))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(841)).addModules({ButtonAssets:n(1066),ColorPickerState:n(1069),DerivedElementEditState:n(1070),ElementEditState:n(1071),ElementEditStateGetters:n(1073),ElementEditStateMembers:n(1072),History:n(1074),KimiEditorNavState:n(1075),KimiEditorViewState:n(1143),OpenFile:n(1144),OptimizedTemplateTools:n(1145),Preferences:n(1146),ShapeEditorState:n(1147),StandardImport:n(1067)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","Bitmap","corsSafeImageAssetUrl","Promise"],[e,n(1067)],(t,e,r,o)=>{return i.defClass(class ButtonAssets extends t{},function(t,s,a){this.stateFields({fontButtonAssets:null}),this.prototype.loadAssets=function(){return e.get(r("kimi_editor/FontButtonAssets.png")).then(t=>o.deepAll({fontButtonAssets:i.object(n(1068),n=>t.crop(n).toImage().then(t=>new e(t)))})).then(t=>this.setState(t))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(801))}).call(this,n(2)(t))},function(t){t.exports=JSON.parse('{"arial":[0,0,121,98],"courierNew":[120,0,351,98],"timesNewRoman":[470,0,408,98],"impact":[877,0,165,98],"poppins":[1041,0,219,98],"aBeeZee":[1259,0,223,98],"openSans":[1481,0,272,98],"raleway":[1752,0,217,98],"josefinSans":[1968,0,292,98],"arimo":[0,97,151,99],"titanOne":[150,97,277,99],"sigmarOne":[426,97,362,99],"fredokaOne":[787,97,325,99],"lobster":[1111,97,153,99],"bangers":[1263,97,172,99],"rammettoOne":[1434,97,493,99],"balooTammudu":[1926,97,388,99],"playfairDisplay":[0,195,370,98],"alegreya":[369,195,194,98],"cardo":[562,195,153,98],"cantataOne":[714,195,342,98],"bellefair":[1055,195,173,98],"crimsonText":[1227,195,296,98],"cormorantGaramond":[1522,195,461,98],"oldStandardTt":[1982,195,392,98],"specialElite":[0,292,371,99],"stylish":[370,292,154,99],"anonymousPro":[523,292,376,99],"gabriela":[898,292,225,99],"slabo":[1122,292,132,99],"portLligatSlab":[1253,292,321,99],"breeSerif":[1573,292,239,99],"shrikhand":[1811,292,310,99],"alfaSlabOne":[0,390,377,98],"ultra":[376,390,181,98],"fugazOne":[556,390,268,98],"inknutAntiqua":[823,390,444,98],"homemadeApple":[1266,390,501,98],"frederickaTheGreat":[1766,390,509,98],"laBelleAurore":[0,487,356,99],"gamjaFlower":[355,487,275,99],"indieFlower":[629,487,264,99],"emilysCandy":[892,487,312,99],"sedgwickAveDisplay":[1203,487,469,99],"barrio":[1671,487,171,99],"chelseaMarket":[1841,487,420,99],"loveYaLikeASister":[0,585,492,98],"freckleFace":[491,585,296,98],"newRocker":[786,585,281,98],"frijole":[1066,585,280,98],"griffy":[1345,585,151,98],"eater":[1495,585,191,98],"creepster":[1685,585,214,98],"nosifer":[1898,585,323,98],"aclonica":[0,682,257,99],"fasterOne":[256,682,347,99],"blackOpsOne":[602,682,401,99],"meriendaOne":[1002,682,372,99],"shojumaru":[1373,682,386,99],"sancreek":[1758,682,234,99],"tradeWinds":[1991,682,336,99],"jollyLodger":[0,780,190,98],"metalMania":[189,780,257,98],"pressStart2P":[445,780,721,98],"flavors":[1165,780,174,98],"hennyPenny":[1338,780,311,98],"luckiestGuy":[1648,780,328,98],"rancho":[1975,780,132,98],"fontdinerSwanky":[0,877,501,99],"peralta":[500,877,228,99],"milonga":[727,877,210,99],"risque":[936,877,164,99],"snowburstOne":[1099,877,415,99],"irishGrover":[1513,877,292,99],"spicyRice":[1804,877,236,99],"ribeye":[2039,877,195,99],"rumRaisin":[0,975,211,98],"poiretOne":[210,975,241,98],"unifrakturCook":[450,975,305,98],"unifrakturMaguntia":[754,975,428,98],"limelight":[1181,975,279,98],"cinzelDecorative":[1459,975,548,98],"cinzel":[2006,975,199,98],"ruthie":[2204,975,137,98],"pinyonScript":[0,1072,275,99],"mrDafoe":[274,1072,194,99],"monsieurLaDoulaise":[467,1072,451,99],"italianno":[917,1072,145,99],"dancingScript":[1061,1072,288,99],"satisfy":[1348,1072,150,99],"greatVibes":[1497,1072,221,99],"kaushanScript":[1717,1072,335,99],"sacramento":[2051,1072,220,99],"tangerine":[0,1170,141,98],"badScript":[140,1170,222,98],"playball":[361,1170,176,98],"alexBrush":[536,1170,247,98],"allura":[782,1170,148,98],"rochester":[929,1170,179,98],"rougeScript":[1107,1170,220,98],"stalemate":[1326,1170,132,98],"mrsSaintDelafield":[1457,1170,334,98],"molle":[1790,1170,168,98],"pacifico":[1957,1170,184,98],"seaweedScript":[0,1267,287,99],"fellEnglish":[286,1267,300,99],"diplomataSc":[585,1267,699,99],"ewert":[1283,1267,205,99],"oswald":[1487,1267,164,99],"bungee":[1650,1267,233,99],"monoton":[1882,1267,300,99],"orbitron":[0,1365,252,98],"exo2":[251,1365,151,98]}')},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","rgbColor","arrayWithout","arrayWith","bound"],[e,n(1067)],(t,e,n,r,o)=>{return i.defClass(class ColorPickerState extends t{},function(t,i,s){this.stateFields({color:e("#f00"),r:1,g:0,b:0,a:1,h:1,s:1,l:1,advanced:!1,history:[e("white").rgbaHexString]}),this.prototype.addToHistory=function(t){let i,o;if(t)return t=e(t).rgbaHexString,0<=(o=(i=this.history).indexOf(t))&&(i=n(i,o)),i=i.slice(0,100),this.history=r(i,t)},this.prototype.addCurrentColorToHistory=function(){return this.addToHistory(this.color)},this.prototype.setChannel=function(t,e){let n,i;return n=this.state.color.withChannel(t,e=o(0,e,1)),(i=(()=>{switch(t){case"r":case"g":case"b":return{h:n.h,s:n.s,l:n.l,a:n.a,color:n};default:return{r:n.r,g:n.g,b:n.b,a:n.a,color:n}}})())[t]=e,this.setState(i)},this.setter({color:function(t){return this.setState({color:t=e(t),r:t.r,g:t.g,b:t.b,h:t.h,s:t.s,l:t.l,a:t.a})}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState"],[e,n(1067)],t=>{return i.defClass(class DerivedElementEditState extends t{},function(t,e,n){this.stateFields({selectedElementDropInId:null,selectedElementProps:null,selectedElementDropInProps:null,selectedElementTextProps:null,maxTopElementsReached:!1}),this.prototype._update=function(){let t;return t=this.models.elementEditState,this.setState(i.object(this.state,(e,n)=>t[n]))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D={}.hasOwnProperty,N=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};z=n(1067),I=z.point,M=z.point0,A=z.point1,a=z.Matrix,R=z.rect,z.hslColor,L=z.rgbColor,F=z.randomString,C=z.log,z.createWithPostCreate,E=z.mergeInto,u=z.RestClient,z.min,z.max,_=z.merge,g=z.bound,z.select,P=z.isString,h=z.arrayWith,f=z.arrayWithoutValue,d=z.arrayWithElementValueMoved,p=z.arrayWithElementMoved,z.peek,z.upperCamelCase,z.plainObjectsDeepEq,b=z.defineModule,v=z.createObjectTreeFactories,z.compactFlatten,l=z.Promise,z.compact,B=z.readAsBinaryString,z.arrayToMap,m=z.binary,z.neq,e=z.ApplicationState,z.pending,z.success,z.failure,z.zoPickImage,s=z.Engine,L=z.rgbColor,x=z.isColor,P=z.isString,S=z.deepEach,y=z.colorRegExp,z.max,c=Neptune.Imikimi.KimiEditor.TextEffects,s.CanvasElement,r=s.Element,T=s.newElement,s.File.V1Loader,O=v({suffix:"Factory"},"Element BitmapElement",function(t,e,n){return T(t,e,n)}),o=O.ElementFactory,i=O.BitmapElementFactory,w=I(128),k=0,b(t,function(t){function ElementEditState(){this._viewElements={},ElementEditState.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)D.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ElementEditState,e),ElementEditState.aliases("dropIn","element"),ElementEditState.prototype.getUniqueId=function(){return"ElementEditStateId_"+ ++k},ElementEditState.getter({nextUniqueId:function(){return k}}),ElementEditState.stateFields({selectedElementId:null,topElementIds:[],dropInIds:[],editMode:null,kimiSize:null,backgroundBitmap:null,maxTopElements:40,lastCloneInfo:{},premiumTextPreviewProps:{}}),ElementEditState.maximumBitmapSize=I(2048),ElementEditState.prototype.maximumBitmapSize=ElementEditState.maximumBitmapSize,ElementEditState.setter({premiumTextPreviewProps:function(t){return this._setElementProps("premiumTextPreviewProps",t)},backgroundBitmap:function(t){return this.setState({backgroundBitmap:t})}}),ElementEditState.prototype.updateColorHistory=function(t){var e;if(t)return S(t,(e=this,function(t){if(x(t)||P(t)&&y.test(t))return t=L(t),e.models.colorPickerState.addToHistory(t)}))},ElementEditState.prototype.resetState=function(){return this._viewElements={},ElementEditState.__super__.resetState.apply(this,arguments)},ElementEditState.prototype.init=function(t){var e,n,i,r;return i=t.dropIns,r=t.kimiSize,e=t.backgroundBitmap,this.resetState(),this.kimiSize=e?e.size:r,this.backgroundBitmap=e||null,this.setState({dropInIds:function(){var t,e,r,o;for(o=[],t=0,e=(r=i||[]).length;t<e;t++)n=r[t],o.push(this.setElementProps(n,{dropIn:n,key:n.key}));return o}.call(this)}),this.models.history.reset()},ElementEditState.prototype.toggleEditMaskMode=function(){switch(this.editMode="mask"===this.editMode?null:"mask",this.editMode){case"mask":return this.ensureElementHasMask()}},ElementEditState.prototype.normalEditMode=function(){return this.editMode=null},ElementEditState.prototype.select=function(t){var e;return t?((e=this.getElementProps(t))&&(e.locked?this.deselect():(this.setState({selectedElementId:t}),this.saveUndo("select"))),t):this.deselect()},ElementEditState.prototype.ensureElementHasMask=function(){var t;if(!this.selectedElementProps.maskBitmap)return this.updateSelectedElementProps({maskBitmap:t=this.selectedElementProps.bitmap.newBitmap()}),t.drawRectangle(null,R(t.size.div(2)),{color:"black"})},ElementEditState.prototype.deselect=function(){if(this.selectedElementId)return this.setState({selectedElementId:null}),this.saveUndo("deselect"),null},ElementEditState.prototype.bringToFront=function(t){return this.moveElement(t,-1)},ElementEditState.prototype.sendToBack=function(t){return this.moveElement(t,0)},ElementEditState.prototype.moveForward=function(t){return this.moveElementRelative(t,1)},ElementEditState.prototype.moveBackward=function(t){return this.moveElementRelative(t,-1)},ElementEditState.prototype.moveElement=function(t,e){return P(t)||(t=this.selectedElementId),this.setState({topElementIds:d(this.topElementIds,t,e)}),this.saveUndo("changeDrawOrder")},ElementEditState.prototype.moveElementRelative=function(t,e){var n,i;return P(t)||(t=this.selectedElementId),n=(i=this.topElementIds).indexOf(t),this.setState({topElementIds:p(i,n,g(0,n+e,i.length-1))}),this.saveUndo("changeDrawOrder")},ElementEditState.prototype.toggleLocked=function(t){var e;if(P(t)||(t=this.selectedElementId),e=this.getElementProps(t))return this.selectedElementId===t&&(this.selectedElementId=null),this.updateElementProps(t,{locked:!e.locked}),this.saveUndo("toggleLocked")},ElementEditState.prototype.cloneSelected=function(){var t,e,n,i,r,o;if(this.selectedElementProps)return n=this.selectedElementProps.currentLocation,t=(r=this.lastCloneInfo).lastCloneFrom,n=r.lastCloneTo===this.selectedElementId&&(e=this.getElementProps(t))?n.add(n.sub(e.currentLocation)):n=n.add(50),this.kimiSize.contains(n)||(n=this.kimiSize.mul(.25).add(this.kimiSize.x*Math.random()*.5,this.kimiSize.y*Math.random()*.5)),i=this.selectedElementId,this.addTopElement(_(this.selectedElementProps,{location:n})).then((o=this,function(t){return o.lastCloneInfo={lastCloneFrom:i,lastCloneTo:t}})),this.saveUndo("cloneSelected")},ElementEditState.prototype.flipSelected=function(t){var e;if(P(t)||(t=this.selectedElementId),e=this.getElementProps(t))return this.updateElementProps(t,{flipped:!e.flipped,encodedBitmap:null}),this.saveUndo("flip")},ElementEditState.prototype.moveSelected=function(t,e){var n;if(P(e)||(e=this.selectedElementId),n=this.getElementProps(e))return this.updateSelectedElementProps({location:n.currentLocation.add(t)}),this.saveUndo("nudge")},ElementEditState.prototype.trashSelected=function(t){var e;if(P(t)||(t=this.selectedElementId),t&&(e=this.removeState(t)))return this.selectedElementId===t&&(this.selectedElementId=null),this.updateElementProps(e.dropInId,{droppedInElementId:null}),N.call(this.topElementIds,t)>=0&&(this.topElementIds=f(this.topElementIds,t)),this.saveUndo("trash")},ElementEditState.prototype.addTopBitmapWithFill=function(t){var e;return e=t.size,this.addTopElement({bitmap:t,scale:1,axis:.5,location:{ps:.5},size:function(t){return e.fill(t)}})},ElementEditState.prototype.addBitmap=function(t,e){var n;return this.updateColorHistory(e),this.models.elementEditState.addTopElement(_(e,{bitmap:t,custom:{options:{editShapeOptions:{bitmap:t}},edit:this.models.kimiEditorNavState.showShape}}),null==(n=null!=e?e.userRequested:void 0)||n)},ElementEditState.prototype.addTopElement=function(t,e){return null==e&&(e=!0),l.then((n=this,function(){var t;if(n.maxTopElementsReached)throw Neptune.Art.Flux.models.navState.showSystemMessage({message:t="Maximum limit of "+n.maxTopElements+" layers reached."}),t})).then(function(e){return function(){return e.normalizeBitmap(t)}}(this)).then(function(e){return function(n){if((t=n).text&&!t.bitmap)return t=_(c.defaultStyle,t),e._generateTextImage(t).then(function(e){return t.bitmap=e})}}(this)).then(function(n){return function(){var i;return t.scale||(t.scale=1),t.axis||(t.axis=.5),t.location||(t.location={ps:.5}),t.size||(t.size=t.bitmap&&function(e){return t.bitmap.size.fitInto(e)}),i=n.getUniqueId(),n.setElementProps(i,t),n.topElementIds=h(n.topElementIds,i),e&&(n.setState({selectedElementId:i}),n.saveUndo("addPhoto")),i}}(this));var n},ElementEditState.prototype.addTextElement=function(t){return this.addTopElement(P(t)?_(this.models.preferences.defaultTextProps,{text:t}):t)},ElementEditState.prototype.getElementTreeForDropInContents=function(t){var e,n,r,s,a;return r=this.kimiSize,e=(a=s=this.getElementProps(t)).dropInContentsBitmap,n=a.flipped,o({size:r,key:"elementTreeRoot",axis:.5,clip:!0},o(s,{key:t},i({key:"standardDropInBackground",axis:.5,location:{ps:.5},scale:n?I(-1,1):1,bitmap:e})))},ElementEditState.prototype.fixTopElementAxis=function(){var t,e,n,i,r,o;for(o=[],e=0,n=(r=this.topElementIds).length;e<n;e++)t=r[e],i=this.getElementProps(t),I(.5).eq(I(i.axis))?o.push(void 0):o.push(this.setAxisWithoutChangingView(t,.5));return o},ElementEditState.prototype.getElementTreePromise=function(t){var e,n,r,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b;return b=(v=null!=t?t:{}).withFills,c=v.dropInsOnly,this,m=this.kimiSize,e=this.backgroundBitmap,this,S=this.topElementIds,a=this.dropInIds,this.fixTopElementAxis(),o({size:m,key:"elementTreeRoot",axis:.5,clip:!0},c?void 0:e?i({bitmap:e}):o({draw:"white"}),function(){var t,e,u,c;for(c=[],t=0,e=a.length;t<e;t++)s=a[t],u=y=this.getElementProps(s),h=u.droppedInElementId,u.location,u.size,u.compositeMode,l=u.dropIn,c.push(o({location:l.location,key:s,size:l.size,compositeMode:l.compositeMode},function(){var t,e,s,a,u;for(u=[],t=0,e=(s=l.children).length;t<e;t++)r=s[t],u.push([r.isMask&&h?(a=y=this.getElementProps(h),f=a.flipped,n=a.bitmap,d=a.encodedBitmap,o(y,{key:h},i({axis:.5,location:{ps:.5},scale:f?I(-1,1):1,bitmap:n,userProps:{encodedBitmap:d}}))):void 0,i({size:r.size,location:r.location,bitmap:r.bitmap,compositeMode:r.compositeMode})]);return u}.call(this)));return c}.call(this),function(){var t,e,r;for(r=[],t=0,e=S.length;t<e;t++)p=S[t],(y=this.getElementProps(p)).isDropIn?(n=y.bitmap,g=y.maskBitmap,f=y.flipped,y.exampleDropInProps,d=y.encodedBitmap,u=y.dropInTopBitmap,C({dropInTopBitmap:u}),r.push(o(y,{key:p,userProps:{dropInEnabled:!0}},o({axis:"centerCenter",location:"centerCenter",scale:f?I(-1,1):1},b?[o({key:"dropInFill",draw:"black"}),i({key:"dropInMask",bitmap:g,isMask:!0})]:i({key:"standardDropInBackground",bitmap:n,userProps:{encodedBitmap:d}}),u?i({bitmap:u}):void 0)))):c?r.push(void 0):r.push(i(y,{key:p,userProps:{encodedBitmap:y.encodedBitmap},scale:I(y.scale).mul(y.flipped?I(-1,1):1)}));return r}.call(this)).onNextReady()},ElementEditState.prototype.saveUndo=function(t){return this.models.history.saveUndo(t)},ElementEditState.prototype.updateElementProps=function(t,e){var n,i;if(t=this.getElementId(t))return i=this.state[t],n=_(i,e),this._setElementProps(t,n,i)},ElementEditState.prototype.updateSelectedElementProps=function(t){return this.updateElementProps(this.selectedElementId,t)},ElementEditState.prototype.updatePremiumTextPreviewProps=function(t){return this.updateElementProps("premiumTextPreviewProps",t),this.models.preferences.saveDefaultTextProps()},ElementEditState.prototype.applyTextPreviewPropsToSelected=function(){var t,e,n,i,r,o;return o=(i=this.premiumTextPreviewProps).text,n=i.font,t=i.color,e=i.effect,r=i.style,this.updateSelectedElementProps({font:n,color:t,effect:e,style:r}),this.saveUndo("changeTextProps"),o&&this.updateSelectedElementProps({text:o}),this.saveUndo("editText")},ElementEditState.prototype.applyTextProps=function(t,e){var n;return n=this.models.openFile,"premiumTextPreviewProps"===t?(this.updateElementProps(t,e),!0):n.isCreator?(this.updateElementProps(t,e),this.saveUndo("changeTextProps"),!0):void 0},ElementEditState.prototype.getElementProps=function(t){return t=this.getElementId(t),this.state[t]},ElementEditState.prototype.setElementProps=function(t,e){return null==e&&(e={}),t=this.getElementId(t),this._setElementProps(t,e)},ElementEditState.prototype.getElementId=function(t){return P(t)?t:t?t.key||t.objectId||t.elementId:null},ElementEditState.prototype.elementViewReady=function(t,e){if(e.parent)return this._viewElements[t]=e,this.updateElementProps(t,{currentLocation:e.currentLocation,currentSize:e.currentSize,currentElementToParentMatrix:e.elementToParentMatrix})},ElementEditState.prototype.getViewElement=function(t){var e;return!t||t instanceof r?t:(e=this.getElementId(t),this._viewElements[e])},ElementEditState.prototype.getElementToElementIdSpaceMatrix=function(t,e){return this.getViewElement(t).getElementToElementMatrix(this.getViewElement(e))},ElementEditState.prototype.getLocationInElementSpace=function(t,e,n){return this.getElementToElementIdSpaceMatrix(e,n).transform(t)},ElementEditState.prototype.getLocationInElementParentSpace=function(t,e,n){return this.getElementToElementIdSpaceMatrix(e,this.getViewElement(n).parent).transform(t)},ElementEditState.prototype.setAxisWithoutChangingView=function(t,e){var n,i,r,o,s;if(s=this.state[t])return e=I(e),o=s.currentSize,r=s.currentElementToParentMatrix,n=o.mul(e),i=r.transform(n),this.updateElementProps(t,{location:i,axis:e})},ElementEditState.prototype.getElementIdUnderPresenterSpacePoint=function(t){var e,n;return t.gte(M)&&t.lt(this.kimiSize)?(n=this.topElementPropsUnderPoint(t))?n.elementId:(e=this.dropInPropsUnderPoint(t))?e.droppedInElementId:void 0:null},ElementEditState.prototype.encodeBitmaps=function(){var t,e;return e=function(){var e,n,i,r;for(r=[],e=0,n=(i=this.allUserAddedElementIds).length;e<n;e++)t=i[e],r.push(this.encodeBitmapForElement(t));return r}.call(this),l.all(e)},ElementEditState.prototype.encodeBitmapForElement=function(t){var e,n;return e=this.getElementProps(t),l.resolve().then(function(){var n,i,r,o,s;if(n=e.bitmap,r=e.encodedBitmap,s=e.encodedBitmapFlipped,o=e.encodedBitmapAsLoaded,i=e.encodedAsJpg,e.flipped,!n)throw new Error("missing bitmap for "+t);return l.deepAll({encodedBitmap:r||o||(i?n.toJpg():n.toPng()),encodedBitmapFlipped:s||(i?n.hFlipped().toJpg():n.hFlipped().toPng())})}).then((n=this,function(e){return n.updateElementProps(t,e),e}))},ElementEditState.prototype.normalizeBitmap=function(t){var e,n,i,r,o,s,c,h;return e=t.bitmap,r=t.file,h=t.sourceUrl,n=t.encodedAsJpg,i=t.encodedBitmap,e?(n||(n=!!(null!=r?r.type.match(/\bjpg|jpeg\b/i):void 0)),e.size.lt(this.maximumBitmapSize)?l.resolve().then(function(){return i||(r?B(r):h?u.getArrayBuffer(h,{verbose:!0,query:{cacheBust:F(16)}}):void 0)}).then(function(i){return _(t,{bitmap:e,encodedBitmapAsLoaded:i&&m(i),encodedAsJpg:n})}):(s=this.maximumBitmapSize.div(e.size).min(),o=e.size.mul(s).floored,(c=e.newBitmap(o)).drawBitmap(a.scale(s),e),l.resolve(_(t,{bitmap:c,encodedBitmapAsLoaded:null,encodedAsJpg:n})))):l.resolve(t)},ElementEditState.prototype._selectElement=function(t){return this.setState({selectedElementId:t})},ElementEditState.prototype.topElementPropsUnderPoint=function(t){return this.elementPropsUnderPointFromElementIds(t,this.topElementIds)},ElementEditState.prototype.elementPropsUnderPointFromElementIds=function(t,e){var n,i,r,o,s,a,l,u,c,h,p,d,f;for(5,n=null,a=e.length-1;a>=0;a+=-1)if(o=e[a],(null!=(d=s=this.state[o])?d.exactPointInsideMap:void 0)&&(r=s.currentSize,i=s.currentElementToParentMatrix,l=(f=s.exactPointInsideMap).map,u=f.mapSize,i&&r&&(p=i.inverseTransform(t).div(r)).gte(M)&&p.lt(A)&&(c=l[(0|(h=p.mul(u)).y)*u.x+h.x|0])>5&&(n=s,c>128)))return n;return n},ElementEditState.prototype.elementClosestLegalGeometry=function(t,e,n){var i,r,o,s,a,l,u,c,h,p,d,f,m,y,v,S,b,w,x,P;return(c=this.state[t])&&(x=this.getViewElement(t))?(b=x.parent,o=x.currentSize,w=x.getCurrentElementToParentMatrix(!1,e,n),i=function(){return b?(l=c.dropInId)?(u=this.getViewElement(l),y=u.currentSize.div(x.currentSize).max(),m=.5*y,f=25*y,(r=w.getExactScaler())!==(d=g(m,r,f))&&(w=x.getCurrentElementToParentMatrix(!1,e,d)),s=u.currentSize.cc,a=w.inverseTransform(s),S=o.nearestInsidePoint(a),(v=w.transform(S)).eq(s)?w:w.translate(s.sub(v))):(p=function(t,e,n){var i,r;return r=n.transformBoundingRect(t),e.overlaps(r)?n:(i=I(g(e.left-r.width,r.x,e.right),g(e.top-r.height,r.y,e.bottom)),n.translate(i.sub(r.location)))},h=function(t,e,n){var i;return i=p(t,e,n),p(e,t,i.invert()).invert()},x.parent.currentSize.div(x.currentSize).min(),P=x.parent.currentSize.div(x.currentSize).max(),m=.02*P,f=5*P,(r=w.getExactScaler())!==(d=g(m,r,f))&&(w=x.getCurrentElementToParentMatrix(!1,e,d)),h(x.logicalArea,b.logicalArea,w)):w}.call(this),{location:x.getCurrentLocation(!1,i),scale:i.getScale()}):{location:null!=e?e:M,scale:null!=n?n:1}},ElementEditState.prototype.setState=function(t,e){var n;return n=ElementEditState.__super__.setState.apply(this,arguments),this.models.derivedElementEditState._update(),n},ElementEditState.prototype._getTextRendererForSelectedText=function(t){var e,n,i,r;if(null==t&&(t=this.selectedElementProps),null!=t?t.text:void 0)return r=t.text,i=t.font,n=t.effect,e=t.color,new c.renderers[n]({font:i,color:e,text:r})},ElementEditState.prototype._generateTextImage=function(t){return this._getTextRendererForSelectedText(t).createBitmap()},ElementEditState.prototype._textPropsChanged=function(t,e){return e&&(e.text!==t.text||e.font!==t.font||e.effect!==t.effect||e.color!==t.color)},ElementEditState.prototype._setElementProps=function(t,e,n){var i;return n||(n=this.state[t]||{}),e.text&&(e.style&&delete(e=_(e,c.styles[e.style])).style,(e=_(c.defaultStyle,e)).bitmap&&!this._textPropsChanged(e,this.state[t])||this._generateTextImage(e).then((i=this,function(e){return i.updateElementProps(t,{bitmap:e,encodedBitmap:null,encodedBitmapAsLoaded:null,size:e.size.withSameAreaAs(i.selectedElementProps.currentSize)})})),e.styleName=c.detectStyleName(e)),n.bitmap!==e.bitmap?(n.bitmap&&(e.size=e.bitmap.size.withSameAreaAs(this.getElementProps(t).currentSize)),e.exactPointInsideMap=this._generateExactPointInsideMap(e.bitmap)):e.dropIn&&e.dropIn!==n.dropIn&&e.dropIn.toBitmapBasic({area:"logicalArea"}).then(function(e){return function(n){var i;return i=e._generateExactPointInsideMap(n),e.updateElementProps(t,{exactPointInsideMap:i,bitmap:i.mapBitmap})}}(this)),e.elementId=t,this.setState(t,e),t},ElementEditState.prototype._generateExactPointInsideMap=function(t){var e,n,i,r;return t?(n=(r=t.size).fitInto(w).round(),e=a.scale(n.div(r)),(i=t.newBitmap(n)).drawBitmap(e,t),{mapBitmap:i,map:i.getImageDataArray("alpha"),mapSize:n}):null},E(ElementEditState.prototype,n(1072)),ElementEditState.getter(n(1073)),ElementEditState}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["console","zoPickImage","Error","merge"],[e,n(1067)],(t,e,n,r)=>{let o;return o=function(t,e){return t.currentSize.maxRatio(e.size)},{setElementDropIn:function(t,e,n){let i;return e&&e!==(i=this.state[t].dropInId)?(n&&(this._swapDropInContents(i,n),i=n),this._swapDropInContents(i,e)):void 0},dropInPropsUnderPoint:function(t){return this.elementPropsUnderPointFromElementIds(t,this.dropInIds)},getDropInState:function(t){return this.state[this.getElementId(t)]},addBitmapToDropIn:function(e,n){return e||(e=this.emptyDropIns[0]),this.normalizeBitmap(n).then(t=>{let n;return this._selectElement(n=this._addBitmapToDropIn(e,t)),this.saveUndo("addPhoto"),n}).catch(e=>t.error(e))},selectAndAddPhotoToDropIn:function(t){return t?e().then(e=>this.models.elementEditState.addBitmapToDropIn(t,e)):void 0},getSizeRatio:function(t,e){let n,i,r,s,a;return n=this.state[t],i=this.state[e],n&&i?(({bitmap:r,scale:s}=i),({dropIn:a}=n),o(a,r)/s):void 0},setSizeRatio:function(t,e,n){let i,r,s,a;return i=this.state[t],r=this.state[e],n&&i&&r?(({bitmap:s}=r),({dropIn:a}=i),this.updateElementProps(e,{scale:o(a,s)/n})):void 0},_makeDroppedInElementsLocationRelative:function(t){let e,n,r,o;return this.setAxisWithoutChangingView(t,.5),(e=this.state[t])?(n=e.location,(i.exists(o=this.state[e.dropInId])?r=o.dropIn.currentSize:void 0)?this.updateElementProps(t,{location:{xw:n.x/r.x,yh:n.y/r.y}}):void 0):void 0},_addBitmapToDropIn:function(t,e){let s,a,l,u,c;if(s=this.getElementId(t),!i.exists(c=this.state[s])||!c.dropIn)throw new n(`couldn't find dropIn for ${i.toString(s)}`);return({dropIn:t}=a=this.state[s]),({bitmap:l}=e),e=r({size:l.size,axis:.5,location:{ps:.5},scale:o(t,l),angle:0,flipped:!1},e,{dropInId:s}),u=this.getUniqueId(),this.setElementProps(u,e),this.updateElementProps(s,{droppedInElementId:u}),u},_setSizeRatioForNewDropIn:function(t,e,n){let i,r,o;return(i=this.state[n])?(r=this.getSizeRatio(t,n),o=i.scale,this.setSizeRatio(e,n,r)):void 0},_swapDropInContents:function(t,e){let n,i,r,o;return t!==e?(n=this.state[t],i=this.state[e],(()=>{switch(!1){case!n.droppedInElementId:return r=n.droppedInElementId,o=i.droppedInElementId,this._makeDroppedInElementsLocationRelative(o),this._setSizeRatioForNewDropIn(t,e,r),this._setSizeRatioForNewDropIn(e,t,o),this.updateElementProps(t,{droppedInElementId:null!=o?o:null}),this.updateElementProps(e,{droppedInElementId:null!=r?r:null}),this.updateElementProps(r,{dropInId:e}),o?this.updateElementProps(o,{dropInId:t}):void 0;case!i.droppedInElementId:return this._swapDropInContents(e,t)}})()):void 0}}}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["merge"],[e,n(1067)],t=>({hasUserAddedElements:function(){return this.topElementIds.length>0||this.hasUserDroppedInElements},allUserAddedElementIds:function(){return this.droppedInElementIds.concat(this.topElementIds)},maxTopElementsReached:function(){return this.topElementIds.length>=this.maxTopElements},selectedElementProps:function(){return this.state[this.selectedElementId]||null},selectedElementTextProps:function(){let t,e,n,i;return({color:t,effect:e,font:n}=null!=(i=this.selectedElementProps)?i:{}),{color:t,effect:e,font:n}},creatorDropInCount:function(){let t;return t=0,i.each2(this.topElementIds,e=>t++,t=>{let e;return i.exists(e=this.getElementProps(t))&&e.isDropIn}),t},droppedInImageInfo:function(){let e,n;return({kimiPresenter:e}=this.models.kimiEditorViewState),n={},i.each2(this.dropInIds,(i,r)=>{let o,s,a,l;return({droppedInElementId:o,key:s}=this.getElementProps(i)),a=this.getElementProps(o),l=this.getViewElement(o),n[s]=a&&t(a,{size:l.currentSize,elementToFileMatrix:l.getElementToElementMatrix(e),dropInIndex:r})}),n},fullDropIns:function(){return i.array(this.dropInIds,t=>this.state[t],t=>this.state[t].droppedInElementId)},emptyDropIns:function(){return i.array(this.dropInIds,t=>this.state[t],t=>!this.state[t].droppedInElementId)},hasUserDroppedInElements:function(){return!!i.find(this.dropInIds,null,t=>this.state[t].droppedInElementId)},droppedInElementIds:function(){let t;return t=null,i.array(this.dropInIds,e=>t,e=>t=this.state[e].droppedInElementId)},selectedElementDropInId:function(){let t;return i.exists(t=this.state[this.selectedElementId])&&t.dropInId},selectedElementDropInProps:function(){let t;return this.state[i.exists(t=this.selectedElementProps)&&t.dropInId]||null}})))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u={}.hasOwnProperty;r=n(160),i=n(506),r.log,s=r.defineModule,r.mergeInto,l=r.shallowClone,a=r.peek,o=r.bound,e=i.Models.ApplicationState,s(t,function(t){function History(){return History.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(History,e),History.stateFields({undoAvailable:!1,redoAvailable:!1,history:[],historyIndex:-1,maxHistoryLength:25}),History.prototype.reset=function(){return this.resetState(),this.saveUndo("initial")},History.getter({currentUndoState:function(){return this.history[this.historyIndex]}}),History.prototype.saveUndo=function(t){if(!t)throw new Error;return this._truncateHistory(),this.currentUndoState,this._pushUndoState({type:t,state:l(this.models.elementEditState.state)}),this._collapseStates(),this._updateAvailability()},History.prototype.undo=function(){if(!(this.historyIndex<=0))return this.historyIndex--,this._applyState();Neptune.Art.Flux.models.navState.showSystemMessage({title:"History",message:"Nothing to undo."})},History.prototype.redo=function(){if(!(this.historyIndex>this.history.length-1))return this.historyIndex++,this._applyState();Neptune.Art.Flux.models.navState.showSystemMessage({title:"History",message:"Nothing to redo."})},History.prototype._debug=function(){var t;return{historyIndex:this.historyIndex,history:function(){var e,n,i,r;for(r=[],e=0,n=(i=this.history).length;e<n;e++)t=i[e],r.push(t.type);return r}.call(this)}},History.prototype._updateAvailability=function(){return this.setState({undoAvailable:this.historyIndex>0,redoAvailable:this.historyIndex<this.history.length-1})},History.prototype._applyState=function(){return this.models.elementEditState.replaceState(this.history[this.historyIndex].state),this._updateAvailability()},History.prototype._truncateHistory=function(){return this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1)),this.history.length>=this.maxHistoryLength&&(this.history=this.history.slice(1)),this.historyIndex=o(0,this.historyIndex,this.history.length-1)},History.prototype._replaceCurrentUndoState=function(t){return t?this.history[this.historyIndex]=t:this._popUndoState()},History.prototype._popAndCollapse=function(){var t,e;return e=this._popUndoState(),t=this._popUndoState(),function(){switch(t.type){case"flip":if(e.type===t.type)return[];break;case"deselect":if(e.state.selectedElementId)return[e];break;case"select":if("select"===e.type||"deselect"===e.type)return[e];break;default:if("select"===e.type&&t.state.selectedElementId===e.state.selectedElementId)return[t]}}()||[t,e]},History.prototype._collapseStates=function(){var t,e,n,i,r;if(this.history.length>=2){for(e=0,n=(i=t=this._popAndCollapse()).length;e<n;e++)r=i[e],this._pushUndoState(r);if(t.length<2)return this._collapseStates()}},History.prototype._peekUndoState=function(){return a(this.history)},History.prototype._popUndoState=function(){return this.historyIndex=this.history.length-2,this.history.pop()},History.prototype._pushUndoState=function(t){if(t)return this.history.push(t),this.historyIndex=this.history.length-1},History}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState","Error","zoPickImage","merge"],[e,n(1067)],(t,e,r,o)=>{return i.defClass(class KimiEditorNavState extends t{},function(t,s,a){let l;l=null,i.each2(["Exit","Add","AddShape","Text","Shape","AddDropIn","Layers"],t=>this.prototype[`show${i.toString(t)}`]=function(r){let o;if(l||({Overlays:l}=n(1076)),!(o=l[t]))throw new e(`can't find Overlay ${i.toString(t)}`);return this.models.navState.showOverlay({overlayFactory:o,props:r})}),this.prototype.addBitmap=function(){return this.hideOverlay(),r().then(({bitmap:t,colorInfo:{colors:e}})=>this.models.elementEditState.addBitmap(t,{colors:e}))},this.prototype.hideOverlay=function(){return this.models.navState.hideOverlay()},this.prototype.save=function(){return this.models.openFile.encodeForOz().then(t=>{let e;return e=o(t,this.models.openFile.newPostProps),this.models.event.create({key:"navigate:onKimiEditorSave",data:e}),this.models.navState.showNewPost({editorSave:!0,close:()=>(this.models.newPostState.resetState(),this.models.navState.hideOverlay())}),this.models.newPostState.selectedImageInfo=o(e,{editorSave:!0})})},this.prototype.exit=function(){let t,e,n;return t=(n=this.models.history).undoAvailable,e=n.redoAvailable,t||e?this.models.kimiEditorNavState.showExit():this.forceExit()},this.prototype.forceExit=function(){return this.models.openFile.exit(),this.hideOverlay()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(830)).includeInNamespace(n(1077)).addModules({KimiEditor:n(1128),StandardImport:n(1080)}),n(1129),n(1092),n(1130),n(1082),n(1139),n(1078)},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>(n(1078),n(1082)))}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(839)).addModules({AddPhotoButton:n(823),GradientColorsWidget:n(1079),Swatch:n(1081)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","GradientFillStyle","bound","merge","rgbColor","Math","objectWithout","parseFloat","shallowClone","Element","StyleProps","TextElement","Icons"],[e,n(1080)],(t,e,n,r,o,s,a,l,u,c,h,p,d)=>{let f;return f=4,i.defClass(class GradientColorsWidget extends t{},function(t,f,m){let g;this.subscriptions("viewState.buttonSize"),this.normalizeColors=g=function(t){let n,r;return t instanceof e&&(n=t),({colors:t}=n||new e("topLeft","bottomLeft",t)),r={},i.each2(t,({c:t,n:e})=>r[e.toPrecision(4)]=t),r},this.stateFields({editingColorStop:null,editingNString:null,previewAddLocation:null}),this.prototype.nFromEvent=function({target:t,location:e}){return n(0,e.x/t.currentSize.x,1)},this.prototype.updateEditingColorStop=function(t){return this.props.update({colors:g(t?r(this.editingColorsWithout,t):this.editingColorsWithout)})},this.prototype.setEditingColorStop=function(t,e){let n;return null==t&&null==e?this.editingColorStop=null:(null==t&&(t=this.editingN),this.editingN=t,this.editingColor=o(e||this.editingColor),this.editingNString=n=t.toPrecision(4),this.editingColorStop={[`${i.toString(n)}`]:this.editingColor})},this.prototype.closestExistingColorStopNUnderEvent=function({target:t,location:e}){let n,r,o,a,l;return({w:n}=t.currentSize),({x:r}=e),this.setEditingColorStop(),o=10.1,a=null,l=null,i.each2(this.props.colors,(t,e)=>{let i;return(i=s.abs(e*n-r))<=o?(o=i,a=e,l=t):void 0}),a},this.prototype.startEditingColorStopUnderEvent=function(t){let e;return(e=this.closestExistingColorStopNUnderEvent(t))?(this.editingColorsWithout="0.000"===e||"1.000"===e?this.props.colors:a(this.props.colors,e),this.setEditingColorStop(l(e),this.props.colors[e])):void 0},this.prototype.pointerDown=function(t){let e,n,i,r;if(t.target.capturePointerEvents(),this.previewAddLocation=null,!this.startEditingColorStopUnderEvent(t))return e=this.nFromEvent(t),this.editingY=0,({update:n,colors:i,gradientFillStyle:r}=this.props),this.editingColorsWithout=u(i),this.updateEditingColorStop(this.setEditingColorStop(e,r.getColorAt(e)))},this.prototype.pointerMove=function(t){let e,n,i,r;return({target:e,location:n}=t),({h:i}=e.currentSize),({y:r}=n),this.editingY=r<0||r>=i?(this.pointerMoveOut(),r-10):(this.pointerMoveIn(),this.updateEditingColorStop(this.setEditingColorStop(this.nFromEvent(t))),0)},this.prototype.pointerUp=function(){let t,e,n,r;return this.setEditingColorStop(),t=(r=this.props).colors,e=r.update,(n=i.array(t)).length>=2&&n[0]===n[1]?e({color:n[0],colors:null}):void 0},this.prototype.pointerClick=function(){return this.editingColorStop?this.props.showColorPicker(this.editingColor,t=>this.updateEditingColorStop(this.setEditingColorStop(null,t))):void 0},this.prototype.mouseIn=function(t){return this.previewAddLocation=this.nFromEvent(t)},this.prototype.mouseMove=function(t){return this.editingColorStop?void 0:this.setState({previewAddLocation:this.closestExistingColorStopNUnderEvent(t)?null:this.nFromEvent(t)})},this.prototype.mouseOut=function(t){return this.previewAddLocation=null},this.prototype.pointerMoveIn=function(){return this.moveOutEditingColorStop?(this.updateEditingColorStop(this.setEditingColorStop(this.moveOutEditingColorStop.n,this.moveOutEditingColorStop.c)),this.moveOutEditingColorStop=null):void 0},this.prototype.pointerMoveOut=function(){return this.editingColorStop?(this.moveOutEditingColorStop=this.editingColorStop,this.updateEditingColorStop(this.setEditingColorStop())):void 0},this.prototype.renderHandle=function(t,e,n){let r;return r=t===this.editingNString,t=l(t),c({key:`${i.toString(n)}`,size:{w:.5*this.buttonSize,hh:1},axis:"topCenter",location:{ww:t,y:0},drawOrder:["circle",{fill:{color:e},outline:h.getContrastingColor(e)}]})},this.prototype.render=function(){let t,e;return({colors:t}=this.props),e=0,c({size:{ww:1,h:.75*this.buttonSize},receivePointerEvents:"passToChildren"},"pointerCursor",c({receivePointerEvents:"passToChildren",on:{pointerDown:this.pointerDown,pointerMove:this.pointerMove,mouseIn:this.mouseIn,mouseMove:this.mouseMove,mouseOut:this.mouseOut,pointerUp:this.pointerUp,pointerClick:this.pointerClick},draw:{fill:{to:"topRight",colors:t}}},c(null!=this.previewAddLocation&&p(d.circlePlus,"childrenSize",{axis:"centerCenter",fontSize:25,location:{ww:this.previewAddLocation,hh:.5},animators:{color:!0,opacity:{toFrom:0}},color:h.getContrastingColor(this.props.gradientFillStyle.getColorAt(this.previewAddLocation))})),c("centerLeft",{size:{ww:1,h:.5*this.buttonSize},receivePointerEvents:"passToChildren"},i.array(t,(t,n)=>this.renderHandle(n,t,e++)))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(801).mergeWithSelf(n(824)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","rgbColor","Element","ColorPickerStyleProps","ImikimiPalette"],[e,n(1080)],(t,e,n,r,o)=>{return i.defClass(class Swatch extends t{},function(t,i,s){this.propFields("color","selectColor","selectedColor"),this.prototype.render=function(){let t;return t=e(this.color),n("pointerCursor",{margin:r.swatchMargin,size:r.swatchSize,on:{pointerClick:()=>this.selectColor(this.color)},draw:[{radius:2},t.a<1?{fill:r.backgroundGradient}:void 0,{fill:t,outline:t.eq(this.selectedColor)?{lineWidth:5,color:o.primary,compositeMode:"targetTopUnion"}:"#0001"}]})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(836)).addModules({KimiPresenter:n(1083),KimiViewer:n(1091),MenuColorPicker:n(1098),Zoom:n(1105)}),n(1084)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","KimiPresenterContents"],[e,n(1080),n(1084)],(t,e,n)=>{return i.defClass(class KimiPresenter extends t{},function(t,i,r){this.subscriptions("elementEditState.kimiSize","kimiEditorViewState.presenterProps"),this.prototype.ready=function({target:t}){return this.models.kimiEditorViewState.presenterCurrentLocation=t.currentLocation,this.models.kimiEditorViewState.kimiPresenter=t},this.prototype.render=function(){return e(this.presenterProps,{on:{ready:this.ready},axis:.5,size:this.kimiSize},this.kimiSize&&n())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(837)).addModules({DropIn:n(1085),DropInInverseMaskFilterComponent:n(1087),DropInWrapper:n(1088),EditableBitmapElement:n(1086),KimiPresenterBottom:n(1089),KimiPresenterContents:n(1090)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","BitmapElement"],[e,n(1080)],(t,e,r)=>{return i.defClass(class DropIn extends t{},function(t,o,s){this.subscriptions("dropIn"),this.prototype.ready=function({target:t}){let e;return({dropInId:e}=this.props),this.models.elementEditState.elementViewReady(e,t)},this.prototype.render=function(){let t,o,s,a,l,u;return({dropInId:t,hide:o,cacheDraw:s}=this.props),({dropIn:a}=this.state),i.exists(a)&&a.dropIn?(({droppedInElementId:l,dropIn:u}=a),e({key:`dropIn:${i.toString(t)}`,cacheDraw:s,on:{ready:this.ready},visible:!o,location:u.location,size:u.size,compositeMode:u.compositeMode},i.array(u.children,t=>[t.isMask&&l?n(1086)({elementId:l}):void 0,r({size:t.size,location:t.location,bitmap:t.bitmap,compositeMode:t.compositeMode})]))):e({key:`dropIn:${i.toString(t)}`})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","BitmapElement","point"],[e,n(1080)],(t,e,n,r)=>{return i.defClass(class EditableBitmapElement extends t{},function(t,i,o){this.subscriptions("element"),this.prototype.ready=function({target:t}){let e;return({elementId:e}=this.props),this.models.elementEditState.elementViewReady(e,t)},this.prototype.render=function(){let t,i,o;return({element:t}=this.state),t&&({flipped:i,bitmap:o}=t),e(t,{key:"EditableBitmapElement",on:{ready:this.ready}},n({axis:"centerCenter",location:"centerCenter",scale:i?r(-1,1):1,bitmap:o}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","DropInInverseMaskFilter","peek","point0"],[e,n(1080),n(484).addElementFactories("DropInInverseMaskFilter")],(t,e,n,r)=>{return i.defClass(class DropInInverseMaskFilterComponent extends t{},function(t,i,o){this.subscriptions("dropIn"),this.prototype.render=function(){let t,i,o;return({dropIn:t}=this.state),t?(i=n(t.dropIn.children),o=t.currentLocation&&i.currentLocation?i.currentLocation.add(t.currentLocation):r,e({maskLocation:o,mask:i.bitmap})):e()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","log","BitmapElement"],[e,n(1080)],(t,e,r,o)=>{return i.defClass(class DropInWrapper extends t{},function(t,i,s){this.subscriptions("dropIn"),this.prototype.ready=function({target:t}){let e;return({dropInId:e}=this.props),this.models.elementEditState.elementViewReady(e,t)},this.prototype.render=function(){let t,i,s,a,l;return({dropInId:t}=this.props),({dropIn:i}=this.state),i?(({droppedInElementId:s,dropIn:a}=i),a||r.warn({dropIn:i}),l=a.children[0],e({on:{ready:this.ready},location:a.location,size:a.size,clip:!0},o({size:l.size,location:l.location,bitmap:l.bitmap,compositeMode:l.compositeMode}),n(1086)({elementId:s}))):e()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","BitmapElement","Element","DropIn","EditableBitmapElement"],[e,n(1080),{DropIn:n(1085),EditableBitmapElement:n(1086)}],(t,e,n,r,o)=>{return i.defClass(class KimiPresenterBottom extends t{},function(t,s,a){this.subscriptions("elementEditState.backgroundBitmap","derivedElementEditState.selectedElementDropInId","elementEditState.dropInIds"),this.prototype.renderBackground=function(){let t;return({backgroundBitmap:t}=this.state),t?e({bitmap:this.state.backgroundBitmap}):n({drawOrder:[{outline:{color:"#0003",lineWidth:2}},"white"]})},this.prototype.renderDropIns=function(t){let e;return e=this.selectedElementDropInId,i.array(this.dropInIds,t=>r({cacheDraw:this.props.cacheDraw,dropInId:t,hide:t===e}))},this.prototype.render=function(){let t,e;return({topElementIds:t,cacheDraw:e}=this.props),n({key:"kimiPresenterBottom",cacheDraw:e},this.renderBackground(),n({clip:!0,stage:!1},this.renderDropIns(),i.array(t,t=>o({elementId:t}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","splitArray","Element","EditableBitmapElement","DropInWrapper","KimiPresenterBottom","DropInInverseMaskFilterComponent"],[e,n(1080),{DropInWrapper:n(1088),KimiPresenterBottom:n(1089),EditableBitmapElement:n(1086),DropInInverseMaskFilterComponent:n(1087)}],(t,e,r,o,s,a,l)=>{let u;return u={pixelsPerPoint:1},i.defClass(class KimiPresenterContents extends t{},function(t,c,h){this.subscriptions("derivedElementEditState.selectedElementDropInId","elementEditState.selectedElementId","elementEditState.topElementIds"),this.prototype.renderTopElementSandwich=function(){let t,s,a,l;return({topElementIds:t,selectedElementId:s}=this.state),[a,l]=e(t,s),[n(1089)({cacheDraw:u,topElementIds:a}),r({clip:!0},o({elementId:s})),r({key:"kimiPresenterTop",cacheDraw:u,clip:!0},i.array(l,t=>o({elementId:t})))]},this.prototype.renderDropInElementSandwich=function(){let t,e;return({topElementIds:t,selectedElementDropInId:e}=this.state),[s({dropInId:e}),r({key:"kimiPresenterSandwich",cacheDraw:u},a({topElementIds:[],cacheDraw:u}),l({dropInId:e}),i.array(t,t=>o({elementId:t})))]},this.prototype.render=function(){let t,e;return({topElementIds:t,selectedElementId:e}=this.state),r(t&&i.in(e,t)?this.renderTopElementSandwich():e?this.renderDropInElementSandwich():a({topElementIds:t,cacheDraw:u}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","present","merge","Element","SelectedElementOverlay","NothingSelectedOverlay","TextElement","TextStyles","TextPalette"],[e,n(1080),n(1092)],(t,e,r,o,s,a,l,u,c)=>{return i.defClass(class KimiViewer extends t{},function(t,i,h){this.subscriptions("elementEditState.selectedElementId","elementEditState.editMode","viewState.viewState","kimiEditorViewState.instantNotification"),this.stateFields({firstReadyCompleted:!1,instantNotificationOpacity:1}),this.prototype.preprocessState=function(t){let n;return({instantNotification:n}=t),n!==this.state.instantNotification&&e(n)?r(h.preprocessState.apply(this,arguments),{instantNotificationOpacity:1}):h.preprocessState.apply(this,arguments)},this.prototype.ready=function({target:{currentSize:t}}){return this.models.kimiEditorViewState.kimiViewerCurrentSize=t,this.onNextReady().then(()=>(this.firstReadyCompleted||this.models.kimiEditorViewState.resetView(),this.firstReadyCompleted=!0))},this.prototype.kimiPresenterReady=function({target:t}){return this.models.kimiEditorViewState.presenterCurrentLocation=t.currentLocation,this.models.kimiEditorViewState.kimiPresenter=t},this.prototype.render=function(){let t,e,i,r,h,p,d;return t=(d=this.state).eventHandlers,e=d.selectedElementId,i=d.editMode,r=d.instantNotificationOpacity,({safePadding:h,gridSize:p}=this.viewState),this.instantNotificationOpacity>0&&(this.instantNotificationOpacity=0),o({key:"rootElement",on:{ready:this.ready},visible:this.firstReadyCompleted,padding:{left:h.left,right:h.right}},n(1083)(),e?(()=>{switch(i){case"mask":return null;default:return s({selectedElementId:e})}})():a(),o("childrenSize",{key:this.instantNotification,location:p/2,padding:p/2,opacity:r,animators:{opacity:{duration:1,f:"easeOutCirc"}},draw:{radius:100,fill:"white"}},l(u.mediumText,"childrenSize",{text:this.instantNotification,color:c.black.secondary})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(834)).addModules({NothingSelectedOverlay:n(1093),OverlayBase:n(1095),SelectedElementOverlay:n(1096),SyncedOverlay:n(1094),TransformHandle:n(1097)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","AddPhotoButton"],[e,n(1080),n(1078)],(t,e)=>{let r,o;return r=i.defClass(class AddPhotoFluxButton extends t{},function(t,n,r){this.subscriptions("dropIn openFile.isCreator"),this.prototype.render=function(){let t,n,r,o,s,a,l,u,c,h;return t=(c=this.props).presenterScale,n=c.animators,r=(h=this.state).isCreator,o=h.dropIn,i.exists(o)&&(s=o.droppedInElementId,a=o.dropIn,i.exists(a)&&(l=a.elementToParentMatrix,u=a.currentSize)),e({visible:r||l&&!s,location:i.exists(l)&&l.transform(u.cc),dropIn:o,scale:1/t,animators:n})}}),o=i.defClass(class NothingSelectedSyncedOverlay extends t{},function(t,e,o){this.subscriptions("elementEditState.dropInIds","kimiEditorViewState.presenterProps"),this.prototype.render=function(){let t,e,o;return t=(o=this.state).dropInIds,e=o.presenterProps,n(1094)(i.array(t||[],t=>r({dropInId:t,animators:e.animators,presenterScale:e.scale})))}}),i.defClass(class NothingSelectedOverlay extends t{},function(t,e,i){this.prototype.render=function(){return n(1095)(o())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element"],[e,n(1080)],(t,e)=>{return i.defClass(class SyncedOverlay extends t{},function(t,n,i){this.subscriptions("elementEditState.kimiSize","kimiEditorViewState.presenterProps"),this.prototype.render=function(){return e(this.presenterProps,{receivePointerEvents:"passToChildren",axis:.5,key:"syncedOverlay",size:this.kimiSize},this.props.children)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","rect","Element"],[e,n(1080)],(t,e,n)=>{return i.defClass(class OverlayBase extends t{},function(t,r,o){this.subscriptions("kimiEditorViewState.presenterCurrentLocation"),this.prototype.pointerDown=function(t){return this.startLocation=this.state.presenterCurrentLocation},this.prototype.pointerMove=function({target:t,totalDelta:e}){let n,r;return i.exists(t)&&t.capturePointerEvents(),n=this.startLocation.add(e),r=this.legalLocationArea.nearestInsidePoint(n),this.models.kimiEditorViewState.presenterLocation=n.average(r)},this.getter({overlayElement:function(){return this.refs.overlayParent.element.children[1]},legalLocationArea:function(){let t,n,i,r,o,s;return t=(s=this.overlayElement).currentSize,n=s.scale,i=s.parent,r=s.elementToParentMatrix,o=t.mul(n),e(i.currentSize.cc.sub(o.cc),o).roundOut()}}),this.prototype.animateToLegalLocation=function(){return this.models.kimiEditorViewState.animatedPresenterLocation=this.legalLocationArea.nearestInsidePoint(this.overlayElement.currentLocation)},this.prototype.selectElement=function(t){return this.models.kimiEditorViewState.selectElementUnderEvent(t)},this.prototype.render=function(){return n({key:"overlayParent",animators:{opacity:{voidValue:0}}},n({on:{pointerDown:this.pointerDown,pointerMove:this.pointerMove,pointerClick:this.selectElement,pointerUp:this.animateToLegalLocation}}),this.props.children)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","point","min","Math","Element","TransformHandle"],[e,n(1080),{TransformHandle:n(1097)}],(t,e,r,o,s,a,l)=>{let u;return u=i.defClass(class SelectionSyncedOverlay extends t{},function(t,u,c){this.subscriptions("derivedElementEditState.selectedElementDropInProps","derivedElementEditState.selectedElementProps","kimiEditorViewState.presenterProps","kimiEditorViewState.editableElementAnimators"),this.stateFields({stretchMode:!1}),this.prototype.toggleStretchMode=function(){return this.stretchMode?(this.stretchMode=!1,this.models.kimiEditorViewState.instantNotification="scale and rotate"):(this.stretchMode=!0,this.models.kimiEditorViewState.instantNotification="stretch")},this.prototype.preprocessState=function(t){return t=e(t,{selectedElementProps:t.selectedElementProps||this.state.selectedElementProps||{},selectedElementDropInProps:t.selectedElementDropInProps||this.state.selectedElementDropInProps||{}}),c.preprocessState.call(this,t)},this.prototype.pointerDown=function(t){let e,n,r,o,s,a,l;return({selectedElementProps:e}=this.state),n=e.elementId,({location:r,target:o}=t),this._transformedSelected=!1,i.isF((l=this.props).hideOverlay)&&l.hideOverlay(),e.currentSize?(s=this.models.elementEditState.getLocationInElementSpace(r,o,n),this.models.kimiEditorViewState.disableEditableElementAnimators(),this.models.elementEditState.setAxisWithoutChangingView(e.elementId,s.div(e.currentSize)),this._dropInChangeEnabled=!!(this._startedInDropInId=i.exists(e)&&e.dropInId)&&(a=this.models.kimiEditorViewState.dropInIdUnderEvent(t),this._startedInDropInId===a)):void 0},this.prototype.pointerMove=function(t){let e,n,r,o,s,a;return({target:e,location:n}=t),i.exists(e)&&e.capturePointerEvents(),({selectedElementProps:r}=this.state),o=r.elementId,this._dropInChangeEnabled&&this.models.elementEditState.setElementDropIn(o,s=this.models.kimiEditorViewState.dropInIdUnderEvent(t),this._startedInDropInId),this._transformedSelected=!0,n=s||r.dropInId?this.models.elementEditState.getLocationInElementSpace(n,e,s||r.dropInId):this.models.elementEditState.getLocationInElementParentSpace(n,e,r.elementId),a=this.models.elementEditState.elementClosestLegalGeometry(o,n),this.models.elementEditState.updateElementProps(o,{location:n.average(a.location)})},this.prototype.pointerUp=function(t){let e,n;return({selectedElementProps:e}=this.state),e&&this._transformedSelected&&(this.models.elementEditState.setAxisWithoutChangingView(e.elementId,.5),this.onNextReady(()=>{let t;return t=this.models.elementEditState.elementClosestLegalGeometry(e.elementId),this.models.kimiEditorViewState.enableEditableElementAnimators(),this.models.elementEditState.updateSelectedElementProps({location:t.location}),this.models.elementEditState.saveUndo("transformSelected")})),i.isF((n=this.props).showOverlay)&&n.showOverlay()},this.prototype.pointerCancel=function(){let t;return i.isF((t=this.props).showOverlay)&&t.showOverlay(),this.models.kimiEditorViewState.disableEditableElementAnimators()},this.prototype.selectElement=function(t){return this.models.kimiEditorViewState.selectElementUnderEvent(t)},this.prototype.render=function(){let t,e,i,u,c,h,p,d,f,m,g,y,v,S,b,w,x;return({presenterProps:t,selectedElementProps:e,selectedElementDropInProps:i,editableElementAnimators:u}=this.state),({stretchMode:c}=this),({scale:h,currentSize:p}=e),d=r(h).mul(t.scale),p&&(m=(f=p.mul(d)).min())<(g=2*(y=40))&&(d=d.mul(o(1.5,g/m))),v=d.inv,S=e.dropInId?i.dropIn:{location:0,size:{ps:1}},b=3*s.PI/2,w=s.PI,x=s.PI/2,n(1094)(S&&a({size:S.size,location:S.location,receivePointerEvents:"passToChildren"},a(e,{receivePointerEvents:"passToChildren"},a({on:{pointerDown:this.pointerDown,pointerMove:this.pointerMove,pointerUp:this.pointerUp,pointerCancel:this.pointerCancel,pointerClick:this.selectElement}}),l({stretchMode:c,scale:v,action:this.toggleStretchMode,relativeLocation:"topLeft"}),l({stretchMode:c,scale:v,action:this.toggleStretchMode,relativeLocation:"topCenter"}),l({stretchMode:c,scale:v,action:this.toggleStretchMode,relativeLocation:"topRight"}),l({stretchMode:c,scale:v,action:this.toggleStretchMode,relativeLocation:"centerLeft"}),l({stretchMode:c,scale:v,action:this.toggleStretchMode,relativeLocation:"centerRight"}),l({stretchMode:c,scale:v,action:this.toggleStretchMode,relativeLocation:"bottomLeft"}),l({stretchMode:c,scale:v,action:this.toggleStretchMode,relativeLocation:"bottomCenter"}),l({stretchMode:c,scale:v,action:this.toggleStretchMode,relativeLocation:"bottomRight"}))))}}),i.defClass(class SelectedElementOverlay extends t{},function(t,e,i){this.prototype.render=function(){return n(1095)(u({showOverlay:this.showOverlay,hideOverlay:this.hideOverlay}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["StyleProps","FluxComponent","Math","merge","point","Point","Matrix","max","Element","roundedRectanglePath","rect"],[e,n(1080),n(325).Paths],(t,e,n,r,o,s,a,l,u,c,h)=>{let p;return p=t.overlayStyleProps,i.defClass(class TransformHandle extends e{},function(t,e,p){let d,f,m,g,y,v;this.prototype.name="TransformHandle",this.prototype.hover=function(){return this.setState({hover:!0})},this.prototype.dehover=function(){return this.setState({hover:!1})},this.prototype.preprocessProps=function(t){return t=r(t,{relativeLocation:o(t.relativeLocation)}),p.preprocessProps.call(this,t)},this.prototype.pointerDown=function({target:t,location:e}){let n,i,r,l,u,c,h,p,d,f,m,g,y,v,S;return this.models.kimiEditorViewState.disableEditableElementAnimators(),this._transformedSelected=!1,this._pointerLocationToCenterVector=t.currentSize.cc.sub(e),({relativeLocation:n,stretchMode:i}=this.props),({selectedElementProps:r}=this.models.elementEditState),({elementId:l,size:u,currentSize:c,scale:h,angle:p=0}=r),this._originalScale=o(h),this._originalAngle=p,u instanceof s&&(c=u),d=this.models.elementEditState.getViewElement(l),f=o(1-n.x,1-n.y),this.models.elementEditState.setAxisWithoutChangingView(l,f),m=d.getElementToAbsMatrix(),g=a.scale(c).mul(m),this._elementLocationInAbsSpace=g.transform(f),y=g.transform(n),i&&(v=g.transformXY(n.x,1-n.y),S=g.transformXY(1-n.x,n.y),this._horizontalBaseProjection=v.sub(this._elementLocationInAbsSpace),this._verticalBaseProjection=S.sub(this._elementLocationInAbsSpace),this._horizontalBaseProjectionMagnitude=this._horizontalBaseProjection.magnitude,this._verticalBaseProjectionMagnitude=this._verticalBaseProjection.magnitude),this._baseVector=y.sub(this._elementLocationInAbsSpace),this._baseVectorLength=this._baseVector.magnitude,this._baseVectorAngle=this._baseVector.angle,t.capturePointerEvents()},this.prototype.pointerUp=function(){let t;return this.models.kimiEditorViewState.enableEditableElementAnimators(),this._transformedSelected&&this.onNextReady(()=>{let t;return t=this.models.elementEditState.elementClosestLegalGeometry(this.models.elementEditState.selectedElementId),this.models.kimiEditorViewState.enableEditableElementAnimators(),this.models.elementEditState.updateSelectedElementProps({location:t.location}),this.models.elementEditState.saveUndo("transformSelected")}),i.isF((t=this.props).showOverlay)&&t.showOverlay()},this.getter({stretchMode:function(){return this.props.stretchMode},isVerticalHandle:function(){let t;return null!=(t=this._isVerticalHandle)?t:this._isVerticalHandle=.5===this.props.relativeLocation.x},isHorizontalHandle:function(){let t;return null!=(t=this._isHorizontalHandle)?t:this._isHorizontalHandle=.5===this.props.relativeLocation.y},isCornerHandle:function(){let t;return null!=(t=this._isCornerHandler)?t:this._isCornerHandler=!this.isVerticalHandle&&!this.isHorizontalHandle},elementId:function(){return this.models.elementEditState.selectedElementProps.elementId},stretch:function(){let t,e;return({relativeLocation:t,stretchMode:e}=this.props),e&&(.5===t.x||.5===t.y)}}),this.stateField({previousSnapNotification:null}),this.prototype.setSnapNotification=function(t){return t!==this.previousSnapNotification?(this.models.kimiEditorViewState.instantNotification=t,this.previousSnapNotification=t):void 0},m=[],g=2*n.PI,y=0,v=n.PI/4,(()=>{for(;v>0&&y<g||v<0&&y>g;){let t;t=y,m.push(t),y+=v}})(),d=m,f=[0,.25,.5,1,2,4],this.prototype.pointerMove=function({target:t,location:e}){let r,s,a,u,c,h,p,m,g,y,v,S,b,w,x,P,C,_,E;if(({snapAngle:r=!0}=this.props),u=c=(a=(s=t.getElementToAbsMatrix().transform(e.add(this._pointerLocationToCenterVector))).sub(this._elementLocationInAbsSpace)).magnitude/this._baseVectorLength,this.stretchMode){if(!this._horizontalBaseProjection||!this._verticalBaseProjection)return;u=this.isVerticalHandle?1:a.dot(this._horizontalBaseProjection)/i.pow(this._horizontalBaseProjectionMagnitude,2),c=this.isHorizontalHandle?1:a.dot(this._verticalBaseProjection)/i.pow(this._verticalBaseProjectionMagnitude,2)}else{if(h=this._originalAngle+a.angle-this._baseVectorAngle,h=i.mod(h,2*n.PI),p=!1,r&&(b=S=d,null!=S))for(w=S.length,x=0;x<w;){let t;t=S[x],n.abs(h-t)<n.PI/60&&(p=!0,this.setSnapNotification(`snap: ${i.toString(i.mod(180*t/n.PI|0,360))}`),h=t),x++}p||this.setSnapNotification(null)}if(m=l(.01,this._originalScale.x*u),g=l(.01,this._originalScale.y*c),this.stretchMode){if(y=m/g,f[0]=this._originalScale.aspectRatio,p=!1,C=null,null!=(P=f))for(_=P.length,E=0;E<_;){let t;if(t=P[E],n.abs(y-t)<.05){p=!0,this.setSnapNotification(`snap: ${i.toString(100*t|0)}%`),C=this.isVerticalHandle?g=m/t:this.isHorizontalHandle?m=t*g:m=t*(g=(g+m/t)/2);break}E++}p||this.setSnapNotification(null)}return v=o(m,g),this._transformedSelected=!0,this.models.elementEditState.updateElementProps(this.elementId,this.stretchMode?{scale:v}:{scale:v,angle:h})},this.prototype.pointerCancel=function(){return this.models.kimiEditorViewState.disableEditableElementAnimators()},this.prototype.render=function(){let t,e,n,i,r,o,s,a,l,p;return({bitmapSource:t,scale:e,angle:n,relativeLocation:i,stretchMode:r}=this.props),({hover:o,handlers:s}=this.state),a=40,l=40/6,p=40/3,u("cacheDraw",{on:{mouseIn:this.hover,mouseOut:this.dehover,pointerClick:this.props.action,pointerDown:this.pointerDown,pointerUp:this.pointerUp,pointerMove:this.pointerMove,pointerCancel:this.pointerCancel},opacity:o?.75:1,animators:{opacity:!0},size:40,axis:"centerCenter",scale:e,location:{ps:i},draw:[{radius:100},"#213850","clip",r?{shape:(t,e)=>{let n,r,o,s;return n=-40*i.x,r=-40*i.y,o=80,s=80,c(t,h(n,r,80,80).pad(40/6),40/3),c(t,h(n,r,80,80).pad(40/3),40/6)},outline:"white"}:void 0,{rectangle:({x:t,y:e})=>h(.5*t-i.x*t*2,.5*e-i.y*e*2,2*t,2*e),fill:"white"}]})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","StyleProps","Element","Swatch","TextPalette","TextInputElement","rgbColor","TextElement","TextStyles","ColorPickerStyleProps","TabbedBar","m","ImikimiPalette","ColorPicker"],[e,n(1080),n(1078),n(1099)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f)=>{return i.defClass(class MenuColorPicker extends t{},function(t,m,g){this.subscriptions("colorPickerState.history","colorPickerState.color","viewState.viewState"),this.stateFields({currentTab:"swatches"}),this.propFields({selectedColor:null}),this.prototype.selectColor=function(t){let e;return this._lastSelectedColor=t,this.models.colorPickerState.color=t,i.isF((e=this.props).selectColor)&&e.selectColor(t)},this.prototype.selectColorAndExit=function(t){let e;return this.selectColor(t),i.isF((e=this.props).done)&&e.done()},this.prototype.close=function(){let t;return i.exists(t=this.props)&&t.close(),this.models.colorPickerState.addToHistory(this._lastSelectedColor)},this.prototype.renderHex=function(){let t,i,l;return({color:t}=this.state),({gridSize:i}=this.viewState),l=e.getContrastingColor(t),n("parentWidthChildrenHeight",{padding:i},n(["row","parentWidthChildrenHeight"],"childrenCenterCenter",{childrenMargins:i},r({color:t,selectedColor:this.selectedColor,large:!0,selectColor:this.selectColorAndExit}),n("parentWidthChildrenHeight",{draw:{radius:i/4,outline:o.black.barely},padding:i/2},s("parentWidthChildrenHeight","textCenterCenter",{on:{focus:this.selectAll},value:t.autoRgbaHexString,fontFamily:"monaco",fontSize:24,color:o.black.primary,on:{enter:({target:t})=>this.selectColor(a(t.value))}}))))},this.prototype.renderSwatches=function(){let t,e,s,a;return({selectColorAndExit:t,color:e}=this),({gridSize:s,reducedHeightMode:a}=this.viewState),n({padding:s},["flow","parentWidthChildrenHeight"],l(u.smallText,{color:o.black.secondary,size:a?"childrenSize":"parentWidthChildrenHeight",text:"recent",margin:10}),i.array(this.history.slice().reverse(),n=>r({color:n,selectColor:t,selectedColor:e})),n({size:{h:0}}),a?void 0:l(u.smallText,"parentWidthChildrenHeight",{color:o.black.secondary,text:"swatches",margin:10}),i.array(c.sortedColors,n=>r({color:n,selectColor:t,selectedColor:e})))},this.prototype.render=function(){let t,e,i,r,s,a,l;return({close:t,selectColor:e,fullHeight:i,visible:r}=this),s=!0,n({visible:null==r||r},["column","parentWidthChildrenHeight"],h({buttonSize:this.viewState.heightAdjustedButtonSize,currentTab:this.currentTab,tabChanged:this.setCurrentTab,secondary:!0,tabs:[p({label:"swatches",icon:n(["flow","childrenCenterCenter"],(a=[],l=0,(()=>{for(;l<4;){let t;t=l,a.push(n({margin:2,size:{ps:.3},draw:o.black.secondary})),l++}})(),a)),enabled:!0,iconScale:1.1}),p({label:"sliders",enabled:!0,icon:"sliders",iconScale:.7}),p({icon:"hashtag",label:"hex",iconScale:.7,enabled:!0})]}),n("parentWidthChildrenHeight",{draw:d.selectedTabColor},(()=>{switch(this.currentTab){case"swatches":return this.renderSwatches();case"sliders":return f({selectColor:e,selectColorAndExit:this.props.done&&this.selectColorAndExit});case"hex":return this.renderHex()}})()))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(832)).addModules({ColorPicker:n(1100),ColorPicker1d:n(1104),ColorPreview:n(1103),StandardImport:n(1101)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ReschedulableTimer","Element","TextPalette","ColorPickerStyleProps","ColorPicker1d"],[e,n(1101),n(1043),{ColorPreview:n(1103),ColorPicker1d:n(1104)}],(t,e,n,r,o,s)=>{let a;return a=[["red","green","blue"],["saturation","lightness","alpha"]],i.defClass(class ColorPicker extends t{},function(t,l,u){this.subscriptions("colorPickerState.color"),this.prototype.selectCurrentColor=function(){return this.props.selectColor(this.models.colorPickerState.color)},this.prototype.preprocessState=function(t){let n,i;return({color:n}=t),null!=(i=this.timer)||(this.timer=new e),this.timer.timeout(250,this.selectCurrentColor),u.preprocessState.apply(this,arguments)},this.prototype.render=function(){let t;return({color:t}=this.state),n("column","cacheDraw",{size:{ww:1,hch:1},padding:10,childrenMargins:5},n({size:{ww:1,h:30},draw:[{radius:10,outline:r.black.barely,colors:o.backgroundGradient},t],cursor:this.props.selectColorAndExit&&"pointer",on:{pointerClick:()=>this.props.selectColorAndExit(this.color)}}),n(["column","parentWidthChildrenHeight"],{draw:[{radius:10},"clip","children"],childrenMargins:5},s({channel:"h",label:"hue"}),n(["row","parentWidthChildrenHeight"],{childrenMargins:5},i.array(a,t=>n(["clip","column","parentWidthChildrenHeight"],i.array(t,t=>s({channel:t.slice(0,1),label:t})))))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(1102))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(1080).mergeWithSelf(n(1082),n(1078)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","rgbColor","StyleProps","Element","TextInputElement","TabButton"],[e,n(1101)],(t,e,n,r,o,s)=>{return i.defClass(class ColorPreview extends t{},function(t,i,a){this.subscriptions("colorPickerState.color"),this.propFields("selectCurrentColor"),this.prototype.selectAll=function({target:t}){return t.selectAll()},this.prototype.setColor=function(t){let n;return(n=e(t)).parseError?void 0:this.models.colorPickerState.setColor(n)},this.prototype.render=function(){let t,e,i,a;return a=this,t=this.color,e=this.selectCurrentColor,i=n.getContrastingColor(t),r(["row","parentWidthChildrenHeight"],{margin:10},r("column","cacheDraw",{margin:10,draw:[{radius:5},t,"clip"]},o({on:{focus:this.selectAll},padding:10,size:{ww:1,hh:1},value:t.getHexString(),fontFamily:"monaco",fontSize:24,align:.5,color:i,on:{enter:({target:t})=>this.setColor(t.value)}})),s({size:{ww:1,h:50},text:"okay",action:e,icon:"checkmark"}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Math","RectangleElement","FillElement","OutlineElement","StyleProps","Element","ColorPickerStyleProps","TextElement","TextStyles"],[e,n(1101)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class ColorPicker1d extends t{},function(t,h,p){this.subscriptions("colorPickerState.color","viewState.viewState",{value:{key:function({channel:t}){return t},model:"colorPickerState"}}),this.propFields("channel","label"),this.stateFields({currentWidth:void 0}),this.getter({handlers:function(){let t;return null!=(t=this._handlers)?t:this._handlers={ready:t=>this.currentWidth=t.target.currentSize.x,pointerDown:t=>this._capturedPointerEvents=!1,pointerUp:t=>this.setPosFromPixels(t.location.x),pointerMove:t=>{let n;return e.abs(t.totalDelta.x)>3&&(i.exists(n=t.target)&&i.isF(n.capturePointerEvents)&&n.capturePointerEvents(),this._capturedPointerEvents=!0),this._capturedPointerEvents?this.setPosFromPixels(t.location.x):void 0}}}}),this.getter({colors:function(){let t,e,n,i,r,o;return n=this,t=this.channel,e=this.color,"h"===t?(i=[],r=0,o=1/6,(()=>{for(;o>0&&r<1||o<0&&r>1;){let t;t=r,i.push(e.withHue(t)),r+=o}})(),i):[e.withChannel(t,0),e.withChannel(t,1)]}}),this.prototype.setPosFromPixels=function(t){return this.models.colorPickerState.setChannel(this.channel,t/this.currentWidth)},this.prototype.renderHandle=function(t,e){return n({key:`${i.toString(this.props.label)} handle`,color:e,radius:100,size:20,axis:"centerCenter",location:{ww:t,yh:.5},animators:{location:{duration:.1}}},r(),o(s.getColoredHandleOutlineProps(e)))},this.prototype.render=function(){let t,e,n,r,o,h,p,d,f,m,g,y;return y=this,t=this.channel,e=this.label,n=this.value,r=this.color,o=this.colors,p=(h=this.viewState).heightAdjustedButtonSize,d=o.length>2?o[o.length/2|0]:([f,m]=o,f.interpolate(m,.5)),g=`ColorPicker1D_${i.toString(t)}_`,a({on:this.handlers,size:{ww:1,h:p}},"pointerCursor",{draw:[{fill:{colors:l.backgroundGradient}},{fill:{to:"topRight",colors:this.colors}}]},this.renderHandle(n,r),u(c.mediumText,{text:e,size:{ps:1},padding:{h:4},align:"centerCenter",color:s.getContrastingColor(d),animators:{color:{duration:.1}}}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","bound","Math","Element","ImikimiStyles","TabButton","Slider"],[e,n(1080),n(1106)],(t,e,n,r,o,s,a)=>{let l,u,c;return l=-2,u=2,c=4,i.defClass(class Zoom extends t{},function(t,l,u){this.subscriptions("kimiEditorViewState.presenterProps","viewState.viewState"),this.prototype.hoverTrue=function(){return this.setState({hover:!0})},this.prototype.hoverFalse=function(){return this.setState({hover:!1})},this.prototype.update=function(t){return this.models.kimiEditorViewState.presenterScale=this.models.kimiEditorViewState.defaultScale*i.pow(2,4*t-2)},this.prototype.resetZoom=function(){return this.models.kimiEditorViewState.resetView(!0)},this.getter({zoomPos:function(){return(e(-2,n.log2(this.presenterProps.scale/this.models.kimiEditorViewState.defaultScale),2)- -2)/4}}),this.prototype.render=function(){let t,e,n,i,l,u,c;return({presenterProps:t,hover:e}=this.state),({gridSize:n,buttonSize:i,safePadding:l}=this.viewState),({right:u}=l),r((c=u>0)?"bottomLeft":"bottomRight",{inFlow:!1,cacheDraw:!0,size:{h:i,w:12*n},padding:{right:n/2},on:{mouseIn:this.hoverTrue,mouseOut:this.hoverFalse},draw:{rectangle:{radius:c?{tr:n/2}:{tl:n/2}},color:"white",shadow:o.tinyShadow}},r(["row","childrenSize"],{childrenMargins:n/2},s({icon:"search",size:i,action:this.resetZoom}),a({value:this.zoomPos,update:this.update})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(833)).addModules({BitmapPositioning:n(1107),BlurPropEditor:n(1109),BlurSlider:n(1111),ChildPropEditorWrapper:n(1110),ColorOptions:n(1115),CompositeOptions:n(1116),DropInPropEditor:n(1118),FillPropEditor:n(1119),GradientHandle:n(1120),LabeledPropEditor:n(1113),LabeledSlider:n(1112),OptionButtons:n(1117),OutlinePropEditor:n(1121),PreviewGenericHandle:n(1108),ShadowHandle:n(1122),ShadowPropEditor:n(1123),ShapeChildrenEditor:n(1124),ShapePicker:n(1125),ShapePreview:n(1126),ShapePropEditor:n(1127),Slider:n(1114)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","isPoint","Element","point","TextPalette"],[e,n(1102)],(t,e,r,o,s,a)=>{return i.defClass(class BitmapPositioning extends t{},function(t,i,l){this.prototype.updateMovingPoint=function(t){let e,n,i;return({childOptions:e,part:n}=this.props),({id:i}=e),this.models.shapeEditorState.updateChild(i,{location:{ww:t.x,hh:t.y}})},this.prototype.preprocessProps=function(t){let n,i,o;return({childOptions:n}=t),({color:i,location:o}=n),e(l.preprocessProps.apply(this,arguments),{color:i,position:r(o)?{xw:o.x,yh:o.y}:o||{ps:.5}})},this.prototype.render=function(){let t,e,i;return({position:t,color:e,childOptions:i}=this.props),o({receivePointerEvents:"passToChildren",size:{ps:1}},n(1108)({minValue:s(0),maxValue:s(1),location:t,updateMovingPoint:this.updateMovingPoint,drawOrder:["circle",{outline:{lineWidth:3,color:a.white.primary}},{outline:{color:a.black.secondary}}]}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","point","point0","point1","Element"],[e,n(1102)],(t,e,n,r,o)=>{return i.defClass(class PreviewGenericHandle extends t{},function(t,i,s){this.subscriptions("viewState.buttonSize"),this.prototype.posFromEvent=function({parentLocation:t,target:i}){let o,s;return({minValue:o,maxValue:s}=this.props),o=e(o||n),s=e(s||r),t.div(i.parent.currentSize).bound(o,s)},this.prototype.pointerMove=function(t){return t.target.capturePointerEvents(),this.props.updateMovingPoint(this.posFromEvent(t))},this.prototype.render=function(){let t,e,n;return({location:t,children:e,drawOrder:n}=this.props),o({size:this.buttonSize,axis:.5,padding:this.buttonSize/8,animators:{opacity:{voidValue:0}},location:t,drawOrder:n,on:{pointerDown:this.pointerMove,pointerMove:this.pointerMove}},e)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","BlurElement"],[e,n(1102)],(t,e,r)=>{return i.defClass(class BlurPropEditor extends t{},function(t,i,o){this.prototype.render=function(){return n(1110)(this.props,{preview:e({stage:!0,drawOrder:{fill:"#aaa"}},r({radius:2}))},n(1111)(this.props.childOptions))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ButtonWrapper","TextElement","Icons","Math","TextPalette","TextStyles","TabButton","rect"],[e,n(1102)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class ChildPropEditorWrapper extends t{},function(t,i,h){this.subscriptions("viewState.viewState"),this.getter({childId:function(){return this.props.childOptions.id}}),this.prototype.toggleExpanded=function(){return this.props.toggleChildOpen(this.childId)},this.prototype.removeChild=function(){return this.models.shapeEditorState.removeChild(this.childId)},this.prototype.moveToFront=function(){return this.models.shapeEditorState.moveToFront(this.childId)},this.prototype.moveToBack=function(){return this.models.shapeEditorState.moveToBack(this.childId)},this.prototype.render=function(){let t,i,h,p,d,f,m,g,y,v;return y=this.viewState,t=y.gridSize,i=y.buttonSize,h=(v=this.props).open,p=v.isFirstChild,d=v.isLastChild,f=v.childId,m=v.preview,g=v.childOptions,e("column",{size:{ww:1,hch:1},animators:{size:{voidValue:{ww:1,h:0}}},draw:{rectangle:{area:({w:e,h:n})=>c(-t/2,0,e+t,n),radius:.625*t},clip:!0,outline:{color:"#eee",lineWidth:2}}},e("row",{size:{ww:1,h:i},padding:{h:-t/2}},n({size:{ps:1},action:this.toggleExpanded},e(["row","childrenCenterLeft"],{childrenMargins:t,padding:{left:t},size:{ww:1,h:i}},r(o.triangleRight,"childrenSize","centerCenter",{angle:h?s.PI/2:0,animators:"angle",color:a.black.secondary}),e({size:t},m),r(l.mediumText,"childrenSize",{text:g.type,color:a.black.secondary}))),!d&&u({key:"move to last",icon:"angleDoubleUp",size:i,action:this.moveToFront}),!p&&u({key:"move to first",icon:"angleDoubleDown",size:i,action:this.moveToBack}),u({key:"trash",icon:"trash",size:i,action:this.removeChild})),e({padding:{h:t/2,bottom:t/2},size:h?{ww:1,hch:1}:{ww:1,h:0},clip:!h,animators:"size clip"},e("column",{size:{ww:1,hch:1}},this.props.children)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent"],[e,n(1102)],t=>{return i.defClass(class BlurSlider extends t{},function(t,e,i){this.prototype.render=function(){return n(1112)(this.props,{label:"blur",propName:"radius",defaultValue:0,minValue:0,maxValue:20})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette"],[e,n(1102)],(t,e)=>{return i.defClass(class LabeledSlider extends t{},function(t,i,r){this.prototype.updateProp=function(t){let e,n,i;return e=(i=this.props).propName,(n=i.update)({[e]:t})},this.prototype.render=function(){let t,i,r;return t=(r=this.props).label,i=r.propName,n(1113)({label:null!=t?t:i},n(1114)(this.props,i&&{value:this.props[i],update:this.updateProp},{color:e.black.secondary}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","StyleProps"],[e,n(1102)],(t,e,n,r)=>{return i.defClass(class LabeledPropEditor extends t{},function(t,i,o){this.subscriptions("viewState.buttonSize"),this.prototype.render=function(){return e({size:{ww:1,h:this.buttonSize}},"row","childrenCenterLeft",n(r.menuItemLabelText,{text:this.props.label}),this.props.children)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","bound","Math","rect","Element","TextPalette"],[e,n(1102)],(t,e,n,r,o,s,a)=>{return i.defClass(class Slider extends t{},function(t,i,l){let u,c,h,p,d,f;this.subscriptions("viewState.buttonSize"),this.stateFields({tracking:!1}),this.prototype.preprocessProps=function(t){let i,r,o,s,a,u;return e(l.preprocessProps.apply(this,arguments),{minValue:i=t.minValue||0,maxValue:r=t.maxValue||1,range:o=r-i,value:s=n(i,null!=(u=t.value)?u:t.defaultValue,r),pos:a=(s-i)/o,fillProps:t.fillProps||{color:"black"}})},this.prototype.setPos=function(t){let e,i,r,o,s;return e=(s=this.props).range,i=s.minValue,r=s.maxValue,(o=s.update)?o(n(i,t*e+i,r)):void 0},this.prototype.pointerDown=function(){return this._movedOutsideDeadZone=!1},this.prototype.pointerMove=function({totalDelta:t,location:e,target:n}){return r.abs(t.x)>3||this._movedOutsideDeadZone?(this._movedOutsideDeadZone||(n.capturePointerEvents(),this._movedOutsideDeadZone=!0),this.tracking=!0,this.setPos(e.x/n.currentSize.w)):void 0},this.prototype.pointerClick=function(t){return this.pointerMove(t),this.tracking=!1},u=function(t,{x:e,y:n,w:i,h:r}){return t.moveTo(e+0,n+r),t.lineTo(e+i,n+r),t.lineTo(e+i,n+0),t.closePath()},c=function(t,{x:e,y:n,w:i,h:r}){return t.moveTo(e+i/2,n+0),t.lineTo(e+i,n+r),t.lineTo(e+0,n+r),t.closePath()},h=9,p=15,d=function({w:t,h:e}){return o(0,(e-15)/2,t,15)},f=function({w:t,h:e},{pos:n}){let i;return i=9,o(n*t-9,2+(e+15)/2,18,9)},this.prototype.render=function(){let t,e,n;return t=(n=this.props).pos,e=n.color,s("pointerCursor",{size:{ww:1,h:this.buttonSize},key:"slider",on:{pointerDown:this.pointerDown,pointerClick:this.pointerClick,pointerMove:this.pointerMove,pointerUp:this.clearTracking,pointerCancel:this.clearTracking},animators:this.tracking?void 0:"draw",draw:[{shape:{path:u,area:d}},e||a.black.secondary,{shape:{pos:t,area:f,path:c}},e||a.black.secondary]})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","GradientFillStyle","GradientColorsWidget","ButtonWrapper","Element","ImikimiStyles","TabButton"],[e,n(1102),n(1078)],(t,e,r,o,s,a,l,u)=>{return i.defClass(class ColorOptions extends t{},function(t,c,h){this.subscriptions("viewState.buttonSize"),this.prototype.selectColor=function(){let t;return this.props.showColorPicker(i.exists(t=this.props)&&t.color,t=>{let e,n;return({update:e,shadow:n}=this.props),e({color:t})})},this.prototype.convertToGradient=function(){let t,n;return t=!0,this.props.showColorPicker(i.exists(n=this.props)&&n.color,n=>{let i,r;return({update:i,color:r}=this.props),i(e({colors:[r,n]},t?{from:"topCenter",to:"bottomCenter"}:void 0)),t=!1})},this.prototype.render=function(){let t,i,c,h,p,d;return({color:t,colors:i,noGradient:c}=this.props),({buttonSize:h}=this),i||t||(t="white"),p=new r("topLeft","topRight",i),d=e(this.props,{colors:o.normalizeColors(p),gradientFillStyle:p}),n(1113)({label:"color"},i?o(d):[s({size:h,action:this.selectColor},a("centerCenter",{size:20,drawOrder:{color:t,shadow:l.tinyShadow}})),c?void 0:u({icon:"circlePlus",size:h,action:this.convertToGradient})])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","rect"],[e,n(1102)],(t,e,r)=>{return i.defClass(class CompositeOptions extends t{},function(t,o,s){this.subscriptions("viewState.buttonSize"),this.prototype.render=function(){return e({size:{ww:1,hch:1}},"column",n(1112)(this.props,{propName:"opacity",defaultValue:1,maxValue:1}),n(1117)({buttons:i.object(["normal","under","inside","add"],t=>{let n;return n=(()=>{switch(t){case"inside":return"sourceTopInTarget";case"under":return"targetTopUnion";default:return t}})(),{selected:this.props.compositeMode===n,customIcon:e({size:{hh:.5,wh:.5},draw:[{fill:"#ddd",rectangle:({x:t})=>{let e;return r(0,0,e=2*t/3,e)}},{fill:{color:"#777",compositeMode:n},rectangle:({x:t})=>{let e,n;return r(e=1*t/3,e,n=2*t/3,n)}}]}),action:()=>this.props.update({compositeMode:n})}})}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ImikimiStyles","TabButton","getLowerCaseCodeWords"],[e,n(1102)],(t,e,n,r,o)=>{return i.defClass(class OptionButtons extends t{},function(t,s,a){this.prototype.render=function(){return e({size:{h:n.touchButtonSize,ww:1}},["row","childrenCenterCenter"],i.array(this.props.buttons,(t,e)=>r({text:o(e).join(" ")},t)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","zoPickImage","TextElement","Icons","TextPalette","BitmapElement","ButtonWrapper","TextStyles","Math"],[e,n(1102)],(t,e,r,o,s,a,l,u,c)=>{return i.defClass(class DropInPropEditor extends t{},function(t,h,p){this.subscriptions("viewState.viewState"),this.getter({update:function(){return this.props.childOptions.update}}),this.prototype.clearBitmap=function(){return this.update({bitmap:null})},this.prototype.setBitmap=function(){return e().then(({bitmap:t,file:e})=>{for(;t.size.max()>2048;)t=t.mipmap;return this.update({bitmap:t})})},this.prototype.render=function(){let t,e,h,p;return({gridSize:t,buttonSize:e}=this.viewState),({childOptions:h}=this.props),({bitmap:p}=h),n(1110)(this.props,{preview:r(o.droplet,{fontSize:t,color:s.black.secondary},{size:{ps:1},align:.5})},p&&a({bitmap:p,size:{ww:1,hw:1/3},layout:"fit"}),l({size:{ww:1,h:e},action:this.setBitmap},r(u.mediumText,"parentSize","textCenterCenter",{text:`${i.toString(p?"change":"select")} sample photo`,color:s.black.secondary})),p?[l({size:{ww:1,h:e},action:this.clearBitmap},r(u.mediumText,"parentSize","textCenterCenter",{text:"clear sample photo",color:s.black.secondary})),n(1112)(h,{label:"scale",propName:"scale",defaultValue:1.5,minValue:.5,maxValue:3}),n(1112)(h,{label:"angle",propName:"angle",defaultValue:0,minValue:-c.PI,maxValue:c.PI})]:void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","ImikimiStyles"],[e,n(1102)],(t,e,r)=>{return i.defClass(class FillPropEditor extends t{},function(t,i,o){this.prototype.render=function(){let t;return t=this.props.childOptions,n(1110)(this.props,{preview:{draw:{fill:e(t,{shadow:r.tinyShadow})}}},n(1115)(t),n(1116)(t))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","toObject","isPlainObject","peek","merge","isPoint","PointLayout","point1","StyleProps"],[e,n(1102)],(t,e,r,o,s,a,l,u,c)=>{return i.defClass(class GradientHandle extends t{},function(t,i,h){let p;this.prototype.updateMovingPoint=function(t){let n,i,r;return({childOptions:n,part:i}=this.props),({id:r}=n),this.models.shapeEditorState.updateChild(r,e(i,{ww:t.x,hh:t.y}))},p={from:"topCenter",to:"bottomCenter"},this.prototype.preprocessProps=function(t){let e,n,i,c,d;return({part:e,childOptions:n}=t),({colors:i}=n),i=r(i)?{from:i["0.000"],to:i["1.000"]}:((c={}).to=o(i),c.from=i[0],c),s(h.preprocessProps.apply(this,arguments),{color:i[e],position:a(d=n[e]||p[e])?d:new l(d).layout(u)})},this.prototype.render=function(){let t,e,i,r;return({position:t,color:e}=this.props),({x:i,y:r}=t),n(1108)({location:{ww:i,hh:r},updateMovingPoint:this.updateMovingPoint,drawOrder:["circle",{padding:10},{color:e},{outline:c.getColoredHandleOutlineProps(e)}]})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","Math","ImikimiStyles","Element","TextPalette","rect"],[e,n(1102)],(t,e,r,o,s,a,l)=>{return i.defClass(class OutlinePropEditor extends t{},function(t,u,c){this.prototype.render=function(){let t,u;return t=this.props.childOptions,n(1110)(this.props,{preview:{draw:{fill:"#ddd",outline:e(t,{lineWidth:r.sqrt(null!=(u=i.exists(t)&&t.lineWidth)?u:1),shadow:o.tinyShadow})}}},n(1115)(t),n(1112)(t,{label:"width",maxValue:50,minValue:.1,defaultValue:2,propName:"lineWidth"}),n(1116)(t),n(1117)({buttons:i.object(["round","miter","bevel"],e=>({selected:t.lineJoin===e,customIcon:s({size:{hh:.5,wh:.5},draw:["#ddd","clip",{rectangle:({x:t})=>l(t/2,t/2,t,t),outline:{color:a.black.secondary,lineWidth:15,lineJoin:e}}]}),action:()=>t.update({lineJoin:e})}))}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","isPoint","Element","point","rgbColor"],[e,n(1102)],(t,e,r,o,s,a)=>{return i.defClass(class ShadowHandle extends t{},function(t,i,l){this.prototype.updateMovingPoint=function(t){let e,n,i;return({childOptions:e,part:n}=this.props),({id:i}=e),this.models.shapeEditorState.updateChild(i,{location:{ww:t.x,hh:t.y}})},this.prototype.preprocessProps=function(t){let n,i,o;return({childOptions:n}=t),({color:i,location:o}=n),e(l.preprocessProps.apply(this,arguments),{color:i,position:r(o)?{xw:o.x,yh:o.y}:o})},this.prototype.render=function(){let t,e,i;return({position:t,color:e,childOptions:i}=this.props),o({receivePointerEvents:"passToChildren",location:{ps:.5},size:{ps:1}},n(1108)({minValue:s(-.5),maxValue:s(.5),location:t,updateMovingPoint:this.updateMovingPoint,drawOrder:{padding:10,color:a(e).withAlpha(1),shadow:{offset:4,color:"#0004"}}}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent"],[e,n(1102)],t=>{return i.defClass(class ShadowPropEditor extends t{},function(t,e,i){this.prototype.render=function(){let t;return t=this.props.childOptions,n(1110)(this.props,{preview:{draw:{color:t.color||"#0007",shadow:{color:"#0004",offset:4}}}},n(1111)(t),n(1115)(t,{noGradient:!0}),n(1116)(t))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ImikimiStyles","FluxComponent","Element","TextPalette","TextElement","Icons","OptionButtons","BlurElement","FillPropEditor","ShadowPropEditor","OutlinePropEditor","BlurPropEditor","DropInPropEditor","ErrorWithInfo","merge"],[e,n(1102),n(1043),{OutlinePropEditor:n(1121),FillPropEditor:n(1119),ShadowPropEditor:n(1123),BlurPropEditor:n(1109),DropInPropEditor:n(1118),OptionButtons:n(1117)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m)=>{let g;return g=t.touchButtonSize,i.defClass(class ShapeChildrenEditor extends e{},function(t,e,i){this.subscriptions("viewState.viewState"),this.prototype.renderPlusIcon=function(){return n({size:.25*g,axis:"centerCenter",location:"centerLeft",draw:["circle","white",{outline:r.black.barely}]},o(s.plus,"parentSize","textCenterCenter",{fontWeight:"bold",fontSize:16,color:r.black.secondary}))},this.prototype.renderAddActions=function(){let t,e;return t=this.viewState.gridSize,e="#777",a({buttons:{fill:{customIcon:n({size:.5*g,draw:"#777"},this.renderPlusIcon()),action:this.models.shapeEditorState.addFill},outline:{customIcon:n({size:.5*g,draw:{outline:"#777"}},this.renderPlusIcon()),action:this.models.shapeEditorState.addOutline},shadow:{customIcon:n({size:.5*g,draw:{color:"#ddd",shadow:{offset:3,blur:0}}},this.renderPlusIcon()),action:this.models.shapeEditorState.addShadow},blur:{customIcon:n({cacheDraw:!0,size:.5*g,draw:"#777"},l({radius:5}),this.renderPlusIcon()),action:this.models.shapeEditorState.addBlur}}})},this.prototype.render=function(){let t,e,i,r,o,s,a,l,g;return t=this.viewState.gridSize,o=this.props,e=o.shapeChildren,i=o.openChildren,r=o.showColorPicker,n("column","parentWidthChildrenHeight",{key:"shapeChildrenEditor",childrenMargins:t/4},(a=[],null!=(s=e)&&(l=s.length-1,(()=>{for(;l>=0;){let t,n,o,y;t=s[l],n=l,a.push((o=t.id,(y=(()=>{switch(t.type.toLowerCase()){case"fill":return u;case"shadow":return c;case"outline":return h;case"blur":return p;case"drop-in":return d;default:return(()=>{throw new f("old ChildOptions",{childOptions:t})})()}})())({key:o,showColorPicker:r,toggleChildOpen:this.props.toggleChildOpen,isFirstChild:0===n,isLastChild:n===e.length-1,open:i[o],childOptions:m({showColorPicker:r,update:t=>this.models.shapeEditorState.updateChild(o,t)},t)}))),g=l--}})()),a),this.renderAddActions())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","present","ButtonWrapper","TextElement","MenuSectionGroup","MenuSection","Element"],[e,n(1102)],(t,e,n,r,o,s,a)=>{let l;return l=i.defClass(class PickShapeButton extends t{},function(t,i,o){this.prototype.pickShape=function(){return this.props.pickShape(this.props.shape)},this.prototype.render=function(){let t,i,o;return({shape:t,textProps:i,currentShape:o}=this.props),e(t)||(t="-"),n({size:40,selected:o===t,action:this.pickShape},r(i,{fontFamily:"Arial Unicode MS",text:t+"",fontSize:30,align:"centerCenter"}))}}),i.defClass(class ShapePicker extends t{},function(t,e,n){let r;r=function(t){let e,n,r;return e={shapes:n={},categories:r={}},i.array(t,(t,i)=>{let o,s,a;return n[i]=o=t.replace(/\n+/g,"").split(""),s=o[0],a=r[i]={name:i,list:o,shape:o[0]},e.defaultCategory||(e.defaultCategory=s)}),e},this.shapes=r({shapes:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"}),this.stateFields({categoryName:this.shapes.defaultCategory}),this.getter({category:function(){return t.shapes.categories[this.categoryName]}}),this.prototype.pickShape=function(t){let e;return i.isF((e=this.props).selectShape)&&e.selectShape(t+""),this.models.kimiEditorViewState.hideDialog()},this.prototype.render=function(){let e;return e=this.props.currentShape,e=i.exists(e)&&e.slice(0,1),o(i.array(t.shapes.categories,t=>s(a("parentWidthChildrenHeight","flow",i.array(t.list,t=>l({currentShape:e,shape:t,pickShape:this.pickShape}))))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ShadowHandle","BitmapPositioning","GradientHandle"],[e,n(1102),{GradientHandle:n(1120),BitmapPositioning:n(1107),ShadowHandle:n(1122)}],(t,e,n,r,o)=>{return i.defClass(class ShapePreview extends t{},function(t,s,a){this.prototype.render=function(){let t,s,a;return t=(a=this.props).shapeOptions,s=a.openChildren,e("centerCenter",{size:{cs:1,max:{ps:1}},receivePointerEvents:"passToChildren"},e({size:{cs:1,max:{ps:1}},cacheDraw:!0},this.models.shapeEditorState.generateShapeElements(t,"artReact",{rootProps:{scale:(t,e)=>3*t.div(e).min()/4}})),i.array(t.children,t=>[(()=>{switch(t.type){case"shadow":return n({childOptions:t});case"drop-in":return t.bitmap&&r({childOptions:t})}})(),t.colors?i.array(["from","to"],e=>o({part:e,childOptions:t})):void 0],t=>s[t.id]))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","BlurElement"],[e,n(1102)],(t,e,r)=>{return i.defClass(class ShapePropEditor extends t{},function(t,i,o){this.prototype.render=function(){return n(1110)(this.props,{preview:e({stage:!0,drawOrder:{fill:"#aaa"}},r({radius:2}))},n(1111)(this.props.childOptions))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","point","Element","KimiViewer","Zoom"],[e,n(1080),n(1082)],(t,e,r,o,s)=>{return n(1092),n(1129),n(1130),i.defClass(class KimiEditor extends t{},function(t,n,a){this.subscriptions("kimiEditorViewState.activeDialogs","kimiEditorViewState.activePremiumPreview","openFile.isCreator","viewState.viewState","kimiEditorNavState.overlay","currentSession.currentUser"),this.prototype.componentWillMount=function(){return this.onNextReady(()=>this.refs.KimiEditor.element.focus()),a.componentWillMount.apply(this,arguments)},this.prototype.cancelDialog=function(){return this.models.kimiEditorViewState.cancelDialog()},this.prototype.keyPress=function(t){let n,i,r,o,s,a,l;return({key:n,ctrlKey:i,metaKey:r,altKey:o,shiftKey:s}=t.props),({elementEditState:a,history:l}=this.models),i||r?(()=>{switch(n){case"Z":return l.redo();case"z":return l.undo()}})():(()=>{switch(n){case"Enter":return this.models.kimiEditorViewState.editSelectedElement();case"Backspace":return a.trashSelected();case"ArrowLeft":return a.moveSelected(e(-1,0));case"ArrowRight":return a.moveSelected(e(1,0));case"ArrowUp":return a.moveSelected(e(0,-1));case"ArrowDown":return a.moveSelected(e(0,1))}})()},this.prototype.render=function(){let t,e,n,a,l;return l=this,t=this.activeDialogs,e=this.activePremiumPreview,n=this.isCreator,r({on:0===t.length?{keyPress:this.keyPress}:void 0,key:"KimiEditor",draw:"#f0f0f0"},o({ready:this.props.ready}),s(),i.exists(e)&&e.component(e.props),i.array(t,({component:e,props:n},i)=>(i===t.length-1&&a.push(r({on:{pointerClick:this.cancelDialog}})),e(n)),null,a=[]))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(831)).addModules({StandardImport:n(1102)}),n(1099),n(1106)},function(t,e,n){(t.exports=n(835)).addModules({Add:n(1131),AddDropIn:n(1133),AddShape:n(1134),Exit:n(1135),Layers:n(1136),Shape:n(1137),StandardImport:n(1132),Text:n(1138)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","PopOver","Element","MenuButton"],[e,n(1132)],(t,e,n,r)=>{return i.defClass(class AddOverlay extends t{},function(t,i,o){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,o;return({currentUser:t}=this.state),({fullScreen:i,gridSize:o}=this.state.viewState),e({title:"Add Element",close:this.props.close},n({size:{ww:1,hch:1},padding:o,childrenLayout:"column"},r({icon:"capitalA",text:"add Text",action:this.models.kimiEditorNavState.showText}),r({icon:"box",text:"add Shape",action:this.models.kimiEditorNavState.showAddShape}),r({icon:"image",text:"add Photo",action:this.models.kimiEditorNavState.addBitmap}),r({icon:"droplet",text:"add Drop-in",action:this.models.kimiEditorNavState.showAddDropIn})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(1080).mergeWithSelf(n(1082),n(1078)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","timeout","PopOver","Element","ButtonWrapper","TextElement","TextStyles","lowerCase","TextPalette"],[e,n(1132)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class AddDropIn extends t{},function(t,c,h){this.subscriptions("viewState.viewState"),this.prototype.addDropIn=function(t){return this.models.shapeEditorState.getElementEditState(this.getDropInShapeProps(t)).then(this.models.elementEditState.addTopElement),e(100,this.models.kimiEditorNavState.hideOverlay)},this.prototype.dropInShapes=["square","circle","soft circle"],this.prototype.getDropInShapeProps=function(t){return(()=>{switch(null!=t?t:"square"){case"square":return{fontFamily:"Arial Unicode MS",text:"",children:[{type:"fill",color:"#ddd"},{type:"drop-in"}]};case"circle":return{fontFamily:"Arial Unicode MS",text:"",children:[{type:"fill",color:"#ddd"},{type:"drop-in"}]};case"soft circle":return{fontFamily:"Arial Unicode MS",text:"",children:[{type:"fill",color:"#ddd"},{type:"blur",radius:10},{type:"drop-in"}]}}})()},this.prototype.renderDropIn=function(t){return this.models.shapeEditorState.generateShapeElements(this.getDropInShapeProps(t))},this.prototype.render=function(){let t,e,c;return({currentUser:t}=this.state),({fullScreen:e,gridSize:c}=this.state.viewState),n({title:"Add Drop In",close:this.props.close},r(["row","parentWidthChildrenHeight"],{padding:c},i.array(this.dropInShapes,t=>o({margin:{bottom:c},size:{w:25*c/4,hch:1},action:()=>this.addDropIn(t)},r(["column","childrenCenterCenter"],"parentWidthChildrenHeight",{padding:c/2,childrenMargins:c/2},r("parentWidthSquare",{stage:!0,cacheDraw:!0},r({size:{cs:1}},"scaleToFit",this.renderDropIn(t))),s(a.tinyText,"childrenSize",{text:l(t),color:u.black.secondary}))))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","timeout","PopOver","ShapePicker"],[e,n(1132),n(1106)],(t,e,n,r,o)=>{return i.defClass(class AddShapeOverlay extends t{},function(t,i,s){this.subscriptions("viewState.gridSize"),this.prototype.getInitialState=function(){return this.models.shapeEditorState.resetWithShapeOptions(),s.getInitialState.apply(this,arguments)},this.prototype.selectShape=function(t){return this.models.shapeEditorState.getElementEditState(e(this.models.shapeEditorState.shapeOptions,{text:t})).then(this.models.elementEditState.addTopElement),n(100,this.models.kimiEditorNavState.hideOverlay)},this.prototype.render=function(){return r({title:"Add Shape",close:this.props.close},o({selectShape:this.selectShape}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","PopOver","Element","TextElement","TextStyles","TextPalette","MenuButton"],[e,n(1132)],(t,e,n,r,o,s,a)=>{return i.defClass(class SaveOverlay extends t{},function(t,i,l){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,i,l;return({currentUser:t}=this.state),({fullScreen:i,gridSize:l}=this.state.viewState),e({title:"Exit",close:this.props.close},n(["column","parentWidthChildrenHeight"],{padding:l,childrenMargins:l},r(o.mediumText,{paragraphLeading:2,text:"You have unsaved changes.\nDo you want to discard them?",color:s.black.primary}),a({icon:"checkmark",action:this.models.kimiEditorNavState.forceExit,text:"Exit without saving"})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["createWithPostCreate","FluxComponent","BitmapElement","point","Element","ImikimiPalette","TextElement","TextStyles","TextPalette","ButtonWrapper","Icons","TabButton","PopOver","MenuSection","pluralize","MenuButton"],[e,n(1132)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{let y,v;return y=t(y=i.defClass(class DroppedInElementImage extends e{},function(t,e,i){this.subscriptions("element"),this.prototype.render=function(){let t,e,i;return({element:t}=this.state),t&&({flipped:e,bitmap:i}=t),n({axis:"centerCenter",location:"centerCenter",scale:e?r(-1,1):1,layout:"fit",bitmap:i})}})),v=t(v=i.defClass(class LayerLine extends e{},function(t,e,i){this.subscriptions("element"),this.propFields({elementId:null,selectedElementId:null}),this.getter({editElementId:function(){let t,e,n;return({element:t}=this.state),t?(({dropIn:e,droppedInElementId:n}=t),e?n:this.elementId):void 0}}),this.prototype.select=function(){let t,e,n;return({element:t}=this.state),t?(({dropIn:e,droppedInElementId:n}=t),e&&!n?this.models.elementEditState.selectAndAddPhotoToDropIn(e):this.models.elementEditState.select(this.editElementId)):void 0},this.prototype.flip=function(){return this.models.elementEditState.flipSelected(this.editElementId)},this.prototype.trash=function(){return this.models.elementEditState.trashSelected(this.editElementId)},this.prototype.bringToFront=function(){return this.models.elementEditState.bringToFront(this.editElementId)},this.prototype.sendToBack=function(){return this.models.elementEditState.sendToBack(this.editElementId)},this.prototype.moveForward=function(){return this.models.elementEditState.moveForward(this.editElementId)},this.prototype.moveBackward=function(){return this.models.elementEditState.moveBackward(this.editElementId)},this.prototype.toggleLocked=function(){return this.models.elementEditState.toggleLocked(this.editElementId)},this.prototype.edit=function(){return this.models.kimiEditorViewState.editSelectedElement(this.editElementId)},this.prototype.render=function(){let t,e,i,d,f,m,g,v,S,b,w,x,P,C,_;return({gridSize:t,y:e,layerNumber:i,buttonSize:d,lineHeight:f}=this.props),({element:m}=this.state),m&&({flipped:g,bitmap:v,locked:S,dropIn:b,droppedInElementId:w}=m),x={ww:1,h:f},C={tight:!0,labelBottom:!0,disabled:!(P=!b||w)},o("row",{location:{y:e},animators:"location",size:{ww:1,h:f},cacheDraw:!0,padding:{h:-t/2},draw:{padding:{h:-t,v:-t/4},color:0==i%2?s.tabBackgroundColor:s.selectedTabColor}},a(l.smallText,"textCenterCenter",{size:{hh:1,w:d/2},text:i,color:u.black.secondary}),o({draw:[{rectangle:{radius:t/4}},"children",{outline:this.selectedElementId&&this.editElementId===this.selectedElementId?{color:s.primary,lineWidth:4}:void 0}]},c({action:this.select,backgroundPadding:0,radius:t/4,size:x},o({childrenLayout:"row"},n("centerCenter",{scale:g?r(-1,1):1,layout:"fit",bitmap:v}),b?[o({inFlow:!1,compositeMode:"sourceTopInTarget",draw:_="#ccc"}),o({size:t/2}),w?y({elementId:w}):o(o("centerCenter",{draw:["circle",{padding:t/4},s.primary]}),a(h.frame,{size:"parentSize",align:{x:.5,y:.45},color:"white"}))]:void 0))),b?o():[p(C,{icon:"angleUp",action:this.moveForward}),p(C,{icon:"angleDown",action:this.moveBackward})],b?void 0:p(C,{icon:"pencil",label:"edit",action:this.edit}),p(C,{icon:"flip",label:"flip",action:this.flip}),b?void 0:p([C,{label:S?"locked":"lock"}],{icon:S?"lock":"unlock",action:this.toggleLocked}),p(C,{label:"trash",icon:"trash",action:this.trash}))}})),i.defClass(class LayersOverlay extends e{},function(t,e,n){this.subscriptions("viewState.viewState","elementEditState.selectedElementId","elementEditState.topElementIds","elementEditState.dropInIds","derivedElementEditState.maxTopElementsReached"),this.prototype.render=function(){let t,e,n,r,s,a,l;return({currentUser:t}=this.state),({fullScreen:e,gridSize:n,buttonSize:r}=this.state.viewState),s=r+n/2,a=n/2,d({title:"Layers",fullHeight:!0,close:this.props.close},o("parentWidthChildrenHeight","column",f({label:m(this.topElementIds.length,"layer")},o({animators:"size",size:{ww:1,h:(s+a)*this.topElementIds.length-a},margin:n},i.array(this.topElementIds.slice().reverse(),(t,e)=>v({key:t,y:(s+a)*e,layerNumber:e+1,lineHeight:s,elementId:t,gridSize:n,buttonSize:r,selectedElementId:this.selectedElementId}))),g({icon:"plus",text:"add layer",action:this.models.kimiEditorNavState.showAdd,disabled:this.maxTopElementsReached})),(i.exists(l=this.dropInIds)&&l.length)>0?f({label:m(this.dropInIds.length,"drop-in")},o({animators:"size",size:{ww:1,h:(s+a)*this.dropInIds.length-a},margin:n},i.array(this.dropInIds.slice().reverse(),(t,e)=>v({key:t,y:(s+a)*e,layerNumber:e+1,lineHeight:s,elementId:t,gridSize:n,buttonSize:r,selectedElementId:this.selectedElementId})))):void 0,o({size:{h:n}})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["AbstractOverlayComponent","merge","JSON","present","consistentJsonStringify","toPlainObjects","timeout","Element","ShapePreview","MenuSection","ShapeChildrenEditor","MenuToggle","ShapePicker","LabeledSlider","Math","OptionButtons","rgbColor","ImikimiPalette","TabbedBar","TabButton","MenuSectionGroup","MenuColorPicker"],[e,n(1132),n(1106)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x)=>{return i.defClass(class ShapeOverlay extends t{},function(t,P,C){let _;this.subscriptions("shapeEditorState.shapeEditorState","openFile.isCreator"),this.stateFields({openChildren:{},showShapePicker:!1,currentTab:"drawing",menuColorPickerDone:null}),this.prototype.getInitialState=function(){let t;return t=this.props.editShapeOptions,this.models.shapeEditorState.resetWithShapeOptions(t),C.getInitialState.apply(this,arguments)},this.prototype.hideDialog=function(){return this.models.kimiEditorViewState.hideDialog()},this.prototype.toggleChildOpen=function(t){return this.openChildren=e(this.openChildren,{[`${i.toString(t)}`]:!this.openChildren[t]})},this.prototype.toggleAdvanced=function(){return this.advanced=!this.advanced},this.prototype.shapeOptionsChanged=function({props:t}){let e;return(()=>{try{return this.models.shapeEditorState.shapeOptions=n.parse(t.value),this.setState({jsonParsed:!0})}catch(t){return e=t,this.setState({jsonParsed:!1})}})()},this.prototype.shapeTextChanged=function({target:{value:t}}){return this.updateShapeOptions({text:r(t,this.shapeEditorState.shapeOptions.text)})},this.prototype.fontChanged=function({target:{value:t}}){return this.updateShapeOptions({fontFamily:r(t,"Arial Unicode MS")})},_=function(t){return o(s(t),"  ")},this.prototype.updateShapeOptions=function(t){return this.models.shapeEditorState.updateShapeOptions(t)},this.prototype.undoAction=function(){return this.models.shapeEditorState.undo()},this.prototype.redoAction=function(){return this.models.shapeEditorState.redo()},this.prototype.save=function(){let t;return({shapeOptions:t}=this.shapeEditorState),this.models.shapeEditorState.getElementEditState(t).then(t=>{let e;return(e=this.props.editShapeOptions)?this.models.elementEditState.updateSelectedElementProps(t):this.models.elementEditState.addTopElement(t),this.models.elementEditState.updateColorHistory(t)}),a(100,this.models.kimiEditorNavState.hideOverlay)},this.prototype.selectShape=function(t){return this.clearShowShapePicker(),this.updateShapeOptions({text:t})},this.getter({editMode:function(){return!!this.props.editShapeOptions}}),this.prototype.renderPreview=function(){return l(u({shapeOptions:this.shapeEditorState.shapeOptions,openChildren:this.state.openChildren}))},this.prototype.preprocessState=function(t){return e(C.preprocessState.apply(this,arguments),{showShapePicker:t.loaded?t.showShapePicker:!this.props.editShapeOptions,loaded:!0})},this.prototype.renderDrawOptions=function(){let t,e,n,i,r,o,s,a,u,d;return({gridSize:t,buttonSize:e}=this.state.viewState),n=(d=this.state).dropInBitmapsByType,i=d.jsonParsed,r=d.shapeString,o=d.advanced,s=d.openChildren,a=this.shapeEditorState.shapeOptions,u=this.props.editShapeOptions,l(["column","parentWidthChildrenHeight"],{key:"draw options"},c(h({toggleChildOpen:this.toggleChildOpen,openChildren:s,updateShapeOptions:this.updateShapeOptions,updateChild:this.updateChild,showColorPicker:this.showColorPicker,shapeChildren:a.children||[]}),this.isCreator&&p({icon:"droplet",text:"is drop-in",isOn:this.models.shapeEditorState.isDropIn,action:this.models.shapeEditorState.toggleIsDropIn})))},this.prototype.renderShapeOptions=function(){let t,e;return({gridSize:t}=this.viewState),({shapeOptions:e}=this.shapeEditorState),l(["parentWidthChildrenHeight","column"],{key:"shape options"},e.bitmap?void 0:d({selectShape:this.selectShape,currentShape:e.text}),c(null,f(e,{update:this.updateShapeOptions,label:"stretch",propName:"stretch",defaultValue:0,minValue:-1,maxValue:1}),f(e,{update:this.updateShapeOptions,label:"angle",propName:"angle",defaultValue:0,minValue:-m.PI,maxValue:m.PI}),f(e,{update:this.updateShapeOptions,label:"opacity",propName:"opacity",defaultValue:1,minValue:0,maxValue:1}),g({buttons:{flip:{icon:"flip",selected:e.flip,action:()=>this.updateShapeOptions({flip:!e.flip})},reset:{icon:"undo",action:()=>this.updateShapeOptions({opacity:1,angle:0,stretch:0})}}})))},this.stateFields({selectedColor:null,selectColor:null,abortPickColor:null}),this.prototype.showColorPicker=function(t,e){return this.selectColor=e,this.models.colorPickerState.color=this.selectedColor=y(t),this.currentTab="colors",this.menuColorPickerDone=(()=>(this.currentTab="drawing",this.menuColorPickerDone=null))},this.prototype.render=function(){let t,n,r,o,s,a,u,c,h;return({heightAdjustedButtonSize:t,gridSize:n,viewHeight:r,landscape:o}=this.viewState),({close:s}=this.props),({selectColor:a,selectedColor:u}=this),c=`${i.toString(this.editMode?"Edit":"Add")} shape`,({shapeOptions:h}=this.shapeEditorState),C.render.call(this,{fullHeight:!0,title:c,close:s,fixedTopChildren:l({size:{ww:1,hch:1},childrenLayout:"column",animators:"size"},!o&&r>414?l({size:{ww:1,h:.5*r-5*n-t,max:{hw:2/3}},cacheDraw:!0,draw:v.tabBackgroundColor},this.renderPreview()):void 0,S({buttonSize:this.viewState.heightAdjustedButtonSize,currentTab:this.currentTab,tabChanged:this.setCurrentTab,tabs:[{icon:"layers",label:"drawing",enabled:!0},e({tab:"shape",enabled:!0},h.bitmap?{label:"photo",icon:"image"}:{label:"shape",icon:{fontFamily:"Arial",fontSize:24,layoutMode:"tight",text:h.text}}),{icon:"palette",label:"colors",enabled:this.selectColor},this.viewState.landscape?{icon:"image",label:"preview"}:void 0]})),noScrollChildren:"preview"===this.currentTab?this.renderPreview():void 0,fixedButtonButtons:[b({action:this.models.kimiEditorNavState.hideOverlay,icon:"close",iconScale:.5,text:"cancel"}),b({icon:"checkmark",iconScale:.75,maxLargeLabelLength:20,text:this.editMode?"save changes":"add shape",action:this.save})]},l("parentWidthChildrenHeight",(()=>{switch(this.currentTab){case"drawing":return this.renderDrawOptions();case"shape":return this.renderShapeOptions()}})(),w({visible:"colors"===this.currentTab,key:"colorpicker"},x({done:this.menuColorPickerDone,overlay:this,close:this.abortPickColor,selectedColor:u,selectColor:a}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["TextEffects","AbstractOverlayComponent","Element","rgbColor","present","neq","merge","console","timeout","BitmapElement","MembershipRequiredButton","LoadingOverlay","point","TabbedBar","m","MenuSectionGroup","MenuSection","MenuDivider","MenuButton","TextPalette","TextInputElement","TextStyles","TextElement","objectKeyCount","TabButton","ButtonWrapper","ImikimiPalette","w","escapeRegexp","ScrollElement","SimpleTagLink","isString","MenuColorPicker","DelayApplyTextInput","iOSDetect","lowerCamelCase","PushBackTimer"],[e,n(1132),n(1078),n(1082),{TextEffects:n(1045)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L)=>{let D;return D=t.Fonts,i.defClass(class Text extends e{constructor(){super(...arguments),this.pushBackTimer=new L}},function(e,L,N){this.subscriptions("buttonAssets.fontButtonAssets","currentSession.grantMemberAccess"),this.prototype.renderOptions=function(){return n({size:50})},this.stateFields({liveText:void 0,text:void 0,style:void 0,styleName:void 0,color:void 0,font:void 0,effect:void 0,fontFilter:void 0,align:void 0,previewBitmap:void 0,currentTab:"text",loadingFont:!1}),this.getter({editMode:function(){return null!=this.props.text},editObjectType:function(){return"text"}}),this.setter({currentTab:function(t){return this.setState({currentTab:t}),this.clearPageStack()},style:function(t){return this.setState(t),this.setState({style:t})},color:function(t){return this.setState({color:r(t)})}}),this.prototype.preprocessState=function(e){let n,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I;return({style:n}=e),null!=n||(n=t.defaultStyle),u=void 0!==(b=e.text)?b:this.props.text,c=void 0!==(w=e.font)?w:null!=(x=this.props.font)?x:n.font,h=void 0!==(P=e.effect)?P:null!=(C=this.props.effect)?C:n.effect,p=void 0!==(_=e.align)?_:null!=(E=this.props.align)?E:"center",d=void 0!==(T=e.color)?T:r(null!=(k=this.props.color)?k:n.color),f=e.previewBitmap,m=e.viewState,g=e.liveText,y=e.loadingFont,v=o(u)?u:null!=(I=i.exists(n)&&n.sampleText)?I:"The quick brown fox\njumped over the lazy dog.",f&&!s(this._previewProps,S={effect:h,font:c,align:p,color:d,text:v})||(this._previewProps=S,D.getFontIsLoaded(c)?(y=!1,new t.renderers[h]({font:c,align:p,color:d,text:v}).createBitmap(m.feedWidth*m.devicePixelsPerPoint).then(this.setPreviewBitmap).catch(t=>(l.error({"Error generating preview bitmap":{props:{effect:h,font:c,color:d,align:p,text:v},error:{message:t.message,info:t.info}}}),l.error(t)))):(D.loadFont(c).then(this.clearLoadingFont),y=!0,f=null)),N.preprocessState.call(this,a(e,{loadingFont:y,liveText:null!=g?g:u,text:u,align:p,font:c,effect:h,color:d,previewBitmap:f}))},this.prototype.save=function(){return new t.renderers[this.effect]({font:this.font,color:this.color,text:this.text,align:this.align}).createBitmap().then(t=>{let e,n,i,r,o,s;return e={bitmap:t,custom:{options:(({text:n,font:i,effect:r,color:o,align:s}=this.state),{text:n,font:i,effect:r,color:o,align:s}),edit:this.models.kimiEditorNavState.showText}},this.props.text?this.models.elementEditState.updateSelectedElementProps(e):this.models.elementEditState.addTopElement(e),this.models.elementEditState.updateColorHistory(e)}),u(100,this.models.kimiEditorNavState.hideOverlay)},this.getter({membershipRequired:function(){let e,n,i;return({font:e,effect:n}=this),({premium:i}=t),!this.grantMemberAccess&&(i.font[e]||i.effect[n])}}),this.prototype.renderPreview=function(){let t;return({gridSize:t}=this.viewState),n("column",{key:"preview"},n({padding:t/2},"column","childrenTopCenter",n(null,this.previewBitmap?c({size:(t,e)=>e.fitInto(t.sub(d(10,0))),bitmap:this.previewBitmap,animators:"axis location"},(()=>{switch(this.align){case"left":return"centerLeft";case"right":return"centerRight";default:return"centerCenter"}})()):void 0),this.membershipRequired?h({overlay:this}):void 0,this.loadingFont?p():void 0))},this.prototype.renderTabButtons=function(){let t;return t=o(this.liveText),f({buttonSize:this.viewState.heightAdjustedButtonSize,currentTab:this.currentTab,tabChanged:this.setCurrentTab,tabs:[m({label:"text"}),m({icon:"paintbrush",label:"style"}),m({icon:"magicWand",label:"effect"}),m({icon:"capitalA",label:"font"}),m({icon:"palette",label:"color"}),this.viewState.landscape?{icon:"image",label:"preview"}:void 0]})},this.prototype.renderStylePicker=function(){let e;return({styleName:e}=this.state),g({key:"stylepicker"},y(i.array(t.styleOrder,n=>S({text:t.styleNames[n],icon:"paintbrush",selected:e===n,action:()=>this.style=t.styles[this.styleName=n]}),e=>t.free.style[e]),v({text:"Member styles",memberOnly:!0,inMenuSection:!0,padding:0,memberFeature:"These text styles"},this.subPageActionProps),i.array(t.styleOrder,n=>S({text:t.styleNames[n],icon:"paintbrush",selected:e===n,action:()=>this.style=t.styles[this.styleName=n]}),e=>!t.free.style[e])))},this.prototype.renderEffectPicker=function(){let e;return({effect:e}=this.state),g({key:"effectpicker"},y(i.array(t.effectOrder,n=>S({text:t.effectNames[n],icon:"magicWand",selected:e===n,action:()=>this.effect=n}),e=>t.free.effect[e]),v({text:"Member effects",memberOnly:!0,inMenuSection:!0,memberFeature:"These text effects"},this.subPageActionProps),i.array(t.effectOrder,n=>S({text:t.effectNames[n],icon:"magicWand",selected:e===n,action:()=>this.effect=n}),e=>!t.free.effect[e])))},this.getter({fonts:function(){return t.getFonts()}}),this.prototype.renderFontFilter=function(){let t,e,r,s;return({gridSize:t,buttonSize:e,reducedHeightMode:r}=this.viewState),({tags:s}=this.fonts[this.font]),r?void 0:n(["column","parentWidthChildrenHeight"],{padding:{top:t/2,h:t/2}},n(["row","parentWidthChildrenHeight"],{padding:t/4,draw:{radius:2,padding:-.5,outline:{color:b.black.tertiary,lineWidth:1}}},w(x.tinyText,{value:this.fontFilter,size:{h:25},on:{valueChanged:({props:{value:t}})=>this.fontFilter=t}}),P(x.tinyText,"parentHeightChildrenWidth",{padding:{right:t/2},align:.5,color:b.black.secondary,text:o(this.fontFilter)?`showing ${i.toString(this.filteredFonts.fontKeys.length)} / ${i.toString(C(this.fonts))} fonts`:`filter ${i.toString(C(this.fonts))} fonts`}),_({icon:"close",size:25,iconScale:.5,action:o(this.fontFilter)&&this.clearFontFilter})))},this.prototype.renderFontButton=function(t,e,i){let r,o,s,a,l,u;return r=this.fonts[t],o=(u=this.viewState).gridSize,s=u.heightAdjustedButtonSize,E("childrenSize",{key:t,action:a=(()=>this.font=t),selected:this.font===t,hoverAction:()=>D.loadFont(t)},(l=this.fontButtonAssets[t])?n("childrenSize",{padding:{v:2,h:6}},c({bitmap:l},{size:{h:s,w:(t,e)=>e.x*s/e.y}})):P({size:{h:s,wcw:1},padding:{h:o/2},align:.5,fontSize:24,fontFamily:r.fontFamily,fontWeight:r.fontWeight,text:r.name,color:T.red}))},this.getter({filteredFonts:function(){let t,e,n,r,s,a;return({fontFilter:t}=this),e=t,o(t)?(t=RegExp(`^(?=.*${i.toString(i.array(k(e),t=>I(t),t=>"#"!==t).join(") (?=.*"))})`,"i"),n=RegExp(`^((?=.*${i.toString(i.array(k(e),t=>I(t),t=>"#"!==t).join(")|(?=.*"))}))`,"i")):t=e=null,r=[],s=[],a=i.array(this.fonts,({guest:t,search:e},n)=>(t?r:s).push(n),({guest:e,search:n},i)=>!t||t.test(n)),{guestFontKeys:r,memberFontKeys:s,fontKeys:a,orFontFilter:n,fontFilter:t}}}),this.prototype.renderFontPicker=function(){let e,r,o,s,a,l,u,c,h,d;return({gridSize:e,buttonSize:r,reducedHeightMode:o,smallButtonSize:s,viewHeight:a}=this.viewState),({guestFontKeys:l,memberFontKeys:u,orFontFilter:c,fontFilter:h}=this.filteredFonts),this.fontButtonAssets?n("flow",{key:"fontpicker",size:{ww:1,hch:1},padding:e/2},o?M(["row","parentWidthChildrenHeight"],i.array(t.fontTags.sort(),t=>this.renderFontTagLink(t,c))):n(["flow","parentWidthChildrenHeight"],i.array(t.fontTags.sort(),t=>this.renderFontTagLink(t,c))),l.length>0?g({key:"guest fonts"},n({size:{h:e/2}}),v({text:"Guest fonts"}),n({size:"parentWidthChildrenHeight",childrenLayout:"flow"},i.array(l.sort(),t=>this.renderFontButton(t,h)))):void 0,u.length>0?g({label:"Member fonts (trial mode)",key:"member fonts"},n({size:{h:e/2}}),v({text:"Member fonts",memberOnly:!0,memberFeature:"These fonts"},this.subPageActionProps),n(["flow","parentWidthChildrenHeight"],i.array(u.sort(),t=>this.renderFontButton(t,h,!0)))):void 0,g({key:"selected font"},n({size:{h:e/2}}),v({text:"Selected Font"}),n({childrenLayout:"column",childrenMargins:e,padding:e},this.renderLabeledLine("name",D.fonts[this.font].name),this.renderLabeledLine("sample",(d=this.fontButtonAssets[this.font])?P({fontFamily:D.fonts[this.font].fontFamily,fontSize:24,size:"parentWidthChildrenHeight",text:"The quick brown fox jumped over the lazy dog.\n1234567890\n. , ! ? @ # $ % & *"}):void 0),this.renderLabeledLine("tags",n(["flow","parentWidthChildrenHeight"],i.array(D.fonts[this.font].tags,t=>this.renderFontTagLink(t,c))))))):n({size:{h:100}},p())},this.prototype.renderFontTagLink=function(t,e){let n,r,o;return({smallButtonSize:n,gridSize:r,reducedHeightMode:o}=this.viewState),A({gridSize:r,buttonSize:n*(o?.75:1),text:t,actionWithTag:(t,{props:{shiftKey:e}})=>e?this.fontFilter.match(t)?this.fontFilter=`${i.toString(this.fontFilter)}`.replace(t,"").replace(/\s+/g," "):this.fontFilter+=` ${i.toString(t)}`:this.fontFilter=t===this.fontFilter?null:t,selected:i.exists(e)&&e.test(t)})},this.prototype.renderLabeledLine=function(t,e){let i;return({gridSize:i}=this.viewState),n(["row","parentWidthChildrenHeight"],P(x.smallText,"textTopRight",{text:t,padding:{right:i},size:{hch:1,w:6*i}}),F(e)?P(x.mediumText,{text:e}):e)},this.prototype.renderOptions=function(){let t,e,i,r,o,s;return t=null!=this.props.text,e=(s=this.viewState).fullScreen,i=s.gridSize,r=s.buttonSize,o=s.viewHeight,n({size:{ww:1,hch:1}},"column",(()=>{switch(this.currentTab){case"color":return B({overlay:this,selectedColor:this.color,selectColor:this.setColor,close:this.clearPickColor});case"style":return this.renderStylePicker();case"font":return this.renderFontPicker();case"effect":return this.renderEffectPicker()}})())},this.getter({saveAction:function(){return o(this.text)&&(this.membershipRequired?()=>this.models.navState.showOrPushSubscriptions(this,!0):this.save)}}),this.prototype.render=function(){let t,e,r,s,a,l,u,c,h;return t=(h=this.viewState).viewHeight,e=h.heightAdjustedButtonSize,r=h.landscape,s=h.isPhone,a=h.gridSize,l={ww:1,hw:.4,max:{y:1*t/5}},N.render.call(this,{fullHeight:u=s,title:`${i.toString(this.editMode?"Edit":"Add")} ${i.toString(this.editObjectType)}`,close:this.props.close,fixedTopChildren:n(["column","parentWidthChildrenHeight"],!r&&t>414?n({size:l,drawOrder:[{color:T.tabBackgroundColor},"reset","clip"]},this.renderPreview()):void 0,this.renderTabButtons(),"font"===this.currentTab?this.renderFontFilter():void 0),scrollAreaKey:this.currentTab,fixedButtonButtons:[_({action:this.models.kimiEditorNavState.hideOverlay,icon:"close",text:"cancel",iconScale:.75,radius:100}),_({radius:100,icon:o(this.text)&&this.membershipRequired?"lock":"checkmark",maxLargeLabelLength:20,text:o(this.text)&&this.membershipRequired?"membership required":this.editMode?"save changes":`add ${i.toString(this.editObjectType)}`,action:this.saveAction,disabledAction:()=>this.currentTab="text"})],noScrollChildren:(()=>{switch(this.currentTab){case"text":return c=this.viewState.isPhone?{ps:1}:{ww:1,hch:1,max:{hh:1}},n({draw:T.selectedTabColor,key:"textEditElementWrapper",padding:a/2,size:c,childrenMargins:r?a/2:void 0},r?"row":"column",n({size:r?"parentHeightChildrenWidth":{ww:1,h:e},padding:!r&&{h:3*a}},r?"column":"row",i.array(["left","center","right"],t=>{let n,o,s;return n=O(`align ${i.toString(t)}`),o=this.align===t,_({size:r?e:{h:e,ww:1},icon:n,text:!r&&t,selected:o,action:s=(()=>this.align=t)})})),R({size:!this.viewState.nativeApp&&this.viewState.isPhone&&z()?{ww:1,h:this.viewState.viewHeight/2.5,max:{hh:1}}:c,autoFocus:!0,align:this.align,value:this.liveText,valueChanged:this.setLiveText,valueApplied:this.setText,placeholder:"enter text here",maxLength:1e3,type:"textarea"}),r?_({size:e,icon:"checkmark",action:this.saveAction}):void 0);case"preview":return this.renderPreview()}})()},(()=>{switch(this.currentTab){case"color":return B({fullHeight:u,overlay:this,selectedColor:this.color,selectColor:this.setColor});case"text":case"preview":return null;default:return this.renderOptions()}})())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(838)).addModules({MainToolbar:n(1140),PhonePrimaryToolbar:n(1141),PhoneSecondaryToolbar:n(1142)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","ImikimiPalette","TextPalette","TabButton","TabBarSpacer","vertical","lowerCase"],[e,n(1080)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class MainToolbar extends t{},function(t,i,h){this.subscriptions("history.undoAvailable","history.redoAvailable","viewState.viewState","elementEditState.topElementIds","elementEditState.selectedElementId","derivedElementEditState.maxTopElementsReached","openFile.isCreator"),this.stateFields({info:null}),this.prototype.hoverInfo=function(t,{info:e}){return this.info=t&&e},this.prototype.render=function(){let t,i,h,p,d,f,m,g,y,v,S,b,w,x;return t=(w=this.viewState).buttonSize,i=w.gridSize,h=w.viewWidth,p={lightText:!0,size:{hh:1,wcw:1},hoverAction:this.hoverInfo},d={size:t,hoverAction:this.hoverInfo},x=this,f=this.selectedElementId,m=this.maxTopElementsReached,(g=0<=(y=this.topElementIds.indexOf(f)))&&(v=0===y,S=y===this.topElementIds.length-1),e(this.props,h>=900?e("cacheDraw",["row","parentHeightChildrenWidth"],{padding:{left:i}},n(r.largeText,"parentHeightChildrenWidth","textCenterLeft",{text:"Kimi "+(b=this.isCreator?"Maker":"Framer"),color:o.primary})):void 0,h>=750?n(r.smallText,{key:"buttonInfo",padding:{h:i/4},animators:{opacity:{toFrom:0}},maxLines:2,align:{y:.5,x:1},color:s.black.tertiary,text:this.info||""}):e(),h>=13*t?[a(d,{key:"toFront",icon:"angleDoubleUp",info:"move selected to front",action:this.models.elementEditState.bringToFront,disabled:!g||!g||S}),a(d,{key:"toBack",icon:"angleDoubleDown",info:"move selected to back",action:this.models.elementEditState.sendToBack,disabled:!g||!g||v})]:void 0,a(d,{icon:"pencil",info:"edit selected",action:this.models.kimiEditorViewState.editSelectedElement,disabled:!g}),a(d,{icon:"copy",info:"duplicate selected",disabled:!g||m,action:this.models.elementEditState.cloneSelected}),a(d,{icon:"flip",info:"flip selected",disabled:!f,action:this.models.elementEditState.flipSelected}),a(d,{icon:"trash",info:"trash selected",disabled:!f,action:this.models.elementEditState.trashSelected}),l(),a(d,{icon:"undo",info:"undo",action:this.models.history.undo,disabled:!this.undoAvailable}),a(d,{action:this.models.history.redo,disabled:!this.redoAvailable,info:"redo",icon:"redo"}),l(),h>=17*t?[a(d,{key:"addText",icon:"capitalA",info:"add text",action:this.models.kimiEditorNavState.showText,disabled:m}),a(d,{key:"addShape",icon:"star",info:"add shape",action:this.models.kimiEditorNavState.showAddShape,disabled:m}),a(d,{key:"addPhoto",icon:"image",info:"add photo",action:this.models.kimiEditorNavState.addBitmap,disabled:m}),this.isCreator&&"imikimi"===u?a(d,{icon:"droplet",key:"addDropin",info:"add drop-in",action:this.models.kimiEditorNavState.showAddDropIn,disabled:m}):void 0]:a(d,{key:"addLayer",icon:"plus",info:"add layer",action:this.models.kimiEditorNavState.showAdd,disabled:m}),l(),a(d,{icon:"layers",info:"show layers",action:this.models.kimiEditorNavState.showLayers}),l(),a(p,{key:"save",icon:"save",text:"save",info:"save and share",disabled:!this.models.elementEditState.hasUserAddedElements,action:this.models.kimiEditorNavState.save}),l(),a(d,{icon:"close",info:"exit "+c(b),iconScale:.5,action:this.models.kimiEditorNavState.exit}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TabButton"],[e,n(1080)],(t,e,n)=>{return i.defClass(class PhonePrimaryToolbar extends t{},function(t,r,o){this.subscriptions("history.undoAvailable","history.redoAvailable","viewState.viewState","kimiEditorNavState.overlay","elementEditState.topElementIds","elementEditState.selectedElementId","derivedElementEditState.maxTopElementsReached"),this.prototype.render=function(){let t,r,o,s,a,l,u;return t={labelBottom:!0,lightText:!0,size:"right"===this.viewState.tabBar?{ps:1}:void 0},(r=this.selectedElementId)&&(s=(o=this.topElementIds.indexOf(r))>=0,a=0===o,l=o===this.topElementIds.length-1),e(this.props,n(t,{action:this.models.history.undo,disabled:!this.undoAvailable,icon:"undo",text:"undo"}),n(t,{action:this.models.history.redo,disabled:!this.redoAvailable,icon:"redo",text:"redo"}),n(t,{icon:"plus",text:"add",selected:"Add"===(i.exists(u=this.overlay)&&u.type),action:this.models.kimiEditorNavState.showAdd,disabled:this.maxTopElementsReached}),n(t,{action:this.models.elementEditState.bringToFront,disabled:!r||!s||l,icon:"angleDoubleUp",text:"to front"}),n(t,{action:this.models.elementEditState.sendToBack,disabled:!r||!s||a,icon:"angleDoubleDown",text:"to back"}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TabButton"],[e,n(1080)],(t,e,n)=>{return i.defClass(class PhoneSecondaryToolbar extends t{},function(t,r,o){this.subscriptions("elementEditState.topElementIds","elementEditState.selectedElementId","derivedElementEditState.maxTopElementsReached"),this.prototype.render=function(){let t,r;return t={labelBottom:!0,lightText:!0},r=i.in(this.selectedElementId,this.topElementIds),e(this.props,n(t,{action:this.models.kimiEditorNavState.exit,icon:"angleLeft",text:"back"}),n(t,{icon:"pencil",text:"edit",action:this.selectedElementId&&this.models.kimiEditorViewState.editSelectedElement,disabled:!r}),n(t,{disabled:!r||this.maxTopElementsReached,icon:"copy",text:"clone",action:this.models.elementEditState.cloneSelected}),n(t,{action:this.models.kimiEditorNavState.showLayers,text:"layers",icon:"layers"}),n(t,{disabled:!this.selectedElementId,action:this.models.elementEditState.trashSelected,icon:"trash",text:"trash"}),n(t,{action:this.models.kimiEditorNavState.save,icon:"save",key:"save",text:"save"}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v={}.hasOwnProperty;s=n(160),o=n(506),r=n(341),i=n(313),g=i.point,i.point0,r.File.V1Loader,a=Neptune.Imikimi.KimiEditor.TextEffects,s.log,c=s.defineModule,s.mergeInto,s.RestClient,f=s.min,d=s.merge,h=s.isFunction,u=s.arrayWithout,l=s.arrayWith,m=s.peek,y=s.timeout,p=s.isString,e=o.ApplicationState,o.pending,o.success,o.failure,c(t,function(t){function KimiEditorViewState(){return KimiEditorViewState.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)v.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(KimiEditorViewState,e),KimiEditorViewState.stateFields({defaultViewPadding:20,kimiViewerCurrentSize:g(100),presenterCurrentLocation:g(0),presenterProps:{location:{ps:.5},scale:1},kimiPresenter:null,activeDialogs:[],activePremiumPreview:null,editableElementAnimators:!0,currentSamplePhotoCategoryName:null,instantNotification:null}),KimiEditorViewState.prototype.disableEditableElementAnimators=function(){return this.editableElementAnimators=null},KimiEditorViewState.prototype.enableEditableElementAnimators=function(){return this.editableElementAnimators="location scale"},KimiEditorViewState.prototype.showPremiumPreview=function(t){return this.activePremiumPreview={component:Neptune.Imikimi.KimiEditor.Components.Dialogs.PremiumTextPreview,props:{previewProps:t}}},KimiEditorViewState.prototype.hidePremiumPreview=function(){return this.activePremiumPreview=null},KimiEditorViewState.prototype.showDialog=function(t,e){var n,i,r,o;return n=null!=(i=Neptune.Imikimi.KimiEditor.Components)&&null!=(r=i.Dialogs)?r[t]:void 0,h(n)?new Promise((o=this,function(i,r){var s,a;return s=o.activeDialogs,t===(null!=(a=m(s))?a.dialogName:void 0)&&(s=u(s)),o.activeDialogs=l(s,{dialogName:t,component:n,props:d(e,{resolve:i,reject:r}),preventCancel:null!=e?e.preventCancel:void 0})})):Promise.reject("Dialog not found: "+t)},KimiEditorViewState.prototype.hideDialog=function(t){var e,n;return e=this.activeDialogs,t&&t!==(null!=(n=m(e))?n.dialogName:void 0)||(this.activeDialogs=u(this.activeDialogs)),this.onNextReady()},KimiEditorViewState.prototype.hideAllDialogs=function(){return this.activeDialogs=[],this.onNextReady()},KimiEditorViewState.prototype.hideThenShowDialog=function(t,e){return this.hideDialog().then(function(){return y(300)}).then((n=this,function(){return n.showDialog(t,e)}));var n},KimiEditorViewState.prototype.cancelDialog=function(){if(!m(this.activeDialogs).preventCancel)return this.hideDialog()},KimiEditorViewState.prototype.eventLocationInPresenterSpace=function(t){return t.locationIn(this.kimiPresenter)},KimiEditorViewState.prototype.dropInPropsUnderEvent=function(t){return this.models.elementEditState.dropInPropsUnderPoint(this.eventLocationInPresenterSpace(t))},KimiEditorViewState.prototype.dropInIdUnderEvent=function(t){var e;return null!=(e=this.dropInPropsUnderEvent(t))?e.elementId:void 0},KimiEditorViewState.prototype.getElementIdUnderEvent=function(t){return this.models.elementEditState.getElementIdUnderPresenterSpacePoint(this.eventLocationInPresenterSpace(t))},KimiEditorViewState.prototype.createTextElement=function(){var t,e,n;return n=this.models,t=n.elementEditState,e=n.preferences,this.showDialog("EditText",{fontFamily:a.getFontFamily(e.defaultTextProps.font),color:e.defaultTextProps.color,action:function(e){return t.addTextElement(e)}})},KimiEditorViewState.prototype.editSelectedElement=function(t){var e,n,i,r,o,s,l;if(p(t)?this.models.elementEditState.select(t):t=this.models.elementEditState.selectedElementId,s=this.models,i=s.elementEditState,s.preferences,r=i.getElementProps(t)){if(l=r.text)return this.showDialog("EditText",{text:l,fontFamily:a.getFontFamily(r.font),color:r.color,action:function(t){return i.updateSelectedElementProps({text:t}),i.saveUndo("editText")}}),!0;if((e=r.custom)&&(n=e.edit,o=e.options,n))return n(o),!0}},KimiEditorViewState.prototype.selectElementUnderEvent=function(t){var e,n;return e=this.models.elementEditState,(n=this.getElementIdUnderEvent(t))&&n===e.selectedElementId?this.editSelectedElement()?void 0:e.deselect():e.select(n)},KimiEditorViewState.getter({defaultScale:function(){var t,e,n,i;return(t=this.models.elementEditState.kimiSize)?(e=(i=this).kimiViewerCurrentSize,i.presenterCurrentSize,n=2*i.defaultViewPadding,f((e.x-n)/t.x,(e.y-n)/t.y)):1}}),KimiEditorViewState.setter({presenterLocation:function(t){return this.updatePresenterProps({location:t,animators:{}})},animatedPresenterLocation:function(t){return this.updatePresenterProps({location:t,animators:{location:{on:{done:(e=this,function(){return e.disableViewAnimation()})}}}});var e},presenterScale:function(t){return this.updatePresenterProps({scale:t})}}),KimiEditorViewState.prototype.updatePresenterProps=function(t){return this.presenterProps=d(this.presenterProps,t)},KimiEditorViewState.prototype.disableViewAnimation=function(){return this.updatePresenterProps({animators:null})},KimiEditorViewState.prototype.resetView=function(t){var e,n;return e={scale:this.defaultScale,location:{ps:.5},animators:t&&{location:{on:{done:(n=this,function(){return n.disableViewAnimation()})}},scale:{on:{done:function(t){return function(){return t.disableViewAnimation()}}(this)}}}},this.presenterProps=e},KimiEditorViewState.prototype.reset=function(){return this.resetView()},KimiEditorViewState}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b={}.hasOwnProperty;i=n(341),(m=n(802)).randomString,h=m.log,a=m.defineModule,m.mergeInto,o=m.RestClient,m.inspect,m.arrayToTruthMap,m.wordsArray,c=m.isNumber,m.shallowClone,p=m.merge,m.objectLength,m.isString,m.errorToString,m.present,m.timeout,v=m.round,m.objectKeyCount,d=m.point,f=m.point0,m.Matrix,m.rect,m.Point,m.Bitmap,e=m.ApplicationState,m.pending,m.success,m.failure,g=m.Browser,l=g.getIsMobileBrowser,m.formattedInspect,r=m.ErrorWithInfo,m.EncodedImage.toImage,m.humanByteSize,u=n(1145).getOptimizedTemplate,y=i.File.V1Writer,S=y.toArtFileTags,y.toEncodedArtFile,s=i.File.V1Loader,a(t,function(t){function OpenFile(){return OpenFile.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)b.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(OpenFile,e),OpenFile.stateFields({kimiTemplate:null,postCancel:null,saveUrl:null,isCreator:!1,newPostProps:null}),OpenFile.prototype.getDropInElements=function(t){var e,n,i,r,o,s;for(s=[],n=0,i=(r=t.children).length;n<i;n++)(null!=(o=(e=r[n]).userProps)?o.dropInEnabled:void 0)&&(e.compositeMode="add",s.push(e));return s},OpenFile.prototype.initCreatorEdit=function(t){return this.reset(),this._initKimiEditor(),this._initCreatorEdit(t)},OpenFile.prototype.loadKimiTemplateForCustomizing=function(t){var e,n,i,r;return this.reset(),this._initKimiEditor(),i=t.onProgress,e=t.customizeUrl,n=t.kimiData,this.saveUrl=t.saveUrl,this.postCancel=t.postCancel,this.newPostProps=t.newPostProps,this.isCreator=!1,Promise.resolve(n||o.getArrayBuffer(e,{verbose:!0,onProgress:i})).then(function(t){return s.load(t)}).then((r=this,function(t){return r._setKimiTemplate(t),r.models.kimiEditorViewState.hideDialog(),t}))},OpenFile.getter({dropInCount:function(){return this.models.elementEditState.creatorDropInCount}}),OpenFile.prototype.reset=function(){return this.resetState(),this.models.elementEditState.resetState(),this.models.history.resetState(),this.models.kimiEditorViewState.resetState()},OpenFile.prototype.toEncodedArtFileTree=function(){return this.models.elementEditState.encodeBitmaps().then((t=this,function(){return t.models.elementEditState.getElementTreePromise({withSampleDropIns:!0})}));var t},OpenFile.prototype.toEncodedArtFileTags=function(){return this.toEncodedArtFileTree().then(function(t){return S(t)})},OpenFile.prototype.toEncodedArtFile=function(){return this.toEncodedArtFileTags().then(function(t){return t.toXbd()})},OpenFile.prototype.encodeForOz=function(){var t,e,n,i,r;return 1,n=this.dropInCount>0?1.5:3,i=(t=this.models.elementEditState.backgroundBitmap)?t.size:d({aspectRatio:1,area:1e6*n}),e=v(Math.sqrt(i.area),128),this.dropInCount>0?u(e).then((r=this,function(t){return Promise.all([S(t).then(function(t){return t.toXbd()}),t.toBitmapBasic({area:"logicalArea"})]).then(function(t){var e,n;return n=t[0],e=t[1],h({templateByteLength:n.length,templateDropInCount:r.dropInCount}),{templateData:n,bitmap:e,templateType:"optimizedKimiTemplate",templateByteLength:n.length,templateDropInCount:r.dropInCount}})})):this.models.elementEditState.getElementTreePromise().then(function(t){return t.toBitmapBasic()}).then(function(t){return{bitmap:t}})},OpenFile.prototype.exit=function(){return"function"==typeof this.postCancel?this.postCancel():void 0},OpenFile.prototype._setKimiTemplate=function(t){return this.kimiTemplate=t,this.isCreator=!1,this.models.elementEditState.init({dropIns:this.getDropInElements(t),kimiSize:t.size.layout(f),backgroundBitmap:t.children[0].bitmap}),this.models.kimiEditorViewState.reset()},OpenFile.prototype._initKimiEditor=function(){return this.models.buttonAssets.loadAssets()},OpenFile.prototype._initCreatorEdit=function(t){var e,n,i;if(t=p({saveUrl:this.saveUrl,postCancel:this.postCancel},t),this.resetState(),this.saveUrl=t.saveUrl,this.postCancel=t.postCancel,this.isCreator=!0,n=t.bitmap,e=t.aspectRatio,i=t.colors,n&&(e=n.size.aspectRatio),this.models.elementEditState.updateColorHistory(i),!c(e))throw new r("expected options.bitmap or options.aspectRatio",{bitmap:n,aspectRatio:e});return this.models.elementEditState.init({kimiSize:d({aspectRatio:e,area:1048576*(l()?2:3)}).rounded}),n&&this.models.elementEditState.addBitmap(n,{locked:!0,userRequested:!1}),this.models.kimiEditorViewState.reset(),this.onNextReady()},OpenFile}())}).call(this,n(2)(t))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w;b=n(1067),y=b.point,b.point0,v=b.point1,o=b.Matrix,S=b.rect,b.hslColor,b.rgbColor,b.randomString,b.log,b.createWithPostCreate,c=b.defineModule,b.mergeInto,b.RestClient,d=b.min,h=b.max,p=b.merge,b.bound,b.select,b.isString,b.arrayWith,b.arrayWithoutValue,b.arrayWithElementValueMoved,b.arrayWithElementMoved,b.peek,b.upperCamelCase,b.plainObjectsDeepEq,c=b.defineModule,u=b.createObjectTreeFactories,l=b.compactFlatten,s=b.Promise,a=b.compact,b.readAsBinaryString,b.arrayToMap,b.binary,b.neq,b.ApplicationState,b.pending,b.success,b.failure,b.zoPickImage,r=b.Engine,b.Canvas,b.rgbColor,b.isColor,b.object,b.EncodedImage.toImage,b.isString,b.deepEach,b.colorRegExp,h=b.max,f=b.models,m=r.newElement,w=u({suffix:"Factory"},"Element BitmapElement",function(t,e,n){return m(t,e,n)}),i=w.ElementFactory,e=w.BitmapElementFactory,g=function(t){var e,n,i,r,o;for(n=r=0,o=(e=(i=t.imageData).data).length;r<o;n=r+=4)e[n],e[n+3]>2&&(e[n+3]=255);return t.putImageData(i)},c(t,function(){var t,n;function OptimizedTemplateTools(){}return OptimizedTemplateTools.encodeImage=function(t,e){return null==e&&(e=!1),e?t.toPng():s.all([t.toPng(),t.toJpg()]).then(function(t){var e,n;return n=t[0],e=t[1],n.length<e.length?n:e})},OptimizedTemplateTools.getOptimizedTemplate=function(n){var r;return null==n&&(n=1024),r=function(t,e){var n,i;return l([(null!=(i=t.userProps)?i.dropInEnabled:void 0)?e(t):void 0,function(){var i,o,s,a;for(a=[],i=0,o=(s=t.children).length;i<o;i++)n=s[i],a.push(r(n,e));return a}()])},s.all([f.elementEditState.getElementTreePromise(),f.elementEditState.getElementTreePromise({withFills:!0}),f.elementEditState.getElementTreePromise({dropInsOnly:!0})]).then(function(o){var l,u;return l=o[0],u=o[1],o[2],n=l.currentSize.withArea(y(n).area).rounded,s.all([l.toBitmapBasic({size:n,area:"logicalArea"}),u.toBitmapBasic({size:n})]).then(function(o){var l,c,h;return h=o[0],c=o[1],l=c.getImageData(),s.all(r(u,s.serialize(function(e){return t(e,c,l,u,n)}))).then(function(t){var n,r,o,s,l,u,p,d;return t=a(t),i({size:h.size,clip:!0},e({size:h.size,bitmap:c}),function(){var a,c,h,f;for(f=[],s=a=0,c=t.length;a<c;s=++a)h=t[s],u=h.mask,o=h.dropInMaskArea,n=h.dropInContents,r=h.dropInContentsEncoded,p=h.maskEncoded,l=o.location,d=o.size,f.push(i({compositeMode:"add",userProps:{dropInEnabled:!0},size:d,location:l},e({size:d,bitmap:n,userProps:{encodedBitmap:r}}),e({size:d,bitmap:u,userProps:{encodedBitmap:p},compositeMode:"targetTopIntersection"})));return f}())}).then(function(t){return t.onNextReady()})})})},t=function(t,e,i,r,a){var l,u,c,h,d,m,y,b;if(h=t.key,m=t.find("dropInFill")[0],(d=t.getDrawAreaIn(t.getElementToElementMatrix(r)).mul(y=a.minRatio(r.currentSize)).roundOut().intersection(S(a))).size.gt(v))return c=f.elementEditState.getElementTreeForDropInContents(h),u=r.bitmapFactory.newBitmap(d.size),b=r.bitmapFactory.newBitmap(d.size),l=o.scale(y).translate(d.location.neg),m.draw="white",r.onNextReady(function(){var t,o,a,f,y,v;return r.drawOnBitmap(b,l),c.drawOnBitmap(u,l),m.draw="black",y=v=n(b,e,i,o=d.location),d=y.dropInMaskArea,f=(a=y.mask).clone(),g(f),t=f.drawBitmap(o.sub(d.location),u,{compositeMode:"sourceTopInTarget"}),s.all([t.toJpg(),a.toPng()]).then(function(e){var n,i;return n=e[0],i=e[1],p(v,{dropInId:h,dropInContents:t,dropInContentsEncoded:n,maskEncoded:i})})})},n=function(t,e,n,i){var r,o,s,a,l,u,c,p,f,m,g,y,v,b,w,x,P,C,_;for(p=(f=t.getImageData()).data,s=n.data,y=4*t.size.x|0,l=4*e.size.x|0,m=0,a=i.y*l+4*i.x|0,g=t.size.y*y|0,0,1,2,3,0,w=0|t.size.x,x=0|t.size.y,v=-1,b=-1,r=0,_=0,c=0,u=0,o=0;m<g;){for(u=(c=m)+y,o=a,C=0;c<u;)r=(h(0,p[c+0]-s[o+0])+h(0,p[c+1]-s[o+1])+h(0,p[c+2]-s[o+2]))/3|0,p[c+0]=0,p[c+1]=0,p[c+2]=0,p[c+3]=r,r&&(w=0|d(w,C),v=0|h(v,C),x=0|d(x,_),b=0|h(b,_)),0,c+=4,o+=4,C++;m+=y,a+=l,_++}return P=S(w,x,1+v-w,1+b-x),t.putImageData(f),{mask:t.crop(P),dropInMaskArea:S(i.add(P.location),P.size)}},OptimizedTemplateTools}())}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ApplicationState"],[e,n(1067)],t=>{return i.defClass(class Preferences extends t{},function(t,e,n){this.stateFields({defaultTextProps:{}}),this.prototype.saveDefaultTextProps=function(){return this.defaultTextProps=this.models.elementEditState.selectedElementTextProps}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(function(t){var e,i,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q={}.hasOwnProperty,H=[].slice;(N=n(802)).log,T=N.defineModule,j=N.shallowClone,N.timeout,N.bound,P=N.arrayWith,C=N.arrayWithout,E=N.currentSecond,I=N.flatten,L=N.present,N.toObject,M=N.merge,_=N.createObjectTreeFactories,z=N.objectWithout,e=N.ApplicationState,u=N.Engine,N.clone,w=N.TextElement,i=N.BitmapElement,c=N.FillElement,m=N.OutlineElement,S=N.ShadowElement,o=N.BlurElement,p=N.FilterElement,a=N.Element,y=N.RectangleElement,D=N.rect,O=N.point,(U=n(596)).ImikimiPalette,f=U.Icons,A=u.newElement,l=(W=_({suffix:"AE"},"TextElement RectangleElement FilterElement FillElement BitmapElement OutlineElement Element ShadowElement BlurElement",function(t,e,n){return A(t,e,n)})).ElementAE,v=W.RectangleElementAE,x=W.TextElementAE,r=W.BitmapElementAE,h=W.FillElementAE,g=W.OutlineElementAE,b=W.ShadowElementAE,s=W.BlurElementAE,d=W.FilterElementAE,k={artEngine:{text:x,bitmap:r,fill:h,outline:g,shadow:b,blur:s,rectangle:v,element:l,filter:d},artReact:{text:w,bitmap:i,fill:c,outline:m,shadow:S,blur:o,element:a,rectangle:y,filter:p}},F=0,B=function(t){return M(t,{id:L(t.id,"id"+F++),type:L(t.type,"fill").toLowerCase()})},R=function(t){var e,n,i,r,o;return o=t.text,e=t.bitmap,i=t.children,r={text:o,bitmap:e,children:function(){var t,e,r,o;for(o=[],t=0,e=(r=i||[]).length;t<e;t++)n=r[t],o.push(B(n));return o}()},e||r.text||(r.text=""),M(t,r)},T(t,function(t){var n,i,r,o,s,a;function ShapeEditorState(){return ShapeEditorState.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)q.call(e,n)&&(t[n]=e[n]);function ctor(){this.constructor=t}ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype}(ShapeEditorState,e),ShapeEditorState.stateFields({shapeOptions:n=R({fontFamily:"Arial Unicode MS",children:[{type:"fill",color:"#ddd"},{type:"outline",lineWidth:5,color:"#777",lineJoin:"round"}]}),undoAvailable:!1,redoAvailable:!1,shapeHistory:[],shapeFuture:[],isDropIn:!1}),a=function(t,e){return null==t&&(t=e),(null!=t?t.ww:void 0)&&(null!=t?t.hh:void 0)?O(t.ww,t.hh):O(t)},ShapeEditorState.prototype.generateShapeElements=o=function(t,e,n){var i,r,o,s,l,u,c,h,p,d,m,g,y,v,S,b,w,x,P,C,_,E,T,I,M,A,F,B,R,L,N,U;if(null==e&&(e="artReact"),d=(g=k[e]).element,n&&(I=n.rootProps,u=n.dropInColor,h=n.dropInContentsOnly,p=n.dropInTopOnly),r=t.bitmap,L=!1,v=!1,S=!1,R=null!=(P=t.stretch)?P:0,F=null!=(C=t.flip)&&C,A=null!=(_=t.angle)?_:0,B=function(t,e){var n,i;return i=(n=t.div(e).min())*(F?-1:1),R<0?{x:i,y:n*(1+.9*R)}:{y:n,x:i*(1-.9*R)}},T=function(){var e,n;return e=1<=arguments.length?H.call(arguments,0):[],t.text,null!=(n=t.angle)?n:0,r?g.rectangle.apply(g,[z(t,"children","opacity"),{size:r.size.fitInto(O(100)),axis:.5,location:{ps:.5},angle:A,scale:B}].concat(H.call(e))):g.text.apply(g,[z(t,"children","opacity","text"),{layoutMode:"tight",size:{cs:1},text:t.text||"",axis:.5,fontSize:200,location:{ps:.5},angle:A,scale:B,color:"#ddd"}].concat(H.call(e)))},x=d({size:100},I,{opacity:null!=(E=t.opacity)?E:1},p?void 0:r?g.bitmap({size:r.size.fitInto(O(100)),bitmap:r,location:{ps:.5},axis:.5,angle:A,scale:B}):0===t.children.length||1===t.children.length&&"drop-in"===t.children[0].type?T():void 0,function(){var e,n,r,d;for(d=[],e=0,n=(r=t.children).length;e<n;e++)if(o=r[e],!L)if("drop-in"===(U=o.type))v=!0,p?d.push(void 0):(l=o.bitmap,w=o.location,M=o.scale,i=o.angle,c=u?g.rectangle({axis:.5,location:{ps:.5},size:{ps:10},color:u,compositeMode:"sourceTopInTarget"}):[l?g.bitmap({inFlow:!1,compositeMode:"sourceTopInTarget",bitmap:l,scale:null!=M?M:1.5,location:w||{ps:.5},angle:null!=i?i:0,axis:.5,size:function(t,e){return e.mul(t.div(e).max())}}):g.element({compositeMode:"sourceTopInTarget"},g.text(f.image,{size:{cs:1},axis:.5,location:{ps:.5},opacity:.5,scale:function(t,e){return 1*t.div(e).min()/3}}))],h?(L=!0,d.push([g.filter({filter:function(t){var e,n,i,r,o;for(n=r=0,o=(e=(i=t.imageData).data).length;r<o;n=r+=4)0<e[n+3]&&(e[n+3]=255);return t.putImageData(i)}}),c])):d.push(c));else if(!p||v)switch(S=!0,U){case"outline":y=null,o.colors&&(s=o.colors,b=o.from,N=o.to,(o=z(o,"colors","from","to")).color="black",N=a(N,"topCenter"),b={ww:1*(b=a(b,"bottomCenter")).x/3+1/3,hh:1*b.y/3+1/3},N={ww:1*N.x/3+1/3,hh:1*N.y/3+1/3},y={colors:s,from:b,to:N}),d.push(T(null,{compositeMode:o.compositeMode},g.outline(z(o,"compositeMode")),y?g.element({compositeMode:"sourceTopInTarget",draw:{rectangle:function(t){return D(t).expand(t)},fill:y}}):void 0));break;case"fill":d.push(T(o));break;default:m=g[U]||function(){throw new Error("no elementFactory for: "+o.type)}(),d.push(m(z(o,"key","id","name")))}else d.push(void 0);return d}()),!p||S)return x},i=function(t,e){var n,i,r,o,s,a,l,u;for(n=t.imageData,o=e.imageData,i=n.data,s=o.data,a=l=0,u=i.length;l<u;a=l+=4)r=i[a],i[a+3]=Math.max(r-s[a],i[a+1]-s[a+1],i[a+2]-s[a+2])*i[a+3]/255,i[a]=i[a+1]=i[a+2]=0;return t.context.putImageData(n,0,0),t},ShapeEditorState.getter({shapeElements:function(t){return o(this.shapeOptions,"artEngine",t)},shapeBitmapPromise:function(){return r(this.shapeOptions)}}),ShapeEditorState.prototype.generateShapeBitmaps=r=function(t){var e,n,r,s;for(e=!1,n=0,r=(s=t.children).length;n<r;n++)if("drop-in"===s[n].type){e=!0;break}return e?o(t,"artEngine").onNextReady().then(function(e){var n,i;return n=e.elementSpaceDrawArea,Promise.all([o(t,"artEngine",{dropInColor:"#fff"}).toBitmapBasic({size:1024,drawArea:n}),o(t,"artEngine",{dropInColor:"#000"}).toBitmapBasic({size:1024,drawArea:n}),e.toBitmapBasic({size:1024,drawArea:n}),o(t,"artEngine",{dropInContentsOnly:!0}).toBitmapBasic({size:1024,drawArea:n}),null!=(i=o(t,"artEngine",{dropInTopOnly:!0}))?i.toBitmapBasic({size:1024,drawArea:n}):void 0])}).then(function(t){var e,n,r,o,s,a;return a=t[0],r=t[1],e=t[2],o=t[3],s=t[4],{bitmap:e.crop(n=e.autoCropRectangle),maskBitmap:i(a,r).crop(n),dropInContentsBitmap:o.crop(n),dropInTopBitmap:null!=s?s.crop(n):void 0}}):o(t,"artEngine").toBitmapBasic({size:1024}).then(function(t){return{bitmap:t.crop()}})},ShapeEditorState.prototype.getElementEditState=function(t){return null==t&&(t=this.shapeOptions),r(t).then((e=this,function(n){return M(n,{isDropIn:!!n.maskBitmap,custom:{options:{editShapeOptions:t},edit:e.models.kimiEditorNavState.showShape}})}));var e},s=E(),ShapeEditorState.setter({shapeOptions:function(t){var e;return(e=E())-s<1/3||this.saveUndo(),this.setState({shapeOptions:R(t)}),s=e}}),ShapeEditorState.getter({shapeChildren:function(){return this.shapeOptions.children||[]}}),ShapeEditorState.prototype.resetWithShapeOptions=function(t){return null==t&&(t=n),this.setState({shapeOptions:R(t),undoAvailable:!1,redoAvailable:!1,shapeHistory:[],shapeFuture:[]})},ShapeEditorState.prototype.saveUndo=function(){return this.setState({shapeHistory:P(this.shapeHistory,this.shapeOptions),shapeFuture:[],undoAvailable:!0,redoAvailable:!1})},ShapeEditorState.prototype.getChildIndex=function(t){var e,n,i,r;for(e=n=0,i=(r=this.shapeChildren).length;n<i;e=++n)if(r[e].id===t)return e;throw new Error("child with id:"+t+" not found")},ShapeEditorState.prototype.getChild=function(t){return this.shapeChildren[this.getChildIndex(t)]},ShapeEditorState.prototype.moveToFront=function(t){return this.updateShapeOptions({children:I(C(this.shapeChildren,this.getChildIndex(t)),this.getChild(t))})},ShapeEditorState.prototype.moveToBack=function(t){return this.updateShapeOptions({children:I(this.getChild(t),C(this.shapeChildren,this.getChildIndex(t)))})},8,ShapeEditorState.prototype.addChild=function(t){var e;return t=B(t),(e=this.shapeChildren).length<8?this.updateShapeOptions({children:P(e,t)}):(Neptune.Art.Flux.models.navState.showSystemMessage({message:"There can be no more than 8 fills and outlines."}),!1)},ShapeEditorState.prototype.addOutline=function(){return this.addChild({type:"outline",color:"black",miterLimit:3})},ShapeEditorState.getter({isDropIn:function(){var t,e,n;for(t=0,e=(n=this.shapeChildren).length;t<e;t++)if("drop-in"===n[t].type)return!0;return!1}}),ShapeEditorState.prototype.toggleIsDropIn=function(){var t;return this.isDropIn?this.updateShapeOptions({children:function(){var e,n,i,r;for(r=[],e=0,n=(i=this.shapeChildren).length;e<n;e++)"drop-in"!==(t=i[e]).type&&r.push(t);return r}.call(this)}):this.addChild({type:"drop-in"})},ShapeEditorState.prototype.addShadow=function(){return this.addChild({type:"shadow",color:"#0004",location:5})},ShapeEditorState.prototype.addBlur=function(){return this.addChild({type:"blur",radius:2})},ShapeEditorState.prototype.addFill=function(){return this.addChild({type:"fill",color:"white"})},ShapeEditorState.prototype.removeChild=function(t){return this.updateChild(t)},ShapeEditorState.prototype.updateChild=function(t,e){var n,i;return n=this.getChildIndex(t),e?(i=j(this.shapeChildren))[n]=M(i[n],e):i=C(this.shapeChildren,n),this.updateShapeOptions({children:i})},ShapeEditorState.prototype.updateShapeOptions=function(t){return this.shapeOptions=M(this.shapeOptions,t)},ShapeEditorState.prototype.undo=function(){var t,e,n,i,r,o;if(this,r=this.shapeHistory,i=this.shapeFuture,o=this.shapeOptions,r.length>0)return e=2<=r.length?H.call(r,0,t=r.length-1):(t=0,[]),n=r[t++],this.setState({shapeHistory:e,shapeOptions:n,shapeFuture:P(i,o),undoAvailable:e.length>0,redoAvailable:!0})},ShapeEditorState.prototype.redo=function(){var t,e,n,i,r,o;if(this,r=this.shapeHistory,i=this.shapeFuture,o=this.shapeOptions,i.length>0)return e=2<=i.length?H.call(i,0,t=i.length-1):(t=0,[]),n=i[t++],this.setState({shapeHistory:P(r,o),shapeOptions:n,shapeFuture:e,redoAvailable:e.length>0,undoAvailable:!0})},ShapeEditorState}())}).call(this,n(2)(t))},function(t,e,n){(t.exports=n(840)).addModules({DropInFilter:n(1149),DropInInverseMaskFilter:n(1150)})},function(t,e,n){"use strict";(function(t){let e=n(3);e.defMod(t,()=>e.defClass(class DropInFilter extends n(341).FilterElement{},function(t,e,n){this.prototype.filterPixelData=function(t,e){let n,i,r,o,s,a;for(({w:n,h:i}=t.size),r=i/2|0,o=n/2|0,s=i,a=0;a<s;){let t,i,s;for(t=a,i=n,s=0;s<i;){let i,a,l,u,c;(i=s)<o==t<r&&(l=e[0+(a=4*(n*t+i))],u=e[a+1],c=e[a+2],e[a]=255-l,e[a+1]=255-u,e[a+2]=255-c),s++}a++}return e}}))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["rect","point0","Matrix"],[e,n(801)],(t,e,r)=>{let o,s,a;return o=20,s=40,a=function(e,n,i,r){let o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b;if(!((s=(o=t(n,i,r.size.w,r.size.y)).intersection(t(e.size))).area<=0)){for(a=s.withLocation(s.location.sub(o.location)),l=e.getImageData(),u=r.getImageData(),c=l.data,h=u.data,p=4,d=4*s.w,f=4*e.size.x,m=4*r.size.x,g=f*s.y+4*s.x,y=m*a.y+4*a.x,v=g+f*s.h,S=g,b=y;S<v;){let t,e,n;for(t=S,e=b,n=S+d;t<n;){let n;n=255-h[e+3],c[t+3]=n,c[t]=255*c[t]/n|0,c[t+1]=255*c[t+1]/n|0,c[t+2]=255*c[t+2]/n|0,t+=4,e+=4}S+=f,b+=m}return e.putImageData(l)}},i.defClass(class DropInInverseMaskFilter extends n(341).AtomElement{},function(t,n,i){this.getter({requiresParentStagingBitmap:function(){return!0}}),this.drawProperty({mask:{default:null},maskLocation:{default:e}}),this.prototype.fillShape=function(t,e,n){let i,o,s,l,u,c;if(i=e.exactScaler,({mask:o,maskLocation:s}=this),o)return u=(l=r.translate(s).mul(e)).transformBoundingRect(o.size).roundOut(),(c=t.newBitmap(u.size)).drawBitmap(l.translate(u.location.neg),o),a(t,u.x,u.y,c)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{let t;return i.importInvoke(["PosterTextLib"],t=[e,n(1026),n(779),n(576),n(313),n(1152)],e=>i.importInvoke(["Math","toSeconds","FluxComponent","randomElement","posterTextStyles","point0","timeout","merge","point","rgbColor","compactFlatten","intRand","shadeColor","getPosterTextColorPalette","neq","getExpandColorPalette","TextPalette","Element","MembershipRequiredButton","TabButton","PosterTextPreview","PosterTextToolbar"],[t,e],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P)=>{let C,_;return C=t.abs,_=e("2018-12-16"),i.defClass(class PosterText extends(n(594)(r)){},function(t,n,r){let E;this.subscriptions("viewState.viewState","newPostState.selectedImageInfo","posterTextState.posterTextState","currentSession.grantMemberAccess","currentSession.currentUserId","navState.overlay"),this.getter({reEditing:function(){let t;return i.exists(t=this.selectedImageInfo)&&t.hasPosterText},bitmap:function(){let t,e,n;return null!=(t=i.exists(e=this.selectedImageInfo)&&e.originalBitmap)?t:i.exists(n=this.selectedImageInfo)&&n.bitmap},colorInfo:function(){let t;return null!=(t=this.props.colorInfo)?t:this.models.newPostState.selectedImageInfo.colorInfo},freeToEveryone:function(){return e()<_},membershipRequired:function(){return this.posterTextStyle&&!(this.posterTextStyle.free||this.grantMemberAccess)}}),this.stateFields({colorPalette:null,expandedColorPalette:null,randomColorStyleCount:0,selectedQuoteCategory:null,quoteCountByCategory:{},bitmapIsBright:null,averagePerceptualLightness:null,fullscreen:!1,movingText:!1,blurredBitmap:null,posterTextBitmap:null,hideFreeToEveryone:!1,savedBackgroundColor:null}),this.getFullscreen=function(){return!0},E={posterTextText:null,posterTextSeedsByStyleName:{},posterTextStyle:o(i.array(s)),posterTextLocation:a,posterTextScaleStep:1,posterTextForeground:"white",posterTextForegroundShade:.5,posterTextBackground:null,posterTextBackgroundOpacity:1,posterTextBackgroundShade:.5,posterTextCornersRounded:!0,posterTextBackgroundBlur:null},this.getter(i.object(["shadedPosterTextForeground","shadedPosterTextBackground","posterTextScale","posterTextOutsideScale","shadedPosterTextBackgroundWithAlpha","posterTextLocationMode"],t=>(function(){return this.models.posterTextState[t]}))),this.getter(i.object(E,(t,e)=>(function(){return this.posterTextState[e]}))),this.setter({posterTextState:function(t){return this.models.posterTextState.setState(t)}},i.object(E,(t,e)=>(function(t){return this.models.posterTextState[e]=t}))),this.prototype.componentWillMount=function(){switch(this.createEvent("start:posterText"),this.freeToEveryone&&l(1e4,()=>this.triggerHideFreeToEveryone()),!1){case!this.models.newPostState.isNewKimiUse:this.createEvent("start:from:kimiUse");break;case!this.models.newPostState.isNewTemplate:this.createEvent("start:from:templateShouldntHappen");break;default:this.createEvent("start:from:photo")}return this.posterTextState.randomize?(this.createEvent("start:init:random"),this.posterTextState=u(u(this.getRandomForegroundBackground(),{posterTextStyle:s.AsYouLikeIt,posterTextLocation:c(.5),randomize:!1}))):this.createEvent("start:init:edit"),r.componentWillMount.apply(this,arguments)},this.getter({randomPosterTextBackground:function(){let t,e;return i.exists(e=this.colorInfo)&&(t=e.colors),h(o(p([i.array(t),"#1","#e"])))},randomPosterTextForeground:function(){let t,e;return i.exists(e=this.colorInfo)&&(t=e.colors),h(o(p([i.array(t),"#07","#f7"])))},randomForegroundBackground:function(t){let e,n,r,o,s,a,l,u,c,h,p,m,g,y,v,S;return this.models.newPostState.selectedImageInfo?(e=this.averagePerceptualLightness,n=void 0!==(v=this.props.colorInfo)?v:this.models.newPostState.selectedImageInfo.colorInfo,r=this.randomPosterTextBackground,o=this.randomPosterTextForeground,s=(()=>{switch(d(t?4:2)){case 0:return"light";case 1:return null;case 2:return r=null,"light";case 3:return r=null}})(),a=i.exists(r)&&r.perceptualLightness,l=o.perceptualLightness,u=(()=>{switch(!1){case!s:return null!=r?0===d(2)?.9:.1:e>.8?.125:1;case!(null!=r):return l<a?.25:.75;default:return e<.75?1:l<.5?.5:l>.75?.1:.25}})(),h=(c=f(o,u)).perceptualLightness,p=s?50:75,g=r?(y=100*(h-(m=s?(a+e)/2:a)),(()=>{switch(!1){case!(p<C(y)):return.5;case!(p/2<C(y)):return y<0?.75:.25;case!(u>.5):return.1;default:return.9}})()):.5,{randomColorStyleCount:(null!=(S=this.state.randomColorStyleCount)?S:0)+1,posterTextCornersRounded:0===d(2),posterTextBackgroundOpacity:1,posterTextBlurredBackgroundOpacity:.5,averagePerceptualLightness:e,posterTextForegroundShade:u,posterTextForeground:o,posterTextBackgroundBlur:s,posterTextBackground:r,posterTextBackgroundShade:g}):{}}}),this.getter({outputBitmapPromise:function(){return this.refs.posterTextPreview.outputBitmapPromise}}),this.prototype.exit=function(){return this.models.navState.hidePosterText(),this.models.navState.showNewPost()},this.prototype.closePosterText=function(){return this.createEvent("exit:close"),this.exit()},this.prototype.exitWithoutText=function(){return this.createEvent("exit:trashText"),this.models.newPostState.selectedImageInfo.bitmap!==this.bitmap&&(this.models.newPostState.selectedImageInfo=u(this.models.newPostState.selectedImageInfo,{bitmap:this.bitmap,hasPosterText:!1})),this.exit()},this.prototype.save=function(){return this.createEvent("exit:save"),this.outputBitmapPromise.then(t=>(this.models.newPostState.selectedImageInfo=u(this.models.newPostState.selectedImageInfo,{bitmap:t,originalBitmap:this.bitmap,hasPosterText:!0}),this.exit()))},this.prototype.computeAveragePerceptualLightness=function(){let t,e,n,r;return(t=void 0!==(r=this.props.colorInfo)?r:this.models.newPostState.selectedImageInfo.colorInfo)&&(e=t.colors,n=t.colorMap)?i.reduce(n,(t,e)=>t+h(e).perceptualLightness,null,0)/9:void 0},this.prototype.preprocessState=function(t){let e,n,i,o,s,a,l,c,h,d;return e=t.veragePerceptualLightness,n=t.bitmapIsBright,i=t.expandedColorPalette,o=t.colorPalette,s=t.editStep,l=(a=t.selectedImageInfo).bitmap,c=a.originalBitmap,h=a.colorInfo,(l=null!=c?c:l)&&l!==this.bitmap&&(o=m(h),g(o,this.state.colorPalette)&&(i=p([o,y(h)])),d=this.computeAveragePerceptualLightness(t)),r.preprocessState.call(this,u(t,{colorPalette:o,expandedColorPalette:i,averagePerceptualLightness:d,bitmapIsBright:d>.7}))},this.prototype.renderViewOverlayButtons=function(){let t,e,n,i,r,o;return({gridSize:t,buttonSize:e,safePadding:n,viewWidth:i}=this.viewState),r={location:"topRight",axis:"topRight",icon:"close",radius:100,background:"#000d",color:v.white.secondary,action:this.closePosterText,size:t*((o=0!==n.top||0!==n.right||0!==n.left)?5:3.5),backgroundPadding:t*(o?1.25:.75)},S({receivePointerEvents:"passToChildren"},!this.membershipRequired||this.fullscreen||this.freeToEveryone&&this.hideFreeToEveryone?void 0:S({animators:{opacity:{toFrom:0,delay:.5}},size:"childrenSize",padding:t,location:"bottomCenter",axis:"bottomCenter"},b({text:"membership required for this style"})),this.fullscreen?void 0:w({key:"closeButton",iconScale:.5},r),!this.fullscreen&&this.reEditing?w(r,{key:"trashButton",location:"topLeft",axis:"topLeft",icon:"trash",action:this.exitWithoutText}):void 0,w(r,{key:"fullscreenButton",location:"bottomRight",axis:"bottomRight",icon:this.fullscreen?"triangleUp":"triangleDown",action:()=>(this.createEventOncePerHour("view:fullscreen"),this.toggleFullscreen())}))},this.prototype.render=function(){let t,e,n,i,r,o,s;return({gridSize:t,buttonSize:e,safePadding:n,viewWidth:i}=this.viewState),S({childrenLayout:"column",key:"posterTextTop",size:{ps:1}},S({key:"posterTextPreviewArea"},x({key:"posterTextPreview",bitmapIsBright:this.bitmapIsBright,averagePerceptualLightness:this.averagePerceptualLightness,safePadding:this.fullscreen?n:(({top:r,left:o,right:s}=n),{top:r,left:o,right:s})}),this.renderViewOverlayButtons()),P({fullscreen:this.fullscreen,getRandomForegroundBackground:this.getRandomForegroundBackground,expandedColorPalette:this.expandedColorPalette,save:this.save,membershipRequired:this.membershipRequired&&!this.freeToEveryone}))}})}))})}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(292)).addModules({ColorPicker:n(1153),ColorPickerWheel:n(1159),ColorShadePicker:n(1154),PickerButton:n(1160),PosterTextButtonLabel:n(1156),PosterTextComponent:n(1161),PosterTextGrid:n(1162),PosterTextIcon:n(1163),PosterTextLabel:n(1158),PosterTextNavButton:n(1164),PosterTextPhoneNav:n(1165),PosterTextPreview:n(1166),PosterTextQuotes:n(1167),PosterTextScrollableToolBar:n(1157),PosterTextStylePicker:n(1168),PosterTextToolbar:n(1170),PosterTextToolbarWrapper:n(1172),PosterTextVariableWidthButton:n(1169),PosterTextWidgets:n(1171),StepButton:n(1182),VSliderPicker:n(1155)}),n(1173)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","shadeColor","rgbColor","Element","ColorShadePicker"],[e,n(1026),{ColorShadePicker:n(1154)}],(t,e,r,o,s)=>{return i.defClass(class ColorPicker extends t{},function(t,a,l){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t,a,l,u,c,h,p,d,f,m,g;return t=(g=this.props).edgeShadows,a=g.label,l=g.colorPalette,u=g.shade,c=g.setShade,h=g.setColor,p=g.currentColor,d=g.afterChildren,f=e(r(null!=p?p:"red"),u),m=this.viewState.gridSize,n(1157)({edgeShadows:t,label:a},this.props.children,o("childrenSize","row",{draw:[{radius:m/2,fill:{color:"white",shadow:{color:"#0001"}}},"clip"]},i.array(l,t=>s(this.props,{color:t,showValue:t.eq(p),shade:u}))),d)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","bound","shadeColor","VSliderPicker"],[e,n(1026),{VSliderPicker:n(1155)}],(t,e,n,r)=>{return i.defClass(class ColorShadePicker extends t{},function(t,o,s){let a,l;this.propFields({color:null,shade:null}),this.prototype.setShade=function(t){let n;return i.isF((n=this.props).setShade)&&n.setShade(e(0,t,1))},this.prototype.setColor=function(t){let e;return i.isF((e=this.props).setColor)&&e.setColor(this.color)},a=.1,l=.98,this.prototype.render=function(){let t,e,i,o,s,a,l,u,c,h,p;return t=this.props.backgroundOpacity,({lightness:e}=i=n(this.color,this.shade)),r((({label:o,rounded:s,showValue:a,click:l,wide:u,width:c}=this.props),{label:o,rounded:s,showValue:a,click:l,wide:u,width:c}),{value:this.shade,showValue:a,select:this.setColor,setValue:this.setShade,handleColor:i,colors:(h=[],p=2,(()=>{for(;p>=0;){let i,r;i=p,h.push((({lightness:e}=r=n(this.color,i/2)),e<.1&&(r=r.withLightness(.1)),e>.98&&(r=r.withLightness(.98)),t<1?r.withAlpha(t):r)),p--}})(),h)})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","bound","GestureRecognizer","Number","Element","rect","PosterTextButtonLabel"],[e,n(1026),{PosterTextButtonLabel:n(1156)}],(t,e,n,r,o,s,a)=>{return i.defClass(class VSliderPicker extends t{},function(t,l,u){this.subscriptions("viewState.gridSize"),this.prototype.setValue=function(t){let n;return i.isF((n=this.props).setValue)&&n.setValue(e(0,t,1))},this.prototype.select=function(){let t;return i.isF((t=this.props).select)&&t.select()},this.prototype.getInitialState=function(){return{handlers:n.create({pointerClick:()=>{let t;return i.isF((t=this.props).click)&&t.click(this.props),this.select()},vertical:{finally:()=>this._tracking=!1,begin:t=>(this._tracking=!0,this._restoreValue=this.props.value,t.leftDeadzone?this.select():void 0),cancel:()=>this.setValue(this._restoreValue),move:({target:t,location:e,leftDeadzone:n})=>n?(this.select(),this.setValue(1-e.y/t.currentSize.y)):void 0}})}},this.prototype.render=function(){let t,e,n,l,u,c,h,p,d,f,m,g,y,v,S,b,w;return t=this.gridSize,e=(S=this.props).width,n=S.drawBackground,l=S.wide,u=S.label,c=S.colors,h=S.showValue,p=S.backgroundPattern,d=S.rounded,f=S.value,m=void 0!==(b=S.handleScale)?b:.8,g=void 0!==(w=S.handleColor)?w:"white",y=null!=e?e:t*(l?6:3),v=4*t,i.is(y,r)&&y==y||(y=50),i.is(v,r)&&v==v||(v=50),null!=f&&(i.is(f,r)&&f==f||(f=.5)),o({size:{w:y,h:v},cursor:"pointer",on:this.state.handlers,animators:this._tracking?void 0:"draw",draw:[{radius:(()=>{switch(d){case"left":return{left:t/2};case"right":return{right:t/2};default:return d?t/2:void 0}})()},"clip",p?{fill:{colors:{stripes:["#fff","#aaa","#fff","#aaa","#fff","#aaa","#fff","#aaa","#fff","#aaa"]},to:"bottomRight"}}:void 0,{colors:c},n,null!=f&&!1!==h?{circle:s({center:{x:.5*y,y:v*(1-f)},size:3*t*m}),fill:g}:void 0,"reset"]},u?a({label:u}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","TextPalette","Icons"],[e,n(1026)],(t,e,n,r,o,s)=>{return i.defClass(class PosterTextButtonLabel extends t{},function(t,i,a){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,i,a,l,u;return t=(u=this.props).alignLabel,i=u.label,a=u.icon,e({size:"parentWidthChildrenHeight",axis:"centerCenter",location:{xw:.5,yh:1,y:.75*this.gridSize}},e("topCenter","childrenSize","row",{childrenMargins:this.gridSize/4},this.props.alignLabel,n(r.tinyText,"childrenSize",{text:this.props.label,color:l=o.black.secondary}),a?n(s[a],"childrenSize",{fontSize:this.gridSize,color:l}):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ScrollerWithBar"],[e,n(1026)],(t,e,r)=>{return i.defClass(class PosterTextScrollableToolBar extends t{},function(t,i,o){this.subscriptions("viewState.gridSize","viewState.isTouchScreen"),this.prototype.render=function(){let t,i,o,s;return t=this.gridSize,i=(s=this.props).edgeShadows,o=s.label,e({padding:i?void 0:{h:t}},o?n(1158)({label:o}):void 0,r({scrollBarOpacity:this.isTouchScreen?0:.33,edgeShadows:i,noPadding:!i,childrenMargins:.5*t,padding:{h:i?t/2:0}},"row","childrenCenterCenter",this.props.children))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","TextPalette"],[e,n(1026)],(t,e,n,r,o)=>{return i.defClass(class PosterTextLabel extends t{},function(t,i,s){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){return e({size:{h:1.5*this.gridSize}},n(r.tinyText,{text:this.props.label,color:o.black.secondary},"textCenterCenter","parentSize"))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Bitmap","Math","hsl2Rgb","GestureRecognizer","Element","BitmapElement"],[e,n(1026)],(t,e,n,r,o,s,a)=>{let l;return l=function(t=128){let i,o,s,a,l,u,c,h,p,d;if(s=(o=(i=new e(128)).imageData).data,a=512,l=n.floor(64),u=2*n.PI,h=c=s,null!=c)for(p=c.length,d=0;d<p;){let t,e,i,o,a,h,p,f;t=c[d],i=(e=d)%512/4-l,o=(e/512|0)-l,h=.5+(a=n.atan2(o,i))/u,[t,p,f]=r(h,1,1),s[e]=255*t,s[e+1]=255*p,s[e+2]=255*f,s[e+3]=255,d+=4}return i.putImageData(o),i},i.defClass(class ColorPickerWheel extends t{},function(t,e,r){this.subscriptions("viewState.gridSize"),this.getter({hue:function(){let t,e;return null!=(t=i.exists(e=this.props.color)&&e.hue)?t:0}}),this.prototype.getInitialState=function(){return{handlers:o.create({pointerClick:({angle:t})=>{let e;return i.isF((e=this.props).setHue)&&e.setHue(i.mod(this.hue-(n.PI-t)/(2*n.PI),1))},rotate:{finally:()=>this._tracking=!1,begin:t=>(this._tracking=!0,this._restoreValue=this.hue),cancel:()=>{let t;return i.isF((t=this.props).setHue)&&t.setHue(this._restoreValue)},move:({angleDelta:t})=>{let e;return i.isF((e=this.props).setHue)&&e.setHue(i.mod(this._restoreValue+t/(2*n.PI),1))}}})}},this.prototype.render=function(){let t,e,i,r;return i=this,t=this.hue,e=this.gridSize,s({on:this.state.handlers,draw:[{shape:(t,e)=>{let i,r,o,s,a,l,u;return({top:i,left:r,right:o,bottom:s,vCenter:a,hCenter:l}=e),t.moveTo(l,a),u=o-l,t.arc(l,a,u,0,2*n.PI)}},"clip"],cursor:"pointer"},s({angle:-t*n.PI*2,axis:"centerCenter",location:"centerCenter",animators:this._tracking?void 0:"angle"},a({bitmap:null!=(r=this._hueBitmap)?r:this._hueBitmap=l()}),s({location:"centerCenter",axis:"centerRight",angle:t*n.PI*2,size:{ww:1,h:1.5*e,w:3*-e},draw:["circle","white"]})),s({location:"centerCenter",axis:"centerCenter",size:7*e,draw:["circle","#f9f9f9"]}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextPalette","ButtonWrapper","Element","ImikimiPalette","TextElement","Icons","PosterTextButtonLabel"],[e,n(1026),{PosterTextButtonLabel:n(1156)}],(t,e,n,r,o,s,a,l)=>{return i.defClass(class PickerButton extends t{},function(t,i,u){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,i,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P;return t=(x=this.props).wide,i=x.width,u=x.icon,c=void 0!==(P=x.iconColor)?P:e.black.secondary,h=x.action,p=x.children,d=x.selected,f=x.label,m=this.gridSize,n({size:g={h:4*m,w:null!=i?i:m*(t?6:3)},backgroundPadding:0,animators:"size"},(({action:h,backgroundColor:y,key:v,disabledOpacity:S=.5}=this.props),{action:h,backgroundColor:y,key:v,disabledOpacity:S}),r({childrenLayout:"column",childrenAlignment:"centerCenter"},r({size:g,draw:[{radius:m/2},"clip","children",{radius:m/2,outline:{lineWidth:4,color:o.primary.withAlpha(d?1:0)}}],animators:["draw","opacity"]},p)),u?s(a[u],{color:c,animators:{angle:{duration:.5}}},"childrenSize","centerCenter",(({iconScale:b=1,angle:w}=this.props),{scale:b,angle:w})):void 0,f?l({label:f,alignLabel:this.props.alignLabel},{icon:this.props.showMiniIcon?u:void 0}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent"],[e,n(1026)],t=>{return i.defClass(class PosterTextComponent extends(n(594)(t)){},function(t,e,n){this.abstractClass(),this.eventKey("posterText"),this.getter({posterTextState:function(){return this.models.posterTextState}})})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","Math"],[e,n(1026)],(t,e,n)=>{return i.defClass(class PosterTextGrid extends t{},function(t,i,r){this.prototype.render=function(){let t,i,r,o,s,a;return t=(r=this.props).scale,i=r.color,e((o=[],s=0,a=1===t?.5:t,(()=>{for(;a>0&&s<1||a<0&&s>1;){let t;t=s,.05<n.abs(t)&&.95>n.abs(t)&&o.push([e({size:{w:1},location:{xw:t,x:-1},draw:i}),e({size:{h:1},location:{yh:t,y:-1},draw:i})]),s+=a}})(),o))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ButtonWrapper","Element","merge","TextPalette","ImikimiPalette","TextElement","Icons","Math","NewFeature","Date"],[e,n(1026)],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class PosterTextIcon extends t{},function(t,i,p){this.subscriptions("viewState.viewState"),this.stateFields({loaded:!1,activeCount:0,seedCount:0}),this.prototype.componentWillMount=function(){return this.props.style.load().then(this.triggerLoaded),p.componentWillMount.apply(this,arguments)},this.prototype.preprocessProps=function(t){return this.props.seed!==t.seed&&this.seedCount++,p.preprocessProps.apply(this,arguments)},this.prototype.action=function(){return this.props.action(),this.activeCount++},this.prototype.render=function(){let t,i,p,d,f,m,g,y,v,S,b;return v=this.props,t=v.style,i=v.selected,p=v.action,d=v.seed,f=v.selectedColor,m=(S=this.viewState).gridSize,g=S.viewWidth,e({action:this.action,size:4.5*m,backgroundPadding:0,selectedColor:f,selected:i},n({padding:m/2,draw:i?["children",{radius:m/2,outline:r({lineWidth:2},t.free?{color:o.black.tertiary}:{colors:s.goldGradient,to:"bottomRight"})}]:void 0},n({cursor:"pointer",size:"childrenSize",location:"centerCenter",axis:"centerCenter",scale:(t,e)=>t.minRatio(e)},this.loaded?t.sampleRender(d).layoutAndRender():a({size:"childrenSize",text:"not loaded"})),i?[n(y={size:"childrenSize",padding:m/3,location:{ps:1,plus:-m/2},axis:"centerCenter"},{compositeMode:"targetWithoutSource",draw:["circle",{outline:{color:"red",lineWidth:6}}]},a(l.redo,{fontSize:16,color:o.white.primary})),n(y,{animators:{angle:{duration:.5}},angle:2*u.PI*(null!=(b=this.seedCount)?b:0),draw:["circle","#0"]},a(l.redo,{compositeMode:"targetWithoutSource",fontSize:16}))]:void 0,(()=>{switch(t.name){case"DinnerWithTheBassetts":case"AVisitFromSaintNicholas":return c("bottomCenter",{addedAt:h.parse("2018-12-10"),memberFeature:!0})}})()))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ButtonWrapper2","Element","TextElement","Icons","TextPalette","TextStyles"],[e,n(1026)],(t,e,n,r,o,s,a)=>{return i.defClass(class PosterTextNavButton extends t{},function(t,i,l){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,i,l,u,c,h,p,d;return t=this.gridSize,i=(d=this.props).icon,l=d.text,u=d.action,c=d.angle,h=d.iconRight,e({key:h?"nextButtonWrapper":"prevButtonWrapper",backgroundColor:h&&"#e",action:u,disabledOpacity:0},p=h?"parentSize":"parentHeightChildrenWidth",n({key:"fuzbut",padding:{h:t}},p,h?void 0:"row",h?void 0:{childrenMargins:this.gridSize},i&&r(o[i],"childrenSize",h?"centerRight":"centerLeft",{key:"textIconButt",angle:null!=c?c:0,animators:{angle:{duration:.5}},color:s.black.secondary}),r(a.smallText,p,"textCenterCenter",{text:l,color:s.black.primary})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","present","Element","max","TextElement","TextStyles"],[e,n(1026)],(t,e,r,o,s,a)=>{return i.defClass(class PosterTextPhoneNav extends t{},function(t,l,u){this.subscriptions("viewState.viewState","posterTextState.posterTextText"),this.propFields("nextStep","prevStep","goToNextStep","goToPrevStep","prevStepName","nextStepName","safePadding"),this.getter({canGoPrev:function(){return!!this.prevStep},canGoNext:function(){return!!this.nextStep&&e(this.posterTextText)}}),this.prototype.render=function(){let t,e,l,u;return t=(u=this.viewState).gridSize,e=u.buttonSize,r({key:"PosterTextPhoneNav",size:{h:e+(l=o(this.safePadding.bottom,t))},padding:{h:t,bottom:l}},this.canGoPrev||this.canGoNext?r("row",{size:{wcw:1,h:e},childrenMargins:t},this.canGoPrev&&n(1164)({key:`prevButton ${i.toString(this.prevStep)}`,icon:"angleLeft",action:this.goToPrevStep,text:this.prevStepName}),this.canGoNext&&n(1164)({icon:"angleRight",key:`nextButton ${i.toString(this.nextStep)}`,iconRight:!0,action:this.goToNextStep,text:"save"===this.nextStep?"last: save":"next: "+this.nextStepName})):r(s(a.mediumText,"parentSize","textCenterCenter",{padding:{bottom:this.safePadding.bottom},text:"start by selecting a theme"})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Math","point","point1","point0","present","merge","generateBlurredBitmap","neq","toSeconds","bound","max","min","rect","floatEq","float32Eq","Element","BitmapElement","Number","ReschedulableTimer"],[e,n(1026)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w)=>{let x,P,C,_;return x=400,P=function(t,n){let i,r,o,s,a,l,u;for(i=null,r=null,s=[],u=(l=0)<(a=o=2/t+.5|0)?1:-1;u>0&&l<=a||u<0&&l>=a;){let t,a;t=l,s.push((t/=o,a=e.abs(n-t),null==r||a<r?(i=t,r=a):void 0)),l+=u}return i},C=function(t,e,n,i,r){let o,s;return o=P(r,(t+e/2)/n),s=t+e,(()=>{switch(!1){case!(t<=0):return 0;case!(s>=n):return n-e;case!(.5===o):return o*n-e/2;case!(t<=i):return i;case!(s>=n-i):return n-e-i;default:return o*n-e/2}})()},_=function(t,e,n,i,o){return r(C(t.x,e.x,n.x,i,o),C(t.y,e.y,n.y,i,o))},i.defClass(class PosterTextPreview extends(n(594)(t)){constructor(){super(...arguments),this._updateTextBitmapTimer=new w,this._updateRateMs=100}},function(t,e,w){let x,P;this.subscriptions("posterTextState.posterTextState","newPostState.selectedImageInfo","viewState.viewState"),this.eventKey("posterText"),this.propFields({bitmapIsBright:!1,averagePerceptualLightness:!1}),this.stateFields({viewWindowSize:o,blurredBitmap:null,posterTextBitmap:null,movingText:!1,movingOffset:s}),this.getter({readyToRender:function(){return this.posterTextBitmap&&this.bitmap&&a(this.posterTextText)},snapScale:function(){return 1/6},posterTextGridColor:function(){return this.bitmapIsBright?"#1117":"#eee7"},outputBitmapPromise:function(){return this.renderMainPreview(l({viewWindowSize:this.bitmap.size.area>2*i.pow(2,20)?this.bitmap.size:this.bitmap.size.withArea(3*i.pow(2,20))},"inside"===this.posterTextLocationMode?this.layoutInsideText():this.layoutOutsideText()))._instantiate().onNextReady().then(t=>t.element.toBitmapBasic())},shadedPosterTextBackgroundWithAlpha:function(){return this.shadedPosterTextBackground.withAlpha(this.posterTextBackgroundBlur?.65*this.posterTextBackgroundOpacity+.2:.8*this.posterTextBackgroundOpacity+.2)}}),this.getter(i.object(["posterTextScale","posterTextCornersRounded","bitmap","posterTextBackgroundOpacity","shadedPosterTextBackground","posterTextBackground","posterTextBackgroundBlur","shadedPosterTextForeground","posterTextLocationMode","posterTextLocation","posterTextText","posterTextStyle","posterTextScale"],t=>(function(){return this.models.posterTextState[t]}))),this.prototype.preprocessState=function(t){let e,n,r,o,s,a;return(i.exists(s=t.posterTextState)?e=s.posterTextBackgroundBlur:void 0)&&(n="heavy"===e?.1:.05,t=l(t,{blurredBitmap:r=null!=(a=t[o=`blurredBitmap${i.toString(100*n|0)}`])?a:u(this.bitmap,n),[o]:r})),this.preparePosterTextBitmap(t),w.preprocessState.call(this,t)},this.prototype.preparePosterTextBitmap=function(t){let e,n,r,o,s,l,u,d;return i.exists(l=t.viewState)&&(e=l.viewSize),(n=null!=(u=t.posterTextState)?u:{}).posterTextStyle&&e&&c((({posterTextStyle:r,posterTextSeedsByStyleName:o,posterTextText:s}=null!=(d=this.posterTextState)?d:{}),{posterTextStyle:r,posterTextSeedsByStyleName:o,posterTextText:s}),(({posterTextStyle:r,posterTextSeedsByStyleName:o,posterTextText:s}=n),{posterTextStyle:r,posterTextSeedsByStyleName:o,posterTextText:s}))&&a(s)&&this._updateTextBitmapTimer.timeout(this._updateRateMs,()=>{let t;return t=h(),r.load().then(()=>r.renderAndLayout({seed:o[r.name],text:s})._instantiate().onNextReady()).then(t=>{let e;return e=this.bitmap.size.minRatio(t.element.currentSize),t.element.toBitmapBasic({size:t.element.drawArea.size.withArea(2*i.pow(1024,2))})}).then(t=>t.crop()).then(e=>{let n;return this.posterTextBitmap=e,n=1e3*(h()-t)|0,this._updateRateMs=p(25,1.5*n,250)})}),null},this.prototype.layoutOutsideText=function(){let t,e,n,i,o,s,a,l,u,c,h,p,m,g,y,v,S,b,w,x,P,C,_,E,T;return T=this,t=this.posterTextScale,e=this.posterTextCornersRounded,n=this.posterTextBitmap,i=this.bitmap,"left"===(o=this.posterTextLocationMode)||"right"===o?(s=!0,a="y",l="x",u=((t,e)=>r(e,t)),c=(t=>{let e,n;return({x:e,y:n}=t),e/n})):(a="x",l="y",u=((t,e)=>r(t,e)),c=(t=>{let e,n;return({x:e,y:n}=t),n/e})),p=(1/t-1)/2,(h=e?25:0)>0||(p=d(p,1/32)),m=c(n.size.add(2*n.size.min()*p)),S=p*(v=u(y=(g=f(m,d(3,c(i.size)/2)))/m*400,y*m)).min()/(1+2*p),b=v.sub(2*S),w=h,P=u(2*h+400,2*h+(x=u(400,400*c(i.size)))[l]+b[l]+2*S+w),"right"===o||"bottom"===o?(C=r(h),_=u(h+S,h+S+x[l]+w)):(C=u(h,P[l]-h-x[l]),_=r(h+S)),0<(E=P[a]-b[a])&&(_=u(E/2,_[l])),{overallLayoutSize:P,bitmapSize:x,bitmapLocation:C,posterTextSize:b,posterTextLocation:_}},x=function(t,e){return m({center:e.cc,size:e.size.mul(t)})},this.prototype.layoutInsideText=function(){let t,e,n,i,o,s,a,l,u,c,h,p,d,f,y,v,S,b,w,x,P,C;return({aspectRatio:t}=this.bitmap),({posterTextLocation:e,posterTextScale:n}=this),i=this.posterTextBitmap.aspectRatio,a=(l=s=(o=r(400,400/t)).average()*n/15)+(u=this.posterTextBackgroundBlur||this.posterTextBackground?s:0),c=l,p=(h=r({aspectRatio:this.posterTextBitmap.aspectRatio,fitInto:r(o.x*n-2*c,o.y*n-2*c)})).add(2*l),d=o.mul(this.posterTextLocation).sub(p.div(2)),e=(f=y=_(d,p,o,u,this.snapScale)).add(l),v=m(f,p),S=m(o),this.movingText||(b=g(S.left,v.left),w=g(S.right,v.right),x=g(S.top,v.top),P=g(S.bottom,v.bottom)),C=this.posterTextCornersRounded&&this.posterTextScale<.999?l:0,{bitmapSize:o,posterTextContrastLocation:f,posterTextContrastSize:p,posterTextLocation:e,posterTextSize:h,posterTextOutterPadding:u,posterTextContrastRadius:{tl:b||x?0:C,tr:w||x?0:C,bl:b||P?0:C,br:w||P?0:C}}},this.prototype.renderContrast=function(t){let e,n,r,o,s;return e=t.showContrast,n=t.posterTextContrastLocation,r=t.posterTextContrastSize,o=t.posterTextContrastRadius,s=t.bitmapSize,o&&null!=this._changingPosterTextScale&&!y(1,this._changingPosterTextScale)&&(o=i.object(o,t=>t*this._changingPosterTextScale)),v({key:"posterTextContrast",location:n,size:r,animators:this.movingText?void 0:["draw","size","location"],draw:[{radius:null!=o?o:{tl:0,tr:0,bl:0,br:0}},"clip"]},e?v({animators:{opacity:{toFrom:0}}},this.posterTextBackgroundBlur?v({animators:{opacity:{toFrom:0}},key:`blur ${i.toString(this.posterTextBackgroundBlur)}`},S({location:n.neg,bitmap:this.blurredBitmap,size:s,animators:this.movingText?void 0:"location"})):void 0,this.posterTextBackground?v({animators:["draw",{opacity:{toFrom:0}}],draw:this.shadedPosterTextBackgroundWithAlpha}):void 0):void 0)},this.prototype.renderGrid=function(){return v({cacheDraw:!0,opacity:this.movingText?.5:0,animators:"opacity"},n(1162)({scale:1/3,color:this.posterTextGridColor}))},this.prototype.renderText=function({posterTextLocation:t,posterTextSize:e}){return v({location:t,size:e,key:`textBitmapElement ${i.toString(this.posterTextBitmap.size)}`,animators:this.movingText?void 0:["location","size"]},S({bitmap:this.posterTextBitmap}),v({compositeMode:"sourceTopInTarget",draw:[{padding:-10},this.shadedPosterTextForeground],animators:"draw"}))},this.prototype.renderBitmap=function({bitmapSize:t,bitmapLocation:e,radius:n}){return v({key:"mainBitmapElement",size:t,location:e,animators:["location","size","draw"],draw:[{radius:n},"clip",{child:"mainBitmap"},"resetClip"]},S({key:"mainBitmap",bitmap:this.bitmap}))},P={left:"right",right:"left",top:"bottom",bottom:"top"},this.prototype.renderMainPreview=function(t){let e,n,o,a,l,u,c,h,p,f,b,w,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U;return e=t.bitmapSize,n=void 0!==(D=t.bitmapLocation)?D:s,o=t.posterTextLocation,a=t.posterTextSize,l=void 0!==(N=t.overallLayoutSize)?N:e,u=t.posterTextContrastLocation,c=t.posterTextContrastSize,h=t.posterTextContrastRadius,p=t.posterTextOutterPadding,f=void 0!==(U=t.viewWindowSize)?U:this.viewWindowSize,this.movingText&&!y(1,b=this._changingPosterTextScale)&&(b=this.models.posterTextState.boundPosterTextScale(b*this.posterTextScale)/this.posterTextScale,u&&(u=(w=x(b,m(u,c))).location,c=w.size),w=x(b,m(o,a)),o=w.location,a=w.size),(C=null!=u)||(u=o,c=a),_=f.minRatio(l),this.movingText&&(E="inside"===this.posterTextLocationMode?e.sub((null!=c?c:a).sub(2*p)):e.mul(.5),T=m({center:k=l.cc,size:E}),I=this._scaledPreviewMoveCenter.div(_),M=this._multitouching?this.posterTextLocationMode:T.contains(I)?"inside":(({tl:A,tr:F,bl:B,br:R}=T),z=0<B.sub(F).cross(I.sub(F)),O=0<A.sub(R).cross(I.sub(R)),(()=>{switch(!1){case!(z&&O):return"top";case!(z&&!O):return"left";case!(!z&&O):return"right";case!(!z&&!O):return"bottom"}})()),n=this.posterTextLocationMode===M?n:P[this.posterTextLocationMode]===M?(()=>{switch(M){case"bottom":case"right":return l.sub(n.add(e));default:return l.sub(e.add(n))}})():k.sub(e).add((()=>{switch(M){case"inside":return e.cc;case"top":return e.bottomCenter;case"left":return e.centerRight;case"right":return e.centerLeft;case"bottom":return e.topCenter}})())),L=n.neq(s)||e.neq(l),null!=T&&(T=T.mul(_)),e=e.mul(_),n=n.mul(_),o=o.mul(_),a=a.mul(_),l=l.mul(_),u=u.mul(_),c=c.mul(_),h&&(h=i.object(h,t=>t*_)),"inside"===M&&"inside"!==this.posterTextLocationMode&&(e=e.mul(d(1.1,1+.5*(this.viewWindowSize.minRatio(e)-1))),n=l.sub(e).cc),v("centerCenter",{animators:["size","padding","draw"],size:l,receivePointerEvents:"always",draw:[{child:"blur"},L?this.posterTextBackgroundBlur?this.posterTextBackground?this.shadedPosterTextBackgroundWithAlpha:void 0:this.posterTextBackground?this.shadedPosterTextBackground:"#7":"#0000"],on:{pointerUp:({multitouchLeftDeadzone:t})=>{let e,n,s,u,c,h;return this._multitouching=this.movingText=!1,e=this._changingPosterTextScale,this._changingPosterTextScale=1,this._scaledPreviewMoveCenter=null,t?(n=this.movingOffset,y(1,e)||(this.models.posterTextState.posterTextScale=e*this.posterTextScale),M&&M!==this.posterTextLocationMode?(this.createEventOncePerHour(`edit:move:placeText:${i.toString(M)}`),this.models.posterTextState.posterTextLocationMode=M):"inside"===this.posterTextLocationMode?(this.createEventOncePerHour("edit:move:text"),({x:s,y:u}=n),({w:c,h:h}=a),this.models.posterTextState.posterTextLocation=r((s+o.x+c/2)/l.x,(u+o.y+h/2)/l.y)):void 0):void 0},pointerMove:({multitouchParts:t,multitouchOccured:e})=>{let n,i,s,l,u;return n=t.translate,this.movingText=!0,this.movingOffset=n,this._multitouching||(this._multitouching=e),this._changingPosterTextScale=t.scale,({x:i,y:s}=n),({w:l,h:u}=a),this._scaledPreviewMoveCenter=r(i+o.x+l/2,s+o.y+u/2)}}},L&&this.posterTextBackgroundBlur?v({key:"blur",animators:["padding",{opacity:{toFrom:0}}]},S({bitmap:this.blurredBitmap,layout:"zoom"})):void 0,v({size:l,animators:"size"},this.renderBitmap({bitmapSize:e,bitmapLocation:n,radius:"inside"!==this.posterTextLocationMode?this.posterTextCornersRounded&&!g(1,l.minRatio(n))?12.5:0:void 0}),this.renderContrast({showContrast:C,posterTextContrastLocation:this.movingText?u.add(this.movingOffset):u,posterTextContrastSize:c,posterTextContrastRadius:h,bitmapSize:e}),this.renderText({posterTextLocation:this.movingText?o.add(this.movingOffset):o,posterTextSize:a})))},this.prototype.readyEvent=function({target:t}){return this.viewWindowSize=t.currentSize},this.prototype.render=function(){let t,e,n,r,o,s;return t=this.props.safePadding,(e=-d(null!=(n=t.top)?n:0,null!=(r=t.left)?r:0,null!=(o=t.right)?o:0,null!=(s=t.bottom)?s:0))==e&&i.is(e,b)&&e>0||(e=0),v({key:"posterTextPreviewTop",draw:[{padding:e,fill:.5<this.averagePerceptualLightness?"#0":"#2"},"clip"],cursor:"pointer",padding:this.props.safePadding,animators:["padding","draw"]},v({key:"posterTextPreviewLevel2",on:{pointerClick:this.models.posterTextState.cyclePosterTextScale,ready:this.readyEvent}},this.readyToRender?this.renderMainPreview("inside"===this.posterTextLocationMode?this.layoutInsideText():this.layoutOutsideText()):this.bitmap?S({bitmap:this.bitmap,layout:"fit"}):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["HotStyleProps","compactFlatten","Object","randomSortInPlace"],[e,n(1026)],(t,e,n,r)=>{return i.defClass(class PosterTextQuotes extends t{},function(t,o,s){this.icons={appreciation:"thumbsUp",birthday:"gift",congratulations:"trophy",friendship:"users",holidays:"tree",inspiration:"paintbrush",love:"heart",memorial:"moon",sympathy:"droplet",kindness:"openArmPerson"},this.quotes={kindness:["Be kind, for everyone you meet is fighting a harder battle.","Kindness is a language which the deaf can hear and the blind can see.","My religion is very simple.\nMy religion is kindness.","Tenderness and kindness are not signs of weakness and despair, but manifestations of strength and resolution.","You cannot do a kindness too soon, for you never know how soon it will be too late.","No act of kindness, no matter how small, is ever wasted.","Kindness in words creates confidence. Kindness in thinking creates profoundness. Kindness in giving creates love.","For it is in giving that we receive.","Silence the angry man with love. Silence the ill-natured man with kindness. Silence the miser with generosity. Silence the liar with truth.","Forget Injuries. Never forget kindnesses.","Just saying thank you will never repay your Kindness.","Scatter\nKindness"],appreciation:["You are the\nBest\nTheirName!","Someday I will give back what you have given me. Thank You.","Just saying thank you will never repay your kindness.","You are the Sparkle in my Eye","You are the Music to my Song","You are the Ink to my Pen","You are the Stars in my Sky","The best things in\nLife\naren't things","For all you do, for who you are, I will be forever grateful you are in my life.","Your thoughtfulness will always be remembered.","Words cannot express my feelings, nor my thanks for all your help.","I appreciate your determination in showing me I can do it! Thanking you for your perseverance, support, and love.","If the world had more people like you it would be a better place. You do make a difference."],birthday:["TheirNameHere\nI hope you have the\nBest\nBirthday\nEver","May you live as long as you want, and never want as long as you live.","How do you expect me\nto remember your birthday\nwhen you never look any older?","Hope your birthday\nbrings you a\nspecial kind of\nhappiness\nand leaves you with\nthe nicest kind of\nmemories","Birthdays are filled\nwith yesterday's memories\ntoday's joys\nand tomorrows dreams","A simple celebration\na gathering of friends\nhere is wishing you great happiness\na joy that never ends","Here's wishing you all the special things in life\nThat brings you happiness\nHave a Lovely Day!","May today be filled with\nall the things you're wishing for.\nHappy Birthday!","Wishing you every\nHappiness\non your special day\nHappy Birthday!","Wishing you every happiness\nthis special day brings.\nHave a wonderful birthday!","May your birthday be filled with\nsunshine and smiles\nlaughter, love and cheer","May all your hopes and dreams come true\nand your future be filled with happiness.\nHappy Birthday!","The more candles,\nthe bigger the wish."],congratulations:["TheirNameHere\nWhat a superb achievement!","You did it! Congratulations!","Today is the day you have been waiting for, and we are so happy for you.","You have done remarkably well at such a young age. My best wishes are always with you.","Absolutely\nFabulous!","Actually,\nYou can!","Congratulations\non finding your\nTrue Love","Congratulations!\nYou stayed\ntrue\nto yourself\nand your hard work paid off","You very well deserve this congrats for your hard work and dedication. Congratulations on your success.","I am proud of you. You have accomplished a lot. I look forward to seeing even more blessings come to you in the future.","Keep being Awesome and Ill keep saying Congratulations","You are an\ninspiration\nto us all","You have earned my heart-felt\nCongratulations","I love when good things happen to good people like you.","Your dedication, enthusiasm and insight are really inspiring.","If Oscars were given for a job well done,\nId nominate you","How many times do I have to tell you?\nCongratulations!\nCongratulations!\nCongratulations!","My face has a proud smile because of you","No matter how big the crowd, you will always stand out","I dont know if anyone has ever told you this before, but I think you are pretty great.","Congrats on your graduation! The world is waiting for you. Just keep dreaming and move on with confidence. You are soon to reach the stars!","First they ignore you Then they laugh at you Then you win! I knew you could do it. Congratulations for your brilliant victory!","The key to happiness is having dreams. The key to success is making them come true.\nCongratulations","Congratulations\nFootprints on the sands of time are not made by sitting down.","You are our\nshining star","Congratulations\nI knew that if someone could do it, it would be you.\nWell done!"],friendship:["TheirNameHere\nYou are the\nBestest\nFriend","Great friends\nare few and far between\nThanks\nfor being there for me","Through thick and thin, we've always been friends. Here's to many more years of being best buddies!","Just wanted to write and tell you I've been thinking about you!\nLove you, friend.","So blessed to have you in my life! Cheers to you, friend.","When I count my blessings, you're always at the top of the list.\nSo glad we're friends!","Here's a special photo for a special friend. Love you and miss you!","A friend is one that knows you as you are, understands where you have been, accepts what you have become, and still, gently allows you to grow.","The greatest gift in life is friendship, and I have received it.","I'd rather walk with a friend in the dark than walk alone in the light.","There is nothing on this earth more to be prized than true friendship.","In life, there are big ships and there are small ships, but the best ship of all is friendship.","COFFEE\nKeeping people\nsafe\nsince I got up\nthis morning","Don't make me laugh. I'm trying to be mad at you.","Everybody needs somebody sometimes.","Friends Forever","Friends are the spice of life, and you, my friend, are extra spicy!","Friends don't let\nfriends do silly things\nalone.","Hi. I like you a lot. Like a lot, a lot.","I have a big hug waiting for you anytime you need one.","I like you. You're weird.","I think I'm in like with you.","I truly feel that you know me better than I know myself. I'm ever grateful for your friendship.","If you fall, I'll be there.","Lucky to have you in my life.","May the roof above us never fall in, And may we friends gathered below never fall out. - Irish Blessing","My best friend is the one who brings out the best in me","My phone is off for you","One of a kind","Thank you for existing","The only way to have a friend is to be one.","When I count my blessings, I count you twice.","You are Amazing and don't forget that!","You are\nSO\nloved","You make me smile\nThank you","You might not know this but I'd go out of my way just to make sure that you're okay.","You're an idiot, But you're my idiot."],holidays:["I'm hoping this Season will bring you Joy,\nTheirName","Have a very merry Christmas and a Happy New Year!","Wishing you all the best that a holiday could offer.","Peace, joy, and love to you and your family.","May your Christmas season be filled with joy and light!","Hope your stocking is stuffed full of joy this year.","Sending you glad tidings this holiday season.","May this Christmas end the present year on a cheerful note and make way for a fresh and bright New Year.","May all the sweet magic of Christmas conspire to gladden your heart and fill every desire.","May the peace and joy of Christmas live in your heart all year long.","Warmest thoughts and best wishes for a wonderful Holiday and a Happy New Year.","May peace, love and prosperity follow you always.","To a joyful present and a well remembered past.","Whatever is beautiful. Whatever is meaningful. Whatever brings you happiness. May it be yours these Holidays and throughout the coming year.","Warmest thoughts and best wishes for a wonderful Holiday season and a very happy New Year.","Wishing you and your loved ones peace, health, happiness, and prosperity in the coming New Year.","Let the spirit of love gently fill our hearts and homes. In this loveliest of seasons may you find many reasons for happiness.","Dear Santa,\nCould you define\nNaughty?","It is all fun and games until Santa checks the naughty list.","Santa's cutest\nElf","Santa\nit is a long story","When you stop believing in Santa\nyou get\nunderwear","Happy\nHanukkah\nHanuka\nChanukah\nChanukkah\nHannukah\nHanukah\nChannuka\nChanuka\nChanukah\n(however you spell it!)","May your holidays be as Bright as a fully lit Menorah","Glory to God in the highest, and on earth peace, good will toward men.","May this Joyous Season bring you peace, health and happiness throughout the coming year.","The Gift of Hanukkah is a precious reminder that we are loved","The Magic of Hanukkah never ends and its greatest of gifts are family and friends. Happy Hanukkah and Happy New Year!"],inspiration:["You Inspire Me\nTheirName","Cinderella is proof\nthat a new pair\nof shoes can\nchange your life.","Find\nJoy\nin the journey","Keep your face to\nthe sunshine and you\ncannot see a shadow.","Spread love\neverywhere you go.","Let us make our\nfuture now, and\nlet us make our dreams\ntomorrow's reality.","You must do the\nthings you think\nyou cannot do.","Keep your face always\ntowards the\nsunshine\nand shadows will\nfall behind you.","You are never too old to\nset another goal, or to\ndream\na new dream.","Life\nis like riding a\nBicycle\nTo keep your balance,\nyou must keep moving.","Stay close to\nanything\nthat makes you\nglad you are alive.","The most wasted\nof days is one without\nlaughter.","A the end of the day, your feet should be dirty, your hair should be messy and your eyes sparkling.","Adventure More.","Be Different!","Be Extraordinary. Now!","Creativity is your heart's way of doing a happy dance when it sees an opportunity to play.","Difficult roads often lead to beautiful destinations.","Do more of what makes you happy.","Don't forget to play.","Don't look back. You're not going that way.","Don't make things complicated. Keep it simple.","Every majestic oak tree was once a nut who stood his ground.","Find a beautiful place and get lost.","It's your time to fly.","Keep on the Sunny side.","Look Around. Life is Beautiful!","May you have the hindsight to know where you've been, The foresight to know where you're going, And the insight to know when you're going too far.","Pick: Ordinary or Spectacular!","Scatter Kindness","Stay Focused and Extra Sparkly.","Strong is what happens when you run out of weak."],love:["TheirNameHere\nI Love\nYou","Always\nkiss me\ngoodnight","You\nare what happened\nwhen I wished upon a\nstar","I\nlove\nU","I love you","Whom we\nlove\nbest\nto them we can\nsay least","I never knew how to\nworship\nuntil I knew how to\nlove","Love looks not with the eyes, but with the mind. And thus is winged Cupid painted blind.","The deepest sweetest dreams come true when the paths of destined lovers cross.","Heaven is the perfect, unconditional love for another.","Every day I think of you, every night I dream of you, only proves it must be true, that I'm in love with you.","A kiss\nis a promise\nwritten upon the\nlips","You'll kiss\nmany toads before you find\nPrince Charming","My heart skips a beat\nevery time\nIm with you","The reality of\nloving you\nis far better than any of\nmy dreams","Youre the most\nwonderful\nthing thats ever\nhappened to me.\nEver.","You have shown me how to fall in love, how love hurts and how it heals.","Love bears all things, believes all things, hopes all things, and endures all things.","Love can never be tamed. It can only be felt with a true heart.","Many things in life will catch your eye, but only a few will catch your heart.","You've got to dance like nobody's looking, and love like it's never going to hurt.","Absence is to love what wind is to fire; it extinguishes the small, yet enkindles the great.","The times we spend together are the best times that I know, I am a better person, because you've made me so.","To the world you are someone, but to someone you are the world.","Absence makes the heart grow fonder","Life is a journey, and love is what makes that journey worthwhile.","Love is the beauty of the soul.","Love's pure silver flame gives each innermost spirit invisible warmth.","Nothing is impossible to a willing heart.","Love conquers all things\nlet us too surrender to love","Life is the flower for which\nlove\nis the honey","Love seeketh not itself to please, but for another gives its ease.","There is only one happiness in life, to love and be loved.","Keep me as the apple of the eye, Hide me under the shadow of thy wings.","Love is the bridge between two hearts.","The love we give away is the only one we keep.","A heart that loves is always young.","Love is not in our choice but in our fate.","The heart has its reasons that reason does not know.","If there is anything\nbetter\nthan to be\nLoved\nit is Loving","'Tis better to have loved and lost Than never to have loved at all.","To love is to place our happiness in the happiness of another.","Love is but the discovery of ourselves in others, and the delight in the recognition.","I don't believe in magic\nsaid the young boy\nThe old man smiled\nYou will when you see her","All of me loves All of you","And suddenly all the love songs were about you.","Black Friday sale: My house. You and I. All clothes 100% off.","By the way, I'm wearing the Smile you gave me","I don't feel like doing anything. Except you I'll do you","I like it when you\nSmile\nbut I love it when\nI'm the reason","I wish I was kissing you instead of missing you.","It was always you","Kiss Me","Kissing burns six calories per minute. Want to workout?","My favorite place in the world is next to you.","Once in a lifetime you meet someone who changes Everything.","That's a horrible idea. What time?","When I'm with you, hours feel like seconds. When we're apart, Days feel like years.","You can't rush something you want to last forever.","You have this incredible way of making my heart happy.","You put your arms around me and I'm Home.","You're all my heart ever talks about.","You're kinda, sorta, basically, pretty much always on my mind."],memorial:["I'm Missing You\nTheirName","Gone\nbut not forgotten","Forever in my heart you'll stay. Loved and remembered everyday.","I know you are in better hands now, but I still wish you were in mine.","Our hearts are filled with sorrow.","Though our days together are over I will remember you always with love.","A simple wish that you were here.","Treasured\nmemories","Till we meet again","Memories of you will\nnever die\nnor will they\nfade\nas time goes by","So dearly loved.\nSo sadly missed.\nGod Bless","Well always love and miss you so much","The sorrow we feel no words can explain. The ache in our hearts will always remain","To me you were so special. Someone good and true. Never will I forget, I thought the world of you","You were always the most beautiful flower in the garden.","Always in my heart","Although we are far away we will hold you close in our thoughts and in our hearts today and always","You will live on in our hearts","I wish Id been there to hold your hand","There is one star in the sky tonight brighter than all the rest combined","My friend you are a leaving. Its time for you to go. Your friendship was a blessing and I will miss you so.","You always remembered us  we will never forget you.","Death may leave a heartache no one can heal but love leaves a memory that no one can steal.","It is not length of life, but depth of life.","May the winds of heaven blow softly; and whisper in your ear; how much we love and miss you; and wish that you were here","Missing you comes in waves. Tonight I'm drowning.","Perhaps they are not stars but rather openings in Heaven where the love of our lost ones shines down to let us know they are happy.","Remembering you is easy. I do it every day. Missing you is the heartache that never goes away.","Say not in grief he is no more  but live in thankfulness that he was","The comfort of having a friend may be taken away, but not that of having had one.","Those we love can never be more than a thought away for as long as there's a memory they live in our hearts to stay.","Those we love don't go away, they sit beside us every day. Unseen, unheard, but always near, still loved and missed and forever dear.","When you are born, you cry, and the world rejoices. When you die, you rejoice, and the world cries.","Yesterday is a memory, tomorrow a mystery and today is a gift, which is why it is called the present. What the caterpillar perceives is the end; to the butterfly is just the beginning.","Your end, which is endless, is as a snowflake dissolving in the pure air.","Your life was a blessing\nYour memory a treasure\nYou are loved beyond words\nand missed beyond measure"],sympathy:["TheirNameHere\nI'm thinking of you every day","You are in our hearts and prayers during this sad and trying time.","Words can never express how saddened we were to hear about your loss.","I am truly sorry to hear about your pain and loss.","We just wanted you to know our thoughts are with you during the difficult days ahead.","Although no one can truly understand your sense of loss, I wanted you to know that our hearts are aching for you.","Know that our love and thoughts are with you and not a day goes by that we do not think about you.","Wishing you peace to bring comfort, courage to face the days ahead and loving memories to forever hold in your hearts.","May you be comforted by the outpouring of love surrounding you.","A sunbeam to warm you, A moonbeem to charm you, A sheltering angel so nothing can harm you. -Irish Blessing","As you slide down the banisters of life, May the splinters never point the wrong way. -Irish Blessing","Hope you perk up soon!","I hate it when the people I love aren't feeling well.","I pray that you get through this setback as fast as possible. Let me know how I can help.","Just thought you could use a little extra sunshine today.","May each day bring you renewed strength and brighter times.","The Lord bless you and keep you."]},i.each2(this.quotes,(t,e)=>r(t)),this.featuredKeys=["love","kindness"],this.sortedKeys=e([this.featuredKeys,i.array(n.keys(this.quotes),null,t=>!i.in(t,this.featuredKeys)).sort()])})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Promise","posterTextStyles","Element","TextElement","TextStyles","TextPalette","ImikimiPalette","upperCamelCase","Math","LoadingOverlay"],[e,n(1026),n(779)],(t,e,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class PosterTextStylePicker extends t{},function(t,d,f){this.subscriptions("viewState.gridSize"),this.stateFields({stylesLoaded:!1,randomStyleCount:0}),this.getter({selectedStyleName:function(){let t;return i.exists(t=this.props.selectedStyle)&&t.name}}),this.prototype.preprocessProps=function(t){return t.selectedStyle&&t.selectedStyle!==this.props.selectedStyle&&this.onNextReady(this.scrollSelectOnScreen),t},this.prototype.scrollSelectOnScreen=function(){let t,e;return i.exists(t=this.refs)&&i.exists(e=t[this.selectedStyleName])&&e.element.scrollOnscreen()},this.prototype.componentWillMount=function(){return e.all(i.array(r,t=>t.load())).then(this.triggerStylesLoaded),f.componentWillMount.apply(this,arguments)},this.prototype.render=function(){let t,e,d,f,m,g,y;return t=(y=this.props).edgeShadows,e=y.label,d=y.selectedStyle,f=y.selectStyle,m=y.posterTextSeedsByStyleName,g=this.gridSize,n(1157)({edgeShadows:t,label:e},this.stylesLoaded?o("row","parentHeightChildrenWidth","childrenCenterCenter",o({size:{wcw:1,h:4*g},padding:this.gridSize/2,cacheDraw:!0,draw:{fill:"#e",radius:{left:this.gridSize/2}}},s(a.smallBoldText,"textCenterRight","parentHeightChildrenWidth",{leading:1,fontSize:this.gridSize,text:"FREE\nSTYLES",color:l.black.secondary})),o("row","parentHeightChildrenWidth","childrenCenterCenter",o("centerCenter",{inFlow:!1,size:{ww:1,h:4*g},draw:"#f4"}),i.array(r,t=>n(1163)({style:t,key:t.name,selectedColor:"#f4",seed:m[t.name],selected:d===t,action:()=>i.isF(f)&&f(t)}),t=>t.free)),o({size:{h:4*g,w:g},draw:{fill:"#e",radius:{right:g/2}}}),o({size:this.gridSize}),o({size:{wcw:1,h:4*g},padding:this.gridSize/2,cacheDraw:!0,draw:{radius:{left:this.gridSize/2},colors:u.goldGradient,to:{xw:1,yw:1}}},s(a.smallBoldText,"textCenterRight","parentHeightChildrenWidth",{leading:1,fontSize:this.gridSize,text:"MEMBER\nSTYLES",color:"white",shadow:{offset:0,color:"#0002",blur:7}})),o("row","parentHeightChildrenWidth","childrenCenterCenter",o("centerCenter",{inFlow:!1,size:{ww:1,h:4*g},draw:u.lightGoldenBackground}),i.array(r,(t,e)=>n(1163)({style:t,key:t.name,selectedColor:u.lightGoldenBackground,seed:m[t.name],selected:d===t,action:()=>i.isF(f)&&f(t)}),(t,e)=>!t.free)),o({size:{h:4*g,w:g},draw:{radius:{right:this.gridSize/2},colors:u.goldGradient,to:{xh:1,yh:1}}}),o({size:this.gridSize}),n(1169)({backgroundColor:"#e",key:"random background picker",width:11*this.gridSize,action:()=>(i.isF(f)&&f(d),this.randomStyleCount++),text:`random ${i.toString(c(this.selectedStyleName," "))} variant`,icon:"redo",iconScale:1.5,iconColor:"#4",angle:2*h.PI*this.randomStyleCount})):p())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ButtonWrapper2","Element","TextElement","Icons","TextPalette","TextStyles"],[e,n(1026)],(t,e,n,r,o,s,a)=>{return i.defClass(class PosterTextVariableWidthButton extends t{},function(t,i,l){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,i,l,u,c,h;return t=this.gridSize,i=(h=this.props).icon,l=h.text,u=h.action,c=h.angle,e({backgroundColor:"#e",action:u,size:{wcw:1,h:4*t}},n({size:{wcw:1,h:4*t},padding:{h:t}},"row","childrenCenterLeft",{childrenMargins:t},i&&r(o[i],"centerCenter","childrenSize",{angle:null!=c?c:0,animators:{angle:{duration:.5}},color:s.black.primary}),r(a.mediumText,"parentHeightChildrenWidth","textCenterCenter",{text:l})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>{let t;return i.importInvoke(["PosterTextLib"],t=[e,n(1026),n(1171),n(779),{PosterTextToolbarWrapper:n(1172)}],e=>i.importInvoke(["TextElement","TextStyles","upperCamelCase","present","String","merge","PosterTextQuotes","arrayWithElementReplaced","arrayWithInsertedValue","PickerButton","Icons","TextPalette","Element","ImikimiPalette","PosterTextToolbarWrapper"],[t,e],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{let y,v,S,b,w,x,P,C;return y=n(1173),v=["theme","text","style","position","colors","foreground","background","save"],b=(S=["theme","text","style","position","colors","save"])[0],w=i.defClass(class MissingToolbar extends(n(1161)){},function(n,r,o){this.prototype.render=function(){let n;return({step:n}=this.props),t(e.mediumText,"parentSize","textCenterCenter",{text:`missing step: ${i.toString(n)}`})}}),x=i.object(v,t=>y[r(t)]||w),P=function(t){return(()=>{switch(t){case"foreground":return"text color";case"background":return"bg color";case"position":return"placement";case"text":return"edit";default:return t}})()},C=function(t){return(()=>{switch(t){case"background":return"background";default:return P(t)}})()},i.defClass(class PosterTextToolbar extends(n(1161)){},function(e,n,r){this.prototype.getStepLabel=function(t){return(()=>{switch(t){case"background":return"background";case"theme":return"text theme";case"text":return this.selectedQuoteCategory?`edit ${i.toString(this.selectedQuoteCategory)} text`:"edit text";default:return P(t)}})()},this.subscriptions("viewState.viewState","posterTextState.editStep","posterTextState.posterTextText"),this.propFields("fullscreen","expandedColorPalette","membershipRequired","save"),this.stateFields({steps:S,quoteCountByCategory:{}}),this.setter({selectedQuoteCategory:function(t){return this.posterTextState.posterTextQuoteCategory=t}}),this.prototype.clearSelectedQuoteCategory=function(){return this.selectedQuoteCategory=null},this.getter({selectedQuoteCategory:function(){return this.posterTextState.posterTextQuoteCategory},editStep:function(){let t;return null!=(t=this.state.editStep)?t:b},canGoPrev:function(){return!!this.prevStep},canGoNext:function(){return!!this.nextStep&&o(this.posterTextText)},currentStepIndex:function(){return this.steps.indexOf(this.editStep)},nextStep:function(){return this.steps[this.currentStepIndex+1]},prevStep:function(){return this.steps[this.currentStepIndex-1]},widescreen:function(){return this.viewState.viewWidth>=33*this.viewState.gridSize}}),this.prototype.preprocessState=function(t){let e,n;return e=t.editStep,n=t.steps,e&&e!==this.state.editStep&&this.createEventOncePerHour(`step:${i.toString(e)}`),r.preprocessState.call(this,t)},this.prototype.applyNextQuote=function(t){let e,n,r,o;return null!=t&&t!==this.selectedQuoteCategory?this.createEventOncePerHour(`edit:theme:select:${i.toString(t)}`):this.createEventOncePerHour(`edit:random:theme:${i.toString(this.selectedQuoteCategory)}`),i.is(t,s)?this.selectedQuoteCategory=t:t=this.selectedQuoteCategory,n=(e=this.quoteCountByCategory=a(this.quoteCountByCategory))[t]=(null!=(o=e[t])?o:0)+1,r=l.quotes[t],this.posterTextState.posterTextText=r[n%r.length]},this.prototype.advanceToForeground=function(){return this.advanceToFgBg("foreground")},this.prototype.advanceToBackground=function(){return this.advanceToFgBg("background")},this.prototype.advanceToFgBg=function(t){let e;switch(e="foreground"===t?"background":"foreground",!1){case!i.in(t,this.steps):break;case!i.in(e,this.steps):this.steps=u(this.steps,t,this.steps.indexOf(e));break;default:this.steps=c(this.steps,1+this.steps.indexOf("colors"),t)}return this.onNextReady(()=>this.goToNextStep(t))},this.prototype.goToNextStep=function(t=this.nextStep){return this.posterTextState.editStep=null!=t?t:this.editStep},this.prototype.goToPrevStep=function(){let t;return this.posterTextState.editStep=null!=(t=this.prevStep)?t:this.editStep},this.prototype.renderBackButton=function(){return h({action:this.canGoPrev&&this.goToPrevStep,label:P(this.prevStep),backgroundColor:"transparent",disabledOpacity:0,backgroundColor:"#e"},t(p.angleLeft,{size:"childrenSize",location:"centerCenter",axis:"centerCenter",color:d.black.secondary}))},this.prototype.renderNextButton=function(){return h({action:this.canGoNext&&this.goToNextStep,backgroundColor:"#e",label:P(this.nextStep),disabledOpacity:0},t(p.angleRight,{size:"childrenSize",location:"centerCenter",axis:"centerCenter",color:d.black.secondary}))},this.prototype.render=function(){let t,e,n,r,s,l,u,c,h;return c=this,t=this.widescreen,e=this.steps,n=(h=this.viewState).safePadding,r=h.gridSize,s=v.indexOf(this.editStep),l=t?P:C,u=a(this.props,{widescreen:t,save:this.save,advanceToForeground:this.advanceToForeground,advanceToBackground:this.advanceToBackground,selectedQuoteCategory:this.selectedQuoteCategory,applyNextQuote:this.applyNextQuote,clearSelectedQuoteCategory:this.clearSelectedQuoteCategory,goToNextStep:this.goToNextStep,goToPrevStep:this.goToPrevStep,safePadding:n}),f({key:"posterTextToolBarsArea",childrenLayout:"column",childrenMargins:r/2,size:this.fullscreen?{h:0}:{hch:1},animators:["size","draw","padding"],padding:t?{bottom:n.bottom}:void 0,draw:[{fill:m.veryLightGrey},"reset","clip"]},f({cacheDraw:!0,childrenAlignment:"centerCenter"},"parentWidthChildrenHeight",i.array(v,(t,n)=>{let i,r,a;return i=e.indexOf(t),f("parentWidthChildrenHeight",{clip:!0,axis:{x:(()=>{switch(!1){case!(n<s):return 1;case!(n===s):return 0;case!(n>s):return-1}})()},animators:"axis"},g(u,{label:!this.widescreen||o(this.posterTextText)?this.getStepLabel(t):"theme"===t?"start by selecting a theme":"add some text to continue",prevStep:r=e[i-1],nextStep:a=e[i+1],nextStepName:l(a),prevStepName:l(r)},x[t](u,{active:n===s,step:t})))})))}})}))})}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>({PosterTextScrollableToolBar:n(1157),PosterTextQuotes:n(1167),PickerButton:n(1160),VSliderPicker:n(1155),PosterTextLabel:n(1158),ColorPicker:n(1153),ColorShadePicker:n(1154),PosterTextVariableWidthButton:n(1169),PosterTextStylePicker:n(1168)}))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["present","PickerButton","TextElement","Icons","TextPalette","Element","max","TextStyles"],[e,n(1026),{PickerButton:n(1160)}],(t,e,r,o,s,a,l,u)=>{return i.defClass(class PosterTextToolbarWrapper extends(n(1161)){},function(c,h,p){this.subscriptions("viewState.viewState","posterTextState.posterTextText"),this.propFields("nextStep","prevStep","goToNextStep","goToPrevStep","prevStepName","nextStepName","safePadding","label","children","widescreen"),this.getter({canGoPrev:function(){return!!this.prevStep},canGoNext:function(){return!!this.nextStep&&t(this.posterTextText)}}),this.prototype.renderWidescreenNavButton=function(t){let n,i,a;return n=(a=this.viewState).gridSize,i=a.viewWidth,e({backgroundColor:"#e",disabledOpacity:0,width:i>=568?4*n:void 0},t?{action:this.canGoNext&&this.goToNextStep,label:"next"}:{action:this.canGoPrev&&this.goToPrevStep,label:this.prevStepName},r(t?o.angleRight:o.angleLeft,"childrenSize","centerCenter",{color:s.black.secondary}))},this.prototype.renderBottomNav=function(){let t,e,o,s,c;return t=(c=this.viewState).gridSize,e=c.buttonSize,a({key:"PosterTextPhoneNav",size:{h:(o=4*t)+(s=l(this.safePadding.bottom,t))},padding:{h:t,bottom:s}},this.canGoPrev||this.canGoNext?a("row",{size:{wcw:1,h:o},childrenMargins:t},this.canGoPrev&&n(1164)({key:`prevButton ${i.toString(this.prevStep)}`,icon:"angleLeft",action:this.goToPrevStep,text:this.prevStepName}),this.canGoNext&&n(1164)({icon:"angleRight",key:`nextButton ${i.toString(this.nextStep)}`,iconRight:!0,action:this.goToNextStep,text:"save"===this.nextStep?"last: save":"next: "+this.nextStepName})):a(r(u.mediumText,"parentSize","textCenterCenter",{padding:{bottom:this.safePadding.bottom},text:"start by selecting a theme"})))},this.prototype.render=function(){let t,e,n,i,o,c,h,p,d,f,m,g,y,v;return y=this,t=this.label,e=this.children,n=this.widescreen,i=this.safePadding,o=(v=this.viewState).gridSize,h=(c=v.viewWidth)>750?o/2:o/4,p=i.left+o/2,d=i.right+o/2,f=l(h,p,d),m={h:o*(n?7:8)},g=this.canGoNext||this.prevStep,a("parentWidthChildrenHeight",{clip:!0,padding:n?{left:this.canGoPrev?f:p,right:g?f:d}:void 0},n?a("row","parentWidthChildrenHeight","childrenCenterCenter",{childrenMargins:h},this.canGoPrev&&this.renderWidescreenNavButton(),a({size:m,clip:!0},e),g?this.renderWidescreenNavButton(!0):void 0):a("column","parentWidthChildrenHeight",a({size:m},e),this.renderBottomNav()),a({size:{h:o*(n?1.5:2)}},r(u.tinyText,{text:t,color:s.black.secondary},"centerCenter","childrenSize")))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(293)).addModules({Background:n(1174),Colors:n(1175),Foreground:n(1176),Position:n(1177),Save:n(1178),Style:n(1179),Text:n(1180),Theme:n(1181)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["ColorPicker","PickerButton","Element","TextPalette","BlurElement","VSliderPicker","rgbColor"],[e,n(1026),{PickerButton:n(1160),ColorPicker:n(1153),VSliderPicker:n(1155)}],(t,e,r,o,s,a,l)=>{return i.defClass(class Background extends(n(1161)){},function(n,u,c){this.subscriptions("viewState.gridSize","posterTextState.posterTextBackgroundBlur","posterTextState.posterTextBackground","posterTextState.posterTextCornersRounded","posterTextState.posterTextBackgroundShade","posterTextState.posterTextBackgroundOpacity"),this.propFields("widescreen","expandedColorPalette"),this.prototype.render=function(){let n,u,c,h,p;return n=this.gridSize,t({colorPalette:this.expandedColorPalette,currentColor:this.posterTextBackground,shade:this.posterTextBackgroundShade,setColor:this.posterTextState.setPosterTextBackground,setShade:this.posterTextState.setPosterTextBackgroundShade,edgeShadows:this.widescreen},e({selected:!!this.posterTextBackgroundBlur,innerLabel:(()=>{switch(this.posterTextBackgroundBlur){case"heavy":return"2x blur";case"light":return"blur";default:return"no blur"}})(),action:this.posterTextState.cyclePosterTextBackgroundBlur},r({location:"centerCenter",axis:"centerCenter",size:t=>.5*t.min(),cacheDraw:!0},r({draw:[{radius:5},o.black.secondary]}),s({radius:"heavy"===this.posterTextBackgroundBlur?10:5}))),e({selected:this.posterTextCornersRounded,action:this.posterTextState.cycleRoundedCorners,innerLabel:this.posterTextCornersRounded?"round":"square"},r({location:"centerCenter",axis:"centerCenter",size:t=>.5*t.min(),draw:[{radius:5},o.black.secondary]})),e({action:()=>{let t;return this.posterTextState.setPosterTextBackground(this.posterTextBackground?(this._savedBackgroundColor=this.posterTextBackground,null):(this.createEvent("edit:background:turnOnColor"),null!=(t=this._savedBackgroundColor)?t:this.expandedColorPalette[1]))},selected:this.posterTextBackground,innerLabel:"no bg"},r({size:1.5*n,axis:"centerCenter",location:"centerCenter",draw:["circle",{colors:["#f00","#ff0","#0f0","#0ff","#00f"]}]})),a({value:this.posterTextBackgroundOpacity,rounded:!0,backgroundPattern:!0,handleScale:.5,setValue:this.posterTextState.setPosterTextBackgroundOpacity,colors:[null!=(u=i.exists(c=this.posterTextBackground||this._savedBackgroundColor)&&c.withAlpha(1))?u:l("#aaaf"),null!=(h=i.exists(p=this.posterTextBackground||this._savedBackgroundColor)&&p.withAlpha(0))?h:l("#aaa0")]}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Element","PickerButton","TextPalette","Math","ColorShadePicker","BlurElement","TextElement","Icons"],[e,n(1026),{PickerButton:n(1160),ColorShadePicker:n(1154)}],(t,e,r,o,s,a,l,u)=>{return i.defClass(class Colors extends(n(1161)){},function(n,c,h){this.subscriptions("viewState.gridSize","posterTextState.posterTextForeground","posterTextState.posterTextForegroundShade","posterTextState.posterTextBackground","posterTextState.posterTextBackgroundShade","posterTextState.posterTextBackgroundBlur"),this.stateFields({randomColorStyleCount:0}),this.propFields("widescreen","advanceToForeground","advanceToBackground","getRandomForegroundBackground"),this.prototype.selectStyle=function(t){return this.posterTextStyle===t?this.posterTextState.cyclePosterTextSeed(t):(this.createEventOncePerHour(`edit:select:style:${i.toString(t.getName())}`),this.posterTextState.posterTextStyle=t)},this.prototype.randomBackground=function(){return this.createEventOncePerHour("edit:random:colors"),this.randomColorStyleCount++,this.posterTextState.setState(this.getRandomForegroundBackground(!0))},this.prototype.render=function(){let n,i;return n=this.gridSize,t("row","childrenCenterCenter",{childrenMargins:n},e({backgroundColor:"#e",key:"random background picker",width:11*n,action:this.randomBackground,label:"random colors",icon:"redo",iconScale:1.5,iconColor:r.black.primary,angle:2*o.PI*this.randomColorStyleCount}),s({width:6*n,color:this.posterTextForeground,shade:this.posterTextForegroundShade,label:"text color",rounded:!0,click:this.advanceToForeground,setShade:this.posterTextState.setPosterTextForegroundShade}),t("childrenSize",e({width:6*n,backgroundColor:"#e",action:this.advanceToBackground,key:"background picker",label:"background"},(null!=(i=this.posterTextBackgroundBlur)?i:this.posterTextBackground)?t({size:2*n,draw:"#7"},"centerCenter",a({radius:n/2})):l(u.plus,{size:"childrenSize",location:"centerCenter",axis:"centerCenter",color:r.black.secondary})),t({animators:"opacity",opacity:this.posterTextBackground?1:0},s({width:6*n,rounded:!0,backgroundOpacity:this.posterTextBackgroundBlur?.5:1,shade:this.posterTextBackgroundShade,color:this.posterTextBackground,click:this.advanceToBackground,setShade:this.posterTextState.setPosterTextBackgroundShade}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){let e=n(3);e.defMod(t,()=>e.defClass(class Foreground extends(n(1161)){},function(t,e,i){this.subscriptions("posterTextState.posterTextForeground","posterTextState.posterTextForegroundShade"),this.propFields("widescreen","expandedColorPalette"),this.prototype.render=function(){return n(1153)({colorPalette:this.expandedColorPalette,currentColor:this.posterTextForeground,shade:this.posterTextForegroundShade,setShade:this.posterTextState.setPosterTextForegroundShade,setColor:this.posterTextState.setPosterTextForeground,edgeShadows:this.widescreen})}}))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["TextPalette","Element","VSliderPicker","PickerButton"],[e,n(1026),{PickerButton:n(1160),VSliderPicker:n(1155)}],(t,e,r,o)=>{let s;return s=function(t,{w:e,h:n}){return t.moveTo(2*e/3,n),t.lineTo(1*e/3,n),t.lineTo(0*e,0),t.lineTo(1*e,0),t.closePath()},i.defClass(class Position extends(n(1161)){},function(n,a,l){let u;this.subscriptions("viewState.gridSize","posterTextState.posterTextScaleStep"),u={top:"triangleUp",bottom:"triangleDown",left:"triangleLeft",right:"triangleRight",inside:"image"},this.prototype.render=function(){let n,a,l,c;return n=this.gridSize,a=this.posterTextState.posterTextScale,l={width:c=3.5*n,backgroundColor:"#e",iconColor:t.black.primary},e({childrenLayout:"row",childrenAlignment:"centerCenter",childrenMargins:n/2},i.array(["top","bottom","left","right","inside"],t=>o(l,{label:`${i.toString(t)}`,icon:u[t],action:()=>(this.createEventOncePerHour(`edit:placementButton:${i.toString(t)}`),this.models.posterTextState.posterTextLocationMode=t)})),r(l,{value:1.5*(a-1/3),rounded:!0,label:"size",handleColor:t.black.primary,handleScale:.8*a,click:this.models.posterTextState.cyclePosterTextScale,drawBackground:["#c",{shape:s,color:"#e"}],setValue:t=>(this.createEventOncePerHour("edit:scaleSlider"),this.models.posterTextState.posterTextScale=2*t/3+1/3)}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Element","TabButton","TextStyles","TextPalette","LargeBecomeAMemberButton"],[e,n(1026)],(t,e,r,o,s)=>{return i.defClass(class Save extends(n(1161)){},function(n,a,l){this.subscriptions("viewState.viewState","posterTextState.posterTextStyle","posterTextState.posterTextSeedsByStyleName"),this.propFields("membershipRequired","save"),this.prototype.selectStyle=function(t){return this.posterTextStyle===t?this.posterTextState.cyclePosterTextSeed(t):(this.createEventOncePerHour(`edit:select:style:${i.toString(t.getName())}`),this.posterTextState.posterTextStyle=t)},this.prototype.render=function(){let n,i,a;return n=(a=this.viewState).gridSize,i=a.feedWidth,t(this.membershipRequired?t("column","childrenCenterCenter","centerCenter",{key:"member first, then save",size:{ps:1,max:{w:i}},padding:n/2},s({compressed:!0})):t({key:"save away!",childrenLayout:"row",childrenAlignment:"centerCenter",childrenMargins:n,padding:{h:3*n/4}},e({icon:"checkmark",text:"save",backgroundColor:"#e",backgroundPadding:0,size:{h:4*n,w:25*n},action:this.save,labelStyle:r.largeText,color:o.black.primary})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PosterTextStylePicker"],[e,n(1026),{PosterTextStylePicker:n(1168)}],t=>{return i.defClass(class Style extends(n(1161)){},function(e,n,r){this.subscriptions("viewState.gridSize","posterTextState.posterTextStyle","posterTextState.posterTextSeedsByStyleName"),this.propFields("widescreen"),this.prototype.selectStyle=function(t){return this.posterTextStyle===t?this.posterTextState.cyclePosterTextSeed(t):(this.createEventOncePerHour(`edit:select:style:${i.toString(t.getName())}`),this.posterTextState.posterTextStyle=t)},this.prototype.render=function(){let e,n,i,r;return r=this,e=this.gridSize,n=this.posterTextStyle,i=this.widescreen,t({selectedStyle:n,edgeShadows:i,posterTextSeedsByStyleName:this.posterTextSeedsByStyleName,selectStyle:this.selectStyle})}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["timeout","TextElement","TextInputElement","Element","TextStyles","TextPalette","present","PickerButton","Math"],[e,n(1026),{PickerButton:n(1160)}],(t,e,r,o,s,a,l,u,c)=>{return i.defClass(class Text extends(n(1161)){},function(n,h,p){this.subscriptions("viewState.viewState","posterTextState.posterTextText","navState.overlay"),this.propFields("widescreen","selectedQuoteCategory","active","applyNextQuote"),this.stateFields({randomCount:0}),this.prototype.blurTextInput=function(){let t,e;return i.exists(t=this.refs.mainTextInput)&&i.exists(e=t.element)&&e.blur()},this.prototype.focusTextInput=function(){let t,e;return this.viewState.isTouchScreen?void 0:i.exists(t=this.refs.mainTextInput)&&i.exists(e=t.element)&&e.focus()},this.prototype.preprocessProps=function(e){let n;return(n=e.active)!==this.active&&(n?t(250,this.focusTextInput):this.blurTextInput()),p.preprocessProps.apply(this,arguments)},this.prototype.valueChanged=function({target:t}){return this.createEventOncePerHour("edit:text:changed"),/\n/.test(t.value)&&this.createEventOncePerHour("edit:text:addedNewLine"),this.posterTextState.posterTextText=t.value},this.prototype.render=function(){let n,h,p,d;return n=(d=this.viewState).gridSize,h=d.viewWidth,p=this.overlay?e:r,o("row","childrenCenterCenter",{padding:{h:this.widescreen?n/4:n},cursor:"text",childrenMargins:n/2,on:{pointerClick:this.focusTextInput}},p(s.mediumText,{color:a.black.primary,key:"mainTextInput",size:{ww:1,hch:1,max:{h:4.5*n}},type:"textarea",maxLength:1e3,value:this.posterTextText,on:{valueChanged:this.valueChanged},placeholder:"enter your text here"}),l(this.selectedQuoteCategory)?u({label:"random",backgroundColor:"#e",iconColor:a.black.primary,icon:"redo",angle:2*c.PI*this.randomCount,action:()=>(this.applyNextQuote(),this.randomCount++,t(250,this.focusTextInput))},h>750?{width:11*n,label:`next ${i.toString(this.selectedQuoteCategory)} text`,iconScale:1.5}:void 0):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PosterTextScrollableToolBar","PosterTextVariableWidthButton","PosterTextQuotes","upperCamelCase"],[e,n(1026),{PosterTextScrollableToolBar:n(1157),PosterTextVariableWidthButton:n(1169),PosterTextQuotes:n(1167)}],(t,e,r,o)=>{return i.defClass(class Theme extends(n(1161)){},function(n,s,a){this.subscriptions("viewState.gridSize","posterTextState.posterTextStyle","posterTextState.posterTextSeedsByStyleName"),this.propFields("widescreen","clearSelectedQuoteCategory","goToNextStep","applyNextQuote"),this.prototype.render=function(){return t({edgeShadows:this.widescreen},e({text:"Custom Text",action:()=>(this.clearSelectedQuoteCategory(),this.goToNextStep())}),i.array(r.sortedKeys,t=>e({icon:r.icons[t],text:o(t," "),action:()=>(this.applyNextQuote(t),this.goToNextStep())})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","ButtonWrapper","TextElement","Icons","TextPalette","TextStyles"],[e,n(1026)],(t,e,n,r,o,s)=>{return i.defClass(class StepButton extends t{},function(t,i,a){this.subscriptions("viewState.gridSize"),this.prototype.render=function(){let t,i,a;return t=(a=this.props).next,i=a.action,e({size:3*this.gridSize,disabledOpacity:0,action:i},n(r[t?"angleRight":"angleLeft"],{size:"childrenSize",location:"centerCenter",axis:"centerCenter",color:o.black.secondary}),n(s.tinyText,{location:{xw:.5,yh:.75},axis:.5,size:"childrenSize",text:t?"next":"back",color:o.black.secondary}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","models","getMostUsedTags","getTrendingTags","neq","merge","SimpleStreamCard","MiniUser","config","TextPalette","Icons","ImikimiPalette","Element","TabButton","TextElement","UserSearchConstraint","TopicSearchConstraint","TextInputElement","TextStyles","present","ButtonWrapper","timeout","lowerCamelCase","upperCamelCase","escapeRegexp","TagLink","ShowError","Spinner","ScrollerWithBar","FeedLabel","TagList","TabbedSection","compactFlatten","nicePluralize","max","commaize","PostSearchSection","PaginatedSearchResults","vertical","SampleKimis"],[e,n(1026),n(1184)],(t,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j)=>{let q,H;return q=i.array(n(774),t=>`#${i.toString(t)}`),H=q.join(" "),i.defClass(class Search extends t{},function(t,n,q){let V,$,G;this.subscriptions("viewState.viewState","navState.navState","searchState.searchState"),this.prototype.setDefaultTextFocus=function(){let t,e;return this.viewState.nativeApp?void 0:i.exists(t=this.refs)&&i.exists(e=t.searchTextInput)&&e.element.focus()},this.prototype.preprocessState=function(t){let e,n,r,u,c,h,p,d,f,m,g,y;return e=t.navState,n=t.relatedTags,r=t.viewState,i.exists(r)&&(u=r.isMobileBrowser),c=t.searchState,i.exists(c)&&(h=c.postSearchResults,p=c.currentSearchOptions),n=this.searchKimis&&(i.exists(h)&&h.length)>0?n&&h===(i.exists(d=this.state.searchState)&&d.postSearchResults)&&e.searchOptions.order===this.navState.searchOptions.order?n:"uses"===e.searchOptions.order?o(h):s(h):null,a(p,i.exists(f=this.state.searchState)&&f.currentSearchOptions)?(u&&(i.exists(m=this.refs)&&i.exists(g=m.searchTextInput)&&g.element.blur()),l(q.preprocessState.apply(this,arguments),{toSearchString:null!=(y=i.exists(p)&&p.query)?y:"",relatedTags:n})):l(q.preprocessState.apply(this,arguments),{relatedTags:n})},this.stateFields({toSearchString:"",showSearchOptions:!1,relatedTags:null,currentResultTab:null}),this.prototype.searchNow=function(){return this.models.navState.updateSearch(this.toSearchString)},V=function(t){let e,n,r;return(null!=(n=t.title)?n:t.lastPostId)?t=(e=t).lastPost:({topic:e}=t),u({topic:e,post:t,key:(null!=t?t:e).id,user:null!=(r=i.exists(t)&&t.user)?r:i.exists(e)&&e.user})},$=function(t){return c({user:t})},G={trending:{action:r.navState.sortByTrending,radius:{left:100}},date:{action:r.navState.sortByDate,radius:0},uses:{action:r.navState.sortByUses,radius:{right:100}}},this.getter({searchKimis:function(){let t,e;return!h.zoStream&&i.exists(t=this.navState)&&i.exists(e=t.searchOptions)&&e.searchKimis}}),this.prototype.renderOptions=function(){let t,e,n,o,s,a,l,u,c,b,w;return({fullScreen:t,buttonSize:e,gridSize:n,isTouchScreen:o}=this.viewState),({order:s,userId:a,topicId:l}=this.navState.searchOptions),({searchKimis:u}=this),c={color:p.black.secondary,size:"parentHeightChildrenWidth",align:.5,fontSize:.75*d.frame.fontSize},b={size:{h:e*=.8,wcw:1},backgroundColor:f.lightGrey,backgroundPadding:0},w=n,m(["parentWidthChildrenHeight","flow"],{childrenMargins:n/2},u?m(["childrenSize","row"],{key:"sort modes",childrenMargins:1,animators:{size:{toFrom:{w:0}},clip:{toFrom:!0}}},i.array(G,(t,e)=>g(b,t,{text:r.navState.getHumanSortName(e),selected:s===e}))):void 0,h.zoStream?void 0:m(["childrenSize","row"],{childrenMargins:1},g(b,{radius:{left:100},selected:u,action:this.models.navState.toggleSearchKimis,customIcon:y(d.frame,c,["childrenSize","textCenterCenter"],{padding:{left:10,right:5}})}),g(b,{radius:{right:100},action:this.models.navState.toggleSearchKimis,selected:!u,customIcon:m(["childrenSize","row"],{padding:{left:5,right:10},childrenMargins:10},i.array(["user","frame","image","book"],t=>y(d[t],c)))})),a&&v({userId:a}),l&&S({topicId:l}))},this.prototype.renderSearch=function(){let t,e,n,r,o,s,a,l,u,c,g,v,S,C,_,E,T,k,I,M,A,F;return t=(I=this.viewState).fullScreen,e=I.buttonSize,n=I.gridSize,r=I.isTouchScreen,e=I.buttonSize,s=(o=(M=this.models.navState).searchOptions).query,a=o.userId,l=o.topicId,u=M.overlay,c=M.humanSortName,g=this.searchKimis,v=this.props.visible,S=(A=this.searchState).postSearchResult,C=A.topicSearchResults,_=A.userSearchResults,m(["parentWidthChildrenHeight","row"],{key:"renderSearch",padding:{bottom:n},childrenMargins:n/2},m(["parentWidthChildrenHeight","row"],{padding:{left:n},draw:{rectangle:{radius:T=100},color:"#eee"}},v&&(E=u?y:b)(w.mediumText,"textCenterLeft",{size:{ww:1,h:e},maxLength:75,key:u?void 0:"searchTextInput",value:this.toSearchString,on:this.textInputHandlers,placeholder:k=(()=>{switch(!1){case!h.zoStream:return"search";case!g:return"uses"===c?"search kimis with the most uses":`search ${i.toString(c)} kimis`;default:return"search everything"}})(),text:null!=(F=this.toSearchString)?F:k,willConsumeKeyboardEvent:(t,e)=>"Enter"===e.key?"beforeDescendents":void 0}),x(this.toSearchString)?P("parentHeightChildrenWidth",{key:"closeButton",radius:100,backgroundPadding:n/4,action:()=>(this.models.navState.clearSearch(),this.setDefaultTextFocus())},y(d.close,{padding:{h:n}},"parentHeightChildrenWidth","textCenterCenter",{fontSize:12,color:p.black.secondary})):void 0,P("parentHeightChildrenWidth",{key:"searchButton",backgroundColor:f.primary,radius:100,backgroundPadding:n/4,action:this.searchNow},y({padding:{h:n}},d.search,"parentHeightChildrenWidth","textCenterCenter",{fontSize:16,color:p.white.primary}))))},this.getter({textInputHandlers:function(){let t;return null!=(t=this._textInputHandlers)?t:this._textInputHandlers={valueChanged:({target:t})=>this.toSearchString=t.value,domElementAttached:({target:t})=>(e.searchBox=t,this.viewState.isMobileBrowser&&(x(t.value)||x(this.toSearchString))?void 0:C(100,()=>(t.focus(),t.selectAll()))),enter:this.searchNow}},suggestedTags:function(){let t,e,n,r,o,s;return t=this.navState.searchOptions.query,e=this.toSearchString,this.searchKimis&&e!==t&&x(e)?(n=_(e),r=E(n),n.length>0&&(o=H.match(RegExp(`\\#[a-z]*${i.toString(T(n))}[a-z]*\\b`,"gi")))?(s=RegExp(`^\\#${i.toString(T(n))}|${i.toString(T(r))}`),o.sort((t,e)=>{let n,i;return n=s.test(t)?1:0,(i=s.test(e)?1:0)-n})):void 0):void 0}}),this.prototype.renderSuggestedCategories=function(){let t,e,n,r,o,s,a,u,c,h;return({query:t}=this.navState.searchOptions),({searchKimis:e}=this),({toSearchString:n}=this),e&&n!==t&&x(n)?(r=_(this.toSearchString),o=E(r),r.length>0&&(s=H.match(RegExp(`\\#[a-z]*${i.toString(T(r))}[a-z]*\\b`,"gi")))?(a=RegExp(`^\\#${i.toString(T(r))}|${i.toString(T(o))}`),s=(s=s.sort((t,e)=>{let n,i;return n=a.test(t)?1:0,(i=a.test(e)?1:0)-n})).slice(0,this.viewState.isPhone?7:15),({buttonSize:u,gridSize:c}=this.viewState),m({animators:{size:{toFrom:{ww:1,h:0}},clip:{toFrom:!0}},size:"parentWidthChildrenHeight",childrenLayout:"row",padding:{h:c/2}},this.viewState.isPhone?void 0:y({text:"suggestions:"},h=l(w.smallText,{size:{wcw:1,h:.75*u},align:.5,color:p.black.secondary})),m({childrenLayout:"flow",size:"parentWidthChildrenHeight"},i.array(s,t=>k({key:t,kimis:!0,buttonSize:u,gridSize:c,text:t}))))):void 0):void 0},this.prototype.scrollTop=function(){let t,e;return i.exists(t=this.refs.ScrollerWithBar)&&i.exists(e=t.scrollElement)&&e.scrollToTop()},this.prototype.renderSearchResults=function(){let t,e,n,r,o,s,a,l,u,c,h,p,d,g,y,v,S,b,w,x,P,C,_,E,T,k,q,H,G,Y,K,X;return({fullScreen:t,gridSize:e,feedPosition:n,viewWidth:r}=this.viewState),({query:o,userId:s,topicId:a}=this.navState.searchOptions),({searchKimis:l}=this),X=this.searchState,u=X.postSearchResults,c=X.userSearchResults,h=X.topicSearchResults,p=X.postSearchMetadata,d=X.userSearchMetadata,g=X.topicSearchMetadata,y=X.searchError,v=X.loading,s&&(c=[]),a&&(c=h=[]),S=!(b=0===(i.exists(c)&&c.length)&&0===(i.exists(u)&&u.length)&&0===(i.exists(h)&&h.length)),null!=y?I(y):v?m({size:4*e,axis:.5,location:"centerCenter"},M()):A({draw:[{padding:{top:e/2}},"clip"],key:"ScrollerWithBar",padding:(({left:w,right:x,bottom:P}=this.props.suggestedPadding),{left:w,right:x,bottom:P})},m(["parentWidthChildrenHeight","column"],{padding:{top:e}},b&&(o||l||s||a)?m("parentWidthChildrenHeight",{padding:{h:e/2}},F({wide:!0,icon:"search"},l?{title:"No Kimis found",details:"We didn't find any Kimis for your search.'\nClick here to extend your search to all people, posts and streams.",action:this.models.navState.clearSearchKimis}:{title:"No people, streams or posts found",details:"We didn't find anything for your search."})):void 0,m({key:"TrendingTags"},"parentWidthChildrenHeight","column",{visible:l&&(C=this.suggestedTags||this.relatedTags||this.searchState.trendingTags)},F({wide:!0,iconColor:f.primary,title:(()=>{switch(!1){case!this.suggestedTags:return"Suggested Tags";case!this.relatedTags:return"Related Tags";default:return"Trending Tags"}})(),icon:"tag",iconScale:.75}),B({tags:C})),R({currentTab:this.currentResultTab,selectTab:this.setCurrentResultTab,tabList:z([(i.exists(u)&&u.length)>0?(_=u,E=p.totalFound,T=p.secondQueryFound,k=p.searchParams,q=H=G=l?"Kimi frame":"post",0===E&&T>0?(E=T,T=0):i.exists(k)&&k.trending&&(q=`trending ${i.toString(G)}`),q=O(null!=E?E:_.length,q),Y=O(T>0?T:L(E,_.length),G),T>0&&(q+=` in ${i.toString(D(T))} matches`),{key:"posts",title:Y,details:`found ${i.toString(q)}`,icon:l?"frame":"image"}):void 0,(i.exists(h)&&h.length)>0&&!a?{key:"topics",title:O(h.length,"stream")}:void 0,(i.exists(c)&&c.length)>0&&!s&&!a?{key:"users",title:O(c.length,"people")}:void 0])}),(()=>{switch(this.currentResultTab){case"posts":return N({results:u,scrollTop:this.scrollTop});case"users":return U(d,{key:"userSearchResults",renderItem:$,results:c,initalPageSize:5,scrollTop:this.scrollTop});case"topics":return U(g,{key:"topicSearchResults",renderItem:V,results:h,pageSize:8,scrollTop:this.scrollTop})}})(),"imikimi"===W?m("parentWidthChildrenHeight",{key:"SampleKimis",visible:K=l&&!((i.exists(u)&&u.length)>0)},j()):void 0))},this.prototype.render=function(){let t,e,n,i;return({suggestedPadding:t}=this.props),m("column",{draw:"white",padding:(({top:e}=t),{top:e})},this.props,m("column","parentWidthChildrenHeight",{padding:(({left:n,right:i}=t),{left:n,right:i})},this.renderSearch(),this.renderOptions()),this.renderSearchResults())}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(294)).addModules({SampleKimis:n(1185),TopicSearchConstraint:n(1186),UserSearchConstraint:n(1187)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TabbedSection","PostSearchSection","LoadingOverlay"],[e,n(1026)],(t,e,n,r,o)=>{return i.defClass(class SampleKimis extends t{},function(t,s,a){this.subscriptions("searchState.kimiHomeSearchResults","searchState.kimiHomeSearchQuery","currentSession.currentUser"),this.prototype.render=function(){let t,s,a;return a=this,t=this.kimiHomeSearchResults,s=this.kimiHomeSearchQuery,e(t?"parentWidthChildrenHeight":"parentSize",t?["column",n({tabs:{sampleKimis:{icon:"frame",title:"Sample Kimi frames",details:s?`search: ${i.toString(s)}`:void 0,action:()=>(this.models.navState.sortByTrending(),this.models.navState.showSearch(s))}}}),r({results:this.currentUser?t:i.exists(t)&&t.slice(4,1e3)})]:e("clip",o()))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ImikimiPalette","ShowMedia","TextElement","TextStyles","TextPalette","getDisplayTitle","TabButton"],[e,n(1026)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class TopicSearchConstraint extends t{},function(t,c,h){this.subscriptions("topic","viewState.viewState"),this.prototype.render=function(){let t,c,h,p;return({buttonSize:t,gridSize:c}=this.viewState),h=.8*t,e("childrenSizeMaxParentWidth",["row","childrenCenterCenter"],{childrenMargins:c/4,animators:{size:{toFrom:{hch:1,w:0}},opacity:{toFrom:0}},draw:{rectangle:{radius:100},fill:n.lightGrey,clip:!0}},r({size:h,post:i.exists(p=this.topic)&&p.lastChapterPost}),o(s.smallText,"childrenSize",{padding:{left:c/4},color:a.black.secondary,text:`in ${i.toString(l(this.topic))} Stream`}),u({backgroundPadding:0,icon:"close",iconScale:.5,radius:100,size:h,action:()=>this.models.navState.removeSearchOption("topicId")}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","ImikimiPalette","UserCircle","TextElement","TextStyles","TextPalette","getShortDisplayName","TabButton"],[e,n(1026)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class UserSearchConstraint extends t{},function(t,i,c){this.subscriptions("user","viewState.viewState"),this.prototype.render=function(){let t,i,c;return({buttonSize:t,gridSize:i}=this.viewState),c=.8*t-6,e("childrenSizeMaxParentWidth",{animators:{size:{toFrom:{hch:1,w:0}},opacity:{toFrom:0},clip:{toFrom:!0}},draw:{rectangle:{radius:100},fill:n.lightGrey}},e("childrenSizeMaxParentWidth","row","childrenCenterCenter",{childrenMargins:i/4,padding:3},r({user:this.user,size:c}),o(s.smallText,"childrenSize",{color:a.black.secondary,text:"by "+l(this.user)}),u({backgroundPadding:0,icon:"close",iconScale:.5,radius:100,size:c,action:()=>this.models.navState.removeSearchOption("userId")})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","config"],[e,n(1026)],(t,e)=>{return i.defClass(class ZoHome extends t{},function(t,i,r){this.prototype.render=function(){return(()=>{switch(e.vertical){case"zoStream":return n(1189)(this.props);case"zoPeople":return n(1190)(this.props);default:return n(1191)(this.props)}})()}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pipelines","Element","Dashboard3","ScrollerWithBar","Welcome","UserCircle","TextElement","TextStyles","SimpleStreamCard","present","MarkdownView","max"],[e,n(1026)],(t,e,n,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class ZoStreamHome extends t{},function(t,f,m){this.subscriptions("viewState.viewState","currentSession.currentUserId",{welcomePost:{model:"post",key:"T0fdWcIKoAna"},topicInviteLink:function(){return e.topicInviteLink.getTopicInviteLinkIdFromEnv()},topics:{model:"topicsByUserId",key:function({currentUserId:t}){return t}}}),this.propFields("currentUser","suggestedPadding","visible"),this.prototype.render=function(){let t,e,f,m,g,y,v,S,b;return S=this,t=this.currentUser,e=this.suggestedPadding,f=this.visible,({gridSize:m}=this.viewState),n({draw:"white",visible:f},this.currentUserId?r({currentUser:t,suggestedPadding:e}):o("childrenCenterCenter",{padding:e},n({size:{h:(t,e)=>d(e.y+m,.75*this.viewState.viewHeight)}},s({postIds:["a6leXLML8KS4","go00Iwp4BMmI","iphLnVrffZPj","yMQ24f9xQ2Ii","pm0hbsRDJIyH","50x9GUd3ZomF","D8KWcpKhH61f"]})),this.topicInviteLink?n("childrenSize","column",{childrenMargins:m,padding:{bottom:2*m}},n(["row","parentWidthChildrenHeight"],"childrenCenterLeft",{childrenMargins:m},a({size:4*m,shadow:!0,userId:this.topicInviteLink.invitedByUserId}),l(u.mediumText,{text:"You're invited!\nWould you like to join this stream?"})),c((({topic:g,topicId:y}=this.topicInviteLink),{topic:g,topicId:y}))):void 0,h(i.exists(b=this.welcomePost)?v=b.caption:void 0)?n({size:{hch:1,ww:1,max:{w:700}}},p({large:this.viewState.fullscreen,text:v,includeTags:!0})):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","Welcome"],[e,n(1026)],(t,e,n)=>{return i.defClass(class ZoPeopleHome extends t{},function(t,i,r){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t;return({gridSize:t}=this.viewState),e(["column","childrenCenterCenter"],{draw:"white"},n({postIds:["6DkJlyoHkfyS","GHGQqTnCYPXV","x23PqmCoS2uW","fwYR0xxNGY8d","a6leXLML8KS4","go00Iwp4BMmI","iphLnVrffZPj","yMQ24f9xQ2Ii","pm0hbsRDJIyH","50x9GUd3ZomF","D8KWcpKhH61f"]}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","membershipExpired","WelcomeExpiredUser","Dashboard2","Welcome","HomeButtonBar","config","Element","MenuSectionLabel","TagLink","NewsHomeView","ScrollerWithBar","MenuButton2","TabbedSection","compactFlatten","TagList","SampleKimis"],[e,n(1026),n(1184)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v)=>{let S;return S=i.array(n(774),t=>`#${i.toString(t)}`),i.defClass(class ZoKimiHome extends t{},function(t,n,b){this.subscriptions("viewState.viewState","searchState.kimiHomeSearchResults","searchState.kimiHomeSearchQuery","searchState.trendingTags","navState.featuredKimiTags"),this.stateFields({smallTopMenu:!1,showAllCats:!1,showFeaturedTags:!1,selectedTagsTab:void 0}),this.propFields("currentUser","currentUserId","suggestedPadding"),this.prototype.renderEdgeAboveTheFold=function(){let t,n;return this.currentUserId?this.currentUser?e(this.currentUser)?r():o((({currentUser:t,suggestedPadding:n}=this),{currentUser:t,suggestedPadding:n})):void 0:s({samplePosts:this.kimiHomeSearchResults})},this.prototype.renderTopMenu=function(){let t,e,n,r,o,s,p,d;return({gridSize:t,fullScreen:e,paddedFeedWidth:n,viewWidth:r,buttonSize:o,feedWidth:s}=this.viewState),[a({featureDemoStreamId:i.exists(d=l.featureDemoStreams)&&d.posterText,buttons:[{icon:"search",text:"search",action:this.models.navState.searchForKimis},{icon:"star",text:"tags",action:this.toggleShowAllCats,selected:this.showAllCats},{icon:"image",text:"create",action:this.models.navState.showNewPost},{icon:"helpInverted",text:"help",action:this.models.navState.showHelp}]}),this.showAllCats?(({featuredCategoryTags:p}=this.models.navState),u("parentWidthChildrenHeight","flow",{childrenMargins:t/4,padding:{top:t/2},key:"featuredCats",animators:{size:{toFrom:{ww:1,h:0}},clip:{toFrom:!0}}},c({large:!0,label:"Featured Tags"}),i.array(p,e=>h({key:e,kimis:!0,buttonSize:o,gridSize:t,text:e})),c({large:!0,label:"Tag Suggestions"}),i.array(S,e=>h({key:`all-${i.toString(e)}`,kimis:!0,buttonSize:o,gridSize:t,text:e})))):void 0]},this.prototype.render=function(){let t,e,n,r,o,s,a,l,c;return this.models.searchState.ensureFeaturedKimiSearchIsReady(),t=(l=this.props).visible,e=l.safePadding,n=l.suggestedPadding,r=(c=this.viewState).gridSize,o=c.buttonSize,s=c.fullScreen,u("column",{draw:["white",{padding:(({top:a}=n),{top:a})},"clip","children",{child:"newsHome"}],visible:t,padding:{top:n.top,left:n.left-r,right:n.right-r}},this.currentUserId?p({padding:{bottom:r}}):void 0,d({padding:{h:r,bottom:n.bottom}},u(["parentWidthChildrenHeight","column","childrenTopCenter"],{childrenMargins:r,key:"kimiHomeMainContent"},!s&&this.currentUserId?f({text:"search Kimi frames",icon:"search",action:this.models.navState.showSearch}):void 0,this.renderEdgeAboveTheFold(),s||this.currentUserId?void 0:f({text:"search Kimi frames",icon:"search",action:this.models.navState.showSearch}),this.trendingTags?u("parentWidthChildrenHeight","column",m({currentTab:this.selectedTagsTab,selectTab:this.setSelectedTagsTab,tabOrder:g([this.trendingTags.length>0?"trendingTags":void 0,"featuredTags"]),tabs:{trendingTags:{title:"Trending Tags",icon:"trending"},featuredTags:{title:"Featured Tags",icon:"star"}}}),y({tags:"trendingTags"===this.selectedTagsTab&&this.trendingTags.length>0?this.trendingTags:i.array(this.models.navState.featuredCategories,t=>`#${i.toString(t)}`)})):void 0,v())))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(285)).addModules({AuthSettings:n(1193),BlockUserOverlay:n(1195),ChapterNavigator:n(1196),EditNewImage:n(1197),FlagUserOverlay:n(1198),Help:n(1199),Login:n(1200),Messages:n(1201),NewPost:n(1202),ProfileSettings:n(1203),ReferralOverlay:n(1212),SharePost:n(1213),SocialActivity:n(1214),StandardImport:n(1194),StreamSettings:n(1218),Subscription:n(1230),SystemMessage:n(1231)}),n(1207),n(1215),n(1219),n(1204)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","formatDate","ListItemWithDefault","PopOver","Authenticate","MenuButton","TextPalette"],[e,n(1194),n(906)],(t,e,n,r,o,s,a,l,u,c)=>{let h,p;return h=i.defClass(class ManageAuthKey extends t{},function(t,i,o){this.prototype.render=function(){let t,i,o;return t=(o=this.props).authenticationKey,i=o.gridSize,e({size:{h:50,ww:1},padding:{left:i}},["row","centerCenter"],n(r.smallText,"parentWidthChildrenHeight",{text:t.denormalizedAddress}))}}),p=i.defClass(class AuthKeyList extends t{},function(t,n,r){this.subscriptions({authKeys:{model:"authenticationKeysByUserId",key:function({currentUser:t}){return t.id}}}),this.prototype.deleteItem=function(t){return this.models.session.deleteAuthenticationKey({data:{authenticationKeyId:t}})},this.prototype.render=function(){let t;return t=this.props.currentUser,e(["parentWidthChildrenHeight","column"],i.array(this.authKeys,t=>{let e,n,r,a;return e=t.id,a=n=t.denormalizedAddress,(r=t.lastUsedAt)&&(a+=`\nlast used: ${i.toString(r&&o(r,"m-d-yyyy, h:MMtt"))}`),s({id:e,key:e,description:a,deleteItem:this.deleteItem,deletable:this.authKeys.length>1})}))}}),i.defClass(class AuthSettings extends t{},function(t,i,o){this.subscriptions("viewState.viewState","navState.searchVisible","currentSession.currentUser"),this.stateFields({addEmail:!1}),this.prototype.render=function(){let t,i,o,s;return t={size:"parentWidthChildrenHeight",childrenLayout:"column",animators:{size:{toFrom:{ww:1,h:0}},clip:{toFrom:!0}}},({currentUser:i}=this.state),({fullScreen:o,gridSize:s}=this.state.viewState),a({title:"Manage Email Addresses"},e(["parentWidthChildrenHeight","column"],{padding:s},this.addEmail?e(t,{key:"addEmail"},l({prompt:"add email",addEmail:!0,success:this.toggleAddEmail}),u({key:"toggleAddEmail",icon:"cancel",text:"cancel",action:this.toggleAddEmail})):e(t,{key:"main"},e(["parentWidthChildrenHeight","column"],n(r.mediumText,"parentWidthChildrenHeight",{color:c.black.primary,margin:s,text:"Your Email Addresses"}),p({currentUser:i})),u({key:"toggleAddEmail",icon:"mail",text:"Add email",action:this.toggleAddEmail}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t){n(3).defMod(t,()=>n(810).mergeWithSelf(n(909)))}).call(this,n(2)(t))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","logRejectedPromises","getDisplayName","PopOver","ImikimiPalette","MenuSection","MenuMarkdown","niceFullDateString","MenuButton","MenuChooseAndConfirm"],[e,n(1194)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class BlockUserOverlay extends t{},function(t,h,p){let d;this.subscriptions("viewState.gridSize",{topics:{model:"topicsByUserId",key:d=function({userId:t,user:e,currentUser:n}){return e||(e=n),i.exists(e)&&e.id||t}},migrationUpdatedAtString:{model:"ageString",key:function({user:t,currentUser:e}){return t||(t=e),i.exists(t)&&t.migrationUpdatedAt}},blockedUser:function({user:t,currentUser:e}){return e&&t?{userId:e.id,blockedUserId:t.id}:void 0}}),this.stateFields({loading:!1}),this.propFields("user"),this.prototype.blockUser=function(t){return this.models.blockedUser.create({data:{blockedUserId:this.props.user.id,reason:t}}).then(t=>this.setState({blockedUserByUserIdAndBlockedUserId:t}))},this.prototype.unblockUser=function(){let t,n;return this.triggerLoading(),e("unblockUser",this.models.blockedUser.delete({returnResponse:!0,key:(({userId:t,blockedUserId:n}=this.blockedUser),{userId:t,blockedUserId:n})})).finally(this.clearLoading)},this.prototype.render=function(){let t,e;return t=this.user,e=n(t),r({titlebarColor:o.warningBackground,centered:!0,title:`Block ${i.toString(e)}`},this.blockedUser?s(a({text:`${i.toString(e)} is blocked from commenting on\nany of your posts.\n\n* when: ${i.toString(l(this.blockedUser.createdAt))}\n* reason: ${i.toString(this.blockedUser.reason)}`}),u({icon:"blockComment",text:`unblock ${i.toString(e)}`,action:this.unblockUser})):c({options:"egregious or repeated personal attacks\negregious or repeated threatening statements\nrepeated lack of civility\nrepeated off-topic comments\nrepeated other offenses",icon:"blockComment",label:`Block: ${i.toString(e)}`,info:`This will prevent '${i.toString(e)}' from commenting on any of your posts.`,prompt:"Please select your reason for blocking:",action:this.blockUser,close:this.clearShowBlockUser,completionMessage:`'${i.toString(e)}' is now blocked from commenting on your posts.`,generateConfirmMessage:t=>`Block '${i.toString(e)}' from commenting on any of my posts because of ${i.toString(t)}`}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","getPostColors","getDisplayChapterTitle","Element","ShowMedia","ColorFadeOverlay","TextElement","TextStyles","TextPalette","present","PostInfo","TabButton","ClientLib","SlideshowElement","PopOver","getDisplayTitle","Spinner"],[e,n(1194)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v)=>{let S,b;return S=20,b=i.defClass(class Chapter extends t{},function(t,g,y){this.subscriptions("post","viewState.viewState"),this.stateFields({showPosts:!1}),this.prototype.preprocessState=function(t){let n;return t.initialized?y.preprocessState.apply(this,arguments):e(y.preprocessState.apply(this,arguments),{initialized:!0,showPosts:!!(this.props.showPosts&&(i.exists(n=this.props.posts)&&n.length)<=20)})},this.prototype.render=function(){let t,e,g,y,v,S,b,w,x,P,C,_,E;return _=this.props,t=_.gridSize,e=_.popOverWidth,g=_.action,y=_.postCount,v=_.chapterNumber,S=_.posts,b=this.showPosts,w=(E=n(this.post)).foreground,x=E.background,P=r(this.post),C=4,o(["column","parentWidthChildrenHeight"],{draw:[{rectangle:{radius:t}},"clip"]},o({on:{pointerClick:()=>g(this.post)},size:{ww:1,h:9*t}},s({post:this.post,mediaSize:"large"}),{cursor:"pointer"},a({color:x},o("parentWidthChildrenHeight","row","childrenBottomRight",{childrenMargins:t,padding:t},l(u.smallText,"parentWidthChildrenHeight",{color:c.white.primary,text:`Chapter ${i.toString(v)}`+(h(P)?`\n${i.toString(P)}`:"")}),p({post:this.post,postCount:y}))),d({radius:100,backgroundColor:x,hoverColor:w,color:c.white.primary,inFlow:!1,icon:this.showPosts?"triangleDown":"triangleRight",size:this.viewState.buttonSize,location:this.viewState.gridSize/2,action:this.toggleShowPosts})),(i.exists(S)&&S.length)>0?o(["parentWidthChildrenHeight","column"],{draw:x},b?(S=S.slice().reverse(),o("parentWidthChildrenHeight",{key:"contents",padding:{bottom:t,h:t},animators:{size:{toFrom:{ww:1,h:0}},clip:{toFrom:!0}}},i.array(f.layoutPostsWithDynamicAspectRatios({posts:S,margin:t/2,width:e-t,rowAspectRatio:2.5,minAspectRatio:.8}),e=>m(e,{gridSize:t,justPost:!0,chapterPost:this.post})))):void 0):void 0)}}),i.defClass(class ChapterNavigator extends t{},function(t,n,r){this.subscriptions("topic","viewState.viewState",{postsDesc:{key:function({topic:t,topicId:e}){return i.exists(t)&&t.id||e},model:"postsByTopicIdDesc"}}),this.stateFields({posts:null}),this.prototype.action=function(t){return this.models.navState.hideOverlay().then(()=>this.models.navState.showPost(t))},this.prototype.preprocessState=function(t){let n,o,s;return t.postsDesc?(n=t.postsDesc.slice().reverse(),o=[],s=null,i.each2(n,t=>(!t.isChapterStart&&s||o.push(s={post:t,posts:[],postCount:0,chapterNumber:o.length+1}),s.postCount++,s.posts.push(t))),e(r.preprocessState.apply(this,arguments),{chapters:o,posts:n})):r.preprocessState.apply(this,arguments)},this.prototype.render=function(){let t,e,n,r,s,a,l,u,c,h,p;return({gridSize:t,popOverWidth:e}=this.viewState),n=0,({chapters:r}=this.state),s=(i.exists(a=this.posts)&&a.length)<=100,g({title:`All Posts in ${i.toString(y(this.topic))}`,userId:this.topic.userId,titlePost:i.exists(l=this.topic)&&l.lastChapterPost,centered:!0,fullHeight:!0},o(["column","parentWidthChildrenHeight"],{childrenMargins:t/2,padding:this.viewState.isPhone?void 0:t/4},r?(c=[],null!=(u=r||[])&&(h=u.length-1,(()=>{for(;h>=0;){let n;n=u[h],c.push(b(n,{showPosts:s,popOverWidth:e,gridSize:t,key:n.post.id,action:this.props.action||this.action})),p=h--}})()),c):o({size:{ww:1,h:4*t}},v())))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["AbstractOverlayComponent","zoPickImage","MenuSection","MenuButton","Element","point","ButtonWrapper","ImikimiPalette","TextElement","TextStyles","TextPalette"],[e,n(1194)],(t,e,n,r,o,s,a,l,u,c,h)=>{let p,d;return(p=[[5,6],[4,5],[3,4],[2,3],[1,1],[6,5],[5,4],[4,3],[3,2],[11,8],[1.618,1],[16,10],[5,3],[1.85,1],[16,9],[18,9],[21,9],[2.7,1]]).sort(function(t,e){return t[0]/t[1]-e[0]/e[1]}),d=20,i.defClass(class EditNewImage extends t{},function(t,d,f){this.prototype.startFromImage=function(){return e().then(({bitmap:t,colorInfo:{colors:e}})=>this.models.navState.startNewKimi({bitmap:t,colors:e}))},this.prototype.render=function(){return f.render.call(this,{title:"New Image or Frame",fullHeight:!0},[n({label:"start with background photo"},r({icon:"image",text:"Select background photo",action:this.startFromImage})),n({label:"start with blank canvas"},o(["parentWidthChildrenHeight","flow"],i.array(p,([t,e])=>{let n,r,p;return r=(r=s({aspectRatio:n=t/e,area:100})).fitInto(p=s((this.viewState.feedWidth-4*this.viewState.gridSize)/4)),a({margin:this.viewState.gridSize/2,size:p,backgroundColor:l.lightGrey,backgroundPadding:0,action:()=>this.models.navState.startNewKimi({aspectRatio:n})},o({size:r,draw:l.grey,scale:(t,e)=>(1===n?.85:1)*t.minRatio(e)},"pointerCursor","centerCenter",u(c.smallText,"textCenterCenter","parentSize",{text:`${i.toString(t)}:${i.toString(e)}`,color:h.white.primary})))})))])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","PopOver","ImikimiPalette","getDisplayName","InlineFlagOptions"],[e,n(1194)],(t,e,n,r,o)=>{return i.defClass(class FlagUserOverlay extends t{},function(t,s,a){this.propFields("user"),this.prototype.render=function(){return e({titlebarColor:n.warningBackground,centered:!0,title:`Flag ${i.toString(r(this.user))}`},o({userId:this.user.id}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Neptune","verticalProductName","config","pipelines","secondsPer","log","humanDurationString","timeout","present","PopOver","Element","TextStyles","MenuSectionGroup","MenuSection","MenuButton","MenuMarkdown","MenuTopic","dateAgeString","getEnv","TextElement","TextPalette","openLink","docUrls"],[e,n(1194)],(t,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_)=>{return i.defClass(class Help extends t{},function(t,E,T){let k,I;this.subscriptions("viewState.viewState","navState.searchVisible","currentSession.currentUser",{ageString:n.Imikimi.Oz.deployedAt,newsTopic:{model:"topic",key:function(){return o.newsTopicId}},newsTopic2:{model:"topic",key:function(){return o.newsTopic2Id}}}),this.propFields({helpPage:null}),this.stateFields({versionInfo:null}),this.setter({helpPage:function(t){return this.models.navState.showHelp({helpPage:t})}}),this.prototype.clearHelpPage=function(){return this.models.navState.showHelp({})},this.prototype.loadVersion=function(t=1){return this._stopLoadingVersion?void 0:s.status.version().then(e=>{let n;return this.versionInfo=e,n=this.models.currentSession.currentlyAdmin?5:a.minute,l({Help_loadVersion:{versionInfo:e,count:t,nextUpdate:u(n,!0)}}),c(1e3*n,()=>this.loadVersion(t+1))})},this.prototype.componentWillMount=function(){return T.componentWillMount.apply(this,arguments),this.loadVersion()},this.prototype.componentWillUnmount=function(){return this._stopLoadingVersion=!0},this.prototype.preprocessProps=function(t){return this.models.event.create(`help:${i.toString(t.helpPage||"home")}`),T.preprocessProps.apply(this,arguments)},k={about:{icon:"magicWand",title:`About ${i.toString(r)}`,text:`# About ${i.toString(r)}\n\nWe've been working on Zo for many years now. For our current, Imikimi customers, Zo is a great new way to share and organize your Kimis with hashtags, Zo-Streams, chapters, and posts.\n\nBrowsing, making and sharing Kimis looks very different, but you can still search and browse for Kimi frames, customize them and share them, both here on Zo, and on Facebook or elsewhere on the web.\n\nZo is more than just a new Imikimi, though. It's a whole new way of thinking about sharing and connecting that we believe can revolutionize how we build meaningful relationships online. It starts with Zo Streams, but we have lots more planned. This is just the beginning.`},aspiration:{icon:"earth",title:"Our Aspiration for Zo",text:"# Our Aspirations\nWe aspire to make it easy for you to build great, meaningful connections with other people like you, in both the digital and physical worlds.\n\nWe believe:\n\n- There are people who share each and every one of your passions.\n- Everyone is the best at some things and that should be shared.\n- Everyone can do their best, and we want to make sure you are appreciated.\n- Everyone has lots of interests and each interest matches only some people.\n\nOur passion is to make it easy to share your passions in beautiful ways and connect with others with common interests. That includes both people you already know, and people you find and meet here."},topics:{icon:"book",title:"Zo-Streams",text:`# Zo Streams\n\nStreams are like a photo album you can follow. They are a collection of posts sorted by date. Each stream has a title, which can be virtually anything you can think of: sailing, pastries, cars, or even underwater-basket-weaving.\n\nStreams can be public or private. Only you can see your private streams. Public streams can be shared and discovered by other Zo visitors.\n\nWith Zo, everyone can create their own streams focused on their unique experiences, projects, adventures, passions and interests. Instead of following a person, and everything they share whether you want to see it or not, here on ${i.toString(r)} you can follow just their streams that interest you.`},chapters:{icon:"chapter",title:"Stream Chapters",text:"# zoStream Chapters\n\nStreams can be broken up into chapters. Chapters help you organize a big stream, just like chapters in a book. Chapters are useful for marking different segments of your travels, different stages of your project, or just to break things up and keep things interesting.\n\nEvery post in a chapter shares the same chapter-title, color-theme and cover-photo. To start a chapter, browse to the first post you want in the chapter, click the settings icon (), and choose 'Begin chapter here.'\n\nTo browse a stream's chapters, click the chapter-photo or select 'Show all posts' under the settings icon."},tags:{icon:"hashtag",title:"Tags",text:"# Tags\n\nAdding tags to your Stream-Titles, Chapter-Titles and Post-Captions can make it easy for others to find your topics and posts.\n\nAll you need to do is place a '#' symbol in front of a word to make it a tag. Tags can also be phrases.\n\nExamples:\n\n- #EiffelTower\n- #I-love-coffee\n- #wood_working\n\nAll three styles of tag-phrases are equivalent and will link to each other: #EiffelTower is the same as #eiffel-tower is the same as #eiffel_tower.\n\nYou may notice that your tags appear without the '#' in most places. This is intentional. It makes the text more readable. The tag appears again, with the #, as a button you can click or tap to find other posts with that tag."},photos:{icon:"image",title:"High Quality Photos",text:"# High Quality Photos\n\nPhotos on Zo are up to 4x higher quality than other sharing services. We preserve 3 megapixels from your original photo.\n\nZo supports all aspect ratios from portrait and landscape to panorama and square. We strive to make your photo look great on all devices through intelligent clipping and zooming. You can help by specifying the focal-point of your photo.\n\nIntelligent color-detection software automatically generates a color-theme to set the mood and make your topics and chapters pop. You can customize your color-scheme from the settings screen of the first post of your stream or chapter."},focus:{icon:"target",title:"Photo Focal Point",text:"# Photo Focal Point\nWhether your photo is portrait, landscape, panorama or square, we want to make it look amazing on all devices. You can help by specifying a focal-point. By telling us the most important part of your photo, we can guarantee it is always visible.\n\nChange your photo's focal-point by clicking the settings icon () and then selecting 'set focal point.' From there you can either Tap one of the previews or Drag it until it looks just right."},tips:{icon:"handRight",title:"Quick Tips and Tricks",text:'# Mobile Tips\n- Swipe left and right to view the previous or next post in a stream.\n\n# Desktop Tips\n- Click arrow buttons to got to the next or previous post in a stream.\n- Click on the book icon when hovering over the Stream title, to see a list of posts and chapters in a stream.\n- Click on the member\'s circular profile photo to see a list of their zoStreams.\n- Click on photo to see it better.\n- Click on Home or "X" to return to the main browse screen.\n\n# Other Tips\n- The browse screen timeline shows current posts in Topics you have followed first, then everything else.\n- Try the Search bar to find other things you are interested in.\n- Turn Kimi search on and off by using the slider button with the frame icon.'}},I=function(t){let e,n;return({text:e}=k[t]),n=e.split(/\s*(\n\s*)+/),i.array(n,t=>/^[-*] /.test(t)?{style:"bullet",text:t.slice(2,t.length)}:/^# /.test(t)?{style:"heading",text:t.slice(2,t.length)}:{style:"body",text:t},t=>h(t=t.trim()))},this.prototype.render=function(){let t,s,a,u,c,h,E,T,M,A,F,B,R,z;return({currentUser:t}=this.state),({fullScreen:s,gridSize:a,nativeApp:u}=this.state.viewState),({tutorial:c}=n.Imikimi.Oz.config),c&&(h=i.exists(B=c.zoHome)&&B.topicId,E=i.exists(R=c.kimiHome)&&R.topicId,T=c.streams),p({title:"Help",fullHeight:!0},d({padding:{bottom:a/2}},["parentWidthChildrenHeight","column"],this.helpPage?(({fontSize:M}=f.mediumText),m({key:"actual help"},g(d("parentWidthChildrenHeight",{padding:{v:a},childrenLayout:"column"},i.array(I(this.helpPage),({style:t,text:e})=>d("parentWidthChildrenHeight",{margin:(()=>{switch(t){case"bullet":return 1.5*M;default:return{top:3*M,bottom:M}}})()},x("parentWidthChildrenHeight",{padding:{left:"bullet"===t?2*a:0},leading:1.5,color:P.black.secondary,text:e},(()=>{switch(t){case"heading":return f.mediumBoldText;default:return f.mediumText}})()),"bullet"===t?d({size:10,axis:.5,location:{x:a,y:f.mediumText.fontSize/2},draw:["circle",P.black.secondary]}):void 0))),y({icon:"angleLeft",text:"back to help",action:this.clearHelpPage})))):m(g(v({text:"Zo is for everyone who wants to share all their adventures, stories, passions and creations and building meaningful connections."}),i.array(k,({icon:t,title:e},n)=>y({icon:t,text:e,action:()=>(l(`show help: ${i.toString(n)}`),this.helpPage=n)}))),u?g({label:"rate"},y({icon:"star",text:"Rate this app",action:()=>{let t;return i.exists(t=e.AppRate)&&t.promptForRating()}})):g({label:"apps"},y({icon:"appleInc",text:"Get the iPhone & iPad app",action:()=>(this.models.event.create("help:getApp:iOs"),C("https://itunes.apple.com/us/app/imikimi-zo/id1353175034"))}),y({icon:"android",text:"Get the Android app",action:()=>(this.models.event.create("help:getApp:android"),C("https://play.google.com/store/apps/details?id=com.imikimi.app11"))})),o.newsTopicId||o.newsTopic2Id?g({label:"news"},d(["parentWidthChildrenHeight","column"],{childrenMargins:a},this.newsTopic&&S({usePostTitle:!0,topic:this.newsTopic}),this.newsTopic2&&S({usePostTitle:!0,topic:this.newsTopic2}))):void 0,g({label:"feedback"},v({text:"What are we doing right? How could we be better? How can we help you? We'd love to hear from you."}),y({icon:"mail",action:this.models.feedback.sendFeedback,text:"Email Help and Feedback"}),v({text:">-- feedback@imikimi.com"})),T?g({label:"tutorials"},i.array(T,(t,e)=>y({icon:"info",text:t,action:()=>this.models.navState.showPost(e)}))):void 0,h||E?g({label:"welcome streams"},E&&y({icon:"book",text:"Show welcome stream",action:this.models.tutorialState.showKimiTutorial})):void 0,g({label:"terms"},y({icon:"info",text:"Community Guidelines",action:()=>C(_.community)}),y({icon:"info",text:"Terms of Use",action:()=>C(_.terms)}),y({icon:"info",text:"Privacy Policy",action:()=>C(_.privacy)}),y({icon:"info",text:"Copyright Notices",action:()=>C(_.copyright)})),g({label:"information"},v({text:u?`${i.toString(r)} Native v${i.toString(n.Imikimi.Oz.version)} released ${i.toString(this.ageString)}`:`${i.toString(r)} v${i.toString(n.Imikimi.Oz.version)} released ${i.toString(this.ageString)} ${i.toString(u?void 0:this.versionInfo?(({updateAvailable:A,serverDeployedAt:F}=this.versionInfo),A?`\n* New version available ${i.toString(F?b(F,!0):"")}`:"\n* Client is up to date."):"")}`.trim()}),!u&&i.exists(z=this.versionInfo)&&z.updateAvailable?y({icon:"redo",text:`update to latest version (v${i.toString(this.versionInfo.serverVersion)})`,action:()=>e.document.location.reload()}):void 0),w().curate?g({label:"curate"},y({icon:"redo",text:"run read-only UI tests",action:()=>n.Imikimi.Oz.Client.LiveTests.ReadOnly.testAll()})):void 0)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","log","timeout","PopOver","Element","Authenticate"],[e,n(1194),n(906)],(t,e,n,r,o,s)=>{return i.defClass(class Login extends t{},function(t,i,a){this.subscriptions("viewState.viewState","currentSession.currentUserId"),this.stateFields({authActionTriggered:!1}),this.prototype.preprocessState=function(t){let i;return t.currentUserId&&!t.authActionTriggered&&(e({Login:{doing:"hideOverlay",success:this.props.success}}),i=n(250,()=>this.models.navState.hideOverlay("Login")),this.props.success||i.then(this.models.navState.showProfileSettings),this.authActionTriggered=!0),a.preprocessState.apply(this,arguments)},this.prototype.render=function(){let t;return({gridSize:t}=this.state.viewState),r({title:"Sign Up or Log In",fullHeight:!0,track:"bottom"},o("parentWidthChildrenHeight",{padding:t},s(this.props)))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["AbstractOverlayComponent","ImikimiPalette","getPostBackground","getPostTitle","pending","Element","CommentForm","getPostAspectRatio","ShowMediaWithText","ShowMedia","present","MarkdownView","UserCircle","PostMessages"],[e,n(1194)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f)=>{return i.defClass(class Messages extends t{},function(t,m,g){let y;this.subscriptions("currentSession.currentUser","post",{messagesByPostId:y=function({post:t,postId:e}){return e||i.exists(t)&&t.id}}),this.prototype.showPost=function(){return this.models.navState.showPost(this.post)},this.prototype.submit=function(t){return this.models.message.create({data:{postId:y(this.props),text:t}})},this.prototype.componentWillMount=function(){let t,e,n;return g.componentWillMount.apply(this,arguments),({currentUser:t}=this.state),({post:e,postId:n}=this.props),n||(n=i.exists(e)&&e.id),t&&n?this.models.postParticipant.seen({key:n}):void 0},this.prototype.render=function(){let t,i,m,y,v,S,b,w,x,P,C;return({currentUser:t}=this.state),({fullScreen:i,deviceType:m,gridSize:y}=this.viewState),v=e.primary,S=n(this.post),g.render.call(this,{fullHeight:!0,title:null!=(C=r(this.post))?C:"Conversation",titlePost:this.post,clickTitle:this.showPost,centered:!0,track:"bottom",loading:b=this.messagesByPostIdStatus===o,fixedBottomChildren:s("parentWidthChildrenHeight",{padding:y/2},a({post:this.post,disabled:b}))},s("column","parentWidthChildrenHeight",{childrenMargins:y},this.post.mediaFile?1<(w=l(this.post))?s({size:{ww:1,hw:1/w}},u({post:this.post})):s("parentWidthSquare",{draw:S},c({layout:"fit",post:this.post})):void 0,h(this.post.caption)?p({post:this.post,padding:{h:y,top:this.post.mediaFile?0:y},large:!1,searchKimis:this.post.templateFile,includeTags:!0}):void 0,s("parentWidthChildrenHeight",["row","childrenCenterCenter"],{padding:{v:y/2}},d({size:3*y},(({user:x,userId:P}=this.post),{user:x,userId:P}))),s({size:{h:1},draw:{padding:{h:y},fill:S.withAlpha(.5)}}),s("parentWidthChildrenHeight",{padding:y/2},f(this.subPageActionProps,{post:this.post}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["AbstractOverlayComponent","normalizeTagsInText","timeout","pipelines","hashtagRegexp","pluralize","Element","TextElement","TextStyles","TextPalette","TextInputElement","getShortDisplayName","max","MenuToggle","ImikimiPalette","ShowMedia","ImikimiStyles","TabButton","PosterTextButton","rect","config","NewFeature","PosterTextIcon","getPostColors","getColorPalette","present","getDisplayTitle","MenuSectionGroup","MenuSection","pending","ProgressBar","Spinner","success","failure","MenuButton","InlineShare","merge","compactFlatten","PrimaryMenuButton","Authenticate","MarkdownView","ButtonWrapper","min","vertical","Icons","upperCamelCase","TopicSelector","bound","MenuEditableText","MenuMarkdown","LargeBecomeAMemberButton","humanDurationString","SimpleStreamCard"],[e,n(1194),n(906)],(n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q,H,V,$,G,Y,K,X,J,Q,Z,tt,et)=>{let nt;return nt="Choose a name for your stream. It doesn't have to be perfect. You can change it at any time.\n\nIdeas: Sailing, Photography, Beetles Tribute, Favorite Animals, Trip to Venezuela, Bathroom Remodel",i.defClass(class NewPost extends n{},function(n,it,rt){let ot;this.prototype.hotModule=t,this.subscriptions("newPostState.newPostState","navState.overlay","currentSession.grantMemberAccess",{topicsWithoutNew:{model:"topicsByUserId",key:function({currentUser:t,currentUserId:e}){return null!=e?e:i.exists(t)&&t.id}}}),this.stateFields({defaultTopic:null,showOptions:!1,showPhotoButtons:!1,editingNewTopicTitle:!1,aboutStreams:!1,topics:[],showBadCaptionMessage:!1,canPostInfo:null}),this.propFields({currentUser:null,currentUserId:null}),this.prototype.updateCanPostInfo=function(t=this.props){return this.models.recentPost.canPostInfo().tap(t=>{let e,n,r;return e=t.member,n=t.canPost,r=t.currentUser,this.models.event.create(`client:recentPost:requireCanPost:${i.toString((()=>{switch(!1){case!e:return"member";case!!r:return"noUser";case!n:return"postAllowed";default:return"postDenied"}})())}`,t)}).then(this.setCanPostInfo)},ot=function({currentUserId:t,currentUser:e}){return null!=t?t:i.exists(e)&&e.id},this.prototype.preprocessProps=function(t){let e;return ot(this.props)===(e=ot(t))&&null!=this.canPostInfo||this.updateCanPostInfo(t),t},this.prototype.captionChanged=function(t,e){let n,i,s;return({text:t,cursor:n}=r(t,e.selectionStart)),(i=this.models.newPostState.setCaption(t))!==t?(this.showBadCaptionMessage=!0,o(250,()=>this.showBadCaptionMessage=!1),({selectionStart:s}=e),s--,e.value=i,e.selectionStart=s,e.selectionEnd=s):n!==e.selectionStart?e.selectionStart=n:void 0},this.prototype.renderCaptionPost=function(){let t,e,n,r,o,m,g,y,v,S,b,w;return({gridSize:t,viewHeight:e}=this.viewState),({visible:n,editorSave:r,currentUser:o}=this.props),({maxLength:m,maxTags:g}=s.post.fields.caption),({caption:y}=this.newPostState),v=i.exists(y)&&y.match(a),(i.exists(y)&&y.length)>m/2&&(S=`${i.toString(m-y.length)} characters left`),(i.exists(v)&&v.length)>1&&(b=v.length===g?"no #tags left":`${i.toString(l(g-v.length,"#tag"))} left`),u({key:"captionPost",size:"parentWidthChildrenHeight",clip:!0,padding:t},S||b?(w=S&&b?`${i.toString(S)}, ${i.toString(b)}`:null!=S?S:b,c(h.tinyText,{text:w,size:"childrenSize",axis:"bottomRight",location:"topRight",animators:"fontSize",color:p.black.secondary})):void 0,d(h.mediumText,{key:"captionInput",type:"textarea",maxLength:m,animators:"size",size:this.textInputSafeSize,value:y,padding:{v:t/2},placeholder:this.bitmap?r&&!this.firstTopic?"add description and #tags here":`say something about this ${i.toString(this.humanPostType)}`:`What's on your mind, ${i.toString(f(this.props.currentUser))}?`,color:p.black.primary,on:{valueChanged:({target:t})=>this.captionChanged(t.value,t)}}))},this.getter({textInputSafeSize:function(){let t,e,n,i,r;return({isTouchScreen:t,nativeApp:e,safePadding:n,viewHeight:i,gridSize:r}=this.viewState),{ww:1,hch:1,max:{h:m(100,.5*(i-10*r-n.top-n.bottom))}}}}),this.prototype.renderTogglePublicStream=function(){let t,e;return t=!(i.exists(e=this.newPostState)&&e.newTopicPrivate),g({text:t?"public":"private",icon:t?"public":"private",isOn:t,action:this.models.newPostState.toggleNewTopicPrivate})},this.prototype.renderPostPreview=function(){let t,e,n,r,o,s,a,l,c,h;return({gridSize:t,heightAdjustedButtonSize:e,buttonSize:n,isTouchScreen:r}=this.viewState),(o=i.exists(h=this.newPostState)&&h.selectedImageInfo)&&({bitmap:s,colors:a}=o),({focus:l}=this.newPostState),c={backgroundPadding:t/4,size:n,color:p.white.primary},u({noFocus:!0,key:"previewStuff",clip:!0,animators:{size:{toFrom:{ww:1,h:0}}},size:{ww:1,hw:1/s.aspectRatio,max:{hh:1}},on:{mouseIn:this.triggerShowPhotoButtons,mouseOut:this.clearShowPhotoButtons},draw:this.isProfilePost?y.lightGrey:void 0},u(this.isProfilePost?{size:t=>t.min(),location:"centerCenter",axis:.5,draw:["circle","clip"]}:void 0,v({post:{focus:l,bitmap:s,colors:a,aspectRatio:s.aspectRatio},focusEditMode:!0,focusChanged:this.models.newPostState.setFocus,dragOk:!1})),u({receivePointerEvents:"passToChildren",draw:{rectangle:t=>x(t.w,1.5*n),fill:{color:S.sineGradient("#0002","#0000"),to:"bottomLeft"}}},!this.props.editorSave&&b(c,{location:"bottomLeft",axis:"bottomLeft",palette:"primary",icon:"paintbrush",action:this.models.navState.resumeKimiCreator}),!this.props.editorSave&&b(c,{icon:"trash",animators:{opacity:{toFrom:0}},location:"topRight",axis:"topRight",iconScale:.75,action:this.models.newPostState.removePhoto}),this.postIsTemplate||this.isProfilePost?void 0:w({showNewFeature:!0})))},this.prototype.renderStartPost=function(){let t,e,n;return({gridSize:t,buttonSize:e}=this.viewState),n={size:{h:2*e,ww:1},radius:t,backgroundPadding:0,palette:"primary",labelStyle:h.mediumText,labelBottom:!0},u({key:"addImageryOptions",animators:{size:{toFrom:{ww:1,h:0}}},clip:!0,padding:{h:t/2,top:t/2},size:"parentWidthChildrenHeight",childrenLayout:"row",childrenMargins:t/2},P.zoStream?void 0:b(n,{customIcon:u({size:2*e-t},C({addedAt:"2018-11-20",location:{xw:.5,y:3}}),_({simple:!0})),action:this.models.posterTextState.tryPosterText}),b(n,{icon:"image",label:"photo",action:this.models.newPostState.selectPhoto}),P.zoStream?void 0:b(n,{icon:"frame",label:"edit new",action:this.models.navState.showEditNewImage}))},this.prototype.postAnotherPhoto=function(){return this.models.newPostState.resetState(),this.props.editorSave?this.models.navState.showEditNewImage():this.models.newPostState.selectPhoto()},this.prototype.trashPost=function(){return this.models.navState.hideNewPost(),o(250).then(()=>this.models.newPostState.resetState())},this.getter({captionAllowed:function(){return!this.firstTopic||!!this.bitmap},haveOptions:function(){return!this.isProfilePost&&(this.models.newPostState.selectedTopic&&this.canBeChapterStart||this.models.newPostState.newTopicTitle)},colors:function(){let t;return E(i.exists(t=this.newPostState)&&t.selectedImageInfo)},colorPalette:function(){let t;return T(i.exists(t=this.newPostState)&&t.selectedImageInfo)},colorInfo:function(){let t,e;return i.exists(t=this.newPostState)&&i.exists(e=t.selectedImageInfo)&&e.colorInfo},chapterColors:function(){let t;return this.isNewTopic||this.isProfilePost?this.colors:E(i.exists(t=this.selectedTopic)&&t.lastChapterPost)},havePostContents:function(){let t,e,n;return(t=this.newPostState)?(({selectedImageInfo:e,caption:n}=t),e||k(n)):void 0},canBeChapterStart:function(){let t;return i.exists(t=this.newPostState)&&t.selectedImageInfo},postForShowMedia:function(){return this.models.newPostState.postForShowMedia},havePhoto:function(){let t,e;return!!(i.exists(t=this.newPostState)&&i.exists(e=t.selectedImageInfo)&&e.bitmap)},firstTopic:function(){let t;return!((i.exists(t=this.topics)&&t.length)>=1)},newTopicTitle:function(){let t;return i.exists(t=this.newPostState)&&t.newTopicTitle},haveNewTopicTitle:function(){return k(this.newTopicTitle)},selectedTopic:function(){return this.newPostState.selectedTopic},caption:function(){let t;return i.exists(t=this.newPostState)&&t.caption},isNewTopic:function(){return this.models.newPostState.isNewTopic},isPrivateTopic:function(){let t;return i.exists(t=this.selectedTopic)&&t.private},canEditTopicTitle:function(){return!this.newPostState.isProfilePost&&this.isNewTopic},isProfilePost:function(){return this.newPostState.isProfilePost},isFirstProfilePost:function(){return this.newPostState.isProfilePost&&!this.models.currentSession.currentUser.profileTopicId},topicTitle:function(){return this.isNewTopic?this.newTopicTitle:I(this.selectedTopic)},bitmap:function(){let t,e;return i.exists(t=this.newPostState)&&i.exists(e=t.selectedImageInfo)&&e.bitmap},colors:function(){let t,e;return i.exists(t=this.newPostState)&&i.exists(e=t.selectedImageInfo)&&e.colors},eventProps:function(){return{haveCurrentUser:!!this.currentUserId}},postIsTemplate:function(){let t,e;return!!(i.exists(t=this.newPostState)&&i.exists(e=t.selectedImageInfo)&&e.templateData)},postIsJustText:function(){let t;return!(i.exists(t=this.newPostState)&&t.selectedImageInfo)},firstTopic:function(){return null!=this.topics&&(0===this.topics.length||1===this.topics.length&&this.topics[0].isNewTopic)},humanPostType:function(){return(()=>{switch(!1){case!this.postIsJustText:return"post";case!this.postIsTemplate:return"kimi";case!this.props.editorSave:return"image";default:return"photo"}})()},newPost:function(){return this.newPostState.newPost},canPost:function(){let t;return!(!i.exists(t=this.canPostInfo)||!t.canPost)}}),this.prototype.renderSaving=function(){let t,e,n,r,o,s,a,l,d,f;return({newTopicPrivate:t,postStatus:e,progress:n,newPost:r,retry:o,abort:s,isProfilePost:a}=this.newPostState),({gridSize:l}=this.viewState),({postForShowMedia:d}=this),M({key:"saving MSG"},A(u({margin:l,size:{h:5*l},childrenLayout:"row",childrenMargins:l,on:{pointerClick:this.showNewPost},cursor:"pointer"},this.canBeChapterStart&&v({radius:a&&1e3,size:5*l,post:d}),u((()=>{switch(e){case F:return u({clip:!0,key:"status stuff",animators:{opacity:{toFrom:0}},childrenLayout:"column",childrenAlignment:.5,childrenMargins:l/2,padding:{top:l/2}},c(h.smallText,{size:"parentWidthChildrenHeight",align:.5,text:n<1?`posting ${i.toString(this.humanPostType)}...`:"finishing up...",color:p.black.secondary}),u({clip:!0,animators:{size:{toFrom:{ww:1,h:0}}},size:{h:40}},this.canBeChapterStart&&n<1?B({progress:n}):R()));case z:case O:return f=this.props.editorSave?"kimi":"post",u({key:"postStatus messages",clip:!0,animators:{opacity:{toFrom:0}}},c(h.smallText,{size:"parentSize",align:{y:.5},color:p.black.secondary,text:e===z?this.isPrivateTopic?this.isNewTopic?"Success! Your new, private stream has been created.":`Success! Your ${i.toString(f)} has been added to your private stream.`:`Success! Your ${i.toString(f)} has been added to your public stream.`:o?` Aw, snap! The ${i.toString(this.humanPostType)} failed to upload. Please check your internet connection and tap Retry below.`:" Aw, snap! We're sorry, but something didn't work on our end. We'll fix that soon.\n\nPlease try again in a little bit."}))}})())),e===O&&o?L({icon:"redo",text:"Retry",action:o}):void 0,e!==z?L({icon:"cancel",text:"Cancel",action:this.abort}):void 0))},this.prototype.renderPosted=function(){let t,e;return({postStatus:t}=this.newPostState),M(this.renderSaving(),t===z?(({isPrivateTopic:e}=this),[D({post:this.newPost,private:e}),A({key:"successSection"},this.newPost&&M(L({icon:"checkmark",text:"Done",action:this.finishedPosting})))]):void 0)},this.prototype.finishedPosting=function(){return this.models.navState.hideNewPost().then(()=>this.models.newPostState.resetState())},this.prototype.abort=function(){let t,e;return({newPost:t,abort:e}=this.newPostState),this.models.navState.hideNewPost().then(()=>i.isF(e)&&e()).then(()=>this.models.newPostState.resetState())},this.prototype.showNewPost=function(){let t;return({newPost:t}=this.newPostState),this.finishedPosting().then(()=>this.models.navState.showPost(t))},this.prototype.showTopicSettings=function(){let t;return({newPost:t}=this.newPostState),this.finishedPosting().then(()=>this.models.navState.showTopicSettings(t))},this.prototype.sharePostViaEmail=function(){let t;return({newPost:t}=this.newPostState),this.finishedPosting().then(()=>this.models.share.sharePostViaEmail(t))},this.prototype.sharePostOnFacebook=function(){let t;return({newPost:t}=this.newPostState),this.finishedPosting().then(()=>this.models.share.sharePostOnFacebook(t))},this.prototype.preprocessState=function(t){let n,r,o,s,a,l;return({topicsWithoutNew:n,topics:r}=t),({newTopicTitle:o,selectedImageInfo:s,newTopicPrivate:a}=this.models.newPostState),l=null,N(rt.preprocessState.apply(this,arguments),{topics:e.postTopics=n?U([s?{id:null,isNewTopic:!0,private:!!a,title:o,lastChapterPost:this.postForShowMedia||{}}:void 0,i.array(n,(t,e)=>(l=t,t),(t,e)=>!t.isProfileTopic)]):null!=r?r:[],defaultTopic:l})},this.prototype.renderAuth=function(){return u({padding:{h:this.viewState.gridSize},size:"parentWidthChildrenHeight"},W({rightIcon:"triangleRight",text:"join Zo to save",action:()=>this.pushPage("renderAuthUi")}))},this.prototype.renderAuthUi=function(){let t,e;return({gridSize:t}=this.viewState),({editorSave:e}=this.props),this.currentUser&&this.popPage(),A(u({size:t}),j({heading:"Join Imikimi Zo",info:"Your Imikimi Zo account lets you save, view, share and download your creations anywhere.",reason:"newPost",success:()=>this.popPage()}))},this.prototype.completeEditorSave=function(){return this.models.newPostState.post().tap(()=>o(500)).then(t=>(this.models.navState.cancelKimiEditor(),this.models.navState.showPost(t,null,!1)))},this.prototype.renderAboutStreams=function(){let t;return({gridSize:t}=this.viewState),M(q({style:"dialog",padding:t,text:`# About Zo Streams\n\nYour ${i.toString(this.humanPostType)}s are saved in Zo Streams. Streams can be used like folders to organize your content.\n\nStreams can also be shared. Your friends, family and fans can follow your streams and keep up to date with your latest contributions.\n\n# Stream privacy\n\nManaging privacy on Zo couldn't be easier. Instead of choosing your privacy settings post-by-post, on Zo privacy settings are set on streams. Just set the privacy for each stream once and rest assured only the right people can see your posts.\n\n* Private Streams: Only you can see your private streams and posts in those streams.\n* Public Streams: Everyone can see your public streams and posts in those streams.`}),A({label:"more"},L({icon:"book",text:"Learn more about Zo Streams",action:()=>this.models.navState.showHelp({helpPage:"topics"})})))},this.prototype.renderScalingPostButton=function({verb:t,buttonSize:e}){let n,r,o;return({gridSize:n}=this.viewState),H({size:{ww:1,h:e},backgroundPadding:0,background:y.primary,radius:1e3,action:this.havePostContents&&this.completeEditorSave},u(["row","childrenCenterLeft"],{childrenMargins:n/2,padding:this.selectedTopic?{h:n/4,v:3}:void 0},this.selectedTopic&&v({size:r=e-n/2,post:this.selectedTopic.lastPost,radius:100}),u(u({axis:.5,location:{ps:.5},size:{cs:1,max:{ps:1.25}},scale:(t,e)=>V(1,t.minRatio(e))},c(h.mediumBoldText,{size:{cs:1,max:{ps:1}},maxLines:2,text:this.isProfilePost?"update profile photo":this.selectedTopic?`${i.toString(t)} to ${i.toString(i.exists(o=this.selectedTopic)&&o.title)}`:`${i.toString(t)}`,color:p.white.primary}))),this.selectedTopic?u({size:this.viewState.viewWidth>320?r:r/2}):void 0))},this.prototype.renderStreamlinedWhere=function(){let t,e,n,r,o;return t="imikimi"===$?"save":"post",({heightAdjustedButtonSize:e,gridSize:n,nativeApp:r}=this.viewState),u(["row","parentWidthChildrenHeight"],"clip",{animators:{size:{toFrom:{ww:1,h:0}}},childrenMargins:n/2,padding:{v:1,h:n}},this.renderScalingPostButton({verb:t,buttonSize:e}),this.isProfilePost||this.firstTopic?void 0:b({tight:!0,text:"change",labelStyle:h.mediumText,size:{h:e,w:2*e},backgroundPadding:0,outline:{lineWidth:2,color:y.primary},radius:1e3,color:y.primary,hoverColor:y.veryLightPrimary,action:()=>this.pushPage("renderWhere",{track:"top"})}),i.exists(o=this.newPostState.selectedImageInfo)&&o.bitmap&&!P.zoStream?H({size:e,backgroundPadding:0,color:y.membershipGradient,hoverColor:y.lightGolden,action:()=>this.grantMemberAccess?r?this.models.share.nativeSharePhoto(this.newPostState.selectedImageInfo.bitmap):this.models.share.downloadBitmap(this.newPostState.selectedImageInfo.bitmap):(t=r?"share":"download",this.models.navState.showOrPushSubscriptions(this,!0,`\n## Quick-${i.toString(t)} your image\n\nBecome a member to quick-${i.toString(t)} your image without saving it to Imikimi Zo first.\n\nLearn more about all the membership benefits below.\n\n> Note: You can still download and share your images\neven if you are not a member. You just need to save\nyour image first.\n> Tap Back below, then Save, then ${i.toString(Y(t))}`))},u({size:e,draw:[{radius:n/2},"clip",{outline:{lineWidth:4}},"children",{padding:-10,fill:{compositeMode:"sourceTopInTarget",colors:y.membershipGradient,to:"bottomRight"}}]},c(G[r?"share":"download"],"centerCenter"))):void 0)},this.prototype.renderWhere=function(){let t,e,n,r;return({gridSize:t,viewHeight:e}=this.viewState),({firstTopic:n}=this),n||this.isProfilePost?void 0:A(n?void 0:{label:"Choose stream",button:{icon:"helpInverted",selected:this.aboutStreams,action:()=>this.pushPage("renderAboutStreams")}},u({size:"parentWidthChildrenHeight",childrenLayout:"column"},M((i.exists(r=this.topics)&&r.length)>0?u({padding:{v:t/4},size:"parentWidthChildrenHeight"},K({topicsPerPage:3*X(1,(e-200)/(8*t)|0,4),topics:this.topics,userId:this.currentUserId,selectedTopic:this.selectedTopic,vertical:!0,selectTopic:t=>(t.isNewTopic?this.pushPage({rendererName:"renderNewTopicUX",back:()=>this.models.newPostState.setSelectedTopic(this.defaultTopic),okay:()=>{}}):this.popPage(),this.models.newPostState.setSelectedTopic(t))})):void 0)))},this.prototype.renderNewTopicUX=function(){return A({label:"new stream"},J({key:"chapterTitle",text:this.models.newPostState.newTopicTitle,overlay:this,label:"new stream name",placeholder:"set stream title",editTextProps:{title:"New Stream Title",info:nt,submit:this.models.newPostState.setNewTopicTitle}}),this.renderTogglePublicStream())},this.prototype.componentWillMount=function(){return rt.componentWillMount.apply(this,arguments),this.models.event.create("post:new:start")},this.prototype.render=function(){let t,e,n,r,o,s,a,l;return({currentUser:t,close:e,editorSave:n}=this.props),({viewState:r}=this.state),({gridSize:o}=r),({postStatus:s,selectedImageInfo:a}=this.newPostState),s===z&&"imikimi"!==$&&this.finishedPosting(),rt.render.call(this,{title:s===z?n?"Saved":"Posted":n?"Save Kimi":this.isProfilePost?"New Profile Photo":"Create",track:"bottom",close:e,noScrollChildren:s?void 0:u("column",{key:"newPostTop",padding:{bottom:o},size:{ww:1,hch:1,max:{ps:1}}},this.bitmap?this.renderPostPreview():this.renderStartPost(),this.captionAllowed?this.renderCaptionPost():void 0,this.havePostContents||this.newPostState.showWillPostToTopic?this.currentUser?[this.canPost?this.renderStreamlinedWhere():this.canPostInfo?A(Q({text:`# Free Limit Reached\n\nYou have reached the free account limit of ${i.toString(this.canPostInfo.maxPostsPerTimespan)} ${i.toString(this.humanPostType)}s per ${i.toString(this.canPostInfo.timespanInDays)} days.\n\nBecome a member today to unlock unlimited ${i.toString(this.humanPostType)}s!`}),Z({overlay:this}),Q({text:`> You can create your next free ${i.toString(this.humanPostType)} in ${i.toString(tt(this.canPostInfo.secondsUntilCanPost,!0))}.`})):void 0,(l=this.newPostState.afterPost)&&l.topicId===this.selectedTopic.id?u("column","parentWidthChildrenHeight",{padding:{top:o,h:o},animators:{size:{toFrom:{h:0}}}},u("parentWidthChildrenHeight","row","childrenCenterLeft",c(h.mediumText,{text:"after post:",color:p.black.secondary}),b({size:this.viewState.buttonSize,icon:"close",iconScale:1/3,tight:!0,action:this.models.newPostState.clearAfterPost})),et({width:25*o,post:l,topic:this.selectedTopic})):void 0]:this.renderAuth():void 0)},s?this.renderPosted():void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["AbstractOverlayComponent","present","ManageSubscription","merge","MenuSection","MarkdownView","MenuButton","membershipExpiresIn","isMember","isTrialMember","isPatronMember","isPurchaseMember","isSubscriberMember","MenuSectionGroup","humanDurationString","UserInfo","capitalize","memberShortPitch","Element","LargeBecomeAMemberButton","MembershipBenefits","MenuMarkdown","StringConstants","LargeMenuButton","ProfileRingPreview","alert","isFullMember","MemberCircle","MenuTheirStreamsManagement","TabButton","ImikimiPalette","TextStyles","vertical","pluralize","TopicSelector","bound","MenuEditableText","pipelines","StartReferral","zoPickImage","logRejectedPromises","log","missing","openLocalUrlInNewWindow","LoadingOverlay"],[e,n(1194),n(1204),n(1207)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U,W,j,q,H,V,$)=>{return i.defClass(class ProfileSettings extends t{},function(t,G,Y){let K;this.subscriptions("navState.searchVisible","currentSession.currentSession","followingTopic.followingTopics",{streamMemberships:{model:"topicMembershipsByUserId",key:K=function({currentUserId:t}){return t}},topics:{model:"topicsByUserId",key:K},streamInvites:{model:"topicInvitesByUserId",key:K}}),this.propFields({currentUserId:null,currentUser:null}),this.stateFields({copiedReferralLink:!1}),this.getter({currentSession:function(){return this.models.currentSession}}),this.prototype.logOut=function(){return this.models.navState.hideOverlay().then(()=>this.models.currentSession.logOut())},this.prototype.preprocessState=function(t){return e(this.currentUserId)||this.models.navState.hideOverlay(),Y.preprocessState.apply(this,arguments)},this.prototype.manageOrStartSubscription=function(){return this.pushPage({component:r,props:o({short:[!0,this.subPageActionProps]})})},this.prototype.searchForUsersContent=function(){return this.models.navState.searchWithinUserId(this.currentUserId)},this.prototype.renderMembershipInfo=function({label:t,message:e,buttonLabel:n}){return s({label:t},a({style:"dialog",padding:{top:this.gridSize,bottom:this.gridSize*(null!=n?2:1)},text:e}),this.currentlySubscribingMember?l({icon:"handRight",text:"Manage subscription",action:this.manageOrStartSubscription}):void 0)},this.getter({gridSize:function(){return this.viewState.gridSize},stripeOk:function(){return!this.models.viewState.nativeApp},expiresIn:function(){return u(this.currentUser)},currentlyMember:function(){return c(this.currentUser)},currentlyTrialMember:function(){return h(this.currentUser)},currentlyPatronMember:function(){return p(this.currentUser)},currentlyPurchaseMember:function(){return d(this.currentUser)},currentlySubscribingMember:function(){return f(this.currentUser)}}),this.prototype.renderMembershipStatus=function(){let t,e,n,r;return r=this,t=this.currentUser,e=this.gridSize,(()=>{switch(!1){case!this.currentlyTrialMember:return s({label:"Trial Membership Information"},a({style:"dialog",padding:{v:e},text:"You are a Trial member.\n\nThank you for trying Zo. We would like to extend you a free month of full membership access. Please enjoy!"}));case!this.currentlySubscribingMember:return s({label:"Full, Subscribing Member"},a({style:"dialog",padding:{v:e},text:"You are a Subscribing Member."}));case!this.currentlyPatronMember:return m(null,s({label:"Patron Member"},a({style:"dialog",text:`Thank you for joining us. As the beneficiary of your patron, you receive the exact same benefits as any other, full member.\n\n${i.toString(this.expiresIn?`\nPatron membership expires in ${i.toString(g(this.expiresIn,!0))}`:"")}`})),t.membershipPatronId?s({label:"Your Patron"},y({userId:t.membershipPatronId})):void 0);default:return this.renderMembershipInfo({label:`${i.toString(v(t.membershipType))} Membership Expired`,message:(n=!0)?"Thank you for trying Zo. We hope you enjoyed it. Your free trial membership has expired, but it's easy to resume your membership.":"Thank you for trying Zo. We hope you'll consider resuming your membership.",buttonLabel:n?"Become a member today":"Resume membership"})}})()},this.prototype.renderMembershipSettings=function(){let t,e,n,i,r,o,s,a,l,u;return u=this,t=this.currentUser,e=this.currentlyMember,n=this.currentlyTrialMember,i=this.currentlyPatronMember,r=this.stripeOk,o=this.expiresIn,({gridSize:s,viewHeight:a}=this.viewState),({displayName:l}=t),m(this.currentlySubscribingMember||this.currentlyPatronMember||this.currentlyPurchaseMember?void 0:[this.renderMembershipInfo({label:"Become a Member",message:S}),b({size:"parentWidthChildrenHeight",padding:{h:s,bottom:s}},w({action:this.manageOrStartSubscription}))],x())},this.prototype.renderReferralProgram=function(){return m(s(P({text:C.referrals.explanationPart1}),b({size:this.gridSize}),this.viewState.nativeApp?l({key:"shareLinkNative",text:"Share or Copy referral link",icon:"share",action:()=>(this.createEvent("refer:nativeShare"),this.models.share.nativeShareLink(this.models.feedback.referralLink))}):[_({text:"Email referral link",icon:"mail",action:()=>(this.createEvent("refer:emailLinkShare"),this.models.feedback.emailReferralLink())}),_({icon:this.copiedReferralLink?"checkmark":"link",text:`Copy referral link ${i.toString(this.copiedReferralLink?"(copied)":void 0)}`,action:()=>n(848)(this.models.feedback.referralLink)?(this.createEvent("refer:copyShare"),this.triggerCopiedReferralLink()):void 0})],b({size:this.gridSize}),P({text:C.referrals.explanationPart2})),s({label:"Referral Program FAQ"},P({text:C.referrals.faq}),E()))},this.prototype.setDisplayName=function(t){return(t=t.trim()).length<3?T("Display names must be at least 3 characters."):this.models.user.update({key:this.props.currentUser.id,data:{displayName:t}}).then(()=>(this.editing=!1,this.savedDisplayName=t)).catch(()=>this.cancel())},this.prototype.renderCurrentUserSettings=function(){let t,e,n,r,o,a,c,p,d,f;return({currentUser:t}=this),({gridSize:e,viewHeight:n}=this.viewState),r=k(t),o=h(t),a=u(t),(c=i.exists(d=this.topics)&&d.length)&&null!=this.currentUser.profileTopicId&&c--,({displayName:p}=t),m(s(y({userId:t.id}),b({size:{h:e/2}}),(()=>{switch(!1){case!this.currentlyPatronMember:return l({customIcon:I({size:"parentSize"}),text:"Membership status",action:()=>this.pushPage("renderMembershipStatus")});case!(this.currentlySubscribingMember||this.currentlyPurchaseMember):return l({customIcon:I({size:"parentSize"}),text:"Manage membership",action:this.manageOrStartSubscription});case!k(t):return null;default:return w({action:this.manageOrStartSubscription})}})(),l({customIcon:I({size:"parentSize"}),text:r?"membership benefits":"Learn more about Membership benefits",action:()=>this.pushPage("renderMembershipSettings")}),P({text:"## Get free Zo Membership!\n\nGet one month of membership free for every friend who joins Imikimi Zo."}),l({text:"Invite friends",icon:"users",action:()=>(this.createEvent("refer:start"),this.pushPage(U))})),this.viewState.fullScreen?void 0:s({label:"help"},l({icon:"helpInverted",text:"Imikimi Zo help",action:this.models.navState.toggleShowHelp})),s({label:"Streams"},M(this.subPageActionProps,{currentUserId:this.currentUserId,currentUser:t}),0===(i.exists(f=this.topics)&&f.length)?A({size:{ww:1,h:9*e},icon:"image",text:"start your first stream with a photo",backgroundColor:F.lightGrey,centered:!0,labelStyle:B.mediumText,action:()=>W().then(t=>(this.models.newPostState.selectedImageInfo=t,this.models.navState.showNewPost()))}):void 0),"imikimi"===R&&c>0?s({label:"Your Streams"},l({icon:"search",text:`search your ${i.toString(1===c?"stream":z(c,"stream"))}`,action:this.searchForUsersContent}),b({size:"parentWidthChildrenHeight",padding:{top:e}},O({userId:t.id,topicsPerPage:3*L(1,(n-200)/(8*e)|0,4),selectTopic:this.models.navState.showTopic}))):void 0,s({label:"Settings"},D({label:"change name",large:!0,text:p,overlay:this,placeholder:"first and last name",editTextProps:{title:"First and Last name",submit:this.setDisplayName,maxLength:N.user.fields.displayName.maxLength}}),l({icon:"image",text:this.currentUser.profileTopic?"Update profile photo":"Set profile photo",action:this.models.newPostState.updateProfilePhoto}),l({icon:"mail",text:"Email settings",action:this.models.navState.toggleShowAuthSettings})),s({label:"Options"},l({icon:"user",text:"Show public profile",action:()=>this.models.navState.showUser(this.currentUser)}),l({icon:"logout",text:"Log out",action:this.logOut})),this.currentSession.currentlyAdmin?this.renderAdminOptions():this.currentSession.canReturnToAdmin?s({label:"Admin"},l({icon:"undo",text:"return to your admin account",action:()=>this.models.admin.switchUser(this.currentSession.adminUserId)})):void 0)},this.prototype.renderAdminOptions=function(){return s({label:"Admin"},D({key:"switchUser",label:"admin switch user",placeholder:"userId or email",overlay:this,editTextProps:{title:"Admin Switch User",submit:t=>j("switchUser",this.models.admin.switchUser(t)).then(t=>q.warn({switchUser:{result:t}})).catch(e=>(()=>{switch(e.status){case H:return this.pushPage("renderMessage",{message:`User not found for: ${i.toString(t)}`});default:return this.pushPage("renderMessage",{message:`Error:\nstatus: ${i.toString(e.status)},\nmessage: ${i.toString(e.message)}`})}})())}}),l({text:"Admin tools",action:()=>V("/Admin")}))},this.prototype.render=function(){let t,e,n;return({currentUser:t}=this),({fullScreen:e,gridSize:n}=this.state.viewState),Y.render.call(this,{fullHeight:!0,title:"My Profile Settings"},t?this.renderCurrentUserSettings():b({size:{h:100}},$()))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(289)).addModules({ManageSubscription:n(1205),MembershipBenefits:n(1206)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["EventLogMixin","FluxComponent","isSubscriberMember","isMember","pending","pipelines","success","failure","MenuSection","NativeAppSubscriptionPrompt","Element","TextElement","TextStyles","humanDurationString","membershipExpiresIn","MarkdownView","isPurchaseMember","MenuButton","LoadingOverlay","pluralize","formatDate","MenuMarkdown","ListItemWithDefault","Promise","merge","timeout","logRejectedPromises","StringConstants","MenuSectionGroup","networkFailure","Authenticate","isPatronMember","MembershipBenefits","isFullMember","StartReferral","getMembershipType","ButtonWrapper2","MemberCircle","TextPalette","MenuStatusMessage"],[e,n(1194),n(906),{MembershipBenefits:n(1206)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L,D,N,U)=>{return i.defClass(class ManageSubscription extends(t(e)){},function(t,e,W){this.subscriptions("viewState.viewState","currentSession.currentSession","currentSubscription.subscriptionDetails"),this.getter({currentUser:function(){let t;return i.exists(t=this.currentSession)&&t.currentUser},isSubscriber:function(){return n(this.currentUser)},isMember:function(){return r(this.currentUser)}}),this.stateFields({loading:!1,plans:[],plansStatus:null,purchaseMembershipTimePlans:{},purchaseMembershipTimePlansStatus:null,actionErrorMessage:null,actionErrorMessageClickAction:null,actionErrorMessageCount:0}),this.getter({pushPage:function(){return this.props.pushPage},showAuth:function(){return!this.currentUser}}),this.prototype.componentWillMount=function(){return W.componentWillMount.apply(this,arguments),this.models.currentSubscription.createEvent("manageSubscription:show"),this.plansStatus=o,s.stripeSubscription.membershipPlans().then(this.setPlans).then(()=>this.plansStatus=a).catch(()=>this.plansStatus=l),this.purchaseMembershipTimePlansStatus=o,s.stripeCustomer.purchaseMembershipTimePlans().then(this.setPurchaseMembershipTimePlans).then(()=>this.purchaseMembershipTimePlansStatus=a).catch(({status:t})=>this.purchaseMembershipTimePlansStatus=t),this.currentUser&&s.stripeSubscription.refreshFromStripe(),this.models.currentSubscription.loadStripeCheckout()},this.prototype.requestSponsorship=function(){return this.models.currentSubscription.createEvent("manageSubscription:requestSponsorship"),this.models.feedback.requestSponsorship()},this.prototype.renderMember=function(){let t,e,o,s,a,l;return({fullScreen:t,gridSize:e,nativeApp:o}=this.viewState),o?u({label:"membership subscription"},c()):this.subscriptionDetails?(s=!1,a=!1,l=i.array(this.subscriptionDetails.subscriptions,t=>{let n,r,o,l,u,c;return({nextPaymentAt:n,paidThrough:r,amountString:o,intervalCount:l,interval:u}=t),a=!0,n&&(s=!0),c=n?{"auto pay":o,every:b(null!=l?l:1,u),"next payment":w(n,"longDate")}:{"paid through":w(r,"longDate"),"next payment":"none"},i.array(c,(t,n)=>h(["row","parentWidthChildrenHeight"],{margin:e},p("parentWidthChildrenHeight",d.smallText,{text:`${i.toString(n)}:`}),p("childrenSize",d.smallText,{text:t,fontWeight:"bold"})))}),!s&&r(this.currentUser)&&l.push(h(["row","parentWidthChildrenHeight"],{margin:e},p(d.smallText,{text:"expires in:",size:"parentWidthChildrenHeight"}),p(d.smallText,{fontWeight:"bold",size:"childrenSize",text:f(m(this.currentUser),!0)}))),[u({label:"membership subscription"},g({style:"dialog",padding:{top:e},text:n(this.currentUser)?r(this.currentUser)?"Thank you for subscribing. You are the bedrock of our community, and we deeply appriciate it.":"Thank you for subscribing. Your subscription has expired. Click the button below to resume.":y(this.currentUser)?"Thank you for purchasing membership time with us. You are the bedrock of our community, and we deeply appriciate it.":void 0}),g({style:"dialog",padding:{top:2*e,bottom:e},text:"Your membership status:"}),u({padding:{v:e}},l),s?v({icon:"cancel",text:"Cancel Membership Subscription",action:this.createPerformRemoteActionFunction(this.models.currentSubscription.cancel,"Cancel subscription")}):a?[v({icon:"redo",text:"Resume Membership Subscription",action:this.createPerformRemoteActionFunction(this.models.currentSubscription.resume,"Resume subscription")}),this.renderPurchaseMembershipTimePlans()]:void 0),r(this.currentUser)?s||a?void 0:u(v({icon:"plus",text:"Add time",action:()=>{let t;return t=this.props.pageStackManager.popBackToHereAction,this.pushPage(this.renderPurchaseOptions,{onPurchaseSuccess:e=>t()})}})):this.renderPurchaseOptions(),this.renderPaymentTypes(s)]):h({size:{h:100}},S())},this.prototype.renderPaymentTypes=function(t){let e,n,r,o,s,a;return e=!t,({gridSize:n}=this.viewState),u({label:`payment ${i.toString((i.exists(s=this.subscriptionDetails)&&s.paymentMethods.length)>1?"types":"type")}`},x({text:null!=(i.exists(a=this.subscriptionDetails)&&a.paymentMethods)&&0===this.subscriptionDetails.paymentMethods.length?"You don't have any payment methods. You will be prompted to\nadd one for any future purchases.":t?`Your 'default' payment method will be billed once\na ${i.toString(this.subscriptionDetails.subscriptions[0].interval)}.`:"Your 'default' payment method will be used for\nany future purchases."}),this.subscriptionDetails?(({defaultPaymentMethodId:r}=this.subscriptionDetails),o=this.subscriptionDetails.paymentMethods.sort((t,e)=>{let n;return 0===(n=t.expirationYear-e.expirationYear)&&(n=t.expirationMonth-e.expirationMonth),0===n&&(n=t.last4-e.last4),n}),i.array(o,t=>{let n,s,a,l,u;return({brand:n,last4:s,expirationMonth:a,expirationYear:l,id:u}=t),P({id:u,key:u,description:`${i.toString(n)} ending in ${i.toString(s)}\nexpires: ${i.toString(a)}/${i.toString(l)}`,setDefaultItem:this.createPerformRemoteActionFunction(this.models.currentSubscription.setDefaultPaymentMethod,"Set default payment method"),deleteItem:this.createPerformRemoteActionFunction(this.models.currentSubscription.deletePaymentMethod,"Delete payment method"),defaultItemId:r,deletable:o.length>1||e})})):void 0,v({icon:"creditCard",text:"Add payment type",action:this.createPerformRemoteActionFunction(this.models.currentSubscription.addPaymentMethod,"Add payment method")}))},this.prototype.confirmPromise=function(t){return new C((e,n)=>this.pushPage(this.renderConfirm,_(t,{confirmed:()=>(this.props.popPage(),this.onNextReady().then(e))})))},this.prototype.renderConfirm=function({markdownMessage:t,text:e,icon:n,confirmed:i}){return u({label:"confirm"},t&&x({style:"dialog",text:t}),v({text:e,icon:n,action:i}))},this.prototype.confirmIfStripeCustomer=function(t){return this.currentUser.stripeCustomerId?this.confirmPromise({markdownMessage:"Please confirm your purchase.",text:`Pay ${i.toString(t.humanPaymentInfo)}`,icon:"creditCard"}):C.resolve()},this.prototype.joinNow=function(t,e){return this.confirmIfStripeCustomer(t).then(()=>(this.loading=!0,this.models.currentSubscription.start({plan:t,opened:()=>E(250,this.clearLoading)}).tap(()=>i.exists(e)&&i.isF(e.onPurchaseSuccess)&&e.onPurchaseSuccess(t)).catch(t=>this.pushPage(this.renderJoinNowError,{error:t})))).finally(this.clearLoading)},this.prototype.purchaseMembershipTimeNow=function(t,e){return this.confirmIfStripeCustomer(t).then(()=>(this.loading=!0,this.models.currentSubscription.purchaseMembershipTime({plan:t,opened:()=>E(250,this.clearLoading)}).tap(()=>i.exists(e)&&i.isF(e.onPurchaseSuccess)&&e.onPurchaseSuccess(t)).catch(t=>this.pushPage(this.renderJoinNowError,{error:t})).finally(this.clearLoading)))},this.prototype.createPerformRemoteActionFunction=function(t,e){return n=>this.performRemoteAction(t,n,e)},this.prototype.performRemoteAction=function(t,e,n){return this.triggerLoading(),T(`performRemoteAction ${i.toString(t)}-${i.toString(e)}-${i.toString(n)}`,t(e)).finally(this.clearLoading).catch(i=>{let r,o;return({message:r,status:o}=i),this.showErrorMessage(i,()=>this.performRemoteAction(t,e,n),n)})},this.prototype.showErrorMessage=function(t,e,n){let r,o;return i.exists(r=t.info)&&r.userAborted?void 0:i.exists(o=this.refs.menuStatusMessage)&&o.showErrorMessage(t,e,n)},this.prototype.renderJoinNowError=function({error:t}){let e,n,r,o,s;return null!=(e=i.exists(r=t.info)&&i.exists(o=r.response)&&i.exists(s=o.responseData)&&s.message)||(e=k.getCommunicationStatusMessage(n=t.status)),I(u({label:"Subscription not completed"},g({style:"dialog",padding:{v:this.viewState.gridSize},text:`There was a problem starting your subscription:\n\n> ${i.toString(e)}\n\n${i.toString(n!==M?"You may need to add a different payment type.":void 0)}`})),n!==M?this.renderPaymentTypes():void 0)},this.prototype.renderReasons=function(){let t,e;return({fullScreen:t,gridSize:e}=this.viewState),[u({label:"Our Mission"},x({text:k.membership.joinUs})),u({label:"Member Benefits"},g({text:k.membership.memberBenefits}))]},this.prototype.renderNonMember=function(){let t,e,n,i;return({reason:t}=this.props),({fullScreen:e,gridSize:n,nativeApp:i}=this.viewState),this._renderedNonMember||(this._renderedNonMember=!0),I(t?u({label:"Membership required"},x({text:t})):void 0,this.showAuth?u({label:"Sign up"},x({text:k.membership.signUpLongPrompt}),A({padding:{v:n},reason:"subscribe"})):[this.renderHowToBecomeAMember(),this.renderPurchaseOptions(),this.renderReferralProgram(),this.showAuth||F(this.currentUser)?void 0:this.renderSponsorshipProgram()],this.props.short?void 0:B())},this.prototype.renderPurchaseOptions=function(t){return this.viewState.nativeApp?c():[u({label:k.membership.purchaseTimeSectionTitle},this.renderPurchaseMembershipTimePlans(t)),R(this.currentUser)?void 0:u({label:k.membership.startSubscriptionSectionTitle},this.renderPlans(t))]},this.prototype.renderReferralProgram=function(){return u({label:k.membership.referralProgramSectionTitle},x({text:k.membership.referralProgramPrompt}),v({text:"Invite Friends",icon:"users",action:()=>(this.createEvent("refer:start"),this.pushPage(z))}))},this.prototype.renderHowToBecomeAMember=function(){return u({label:k.membership.howToBecomeAMemberSectionTitle},x({text:k.membership.howToBecomeAMember}))},this.prototype.renderSponsorshipProgram=function(){return u({label:"Apply for Sponsorship"},x({text:"> Don't have a major credit card? Simply can't afford it?\nApply for sponsorship below.\nWe want everyone to be a member."}),v({icon:"mail",action:this.requestSponsorship,text:"Apply for Sponsorship"}))},this.prototype.renderSubscriptionStatus=function(){let t,e;return({gridSize:t}=this.viewState),x({text:0>(e=m(this.currentUser))?`Your ${i.toString(O(this.currentUser))} membership expired.\n\n`:`Your ${i.toString(O(this.currentUser))} membership expires in ${i.toString(f(e,!0))}. You have full access to all features, but if you'd like to become a full member today: \n\n`})},this.prototype.renderPlanButton=function({action:t,name:e,details:n}){let i;return i=this.viewState.gridSize,L({icon:"handRight",action:()=>this.currentUser?t():this.toggleShowAuth()},"parentWidthChildrenHeight",h(["row","parentWidthChildrenHeight"],{padding:{h:i/2,top:i/2}},D({size:3*i}),h("column","parentWidthChildrenHeight",{padding:{top:i,h:i/2}},p(d.mediumBoldText,{text:e}),n&&p(d.mediumItalicText,{paragraphLeading:2,padding:{h:i,top:2*i,bottom:i},text:n,color:N.black.secondary}))))},this.prototype.renderLoading=function(t,e){return"success"===t&&(i.exists(e)&&e.length)>0?null:p(d.mediumItalicText,{padding:this.viewState.gridSize,color:N.black.secondary,text:k.getCommunicationStatusMessage(t)})},this.prototype.renderPurchaseMembershipTimePlans=function(t){return[x({text:"Purchase time without a subscription:"}),this.renderLoading(this.purchaseMembershipTimePlansStatus,this.purchaseMembershipTimePlans),i.array(this.purchaseMembershipTimePlans,e=>this.renderPlanButton({action:()=>this.purchaseMembershipTimeNow(e,t),name:e.humanPaymentInfo,details:`Easiest:\n${i.toString(f(e.seconds,!0))} of membership with no renewing subscription`})),g({padding:{top:this.viewState.gridSize},small:!0,style:"dialog",text:k.membership.shortPurchaseTimeExplanation})]},this.prototype.renderPlans=function(t){return[x({text:"Start a subscription:"}),this.renderLoading(this.plansStatus,this.plans),i.array(this.plans.sort((t,e)=>t.amount-e.amount),e=>this.renderPlanButton({action:()=>this.joinNow(e,t),name:e.humanPaymentInfo,details:(()=>{switch(e.interval){case"month":return"Most popular:\nJust 10 cents a day";case"year":return"Best deal:\nGet 12 months for the price of 9, that's 3 months FREE, with a yearly membership"}})()})),g({padding:{top:this.viewState.gridSize},small:!0,style:"dialog",text:k.membership.shortSubscriptionExplanation})]},this.prototype.render=function(){let t,e,n,r;return({fullScreen:t,gridSize:e}=this.viewState),this.props.closeOnAccessGranted&&this.isMember&&i.isF((n=this.props).popPage)&&n.popPage(),I(["column","parentWidthChildrenHeight"],this.isSubscriber||i.exists(r=this.currentUser)&&r.stripeCustomerId?this.renderMember():this.renderNonMember(),this.loading?S():void 0,U({key:"menuStatusMessage",context:"ManageSubscription"}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","MenuSection","MarkdownView","StringConstants","isContributingMember","ProfileRingPreview","MenuSectionGroup","isMember"],[e,n(1194)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class MembershipBenefits extends t{},function(t,i,u){this.subscriptions("currentSession.currentUser viewState.viewState"),this.prototype.renderMemberGoldRing=function(){let t;return({gridSize:t}=this.viewState),e({label:"Gold Profile Ring"},n({style:"dialog",padding:{v:t},text:r.membershipBenefits.contributingMember+"\n\n"+(o(this.currentUser)?r.membershipBenefits.isAContributingMember:r.membershipBenefits.isNotAContributingMember)}),s())},this.prototype.render=function(){let t,i;return({fullScreen:t,gridSize:i}=this.viewState),a(null,e({label:"Our Mission"},n({large:!1,padding:{v:i},style:"dialog",text:l(this.currentUser)?r.membership.ourMission:r.membership.joinUs})),this.currentUser?this.renderMemberGoldRing():void 0,e({label:"Member Benefits"},n({large:!1,padding:{v:i},style:"dialog",text:r.membership.memberBenefits})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(286)).addModules({MenuTheirStreamManagement:n(1208),MenuTheirStreamManagementList:n(1209),MenuTheirStreamsManagement:n(1210),UserInfo:n(1211)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pending","Element","MenuTopic","MenuSectionGroup","MenuButton","LoadingOverlay","pipelines","MenuMarkdown","MenuFollowOptions"],[e,n(1194)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class MenuTheirStreamManagement extends t{},function(t,h,p){this.subscriptions({topic:function({topicId:t}){return t}},"currentSession.currentUserId","viewState.gridSize"),this.propFields("topicId","selected","currentUserId","select","topicFollow","topicMembership","topicInvite"),this.stateFields({confirmDelete:!1,loading:!1}),this.prototype.action=function(){return i.isF(this.select)&&this.select(this.selected?null:this.topicId)},this.prototype.openStream=function(){return this.models.navState.showTopic(this.topic)},this.prototype.render=function(){let t,h,p,d,f;return t=this.topicMembership,i.exists(t)&&(h=t.canAdmin,p=t.canPost,d=t.channelId),f=this.topicStatus===e,n("parentWidthChildrenHeight","column",{animators:{size:{toFrom:{h:0}}},draw:[{padding:{h:-this.gridSize}},"clip"]},r({topic:this.topic,action:this.action,currentUserId:this.currentUserId,rightText:(()=>{switch(!1){case!h:return"admin";case!p:return"poster"}})()}),this.selected?o(s({text:"Open stream",action:this.openStream,icon:"book"}),f?n({size:{h:100}},a()):(()=>{switch(l.topicInvite.getInviteStatus(this.topicInvite)){case"declined":return u({text:"You declined this invite, but it is still open. You can still open the stream and accept if you change your mind."});case"outstanding":return u({text:"You have been invited to this stream. Open the stream to accept."});default:return c(this.props,{topic:this.topic})}})()):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","MenuSection","MenuMarkdown","MenuTheirStreamManagement"],[e,n(1194),{MenuTheirStreamManagement:n(1208)}],(t,e,n,r,o)=>{return i.defClass(class MenuTheirStreamManagementList extends t{},function(t,s,a){let l;this.subscriptions({topicMemberships:{model:"topicMembershipsByUserId",key:l=function({currentUserId:t}){return t}},topicInvites:{model:"topicInvitesByUserId",key:l},topicFollowers:{model:"topicFollowersByUserId",key:l}}),this.stateFields({selectedTopicId:null,topicMembershipsByTopicId:null,topicInvitesByTopicId:null,topicFollowersByTopicId:null}),this.propFields("currentUserId","topics","title","explanation"),this.prototype.updateByTopicIdState=function(t,e,n){let r,o,s,a;return r=this.state[e],o=t[e],s=t[a=`${i.toString(e)}ByTopicId`],r===o&&s?void 0:n[a]=i.object(o,null,null,null,t=>t.topicId)},this.prototype.preprocessState=function(t){let n;return e(a.preprocessState.apply(this,arguments),i.each2(["topicMemberships","topicInvites","topicFollowers"],e=>this.updateByTopicIdState(t,e,n),null,n={}))},this.prototype.render=function(){let t,e,s,a,l,u,c,h,p;return p=this,t=this.explanation,e=this.topics,s=this.selectedTopicId,a=this.currentUserId,l=this.topicMembershipsByTopicId,u=this.topicInvitesByTopicId,c=this.topicFollowersByTopicId,h=l&&u&&c,n({label:this.title},t?r({text:t}):void 0,h?i.array(e,t=>{let e;return o(this.props,{key:t.id,topic:t,userId:a,topicId:e=t.id,selected:s===t.id,select:this.setSelectedTopicId,topicMembership:l[e],topicInvite:u[e],topicFollower:c[e]})}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","pipelines","Promise","compactFlatten","Element","MenuButton","pluralize","StringConstants"],[e,n(1194),{MenuTheirStreamManagement:n(1208)}],(t,e,r,o,s,a,l,u,c)=>{return i.defClass(class MenuTheirStreamsManagement extends t{},function(t,h,p){let d;this.subscriptions({streamMemberships:{model:"topicMembershipsByUserId",key:d=function({currentUserId:t,currentUser:e}){return null!=t?t:i.exists(e)&&e.id}},streamInvites:{model:"topicInvitesByUserId",key:d},topicFollowersByUserId:d,topicsByUserId:d,streamFollows:{model:"channelTopicsByChannelId",key:function({currentUser:t}){return i.exists(t)&&t.defaultChannelId}}}),this.propFields("pushPage","currentUserId"),this.stateFields({outstandingInvites:null,declinedInvites:null,streamSubscriptions:null,yourStreams:null}),this.prototype.preprocessState=function(t){let n;return e(p.preprocessState.apply(this,arguments),n={outstandingInvites:i.array(t.streamInvites,null,t=>r.topicInvite.inviteIsOutstanding(t)),declinedInvites:i.array(t.streamInvites,null,t=>r.topicInvite.inviteWasDeclined(t)),streamSubscriptions:i.array(t.topicFollowersByUserId,null,t=>t.subscribed),yourStreams:i.array(t.topicsByUserId,t=>({topic:t,topicId:t.id}))})},this.prototype.showList=function(t){let a,l,u;return a={},i.each2(t.items,({topic:t,topicId:e})=>a[e]=t),l=null!=(u=t.topicIds)?u:i.array(t.items,({topicId:t})=>t),o.all(i.array(l,t=>{let e;return null!=(e=a[t])?e:r.topic.get(t).catch(()=>null)})).then(i=>(i=s(i).sort((t,e)=>e.updatedAt-t.updatedAt),this.pushPage(n(1209),e(t,this.state,{currentUserId:this.currentUserId,topics:i}))))},this.prototype.render=function(){let t,e,n,r,o,s,h,p;return t=i.exists(e=this.topic)&&e.private&&this.topicMembership,a("parentWidthChildrenHeight","column",(i.exists(n=this.outstandingInvites)&&n.length)>0?l({text:`${i.toString(u(this.outstandingInvites.length,"Stream invite"))}`,icon:"ticket",action:()=>this.showList({title:"Stream invites",items:this.outstandingInvites,explanation:c.streamExplanations.outstandingInvites})}):void 0,(i.exists(r=this.streamMemberships)&&r.length)>0?l({text:`Member of ${i.toString(u(this.streamMemberships.length,"stream"))}`,icon:"user",action:()=>this.showList({title:"Stream memberships",items:this.streamMemberships,explanation:c.streamExplanations.streamMemberships})}):void 0,(i.exists(o=this.streamFollows)&&o.length)>0?l({text:`following ${i.toString(u(this.streamFollows.length,"stream"))}`,icon:"heart",action:()=>this.showList({title:"Following streams",items:this.streamFollows,explanation:c.streamExplanations.streamFollows})}):void 0,(i.exists(s=this.streamSubscriptions)&&s.length)>0?l({text:`Subscribing to ${i.toString(u(this.streamSubscriptions.length,"stream"))}`,icon:"mail",action:()=>this.showList({title:"Stream subscriptions",items:this.streamSubscriptions,explanation:c.streamExplanations.streamSubscriptions})}):void 0,(i.exists(h=this.yourStreams)&&h.length)>0?l({text:`Your ${i.toString(u(this.yourStreams.length,"stream"))}`,icon:"book",action:()=>this.showList({title:"Your streams",items:this.yourStreams})}):void 0,(i.exists(p=this.declinedInvites)&&p.length)>0?l({text:`Declined invitations to ${i.toString(u(this.declinedInvites.length,"stream"))}`,icon:"cancel",action:()=>this.showList({title:"Declined streams invites",items:this.declinedInvites,explanation:c.streamExplanations.declinedInvites})}):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","UserCircle","TextElement","TextStyles","TextPalette","isTrialMember","daysDurationString","membershipExpiresIn","isMember","isSubscriberMember"],[e,n(1194),n(1204)],(t,e,n,r,o,s,a,l,u,c,h)=>{return i.defClass(class UserInfo extends t{},function(t,p,d){this.subscriptions("user","viewState.gridSize","currentSession.currentUserId"),this.prototype.render=function(){let t,p,d;return d=this,t=this.gridSize,p=this.user,e("row","parentWidthChildrenHeight",{padding:{v:t/2},childrenAlignment:.5,childrenMargins:t},n({size:3*t,user:p,action:this.models.newPostState.updateProfilePhoto}),p&&e("column","parentWidthChildrenHeight",{childrenMargins:t/2},r(o.largeBoldText,{text:p.displayName}),r(o.smallText,{color:s.black.secondary,text:a(p)?`trial member - ${i.toString(l(u(this.user)))} remaining`:c(p)?h(p)?"member":`member - ${i.toString(l(u(this.user)))} remaining`:"expired membership"})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["AbstractOverlayComponent","StartReferral"],[e,n(1194)],(t,e)=>{return i.defClass(class ReferralOverlay extends t{},function(t,n,i){this.prototype.render=function(){return i.render.call(this,{title:"Invite a Friend",fullHeight:!0},e(this.props,this.subPageActionProps))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","PopOver","getPostTitle","Element","InlineShare"],[e,n(1194)],(t,e,n,r,o)=>{return i.defClass(class SharePost extends t{},function(t,s,a){this.subscriptions("post"),this.prototype.render=function(){return e({centered:!0,title:`Share ${i.toString(n(this.post))}`,titlePost:this.post,fullHeight:!0},r(["parentWidthChildrenHeight","column"],this.post&&o({post:this.post,showPrivateTopicHelp:!0})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","PopOver","Element","SocialActivityList"],[e,n(1194),n(1215)],(t,e,n,r)=>{return i.defClass(class SocialActivity extends t{},function(t,o,s){this.subscriptions("viewState.viewState navState.searchVisible currentSession.currentUser"),this.prototype.render=function(){let t,o,s;return({currentUser:t}=this.state),({fullScreen:o,gridSize:s}=this.state.viewState),e({fullHeight:!0,title:"Social Activity",track:"top"},n({size:"parentWidthChildrenHeight",padding:{h:-s}},r({currentUserId:i.exists(t)&&t.id,gridSize:s})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(287)).addModules({SocialActivityEntry:n(1216),SocialActivityList:n(1217)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","TextElement","TextStyles","TextPalette","Promise","pipelines","log","pending","Math","getDisplayTitle","pluralize","ButtonWrapper2","ImikimiPalette","Element","UserCircle","ActivityBadge","getDisplayName","applyStringVariables","merge","ShowMedia"],[e,n(1194)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b)=>{let w;return w=i.defClass(class EntryAge extends t{},function(t,i,o){this.subscriptions({ageString:function({createdAt:t}){return t}}),this.prototype.render=function(){return e(n.tinyText,"childrenSize",{text:this.ageString,color:r.black.tertiary})}}),i.defClass(class SocialActivityEntry extends t{},function(t,x,P){this.subscriptions({post:function({postId:t}){return t},topic:function({topicId:t}){return t},user:{model:"user",key:function({linkToUserId:t}){return t}},lastMessage:{model:"message",key:function({lastMessageId:t}){return t}},lastActiveUser:{model:"user",key:function({lastActiveUserId:t}){return t}},topicMembership:function({action:t,topicId:e,userId:n}){return e&&n&&"topicMembershipAccept"===t?{topicId:e,userId:n}:void 0}}),this.prototype.action=function(){return o.then(()=>this.props.id?s.notification.seen(this.props.id):void 0).then(()=>{let t,e,n,i,r,o;return(t=this.props.action)?(()=>{switch(t){case"topicMembershipAccept":return this.models.navState.showTopic(this.topic.id);default:return a.error({"unsupported notification action":(({action:t,id:e,text:n,userId:i,topicId:r,postId:o}=this.props),{action:t,id:e,text:n,userId:i,topicId:r,postId:o})})}})():(()=>{switch(!1){case!this.state.post:return this.models.navState.showMessages(this.post);case!this.topic:return this.models.navState.showTopic(this.topic.id);case!this.user:return this.models.navState.showUser(this.user)}})()})},this.getter({user:function(){let t;return null!=(t=this.state.user)?t:this.state.lastActiveUser},post:function(){let t,e;return null!=(t=this.state.post)?t:i.exists(e=this.state.topic)&&e.lastPost},showPost:function(){return this.post||this.postIsComing},showUser:function(){return this.user},postIsComing:function(){return this.state.postStatus===l||this.state.topicStatus===l}}),this.prototype.render=function(){let t,o,s,a,l,x,P,C,_,E,T,k,I,M,A,F,B,R,z,O,L;return t=(R=this.props).text,o=R.seenAt,s=R.notificationId,a=R.messageCount,l=R.userId,x=R.lastSeenActivityCount,P=R.gridSize,C=R.currentUserId,_=R.action,E=R.title,x=u.max(0,x),null!=t||(t=this.post?(T=`${i.toString(this.post.userId===l?"your":"their")} post`,this.topic&&(T+=` in ${i.toString(c(this.topic))}`),({activityCount:k,messageCount:a}=this.post),I=k-x,h(a,"comment")+` on ${i.toString(T)}`):void 0),M=null!=s?!(null!=o):I>0,this.topicMembership&&(z=this.topicMembership,A=z.acceptedAt,F=z.declinedAt,E=(()=>{switch(!1){case!A:return"accepted stream invite";case!(null!=F):return"declined stream invite";default:return"open to accept or decline"}})()),p("parentWidthChildrenHeight",{hoverExpand:!0,action:this.action,backgroundPadding:0,radius:0,hoverColor:B=d.primary.withAlpha(.5)},f(["parentWidthChildrenHeight","row"],{padding:{h:P,v:P/2},childrenMargins:P},f({size:3.5*P},this.user?m("parentSize",{user:this.user,mediaSize:128,pointerEventPriority:1}):void 0),M&&g("centerCenter",{count:I,radius:8,location:2}),t||this.lastMessage?(this.lastMessage?(E=y(this.user),t=this.lastMessage.text):(this.user&&(E=y(this.user)),t=v(t,S(this.user,this.topic,this.post))),f(["parentWidthChildrenHeight","column"],{childrenMargins:P/2},f(["parentWidthChildrenHeight","row"],"childrenCenterCenter",{childrenMargins:P/2},e(n.tinyBoldText,"parentWidthChildrenHeight",{text:null!=E?E:"",color:r.black.secondary,maxLines:1}),w({createdAt:null!=(O=i.exists(L=this.lastMessage)&&L.createdAt)?O:this.props.createdAt})),e(this.props.notificationId?n.smallItalicText:n.smallText,"parentWidthChildrenHeight",{color:r.black.primary,text:t,maxLines:this.lastMessage?3:void 0}))):void 0,this.showPost?p({action:()=>this.models.navState.showPost(this.post),pointerEventPriority:1,size:3.5*P,hoverExpand:!0},b({mediaSize:128,size:3.5*P,post:this.post,shadow:!0})):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","getPostParticipantsToShow","min","merge","Element","LoadingOverlay","TextElement","TextStyles","TextPalette","MenuSection","BarButton","SocialActivityEntry"],[e,n(1194),{SocialActivityEntry:n(1216)}],(t,e,n,r,o,s,a,l,u,c,h,p)=>{return i.defClass(class SocialActivityList extends t{},function(t,d,f){this.subscriptions("navState.maxRecentConversationsToShow",{participantsByUserIdDesc:function({currentUserId:t}){return t},notificationsByUserId:function({currentUserId:t}){return t}}),this.stateFields({amountToShow:null,socialActivityEntries:[]}),this.prototype.showMore=function(){let t,i,r,o;return({selectedPostParticipants:t,allPostParticipants:i}=e(this.participantsByUserIdDesc)),r=null!=(o=this.amountToShow)?o:t.length,this.amountToShow=n(i.length,r+3)},this.prototype.preprocessState=function(t){let n,o,s,a,l,u,c,h;return n=t.participantsByUserIdDesc,o=t.notificationsByUserId,h=this.props,s=h.currentUserId,a=h.gridSize,n&&({selectedPostParticipants:l,allPostParticipants:u}=e(n)),c=i.array(l,t=>r({key:t.id,postParticipantId:t.id,sortBy:t.lastActivityAt,gridSize:a,currentUserId:s},t)),i.array(o,t=>r({key:t.id,notificationId:t.id,sortBy:t.createdAt,gridSize:a,currentUserId:s},t),null,c),r(f.preprocessState.apply(this,arguments),{socialActivityEntries:c.sort((t,e)=>e.sortBy-t.sortBy)})},this.prototype.render=function(){let t,n,r,d,f,m;return t=(m=this.props).currentUserId,n=m.gridSize,r=this.socialActivityEntries,({selectedPostParticipants:d,allPostParticipants:f}=e(this.participantsByUserIdDesc)),this.amountToShow&&r&&(r=r.slice(0,this.amountToShow)),o("parentWidthChildrenHeight","column",{padding:n},r.length>0?i.array(r,t=>p(t)):o({size:{h:6*n}},"pending"===this.participantsByUserIdDescStatus||"pending"===this.notificationsByUserIdStatus?s():a(l.mediumText,"parentSize","textCenterCenter",{color:u.black.secondary,text:"conversations and notifications\nappear here"})),d.length<f.length?c(h({icon:"angleDown",text:"show more",action:this.showMore})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["AbstractOverlayComponent","logRejectedPromises","MenuSection","pluralize","Element","ImikimiPalette","TextElement","TextStyles","TextPalette","MenuInfo","MenuButton","isMember","MenuDivider","MenuBulkUploadPhotos","MenuMarkdown","StreamEditor","PostSettings","PostPreview","MenuSectionGroup","MenuEditableText","pipelines","MenuChooseAndConfirm","InlineFlagOptions","MenuFollowOptions","MenuToggle","UserCircle","min","StreamMembers","present","getDisplayTitle","getShortDisplayName"],[e,n(1194),n(1219)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_,E,T,k,I,M,A)=>{return i.defClass(class StreamSettings extends t{},function(t,F,B){let R,z;this.subscriptions("navState.searchVisible","currentSession.currentUserId","currentSession.grantMemberAccess","post",{user:function({topic:t,post:e}){return i.exists(t)&&t.userId||i.exists(e)&&e.userId},topic:R=function({topic:t,post:e}){let n;return null!=(n=i.exists(t)&&t.id)?n:i.exists(e)&&e.topicId},followingTopic:R,topicFollower:z=function(t){let e,n;return e=R(t),n=t.currentUserId,e&&n?{topicId:e,userId:n}:void 0},topicMembership:z,prevChapterByPostId:function({post:t}){return i.exists(t)&&t.id},topicMembershipsByTopicId:R,topicInvitesByTopicId:R,topicInviteLinksByTopicId:R}),this.stateFields({confirmedDeleteTopic:!1,confirmHideTopic:!1,settingFocus:!1,settingColors:!1,focus:null,showFlagOptions:!1}),this.getter({chapterPost:function(){let t;return i.exists(t=this.post)&&t.isChapterStart?this.post:this.prevChapterByPostId},stream:function(){return this.topic},isOwner:function(){return this.currentUserId===this.stream.userId},canAdminPost:function(){let t;return this.canAdmin||this.currentUserId===(i.exists(t=this.post)&&t.userId)},canPost:function(){return this.stream&&(this.currentUserId===this.stream.userId||!!i.find(this.topicMembershipsByTopicId,null,({userId:t,canPost:e})=>this.currentUserId===t&&e))},canAdmin:function(){return this.stream&&(this.currentUserId===this.stream.userId||!!i.find(this.topicMembershipsByTopicId,null,({userId:t,canAdmin:e})=>this.currentUserId===t&&e))},postId:function(){let t;return i.exists(t=this.post)&&t.id},isProfileTopic:function(){return this.stream.isProfileTopic},topicId:function(){return R(this.props)},isSubscribed:function(){let t;return i.exists(t=this.topicFollower)&&t.subscribed},canViewTopicMemberships:function(){return this.isOwner||i.find(this.topicMembershipsByTopicId,t=>t.userId===this.currentUserId)}}),this.prototype.submitTitle=function(t){return this.models.topic.update({key:this.stream.id,data:{title:t}})},this.prototype.submitStreamDescription=function(t){return this.models.topic.update({key:this.stream.id,data:{description:t}})},this.prototype.closeAndReportErrors=function(t){return this.models.navState.hideOverlay().then(()=>t()).catch(t=>this.models.navState.showSystemError(t))},this.prototype.toggleTopicPrivacy=function(){return this.models.topic.update({key:this.stream.id,data:{private:!this.stream.private}})},this.prototype.hideTopic=function(t){return this.models.hidingTopic.hideTopic({topicId:this.stream.id,hiddenOnPostId:this.post.id,reason:t})},this.prototype.deletePost=function(){return this.closeAndReportErrors(()=>this.models.post.delete({key:this.post.id}))},this.prototype.deleteTopic=function(){return this.models.navState.closeFullScreenPost(),this.closeAndReportErrors(()=>{let t;return e("deleteTopic",this.models.topic.delete(t={key:this.stream.id,props:{async:!0,force:this.confirmedDeleteTopic}})).then(()=>this.models.navState.showSystemMessage({title:"Delete stream",message:`You stream '${i.toString(this.stream.title)}' is being deleted.`}))})},this.prototype.showMessages=function(){return this.models.navState.showMessages(this.post)},this.prototype.sharePost=function(){return this.models.navState.showSharePost(this.post)},this.prototype.showProfile=function(){return this.models.navState.showUser(this.user)},this.prototype.renderConfirmDeleteTopic=function(){let t,e;return({gridSize:t}=this.viewState),n({key:"delete stream section",label:`Delete Stream and ${i.toString(e=r(this.stream.postCount,"post"))}`},o("parentWidthChildrenHeight",{padding:t,draw:[{radius:t},s.red]},a(l.mediumBoldText,"parentWidthChildrenHeight",{color:u.white.primary,paragraphLeading:2,align:.5,text:"WARNING!\nYou are about to delete this stream and every post in it! Are you absolutely sure?\nThis CANNOT be undone."})),this.stream.postCount>100?c({text:"If this stream has a lot of posts, it may take a few minutes for it to be completely deleted."}):void 0,o("parentWidthChildrenHeight",{padding:{v:t}},o("parentWidthChildrenHeight",{padding:t},h({key:"deleteTopicNow",icon:"trash",height:2*this.viewState.buttonSize,hoverColor:s.red,text:`delete '${i.toString(this.stream.title)}' forever`,action:()=>this.confirmedDeleteTopic?this.deleteTopic():this.confirmedDeleteTopic=!0})),o("pointerCursor",{inFlow:!1,opacity:.9,animators:{axis:{duration:this.confirmedDeleteTopic?3:.5,f:"linear"}},on:{pointerClick:({target:t})=>0!==t.axis.x?(this.confirmedDeleteTopic=!1,t.axis={x:0}):(this.confirmedDeleteTopic=!0,t.axis={x:-.9})},draw:{radius:10,outline:{color:"#f7f700",lineWidth:3,shadow:!0},colors:{stripes:["#f7f700","#0001"],repetitions:10},to:{xw:1,yw:1},shadow:!0}})))},this.prototype.postInThisStream=function(){return this.models.newPostState.startNewPostForTopic(this.stream)},this.prototype.renderEditStream=function(){let t,e,i,r;return r=this,t=this.canAdmin,e=this.canPost,i=this.grantMemberAccess||p(this.topic.user),t||e?n({label:"Edit"},h({icon:"plus",text:"Post in this Stream",action:this.postInThisStream}),!i&&d({memberOnly:!0,text:"Member tools",inMenuSection:!0},this.subPageActionProps),f({topic:this.topic,disabled:!i}),t?[h({icon:"tiles",text:"Stream Editor",action:i&&(()=>this.pushPage(g,{topic:this.topic,overlay:this}))}),!i&&m({text:"The Stream Editor is a powerful tool for managing your stream's chapters and posts.\n\n* move posts between streams\n* change post order\n* bulk delete posts\n* bulk upload photos\n* change any chapter or post's settings"})]:void 0):void 0},this.prototype.renderPostOptions=function(){return this.canAdminPost?y({post:this.post,chapterPost:this.chapterPost,overlay:this,deleteAction:()=>this.pushPage("renderConfirmDeletePost")}):n({label:"Post"},v({post:this.post}))},this.prototype.renderOwnerOptions=function(){let t,e,o;return({gridSize:t}=this.viewState),e=this.chapterPost,({isProfileTopic:o}=this.stream),S(e&&e!==this.post?y({key:"chapter post settings",post:this.prevChapterByPostId,overlay:this,chapterSettingsOnly:!0}):void 0,!o&&n({label:"Stream settings"},b({text:this.stream.title,overlay:this,label:"stream title",editTextProps:{title:"Stream title",value:this.stream.title,placeholder:"stream title",submit:this.submitTitle,maxLength:w.topic.fields.title.maxLength}}),b({text:this.stream.description,placeholder:"describe this stream",overlay:this,label:"stream description",maxLines:10,editTextProps:{spellcheck:!0,textArea:!0,title:"Stream description",value:this.stream.description,placeholder:"stream description",submit:this.submitStreamDescription,maxLength:w.topic.fields.description.maxLength}}),this.renderPublicPrivateToggle(),c({text:(this.stream.private?"This stream is private. Only you can see posts in your private streams.":"This stream is public. Anyone can see your public streams.")+" Posts inside a stream have the same privacy setting as the stream."})),this.isProfileTopic?void 0:n({label:"DANGER AREA"},h({icon:"trash",text:`delete stream and all ${i.toString(r(this.stream.postCount,"post"))}`,action:()=>this.pushPage("renderConfirmDeleteTopic")})))},this.prototype.renderHideStreamOptions=function(){return x({label:"Hide Stream",generateConfirmMessage:t=>`Hide this stream because ${i.toString(t)}`,currentUserRequired:!0,icon:"eyeBlocked",info:"Are you sure you want to hide this stream and all its posts? This cannot be undone.\nTo help improve the site, please select your reason.",options:"this stream is not interesting to me\nthis stream's content offends me\nI have my reasons",completionMessage:"The stream has been hidden.",action:this.hideTopic})},this.prototype.renderViewerOptions=function(){return S(n({label:"Report inappropriate content"},h({icon:"flag",text:"Flag this post"},{action:()=>this.pushPage({component:P,props:{topicId:this.topicId,postId:this.postId},title:"Flag post"})})))},this.prototype.renderOptions=function(){return n({key:"main",label:"Following & Notifications"},C(this.subPageActionProps,{currentUserId:this.currentUserId,topic:this.topic}),this.followingTopic||this.canAdmin||this.topicMembership?void 0:S({key:"hideThisStream"},h({icon:"eyeBlocked",text:"Hide this stream",action:()=>this.pushPage("renderHideStreamOptions")})))},this.prototype.renderBrowseOptions=function(){return n({label:"Browse"},h({icon:"search",text:"Search this stream",action:()=>{let t;return this.models.navState.searchWithinTopicId(i.exists(t=this.stream)&&t.id)}}),h({icon:"chapter",text:"Show all chapters and posts",action:()=>this.models.navState.showChapterNavigator(this.stream)}))},this.prototype.toggleFollowing=function(){return this.isSubscribed&&this.toggleSubscribing(),this.models.followingTopic.toggleFollowing(this.stream)},this.prototype.toggleSubscribing=function(){return this.isSubscribed?w.topicFollower.unsubscribe(this.stream.id):w.topicFollower.subscribe(this.stream.id)},this.prototype.renderPublicPrivateToggle=function(){return _({icon:this.stream.private?"private":"public",text:this.stream.private?"Private stream":"Public stream",action:this.toggleTopicPrivacy,isOn:!this.stream.private})},this.prototype.componentWillMount=function(){return B.componentWillMount.apply(this,arguments),this.createEvent(`show:${i.toString(this.canAdmin?"ownStream":"othersStream")}`,{topicId:this.topicId})},this.prototype.renderConfirmDeletePost=function(){return n({key:"delete post section",label:"Delete Post"},v({post:this.post}),c({text:"Are you sure you want to delete this post? This cannot be undone.",color:u.black.primary}),h({icon:"trash",text:"delete post now",key:"deletePostNow",action:this.deletePost}))},this.prototype.renderVisibility=function(){let t,e,r,s,a,l,u,c,p,d,f,g;return t=this.viewState.gridSize,e=this.topicMembershipsByTopicId,r=null!=(u=i.exists(e)&&e.length)?u:0,s=4*t,a=0,i.each2(this.topicInvitesByTopicId,t=>a++,t=>w.topicInvite.inviteIsOutstanding(t)),n(m({text:this.topic.private?r>0?"# Private Stream\n\n> Only stream members can see this stream.":"# Private Stream\n\n> Only you can see this stream.":"# Public Stream\n\n> Everyone can see this stream."}),o("parentWidthChildrenHeight",{padding:{v:t}},o("row","childrenSize","childrenCenterCenter","topCenter",{childrenMargins:t,scale:(t,e)=>T(1,t.minRatio(e))},E({size:s,userId:i.exists(c=this.topic)&&c.userId,mediaSize:"medium"}),(p=[],d=T(r,l=5),g=(f=0)<d?1:-1,(()=>{for(;g>0&&f<d||g<0&&f>d;){let t;t=f,p.push(E({size:s,userId:e[t].userId,mediaSize:"medium"})),f+=g}})(),p),!this.topic.private||r>5?E({size:s,initials:this.topic.private?`+${i.toString(r-5)}`:"+"}):void 0)),this.canViewTopicMemberships&&h({icon:"users",text:r>0?(this.canAdmin?"manage":"view")+" stream members":"Invite stream members",action:()=>this.pushPage({component:k,props:{topic:this.topic,overlay:this},title:"Stream Members"})}))},this.prototype.renderAbout=function(){let t;return I(t=this.topic.description)?n({label:"Stream Description"},m({text:t,maxMarkdownBlocks:3,moreButton:!0})):void 0},this.prototype.render=function(){let t,e,n;return t=!(!this.stream||!this.user),e=M(this.stream),B.render.call(this,{centered:!0,fullHeight:!0,title:t?(()=>{switch(!1){case!this.settingFocus:return this.post.isChapterStart?"Chapter Focal-point and Colors":"Post Photo Focal-point";case!this.isProfileTopic:return"Profile Photo Stream";case!this.canAdmin:return`Settings: ${i.toString(e||"loading...")}`;default:return`${i.toString(A(this.user))}'s ${i.toString(e||"loading...")}`}})():void 0,titlePost:i.exists(n=this.stream)&&n.lastChapterPost},S(t?S(this.renderVisibility(),this.renderAbout(),this.renderOptions(),this.renderBrowseOptions(),this.renderEditStream(),this.renderPostOptions(),this.canAdmin?this.renderOwnerOptions():this.renderViewerOptions()):void 0))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(288)).addModules({MenuBulkUploadPhotos:n(1220),PostPreview:n(1222),PostSettings:n(1223),SelectUsers:n(1224),SpmLoadingPost:n(1221),StreamEditor:n(1225),StreamEditorPostIcon:n(1226),StreamInviteLinkManager:n(1227),StreamMember:n(1228),StreamMembers:n(1229)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","zoPickImage","toSeconds","Promise","PromiseWorkerPool","zoUploadImage","merge","arrayWith","MenuSectionGroup","MenuInfo","Element","MenuButton","SpmLoadingPost"],[e,n(1194),{SpmLoadingPost:n(1221)}],(t,e,n,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class MenuBulkUploadPhotos extends t{},function(t,f,m){this.subscriptions("viewState.viewState","topic"),this.stateFields({imagesUploaded:0,imagesToUpload:0,uploadingPostImageInfos:null,canceled:!1}),this.getter({postIconSize:function(){return 6*this.viewState.gridSize+1},spmLayoutSize:function(){return this.postIconSize+this.viewState.gridSize/2},postIconProps:function(){let t,e;return({gridSize:t}=this.viewState),null!=(e=this._StreamEditorPostIconProps)?e:this._StreamEditorPostIconProps={size:this.postIconSize,isTouchScreen:this.viewState.isTouchScreen,gridSize:t,dragMove:this.dragMove,dragStart:this.dragStart,dragEnd:this.dragEnd,dragFinally:this.dragFinally,togglePostSelected:this.togglePostSelected,selectPost:this.selectPost,clearSelection:this.clearSelection}}}),this.prototype.addPhotos=function(){return this.canceled=!1,this._activeImageUploaders=[],e({multiple:!0}).then(t=>{let e,u,c;return this.imagesToUpload=t.length,this.imagesUploaded=0,e=n(),u=new r.Serializer,c=new o(4),i.each2(t,(t,n)=>c.queue(()=>{let r;return this.canceled?void 0:(r=null,t().then(t=>{let e;return(e=s(t,t=>this.setState(e=>a(e,{uploadingPostImageInfos:i.array(e.uploadingPostImageInfos,e=>e.objectName===r?a(e,{progress:t}):e)})),n=>(({objectName:r}=n),this.setState(n=>a(n,{uploadingPostImageInfos:l(n.uploadingPostImageInfos,a(t,{imageUploader:e,objectName:r,progress:0}))}))))).try()}).then(t=>this.models.newPostState.postDirectlyFromImageStorePutResult(t,{topicId:this.topic.id,postOrder:e+.1*n})).finally(()=>(this.imagesUploaded++,this.setState(t=>{let e;return a(t,{uploadingPostImageInfos:1===(i.exists(e=t.uploadingPostImageInfos)&&e.length)?null:i.array(t.uploadingPostImageInfos,null,t=>t.objectName!==r)})}))))})),c.then(()=>this.canceled=!1)})},this.prototype.cancel=function(){return this.canceled=!0,i.each2(this.uploadingPostImageInfos,({imageUploader:t})=>i.exists(t)&&t.abort())},this.prototype.render=function(){let t,e,n,r;return t=this.viewState.gridSize,u((e=(i.exists(n=this.uploadingPostImageInfos)&&n.length)>0)?u(c({text:`Uploading photos: ${i.toString(this.imagesUploaded+(i.exists(r=this.uploadingPostImageInfos)&&r.length))} / ${i.toString(this.imagesToUpload)}`}),h({padding:{h:-t/2},childrenLayout:"flow",size:{h:this.postIconSize}},i.array(this.uploadingPostImageInfos,({bitmap:t,progress:e,objectName:n})=>d(this.postIconProps,{key:n,chapterPost:this.lastChapterPost,margin:this.spmLayoutSize-this.postIconSize,progress:e,bitmap:t})))):void 0,p(e?{key:"cancel",icon:"cancel",text:"Cancel add photos",action:this.cancel}:{icon:"cloudUpload",text:"Add photos",action:!this.props.disabled&&this.addPhotos}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","Element","getPostBackground","BitmapElement","ProgressBar"],[e,n(1194)],(t,e,n,r,o,s)=>{return i.defClass(class SpmLoadingPost extends(t(e)){},function(t,e,i){this.prototype.render=function(){let t,e,i,a,l,u,c,h;return t=(h=this.props).gridSize,e=h.size,i=h.bitmap,a=h.chapterPost,l=h.margin,u=h.progress,n({cacheDraw:!0,size:{cs:1},animators:{size:{to:{w:0,hch:1}},opacity:{from:0}},margin:l,draw:[{radius:3,color:c=r(a)},"clip"]},n({padding:5,size:e},o({bitmap:i,layout:"zoom"}),n({size:{ww:1,h:t}},"bottomLeft",s({progress:u}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","aspectRatioForPost","Element","ShowMedia","ShowMediaWithText","ImikimiPalette","min"],[e,n(1194)],(t,e,n,r,o,s,a)=>{return i.defClass(class PostPreview extends t{},function(t,i,l){this.subscriptions("post","viewState.viewState"),this.prototype.render=function(){let t,i,l,u,c,h,p;return t=this.viewState.gridSize,i=(p=this.props).focusChanged,l=p.focusEditMode,u=p.chapterPost,c=this.post?(h=this.post.mediaFile,e(this.post)):1,n("row","childrenCenterCenter",{size:{ww:1,h:13*t},padding:{v:t}},n({size:c>1?{yh:1,x:({x:t,y:e})=>a(t,e*c)}:{yh:1,xh:c}},h?r({post:this.post,focus:this.focus,shadow:!0,dragOk:!1,focusChanged:i,focusEditMode:l}):this.post?o({post:this.post,chapterPost:u,shadow:!0,drawBackground:!0}):n({size:{hh:1,wh:1},draw:s.lightGrey})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["config","FluxComponent","Promise","getColorInfoForPost","timeout","getIsCoverPhoto","present","MenuSection","isShortFormTextPost","PostPreview","MenuEditableText","pipelines","MenuToggle","MenuButton","MenuMarkdown","FocusEditor","ChapterColorEditor"],[e,n(1194),n(576),{PostPreview:n(1222)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y)=>{let v;return v=t.edge,i.defClass(class PostSettings extends e{},function(t,e,S){this.subscriptions("post","viewState.viewState",{topic:function({post:t,topicId:e,topic:n}){let r;return null!=(r=null!=e?e:i.exists(n)&&n.id)?r:i.exists(t)&&t.topicId}}),this.stateFields({settingFocus:!1,settingColors:!1,colorInfo:null,focus:null}),this.prototype.showSetFocus=function(){return this.push},this.prototype.showFullscreenTextEditor=function(){return this.models.navState.showFullscreenTextEditor(this.props.post)},this.prototype.loadColorInfo=function(){return n.then(()=>{let t,e;return this.post.mediaFile?r(this.post):(({colors:t,colorMap:e}=this.post),{colors:t,colorMap:e})}).then(this.setColorInfo)},this.prototype.setAndSaveFocus=function(t,e){let n,i;return({x:n,y:i}=this.focus=t),e?void 0:this.models.post.update({key:this.post.id,data:{focus:t?{x:n,y:i}:void 0}})},this.prototype.preprocessState=function(t){return t.post&&t.post!==this.post&&o(500,this.loadColorInfo),t},this.prototype.togglePostIsChapterStart=function(){return this.models.post.update({key:this.post.id,data:{isChapterStart:!this.post.isChapterStart}})},this.prototype.toggleIsCoverPhoto=function(){return this.models.post.update({key:this.post.id,data:{isCoverPhoto:!s(this.post)}})},this.prototype.submitCaption=function(t){return a(t)||(t=null),this.models.post.update({key:this.post.id,data:{caption:t}})},this.prototype.submitChapterTitle=function(t){return a(t)||(t=null),t!==this.post.chapterTitle?this.models.post.update({key:this.post.id,data:{chapterTitle:t}}):void 0},this.prototype.render=function(){let t,e,n,r,o,a,S,b,w,x,P,C;return({overlay:t,chapterSettingsOnly:e,chapterPost:n}=this.props),this.post&&({mediaFile:r,isChapterStart:o,chapterTitle:a,caption:S}=this.post),b=null!=r,l({label:null!=(P=this.props.label)?P:e?"Chapter settings":o?"Post and Chapter settings":"Post settings",disabled:!this.post},(w=this.post&&(this.post.mediaFile||u(this.post)))?c({key:`PostPreview ${i.toString(i.exists(C=this.post)&&C.id)}`,post:this.post,chapterPost:n,focusChanged:this.setAndSaveFocus,focusEditMode:!0}):void 0,b&&!this.isProfileTopic&&o&&h({label:"chapter title",key:"postChapterTitle",text:a,overlay:t,editTextProps:{spellcheck:!0,title:"Chapter Title",value:a,placeholder:"chapter title",submit:this.submitChapterTitle,maxLength:p.post.fields.chapterTitle.maxLength},placeholder:"set this chapter's title"}),!e&&h({key:"postCaption",label:"post text",text:S,placeholder:"say something about this post",overlay:t,maxLines:w?5:10,editTextProps:{spellcheck:!0,title:"Post caption",value:S,textArea:!0,maxLength:p.post.fields.caption.maxLength,submit:this.submitCaption}}),!e&&b&&d({text:"Begin chapter here",icon:"bookmarkBook",isOn:o,action:this.togglePostIsChapterStart}),v?f({text:"New Zo Story Editor",action:this.showFullscreenTextEditor}):void 0,r?d({text:"Cover photo",icon:"bookmarkBook",isOn:x=s(this.post),action:this.toggleIsCoverPhoto}):void 0,!e&&b&&m({text:"The first post in a chapter sets the cover-photo and background-color for all following posts until the next chapter."}),null!=r&&f({icon:"target",text:"Set photo's focal-point",action:()=>t.pushPage({component:g,props:{post:this.post,topic:this.topic}})}),null!=r?f({icon:"palette",text:o?"Set chapter colors":"Set cover photo colors",action:()=>t.pushPage({component:y,props:{post:this.post,topic:this.topic,colorInfo:this.colorInfo}})}):void 0,this.props.deleteAction&&f({icon:"trash",text:"Delete this post",action:this.props.deleteAction}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Promise","pipelines","merge","config","present","createFilterRegExp","MenuSectionGroup","MenuSection","RelaxedMenuButton","pluralize","ImikimiPalette","SearchBar","Element","MenuLoadingSpinner","TextElement","TextStyles","TextPalette","MenuUser"],[e,n(1194)],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S)=>{return i.defClass(class SelectUsers extends t{},function(t,b,w){let x,P,C;this.subscriptions("viewState.gridSize","currentSession.currentUserId",{userFollowerByUserId:function({currentUser:t}){return t.id}}),this.propFields("verb"),this.stateFields({currentSearchString:null,searchResults:null,searchString:null,searchLoading:!1,followedUsers:null,filterRegExp:null,selectedUsers:[],selectedUserIds:[],loadingFollowedUsers:!0}),this.prototype.clearSearch=function(){return this.clearSearchResults()},x=function(t,e){return t.followingCount!==e.followingCount?e.followingCount-t.followingCount:t.displayName.localeCompare(e.displayName,void 0,{sensitivity:"base"})},P=function(t,e,n){let i,r;return null!=(i=t[n])&&null!=(r=e[n])?r-i:void 0},C=function(t,e){let n;return null!=(n=P(t,e,"followerCount"))&&0!==n?n:null!=(n=P(t,e,"postCount"))&&0!==n?n:t.createdAt-e.createdAt},this.prototype.preprocessState=function(t){let o,s;return o=t.userFollowerByUserId,s=t.followedUsers,!o||s&&o===this.state.userFollowerByUserId||(this.triggerLoadingFollowedUsers(),e.all(i.array(o,({followedUserId:t,followingCount:e})=>n.user.get(t).then(t=>r(t,{followingCount:e})))).then(t=>(this.clearLoadingFollowedUsers(),this.setFollowedUsers(t.sort(x))))),t},this.prototype.searchNow=function(t){return this.searchString=t,this.searchResults=null,this.searchLoading=!0,n.userSearch.search({data:{query:t,vertical:o.vertical}}).then(t=>(this.searchResults=t,this.searchLoading=!1))},this.prototype.setSearchString=function(t){return this.filterRegExp=s(this.currentSearchString=t)?a(t):void 0},this.prototype.selectUser=function(t){let e,n;return(e=i.array(this.selectedUsers,null,e=>e.id!==t.id)).length===(i.exists(n=this.selectedUsers)&&n.length)&&e.push(t),this.selectedUsers=e,this.selectedUserIds=i.array(e,({id:t})=>t)},this.prototype.selectUsers=function(){let t,e;return i.isF((t=this.props).selectUsers)&&t.selectUsers(this.selectedUsers),i.isF((e=this.props).popPage)&&e.popPage()},this.prototype.render=function(){let t,e,n,r,o,s,a,b;return t=this.filterRegExp,null!=(e=this.verb)||(e="add"),l((i.exists(o=this.selectedUsers)&&o.length)>0?u({key:"selectedUsers",label:"Selected people"},i.array(this.selectedUsers,t=>S({key:t.id,user:t,selectUser:this.selectUser})),c({icon:1===this.selectedUsers.length?"user":"users",text:`${i.toString(e)} ${i.toString(h(this.selectedUsers.length,"people"))}`,action:this.selectUsers,backgroundColor:p.lightGrey})):void 0,u({label:"Search People",childrenMargins:this.gridSize,key:"searchPeople"},d({placeholder:"email or name",searchNow:this.searchNow,clearSearch:this.clearSearch,setSearchString:this.setSearchString}),this.searchLoading||this.searchResults?f({size:{h:this.gridSize}}):void 0,this.searchLoading?m():void 0,(i.exists(s=this.searchResults)&&s.length)>0?(n=50,l(i.array(this.searchResults.sort(C),t=>S({key:t.id,disabled:t.id===this.currentUserId,user:t,rightText:t.id===this.currentUserId?"you":void 0,selectUser:this.selectUser}),t=>!i.in(t.id,this.selectedUserIds)&&n-- >=0))):void 0,0===(i.exists(a=this.searchResults)&&a.length)&&this.currentSearchString===this.searchString?g(y.smallText,"textCenterCenter",{color:v.black.tertiary,text:"no people found"}):void 0),this.loadingFollowedUsers?m():(i.exists(b=this.followedUsers)&&b.length)>0?(r=i.array(this.followedUsers,t=>S({key:t.id,user:t,selectUser:this.selectUser}),e=>(!t||t.test(e.displayName))&&!i.in(e.id,this.selectedUserIds)&&e.id!==this.currentUserId),(i.exists(r)&&r.length)>0?u({key:"followedUsers",label:`Following ${i.toString(h(r.length,"People"))} ${i.toString(t&&"(filtered)")}`},r):void 0):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","merge","isMember","peek","arrayWith","bound","Promise","MenuSection","TopicSelector","MenuButton","pluralize","zoPickImage","PromiseWorkerPool","logRejectedPromises","zoUploadImage","PostSettings","MenuBulkUploadPhotos","Math","MenuSectionGroup","Element","Spinner","MenuMarkdown","TextPalette","StreamEditorPostIcon","SpmLoadingPost"],[e,n(1194),{StreamEditorPostIcon:n(1226),SpmLoadingPost:n(1221),PostSettings:n(1223),MenuBulkUploadPhotos:n(1220)}],(t,e,n,r,o,s,a,l,u,c,h,p,d,f,m,g,y,v,S,b,w,x,P,C,_)=>{let E,T;return E=100,T=500,i.defClass(class StreamEditor extends t{},function(t,E,T){let k;this.subscriptions("topic viewState.viewState currentSession.currentUserId currentSession.grantMemberAccess",{postsDesc:{key:function({topic:t,topicId:e}){return i.exists(t)&&t.id||e},model:"postsByTopicIdDesc"}}),this.stateFields(e({selectedPosts:{},lastChapterPost:null,selectedPostStack:[],imagesUploaded:0,imagesToUpload:0,posts:[],uploadingPostImageInfos:null,draggingPostInitialLocation:null},k={pointerDownAtParentSpace:null,dropIndex:null,dragOffset:null,previewDrop:!1,dragWillAbort:!1,draggingPost:null})),this.getter({grantStreamEditorAccess:function(){return this.state.grantMemberAccess||n(this.topic.user)}}),this.prototype.resetDragging=function(){return this.setState(k)},this.prototype.preprocessState=function(t){let n,i,o,s,a,l,u;return({postsDesc:n,posts:i}=t),n&&n!==this.postsDesc&&(n.length>500&&(n=n.slice(0,500)),o=r(n),a=[],null!=(s=n)&&(l=s.length-1,(()=>{for(;l>=0;){let t;t=s[l],a.push((t.isChapterStart&&(o=t),t.chapterPost!==o?e(t,{chapterPost:o}):t)),u=l--}})()),i=a),e(t,{posts:i,lastChapterPost:o})},this.setter({selectedPostStack:function(t){return this.setState("selectedPostStack",t),this.selectedPosts=i.object(t,({id:t},e)=>e+1,null,null,({id:t},e)=>t)}}),this.prototype.selectPost=function(t){let e;return this.selectedPostCount<100?this.isSelected(t)?void 0:this.selectedPostStack=e=o(this.selectedPostStack,t):void 0},this.prototype.unselectPost=function(t){let e;return this.isSelected(t)?this.selectedPostStack=e=i.array(this.selectedPostStack,null,e=>e.id!==t.id):void 0},this.prototype.isSelected=function(t){let e;return null!=this.selectedPosts[null!=(e=t.id)?e:t]},this.prototype.togglePostSelected=function(t){return this.isSelected(t)?this.unselectPost(t):this.selectPost(t)},this.prototype.getPostIndexUnderPoint=function({x:t,y:e}){let n,i,r;return({spmLayoutSize:n}=this),s(0,4*(i=e/n|0)+(r=t/n|0),this.posts.length-this.selectedPostCount)},this.prototype.dragMove=function(t,e,n){return this.dragOffset=e,this.dragWillAbort=!n.target.parent.paddedArea.size.contains(n.parentLocation),this.dropIndex=this.getPostIndexUnderPoint(n.parentLocation)},this.prototype.dragStart=function(t,e,n){return this.dragOffset=e,this.draggingPost=t,this.dragWillAbort=!1,this.pointerDownAtParentSpace=n.parentLocation,this.isSelected(t)||this.clearSelection().then(()=>this.selectPost(t)),this.draggingPostInitialLocation=n.target.currentLocation},this.prototype.getPostIndex=function(t){return i.find(this.posts,(t,e)=>e,(e,n)=>t===e)},this.prototype.dragEnd=function(t,e){return this.dragOffset=e,(this.previewDrop=!this.dragWillAbort)?a.then(()=>{let t,e;return t=this.dropIndex,e=null,i.each2(this.posts,n=>(e=n,t--),e=>t>0&&!this.isSelected(e)),this.models.post.updatePostOrdersFromPosts({selectedPostIds:this.selectedPostIds,posts:this.posts,afterPost:e})}).finally(this.resetDragging):(this.resetDragging(),a.reject())},this.prototype.dragFinally=function(t,e){return this.dragOffset=e,this.draggingPost=null},this.prototype.clearSelection=function(t){let e;return this.selectedPostStack=(e=i.exists(t)&&t.id)?[t]:[],this.onNextReady()},this.getter({selectedPostCount:function(){return this.selectedPostStack.length},selectedPostIds:function(){return i.array(this.posts,t=>t.id,t=>this.isSelected(t.id))},StreamEditorPostIconSize:function(){return 6*this.viewState.gridSize+1},spmMargin:function(){return this.viewState.gridSize/2},spmLayoutSize:function(){return this.StreamEditorPostIconSize+this.viewState.gridSize/2},StreamEditorPostIconProps:function(){let t,e;return({gridSize:t}=this.viewState),null!=(e=this._StreamEditorPostIconProps)?e:this._StreamEditorPostIconProps={size:this.StreamEditorPostIconSize,isTouchScreen:this.viewState.isTouchScreen,gridSize:t,dragMove:this.dragMove,dragStart:this.dragStart,dragEnd:this.dragEnd,dragFinally:this.dragFinally,togglePostSelected:this.togglePostSelected,selectPost:this.selectPost,clearSelection:this.clearSelection}}}),this.prototype.renderMoveStreams=function(){return l(null,u({userId:this.currentUserId,selectTopic:t=>this.props.pushPage({render:this.renderConfirmMoveStreams,props:{topic:t},title:"Confirm Move"})}))},this.prototype.renderConfirmMoveStreams=function({topic:t}){return l(null,c({icon:"angleDoubleRight",text:`move ${i.toString(h(this.selectedPostCount,"post"))} to '${i.toString(t.title)}' now`,action:()=>this.moveSelectedToTopic(t)}))},this.prototype.renderConfirmDeletePosts=function(){return l(null,c({icon:"trash",text:`delete ${i.toString(h(this.selectedPostCount,"post"))} now`,action:this.deleteSelectedPosts}))},this.prototype.deleteSelectedPosts=function(){return a.all(i.array(this.selectedPostIds,t=>this.models.post.delete(t))).finally(()=>(this.clearSelection(),this.props.popPage()))},this.prototype.moveSelectedToTopic=function(t){return this.models.post.move({props:{keys:this.selectedPostIds,toTopicId:t.id}}).finally(()=>this.props.popPage(2))},this.prototype.addPhotos=function(){return p({multiple:!0}).then(t=>{let n,r;return this.imagesToUpload=t.length,this.imagesUploaded=0,n=new a.Serializer,r=new d(4),i.each2(t,t=>r.queue(()=>{let n;return n=null,f("streamEditor.addPhotos",t()).then(t=>m(t,t=>this.setState(r=>{let o;return({uploadingPostImageInfos:o}=r),e(r,{uploadingPostImageInfos:i.array(o,i=>i.objectName===n?e(i,{progress:t}):i)})}),i=>(({objectName:n}=i),this.setState(i=>e(i,{uploadingPostImageInfos:o(i.uploadingPostImageInfos,e(t,{objectName:n,progress:0}))})))).try()).then(t=>this.models.newPostState.postDirectlyFromImageStorePutResult(t,{topicId:this.topic.id})).finally(()=>(this.imagesUploaded++,this.setState(t=>{let r;return({uploadingPostImageInfos:r}=t),e(t,{uploadingPostImageInfos:1===r.length?null:i.array(r,null,t=>t.objectName!==n)})})))})),r})},this.getOverlayPageProps=function(t){return{title:t.topic?`Stream Editor: ${i.toString(t.topic.title)}`:"Stream Editor"}},this.prototype.renderPostSettings=function(){let t;return g({label:"Selected post",key:"postSettings",post:1===this.selectedPostStack.length?i.exists(t=this.selectedPostStack)&&t[0]:void 0,overlay:this.props.overlay,hideDelete:!0})},this.prototype.renderActions=function(){let t,e,n,r,o,s;return t=this.selectedPostCount,e=null!=(o=i.exists(s=this.posts)&&s.length)?o:0,r=(n=t>0&&t<e)?1===t?"post":h(t,"post"):"selected posts",l({label:0===t?"Select posts":`${i.toString(r)} selected`},c({icon:"pencil",text:"Edit selected post",action:1===this.selectedPostStack.length?()=>this.props.pushPage({render:this.renderPostSettings,title:"Post Settings"}):void 0}),y({topic:this.topic}),c({icon:"angleDoubleRight",text:"Move "+(r?`${i.toString(r)} to a another Stream`:void 0),action:n&&(()=>this.props.pushPage({render:this.renderMoveStreams,title:"Move to Stream"}))}),c({icon:"trash",text:`Delete ${i.toString(r)}`,action:n&&(()=>this.props.pushPage({render:this.renderConfirmDeletePosts,title:"Confirm Delete"}))}),c({icon:"cancel",text:"Unselect all",action:t>0&&(()=>this.clearSelection())}))},this.prototype.render=function(){let t,e,n,r,o,s,a,u,c,h,p,d,f,m,g,y,E,T,k,I,M;return({gridSize:t,feedWidth:e}=this.viewState),E=this,n=this.selectedPosts,r=this.selectedPostCount,o=this.draggingPost,s=this.dropIndex,a=this.dragWillAbort,u=this.spmLayoutSize,c=this.StreamEditorPostIconSize,h=this.spmMargin,p=0,d=v.ceil((null!=(T=i.exists(k=this.posts)&&k.length)?T:0)/4),f=(e-4*c-3*h)/2,m=(i.exists(I=this.posts)&&I.length)>0,S(b({size:f}),b({size:"parentWidthChildrenHeight",childrenLayout:"column"},m?void 0:b({size:{ww:1,h:4*t}},w()),m&&b({size:{ww:1,h:u*d-h}},b({inFlow:!1,on:{pointerClick:()=>this.clearSelection()}}),b({receivePointerEvents:"passToChildren",padding:{h:f,bottom:f}},i.array(this.posts,t=>{let e,n,i,s;return e=this.isSelected(t),o||(o=this.previewDrop),n=e&&o,!a&&o&&p===this.dropIndex&&(p+=r),i=p/4|0,s=p%4,!n||a?(p++,C(this.StreamEditorPostIconProps,{key:t.id,opacity:n&&a?1/3:1,location:{x:.5*c+s*u,y:.5*c+i*u},post:t,selected:e})):a?(p++,null):void 0}),this.previewDrop?(p=this.dropIndex,i.array(this.posts,t=>{let e,n;return e=p/4|0,n=p%4,p++,C(this.StreamEditorPostIconProps,{key:t.id,location:{x:.5*c+n*u,y:.5*c+e*u},post:t,selected:!0,saving:!0})},t=>this.isSelected(t))):o&&!a?(({pointerDownAtParentSpace:g,dragOffset:y}=this),p=0,i.array(this.posts,e=>{let n;return n=p,p++,C(this.StreamEditorPostIconProps,{key:e.id,opacity:n<3?this.dragWillAbort?1/3:1:0,scale:1.1,location:g.add(y).add(n*t/2),post:e,selected:!0})},t=>this.isSelected(t)).reverse()):void 0),this.previewDrop?b():void 0),l(x({small:!0,text:this.viewState.isTouchScreen?"* Tap to select one.\n* Tap and hold (short) to add to selection.\n* Tap and hold (long) to move posts.":"* Drag posts to change order.\n* Shift-click to select multiple posts."})),(i.exists(M=this.uploadingPostImageInfos)&&M.length)>0?l({label:`Uploading photos: ${i.toString(this.imagesUploaded+this.uploadingPostImageInfos.length)} / ${i.toString(this.imagesToUpload)}`},b({padding:-t/2,childrenLayout:"flow"},"parentWidthChildrenHeight",i.array(this.uploadingPostImageInfos,({bitmap:t,progress:e,objectName:n})=>_(this.StreamEditorPostIconProps,{key:n,chapterPost:this.lastChapterPost,margin:this.spmLayoutSize-this.StreamEditorPostIconSize,progress:e,bitmap:t})))):void 0,this.renderActions(),this.grantStreamEditorAccess?void 0:b({inFlow:!1,draw:P.white.primary})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["PointerActionsMixin","FluxComponent","timeout","Element","getPostBackground","ShowMediaWithText","ImikimiPalette","TextElement","Icons","TextPalette"],[e,n(1194)],(t,e,n,r,o,s,a,l,u,c)=>{return i.defClass(class SpmPost extends(t(e)){},function(t,e,h){this.propFields("post","isTouchScreen","togglePostSelected","clearSelection","selectPost","saving","selected"),this.stateFields({prepareToPrepare:!1,prepareToMove:!1,prepareToDeselect:!1}),this.getter({touchDragTimeoutMs:function(){return 1e3}}),this.prototype.dragMove=function(t,e){return this.cancelSelectTimeout(),this.props.dragMove(this.post,e,t),t.target.scrollOnScreen()},this.prototype.dragStart=function(t,e){return this.selectPost(this.post),this.prepareToDeselect=!1,t=t.clone(),this.onNextReady(()=>this.props.dragStart(this.post,e,t))},this.prototype.dragEnd=function(t,e){return this.props.dragEnd(this.post,e,t)},this.prototype.dragFinally=function(t,e,n){return this._dragging=this.prepareToMove=this.prepareToPrepare=this.prepareToDeselect=!1,this.cancelSelectTimeout(),this.props.dragFinally(this.post,e,n)},this.prototype.cancelSelectTimeout=function(){return this._selectTimeoutCanceled=!0},this.prototype.dragPrepare=function(t){let e,r;return this._dragging=!0,this._preventClear=!1,this._selectTimeoutCanceled=this.prepareToDeselect=this.prepareToMove=!1,this.prepareToPrepare=this.isTouchScreen,this.isTouchScreen?n(250,()=>this._selectTimeoutCanceled?void 0:(n(250,()=>this._dragging?this.triggerPrepareToMove():void 0),n(750,this.clearPrepareToMove),this._preventClear=!0,this.props.selected?this.prepareToDeselect=!0:this.togglePostSelected(this.post))):(i.exists(r=t.target)&&i.isF(r.capturePointerEvents)&&r.capturePointerEvents(),({shiftKey:e}=t.props),e?(this._preventClear=!0,this.togglePostSelected(this.post)):this.selected?void 0:this.clearSelection(this.post))},this.prototype.action=function(){return this._preventClear?this.prepareToDeselect?this.togglePostSelected(this.post):void 0:this.clearSelection(this.post)},this.prototype.togglePostIsChapterStart=function(){return this.models.post.update({key:this.post.id,data:{isChapterStart:!this.post.isChapterStart}})},this.prototype.render=function(){let t,e,n,i,h,p,d,f,m;return({gridSize:t,post:e,selected:n,size:i,scale:h,location:p,dragTarget:d,opacity:f}=this.props),this.prepareToPrepare&&(h=1.05),r({axis:.5,cacheDraw:!0,opacity:f,scale:null!=h?h:1,on:this.dragHandlers,location:p,animators:{scale:{duration:this.prepareToPrepare?.75:.1},location:{duration:.1},draw:!0},cursor:"pointer",size:null!=i?i:6*t,padding:5,draw:{radius:3,color:m=o(e.chapterPost)}},r({axis:d?"topCenter":"topLeft",animators:"axis"},s({post:e,shadow:!0,layout:"fit",chapterPost:e.chapterPost,thumbnailMode:!0,mediaSize:128})),this.isTouchScreen||this.selected?r({padding:t/4},r("topRight",{size:1.5*t,animators:"draw",draw:["circle",{padding:this.prepareToPrepare?-1:0,outline:{lineWidth:this.prepareToPrepare?2:0,color:"white"}},n?{padding:0,fill:this.saving?a.yellow:this.prepareToDeselect?a.primary.withAlpha(.25):a.primary}:void 0]},n?l(this.saving?u.bullet:u.check,"parentSize","textCenterCenter",{color:this.prepareToDeselect?"#fff4":"#fff",fontSize:16}):void 0)):void 0,e.isChapterStart?r("childrenSize","bottomLeft",{padding:{right:5,top:5},draw:{radius:{topRight:3},color:m}},l(u.bookmarkBook,"childrenSize",{color:c.white.primary,fontSize:16})):void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","toSeconds","pipelines","timeout","Promise","MenuButton","humanDurationString","MenuSectionGroup","MenuSection","MenuMarkdown","StringConstants","Element"],[e,n(1194)],(t,e,r,o,s,a,l,u,c,h,p,d)=>{return i.defClass(class StreamInviteLinkManager extends t{},function(t,f,m){let g;this.subscriptions("viewState.gridSize","viewState.nativeApp","currentSession.currentUserId",{topicInviteLinksByTopicId:function({topicId:t}){return t}}),this.stateFields({copiedId:null}),g=function(t){return e(t.expiresAt)>e()},this.getter({activeInviteLinkFromCurrentUser:function(){return i.find(this.topicInviteLinksByTopicId,null,t=>this.currentUserId===t.invitedByUserId&&g(t))}}),this.propFields("topicId"),this.prototype.createNewLink=function(){return r.topicInviteLink.create({data:{topicId:this.topicId}})},this.prototype.copyInviteLink=function(t){return n(848)(r.topicInviteLink.createInviteLinkUrl(t))?(this.copiedId=t.id,o(3e3,this.clearCopiedId)):void 0},this.prototype.autoCopyLink=function(){return s.then(()=>{let t;return null!=(t=this.activeInviteLinkFromCurrentUser)?t:this.createNewLink()}).then(this.nativeApp?this.models.share.nativeShareLink:this.copyInviteLink)},this.prototype.renderCopyLink=function(){let t;return t=this.activeInviteLinkFromCurrentUser,a({icon:"share",rightText:t&&`expires in ${i.toString(l(e(t.expiresAt)-e(),!0))}`,text:this.nativeApp?"share invite link":`${i.toString(this.copiedId===(i.exists(t)&&t.id)?"copied":"copy")} invite link`,action:this.autoCopyLink})},this.prototype.render=function(){let t;return t=!1,u(c({label:"Stream Invite Links"},h({padding:{top:this.gridSize,bottom:2*this.gridSize},text:p.streamExplanations.streamInviteLink}),d("column","parentWidthChildrenHeight",{childrenMargins:this.gridSize},this.renderCopyLink(this.activeInviteLinkFromCurrentUser))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pipelines","Element","MenuUser","MenuMarkdown","getDisplayName","MenuButton","MenuSectionGroup","LoadingOverlay"],[e,n(1194)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class StreamMember extends t{},function(t,c,h){this.subscriptions({user:function({participant:{userId:t}}){return t},topic:function({participant:{topicId:t}}){return t}},"viewState.gridSize"),this.propFields("participant","selected","canAdmin","currentUserId"),this.stateFields({confirmDelete:!1,loading:!1}),this.prototype.action=function(){let t;return i.isF((t=this.props).selectParticipant)&&t.selectParticipant(this.participant)},this.prototype.unselect=function(){let t;return i.isF((t=this.props).selectParticipant)&&t.selectParticipant(null)},this.getter({currentRole:function(){return this.participant.canAdmin?"admin":this.participant.canPost?"poster":"member"}}),this.prototype.setRole=function(t){return t!==this.currentRole?(this.loading=!0,e.topicMembership.update({key:{userId:this.participant.userId,topicId:this.participant.topicId},data:{canAdmin:"admin"===t,canPost:"admin"===t||"poster"===t}}).finally(this.clearLoading).finally(this.unselect)):void 0},this.prototype.remove=function(){return this.loading=!0,(null!=this.participant.invitedAt?e.topicInvite:e.topicMembership).delete({key:{topicId:this.participant.topicId,userId:this.participant.userId}}).finally(this.clearLoading)},this.prototype.render=function(){let t,e,c,h,p,d;return p=this,t=this.participant,e=this.currentRole,c=this.canAdmin,h=this.currentUserId===t.userId,n("parentWidthChildrenHeight","column",{animators:{size:{toFrom:{h:0}}},draw:[{padding:{h:-this.gridSize}},"clip"]},r({user:this.user,action:this.action},{rightText:t.userId===(i.exists(d=this.topic)&&d.userId)?"owner":e}),(()=>{switch(!1){case!this.confirmDelete:return this.selected||this.clearConfirmDelete(),n("parentWidthChildrenHeight",{padding:{left:this.gridSize},key:"confirmDelete",animators:{size:{toFrom:{h:0}}},draw:[{padding:{h:-this.gridSize}},"clip"]},"column",o({padding:{v:2*this.gridSize},text:h?`Are you sure you want to leave this stream?\n\n${i.toString(this.topic.private?"* This is a private stream, and you will no longer be able to view it":void 0)}\n* You will not be able to re-enter again unless you are re-invited`:`Are you sure you want to remove\n\n${i.toString(s(this.user))}\n\nfrom this stream's participant list?`}),a({icon:"trash",key:"trash",text:h?"leave now":"remove now",action:this.remove}),a({icon:"cancel",key:"cancelRemove",text:"cancel",action:this.clearConfirmDelete}));case!this.selected:return l({key:"options",padding:{left:this.gridSize}},null==t.invitedAt?i.array(["admin","poster","member"],t=>a({icon:"bullet",text:`role: ${i.toString(t)}`,action:()=>c&&this.setRole(t),selected:t===e}),t=>c||t===e):void 0,this.canAdmin?a({icon:"trash",key:"trash",text:"remove",action:this.triggerConfirmDelete}):h?a({icon:"logout",key:"trash",text:"leave stream",action:this.triggerConfirmDelete}):void 0)}})(),this.loading?u():void 0)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","MenuSectionGroup","Promise","pipelines","MenuSection","MenuUser","RelaxedMenuButton"],[e,n(1194)],(t,e,r,o,s,a,l)=>{return i.defClass(class StreamMembers extends t{},function(t,u,c){this.subscriptions("topic","currentSession.currentUser","currentSession.currentUserId",{topicMembershipsByTopicId:function({topic:t}){return i.exists(t)&&t.id},topicInvitesByTopicId:function({topic:t}){return i.exists(t)&&t.id}}),this.propFields("topic"),this.stateFields({selectedParticipantUserId:null}),this.getter({noMembersOrInvites:function(){let t,e;return 0===(i.exists(t=this.topicInvitesByTopicId)&&t.length)&&0===(i.exists(e=this.topicMembershipsByTopicId)&&e.length)},topicId:function(){return this.topic.id},canAdmin:function(){return this.topic&&(this.currentUserId===this.topic.userId||!!i.find(this.topicMembershipsByTopicId,null,({userId:t,canAdmin:e})=>this.currentUserId===t&&e))}}),this.prototype.addPeople=function(){return this.props.pushPage(this.renderInvitePeople,{title:"Invite People to Stream"})},this.prototype.renderInvitePeople=function(){return e(n(1227)({currentUser:this.currentUser,topicId:this.topicId}),n(1224)({currentUser:this.currentUser,selectUsers:this.addUsers,verb:"invite"}))},this.prototype.selectParticipant=function(t){let e;return i.exists(t)&&(e=t.userId),this.selectedParticipantUserId=this.selectedParticipantUserId!==e?this.selectedParticipantUserId=e:void 0},this.prototype.addUsers=function(t){return r.all(i.array(t,({id:t})=>o.topicInvite.create({data:{topicId:this.topicId,userId:t}})))},this.prototype.renderParticipantList=function(t,n){return t.length>0?e({key:n},this.renderParticipantListInternal(t)):void 0},this.prototype.renderParticipantListInternal=function(t){return i.array(t,t=>n(1228)({participant:t,currentUserId:this.currentUserId,canAdmin:this.canAdmin,selectParticipant:this.selectParticipant,selected:t.userId===this.selectedParticipantUserId}))},this.prototype.render=function(){let t,n,r,o,u;return t=[],n=[],r=[],o=[],u=[],i.each2(this.topicInvitesByTopicId,t=>{let e,n,i,r;return e=t.declinedAt,n=t.acceptedAt,i=t.invited,(()=>{switch(!1){case!(null!=(r=e>n)&&r):return u.push(t);case!(i&&null==n):return o.push(t)}})()}),i.each2(this.topicMembershipsByTopicId,e=>(()=>{switch(!1){case!e.canAdmin:return t;case!e.canPost:return n;default:return r}})().push(e)),e(this.noMembersOrInvites?this.renderInvitePeople():[s(a({userId:this.topic.userId,rightText:"owner"}),this.renderParticipantList(t,"admins"),this.renderParticipantList(n,"posters"),this.renderParticipantList(r,"guests"),this.canAdmin?l({icon:"plus",text:"Invite",action:this.addPeople}):void 0),o.length>0?s({label:"invited",key:"invited"},this.renderParticipantListInternal(o)):void 0,u.length>0?s({label:"declined",key:"declined"},this.renderParticipantList(u,"declined")):void 0])}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["AbstractOverlayComponent","isSubscriberMember","isMember","ManageSubscription"],[e,n(1194),n(1204)],(t,e,n,r)=>{return i.defClass(class Subscription extends t{},function(t,i,o){this.propFields("currentUser"),this.getter({isSubscriber:function(){return e(this.currentUser)},isMember:function(){return n(this.currentUser)}}),this.prototype.preprocessState=function(t){return this.props.closeOnAccessGranted&&this.isMember&&this.models.navState.hideOverlay("Subscription"),o.preprocessState.apply(this,arguments)},this.prototype.render=function(){return o.render.call(this,{fullHeight:!0,title:this.isSubscriber?"Membership Settings":"Become a Member"},r(this.props,this.subPageActionProps))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","PopOver","ImikimiPalette","Element","MenuSection","MenuMarkdown","ProgressBar","Spinner","MenuButton"],[e,n(1194)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class SystemMessage extends t{},function(t,c,h){this.subscriptions("viewState.gridSize","post"),this.prototype.render=function(){let t,c,h,p,d,f,m,g,y,v,S,b;return t=this.gridSize,c=void 0!==(S=(v=this.props).title)?S:"Message",h=v.warning,p=v.progress,d=v.buttons,f=v.message,m=void 0!==(b=v.text)?b:f,g=v.showSpinner,e({titlebarColor:h?n.yellow:n.primary,centered:!0,title:c,titlePost:this.post},r("parentWidthChildrenHeight","column",{padding:{bottom:t/2}},o(s((({stringVariables:y}=this.props),{stringVariables:y}),{text:m,includeTags:!0}),null!=p?r({size:{ww:1,h:3*t/2},padding:{bottom:t/2}},a({progress:p})):void 0,g?r({size:{h:3*t}},l()):void 0,d?i.array(d,t=>u(t)):u({icon:"checkmark",text:"okay",action:this.models.navState.hideOverlay}))))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","TextPalette","BitmapElement","zoMaskBitmapProps","openLink","docUrls"],[e,n(810)],(t,e,n,r,o,s,a,l,u)=>{return i.defClass(class RootLoadingScreen extends t{},function(t,i,c){this.subscriptions("viewState.viewState"),this.prototype.render=function(){let t;return({gridSize:t}=this.viewState),e({key:"loading overlay",animators:{opacity:{to:0}},cacheDraw:!0,draw:"white"},n(r.xLargeText,{size:"childrenSize",fontSize:24,location:{xw:.5,y:16},axis:"topCenter",text:"imikimi",color:o.black.secondary}),e({draw:["children",{fill:{compositeMode:"sourceTopInTarget",color:"#777"}}]},s({size:64,location:"centerCenter",axis:"centerCenter"},a)),e({size:"childrenSize",padding:{bottom:t},location:{ps:"bottomCenter"},axis:"bottomCenter",childrenLayout:"row",childrenMargins:this.viewState.gridSize/2},n(r.mediumText,{text:"help",color:o.black.secondary,size:"childrenSize",on:{pointerClick:()=>l(u.help)}}),n(r.mediumText,{size:"childrenSize",color:o.black.secondary,text:""}),n(r.mediumText,{size:"childrenSize",text:"privacy policy",color:o.black.secondary,on:{pointerClick:()=>l(u.privacy)}}),n(r.mediumText,{color:o.black.secondary,size:"childrenSize",text:""}),n(r.mediumText,{text:"terms of use",size:"childrenSize",color:o.black.secondary,on:{pointerClick:()=>l(u.terms)}})))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","pipelines","present","timeout","getShortDisplayName","MarkdownView","Element","LargeBecomeAMemberButton","TabButton","ImikimiPalette","ScrollerWithBar","max","TextElement","TextStyles","ZoLogo"],[e,n(810),n(805)],(t,e,r,o,s,a,l,u,c,h,p,d,f,m,g)=>{let y;return y="2019ExpiredInverventionV2",i.defClass(class ExpiredUserIntervention extends t{},function(t,v,S){this.subscriptions("viewState.gridSize","viewState.buttonSize","viewState.feedWidth","viewState.safePadding","currentSession.currentUser"),this.prototype.createEvent=function(t,n){let o;return e.event.create(o=`${i.toString(this.models.subscriptionPromptState.expiredUserInterventionEventKey)} :${i.toString(t)} ${i.toString(r(n)?":"+n:void 0)}`),this.models.abTest.createEvent(y,o)},this.prototype.componentWillMount=function(){return o(100,()=>this.createEvent("show")),this.models.currentSubscription.setCurrentAbTestName(y)},this.prototype.subscribeAction=function(t){return this.models.subscriptionPromptState.expiredUserInterventionMessageShown=!0,this.createEvent("click:subscribe",t),this.models.navState.showOrPushSubscriptions(this.props.overlay,!0)},this.prototype.cancelAction=function(t){return this.models.subscriptionPromptState.expiredUserInterventionMessageShown=!0,this.createEvent("click:notRightNow",t)},this.prototype.applyForSponsorship=function(t){return this.models.subscriptionPromptState.expiredUserInterventionMessageShown=!0,this.createEvent("click:applyForSponsorship",t),this.models.navState.showSystemMessage({title:"Apply for Sponsorship",text:"Your email client should open so you can email us about applying for sponsorship.\n\nIf it does not, please email us directly, and tell us\nwhy you'd like to apply for sponsorship. feedback@imikimi.com\n\nThank you!"}),this.models.feedback.requestSponsorship()},this.getter({infoText:function(){return`# Membership Matters\n\nDear ${i.toString(s(this.currentUser))},`}}),this.prototype.renderMixedVersion=function(){return[a({text:'# Membership Matters\n\nHelp us create a better Internet based on\nmeaningful connection, community and creative expression.\n\n## Why become a Member?\n\nSupport your community and receive great membership benefits:\n* Your subscription allows us to sponsor others:\n\n> "I am disabled and live on a fixed income with a foster son. I would love to use this service to document his new life with his new family here. I am currently going through the adoption process with him."\n\n> "I am working on getting a degree in fine arts and this is a very helpful tool for me. I\'m a single mom with three kids and between tuition, rent and other bills and keeping food on the table I just can\'t afford it."\n\n* 5 Member Poster Text Styles\n* 9 Customizable Member Font-Effects\n* Over 100 Member Fonts\n* Member Dashboard\n* Member Stream Editor\n\n## Become a Member Now\n\nLearn more about our mission and how we serve you below.'}),this.renderButtons("v2TopButtons"),a({includeTags:!0,text:`## We Value You\n\nThank you for spending your valuable time with us. We hope you've enjoyed enhancing your photos with our millions of Kimi-frames, Poster-Text and\npowerful editor.\n\nWe believe in the power of creative expression to foster meaningful relationships and communities.\nYour membership not only gives you access to all our creativity tools, it also helps us serve others in wonderful ways.\nWe have given memberships to many wonderful, creative people through our sponsorship program.\n\nWe value your time, attention and privacy. That's why we\nuse subscriptions instead of ads.\nSubscriptions allow us to serve you and a growing community of wonderful, generous people to our fullest capacity.\n\nWe need your help to create a better internet based on\nmeaningful connection, community and creative expression.\n\n## Founded on Creativity\n\nImikimi was founded in 2007 based on a belief that creative self-expression can help build the meaningful relationships\nand community that give our lives meaning. Since that time volunteer artists have created millions of Kimi-templates, and those\nframes have been used nearly one billion times!\n\nLast year we introduced two new ways to express yourself creatively: Streams and Poster-Text. We are constantly working on\nnew and better ways to fuel your creativity and, through your creativity, help you build meaningful relationships and community.\n\n## Becoming a Member has Tons of Benefits\n\nSupport Your Community - Your contribution helps us serve others.\n* Volunteer Kimi Artists find meaning and joy making beautiful Kimi frames for your photos.\n* Our generous Angels use Kimis to support others in times of grief.\n* People with real life challenges who find Imikimi to be a vital creative outlet and a bright spot in their lives.\n* People sharing their joys and memories with friends and families.\n* People supporting, congratulating and connecting with the important people in their lives.\n\nMembership Benefits - We are adding membership benefits all the time.\n* 5 Member Poster Text Styles https://zo.imikimi.com/post/ltxILRIPaCXz\n* 9 Customizable Member Font-Effects https://zo.imikimi.com/post/eVhctKrxTrt5\n* Over 100 Member Fonts https://zo.imikimi.com/post/iK8iEtSRD4Fi\n* Member Dashboard https://zo.imikimi.com/post/hiEJjt5kTkSu\n* Member Stream Editor https://zo.imikimi.com/post/d9dFYUuANFpx\n^^ ${i.toString(n(590).membership.streamEditorFeatures.join("<br>"))}\n\n## Sponsorship Program\n\nOur sponsorship program is designed for those who cannot afford a membership.\nYour support helps us develop this great resource for so many people in need.\n\n> "I love to mess around with pictures. I LOVE this site. I have twin granddaughters, my only grandchildren, so I do a lot of playing around with the pictures frames with them. I am a disable grandmother."\n>-- -Sponsorship Recipient\n\n> "I have enjoyed the Imikimi website for several years. I have used it to help lift the spirits up of many people. When my friend's husband died, I found a beautiful blue frame to frame a picture of him wearing a blue shirt. She loved it and used it to announce his obituary. I love sending  Happy Birthday pictures to friends on Facebook on their birthday using the Imikimi frames. It makes me happy to use Imikimi to brighten someone's day."\n>-- -Sponsorship Recipient\n\n> "I am an old age pensioner of 76 years old, and this is the only way I can afford to send Christmas Cards. I use your cards all the time [...]. I use Kimi frames to add my own photos for family mostly, but also to post for my many friends on social media. This saves me having to do a 5 mile trip to our nearest Post Office & also saves my old age pension money on the high costs of postage. I tell all my friends & family what a great site this is, and a good few of them use it now."\n>-- -Sponsorship Recipient\n\n## Why Subscriptions?\n\nAd-based services are not free. Though some ad-based business are more intrusive than others, every ad-business\nmakes its money by manipulating your attention and using your valuable time. They make money when you are viewing\nand clicking on ads, instead of satisfying the need you came to their service to fulfill.\n\nAs a subscription-based business, our sole purpose is to fulfill your needs as fully as possible while wasting\nyour time as little as possible. Our success is directly aligned with satisfying your needs to the very best of our ability.\n\nAd-based businesses also make money another way. They collect personal information about you and sell it. Usually it is sold to\nadvertisers who want your business, but anyone can buy your personal information for whatever purpose they want.\n\nWe do not sell your information to anyone. We have no need to.\n\nSubscriptions allow us to:\n\n* Serve you directly\n* Protect your privacy\n* Respect your attention and time\n\n# Join Us\n\nWe believe in meaningful relationships, community and creative self-expression.\nWe value your time, attention and privacy.\n\nYour subscription matters. With it we can offer you ever better ways to enhance your photos,\nbuild meaningful connections and give sponsorships that impact so many wonderful lives.\n\nWe hope you'll join us.\n>-- Thank you<br>Shane & Kent`}),this.renderButtons("v2BottomButtons")]},this.prototype.renderButtons=function(t){return l("column","parentWidthChildrenHeight","childrenCenterCenter",u({action:()=>this.subscribeAction(t)}),c({size:{h:this.buttonSize,w:this.feedWidth-2*this.gridSize},backgroundColor:h.lightGrey,radius:100,text:"Apply for Sponsorship",action:()=>this.applyForSponsorship(t)}),c({size:{h:this.buttonSize,w:this.feedWidth-2*this.gridSize},backgroundColor:h.lightGrey,radius:100,text:"Maybe later...",action:()=>this.cancelAction(t)}))},this.prototype.render=function(){let t,e,n;return t=void 0!==(n=this.safePadding)?n:{left:0,right:0,top:0,bottom:0},e=i.object(t,t=>d(t,this.gridSize)),l({draw:"white",padding:t},p({padding:{left:d(0,this.gridSize-t.left),right:d(0,this.gridSize-t.right)},scrollBarOpacity:.2,clip:!0},"childrenCenterCenter",l({padding:{top:d(0,this.gridSize-t.top),bottom:d(0,this.gridSize-t.bottom)},size:{ww:1,hch:1,max:{w:33*this.gridSize}},childrenMargins:2*this.gridSize},"childrenTopCenter","column",l("row","parentWidthChildrenHeight",{childrenMargins:this.gridSize/2},l(f(m.largeText,"childrenSize","centerRight",{animators:{size:!0},text:"imikimi",color:h.primary})),g({size:1.5*m.largeText.fontSize})),this.renderMixedVersion())))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["FluxComponent","Element","TextElement","TextStyles","Neptune"],[e,n(810)],(t,e,n,r,o)=>{return i.defClass(class VersionWatermark extends t{},function(t,i,s){this.prototype.render=function(){return e({receivePointerEvents:"never",inFlow:!1,opacity:.25,size:"childrenSize",padding:1,draw:{padding:1,rectangle:{radius:3},fill:"white"},location:"bottomRight",axis:1},n(r.bittyText,{fontSize:7,size:"childrenSize",color:"black",text:"v"+o.Imikimi.Oz.version}))}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(301)).addModules({MediaBackground:n(1236)})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["Paths","isPlainObject","isNumber","isString","isPlainArray","merge"],[e,n(268)],(t,e,r,o,s,a)=>{let l,u;return l=n(576).generatePreviewBitmap,u=t.rectanglePath,i.defClass(class MediaBackground extends n(341).BitmapElement{constructor(t,e){super(...arguments),this._renderedRectangles=!1,this._lastBitmapRenderOpacity=0}},function(t,n,c){this.drawProperty({previewBitmap:{default:null},post:{default:null,validate:function(t){return!t||e(t)},setter:function(t){let e,n,r,o,s;return i.exists(t)&&(e=t.dimensions,n=t.focus,r=t.colorMap,o=t.aspectRatio,s=t.bitmap),e&&(null!=o||(o=e.x/e.y)),this.setAspectRatio(o),this.setFocus(n),s&&this.setBitmap(s),t}},radius:{default:0,validate:function(t){return!t||r(t)||e(t)},preprocess:function(t){return t||0}},bitmapOpacity:{default:0,validate:function(t){return r(t)}}}),this.prototype.animateInBitmap=function(){return this.bitmapOpacity=1},this.prototype._drawContents=function(t,e,n){let i,r,a,u,c,h;return h=this,i=this.bitmapOpacity,r=this.previewBitmap,a=this.currentBitmap,u=this.post,a||!u||r||(c=u.colorMap,(o(c)&&54===c.length||s(c)&&9===c.length)&&this.setPreviewBitmap(r=l(c))),0<i&&a&&(n.opacity=1,this._drawBitmapElement(t,e,n)),1>i?(n.opacity=1-i,this._renderedPreviewBitmap=!0,t.drawBitmapWithLayout(e,r,n)):a&&r?this.setPreviewBitmap(null):void 0},this.prototype.startPreviewAnimation=function(){return this._previewAnimationStarted=!0,this._renderedPreviewBitmap&&this.setAnimators(a(this.getPendingAnimators(),{bitmapOpacity:!0})),this.setBitmapOpacity(1)},this.prototype.fillShape=function(t,e,n){let i,r,o,s;return this.getCurrentBitmap()&&!this._previewAnimationStarted&&this.startPreviewAnimation(),null!=(i=this._radius)&&i>.01?(n.radius=i,r=this.getPaddedArea(),(o=n.shadow)&&(n.fillStyle=null,n.color=o.color,t.drawRectangle(e,r,n),n.shadow=null),s=t.openClipping(u,e,r,n),this._drawContents(t,e,n),t.closeClipping(s)):this._drawContents(t,e,n)}})}))}).call(this,n(2)(t),n(5))},function(t,e,n){(t.exports=n(302)).addModules({ImagePicker:n(634),ImageUploader:n(645),StandardImport:n(635)})},function(t,e,n){t.exports=n(1041)},function(t,e,n){(t.exports=n(1240)).includeInNamespace(n(1241)).addModules({ReadOnly:n(1242)})},function(t,e,n){t.exports=n(269).addNamespace("LiveTests",class LiveTests extends Neptune.PackageNamespace{})},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["log","Neptune"],[e,n(268)],(t,r)=>{let o;return{testAll:o=function(){let o,s,a,l,u;return o=0,s="",a=((e,n,r,a)=>{let l;return o++,l=`\n${i.toString(e)}: ${i.toString(n)}`,r&&(l+=` (${i.toString(r)}:${i.toString(a)})`),s+=l,t.error(`LIVETEST Error ${i.toString(o)}: ${i.toString(l)}`)}),e.addEventListener("error",l=(({message:t,filename:e,lineno:n})=>a("Unhandled Exception",t,e,n))),e.addEventListener("unhandledrejection",u=(e=>{let n,r,o,s,l,u;return(n=null!=(l=e.detail.Error)?l:i.exists(u=e.detail.reason)&&u.message&&e.detail.reason)?(r=n.message,o=n.filename,s=n.lineno,a("Unhandled Rejection",r,o,s)):(t.error({unhandledrejection:e}),a("Unhandled Rejection",e.detail.reason))})),n(1242).testAll().then(()=>{let n,a,c;return e.removeEventListener("error",l),e.removeEventListener("unhandledrejection",u),n=`LiveTest Results: ${i.toString(s.length>0?`${i.toString(o)} Errors`:"Success")}`,a=o>0?s:"no errors detected",c=`====================================\n${i.toString(n)}\n${i.toString(a)}\n====================================`,o>0?t.error(c):t(c),r.Art.Flux.models.navState.showSystemMessage({title:n,warning:s.length>0,message:a})})},runAll:o}}))}).call(this,n(2)(t),n(5))},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["BaseClass","models","ApplicationState","timeout","Promise","log","w","pipelines"],[e,n(268),n(758)],(t,e,n,r,o,s,a,l)=>{return i.defClass(class ReadOnly extends t{},function(t,u,c){let h;({navState:h}=e),this.resetModels=function(){return i.each2(e,(t,e)=>e instanceof n?e.resetState():void 0,(t,e)=>"viewState"!==t),e.session.logOut().then(()=>r(1e3)).then(()=>e.navState.loading=!1).then(()=>r(2e3))},this.setupModelLiveTest=function(e,n=1e3){let a,l,u;return a=0,l=0,(u=((t,n,c,h=o.resolve())=>{let p;return l++,(p=h.then(()=>(a++,s.warn(`LIVETEST ${i.toString(e)} STEP ${i.toString(a)}/${i.toString(l)}: ${i.toString(t)}`),n()))).catch(n=>(s.error(`ERROR IN LIVETEST ${i.toString(e)} STEP ${i.toString(a)}/${i.toString(l)}: ${i.toString(t)}`),s(n),(()=>{throw n})())).then(()=>r(c)),p.thenTest=((t,e)=>u(t,e,c,p)),p}))("resetModels",()=>t.resetModels().then(()=>r(n)))(n)},this.testTabBarActions=function(){let e;return e=t.setupModelLiveTest("testTabBarActions"),i.array(a("kimiHome search home toggleShowLogin toggleShowNewPost toggleShowSocialActivity toggleShowHelp hideOverlay"),t=>e=e.thenTest(t,()=>h[t]())),e},this.testSearch=function(){let e;return(e=t.setupModelLiveTest("testPostSpecificActions",2e3)).thenTest("search",()=>h.search("love")),i.array(a("sortByTrending sortByDate sortByUses clearSearchKimis"),t=>e=e.thenTest(t,()=>h[t]())),e},this.testPostSpecificActions=function(){return l.topic.staffPicks().then(([e])=>{let n;return n=e.lastPost,s.warn({testPostSpecificActions:{topic:e.id,post:n.id}}),t.setupModelLiveTest("testPostSpecificActions",2e3).thenTest("showPost",()=>h.showPost(n)).thenTest("showTopicSettings with post",()=>h.showTopicSettings(n)).thenTest("showChapterNavigator with topic",()=>h.showChapterNavigator(e)).thenTest("showTopicSettings with topic",()=>h.showTopicSettings(e)).thenTest("showSharePost",()=>h.showSharePost(n)).thenTest("showMessages",()=>h.showMessages(n)).thenTest("hideOverlay",()=>h.hideOverlay()).thenTest("closeFullScreenPost",()=>h.closeFullScreenPost()).thenTest("searchWithinTopicId",()=>h.searchWithinTopicId(e.id)).thenTest("searchWithinUserId",()=>h.searchWithinUserId(e.userId))})},this.testAll=(()=>this.testTabBarActions().then(()=>this.testSearch()).then(()=>this.testPostSpecificActions()).then(()=>s.warn("!!!!!!!!!!! testALL DONE !!!!!!!!!!!!!!")).then(()=>h.home()))})}))}).call(this,n(2)(t),n(5))},function(t,e,n){t.exports=n(1244)},function(t,e,n){"use strict";(function(t,e){let i=n(3);i.defMod(t,()=>i.importInvoke(["initArtSuiteApp"],[e,n(307)],t=>{return i.defClass(class Client extends Object{},function(e,n,i){this.initArtSuiteClient=function(e){return t(e)}})}))}).call(this,n(2)(t),n(5))}]);
